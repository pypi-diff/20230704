# Comparing `tmp/inmanta-core-8.3.0.tar.gz` & `tmp/inmanta-core-9.3.0.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "inmanta-core-8.3.0.tar", last modified: Wed Apr 12 07:26:35 2023, max compression
+gzip compressed data, was "inmanta-core-9.3.0.tar", last modified: Tue Jul  4 11:30:06 2023, max compression
```

## Comparing `inmanta-core-8.3.0.tar` & `inmanta-core-9.3.0.tar`

### file list

```diff
@@ -1,252 +1,258 @@
-drwxrwxr-x   0 jenkins    (989) jenkins    (987)        0 2023-04-12 07:26:35.434978 inmanta-core-8.3.0/
--rw-rw-r--   0 jenkins    (989) jenkins    (987)    10174 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/LICENSE
--rw-rw-r--   0 jenkins    (989) jenkins    (987)      311 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/MANIFEST.in
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     3195 2023-04-12 07:26:35.434978 inmanta-core-8.3.0/PKG-INFO
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     2238 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/README.md
-drwxrwxr-x   0 jenkins    (989) jenkins    (987)        0 2023-04-12 07:26:35.409977 inmanta-core-8.3.0/misc/
--rw-rw-r--   0 jenkins    (989) jenkins    (987)       31 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/misc/extensions.cfg
--rw-rw-r--   0 jenkins    (989) jenkins    (987)      402 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/misc/inmanta-agent.service
--rw-rw-r--   0 jenkins    (989) jenkins    (987)      333 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/misc/inmanta-server.service
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     8762 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/misc/inmanta-workon-register.sh
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     2906 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/misc/inmanta.cfg
--rw-rw-r--   0 jenkins    (989) jenkins    (987)    12162 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/misc/inmanta.lang
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     1256 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/misc/inmanta.vim
--rw-rw-r--   0 jenkins    (989) jenkins    (987)      141 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/misc/logrotation_config
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     1432 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/pyproject.toml
--rw-rw-r--   0 jenkins    (989) jenkins    (987)      918 2023-04-12 07:26:35.434978 inmanta-core-8.3.0/setup.cfg
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     3393 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/setup.py
-drwxrwxr-x   0 jenkins    (989) jenkins    (987)        0 2023-04-12 07:26:35.407977 inmanta-core-8.3.0/src/
-drwxrwxr-x   0 jenkins    (989) jenkins    (987)        0 2023-04-12 07:26:35.412977 inmanta-core-8.3.0/src/inmanta/
--rw-rw-r--   0 jenkins    (989) jenkins    (987)      914 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/__init__.py
-drwxrwxr-x   0 jenkins    (989) jenkins    (987)        0 2023-04-12 07:26:35.413977 inmanta-core-8.3.0/src/inmanta/agent/
--rw-rw-r--   0 jenkins    (989) jenkins    (987)      738 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/agent/__init__.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)    59551 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/agent/agent.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)    10115 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/agent/cache.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     4634 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/agent/config.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)    42404 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/agent/handler.py
-drwxrwxr-x   0 jenkins    (989) jenkins    (987)        0 2023-04-12 07:26:35.413977 inmanta-core-8.3.0/src/inmanta/agent/io/
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     2815 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/agent/io/__init__.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)    19884 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/agent/io/local.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     6362 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/agent/io/remote.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     3395 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/agent/reporting.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)    32322 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/app.py
-drwxrwxr-x   0 jenkins    (989) jenkins    (987)        0 2023-04-12 07:26:35.414977 inmanta-core-8.3.0/src/inmanta/ast/
--rw-rw-r--   0 jenkins    (989) jenkins    (987)    32260 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/ast/__init__.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     7103 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/ast/attribute.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     6354 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/ast/blocks.py
-drwxrwxr-x   0 jenkins    (989) jenkins    (987)        0 2023-04-12 07:26:35.414977 inmanta-core-8.3.0/src/inmanta/ast/constraint/
--rw-rw-r--   0 jenkins    (989) jenkins    (987)      627 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/ast/constraint/__init__.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)    17187 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/ast/constraint/expression.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)    19266 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/ast/entity.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     2783 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/ast/export.py
-drwxrwxr-x   0 jenkins    (989) jenkins    (987)        0 2023-04-12 07:26:35.415977 inmanta-core-8.3.0/src/inmanta/ast/statements/
--rw-rw-r--   0 jenkins    (989) jenkins    (987)    22464 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/ast/statements/__init__.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)    21894 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/ast/statements/assign.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)    12250 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/ast/statements/call.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)    24146 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/ast/statements/define.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)    40816 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/ast/statements/generator.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)    20775 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/ast/type.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)    12520 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/ast/variables.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     2985 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/command.py
-drwxrwxr-x   0 jenkins    (989) jenkins    (987)        0 2023-04-12 07:26:35.415977 inmanta-core-8.3.0/src/inmanta/compiler/
--rw-rw-r--   0 jenkins    (989) jenkins    (987)    14012 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/compiler/__init__.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     1963 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/compiler/config.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     1110 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/compiler/data.py
-drwxrwxr-x   0 jenkins    (989) jenkins    (987)        0 2023-04-12 07:26:35.416977 inmanta-core-8.3.0/src/inmanta/compiler/help/
--rw-rw-r--   0 jenkins    (989) jenkins    (987)      627 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/compiler/help/__init__.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     8327 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/compiler/help/explainer.py
-drwxrwxr-x   0 jenkins    (989) jenkins    (987)        0 2023-04-12 07:26:35.416977 inmanta-core-8.3.0/src/inmanta/compiler/help/templates/
--rw-rw-r--   0 jenkins    (989) jenkins    (987)      235 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/compiler/help/templates/index_collision.j2
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     3604 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/compiler/help/templates/modified_after_freeze.j2
--rw-rw-r--   0 jenkins    (989) jenkins    (987)      733 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/compiler/help/templates/module_v2_in_v1_path.j2
--rw-rw-r--   0 jenkins    (989) jenkins    (987)    20756 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/config.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     9233 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/const.py
-drwxrwxr-x   0 jenkins    (989) jenkins    (987)        0 2023-04-12 07:26:35.416977 inmanta-core-8.3.0/src/inmanta/data/
--rw-rw-r--   0 jenkins    (989) jenkins    (987)   240602 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/data/__init__.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)    44266 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/data/dataview.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)    21310 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/data/model.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)    12206 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/data/schema.py
-drwxrwxr-x   0 jenkins    (989) jenkins    (987)        0 2023-04-12 07:26:35.417977 inmanta-core-8.3.0/src/inmanta/db/
--rw-rw-r--   0 jenkins    (989) jenkins    (987)      627 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/db/__init__.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     8702 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/db/util.py
-drwxrwxr-x   0 jenkins    (989) jenkins    (987)        0 2023-04-12 07:26:35.421977 inmanta-core-8.3.0/src/inmanta/db/versions/
--rw-rw-r--   0 jenkins    (989) jenkins    (987)      627 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/db/versions/__init__.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)    12123 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/db/versions/v1.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     1737 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/db/versions/v17.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     1393 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/db/versions/v2.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     2443 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/db/versions/v202105170.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)      915 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/db/versions/v202106080.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     1247 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/db/versions/v202106210.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     1826 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/db/versions/v202109100.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)      979 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/db/versions/v202111260.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     1581 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/db/versions/v202203140.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     2200 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/db/versions/v202203160.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)      910 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/db/versions/v202205250.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)      979 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/db/versions/v202206290.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)      948 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/db/versions/v202208180.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     1881 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/db/versions/v202208190.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)      976 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/db/versions/v202209090.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     3957 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/db/versions/v202209130.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)      861 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/db/versions/v202209160.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     2919 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/db/versions/v202211230.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     1430 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/db/versions/v202212010.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     1494 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/db/versions/v202301100.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)      924 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/db/versions/v202301110.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)      977 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/db/versions/v202301120.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)      929 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/db/versions/v202301160.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)      896 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/db/versions/v202301170.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     1313 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/db/versions/v202301190.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)      860 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/db/versions/v202302200.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     1036 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/db/versions/v202302270.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)      825 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/db/versions/v202303070.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     1936 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/db/versions/v202303071.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     1471 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/db/versions/v3.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     3556 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/db/versions/v4.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     1529 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/db/versions/v5.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     1043 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/db/versions/v6.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     1558 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/db/versions/v7.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)    16471 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/deploy.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     2694 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/docstring_parser.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)    56412 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/env.py
-drwxrwxr-x   0 jenkins    (989) jenkins    (987)        0 2023-04-12 07:26:35.421977 inmanta-core-8.3.0/src/inmanta/execute/
--rw-rw-r--   0 jenkins    (989) jenkins    (987)      627 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/execute/__init__.py
-drwxrwxr-x   0 jenkins    (989) jenkins    (987)        0 2023-04-12 07:26:35.422978 inmanta-core-8.3.0/src/inmanta/execute/dataflow/
--rw-rw-r--   0 jenkins    (989) jenkins    (987)    41029 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/execute/dataflow/__init__.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     9488 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/execute/dataflow/datatrace.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     7405 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/execute/dataflow/graphic.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     7152 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/execute/dataflow/root_cause.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     8478 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/execute/proxy.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)    49389 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/execute/runtime.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)    30598 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/execute/scheduler.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     1807 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/execute/tracking.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     1451 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/execute/util.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)    25617 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/export.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     5488 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/file_parser.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)    24386 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/loader.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)    35363 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/main.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     9144 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/model.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)   141814 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/module.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)    82419 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/moduletool.py
-drwxrwxr-x   0 jenkins    (989) jenkins    (987)        0 2023-04-12 07:26:35.423977 inmanta-core-8.3.0/src/inmanta/parser/
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     2934 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/parser/__init__.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     5591 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/parser/cache.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)   505683 2023-04-12 07:26:25.000000 inmanta-core-8.3.0/src/inmanta/parser/parser.out
--rw-rw-r--   0 jenkins    (989) jenkins    (987)    66421 2023-04-12 07:26:25.000000 inmanta-core-8.3.0/src/inmanta/parser/parsetab.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     1563 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/parser/pickle.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     7799 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/parser/plyInmantaLex.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)    36122 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/parser/plyInmantaParser.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)    21362 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/plugins.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     5509 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/postgresproc.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)      734 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/profile_mem.py
-drwxrwxr-x   0 jenkins    (989) jenkins    (987)        0 2023-04-12 07:26:35.424978 inmanta-core-8.3.0/src/inmanta/protocol/
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     3131 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/protocol/__init__.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)    41952 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/protocol/common.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     8807 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/protocol/decorators.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)    17519 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/protocol/endpoints.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     4455 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/protocol/exceptions.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)    33273 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/protocol/methods.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)    61334 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/protocol/methods_v2.py
-drwxrwxr-x   0 jenkins    (989) jenkins    (987)        0 2023-04-12 07:26:35.424978 inmanta-core-8.3.0/src/inmanta/protocol/openapi/
--rw-rw-r--   0 jenkins    (989) jenkins    (987)      627 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/protocol/openapi/__init__.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)    20514 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/protocol/openapi/converter.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     9049 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/protocol/openapi/model.py
-drwxrwxr-x   0 jenkins    (989) jenkins    (987)        0 2023-04-12 07:26:35.424978 inmanta-core-8.3.0/src/inmanta/protocol/rest/
--rw-rw-r--   0 jenkins    (989) jenkins    (987)    21717 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/protocol/rest/__init__.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     6064 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/protocol/rest/client.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)    13836 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/protocol/rest/server.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     2158 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/protocol/return_value_meta.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)        0 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/py.typed
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     6273 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/reporter.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)    23291 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/resources.py
-drwxrwxr-x   0 jenkins    (989) jenkins    (987)        0 2023-04-12 07:26:35.426978 inmanta-core-8.3.0/src/inmanta/server/
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     1363 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/server/__init__.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)    55982 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/server/agentmanager.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     9730 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/server/bootloader.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)      688 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/server/compilerservice.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)    10223 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/server/config.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     7314 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/server/diff.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     7672 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/server/extensions.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)    27495 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/server/protocol.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     7036 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/server/server.py
-drwxrwxr-x   0 jenkins    (989) jenkins    (987)        0 2023-04-12 07:26:35.427978 inmanta-core-8.3.0/src/inmanta/server/services/
--rw-rw-r--   0 jenkins    (989) jenkins    (987)      627 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/server/services/__init__.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     5702 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/server/services/codeservice.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)    38105 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/server/services/compilerservice.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     4850 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/server/services/databaseservice.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)    11640 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/server/services/dryrunservice.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)    25390 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/server/services/environment_metrics_service.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)    27904 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/server/services/environmentservice.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     6420 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/server/services/fileservice.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     4551 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/server/services/metricservice.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     7970 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/server/services/notificationservice.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)    64468 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/server/services/orchestrationservice.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)    13562 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/server/services/paramservice.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     6280 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/server/services/projectservice.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)    45518 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/server/services/resourceservice.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     4852 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/server/services/userservice.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)    11714 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/server/validate_filter.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)      865 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/stable_api.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     2927 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/types.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     6908 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/user_setup.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)    25266 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/util.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     6487 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta/warnings.py
-drwxrwxr-x   0 jenkins    (989) jenkins    (987)        0 2023-04-12 07:26:35.428978 inmanta-core-8.3.0/src/inmanta_core.egg-info/
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     3195 2023-04-12 07:26:35.000000 inmanta-core-8.3.0/src/inmanta_core.egg-info/PKG-INFO
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     6863 2023-04-12 07:26:35.000000 inmanta-core-8.3.0/src/inmanta_core.egg-info/SOURCES.txt
--rw-rw-r--   0 jenkins    (989) jenkins    (987)        1 2023-04-12 07:26:35.000000 inmanta-core-8.3.0/src/inmanta_core.egg-info/dependency_links.txt
--rw-rw-r--   0 jenkins    (989) jenkins    (987)      129 2023-04-12 07:26:35.000000 inmanta-core-8.3.0/src/inmanta_core.egg-info/entry_points.txt
--rw-rw-r--   0 jenkins    (989) jenkins    (987)        1 2023-04-12 07:26:17.000000 inmanta-core-8.3.0/src/inmanta_core.egg-info/not-zip-safe
--rw-rw-r--   0 jenkins    (989) jenkins    (987)      589 2023-04-12 07:26:35.000000 inmanta-core-8.3.0/src/inmanta_core.egg-info/requires.txt
--rw-rw-r--   0 jenkins    (989) jenkins    (987)       36 2023-04-12 07:26:35.000000 inmanta-core-8.3.0/src/inmanta_core.egg-info/top_level.txt
-drwxrwxr-x   0 jenkins    (989) jenkins    (987)        0 2023-04-12 07:26:35.407977 inmanta-core-8.3.0/src/inmanta_ext/
-drwxrwxr-x   0 jenkins    (989) jenkins    (987)        0 2023-04-12 07:26:35.428978 inmanta-core-8.3.0/src/inmanta_ext/core/
--rw-rw-r--   0 jenkins    (989) jenkins    (987)      627 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta_ext/core/__init__.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     2238 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta_ext/core/extension.py
-drwxrwxr-x   0 jenkins    (989) jenkins    (987)        0 2023-04-12 07:26:35.407977 inmanta-core-8.3.0/src/inmanta_plugins/
-drwxrwxr-x   0 jenkins    (989) jenkins    (987)        0 2023-04-12 07:26:35.429978 inmanta-core-8.3.0/src/inmanta_plugins/1/
--rw-rw-r--   0 jenkins    (989) jenkins    (987)      627 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/src/inmanta_plugins/1/__init__.py
-drwxrwxr-x   0 jenkins    (989) jenkins    (987)        0 2023-04-12 07:26:35.434978 inmanta-core-8.3.0/tests/
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     7790 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/tests/test_2way_protocol.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     7692 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/tests/test_agent.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)    54792 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/tests/test_agent_manager.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)    18854 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/tests/test_app.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)    12682 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/tests/test_app_cli.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)    12791 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/tests/test_cache.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)    18791 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/tests/test_cli.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     4624 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/tests/test_compilation.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     7682 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/tests/test_compiler_entrypoints.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)    11564 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/tests/test_config.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     1300 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/tests/test_const.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)   120276 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/tests/test_data.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     8212 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/tests/test_data_concurrency.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     3426 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/tests/test_data_model.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     3912 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/tests/test_deploy.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     5151 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/tests/test_docs_snippets.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     3047 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/tests/test_docstring_parser.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)    27232 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/tests/test_env.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)    21255 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/tests/test_export.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     9102 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/tests/test_extension_loading.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     2789 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/tests/test_file_parser.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     6670 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/tests/test_handler.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     4111 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/tests/test_import_entry_points.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     5982 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/tests/test_influxdbreporting.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     8541 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/tests/test_io.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     5352 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/tests/test_jwt.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)    18512 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/tests/test_loader.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)    54161 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/tests/test_module_loader.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)    18976 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/tests/test_modules.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)    33059 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/tests/test_openapi.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)      988 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/tests/test_param.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)    62820 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/tests/test_parser.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     6299 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/tests/test_postgres.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     2110 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/tests/test_postgres_proc.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)    24509 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/tests/test_project.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     3805 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/tests/test_projectmetadata.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)    77912 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/tests/test_protocol.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     3038 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/tests/test_proxy.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)    11162 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/tests/test_resource.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)    59544 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/tests/test_server.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     3664 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/tests/test_type.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     5678 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/tests/test_usersetup.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)    17775 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/tests/test_util.py
--rw-rw-r--   0 jenkins    (989) jenkins    (987)     1924 2023-04-12 07:23:21.000000 inmanta-core-8.3.0/tox.ini
+drwxrwxr-x   0 jenkins    (989) jenkins    (987)        0 2023-07-04 11:30:06.147137 inmanta-core-9.3.0/
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)    10174 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/LICENSE
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)      311 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/MANIFEST.in
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     3195 2023-07-04 11:30:06.147137 inmanta-core-9.3.0/PKG-INFO
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     2238 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/README.md
+drwxrwxr-x   0 jenkins    (989) jenkins    (987)        0 2023-07-04 11:30:06.114136 inmanta-core-9.3.0/misc/
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)       31 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/misc/extensions.cfg
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)      402 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/misc/inmanta-agent.service
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)      333 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/misc/inmanta-server.service
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     8762 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/misc/inmanta-workon-register.sh
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     2906 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/misc/inmanta.cfg
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)    12162 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/misc/inmanta.lang
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     1256 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/misc/inmanta.vim
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)      141 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/misc/logrotation_config
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     1432 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/pyproject.toml
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)      918 2023-07-04 11:30:06.148137 inmanta-core-9.3.0/setup.cfg
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     3416 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/setup.py
+drwxrwxr-x   0 jenkins    (989) jenkins    (987)        0 2023-07-04 11:30:06.112136 inmanta-core-9.3.0/src/
+drwxrwxr-x   0 jenkins    (989) jenkins    (987)        0 2023-07-04 11:30:06.118136 inmanta-core-9.3.0/src/inmanta/
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)      914 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/__init__.py
+drwxrwxr-x   0 jenkins    (989) jenkins    (987)        0 2023-07-04 11:30:06.119136 inmanta-core-9.3.0/src/inmanta/agent/
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)      738 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/agent/__init__.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)    59119 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/agent/agent.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)    10115 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/agent/cache.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     5149 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/agent/config.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)    43297 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/agent/handler.py
+drwxrwxr-x   0 jenkins    (989) jenkins    (987)        0 2023-07-04 11:30:06.119136 inmanta-core-9.3.0/src/inmanta/agent/io/
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     2815 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/agent/io/__init__.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)    19884 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/agent/io/local.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     6362 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/agent/io/remote.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     3395 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/agent/reporting.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)    28443 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/app.py
+drwxrwxr-x   0 jenkins    (989) jenkins    (987)        0 2023-07-04 11:30:06.120136 inmanta-core-9.3.0/src/inmanta/ast/
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)    32500 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/ast/__init__.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     7103 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/ast/attribute.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     6354 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/ast/blocks.py
+drwxrwxr-x   0 jenkins    (989) jenkins    (987)        0 2023-07-04 11:30:06.120136 inmanta-core-9.3.0/src/inmanta/ast/constraint/
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)      627 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/ast/constraint/__init__.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)    17182 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/ast/constraint/expression.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)    19266 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/ast/entity.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     2783 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/ast/export.py
+drwxrwxr-x   0 jenkins    (989) jenkins    (987)        0 2023-07-04 11:30:06.121136 inmanta-core-9.3.0/src/inmanta/ast/statements/
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)    23361 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/ast/statements/__init__.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)    23834 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/ast/statements/assign.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)    12314 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/ast/statements/call.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)    24146 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/ast/statements/define.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)    55960 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/ast/statements/generator.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)    20775 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/ast/type.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)    12524 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/ast/variables.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     3400 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/command.py
+drwxrwxr-x   0 jenkins    (989) jenkins    (987)        0 2023-07-04 11:30:06.121136 inmanta-core-9.3.0/src/inmanta/compiler/
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)    14509 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/compiler/__init__.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     1963 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/compiler/config.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     1110 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/compiler/data.py
+drwxrwxr-x   0 jenkins    (989) jenkins    (987)        0 2023-07-04 11:30:06.122136 inmanta-core-9.3.0/src/inmanta/compiler/help/
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)      627 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/compiler/help/__init__.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     8327 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/compiler/help/explainer.py
+drwxrwxr-x   0 jenkins    (989) jenkins    (987)        0 2023-07-04 11:30:06.122136 inmanta-core-9.3.0/src/inmanta/compiler/help/templates/
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)      235 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/compiler/help/templates/index_collision.j2
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     3604 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/compiler/help/templates/modified_after_freeze.j2
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)      733 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/compiler/help/templates/module_v2_in_v1_path.j2
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)    20756 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/config.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     9233 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/const.py
+drwxrwxr-x   0 jenkins    (989) jenkins    (987)        0 2023-07-04 11:30:06.123136 inmanta-core-9.3.0/src/inmanta/data/
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)   242866 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/data/__init__.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)    46598 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/data/dataview.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)    21742 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/data/model.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)    12206 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/data/schema.py
+drwxrwxr-x   0 jenkins    (989) jenkins    (987)        0 2023-07-04 11:30:06.123136 inmanta-core-9.3.0/src/inmanta/db/
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)      627 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/db/__init__.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     8702 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/db/util.py
+drwxrwxr-x   0 jenkins    (989) jenkins    (987)        0 2023-07-04 11:30:06.127137 inmanta-core-9.3.0/src/inmanta/db/versions/
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)      627 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/db/versions/__init__.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)    12123 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/db/versions/v1.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     1737 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/db/versions/v17.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     1393 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/db/versions/v2.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     2443 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/db/versions/v202105170.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)      915 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/db/versions/v202106080.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     1247 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/db/versions/v202106210.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     1826 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/db/versions/v202109100.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)      979 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/db/versions/v202111260.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     1581 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/db/versions/v202203140.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     2200 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/db/versions/v202203160.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)      910 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/db/versions/v202205250.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)      979 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/db/versions/v202206290.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)      948 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/db/versions/v202208180.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     1881 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/db/versions/v202208190.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)      976 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/db/versions/v202209090.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     3957 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/db/versions/v202209130.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)      861 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/db/versions/v202209160.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     2919 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/db/versions/v202211230.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     1430 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/db/versions/v202212010.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     1494 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/db/versions/v202301100.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)      924 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/db/versions/v202301110.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)      977 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/db/versions/v202301120.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)      929 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/db/versions/v202301160.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)      896 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/db/versions/v202301170.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     1313 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/db/versions/v202301190.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)      860 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/db/versions/v202302200.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     1036 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/db/versions/v202302270.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)      825 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/db/versions/v202303070.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     1936 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/db/versions/v202303071.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)      989 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/db/versions/v202304060.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     1027 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/db/versions/v202304070.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     1434 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/db/versions/v202306060.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     1471 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/db/versions/v3.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     3556 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/db/versions/v4.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     1529 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/db/versions/v5.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     1043 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/db/versions/v6.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     1558 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/db/versions/v7.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)    16471 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/deploy.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     2694 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/docstring_parser.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)    57882 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/env.py
+drwxrwxr-x   0 jenkins    (989) jenkins    (987)        0 2023-07-04 11:30:06.128136 inmanta-core-9.3.0/src/inmanta/execute/
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)      627 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/execute/__init__.py
+drwxrwxr-x   0 jenkins    (989) jenkins    (987)        0 2023-07-04 11:30:06.128136 inmanta-core-9.3.0/src/inmanta/execute/dataflow/
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)    41029 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/execute/dataflow/__init__.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     9488 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/execute/dataflow/datatrace.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     7405 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/execute/dataflow/graphic.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     7152 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/execute/dataflow/root_cause.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     8478 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/execute/proxy.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)    50130 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/execute/runtime.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)    30598 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/execute/scheduler.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     1807 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/execute/tracking.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     1451 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/execute/util.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)    25819 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/export.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     5488 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/file_parser.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)    24386 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/loader.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)    11292 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/logging.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)    35363 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/main.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     9144 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/model.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)   143695 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/module.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)    83933 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/moduletool.py
+drwxrwxr-x   0 jenkins    (989) jenkins    (987)        0 2023-07-04 11:30:06.130137 inmanta-core-9.3.0/src/inmanta/parser/
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     2934 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/parser/__init__.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     5803 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/parser/cache.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)   549509 2023-07-04 11:29:55.000000 inmanta-core-9.3.0/src/inmanta/parser/parser.out
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)    71238 2023-07-04 11:29:55.000000 inmanta-core-9.3.0/src/inmanta/parser/parsetab.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     1563 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/parser/pickle.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     8245 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/parser/plyInmantaLex.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)    41546 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/parser/plyInmantaParser.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)    23793 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/plugins.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     5509 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/postgresproc.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)      734 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/profile_mem.py
+drwxrwxr-x   0 jenkins    (989) jenkins    (987)        0 2023-07-04 11:30:06.132137 inmanta-core-9.3.0/src/inmanta/protocol/
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     3131 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/protocol/__init__.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)    42088 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/protocol/common.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     9024 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/protocol/decorators.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)    17283 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/protocol/endpoints.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     4455 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/protocol/exceptions.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)    32616 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/protocol/methods.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)    63705 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/protocol/methods_v2.py
+drwxrwxr-x   0 jenkins    (989) jenkins    (987)        0 2023-07-04 11:30:06.132137 inmanta-core-9.3.0/src/inmanta/protocol/openapi/
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)      627 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/protocol/openapi/__init__.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)    20514 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/protocol/openapi/converter.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     9049 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/protocol/openapi/model.py
+drwxrwxr-x   0 jenkins    (989) jenkins    (987)        0 2023-07-04 11:30:06.133137 inmanta-core-9.3.0/src/inmanta/protocol/rest/
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)    23049 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/protocol/rest/__init__.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     6064 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/protocol/rest/client.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)    13955 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/protocol/rest/server.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     2158 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/protocol/return_value_meta.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)        0 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/py.typed
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     6396 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/reporter.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)    23670 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/resources.py
+drwxrwxr-x   0 jenkins    (989) jenkins    (987)        0 2023-07-04 11:30:06.135137 inmanta-core-9.3.0/src/inmanta/server/
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     1363 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/server/__init__.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)    56173 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/server/agentmanager.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     9866 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/server/bootloader.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)      688 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/server/compilerservice.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)    10223 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/server/config.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     7314 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/server/diff.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     7672 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/server/extensions.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)    27983 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/server/protocol.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     7705 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/server/server.py
+drwxrwxr-x   0 jenkins    (989) jenkins    (987)        0 2023-07-04 11:30:06.138137 inmanta-core-9.3.0/src/inmanta/server/services/
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)      627 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/server/services/__init__.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     5702 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/server/services/codeservice.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)    42567 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/server/services/compilerservice.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     5790 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/server/services/databaseservice.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)    11640 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/server/services/dryrunservice.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)    25390 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/server/services/environment_metrics_service.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)    27899 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/server/services/environmentservice.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     6420 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/server/services/fileservice.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     4551 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/server/services/metricservice.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     7970 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/server/services/notificationservice.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)    59626 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/server/services/orchestrationservice.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)    13898 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/server/services/paramservice.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     6280 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/server/services/projectservice.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)    48277 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/server/services/resourceservice.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     4852 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/server/services/userservice.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)    11714 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/server/validate_filter.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)      865 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/stable_api.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     2927 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/types.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     6908 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/user_setup.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)    27310 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/util.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     6487 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta/warnings.py
+drwxrwxr-x   0 jenkins    (989) jenkins    (987)        0 2023-07-04 11:30:06.139137 inmanta-core-9.3.0/src/inmanta_core.egg-info/
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     3195 2023-07-04 11:30:06.000000 inmanta-core-9.3.0/src/inmanta_core.egg-info/PKG-INFO
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     7057 2023-07-04 11:30:06.000000 inmanta-core-9.3.0/src/inmanta_core.egg-info/SOURCES.txt
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)        1 2023-07-04 11:30:06.000000 inmanta-core-9.3.0/src/inmanta_core.egg-info/dependency_links.txt
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)      129 2023-07-04 11:30:06.000000 inmanta-core-9.3.0/src/inmanta_core.egg-info/entry_points.txt
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)        1 2023-07-04 11:29:45.000000 inmanta-core-9.3.0/src/inmanta_core.egg-info/not-zip-safe
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)      586 2023-07-04 11:30:06.000000 inmanta-core-9.3.0/src/inmanta_core.egg-info/requires.txt
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)       36 2023-07-04 11:30:06.000000 inmanta-core-9.3.0/src/inmanta_core.egg-info/top_level.txt
+drwxrwxr-x   0 jenkins    (989) jenkins    (987)        0 2023-07-04 11:30:06.112136 inmanta-core-9.3.0/src/inmanta_ext/
+drwxrwxr-x   0 jenkins    (989) jenkins    (987)        0 2023-07-04 11:30:06.139137 inmanta-core-9.3.0/src/inmanta_ext/core/
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)      627 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta_ext/core/__init__.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     2238 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta_ext/core/extension.py
+drwxrwxr-x   0 jenkins    (989) jenkins    (987)        0 2023-07-04 11:30:06.112136 inmanta-core-9.3.0/src/inmanta_plugins/
+drwxrwxr-x   0 jenkins    (989) jenkins    (987)        0 2023-07-04 11:30:06.139137 inmanta-core-9.3.0/src/inmanta_plugins/1/
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)      627 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/src/inmanta_plugins/1/__init__.py
+drwxrwxr-x   0 jenkins    (989) jenkins    (987)        0 2023-07-04 11:30:06.147137 inmanta-core-9.3.0/tests/
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     7829 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/tests/test_2way_protocol.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     8023 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/tests/test_agent.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)    54739 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/tests/test_agent_manager.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)    18854 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/tests/test_app.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)    12682 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/tests/test_app_cli.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)    12791 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/tests/test_cache.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)    18791 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/tests/test_cli.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     4624 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/tests/test_compilation.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     7682 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/tests/test_compiler_entrypoints.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)    11564 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/tests/test_config.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     1300 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/tests/test_const.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)   123032 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/tests/test_data.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     8212 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/tests/test_data_concurrency.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     3426 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/tests/test_data_model.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     3912 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/tests/test_deploy.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     8058 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/tests/test_discovered_resources.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     5151 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/tests/test_docs_snippets.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     3047 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/tests/test_docstring_parser.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)    27584 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/tests/test_env.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)    22013 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/tests/test_export.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     9400 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/tests/test_extension_loading.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     2789 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/tests/test_file_parser.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     6573 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/tests/test_handler.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     4111 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/tests/test_import_entry_points.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     5982 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/tests/test_influxdbreporting.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     8541 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/tests/test_io.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     5352 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/tests/test_jwt.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)    18512 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/tests/test_loader.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     8697 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/tests/test_logging.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)    58413 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/tests/test_module_loader.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)    18976 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/tests/test_modules.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)    33059 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/tests/test_openapi.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)      988 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/tests/test_param.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)    62820 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/tests/test_parser.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     6367 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/tests/test_postgres.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     2110 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/tests/test_postgres_proc.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)    24277 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/tests/test_project.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     5585 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/tests/test_projectmetadata.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)    78909 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/tests/test_protocol.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     3038 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/tests/test_proxy.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)    11162 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/tests/test_resource.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)    62143 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/tests/test_server.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     3664 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/tests/test_type.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     5678 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/tests/test_usersetup.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)    17775 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/tests/test_util.py
+-rw-rw-r--   0 jenkins    (989) jenkins    (987)     1924 2023-07-04 11:27:43.000000 inmanta-core-9.3.0/tox.ini
```

### Comparing `inmanta-core-8.3.0/LICENSE` & `inmanta-core-9.3.0/LICENSE`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/PKG-INFO` & `inmanta-core-9.3.0/PKG-INFO`

 * *Files 0% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: inmanta-core
-Version: 8.3.0
+Version: 9.3.0
 Summary: Inmanta deployment tool
 Home-page: https://github.com/inmanta/inmanta-core
 Author: Inmanta
 Author-email: code@inmanta.com
 License: Apache Software License 2
 Project-URL: Bug Tracker, https://github.com/inmanta/inmanta-core/issues
 Project-URL: Documentation, https://docs.inmanta.com/community/latest/
```

### Comparing `inmanta-core-8.3.0/README.md` & `inmanta-core-9.3.0/README.md`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/misc/inmanta-workon-register.sh` & `inmanta-core-9.3.0/misc/inmanta-workon-register.sh`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/misc/inmanta.cfg` & `inmanta-core-9.3.0/misc/inmanta.cfg`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/misc/inmanta.lang` & `inmanta-core-9.3.0/misc/inmanta.lang`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/misc/inmanta.vim` & `inmanta-core-9.3.0/misc/inmanta.vim`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/pyproject.toml` & `inmanta-core-9.3.0/pyproject.toml`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/setup.cfg` & `inmanta-core-9.3.0/setup.cfg`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/setup.py` & `inmanta-core-9.3.0/setup.py`

 * *Files 4% similar despite different names*

```diff
@@ -5,50 +5,51 @@
     "asyncpg~=0.25,<0.28",
     "click-plugins~=1.0",
     # click has been known to publish non-backwards compatible minors in the past (removed deprecated code in 8.1.0)
     "click>=8.0,<8.2",
     "colorlog~=6.4",
     "cookiecutter>=1,<3",
     "crontab>=0.23,<2.0",
-    "cryptography>=36,<41",
+    "cryptography>=36,<42",
     # docstring-parser has been known to publish non-backwards compatible minors in the past
     "docstring-parser>=0.10,<0.16",
-    "email-validator~=1.0",
+    "email-validator>=1,<3",
     "execnet~=1.0",
     "importlib_metadata>=4,<7",
     "jinja2~=3.0",
     "more-itertools>=8,<10",
     "netifaces~=0.11",
     # leave upper bound floating for fast-moving and extremely stable packaging
     "packaging>=21.3",
     # pip>=21.3 required for editable pyproject.toml + setup.cfg based install support
     "pip>=21.3",
     "ply~=3.0",
-    # Exclude pre-release due to https://github.com/samuelcolvin/pydantic/issues/3546
-    "pydantic~=1.0,!=1.9.0a1",
+    # lower bound because of pydantic/pydantic#5821
+    "pydantic>=1.10.8,<2",
     "pyformance~=0.4",
     "PyJWT~=2.0",
     "pynacl~=1.5",
     "python-dateutil~=2.0",
     "pyyaml~=6.0",
     "texttable~=1.0",
     "tornado~=6.0",
-    "typing_inspect~=0.7",
+    # lower bound because of ilevkivskyi/typing_inspect#100
+    "typing_inspect~=0.9",
     "build~=0.7",
     "ruamel.yaml~=0.17",
     "toml~=0.10 ",
 ]
 
 
 # read the contents of your README file
 this_directory = path.abspath(path.dirname(__file__))
 with open(path.join(this_directory, "README.md"), encoding="utf-8") as f:
     long_description = f.read()
 
-version = "8.3.0"
+version = "9.3.0"
 
 setup(
     version=version,
     python_requires=">=3.9",  # also update classifiers
     # Meta data
     name="inmanta-core",
     description="Inmanta deployment tool",
```

### Comparing `inmanta-core-8.3.0/src/inmanta/__init__.py` & `inmanta-core-9.3.0/src/inmanta/__init__.py`

 * *Files 2% similar despite different names*

```diff
@@ -12,15 +12,15 @@
     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     See the License for the specific language governing permissions and
     limitations under the License.
 
     Contact: code@inmanta.com
 """
 
-COMPILER_VERSION = "2023.2"
+COMPILER_VERSION = "2024.0"
 RUNNING_TESTS = False
 """
     This is enabled/disabled by the test suite when tests are run.
     This variable is used to disable certain features that shouldn't run during tests.
 """
 
 if __name__ == "__main__":
```

### Comparing `inmanta-core-8.3.0/src/inmanta/agent/__init__.py` & `inmanta-core-9.3.0/src/inmanta/agent/__init__.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/agent/agent.py` & `inmanta-core-9.3.0/src/inmanta/agent/agent.py`

 * *Files 2% similar despite different names*

```diff
@@ -23,18 +23,15 @@
 import random
 import time
 import uuid
 from asyncio import Lock
 from collections import defaultdict
 from concurrent.futures.thread import ThreadPoolExecutor
 from logging import Logger
-from typing import TYPE_CHECKING, Any, Dict, Iterable, List, Optional, Sequence, Set, Tuple, cast
-
-from tornado import ioloop
-from tornado.concurrent import Future
+from typing import Any, Dict, Iterable, List, Optional, Sequence, Set, Tuple, cast
 
 from inmanta import const, data, env, protocol
 from inmanta.agent import config as cfg
 from inmanta.agent import handler
 from inmanta.agent.cache import AgentCache
 from inmanta.agent.handler import ResourceHandler, SkipResource
 from inmanta.agent.io.remote import ChannelClosedException
@@ -44,33 +41,28 @@
 from inmanta.loader import CodeLoader, ModuleSource
 from inmanta.protocol import SessionEndpoint, SyncClient, methods, methods_v2
 from inmanta.resources import Id, Resource
 from inmanta.types import Apireturn, JsonType
 from inmanta.util import IntervalSchedule, NamedLock, ScheduledTask, TaskMethod, add_future, join_threadpools
 
 LOGGER = logging.getLogger(__name__)
-GET_RESOURCE_BACKOFF = 5
 
 
 class ResourceActionResult(object):
     def __init__(self, cancel: bool) -> None:
         self.cancel = cancel
 
     def __add__(self, other: "ResourceActionResult") -> "ResourceActionResult":
         return ResourceActionResult(self.cancel or other.cancel)
 
     def __str__(self) -> str:
         return "%r" % self.cancel
 
 
-# https://mypy.readthedocs.io/en/latest/common_issues.html#using-classes-that-are-generic-in-stubs-but-not-at-runtime
-if TYPE_CHECKING:
-    ResourceActionResultFuture = asyncio.Future[ResourceActionResult]
-else:
-    ResourceActionResultFuture = asyncio.Future
+ResourceActionResultFuture = asyncio.Future[ResourceActionResult]
 
 
 class ResourceActionBase(abc.ABC):
     """Base class for Local and Remote resource actions"""
 
     resource_id: Id
     future: ResourceActionResultFuture
@@ -80,15 +72,15 @@
 
     def __init__(self, scheduler: "ResourceScheduler", resource_id: Id, gid: uuid.UUID, reason: str) -> None:
         """
         :param gid: A unique identifier to identify a deploy. This is local to this agent.
         """
         self.scheduler: "ResourceScheduler" = scheduler
         self.resource_id: Id = resource_id
-        self.future: ResourceActionResultFuture = Future()
+        self.future: ResourceActionResultFuture = asyncio.Future()
         # This variable is used to indicate that the future of a ResourceAction will get a value, because of a deploy
         # operation. This variable makes sure that the result cannot be set twice when the ResourceAction is cancelled.
         self.running: bool = False
         self.gid: uuid.UUID = gid
         self.status: Optional[const.ResourceState] = None
         self.change: Optional[const.Change] = const.Change.nochange
         self.undeployable: Optional[const.ResourceState] = None
@@ -167,15 +159,15 @@
         except Exception:
             ctx.set_status(const.ResourceState.unavailable)
             ctx.exception("Unable to find a handler for %(resource_id)s", resource_id=self.resource.id.resource_version_str())
             return
         else:
             # main execution
             try:
-                await asyncio.get_event_loop().run_in_executor(
+                await asyncio.get_running_loop().run_in_executor(
                     self.scheduler.agent.thread_pool,
                     provider.deploy,
                     ctx,
                     self.resource,
                     requires,
                 )
                 if ctx.status is None:
@@ -348,24 +340,22 @@
     State of the last run is not removed after the run but remains.
 
     By not removing e.g. the generation,
     1 - the class is always in a valid state
     2 - we don't need to figure out exactly when a run is done
     """
 
-    def __init__(
-        self, agent: "AgentInstance", env_id: uuid.UUID, name: str, cache: AgentCache, ratelimiter: asyncio.Semaphore
-    ) -> None:
+    def __init__(self, agent: "AgentInstance", env_id: uuid.UUID, name: str, cache: AgentCache) -> None:
         self.generation: Dict[ResourceIdStr, ResourceActionBase] = {}
         self.cad: Dict[str, RemoteResourceAction] = {}
         self._env_id = env_id
         self.agent = agent
         self.cache = cache
         self.name = name
-        self.ratelimiter = ratelimiter
+        self.ratelimiter = agent.ratelimiter
         self.version: int = 0
         # the reason the last run was started
         self.reason: str = ""
         # was the last run a repair run?
         self.is_repair: bool = False
         # if this value is not None, a new repair run will be started after the current run is done
         # this field is both flag and value, to ensure consistency
@@ -536,15 +526,15 @@
             raise Exception("Agent instance started without a valid environment id set.")
 
         self._env_id: uuid.UUID = process.environment
         self.sessionid: uuid.UUID = process.sessionid
 
         # init
         self._cache = AgentCache(self)
-        self._nq = ResourceScheduler(self, self._env_id, name, self._cache, ratelimiter=self.ratelimiter)
+        self._nq = ResourceScheduler(self, self._env_id, name, self._cache)
         self._time_triggered_actions: Set[ScheduledTask] = set()
         self._enabled = False
         self._stopped = False
 
         # do regular deploys
         self._deploy_interval = cfg.agent_deploy_interval.get()
         deploy_splay_time = cfg.agent_deploy_splay_time.get()
@@ -677,23 +667,23 @@
 
     def _can_get_resources(self) -> bool:
         if self._getting_resources:
             self.logger.info("Attempting to get resource while get is in progress")
             return False
         if time.time() < self._get_resource_timeout:
             self.logger.info(
-                "Attempting to get resources during backoff %g seconds left, last download took %d seconds",
+                "Attempting to get resources during backoff %g seconds left, last download took %f seconds",
                 self._get_resource_timeout - time.time(),
                 self._get_resource_duration,
             )
             return False
         return True
 
     async def get_provider(self, resource: Resource) -> ResourceHandler:
-        provider = await asyncio.get_event_loop().run_in_executor(
+        provider = await asyncio.get_running_loop().run_in_executor(
             self.provider_thread_pool, handler.Commander.get_provider, self._cache, self, resource
         )
         provider.set_cache(self._cache)
         return provider
 
     async def get_latest_version_for_agent(
         self, reason: str = "Unknown", incremental_deploy: bool = False, is_repair_run: bool = False
@@ -719,15 +709,15 @@
                 result = await self.get_client().get_resources_for_agent(
                     tid=self._env_id, agent=self.name, incremental_deploy=incremental_deploy
                 )
             finally:
                 self._getting_resources = False
             end = time.time()
             self._get_resource_duration = end - start
-            self._get_resource_timeout = GET_RESOURCE_BACKOFF * self._get_resource_duration + end
+            self._get_resource_timeout = cfg.agent_get_resource_backoff.get() * self._get_resource_duration + end
             if result.code == 404:
                 self.logger.info("No released configuration model version available for %s", reason)
             elif result.code == 409:
                 self.logger.warning("We are not currently primary during %s: %s", reason, result.result)
             elif result.code != 200 or result.result is None:
                 self.logger.warning("Got an error while pulling resources for %s. %s", reason, result.result)
 
@@ -791,15 +781,15 @@
                                 tid=self._env_id,
                                 id=dry_run_id,
                                 resource=resource_id,
                                 changes={"handler": {"current": "FAILED", "desired": "Unable to find a handler"}},
                             )
                         else:
                             try:
-                                await asyncio.get_event_loop().run_in_executor(
+                                await asyncio.get_running_loop().run_in_executor(
                                     self.thread_pool, provider.execute, ctx, resource, True
                                 )
 
                                 changes = ctx.changes
                                 if changes is None:
                                     changes = {}
                                 if ctx.status == const.ResourceState.failed:
@@ -862,15 +852,15 @@
                 resource_obj = resources[0]
                 ctx = handler.HandlerContext(resource_obj)
 
                 version = resource_obj.id.get_version()
                 try:
                     self._cache.open_version(version)
                     provider = await self.get_provider(resource_obj)
-                    result = await asyncio.get_event_loop().run_in_executor(
+                    result = await asyncio.get_running_loop().run_in_executor(
                         self.thread_pool, provider.check_facts, ctx, resource_obj
                     )
 
                     parameters = [
                         {
                             "id": name,
                             "value": value,
@@ -969,31 +959,29 @@
     """
     An agent to enact changes upon resources. This agent listens to the
     message bus for changes.
     """
 
     # cache reference to THIS ioloop for handlers to push requests on it
     # defer to start, just to be sure
-    _io_loop: ioloop.IOLoop
+    _io_loop: asyncio.AbstractEventLoop
 
     def __init__(
         self,
         hostname: Optional[str] = None,
         agent_map: Optional[Dict[str, str]] = None,
         code_loader: bool = True,
         environment: Optional[uuid.UUID] = None,
         poolsize: int = 1,
-        cricital_pool_size: int = 5,
     ):
         super().__init__("agent", timeout=cfg.server_timeout.get(), reconnect_delay=cfg.agent_reconnect_delay.get())
 
         self.hostname = hostname
         self.poolsize = poolsize
         self.ratelimiter = asyncio.Semaphore(poolsize)
-        self.critical_ratelimiter = asyncio.Semaphore(cricital_pool_size)
         self.thread_pool = ThreadPoolExecutor(poolsize, thread_name_prefix="mainpool")
 
         self._storage = self.check_storage()
 
         if environment is None:
             environment = cfg.environment.get()
             if environment is None:
@@ -1066,15 +1054,15 @@
                 init_agentmap_succeeded = True
             except CouldNotConnectToServer:
                 await asyncio.sleep(1)
         await self._init_endpoint_names()
 
     async def start(self) -> None:
         # cache reference to THIS ioloop for handlers to push requests on it
-        self._io_loop = ioloop.IOLoop.current()
+        self._io_loop = asyncio.get_running_loop()
         await super(Agent, self).start()
 
     async def add_end_point_name(self, name: str) -> None:
         async with self._instances_lock:
             await self._add_end_point_name(name)
 
     async def _add_end_point_name(self, name: str) -> None:
@@ -1249,15 +1237,15 @@
         return failed_to_load
 
     async def _install(self, sources: list[ModuleSource], requirements: Sequence[str]) -> None:
         if self._env is None or self._loader is None:
             raise Exception("Unable to load code when agent is started with code loading disabled.")
 
         async with self._loader_lock:
-            loop = asyncio.get_event_loop()
+            loop = asyncio.get_running_loop()
             await loop.run_in_executor(self.thread_pool, self._env.install_from_list, requirements)
             await loop.run_in_executor(self.thread_pool, self._loader.deploy_version, sources)
 
     @protocol.handle(methods.trigger, env="tid", agent="id")
     async def trigger_update(self, env: uuid.UUID, agent: str, incremental_deploy: bool) -> Apireturn:
         """
         Trigger an update
```

### Comparing `inmanta-core-8.3.0/src/inmanta/agent/cache.py` & `inmanta-core-9.3.0/src/inmanta/agent/cache.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/agent/config.py` & `inmanta-core-9.3.0/src/inmanta/agent/config.py`

 * *Files 11% similar despite different names*

```diff
@@ -128,13 +128,24 @@
 
 At startup the agent will choose a random number between 0 and agent-repair-splay-time.
 It will wait this number of second before performing the first repair run.
 Each subsequent repair deployment will start agent-repair-interval seconds after the previous one.""",
     is_time,
 )
 
+agent_get_resource_backoff = Option(
+    "config",
+    "agent-get-resource-backoff",
+    3,
+    "This is a load management feature. It ensures that the agent will not pull resources from the inmanta server"
+    " `<agent-get-resource-backoff>*<duration-last-pull-in-seconds>` seconds after the last time the agent pulled resources"
+    " from the server. Setting this option too low may result in a high load on the Inmanta server. Setting it too high"
+    " may result in long deployment times.",
+    is_float,
+)
+
 
 ##############################
 # agent_rest_transport
 ##############################
 
 agent_transport = TransportConfig("agent")
```

### Comparing `inmanta-core-8.3.0/src/inmanta/agent/handler.py` & `inmanta-core-9.3.0/src/inmanta/agent/handler.py`

 * *Files 3% similar despite different names*

```diff
@@ -11,24 +11,24 @@
     distributed under the License is distributed on an "AS IS" BASIS,
     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     See the License for the specific language governing permissions and
     limitations under the License.
 
     Contact: code@inmanta.com
 """
-
 import base64
 import inspect
 import logging
 import traceback
 import typing
 import uuid
+from abc import ABC, abstractmethod
 from collections import defaultdict
 from concurrent.futures import Future
-from typing import Any, Callable, Dict, List, Optional, Sequence, Tuple, Type, TypeVar, Union, cast, overload
+from typing import Any, Callable, Dict, Generic, List, Optional, Tuple, Type, TypeVar, Union, cast, overload
 
 from tornado import concurrent
 
 import inmanta
 from inmanta import const, data, protocol, resources
 from inmanta.agent import io
 from inmanta.agent.cache import AgentCache
@@ -155,15 +155,55 @@
     if func is None:
         return actual
     else:
         return actual(func)
 
 
 @stable_api
-class HandlerContext(object):
+class LoggerABC(ABC):
+    """
+    Minimal logging interface exposing logging methods for commonly used
+    logging levels.
+
+    Child classes are responsible for implementing a _log_msg method with the
+    concrete logging implementation.
+    """
+
+    def critical(self, msg: str, *args: object, exc_info: bool = False, **kwargs: object) -> None:
+        self._log_msg(logging.CRITICAL, msg, *args, exc_info=exc_info, **kwargs)
+
+    def error(self, msg: str, *args: object, exc_info: bool = False, **kwargs: object) -> None:
+        self._log_msg(logging.ERROR, msg, *args, exc_info=exc_info, **kwargs)
+
+    def warning(self, msg: str, *args: object, exc_info: bool = False, **kwargs: object) -> None:
+        self._log_msg(logging.WARNING, msg, *args, exc_info=exc_info, **kwargs)
+
+    def info(self, msg: str, *args: object, exc_info: bool = False, **kwargs: object) -> None:
+        self._log_msg(logging.INFO, msg, *args, exc_info=exc_info, **kwargs)
+
+    def debug(self, msg: str, *args: object, exc_info: bool = False, **kwargs: object) -> None:
+        self._log_msg(logging.DEBUG, msg, *args, exc_info=exc_info, **kwargs)
+
+    def exception(self, msg: str, *args: object, exc_info: bool = True, **kwargs: object) -> None:
+        self.error(msg, *args, exc_info=exc_info, **kwargs)
+
+    @abstractmethod
+    def _log_msg(
+        self,
+        level: int,
+        msg: str,
+        *args: object,
+        exc_info: bool = False,
+        **kwargs: object,
+    ) -> None:
+        raise NotImplementedError
+
+
+@stable_api
+class HandlerContext(LoggerABC):
     """
     Context passed to handler methods for state related "things"
     """
 
     def __init__(
         self,
         resource: resources.Resource,
@@ -350,24 +390,21 @@
             else:
                 raise InvalidOperation(f"Reported changes for {attribute} not in a type that is recognized.")
 
     @property
     def changes(self) -> Dict[str, AttributeStateChange]:
         return self._changes
 
-    def log_msg(self, level: int, msg: str, args: Sequence[object], kwargs: Dict[str, object]) -> None:
+    def _log_msg(self, level: int, msg: str, *args: object, exc_info: bool = False, **kwargs: object) -> None:
         if len(args) > 0:
             raise Exception("Args not supported")
-        if "exc_info" in kwargs:
-            exc_info = kwargs["exc_info"]
+        if exc_info:
             kwargs["traceback"] = traceback.format_exc()
-        else:
-            exc_info = False
 
-        for k, v in dict(kwargs).items():
+        for k, v in kwargs.items():
             try:
                 json_encode(v)
             except TypeError:
                 if inmanta.RUNNING_TESTS:
                     # Fail the test when the value is not serializable
                     raise Exception(f"Failed to serialize argument for log message {k}={v}")
                 else:
@@ -376,81 +413,14 @@
 
             except Exception as e:
                 raise Exception("Exception during serializing log message arguments") from e
         log = data.LogLine.log(level, msg, **kwargs)
         self.logger.log(level, "resource %s: %s", self._resource.id.resource_version_str(), log._data["msg"], exc_info=exc_info)
         self._logs.append(log)
 
-    def debug(self, msg: str, *args: object, **kwargs: object) -> None:
-        """
-        Log 'msg % args' with severity 'DEBUG'.
-
-        To pass exception information, use the keyword argument exc_info with
-        a true value, e.g.
-
-        Keyword arguments should be JSON serializable.
-
-        ``logger.debug("Houston, we have a %s", "thorny problem", exc_info=1)``
-        """
-        self.log_msg(logging.DEBUG, msg, args, kwargs)
-
-    def info(self, msg: str, *args: object, **kwargs: object) -> None:
-        """
-        Log 'msg % args' with severity 'INFO'.
-
-        To pass exception information, use the keyword argument exc_info with
-        a true value, e.g.
-
-        Keyword arguments should be JSON serializable.
-
-        ``logger.info("Houston, we have a %s", "interesting problem", exc_info=1)``
-        """
-        self.log_msg(logging.INFO, msg, args, kwargs)
-
-    def warning(self, msg: str, *args: object, **kwargs: object) -> None:
-        """
-        Log 'msg % args' with severity 'WARNING'.
-
-        To pass exception information, use the keyword argument exc_info with
-        a true value, e.g.
-
-        Keyword arguments should be JSON serializable.
-
-        ``logger.warning("Houston, we have a %s", "bit of a problem", exc_info=1)``
-        """
-        self.log_msg(logging.WARNING, msg, args, kwargs)
-
-    def error(self, msg: str, *args: object, **kwargs: object) -> None:
-        """
-        Log 'msg % args' with severity 'ERROR'.
-
-        To pass exception information, use the keyword argument exc_info with
-        a true value, e.g.
-
-        ``logger.error("Houston, we have a %s", "major problem", exc_info=1)``
-        """
-        self.log_msg(logging.ERROR, msg, args, kwargs)
-
-    def exception(self, msg: str, *args: object, exc_info: bool = True, **kwargs: object) -> None:
-        """
-        Convenience method for logging an ERROR with exception information.
-        """
-        self.error(msg, *args, exc_info=exc_info, **kwargs)
-
-    def critical(self, msg: str, *args: object, **kwargs: object) -> None:
-        """
-        Log 'msg % args' with severity 'CRITICAL'.
-
-        To pass exception information, use the keyword argument exc_info with
-        a true value, e.g.
-
-        ``logger.critical("Houston, we have a %s", "major disaster", exc_info=1)``
-        """
-        self.log_msg(logging.CRITICAL, msg, args, kwargs)
-
 
 @stable_api
 class ResourceHandler(object):
     """
     A baseclass for classes that handle resources. New handler are registered with the
     :func:`~inmanta.agent.handler.provider` decorator.
 
@@ -492,15 +462,15 @@
                     from tornado.gen import convert_yielded
 
                     result = convert_yielded(result)
                     concurrent.chain_future(result, f)
             except Exception as e:
                 f.set_exception(e)
 
-        self._ioloop.add_callback(run)
+        self._ioloop.call_soon_threadsafe(run)
 
         return f.result()
 
     def set_cache(self, cache: AgentCache) -> None:
         self.cache = cache
 
     def get_client(self) -> protocol.SessionClient:
@@ -957,14 +927,44 @@
                 ctx.exception(
                     "An error occurred after deployment of %(resource_id)s (exception: %(exception)s",
                     resource_id=resource.id,
                     exception=f"{e.__class__.__name__}('{e}')",
                 )
 
 
+TPurgeableResource = TypeVar("TPurgeableResource", bound=resources.PurgeableResource)
+
+
+@stable_api
+class CRUDHandlerGeneric(CRUDHandler, Generic[TPurgeableResource]):
+    """
+    This class offers the same functionality as the CRUDHandler class, but was made generic on the type of PurgeableResource.
+    """
+
+    def read_resource(self, ctx: HandlerContext, resource: TPurgeableResource) -> None:
+        pass
+
+    def create_resource(self, ctx: HandlerContext, resource: TPurgeableResource) -> None:
+        pass
+
+    def delete_resource(self, ctx: HandlerContext, resource: TPurgeableResource) -> None:
+        pass
+
+    def update_resource(self, ctx: HandlerContext, changes: Dict[str, Dict[str, Any]], resource: TPurgeableResource) -> None:
+        pass
+
+    def calculate_diff(
+        self, ctx: HandlerContext, current: TPurgeableResource, desired: TPurgeableResource
+    ) -> typing.Dict[str, typing.Dict[str, typing.Any]]:
+        return super().calculate_diff(ctx, current, desired)
+
+    def execute(self, ctx: HandlerContext, resource: TPurgeableResource, dry_run: bool = False) -> None:
+        super().execute(ctx, resource, dry_run)
+
+
 class Commander(object):
     """
     This class handles commands
     """
 
     __command_functions: Dict[str, Dict[str, Type[ResourceHandler]]] = defaultdict(dict)
 
@@ -1063,7 +1063,33 @@
 
 
 class HandlerNotAvailableException(Exception):
     """
     This exception is thrown when a resource handler cannot perform its job. For example, the admin interface
     it connects to is not available.
     """
+
+
+@stable_api
+class PythonLogger(LoggerABC):
+    """
+    This class implements the LoggerABC interface and is a standalone wrapper around a logging.Logger.
+    """
+
+    def __init__(self, logger: logging.Logger) -> None:
+        self.logger = logger
+
+    def _log_msg(
+        self,
+        level: int,
+        msg: str,
+        *args: object,
+        exc_info: bool = False,
+        **kwargs: object,
+    ) -> None:
+        if len(args) > 0:
+            raise Exception("Args not supported")
+
+        if kwargs:
+            self.logger.log(level, msg, kwargs, exc_info=exc_info)
+        else:
+            self.logger.log(level, msg, exc_info=exc_info)
```

### Comparing `inmanta-core-8.3.0/src/inmanta/agent/io/__init__.py` & `inmanta-core-9.3.0/src/inmanta/agent/io/__init__.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/agent/io/local.py` & `inmanta-core-9.3.0/src/inmanta/agent/io/local.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/agent/io/remote.py` & `inmanta-core-9.3.0/src/inmanta/agent/io/remote.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/agent/reporting.py` & `inmanta-core-9.3.0/src/inmanta/agent/reporting.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/app.py` & `inmanta-core-9.3.0/src/inmanta/app.py`

 * *Files 10% similar despite different names*

```diff
@@ -36,101 +36,57 @@
 import os
 import signal
 import socket
 import sys
 import threading
 import time
 import traceback
-import typing
+from argparse import ArgumentParser
 from asyncio import ensure_future
+from collections import abc
 from configparser import ConfigParser
 from threading import Timer
 from types import FrameType
 from typing import Any, Callable, Coroutine, Dict, Optional
 
-import colorlog
-from colorlog.formatter import LogColors
 from tornado import gen
 from tornado.ioloop import IOLoop
 from tornado.util import TimeoutError
 
 import inmanta.compiler as compiler
-from inmanta import const, module, moduletool, protocol
+from inmanta import const, module, moduletool, protocol, util
 from inmanta.ast import CompilerException, Namespace
 from inmanta.ast import type as inmanta_type
 from inmanta.command import CLIException, Commander, ShowUsageException, command
 from inmanta.compiler import do_compile
 from inmanta.config import Config, Option
 from inmanta.const import EXIT_START_FAILED
 from inmanta.export import cfg_env
+from inmanta.logging import InmantaLoggerConfig, _is_on_tty
 from inmanta.server.bootloader import InmantaBootloader
 from inmanta.util import get_compiler_version
 from inmanta.warnings import WarningsManager
 
 try:
     import rpdb
 except ImportError:
     rpdb = None
 
 LOGGER = logging.getLogger("inmanta")
 
 
-class MultiLineFormatter(colorlog.ColoredFormatter):
-    """Multi-line formatter."""
-
-    def __init__(
-        self,
-        fmt: typing.Optional[str] = None,
-        *,
-        # keep interface minimal: only include fields we actually use
-        log_colors: typing.Optional[LogColors] = None,
-        reset: bool = True,
-        no_color: bool = False,
-    ):
-        super().__init__(fmt, log_colors=log_colors, reset=reset, no_color=no_color)
-        self.fmt = fmt
-
-    def get_header_length(self, record: logging.LogRecord) -> int:
-        """Get the header length of a given record."""
-        # to get the length of the header we want to get the header without the color codes
-        formatter = colorlog.ColoredFormatter(
-            fmt=self.fmt,
-            log_colors=self.log_colors,
-            reset=False,
-            no_color=True,
-        )
-        header = formatter.format(
-            logging.LogRecord(
-                name=record.name,
-                level=record.levelno,
-                pathname=record.pathname,
-                lineno=record.lineno,
-                msg="",
-                args=(),
-                exc_info=None,
-            )
-        )
-        return len(header)
-
-    def format(self, record: logging.LogRecord) -> str:
-        """Format a record with added indentation."""
-        indent: str = " " * self.get_header_length(record)
-        head, *tail = super().format(record).splitlines(True)
-        return head + "".join(indent + line for line in tail)
-
-
 @command("server", help_msg="Start the inmanta server")
 def start_server(options: argparse.Namespace) -> None:
     if options.config_file and not os.path.exists(options.config_file):
         LOGGER.warning("Config file %s doesn't exist", options.config_file)
 
     if options.config_dir and not os.path.isdir(options.config_dir):
         LOGGER.warning("Config directory %s doesn't exist", options.config_dir)
 
-    asyncio.set_event_loop(asyncio.new_event_loop())
+    util.ensure_event_loop()
 
     ibl = InmantaBootloader()
     setup_signal_handlers(ibl.stop)
 
     ioloop = IOLoop.current()
 
     # handle startup exceptions
@@ -154,15 +110,15 @@
         exit(EXIT_START_FAILED)
 
 
 @command("agent", help_msg="Start the inmanta agent")
 def start_agent(options: argparse.Namespace) -> None:
     from inmanta.agent import agent
 
-    asyncio.set_event_loop(asyncio.new_event_loop())
+    util.ensure_event_loop()
 
     a = agent.Agent()
     setup_signal_handlers(a.stop)
     IOLoop.current().add_callback(a.start)
     IOLoop.current().start()
     LOGGER.info("Agent Shutdown complete")
 
@@ -294,26 +250,26 @@
         """
         for metavar, option in self.metavar_to_option.items():
             value = getattr(options, metavar, False)
             if value:
                 option.set("true")
 
 
-def compiler_config(parser: argparse.ArgumentParser) -> None:
+def compiler_config(parser: argparse.ArgumentParser, parent_parsers: abc.Sequence[ArgumentParser]) -> None:
     """
     Configure the compiler of the export function
     """
     parser.add_argument("-e", dest="environment", help="The environment to compile this model for")
     parser.add_argument(
         "-X",
         "--extended-errors",
-        dest="errors_subcommand",
+        dest="errors",
         help="Show stack traces for compile errors",
         action="store_true",
-        default=False,
+        default=argparse.SUPPRESS,
     )
     parser.add_argument("--server_address", dest="server", help="The address of the server hosting the environment")
     parser.add_argument("--server_port", dest="port", help="The port of the server hosting the environment")
     parser.add_argument("--username", dest="user", help="The username of the server")
     parser.add_argument("--password", dest="password", help="The password of the server")
     parser.add_argument("--ssl", help="Enable SSL", action="store_true", default=False)
     parser.add_argument("--ssl-ca-cert", dest="ca_cert", help="Certificate authority for SSL")
@@ -409,26 +365,26 @@
         p.strip_dirs().sort_stats("time").print_stats(20)
     else:
         t1 = time.time()
         do_compile()
         LOGGER.debug("Compile time: %0.03f seconds", time.time() - t1)
 
 
-@command("list-commands", help_msg="Print out an overview of all commands")
+@command("list-commands", help_msg="Print out an overview of all commands", add_verbose_flag=False)
 def list_commands(options: argparse.Namespace) -> None:
     print("The following commands are available:")
     for cmd, info in Commander.commands().items():
         print(" %s: %s" % (cmd, info["help"]))
 
 
-def help_parser_config(parser: argparse.ArgumentParser) -> None:
+def help_parser_config(parser: argparse.ArgumentParser, parent_parsers: abc.Sequence[ArgumentParser]) -> None:
     parser.add_argument("subcommand", help="Output help for a particular subcommand", nargs="?", default=None)
 
 
-@command("help", help_msg="show a help message and exit", parser_config=help_parser_config)
+@command("help", help_msg="show a help message and exit", parser_config=help_parser_config, add_verbose_flag=False)
 def help_command(options: argparse.Namespace) -> None:
     if options.subcommand is None:
         cmd_parser().print_help()
     else:
         subc = options.subcommand
         parser = cmd_parser()
         parser.parse_args([subc, "-h"])
@@ -448,15 +404,15 @@
 
 @command("project", help_msg="Subcommand to manage the project", parser_config=moduletool.ProjectTool.parser_config)
 def project(options: argparse.Namespace) -> None:
     tool = moduletool.ProjectTool()
     tool.execute(options.cmd, options)
 
 
-def deploy_parser_config(parser: argparse.ArgumentParser) -> None:
+def deploy_parser_config(parser: argparse.ArgumentParser, parent_parsers: abc.Sequence[ArgumentParser]) -> None:
     parser.add_argument("--dry-run", help="Only report changes", action="store_true", dest="dryrun")
     parser.add_argument("-f", dest="main_file", help="Main file", default="main.cf")
 
 
 @command("deploy", help_msg="Deploy with a inmanta all-in-one setup", parser_config=deploy_parser_config, require_project=True)
 def deploy(options: argparse.Namespace) -> None:
     module.Project.get(options.main_file)
@@ -467,15 +423,15 @@
         if not run.setup():
             raise Exception("Failed to setup an embedded Inmanta orchestrator.")
         run.run()
     finally:
         run.stop()
 
 
-def export_parser_config(parser: argparse.ArgumentParser) -> None:
+def export_parser_config(parser: argparse.ArgumentParser, parent_parsers: abc.Sequence[ArgumentParser]) -> None:
     """
     Configure the compiler of the export function
     """
     parser.add_argument("-g", dest="depgraph", help="Dump the dependency graph", action="store_true")
     parser.add_argument(
         "-j",
         dest="json",
@@ -496,18 +452,18 @@
     parser.add_argument("--server_port", dest="port", help="The port of the server to submit the model to")
     parser.add_argument("--token", dest="token", help="The token to auth to the server")
     parser.add_argument("--ssl", help="Enable SSL", action=argparse.BooleanOptionalAction, default=None)
     parser.add_argument("--ssl-ca-cert", dest="ca_cert", help="Certificate authority for SSL")
     parser.add_argument(
         "-X",
         "--extended-errors",
-        dest="errors_subcommand",
+        dest="errors",
         help="Show stack traces for compile errors",
         action="store_true",
-        default=False,
+        default=argparse.SUPPRESS,
     )
     parser.add_argument("-f", dest="main_file", help="Main file", default="main.cf")
     parser.add_argument(
         "--metadata",
         dest="metadata",
         help="JSON metadata why this compile happened. If a non-json string is "
         "passed it is used as the 'message' attribute in the metadata.",
@@ -658,33 +614,17 @@
         conn = protocol.SyncClient("compiler")
         LOGGER.info("Triggering deploy for version %d" % version)
         tid = cfg_env.get()
         agent_trigger_method = const.AgentTriggerMethod.get_agent_trigger_method(options.full_deploy)
         conn.release_version(tid, version, True, agent_trigger_method)
 
 
-"""
-This dictionary maps the Inmanta log levels to the corresponding Python log levels
-"""
-log_levels = {
-    "0": logging.ERROR,
-    "1": logging.WARNING,
-    "2": logging.INFO,
-    "3": logging.DEBUG,
-    "4": 2,
-    "ERROR": logging.ERROR,
-    "WARNING": logging.WARNING,
-    "INFO": logging.INFO,
-    "DEBUG": logging.DEBUG,
-    "TRACE": 2,
-}
-
-
 def cmd_parser() -> argparse.ArgumentParser:
     # create the argument compiler
+
     parser = argparse.ArgumentParser()
     parser.add_argument("-p", action="store_true", dest="profile", help="Profile this run of the program")
     parser.add_argument("-c", "--config", dest="config_file", help="Use this config file", default=None)
     parser.add_argument(
         "--config-dir",
         dest="config_dir",
         help="The directory containing the Inmanta configuration files",
@@ -721,136 +661,80 @@
         "--version",
         action="store_true",
         dest="inmanta_version",
         help="Show the version of the installed Inmanta product and the version of its subcomponents",
         default=False,
         required=False,
     )
+
+    verbosity_parser = argparse.ArgumentParser(add_help=False)
+    verbosity_parser.add_argument(
+        "-v",
+        "--verbose",
+        action="count",
+        default=argparse.SUPPRESS,
+        help="Log level for messages going to the console. Default is warnings,"
+        "-v warning, -vv info, -vvv debug and -vvvv trace",
+    )
+
     subparsers = parser.add_subparsers(title="commands")
     for cmd_name, cmd_options in Commander.commands().items():
-        cmd_subparser = subparsers.add_parser(cmd_name, help=cmd_options["help"], aliases=cmd_options["aliases"])
+        parent_parsers: list[argparse.ArgumentParser] = []
+        if cmd_options["add_verbose_flag"]:
+            parent_parsers.append(verbosity_parser)
+        cmd_subparser = subparsers.add_parser(
+            cmd_name, help=cmd_options["help"], aliases=cmd_options["aliases"], parents=parent_parsers
+        )
         if cmd_options["parser_config"] is not None:
-            cmd_options["parser_config"](cmd_subparser)
+            cmd_options["parser_config"](cmd_subparser, parent_parsers)
         cmd_subparser.set_defaults(func=cmd_options["function"])
         cmd_subparser.set_defaults(require_project=cmd_options["require_project"])
 
     return parser
 
 
 def print_versions_installed_components_and_exit() -> None:
-    bootloader = InmantaBootloader()
-    app_context = bootloader.load_slices()
-    product_metadata = app_context.get_product_metadata()
-    extension_statuses = app_context.get_extension_statuses()
-    if product_metadata.version:
-        print(f"{product_metadata.product} ({product_metadata.edition}): {product_metadata.version}")
-    else:
-        print(f"{product_metadata.product} ({product_metadata.edition}): version unknown")
-    print(f"Compiler version: {get_compiler_version()}")
-    if extension_statuses:
-        print("Extensions:")
-        for ext_status in extension_statuses:
-            print(f"    * {ext_status.name}: {ext_status.version}")
-    else:
-        print("Extensions: No extensions found")
-    sys.exit(0)
+    # coroutine to make sure event loop is running for server slices
+    async def print_status() -> None:
+        bootloader = InmantaBootloader()
+        app_context = bootloader.load_slices()
+        product_metadata = app_context.get_product_metadata()
+        extension_statuses = app_context.get_extension_statuses()
 
+        if product_metadata.version:
+            print(f"{product_metadata.product} ({product_metadata.edition}): {product_metadata.version}")
+        else:
+            print(f"{product_metadata.product} ({product_metadata.edition}): version unknown")
+        print(f"Compiler version: {get_compiler_version()}")
+        if extension_statuses:
+            print("Extensions:")
+            for ext_status in extension_statuses:
+                print(f"    * {ext_status.name}: {ext_status.version}")
+        else:
+            print("Extensions: No extensions found")
 
-def _is_on_tty() -> bool:
-    return (hasattr(sys.stdout, "isatty") and sys.stdout.isatty()) or const.ENVIRON_FORCE_TTY in os.environ
-
-
-def _get_default_stream_handler() -> logging.StreamHandler:
-    stream_handler = logging.StreamHandler(stream=sys.stdout)
-    stream_handler.setLevel(logging.INFO)
-
-    formatter = _get_log_formatter_for_stream_handler(timed=False)
-    stream_handler.setFormatter(formatter)
-
-    return stream_handler
-
-
-def _get_watched_file_handler(options: argparse.Namespace) -> logging.handlers.WatchedFileHandler:
-    if not options.log_file:
-        raise Exception("No logfile was provided.")
-    level = _convert_inmanta_log_level_to_python_log_level(options.log_file_level)
-    formatter = logging.Formatter(fmt="%(asctime)s %(levelname)-8s %(name)-10s %(message)s")
-    file_handler = logging.handlers.WatchedFileHandler(filename=options.log_file, mode="a+")
-    file_handler.setFormatter(formatter)
-    file_handler.setLevel(level)
-
-    return file_handler
-
-
-def _convert_inmanta_log_level_to_python_log_level(level: str) -> int:
-    """
-    Converts the Inmanta log level to the Python log level
-    """
-    if level.isdigit() and int(level) > 4:
-        level = "4"
-    return log_levels[level]
-
-
-def _convert_cli_log_level(level: int) -> int:
-    """
-    Converts the number of -v's passed on the CLI to the corresponding Inmanta log level
-    """
-    if level < 1:
-        # The minimal log level on the CLI is always WARNING
-        return logging.WARNING
-    else:
-        return _convert_inmanta_log_level_to_python_log_level(str(level))
-
+        await bootloader.stop()
 
-def _get_log_formatter_for_stream_handler(timed: bool) -> logging.Formatter:
-    log_format = "%(asctime)s " if timed else ""
-    if _is_on_tty():
-        log_format += "%(log_color)s%(name)-25s%(levelname)-8s%(reset)s%(blue)s%(message)s"
-        formatter = MultiLineFormatter(
-            log_format,
-            reset=True,
-            log_colors={"DEBUG": "cyan", "INFO": "green", "WARNING": "yellow", "ERROR": "red", "CRITICAL": "red"},
-        )
-    else:
-        log_format += "%(name)-25s%(levelname)-8s%(message)s"
-        formatter = MultiLineFormatter(
-            log_format,
-            reset=False,
-            no_color=True,
-        )
-    return formatter
+    asyncio.run(print_status())
+    sys.exit(0)
 
 
 def app() -> None:
     """
     Run the compiler
     """
-    # Send logs to stdout
-    stream_handler = _get_default_stream_handler()
-    logging.root.handlers = []
-    logging.root.addHandler(stream_handler)
-    logging.root.setLevel(0)
+    log_config = InmantaLoggerConfig.get_instance()
 
     # do an initial load of known config files to build the libdir path
     Config.load_config()
     parser = cmd_parser()
     options, other = parser.parse_known_args()
     options.other = other
 
-    # Log everything to a log_file if logfile is provided
-    if options.log_file:
-        watched_file_handler = _get_watched_file_handler(options)
-        logging.root.addHandler(watched_file_handler)
-        logging.root.removeHandler(stream_handler)
-    else:
-        if options.timed:
-            formatter = _get_log_formatter_for_stream_handler(timed=True)
-            stream_handler.setFormatter(formatter)
-        log_level = _convert_cli_log_level(options.verbose)
-        stream_handler.setLevel(log_level)
+    log_config.apply_options(options)
 
     logging.captureWarnings(True)
 
     if options.config_file and not os.path.exists(options.config_file):
         LOGGER.warning("Config file %s doesn't exist", options.config_file)
 
     # Load the configuration
@@ -869,17 +753,15 @@
     # start the command
     if not hasattr(options, "func"):
         # show help
         parser.print_usage()
         return
 
     def report(e: BaseException) -> None:
-        minus_x_set_top_level_command = options.errors
-        minus_x_set_subcommand = hasattr(options, "errors_subcommand") and options.errors_subcommand
-        if not minus_x_set_top_level_command and not minus_x_set_subcommand:
+        if not options.errors:
             if isinstance(e, CompilerException):
                 print(e.format_trace(indent="  "), file=sys.stderr)
             else:
                 print(str(e), file=sys.stderr)
         else:
             sys.excepthook(*sys.exc_info())
```

### Comparing `inmanta-core-8.3.0/src/inmanta/ast/__init__.py` & `inmanta-core-9.3.0/src/inmanta/ast/__init__.py`

 * *Files 1% similar despite different names*

```diff
@@ -628,14 +628,19 @@
     def format(self) -> str:
         """Make a string representation of this particular exception"""
         if self.stmt is not None:
             return "%s (reported in %s (%s))" % (self.get_message(), self.stmt, self.get_location())
         return super(RuntimeException, self).format()
 
 
+class InvalidCompilerState(RuntimeException):
+    def __init__(self, stmt: "Optional[Locatable]", msg: str) -> None:
+        super().__init__(stmt, "Invalid compiler state, this likely indicates a bug in the compiler. Details: %s" % msg)
+
+
 class HyphenException(RuntimeException):
     def __init__(self, stmt: LocatableString) -> None:
         msg: str = "The use of '-' in identifiers is not allowed. please rename %s." % stmt.value
         RuntimeException.__init__(self, stmt, msg)
 
 
 class CompilerRuntimeWarning(InmantaWarning, RuntimeException):
```

### Comparing `inmanta-core-8.3.0/src/inmanta/ast/attribute.py` & `inmanta-core-9.3.0/src/inmanta/ast/attribute.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/ast/blocks.py` & `inmanta-core-9.3.0/src/inmanta/ast/blocks.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/ast/constraint/__init__.py` & `inmanta-core-9.3.0/src/inmanta/ast/constraint/__init__.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/ast/constraint/expression.py` & `inmanta-core-9.3.0/src/inmanta/ast/constraint/expression.py`

 * *Files 2% similar despite different names*

```diff
@@ -14,15 +14,15 @@
     limitations under the License.
 
     Contact: code@inmanta.com
 """
 
 import re
 from abc import ABCMeta, abstractmethod
-from collections.abc import Iterator
+from collections import abc
 from itertools import chain
 from typing import Dict, List, Optional, Type
 
 import inmanta.execute.dataflow as dataflow
 from inmanta import stable_api
 from inmanta.ast import LocatableString, RuntimeException, TypingException
 from inmanta.ast.statements import (
@@ -156,15 +156,15 @@
     def get_name(self) -> str:
         return self.__name
 
     def execute(self, requires: Dict[object, object], resolver: Resolver, queue: QueueScheduler) -> object:
         super().execute(requires, resolver, queue)
         return self._op([x.execute(requires, resolver, queue) for x in self._arguments])
 
-    def execute_direct(self, requires: Dict[object, object]) -> object:
+    def execute_direct(self, requires: abc.Mapping[str, object]) -> object:
         return self._op([x.execute_direct(requires) for x in self._arguments])
 
     def get_op(self) -> str:
         attribute = "_%s__op" % type(self).__name__
         if hasattr(self, attribute):
             return getattr(self, attribute)
         return self.get_name()
@@ -238,16 +238,16 @@
         Operator.__init__(self, name, [op1, op2])
 
     def normalize(self, *, lhs_attribute: Optional[AttributeAssignmentLHS] = None) -> None:
         super().normalize()
         # lazy execution: we don't immediately emit the second operator so we need to hold its promises until we do
         self._own_eager_promises = list(self.children[1].get_all_eager_promises())
 
-    def get_all_eager_promises(self) -> Iterator["StaticEagerPromise"]:
-        return chain(super().get_all_eager_promises(), self.children[0].get_all_eager_promises())
+    def get_all_eager_promises(self) -> abc.Iterator["StaticEagerPromise"]:
+        return chain(self._own_eager_promises, self.children[0].get_all_eager_promises())
 
     def requires_emit(self, resolver: Resolver, queue: QueueScheduler) -> Dict[object, VariableABC]:
         requires: Dict[object, VariableABC] = self._requires_emit_promises(resolver, queue)
         # introduce temp variable to contain the eventual result of this stmt
         temp: ResultVariable = ResultVariable()
         temp.set_type(Bool())
 
@@ -277,15 +277,15 @@
         if self._is_final(result):
             target.set_value(result, self.location)
         else:
             ExecutionUnit(
                 queue, resolver, target, self.children[1].requires_emit(resolver, queue), self.children[1], owner=self
             )
 
-    def execute_direct(self, requires: Dict[object, object]) -> object:
+    def execute_direct(self, requires: abc.Mapping[str, object]) -> object:
         lhs = self.children[0].execute_direct(requires)
         self._validate_value(lhs, 0)
         assert isinstance(lhs, bool)
         if self._is_final(lhs):
             return lhs
         else:
             rhs = self.children[1].execute_direct(requires)
```

### Comparing `inmanta-core-8.3.0/src/inmanta/ast/entity.py` & `inmanta-core-9.3.0/src/inmanta/ast/entity.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/ast/export.py` & `inmanta-core-9.3.0/src/inmanta/ast/export.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/ast/statements/__init__.py` & `inmanta-core-9.3.0/src/inmanta/ast/statements/__init__.py`

 * *Files 2% similar despite different names*

```diff
@@ -11,22 +11,24 @@
     distributed under the License is distributed on an "AS IS" BASIS,
     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     See the License for the specific language governing permissions and
     limitations under the License.
 
     Contact: code@inmanta.com
 """
+from collections import abc
 from dataclasses import dataclass
 from itertools import chain
 from typing import TYPE_CHECKING, Dict, Iterator, List, Optional, Sequence, Tuple
 
 import inmanta.execute.dataflow as dataflow
 from inmanta.ast import (
     Anchor,
     DirectExecuteException,
+    Locatable,
     Location,
     Named,
     Namespace,
     Namespaced,
     OptionalValueException,
     RuntimeException,
     WithComment,
@@ -113,39 +115,41 @@
         Should only be called after normalization.
         """
         return iter(self._own_eager_promises)
 
     def normalize(self) -> None:
         raise NotImplementedError()
 
-    def requires(self) -> List[str]:
-        """List of all variable names used by this statement"""
-        raise NotImplementedError()
-
     def emit(self, resolver: Resolver, queue: QueueScheduler) -> None:
         """Emit new instructions to the queue, executing this instruction in the context of the resolver"""
         raise NotImplementedError()
 
-    def execute_direct(self, requires: Dict[object, object]) -> object:
-        raise DirectExecuteException(self, f"The statement {str(self)} can not be executed in this context")
-
     def declared_variables(self) -> Iterator[str]:
         """
         Returns an iterator over this statement's own declared variables.
         """
         return iter(())
 
 
 class RequiresEmitStatement(DynamicStatement):
+    """
+    Statements that execute in two stages based on their requirements. These statements have a well defined set of
+    names/variables they require before they can execute. When these are emitted, they schedule their own execution to continue
+    as soon as the requirements are met.
+    If a RequiresEmitStatement does not appear as a top-level statement in a block but as a child of another statement, instead
+    of being emitted, its requirements may be requested through `requires_emit`. These should then be used to schedule `execute`
+    when the requirements are met.
+    """
+
     __slots__ = ()
 
     def emit(self, resolver: Resolver, queue: QueueScheduler) -> None:
         """
         Emits this statement by scheduling its promises and scheduling a unit to wait on its requirements. Injects the
-        schedulred promise objects in the waiter's requires in order to pass it on to the execute method.
+        scheduled promise objects in the waiter's requires in order to pass it on to the execute method.
         """
         target = ResultVariable()
         reqs = self.requires_emit(resolver, queue)
         ExecutionUnit(queue, resolver, target, reqs, self)
 
     def requires_emit(self, resolver: Resolver, queue: QueueScheduler) -> Dict[object, VariableABC]:
         """
@@ -154,15 +158,15 @@
         Additionally schedules this statement's eager promises and includes them (wrapped in a result variable) in the requires
         dict in order to pass it on to the execution phase.
         When this method is called, the caller must make sure to eventually call `execute` as well.
         """
         return self._requires_emit_promises(resolver, queue)
 
     def requires_emit_gradual(
-        self, resolver: Resolver, queue: QueueScheduler, resultcollector: ResultCollector
+        self, resolver: Resolver, queue: QueueScheduler, resultcollector: ResultCollector[object]
     ) -> Dict[object, VariableABC]:
         """
         Returns a dict of the result variables required for execution. Behaves like requires_emit, but additionally may attach
         resultcollector as a listener to result variables.
         When this method is called, the caller must make sure to eventually call `execute` as well.
         """
         return self.requires_emit(resolver, queue)
@@ -208,14 +212,28 @@
     attribute: str
     type_hint: Optional["Type"] = None
 
 
 class ExpressionStatement(RequiresEmitStatement):
     __slots__ = ()
 
+    def requires(self) -> List[str]:
+        """
+        List of all variable names used by this statement. Artifact from the past, hardly used anymore.
+        """
+        raise NotImplementedError()
+
+    def execute_direct(self, requires: abc.Mapping[str, object]) -> object:
+        """
+        Execute this statement in a static context without any scheduling, returning the expression's result.
+
+        :param requires: A dictionary mapping names to values.
+        """
+        raise DirectExecuteException(self, f"The statement {str(self)} can not be executed in this context")
+
     def normalize(self, *, lhs_attribute: Optional[AttributeAssignmentLHS] = None) -> None:
         """
         :param lhs_attribute: The left hand side attribute if this expression is a right hand side in an attribute assignment.
             If not None, that caller is responsible for making sure the reference resolves to the correct instance as soon as
             this statement enters the `requires_emit` stage. As a result, it should always be None if the instance construction
             depends on this statement.
         """
@@ -230,26 +248,26 @@
     def get_dataflow_node(self, graph: DataflowGraph) -> dataflow.NodeReference:
         """
         Return the node in the data flow graph this ExpressionStatement will evaluate to.
         """
         raise NotImplementedError()
 
 
-class Resumer(ExpressionStatement):
+class Resumer(Locatable):
     """
     Resume on a set of requirement variables' values when they become ready (i.e. they are complete).
     """
 
     __slots__ = ()
 
     def resume(self, requires: Dict[object, object], resolver: Resolver, queue: QueueScheduler, target: ResultVariable) -> None:
         pass
 
 
-class RawResumer(ExpressionStatement):
+class RawResumer(Locatable):
     """
     Resume on a set of requirement variables when they become ready (i.e. they are complete).
     """
 
     __slots__ = ()
 
     def resume(self, requires: Dict[object, VariableABC], resolver: Resolver, queue: QueueScheduler) -> None:
@@ -470,15 +488,15 @@
 class ReferenceStatement(ExpressionStatement):
     """
     This class models statements that refer to other statements
     """
 
     __slots__ = ("children",)
 
-    def __init__(self, children: List[ExpressionStatement]) -> None:
+    def __init__(self, children: Sequence[ExpressionStatement]) -> None:
         ExpressionStatement.__init__(self)
         self.children: Sequence[ExpressionStatement] = children
         self.anchors.extend((anchor for e in self.children for anchor in e.get_anchors()))
 
     def normalize(self, *, lhs_attribute: Optional[AttributeAssignmentLHS] = None) -> None:
         for c in self.children:
             c.normalize()
@@ -551,15 +569,15 @@
     def requires(self) -> List[str]:
         return []
 
     def execute(self, requires: Dict[object, object], resolver: Resolver, queue: QueueScheduler) -> object:
         super().execute(requires, resolver, queue)
         return self.value
 
-    def execute_direct(self, requires: Dict[object, object]) -> object:
+    def execute_direct(self, requires: abc.Mapping[str, object]) -> object:
         return self.value
 
     def as_constant(self) -> object:
         return self.value
 
     def get_dataflow_node(self, graph: DataflowGraph) -> dataflow.ValueNodeReference:
         return dataflow.ValueNode(self.value).reference()
```

### Comparing `inmanta-core-8.3.0/src/inmanta/ast/statements/assign.py` & `inmanta-core-9.3.0/src/inmanta/ast/statements/assign.py`

 * *Files 5% similar despite different names*

```diff
@@ -13,19 +13,19 @@
     See the License for the specific language governing permissions and
     limitations under the License.
 
     Contact: code@inmanta.com
 """
 
 # pylint: disable-msg=W0613
-
 import typing
-from collections.abc import Iterator
+from collections import abc
 from itertools import chain
-from typing import Dict, Optional, TypeVar
+from string import Formatter
+from typing import Dict, Optional, Tuple, TypeVar
 
 import inmanta.execute.dataflow as dataflow
 from inmanta.ast import (
     AttributeException,
     DuplicateException,
     HyphenException,
     KeyException,
@@ -140,15 +140,15 @@
             if isinstance(value, list):
                 qlist.extend(value)
             else:
                 qlist.append(value)
 
         return qlist
 
-    def execute_direct(self, requires: Dict[object, object]) -> object:
+    def execute_direct(self, requires: abc.Mapping[str, object]) -> object:
         qlist = []
 
         for i in range(len(self.items)):
             value = self.items[i]
             qlist.append(value.execute_direct(requires))
 
         return qlist
@@ -174,15 +174,15 @@
         self.items = items
         seen = {}  # type: typing.Dict[str,ReferenceStatement]
         for x, v in items:
             if x in seen:
                 raise DuplicateException(v, seen[x], "duplicate key in dict %s" % x)
             seen[x] = v
 
-    def execute_direct(self, requires: Dict[object, object]) -> object:
+    def execute_direct(self, requires: abc.Mapping[str, object]) -> object:
         qlist = {}
 
         for i in range(len(self.items)):
             key, value = self.items[i]
             qlist[key] = value.execute_direct(requires)
 
         return qlist
@@ -225,15 +225,15 @@
         self.list_only = list_only
         self._assignment_promise: StaticEagerPromise = StaticEagerPromise(self.instance, self.attribute_name, self)
 
     def normalize(self, *, lhs_attribute: Optional[AttributeAssignmentLHS] = None) -> None:
         # register this assignment as left hand side to the value on the right hand side
         self.rhs.normalize(lhs_attribute=AttributeAssignmentLHS(self.instance, self.attribute_name))
 
-    def get_all_eager_promises(self) -> Iterator["StaticEagerPromise"]:
+    def get_all_eager_promises(self) -> abc.Iterator["StaticEagerPromise"]:
         # propagate this attribute assignment's promise to parent blocks
         return chain(super().get_all_eager_promises(), [self._assignment_promise])
 
     def _add_to_dataflow_graph(self, graph: typing.Optional[DataflowGraph]) -> None:
         if graph is None:
             return
         node: dataflow.AttributeNodeReference = self.instance.get_dataflow_node(graph).get_attribute(self.attribute_name)
@@ -367,15 +367,15 @@
     def emit(self, resolver: Resolver, queue: QueueScheduler) -> None:
         self._add_to_dataflow_graph(resolver.dataflow_graph)
         target = resolver.lookup(str(self.name))
         assert isinstance(target, ResultVariable)
         reqs = self.value.requires_emit(resolver, queue)
         ExecutionUnit(queue, resolver, target, reqs, self.value, owner=self)
 
-    def declared_variables(self) -> typing.Iterator[str]:
+    def declared_variables(self) -> abc.Iterator[str]:
         yield str(self.name)
 
     def pretty_print(self) -> str:
         return f"{self.name} = {self.value.pretty_print()}"
 
     def __repr__(self) -> str:
         return "Assign(%s, %s)" % (self.name, self.value)
@@ -551,24 +551,41 @@
         return "%s.%s[%s]" % (
             self.rootobject,
             self.relation,
             ",".join(repr(part) for part in chain([self.querypart], self.wrapped_querypart)),
         )
 
 
-class StringFormat(ReferenceStatement):
+class FormattedString(ReferenceStatement):
     """
-    Create a new string by doing a string interpolation
+    This class is an abstraction around a string containing references to variables.
     """
 
     __slots__ = ("_format_string", "_variables")
 
-    def __init__(self, format_string: str, variables: typing.List[typing.Tuple["Reference", str]]) -> None:
-        ReferenceStatement.__init__(self, [k for (k, _) in variables])
+    def __init__(self, format_string: str, variables: abc.Sequence["Reference"]) -> None:
+        super().__init__(variables)
         self._format_string = format_string
+
+    def get_dataflow_node(self, graph: DataflowGraph) -> dataflow.NodeReference:
+        return dataflow.NodeStub("StringFormat.get_node() placeholder for %s" % self).reference()
+
+    def __repr__(self) -> str:
+        return "Format(%s)" % self._format_string
+
+
+class StringFormat(FormattedString):
+    """
+    Create a new string by doing a string interpolation
+    """
+
+    __slots__ = ()
+
+    def __init__(self, format_string: str, variables: abc.Sequence[Tuple["Reference", str]]) -> None:
+        super().__init__(format_string, [k for (k, _) in variables])
         self._variables = variables
 
     def execute(self, requires: typing.Dict[object, object], resolver: Resolver, queue: QueueScheduler) -> object:
         super().execute(requires, resolver, queue)
         result_string = self._format_string
         for _var, str_id in self._variables:
             value = _var.execute(requires, resolver, queue)
@@ -577,12 +594,51 @@
             if isinstance(value, float) and (value - int(value)) == 0:
                 value = int(value)
 
             result_string = result_string.replace(str_id, str(value))
 
         return result_string
 
-    def get_dataflow_node(self, graph: DataflowGraph) -> dataflow.NodeReference:
-        return dataflow.NodeStub("StringFormat.get_node() placeholder for %s" % self).reference()
 
-    def __repr__(self) -> str:
-        return "Format(%s)" % self._format_string
+class FStringFormatter(Formatter):
+    def __init__(self) -> None:
+        Formatter.__init__(self)
+
+    def get_field(self, key: str, args: abc.Sequence[object], kwds: abc.Mapping[str, object]) -> Tuple[object, str]:
+        """
+        Overrides Formatter.get_field. Composite variable names are expected to be resolved at this point and can be
+        retrieved by their full name.
+        """
+        return (kwds[key], key)
+
+
+class StringFormatV2(FormattedString):
+    """
+    Create a new string by using python build in formatting
+    """
+
+    __slots__ = ()
+
+    def __init__(self, format_string: str, variables: abc.Sequence[typing.Tuple["Reference", str]]) -> None:
+        only_refs: abc.Sequence["Reference"] = [k for (k, _) in variables]
+        super().__init__(format_string, only_refs)
+        self._variables = only_refs
+
+    def execute(self, requires: typing.Dict[object, object], resolver: Resolver, queue: QueueScheduler) -> object:
+        super().execute(requires, resolver, queue)
+        formatter: FStringFormatter = FStringFormatter()
+
+        # We can't cache the formatter because it has no ability to cache the parsed string
+
+        kwargs = {}
+        for _var in self._variables:
+            value = _var.execute(requires, resolver, queue)
+            if isinstance(value, Unknown):
+                return Unknown(self)
+            if isinstance(value, float) and (value - int(value)) == 0:
+                value = int(value)
+
+            kwargs[_var.full_name] = value
+
+        result_string = formatter.vformat(self._format_string, args=[], kwargs=kwargs)
+
+        return result_string
```

### Comparing `inmanta-core-8.3.0/src/inmanta/ast/statements/call.py` & `inmanta-core-9.3.0/src/inmanta/ast/statements/call.py`

 * *Files 1% similar despite different names*

```diff
@@ -13,14 +13,15 @@
     See the License for the specific language governing permissions and
     limitations under the License.
 
     Contact: code@inmanta.com
 """
 
 import logging
+from collections import abc
 from itertools import chain
 from typing import Dict, List, Optional, Tuple
 
 import inmanta.ast.type as InmantaType
 import inmanta.execute.dataflow as dataflow
 from inmanta import plugins
 from inmanta.ast import (
@@ -100,15 +101,15 @@
         requires[self] = temp
         return requires
 
     def execute(self, requires, resolver, queue):
         super().execute(requires, resolver, queue)
         return requires[self]
 
-    def execute_direct(self, requires):
+    def execute_direct(self, requires: abc.Mapping[str, object]) -> object:
         arguments = [a.execute_direct(requires) for a in self.arguments]
         kwargs = {k: v.execute_direct(requires) for k, v in self.kwargs.items()}
         for wrapped_kwarg_expr in self.wrapped_kwargs:
             for k, v in wrapped_kwarg_expr.execute_direct(requires):
                 if k in kwargs:
                     raise RuntimeException(self, "Keyword argument %s repeated in function call" % k)
                 kwargs[k] = v
```

### Comparing `inmanta-core-8.3.0/src/inmanta/ast/statements/define.py` & `inmanta-core-9.3.0/src/inmanta/ast/statements/define.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/ast/statements/generator.py` & `inmanta-core-9.3.0/src/inmanta/ast/statements/generator.py`

 * *Files 19% similar despite different names*

```diff
@@ -14,27 +14,29 @@
     limitations under the License.
 
     Contact: code@inmanta.com
 """
 
 # pylint: disable-msg=W0613,R0201
 
+import itertools
 import logging
 import uuid
 from collections import abc
 from itertools import chain
-from typing import Dict, Iterator, List, Optional, Tuple
+from typing import Dict, Iterator, List, Optional, Tuple, Union
 
 import inmanta.ast.entity
 import inmanta.ast.type as inmanta_type
 import inmanta.execute.dataflow as dataflow
 from inmanta.ast import (
     AmbiguousTypeException,
     AttributeReferenceAnchor,
     DuplicateException,
+    InvalidCompilerState,
     Locatable,
     LocatableString,
     Location,
     Namespace,
     NotFoundException,
     Range,
     RuntimeException,
@@ -43,25 +45,28 @@
     TypingException,
 )
 from inmanta.ast.attribute import Attribute, RelationAttribute
 from inmanta.ast.blocks import BasicBlock
 from inmanta.ast.statements import (
     AttributeAssignmentLHS,
     ExpressionStatement,
+    Literal,
     RawResumer,
     RequiresEmitStatement,
     StaticEagerPromise,
 )
 from inmanta.ast.statements.assign import GradualSetAttributeHelper, SetAttributeHelper
 from inmanta.ast.variables import Reference
 from inmanta.const import LOG_LEVEL_TRACE
 from inmanta.execute.dataflow import DataflowGraph
 from inmanta.execute.runtime import (
     ExecutionContext,
+    ExecutionUnit,
     Instance,
+    ListElementVariable,
     QueueScheduler,
     RawUnit,
     Resolver,
     ResultCollector,
     ResultVariable,
     VariableABC,
     VariableResolver,
@@ -110,16 +115,16 @@
         #     # the boundary we translate references so that they are resolved correctly in any context wrapping the constructor
         #     dataclasses.replace(promise, instance=promise.instance.fully_qualified())
         #     for implementation in self.implements.implementations
         #     for promise in implementation.statements.get_eager_promises()
         #     if promise.get_root_variable() not in injected_variables
         # ]
 
-    def requires_emit(self, resolver: Resolver, queue: QueueScheduler) -> Dict[object, VariableABC]:
-        requires: Dict[object, VariableABC] = super().requires_emit(resolver, queue)
+    def requires_emit(self, resolver: Resolver, queue: QueueScheduler) -> Dict[object, VariableABC[object]]:
+        requires: Dict[object, VariableABC[object]] = super().requires_emit(resolver, queue)
         try:
             resv = resolver.for_namespace(self.implements.constraint.namespace)
             requires.update(self.implements.constraint.requires_emit(resv, queue))
             return requires
         except NotFoundException as e:
             e.set_statement(self.implements)
             raise e
@@ -177,15 +182,15 @@
 
     def __init__(self, stmt: "For", resolver: Resolver, queue: QueueScheduler) -> None:
         self.resolver = resolver
         self.queue = queue
         self.stmt = stmt
         self.seen: set[int] = set()
 
-    def receive_result(self, value: object, location: ResultVariable) -> bool:
+    def receive_result(self, value: object, location: Location) -> bool:
         if id(value) in self.seen:
             return False
         self.seen.add(id(value))
 
         xc = ExecutionContext(self.stmt.module, self.resolver.for_namespace(self.stmt.module.namespace))
         loopvar = xc.lookup(self.stmt.loop_var)
         # this assertion is because the typing of this method is not correct
@@ -221,23 +226,16 @@
         self.module.normalize()
         self.module.add_var(self.loop_var, self)
         self._own_eager_promises = self.module.get_eager_promises()
 
     def get_all_eager_promises(self) -> Iterator["StaticEagerPromise"]:
         return chain(super().get_all_eager_promises(), self.base.get_all_eager_promises())
 
-    def requires(self) -> List[str]:
-        base = self.base.requires()
-        var = self.loop_var
-        ext = self.module.requires
-        return list(set(base).union(ext) - set(var))
-
-    def requires_emit(self, resolver: Resolver, queue: QueueScheduler) -> Dict[object, VariableABC]:
-        """Not an actual expression, but following the pattern"""
-        requires: Dict[object, VariableABC] = super().requires_emit(resolver, queue)
+    def requires_emit(self, resolver: Resolver, queue: QueueScheduler) -> dict[object, VariableABC[object]]:
+        requires: Dict[object, VariableABC[object]] = super().requires_emit(resolver, queue)
 
         # pass context via requires!
         helper = GradualFor(self, resolver, queue)
         requires[self] = WrappedValueVariable(helper)
 
         requires.update(self.base.requires_emit_gradual(resolver, queue, helper))
 
@@ -253,26 +251,332 @@
         if isinstance(var, Unknown):
             return None
 
         if not isinstance(var, list):
             raise TypingException(self, "A for loop can only be applied to lists and relations")
 
         helper = requires[self]
+        assert isinstance(helper, GradualFor)
 
         for loop_var in var:
             # generate a subscope/namespace for each loop
             helper.receive_result(loop_var, self.location)
 
         return None
 
     def nested_blocks(self) -> Iterator["BasicBlock"]:
         yield self.module
 
 
-class If(ExpressionStatement):
+class ListComprehension(RawResumer, ExpressionStatement):
+    """
+    A list comprehension expression, e.g. `["hello {{world}}" for world in worlds if world != "exclude"]`.
+    """
+
+    __slots__ = ("loop_var", "value_expression", "iterable", "guard")
+
+    def __init__(
+        self,
+        value_expression: ExpressionStatement,
+        loop_var: LocatableString,
+        iterable: ExpressionStatement,
+        guard: Optional[ExpressionStatement] = None,
+    ) -> None:
+        super().__init__()
+        self.value_expression: ExpressionStatement = value_expression
+        self.loop_var: LocatableString = loop_var
+        self.iterable: ExpressionStatement = iterable
+        self.guard: Optional[ExpressionStatement] = guard
+        self.anchors.extend(
+            itertools.chain(
+                self.value_expression.get_anchors(),
+                self.iterable.get_anchors(),
+                (self.guard.get_anchors() if self.guard is not None else ()),
+            )
+        )
+
+    def normalize(self, *, lhs_attribute: Optional[AttributeAssignmentLHS] = None) -> None:
+        self.value_expression.normalize(lhs_attribute=lhs_attribute)
+        self.iterable.normalize()
+        if self.guard is not None:
+            self.guard.normalize()
+
+    def requires(self) -> list[str]:
+        # exclude loop var, unless it shadows an occurrence in iterable
+        return list(set(self.value_expression.requires()) - {str(self.loop_var)} | set(self.iterable.requires()))
+
+    def requires_emit(
+        self, resolver: Resolver, queue: QueueScheduler, *, lhs: Optional[ResultCollector[object]] = None
+    ) -> dict[object, VariableABC[object]]:
+        """
+        Sets up gradual or non-gradual execution (depending on the lhs) of the list comprehension. Additionally sets up a
+        resumer for when the iterable is complete. Returns as requires the (gradual) helper's result variable, which will be
+        frozen by the resumer.
+
+        Flow:
+            `requires_emit()` -> set up helper, schedule resume and execute
+            -> helper gradual execution (if lhs is not None)
+            -> wait for iterable completion -> `resume()` -> finalize helper input
+            -> wait for helper completion -> `execute()` -> return complete value
+        """
+        base_requires: dict[object, VariableABC[object]] = super().requires_emit(resolver, queue)
+
+        # set up gradual execution
+        collector_helper: ListComprehensionCollector = ListComprehensionCollector(
+            statement=self,
+            resolver=resolver,
+            queue=queue,
+            lhs=lhs,
+        )
+        self.copy_location(collector_helper)
+        iterable_requires: dict[object, VariableABC[object]] = (
+            # use helper strictly non-gradually when in a non-gradual context
+            # => propagates progress potential to iterable expression's requires
+            self.iterable.requires_emit(resolver, queue)
+            if lhs is None
+            else self.iterable.requires_emit_gradual(resolver, queue, collector_helper)
+        )
+
+        # non-gradual mode / finishing up: resume as soon as the iterable can be executed
+        # pass helper to the resumer via the requires object
+        wrapped_helper: VariableABC[ListComprehensionCollector] = WrappedValueVariable(collector_helper)
+        requires: dict[object, VariableABC[object]] = base_requires | iterable_requires | {self: wrapped_helper}
+        RawUnit(queue, resolver, requires, resumer=self)
+
+        # Wait for resumer and helper to populate result.
+        # No need to wait for iterable requires explicitly because resumer already does
+        return base_requires | {self: collector_helper.final_result}
+
+    def requires_emit_gradual(
+        self, resolver: Resolver, queue: QueueScheduler, resultcollector: ResultCollector[object]
+    ) -> dict[object, VariableABC[object]]:
+        return self.requires_emit(resolver, queue, lhs=resultcollector)
+
+    def resume(self, requires: dict[object, VariableABC[object]], resolver: Resolver, queue: QueueScheduler) -> None:
+        """
+        Resume when the iterable is fully ready for execution. Populates the helper's result variable and signals that no more
+        values will be sent.
+        """
+        # fetch helper, passed via the requires object
+        collector_helper: object = requires[self].get_value()
+        assert isinstance(collector_helper, ListComprehensionCollector)
+
+        # execute iterable so we have all values
+        iterable: object = self.iterable.execute({k: v.get_value() for k, v in requires.items()}, resolver, queue)
+
+        # indicate to helper that we're done
+        if isinstance(iterable, Unknown):
+            collector_helper.set_unknown()
+        elif not isinstance(iterable, list):
+            raise TypingException(
+                self, f"A list comprehension can only be applied to lists and relations, got {type(iterable).__name__}"
+            )
+        else:
+            collector_helper.complete(iterable, resolver, queue)
+
+    def execute(self, requires: dict[object, object], resolver: Resolver, queue: QueueScheduler) -> object:
+        super().execute(requires, resolver, queue)
+        # at this point the resumer signalled the helper we were done and the helper waited for all value expressions
+        # => just fetch the result
+        return requires[self]
+
+    def execute_direct(self, requires: abc.Mapping[str, object]) -> Union[list[object], Unknown]:
+        iterable: object = self.iterable.execute_direct(requires)
+        if isinstance(iterable, Unknown):
+            return Unknown(self)
+        elif not isinstance(iterable, list):
+            raise TypingException(
+                self,
+                f"A list comprehension in a direct execute context can only be applied to lists, got {type(iterable).__name__}",
+            )
+
+        def process(element: object) -> Optional[object]:
+            """
+            Execute the list comprehension for a single element of the iterable. Evaluates the guard expression if there is
+            any and executes the value expression if the guard passes. Returns the result of the value expression if the
+            guard passed, otherwise returns None.
+            """
+            extended_requires: abc.Mapping[str, object] = requires | {str(self.loop_var): element}
+
+            guard_passed: bool
+            if self.guard is None:
+                guard_passed = True
+            else:
+                guard_value: object = self.guard.execute_direct(extended_requires)
+                if isinstance(iterable, Unknown):
+                    return Unknown(self)
+                if not isinstance(guard_value, bool):
+                    raise TypingException(
+                        self,
+                        (
+                            f"Invalid value `{guard_value}`:"
+                            " the guard condition for a list comprehension must be a boolean expression"
+                        ),
+                    )
+                guard_passed = guard_value
+
+            return self.value_expression.execute_direct(extended_requires) if guard_passed else None
+
+        return [result for element in iterable if (result := process(element)) is not None]
+
+    def pretty_print(self) -> str:
+        return "[%s for %s in %s%s]" % (
+            self.value_expression.pretty_print(),
+            self.loop_var,
+            self.iterable.pretty_print(),
+            f" if {self.guard.pretty_print()}" if self.guard is not None else "",
+        )
+
+    def __str__(self) -> str:
+        return self.pretty_print()
+
+    def __repr__(self) -> str:
+        return "ListComprehension(value_expression=%s, loop_var=%s, iterable=%s, guard=%s)" % (
+            repr(self.value_expression),
+            repr(self.loop_var),
+            repr(self.iterable),
+            repr(self.guard),
+        )
+
+
+LIST_COMPREHENSION_GUARDED = object()
+"""
+Artificial value used in the else branch of the list comprehension guard's conditional expression. Indicates that the value
+expression for an element should not be executed because the element was filtered by the guard.
+"""
+
+
+class ListComprehensionCollector(RawResumer, ResultCollector[object]):
+    """
+    Result collector (gradual or otherwise) for the list comprehension statement. When it receives a
+    result, it sets up appropriate (gradual or otherwise) execution for the value expression, with the lhs as final result
+    collector. Finally, it collects all final results in its own result variable for non-gradual execution.
+
+    This class has a gradual mode and a non-gradual mode depending on whether `lhs` is set. In non-gradual mode (lhs is None)
+    it must not receive any gradual results. This allows the class to maintain ordering in non-gradual mode (if elements are
+    received gradually each they arrive as soon as they can be resolved).
+
+    Expects to receive each result once, either gradually or at execution-time. Clients should indicate completion by calling
+    `complete()` or `set_unknown()`, after which no more values may be provided. This instance's `final_result` attribute
+    will contain the final result. It will be only be set after the client declares completion, but not necessarily immediately
+    after (we may have to wait for value expressions' requires).
+    """
+
+    __slots__ = ("statement", "resolver", "queue", "lhs", "_results", "_complete", "final_result")
+
+    def __init__(
+        self,
+        statement: ListComprehension,
+        resolver: Resolver,
+        queue: QueueScheduler,
+        lhs: Optional[ResultCollector[object]] = None,
+    ) -> None:
+        self.statement: ListComprehension = statement
+        self.resolver: Resolver = resolver
+        self.queue: QueueScheduler = queue
+        self.lhs: Optional[ResultCollector[object]] = lhs
+        # separately collect results for the value expression for each element of the iterable so we can wait for
+        # each element's value expression to complete.
+        self._results: list[VariableABC[object]] = []
+        # have we received all elements?
+        self._complete: bool = False
+        # collector for the final result
+        self.final_result: ResultVariable[object] = ResultVariable()
+
+    def receive_result(self, value: object, location: Location) -> bool:
+        """
+        Receive an single element from the iterable and schedule execution of the associated value expression.
+        """
+        if self._complete:
+            raise InvalidCompilerState(self, "list comprehension helper received gradual result after it was declared complete")
+
+        # Use special result variable for a pre-known value with listener capabilities. Using a plain `ResultVariable` would
+        # break gradual execution (e.g. `Reference.requires_emit_gradual` registers self.lhs as listener)
+        value_wrapper: ListElementVariable[object] = ListElementVariable(value, location)
+        value_resolver: VariableResolver = VariableResolver(
+            parent=self.resolver,
+            name=str(self.statement.loop_var),
+            variable=value_wrapper,
+        )
+
+        result_variable: ResultVariable[object] = ResultVariable()
+        self._results.append(result_variable)
+
+        # execute the value expression and the guard
+        guarded_expression: ExpressionStatement
+        if self.statement.guard is None:
+            guarded_expression = self.statement.value_expression
+        else:
+            else_expression: ExpressionStatement = Literal(LIST_COMPREHENSION_GUARDED)
+            guarded_expression = ConditionalExpression(
+                condition=self.statement.guard,
+                if_expression=self.statement.value_expression,
+                else_expression=Literal(LIST_COMPREHENSION_GUARDED),
+            )
+            self.statement.copy_location(else_expression)
+            self.statement.copy_location(guarded_expression)
+
+        requires: dict[object, VariableABC[object]] = (
+            guarded_expression.requires_emit(value_resolver, self.queue)
+            if self.lhs is None
+            else guarded_expression.requires_emit_gradual(value_resolver, self.queue, self.lhs)
+        )
+        ExecutionUnit(
+            self.queue,
+            value_resolver,
+            result_variable,
+            requires,
+            guarded_expression,
+        )
+
+        return False
+
+    def set_unknown(self) -> None:
+        """
+        Set the final result to be an unknown. No elements should be gradually received in this case.
+        Mutually exclusive with `complete`.
+        """
+        if self._results:
+            raise InvalidCompilerState(
+                self, "list comprehension helper got set_unknown after some (known) elements where received"
+            )
+        self.final_result.set_value(Unknown(self.statement), self.statement.location)
+
+    def complete(self, all_values: abc.Sequence[object], resolver: Resolver, queue: QueueScheduler) -> None:
+        """
+        Indicate that all results have been received. No further calls to `receive_result` should be done after this.
+        Mutually exclusive with `set_unknown`.
+        """
+        if self._results:
+            # We should only have received previous results in gradual mode, if the
+            if self.lhs is None:
+                raise InvalidCompilerState(self, "list comprehension helper received gradual results in non-gradual mode")
+            if len(self._results) != len(all_values):
+                raise InvalidCompilerState(self, "list comprehension helper received some but not all values gradually")
+        else:
+            for value in all_values:
+                self.receive_result(value, location=self.statement.location)
+
+        RawUnit(queue, resolver, dict(enumerate(self._results)), resumer=self)
+
+    def resume(self, requires: dict[object, VariableABC[object]], resolver: Resolver, queue: QueueScheduler) -> None:
+        def get(variable: VariableABC[object]) -> Optional[abc.Sequence[object]]:
+            value: object = variable.get_value()
+            return None if value is LIST_COMPREHENSION_GUARDED else value if isinstance(value, list) else [value]
+
+        # collect all element value expressions' results and write them to the final result variable
+        self.final_result.set_value(
+            list(
+                itertools.chain.from_iterable(value for variable in requires.values() if (value := get(variable)) is not None)
+            ),
+            self.statement.location,
+        )
+
+
+class If(RequiresEmitStatement):
     """
     An if Statement
     """
 
     __slots__ = ("condition", "if_branch", "else_branch")
 
     def __init__(self, condition: ExpressionStatement, if_branch: BasicBlock, else_branch: BasicBlock) -> None:
@@ -283,25 +587,25 @@
         self.anchors.extend(condition.get_anchors())
         self.anchors.extend(if_branch.get_anchors())
         self.anchors.extend(else_branch.get_anchors())
 
     def __repr__(self) -> str:
         return "If"
 
-    def normalize(self, *, lhs_attribute: Optional[AttributeAssignmentLHS] = None) -> None:
+    def normalize(self) -> None:
         self.condition.normalize()
         self.if_branch.normalize()
         self.else_branch.normalize()
         self._own_eager_promises = [*self.if_branch.get_eager_promises(), *self.else_branch.get_eager_promises()]
 
     def get_all_eager_promises(self) -> Iterator["StaticEagerPromise"]:
         return chain(super().get_all_eager_promises(), self.condition.get_all_eager_promises())
 
-    def requires_emit(self, resolver: Resolver, queue: QueueScheduler) -> Dict[object, VariableABC]:
-        requires: Dict[object, VariableABC] = super().requires_emit(resolver, queue)
+    def requires_emit(self, resolver: Resolver, queue: QueueScheduler) -> Dict[object, VariableABC[object]]:
+        requires: Dict[object, VariableABC[object]] = super().requires_emit(resolver, queue)
         requires.update(self.condition.requires_emit(resolver, queue))
         return requires
 
     def execute(self, requires: Dict[object, object], resolver: Resolver, queue: QueueScheduler) -> object:
         """
         Evaluate this statement.
         """
@@ -356,34 +660,41 @@
 
     def get_all_eager_promises(self) -> Iterator["StaticEagerPromise"]:
         return chain(super().get_all_eager_promises(), self.condition.get_all_eager_promises())
 
     def requires(self) -> List[str]:
         return list(chain.from_iterable(sub.requires() for sub in [self.condition, self.if_expression, self.else_expression]))
 
-    def requires_emit(self, resolver: Resolver, queue: QueueScheduler) -> Dict[object, VariableABC]:
-        requires: Dict[object, VariableABC] = super().requires_emit(resolver, queue)
+    def requires_emit(
+        self, resolver: Resolver, queue: QueueScheduler, *, lhs: Optional[ResultCollector[object]] = None
+    ) -> dict[object, VariableABC[object]]:
+        requires: Dict[object, VariableABC[object]] = super().requires_emit(resolver, queue)
 
         # This ResultVariable will receive the result of this expression
-        result: ResultVariable = ResultVariable()
+        result: ResultVariable[object] = ResultVariable()
 
         # Schedule execution to resume when the condition can be executed
-        resumer: RawResumer = ConditionalExpressionResumer(self, result)
+        resumer: RawResumer = ConditionalExpressionResumer(self, result, lhs=lhs)
         self.copy_location(resumer)
         RawUnit(queue, resolver, self.condition.requires_emit(resolver, queue), resumer)
 
         # Wait for the result variable to be populated
         requires[self] = result
         return requires
 
+    def requires_emit_gradual(
+        self, resolver: Resolver, queue: QueueScheduler, resultcollector: ResultCollector[object]
+    ) -> dict[object, VariableABC[object]]:
+        return self.requires_emit(resolver, queue, lhs=resultcollector)
+
     def execute(self, requires: Dict[object, object], resolver: Resolver, queue: QueueScheduler) -> object:
         super().execute(requires, resolver, queue)
         return requires[self]
 
-    def execute_direct(self, requires: Dict[object, object]) -> object:
+    def execute_direct(self, requires: abc.Mapping[str, object]) -> object:
         condition_value: object = self.condition.execute_direct(requires)
         if isinstance(condition_value, Unknown):
             return Unknown(self)
         if not isinstance(condition_value, bool):
             raise RuntimeException(
                 self, "Invalid value `%s`: the condition for a conditional expression must be a boolean expression"
             )
@@ -397,23 +708,26 @@
         )
 
     def __repr__(self) -> str:
         return "%s ? %s : %s" % (self.condition, self.if_expression, self.else_expression)
 
 
 class ConditionalExpressionResumer(RawResumer):
-    __slots__ = ("expression", "condition_value", "result")
+    __slots__ = ("expression", "condition_value", "result", "lhs")
 
-    def __init__(self, expression: ConditionalExpression, result: ResultVariable) -> None:
+    def __init__(
+        self, expression: ConditionalExpression, result: ResultVariable, *, lhs: Optional[ResultCollector[object]] = None
+    ) -> None:
         super().__init__()
         self.expression: ConditionalExpression = expression
         self.condition_value: Optional[bool] = None
         self.result: ResultVariable = result
+        self.lhs: Optional[ResultCollector[object]] = lhs
 
-    def resume(self, requires: Dict[object, VariableABC], resolver: Resolver, queue: QueueScheduler) -> None:
+    def resume(self, requires: Dict[object, VariableABC[object]], resolver: Resolver, queue: QueueScheduler) -> None:
         if self.condition_value is None:
             condition_value: object = self.expression.condition.execute(
                 {k: v.get_value() for k, v in requires.items()}, resolver, queue
             )
             if isinstance(condition_value, Unknown):
                 self.result.set_value(Unknown(self), self.location)
                 return
@@ -423,18 +737,23 @@
                 )
             self.condition_value = condition_value
 
             # Schedule execution of appropriate subexpression
             subexpression: ExpressionStatement = (
                 self.expression.if_expression if self.condition_value else self.expression.else_expression
             )
+            subexpression_requires: dict[object, VariableABC[object]] = (
+                subexpression.requires_emit(resolver, queue)
+                if self.lhs is None
+                else subexpression.requires_emit_gradual(resolver, queue, self.lhs)
+            )
             RawUnit(
                 queue,
                 resolver,
-                subexpression.requires_emit(resolver, queue),
+                subexpression_requires,
                 self,
             )
         else:
             value: object = (
                 self.expression.if_expression if self.condition_value else self.expression.else_expression
             ).execute({k: v.get_value() for k, v in requires.items()}, resolver, queue)
             self.result.set_value(value, self.location)
@@ -652,16 +971,16 @@
 
     def requires(self) -> List[str]:
         out = [req for (k, v) in self.__attributes.items() for req in v.requires()]
         out.extend(req for kwargs in self.__wrapped_kwarg_attributes for req in kwargs.requires())
         out.extend(req for (k, v) in self.get_default_values().items() for req in v.requires())
         return out
 
-    def requires_emit(self, resolver: Resolver, queue: QueueScheduler) -> Dict[object, VariableABC]:
-        requires: Dict[object, VariableABC] = super().requires_emit(resolver, queue)
+    def requires_emit(self, resolver: Resolver, queue: QueueScheduler) -> Dict[object, VariableABC[object]]:
+        requires: Dict[object, VariableABC[object]] = super().requires_emit(resolver, queue)
         # direct
         direct = [x for x in self._direct_attributes.items()]
 
         direct_requires = {rk: rv for (k, v) in direct for (rk, rv) in v.requires_emit(resolver, queue).items()}
         direct_requires.update(
             {rk: rv for kwargs in self.__wrapped_kwarg_attributes for (rk, rv) in kwargs.requires_emit(resolver, queue).items()}
         )
@@ -916,16 +1235,16 @@
 
     def get_all_eager_promises(self) -> Iterator["StaticEagerPromise"]:
         return chain(super().get_all_eager_promises(), self.dictionary.get_all_eager_promises())
 
     def requires(self) -> List[str]:
         return self.dictionary.requires()
 
-    def requires_emit(self, resolver: Resolver, queue: QueueScheduler) -> Dict[object, VariableABC]:
-        requires: Dict[object, VariableABC] = super().requires_emit(resolver, queue)
+    def requires_emit(self, resolver: Resolver, queue: QueueScheduler) -> Dict[object, VariableABC[object]]:
+        requires: Dict[object, VariableABC[object]] = super().requires_emit(resolver, queue)
         requires.update(self.dictionary.requires_emit(resolver, queue))
         return requires
 
     def execute(self, requires: Dict[object, object], resolver: Resolver, queue: QueueScheduler) -> List[Tuple[str, object]]:
         super().execute(requires, resolver, queue)
         dct: object = self.dictionary.execute(requires, resolver, queue)
         if not isinstance(dct, Dict):
```

### Comparing `inmanta-core-8.3.0/src/inmanta/ast/type.py` & `inmanta-core-9.3.0/src/inmanta/ast/type.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/ast/variables.py` & `inmanta-core-9.3.0/src/inmanta/ast/variables.py`

 * *Files 0% similar despite different names*

```diff
@@ -98,15 +98,15 @@
         requires[self.name] = var
         return requires
 
     def execute(self, requires: Dict[object, object], resolver: Resolver, queue: QueueScheduler) -> object:
         super().execute(requires, resolver, queue)
         return requires[self.name]
 
-    def execute_direct(self, requires: Dict[object, object]) -> object:
+    def execute_direct(self, requires: abc.Mapping[str, object]) -> object:
         if self.name not in requires:
             raise NotFoundException(self, "Could not resolve the value %s in this static context" % self.name)
         return requires[self.name]
 
     def get_root_variable(self) -> "Reference":
         """
         Returns the root reference node. e.g. for a.b.c.d, returns the reference for a.
```

### Comparing `inmanta-core-8.3.0/src/inmanta/command.py` & `inmanta-core-9.3.0/src/inmanta/command.py`

 * *Files 20% similar despite different names*

```diff
@@ -14,18 +14,19 @@
     limitations under the License.
 
     Contact: code@inmanta.com
 """
 
 
 import argparse
+from collections import abc
 from typing import Callable, Dict, List, Optional
 
 FunctionType = Callable[[argparse.Namespace], None]
-ParserConfigType = Callable[[argparse.ArgumentParser], None]
+ParserConfigType = Callable[[argparse.ArgumentParser, abc.Sequence[argparse.ArgumentParser]], None]
 
 
 class CLIException(Exception):
     def __init__(self, *args: str, exitcode: int) -> None:
         self.exitcode = exitcode
         super(CLIException, self).__init__(*args)
 
@@ -48,27 +49,29 @@
         cls,
         name: str,
         function: FunctionType,
         help_msg: str,
         parser_config: Optional[ParserConfigType],
         require_project: bool = False,
         aliases: List[str] = [],
+        add_verbose_flag: bool = True,
     ) -> None:
         """
         Add a new export function
         """
         if name in cls.__command_functions:
             raise Exception("Command %s already registered" % name)
 
         cls.__command_functions[name] = {
             "function": function,
             "help": help_msg,
             "parser_config": parser_config,
             "require_project": require_project,
             "aliases": aliases,
+            "add_verbose_flag": add_verbose_flag,
         }
 
     config = None
 
     @classmethod
     def reset(cls) -> None:
         """
@@ -83,29 +86,35 @@
         """
         return cls.__command_functions
 
 
 class command(object):  # noqa: N801
     """
     A decorator that registers an export function
+
+    :param add_verbose_flag: Set this to false to prevent automatically adding the verbose option to the registered command.
     """
 
     def __init__(
         self,
         name: str,
         help_msg: str,
         parser_config: Optional[ParserConfigType] = None,
         require_project: bool = False,
         aliases: List[str] = [],
+        add_verbose_flag: bool = True,
     ) -> None:
         self.name = name
         self.help = help_msg
         self.require_project = require_project
         self.parser_config = parser_config
         self.aliases = aliases
+        self.add_verbose_flag = add_verbose_flag
 
     def __call__(self, function: FunctionType) -> FunctionType:
         """
         The wrapping
         """
-        Commander.add(self.name, function, self.help, self.parser_config, self.require_project, self.aliases)
+        Commander.add(
+            self.name, function, self.help, self.parser_config, self.require_project, self.aliases, self.add_verbose_flag
+        )
         return function
```

### Comparing `inmanta-core-8.3.0/src/inmanta/compiler/__init__.py` & `inmanta-core-9.3.0/src/inmanta/compiler/__init__.py`

 * *Files 4% similar despite different names*

```diff
@@ -192,16 +192,23 @@
         self.__root_ns = project.get_root_namespace()
 
         project.load()
         statements, blocks = project.get_complete_ast()
 
         project.log_installed_modules()
 
+        # This lookup variable provides efficiency in the loop below by skipping iterations for plugins
+        # that are part of modules that are not imported in the model.
+        non_imported_modules: set[str] = set()
+
         # load plugins
         for name, cls in PluginMeta.get_functions().items():
+            if cls.__module__ in non_imported_modules:
+                continue
+
             mod_ns = cls.__module__.split(".")
             if mod_ns[0] != const.PLUGINS_PACKAGE:
                 raise Exception(
                     "All plugin modules should be loaded in the %s package not in %s" % (const.PLUGINS_PACKAGE, cls.__module__)
                 )
 
             mod_ns = mod_ns[1:]
@@ -209,19 +216,21 @@
             ns: Optional[Namespace] = self.__root_ns
             for part in mod_ns:
                 if ns is None:
                     break
                 ns = ns.get_child(part)
 
             if ns is None:
-                raise Exception("Unable to find namespace for plugin module %s" % (cls.__module__))
-
-            name = name.split("::")[-1]
-            statement = PluginStatement(ns, name, cls)
-            statements.append(statement)
+                # This plugin is part of a module that is not imported in the model. We mark this module as such
+                # so that future iterations on other plugins from this module can be skipped.
+                non_imported_modules.add(cls.__module__)
+            else:
+                name = name.split("::")[-1]
+                statement = PluginStatement(ns, name, cls)
+                statements.append(statement)
 
         # add the entity type (hack?)
         ns = self.__root_ns.get_child_or_create("std")
         nullrange = Range("internal", 1, 0, 0, 0)
         entity = DefineEntity(
             ns,
             LocatableString("Entity", nullrange, 0, ns),
```

### Comparing `inmanta-core-8.3.0/src/inmanta/compiler/config.py` & `inmanta-core-9.3.0/src/inmanta/compiler/config.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/compiler/data.py` & `inmanta-core-9.3.0/src/inmanta/compiler/data.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/compiler/help/__init__.py` & `inmanta-core-9.3.0/src/inmanta/compiler/help/__init__.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/compiler/help/explainer.py` & `inmanta-core-9.3.0/src/inmanta/compiler/help/explainer.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/compiler/help/templates/modified_after_freeze.j2` & `inmanta-core-9.3.0/src/inmanta/compiler/help/templates/modified_after_freeze.j2`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/compiler/help/templates/module_v2_in_v1_path.j2` & `inmanta-core-9.3.0/src/inmanta/compiler/help/templates/module_v2_in_v1_path.j2`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/config.py` & `inmanta-core-9.3.0/src/inmanta/config.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/const.py` & `inmanta-core-9.3.0/src/inmanta/const.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/data/__init__.py` & `inmanta-core-9.3.0/src/inmanta/data/__init__.py`

 * *Files 2% similar despite different names*

```diff
@@ -78,15 +78,14 @@
 from inmanta.types import JsonType, PrimitiveTypes
 
 LOGGER = logging.getLogger(__name__)
 
 DBLIMIT = 100000
 APILIMIT = 1000
 
-
 # TODO: disconnect
 # TODO: difference between None and not set
 
 # Used as the 'default' parameter value for the Field class, when no default value has been set
 default_unset = object()
 
 PRIMITIVE_SQL_TYPES = Union[str, int, bool, datetime.datetime, UUID]
@@ -901,14 +900,25 @@
 
     @property
     def id_column(self) -> Tuple[ColumnNameStr, ColumnType]:
         """Name and type of the id column of this database order"""
         return (ColumnNameStr("id"), UUIDColumn)
 
 
+class DiscoveredResourceOrder(SingleDatabaseOrder):
+    """Represents the ordering by which discovered resources should be sorted"""
+
+    @classmethod
+    def get_valid_sort_columns(cls) -> Dict[ColumnNameStr, ColumnType]:
+        """Describes the names and types of the columns that are valid for this DatabaseOrder"""
+        return {
+            ColumnNameStr("discovered_resource_id"): StringColumn,
+        }
+
+
 class BaseQueryBuilder(ABC):
     """Provides a way to build up a sql query from its parts.
     Each method returns a new query builder instance, with the additional parameters processed"""
 
     def __init__(
         self,
         select_clause: Optional[str] = None,
@@ -1549,22 +1559,28 @@
 
     async def insert(self, connection: Optional[asyncpg.connection.Connection] = None) -> None:
         """
         Insert a new document based on the instance passed. Validation is done based on the defined fields.
         """
         (column_names, values) = self._get_column_names_and_values()
         column_names_as_sql_string = ",".join(column_names)
-        values_as_parameterize_sql_string = ",".join(["$" + str(i) for i in range(1, len(values) + 1)])
+        values_as_parameterized_sql_string = ",".join(["$" + str(i) for i in range(1, len(values) + 1)])
         query = (
             f"INSERT INTO {self.table_name()} "
             f"({column_names_as_sql_string}) "
-            f"VALUES ({values_as_parameterize_sql_string})"
+            f"VALUES ({values_as_parameterized_sql_string})"
         )
         await self._execute_query(query, *values, connection=connection)
 
+    async def insert_with_overwrite(self, connection: Optional[asyncpg.connection.Connection] = None) -> None:
+        """
+        Insert a new document based on the instance passed. If the document already exists, overwrite it.
+        """
+        return await self.insert_many_with_overwrite([self], connection=connection)
+
     @classmethod
     async def _fetchval(cls, query: str, *values: object, connection: Optional[asyncpg.connection.Connection] = None) -> object:
         async with cls.get_connection(connection) as con:
             return await con.fetchval(query, *values)
 
     @classmethod
     async def _fetch_int(cls, query: str, *values: object, connection: Optional[asyncpg.connection.Connection] = None) -> int:
@@ -1620,14 +1636,51 @@
             for col in columns:
                 current_record.append(cls._get_value(doc.__getattribute__(col)))
             records.append(tuple(current_record))
 
         async with cls.get_connection(connection) as con:
             await con.copy_records_to_table(table_name=cls.table_name(), columns=columns, records=records, schema_name="public")
 
+    @classmethod
+    async def insert_many_with_overwrite(
+        cls, documents: Sequence["BaseDocument"], *, connection: Optional[asyncpg.connection.Connection] = None
+    ) -> None:
+        """
+        Insert new documents. If the document already exists, overwrite it.
+        """
+        if not documents:
+            return
+        column_names = cls.get_field_names()
+        primary_key_fields = cls._get_names_of_primary_key_fields()
+        primary_key_string = ",".join(primary_key_fields)
+        update_set = set(column_names) - set(cls._get_names_of_primary_key_fields())
+        update_set_string = ",\n".join([f"{item} = EXCLUDED.{item}" for item in update_set])
+
+        values: List[List[object]] = [document._get_column_names_and_values()[1] for document in documents]
+
+        column_names_as_sql_string = ", ".join(column_names)
+
+        number_of_columns = len(values[0])
+        placeholders = ", ".join(
+            [
+                "(" + ", ".join([f"${doc * number_of_columns + col}" for col in range(1, number_of_columns + 1)]) + ")"
+                for doc in range(len(values))
+            ]
+        )
+
+        query = f"""INSERT INTO {cls.table_name()}
+                    ({column_names_as_sql_string})
+                    VALUES {placeholders}
+                    ON CONFLICT ({primary_key_string})
+                    DO UPDATE SET
+                    {update_set_string};"""
+
+        flattened_values = [item for sublist in values for item in sublist]
+        await cls._execute_query(query, *flattened_values)
+
     def add_default_values_when_undefined(self, **kwargs: object) -> Dict[str, object]:
         result = dict(kwargs)
         for name, field in self._fields.items():
             if name not in kwargs:
                 default_value = field.default_value
                 result[name] = default_value
         return result
@@ -1637,18 +1690,18 @@
         Update this document in the database. It will update the fields in this object and send a full update to database.
         Use update_fields to only update specific fields.
         """
         kwargs = self._convert_field_names_to_db_column_names(kwargs)
         for name, value in kwargs.items():
             setattr(self, name, value)
         (column_names, values) = self._get_column_names_and_values()
-        values_as_parameterize_sql_string = ",".join([column_names[i - 1] + "=$" + str(i) for i in range(1, len(values) + 1)])
+        values_as_parameterized_sql_string = ",".join([column_names[i - 1] + "=$" + str(i) for i in range(1, len(values) + 1)])
         (filter_statement, values_for_filter) = self._get_filter_on_primary_key_fields(offset=len(column_names) + 1)
         values = values + values_for_filter
-        query = "UPDATE " + self.table_name() + " SET " + values_as_parameterize_sql_string + " WHERE " + filter_statement
+        query = "UPDATE " + self.table_name() + " SET " + values_as_parameterized_sql_string + " WHERE " + filter_statement
         await self._execute_query(query, *values, connection=connection)
 
     def _get_set_statement(self, **kwargs: object) -> Tuple[str, List[object]]:
         counter = 1
         parts_of_set_statement = []
         values = []
         for name, value in kwargs.items():
@@ -2330,15 +2383,14 @@
 AUTOSTART_ON_START = "autostart_on_start"
 AUTOSTART_AGENT_MAP = "autostart_agent_map"
 AUTOSTART_AGENT_INTERVAL = "autostart_agent_interval"
 AGENT_AUTH = "agent_auth"
 SERVER_COMPILE = "server_compile"
 AUTO_FULL_COMPILE = "auto_full_compile"
 RESOURCE_ACTION_LOGS_RETENTION = "resource_action_logs_retention"
-PURGE_ON_DELETE = "purge_on_delete"
 PROTECTED_ENVIRONMENT = "protected_environment"
 NOTIFICATION_RETENTION = "notification_retention"
 AVAILABLE_VERSIONS_TO_KEEP = "available_versions_to_keep"
 RECOMPILE_BACKOFF = "recompile_backoff"
 ENVIRONMENT_METRICS_RETENTION = "environment_metrics_retention"
 
 
@@ -2370,22 +2422,30 @@
         :param recompile: Trigger a recompile of the model when a setting is updated?
         :param update_model: Update the configuration model (git pull on project and repos)
         :param agent_restart: Restart autostarted agents when this settings is updated.
         :param allowed_values: list of possible values (if type is enum)
         """
         self.name: str = name
         self.typ: str = typ
-        self.default = default
+        self._default = default
         self.doc = doc
         self.validator = validator
         self.recompile = recompile
         self.update = update_model
         self.agent_restart = agent_restart
         self.allowed_values = allowed_values
 
+    @property
+    def default(self) -> Optional[m.EnvSettingType]:
+        if self._default and isinstance(self._default, dict):
+            # Dicts are mutable objects. Return a copy.
+            return dict(self._default)
+        else:
+            return self._default
+
     def to_dict(self) -> JsonType:
         return {
             "type": self.typ,
             "default": self.default,
             "doc": self.doc,
             "recompile": self.recompile,
             "update": self.update,
@@ -2412,15 +2472,21 @@
     A deployment environment of a project
 
     :param id: A unique, machine generated id
     :param name: The name of the deployment environment.
     :param project: The project this environment belongs to.
     :param repo_url: The repository url that contains the configuration model code for this environment
     :param repo_branch: The repository branch that contains the configuration model code for this environment
-    :param settings: Key/value settings for this environment
+    :param settings: Key/value settings for this environment. This dictionary does not necessarily contain a key
+                     for every environment setting known by the server. This is done for backwards compatibility reasons.
+                     When a setting was renamed, we need to determine whether the old or the new setting has to be taken into
+                     account. The logic to decide that is the following:
+                        * When the name of the new setting is present in this settings dictionary or when the name of the old
+                          setting is not present in the settings dictionary, use the new setting.
+                        * Otherwise, use the setting with the old name.
     :param last_version: The last version number that was reserved for this environment
     :param description: The description of the environment
     :param icon: An icon for the environment
     """
 
     __primary_key__ = ("id",)
 
@@ -2578,28 +2644,20 @@
         AVAILABLE_VERSIONS_TO_KEEP: Setting(
             name=AVAILABLE_VERSIONS_TO_KEEP,
             default=100,
             typ="int",
             validator=convert_int,
             doc="The number of versions to keep stored in the database",
         ),
-        PURGE_ON_DELETE: Setting(
-            name=PURGE_ON_DELETE,
-            default=False,
-            typ="bool",
-            validator=convert_boolean,
-            doc="Enable purge on delete. When set to true, the server will detect the absence of resources with purge_on_delete"
-            " set to true and automatically purges them.",
-        ),
         PROTECTED_ENVIRONMENT: Setting(
             name=PROTECTED_ENVIRONMENT,
             default=False,
             typ="bool",
             validator=convert_boolean,
-            doc="When set to true, this environment cannot be cleared, deleted or decommissioned.",
+            doc="When set to true, this environment cannot be cleared or deleted.",
         ),
         NOTIFICATION_RETENTION: Setting(
             name=NOTIFICATION_RETENTION,
             default=365,
             typ="int",
             validator=convert_int,
             doc="The number of days to retain notifications for",
@@ -2653,48 +2711,62 @@
                     category=DeprecationWarning,
                 )
                 return self.settings[name_deprecated_setting]
 
         if key in self.settings:
             return self.settings[key]
 
-        if self._settings[key].default is None:
+        default_value = self._settings[key].default
+        if default_value is None:
             raise KeyError()
 
-        value = self._settings[key].default
-        await self.set(key, value, connection=connection)
-        return value
+        await self.set(key, default_value, connection=connection, allow_override=False)
+        return self.settings[key]
 
-    async def set(self, key: str, value: m.EnvSettingType, connection: Optional[asyncpg.connection.Connection] = None) -> None:
+    async def set(
+        self,
+        key: str,
+        value: m.EnvSettingType,
+        connection: Optional[asyncpg.connection.Connection] = None,
+        allow_override: bool = True,
+    ) -> None:
         """
         Set a new setting in this environment.
 
         :param key: The name/key of the setting. It should be defined in _settings otherwise a keyerror will be raised.
         :param value: The value of the settings. The value should be of type as defined in _settings
+        :param allow_override: If set to False, don't set the given environment setting when it already exists in the setting
+                               dictionary in the database.
         """
         if key not in self._settings:
             raise KeyError()
         # TODO: convert this to a string
         if callable(self._settings[key].validator):
             value = self._settings[key].validator(value)
 
         type = translate_to_postgres_type(self._settings[key].typ)
-        (filter_statement, values) = self._get_composed_filter(name=self.name, project=self.project, offset=3)
-        query = (
-            "UPDATE "
-            + self.table_name()
-            + " SET settings=jsonb_set(settings, $1::text[], to_jsonb($2::"
-            + type
-            + "), TRUE)"
-            + " WHERE "
-            + filter_statement
+        (filter_statement, values) = self._get_composed_filter(name=self.name, project=self.project, offset=5)
+        query = f"""
+                UPDATE {self.table_name()}
+                SET settings=(
+                        CASE WHEN $1 IS FALSE AND settings ? $2::text
+                        THEN settings
+                        ELSE jsonb_set(settings, $3::text[], to_jsonb($4::{type}), TRUE)
+                        END
+                    )
+                WHERE {filter_statement}
+                RETURNING settings
+        """
+        values = [allow_override, self._get_value(key), self._get_value([key]), self._get_value(value)] + values
+
+        new_value = await self._fetchval(query, *values, connection=connection)
+        new_value_parsed = cast(
+            Dict[str, m.EnvSettingType], self.get_field_metadata()["settings"].from_db(name="settings", value=new_value)
         )
-        values = [self._get_value([key]), self._get_value(value)] + values
-        await self._execute_query(query, *values, connection=connection)
-        self.settings[key] = value
+        self.settings[key] = new_value_parsed[key]
 
     async def unset(self, key: str) -> None:
         """
         Unset a setting in this environment. If a default value is provided, this value will replace the current value.
 
         :param key: The name/key of the setting. It should be defined in _settings otherwise a keyerror will be raised.
         """
@@ -2872,16 +2944,27 @@
     environment: uuid.UUID
     source: str
     resource_id: m.ResourceIdStr = ""
     updated: Optional[datetime.datetime] = None
     metadata: Optional[JsonType] = None
 
     @classmethod
-    async def get_updated_before(cls, updated_before: datetime.datetime) -> List["Parameter"]:
-        query = "SELECT * FROM " + cls.table_name() + " WHERE updated < $1"
+    async def get_updated_before_active_env(cls, updated_before: datetime.datetime) -> List["Parameter"]:
+        """
+        Retrieve the list of parameters that were updated before a specified datetime for environments that are not halted
+        """
+        query = f"""
+         WITH non_halted_envs AS (
+          SELECT id FROM public.environment WHERE NOT halted
+        )
+        SELECT * FROM {cls.table_name()}
+        WHERE environment IN (
+          SELECT id FROM non_halted_envs
+        ) and updated < $1;
+        """
         values = [cls._get_value(updated_before)]
         result = await cls.select_query(query, values)
         return result
 
     @classmethod
     async def list_parameters(cls, env_id: uuid.UUID, **metadata_constraints: str) -> List["Parameter"]:
         query = "SELECT * FROM " + cls.table_name() + " WHERE environment=$1"
@@ -3072,33 +3155,38 @@
                 WHERE expired IS NULL
         """
         await cls._execute_query(query, cls._get_value(now), connection=connection)
 
     @classmethod
     async def cleanup(cls, nr_expired_records_to_keep: int) -> None:
         query = f"""
-            DELETE FROM {cls.table_name()} as a1
+            WITH halted_env AS (
+                SELECT id FROM environment WHERE halted = true
+            )
+            DELETE FROM {cls.table_name()} AS a1
             WHERE a1.expired IS NOT NULL AND
+                  a1.environment NOT IN (SELECT id FROM halted_env) AND
                   (
                     -- Take nr_expired_records_to_keep into account
                     SELECT count(*)
                     FROM {cls.table_name()} a2
                     WHERE a1.environment=a2.environment AND
                           a1.hostname=a2.hostname AND
                           a2.expired IS NOT NULL AND
                           a2.expired > a1.expired
                   ) >= $1
                   AND
                   -- Agent process only has expired agent instances
                   NOT EXISTS(
                     SELECT 1
-                    FROM {cls.table_name()} as agentprocess INNER JOIN {AgentInstance.table_name()} as agentinstance
-                         ON agentinstance.process = agentprocess.sid
-                    WHERE agentprocess.sid = a1.sid and agentinstance.expired IS NULL
-                  )
+                    FROM {cls.table_name()} AS agentprocess
+                    INNER JOIN {AgentInstance.table_name()} AS agentinstance
+                    ON agentinstance.process = agentprocess.sid
+                    WHERE agentprocess.sid = a1.sid AND agentinstance.expired IS NULL
+                  );
         """
         await cls._execute_query(query, cls._get_value(nr_expired_records_to_keep))
 
     def to_dict(self) -> JsonType:
         result = super(AgentProcess, self).to_dict()
         # Ensure backward compatibility API
         result["id"] = result["sid"]
@@ -3419,14 +3507,19 @@
 AND id_primary IS NULL
 -- not used by any version
 AND NOT EXISTS (
     SELECT 1
     FROM public.resource AS re
     WHERE a.environment=re.environment
     AND a.name=re.agent
+)
+AND a.environment IN (
+    SELECT id
+    FROM public.environment
+    WHERE NOT halted
 );
 """
         await cls._execute_query(query, connection=connection)
 
 
 @stable_api
 class Report(BaseDocument):
@@ -3603,32 +3696,46 @@
             f"SELECT * FROM {cls.table_name()} WHERE environment=$1 AND NOT handled and completed IS NULL "
             "ORDER BY requested ASC",
             [cls._get_value(environment_id)],
         )
         return results
 
     @classmethod
-    async def get_next_compiles_count(cls) -> int:
-        """Get the number of compiles in the queue for ALL environments"""
-        result = await cls._fetch_int(f"SELECT count(*) FROM {cls.table_name()} WHERE NOT handled AND completed IS NULL")
-        return result
+    async def get_total_length_of_all_compile_queues(cls, exclude_started_compiles: bool = True) -> int:
+        """
+        Return the total length of all the compile queues on the Inmanta server.
+
+        :param exclude_started_compiles: True iff don't count compiles that started running, but are not finished yet.
+        """
+        query = f"SELECT count(*) FROM {cls.table_name()} WHERE completed IS NULL"
+        if exclude_started_compiles:
+            query += " AND started IS NULL"
+        return await cls._fetch_int(query)
 
     @classmethod
     async def get_by_remote_id(cls, environment_id: uuid.UUID, remote_id: uuid.UUID) -> "Sequence[Compile]":
         results = await cls.select_query(
             f"SELECT * FROM {cls.table_name()} WHERE environment=$1 AND remote_id=$2",
             [cls._get_value(environment_id), cls._get_value(remote_id)],
         )
         return results
 
     @classmethod
     async def delete_older_than(
         cls, oldest_retained_date: datetime.datetime, connection: Optional[asyncpg.Connection] = None
     ) -> None:
-        query = "DELETE FROM " + cls.table_name() + " WHERE completed <= $1::timestamp with time zone"
+        query = f"""
+        WITH non_halted_envs AS (
+          SELECT id FROM public.environment WHERE NOT halted
+        )
+        DELETE FROM {cls.table_name()}
+        WHERE environment IN (
+          SELECT id FROM non_halted_envs
+        ) AND completed <= $1::timestamp with time zone;
+        """
         await cls._execute_query(query, oldest_retained_date, connection=connection)
 
     @classmethod
     async def get_compile_details(cls, environment: uuid.UUID, id: uuid.UUID) -> Optional[m.CompileDetails]:
         """Find all of the details of a compile, with reports from a substituted compile, if there was one"""
 
         # Recursively join the requested compile with the substituted compiles (if there was one), and the corresponding reports
@@ -4010,21 +4117,28 @@
             "resource_version_ids" not in self._updates
         ), "Updating the associated resource_version_ids of a ResourceAction is not currently supported"
         await self.update_fields(connection=connection, **self._updates)
         self._updates = {}
 
     @classmethod
     async def purge_logs(cls) -> None:
-        environments = await Environment.get_list()
-        for env in environments:
-            time_to_retain_logs = await env.get(RESOURCE_ACTION_LOGS_RETENTION)
-            keep_logs_until = datetime.datetime.now().astimezone() - datetime.timedelta(days=time_to_retain_logs)
-            query = "DELETE FROM " + cls.table_name() + " WHERE started < $1"
-            value = cls._get_value(keep_logs_until)
-            await cls._execute_query(query, value)
+        default_retention_time = Environment._settings[RESOURCE_ACTION_LOGS_RETENTION].default
+
+        query = f"""
+            WITH non_halted_envs AS (
+                SELECT id, (COALESCE((settings->>'resource_action_logs_retention')::int, $1)) AS retention_days
+                FROM {Environment.table_name()}
+                WHERE NOT halted
+            )
+            DELETE FROM {cls.table_name()}
+            USING non_halted_envs
+            WHERE environment = non_halted_envs.id
+                AND started < now() AT TIME ZONE 'UTC' - make_interval(days => non_halted_envs.retention_days)
+        """
+        await cls._execute_query(query, default_retention_time)
 
     @classmethod
     async def query_resource_actions(
         cls,
         environment: uuid.UUID,
         resource_type: Optional[str] = None,
         agent: Optional[str] = None,
@@ -4195,15 +4309,15 @@
             arg = ArgumentCollector(offset=2)
 
             # First make the filter
             filter = f"AND ra.started<{arg(current_deploy_start)}"
             if last_deploy_start:
                 filter += f" AND ra.started > {arg(last_deploy_start)}"
             if exclude_change:
-                filter += f"AND ra.change <> {arg(exclude_change.value)}"
+                filter += f" AND ra.change <> {arg(exclude_change.value)}"
 
             # then the query around it
             get_all_query = f"""
     SELECT jt.resource_id, ra.*
         FROM public.resourceaction_resource as jt
         INNER JOIN public.resourceaction as ra
             ON ra.action_id = jt.resource_action_id
@@ -4306,16 +4420,15 @@
         if "requires" in record["attributes"]:
             record["attributes"]["requires"] = [
                 resources.Id.set_version_in_id(id, version) for id in record["attributes"]["requires"]
             ]
         # Due to a bug, the version field has always been present in the attributes dictionary.
         # This bug has been fixed in the database. For backwards compatibility reason we here make sure that the
         # version field is present in the attributes dictionary served out via the API.
-        if "version" not in record["attributes"]:
-            record["attributes"]["version"] = version
+        record["attributes"]["version"] = version
         record["provides"] = [resources.Id.set_version_in_id(id, version) for id in record["provides"]]
 
     @classmethod
     async def get_last_non_deploying_state_for_dependencies(
         cls, environment: uuid.UUID, resource_version_id: "resources.Id", connection: Optional[Connection] = None
     ) -> Dict[m.ResourceVersionIdStr, ResourceState]:
         """
@@ -4446,14 +4559,39 @@
                     # The constraints on the attributes field are checked in memory.
                     # This prevents injection attacks.
                     if util.is_sub_dict(attributes, resource.attributes):
                         result.append(resource)
         return result
 
     @classmethod
+    async def get_resource_type_count_for_latest_version(cls, environment: uuid.UUID) -> dict[str, int]:
+        """
+        Returns the count for each resource_type over all resources in the model's latest version
+        """
+        query_latest_model = f"""
+            SELECT max(version)
+            FROM {ConfigurationModel.table_name()}
+            WHERE environment=$1
+        """
+        query = f"""
+            SELECT resource_type, count(*) as count
+            FROM {Resource.table_name()}
+            WHERE environment=$1 AND model=({query_latest_model})
+            GROUP BY resource_type;
+        """
+        values = [cls._get_value(environment)]
+        result: dict[str, int] = {}
+        async with cls.get_connection() as con:
+            async with con.transaction():
+                async for record in con.cursor(query, *values):
+                    assert isinstance(record["count"], int)
+                    result[str(record["resource_type"])] = record["count"]
+        return result
+
+    @classmethod
     async def get_resources_report(cls, environment: uuid.UUID) -> List[JsonType]:
         """
         This method generates a report of all resources in the given environment,
         with their latest version and when they are last deployed.
         """
         query_resource_ids = f"""
                 SELECT DISTINCT resource_id
@@ -4620,110 +4758,14 @@
             status=new_resource_state,
             last_non_deploying_status=const.NonDeployingResourceState[new_resource_state.name],
             resource_set=self.resource_set,
             provides=self.provides,
         )
 
     @classmethod
-    async def get_deleted_resources(
-        cls,
-        environment: uuid.UUID,
-        current_version: int,
-        current_resources: Sequence[m.ResourceIdStr],
-        *,
-        connection: Optional[asyncpg.connection.Connection] = None,
-    ) -> List["Resource"]:
-        """
-        This method returns all resources that have been deleted from the model and are not yet marked as purged. It returns
-        the latest version of the resource from a released model.
-
-        :param environment:
-        :param current_version:
-        :param current_resources: A Sequence of all resource ids in the current version.
-        """
-        LOGGER.debug("Starting purge_on_delete queries")
-
-        # get all models that have been released
-        query = (
-            "SELECT version FROM "
-            + ConfigurationModel.table_name()
-            + " WHERE environment=$1 AND released=TRUE ORDER BY version DESC LIMIT "
-            + str(DBLIMIT)
-        )
-        versions = set()
-        latest_version = None
-        async with cls.get_connection(connection) as con:
-            async with con.transaction():
-                async for record in con.cursor(query, cls._get_value(environment)):
-                    version = record["version"]
-                    versions.add(version)
-                    if latest_version is None:
-                        latest_version = version
-
-        LOGGER.debug("  All released versions: %s", versions)
-        LOGGER.debug("  Latest released version: %s", latest_version)
-
-        # find all resources in previous versions that have "purge_on_delete" set
-        (filter_statement, values) = cls._get_composed_filter(environment=environment, model=latest_version)
-        query = (
-            "SELECT DISTINCT resource_id FROM "
-            + cls.table_name()
-            + " WHERE "
-            + filter_statement
-            + " AND attributes @> $"
-            + str(len(values) + 1)
-        )
-        values.append(cls._get_value({"purge_on_delete": True}))
-        resources_records = await cls._fetch_query(query, *values, connection=connection)
-        resources = [r["resource_id"] for r in resources_records]
-
-        LOGGER.debug("  Resource with purge_on_delete true: %s", resources)
-
-        # all resources on current model
-        LOGGER.debug("  All resource in current version (%s): %s", current_version, current_resources)
-
-        # determined deleted resources
-
-        deleted = set(resources) - set(current_resources)
-        LOGGER.debug("  These resources are no longer present in current model: %s", deleted)
-
-        # filter out resources that should not be purged:
-        # 1- resources from versions that have not been deployed
-        # 2- resources that are already recorded as purged (purged and deployed)
-        should_purge = []
-        for deleted_resource in deleted:
-            # get the full resource history, and determine the purge status of this resource
-            (filter_statement, values) = cls._get_composed_filter(environment=environment, resource_id=deleted_resource)
-            query = (
-                "SELECT *"
-                + " FROM "
-                + cls.table_name()
-                + " WHERE "
-                + filter_statement
-                + " AND model < $"
-                + str(len(values) + 1)
-                + " ORDER BY model DESC"
-            )
-            values.append(cls._get_value(current_version))
-
-            async with cls.get_connection(connection) as con:
-                async with con.transaction():
-                    async for obj in con.cursor(query, *values):
-                        # if a resource is part of a released version and it is deployed (this last condition is actually enough
-                        # at the moment), we have found the last status of the resource. If it was not purged in that version,
-                        # add it to the should purge list.
-                        if obj["model"] in versions and obj["status"] == const.ResourceState.deployed.name:
-                            attributes = json.loads(str(obj["attributes"]))
-                            if not attributes["purged"]:
-                                should_purge.append(cls(from_postgres=True, **obj))
-                            break
-
-        return should_purge
-
-    @classmethod
     async def get_resource_details(cls, env: uuid.UUID, resource_id: m.ResourceIdStr) -> Optional[m.ReleasedResourceDetails]:
         status_subquery = """
         (CASE WHEN
             (SELECT resource.model < MAX(configurationmodel.version)
             FROM configurationmodel
             WHERE configurationmodel.released=TRUE
             AND environment = $1)
@@ -4836,15 +4878,15 @@
         environment: uuid.UUID,
         source_version: int,
         destination_version: int,
         updated_resource_sets: abc.Set[str],
         deleted_resource_sets: abc.Set[str],
         *,
         connection: Optional[asyncpg.connection.Connection] = None,
-    ) -> abc.Set[m.ResourceIdStr]:
+    ) -> dict[m.ResourceIdStr, str]:
         """
         Copy the resources that belong to an unchanged resource set of a partial compile,
         from source_version to destination_version. This method doesn't copy shared resources.
         """
         query = f"""
             INSERT INTO {cls.table_name()}(
                 environment,
@@ -4875,25 +4917,25 @@
                     r.attributes AS attributes,
                     r.attribute_hash,
                     r.resource_set,
                     r.provides
                 FROM {cls.table_name()} AS r
                 WHERE r.environment=$1 AND r.model=$2 AND r.resource_set IS NOT NULL AND NOT r.resource_set=ANY($4)
             )
-            RETURNING resource_id
+            RETURNING resource_id, resource_set
         """
         async with cls.get_connection(connection) as con:
             result = await con.fetch(
                 query,
                 environment,
                 source_version,
                 destination_version,
                 updated_resource_sets | deleted_resource_sets,
             )
-            return {record["resource_id"] for record in result}
+            return {str(record["resource_id"]): str(record["resource_set"]) for record in result}
 
     @classmethod
     async def get_resources_in_resource_sets(
         cls,
         environment: uuid.UUID,
         version: int,
         resource_sets: abc.Set[str],
@@ -4959,16 +5001,15 @@
         if "requires" in self.attributes:
             version = self.model
             attributes["requires"] = [resources.Id.set_version_in_id(id, version) for id in self.attributes["requires"]]
 
         # Due to a bug, the version field has always been present in the attributes dictionary.
         # This bug has been fixed in the database. For backwards compatibility reason we here make sure that the
         # version field is present in the attributes dictionary served out via the API.
-        if "version" not in self.attributes:
-            attributes["version"] = self.model
+        attributes["version"] = self.model
 
         return m.Resource(
             environment=self.environment,
             model=self.model,
             resource_id=self.resource_id,
             resource_type=self.resource_type,
             resource_version_id=resources.Id.set_version_in_id(self.resource_id, self.model),
@@ -5788,23 +5829,28 @@
     severity: const.NotificationSeverity = const.NotificationSeverity.message
     uri: str
     read: bool = False
     cleared: bool = False
 
     @classmethod
     async def clean_up_notifications(cls) -> None:
-        environments = await Environment.get_list()
-        for env in environments:
-            time_to_retain_logs = await env.get(NOTIFICATION_RETENTION)
-            keep_notifications_until = datetime.datetime.now().astimezone() - datetime.timedelta(days=time_to_retain_logs)
-            LOGGER.info(
-                "Cleaning up notifications in environment %s that are older than %s", env.name, keep_notifications_until
-            )
-            query = f"DELETE FROM {cls.table_name()} WHERE created < $1 AND environment = $2"
-            await cls._execute_query(query, cls._get_value(keep_notifications_until), cls._get_value(env.id))
+        default_retention_time = Environment._settings[NOTIFICATION_RETENTION].default
+        LOGGER.info("Cleaning up notifications")
+        query = f"""
+                   WITH non_halted_envs AS (
+                       SELECT id, (COALESCE((settings->>'notification_retention')::int, $1)) AS retention_days
+                       FROM {Environment.table_name()}
+                       WHERE NOT halted
+                   )
+                   DELETE FROM {cls.table_name()}
+                   USING non_halted_envs
+                   WHERE environment = non_halted_envs.id
+                       AND created < now() AT TIME ZONE 'UTC' - make_interval(days => non_halted_envs.retention_days)
+               """
+        await cls._execute_query(query, default_retention_time)
 
     def to_dto(self) -> m.Notification:
         return m.Notification(
             id=self.id,
             title=self.title,
             message=self.message,
             severity=self.severity,
@@ -5877,14 +5923,32 @@
         """
         return "inmanta_user"
 
     def to_dao(self) -> m.User:
         return m.User(username=self.username, auth_method=self.auth_method)
 
 
+class DiscoveredResource(BaseDocument):
+    """
+    :param environment: the environment of the resource
+    :param discovered_resource_id: The id of the resource
+    :param values: The values associated with the discovered_resource
+    """
+
+    environment: uuid.UUID
+    discovered_at: datetime.datetime
+    discovered_resource_id: m.ResourceIdStr
+    values: dict[str, str]
+
+    __primary_key__ = ("environment", "discovered_resource_id")
+
+    def to_dto(self) -> m.DiscoveredResource:
+        return m.DiscoveredResource(discovered_resource_id=self.discovered_resource_id, values=self.values)
+
+
 _classes = [
     Project,
     Environment,
     UnknownParameter,
     AgentProcess,
     AgentInstance,
     Agent,
@@ -5896,14 +5960,15 @@
     DryRun,
     Compile,
     Report,
     Notification,
     EnvironmentMetricsGauge,
     EnvironmentMetricsTimer,
     User,
+    DiscoveredResource,
 ]
 
 
 def set_connection_pool(pool: asyncpg.pool.Pool) -> None:
     LOGGER.debug("Connecting data classes")
     for cls in _classes:
         cls.set_connection_pool(pool)
```

### Comparing `inmanta-core-8.3.0/src/inmanta/data/dataview.py` & `inmanta-core-9.3.0/src/inmanta/data/dataview.py`

 * *Files 2% similar despite different names*

```diff
@@ -33,23 +33,25 @@
     PRIMITIVE_SQL_TYPES,
     Agent,
     AgentOrder,
     CompileReportOrder,
     ConfigurationModel,
     DatabaseOrderV2,
     DesiredStateVersionOrder,
+    DiscoveredResourceOrder,
     FactOrder,
     InvalidQueryParameter,
     InvalidSort,
     Notification,
     NotificationOrder,
     PagingOrder,
     Parameter,
     ParameterOrder,
     QueryFilter,
+    Resource,
     ResourceAction,
     ResourceHistoryOrder,
     ResourceLogOrder,
     ResourceOrder,
     SimpleQueryBuilder,
     VersionedResourceOrder,
     model,
@@ -198,15 +200,14 @@
                 offset=query_builder.offset, col_name_prefix=None, **self.filter
             )
         )
         query_builder = self.clip_to_page(query_builder)
         sql_query, values = query_builder.build()
 
         records = await data.Resource.select_query(sql_query, values, no_obj=True)
-
         dtos = self.construct_dtos(records)
 
         paging_boundaries = None
         if dtos:
             paging_boundaries = self.order.get_paging_boundaries(dict(records[0]), dict(records[-1]))
         return dtos, paging_boundaries
 
@@ -878,29 +879,44 @@
             query["msg"] = filter_value
         return query
 
     def get_base_url(self) -> str:
         return f"/api/v2/resource/{parse.quote(self.rid, safe='')}/logs"
 
     def get_base_query(self) -> SimpleQueryBuilder:
-        # The query uses a like query to match resource id with a resource_version_id. This means we need to escape the % and _
-        # characters in the query
-        resource_id = self.rid.replace("#", "##").replace("%", "#%").replace("_", "#_") + "%"
         query_builder = SimpleQueryBuilder(
+            prelude=f"""
+                -- Get all resource action in the given environment for the given resource_id
+                WITH actions AS (
+                    SELECT  ra.*
+                    FROM {Resource.table_name()} AS r INNER JOIN resourceaction_resource AS rr ON (
+                                                          r.environment=rr.environment
+                                                          AND r.resource_id=rr.resource_id
+                                                          AND r.model=rr.resource_version
+                                                      )
+                                                      INNER JOIN {ResourceAction.table_name()} AS ra ON (
+                                                          rr.resource_action_id=ra.action_id
+                                                      )
+                    WHERE r.environment=$1 AND r.resource_id=$2
+                )
+            """,
             select_clause="SELECT action_id, action, timestamp, unnested_message",
-            from_clause=f"""
+            from_clause="""
             FROM
-                    (SELECT action_id, action, (unnested_message ->> 'timestamp')::timestamptz as timestamp,
-                    unnested_message ->> 'level' as level,
-                    unnested_message ->> 'msg' as msg,
-                    unnested_message
-                    FROM {ResourceAction.table_name()}, unnest(resource_version_ids) rvid, unnest(messages) unnested_message
-                    WHERE environment = $1 AND rvid LIKE $2 ESCAPE '#') unnested
+                (
+                    SELECT action_id,
+                           action,
+                           (unnested_message ->> 'timestamp')::timestamptz AS timestamp,
+                           unnested_message ->> 'level' AS level,
+                           unnested_message ->> 'msg' AS msg,
+                           unnested_message
+                    FROM actions, unnest(messages) AS unnested_message
+                ) AS unnested
             """,
-            values=[self.environment.id, resource_id],
+            values=[self.environment.id, self.rid],
         )
         return query_builder
 
     def construct_dtos(self, records: Sequence[Record]) -> Sequence[ResourceLog]:
         logs = []
         for record in records:
             message = json.loads(record["unnested_message"])
@@ -1170,7 +1186,56 @@
                 unpause_on_resume=agent["unpause_on_resume"],
                 process_id=agent["process_id"],
                 process_name=agent["process_name"],
                 status=agent["status"],
             )
             for agent in records
         ]
+
+
+class DiscoveredResourceView(DataView[DiscoveredResourceOrder, model.DiscoveredResource]):
+    def __init__(
+        self,
+        environment: data.Environment,
+        limit: Optional[int] = None,
+        sort: str = "discovered_resource_id.asc",
+        start: Optional[str] = None,
+        end: Optional[str] = None,
+    ) -> None:
+        super().__init__(
+            order=DiscoveredResourceOrder.parse_from_string(sort),
+            limit=limit,
+            first_id=None,
+            last_id=None,
+            start=start,
+            end=end,
+            filter=None,
+        )
+        self.environment = environment
+
+    @property
+    def allowed_filters(self) -> Dict[str, Type[Filter]]:
+        """
+        Return the specification of the allowed filters, see FilterValidator
+        """
+        return {}
+
+    def get_base_url(self) -> str:
+        return "/api/v2/discovered"
+
+    def get_base_query(self) -> SimpleQueryBuilder:
+        query_builder = SimpleQueryBuilder(
+            select_clause="SELECT environment, discovered_resource_id, values",
+            from_clause=f" FROM {data.DiscoveredResource.table_name()}",
+            filter_statements=["environment = $1"],
+            values=[self.environment.id],
+        )
+        return query_builder
+
+    def construct_dtos(self, records: Sequence[Record]) -> Sequence[dict[str, str]]:
+        return [
+            model.DiscoveredResource(
+                discovered_resource_id=res["discovered_resource_id"],
+                values=json.loads(res["values"]),
+            ).dict()
+            for res in records
+        ]
```

### Comparing `inmanta-core-8.3.0/src/inmanta/data/model.py` & `inmanta-core-9.3.0/src/inmanta/data/model.py`

 * *Files 4% similar despite different names*

```diff
@@ -24,16 +24,15 @@
 import pydantic
 import pydantic.schema
 from pydantic import Extra, root_validator, validator
 from pydantic.fields import ModelField
 
 import inmanta
 import inmanta.ast.export as ast_export
-import inmanta.data
-from inmanta import const, protocol, resources
+from inmanta import const, data, protocol, resources
 from inmanta.stable_api import stable_api
 from inmanta.types import ArgumentTypes, JsonType, SimpleTypes, StrictNonIntBool
 
 # This reference to the actual pydantic field_type_schema method is only loaded once
 old_field_type_schema = pydantic.schema.field_type_schema
 
 
@@ -304,25 +303,14 @@
     type: str
     extra_data: Optional[JsonType]
 
     class Config:
         fields = {"inmanta_compile_state": {"alias": "inmanta:compile:state"}}
 
 
-class ModelVersionInfo(BaseModel):
-    """Version information that can be associated with an orchestration model
-
-    :param export_metadata: Metadata associated with this version
-    :param model: A serialization of the complete orchestration model
-    """
-
-    export_metadata: ModelMetadata
-    model: Optional[JsonType]
-
-
 class ResourceMinimal(BaseModel):
     """
     Represents a resource object as it comes in over the API. Provides strictly required validation only.
     """
 
     id: ResourceVersionIdStr
 
@@ -723,7 +711,32 @@
 
     :param token: A token representing the user's authentication session
     :param user: The user object for which the token was created
     """
 
     token: str
     user: User
+
+
+class DiscoveredResource(BaseModel):
+    """
+    :param discovered_resource_id: The name of the resource
+    :param values: The actual resource
+    """
+
+    discovered_resource_id: ResourceIdStr
+    values: JsonType
+
+    @validator("discovered_resource_id")
+    @classmethod
+    def discovered_resource_id_is_resource_id(cls, v: str) -> Optional[Any]:
+        if resources.Id.is_resource_id(v):
+            return v
+        raise ValueError(f"id {v} is not of type ResourceIdStr")
+
+    def to_dao(self, env: uuid) -> "data.DiscoveredResource":
+        return data.DiscoveredResource(
+            discovered_resource_id=self.discovered_resource_id,
+            values=self.values,
+            discovered_at=datetime.datetime.now(),
+            environment=env,
+        )
```

### Comparing `inmanta-core-8.3.0/src/inmanta/data/schema.py` & `inmanta-core-9.3.0/src/inmanta/data/schema.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/db/__init__.py` & `inmanta-core-9.3.0/src/inmanta/db/__init__.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/db/util.py` & `inmanta-core-9.3.0/src/inmanta/db/util.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/db/versions/__init__.py` & `inmanta-core-9.3.0/src/inmanta/db/versions/__init__.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/db/versions/v1.py` & `inmanta-core-9.3.0/src/inmanta/db/versions/v1.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/db/versions/v17.py` & `inmanta-core-9.3.0/src/inmanta/db/versions/v17.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/db/versions/v2.py` & `inmanta-core-9.3.0/src/inmanta/db/versions/v2.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/db/versions/v202105170.py` & `inmanta-core-9.3.0/src/inmanta/db/versions/v202105170.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/db/versions/v202106080.py` & `inmanta-core-9.3.0/src/inmanta/db/versions/v202106080.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/db/versions/v202106210.py` & `inmanta-core-9.3.0/src/inmanta/db/versions/v202106210.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/db/versions/v202109100.py` & `inmanta-core-9.3.0/src/inmanta/db/versions/v202109100.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/db/versions/v202111260.py` & `inmanta-core-9.3.0/src/inmanta/db/versions/v202111260.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/db/versions/v202203140.py` & `inmanta-core-9.3.0/src/inmanta/db/versions/v202203140.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/db/versions/v202203160.py` & `inmanta-core-9.3.0/src/inmanta/db/versions/v202203160.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/db/versions/v202205250.py` & `inmanta-core-9.3.0/src/inmanta/db/versions/v202205250.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/db/versions/v202206290.py` & `inmanta-core-9.3.0/src/inmanta/db/versions/v202206290.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/db/versions/v202208180.py` & `inmanta-core-9.3.0/src/inmanta/db/versions/v202208180.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/db/versions/v202208190.py` & `inmanta-core-9.3.0/src/inmanta/db/versions/v202208190.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/db/versions/v202209090.py` & `inmanta-core-9.3.0/src/inmanta/db/versions/v202209090.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/db/versions/v202209130.py` & `inmanta-core-9.3.0/src/inmanta/db/versions/v202209130.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/db/versions/v202209160.py` & `inmanta-core-9.3.0/src/inmanta/db/versions/v202209160.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/db/versions/v202211230.py` & `inmanta-core-9.3.0/src/inmanta/db/versions/v202211230.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/db/versions/v202212010.py` & `inmanta-core-9.3.0/src/inmanta/db/versions/v202212010.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/db/versions/v202301100.py` & `inmanta-core-9.3.0/src/inmanta/db/versions/v202301100.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/db/versions/v202301110.py` & `inmanta-core-9.3.0/src/inmanta/db/versions/v202301110.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/db/versions/v202301120.py` & `inmanta-core-9.3.0/src/inmanta/db/versions/v202301120.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/db/versions/v202301160.py` & `inmanta-core-9.3.0/src/inmanta/db/versions/v202301160.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/db/versions/v202301170.py` & `inmanta-core-9.3.0/src/inmanta/db/versions/v202301170.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/db/versions/v202301190.py` & `inmanta-core-9.3.0/src/inmanta/db/versions/v202301190.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/db/versions/v202302200.py` & `inmanta-core-9.3.0/src/inmanta/db/versions/v202302200.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/db/versions/v202302270.py` & `inmanta-core-9.3.0/src/inmanta/db/versions/v202302270.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/db/versions/v202303070.py` & `inmanta-core-9.3.0/src/inmanta/db/versions/v202303070.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/db/versions/v202303071.py` & `inmanta-core-9.3.0/src/inmanta/db/versions/v202303071.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/db/versions/v3.py` & `inmanta-core-9.3.0/src/inmanta/db/versions/v3.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/db/versions/v4.py` & `inmanta-core-9.3.0/src/inmanta/db/versions/v4.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/db/versions/v5.py` & `inmanta-core-9.3.0/src/inmanta/db/versions/v5.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/db/versions/v6.py` & `inmanta-core-9.3.0/src/inmanta/db/versions/v6.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/db/versions/v7.py` & `inmanta-core-9.3.0/src/inmanta/db/versions/v7.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/deploy.py` & `inmanta-core-9.3.0/src/inmanta/deploy.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/docstring_parser.py` & `inmanta-core-9.3.0/src/inmanta/docstring_parser.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/env.py` & `inmanta-core-9.3.0/src/inmanta/env.py`

 * *Files 2% similar despite different names*

```diff
@@ -327,43 +327,58 @@
         paths: Optional[List[LocalPackagePath]] = None,
         index_urls: Optional[List[str]] = None,
         upgrade: bool = False,
         upgrade_strategy: PipUpgradeStrategy = PipUpgradeStrategy.ONLY_IF_NEEDED,
         allow_pre_releases: bool = False,
         constraints_files: Optional[List[str]] = None,
         requirements_files: Optional[List[str]] = None,
+        use_pip_config: bool = False,
     ) -> List[str]:
         """
         Generate `pip install` command from the given arguments.
 
         :param python_path: The python interpreter to use in the command
         :param requirements: The requirements that should be installed
         :param paths: Paths to python projects on disk that should be installed in the venv.
         :param index_urls: The Python package repositories to use. When set to None, the system default will be used.
         :param upgrade: Upgrade the specified packages to the latest version.
         :param upgrade_strategy: The upgrade strategy to use for requirements' dependencies.
         :param allow_pre_releases: Allow the installation of packages with pre-releases and development versions.
         :param constraints_files: Files that should be passed to pip using the `-c` option.
         :param requirements_files: Files that should be passed to pip using the `-r` option.
+        :param use_pip_config: Whether the pip config file specified in the PIP_CONFIG_FILE env var should be used
         """
         requirements = requirements if requirements is not None else []
         paths = paths if paths is not None else []
         local_paths: Iterator[LocalPackagePath] = (
             # make sure we only try to install from a local source: add leading `./` and trailing `/` to explicitly tell pip
             # we're pointing to a local directory.
             LocalPackagePath(path=os.path.join(".", path.path, ""), editable=path.editable)
             for path in paths
         )
-        index_args: List[str] = (
-            []
-            if index_urls is None
-            else ["--index-url", index_urls[0], *chain.from_iterable(["--extra-index-url", url] for url in index_urls[1:])]
-            if index_urls
-            else ["--no-index"]
-        )
+        index_args: list[str] = []
+
+        if use_pip_config:
+            if index_urls:
+                # Use only --extra-index-url arguments
+                for url in index_urls:
+                    index_args.append("--extra-index-url")
+                    index_args.append(url)
+        elif index_urls is None:
+            pass
+        elif index_urls:
+            # Use separate --index-url and --extra-index-url arguments
+            index_args.append("--index-url")
+            index_args.append(index_urls[0])
+            for url in index_urls[1:]:
+                index_args.append("--extra-index-url")
+                index_args.append(url)
+        else:
+            index_args = ["--no-index"]
+
         constraints_files = constraints_files if constraints_files is not None else []
         requirements_files = requirements_files if requirements_files is not None else []
         return [
             python_path,
             "-m",
             "pip",
             "install",
@@ -468,31 +483,32 @@
         paths: Optional[List[LocalPackagePath]] = None,
         index_urls: Optional[List[str]] = None,
         upgrade: bool = False,
         upgrade_strategy: PipUpgradeStrategy = PipUpgradeStrategy.ONLY_IF_NEEDED,
         allow_pre_releases: bool = False,
         constraints_files: Optional[List[str]] = None,
         requirements_files: Optional[List[str]] = None,
+        use_pip_config: Optional[bool] = False,
     ) -> None:
         cmd: List[str] = PipCommandBuilder.compose_install_command(
             python_path=python_path,
             requirements=requirements,
             paths=paths,
             index_urls=index_urls,
             upgrade=upgrade,
             upgrade_strategy=upgrade_strategy,
             allow_pre_releases=allow_pre_releases,
             constraints_files=constraints_files,
             requirements_files=requirements_files,
+            use_pip_config=use_pip_config,
         )
-
         sub_env = os.environ.copy()
 
         # if index_urls are set, only use those. Otherwise, use the one from the environment
-        if index_urls is not None:
+        if index_urls is not None and not use_pip_config:
             # setting this env_var to os.devnull disables the loading of all pip configuration files
             sub_env["PIP_CONFIG_FILE"] = os.devnull
         if index_urls is not None and "PIP_EXTRA_INDEX_URL" in sub_env:
             del sub_env["PIP_EXTRA_INDEX_URL"]
         if index_urls is not None and "PIP_INDEX_URL" in sub_env:
             del sub_env["PIP_INDEX_URL"]
 
@@ -574,42 +590,49 @@
         self,
         requirements: List[Requirement],
         index_urls: Optional[List[str]] = None,
         upgrade: bool = False,
         allow_pre_releases: bool = False,
         constraint_files: Optional[List[str]] = None,
         upgrade_strategy: PipUpgradeStrategy = PipUpgradeStrategy.ONLY_IF_NEEDED,
+        use_pip_config: Optional[bool] = False,
     ) -> None:
         if len(requirements) == 0:
             raise Exception("install_from_index requires at least one requirement to install")
         constraint_files = constraint_files if constraint_files is not None else []
         inmanta_requirements = self._get_requirements_on_inmanta_package()
         self._run_pip_install_command(
             python_path=self.python_path,
             requirements=[*requirements, *inmanta_requirements],
             index_urls=index_urls,
             upgrade=upgrade,
             allow_pre_releases=allow_pre_releases,
             constraints_files=[*constraint_files],
             upgrade_strategy=upgrade_strategy,
+            use_pip_config=use_pip_config,
         )
 
-    def install_from_source(self, paths: List[LocalPackagePath], constraint_files: Optional[List[str]] = None) -> None:
+    def install_from_source(
+        self,
+        paths: List[LocalPackagePath],
+        constraint_files: Optional[List[str]] = None,
+    ) -> None:
         """
         Install one or more packages from source. Any path arguments should be local paths to a package directory or wheel.
         """
         if len(paths) == 0:
             raise Exception("install_from_source requires at least one package to install")
         constraint_files = constraint_files if constraint_files is not None else []
         inmanta_requirements = self._get_requirements_on_inmanta_package()
         self._run_pip_install_command(
             python_path=self.python_path,
             paths=paths,
             constraints_files=constraint_files,
             requirements=inmanta_requirements,
+            use_pip_config=True,
         )
 
     @classmethod
     def get_protected_inmanta_packages(cls) -> List[str]:
         """
         Returns the list of packages that should not be installed/updated by any operation on a Python environment.
         """
@@ -735,25 +758,30 @@
         self,
         requirements: List[Requirement],
         index_urls: Optional[List[str]] = None,
         upgrade: bool = False,
         allow_pre_releases: bool = False,
         constraint_files: Optional[List[str]] = None,
         upgrade_strategy: PipUpgradeStrategy = PipUpgradeStrategy.ONLY_IF_NEEDED,
+        use_pip_config: Optional[bool] = False,
     ) -> None:
         if not upgrade and self.are_installed(requirements):
             return
         try:
             super(ActiveEnv, self).install_from_index(
-                requirements, index_urls, upgrade, allow_pre_releases, constraint_files, upgrade_strategy
+                requirements, index_urls, upgrade, allow_pre_releases, constraint_files, upgrade_strategy, use_pip_config
             )
         finally:
             self.notify_change()
 
-    def install_from_source(self, paths: List[LocalPackagePath], constraint_files: Optional[List[str]] = None) -> None:
+    def install_from_source(
+        self,
+        paths: List[LocalPackagePath],
+        constraint_files: Optional[List[str]] = None,
+    ) -> None:
         try:
             super().install_from_source(paths, constraint_files)
         finally:
             self.notify_change()
 
     @classmethod
     def _parse_line(cls, req_line: str) -> Tuple[Optional[str], str]:
@@ -847,37 +875,42 @@
 
     def install_from_list(
         self,
         requirements_list: Sequence[str],
         *,
         upgrade: bool = False,
         upgrade_strategy: PipUpgradeStrategy = PipUpgradeStrategy.ONLY_IF_NEEDED,
+        use_pip_config: Optional[bool] = False,
     ) -> None:
         """
         Install requirements from a list of requirement strings. This method uses the Python package repositories
         configured on the host.
 
         :param requirements_list: List of requirement strings to install.
         :param upgrade: Upgrade requirements to the latest compatible version.
         :param upgrade_strategy: The upgrade strategy to use for requirements' dependencies.
+        :param use_pip_config: Whether the pip config file specified in the PIP_CONFIG_FILE env var should be used
         """
         if not upgrade and self.are_installed(requirements_list):
             # don't fork subprocess if requirements are already met
             return
         try:
-            self._install_from_list(requirements_list, upgrade=upgrade, upgrade_strategy=upgrade_strategy)
+            self._install_from_list(
+                requirements_list, upgrade=upgrade, upgrade_strategy=upgrade_strategy, use_pip_config=use_pip_config
+            )
         finally:
             self.notify_change()
 
     def _install_from_list(
         self,
         requirements_list: Sequence[str],
         *,
         upgrade: bool = False,
         upgrade_strategy: PipUpgradeStrategy = PipUpgradeStrategy.ONLY_IF_NEEDED,
+        use_pip_config: Optional[bool] = False,
     ) -> None:
         """
         This method differs from the `install_from_index()` method in the sense that it calls
         `_gen_content_requirements_file()`, which rewrites the requirements from pep440 format to a format that pip understands.
         This method is maintained for V1 modules only: V2 modules do not require this conversion. It is currently used for both
         v1 and v2 for consistency but it can be substituted by `install_from_index` once V1 support is removed.
         """
@@ -887,14 +920,15 @@
             try:
                 self._run_pip_install_command(
                     python_path=self.python_path,
                     requirements_files=[requirements_file],
                     requirements=inmanta_requirements,
                     upgrade=upgrade,
                     upgrade_strategy=upgrade_strategy,
+                    use_pip_config=use_pip_config,
                 )
             except Exception:
                 LOGGER.info("requirements:\n%s", content_requirements_file)
                 raise
 
     @classmethod
     def get_constraint_violations_for_check(
@@ -1282,36 +1316,44 @@
         self,
         requirements: List[Requirement],
         index_urls: Optional[List[str]] = None,
         upgrade: bool = False,
         allow_pre_releases: bool = False,
         constraint_files: Optional[List[str]] = None,
         upgrade_strategy: PipUpgradeStrategy = PipUpgradeStrategy.ONLY_IF_NEEDED,
+        use_pip_config: Optional[bool] = False,
     ) -> None:
         if not self._using_venv:
             raise Exception(f"Not using venv {self.env_path}. use_virtual_env() should be called first.")
         super(VirtualEnv, self).install_from_index(
-            requirements, index_urls, upgrade, allow_pre_releases, constraint_files, upgrade_strategy
+            requirements, index_urls, upgrade, allow_pre_releases, constraint_files, upgrade_strategy, use_pip_config
         )
 
-    def install_from_source(self, paths: List[LocalPackagePath], constraint_files: Optional[List[str]] = None) -> None:
+    def install_from_source(
+        self,
+        paths: List[LocalPackagePath],
+        constraint_files: Optional[List[str]] = None,
+    ) -> None:
         if not self._using_venv:
             raise Exception(f"Not using venv {self.env_path}. use_virtual_env() should be called first.")
         super(VirtualEnv, self).install_from_source(paths, constraint_files)
 
     def install_from_list(
         self,
         requirements_list: Sequence[str],
         *,
         upgrade: bool = False,
         upgrade_strategy: PipUpgradeStrategy = PipUpgradeStrategy.ONLY_IF_NEEDED,
+        use_pip_config: Optional[bool] = False,
     ) -> None:
         if not self._using_venv:
             raise Exception(f"Not using venv {self.env_path}. use_virtual_env() should be called first.")
-        super(VirtualEnv, self).install_from_list(requirements_list, upgrade=upgrade, upgrade_strategy=upgrade_strategy)
+        super(VirtualEnv, self).install_from_list(
+            requirements_list, upgrade=upgrade, upgrade_strategy=upgrade_strategy, use_pip_config=use_pip_config
+        )
 
 
 class VenvCreationFailedError(Exception):
     def __init__(self, msg: str) -> None:
         super().__init__(msg)
         self.msg = msg
```

### Comparing `inmanta-core-8.3.0/src/inmanta/execute/__init__.py` & `inmanta-core-9.3.0/src/inmanta/execute/__init__.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/execute/dataflow/__init__.py` & `inmanta-core-9.3.0/src/inmanta/execute/dataflow/__init__.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/execute/dataflow/datatrace.py` & `inmanta-core-9.3.0/src/inmanta/execute/dataflow/datatrace.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/execute/dataflow/graphic.py` & `inmanta-core-9.3.0/src/inmanta/execute/dataflow/graphic.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/execute/dataflow/root_cause.py` & `inmanta-core-9.3.0/src/inmanta/execute/dataflow/root_cause.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/execute/proxy.py` & `inmanta-core-9.3.0/src/inmanta/execute/proxy.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/execute/runtime.py` & `inmanta-core-9.3.0/src/inmanta/execute/runtime.py`

 * *Files 1% similar despite different names*

```diff
@@ -43,17 +43,19 @@
     from inmanta.ast.entity import Entity, Implementation
     from inmanta.ast.statements import RawResumer, RequiresEmitStatement, Resumer, Statement
     from inmanta.compiler import Compiler
     from inmanta.execute.scheduler import PrioritisedDelayedResultVariableQueue
 
 
 T = TypeVar("T")
+T_co = TypeVar("T_co", covariant=True)
+T_contra = TypeVar("T_contra", contravariant=True)
 
 
-class ResultCollector(Generic[T]):
+class ResultCollector(Generic[T_contra]):
     """
     Helper interface for gradual execution. Should be attached as a listener to a ResultVariable, which will then call
     receive_result whenever it receives a new value.
     """
 
     __slots__ = ()
 
@@ -63,15 +65,15 @@
         no progress is expected as a result of the variable being frozen.
 
         This is a static property of a result collector, i.e. this method will always have the same result at any point within
         the lifetime of the instance.
         """
         return True
 
-    def receive_result(self, value: T, location: Location) -> bool:
+    def receive_result(self, value: T_contra, location: Location) -> bool:
         """
         Receive a single value for gradual execution. Called once for each value that is part of the result.
 
         :return: Whether this collector is complete, i.e. it does not need to receive any further results and its associated
             waiter will no longer cause progress. Once this is signalled, this instance should get no further results.
         """
         raise NotImplementedError()
@@ -116,36 +118,36 @@
     def fulfill(self) -> None:
         """
         Fulfills this promise by notifying the owner. No further progression is expected. Idempotent.
         """
         self.owner.fulfill(self)
 
 
-class VariableABC(Generic[T]):
+class VariableABC(Generic[T_co]):
     """
     Abstract base class for variables that get passed around the AST nodes' methods via waiters.
     """
 
     __slots__ = ()
 
     def is_ready(self) -> bool:
         """
         Returns true iff this variable does not expect any more values.
         """
         raise NotImplementedError()
 
-    def get_value(self) -> T:
+    def get_value(self) -> T_co:
         """
         Returns the value object for this variable
 
         :raises OptionalValueException: This is an optional variable that has not received a value (or explicit `null`).
         """
         raise NotImplementedError()
 
-    def listener(self, resultcollector: ResultCollector[T], location: Location) -> None:
+    def listener(self, resultcollector: ResultCollector[T_co], location: Location) -> None:
         """
         Add a listener to report new values to. If the variable already has a value, this is reported immediately. Explicit
         assignments of `null` will not be reported.
 
         Each listener is expected to register one associated waiter to track completeness. The progress potential implementation
         is based on this invariant.
 
@@ -304,14 +306,30 @@
         self._node.set_result_variable(self)
 
     def get_dataflow_node(self) -> dataflow.AssignableNodeReference:
         assert self._node is not None, "assertion error at %s.get_dataflow_node() in ResultVariable" % self
         return self._node
 
 
+class ListElementVariable(ResultVariable[T]):
+    """
+    Variable representing a single value in a gradually executable list. Can be resolved immediately and allows attaching
+    listeners who will receive this single value.
+    """
+
+    def __init__(self, value: T, location: Location) -> None:
+        super().__init__()
+        self.set_value(value, location)
+
+    def listener(self, resultcollector: ResultCollector[T], location: Location) -> None:
+        assert self.value is not None
+        if not isinstance(self.value, NoneValue):
+            resultcollector.receive_result(self.value, location)
+
+
 class ResultVariableProxy(VariableABC[T]):
     """
     A proxy for a reading from a ResultVariable that implements the VariableABC interface. Allows for assignment between
     variables without resolving the right hand side at the time of assignment.
     This class does not support setting values or related operations such as acquiring progression promises.
     """
 
@@ -529,15 +547,15 @@
 
     value: "List[Instance]"
 
     __slots__ = ("_listeners", "_nb_gradual_waiters")
 
     def __init__(self, queue: "QueueScheduler") -> None:
         # use dict for easy lookup with reliable ordering
-        self._listeners: Optional[dict[ResultCollector[ListValue], None]] = {}
+        self._listeners: Optional[dict[ResultCollector["Instance"], None]] = {}
         # Cache count for waiters without progress potential. Meaning waiters associated with either a purely gradual
         # listener or with a listener that indicated it is done.
         self._nb_gradual_waiters: int = 0
         super().__init__(queue, [])
 
     def _set_value(self, value: ListValue, location: Location, recur: bool = True) -> bool:
         """
@@ -586,15 +604,15 @@
             return False
 
         self.value.append(value)
         self._notify_listeners(value, location)
 
         return True
 
-    def _notify_listeners(self, value: ListValue, location: Location) -> None:
+    def _notify_listeners(self, value: "Instance", location: Location) -> None:
         """
         Notifies all listeners about a new value. Deregisters any listeners that indicate they no longer wish to receive
         results.
         """
         assert self._listeners is not None
         for listener in list(self._listeners.keys()):
             done: bool = listener.receive_result(value, location)
@@ -614,15 +632,15 @@
     def can_get(self) -> bool:
         return self.get_waiting_providers() == 0
 
     def receive_result(self, value: ListValue, location: Location) -> bool:
         self.set_value(value, location)
         return False
 
-    def listener(self, resultcollector: ResultCollector, location: Location) -> None:
+    def listener(self, resultcollector: ResultCollector["Instance"], location: Location) -> None:
         for value in self.value:
             resultcollector.receive_result(value, location)
         if not self.hasValue:
             assert self._listeners is not None
             if resultcollector in self._listeners:
                 # may happen in case of a duplicate assignment, e.g. `x.a = [y.a, y.a]`
                 # consider the new one to have no progress potential because we don't track it separately
@@ -904,15 +922,15 @@
     def requeue_with_additional_requires(self, key: Hashable, waitable: ResultVariable) -> None:
         """
         Re-queue with an additional requirement
         """
         self.requires[key] = waitable
         self.waitfor(waitable)
 
-    def waitfor(self, waitable: ResultVariable) -> None:
+    def waitfor(self, waitable: VariableABC[object]) -> None:
         self.waitcount = self.waitcount + 1
         waitable.waitfor(self)
 
     def ready(self, other: Union[ResultVariable, "Waiter"]) -> None:
         self.waitcount = self.waitcount - 1
         if self.waitcount == 0:
             self.queue.add_running(self)
```

### Comparing `inmanta-core-8.3.0/src/inmanta/execute/scheduler.py` & `inmanta-core-9.3.0/src/inmanta/execute/scheduler.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/execute/tracking.py` & `inmanta-core-9.3.0/src/inmanta/execute/tracking.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/execute/util.py` & `inmanta-core-9.3.0/src/inmanta/execute/util.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/export.py` & `inmanta-core-9.3.0/src/inmanta/export.py`

 * *Files 1% similar despite different names*

```diff
@@ -529,15 +529,19 @@
         version_info = {const.EXPORT_META_DATA: metadata}
 
         # TODO: start transaction
         LOGGER.info("Sending resource updates to server")
         if LOGGER.isEnabledFor(logging.DEBUG):
             for res in resources:
                 rid = res["id"]
-                LOGGER.debug("  %s in resource set %s", rid, self._resource_sets.get(Id.parse_id(rid).resource_str(), ""))
+                resource_set: Optional[str] = self._resource_sets.get(Id.parse_id(rid).resource_str(), None)
+                if resource_set is not None:
+                    LOGGER.debug("  %s in resource set %s", rid, resource_set)
+                else:
+                    LOGGER.debug("  %s not in any resource set", rid)
 
         if partial_compile:
             result = conn.put_partial(
                 tid=tid,
                 resources=resources,
                 resource_sets=self._resource_sets,
                 unknowns=unknown_parameters,
```

### Comparing `inmanta-core-8.3.0/src/inmanta/file_parser.py` & `inmanta-core-9.3.0/src/inmanta/file_parser.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/loader.py` & `inmanta-core-9.3.0/src/inmanta/loader.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/main.py` & `inmanta-core-9.3.0/src/inmanta/main.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/model.py` & `inmanta-core-9.3.0/src/inmanta/model.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/module.py` & `inmanta-core-9.3.0/src/inmanta/module.py`

 * *Files 1% similar despite different names*

```diff
@@ -13,17 +13,17 @@
     See the License for the specific language governing permissions and
     limitations under the License.
 
     Contact: code@inmanta.com
 """
 
 import configparser
-import enum
 import glob
 import importlib
+import itertools
 import logging
 import operator
 import os
 import re
 import subprocess
 import sys
 import tempfile
@@ -31,14 +31,15 @@
 import traceback
 import types
 import warnings
 from abc import ABC, abstractmethod
 from collections import abc, defaultdict
 from configparser import ConfigParser
 from dataclasses import dataclass
+from enum import Enum
 from functools import reduce
 from importlib.abc import Loader
 from io import BytesIO, TextIOBase
 from itertools import chain
 from subprocess import CalledProcessError
 from tarfile import TarFile
 from time import time
@@ -319,15 +320,15 @@
             f"Unable to load all plug-ins for module {self.module}:"
             f"\n\t{cause_type_name} while loading plugin module {self.fq_import}: {self.cause}"
         )
         exception.set_location(Location(self.path, self.lineno if self.lineno is not None else 0))
         return exception
 
 
-class UntrackedFilesMode(enum.Enum):
+class UntrackedFilesMode(Enum):
     """
     The different options that can be passed to the --untracked-files option of the `git status` command.
     """
 
     ALL = "all"
     NORMAL = "normal"
     NO = "no"
@@ -708,21 +709,22 @@
 
     @classmethod
     def get_namespace_package_name(cls, module_name: str) -> str:
         return f"{const.PLUGINS_PACKAGE}.{module_name}"
 
     def install(self, project: "Project", module_spec: List[InmantaModuleRequirement]) -> Optional["ModuleV2"]:
         module_name: str = self._get_module_name(module_spec)
-        if not self.urls:
+        if not self.urls and not project.metadata.pip.use_config_file:
             raise Exception(
-                f"Attempting to install a v2 module {module_name} but no v2 module source is configured. Add at least one "
-                'repo of type "package" to the project config file. e.g. to add PyPi as a module source, add the following to '
-                "the `repo` section of the project's `project.yml`:"
-                "\n\t- type: package"
-                "\n\t  url: https://pypi.org/simple"
+                f"Attempting to install a v2 module {module_name} but no v2 module source is configured. Add the relevant pip "
+                f"indexes to the project config file. e.g. to add PyPi as a module source, add the following to "
+                "the `pip` section of the project's `project.yml`:"
+                "\n\t  index_urls:"
+                "\n\t\t  - https://pypi.org/simple"
+                "\nAnother option is to set the use_config_file project option to true to use the system's pip config file."
             )
         requirements: List[Requirement] = [req.get_python_package_requirement() for req in module_spec]
         allow_pre_releases = project is not None and project.install_mode in {InstallMode.prerelease, InstallMode.master}
         preinstalled: Optional[ModuleV2] = self.get_installed_module(project, module_name)
 
         # Get known requires and add them to prevent invalidating constraints through updates
         # These could be constraints (-c) as well, but that requires additional sanitation
@@ -739,16 +741,20 @@
                     module_name,
                     preinstalled_version,
                     ",".join(constraint.version_spec_str() for constraint in module_spec if constraint.specs),
                 )
         try:
             self.log_pre_install_information(module_name, module_spec)
             modules_pre_install = self.take_v2_modules_snapshot(header="Modules versions before installation:")
-            env.process_env.install_from_index(requirements, self.urls, allow_pre_releases=allow_pre_releases)
-
+            env.process_env.install_from_index(
+                requirements,
+                self.urls,
+                allow_pre_releases=allow_pre_releases,
+                use_pip_config=project.metadata.pip.use_config_file,
+            )
             self.log_post_install_information(module_name)
             self.log_snapshot_difference_v2_modules(modules_pre_install, header="Modules versions after installation:")
         except env.PackageNotFound:
             return None
         path: Optional[str] = self.path_for(module_name)
         if path is None:
             python_package: str = ModuleV2Source.get_package_name_for(module_name)
@@ -1057,15 +1063,15 @@
         if key not in mainspec:
             mainspec[key] = [req]
         else:
             mainspec[key] = mainspec[key] + [req]
 
 
 @stable_api
-class InstallMode(str, enum.Enum):
+class InstallMode(str, Enum):
     """
     The module install mode determines what version of a module should be selected when a module is downloaded.
     """
 
     release = "release"
     """
     Only use a released version that is compatible with the current compiler and any version constraints defined in the
@@ -1094,15 +1100,15 @@
 INSTALL_OPTS: List[str] = [mode.value for mode in InstallMode]  # Part of the stable API
 """
 List of possible module install modes, kept for backwards compatibility. New code should use :class:`InstallMode` instead.
 """
 
 
 @stable_api
-class FreezeOperator(str, enum.Enum):
+class FreezeOperator(str, Enum):
     eq = "=="
     compatible = "~="
     ge = ">="
 
     @classmethod
     def get_regex_for_validation(cls) -> str:
         all_values = [re.escape(o.value) for o in cls]
@@ -1477,15 +1483,15 @@
                 out.add_section("egg_info")
             out.set("egg_info", "tag_build", self.version_tag)
 
         return out
 
 
 @stable_api
-class ModuleRepoType(enum.Enum):
+class ModuleRepoType(Enum):
     git = "git"
     package = "package"
 
 
 @stable_api
 class ModuleRepoInfo(BaseModel):
     url: str
@@ -1525,14 +1531,31 @@
         )
 
     def __str__(self) -> str:
         return f"{self.first_type}.{self.first_relation_name} before {self.then_type}.{self.then_relation_name}"
 
 
 @stable_api
+class ProjectPipConfig(BaseModel):
+    """
+    :param use_config_file: Indicates whether the pip configuration files have to be taken into account when installing
+        Python packages.
+    :param index_urls: List of pip indexes to use project-wide. These repositories should be
+        `PEP 503 <https://www.python.org/dev/peps/pep-0503/>`_ (the simple repository API)
+        compliant. If more than one index url is configured, they will all be passed to pip. This is generally only
+        recommended if all configured indexes are under full control of the end user to protect against dependency
+        confusion attacks. See the `pip install documentation <https://pip.pypa.io/en/stable/cli/pip_install/>`_ and
+        `PEP 708 (draft) <https://peps.python.org/pep-0708/>`_ for more information.
+    """
+
+    use_config_file: bool = False
+    index_urls: List[str] = []
+
+
+@stable_api
 class ProjectMetadata(Metadata, MetadataFieldRequires):
     """
     :param name: The name of the project.
     :param description: (Optional) An optional description of the project
     :param author: (Optional) The author of the project
     :param author_email: (Optional) The contact email address of author
     :param license: (Optional) License the project is released under
@@ -1545,20 +1568,16 @@
     :param repo: (Optional) A list (a yaml list) of repositories where Inmanta can find modules. Inmanta tries each repository
         in the order they appear in the list. Each element of this list requires a ``type`` and a ``url`` field. The type field
         can have the following values:
 
         * git: When the type is set to git, the url field should contain a template of the Git repo URL. Inmanta creates the
           git repo url by formatting {} or {0} with the name of the module. If no formatter is present it appends the name
           of the module to the URL.
-        * package: When the type is set to package, the URL field should contain the URL of the Python package repository.
-          The repository should be `PEP 503 <https://www.python.org/dev/peps/pep-0503/>`_ (the simple repository API)
-          compliant. If more than one package url is configured, they will all be passed to pip. This is generally only
-          recommended if all configured indexes are under full control of the end user to protect against dependency
-          confusion attacks. See the `pip install documentation <https://pip.pypa.io/en/stable/cli/pip_install/>`_ and
-          `PEP 708 (draft) <https://peps.python.org/pep-0708/>`_ for more information.
+        * package: [DEPRECATED] Setting up pip indexes should be done via the ``index_urls`` option of the ``pip`` section. See
+          :py:class:`inmanta.module.ProjectPipConfig` for more details.
 
         The old syntax, which only defines a Git URL per list entry is maintained for backward compatibility.
     :param requires: (Optional) This key can contain a list (a yaml list) of version constraints for modules used in this
         project. Similar to the module, version constraints are defined using
         `PEP440 syntax <https://www.python.org/dev/peps/pep-0440/#version-specifiers>`_.
     :param freeze_recursive: (Optional) This key determined if the freeze command will behave recursively or not. If
         freeze_recursive is set to false or not set, the current version of all modules imported directly in the main.cf file
@@ -1589,14 +1608,16 @@
         account when making changes to handler code.
 
         Another caveat is that if the dependency module does contain code that is relevant for the agent, it will be loaded
         like any other handler code and it will be this code that is imported by any dependent modules (though depending on
         the load order the very first import may use the version installed by pip). If at some point this dependency module's
         handlers cease to be relevant for this agent, its code will remain stale. Therefore this feature should not be depended
         on in transient scenarios like this.
+    :param pip: A configuration section that holds information about the pip configuration that should be taken into account
+                when installing Python packages (See: :py:class:`inmanta.module.ProjectPipConfig` for more details).
     """
 
     _raw_parser: Type[YamlParser] = YamlParser
     _re_relation_precedence_rule: str = r"^(?P<ft>[^\s.]+)\.(?P<fr>[^\s.]+)\s+before\s+(?P<tt>[^\s.]+)\.(?P<tr>[^\s.]+)$"
     _re_relation_precedence_rule_compiled: re.Pattern[str] = re.compile(_re_relation_precedence_rule)
 
     author: Optional[str] = None
@@ -1607,14 +1628,15 @@
     repo: List[ModuleRepoInfo] = []
     downloadpath: Optional[str] = None
     install_mode: InstallMode = InstallMode.release
     requires: List[str] = []
     relation_precedence_policy: List[constr(strip_whitespace=True, regex=_re_relation_precedence_rule, min_length=1)] = []
     strict_deps_check: bool = True
     agent_install_dependency_modules: bool = False
+    pip: ProjectPipConfig = ProjectPipConfig()
 
     @validator("modulepath", pre=True)
     @classmethod
     def modulepath_to_list(cls, v: object) -> object:
         return cls.to_list(v)
 
     @validator("repo", pre=True)
@@ -1623,27 +1645,37 @@
         v_as_list = cls.to_list(v)
         result = []
         for elem in v_as_list:
             if isinstance(elem, str):
                 # Ensure backward compatibility with the version of Inmanta that didn't have support for the type field.
                 result.append({"url": elem, "type": ModuleRepoType.git})
             elif isinstance(elem, dict):
+                if elem["type"] == ModuleRepoType.package.value:
+                    LOGGER.warning(
+                        "Setting a pip index through the `repo -> url` option with type `package` in the project.yml file "
+                        "is deprecated. Please set the pip index url through the `pip -> index_urls` option instead."
+                    )
                 result.append(elem)
             else:
                 raise ValueError(f"Value should be either a string of a dict, got {elem}")
         return result
 
     def get_relation_precedence_rules(self) -> List[RelationPrecedenceRule]:
         """
         Return all RelationPrecedenceRules defined in the project.yml file.
         """
         return [RelationPrecedenceRule.from_string(rule_as_str) for rule_as_str in self.relation_precedence_policy]
 
     def get_index_urls(self) -> List[str]:
-        return [repo.url for repo in self.repo if repo.type == ModuleRepoType.package]
+        # Once setting repos with type package is no longer supported, this method can return self.pip.index_urls alone.
+        index_urls_deprecated_option: List[str] = [repo.url for repo in self.repo if repo.type == ModuleRepoType.package]
+
+        # This ensures no duplicates are returned and insertion order is preserved.
+        # i.e. the left-most index will be passed to pip as --index-url and the others as --extra-index-url
+        return list({value: None for value in itertools.chain(self.pip.index_urls, index_urls_deprecated_option)})
 
 
 @stable_api
 class ModuleLike(ABC, Generic[TMetadata]):
     """
     Commons superclass for projects and modules, which are both versioned by git
 
@@ -2058,14 +2090,15 @@
         if len(pyreq) > 0:
             # upgrade both direct and transitive module dependencies: eager upgrade strategy
             self.virtualenv.install_from_index(
                 pyreq,
                 upgrade=update_dependencies,
                 index_urls=indexes_urls if indexes_urls else None,
                 upgrade_strategy=env.PipUpgradeStrategy.EAGER,
+                use_pip_config=self.metadata.pip.use_config_file,
             )
 
         self.verify()
 
     def load(self, install: bool = False) -> None:
         """
         Load this project's AST and plugins.
@@ -2353,15 +2386,14 @@
         """
         if not self.is_using_virtual_env():
             self.use_virtual_env()
         reqs: Mapping[str, List[InmantaModuleRequirement]] = self.collect_requirements()
         module_reqs: List[InmantaModuleRequirement] = (
             list(reqs[module_name]) if module_name in reqs else [InmantaModuleRequirement.parse(module_name)]
         )
-
         module: Optional[Union[ModuleV1, ModuleV2]]
         try:
             module = self.module_source.get_module(self, module_reqs, install=install_v2)
             if module is not None and self.module_source_v1.path_for(module_name) is not None:
                 LOGGER.warning("Module %s is installed as a V1 module and a V2 module: V1 will be ignored.", module_name)
             if module is None and allow_v1:
                 module = self.module_source_v1.get_module(self, module_reqs, install=install_v1)
@@ -2671,15 +2703,15 @@
         super().__init__(tempfile.gettempdir(), autostd=autostd, attach_cf_cache=False)
 
     def _get_metadata_from_disk(self) -> ProjectMetadata:
         return ProjectMetadata(name="DUMMY")
 
 
 @stable_api
-class ModuleGeneration(enum.Enum):
+class ModuleGeneration(Enum):
     """
     The generation of a module. This might affect the on-disk structure of a module as well as how it's distributed.
     """
 
     V1: int = 1
     V2: int = 2
```

### Comparing `inmanta-core-8.3.0/src/inmanta/moduletool.py` & `inmanta-core-9.3.0/src/inmanta/moduletool.py`

 * *Files 2% similar despite different names*

```diff
@@ -32,22 +32,22 @@
 import time
 import zipfile
 from argparse import ArgumentParser, RawTextHelpFormatter
 from collections import abc
 from configparser import ConfigParser
 from functools import total_ordering
 from types import TracebackType
-from typing import TYPE_CHECKING, Any, Dict, List, Optional, Pattern, Sequence, Set, Type
+from typing import TYPE_CHECKING, Any, Dict, List, Optional, Pattern, Set, Type
 
 import click
 import more_itertools
 import texttable
 import yaml
 from cookiecutter.main import cookiecutter
-from pkg_resources import parse_version
+from pkg_resources import Requirement, parse_version
 
 import build
 import build.env
 import inmanta
 import inmanta.warnings
 import toml
 from build.env import IsolatedEnvBuilder
@@ -74,16 +74,14 @@
     Project,
     gitprovider,
 )
 from inmanta.stable_api import stable_api
 from packaging.version import Version
 
 if TYPE_CHECKING:
-    from pkg_resources import Requirement  # noqa: F401
-
     from packaging.requirements import InvalidRequirement
 else:
     from pkg_resources.extern.packaging.requirements import InvalidRequirement
 
 LOGGER = logging.getLogger(__name__)
 
 
@@ -104,25 +102,25 @@
         "--no-strict-deps-check",
         dest="no_strict_deps_check",
         action="store_true",
         default=False,
         help=(
             "When this option is enabled, only version conflicts in the direct dependencies will result in an error. "
             "All other version conflicts will result in a warning. This option is mutually exclusive with the "
-            "--strict-deps-check option."
+            "\--strict-deps-check option."  # noqa: W605
         ),
     )
     parser.add_argument(
         "--strict-deps-check",
         dest="strict_deps_check",
         action="store_true",
         default=False,
         help=(
             "When this option is enabled, a version conflict in any (transitive) dependency will results in an error. "
-            "This option is mutually exclusive with the --no-strict-deps-check option."
+            "This option is mutually exclusive with the \--no-strict-deps-check option."  # noqa: W605
         ),
     )
 
 
 def get_strict_deps_check(no_strict_deps_check: bool, strict_deps_check: bool) -> Optional[bool]:
     """
     Perform input validation on the --no-strict-deps-check and --strict-deps-check options and
@@ -330,17 +328,18 @@
         release_part_str = ".".join(str(number) for number in release_part_version_number)
         version_tag_str = f".{version_tag.lstrip('.')}" if version_tag else ""
         return Version(f"{release_part_str}{version_tag_str}")
 
 
 class ProjectTool(ModuleLikeTool):
     @classmethod
-    def parser_config(cls, parser: ArgumentParser) -> None:
+    def parser_config(cls, parser: ArgumentParser, parent_parsers: abc.Sequence[ArgumentParser]) -> None:
         subparser = parser.add_subparsers(title="subcommand", dest="cmd")
-        freeze = subparser.add_parser("freeze", help="Set all version numbers in project.yml")
+
+        freeze = subparser.add_parser("freeze", help="Set all version numbers in project.yml", parents=parent_parsers)
         freeze.add_argument(
             "-o",
             "--outfile",
             help="File in which to put the new project.yml, default is the existing project.yml. Use - to write to stdout.",
             default=None,
         )
         freeze.add_argument(
@@ -354,15 +353,15 @@
         freeze.add_argument(
             "--operator",
             help="Comparison operator used to freeze versions, If not set, the freeze_operator option in"
             " project.yml is used which defaults to ~=",
             choices=[o.value for o in FreezeOperator],
             default=None,
         )
-        init = subparser.add_parser("init", help="Initialize directory structure for a project")
+        init = subparser.add_parser("init", help="Initialize directory structure for a project", parents=parent_parsers)
         init.add_argument("--name", "-n", help="The name of the new project", required=True)
         init.add_argument("--output-dir", "-o", help="Output directory path", default="./")
         init.add_argument(
             "--default", help="Use default parameters for the project generation", action="store_true", default=False
         )
         install = subparser.add_parser(
             "install",
@@ -373,14 +372,15 @@
 This command installs missing modules in the development venv, but doesn't update already installed modules if that's not
 required to satisfy the module version constraints. Use `inmanta project update` instead if the already installed modules need
 to be updated to the latest compatible version.
 
 This command might reinstall Python packages in the development venv if the currently installed versions are not compatible
 with the dependencies specified by the different Inmanta modules.
         """.strip(),
+            parents=parent_parsers,
         )
         add_deps_check_arguments(install)
 
         update = subparser.add_parser(
             "update",
             help=(
                 "Update all modules to the latest version compatible with the module version constraints and install missing "
@@ -388,14 +388,15 @@
             ),
             description="""
 Update all modules to the latest version compatible with the module version constraints and install missing modules.
 
 This command might reinstall Python packages in the development venv if the currently installed versions are not the latest
 compatible with the dependencies specified by the updated modules.
             """.strip(),
+            parents=parent_parsers,
         )
         add_deps_check_arguments(update)
 
     def freeze(self, outfile: Optional[str], recursive: Optional[bool], operator: Optional[str]) -> None:
         """
         !!! Big Side-effect !!! sets yaml parser to be order preserving
         """
@@ -484,14 +485,15 @@
                 # Because for pip not every valid -r is a valid -c
                 current_requires = my_project.get_strict_python_requirements_as_list()
                 env.process_env.install_from_index(
                     v2_python_specs + [Requirement.parse(r) for r in current_requires],
                     my_project.module_source.urls,
                     upgrade=True,
                     allow_pre_releases=my_project.install_mode != InstallMode.release,
+                    use_pip_config=my_project.metadata.pip.use_config_file,
                 )
 
             for v1_module in set(modules).difference(v2_modules):
                 spec = specs.get(v1_module, [])
                 try:
                     ModuleV1.update(my_project, v1_module, spec, install_mode=my_project.install_mode)
                 except Exception:
@@ -552,46 +554,55 @@
     A tool to manage configuration modules
     """
 
     def __init__(self) -> None:
         self._mod_handled_list = set()
 
     @classmethod
-    def modules_parser_config(cls, parser: ArgumentParser) -> None:
+    def modules_parser_config(cls, parser: ArgumentParser, parent_parsers: abc.Sequence[ArgumentParser]) -> None:
         parser.add_argument("-m", "--module", help="Module to apply this command to", nargs="?", default=None)
-
         subparser = parser.add_subparsers(title="subcommand", dest="cmd")
 
         add_help_msg = "Add a module dependency to an Inmanta module or project."
         add = subparser.add_parser(
             "add",
             help=add_help_msg,
             description=f"{add_help_msg} When executed on a project, the module is installed as well. "
-            f"Either --v1 or --v2 has to be set.",
+            f"Either \--v1 or \--v2 has to be set.",  # noqa: W605
+            parents=parent_parsers,
         )
         add.add_argument(
             "module_req",
             help="The name of the module, optionally with a version constraint.",
         )
         add.add_argument("--v1", dest="v1", help="Add the given module as a v1 module", action="store_true")
         add.add_argument("--v2", dest="v2", help="Add the given module as a V2 module", action="store_true")
         add.add_argument(
             "--override",
             dest="override",
             help="Override the version constraint when the given module dependency already exists.",
             action="store_true",
         )
 
-        subparser.add_parser("list", help="List all modules used in this project in a table")
+        subparser.add_parser(
+            "list",
+            help="List all modules used in this project in a table",
+            parents=parent_parsers,
+        )
 
-        do = subparser.add_parser("do", help="Execute a command on all loaded modules")
-        do.add_argument("command", metavar="command", help="the command to  execute")
+        do = subparser.add_parser(
+            "do",
+            help="Execute a command on all loaded modules",
+            parents=parent_parsers,
+        )
+        do.add_argument("command", metavar="command", help="the command to execute")
 
         install: ArgumentParser = subparser.add_parser(
             "install",
+            parents=parent_parsers,
             help="Install a module in the active Python environment.",
             description="""
 Install a module in the active Python environment. Only works for v2 modules: v1 modules can only be installed in the context
 of a project.
 
 This command might reinstall Python packages in the development venv if the currently installed versions are not compatible
 with the dependencies specified by the installed module.
@@ -599,20 +610,32 @@
 Like `pip install`, this command does not reinstall a module for which the same version is already installed, except in editable
 mode.
         """.strip(),
         )
         install.add_argument("-e", "--editable", action="store_true", help="Install in editable mode.")
         install.add_argument("path", nargs="?", help="The path to the module.")
 
-        subparser.add_parser("status", help="Run a git status on all modules and report")
+        subparser.add_parser(
+            "status",
+            help="Run a git status on all modules and report",
+            parents=parent_parsers,
+        )
 
-        subparser.add_parser("push", help="Run a git push on all modules and report")
+        subparser.add_parser(
+            "push",
+            help="Run a git push on all modules and report",
+            parents=parent_parsers,
+        )
 
         # not currently working
-        subparser.add_parser("verify", help="Verify dependencies and frozen module versions")
+        subparser.add_parser(
+            "verify",
+            help="Verify dependencies and frozen module versions",
+            parents=parent_parsers,
+        )
 
         commit = subparser.add_parser("commit", help="Commit all changes in the current module.")
         commit.add_argument("-m", "--message", help="Commit message", required=True)
         commit.add_argument("-r", "--release", dest="dev", help="make a release", action="store_false")
         commit.add_argument("--major", dest="major", help="make a major release", action="store_true")
         commit.add_argument("--minor", dest="minor", help="make a major release", action="store_true")
         commit.add_argument("--patch", dest="patch", help="make a major release", action="store_true")
@@ -625,21 +648,30 @@
             help="Create a tag for the commit."
             "Tags are not created for dev releases by default, if you want to tag it, specify this flag explicitly",
             action="store_true",
         )
         commit.add_argument("-n", "--no-tag", dest="tag", help="Don't create a tag for the commit", action="store_false")
         commit.set_defaults(tag=False)
 
-        create = subparser.add_parser("create", help="Create a new module")
+        create = subparser.add_parser(
+            "create",
+            help="Create a new module",
+            parents=parent_parsers,
+        )
         create.add_argument("name", help="The name of the module")
         create.add_argument(
             "--v1", dest="v1", help="Create a v1 module. By default a v2 module is created.", action="store_true"
         )
 
-        freeze = subparser.add_parser("freeze", help="Set all version numbers in module.yml")
+        freeze = subparser.add_parser(
+            "freeze",
+            help="Freeze all version numbers in module.yml. This command is only supported on v1 modules. On v2 modules use"
+            " the pip freeze command instead.",
+            parents=parent_parsers,
+        )
         freeze.add_argument(
             "-o",
             "--outfile",
             help="File in which to put the new module.yml, default is the existing module.yml. Use - to write to stdout.",
             default=None,
         )
         freeze.add_argument(
@@ -654,15 +686,19 @@
             "--operator",
             help="Comparison operator used to freeze versions, If not set, the freeze_operator option in"
             " module.yml is used which defaults to ~=",
             choices=[o.value for o in FreezeOperator],
             default=None,
         )
 
-        build = subparser.add_parser("build", help="Build a Python package from a V2 module.")
+        build = subparser.add_parser(
+            "build",
+            help="Build a Python package from a V2 module.",
+            parents=parent_parsers,
+        )
         build.add_argument(
             "path",
             help="The path to the module that should be built. By default, the current working directory is used.",
             nargs="?",
         )
         build.add_argument(
             "-o",
@@ -684,32 +720,40 @@
             "--byte-code",
             help="Produce a module wheel that contains only python bytecode for the plugins.",
             action="store_true",
             default=False,
             dest="byte_code",
         )
 
-        subparser.add_parser("v1tov2", help="Convert a V1 module to a V2 module in place")
+        subparser.add_parser(
+            "v1tov2",
+            help="Convert a V1 module to a V2 module in place",
+            parents=parent_parsers,
+        )
 
         release = subparser.add_parser(
             "release",
+            parents=parent_parsers,
             help="Release a new stable or dev release for this module.",
             description="""
 When a stable release is done, this command:
+
 * Does a commit that changes the current version to a stable version.
 * Adds Git release tag.
 * Does a commit that changes the current version to a development version that is one patch increment ahead of the released
   version.
-When a development release is done using the --dev option, this command:
+
+When a development release is done using the \--dev option, this command:
+
 * Does a commit that updates the current version of the module to a development version that is a patch, minor or major version
-  ahead of the previous stable release. The size of the increment is determined by the --revision, --patch, --minor or
-  --major argument (--patch is the default). When a CHANGELOG.md file is present in the root of the module
+  ahead of the previous stable release. The size of the increment is determined by the \--revision, \--patch, \--minor or
+  \--major argument (\--patch is the default). When a CHANGELOG.md file is present in the root of the module
   directory then the version number in the changelog is also updated accordingly. The changelog file is always populated with
   the associated stable version and not a development version.
-            """.strip(),
+            """.strip(),  # noqa: W605
             formatter_class=RawTextHelpFormatter,
         )
         release.add_argument(
             "--dev",
             dest="dev",
             help="Create a development version. The new version number will have the .dev0 build tag.",
             action="store_true",
@@ -930,15 +974,15 @@
             return "yes" if b else "no"
 
         table = []
 
         project = Project.get()
         project.get_complete_ast()
 
-        names: Sequence[str] = sorted(project.modules.keys())
+        names: abc.Sequence[str] = sorted(project.modules.keys())
         specs: Dict[str, List[InmantaModuleRequirement]] = project.collect_imported_requirements()
         for name in names:
             mod: Module = Project.get().modules[name]
             version = str(mod.version)
             if name not in specs:
                 specs[name] = []
 
@@ -1068,14 +1112,19 @@
         if not dev or tag:
             gitprovider.tag(module._path, str(outversion))
 
     def freeze(self, outfile: Optional[str], recursive: Optional[bool], operator: str, module: Optional[str] = None) -> None:
         """
         !!! Big Side-effect !!! sets yaml parser to be order preserving
         """
+        if (module and ModuleV2.from_path(module)) or ModuleV2.from_path(os.curdir):
+            raise CLIException(
+                "The `inmanta module freeze` command is not supported on V2 modules. Use the `pip freeze` command instead.",
+                exitcode=1,
+            )
 
         # find module
         module_obj = self.get_module(module)
 
         if recursive is None:
             recursive = module_obj.freeze_recursive
 
@@ -1283,14 +1332,15 @@
                 repo=module_dir,
                 message=message if message else f"Release version {module.metadata.get_full_version()}",
                 commit_all=commit_all,
                 add=[module.get_metadata_file_path()] + ([changelog.get_path()] if changelog else []),
                 raise_exc_when_nothing_to_commit=False,
             )
             gitprovider.tag(repo=module_dir, tag=str(release_tag))
+            print(f"Tag created successfully: {release_tag}")
             # bump to the next dev version
             self.release(dev=True, message="Bump version to next development version", patch=True)
 
 
 class ModuleChangelog:
     """
     This class represent the changelog file in an Inmanta module.
```

### Comparing `inmanta-core-8.3.0/src/inmanta/parser/__init__.py` & `inmanta-core-9.3.0/src/inmanta/parser/__init__.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/parser/cache.py` & `inmanta-core-9.3.0/src/inmanta/parser/cache.py`

 * *Files 2% similar despite different names*

```diff
@@ -17,15 +17,15 @@
 """
 import logging
 import os
 from typing import List, Optional
 
 from inmanta.ast import Namespace
 from inmanta.ast.statements import Statement
-from inmanta.const import CF_CACHE_DIR
+from inmanta.const import CF_CACHE_DIR, LogLevel
 from inmanta.parser.pickle import ASTPickler, ASTUnpickler
 from inmanta.util import get_compiler_version
 
 LOGGER = logging.getLogger(__name__)
 
 
 class CacheEnvelope:
@@ -109,15 +109,19 @@
                     # mtime is not exactly the same
                     self.misses += 1
                     return None
                 self.hits += 1
                 return result.statements
         except Exception:
             self.failures += 1
-            LOGGER.warning("Compile cache loading failure, ignoring cache entry for %s", filename, exc_info=True)
+            LOGGER.warning(
+                "Compile cache loading failure, ignoring cache entry for %s",
+                filename,
+                exc_info=LOGGER.isEnabledFor(LogLevel.DEBUG.to_int),
+            )
             return None
 
     def cache(self, namespace: Namespace, filename: str, statements: List[Statement]) -> None:
         if not self.cache_enabled.get():
             # cache not enabled
             return
         if not self.is_attached_to_project():
@@ -125,15 +129,19 @@
         try:
             cache_filename = self._get_file_name(namespace, filename)
             mtime = os.path.getmtime(filename)
             cache_entry = CacheEnvelope(mtime, statements)
             with open(cache_filename, "wb") as fh:
                 ASTPickler(fh, protocol=4).dump(cache_entry)
         except Exception:
-            LOGGER.warning("Compile cache failure, failed to cache statements for %s", filename, exc_info=True)
+            LOGGER.warning(
+                "Compile cache failure, failed to cache statements for %s",
+                filename,
+                exc_info=LOGGER.isEnabledFor(LogLevel.DEBUG.to_int),
+            )
 
     def reset_stats(self) -> None:
         self.hits = 0
         self.misses = 0
         self.failures = 0
 
     def log_stats(self) -> None:
```

### Comparing `inmanta-core-8.3.0/src/inmanta/parser/parser.out` & `inmanta-core-9.3.0/src/inmanta/parser/parser.out`

 * *Files 6% similar despite different names*

```diff
@@ -101,210 +101,223 @@
 Rule 96    index -> INDEX class_ref ( id_list )
 Rule 97    expression -> boolean_expression
 Rule 98    expression -> constant
 Rule 99    expression -> function_call
 Rule 100   expression -> var_ref
 Rule 101   expression -> constructor
 Rule 102   expression -> list_def
-Rule 103   expression -> map_def
-Rule 104   expression -> map_lookup
-Rule 105   expression -> index_lookup
-Rule 106   expression -> conditional_expression
-Rule 107   expression -> ( expression )
-Rule 108   boolean_expression -> expression CMP_OP expression
-Rule 109   boolean_expression -> expression IN expression
-Rule 110   boolean_expression -> expression AND expression
-Rule 111   boolean_expression -> expression OR expression
-Rule 112   boolean_expression -> NOT expression
-Rule 113   boolean_expression -> var_ref . ID IS DEFINED
-Rule 114   boolean_expression -> ID IS DEFINED
-Rule 115   boolean_expression -> map_lookup IS DEFINED
-Rule 116   operand -> expression
-Rule 117   map_lookup -> attr_ref [ operand ]
-Rule 118   map_lookup -> var_ref [ operand ]
-Rule 119   map_lookup -> map_lookup [ operand ]
-Rule 120   constructor -> class_ref ( param_list )
-Rule 121   function_call -> ns_ref ( function_param_list )
-Rule 122   function_call -> attr_ref ( function_param_list )
-Rule 123   list_def -> [ operand_list ]
-Rule 124   dict_key -> RSTRING
-Rule 125   dict_key -> STRING
-Rule 126   pair_list -> dict_key : operand , pair_list
-Rule 127   pair_list -> dict_key : operand empty pair_list_empty
-Rule 128   pair_list -> pair_list_empty
-Rule 129   pair_list_empty -> empty
-Rule 130   map_def -> { pair_list }
-Rule 131   index_lookup -> class_ref [ param_list ]
-Rule 132   index_lookup -> attr_ref [ param_list ]
-Rule 133   conditional_expression -> expression ? expression : expression
-Rule 134   constant -> INT
-Rule 135   constant -> FLOAT
-Rule 136   constant -> NULL
-Rule 137   constant -> REGEX
-Rule 138   constant -> TRUE
-Rule 139   constant -> FALSE
-Rule 140   constant -> STRING
-Rule 141   constant -> RSTRING
-Rule 142   constant -> MLS
-Rule 143   constant_list -> [ constants ]
-Rule 144   constants -> constant
-Rule 145   constants -> <empty>
-Rule 146   constants -> constant , constants
-Rule 147   wrapped_kwargs -> * * operand
-Rule 148   param_list_element -> ID = operand
-Rule 149   param_list_element -> wrapped_kwargs
-Rule 150   param_list -> param_list_empty
-Rule 151   param_list_empty -> empty
-Rule 152   param_list -> param_list_element empty param_list_empty
-Rule 153   param_list -> param_list_element , param_list
-Rule 154   function_param_list_element -> param_list_element
-Rule 155   function_param_list_element -> operand
-Rule 156   function_param_list -> function_param_list_empty
-Rule 157   function_param_list_empty -> empty
-Rule 158   function_param_list -> function_param_list_element empty function_param_list_empty
-Rule 159   function_param_list -> function_param_list_element , function_param_list
-Rule 160   operand_list -> operand , operand_list
-Rule 161   operand_list -> operand
-Rule 162   operand_list -> <empty>
-Rule 163   var_ref -> attr_ref
-Rule 164   attr_ref -> var_ref . ID
-Rule 165   var_ref -> ns_ref
-Rule 166   class_ref -> CID
-Rule 167   class_ref -> ns_ref SEP CID
-Rule 168   class_ref -> var_ref . CID
-Rule 169   class_ref_list -> class_ref , class_ref_list
-Rule 170   class_ref_list -> var_ref , class_ref_list
-Rule 171   class_ref_list -> class_ref
-Rule 172   class_ref_list -> var_ref
-Rule 173   ns_ref -> ns_ref SEP ID
-Rule 174   ns_ref -> ID
-Rule 175   id_list -> ID , id_list
-Rule 176   id_list -> ID
+Rule 103   expression -> list_comprehension
+Rule 104   expression -> map_def
+Rule 105   expression -> map_lookup
+Rule 106   expression -> index_lookup
+Rule 107   expression -> conditional_expression
+Rule 108   expression -> ( expression )
+Rule 109   boolean_expression -> expression CMP_OP expression
+Rule 110   boolean_expression -> expression IN expression
+Rule 111   boolean_expression -> expression AND expression
+Rule 112   boolean_expression -> expression OR expression
+Rule 113   boolean_expression -> NOT expression
+Rule 114   boolean_expression -> var_ref . ID IS DEFINED
+Rule 115   boolean_expression -> ID IS DEFINED
+Rule 116   boolean_expression -> map_lookup IS DEFINED
+Rule 117   operand -> expression
+Rule 118   map_lookup -> attr_ref [ operand ]
+Rule 119   map_lookup -> var_ref [ operand ]
+Rule 120   map_lookup -> map_lookup [ operand ]
+Rule 121   constructor -> class_ref ( param_list )
+Rule 122   function_call -> ns_ref ( function_param_list )
+Rule 123   function_call -> attr_ref ( function_param_list )
+Rule 124   list_def -> [ operand_list ]
+Rule 125   list_comprehension -> [ expression list_comprehension_for list_comprehension_guard ]
+Rule 126   list_comprehension_for_empty -> empty
+Rule 127   list_comprehension_for -> FOR ID IN expression list_comprehension_for_empty
+Rule 128   list_comprehension_for -> FOR ID IN expression list_comprehension_for
+Rule 129   list_comprehension_guard -> empty
+Rule 130   list_comprehension_guard -> IF expression list_comprehension_guard
+Rule 131   dict_key -> RSTRING
+Rule 132   dict_key -> STRING
+Rule 133   pair_list -> dict_key : operand , pair_list
+Rule 134   pair_list -> dict_key : operand empty pair_list_empty
+Rule 135   pair_list -> pair_list_empty
+Rule 136   pair_list_empty -> empty
+Rule 137   map_def -> { pair_list }
+Rule 138   index_lookup -> class_ref [ param_list ]
+Rule 139   index_lookup -> attr_ref [ param_list ]
+Rule 140   conditional_expression -> expression ? expression : expression
+Rule 141   constant -> INT
+Rule 142   constant -> FLOAT
+Rule 143   constant -> NULL
+Rule 144   constant -> REGEX
+Rule 145   constant -> TRUE
+Rule 146   constant -> FALSE
+Rule 147   constant -> STRING
+Rule 148   constant -> FSTRING
+Rule 149   constant -> RSTRING
+Rule 150   constant -> MLS
+Rule 151   constant_list -> [ constants ]
+Rule 152   constants -> constant
+Rule 153   constants -> <empty>
+Rule 154   constants -> constant , constants
+Rule 155   wrapped_kwargs -> * * operand
+Rule 156   param_list_element -> ID = operand
+Rule 157   param_list_element -> wrapped_kwargs
+Rule 158   param_list -> param_list_empty
+Rule 159   param_list_empty -> empty
+Rule 160   param_list -> param_list_element empty param_list_empty
+Rule 161   param_list -> param_list_element , param_list
+Rule 162   function_param_list_element -> param_list_element
+Rule 163   function_param_list_element -> operand
+Rule 164   function_param_list -> function_param_list_empty
+Rule 165   function_param_list_empty -> empty
+Rule 166   function_param_list -> function_param_list_element empty function_param_list_empty
+Rule 167   function_param_list -> function_param_list_element , function_param_list
+Rule 168   operand_list -> operand , operand_list
+Rule 169   operand_list -> operand
+Rule 170   operand_list -> <empty>
+Rule 171   var_ref -> attr_ref
+Rule 172   attr_ref -> var_ref . ID
+Rule 173   var_ref -> ns_ref
+Rule 174   class_ref -> CID
+Rule 175   class_ref -> ns_ref SEP CID
+Rule 176   class_ref -> var_ref . CID
+Rule 177   class_ref_list -> class_ref , class_ref_list
+Rule 178   class_ref_list -> var_ref , class_ref_list
+Rule 179   class_ref_list -> class_ref
+Rule 180   class_ref_list -> var_ref
+Rule 181   ns_ref -> ns_ref SEP ID
+Rule 182   ns_ref -> ID
+Rule 183   id_list -> ID , id_list
+Rule 184   id_list -> ID
 
 Terminals, with rules where they appear
 
-(                    : 96 107 120 121 122
-)                    : 96 107 120 121 122
-*                    : 147 147
-,                    : 70 126 146 153 159 160 169 170 175
-.                    : 84 84 85 86 86 87 113 164 168
-:                    : 25 27 29 31 32 33 34 77 78 89 90 91 126 127 133
-=                    : 23 49 50 51 53 54 55 57 58 60 61 63 64 66 67 148
-?                    : 43 44 59 60 61 65 66 67 133
-AND                  : 110
+(                    : 96 108 121 122 123
+)                    : 96 108 121 122 123
+*                    : 155 155
+,                    : 70 133 154 161 167 168 177 178 183
+.                    : 84 84 85 86 86 87 114 172 176
+:                    : 25 27 29 31 32 33 34 77 78 89 90 91 133 134 140
+=                    : 23 49 50 51 53 54 55 57 58 60 61 63 64 66 67 156
+?                    : 43 44 59 60 61 65 66 67 140
+AND                  : 111
 AS                   : 16 94 95
-CID                  : 31 33 48 49 50 51 56 57 58 59 60 61 95 166 167 168
-CMP_OP               : 108
-DEFINED              : 113 114 115
+CID                  : 31 33 48 49 50 51 56 57 58 59 60 61 95 174 175 176
+CMP_OP               : 109
+DEFINED              : 114 115 116
 DICT                 : 56 57 58 59 60 61 62 63 64 65 66 67
 ELIF                 : 30
 ELSE                 : 29
 END                  : 26 35 36 37 38 79
 ENTITY               : 31 32 33 34
 EXTENDS              : 33 34
-FALSE                : 139
-FLOAT                : 135
-FOR                  : 25 75
-ID                   : 16 25 32 34 52 53 54 55 62 63 64 65 66 67 75 80 80 81 81 84 84 85 86 86 87 94 113 114 148 164 173 174 175 176
-IF                   : 26
+FALSE                : 146
+FLOAT                : 142
+FOR                  : 25 75 127 128
+FSTRING              : 148
+ID                   : 16 25 32 34 52 53 54 55 62 63 64 65 66 67 75 80 80 81 81 84 84 85 86 86 87 94 114 115 127 128 156 172 181 182 183 184
+IF                   : 26 130
 IMPLEMENT            : 71 72 73 74
 IMPLEMENTATION       : 75
 IMPORT               : 15 16
-IN                   : 25 109
+IN                   : 25 110 127 128
 INDEX                : 96
-INT                  : 88 89 90 90 91 134
-IS                   : 113 114 115
+INT                  : 88 89 90 90 91 141
+IS                   : 114 115 116
 MATCHING             : 94
-MLS                  : 3 35 38 72 74 78 81 82 93 142
-NOT                  : 112
-NULL                 : 58 61 64 67 136
-OR                   : 111
+MLS                  : 3 35 38 72 74 78 81 82 93 150
+NOT                  : 113
+NULL                 : 58 61 64 67 143
+OR                   : 112
 PARENTS              : 69
 PEQ                  : 24
-REGEX                : 137
+REGEX                : 144
 REL                  : 80 81 84 85
-RSTRING              : 124 141
-SEP                  : 167 173
-STRING               : 125 140
-TRUE                 : 138
+RSTRING              : 131 149
+SEP                  : 175 181
+STRING               : 132 147
+TRUE                 : 145
 TYPEDEF              : 94 95
 UNDEF                : 51 55
 USING                : 71 72 73 74
 WHEN                 : 73 74
-[                    : 42 88 89 90 91 117 118 119 123 131 132 143
-]                    : 42 88 89 90 91 117 118 119 123 131 132 143
+[                    : 42 88 89 90 91 118 119 120 124 125 138 139 151
+]                    : 42 88 89 90 91 118 119 120 124 125 138 139 151
 error                : 
-{                    : 130
-}                    : 130
+{                    : 137
+}                    : 137
 
 Nonterminals, with rules where they appear
 
 assign               : 17
 attr                 : 39 40
 attr_base_type       : 42 44 47
-attr_ref             : 117 122 132 163
+attr_ref             : 118 123 139 171
 attr_type            : 48 49 50 51 52 53 54 55
 attr_type_multi      : 43 46
 attr_type_opt        : 45
 block                : 25 76
 body                 : 1 4
 boolean_expression   : 97
-class_ref            : 71 72 73 74 75 80 80 81 81 84 84 85 85 86 86 87 87 96 120 131 169 171
-class_ref_list       : 33 34 169 170
-conditional_expression : 106
-constant             : 49 53 98 144 146
+class_ref            : 71 72 73 74 75 80 80 81 81 84 84 85 85 86 86 87 87 96 121 138 177 179
+class_ref_list       : 33 34 177 178
+conditional_expression : 107
+constant             : 49 53 98 152 154
 constant_list        : 50 54
-constants            : 143 146
+constants            : 151 154
 constructor          : 95 101
-dict_key             : 126 127
-empty                : 5 22 28 48 56 56 57 58 59 71 73 127 129 151 152 157 158
+dict_key             : 133 134
+empty                : 5 22 28 48 56 56 57 58 59 71 73 126 129 134 136 159 160 165 166
 entity_body          : 35 36 39
 entity_body_outer    : 31 32 33 34
 entity_def           : 6
-expression           : 20 27 73 74 94 107 108 108 109 109 110 110 111 111 112 116 133 133 133
+expression           : 20 27 73 74 94 108 109 109 110 110 111 111 112 112 113 117 125 127 128 130 140 140 140
 for                  : 18
 function_call        : 99
-function_param_list  : 121 122 159
-function_param_list_element : 158 159
-function_param_list_empty : 156 158
+function_param_list  : 122 123 167
+function_param_list_element : 166 167
+function_param_list_empty : 164 166
 head                 : 1
-id_list              : 96 175
+id_list              : 96 183
 if                   : 19
 if_body              : 26 30
 if_next              : 27
 implement_def        : 7
 implement_ns_list    : 70 70 71 72 73 74
 implementation       : 75
 implementation_def   : 8
 implementation_head  : 76
 import               : 13
 index                : 12
-index_lookup         : 105
+index_lookup         : 106
+list_comprehension   : 103
+list_comprehension_for : 125 128
+list_comprehension_for_empty : 127
+list_comprehension_guard : 125 130
 list_def             : 102
 main                 : 0
-map_def              : 57 60 63 66 103
-map_lookup           : 104 115 119
+map_def              : 57 60 63 66 104
+map_lookup           : 105 116 120
 multi                : 80 80 81 81 84 84 85 86 86 87
-ns_ref               : 15 16 41 68 94 121 165 167 173
-operand              : 23 24 25 117 118 119 126 127 147 148 155 160 161
-operand_list         : 86 87 123 160
-pair_list            : 126 130
-pair_list_empty      : 127 128
-param_list           : 120 131 132 153
-param_list_element   : 152 153 154
-param_list_empty     : 150 152
+ns_ref               : 15 16 41 68 94 122 173 175 181
+operand              : 23 24 25 118 119 120 133 134 155 156 163 168 169
+operand_list         : 86 87 124 168
+pair_list            : 133 137
+pair_list_empty      : 134 135
+param_list           : 121 138 139 161
+param_list_element   : 160 161 162
+param_list_empty     : 158 160
 relation             : 9
 relation_def         : 82 83
 statement            : 10 21
 stmt_list            : 21 27 29 79
 top_stmt             : 4
 typedef              : 11
 typedef_inner        : 92 93
-var_ref              : 23 24 100 113 118 164 168 170 172
-wrapped_kwargs       : 149
+var_ref              : 23 24 100 114 119 172 176 178 180
+wrapped_kwargs       : 157
 
 Parsing method: LALR
 
 state 0
 
     (0) S' -> . main
     (1) main -> . head body
@@ -326,14 +339,15 @@
     INT             reduce using rule 2 (head -> .)
     FLOAT           reduce using rule 2 (head -> .)
     NULL            reduce using rule 2 (head -> .)
     REGEX           reduce using rule 2 (head -> .)
     TRUE            reduce using rule 2 (head -> .)
     FALSE           reduce using rule 2 (head -> .)
     STRING          reduce using rule 2 (head -> .)
+    FSTRING         reduce using rule 2 (head -> .)
     RSTRING         reduce using rule 2 (head -> .)
     [               reduce using rule 2 (head -> .)
     {               reduce using rule 2 (head -> .)
     $end            reduce using rule 2 (head -> .)
     MLS             shift and go to state 3
 
   ! MLS             [ reduce using rule 2 (head -> .) ]
@@ -379,96 +393,100 @@
     (19) statement -> . if
     (20) statement -> . expression
     (92) typedef -> . typedef_inner
     (93) typedef -> . typedef_inner MLS
     (96) index -> . INDEX class_ref ( id_list )
     (15) import -> . IMPORT ns_ref
     (16) import -> . IMPORT ns_ref AS ID
-    (166) class_ref -> . CID
-    (167) class_ref -> . ns_ref SEP CID
-    (168) class_ref -> . var_ref . CID
+    (174) class_ref -> . CID
+    (175) class_ref -> . ns_ref SEP CID
+    (176) class_ref -> . var_ref . CID
     (84) relation_def -> . class_ref . ID multi REL class_ref . ID multi
     (85) relation_def -> . class_ref . ID multi REL class_ref
     (86) relation_def -> . class_ref . ID multi operand_list class_ref . ID multi
     (87) relation_def -> . class_ref . ID multi operand_list class_ref
     (23) assign -> . var_ref = operand
     (24) assign -> . var_ref PEQ operand
     (25) for -> . FOR ID IN operand : block
     (26) if -> . IF if_body END
     (97) expression -> . boolean_expression
     (98) expression -> . constant
     (99) expression -> . function_call
     (100) expression -> . var_ref
     (101) expression -> . constructor
     (102) expression -> . list_def
-    (103) expression -> . map_def
-    (104) expression -> . map_lookup
-    (105) expression -> . index_lookup
-    (106) expression -> . conditional_expression
-    (107) expression -> . ( expression )
+    (103) expression -> . list_comprehension
+    (104) expression -> . map_def
+    (105) expression -> . map_lookup
+    (106) expression -> . index_lookup
+    (107) expression -> . conditional_expression
+    (108) expression -> . ( expression )
     (94) typedef_inner -> . TYPEDEF ID AS ns_ref MATCHING expression
     (95) typedef_inner -> . TYPEDEF CID AS constructor
-    (173) ns_ref -> . ns_ref SEP ID
-    (174) ns_ref -> . ID
-    (163) var_ref -> . attr_ref
-    (165) var_ref -> . ns_ref
-    (108) boolean_expression -> . expression CMP_OP expression
-    (109) boolean_expression -> . expression IN expression
-    (110) boolean_expression -> . expression AND expression
-    (111) boolean_expression -> . expression OR expression
-    (112) boolean_expression -> . NOT expression
-    (113) boolean_expression -> . var_ref . ID IS DEFINED
-    (114) boolean_expression -> . ID IS DEFINED
-    (115) boolean_expression -> . map_lookup IS DEFINED
-    (134) constant -> . INT
-    (135) constant -> . FLOAT
-    (136) constant -> . NULL
-    (137) constant -> . REGEX
-    (138) constant -> . TRUE
-    (139) constant -> . FALSE
-    (140) constant -> . STRING
-    (141) constant -> . RSTRING
-    (142) constant -> . MLS
-    (121) function_call -> . ns_ref ( function_param_list )
-    (122) function_call -> . attr_ref ( function_param_list )
-    (120) constructor -> . class_ref ( param_list )
-    (123) list_def -> . [ operand_list ]
-    (130) map_def -> . { pair_list }
-    (117) map_lookup -> . attr_ref [ operand ]
-    (118) map_lookup -> . var_ref [ operand ]
-    (119) map_lookup -> . map_lookup [ operand ]
-    (131) index_lookup -> . class_ref [ param_list ]
-    (132) index_lookup -> . attr_ref [ param_list ]
-    (133) conditional_expression -> . expression ? expression : expression
-    (164) attr_ref -> . var_ref . ID
+    (181) ns_ref -> . ns_ref SEP ID
+    (182) ns_ref -> . ID
+    (171) var_ref -> . attr_ref
+    (173) var_ref -> . ns_ref
+    (109) boolean_expression -> . expression CMP_OP expression
+    (110) boolean_expression -> . expression IN expression
+    (111) boolean_expression -> . expression AND expression
+    (112) boolean_expression -> . expression OR expression
+    (113) boolean_expression -> . NOT expression
+    (114) boolean_expression -> . var_ref . ID IS DEFINED
+    (115) boolean_expression -> . ID IS DEFINED
+    (116) boolean_expression -> . map_lookup IS DEFINED
+    (141) constant -> . INT
+    (142) constant -> . FLOAT
+    (143) constant -> . NULL
+    (144) constant -> . REGEX
+    (145) constant -> . TRUE
+    (146) constant -> . FALSE
+    (147) constant -> . STRING
+    (148) constant -> . FSTRING
+    (149) constant -> . RSTRING
+    (150) constant -> . MLS
+    (122) function_call -> . ns_ref ( function_param_list )
+    (123) function_call -> . attr_ref ( function_param_list )
+    (121) constructor -> . class_ref ( param_list )
+    (124) list_def -> . [ operand_list ]
+    (125) list_comprehension -> . [ expression list_comprehension_for list_comprehension_guard ]
+    (137) map_def -> . { pair_list }
+    (118) map_lookup -> . attr_ref [ operand ]
+    (119) map_lookup -> . var_ref [ operand ]
+    (120) map_lookup -> . map_lookup [ operand ]
+    (138) index_lookup -> . class_ref [ param_list ]
+    (139) index_lookup -> . attr_ref [ param_list ]
+    (140) conditional_expression -> . expression ? expression : expression
+    (172) attr_ref -> . var_ref . ID
 
     $end            reduce using rule 14 (empty -> .)
     ENTITY          shift and go to state 15
     IMPLEMENT       shift and go to state 18
     IMPLEMENTATION  shift and go to state 22
     INDEX           shift and go to state 29
     IMPORT          shift and go to state 31
     CID             shift and go to state 16
     FOR             shift and go to state 23
     IF              shift and go to state 34
     (               shift and go to state 30
-    TYPEDEF         shift and go to state 44
+    TYPEDEF         shift and go to state 45
     ID              shift and go to state 17
-    NOT             shift and go to state 46
-    INT             shift and go to state 47
-    FLOAT           shift and go to state 48
-    NULL            shift and go to state 49
-    REGEX           shift and go to state 50
-    TRUE            shift and go to state 51
-    FALSE           shift and go to state 52
-    STRING          shift and go to state 53
-    RSTRING         shift and go to state 54
+    NOT             shift and go to state 47
+    INT             shift and go to state 48
+    FLOAT           shift and go to state 49
+    NULL            shift and go to state 50
+    REGEX           shift and go to state 51
+    TRUE            shift and go to state 52
+    FALSE           shift and go to state 53
+    STRING          shift and go to state 54
+    FSTRING         shift and go to state 55
+    RSTRING         shift and go to state 56
     MLS             shift and go to state 20
-    [               shift and go to state 55
-    {               shift and go to state 56
+    [               shift and go to state 57
+    {               shift and go to state 58
 
     body                           shift and go to state 4
     top_stmt                       shift and go to state 5
     empty                          shift and go to state 6
     entity_def                     shift and go to state 7
     implement_def                  shift and go to state 8
     implementation_def             shift and go to state 9
@@ -487,19 +505,20 @@
     ns_ref                         shift and go to state 32
     var_ref                        shift and go to state 33
     boolean_expression             shift and go to state 35
     constant                       shift and go to state 36
     function_call                  shift and go to state 37
     constructor                    shift and go to state 38
     list_def                       shift and go to state 39
-    map_def                        shift and go to state 40
-    map_lookup                     shift and go to state 41
-    index_lookup                   shift and go to state 42
-    conditional_expression         shift and go to state 43
-    attr_ref                       shift and go to state 45
+    list_comprehension             shift and go to state 40
+    map_def                        shift and go to state 41
+    map_lookup                     shift and go to state 42
+    index_lookup                   shift and go to state 43
+    conditional_expression         shift and go to state 44
+    attr_ref                       shift and go to state 46
 
 state 3
 
     (3) head -> MLS .
 
     ENTITY          reduce using rule 3 (head -> MLS .)
     IMPLEMENT       reduce using rule 3 (head -> MLS .)
@@ -516,14 +535,15 @@
     INT             reduce using rule 3 (head -> MLS .)
     FLOAT           reduce using rule 3 (head -> MLS .)
     NULL            reduce using rule 3 (head -> MLS .)
     REGEX           reduce using rule 3 (head -> MLS .)
     TRUE            reduce using rule 3 (head -> MLS .)
     FALSE           reduce using rule 3 (head -> MLS .)
     STRING          reduce using rule 3 (head -> MLS .)
+    FSTRING         reduce using rule 3 (head -> MLS .)
     RSTRING         reduce using rule 3 (head -> MLS .)
     MLS             reduce using rule 3 (head -> MLS .)
     [               reduce using rule 3 (head -> MLS .)
     {               reduce using rule 3 (head -> MLS .)
     $end            reduce using rule 3 (head -> MLS .)
 
 
@@ -566,99 +586,103 @@
     (19) statement -> . if
     (20) statement -> . expression
     (92) typedef -> . typedef_inner
     (93) typedef -> . typedef_inner MLS
     (96) index -> . INDEX class_ref ( id_list )
     (15) import -> . IMPORT ns_ref
     (16) import -> . IMPORT ns_ref AS ID
-    (166) class_ref -> . CID
-    (167) class_ref -> . ns_ref SEP CID
-    (168) class_ref -> . var_ref . CID
+    (174) class_ref -> . CID
+    (175) class_ref -> . ns_ref SEP CID
+    (176) class_ref -> . var_ref . CID
     (84) relation_def -> . class_ref . ID multi REL class_ref . ID multi
     (85) relation_def -> . class_ref . ID multi REL class_ref
     (86) relation_def -> . class_ref . ID multi operand_list class_ref . ID multi
     (87) relation_def -> . class_ref . ID multi operand_list class_ref
     (23) assign -> . var_ref = operand
     (24) assign -> . var_ref PEQ operand
     (25) for -> . FOR ID IN operand : block
     (26) if -> . IF if_body END
     (97) expression -> . boolean_expression
     (98) expression -> . constant
     (99) expression -> . function_call
     (100) expression -> . var_ref
     (101) expression -> . constructor
     (102) expression -> . list_def
-    (103) expression -> . map_def
-    (104) expression -> . map_lookup
-    (105) expression -> . index_lookup
-    (106) expression -> . conditional_expression
-    (107) expression -> . ( expression )
+    (103) expression -> . list_comprehension
+    (104) expression -> . map_def
+    (105) expression -> . map_lookup
+    (106) expression -> . index_lookup
+    (107) expression -> . conditional_expression
+    (108) expression -> . ( expression )
     (94) typedef_inner -> . TYPEDEF ID AS ns_ref MATCHING expression
     (95) typedef_inner -> . TYPEDEF CID AS constructor
-    (173) ns_ref -> . ns_ref SEP ID
-    (174) ns_ref -> . ID
-    (163) var_ref -> . attr_ref
-    (165) var_ref -> . ns_ref
-    (108) boolean_expression -> . expression CMP_OP expression
-    (109) boolean_expression -> . expression IN expression
-    (110) boolean_expression -> . expression AND expression
-    (111) boolean_expression -> . expression OR expression
-    (112) boolean_expression -> . NOT expression
-    (113) boolean_expression -> . var_ref . ID IS DEFINED
-    (114) boolean_expression -> . ID IS DEFINED
-    (115) boolean_expression -> . map_lookup IS DEFINED
-    (134) constant -> . INT
-    (135) constant -> . FLOAT
-    (136) constant -> . NULL
-    (137) constant -> . REGEX
-    (138) constant -> . TRUE
-    (139) constant -> . FALSE
-    (140) constant -> . STRING
-    (141) constant -> . RSTRING
-    (142) constant -> . MLS
-    (121) function_call -> . ns_ref ( function_param_list )
-    (122) function_call -> . attr_ref ( function_param_list )
-    (120) constructor -> . class_ref ( param_list )
-    (123) list_def -> . [ operand_list ]
-    (130) map_def -> . { pair_list }
-    (117) map_lookup -> . attr_ref [ operand ]
-    (118) map_lookup -> . var_ref [ operand ]
-    (119) map_lookup -> . map_lookup [ operand ]
-    (131) index_lookup -> . class_ref [ param_list ]
-    (132) index_lookup -> . attr_ref [ param_list ]
-    (133) conditional_expression -> . expression ? expression : expression
-    (164) attr_ref -> . var_ref . ID
+    (181) ns_ref -> . ns_ref SEP ID
+    (182) ns_ref -> . ID
+    (171) var_ref -> . attr_ref
+    (173) var_ref -> . ns_ref
+    (109) boolean_expression -> . expression CMP_OP expression
+    (110) boolean_expression -> . expression IN expression
+    (111) boolean_expression -> . expression AND expression
+    (112) boolean_expression -> . expression OR expression
+    (113) boolean_expression -> . NOT expression
+    (114) boolean_expression -> . var_ref . ID IS DEFINED
+    (115) boolean_expression -> . ID IS DEFINED
+    (116) boolean_expression -> . map_lookup IS DEFINED
+    (141) constant -> . INT
+    (142) constant -> . FLOAT
+    (143) constant -> . NULL
+    (144) constant -> . REGEX
+    (145) constant -> . TRUE
+    (146) constant -> . FALSE
+    (147) constant -> . STRING
+    (148) constant -> . FSTRING
+    (149) constant -> . RSTRING
+    (150) constant -> . MLS
+    (122) function_call -> . ns_ref ( function_param_list )
+    (123) function_call -> . attr_ref ( function_param_list )
+    (121) constructor -> . class_ref ( param_list )
+    (124) list_def -> . [ operand_list ]
+    (125) list_comprehension -> . [ expression list_comprehension_for list_comprehension_guard ]
+    (137) map_def -> . { pair_list }
+    (118) map_lookup -> . attr_ref [ operand ]
+    (119) map_lookup -> . var_ref [ operand ]
+    (120) map_lookup -> . map_lookup [ operand ]
+    (138) index_lookup -> . class_ref [ param_list ]
+    (139) index_lookup -> . attr_ref [ param_list ]
+    (140) conditional_expression -> . expression ? expression : expression
+    (172) attr_ref -> . var_ref . ID
 
     $end            reduce using rule 14 (empty -> .)
     ENTITY          shift and go to state 15
     IMPLEMENT       shift and go to state 18
     IMPLEMENTATION  shift and go to state 22
     INDEX           shift and go to state 29
     IMPORT          shift and go to state 31
     CID             shift and go to state 16
     FOR             shift and go to state 23
     IF              shift and go to state 34
     (               shift and go to state 30
-    TYPEDEF         shift and go to state 44
+    TYPEDEF         shift and go to state 45
     ID              shift and go to state 17
-    NOT             shift and go to state 46
-    INT             shift and go to state 47
-    FLOAT           shift and go to state 48
-    NULL            shift and go to state 49
-    REGEX           shift and go to state 50
-    TRUE            shift and go to state 51
-    FALSE           shift and go to state 52
-    STRING          shift and go to state 53
-    RSTRING         shift and go to state 54
+    NOT             shift and go to state 47
+    INT             shift and go to state 48
+    FLOAT           shift and go to state 49
+    NULL            shift and go to state 50
+    REGEX           shift and go to state 51
+    TRUE            shift and go to state 52
+    FALSE           shift and go to state 53
+    STRING          shift and go to state 54
+    FSTRING         shift and go to state 55
+    RSTRING         shift and go to state 56
     MLS             shift and go to state 20
-    [               shift and go to state 55
-    {               shift and go to state 56
+    [               shift and go to state 57
+    {               shift and go to state 58
 
     top_stmt                       shift and go to state 5
-    body                           shift and go to state 57
+    body                           shift and go to state 59
     empty                          shift and go to state 6
     entity_def                     shift and go to state 7
     implement_def                  shift and go to state 8
     implementation_def             shift and go to state 9
     relation                       shift and go to state 10
     statement                      shift and go to state 11
     typedef                        shift and go to state 12
@@ -674,19 +698,20 @@
     ns_ref                         shift and go to state 32
     var_ref                        shift and go to state 33
     boolean_expression             shift and go to state 35
     constant                       shift and go to state 36
     function_call                  shift and go to state 37
     constructor                    shift and go to state 38
     list_def                       shift and go to state 39
-    map_def                        shift and go to state 40
-    map_lookup                     shift and go to state 41
-    index_lookup                   shift and go to state 42
-    conditional_expression         shift and go to state 43
-    attr_ref                       shift and go to state 45
+    list_comprehension             shift and go to state 40
+    map_def                        shift and go to state 41
+    map_lookup                     shift and go to state 42
+    index_lookup                   shift and go to state 43
+    conditional_expression         shift and go to state 44
+    attr_ref                       shift and go to state 46
 
 state 6
 
     (5) body -> empty .
 
     $end            reduce using rule 5 (body -> empty .)
 
@@ -710,14 +735,15 @@
     INT             reduce using rule 6 (top_stmt -> entity_def .)
     FLOAT           reduce using rule 6 (top_stmt -> entity_def .)
     NULL            reduce using rule 6 (top_stmt -> entity_def .)
     REGEX           reduce using rule 6 (top_stmt -> entity_def .)
     TRUE            reduce using rule 6 (top_stmt -> entity_def .)
     FALSE           reduce using rule 6 (top_stmt -> entity_def .)
     STRING          reduce using rule 6 (top_stmt -> entity_def .)
+    FSTRING         reduce using rule 6 (top_stmt -> entity_def .)
     RSTRING         reduce using rule 6 (top_stmt -> entity_def .)
     MLS             reduce using rule 6 (top_stmt -> entity_def .)
     [               reduce using rule 6 (top_stmt -> entity_def .)
     {               reduce using rule 6 (top_stmt -> entity_def .)
     $end            reduce using rule 6 (top_stmt -> entity_def .)
 
 
@@ -740,14 +766,15 @@
     INT             reduce using rule 7 (top_stmt -> implement_def .)
     FLOAT           reduce using rule 7 (top_stmt -> implement_def .)
     NULL            reduce using rule 7 (top_stmt -> implement_def .)
     REGEX           reduce using rule 7 (top_stmt -> implement_def .)
     TRUE            reduce using rule 7 (top_stmt -> implement_def .)
     FALSE           reduce using rule 7 (top_stmt -> implement_def .)
     STRING          reduce using rule 7 (top_stmt -> implement_def .)
+    FSTRING         reduce using rule 7 (top_stmt -> implement_def .)
     RSTRING         reduce using rule 7 (top_stmt -> implement_def .)
     MLS             reduce using rule 7 (top_stmt -> implement_def .)
     [               reduce using rule 7 (top_stmt -> implement_def .)
     {               reduce using rule 7 (top_stmt -> implement_def .)
     $end            reduce using rule 7 (top_stmt -> implement_def .)
 
 
@@ -770,14 +797,15 @@
     INT             reduce using rule 8 (top_stmt -> implementation_def .)
     FLOAT           reduce using rule 8 (top_stmt -> implementation_def .)
     NULL            reduce using rule 8 (top_stmt -> implementation_def .)
     REGEX           reduce using rule 8 (top_stmt -> implementation_def .)
     TRUE            reduce using rule 8 (top_stmt -> implementation_def .)
     FALSE           reduce using rule 8 (top_stmt -> implementation_def .)
     STRING          reduce using rule 8 (top_stmt -> implementation_def .)
+    FSTRING         reduce using rule 8 (top_stmt -> implementation_def .)
     RSTRING         reduce using rule 8 (top_stmt -> implementation_def .)
     MLS             reduce using rule 8 (top_stmt -> implementation_def .)
     [               reduce using rule 8 (top_stmt -> implementation_def .)
     {               reduce using rule 8 (top_stmt -> implementation_def .)
     $end            reduce using rule 8 (top_stmt -> implementation_def .)
 
 
@@ -800,14 +828,15 @@
     INT             reduce using rule 9 (top_stmt -> relation .)
     FLOAT           reduce using rule 9 (top_stmt -> relation .)
     NULL            reduce using rule 9 (top_stmt -> relation .)
     REGEX           reduce using rule 9 (top_stmt -> relation .)
     TRUE            reduce using rule 9 (top_stmt -> relation .)
     FALSE           reduce using rule 9 (top_stmt -> relation .)
     STRING          reduce using rule 9 (top_stmt -> relation .)
+    FSTRING         reduce using rule 9 (top_stmt -> relation .)
     RSTRING         reduce using rule 9 (top_stmt -> relation .)
     MLS             reduce using rule 9 (top_stmt -> relation .)
     [               reduce using rule 9 (top_stmt -> relation .)
     {               reduce using rule 9 (top_stmt -> relation .)
     $end            reduce using rule 9 (top_stmt -> relation .)
 
 
@@ -830,14 +859,15 @@
     INT             reduce using rule 10 (top_stmt -> statement .)
     FLOAT           reduce using rule 10 (top_stmt -> statement .)
     NULL            reduce using rule 10 (top_stmt -> statement .)
     REGEX           reduce using rule 10 (top_stmt -> statement .)
     TRUE            reduce using rule 10 (top_stmt -> statement .)
     FALSE           reduce using rule 10 (top_stmt -> statement .)
     STRING          reduce using rule 10 (top_stmt -> statement .)
+    FSTRING         reduce using rule 10 (top_stmt -> statement .)
     RSTRING         reduce using rule 10 (top_stmt -> statement .)
     MLS             reduce using rule 10 (top_stmt -> statement .)
     [               reduce using rule 10 (top_stmt -> statement .)
     {               reduce using rule 10 (top_stmt -> statement .)
     $end            reduce using rule 10 (top_stmt -> statement .)
 
 
@@ -860,14 +890,15 @@
     INT             reduce using rule 11 (top_stmt -> typedef .)
     FLOAT           reduce using rule 11 (top_stmt -> typedef .)
     NULL            reduce using rule 11 (top_stmt -> typedef .)
     REGEX           reduce using rule 11 (top_stmt -> typedef .)
     TRUE            reduce using rule 11 (top_stmt -> typedef .)
     FALSE           reduce using rule 11 (top_stmt -> typedef .)
     STRING          reduce using rule 11 (top_stmt -> typedef .)
+    FSTRING         reduce using rule 11 (top_stmt -> typedef .)
     RSTRING         reduce using rule 11 (top_stmt -> typedef .)
     MLS             reduce using rule 11 (top_stmt -> typedef .)
     [               reduce using rule 11 (top_stmt -> typedef .)
     {               reduce using rule 11 (top_stmt -> typedef .)
     $end            reduce using rule 11 (top_stmt -> typedef .)
 
 
@@ -890,14 +921,15 @@
     INT             reduce using rule 12 (top_stmt -> index .)
     FLOAT           reduce using rule 12 (top_stmt -> index .)
     NULL            reduce using rule 12 (top_stmt -> index .)
     REGEX           reduce using rule 12 (top_stmt -> index .)
     TRUE            reduce using rule 12 (top_stmt -> index .)
     FALSE           reduce using rule 12 (top_stmt -> index .)
     STRING          reduce using rule 12 (top_stmt -> index .)
+    FSTRING         reduce using rule 12 (top_stmt -> index .)
     RSTRING         reduce using rule 12 (top_stmt -> index .)
     MLS             reduce using rule 12 (top_stmt -> index .)
     [               reduce using rule 12 (top_stmt -> index .)
     {               reduce using rule 12 (top_stmt -> index .)
     $end            reduce using rule 12 (top_stmt -> index .)
 
 
@@ -920,199 +952,203 @@
     INT             reduce using rule 13 (top_stmt -> import .)
     FLOAT           reduce using rule 13 (top_stmt -> import .)
     NULL            reduce using rule 13 (top_stmt -> import .)
     REGEX           reduce using rule 13 (top_stmt -> import .)
     TRUE            reduce using rule 13 (top_stmt -> import .)
     FALSE           reduce using rule 13 (top_stmt -> import .)
     STRING          reduce using rule 13 (top_stmt -> import .)
+    FSTRING         reduce using rule 13 (top_stmt -> import .)
     RSTRING         reduce using rule 13 (top_stmt -> import .)
     MLS             reduce using rule 13 (top_stmt -> import .)
     [               reduce using rule 13 (top_stmt -> import .)
     {               reduce using rule 13 (top_stmt -> import .)
     $end            reduce using rule 13 (top_stmt -> import .)
 
 
 state 15
 
     (31) entity_def -> ENTITY . CID : entity_body_outer
     (32) entity_def -> ENTITY . ID : entity_body_outer
     (33) entity_def -> ENTITY . CID EXTENDS class_ref_list : entity_body_outer
     (34) entity_def -> ENTITY . ID EXTENDS class_ref_list : entity_body_outer
 
-    CID             shift and go to state 58
-    ID              shift and go to state 59
+    CID             shift and go to state 60
+    ID              shift and go to state 61
 
 
 state 16
 
-    (166) class_ref -> CID .
+    (174) class_ref -> CID .
 
-    ID              reduce using rule 166 (class_ref -> CID .)
-    .               reduce using rule 166 (class_ref -> CID .)
-    (               reduce using rule 166 (class_ref -> CID .)
-    [               reduce using rule 166 (class_ref -> CID .)
-    USING           reduce using rule 166 (class_ref -> CID .)
-    ,               reduce using rule 166 (class_ref -> CID .)
-    :               reduce using rule 166 (class_ref -> CID .)
-    MLS             reduce using rule 166 (class_ref -> CID .)
-    ENTITY          reduce using rule 166 (class_ref -> CID .)
-    IMPLEMENT       reduce using rule 166 (class_ref -> CID .)
-    IMPLEMENTATION  reduce using rule 166 (class_ref -> CID .)
-    INDEX           reduce using rule 166 (class_ref -> CID .)
-    IMPORT          reduce using rule 166 (class_ref -> CID .)
-    CID             reduce using rule 166 (class_ref -> CID .)
-    FOR             reduce using rule 166 (class_ref -> CID .)
-    IF              reduce using rule 166 (class_ref -> CID .)
-    TYPEDEF         reduce using rule 166 (class_ref -> CID .)
-    NOT             reduce using rule 166 (class_ref -> CID .)
-    INT             reduce using rule 166 (class_ref -> CID .)
-    FLOAT           reduce using rule 166 (class_ref -> CID .)
-    NULL            reduce using rule 166 (class_ref -> CID .)
-    REGEX           reduce using rule 166 (class_ref -> CID .)
-    TRUE            reduce using rule 166 (class_ref -> CID .)
-    FALSE           reduce using rule 166 (class_ref -> CID .)
-    STRING          reduce using rule 166 (class_ref -> CID .)
-    RSTRING         reduce using rule 166 (class_ref -> CID .)
-    {               reduce using rule 166 (class_ref -> CID .)
-    $end            reduce using rule 166 (class_ref -> CID .)
+    ID              reduce using rule 174 (class_ref -> CID .)
+    .               reduce using rule 174 (class_ref -> CID .)
+    (               reduce using rule 174 (class_ref -> CID .)
+    [               reduce using rule 174 (class_ref -> CID .)
+    USING           reduce using rule 174 (class_ref -> CID .)
+    ,               reduce using rule 174 (class_ref -> CID .)
+    :               reduce using rule 174 (class_ref -> CID .)
+    MLS             reduce using rule 174 (class_ref -> CID .)
+    ENTITY          reduce using rule 174 (class_ref -> CID .)
+    IMPLEMENT       reduce using rule 174 (class_ref -> CID .)
+    IMPLEMENTATION  reduce using rule 174 (class_ref -> CID .)
+    INDEX           reduce using rule 174 (class_ref -> CID .)
+    IMPORT          reduce using rule 174 (class_ref -> CID .)
+    CID             reduce using rule 174 (class_ref -> CID .)
+    FOR             reduce using rule 174 (class_ref -> CID .)
+    IF              reduce using rule 174 (class_ref -> CID .)
+    TYPEDEF         reduce using rule 174 (class_ref -> CID .)
+    NOT             reduce using rule 174 (class_ref -> CID .)
+    INT             reduce using rule 174 (class_ref -> CID .)
+    FLOAT           reduce using rule 174 (class_ref -> CID .)
+    NULL            reduce using rule 174 (class_ref -> CID .)
+    REGEX           reduce using rule 174 (class_ref -> CID .)
+    TRUE            reduce using rule 174 (class_ref -> CID .)
+    FALSE           reduce using rule 174 (class_ref -> CID .)
+    STRING          reduce using rule 174 (class_ref -> CID .)
+    FSTRING         reduce using rule 174 (class_ref -> CID .)
+    RSTRING         reduce using rule 174 (class_ref -> CID .)
+    {               reduce using rule 174 (class_ref -> CID .)
+    $end            reduce using rule 174 (class_ref -> CID .)
 
 
 state 17
 
-    (174) ns_ref -> ID .
-    (114) boolean_expression -> ID . IS DEFINED
+    (182) ns_ref -> ID .
+    (115) boolean_expression -> ID . IS DEFINED
 
-    SEP             reduce using rule 174 (ns_ref -> ID .)
-    (               reduce using rule 174 (ns_ref -> ID .)
-    .               reduce using rule 174 (ns_ref -> ID .)
-    =               reduce using rule 174 (ns_ref -> ID .)
-    PEQ             reduce using rule 174 (ns_ref -> ID .)
-    [               reduce using rule 174 (ns_ref -> ID .)
-    CMP_OP          reduce using rule 174 (ns_ref -> ID .)
-    IN              reduce using rule 174 (ns_ref -> ID .)
-    AND             reduce using rule 174 (ns_ref -> ID .)
-    OR              reduce using rule 174 (ns_ref -> ID .)
-    ?               reduce using rule 174 (ns_ref -> ID .)
-    ENTITY          reduce using rule 174 (ns_ref -> ID .)
-    IMPLEMENT       reduce using rule 174 (ns_ref -> ID .)
-    IMPLEMENTATION  reduce using rule 174 (ns_ref -> ID .)
-    INDEX           reduce using rule 174 (ns_ref -> ID .)
-    IMPORT          reduce using rule 174 (ns_ref -> ID .)
-    CID             reduce using rule 174 (ns_ref -> ID .)
-    FOR             reduce using rule 174 (ns_ref -> ID .)
-    IF              reduce using rule 174 (ns_ref -> ID .)
-    TYPEDEF         reduce using rule 174 (ns_ref -> ID .)
-    ID              reduce using rule 174 (ns_ref -> ID .)
-    NOT             reduce using rule 174 (ns_ref -> ID .)
-    INT             reduce using rule 174 (ns_ref -> ID .)
-    FLOAT           reduce using rule 174 (ns_ref -> ID .)
-    NULL            reduce using rule 174 (ns_ref -> ID .)
-    REGEX           reduce using rule 174 (ns_ref -> ID .)
-    TRUE            reduce using rule 174 (ns_ref -> ID .)
-    FALSE           reduce using rule 174 (ns_ref -> ID .)
-    STRING          reduce using rule 174 (ns_ref -> ID .)
-    RSTRING         reduce using rule 174 (ns_ref -> ID .)
-    MLS             reduce using rule 174 (ns_ref -> ID .)
-    {               reduce using rule 174 (ns_ref -> ID .)
-    $end            reduce using rule 174 (ns_ref -> ID .)
-    IS              shift and go to state 60
+    SEP             reduce using rule 182 (ns_ref -> ID .)
+    (               reduce using rule 182 (ns_ref -> ID .)
+    .               reduce using rule 182 (ns_ref -> ID .)
+    =               reduce using rule 182 (ns_ref -> ID .)
+    PEQ             reduce using rule 182 (ns_ref -> ID .)
+    [               reduce using rule 182 (ns_ref -> ID .)
+    CMP_OP          reduce using rule 182 (ns_ref -> ID .)
+    IN              reduce using rule 182 (ns_ref -> ID .)
+    AND             reduce using rule 182 (ns_ref -> ID .)
+    OR              reduce using rule 182 (ns_ref -> ID .)
+    ?               reduce using rule 182 (ns_ref -> ID .)
+    ENTITY          reduce using rule 182 (ns_ref -> ID .)
+    IMPLEMENT       reduce using rule 182 (ns_ref -> ID .)
+    IMPLEMENTATION  reduce using rule 182 (ns_ref -> ID .)
+    INDEX           reduce using rule 182 (ns_ref -> ID .)
+    IMPORT          reduce using rule 182 (ns_ref -> ID .)
+    CID             reduce using rule 182 (ns_ref -> ID .)
+    FOR             reduce using rule 182 (ns_ref -> ID .)
+    IF              reduce using rule 182 (ns_ref -> ID .)
+    TYPEDEF         reduce using rule 182 (ns_ref -> ID .)
+    ID              reduce using rule 182 (ns_ref -> ID .)
+    NOT             reduce using rule 182 (ns_ref -> ID .)
+    INT             reduce using rule 182 (ns_ref -> ID .)
+    FLOAT           reduce using rule 182 (ns_ref -> ID .)
+    NULL            reduce using rule 182 (ns_ref -> ID .)
+    REGEX           reduce using rule 182 (ns_ref -> ID .)
+    TRUE            reduce using rule 182 (ns_ref -> ID .)
+    FALSE           reduce using rule 182 (ns_ref -> ID .)
+    STRING          reduce using rule 182 (ns_ref -> ID .)
+    FSTRING         reduce using rule 182 (ns_ref -> ID .)
+    RSTRING         reduce using rule 182 (ns_ref -> ID .)
+    MLS             reduce using rule 182 (ns_ref -> ID .)
+    {               reduce using rule 182 (ns_ref -> ID .)
+    $end            reduce using rule 182 (ns_ref -> ID .)
+    IS              shift and go to state 62
 
 
 state 18
 
     (71) implement_def -> IMPLEMENT . class_ref USING implement_ns_list empty
     (72) implement_def -> IMPLEMENT . class_ref USING implement_ns_list MLS
     (73) implement_def -> IMPLEMENT . class_ref USING implement_ns_list WHEN expression empty
     (74) implement_def -> IMPLEMENT . class_ref USING implement_ns_list WHEN expression MLS
-    (166) class_ref -> . CID
-    (167) class_ref -> . ns_ref SEP CID
-    (168) class_ref -> . var_ref . CID
-    (173) ns_ref -> . ns_ref SEP ID
-    (174) ns_ref -> . ID
-    (163) var_ref -> . attr_ref
-    (165) var_ref -> . ns_ref
-    (164) attr_ref -> . var_ref . ID
-
-    CID             shift and go to state 16
-    ID              shift and go to state 64
-
-    class_ref                      shift and go to state 61
-    ns_ref                         shift and go to state 62
-    var_ref                        shift and go to state 63
-    attr_ref                       shift and go to state 65
+    (174) class_ref -> . CID
+    (175) class_ref -> . ns_ref SEP CID
+    (176) class_ref -> . var_ref . CID
+    (181) ns_ref -> . ns_ref SEP ID
+    (182) ns_ref -> . ID
+    (171) var_ref -> . attr_ref
+    (173) var_ref -> . ns_ref
+    (172) attr_ref -> . var_ref . ID
+
+    CID             shift and go to state 16
+    ID              shift and go to state 66
+
+    class_ref                      shift and go to state 63
+    ns_ref                         shift and go to state 64
+    var_ref                        shift and go to state 65
+    attr_ref                       shift and go to state 67
 
 state 19
 
     (80) relation -> class_ref . ID multi REL multi class_ref ID
     (81) relation -> class_ref . ID multi REL multi class_ref ID MLS
     (84) relation_def -> class_ref . . ID multi REL class_ref . ID multi
     (85) relation_def -> class_ref . . ID multi REL class_ref
     (86) relation_def -> class_ref . . ID multi operand_list class_ref . ID multi
     (87) relation_def -> class_ref . . ID multi operand_list class_ref
-    (120) constructor -> class_ref . ( param_list )
-    (131) index_lookup -> class_ref . [ param_list ]
+    (121) constructor -> class_ref . ( param_list )
+    (138) index_lookup -> class_ref . [ param_list ]
 
-    ID              shift and go to state 66
-    .               shift and go to state 67
-    (               shift and go to state 68
-    [               shift and go to state 69
+    ID              shift and go to state 68
+    .               shift and go to state 69
+    (               shift and go to state 70
+    [               shift and go to state 71
 
 
 state 20
 
-    (142) constant -> MLS .
+    (150) constant -> MLS .
 
-    CMP_OP          reduce using rule 142 (constant -> MLS .)
-    IN              reduce using rule 142 (constant -> MLS .)
-    AND             reduce using rule 142 (constant -> MLS .)
-    OR              reduce using rule 142 (constant -> MLS .)
-    ?               reduce using rule 142 (constant -> MLS .)
-    ENTITY          reduce using rule 142 (constant -> MLS .)
-    IMPLEMENT       reduce using rule 142 (constant -> MLS .)
-    IMPLEMENTATION  reduce using rule 142 (constant -> MLS .)
-    INDEX           reduce using rule 142 (constant -> MLS .)
-    IMPORT          reduce using rule 142 (constant -> MLS .)
-    CID             reduce using rule 142 (constant -> MLS .)
-    FOR             reduce using rule 142 (constant -> MLS .)
-    IF              reduce using rule 142 (constant -> MLS .)
-    (               reduce using rule 142 (constant -> MLS .)
-    TYPEDEF         reduce using rule 142 (constant -> MLS .)
-    ID              reduce using rule 142 (constant -> MLS .)
-    NOT             reduce using rule 142 (constant -> MLS .)
-    INT             reduce using rule 142 (constant -> MLS .)
-    FLOAT           reduce using rule 142 (constant -> MLS .)
-    NULL            reduce using rule 142 (constant -> MLS .)
-    REGEX           reduce using rule 142 (constant -> MLS .)
-    TRUE            reduce using rule 142 (constant -> MLS .)
-    FALSE           reduce using rule 142 (constant -> MLS .)
-    STRING          reduce using rule 142 (constant -> MLS .)
-    RSTRING         reduce using rule 142 (constant -> MLS .)
-    MLS             reduce using rule 142 (constant -> MLS .)
-    [               reduce using rule 142 (constant -> MLS .)
-    {               reduce using rule 142 (constant -> MLS .)
-    $end            reduce using rule 142 (constant -> MLS .)
-    )               reduce using rule 142 (constant -> MLS .)
-    :               reduce using rule 142 (constant -> MLS .)
-    ,               reduce using rule 142 (constant -> MLS .)
-    ]               reduce using rule 142 (constant -> MLS .)
-    ELSE            reduce using rule 142 (constant -> MLS .)
-    ELIF            reduce using rule 142 (constant -> MLS .)
-    END             reduce using rule 142 (constant -> MLS .)
-    }               reduce using rule 142 (constant -> MLS .)
-    DICT            reduce using rule 142 (constant -> MLS .)
+    CMP_OP          reduce using rule 150 (constant -> MLS .)
+    IN              reduce using rule 150 (constant -> MLS .)
+    AND             reduce using rule 150 (constant -> MLS .)
+    OR              reduce using rule 150 (constant -> MLS .)
+    ?               reduce using rule 150 (constant -> MLS .)
+    ENTITY          reduce using rule 150 (constant -> MLS .)
+    IMPLEMENT       reduce using rule 150 (constant -> MLS .)
+    IMPLEMENTATION  reduce using rule 150 (constant -> MLS .)
+    INDEX           reduce using rule 150 (constant -> MLS .)
+    IMPORT          reduce using rule 150 (constant -> MLS .)
+    CID             reduce using rule 150 (constant -> MLS .)
+    FOR             reduce using rule 150 (constant -> MLS .)
+    IF              reduce using rule 150 (constant -> MLS .)
+    (               reduce using rule 150 (constant -> MLS .)
+    TYPEDEF         reduce using rule 150 (constant -> MLS .)
+    ID              reduce using rule 150 (constant -> MLS .)
+    NOT             reduce using rule 150 (constant -> MLS .)
+    INT             reduce using rule 150 (constant -> MLS .)
+    FLOAT           reduce using rule 150 (constant -> MLS .)
+    NULL            reduce using rule 150 (constant -> MLS .)
+    REGEX           reduce using rule 150 (constant -> MLS .)
+    TRUE            reduce using rule 150 (constant -> MLS .)
+    FALSE           reduce using rule 150 (constant -> MLS .)
+    STRING          reduce using rule 150 (constant -> MLS .)
+    FSTRING         reduce using rule 150 (constant -> MLS .)
+    RSTRING         reduce using rule 150 (constant -> MLS .)
+    MLS             reduce using rule 150 (constant -> MLS .)
+    [               reduce using rule 150 (constant -> MLS .)
+    {               reduce using rule 150 (constant -> MLS .)
+    $end            reduce using rule 150 (constant -> MLS .)
+    )               reduce using rule 150 (constant -> MLS .)
+    :               reduce using rule 150 (constant -> MLS .)
+    ,               reduce using rule 150 (constant -> MLS .)
+    ]               reduce using rule 150 (constant -> MLS .)
+    ELSE            reduce using rule 150 (constant -> MLS .)
+    ELIF            reduce using rule 150 (constant -> MLS .)
+    END             reduce using rule 150 (constant -> MLS .)
+    }               reduce using rule 150 (constant -> MLS .)
+    DICT            reduce using rule 150 (constant -> MLS .)
 
 
 state 21
 
     (20) statement -> expression .
-    (108) boolean_expression -> expression . CMP_OP expression
-    (109) boolean_expression -> expression . IN expression
-    (110) boolean_expression -> expression . AND expression
-    (111) boolean_expression -> expression . OR expression
-    (133) conditional_expression -> expression . ? expression : expression
+    (109) boolean_expression -> expression . CMP_OP expression
+    (110) boolean_expression -> expression . IN expression
+    (111) boolean_expression -> expression . AND expression
+    (112) boolean_expression -> expression . OR expression
+    (140) conditional_expression -> expression . ? expression : expression
 
     ENTITY          reduce using rule 20 (statement -> expression .)
     IMPLEMENT       reduce using rule 20 (statement -> expression .)
     IMPLEMENTATION  reduce using rule 20 (statement -> expression .)
     INDEX           reduce using rule 20 (statement -> expression .)
     IMPORT          reduce using rule 20 (statement -> expression .)
     CID             reduce using rule 20 (statement -> expression .)
@@ -1125,49 +1161,50 @@
     INT             reduce using rule 20 (statement -> expression .)
     FLOAT           reduce using rule 20 (statement -> expression .)
     NULL            reduce using rule 20 (statement -> expression .)
     REGEX           reduce using rule 20 (statement -> expression .)
     TRUE            reduce using rule 20 (statement -> expression .)
     FALSE           reduce using rule 20 (statement -> expression .)
     STRING          reduce using rule 20 (statement -> expression .)
+    FSTRING         reduce using rule 20 (statement -> expression .)
     RSTRING         reduce using rule 20 (statement -> expression .)
     MLS             reduce using rule 20 (statement -> expression .)
     [               reduce using rule 20 (statement -> expression .)
     {               reduce using rule 20 (statement -> expression .)
     $end            reduce using rule 20 (statement -> expression .)
     ELSE            reduce using rule 20 (statement -> expression .)
     ELIF            reduce using rule 20 (statement -> expression .)
     END             reduce using rule 20 (statement -> expression .)
-    CMP_OP          shift and go to state 70
-    IN              shift and go to state 71
-    AND             shift and go to state 72
-    OR              shift and go to state 73
-    ?               shift and go to state 74
+    CMP_OP          shift and go to state 72
+    IN              shift and go to state 73
+    AND             shift and go to state 74
+    OR              shift and go to state 75
+    ?               shift and go to state 76
 
 
 state 22
 
     (75) implementation_def -> IMPLEMENTATION . ID FOR class_ref implementation
 
-    ID              shift and go to state 75
+    ID              shift and go to state 77
 
 
 state 23
 
     (25) for -> FOR . ID IN operand : block
 
-    ID              shift and go to state 76
+    ID              shift and go to state 78
 
 
 state 24
 
     (82) relation -> relation_def . MLS
     (83) relation -> relation_def .
 
-    MLS             shift and go to state 77
+    MLS             shift and go to state 79
     ENTITY          reduce using rule 83 (relation -> relation_def .)
     IMPLEMENT       reduce using rule 83 (relation -> relation_def .)
     IMPLEMENTATION  reduce using rule 83 (relation -> relation_def .)
     INDEX           reduce using rule 83 (relation -> relation_def .)
     IMPORT          reduce using rule 83 (relation -> relation_def .)
     CID             reduce using rule 83 (relation -> relation_def .)
     FOR             reduce using rule 83 (relation -> relation_def .)
@@ -1179,14 +1216,15 @@
     INT             reduce using rule 83 (relation -> relation_def .)
     FLOAT           reduce using rule 83 (relation -> relation_def .)
     NULL            reduce using rule 83 (relation -> relation_def .)
     REGEX           reduce using rule 83 (relation -> relation_def .)
     TRUE            reduce using rule 83 (relation -> relation_def .)
     FALSE           reduce using rule 83 (relation -> relation_def .)
     STRING          reduce using rule 83 (relation -> relation_def .)
+    FSTRING         reduce using rule 83 (relation -> relation_def .)
     RSTRING         reduce using rule 83 (relation -> relation_def .)
     [               reduce using rule 83 (relation -> relation_def .)
     {               reduce using rule 83 (relation -> relation_def .)
     $end            reduce using rule 83 (relation -> relation_def .)
 
   ! MLS             [ reduce using rule 83 (relation -> relation_def .) ]
 
@@ -1210,14 +1248,15 @@
     INT             reduce using rule 17 (statement -> assign .)
     FLOAT           reduce using rule 17 (statement -> assign .)
     NULL            reduce using rule 17 (statement -> assign .)
     REGEX           reduce using rule 17 (statement -> assign .)
     TRUE            reduce using rule 17 (statement -> assign .)
     FALSE           reduce using rule 17 (statement -> assign .)
     STRING          reduce using rule 17 (statement -> assign .)
+    FSTRING         reduce using rule 17 (statement -> assign .)
     RSTRING         reduce using rule 17 (statement -> assign .)
     MLS             reduce using rule 17 (statement -> assign .)
     [               reduce using rule 17 (statement -> assign .)
     {               reduce using rule 17 (statement -> assign .)
     $end            reduce using rule 17 (statement -> assign .)
     ELSE            reduce using rule 17 (statement -> assign .)
     ELIF            reduce using rule 17 (statement -> assign .)
@@ -1243,14 +1282,15 @@
     INT             reduce using rule 18 (statement -> for .)
     FLOAT           reduce using rule 18 (statement -> for .)
     NULL            reduce using rule 18 (statement -> for .)
     REGEX           reduce using rule 18 (statement -> for .)
     TRUE            reduce using rule 18 (statement -> for .)
     FALSE           reduce using rule 18 (statement -> for .)
     STRING          reduce using rule 18 (statement -> for .)
+    FSTRING         reduce using rule 18 (statement -> for .)
     RSTRING         reduce using rule 18 (statement -> for .)
     MLS             reduce using rule 18 (statement -> for .)
     [               reduce using rule 18 (statement -> for .)
     {               reduce using rule 18 (statement -> for .)
     $end            reduce using rule 18 (statement -> for .)
     ELSE            reduce using rule 18 (statement -> for .)
     ELIF            reduce using rule 18 (statement -> for .)
@@ -1276,14 +1316,15 @@
     INT             reduce using rule 19 (statement -> if .)
     FLOAT           reduce using rule 19 (statement -> if .)
     NULL            reduce using rule 19 (statement -> if .)
     REGEX           reduce using rule 19 (statement -> if .)
     TRUE            reduce using rule 19 (statement -> if .)
     FALSE           reduce using rule 19 (statement -> if .)
     STRING          reduce using rule 19 (statement -> if .)
+    FSTRING         reduce using rule 19 (statement -> if .)
     RSTRING         reduce using rule 19 (statement -> if .)
     MLS             reduce using rule 19 (statement -> if .)
     [               reduce using rule 19 (statement -> if .)
     {               reduce using rule 19 (statement -> if .)
     $end            reduce using rule 19 (statement -> if .)
     ELSE            reduce using rule 19 (statement -> if .)
     ELIF            reduce using rule 19 (statement -> if .)
@@ -1310,193 +1351,200 @@
     INT             reduce using rule 92 (typedef -> typedef_inner .)
     FLOAT           reduce using rule 92 (typedef -> typedef_inner .)
     NULL            reduce using rule 92 (typedef -> typedef_inner .)
     REGEX           reduce using rule 92 (typedef -> typedef_inner .)
     TRUE            reduce using rule 92 (typedef -> typedef_inner .)
     FALSE           reduce using rule 92 (typedef -> typedef_inner .)
     STRING          reduce using rule 92 (typedef -> typedef_inner .)
+    FSTRING         reduce using rule 92 (typedef -> typedef_inner .)
     RSTRING         reduce using rule 92 (typedef -> typedef_inner .)
     [               reduce using rule 92 (typedef -> typedef_inner .)
     {               reduce using rule 92 (typedef -> typedef_inner .)
     $end            reduce using rule 92 (typedef -> typedef_inner .)
-    MLS             shift and go to state 78
+    MLS             shift and go to state 80
 
   ! MLS             [ reduce using rule 92 (typedef -> typedef_inner .) ]
 
 
 state 29
 
     (96) index -> INDEX . class_ref ( id_list )
-    (166) class_ref -> . CID
-    (167) class_ref -> . ns_ref SEP CID
-    (168) class_ref -> . var_ref . CID
-    (173) ns_ref -> . ns_ref SEP ID
-    (174) ns_ref -> . ID
-    (163) var_ref -> . attr_ref
-    (165) var_ref -> . ns_ref
-    (164) attr_ref -> . var_ref . ID
-
-    CID             shift and go to state 16
-    ID              shift and go to state 64
-
-    class_ref                      shift and go to state 79
-    ns_ref                         shift and go to state 62
-    var_ref                        shift and go to state 63
-    attr_ref                       shift and go to state 65
+    (174) class_ref -> . CID
+    (175) class_ref -> . ns_ref SEP CID
+    (176) class_ref -> . var_ref . CID
+    (181) ns_ref -> . ns_ref SEP ID
+    (182) ns_ref -> . ID
+    (171) var_ref -> . attr_ref
+    (173) var_ref -> . ns_ref
+    (172) attr_ref -> . var_ref . ID
+
+    CID             shift and go to state 16
+    ID              shift and go to state 66
+
+    class_ref                      shift and go to state 81
+    ns_ref                         shift and go to state 64
+    var_ref                        shift and go to state 65
+    attr_ref                       shift and go to state 67
 
 state 30
 
-    (107) expression -> ( . expression )
+    (108) expression -> ( . expression )
     (97) expression -> . boolean_expression
     (98) expression -> . constant
     (99) expression -> . function_call
     (100) expression -> . var_ref
     (101) expression -> . constructor
     (102) expression -> . list_def
-    (103) expression -> . map_def
-    (104) expression -> . map_lookup
-    (105) expression -> . index_lookup
-    (106) expression -> . conditional_expression
-    (107) expression -> . ( expression )
-    (108) boolean_expression -> . expression CMP_OP expression
-    (109) boolean_expression -> . expression IN expression
-    (110) boolean_expression -> . expression AND expression
-    (111) boolean_expression -> . expression OR expression
-    (112) boolean_expression -> . NOT expression
-    (113) boolean_expression -> . var_ref . ID IS DEFINED
-    (114) boolean_expression -> . ID IS DEFINED
-    (115) boolean_expression -> . map_lookup IS DEFINED
-    (134) constant -> . INT
-    (135) constant -> . FLOAT
-    (136) constant -> . NULL
-    (137) constant -> . REGEX
-    (138) constant -> . TRUE
-    (139) constant -> . FALSE
-    (140) constant -> . STRING
-    (141) constant -> . RSTRING
-    (142) constant -> . MLS
-    (121) function_call -> . ns_ref ( function_param_list )
-    (122) function_call -> . attr_ref ( function_param_list )
-    (163) var_ref -> . attr_ref
-    (165) var_ref -> . ns_ref
-    (120) constructor -> . class_ref ( param_list )
-    (123) list_def -> . [ operand_list ]
-    (130) map_def -> . { pair_list }
-    (117) map_lookup -> . attr_ref [ operand ]
-    (118) map_lookup -> . var_ref [ operand ]
-    (119) map_lookup -> . map_lookup [ operand ]
-    (131) index_lookup -> . class_ref [ param_list ]
-    (132) index_lookup -> . attr_ref [ param_list ]
-    (133) conditional_expression -> . expression ? expression : expression
-    (173) ns_ref -> . ns_ref SEP ID
-    (174) ns_ref -> . ID
-    (164) attr_ref -> . var_ref . ID
-    (166) class_ref -> . CID
-    (167) class_ref -> . ns_ref SEP CID
-    (168) class_ref -> . var_ref . CID
+    (103) expression -> . list_comprehension
+    (104) expression -> . map_def
+    (105) expression -> . map_lookup
+    (106) expression -> . index_lookup
+    (107) expression -> . conditional_expression
+    (108) expression -> . ( expression )
+    (109) boolean_expression -> . expression CMP_OP expression
+    (110) boolean_expression -> . expression IN expression
+    (111) boolean_expression -> . expression AND expression
+    (112) boolean_expression -> . expression OR expression
+    (113) boolean_expression -> . NOT expression
+    (114) boolean_expression -> . var_ref . ID IS DEFINED
+    (115) boolean_expression -> . ID IS DEFINED
+    (116) boolean_expression -> . map_lookup IS DEFINED
+    (141) constant -> . INT
+    (142) constant -> . FLOAT
+    (143) constant -> . NULL
+    (144) constant -> . REGEX
+    (145) constant -> . TRUE
+    (146) constant -> . FALSE
+    (147) constant -> . STRING
+    (148) constant -> . FSTRING
+    (149) constant -> . RSTRING
+    (150) constant -> . MLS
+    (122) function_call -> . ns_ref ( function_param_list )
+    (123) function_call -> . attr_ref ( function_param_list )
+    (171) var_ref -> . attr_ref
+    (173) var_ref -> . ns_ref
+    (121) constructor -> . class_ref ( param_list )
+    (124) list_def -> . [ operand_list ]
+    (125) list_comprehension -> . [ expression list_comprehension_for list_comprehension_guard ]
+    (137) map_def -> . { pair_list }
+    (118) map_lookup -> . attr_ref [ operand ]
+    (119) map_lookup -> . var_ref [ operand ]
+    (120) map_lookup -> . map_lookup [ operand ]
+    (138) index_lookup -> . class_ref [ param_list ]
+    (139) index_lookup -> . attr_ref [ param_list ]
+    (140) conditional_expression -> . expression ? expression : expression
+    (181) ns_ref -> . ns_ref SEP ID
+    (182) ns_ref -> . ID
+    (172) attr_ref -> . var_ref . ID
+    (174) class_ref -> . CID
+    (175) class_ref -> . ns_ref SEP CID
+    (176) class_ref -> . var_ref . CID
 
     (               shift and go to state 30
-    NOT             shift and go to state 46
-    ID              shift and go to state 82
-    INT             shift and go to state 47
-    FLOAT           shift and go to state 48
-    NULL            shift and go to state 49
-    REGEX           shift and go to state 50
-    TRUE            shift and go to state 51
-    FALSE           shift and go to state 52
-    STRING          shift and go to state 53
-    RSTRING         shift and go to state 54
+    NOT             shift and go to state 47
+    ID              shift and go to state 84
+    INT             shift and go to state 48
+    FLOAT           shift and go to state 49
+    NULL            shift and go to state 50
+    REGEX           shift and go to state 51
+    TRUE            shift and go to state 52
+    FALSE           shift and go to state 53
+    STRING          shift and go to state 54
+    FSTRING         shift and go to state 55
+    RSTRING         shift and go to state 56
     MLS             shift and go to state 20
-    [               shift and go to state 55
-    {               shift and go to state 56
+    [               shift and go to state 57
+    {               shift and go to state 58
     CID             shift and go to state 16
 
-    expression                     shift and go to state 80
+    expression                     shift and go to state 82
     boolean_expression             shift and go to state 35
     constant                       shift and go to state 36
     function_call                  shift and go to state 37
-    var_ref                        shift and go to state 81
+    var_ref                        shift and go to state 83
     constructor                    shift and go to state 38
     list_def                       shift and go to state 39
-    map_def                        shift and go to state 40
-    map_lookup                     shift and go to state 41
-    index_lookup                   shift and go to state 42
-    conditional_expression         shift and go to state 43
-    ns_ref                         shift and go to state 83
-    attr_ref                       shift and go to state 84
-    class_ref                      shift and go to state 85
+    list_comprehension             shift and go to state 40
+    map_def                        shift and go to state 41
+    map_lookup                     shift and go to state 42
+    index_lookup                   shift and go to state 43
+    conditional_expression         shift and go to state 44
+    ns_ref                         shift and go to state 85
+    attr_ref                       shift and go to state 86
+    class_ref                      shift and go to state 87
 
 state 31
 
     (15) import -> IMPORT . ns_ref
     (16) import -> IMPORT . ns_ref AS ID
-    (173) ns_ref -> . ns_ref SEP ID
-    (174) ns_ref -> . ID
+    (181) ns_ref -> . ns_ref SEP ID
+    (182) ns_ref -> . ID
 
-    ID              shift and go to state 64
+    ID              shift and go to state 66
 
-    ns_ref                         shift and go to state 86
+    ns_ref                         shift and go to state 88
 
 state 32
 
-    (167) class_ref -> ns_ref . SEP CID
-    (173) ns_ref -> ns_ref . SEP ID
-    (165) var_ref -> ns_ref .
-    (121) function_call -> ns_ref . ( function_param_list )
-
-    SEP             shift and go to state 87
-    .               reduce using rule 165 (var_ref -> ns_ref .)
-    =               reduce using rule 165 (var_ref -> ns_ref .)
-    PEQ             reduce using rule 165 (var_ref -> ns_ref .)
-    [               reduce using rule 165 (var_ref -> ns_ref .)
-    CMP_OP          reduce using rule 165 (var_ref -> ns_ref .)
-    IN              reduce using rule 165 (var_ref -> ns_ref .)
-    AND             reduce using rule 165 (var_ref -> ns_ref .)
-    OR              reduce using rule 165 (var_ref -> ns_ref .)
-    ?               reduce using rule 165 (var_ref -> ns_ref .)
-    ENTITY          reduce using rule 165 (var_ref -> ns_ref .)
-    IMPLEMENT       reduce using rule 165 (var_ref -> ns_ref .)
-    IMPLEMENTATION  reduce using rule 165 (var_ref -> ns_ref .)
-    INDEX           reduce using rule 165 (var_ref -> ns_ref .)
-    IMPORT          reduce using rule 165 (var_ref -> ns_ref .)
-    CID             reduce using rule 165 (var_ref -> ns_ref .)
-    FOR             reduce using rule 165 (var_ref -> ns_ref .)
-    IF              reduce using rule 165 (var_ref -> ns_ref .)
-    TYPEDEF         reduce using rule 165 (var_ref -> ns_ref .)
-    ID              reduce using rule 165 (var_ref -> ns_ref .)
-    NOT             reduce using rule 165 (var_ref -> ns_ref .)
-    INT             reduce using rule 165 (var_ref -> ns_ref .)
-    FLOAT           reduce using rule 165 (var_ref -> ns_ref .)
-    NULL            reduce using rule 165 (var_ref -> ns_ref .)
-    REGEX           reduce using rule 165 (var_ref -> ns_ref .)
-    TRUE            reduce using rule 165 (var_ref -> ns_ref .)
-    FALSE           reduce using rule 165 (var_ref -> ns_ref .)
-    STRING          reduce using rule 165 (var_ref -> ns_ref .)
-    RSTRING         reduce using rule 165 (var_ref -> ns_ref .)
-    MLS             reduce using rule 165 (var_ref -> ns_ref .)
-    {               reduce using rule 165 (var_ref -> ns_ref .)
-    $end            reduce using rule 165 (var_ref -> ns_ref .)
-    (               shift and go to state 88
+    (175) class_ref -> ns_ref . SEP CID
+    (181) ns_ref -> ns_ref . SEP ID
+    (173) var_ref -> ns_ref .
+    (122) function_call -> ns_ref . ( function_param_list )
+
+    SEP             shift and go to state 89
+    .               reduce using rule 173 (var_ref -> ns_ref .)
+    =               reduce using rule 173 (var_ref -> ns_ref .)
+    PEQ             reduce using rule 173 (var_ref -> ns_ref .)
+    [               reduce using rule 173 (var_ref -> ns_ref .)
+    CMP_OP          reduce using rule 173 (var_ref -> ns_ref .)
+    IN              reduce using rule 173 (var_ref -> ns_ref .)
+    AND             reduce using rule 173 (var_ref -> ns_ref .)
+    OR              reduce using rule 173 (var_ref -> ns_ref .)
+    ?               reduce using rule 173 (var_ref -> ns_ref .)
+    ENTITY          reduce using rule 173 (var_ref -> ns_ref .)
+    IMPLEMENT       reduce using rule 173 (var_ref -> ns_ref .)
+    IMPLEMENTATION  reduce using rule 173 (var_ref -> ns_ref .)
+    INDEX           reduce using rule 173 (var_ref -> ns_ref .)
+    IMPORT          reduce using rule 173 (var_ref -> ns_ref .)
+    CID             reduce using rule 173 (var_ref -> ns_ref .)
+    FOR             reduce using rule 173 (var_ref -> ns_ref .)
+    IF              reduce using rule 173 (var_ref -> ns_ref .)
+    TYPEDEF         reduce using rule 173 (var_ref -> ns_ref .)
+    ID              reduce using rule 173 (var_ref -> ns_ref .)
+    NOT             reduce using rule 173 (var_ref -> ns_ref .)
+    INT             reduce using rule 173 (var_ref -> ns_ref .)
+    FLOAT           reduce using rule 173 (var_ref -> ns_ref .)
+    NULL            reduce using rule 173 (var_ref -> ns_ref .)
+    REGEX           reduce using rule 173 (var_ref -> ns_ref .)
+    TRUE            reduce using rule 173 (var_ref -> ns_ref .)
+    FALSE           reduce using rule 173 (var_ref -> ns_ref .)
+    STRING          reduce using rule 173 (var_ref -> ns_ref .)
+    FSTRING         reduce using rule 173 (var_ref -> ns_ref .)
+    RSTRING         reduce using rule 173 (var_ref -> ns_ref .)
+    MLS             reduce using rule 173 (var_ref -> ns_ref .)
+    {               reduce using rule 173 (var_ref -> ns_ref .)
+    $end            reduce using rule 173 (var_ref -> ns_ref .)
+    (               shift and go to state 90
 
-  ! (               [ reduce using rule 165 (var_ref -> ns_ref .) ]
+  ! (               [ reduce using rule 173 (var_ref -> ns_ref .) ]
 
 
 state 33
 
-    (168) class_ref -> var_ref . . CID
+    (176) class_ref -> var_ref . . CID
     (23) assign -> var_ref . = operand
     (24) assign -> var_ref . PEQ operand
     (100) expression -> var_ref .
-    (113) boolean_expression -> var_ref . . ID IS DEFINED
-    (118) map_lookup -> var_ref . [ operand ]
-    (164) attr_ref -> var_ref . . ID
-
-    .               shift and go to state 89
-    =               shift and go to state 90
-    PEQ             shift and go to state 91
+    (114) boolean_expression -> var_ref . . ID IS DEFINED
+    (119) map_lookup -> var_ref . [ operand ]
+    (172) attr_ref -> var_ref . . ID
+
+    .               shift and go to state 91
+    =               shift and go to state 92
+    PEQ             shift and go to state 93
     CMP_OP          reduce using rule 100 (expression -> var_ref .)
     IN              reduce using rule 100 (expression -> var_ref .)
     AND             reduce using rule 100 (expression -> var_ref .)
     OR              reduce using rule 100 (expression -> var_ref .)
     ?               reduce using rule 100 (expression -> var_ref .)
     ENTITY          reduce using rule 100 (expression -> var_ref .)
     IMPLEMENT       reduce using rule 100 (expression -> var_ref .)
@@ -1513,106 +1561,112 @@
     INT             reduce using rule 100 (expression -> var_ref .)
     FLOAT           reduce using rule 100 (expression -> var_ref .)
     NULL            reduce using rule 100 (expression -> var_ref .)
     REGEX           reduce using rule 100 (expression -> var_ref .)
     TRUE            reduce using rule 100 (expression -> var_ref .)
     FALSE           reduce using rule 100 (expression -> var_ref .)
     STRING          reduce using rule 100 (expression -> var_ref .)
+    FSTRING         reduce using rule 100 (expression -> var_ref .)
     RSTRING         reduce using rule 100 (expression -> var_ref .)
     MLS             reduce using rule 100 (expression -> var_ref .)
     {               reduce using rule 100 (expression -> var_ref .)
     $end            reduce using rule 100 (expression -> var_ref .)
-    [               shift and go to state 92
+    [               shift and go to state 94
 
   ! [               [ reduce using rule 100 (expression -> var_ref .) ]
 
 
 state 34
 
     (26) if -> IF . if_body END
     (27) if_body -> . expression : stmt_list if_next
     (97) expression -> . boolean_expression
     (98) expression -> . constant
     (99) expression -> . function_call
     (100) expression -> . var_ref
     (101) expression -> . constructor
     (102) expression -> . list_def
-    (103) expression -> . map_def
-    (104) expression -> . map_lookup
-    (105) expression -> . index_lookup
-    (106) expression -> . conditional_expression
-    (107) expression -> . ( expression )
-    (108) boolean_expression -> . expression CMP_OP expression
-    (109) boolean_expression -> . expression IN expression
-    (110) boolean_expression -> . expression AND expression
-    (111) boolean_expression -> . expression OR expression
-    (112) boolean_expression -> . NOT expression
-    (113) boolean_expression -> . var_ref . ID IS DEFINED
-    (114) boolean_expression -> . ID IS DEFINED
-    (115) boolean_expression -> . map_lookup IS DEFINED
-    (134) constant -> . INT
-    (135) constant -> . FLOAT
-    (136) constant -> . NULL
-    (137) constant -> . REGEX
-    (138) constant -> . TRUE
-    (139) constant -> . FALSE
-    (140) constant -> . STRING
-    (141) constant -> . RSTRING
-    (142) constant -> . MLS
-    (121) function_call -> . ns_ref ( function_param_list )
-    (122) function_call -> . attr_ref ( function_param_list )
-    (163) var_ref -> . attr_ref
-    (165) var_ref -> . ns_ref
-    (120) constructor -> . class_ref ( param_list )
-    (123) list_def -> . [ operand_list ]
-    (130) map_def -> . { pair_list }
-    (117) map_lookup -> . attr_ref [ operand ]
-    (118) map_lookup -> . var_ref [ operand ]
-    (119) map_lookup -> . map_lookup [ operand ]
-    (131) index_lookup -> . class_ref [ param_list ]
-    (132) index_lookup -> . attr_ref [ param_list ]
-    (133) conditional_expression -> . expression ? expression : expression
-    (173) ns_ref -> . ns_ref SEP ID
-    (174) ns_ref -> . ID
-    (164) attr_ref -> . var_ref . ID
-    (166) class_ref -> . CID
-    (167) class_ref -> . ns_ref SEP CID
-    (168) class_ref -> . var_ref . CID
+    (103) expression -> . list_comprehension
+    (104) expression -> . map_def
+    (105) expression -> . map_lookup
+    (106) expression -> . index_lookup
+    (107) expression -> . conditional_expression
+    (108) expression -> . ( expression )
+    (109) boolean_expression -> . expression CMP_OP expression
+    (110) boolean_expression -> . expression IN expression
+    (111) boolean_expression -> . expression AND expression
+    (112) boolean_expression -> . expression OR expression
+    (113) boolean_expression -> . NOT expression
+    (114) boolean_expression -> . var_ref . ID IS DEFINED
+    (115) boolean_expression -> . ID IS DEFINED
+    (116) boolean_expression -> . map_lookup IS DEFINED
+    (141) constant -> . INT
+    (142) constant -> . FLOAT
+    (143) constant -> . NULL
+    (144) constant -> . REGEX
+    (145) constant -> . TRUE
+    (146) constant -> . FALSE
+    (147) constant -> . STRING
+    (148) constant -> . FSTRING
+    (149) constant -> . RSTRING
+    (150) constant -> . MLS
+    (122) function_call -> . ns_ref ( function_param_list )
+    (123) function_call -> . attr_ref ( function_param_list )
+    (171) var_ref -> . attr_ref
+    (173) var_ref -> . ns_ref
+    (121) constructor -> . class_ref ( param_list )
+    (124) list_def -> . [ operand_list ]
+    (125) list_comprehension -> . [ expression list_comprehension_for list_comprehension_guard ]
+    (137) map_def -> . { pair_list }
+    (118) map_lookup -> . attr_ref [ operand ]
+    (119) map_lookup -> . var_ref [ operand ]
+    (120) map_lookup -> . map_lookup [ operand ]
+    (138) index_lookup -> . class_ref [ param_list ]
+    (139) index_lookup -> . attr_ref [ param_list ]
+    (140) conditional_expression -> . expression ? expression : expression
+    (181) ns_ref -> . ns_ref SEP ID
+    (182) ns_ref -> . ID
+    (172) attr_ref -> . var_ref . ID
+    (174) class_ref -> . CID
+    (175) class_ref -> . ns_ref SEP CID
+    (176) class_ref -> . var_ref . CID
 
     (               shift and go to state 30
-    NOT             shift and go to state 46
-    ID              shift and go to state 82
-    INT             shift and go to state 47
-    FLOAT           shift and go to state 48
-    NULL            shift and go to state 49
-    REGEX           shift and go to state 50
-    TRUE            shift and go to state 51
-    FALSE           shift and go to state 52
-    STRING          shift and go to state 53
-    RSTRING         shift and go to state 54
+    NOT             shift and go to state 47
+    ID              shift and go to state 84
+    INT             shift and go to state 48
+    FLOAT           shift and go to state 49
+    NULL            shift and go to state 50
+    REGEX           shift and go to state 51
+    TRUE            shift and go to state 52
+    FALSE           shift and go to state 53
+    STRING          shift and go to state 54
+    FSTRING         shift and go to state 55
+    RSTRING         shift and go to state 56
     MLS             shift and go to state 20
-    [               shift and go to state 55
-    {               shift and go to state 56
+    [               shift and go to state 57
+    {               shift and go to state 58
     CID             shift and go to state 16
 
-    if_body                        shift and go to state 93
-    expression                     shift and go to state 94
+    if_body                        shift and go to state 95
+    expression                     shift and go to state 96
     boolean_expression             shift and go to state 35
     constant                       shift and go to state 36
     function_call                  shift and go to state 37
-    var_ref                        shift and go to state 81
+    var_ref                        shift and go to state 83
     constructor                    shift and go to state 38
     list_def                       shift and go to state 39
-    map_def                        shift and go to state 40
-    map_lookup                     shift and go to state 41
-    index_lookup                   shift and go to state 42
-    conditional_expression         shift and go to state 43
-    ns_ref                         shift and go to state 83
-    attr_ref                       shift and go to state 84
-    class_ref                      shift and go to state 85
+    list_comprehension             shift and go to state 40
+    map_def                        shift and go to state 41
+    map_lookup                     shift and go to state 42
+    index_lookup                   shift and go to state 43
+    conditional_expression         shift and go to state 44
+    ns_ref                         shift and go to state 85
+    attr_ref                       shift and go to state 86
+    class_ref                      shift and go to state 87
 
 state 35
 
     (97) expression -> boolean_expression .
 
     CMP_OP          reduce using rule 97 (expression -> boolean_expression .)
     IN              reduce using rule 97 (expression -> boolean_expression .)
@@ -1634,14 +1688,15 @@
     INT             reduce using rule 97 (expression -> boolean_expression .)
     FLOAT           reduce using rule 97 (expression -> boolean_expression .)
     NULL            reduce using rule 97 (expression -> boolean_expression .)
     REGEX           reduce using rule 97 (expression -> boolean_expression .)
     TRUE            reduce using rule 97 (expression -> boolean_expression .)
     FALSE           reduce using rule 97 (expression -> boolean_expression .)
     STRING          reduce using rule 97 (expression -> boolean_expression .)
+    FSTRING         reduce using rule 97 (expression -> boolean_expression .)
     RSTRING         reduce using rule 97 (expression -> boolean_expression .)
     MLS             reduce using rule 97 (expression -> boolean_expression .)
     [               reduce using rule 97 (expression -> boolean_expression .)
     {               reduce using rule 97 (expression -> boolean_expression .)
     $end            reduce using rule 97 (expression -> boolean_expression .)
     )               reduce using rule 97 (expression -> boolean_expression .)
     :               reduce using rule 97 (expression -> boolean_expression .)
@@ -1677,14 +1732,15 @@
     INT             reduce using rule 98 (expression -> constant .)
     FLOAT           reduce using rule 98 (expression -> constant .)
     NULL            reduce using rule 98 (expression -> constant .)
     REGEX           reduce using rule 98 (expression -> constant .)
     TRUE            reduce using rule 98 (expression -> constant .)
     FALSE           reduce using rule 98 (expression -> constant .)
     STRING          reduce using rule 98 (expression -> constant .)
+    FSTRING         reduce using rule 98 (expression -> constant .)
     RSTRING         reduce using rule 98 (expression -> constant .)
     MLS             reduce using rule 98 (expression -> constant .)
     [               reduce using rule 98 (expression -> constant .)
     {               reduce using rule 98 (expression -> constant .)
     $end            reduce using rule 98 (expression -> constant .)
     )               reduce using rule 98 (expression -> constant .)
     :               reduce using rule 98 (expression -> constant .)
@@ -1720,14 +1776,15 @@
     INT             reduce using rule 99 (expression -> function_call .)
     FLOAT           reduce using rule 99 (expression -> function_call .)
     NULL            reduce using rule 99 (expression -> function_call .)
     REGEX           reduce using rule 99 (expression -> function_call .)
     TRUE            reduce using rule 99 (expression -> function_call .)
     FALSE           reduce using rule 99 (expression -> function_call .)
     STRING          reduce using rule 99 (expression -> function_call .)
+    FSTRING         reduce using rule 99 (expression -> function_call .)
     RSTRING         reduce using rule 99 (expression -> function_call .)
     MLS             reduce using rule 99 (expression -> function_call .)
     [               reduce using rule 99 (expression -> function_call .)
     {               reduce using rule 99 (expression -> function_call .)
     $end            reduce using rule 99 (expression -> function_call .)
     )               reduce using rule 99 (expression -> function_call .)
     :               reduce using rule 99 (expression -> function_call .)
@@ -1763,14 +1820,15 @@
     INT             reduce using rule 101 (expression -> constructor .)
     FLOAT           reduce using rule 101 (expression -> constructor .)
     NULL            reduce using rule 101 (expression -> constructor .)
     REGEX           reduce using rule 101 (expression -> constructor .)
     TRUE            reduce using rule 101 (expression -> constructor .)
     FALSE           reduce using rule 101 (expression -> constructor .)
     STRING          reduce using rule 101 (expression -> constructor .)
+    FSTRING         reduce using rule 101 (expression -> constructor .)
     RSTRING         reduce using rule 101 (expression -> constructor .)
     MLS             reduce using rule 101 (expression -> constructor .)
     [               reduce using rule 101 (expression -> constructor .)
     {               reduce using rule 101 (expression -> constructor .)
     $end            reduce using rule 101 (expression -> constructor .)
     )               reduce using rule 101 (expression -> constructor .)
     :               reduce using rule 101 (expression -> constructor .)
@@ -1806,14 +1864,15 @@
     INT             reduce using rule 102 (expression -> list_def .)
     FLOAT           reduce using rule 102 (expression -> list_def .)
     NULL            reduce using rule 102 (expression -> list_def .)
     REGEX           reduce using rule 102 (expression -> list_def .)
     TRUE            reduce using rule 102 (expression -> list_def .)
     FALSE           reduce using rule 102 (expression -> list_def .)
     STRING          reduce using rule 102 (expression -> list_def .)
+    FSTRING         reduce using rule 102 (expression -> list_def .)
     RSTRING         reduce using rule 102 (expression -> list_def .)
     MLS             reduce using rule 102 (expression -> list_def .)
     [               reduce using rule 102 (expression -> list_def .)
     {               reduce using rule 102 (expression -> list_def .)
     $end            reduce using rule 102 (expression -> list_def .)
     )               reduce using rule 102 (expression -> list_def .)
     :               reduce using rule 102 (expression -> list_def .)
@@ -1823,1387 +1882,1526 @@
     ELIF            reduce using rule 102 (expression -> list_def .)
     END             reduce using rule 102 (expression -> list_def .)
     }               reduce using rule 102 (expression -> list_def .)
 
 
 state 40
 
-    (103) expression -> map_def .
+    (103) expression -> list_comprehension .
 
-    CMP_OP          reduce using rule 103 (expression -> map_def .)
-    IN              reduce using rule 103 (expression -> map_def .)
-    AND             reduce using rule 103 (expression -> map_def .)
-    OR              reduce using rule 103 (expression -> map_def .)
-    ?               reduce using rule 103 (expression -> map_def .)
-    ENTITY          reduce using rule 103 (expression -> map_def .)
-    IMPLEMENT       reduce using rule 103 (expression -> map_def .)
-    IMPLEMENTATION  reduce using rule 103 (expression -> map_def .)
-    INDEX           reduce using rule 103 (expression -> map_def .)
-    IMPORT          reduce using rule 103 (expression -> map_def .)
-    CID             reduce using rule 103 (expression -> map_def .)
-    FOR             reduce using rule 103 (expression -> map_def .)
-    IF              reduce using rule 103 (expression -> map_def .)
-    (               reduce using rule 103 (expression -> map_def .)
-    TYPEDEF         reduce using rule 103 (expression -> map_def .)
-    ID              reduce using rule 103 (expression -> map_def .)
-    NOT             reduce using rule 103 (expression -> map_def .)
-    INT             reduce using rule 103 (expression -> map_def .)
-    FLOAT           reduce using rule 103 (expression -> map_def .)
-    NULL            reduce using rule 103 (expression -> map_def .)
-    REGEX           reduce using rule 103 (expression -> map_def .)
-    TRUE            reduce using rule 103 (expression -> map_def .)
-    FALSE           reduce using rule 103 (expression -> map_def .)
-    STRING          reduce using rule 103 (expression -> map_def .)
-    RSTRING         reduce using rule 103 (expression -> map_def .)
-    MLS             reduce using rule 103 (expression -> map_def .)
-    [               reduce using rule 103 (expression -> map_def .)
-    {               reduce using rule 103 (expression -> map_def .)
-    $end            reduce using rule 103 (expression -> map_def .)
-    )               reduce using rule 103 (expression -> map_def .)
-    :               reduce using rule 103 (expression -> map_def .)
-    ,               reduce using rule 103 (expression -> map_def .)
-    ]               reduce using rule 103 (expression -> map_def .)
-    ELSE            reduce using rule 103 (expression -> map_def .)
-    ELIF            reduce using rule 103 (expression -> map_def .)
-    END             reduce using rule 103 (expression -> map_def .)
-    }               reduce using rule 103 (expression -> map_def .)
+    CMP_OP          reduce using rule 103 (expression -> list_comprehension .)
+    IN              reduce using rule 103 (expression -> list_comprehension .)
+    AND             reduce using rule 103 (expression -> list_comprehension .)
+    OR              reduce using rule 103 (expression -> list_comprehension .)
+    ?               reduce using rule 103 (expression -> list_comprehension .)
+    ENTITY          reduce using rule 103 (expression -> list_comprehension .)
+    IMPLEMENT       reduce using rule 103 (expression -> list_comprehension .)
+    IMPLEMENTATION  reduce using rule 103 (expression -> list_comprehension .)
+    INDEX           reduce using rule 103 (expression -> list_comprehension .)
+    IMPORT          reduce using rule 103 (expression -> list_comprehension .)
+    CID             reduce using rule 103 (expression -> list_comprehension .)
+    FOR             reduce using rule 103 (expression -> list_comprehension .)
+    IF              reduce using rule 103 (expression -> list_comprehension .)
+    (               reduce using rule 103 (expression -> list_comprehension .)
+    TYPEDEF         reduce using rule 103 (expression -> list_comprehension .)
+    ID              reduce using rule 103 (expression -> list_comprehension .)
+    NOT             reduce using rule 103 (expression -> list_comprehension .)
+    INT             reduce using rule 103 (expression -> list_comprehension .)
+    FLOAT           reduce using rule 103 (expression -> list_comprehension .)
+    NULL            reduce using rule 103 (expression -> list_comprehension .)
+    REGEX           reduce using rule 103 (expression -> list_comprehension .)
+    TRUE            reduce using rule 103 (expression -> list_comprehension .)
+    FALSE           reduce using rule 103 (expression -> list_comprehension .)
+    STRING          reduce using rule 103 (expression -> list_comprehension .)
+    FSTRING         reduce using rule 103 (expression -> list_comprehension .)
+    RSTRING         reduce using rule 103 (expression -> list_comprehension .)
+    MLS             reduce using rule 103 (expression -> list_comprehension .)
+    [               reduce using rule 103 (expression -> list_comprehension .)
+    {               reduce using rule 103 (expression -> list_comprehension .)
+    $end            reduce using rule 103 (expression -> list_comprehension .)
+    )               reduce using rule 103 (expression -> list_comprehension .)
+    :               reduce using rule 103 (expression -> list_comprehension .)
+    ,               reduce using rule 103 (expression -> list_comprehension .)
+    ]               reduce using rule 103 (expression -> list_comprehension .)
+    ELSE            reduce using rule 103 (expression -> list_comprehension .)
+    ELIF            reduce using rule 103 (expression -> list_comprehension .)
+    END             reduce using rule 103 (expression -> list_comprehension .)
+    }               reduce using rule 103 (expression -> list_comprehension .)
 
 
 state 41
 
-    (104) expression -> map_lookup .
-    (115) boolean_expression -> map_lookup . IS DEFINED
-    (119) map_lookup -> map_lookup . [ operand ]
-
-    CMP_OP          reduce using rule 104 (expression -> map_lookup .)
-    IN              reduce using rule 104 (expression -> map_lookup .)
-    AND             reduce using rule 104 (expression -> map_lookup .)
-    OR              reduce using rule 104 (expression -> map_lookup .)
-    ?               reduce using rule 104 (expression -> map_lookup .)
-    ENTITY          reduce using rule 104 (expression -> map_lookup .)
-    IMPLEMENT       reduce using rule 104 (expression -> map_lookup .)
-    IMPLEMENTATION  reduce using rule 104 (expression -> map_lookup .)
-    INDEX           reduce using rule 104 (expression -> map_lookup .)
-    IMPORT          reduce using rule 104 (expression -> map_lookup .)
-    CID             reduce using rule 104 (expression -> map_lookup .)
-    FOR             reduce using rule 104 (expression -> map_lookup .)
-    IF              reduce using rule 104 (expression -> map_lookup .)
-    (               reduce using rule 104 (expression -> map_lookup .)
-    TYPEDEF         reduce using rule 104 (expression -> map_lookup .)
-    ID              reduce using rule 104 (expression -> map_lookup .)
-    NOT             reduce using rule 104 (expression -> map_lookup .)
-    INT             reduce using rule 104 (expression -> map_lookup .)
-    FLOAT           reduce using rule 104 (expression -> map_lookup .)
-    NULL            reduce using rule 104 (expression -> map_lookup .)
-    REGEX           reduce using rule 104 (expression -> map_lookup .)
-    TRUE            reduce using rule 104 (expression -> map_lookup .)
-    FALSE           reduce using rule 104 (expression -> map_lookup .)
-    STRING          reduce using rule 104 (expression -> map_lookup .)
-    RSTRING         reduce using rule 104 (expression -> map_lookup .)
-    MLS             reduce using rule 104 (expression -> map_lookup .)
-    {               reduce using rule 104 (expression -> map_lookup .)
-    $end            reduce using rule 104 (expression -> map_lookup .)
-    )               reduce using rule 104 (expression -> map_lookup .)
-    :               reduce using rule 104 (expression -> map_lookup .)
-    ,               reduce using rule 104 (expression -> map_lookup .)
-    ]               reduce using rule 104 (expression -> map_lookup .)
-    ELSE            reduce using rule 104 (expression -> map_lookup .)
-    ELIF            reduce using rule 104 (expression -> map_lookup .)
-    END             reduce using rule 104 (expression -> map_lookup .)
-    }               reduce using rule 104 (expression -> map_lookup .)
-    IS              shift and go to state 95
-    [               shift and go to state 96
+    (104) expression -> map_def .
 
-  ! [               [ reduce using rule 104 (expression -> map_lookup .) ]
+    CMP_OP          reduce using rule 104 (expression -> map_def .)
+    IN              reduce using rule 104 (expression -> map_def .)
+    AND             reduce using rule 104 (expression -> map_def .)
+    OR              reduce using rule 104 (expression -> map_def .)
+    ?               reduce using rule 104 (expression -> map_def .)
+    ENTITY          reduce using rule 104 (expression -> map_def .)
+    IMPLEMENT       reduce using rule 104 (expression -> map_def .)
+    IMPLEMENTATION  reduce using rule 104 (expression -> map_def .)
+    INDEX           reduce using rule 104 (expression -> map_def .)
+    IMPORT          reduce using rule 104 (expression -> map_def .)
+    CID             reduce using rule 104 (expression -> map_def .)
+    FOR             reduce using rule 104 (expression -> map_def .)
+    IF              reduce using rule 104 (expression -> map_def .)
+    (               reduce using rule 104 (expression -> map_def .)
+    TYPEDEF         reduce using rule 104 (expression -> map_def .)
+    ID              reduce using rule 104 (expression -> map_def .)
+    NOT             reduce using rule 104 (expression -> map_def .)
+    INT             reduce using rule 104 (expression -> map_def .)
+    FLOAT           reduce using rule 104 (expression -> map_def .)
+    NULL            reduce using rule 104 (expression -> map_def .)
+    REGEX           reduce using rule 104 (expression -> map_def .)
+    TRUE            reduce using rule 104 (expression -> map_def .)
+    FALSE           reduce using rule 104 (expression -> map_def .)
+    STRING          reduce using rule 104 (expression -> map_def .)
+    FSTRING         reduce using rule 104 (expression -> map_def .)
+    RSTRING         reduce using rule 104 (expression -> map_def .)
+    MLS             reduce using rule 104 (expression -> map_def .)
+    [               reduce using rule 104 (expression -> map_def .)
+    {               reduce using rule 104 (expression -> map_def .)
+    $end            reduce using rule 104 (expression -> map_def .)
+    )               reduce using rule 104 (expression -> map_def .)
+    :               reduce using rule 104 (expression -> map_def .)
+    ,               reduce using rule 104 (expression -> map_def .)
+    ]               reduce using rule 104 (expression -> map_def .)
+    ELSE            reduce using rule 104 (expression -> map_def .)
+    ELIF            reduce using rule 104 (expression -> map_def .)
+    END             reduce using rule 104 (expression -> map_def .)
+    }               reduce using rule 104 (expression -> map_def .)
 
 
 state 42
 
-    (105) expression -> index_lookup .
+    (105) expression -> map_lookup .
+    (116) boolean_expression -> map_lookup . IS DEFINED
+    (120) map_lookup -> map_lookup . [ operand ]
+
+    CMP_OP          reduce using rule 105 (expression -> map_lookup .)
+    IN              reduce using rule 105 (expression -> map_lookup .)
+    AND             reduce using rule 105 (expression -> map_lookup .)
+    OR              reduce using rule 105 (expression -> map_lookup .)
+    ?               reduce using rule 105 (expression -> map_lookup .)
+    ENTITY          reduce using rule 105 (expression -> map_lookup .)
+    IMPLEMENT       reduce using rule 105 (expression -> map_lookup .)
+    IMPLEMENTATION  reduce using rule 105 (expression -> map_lookup .)
+    INDEX           reduce using rule 105 (expression -> map_lookup .)
+    IMPORT          reduce using rule 105 (expression -> map_lookup .)
+    CID             reduce using rule 105 (expression -> map_lookup .)
+    FOR             reduce using rule 105 (expression -> map_lookup .)
+    IF              reduce using rule 105 (expression -> map_lookup .)
+    (               reduce using rule 105 (expression -> map_lookup .)
+    TYPEDEF         reduce using rule 105 (expression -> map_lookup .)
+    ID              reduce using rule 105 (expression -> map_lookup .)
+    NOT             reduce using rule 105 (expression -> map_lookup .)
+    INT             reduce using rule 105 (expression -> map_lookup .)
+    FLOAT           reduce using rule 105 (expression -> map_lookup .)
+    NULL            reduce using rule 105 (expression -> map_lookup .)
+    REGEX           reduce using rule 105 (expression -> map_lookup .)
+    TRUE            reduce using rule 105 (expression -> map_lookup .)
+    FALSE           reduce using rule 105 (expression -> map_lookup .)
+    STRING          reduce using rule 105 (expression -> map_lookup .)
+    FSTRING         reduce using rule 105 (expression -> map_lookup .)
+    RSTRING         reduce using rule 105 (expression -> map_lookup .)
+    MLS             reduce using rule 105 (expression -> map_lookup .)
+    {               reduce using rule 105 (expression -> map_lookup .)
+    $end            reduce using rule 105 (expression -> map_lookup .)
+    )               reduce using rule 105 (expression -> map_lookup .)
+    :               reduce using rule 105 (expression -> map_lookup .)
+    ,               reduce using rule 105 (expression -> map_lookup .)
+    ]               reduce using rule 105 (expression -> map_lookup .)
+    ELSE            reduce using rule 105 (expression -> map_lookup .)
+    ELIF            reduce using rule 105 (expression -> map_lookup .)
+    END             reduce using rule 105 (expression -> map_lookup .)
+    }               reduce using rule 105 (expression -> map_lookup .)
+    IS              shift and go to state 97
+    [               shift and go to state 98
 
-    CMP_OP          reduce using rule 105 (expression -> index_lookup .)
-    IN              reduce using rule 105 (expression -> index_lookup .)
-    AND             reduce using rule 105 (expression -> index_lookup .)
-    OR              reduce using rule 105 (expression -> index_lookup .)
-    ?               reduce using rule 105 (expression -> index_lookup .)
-    ENTITY          reduce using rule 105 (expression -> index_lookup .)
-    IMPLEMENT       reduce using rule 105 (expression -> index_lookup .)
-    IMPLEMENTATION  reduce using rule 105 (expression -> index_lookup .)
-    INDEX           reduce using rule 105 (expression -> index_lookup .)
-    IMPORT          reduce using rule 105 (expression -> index_lookup .)
-    CID             reduce using rule 105 (expression -> index_lookup .)
-    FOR             reduce using rule 105 (expression -> index_lookup .)
-    IF              reduce using rule 105 (expression -> index_lookup .)
-    (               reduce using rule 105 (expression -> index_lookup .)
-    TYPEDEF         reduce using rule 105 (expression -> index_lookup .)
-    ID              reduce using rule 105 (expression -> index_lookup .)
-    NOT             reduce using rule 105 (expression -> index_lookup .)
-    INT             reduce using rule 105 (expression -> index_lookup .)
-    FLOAT           reduce using rule 105 (expression -> index_lookup .)
-    NULL            reduce using rule 105 (expression -> index_lookup .)
-    REGEX           reduce using rule 105 (expression -> index_lookup .)
-    TRUE            reduce using rule 105 (expression -> index_lookup .)
-    FALSE           reduce using rule 105 (expression -> index_lookup .)
-    STRING          reduce using rule 105 (expression -> index_lookup .)
-    RSTRING         reduce using rule 105 (expression -> index_lookup .)
-    MLS             reduce using rule 105 (expression -> index_lookup .)
-    [               reduce using rule 105 (expression -> index_lookup .)
-    {               reduce using rule 105 (expression -> index_lookup .)
-    $end            reduce using rule 105 (expression -> index_lookup .)
-    )               reduce using rule 105 (expression -> index_lookup .)
-    :               reduce using rule 105 (expression -> index_lookup .)
-    ,               reduce using rule 105 (expression -> index_lookup .)
-    ]               reduce using rule 105 (expression -> index_lookup .)
-    ELSE            reduce using rule 105 (expression -> index_lookup .)
-    ELIF            reduce using rule 105 (expression -> index_lookup .)
-    END             reduce using rule 105 (expression -> index_lookup .)
-    }               reduce using rule 105 (expression -> index_lookup .)
+  ! [               [ reduce using rule 105 (expression -> map_lookup .) ]
 
 
 state 43
 
-    (106) expression -> conditional_expression .
+    (106) expression -> index_lookup .
 
-    CMP_OP          reduce using rule 106 (expression -> conditional_expression .)
-    IN              reduce using rule 106 (expression -> conditional_expression .)
-    AND             reduce using rule 106 (expression -> conditional_expression .)
-    OR              reduce using rule 106 (expression -> conditional_expression .)
-    ?               reduce using rule 106 (expression -> conditional_expression .)
-    ENTITY          reduce using rule 106 (expression -> conditional_expression .)
-    IMPLEMENT       reduce using rule 106 (expression -> conditional_expression .)
-    IMPLEMENTATION  reduce using rule 106 (expression -> conditional_expression .)
-    INDEX           reduce using rule 106 (expression -> conditional_expression .)
-    IMPORT          reduce using rule 106 (expression -> conditional_expression .)
-    CID             reduce using rule 106 (expression -> conditional_expression .)
-    FOR             reduce using rule 106 (expression -> conditional_expression .)
-    IF              reduce using rule 106 (expression -> conditional_expression .)
-    (               reduce using rule 106 (expression -> conditional_expression .)
-    TYPEDEF         reduce using rule 106 (expression -> conditional_expression .)
-    ID              reduce using rule 106 (expression -> conditional_expression .)
-    NOT             reduce using rule 106 (expression -> conditional_expression .)
-    INT             reduce using rule 106 (expression -> conditional_expression .)
-    FLOAT           reduce using rule 106 (expression -> conditional_expression .)
-    NULL            reduce using rule 106 (expression -> conditional_expression .)
-    REGEX           reduce using rule 106 (expression -> conditional_expression .)
-    TRUE            reduce using rule 106 (expression -> conditional_expression .)
-    FALSE           reduce using rule 106 (expression -> conditional_expression .)
-    STRING          reduce using rule 106 (expression -> conditional_expression .)
-    RSTRING         reduce using rule 106 (expression -> conditional_expression .)
-    MLS             reduce using rule 106 (expression -> conditional_expression .)
-    [               reduce using rule 106 (expression -> conditional_expression .)
-    {               reduce using rule 106 (expression -> conditional_expression .)
-    $end            reduce using rule 106 (expression -> conditional_expression .)
-    )               reduce using rule 106 (expression -> conditional_expression .)
-    :               reduce using rule 106 (expression -> conditional_expression .)
-    ,               reduce using rule 106 (expression -> conditional_expression .)
-    ]               reduce using rule 106 (expression -> conditional_expression .)
-    ELSE            reduce using rule 106 (expression -> conditional_expression .)
-    ELIF            reduce using rule 106 (expression -> conditional_expression .)
-    END             reduce using rule 106 (expression -> conditional_expression .)
-    }               reduce using rule 106 (expression -> conditional_expression .)
+    CMP_OP          reduce using rule 106 (expression -> index_lookup .)
+    IN              reduce using rule 106 (expression -> index_lookup .)
+    AND             reduce using rule 106 (expression -> index_lookup .)
+    OR              reduce using rule 106 (expression -> index_lookup .)
+    ?               reduce using rule 106 (expression -> index_lookup .)
+    ENTITY          reduce using rule 106 (expression -> index_lookup .)
+    IMPLEMENT       reduce using rule 106 (expression -> index_lookup .)
+    IMPLEMENTATION  reduce using rule 106 (expression -> index_lookup .)
+    INDEX           reduce using rule 106 (expression -> index_lookup .)
+    IMPORT          reduce using rule 106 (expression -> index_lookup .)
+    CID             reduce using rule 106 (expression -> index_lookup .)
+    FOR             reduce using rule 106 (expression -> index_lookup .)
+    IF              reduce using rule 106 (expression -> index_lookup .)
+    (               reduce using rule 106 (expression -> index_lookup .)
+    TYPEDEF         reduce using rule 106 (expression -> index_lookup .)
+    ID              reduce using rule 106 (expression -> index_lookup .)
+    NOT             reduce using rule 106 (expression -> index_lookup .)
+    INT             reduce using rule 106 (expression -> index_lookup .)
+    FLOAT           reduce using rule 106 (expression -> index_lookup .)
+    NULL            reduce using rule 106 (expression -> index_lookup .)
+    REGEX           reduce using rule 106 (expression -> index_lookup .)
+    TRUE            reduce using rule 106 (expression -> index_lookup .)
+    FALSE           reduce using rule 106 (expression -> index_lookup .)
+    STRING          reduce using rule 106 (expression -> index_lookup .)
+    FSTRING         reduce using rule 106 (expression -> index_lookup .)
+    RSTRING         reduce using rule 106 (expression -> index_lookup .)
+    MLS             reduce using rule 106 (expression -> index_lookup .)
+    [               reduce using rule 106 (expression -> index_lookup .)
+    {               reduce using rule 106 (expression -> index_lookup .)
+    $end            reduce using rule 106 (expression -> index_lookup .)
+    )               reduce using rule 106 (expression -> index_lookup .)
+    :               reduce using rule 106 (expression -> index_lookup .)
+    ,               reduce using rule 106 (expression -> index_lookup .)
+    ]               reduce using rule 106 (expression -> index_lookup .)
+    ELSE            reduce using rule 106 (expression -> index_lookup .)
+    ELIF            reduce using rule 106 (expression -> index_lookup .)
+    END             reduce using rule 106 (expression -> index_lookup .)
+    }               reduce using rule 106 (expression -> index_lookup .)
 
 
 state 44
 
-    (94) typedef_inner -> TYPEDEF . ID AS ns_ref MATCHING expression
-    (95) typedef_inner -> TYPEDEF . CID AS constructor
+    (107) expression -> conditional_expression .
 
-    ID              shift and go to state 97
-    CID             shift and go to state 98
+    CMP_OP          reduce using rule 107 (expression -> conditional_expression .)
+    IN              reduce using rule 107 (expression -> conditional_expression .)
+    AND             reduce using rule 107 (expression -> conditional_expression .)
+    OR              reduce using rule 107 (expression -> conditional_expression .)
+    ?               reduce using rule 107 (expression -> conditional_expression .)
+    ENTITY          reduce using rule 107 (expression -> conditional_expression .)
+    IMPLEMENT       reduce using rule 107 (expression -> conditional_expression .)
+    IMPLEMENTATION  reduce using rule 107 (expression -> conditional_expression .)
+    INDEX           reduce using rule 107 (expression -> conditional_expression .)
+    IMPORT          reduce using rule 107 (expression -> conditional_expression .)
+    CID             reduce using rule 107 (expression -> conditional_expression .)
+    FOR             reduce using rule 107 (expression -> conditional_expression .)
+    IF              reduce using rule 107 (expression -> conditional_expression .)
+    (               reduce using rule 107 (expression -> conditional_expression .)
+    TYPEDEF         reduce using rule 107 (expression -> conditional_expression .)
+    ID              reduce using rule 107 (expression -> conditional_expression .)
+    NOT             reduce using rule 107 (expression -> conditional_expression .)
+    INT             reduce using rule 107 (expression -> conditional_expression .)
+    FLOAT           reduce using rule 107 (expression -> conditional_expression .)
+    NULL            reduce using rule 107 (expression -> conditional_expression .)
+    REGEX           reduce using rule 107 (expression -> conditional_expression .)
+    TRUE            reduce using rule 107 (expression -> conditional_expression .)
+    FALSE           reduce using rule 107 (expression -> conditional_expression .)
+    STRING          reduce using rule 107 (expression -> conditional_expression .)
+    FSTRING         reduce using rule 107 (expression -> conditional_expression .)
+    RSTRING         reduce using rule 107 (expression -> conditional_expression .)
+    MLS             reduce using rule 107 (expression -> conditional_expression .)
+    [               reduce using rule 107 (expression -> conditional_expression .)
+    {               reduce using rule 107 (expression -> conditional_expression .)
+    $end            reduce using rule 107 (expression -> conditional_expression .)
+    )               reduce using rule 107 (expression -> conditional_expression .)
+    :               reduce using rule 107 (expression -> conditional_expression .)
+    ,               reduce using rule 107 (expression -> conditional_expression .)
+    ]               reduce using rule 107 (expression -> conditional_expression .)
+    ELSE            reduce using rule 107 (expression -> conditional_expression .)
+    ELIF            reduce using rule 107 (expression -> conditional_expression .)
+    END             reduce using rule 107 (expression -> conditional_expression .)
+    }               reduce using rule 107 (expression -> conditional_expression .)
 
 
 state 45
 
-    (163) var_ref -> attr_ref .
-    (122) function_call -> attr_ref . ( function_param_list )
-    (117) map_lookup -> attr_ref . [ operand ]
-    (132) index_lookup -> attr_ref . [ param_list ]
-
-    .               reduce using rule 163 (var_ref -> attr_ref .)
-    =               reduce using rule 163 (var_ref -> attr_ref .)
-    PEQ             reduce using rule 163 (var_ref -> attr_ref .)
-    CMP_OP          reduce using rule 163 (var_ref -> attr_ref .)
-    IN              reduce using rule 163 (var_ref -> attr_ref .)
-    AND             reduce using rule 163 (var_ref -> attr_ref .)
-    OR              reduce using rule 163 (var_ref -> attr_ref .)
-    ?               reduce using rule 163 (var_ref -> attr_ref .)
-    ENTITY          reduce using rule 163 (var_ref -> attr_ref .)
-    IMPLEMENT       reduce using rule 163 (var_ref -> attr_ref .)
-    IMPLEMENTATION  reduce using rule 163 (var_ref -> attr_ref .)
-    INDEX           reduce using rule 163 (var_ref -> attr_ref .)
-    IMPORT          reduce using rule 163 (var_ref -> attr_ref .)
-    CID             reduce using rule 163 (var_ref -> attr_ref .)
-    FOR             reduce using rule 163 (var_ref -> attr_ref .)
-    IF              reduce using rule 163 (var_ref -> attr_ref .)
-    TYPEDEF         reduce using rule 163 (var_ref -> attr_ref .)
-    ID              reduce using rule 163 (var_ref -> attr_ref .)
-    NOT             reduce using rule 163 (var_ref -> attr_ref .)
-    INT             reduce using rule 163 (var_ref -> attr_ref .)
-    FLOAT           reduce using rule 163 (var_ref -> attr_ref .)
-    NULL            reduce using rule 163 (var_ref -> attr_ref .)
-    REGEX           reduce using rule 163 (var_ref -> attr_ref .)
-    TRUE            reduce using rule 163 (var_ref -> attr_ref .)
-    FALSE           reduce using rule 163 (var_ref -> attr_ref .)
-    STRING          reduce using rule 163 (var_ref -> attr_ref .)
-    RSTRING         reduce using rule 163 (var_ref -> attr_ref .)
-    MLS             reduce using rule 163 (var_ref -> attr_ref .)
-    {               reduce using rule 163 (var_ref -> attr_ref .)
-    $end            reduce using rule 163 (var_ref -> attr_ref .)
-    ELSE            reduce using rule 163 (var_ref -> attr_ref .)
-    ELIF            reduce using rule 163 (var_ref -> attr_ref .)
-    END             reduce using rule 163 (var_ref -> attr_ref .)
-    (               shift and go to state 99
-    [               shift and go to state 100
+    (94) typedef_inner -> TYPEDEF . ID AS ns_ref MATCHING expression
+    (95) typedef_inner -> TYPEDEF . CID AS constructor
 
-  ! [               [ reduce using rule 163 (var_ref -> attr_ref .) ]
-  ! (               [ reduce using rule 163 (var_ref -> attr_ref .) ]
+    ID              shift and go to state 99
+    CID             shift and go to state 100
 
 
 state 46
 
-    (112) boolean_expression -> NOT . expression
+    (171) var_ref -> attr_ref .
+    (123) function_call -> attr_ref . ( function_param_list )
+    (118) map_lookup -> attr_ref . [ operand ]
+    (139) index_lookup -> attr_ref . [ param_list ]
+
+    .               reduce using rule 171 (var_ref -> attr_ref .)
+    =               reduce using rule 171 (var_ref -> attr_ref .)
+    PEQ             reduce using rule 171 (var_ref -> attr_ref .)
+    CMP_OP          reduce using rule 171 (var_ref -> attr_ref .)
+    IN              reduce using rule 171 (var_ref -> attr_ref .)
+    AND             reduce using rule 171 (var_ref -> attr_ref .)
+    OR              reduce using rule 171 (var_ref -> attr_ref .)
+    ?               reduce using rule 171 (var_ref -> attr_ref .)
+    ENTITY          reduce using rule 171 (var_ref -> attr_ref .)
+    IMPLEMENT       reduce using rule 171 (var_ref -> attr_ref .)
+    IMPLEMENTATION  reduce using rule 171 (var_ref -> attr_ref .)
+    INDEX           reduce using rule 171 (var_ref -> attr_ref .)
+    IMPORT          reduce using rule 171 (var_ref -> attr_ref .)
+    CID             reduce using rule 171 (var_ref -> attr_ref .)
+    FOR             reduce using rule 171 (var_ref -> attr_ref .)
+    IF              reduce using rule 171 (var_ref -> attr_ref .)
+    TYPEDEF         reduce using rule 171 (var_ref -> attr_ref .)
+    ID              reduce using rule 171 (var_ref -> attr_ref .)
+    NOT             reduce using rule 171 (var_ref -> attr_ref .)
+    INT             reduce using rule 171 (var_ref -> attr_ref .)
+    FLOAT           reduce using rule 171 (var_ref -> attr_ref .)
+    NULL            reduce using rule 171 (var_ref -> attr_ref .)
+    REGEX           reduce using rule 171 (var_ref -> attr_ref .)
+    TRUE            reduce using rule 171 (var_ref -> attr_ref .)
+    FALSE           reduce using rule 171 (var_ref -> attr_ref .)
+    STRING          reduce using rule 171 (var_ref -> attr_ref .)
+    FSTRING         reduce using rule 171 (var_ref -> attr_ref .)
+    RSTRING         reduce using rule 171 (var_ref -> attr_ref .)
+    MLS             reduce using rule 171 (var_ref -> attr_ref .)
+    {               reduce using rule 171 (var_ref -> attr_ref .)
+    $end            reduce using rule 171 (var_ref -> attr_ref .)
+    ELSE            reduce using rule 171 (var_ref -> attr_ref .)
+    ELIF            reduce using rule 171 (var_ref -> attr_ref .)
+    END             reduce using rule 171 (var_ref -> attr_ref .)
+    (               shift and go to state 101
+    [               shift and go to state 102
+
+  ! [               [ reduce using rule 171 (var_ref -> attr_ref .) ]
+  ! (               [ reduce using rule 171 (var_ref -> attr_ref .) ]
+
+
+state 47
+
+    (113) boolean_expression -> NOT . expression
     (97) expression -> . boolean_expression
     (98) expression -> . constant
     (99) expression -> . function_call
     (100) expression -> . var_ref
     (101) expression -> . constructor
     (102) expression -> . list_def
-    (103) expression -> . map_def
-    (104) expression -> . map_lookup
-    (105) expression -> . index_lookup
-    (106) expression -> . conditional_expression
-    (107) expression -> . ( expression )
-    (108) boolean_expression -> . expression CMP_OP expression
-    (109) boolean_expression -> . expression IN expression
-    (110) boolean_expression -> . expression AND expression
-    (111) boolean_expression -> . expression OR expression
-    (112) boolean_expression -> . NOT expression
-    (113) boolean_expression -> . var_ref . ID IS DEFINED
-    (114) boolean_expression -> . ID IS DEFINED
-    (115) boolean_expression -> . map_lookup IS DEFINED
-    (134) constant -> . INT
-    (135) constant -> . FLOAT
-    (136) constant -> . NULL
-    (137) constant -> . REGEX
-    (138) constant -> . TRUE
-    (139) constant -> . FALSE
-    (140) constant -> . STRING
-    (141) constant -> . RSTRING
-    (142) constant -> . MLS
-    (121) function_call -> . ns_ref ( function_param_list )
-    (122) function_call -> . attr_ref ( function_param_list )
-    (163) var_ref -> . attr_ref
-    (165) var_ref -> . ns_ref
-    (120) constructor -> . class_ref ( param_list )
-    (123) list_def -> . [ operand_list ]
-    (130) map_def -> . { pair_list }
-    (117) map_lookup -> . attr_ref [ operand ]
-    (118) map_lookup -> . var_ref [ operand ]
-    (119) map_lookup -> . map_lookup [ operand ]
-    (131) index_lookup -> . class_ref [ param_list ]
-    (132) index_lookup -> . attr_ref [ param_list ]
-    (133) conditional_expression -> . expression ? expression : expression
-    (173) ns_ref -> . ns_ref SEP ID
-    (174) ns_ref -> . ID
-    (164) attr_ref -> . var_ref . ID
-    (166) class_ref -> . CID
-    (167) class_ref -> . ns_ref SEP CID
-    (168) class_ref -> . var_ref . CID
+    (103) expression -> . list_comprehension
+    (104) expression -> . map_def
+    (105) expression -> . map_lookup
+    (106) expression -> . index_lookup
+    (107) expression -> . conditional_expression
+    (108) expression -> . ( expression )
+    (109) boolean_expression -> . expression CMP_OP expression
+    (110) boolean_expression -> . expression IN expression
+    (111) boolean_expression -> . expression AND expression
+    (112) boolean_expression -> . expression OR expression
+    (113) boolean_expression -> . NOT expression
+    (114) boolean_expression -> . var_ref . ID IS DEFINED
+    (115) boolean_expression -> . ID IS DEFINED
+    (116) boolean_expression -> . map_lookup IS DEFINED
+    (141) constant -> . INT
+    (142) constant -> . FLOAT
+    (143) constant -> . NULL
+    (144) constant -> . REGEX
+    (145) constant -> . TRUE
+    (146) constant -> . FALSE
+    (147) constant -> . STRING
+    (148) constant -> . FSTRING
+    (149) constant -> . RSTRING
+    (150) constant -> . MLS
+    (122) function_call -> . ns_ref ( function_param_list )
+    (123) function_call -> . attr_ref ( function_param_list )
+    (171) var_ref -> . attr_ref
+    (173) var_ref -> . ns_ref
+    (121) constructor -> . class_ref ( param_list )
+    (124) list_def -> . [ operand_list ]
+    (125) list_comprehension -> . [ expression list_comprehension_for list_comprehension_guard ]
+    (137) map_def -> . { pair_list }
+    (118) map_lookup -> . attr_ref [ operand ]
+    (119) map_lookup -> . var_ref [ operand ]
+    (120) map_lookup -> . map_lookup [ operand ]
+    (138) index_lookup -> . class_ref [ param_list ]
+    (139) index_lookup -> . attr_ref [ param_list ]
+    (140) conditional_expression -> . expression ? expression : expression
+    (181) ns_ref -> . ns_ref SEP ID
+    (182) ns_ref -> . ID
+    (172) attr_ref -> . var_ref . ID
+    (174) class_ref -> . CID
+    (175) class_ref -> . ns_ref SEP CID
+    (176) class_ref -> . var_ref . CID
 
     (               shift and go to state 30
-    NOT             shift and go to state 46
-    ID              shift and go to state 82
-    INT             shift and go to state 47
-    FLOAT           shift and go to state 48
-    NULL            shift and go to state 49
-    REGEX           shift and go to state 50
-    TRUE            shift and go to state 51
-    FALSE           shift and go to state 52
-    STRING          shift and go to state 53
-    RSTRING         shift and go to state 54
+    NOT             shift and go to state 47
+    ID              shift and go to state 84
+    INT             shift and go to state 48
+    FLOAT           shift and go to state 49
+    NULL            shift and go to state 50
+    REGEX           shift and go to state 51
+    TRUE            shift and go to state 52
+    FALSE           shift and go to state 53
+    STRING          shift and go to state 54
+    FSTRING         shift and go to state 55
+    RSTRING         shift and go to state 56
     MLS             shift and go to state 20
-    [               shift and go to state 55
-    {               shift and go to state 56
+    [               shift and go to state 57
+    {               shift and go to state 58
     CID             shift and go to state 16
 
-    expression                     shift and go to state 101
+    expression                     shift and go to state 103
     boolean_expression             shift and go to state 35
     constant                       shift and go to state 36
     function_call                  shift and go to state 37
-    var_ref                        shift and go to state 81
+    var_ref                        shift and go to state 83
     constructor                    shift and go to state 38
     list_def                       shift and go to state 39
-    map_def                        shift and go to state 40
-    map_lookup                     shift and go to state 41
-    index_lookup                   shift and go to state 42
-    conditional_expression         shift and go to state 43
-    ns_ref                         shift and go to state 83
-    attr_ref                       shift and go to state 84
-    class_ref                      shift and go to state 85
-
-state 47
-
-    (134) constant -> INT .
-
-    CMP_OP          reduce using rule 134 (constant -> INT .)
-    IN              reduce using rule 134 (constant -> INT .)
-    AND             reduce using rule 134 (constant -> INT .)
-    OR              reduce using rule 134 (constant -> INT .)
-    ?               reduce using rule 134 (constant -> INT .)
-    ENTITY          reduce using rule 134 (constant -> INT .)
-    IMPLEMENT       reduce using rule 134 (constant -> INT .)
-    IMPLEMENTATION  reduce using rule 134 (constant -> INT .)
-    INDEX           reduce using rule 134 (constant -> INT .)
-    IMPORT          reduce using rule 134 (constant -> INT .)
-    CID             reduce using rule 134 (constant -> INT .)
-    FOR             reduce using rule 134 (constant -> INT .)
-    IF              reduce using rule 134 (constant -> INT .)
-    (               reduce using rule 134 (constant -> INT .)
-    TYPEDEF         reduce using rule 134 (constant -> INT .)
-    ID              reduce using rule 134 (constant -> INT .)
-    NOT             reduce using rule 134 (constant -> INT .)
-    INT             reduce using rule 134 (constant -> INT .)
-    FLOAT           reduce using rule 134 (constant -> INT .)
-    NULL            reduce using rule 134 (constant -> INT .)
-    REGEX           reduce using rule 134 (constant -> INT .)
-    TRUE            reduce using rule 134 (constant -> INT .)
-    FALSE           reduce using rule 134 (constant -> INT .)
-    STRING          reduce using rule 134 (constant -> INT .)
-    RSTRING         reduce using rule 134 (constant -> INT .)
-    MLS             reduce using rule 134 (constant -> INT .)
-    [               reduce using rule 134 (constant -> INT .)
-    {               reduce using rule 134 (constant -> INT .)
-    $end            reduce using rule 134 (constant -> INT .)
-    )               reduce using rule 134 (constant -> INT .)
-    :               reduce using rule 134 (constant -> INT .)
-    ,               reduce using rule 134 (constant -> INT .)
-    ]               reduce using rule 134 (constant -> INT .)
-    ELSE            reduce using rule 134 (constant -> INT .)
-    ELIF            reduce using rule 134 (constant -> INT .)
-    END             reduce using rule 134 (constant -> INT .)
-    }               reduce using rule 134 (constant -> INT .)
-    DICT            reduce using rule 134 (constant -> INT .)
-
+    list_comprehension             shift and go to state 40
+    map_def                        shift and go to state 41
+    map_lookup                     shift and go to state 42
+    index_lookup                   shift and go to state 43
+    conditional_expression         shift and go to state 44
+    ns_ref                         shift and go to state 85
+    attr_ref                       shift and go to state 86
+    class_ref                      shift and go to state 87
 
 state 48
 
-    (135) constant -> FLOAT .
+    (141) constant -> INT .
 
-    CMP_OP          reduce using rule 135 (constant -> FLOAT .)
-    IN              reduce using rule 135 (constant -> FLOAT .)
-    AND             reduce using rule 135 (constant -> FLOAT .)
-    OR              reduce using rule 135 (constant -> FLOAT .)
-    ?               reduce using rule 135 (constant -> FLOAT .)
-    ENTITY          reduce using rule 135 (constant -> FLOAT .)
-    IMPLEMENT       reduce using rule 135 (constant -> FLOAT .)
-    IMPLEMENTATION  reduce using rule 135 (constant -> FLOAT .)
-    INDEX           reduce using rule 135 (constant -> FLOAT .)
-    IMPORT          reduce using rule 135 (constant -> FLOAT .)
-    CID             reduce using rule 135 (constant -> FLOAT .)
-    FOR             reduce using rule 135 (constant -> FLOAT .)
-    IF              reduce using rule 135 (constant -> FLOAT .)
-    (               reduce using rule 135 (constant -> FLOAT .)
-    TYPEDEF         reduce using rule 135 (constant -> FLOAT .)
-    ID              reduce using rule 135 (constant -> FLOAT .)
-    NOT             reduce using rule 135 (constant -> FLOAT .)
-    INT             reduce using rule 135 (constant -> FLOAT .)
-    FLOAT           reduce using rule 135 (constant -> FLOAT .)
-    NULL            reduce using rule 135 (constant -> FLOAT .)
-    REGEX           reduce using rule 135 (constant -> FLOAT .)
-    TRUE            reduce using rule 135 (constant -> FLOAT .)
-    FALSE           reduce using rule 135 (constant -> FLOAT .)
-    STRING          reduce using rule 135 (constant -> FLOAT .)
-    RSTRING         reduce using rule 135 (constant -> FLOAT .)
-    MLS             reduce using rule 135 (constant -> FLOAT .)
-    [               reduce using rule 135 (constant -> FLOAT .)
-    {               reduce using rule 135 (constant -> FLOAT .)
-    $end            reduce using rule 135 (constant -> FLOAT .)
-    )               reduce using rule 135 (constant -> FLOAT .)
-    :               reduce using rule 135 (constant -> FLOAT .)
-    ,               reduce using rule 135 (constant -> FLOAT .)
-    ]               reduce using rule 135 (constant -> FLOAT .)
-    ELSE            reduce using rule 135 (constant -> FLOAT .)
-    ELIF            reduce using rule 135 (constant -> FLOAT .)
-    END             reduce using rule 135 (constant -> FLOAT .)
-    }               reduce using rule 135 (constant -> FLOAT .)
-    DICT            reduce using rule 135 (constant -> FLOAT .)
+    CMP_OP          reduce using rule 141 (constant -> INT .)
+    IN              reduce using rule 141 (constant -> INT .)
+    AND             reduce using rule 141 (constant -> INT .)
+    OR              reduce using rule 141 (constant -> INT .)
+    ?               reduce using rule 141 (constant -> INT .)
+    ENTITY          reduce using rule 141 (constant -> INT .)
+    IMPLEMENT       reduce using rule 141 (constant -> INT .)
+    IMPLEMENTATION  reduce using rule 141 (constant -> INT .)
+    INDEX           reduce using rule 141 (constant -> INT .)
+    IMPORT          reduce using rule 141 (constant -> INT .)
+    CID             reduce using rule 141 (constant -> INT .)
+    FOR             reduce using rule 141 (constant -> INT .)
+    IF              reduce using rule 141 (constant -> INT .)
+    (               reduce using rule 141 (constant -> INT .)
+    TYPEDEF         reduce using rule 141 (constant -> INT .)
+    ID              reduce using rule 141 (constant -> INT .)
+    NOT             reduce using rule 141 (constant -> INT .)
+    INT             reduce using rule 141 (constant -> INT .)
+    FLOAT           reduce using rule 141 (constant -> INT .)
+    NULL            reduce using rule 141 (constant -> INT .)
+    REGEX           reduce using rule 141 (constant -> INT .)
+    TRUE            reduce using rule 141 (constant -> INT .)
+    FALSE           reduce using rule 141 (constant -> INT .)
+    STRING          reduce using rule 141 (constant -> INT .)
+    FSTRING         reduce using rule 141 (constant -> INT .)
+    RSTRING         reduce using rule 141 (constant -> INT .)
+    MLS             reduce using rule 141 (constant -> INT .)
+    [               reduce using rule 141 (constant -> INT .)
+    {               reduce using rule 141 (constant -> INT .)
+    $end            reduce using rule 141 (constant -> INT .)
+    )               reduce using rule 141 (constant -> INT .)
+    :               reduce using rule 141 (constant -> INT .)
+    ,               reduce using rule 141 (constant -> INT .)
+    ]               reduce using rule 141 (constant -> INT .)
+    ELSE            reduce using rule 141 (constant -> INT .)
+    ELIF            reduce using rule 141 (constant -> INT .)
+    END             reduce using rule 141 (constant -> INT .)
+    }               reduce using rule 141 (constant -> INT .)
+    DICT            reduce using rule 141 (constant -> INT .)
 
 
 state 49
 
-    (136) constant -> NULL .
+    (142) constant -> FLOAT .
 
-    CMP_OP          reduce using rule 136 (constant -> NULL .)
-    IN              reduce using rule 136 (constant -> NULL .)
-    AND             reduce using rule 136 (constant -> NULL .)
-    OR              reduce using rule 136 (constant -> NULL .)
-    ?               reduce using rule 136 (constant -> NULL .)
-    ENTITY          reduce using rule 136 (constant -> NULL .)
-    IMPLEMENT       reduce using rule 136 (constant -> NULL .)
-    IMPLEMENTATION  reduce using rule 136 (constant -> NULL .)
-    INDEX           reduce using rule 136 (constant -> NULL .)
-    IMPORT          reduce using rule 136 (constant -> NULL .)
-    CID             reduce using rule 136 (constant -> NULL .)
-    FOR             reduce using rule 136 (constant -> NULL .)
-    IF              reduce using rule 136 (constant -> NULL .)
-    (               reduce using rule 136 (constant -> NULL .)
-    TYPEDEF         reduce using rule 136 (constant -> NULL .)
-    ID              reduce using rule 136 (constant -> NULL .)
-    NOT             reduce using rule 136 (constant -> NULL .)
-    INT             reduce using rule 136 (constant -> NULL .)
-    FLOAT           reduce using rule 136 (constant -> NULL .)
-    NULL            reduce using rule 136 (constant -> NULL .)
-    REGEX           reduce using rule 136 (constant -> NULL .)
-    TRUE            reduce using rule 136 (constant -> NULL .)
-    FALSE           reduce using rule 136 (constant -> NULL .)
-    STRING          reduce using rule 136 (constant -> NULL .)
-    RSTRING         reduce using rule 136 (constant -> NULL .)
-    MLS             reduce using rule 136 (constant -> NULL .)
-    [               reduce using rule 136 (constant -> NULL .)
-    {               reduce using rule 136 (constant -> NULL .)
-    $end            reduce using rule 136 (constant -> NULL .)
-    )               reduce using rule 136 (constant -> NULL .)
-    :               reduce using rule 136 (constant -> NULL .)
-    ,               reduce using rule 136 (constant -> NULL .)
-    ]               reduce using rule 136 (constant -> NULL .)
-    ELSE            reduce using rule 136 (constant -> NULL .)
-    ELIF            reduce using rule 136 (constant -> NULL .)
-    END             reduce using rule 136 (constant -> NULL .)
-    }               reduce using rule 136 (constant -> NULL .)
-    DICT            reduce using rule 136 (constant -> NULL .)
+    CMP_OP          reduce using rule 142 (constant -> FLOAT .)
+    IN              reduce using rule 142 (constant -> FLOAT .)
+    AND             reduce using rule 142 (constant -> FLOAT .)
+    OR              reduce using rule 142 (constant -> FLOAT .)
+    ?               reduce using rule 142 (constant -> FLOAT .)
+    ENTITY          reduce using rule 142 (constant -> FLOAT .)
+    IMPLEMENT       reduce using rule 142 (constant -> FLOAT .)
+    IMPLEMENTATION  reduce using rule 142 (constant -> FLOAT .)
+    INDEX           reduce using rule 142 (constant -> FLOAT .)
+    IMPORT          reduce using rule 142 (constant -> FLOAT .)
+    CID             reduce using rule 142 (constant -> FLOAT .)
+    FOR             reduce using rule 142 (constant -> FLOAT .)
+    IF              reduce using rule 142 (constant -> FLOAT .)
+    (               reduce using rule 142 (constant -> FLOAT .)
+    TYPEDEF         reduce using rule 142 (constant -> FLOAT .)
+    ID              reduce using rule 142 (constant -> FLOAT .)
+    NOT             reduce using rule 142 (constant -> FLOAT .)
+    INT             reduce using rule 142 (constant -> FLOAT .)
+    FLOAT           reduce using rule 142 (constant -> FLOAT .)
+    NULL            reduce using rule 142 (constant -> FLOAT .)
+    REGEX           reduce using rule 142 (constant -> FLOAT .)
+    TRUE            reduce using rule 142 (constant -> FLOAT .)
+    FALSE           reduce using rule 142 (constant -> FLOAT .)
+    STRING          reduce using rule 142 (constant -> FLOAT .)
+    FSTRING         reduce using rule 142 (constant -> FLOAT .)
+    RSTRING         reduce using rule 142 (constant -> FLOAT .)
+    MLS             reduce using rule 142 (constant -> FLOAT .)
+    [               reduce using rule 142 (constant -> FLOAT .)
+    {               reduce using rule 142 (constant -> FLOAT .)
+    $end            reduce using rule 142 (constant -> FLOAT .)
+    )               reduce using rule 142 (constant -> FLOAT .)
+    :               reduce using rule 142 (constant -> FLOAT .)
+    ,               reduce using rule 142 (constant -> FLOAT .)
+    ]               reduce using rule 142 (constant -> FLOAT .)
+    ELSE            reduce using rule 142 (constant -> FLOAT .)
+    ELIF            reduce using rule 142 (constant -> FLOAT .)
+    END             reduce using rule 142 (constant -> FLOAT .)
+    }               reduce using rule 142 (constant -> FLOAT .)
+    DICT            reduce using rule 142 (constant -> FLOAT .)
 
 
 state 50
 
-    (137) constant -> REGEX .
+    (143) constant -> NULL .
 
-    CMP_OP          reduce using rule 137 (constant -> REGEX .)
-    IN              reduce using rule 137 (constant -> REGEX .)
-    AND             reduce using rule 137 (constant -> REGEX .)
-    OR              reduce using rule 137 (constant -> REGEX .)
-    ?               reduce using rule 137 (constant -> REGEX .)
-    ENTITY          reduce using rule 137 (constant -> REGEX .)
-    IMPLEMENT       reduce using rule 137 (constant -> REGEX .)
-    IMPLEMENTATION  reduce using rule 137 (constant -> REGEX .)
-    INDEX           reduce using rule 137 (constant -> REGEX .)
-    IMPORT          reduce using rule 137 (constant -> REGEX .)
-    CID             reduce using rule 137 (constant -> REGEX .)
-    FOR             reduce using rule 137 (constant -> REGEX .)
-    IF              reduce using rule 137 (constant -> REGEX .)
-    (               reduce using rule 137 (constant -> REGEX .)
-    TYPEDEF         reduce using rule 137 (constant -> REGEX .)
-    ID              reduce using rule 137 (constant -> REGEX .)
-    NOT             reduce using rule 137 (constant -> REGEX .)
-    INT             reduce using rule 137 (constant -> REGEX .)
-    FLOAT           reduce using rule 137 (constant -> REGEX .)
-    NULL            reduce using rule 137 (constant -> REGEX .)
-    REGEX           reduce using rule 137 (constant -> REGEX .)
-    TRUE            reduce using rule 137 (constant -> REGEX .)
-    FALSE           reduce using rule 137 (constant -> REGEX .)
-    STRING          reduce using rule 137 (constant -> REGEX .)
-    RSTRING         reduce using rule 137 (constant -> REGEX .)
-    MLS             reduce using rule 137 (constant -> REGEX .)
-    [               reduce using rule 137 (constant -> REGEX .)
-    {               reduce using rule 137 (constant -> REGEX .)
-    $end            reduce using rule 137 (constant -> REGEX .)
-    )               reduce using rule 137 (constant -> REGEX .)
-    :               reduce using rule 137 (constant -> REGEX .)
-    ,               reduce using rule 137 (constant -> REGEX .)
-    ]               reduce using rule 137 (constant -> REGEX .)
-    ELSE            reduce using rule 137 (constant -> REGEX .)
-    ELIF            reduce using rule 137 (constant -> REGEX .)
-    END             reduce using rule 137 (constant -> REGEX .)
-    }               reduce using rule 137 (constant -> REGEX .)
-    DICT            reduce using rule 137 (constant -> REGEX .)
+    CMP_OP          reduce using rule 143 (constant -> NULL .)
+    IN              reduce using rule 143 (constant -> NULL .)
+    AND             reduce using rule 143 (constant -> NULL .)
+    OR              reduce using rule 143 (constant -> NULL .)
+    ?               reduce using rule 143 (constant -> NULL .)
+    ENTITY          reduce using rule 143 (constant -> NULL .)
+    IMPLEMENT       reduce using rule 143 (constant -> NULL .)
+    IMPLEMENTATION  reduce using rule 143 (constant -> NULL .)
+    INDEX           reduce using rule 143 (constant -> NULL .)
+    IMPORT          reduce using rule 143 (constant -> NULL .)
+    CID             reduce using rule 143 (constant -> NULL .)
+    FOR             reduce using rule 143 (constant -> NULL .)
+    IF              reduce using rule 143 (constant -> NULL .)
+    (               reduce using rule 143 (constant -> NULL .)
+    TYPEDEF         reduce using rule 143 (constant -> NULL .)
+    ID              reduce using rule 143 (constant -> NULL .)
+    NOT             reduce using rule 143 (constant -> NULL .)
+    INT             reduce using rule 143 (constant -> NULL .)
+    FLOAT           reduce using rule 143 (constant -> NULL .)
+    NULL            reduce using rule 143 (constant -> NULL .)
+    REGEX           reduce using rule 143 (constant -> NULL .)
+    TRUE            reduce using rule 143 (constant -> NULL .)
+    FALSE           reduce using rule 143 (constant -> NULL .)
+    STRING          reduce using rule 143 (constant -> NULL .)
+    FSTRING         reduce using rule 143 (constant -> NULL .)
+    RSTRING         reduce using rule 143 (constant -> NULL .)
+    MLS             reduce using rule 143 (constant -> NULL .)
+    [               reduce using rule 143 (constant -> NULL .)
+    {               reduce using rule 143 (constant -> NULL .)
+    $end            reduce using rule 143 (constant -> NULL .)
+    )               reduce using rule 143 (constant -> NULL .)
+    :               reduce using rule 143 (constant -> NULL .)
+    ,               reduce using rule 143 (constant -> NULL .)
+    ]               reduce using rule 143 (constant -> NULL .)
+    ELSE            reduce using rule 143 (constant -> NULL .)
+    ELIF            reduce using rule 143 (constant -> NULL .)
+    END             reduce using rule 143 (constant -> NULL .)
+    }               reduce using rule 143 (constant -> NULL .)
+    DICT            reduce using rule 143 (constant -> NULL .)
 
 
 state 51
 
-    (138) constant -> TRUE .
+    (144) constant -> REGEX .
 
-    CMP_OP          reduce using rule 138 (constant -> TRUE .)
-    IN              reduce using rule 138 (constant -> TRUE .)
-    AND             reduce using rule 138 (constant -> TRUE .)
-    OR              reduce using rule 138 (constant -> TRUE .)
-    ?               reduce using rule 138 (constant -> TRUE .)
-    ENTITY          reduce using rule 138 (constant -> TRUE .)
-    IMPLEMENT       reduce using rule 138 (constant -> TRUE .)
-    IMPLEMENTATION  reduce using rule 138 (constant -> TRUE .)
-    INDEX           reduce using rule 138 (constant -> TRUE .)
-    IMPORT          reduce using rule 138 (constant -> TRUE .)
-    CID             reduce using rule 138 (constant -> TRUE .)
-    FOR             reduce using rule 138 (constant -> TRUE .)
-    IF              reduce using rule 138 (constant -> TRUE .)
-    (               reduce using rule 138 (constant -> TRUE .)
-    TYPEDEF         reduce using rule 138 (constant -> TRUE .)
-    ID              reduce using rule 138 (constant -> TRUE .)
-    NOT             reduce using rule 138 (constant -> TRUE .)
-    INT             reduce using rule 138 (constant -> TRUE .)
-    FLOAT           reduce using rule 138 (constant -> TRUE .)
-    NULL            reduce using rule 138 (constant -> TRUE .)
-    REGEX           reduce using rule 138 (constant -> TRUE .)
-    TRUE            reduce using rule 138 (constant -> TRUE .)
-    FALSE           reduce using rule 138 (constant -> TRUE .)
-    STRING          reduce using rule 138 (constant -> TRUE .)
-    RSTRING         reduce using rule 138 (constant -> TRUE .)
-    MLS             reduce using rule 138 (constant -> TRUE .)
-    [               reduce using rule 138 (constant -> TRUE .)
-    {               reduce using rule 138 (constant -> TRUE .)
-    $end            reduce using rule 138 (constant -> TRUE .)
-    )               reduce using rule 138 (constant -> TRUE .)
-    :               reduce using rule 138 (constant -> TRUE .)
-    ,               reduce using rule 138 (constant -> TRUE .)
-    ]               reduce using rule 138 (constant -> TRUE .)
-    ELSE            reduce using rule 138 (constant -> TRUE .)
-    ELIF            reduce using rule 138 (constant -> TRUE .)
-    END             reduce using rule 138 (constant -> TRUE .)
-    }               reduce using rule 138 (constant -> TRUE .)
-    DICT            reduce using rule 138 (constant -> TRUE .)
+    CMP_OP          reduce using rule 144 (constant -> REGEX .)
+    IN              reduce using rule 144 (constant -> REGEX .)
+    AND             reduce using rule 144 (constant -> REGEX .)
+    OR              reduce using rule 144 (constant -> REGEX .)
+    ?               reduce using rule 144 (constant -> REGEX .)
+    ENTITY          reduce using rule 144 (constant -> REGEX .)
+    IMPLEMENT       reduce using rule 144 (constant -> REGEX .)
+    IMPLEMENTATION  reduce using rule 144 (constant -> REGEX .)
+    INDEX           reduce using rule 144 (constant -> REGEX .)
+    IMPORT          reduce using rule 144 (constant -> REGEX .)
+    CID             reduce using rule 144 (constant -> REGEX .)
+    FOR             reduce using rule 144 (constant -> REGEX .)
+    IF              reduce using rule 144 (constant -> REGEX .)
+    (               reduce using rule 144 (constant -> REGEX .)
+    TYPEDEF         reduce using rule 144 (constant -> REGEX .)
+    ID              reduce using rule 144 (constant -> REGEX .)
+    NOT             reduce using rule 144 (constant -> REGEX .)
+    INT             reduce using rule 144 (constant -> REGEX .)
+    FLOAT           reduce using rule 144 (constant -> REGEX .)
+    NULL            reduce using rule 144 (constant -> REGEX .)
+    REGEX           reduce using rule 144 (constant -> REGEX .)
+    TRUE            reduce using rule 144 (constant -> REGEX .)
+    FALSE           reduce using rule 144 (constant -> REGEX .)
+    STRING          reduce using rule 144 (constant -> REGEX .)
+    FSTRING         reduce using rule 144 (constant -> REGEX .)
+    RSTRING         reduce using rule 144 (constant -> REGEX .)
+    MLS             reduce using rule 144 (constant -> REGEX .)
+    [               reduce using rule 144 (constant -> REGEX .)
+    {               reduce using rule 144 (constant -> REGEX .)
+    $end            reduce using rule 144 (constant -> REGEX .)
+    )               reduce using rule 144 (constant -> REGEX .)
+    :               reduce using rule 144 (constant -> REGEX .)
+    ,               reduce using rule 144 (constant -> REGEX .)
+    ]               reduce using rule 144 (constant -> REGEX .)
+    ELSE            reduce using rule 144 (constant -> REGEX .)
+    ELIF            reduce using rule 144 (constant -> REGEX .)
+    END             reduce using rule 144 (constant -> REGEX .)
+    }               reduce using rule 144 (constant -> REGEX .)
+    DICT            reduce using rule 144 (constant -> REGEX .)
 
 
 state 52
 
-    (139) constant -> FALSE .
+    (145) constant -> TRUE .
 
-    CMP_OP          reduce using rule 139 (constant -> FALSE .)
-    IN              reduce using rule 139 (constant -> FALSE .)
-    AND             reduce using rule 139 (constant -> FALSE .)
-    OR              reduce using rule 139 (constant -> FALSE .)
-    ?               reduce using rule 139 (constant -> FALSE .)
-    ENTITY          reduce using rule 139 (constant -> FALSE .)
-    IMPLEMENT       reduce using rule 139 (constant -> FALSE .)
-    IMPLEMENTATION  reduce using rule 139 (constant -> FALSE .)
-    INDEX           reduce using rule 139 (constant -> FALSE .)
-    IMPORT          reduce using rule 139 (constant -> FALSE .)
-    CID             reduce using rule 139 (constant -> FALSE .)
-    FOR             reduce using rule 139 (constant -> FALSE .)
-    IF              reduce using rule 139 (constant -> FALSE .)
-    (               reduce using rule 139 (constant -> FALSE .)
-    TYPEDEF         reduce using rule 139 (constant -> FALSE .)
-    ID              reduce using rule 139 (constant -> FALSE .)
-    NOT             reduce using rule 139 (constant -> FALSE .)
-    INT             reduce using rule 139 (constant -> FALSE .)
-    FLOAT           reduce using rule 139 (constant -> FALSE .)
-    NULL            reduce using rule 139 (constant -> FALSE .)
-    REGEX           reduce using rule 139 (constant -> FALSE .)
-    TRUE            reduce using rule 139 (constant -> FALSE .)
-    FALSE           reduce using rule 139 (constant -> FALSE .)
-    STRING          reduce using rule 139 (constant -> FALSE .)
-    RSTRING         reduce using rule 139 (constant -> FALSE .)
-    MLS             reduce using rule 139 (constant -> FALSE .)
-    [               reduce using rule 139 (constant -> FALSE .)
-    {               reduce using rule 139 (constant -> FALSE .)
-    $end            reduce using rule 139 (constant -> FALSE .)
-    )               reduce using rule 139 (constant -> FALSE .)
-    :               reduce using rule 139 (constant -> FALSE .)
-    ,               reduce using rule 139 (constant -> FALSE .)
-    ]               reduce using rule 139 (constant -> FALSE .)
-    ELSE            reduce using rule 139 (constant -> FALSE .)
-    ELIF            reduce using rule 139 (constant -> FALSE .)
-    END             reduce using rule 139 (constant -> FALSE .)
-    }               reduce using rule 139 (constant -> FALSE .)
-    DICT            reduce using rule 139 (constant -> FALSE .)
+    CMP_OP          reduce using rule 145 (constant -> TRUE .)
+    IN              reduce using rule 145 (constant -> TRUE .)
+    AND             reduce using rule 145 (constant -> TRUE .)
+    OR              reduce using rule 145 (constant -> TRUE .)
+    ?               reduce using rule 145 (constant -> TRUE .)
+    ENTITY          reduce using rule 145 (constant -> TRUE .)
+    IMPLEMENT       reduce using rule 145 (constant -> TRUE .)
+    IMPLEMENTATION  reduce using rule 145 (constant -> TRUE .)
+    INDEX           reduce using rule 145 (constant -> TRUE .)
+    IMPORT          reduce using rule 145 (constant -> TRUE .)
+    CID             reduce using rule 145 (constant -> TRUE .)
+    FOR             reduce using rule 145 (constant -> TRUE .)
+    IF              reduce using rule 145 (constant -> TRUE .)
+    (               reduce using rule 145 (constant -> TRUE .)
+    TYPEDEF         reduce using rule 145 (constant -> TRUE .)
+    ID              reduce using rule 145 (constant -> TRUE .)
+    NOT             reduce using rule 145 (constant -> TRUE .)
+    INT             reduce using rule 145 (constant -> TRUE .)
+    FLOAT           reduce using rule 145 (constant -> TRUE .)
+    NULL            reduce using rule 145 (constant -> TRUE .)
+    REGEX           reduce using rule 145 (constant -> TRUE .)
+    TRUE            reduce using rule 145 (constant -> TRUE .)
+    FALSE           reduce using rule 145 (constant -> TRUE .)
+    STRING          reduce using rule 145 (constant -> TRUE .)
+    FSTRING         reduce using rule 145 (constant -> TRUE .)
+    RSTRING         reduce using rule 145 (constant -> TRUE .)
+    MLS             reduce using rule 145 (constant -> TRUE .)
+    [               reduce using rule 145 (constant -> TRUE .)
+    {               reduce using rule 145 (constant -> TRUE .)
+    $end            reduce using rule 145 (constant -> TRUE .)
+    )               reduce using rule 145 (constant -> TRUE .)
+    :               reduce using rule 145 (constant -> TRUE .)
+    ,               reduce using rule 145 (constant -> TRUE .)
+    ]               reduce using rule 145 (constant -> TRUE .)
+    ELSE            reduce using rule 145 (constant -> TRUE .)
+    ELIF            reduce using rule 145 (constant -> TRUE .)
+    END             reduce using rule 145 (constant -> TRUE .)
+    }               reduce using rule 145 (constant -> TRUE .)
+    DICT            reduce using rule 145 (constant -> TRUE .)
 
 
 state 53
 
-    (140) constant -> STRING .
+    (146) constant -> FALSE .
 
-    CMP_OP          reduce using rule 140 (constant -> STRING .)
-    IN              reduce using rule 140 (constant -> STRING .)
-    AND             reduce using rule 140 (constant -> STRING .)
-    OR              reduce using rule 140 (constant -> STRING .)
-    ?               reduce using rule 140 (constant -> STRING .)
-    ENTITY          reduce using rule 140 (constant -> STRING .)
-    IMPLEMENT       reduce using rule 140 (constant -> STRING .)
-    IMPLEMENTATION  reduce using rule 140 (constant -> STRING .)
-    INDEX           reduce using rule 140 (constant -> STRING .)
-    IMPORT          reduce using rule 140 (constant -> STRING .)
-    CID             reduce using rule 140 (constant -> STRING .)
-    FOR             reduce using rule 140 (constant -> STRING .)
-    IF              reduce using rule 140 (constant -> STRING .)
-    (               reduce using rule 140 (constant -> STRING .)
-    TYPEDEF         reduce using rule 140 (constant -> STRING .)
-    ID              reduce using rule 140 (constant -> STRING .)
-    NOT             reduce using rule 140 (constant -> STRING .)
-    INT             reduce using rule 140 (constant -> STRING .)
-    FLOAT           reduce using rule 140 (constant -> STRING .)
-    NULL            reduce using rule 140 (constant -> STRING .)
-    REGEX           reduce using rule 140 (constant -> STRING .)
-    TRUE            reduce using rule 140 (constant -> STRING .)
-    FALSE           reduce using rule 140 (constant -> STRING .)
-    STRING          reduce using rule 140 (constant -> STRING .)
-    RSTRING         reduce using rule 140 (constant -> STRING .)
-    MLS             reduce using rule 140 (constant -> STRING .)
-    [               reduce using rule 140 (constant -> STRING .)
-    {               reduce using rule 140 (constant -> STRING .)
-    $end            reduce using rule 140 (constant -> STRING .)
-    )               reduce using rule 140 (constant -> STRING .)
-    :               reduce using rule 140 (constant -> STRING .)
-    ,               reduce using rule 140 (constant -> STRING .)
-    ]               reduce using rule 140 (constant -> STRING .)
-    ELSE            reduce using rule 140 (constant -> STRING .)
-    ELIF            reduce using rule 140 (constant -> STRING .)
-    END             reduce using rule 140 (constant -> STRING .)
-    }               reduce using rule 140 (constant -> STRING .)
-    DICT            reduce using rule 140 (constant -> STRING .)
+    CMP_OP          reduce using rule 146 (constant -> FALSE .)
+    IN              reduce using rule 146 (constant -> FALSE .)
+    AND             reduce using rule 146 (constant -> FALSE .)
+    OR              reduce using rule 146 (constant -> FALSE .)
+    ?               reduce using rule 146 (constant -> FALSE .)
+    ENTITY          reduce using rule 146 (constant -> FALSE .)
+    IMPLEMENT       reduce using rule 146 (constant -> FALSE .)
+    IMPLEMENTATION  reduce using rule 146 (constant -> FALSE .)
+    INDEX           reduce using rule 146 (constant -> FALSE .)
+    IMPORT          reduce using rule 146 (constant -> FALSE .)
+    CID             reduce using rule 146 (constant -> FALSE .)
+    FOR             reduce using rule 146 (constant -> FALSE .)
+    IF              reduce using rule 146 (constant -> FALSE .)
+    (               reduce using rule 146 (constant -> FALSE .)
+    TYPEDEF         reduce using rule 146 (constant -> FALSE .)
+    ID              reduce using rule 146 (constant -> FALSE .)
+    NOT             reduce using rule 146 (constant -> FALSE .)
+    INT             reduce using rule 146 (constant -> FALSE .)
+    FLOAT           reduce using rule 146 (constant -> FALSE .)
+    NULL            reduce using rule 146 (constant -> FALSE .)
+    REGEX           reduce using rule 146 (constant -> FALSE .)
+    TRUE            reduce using rule 146 (constant -> FALSE .)
+    FALSE           reduce using rule 146 (constant -> FALSE .)
+    STRING          reduce using rule 146 (constant -> FALSE .)
+    FSTRING         reduce using rule 146 (constant -> FALSE .)
+    RSTRING         reduce using rule 146 (constant -> FALSE .)
+    MLS             reduce using rule 146 (constant -> FALSE .)
+    [               reduce using rule 146 (constant -> FALSE .)
+    {               reduce using rule 146 (constant -> FALSE .)
+    $end            reduce using rule 146 (constant -> FALSE .)
+    )               reduce using rule 146 (constant -> FALSE .)
+    :               reduce using rule 146 (constant -> FALSE .)
+    ,               reduce using rule 146 (constant -> FALSE .)
+    ]               reduce using rule 146 (constant -> FALSE .)
+    ELSE            reduce using rule 146 (constant -> FALSE .)
+    ELIF            reduce using rule 146 (constant -> FALSE .)
+    END             reduce using rule 146 (constant -> FALSE .)
+    }               reduce using rule 146 (constant -> FALSE .)
+    DICT            reduce using rule 146 (constant -> FALSE .)
 
 
 state 54
 
-    (141) constant -> RSTRING .
+    (147) constant -> STRING .
 
-    CMP_OP          reduce using rule 141 (constant -> RSTRING .)
-    IN              reduce using rule 141 (constant -> RSTRING .)
-    AND             reduce using rule 141 (constant -> RSTRING .)
-    OR              reduce using rule 141 (constant -> RSTRING .)
-    ?               reduce using rule 141 (constant -> RSTRING .)
-    ENTITY          reduce using rule 141 (constant -> RSTRING .)
-    IMPLEMENT       reduce using rule 141 (constant -> RSTRING .)
-    IMPLEMENTATION  reduce using rule 141 (constant -> RSTRING .)
-    INDEX           reduce using rule 141 (constant -> RSTRING .)
-    IMPORT          reduce using rule 141 (constant -> RSTRING .)
-    CID             reduce using rule 141 (constant -> RSTRING .)
-    FOR             reduce using rule 141 (constant -> RSTRING .)
-    IF              reduce using rule 141 (constant -> RSTRING .)
-    (               reduce using rule 141 (constant -> RSTRING .)
-    TYPEDEF         reduce using rule 141 (constant -> RSTRING .)
-    ID              reduce using rule 141 (constant -> RSTRING .)
-    NOT             reduce using rule 141 (constant -> RSTRING .)
-    INT             reduce using rule 141 (constant -> RSTRING .)
-    FLOAT           reduce using rule 141 (constant -> RSTRING .)
-    NULL            reduce using rule 141 (constant -> RSTRING .)
-    REGEX           reduce using rule 141 (constant -> RSTRING .)
-    TRUE            reduce using rule 141 (constant -> RSTRING .)
-    FALSE           reduce using rule 141 (constant -> RSTRING .)
-    STRING          reduce using rule 141 (constant -> RSTRING .)
-    RSTRING         reduce using rule 141 (constant -> RSTRING .)
-    MLS             reduce using rule 141 (constant -> RSTRING .)
-    [               reduce using rule 141 (constant -> RSTRING .)
-    {               reduce using rule 141 (constant -> RSTRING .)
-    $end            reduce using rule 141 (constant -> RSTRING .)
-    )               reduce using rule 141 (constant -> RSTRING .)
-    :               reduce using rule 141 (constant -> RSTRING .)
-    ,               reduce using rule 141 (constant -> RSTRING .)
-    ]               reduce using rule 141 (constant -> RSTRING .)
-    ELSE            reduce using rule 141 (constant -> RSTRING .)
-    ELIF            reduce using rule 141 (constant -> RSTRING .)
-    END             reduce using rule 141 (constant -> RSTRING .)
-    }               reduce using rule 141 (constant -> RSTRING .)
-    DICT            reduce using rule 141 (constant -> RSTRING .)
+    CMP_OP          reduce using rule 147 (constant -> STRING .)
+    IN              reduce using rule 147 (constant -> STRING .)
+    AND             reduce using rule 147 (constant -> STRING .)
+    OR              reduce using rule 147 (constant -> STRING .)
+    ?               reduce using rule 147 (constant -> STRING .)
+    ENTITY          reduce using rule 147 (constant -> STRING .)
+    IMPLEMENT       reduce using rule 147 (constant -> STRING .)
+    IMPLEMENTATION  reduce using rule 147 (constant -> STRING .)
+    INDEX           reduce using rule 147 (constant -> STRING .)
+    IMPORT          reduce using rule 147 (constant -> STRING .)
+    CID             reduce using rule 147 (constant -> STRING .)
+    FOR             reduce using rule 147 (constant -> STRING .)
+    IF              reduce using rule 147 (constant -> STRING .)
+    (               reduce using rule 147 (constant -> STRING .)
+    TYPEDEF         reduce using rule 147 (constant -> STRING .)
+    ID              reduce using rule 147 (constant -> STRING .)
+    NOT             reduce using rule 147 (constant -> STRING .)
+    INT             reduce using rule 147 (constant -> STRING .)
+    FLOAT           reduce using rule 147 (constant -> STRING .)
+    NULL            reduce using rule 147 (constant -> STRING .)
+    REGEX           reduce using rule 147 (constant -> STRING .)
+    TRUE            reduce using rule 147 (constant -> STRING .)
+    FALSE           reduce using rule 147 (constant -> STRING .)
+    STRING          reduce using rule 147 (constant -> STRING .)
+    FSTRING         reduce using rule 147 (constant -> STRING .)
+    RSTRING         reduce using rule 147 (constant -> STRING .)
+    MLS             reduce using rule 147 (constant -> STRING .)
+    [               reduce using rule 147 (constant -> STRING .)
+    {               reduce using rule 147 (constant -> STRING .)
+    $end            reduce using rule 147 (constant -> STRING .)
+    )               reduce using rule 147 (constant -> STRING .)
+    :               reduce using rule 147 (constant -> STRING .)
+    ,               reduce using rule 147 (constant -> STRING .)
+    ]               reduce using rule 147 (constant -> STRING .)
+    ELSE            reduce using rule 147 (constant -> STRING .)
+    ELIF            reduce using rule 147 (constant -> STRING .)
+    END             reduce using rule 147 (constant -> STRING .)
+    }               reduce using rule 147 (constant -> STRING .)
+    DICT            reduce using rule 147 (constant -> STRING .)
 
 
 state 55
 
-    (123) list_def -> [ . operand_list ]
-    (160) operand_list -> . operand , operand_list
-    (161) operand_list -> . operand
-    (162) operand_list -> .
-    (116) operand -> . expression
+    (148) constant -> FSTRING .
+
+    CMP_OP          reduce using rule 148 (constant -> FSTRING .)
+    IN              reduce using rule 148 (constant -> FSTRING .)
+    AND             reduce using rule 148 (constant -> FSTRING .)
+    OR              reduce using rule 148 (constant -> FSTRING .)
+    ?               reduce using rule 148 (constant -> FSTRING .)
+    ENTITY          reduce using rule 148 (constant -> FSTRING .)
+    IMPLEMENT       reduce using rule 148 (constant -> FSTRING .)
+    IMPLEMENTATION  reduce using rule 148 (constant -> FSTRING .)
+    INDEX           reduce using rule 148 (constant -> FSTRING .)
+    IMPORT          reduce using rule 148 (constant -> FSTRING .)
+    CID             reduce using rule 148 (constant -> FSTRING .)
+    FOR             reduce using rule 148 (constant -> FSTRING .)
+    IF              reduce using rule 148 (constant -> FSTRING .)
+    (               reduce using rule 148 (constant -> FSTRING .)
+    TYPEDEF         reduce using rule 148 (constant -> FSTRING .)
+    ID              reduce using rule 148 (constant -> FSTRING .)
+    NOT             reduce using rule 148 (constant -> FSTRING .)
+    INT             reduce using rule 148 (constant -> FSTRING .)
+    FLOAT           reduce using rule 148 (constant -> FSTRING .)
+    NULL            reduce using rule 148 (constant -> FSTRING .)
+    REGEX           reduce using rule 148 (constant -> FSTRING .)
+    TRUE            reduce using rule 148 (constant -> FSTRING .)
+    FALSE           reduce using rule 148 (constant -> FSTRING .)
+    STRING          reduce using rule 148 (constant -> FSTRING .)
+    FSTRING         reduce using rule 148 (constant -> FSTRING .)
+    RSTRING         reduce using rule 148 (constant -> FSTRING .)
+    MLS             reduce using rule 148 (constant -> FSTRING .)
+    [               reduce using rule 148 (constant -> FSTRING .)
+    {               reduce using rule 148 (constant -> FSTRING .)
+    $end            reduce using rule 148 (constant -> FSTRING .)
+    )               reduce using rule 148 (constant -> FSTRING .)
+    :               reduce using rule 148 (constant -> FSTRING .)
+    ,               reduce using rule 148 (constant -> FSTRING .)
+    ]               reduce using rule 148 (constant -> FSTRING .)
+    ELSE            reduce using rule 148 (constant -> FSTRING .)
+    ELIF            reduce using rule 148 (constant -> FSTRING .)
+    END             reduce using rule 148 (constant -> FSTRING .)
+    }               reduce using rule 148 (constant -> FSTRING .)
+    DICT            reduce using rule 148 (constant -> FSTRING .)
+
+
+state 56
+
+    (149) constant -> RSTRING .
+
+    CMP_OP          reduce using rule 149 (constant -> RSTRING .)
+    IN              reduce using rule 149 (constant -> RSTRING .)
+    AND             reduce using rule 149 (constant -> RSTRING .)
+    OR              reduce using rule 149 (constant -> RSTRING .)
+    ?               reduce using rule 149 (constant -> RSTRING .)
+    ENTITY          reduce using rule 149 (constant -> RSTRING .)
+    IMPLEMENT       reduce using rule 149 (constant -> RSTRING .)
+    IMPLEMENTATION  reduce using rule 149 (constant -> RSTRING .)
+    INDEX           reduce using rule 149 (constant -> RSTRING .)
+    IMPORT          reduce using rule 149 (constant -> RSTRING .)
+    CID             reduce using rule 149 (constant -> RSTRING .)
+    FOR             reduce using rule 149 (constant -> RSTRING .)
+    IF              reduce using rule 149 (constant -> RSTRING .)
+    (               reduce using rule 149 (constant -> RSTRING .)
+    TYPEDEF         reduce using rule 149 (constant -> RSTRING .)
+    ID              reduce using rule 149 (constant -> RSTRING .)
+    NOT             reduce using rule 149 (constant -> RSTRING .)
+    INT             reduce using rule 149 (constant -> RSTRING .)
+    FLOAT           reduce using rule 149 (constant -> RSTRING .)
+    NULL            reduce using rule 149 (constant -> RSTRING .)
+    REGEX           reduce using rule 149 (constant -> RSTRING .)
+    TRUE            reduce using rule 149 (constant -> RSTRING .)
+    FALSE           reduce using rule 149 (constant -> RSTRING .)
+    STRING          reduce using rule 149 (constant -> RSTRING .)
+    FSTRING         reduce using rule 149 (constant -> RSTRING .)
+    RSTRING         reduce using rule 149 (constant -> RSTRING .)
+    MLS             reduce using rule 149 (constant -> RSTRING .)
+    [               reduce using rule 149 (constant -> RSTRING .)
+    {               reduce using rule 149 (constant -> RSTRING .)
+    $end            reduce using rule 149 (constant -> RSTRING .)
+    )               reduce using rule 149 (constant -> RSTRING .)
+    :               reduce using rule 149 (constant -> RSTRING .)
+    ,               reduce using rule 149 (constant -> RSTRING .)
+    ]               reduce using rule 149 (constant -> RSTRING .)
+    ELSE            reduce using rule 149 (constant -> RSTRING .)
+    ELIF            reduce using rule 149 (constant -> RSTRING .)
+    END             reduce using rule 149 (constant -> RSTRING .)
+    }               reduce using rule 149 (constant -> RSTRING .)
+    DICT            reduce using rule 149 (constant -> RSTRING .)
+
+
+state 57
+
+    (124) list_def -> [ . operand_list ]
+    (125) list_comprehension -> [ . expression list_comprehension_for list_comprehension_guard ]
+    (168) operand_list -> . operand , operand_list
+    (169) operand_list -> . operand
+    (170) operand_list -> .
     (97) expression -> . boolean_expression
     (98) expression -> . constant
     (99) expression -> . function_call
     (100) expression -> . var_ref
     (101) expression -> . constructor
     (102) expression -> . list_def
-    (103) expression -> . map_def
-    (104) expression -> . map_lookup
-    (105) expression -> . index_lookup
-    (106) expression -> . conditional_expression
-    (107) expression -> . ( expression )
-    (108) boolean_expression -> . expression CMP_OP expression
-    (109) boolean_expression -> . expression IN expression
-    (110) boolean_expression -> . expression AND expression
-    (111) boolean_expression -> . expression OR expression
-    (112) boolean_expression -> . NOT expression
-    (113) boolean_expression -> . var_ref . ID IS DEFINED
-    (114) boolean_expression -> . ID IS DEFINED
-    (115) boolean_expression -> . map_lookup IS DEFINED
-    (134) constant -> . INT
-    (135) constant -> . FLOAT
-    (136) constant -> . NULL
-    (137) constant -> . REGEX
-    (138) constant -> . TRUE
-    (139) constant -> . FALSE
-    (140) constant -> . STRING
-    (141) constant -> . RSTRING
-    (142) constant -> . MLS
-    (121) function_call -> . ns_ref ( function_param_list )
-    (122) function_call -> . attr_ref ( function_param_list )
-    (163) var_ref -> . attr_ref
-    (165) var_ref -> . ns_ref
-    (120) constructor -> . class_ref ( param_list )
-    (123) list_def -> . [ operand_list ]
-    (130) map_def -> . { pair_list }
-    (117) map_lookup -> . attr_ref [ operand ]
-    (118) map_lookup -> . var_ref [ operand ]
-    (119) map_lookup -> . map_lookup [ operand ]
-    (131) index_lookup -> . class_ref [ param_list ]
-    (132) index_lookup -> . attr_ref [ param_list ]
-    (133) conditional_expression -> . expression ? expression : expression
-    (173) ns_ref -> . ns_ref SEP ID
-    (174) ns_ref -> . ID
-    (164) attr_ref -> . var_ref . ID
-    (166) class_ref -> . CID
-    (167) class_ref -> . ns_ref SEP CID
-    (168) class_ref -> . var_ref . CID
+    (103) expression -> . list_comprehension
+    (104) expression -> . map_def
+    (105) expression -> . map_lookup
+    (106) expression -> . index_lookup
+    (107) expression -> . conditional_expression
+    (108) expression -> . ( expression )
+    (117) operand -> . expression
+    (109) boolean_expression -> . expression CMP_OP expression
+    (110) boolean_expression -> . expression IN expression
+    (111) boolean_expression -> . expression AND expression
+    (112) boolean_expression -> . expression OR expression
+    (113) boolean_expression -> . NOT expression
+    (114) boolean_expression -> . var_ref . ID IS DEFINED
+    (115) boolean_expression -> . ID IS DEFINED
+    (116) boolean_expression -> . map_lookup IS DEFINED
+    (141) constant -> . INT
+    (142) constant -> . FLOAT
+    (143) constant -> . NULL
+    (144) constant -> . REGEX
+    (145) constant -> . TRUE
+    (146) constant -> . FALSE
+    (147) constant -> . STRING
+    (148) constant -> . FSTRING
+    (149) constant -> . RSTRING
+    (150) constant -> . MLS
+    (122) function_call -> . ns_ref ( function_param_list )
+    (123) function_call -> . attr_ref ( function_param_list )
+    (171) var_ref -> . attr_ref
+    (173) var_ref -> . ns_ref
+    (121) constructor -> . class_ref ( param_list )
+    (124) list_def -> . [ operand_list ]
+    (125) list_comprehension -> . [ expression list_comprehension_for list_comprehension_guard ]
+    (137) map_def -> . { pair_list }
+    (118) map_lookup -> . attr_ref [ operand ]
+    (119) map_lookup -> . var_ref [ operand ]
+    (120) map_lookup -> . map_lookup [ operand ]
+    (138) index_lookup -> . class_ref [ param_list ]
+    (139) index_lookup -> . attr_ref [ param_list ]
+    (140) conditional_expression -> . expression ? expression : expression
+    (181) ns_ref -> . ns_ref SEP ID
+    (182) ns_ref -> . ID
+    (172) attr_ref -> . var_ref . ID
+    (174) class_ref -> . CID
+    (175) class_ref -> . ns_ref SEP CID
+    (176) class_ref -> . var_ref . CID
 
-    ]               reduce using rule 162 (operand_list -> .)
+    ]               reduce using rule 170 (operand_list -> .)
     (               shift and go to state 30
-    NOT             shift and go to state 46
-    ID              shift and go to state 82
-    INT             shift and go to state 47
-    FLOAT           shift and go to state 48
-    NULL            shift and go to state 49
-    REGEX           shift and go to state 50
-    TRUE            shift and go to state 51
-    FALSE           shift and go to state 52
-    STRING          shift and go to state 53
-    RSTRING         shift and go to state 54
+    NOT             shift and go to state 47
+    ID              shift and go to state 84
+    INT             shift and go to state 48
+    FLOAT           shift and go to state 49
+    NULL            shift and go to state 50
+    REGEX           shift and go to state 51
+    TRUE            shift and go to state 52
+    FALSE           shift and go to state 53
+    STRING          shift and go to state 54
+    FSTRING         shift and go to state 55
+    RSTRING         shift and go to state 56
     MLS             shift and go to state 20
-    [               shift and go to state 55
-    {               shift and go to state 56
+    [               shift and go to state 57
+    {               shift and go to state 58
     CID             shift and go to state 16
 
-    operand_list                   shift and go to state 102
-    operand                        shift and go to state 103
-    expression                     shift and go to state 104
+    operand_list                   shift and go to state 104
+    expression                     shift and go to state 105
+    operand                        shift and go to state 106
     boolean_expression             shift and go to state 35
     constant                       shift and go to state 36
     function_call                  shift and go to state 37
-    var_ref                        shift and go to state 81
+    var_ref                        shift and go to state 83
     constructor                    shift and go to state 38
     list_def                       shift and go to state 39
-    map_def                        shift and go to state 40
-    map_lookup                     shift and go to state 41
-    index_lookup                   shift and go to state 42
-    conditional_expression         shift and go to state 43
-    ns_ref                         shift and go to state 83
-    attr_ref                       shift and go to state 84
-    class_ref                      shift and go to state 85
+    list_comprehension             shift and go to state 40
+    map_def                        shift and go to state 41
+    map_lookup                     shift and go to state 42
+    index_lookup                   shift and go to state 43
+    conditional_expression         shift and go to state 44
+    ns_ref                         shift and go to state 85
+    attr_ref                       shift and go to state 86
+    class_ref                      shift and go to state 87
 
-state 56
+state 58
 
-    (130) map_def -> { . pair_list }
-    (126) pair_list -> . dict_key : operand , pair_list
-    (127) pair_list -> . dict_key : operand empty pair_list_empty
-    (128) pair_list -> . pair_list_empty
-    (124) dict_key -> . RSTRING
-    (125) dict_key -> . STRING
-    (129) pair_list_empty -> . empty
+    (137) map_def -> { . pair_list }
+    (133) pair_list -> . dict_key : operand , pair_list
+    (134) pair_list -> . dict_key : operand empty pair_list_empty
+    (135) pair_list -> . pair_list_empty
+    (131) dict_key -> . RSTRING
+    (132) dict_key -> . STRING
+    (136) pair_list_empty -> . empty
     (14) empty -> .
 
-    RSTRING         shift and go to state 109
-    STRING          shift and go to state 110
+    RSTRING         shift and go to state 111
+    STRING          shift and go to state 112
     }               reduce using rule 14 (empty -> .)
 
-    pair_list                      shift and go to state 105
-    dict_key                       shift and go to state 106
-    empty                          shift and go to state 107
-    pair_list_empty                shift and go to state 108
+    pair_list                      shift and go to state 107
+    dict_key                       shift and go to state 108
+    empty                          shift and go to state 109
+    pair_list_empty                shift and go to state 110
 
-state 57
+state 59
 
     (4) body -> top_stmt body .
 
     $end            reduce using rule 4 (body -> top_stmt body .)
 
 
-state 58
+state 60
 
     (31) entity_def -> ENTITY CID . : entity_body_outer
     (33) entity_def -> ENTITY CID . EXTENDS class_ref_list : entity_body_outer
 
-    :               shift and go to state 111
-    EXTENDS         shift and go to state 112
+    :               shift and go to state 113
+    EXTENDS         shift and go to state 114
 
 
-state 59
+state 61
 
     (32) entity_def -> ENTITY ID . : entity_body_outer
     (34) entity_def -> ENTITY ID . EXTENDS class_ref_list : entity_body_outer
 
-    :               shift and go to state 113
-    EXTENDS         shift and go to state 114
+    :               shift and go to state 115
+    EXTENDS         shift and go to state 116
 
 
-state 60
+state 62
 
-    (114) boolean_expression -> ID IS . DEFINED
+    (115) boolean_expression -> ID IS . DEFINED
 
-    DEFINED         shift and go to state 115
+    DEFINED         shift and go to state 117
 
 
-state 61
+state 63
 
     (71) implement_def -> IMPLEMENT class_ref . USING implement_ns_list empty
     (72) implement_def -> IMPLEMENT class_ref . USING implement_ns_list MLS
     (73) implement_def -> IMPLEMENT class_ref . USING implement_ns_list WHEN expression empty
     (74) implement_def -> IMPLEMENT class_ref . USING implement_ns_list WHEN expression MLS
 
-    USING           shift and go to state 116
+    USING           shift and go to state 118
 
 
-state 62
+state 64
 
-    (167) class_ref -> ns_ref . SEP CID
-    (173) ns_ref -> ns_ref . SEP ID
-    (165) var_ref -> ns_ref .
+    (175) class_ref -> ns_ref . SEP CID
+    (181) ns_ref -> ns_ref . SEP ID
+    (173) var_ref -> ns_ref .
 
-    SEP             shift and go to state 87
-    .               reduce using rule 165 (var_ref -> ns_ref .)
+    SEP             shift and go to state 89
+    .               reduce using rule 173 (var_ref -> ns_ref .)
 
 
-state 63
+state 65
 
-    (168) class_ref -> var_ref . . CID
-    (164) attr_ref -> var_ref . . ID
+    (176) class_ref -> var_ref . . CID
+    (172) attr_ref -> var_ref . . ID
 
-    .               shift and go to state 117
+    .               shift and go to state 119
 
 
-state 64
+state 66
 
-    (174) ns_ref -> ID .
+    (182) ns_ref -> ID .
 
-    SEP             reduce using rule 174 (ns_ref -> ID .)
-    .               reduce using rule 174 (ns_ref -> ID .)
-    AS              reduce using rule 174 (ns_ref -> ID .)
-    ENTITY          reduce using rule 174 (ns_ref -> ID .)
-    IMPLEMENT       reduce using rule 174 (ns_ref -> ID .)
-    IMPLEMENTATION  reduce using rule 174 (ns_ref -> ID .)
-    INDEX           reduce using rule 174 (ns_ref -> ID .)
-    IMPORT          reduce using rule 174 (ns_ref -> ID .)
-    CID             reduce using rule 174 (ns_ref -> ID .)
-    FOR             reduce using rule 174 (ns_ref -> ID .)
-    IF              reduce using rule 174 (ns_ref -> ID .)
-    (               reduce using rule 174 (ns_ref -> ID .)
-    TYPEDEF         reduce using rule 174 (ns_ref -> ID .)
-    ID              reduce using rule 174 (ns_ref -> ID .)
-    NOT             reduce using rule 174 (ns_ref -> ID .)
-    INT             reduce using rule 174 (ns_ref -> ID .)
-    FLOAT           reduce using rule 174 (ns_ref -> ID .)
-    NULL            reduce using rule 174 (ns_ref -> ID .)
-    REGEX           reduce using rule 174 (ns_ref -> ID .)
-    TRUE            reduce using rule 174 (ns_ref -> ID .)
-    FALSE           reduce using rule 174 (ns_ref -> ID .)
-    STRING          reduce using rule 174 (ns_ref -> ID .)
-    RSTRING         reduce using rule 174 (ns_ref -> ID .)
-    MLS             reduce using rule 174 (ns_ref -> ID .)
-    [               reduce using rule 174 (ns_ref -> ID .)
-    {               reduce using rule 174 (ns_ref -> ID .)
-    $end            reduce using rule 174 (ns_ref -> ID .)
-    ?               reduce using rule 174 (ns_ref -> ID .)
-    ,               reduce using rule 174 (ns_ref -> ID .)
-    :               reduce using rule 174 (ns_ref -> ID .)
-    WHEN            reduce using rule 174 (ns_ref -> ID .)
-    MATCHING        reduce using rule 174 (ns_ref -> ID .)
+    SEP             reduce using rule 182 (ns_ref -> ID .)
+    .               reduce using rule 182 (ns_ref -> ID .)
+    AS              reduce using rule 182 (ns_ref -> ID .)
+    ENTITY          reduce using rule 182 (ns_ref -> ID .)
+    IMPLEMENT       reduce using rule 182 (ns_ref -> ID .)
+    IMPLEMENTATION  reduce using rule 182 (ns_ref -> ID .)
+    INDEX           reduce using rule 182 (ns_ref -> ID .)
+    IMPORT          reduce using rule 182 (ns_ref -> ID .)
+    CID             reduce using rule 182 (ns_ref -> ID .)
+    FOR             reduce using rule 182 (ns_ref -> ID .)
+    IF              reduce using rule 182 (ns_ref -> ID .)
+    (               reduce using rule 182 (ns_ref -> ID .)
+    TYPEDEF         reduce using rule 182 (ns_ref -> ID .)
+    ID              reduce using rule 182 (ns_ref -> ID .)
+    NOT             reduce using rule 182 (ns_ref -> ID .)
+    INT             reduce using rule 182 (ns_ref -> ID .)
+    FLOAT           reduce using rule 182 (ns_ref -> ID .)
+    NULL            reduce using rule 182 (ns_ref -> ID .)
+    REGEX           reduce using rule 182 (ns_ref -> ID .)
+    TRUE            reduce using rule 182 (ns_ref -> ID .)
+    FALSE           reduce using rule 182 (ns_ref -> ID .)
+    STRING          reduce using rule 182 (ns_ref -> ID .)
+    FSTRING         reduce using rule 182 (ns_ref -> ID .)
+    RSTRING         reduce using rule 182 (ns_ref -> ID .)
+    MLS             reduce using rule 182 (ns_ref -> ID .)
+    [               reduce using rule 182 (ns_ref -> ID .)
+    {               reduce using rule 182 (ns_ref -> ID .)
+    $end            reduce using rule 182 (ns_ref -> ID .)
+    ?               reduce using rule 182 (ns_ref -> ID .)
+    ,               reduce using rule 182 (ns_ref -> ID .)
+    :               reduce using rule 182 (ns_ref -> ID .)
+    WHEN            reduce using rule 182 (ns_ref -> ID .)
+    MATCHING        reduce using rule 182 (ns_ref -> ID .)
 
 
-state 65
+state 67
 
-    (163) var_ref -> attr_ref .
+    (171) var_ref -> attr_ref .
 
-    .               reduce using rule 163 (var_ref -> attr_ref .)
-    ,               reduce using rule 163 (var_ref -> attr_ref .)
-    :               reduce using rule 163 (var_ref -> attr_ref .)
+    .               reduce using rule 171 (var_ref -> attr_ref .)
+    ,               reduce using rule 171 (var_ref -> attr_ref .)
+    :               reduce using rule 171 (var_ref -> attr_ref .)
 
 
-state 66
+state 68
 
     (80) relation -> class_ref ID . multi REL multi class_ref ID
     (81) relation -> class_ref ID . multi REL multi class_ref ID MLS
     (88) multi -> . [ INT ]
     (89) multi -> . [ INT : ]
     (90) multi -> . [ INT : INT ]
     (91) multi -> . [ : INT ]
 
-    [               shift and go to state 119
+    [               shift and go to state 121
 
-    multi                          shift and go to state 118
+    multi                          shift and go to state 120
 
-state 67
+state 69
 
     (84) relation_def -> class_ref . . ID multi REL class_ref . ID multi
     (85) relation_def -> class_ref . . ID multi REL class_ref
     (86) relation_def -> class_ref . . ID multi operand_list class_ref . ID multi
     (87) relation_def -> class_ref . . ID multi operand_list class_ref
 
-    ID              shift and go to state 120
+    ID              shift and go to state 122
 
 
-state 68
+state 70
 
-    (120) constructor -> class_ref ( . param_list )
-    (150) param_list -> . param_list_empty
-    (152) param_list -> . param_list_element empty param_list_empty
-    (153) param_list -> . param_list_element , param_list
-    (151) param_list_empty -> . empty
-    (148) param_list_element -> . ID = operand
-    (149) param_list_element -> . wrapped_kwargs
+    (121) constructor -> class_ref ( . param_list )
+    (158) param_list -> . param_list_empty
+    (160) param_list -> . param_list_element empty param_list_empty
+    (161) param_list -> . param_list_element , param_list
+    (159) param_list_empty -> . empty
+    (156) param_list_element -> . ID = operand
+    (157) param_list_element -> . wrapped_kwargs
     (14) empty -> .
-    (147) wrapped_kwargs -> . * * operand
+    (155) wrapped_kwargs -> . * * operand
 
-    ID              shift and go to state 125
+    ID              shift and go to state 127
     )               reduce using rule 14 (empty -> .)
-    *               shift and go to state 127
+    *               shift and go to state 129
 
-    param_list                     shift and go to state 121
-    param_list_empty               shift and go to state 122
-    param_list_element             shift and go to state 123
-    empty                          shift and go to state 124
-    wrapped_kwargs                 shift and go to state 126
+    param_list                     shift and go to state 123
+    param_list_empty               shift and go to state 124
+    param_list_element             shift and go to state 125
+    empty                          shift and go to state 126
+    wrapped_kwargs                 shift and go to state 128
 
-state 69
+state 71
 
-    (131) index_lookup -> class_ref [ . param_list ]
-    (150) param_list -> . param_list_empty
-    (152) param_list -> . param_list_element empty param_list_empty
-    (153) param_list -> . param_list_element , param_list
-    (151) param_list_empty -> . empty
-    (148) param_list_element -> . ID = operand
-    (149) param_list_element -> . wrapped_kwargs
+    (138) index_lookup -> class_ref [ . param_list ]
+    (158) param_list -> . param_list_empty
+    (160) param_list -> . param_list_element empty param_list_empty
+    (161) param_list -> . param_list_element , param_list
+    (159) param_list_empty -> . empty
+    (156) param_list_element -> . ID = operand
+    (157) param_list_element -> . wrapped_kwargs
     (14) empty -> .
-    (147) wrapped_kwargs -> . * * operand
+    (155) wrapped_kwargs -> . * * operand
 
-    ID              shift and go to state 125
+    ID              shift and go to state 127
     ]               reduce using rule 14 (empty -> .)
-    *               shift and go to state 127
+    *               shift and go to state 129
 
-    param_list                     shift and go to state 128
-    param_list_empty               shift and go to state 122
-    param_list_element             shift and go to state 123
-    empty                          shift and go to state 124
-    wrapped_kwargs                 shift and go to state 126
+    param_list                     shift and go to state 130
+    param_list_empty               shift and go to state 124
+    param_list_element             shift and go to state 125
+    empty                          shift and go to state 126
+    wrapped_kwargs                 shift and go to state 128
 
-state 70
+state 72
 
-    (108) boolean_expression -> expression CMP_OP . expression
+    (109) boolean_expression -> expression CMP_OP . expression
     (97) expression -> . boolean_expression
     (98) expression -> . constant
     (99) expression -> . function_call
     (100) expression -> . var_ref
     (101) expression -> . constructor
     (102) expression -> . list_def
-    (103) expression -> . map_def
-    (104) expression -> . map_lookup
-    (105) expression -> . index_lookup
-    (106) expression -> . conditional_expression
-    (107) expression -> . ( expression )
-    (108) boolean_expression -> . expression CMP_OP expression
-    (109) boolean_expression -> . expression IN expression
-    (110) boolean_expression -> . expression AND expression
-    (111) boolean_expression -> . expression OR expression
-    (112) boolean_expression -> . NOT expression
-    (113) boolean_expression -> . var_ref . ID IS DEFINED
-    (114) boolean_expression -> . ID IS DEFINED
-    (115) boolean_expression -> . map_lookup IS DEFINED
-    (134) constant -> . INT
-    (135) constant -> . FLOAT
-    (136) constant -> . NULL
-    (137) constant -> . REGEX
-    (138) constant -> . TRUE
-    (139) constant -> . FALSE
-    (140) constant -> . STRING
-    (141) constant -> . RSTRING
-    (142) constant -> . MLS
-    (121) function_call -> . ns_ref ( function_param_list )
-    (122) function_call -> . attr_ref ( function_param_list )
-    (163) var_ref -> . attr_ref
-    (165) var_ref -> . ns_ref
-    (120) constructor -> . class_ref ( param_list )
-    (123) list_def -> . [ operand_list ]
-    (130) map_def -> . { pair_list }
-    (117) map_lookup -> . attr_ref [ operand ]
-    (118) map_lookup -> . var_ref [ operand ]
-    (119) map_lookup -> . map_lookup [ operand ]
-    (131) index_lookup -> . class_ref [ param_list ]
-    (132) index_lookup -> . attr_ref [ param_list ]
-    (133) conditional_expression -> . expression ? expression : expression
-    (173) ns_ref -> . ns_ref SEP ID
-    (174) ns_ref -> . ID
-    (164) attr_ref -> . var_ref . ID
-    (166) class_ref -> . CID
-    (167) class_ref -> . ns_ref SEP CID
-    (168) class_ref -> . var_ref . CID
+    (103) expression -> . list_comprehension
+    (104) expression -> . map_def
+    (105) expression -> . map_lookup
+    (106) expression -> . index_lookup
+    (107) expression -> . conditional_expression
+    (108) expression -> . ( expression )
+    (109) boolean_expression -> . expression CMP_OP expression
+    (110) boolean_expression -> . expression IN expression
+    (111) boolean_expression -> . expression AND expression
+    (112) boolean_expression -> . expression OR expression
+    (113) boolean_expression -> . NOT expression
+    (114) boolean_expression -> . var_ref . ID IS DEFINED
+    (115) boolean_expression -> . ID IS DEFINED
+    (116) boolean_expression -> . map_lookup IS DEFINED
+    (141) constant -> . INT
+    (142) constant -> . FLOAT
+    (143) constant -> . NULL
+    (144) constant -> . REGEX
+    (145) constant -> . TRUE
+    (146) constant -> . FALSE
+    (147) constant -> . STRING
+    (148) constant -> . FSTRING
+    (149) constant -> . RSTRING
+    (150) constant -> . MLS
+    (122) function_call -> . ns_ref ( function_param_list )
+    (123) function_call -> . attr_ref ( function_param_list )
+    (171) var_ref -> . attr_ref
+    (173) var_ref -> . ns_ref
+    (121) constructor -> . class_ref ( param_list )
+    (124) list_def -> . [ operand_list ]
+    (125) list_comprehension -> . [ expression list_comprehension_for list_comprehension_guard ]
+    (137) map_def -> . { pair_list }
+    (118) map_lookup -> . attr_ref [ operand ]
+    (119) map_lookup -> . var_ref [ operand ]
+    (120) map_lookup -> . map_lookup [ operand ]
+    (138) index_lookup -> . class_ref [ param_list ]
+    (139) index_lookup -> . attr_ref [ param_list ]
+    (140) conditional_expression -> . expression ? expression : expression
+    (181) ns_ref -> . ns_ref SEP ID
+    (182) ns_ref -> . ID
+    (172) attr_ref -> . var_ref . ID
+    (174) class_ref -> . CID
+    (175) class_ref -> . ns_ref SEP CID
+    (176) class_ref -> . var_ref . CID
 
     (               shift and go to state 30
-    NOT             shift and go to state 46
-    ID              shift and go to state 82
-    INT             shift and go to state 47
-    FLOAT           shift and go to state 48
-    NULL            shift and go to state 49
-    REGEX           shift and go to state 50
-    TRUE            shift and go to state 51
-    FALSE           shift and go to state 52
-    STRING          shift and go to state 53
-    RSTRING         shift and go to state 54
+    NOT             shift and go to state 47
+    ID              shift and go to state 84
+    INT             shift and go to state 48
+    FLOAT           shift and go to state 49
+    NULL            shift and go to state 50
+    REGEX           shift and go to state 51
+    TRUE            shift and go to state 52
+    FALSE           shift and go to state 53
+    STRING          shift and go to state 54
+    FSTRING         shift and go to state 55
+    RSTRING         shift and go to state 56
     MLS             shift and go to state 20
-    [               shift and go to state 55
-    {               shift and go to state 56
+    [               shift and go to state 57
+    {               shift and go to state 58
     CID             shift and go to state 16
 
-    expression                     shift and go to state 129
+    expression                     shift and go to state 131
     boolean_expression             shift and go to state 35
     constant                       shift and go to state 36
     function_call                  shift and go to state 37
-    var_ref                        shift and go to state 81
+    var_ref                        shift and go to state 83
     constructor                    shift and go to state 38
     list_def                       shift and go to state 39
-    map_def                        shift and go to state 40
-    map_lookup                     shift and go to state 41
-    index_lookup                   shift and go to state 42
-    conditional_expression         shift and go to state 43
-    ns_ref                         shift and go to state 83
-    attr_ref                       shift and go to state 84
-    class_ref                      shift and go to state 85
+    list_comprehension             shift and go to state 40
+    map_def                        shift and go to state 41
+    map_lookup                     shift and go to state 42
+    index_lookup                   shift and go to state 43
+    conditional_expression         shift and go to state 44
+    ns_ref                         shift and go to state 85
+    attr_ref                       shift and go to state 86
+    class_ref                      shift and go to state 87
 
-state 71
+state 73
 
-    (109) boolean_expression -> expression IN . expression
+    (110) boolean_expression -> expression IN . expression
     (97) expression -> . boolean_expression
     (98) expression -> . constant
     (99) expression -> . function_call
     (100) expression -> . var_ref
     (101) expression -> . constructor
     (102) expression -> . list_def
-    (103) expression -> . map_def
-    (104) expression -> . map_lookup
-    (105) expression -> . index_lookup
-    (106) expression -> . conditional_expression
-    (107) expression -> . ( expression )
-    (108) boolean_expression -> . expression CMP_OP expression
-    (109) boolean_expression -> . expression IN expression
-    (110) boolean_expression -> . expression AND expression
-    (111) boolean_expression -> . expression OR expression
-    (112) boolean_expression -> . NOT expression
-    (113) boolean_expression -> . var_ref . ID IS DEFINED
-    (114) boolean_expression -> . ID IS DEFINED
-    (115) boolean_expression -> . map_lookup IS DEFINED
-    (134) constant -> . INT
-    (135) constant -> . FLOAT
-    (136) constant -> . NULL
-    (137) constant -> . REGEX
-    (138) constant -> . TRUE
-    (139) constant -> . FALSE
-    (140) constant -> . STRING
-    (141) constant -> . RSTRING
-    (142) constant -> . MLS
-    (121) function_call -> . ns_ref ( function_param_list )
-    (122) function_call -> . attr_ref ( function_param_list )
-    (163) var_ref -> . attr_ref
-    (165) var_ref -> . ns_ref
-    (120) constructor -> . class_ref ( param_list )
-    (123) list_def -> . [ operand_list ]
-    (130) map_def -> . { pair_list }
-    (117) map_lookup -> . attr_ref [ operand ]
-    (118) map_lookup -> . var_ref [ operand ]
-    (119) map_lookup -> . map_lookup [ operand ]
-    (131) index_lookup -> . class_ref [ param_list ]
-    (132) index_lookup -> . attr_ref [ param_list ]
-    (133) conditional_expression -> . expression ? expression : expression
-    (173) ns_ref -> . ns_ref SEP ID
-    (174) ns_ref -> . ID
-    (164) attr_ref -> . var_ref . ID
-    (166) class_ref -> . CID
-    (167) class_ref -> . ns_ref SEP CID
-    (168) class_ref -> . var_ref . CID
+    (103) expression -> . list_comprehension
+    (104) expression -> . map_def
+    (105) expression -> . map_lookup
+    (106) expression -> . index_lookup
+    (107) expression -> . conditional_expression
+    (108) expression -> . ( expression )
+    (109) boolean_expression -> . expression CMP_OP expression
+    (110) boolean_expression -> . expression IN expression
+    (111) boolean_expression -> . expression AND expression
+    (112) boolean_expression -> . expression OR expression
+    (113) boolean_expression -> . NOT expression
+    (114) boolean_expression -> . var_ref . ID IS DEFINED
+    (115) boolean_expression -> . ID IS DEFINED
+    (116) boolean_expression -> . map_lookup IS DEFINED
+    (141) constant -> . INT
+    (142) constant -> . FLOAT
+    (143) constant -> . NULL
+    (144) constant -> . REGEX
+    (145) constant -> . TRUE
+    (146) constant -> . FALSE
+    (147) constant -> . STRING
+    (148) constant -> . FSTRING
+    (149) constant -> . RSTRING
+    (150) constant -> . MLS
+    (122) function_call -> . ns_ref ( function_param_list )
+    (123) function_call -> . attr_ref ( function_param_list )
+    (171) var_ref -> . attr_ref
+    (173) var_ref -> . ns_ref
+    (121) constructor -> . class_ref ( param_list )
+    (124) list_def -> . [ operand_list ]
+    (125) list_comprehension -> . [ expression list_comprehension_for list_comprehension_guard ]
+    (137) map_def -> . { pair_list }
+    (118) map_lookup -> . attr_ref [ operand ]
+    (119) map_lookup -> . var_ref [ operand ]
+    (120) map_lookup -> . map_lookup [ operand ]
+    (138) index_lookup -> . class_ref [ param_list ]
+    (139) index_lookup -> . attr_ref [ param_list ]
+    (140) conditional_expression -> . expression ? expression : expression
+    (181) ns_ref -> . ns_ref SEP ID
+    (182) ns_ref -> . ID
+    (172) attr_ref -> . var_ref . ID
+    (174) class_ref -> . CID
+    (175) class_ref -> . ns_ref SEP CID
+    (176) class_ref -> . var_ref . CID
 
     (               shift and go to state 30
-    NOT             shift and go to state 46
-    ID              shift and go to state 82
-    INT             shift and go to state 47
-    FLOAT           shift and go to state 48
-    NULL            shift and go to state 49
-    REGEX           shift and go to state 50
-    TRUE            shift and go to state 51
-    FALSE           shift and go to state 52
-    STRING          shift and go to state 53
-    RSTRING         shift and go to state 54
+    NOT             shift and go to state 47
+    ID              shift and go to state 84
+    INT             shift and go to state 48
+    FLOAT           shift and go to state 49
+    NULL            shift and go to state 50
+    REGEX           shift and go to state 51
+    TRUE            shift and go to state 52
+    FALSE           shift and go to state 53
+    STRING          shift and go to state 54
+    FSTRING         shift and go to state 55
+    RSTRING         shift and go to state 56
     MLS             shift and go to state 20
-    [               shift and go to state 55
-    {               shift and go to state 56
+    [               shift and go to state 57
+    {               shift and go to state 58
     CID             shift and go to state 16
 
-    expression                     shift and go to state 130
+    expression                     shift and go to state 132
     boolean_expression             shift and go to state 35
     constant                       shift and go to state 36
     function_call                  shift and go to state 37
-    var_ref                        shift and go to state 81
+    var_ref                        shift and go to state 83
     constructor                    shift and go to state 38
     list_def                       shift and go to state 39
-    map_def                        shift and go to state 40
-    map_lookup                     shift and go to state 41
-    index_lookup                   shift and go to state 42
-    conditional_expression         shift and go to state 43
-    ns_ref                         shift and go to state 83
-    attr_ref                       shift and go to state 84
-    class_ref                      shift and go to state 85
+    list_comprehension             shift and go to state 40
+    map_def                        shift and go to state 41
+    map_lookup                     shift and go to state 42
+    index_lookup                   shift and go to state 43
+    conditional_expression         shift and go to state 44
+    ns_ref                         shift and go to state 85
+    attr_ref                       shift and go to state 86
+    class_ref                      shift and go to state 87
 
-state 72
+state 74
 
-    (110) boolean_expression -> expression AND . expression
+    (111) boolean_expression -> expression AND . expression
     (97) expression -> . boolean_expression
     (98) expression -> . constant
     (99) expression -> . function_call
     (100) expression -> . var_ref
     (101) expression -> . constructor
     (102) expression -> . list_def
-    (103) expression -> . map_def
-    (104) expression -> . map_lookup
-    (105) expression -> . index_lookup
-    (106) expression -> . conditional_expression
-    (107) expression -> . ( expression )
-    (108) boolean_expression -> . expression CMP_OP expression
-    (109) boolean_expression -> . expression IN expression
-    (110) boolean_expression -> . expression AND expression
-    (111) boolean_expression -> . expression OR expression
-    (112) boolean_expression -> . NOT expression
-    (113) boolean_expression -> . var_ref . ID IS DEFINED
-    (114) boolean_expression -> . ID IS DEFINED
-    (115) boolean_expression -> . map_lookup IS DEFINED
-    (134) constant -> . INT
-    (135) constant -> . FLOAT
-    (136) constant -> . NULL
-    (137) constant -> . REGEX
-    (138) constant -> . TRUE
-    (139) constant -> . FALSE
-    (140) constant -> . STRING
-    (141) constant -> . RSTRING
-    (142) constant -> . MLS
-    (121) function_call -> . ns_ref ( function_param_list )
-    (122) function_call -> . attr_ref ( function_param_list )
-    (163) var_ref -> . attr_ref
-    (165) var_ref -> . ns_ref
-    (120) constructor -> . class_ref ( param_list )
-    (123) list_def -> . [ operand_list ]
-    (130) map_def -> . { pair_list }
-    (117) map_lookup -> . attr_ref [ operand ]
-    (118) map_lookup -> . var_ref [ operand ]
-    (119) map_lookup -> . map_lookup [ operand ]
-    (131) index_lookup -> . class_ref [ param_list ]
-    (132) index_lookup -> . attr_ref [ param_list ]
-    (133) conditional_expression -> . expression ? expression : expression
-    (173) ns_ref -> . ns_ref SEP ID
-    (174) ns_ref -> . ID
-    (164) attr_ref -> . var_ref . ID
-    (166) class_ref -> . CID
-    (167) class_ref -> . ns_ref SEP CID
-    (168) class_ref -> . var_ref . CID
+    (103) expression -> . list_comprehension
+    (104) expression -> . map_def
+    (105) expression -> . map_lookup
+    (106) expression -> . index_lookup
+    (107) expression -> . conditional_expression
+    (108) expression -> . ( expression )
+    (109) boolean_expression -> . expression CMP_OP expression
+    (110) boolean_expression -> . expression IN expression
+    (111) boolean_expression -> . expression AND expression
+    (112) boolean_expression -> . expression OR expression
+    (113) boolean_expression -> . NOT expression
+    (114) boolean_expression -> . var_ref . ID IS DEFINED
+    (115) boolean_expression -> . ID IS DEFINED
+    (116) boolean_expression -> . map_lookup IS DEFINED
+    (141) constant -> . INT
+    (142) constant -> . FLOAT
+    (143) constant -> . NULL
+    (144) constant -> . REGEX
+    (145) constant -> . TRUE
+    (146) constant -> . FALSE
+    (147) constant -> . STRING
+    (148) constant -> . FSTRING
+    (149) constant -> . RSTRING
+    (150) constant -> . MLS
+    (122) function_call -> . ns_ref ( function_param_list )
+    (123) function_call -> . attr_ref ( function_param_list )
+    (171) var_ref -> . attr_ref
+    (173) var_ref -> . ns_ref
+    (121) constructor -> . class_ref ( param_list )
+    (124) list_def -> . [ operand_list ]
+    (125) list_comprehension -> . [ expression list_comprehension_for list_comprehension_guard ]
+    (137) map_def -> . { pair_list }
+    (118) map_lookup -> . attr_ref [ operand ]
+    (119) map_lookup -> . var_ref [ operand ]
+    (120) map_lookup -> . map_lookup [ operand ]
+    (138) index_lookup -> . class_ref [ param_list ]
+    (139) index_lookup -> . attr_ref [ param_list ]
+    (140) conditional_expression -> . expression ? expression : expression
+    (181) ns_ref -> . ns_ref SEP ID
+    (182) ns_ref -> . ID
+    (172) attr_ref -> . var_ref . ID
+    (174) class_ref -> . CID
+    (175) class_ref -> . ns_ref SEP CID
+    (176) class_ref -> . var_ref . CID
 
     (               shift and go to state 30
-    NOT             shift and go to state 46
-    ID              shift and go to state 82
-    INT             shift and go to state 47
-    FLOAT           shift and go to state 48
-    NULL            shift and go to state 49
-    REGEX           shift and go to state 50
-    TRUE            shift and go to state 51
-    FALSE           shift and go to state 52
-    STRING          shift and go to state 53
-    RSTRING         shift and go to state 54
+    NOT             shift and go to state 47
+    ID              shift and go to state 84
+    INT             shift and go to state 48
+    FLOAT           shift and go to state 49
+    NULL            shift and go to state 50
+    REGEX           shift and go to state 51
+    TRUE            shift and go to state 52
+    FALSE           shift and go to state 53
+    STRING          shift and go to state 54
+    FSTRING         shift and go to state 55
+    RSTRING         shift and go to state 56
     MLS             shift and go to state 20
-    [               shift and go to state 55
-    {               shift and go to state 56
+    [               shift and go to state 57
+    {               shift and go to state 58
     CID             shift and go to state 16
 
-    expression                     shift and go to state 131
+    expression                     shift and go to state 133
     boolean_expression             shift and go to state 35
     constant                       shift and go to state 36
     function_call                  shift and go to state 37
-    var_ref                        shift and go to state 81
+    var_ref                        shift and go to state 83
     constructor                    shift and go to state 38
     list_def                       shift and go to state 39
-    map_def                        shift and go to state 40
-    map_lookup                     shift and go to state 41
-    index_lookup                   shift and go to state 42
-    conditional_expression         shift and go to state 43
-    ns_ref                         shift and go to state 83
-    attr_ref                       shift and go to state 84
-    class_ref                      shift and go to state 85
+    list_comprehension             shift and go to state 40
+    map_def                        shift and go to state 41
+    map_lookup                     shift and go to state 42
+    index_lookup                   shift and go to state 43
+    conditional_expression         shift and go to state 44
+    ns_ref                         shift and go to state 85
+    attr_ref                       shift and go to state 86
+    class_ref                      shift and go to state 87
 
-state 73
+state 75
 
-    (111) boolean_expression -> expression OR . expression
+    (112) boolean_expression -> expression OR . expression
     (97) expression -> . boolean_expression
     (98) expression -> . constant
     (99) expression -> . function_call
     (100) expression -> . var_ref
     (101) expression -> . constructor
     (102) expression -> . list_def
-    (103) expression -> . map_def
-    (104) expression -> . map_lookup
-    (105) expression -> . index_lookup
-    (106) expression -> . conditional_expression
-    (107) expression -> . ( expression )
-    (108) boolean_expression -> . expression CMP_OP expression
-    (109) boolean_expression -> . expression IN expression
-    (110) boolean_expression -> . expression AND expression
-    (111) boolean_expression -> . expression OR expression
-    (112) boolean_expression -> . NOT expression
-    (113) boolean_expression -> . var_ref . ID IS DEFINED
-    (114) boolean_expression -> . ID IS DEFINED
-    (115) boolean_expression -> . map_lookup IS DEFINED
-    (134) constant -> . INT
-    (135) constant -> . FLOAT
-    (136) constant -> . NULL
-    (137) constant -> . REGEX
-    (138) constant -> . TRUE
-    (139) constant -> . FALSE
-    (140) constant -> . STRING
-    (141) constant -> . RSTRING
-    (142) constant -> . MLS
-    (121) function_call -> . ns_ref ( function_param_list )
-    (122) function_call -> . attr_ref ( function_param_list )
-    (163) var_ref -> . attr_ref
-    (165) var_ref -> . ns_ref
-    (120) constructor -> . class_ref ( param_list )
-    (123) list_def -> . [ operand_list ]
-    (130) map_def -> . { pair_list }
-    (117) map_lookup -> . attr_ref [ operand ]
-    (118) map_lookup -> . var_ref [ operand ]
-    (119) map_lookup -> . map_lookup [ operand ]
-    (131) index_lookup -> . class_ref [ param_list ]
-    (132) index_lookup -> . attr_ref [ param_list ]
-    (133) conditional_expression -> . expression ? expression : expression
-    (173) ns_ref -> . ns_ref SEP ID
-    (174) ns_ref -> . ID
-    (164) attr_ref -> . var_ref . ID
-    (166) class_ref -> . CID
-    (167) class_ref -> . ns_ref SEP CID
-    (168) class_ref -> . var_ref . CID
+    (103) expression -> . list_comprehension
+    (104) expression -> . map_def
+    (105) expression -> . map_lookup
+    (106) expression -> . index_lookup
+    (107) expression -> . conditional_expression
+    (108) expression -> . ( expression )
+    (109) boolean_expression -> . expression CMP_OP expression
+    (110) boolean_expression -> . expression IN expression
+    (111) boolean_expression -> . expression AND expression
+    (112) boolean_expression -> . expression OR expression
+    (113) boolean_expression -> . NOT expression
+    (114) boolean_expression -> . var_ref . ID IS DEFINED
+    (115) boolean_expression -> . ID IS DEFINED
+    (116) boolean_expression -> . map_lookup IS DEFINED
+    (141) constant -> . INT
+    (142) constant -> . FLOAT
+    (143) constant -> . NULL
+    (144) constant -> . REGEX
+    (145) constant -> . TRUE
+    (146) constant -> . FALSE
+    (147) constant -> . STRING
+    (148) constant -> . FSTRING
+    (149) constant -> . RSTRING
+    (150) constant -> . MLS
+    (122) function_call -> . ns_ref ( function_param_list )
+    (123) function_call -> . attr_ref ( function_param_list )
+    (171) var_ref -> . attr_ref
+    (173) var_ref -> . ns_ref
+    (121) constructor -> . class_ref ( param_list )
+    (124) list_def -> . [ operand_list ]
+    (125) list_comprehension -> . [ expression list_comprehension_for list_comprehension_guard ]
+    (137) map_def -> . { pair_list }
+    (118) map_lookup -> . attr_ref [ operand ]
+    (119) map_lookup -> . var_ref [ operand ]
+    (120) map_lookup -> . map_lookup [ operand ]
+    (138) index_lookup -> . class_ref [ param_list ]
+    (139) index_lookup -> . attr_ref [ param_list ]
+    (140) conditional_expression -> . expression ? expression : expression
+    (181) ns_ref -> . ns_ref SEP ID
+    (182) ns_ref -> . ID
+    (172) attr_ref -> . var_ref . ID
+    (174) class_ref -> . CID
+    (175) class_ref -> . ns_ref SEP CID
+    (176) class_ref -> . var_ref . CID
 
     (               shift and go to state 30
-    NOT             shift and go to state 46
-    ID              shift and go to state 82
-    INT             shift and go to state 47
-    FLOAT           shift and go to state 48
-    NULL            shift and go to state 49
-    REGEX           shift and go to state 50
-    TRUE            shift and go to state 51
-    FALSE           shift and go to state 52
-    STRING          shift and go to state 53
-    RSTRING         shift and go to state 54
+    NOT             shift and go to state 47
+    ID              shift and go to state 84
+    INT             shift and go to state 48
+    FLOAT           shift and go to state 49
+    NULL            shift and go to state 50
+    REGEX           shift and go to state 51
+    TRUE            shift and go to state 52
+    FALSE           shift and go to state 53
+    STRING          shift and go to state 54
+    FSTRING         shift and go to state 55
+    RSTRING         shift and go to state 56
     MLS             shift and go to state 20
-    [               shift and go to state 55
-    {               shift and go to state 56
+    [               shift and go to state 57
+    {               shift and go to state 58
     CID             shift and go to state 16
 
-    expression                     shift and go to state 132
+    expression                     shift and go to state 134
     boolean_expression             shift and go to state 35
     constant                       shift and go to state 36
     function_call                  shift and go to state 37
-    var_ref                        shift and go to state 81
+    var_ref                        shift and go to state 83
     constructor                    shift and go to state 38
     list_def                       shift and go to state 39
-    map_def                        shift and go to state 40
-    map_lookup                     shift and go to state 41
-    index_lookup                   shift and go to state 42
-    conditional_expression         shift and go to state 43
-    ns_ref                         shift and go to state 83
-    attr_ref                       shift and go to state 84
-    class_ref                      shift and go to state 85
+    list_comprehension             shift and go to state 40
+    map_def                        shift and go to state 41
+    map_lookup                     shift and go to state 42
+    index_lookup                   shift and go to state 43
+    conditional_expression         shift and go to state 44
+    ns_ref                         shift and go to state 85
+    attr_ref                       shift and go to state 86
+    class_ref                      shift and go to state 87
 
-state 74
+state 76
 
-    (133) conditional_expression -> expression ? . expression : expression
+    (140) conditional_expression -> expression ? . expression : expression
     (97) expression -> . boolean_expression
     (98) expression -> . constant
     (99) expression -> . function_call
     (100) expression -> . var_ref
     (101) expression -> . constructor
     (102) expression -> . list_def
-    (103) expression -> . map_def
-    (104) expression -> . map_lookup
-    (105) expression -> . index_lookup
-    (106) expression -> . conditional_expression
-    (107) expression -> . ( expression )
-    (108) boolean_expression -> . expression CMP_OP expression
-    (109) boolean_expression -> . expression IN expression
-    (110) boolean_expression -> . expression AND expression
-    (111) boolean_expression -> . expression OR expression
-    (112) boolean_expression -> . NOT expression
-    (113) boolean_expression -> . var_ref . ID IS DEFINED
-    (114) boolean_expression -> . ID IS DEFINED
-    (115) boolean_expression -> . map_lookup IS DEFINED
-    (134) constant -> . INT
-    (135) constant -> . FLOAT
-    (136) constant -> . NULL
-    (137) constant -> . REGEX
-    (138) constant -> . TRUE
-    (139) constant -> . FALSE
-    (140) constant -> . STRING
-    (141) constant -> . RSTRING
-    (142) constant -> . MLS
-    (121) function_call -> . ns_ref ( function_param_list )
-    (122) function_call -> . attr_ref ( function_param_list )
-    (163) var_ref -> . attr_ref
-    (165) var_ref -> . ns_ref
-    (120) constructor -> . class_ref ( param_list )
-    (123) list_def -> . [ operand_list ]
-    (130) map_def -> . { pair_list }
-    (117) map_lookup -> . attr_ref [ operand ]
-    (118) map_lookup -> . var_ref [ operand ]
-    (119) map_lookup -> . map_lookup [ operand ]
-    (131) index_lookup -> . class_ref [ param_list ]
-    (132) index_lookup -> . attr_ref [ param_list ]
-    (133) conditional_expression -> . expression ? expression : expression
-    (173) ns_ref -> . ns_ref SEP ID
-    (174) ns_ref -> . ID
-    (164) attr_ref -> . var_ref . ID
-    (166) class_ref -> . CID
-    (167) class_ref -> . ns_ref SEP CID
-    (168) class_ref -> . var_ref . CID
+    (103) expression -> . list_comprehension
+    (104) expression -> . map_def
+    (105) expression -> . map_lookup
+    (106) expression -> . index_lookup
+    (107) expression -> . conditional_expression
+    (108) expression -> . ( expression )
+    (109) boolean_expression -> . expression CMP_OP expression
+    (110) boolean_expression -> . expression IN expression
+    (111) boolean_expression -> . expression AND expression
+    (112) boolean_expression -> . expression OR expression
+    (113) boolean_expression -> . NOT expression
+    (114) boolean_expression -> . var_ref . ID IS DEFINED
+    (115) boolean_expression -> . ID IS DEFINED
+    (116) boolean_expression -> . map_lookup IS DEFINED
+    (141) constant -> . INT
+    (142) constant -> . FLOAT
+    (143) constant -> . NULL
+    (144) constant -> . REGEX
+    (145) constant -> . TRUE
+    (146) constant -> . FALSE
+    (147) constant -> . STRING
+    (148) constant -> . FSTRING
+    (149) constant -> . RSTRING
+    (150) constant -> . MLS
+    (122) function_call -> . ns_ref ( function_param_list )
+    (123) function_call -> . attr_ref ( function_param_list )
+    (171) var_ref -> . attr_ref
+    (173) var_ref -> . ns_ref
+    (121) constructor -> . class_ref ( param_list )
+    (124) list_def -> . [ operand_list ]
+    (125) list_comprehension -> . [ expression list_comprehension_for list_comprehension_guard ]
+    (137) map_def -> . { pair_list }
+    (118) map_lookup -> . attr_ref [ operand ]
+    (119) map_lookup -> . var_ref [ operand ]
+    (120) map_lookup -> . map_lookup [ operand ]
+    (138) index_lookup -> . class_ref [ param_list ]
+    (139) index_lookup -> . attr_ref [ param_list ]
+    (140) conditional_expression -> . expression ? expression : expression
+    (181) ns_ref -> . ns_ref SEP ID
+    (182) ns_ref -> . ID
+    (172) attr_ref -> . var_ref . ID
+    (174) class_ref -> . CID
+    (175) class_ref -> . ns_ref SEP CID
+    (176) class_ref -> . var_ref . CID
 
     (               shift and go to state 30
-    NOT             shift and go to state 46
-    ID              shift and go to state 82
-    INT             shift and go to state 47
-    FLOAT           shift and go to state 48
-    NULL            shift and go to state 49
-    REGEX           shift and go to state 50
-    TRUE            shift and go to state 51
-    FALSE           shift and go to state 52
-    STRING          shift and go to state 53
-    RSTRING         shift and go to state 54
+    NOT             shift and go to state 47
+    ID              shift and go to state 84
+    INT             shift and go to state 48
+    FLOAT           shift and go to state 49
+    NULL            shift and go to state 50
+    REGEX           shift and go to state 51
+    TRUE            shift and go to state 52
+    FALSE           shift and go to state 53
+    STRING          shift and go to state 54
+    FSTRING         shift and go to state 55
+    RSTRING         shift and go to state 56
     MLS             shift and go to state 20
-    [               shift and go to state 55
-    {               shift and go to state 56
+    [               shift and go to state 57
+    {               shift and go to state 58
     CID             shift and go to state 16
 
-    expression                     shift and go to state 133
+    expression                     shift and go to state 135
     boolean_expression             shift and go to state 35
     constant                       shift and go to state 36
     function_call                  shift and go to state 37
-    var_ref                        shift and go to state 81
+    var_ref                        shift and go to state 83
     constructor                    shift and go to state 38
     list_def                       shift and go to state 39
-    map_def                        shift and go to state 40
-    map_lookup                     shift and go to state 41
-    index_lookup                   shift and go to state 42
-    conditional_expression         shift and go to state 43
-    ns_ref                         shift and go to state 83
-    attr_ref                       shift and go to state 84
-    class_ref                      shift and go to state 85
+    list_comprehension             shift and go to state 40
+    map_def                        shift and go to state 41
+    map_lookup                     shift and go to state 42
+    index_lookup                   shift and go to state 43
+    conditional_expression         shift and go to state 44
+    ns_ref                         shift and go to state 85
+    attr_ref                       shift and go to state 86
+    class_ref                      shift and go to state 87
 
-state 75
+state 77
 
     (75) implementation_def -> IMPLEMENTATION ID . FOR class_ref implementation
 
-    FOR             shift and go to state 134
+    FOR             shift and go to state 136
 
 
-state 76
+state 78
 
     (25) for -> FOR ID . IN operand : block
 
-    IN              shift and go to state 135
+    IN              shift and go to state 137
 
 
-state 77
+state 79
 
     (82) relation -> relation_def MLS .
 
     ENTITY          reduce using rule 82 (relation -> relation_def MLS .)
     IMPLEMENT       reduce using rule 82 (relation -> relation_def MLS .)
     IMPLEMENTATION  reduce using rule 82 (relation -> relation_def MLS .)
     INDEX           reduce using rule 82 (relation -> relation_def MLS .)
@@ -3218,22 +3416,23 @@
     INT             reduce using rule 82 (relation -> relation_def MLS .)
     FLOAT           reduce using rule 82 (relation -> relation_def MLS .)
     NULL            reduce using rule 82 (relation -> relation_def MLS .)
     REGEX           reduce using rule 82 (relation -> relation_def MLS .)
     TRUE            reduce using rule 82 (relation -> relation_def MLS .)
     FALSE           reduce using rule 82 (relation -> relation_def MLS .)
     STRING          reduce using rule 82 (relation -> relation_def MLS .)
+    FSTRING         reduce using rule 82 (relation -> relation_def MLS .)
     RSTRING         reduce using rule 82 (relation -> relation_def MLS .)
     MLS             reduce using rule 82 (relation -> relation_def MLS .)
     [               reduce using rule 82 (relation -> relation_def MLS .)
     {               reduce using rule 82 (relation -> relation_def MLS .)
     $end            reduce using rule 82 (relation -> relation_def MLS .)
 
 
-state 78
+state 80
 
     (93) typedef -> typedef_inner MLS .
 
     ENTITY          reduce using rule 93 (typedef -> typedef_inner MLS .)
     IMPLEMENT       reduce using rule 93 (typedef -> typedef_inner MLS .)
     IMPLEMENTATION  reduce using rule 93 (typedef -> typedef_inner MLS .)
     INDEX           reduce using rule 93 (typedef -> typedef_inner MLS .)
@@ -3248,52 +3447,53 @@
     INT             reduce using rule 93 (typedef -> typedef_inner MLS .)
     FLOAT           reduce using rule 93 (typedef -> typedef_inner MLS .)
     NULL            reduce using rule 93 (typedef -> typedef_inner MLS .)
     REGEX           reduce using rule 93 (typedef -> typedef_inner MLS .)
     TRUE            reduce using rule 93 (typedef -> typedef_inner MLS .)
     FALSE           reduce using rule 93 (typedef -> typedef_inner MLS .)
     STRING          reduce using rule 93 (typedef -> typedef_inner MLS .)
+    FSTRING         reduce using rule 93 (typedef -> typedef_inner MLS .)
     RSTRING         reduce using rule 93 (typedef -> typedef_inner MLS .)
     MLS             reduce using rule 93 (typedef -> typedef_inner MLS .)
     [               reduce using rule 93 (typedef -> typedef_inner MLS .)
     {               reduce using rule 93 (typedef -> typedef_inner MLS .)
     $end            reduce using rule 93 (typedef -> typedef_inner MLS .)
 
 
-state 79
+state 81
 
     (96) index -> INDEX class_ref . ( id_list )
 
-    (               shift and go to state 136
+    (               shift and go to state 138
 
 
-state 80
+state 82
 
-    (107) expression -> ( expression . )
-    (108) boolean_expression -> expression . CMP_OP expression
-    (109) boolean_expression -> expression . IN expression
-    (110) boolean_expression -> expression . AND expression
-    (111) boolean_expression -> expression . OR expression
-    (133) conditional_expression -> expression . ? expression : expression
-
-    )               shift and go to state 137
-    CMP_OP          shift and go to state 70
-    IN              shift and go to state 71
-    AND             shift and go to state 72
-    OR              shift and go to state 73
-    ?               shift and go to state 74
+    (108) expression -> ( expression . )
+    (109) boolean_expression -> expression . CMP_OP expression
+    (110) boolean_expression -> expression . IN expression
+    (111) boolean_expression -> expression . AND expression
+    (112) boolean_expression -> expression . OR expression
+    (140) conditional_expression -> expression . ? expression : expression
+
+    )               shift and go to state 139
+    CMP_OP          shift and go to state 72
+    IN              shift and go to state 73
+    AND             shift and go to state 74
+    OR              shift and go to state 75
+    ?               shift and go to state 76
 
 
-state 81
+state 83
 
     (100) expression -> var_ref .
-    (113) boolean_expression -> var_ref . . ID IS DEFINED
-    (118) map_lookup -> var_ref . [ operand ]
-    (164) attr_ref -> var_ref . . ID
-    (168) class_ref -> var_ref . . CID
+    (114) boolean_expression -> var_ref . . ID IS DEFINED
+    (119) map_lookup -> var_ref . [ operand ]
+    (172) attr_ref -> var_ref . . ID
+    (176) class_ref -> var_ref . . CID
 
     )               reduce using rule 100 (expression -> var_ref .)
     CMP_OP          reduce using rule 100 (expression -> var_ref .)
     IN              reduce using rule 100 (expression -> var_ref .)
     AND             reduce using rule 100 (expression -> var_ref .)
     OR              reduce using rule 100 (expression -> var_ref .)
     ?               reduce using rule 100 (expression -> var_ref .)
@@ -3313,193 +3513,197 @@
     INT             reduce using rule 100 (expression -> var_ref .)
     FLOAT           reduce using rule 100 (expression -> var_ref .)
     NULL            reduce using rule 100 (expression -> var_ref .)
     REGEX           reduce using rule 100 (expression -> var_ref .)
     TRUE            reduce using rule 100 (expression -> var_ref .)
     FALSE           reduce using rule 100 (expression -> var_ref .)
     STRING          reduce using rule 100 (expression -> var_ref .)
+    FSTRING         reduce using rule 100 (expression -> var_ref .)
     RSTRING         reduce using rule 100 (expression -> var_ref .)
     MLS             reduce using rule 100 (expression -> var_ref .)
     {               reduce using rule 100 (expression -> var_ref .)
     $end            reduce using rule 100 (expression -> var_ref .)
     ,               reduce using rule 100 (expression -> var_ref .)
     ]               reduce using rule 100 (expression -> var_ref .)
     ELSE            reduce using rule 100 (expression -> var_ref .)
     ELIF            reduce using rule 100 (expression -> var_ref .)
     END             reduce using rule 100 (expression -> var_ref .)
     }               reduce using rule 100 (expression -> var_ref .)
-    .               shift and go to state 138
-    [               shift and go to state 92
+    .               shift and go to state 140
+    [               shift and go to state 94
 
   ! [               [ reduce using rule 100 (expression -> var_ref .) ]
 
 
-state 82
+state 84
 
-    (114) boolean_expression -> ID . IS DEFINED
-    (174) ns_ref -> ID .
+    (115) boolean_expression -> ID . IS DEFINED
+    (182) ns_ref -> ID .
 
-    IS              shift and go to state 60
-    (               reduce using rule 174 (ns_ref -> ID .)
-    SEP             reduce using rule 174 (ns_ref -> ID .)
-    .               reduce using rule 174 (ns_ref -> ID .)
-    [               reduce using rule 174 (ns_ref -> ID .)
-    )               reduce using rule 174 (ns_ref -> ID .)
-    CMP_OP          reduce using rule 174 (ns_ref -> ID .)
-    IN              reduce using rule 174 (ns_ref -> ID .)
-    AND             reduce using rule 174 (ns_ref -> ID .)
-    OR              reduce using rule 174 (ns_ref -> ID .)
-    ?               reduce using rule 174 (ns_ref -> ID .)
-    :               reduce using rule 174 (ns_ref -> ID .)
-    ENTITY          reduce using rule 174 (ns_ref -> ID .)
-    IMPLEMENT       reduce using rule 174 (ns_ref -> ID .)
-    IMPLEMENTATION  reduce using rule 174 (ns_ref -> ID .)
-    INDEX           reduce using rule 174 (ns_ref -> ID .)
-    IMPORT          reduce using rule 174 (ns_ref -> ID .)
-    CID             reduce using rule 174 (ns_ref -> ID .)
-    FOR             reduce using rule 174 (ns_ref -> ID .)
-    IF              reduce using rule 174 (ns_ref -> ID .)
-    TYPEDEF         reduce using rule 174 (ns_ref -> ID .)
-    ID              reduce using rule 174 (ns_ref -> ID .)
-    NOT             reduce using rule 174 (ns_ref -> ID .)
-    INT             reduce using rule 174 (ns_ref -> ID .)
-    FLOAT           reduce using rule 174 (ns_ref -> ID .)
-    NULL            reduce using rule 174 (ns_ref -> ID .)
-    REGEX           reduce using rule 174 (ns_ref -> ID .)
-    TRUE            reduce using rule 174 (ns_ref -> ID .)
-    FALSE           reduce using rule 174 (ns_ref -> ID .)
-    STRING          reduce using rule 174 (ns_ref -> ID .)
-    RSTRING         reduce using rule 174 (ns_ref -> ID .)
-    MLS             reduce using rule 174 (ns_ref -> ID .)
-    {               reduce using rule 174 (ns_ref -> ID .)
-    $end            reduce using rule 174 (ns_ref -> ID .)
-    ,               reduce using rule 174 (ns_ref -> ID .)
-    ]               reduce using rule 174 (ns_ref -> ID .)
-    ELSE            reduce using rule 174 (ns_ref -> ID .)
-    ELIF            reduce using rule 174 (ns_ref -> ID .)
-    END             reduce using rule 174 (ns_ref -> ID .)
-    }               reduce using rule 174 (ns_ref -> ID .)
-    =               reduce using rule 174 (ns_ref -> ID .)
-    PEQ             reduce using rule 174 (ns_ref -> ID .)
+    IS              shift and go to state 62
+    (               reduce using rule 182 (ns_ref -> ID .)
+    SEP             reduce using rule 182 (ns_ref -> ID .)
+    .               reduce using rule 182 (ns_ref -> ID .)
+    [               reduce using rule 182 (ns_ref -> ID .)
+    )               reduce using rule 182 (ns_ref -> ID .)
+    CMP_OP          reduce using rule 182 (ns_ref -> ID .)
+    IN              reduce using rule 182 (ns_ref -> ID .)
+    AND             reduce using rule 182 (ns_ref -> ID .)
+    OR              reduce using rule 182 (ns_ref -> ID .)
+    ?               reduce using rule 182 (ns_ref -> ID .)
+    :               reduce using rule 182 (ns_ref -> ID .)
+    ENTITY          reduce using rule 182 (ns_ref -> ID .)
+    IMPLEMENT       reduce using rule 182 (ns_ref -> ID .)
+    IMPLEMENTATION  reduce using rule 182 (ns_ref -> ID .)
+    INDEX           reduce using rule 182 (ns_ref -> ID .)
+    IMPORT          reduce using rule 182 (ns_ref -> ID .)
+    CID             reduce using rule 182 (ns_ref -> ID .)
+    FOR             reduce using rule 182 (ns_ref -> ID .)
+    IF              reduce using rule 182 (ns_ref -> ID .)
+    TYPEDEF         reduce using rule 182 (ns_ref -> ID .)
+    ID              reduce using rule 182 (ns_ref -> ID .)
+    NOT             reduce using rule 182 (ns_ref -> ID .)
+    INT             reduce using rule 182 (ns_ref -> ID .)
+    FLOAT           reduce using rule 182 (ns_ref -> ID .)
+    NULL            reduce using rule 182 (ns_ref -> ID .)
+    REGEX           reduce using rule 182 (ns_ref -> ID .)
+    TRUE            reduce using rule 182 (ns_ref -> ID .)
+    FALSE           reduce using rule 182 (ns_ref -> ID .)
+    STRING          reduce using rule 182 (ns_ref -> ID .)
+    FSTRING         reduce using rule 182 (ns_ref -> ID .)
+    RSTRING         reduce using rule 182 (ns_ref -> ID .)
+    MLS             reduce using rule 182 (ns_ref -> ID .)
+    {               reduce using rule 182 (ns_ref -> ID .)
+    $end            reduce using rule 182 (ns_ref -> ID .)
+    ,               reduce using rule 182 (ns_ref -> ID .)
+    ]               reduce using rule 182 (ns_ref -> ID .)
+    ELSE            reduce using rule 182 (ns_ref -> ID .)
+    ELIF            reduce using rule 182 (ns_ref -> ID .)
+    END             reduce using rule 182 (ns_ref -> ID .)
+    }               reduce using rule 182 (ns_ref -> ID .)
+    =               reduce using rule 182 (ns_ref -> ID .)
+    PEQ             reduce using rule 182 (ns_ref -> ID .)
 
 
-state 83
+state 85
 
-    (121) function_call -> ns_ref . ( function_param_list )
-    (165) var_ref -> ns_ref .
-    (173) ns_ref -> ns_ref . SEP ID
-    (167) class_ref -> ns_ref . SEP CID
-
-    (               shift and go to state 88
-    .               reduce using rule 165 (var_ref -> ns_ref .)
-    [               reduce using rule 165 (var_ref -> ns_ref .)
-    )               reduce using rule 165 (var_ref -> ns_ref .)
-    CMP_OP          reduce using rule 165 (var_ref -> ns_ref .)
-    IN              reduce using rule 165 (var_ref -> ns_ref .)
-    AND             reduce using rule 165 (var_ref -> ns_ref .)
-    OR              reduce using rule 165 (var_ref -> ns_ref .)
-    ?               reduce using rule 165 (var_ref -> ns_ref .)
-    :               reduce using rule 165 (var_ref -> ns_ref .)
-    ENTITY          reduce using rule 165 (var_ref -> ns_ref .)
-    IMPLEMENT       reduce using rule 165 (var_ref -> ns_ref .)
-    IMPLEMENTATION  reduce using rule 165 (var_ref -> ns_ref .)
-    INDEX           reduce using rule 165 (var_ref -> ns_ref .)
-    IMPORT          reduce using rule 165 (var_ref -> ns_ref .)
-    CID             reduce using rule 165 (var_ref -> ns_ref .)
-    FOR             reduce using rule 165 (var_ref -> ns_ref .)
-    IF              reduce using rule 165 (var_ref -> ns_ref .)
-    TYPEDEF         reduce using rule 165 (var_ref -> ns_ref .)
-    ID              reduce using rule 165 (var_ref -> ns_ref .)
-    NOT             reduce using rule 165 (var_ref -> ns_ref .)
-    INT             reduce using rule 165 (var_ref -> ns_ref .)
-    FLOAT           reduce using rule 165 (var_ref -> ns_ref .)
-    NULL            reduce using rule 165 (var_ref -> ns_ref .)
-    REGEX           reduce using rule 165 (var_ref -> ns_ref .)
-    TRUE            reduce using rule 165 (var_ref -> ns_ref .)
-    FALSE           reduce using rule 165 (var_ref -> ns_ref .)
-    STRING          reduce using rule 165 (var_ref -> ns_ref .)
-    RSTRING         reduce using rule 165 (var_ref -> ns_ref .)
-    MLS             reduce using rule 165 (var_ref -> ns_ref .)
-    {               reduce using rule 165 (var_ref -> ns_ref .)
-    $end            reduce using rule 165 (var_ref -> ns_ref .)
-    ,               reduce using rule 165 (var_ref -> ns_ref .)
-    ]               reduce using rule 165 (var_ref -> ns_ref .)
-    ELSE            reduce using rule 165 (var_ref -> ns_ref .)
-    ELIF            reduce using rule 165 (var_ref -> ns_ref .)
-    END             reduce using rule 165 (var_ref -> ns_ref .)
-    }               reduce using rule 165 (var_ref -> ns_ref .)
-    SEP             shift and go to state 139
+    (122) function_call -> ns_ref . ( function_param_list )
+    (173) var_ref -> ns_ref .
+    (181) ns_ref -> ns_ref . SEP ID
+    (175) class_ref -> ns_ref . SEP CID
+
+    (               shift and go to state 90
+    .               reduce using rule 173 (var_ref -> ns_ref .)
+    [               reduce using rule 173 (var_ref -> ns_ref .)
+    )               reduce using rule 173 (var_ref -> ns_ref .)
+    CMP_OP          reduce using rule 173 (var_ref -> ns_ref .)
+    IN              reduce using rule 173 (var_ref -> ns_ref .)
+    AND             reduce using rule 173 (var_ref -> ns_ref .)
+    OR              reduce using rule 173 (var_ref -> ns_ref .)
+    ?               reduce using rule 173 (var_ref -> ns_ref .)
+    :               reduce using rule 173 (var_ref -> ns_ref .)
+    ENTITY          reduce using rule 173 (var_ref -> ns_ref .)
+    IMPLEMENT       reduce using rule 173 (var_ref -> ns_ref .)
+    IMPLEMENTATION  reduce using rule 173 (var_ref -> ns_ref .)
+    INDEX           reduce using rule 173 (var_ref -> ns_ref .)
+    IMPORT          reduce using rule 173 (var_ref -> ns_ref .)
+    CID             reduce using rule 173 (var_ref -> ns_ref .)
+    FOR             reduce using rule 173 (var_ref -> ns_ref .)
+    IF              reduce using rule 173 (var_ref -> ns_ref .)
+    TYPEDEF         reduce using rule 173 (var_ref -> ns_ref .)
+    ID              reduce using rule 173 (var_ref -> ns_ref .)
+    NOT             reduce using rule 173 (var_ref -> ns_ref .)
+    INT             reduce using rule 173 (var_ref -> ns_ref .)
+    FLOAT           reduce using rule 173 (var_ref -> ns_ref .)
+    NULL            reduce using rule 173 (var_ref -> ns_ref .)
+    REGEX           reduce using rule 173 (var_ref -> ns_ref .)
+    TRUE            reduce using rule 173 (var_ref -> ns_ref .)
+    FALSE           reduce using rule 173 (var_ref -> ns_ref .)
+    STRING          reduce using rule 173 (var_ref -> ns_ref .)
+    FSTRING         reduce using rule 173 (var_ref -> ns_ref .)
+    RSTRING         reduce using rule 173 (var_ref -> ns_ref .)
+    MLS             reduce using rule 173 (var_ref -> ns_ref .)
+    {               reduce using rule 173 (var_ref -> ns_ref .)
+    $end            reduce using rule 173 (var_ref -> ns_ref .)
+    ,               reduce using rule 173 (var_ref -> ns_ref .)
+    ]               reduce using rule 173 (var_ref -> ns_ref .)
+    ELSE            reduce using rule 173 (var_ref -> ns_ref .)
+    ELIF            reduce using rule 173 (var_ref -> ns_ref .)
+    END             reduce using rule 173 (var_ref -> ns_ref .)
+    }               reduce using rule 173 (var_ref -> ns_ref .)
+    SEP             shift and go to state 141
 
-  ! (               [ reduce using rule 165 (var_ref -> ns_ref .) ]
+  ! (               [ reduce using rule 173 (var_ref -> ns_ref .) ]
 
 
-state 84
+state 86
 
-    (122) function_call -> attr_ref . ( function_param_list )
-    (163) var_ref -> attr_ref .
-    (117) map_lookup -> attr_ref . [ operand ]
-    (132) index_lookup -> attr_ref . [ param_list ]
-
-    (               shift and go to state 99
-    .               reduce using rule 163 (var_ref -> attr_ref .)
-    )               reduce using rule 163 (var_ref -> attr_ref .)
-    CMP_OP          reduce using rule 163 (var_ref -> attr_ref .)
-    IN              reduce using rule 163 (var_ref -> attr_ref .)
-    AND             reduce using rule 163 (var_ref -> attr_ref .)
-    OR              reduce using rule 163 (var_ref -> attr_ref .)
-    ?               reduce using rule 163 (var_ref -> attr_ref .)
-    :               reduce using rule 163 (var_ref -> attr_ref .)
-    ENTITY          reduce using rule 163 (var_ref -> attr_ref .)
-    IMPLEMENT       reduce using rule 163 (var_ref -> attr_ref .)
-    IMPLEMENTATION  reduce using rule 163 (var_ref -> attr_ref .)
-    INDEX           reduce using rule 163 (var_ref -> attr_ref .)
-    IMPORT          reduce using rule 163 (var_ref -> attr_ref .)
-    CID             reduce using rule 163 (var_ref -> attr_ref .)
-    FOR             reduce using rule 163 (var_ref -> attr_ref .)
-    IF              reduce using rule 163 (var_ref -> attr_ref .)
-    TYPEDEF         reduce using rule 163 (var_ref -> attr_ref .)
-    ID              reduce using rule 163 (var_ref -> attr_ref .)
-    NOT             reduce using rule 163 (var_ref -> attr_ref .)
-    INT             reduce using rule 163 (var_ref -> attr_ref .)
-    FLOAT           reduce using rule 163 (var_ref -> attr_ref .)
-    NULL            reduce using rule 163 (var_ref -> attr_ref .)
-    REGEX           reduce using rule 163 (var_ref -> attr_ref .)
-    TRUE            reduce using rule 163 (var_ref -> attr_ref .)
-    FALSE           reduce using rule 163 (var_ref -> attr_ref .)
-    STRING          reduce using rule 163 (var_ref -> attr_ref .)
-    RSTRING         reduce using rule 163 (var_ref -> attr_ref .)
-    MLS             reduce using rule 163 (var_ref -> attr_ref .)
-    {               reduce using rule 163 (var_ref -> attr_ref .)
-    $end            reduce using rule 163 (var_ref -> attr_ref .)
-    ,               reduce using rule 163 (var_ref -> attr_ref .)
-    ]               reduce using rule 163 (var_ref -> attr_ref .)
-    ELSE            reduce using rule 163 (var_ref -> attr_ref .)
-    ELIF            reduce using rule 163 (var_ref -> attr_ref .)
-    END             reduce using rule 163 (var_ref -> attr_ref .)
-    }               reduce using rule 163 (var_ref -> attr_ref .)
-    [               shift and go to state 100
+    (123) function_call -> attr_ref . ( function_param_list )
+    (171) var_ref -> attr_ref .
+    (118) map_lookup -> attr_ref . [ operand ]
+    (139) index_lookup -> attr_ref . [ param_list ]
+
+    (               shift and go to state 101
+    .               reduce using rule 171 (var_ref -> attr_ref .)
+    )               reduce using rule 171 (var_ref -> attr_ref .)
+    CMP_OP          reduce using rule 171 (var_ref -> attr_ref .)
+    IN              reduce using rule 171 (var_ref -> attr_ref .)
+    AND             reduce using rule 171 (var_ref -> attr_ref .)
+    OR              reduce using rule 171 (var_ref -> attr_ref .)
+    ?               reduce using rule 171 (var_ref -> attr_ref .)
+    :               reduce using rule 171 (var_ref -> attr_ref .)
+    ENTITY          reduce using rule 171 (var_ref -> attr_ref .)
+    IMPLEMENT       reduce using rule 171 (var_ref -> attr_ref .)
+    IMPLEMENTATION  reduce using rule 171 (var_ref -> attr_ref .)
+    INDEX           reduce using rule 171 (var_ref -> attr_ref .)
+    IMPORT          reduce using rule 171 (var_ref -> attr_ref .)
+    CID             reduce using rule 171 (var_ref -> attr_ref .)
+    FOR             reduce using rule 171 (var_ref -> attr_ref .)
+    IF              reduce using rule 171 (var_ref -> attr_ref .)
+    TYPEDEF         reduce using rule 171 (var_ref -> attr_ref .)
+    ID              reduce using rule 171 (var_ref -> attr_ref .)
+    NOT             reduce using rule 171 (var_ref -> attr_ref .)
+    INT             reduce using rule 171 (var_ref -> attr_ref .)
+    FLOAT           reduce using rule 171 (var_ref -> attr_ref .)
+    NULL            reduce using rule 171 (var_ref -> attr_ref .)
+    REGEX           reduce using rule 171 (var_ref -> attr_ref .)
+    TRUE            reduce using rule 171 (var_ref -> attr_ref .)
+    FALSE           reduce using rule 171 (var_ref -> attr_ref .)
+    STRING          reduce using rule 171 (var_ref -> attr_ref .)
+    FSTRING         reduce using rule 171 (var_ref -> attr_ref .)
+    RSTRING         reduce using rule 171 (var_ref -> attr_ref .)
+    MLS             reduce using rule 171 (var_ref -> attr_ref .)
+    {               reduce using rule 171 (var_ref -> attr_ref .)
+    $end            reduce using rule 171 (var_ref -> attr_ref .)
+    ,               reduce using rule 171 (var_ref -> attr_ref .)
+    ]               reduce using rule 171 (var_ref -> attr_ref .)
+    ELSE            reduce using rule 171 (var_ref -> attr_ref .)
+    ELIF            reduce using rule 171 (var_ref -> attr_ref .)
+    END             reduce using rule 171 (var_ref -> attr_ref .)
+    }               reduce using rule 171 (var_ref -> attr_ref .)
+    [               shift and go to state 102
 
-  ! [               [ reduce using rule 163 (var_ref -> attr_ref .) ]
-  ! (               [ reduce using rule 163 (var_ref -> attr_ref .) ]
+  ! [               [ reduce using rule 171 (var_ref -> attr_ref .) ]
+  ! (               [ reduce using rule 171 (var_ref -> attr_ref .) ]
 
 
-state 85
+state 87
 
-    (120) constructor -> class_ref . ( param_list )
-    (131) index_lookup -> class_ref . [ param_list ]
+    (121) constructor -> class_ref . ( param_list )
+    (138) index_lookup -> class_ref . [ param_list ]
 
-    (               shift and go to state 68
-    [               shift and go to state 69
+    (               shift and go to state 70
+    [               shift and go to state 71
 
 
-state 86
+state 88
 
     (15) import -> IMPORT ns_ref .
     (16) import -> IMPORT ns_ref . AS ID
-    (173) ns_ref -> ns_ref . SEP ID
+    (181) ns_ref -> ns_ref . SEP ID
 
     ENTITY          reduce using rule 15 (import -> IMPORT ns_ref .)
     IMPLEMENT       reduce using rule 15 (import -> IMPORT ns_ref .)
     IMPLEMENTATION  reduce using rule 15 (import -> IMPORT ns_ref .)
     INDEX           reduce using rule 15 (import -> IMPORT ns_ref .)
     IMPORT          reduce using rule 15 (import -> IMPORT ns_ref .)
     CID             reduce using rule 15 (import -> IMPORT ns_ref .)
@@ -3512,892 +3716,904 @@
     INT             reduce using rule 15 (import -> IMPORT ns_ref .)
     FLOAT           reduce using rule 15 (import -> IMPORT ns_ref .)
     NULL            reduce using rule 15 (import -> IMPORT ns_ref .)
     REGEX           reduce using rule 15 (import -> IMPORT ns_ref .)
     TRUE            reduce using rule 15 (import -> IMPORT ns_ref .)
     FALSE           reduce using rule 15 (import -> IMPORT ns_ref .)
     STRING          reduce using rule 15 (import -> IMPORT ns_ref .)
+    FSTRING         reduce using rule 15 (import -> IMPORT ns_ref .)
     RSTRING         reduce using rule 15 (import -> IMPORT ns_ref .)
     MLS             reduce using rule 15 (import -> IMPORT ns_ref .)
     [               reduce using rule 15 (import -> IMPORT ns_ref .)
     {               reduce using rule 15 (import -> IMPORT ns_ref .)
     $end            reduce using rule 15 (import -> IMPORT ns_ref .)
-    AS              shift and go to state 140
-    SEP             shift and go to state 141
+    AS              shift and go to state 142
+    SEP             shift and go to state 143
 
 
-state 87
+state 89
 
-    (167) class_ref -> ns_ref SEP . CID
-    (173) ns_ref -> ns_ref SEP . ID
+    (175) class_ref -> ns_ref SEP . CID
+    (181) ns_ref -> ns_ref SEP . ID
 
-    CID             shift and go to state 142
-    ID              shift and go to state 143
+    CID             shift and go to state 144
+    ID              shift and go to state 145
 
 
-state 88
+state 90
 
-    (121) function_call -> ns_ref ( . function_param_list )
-    (156) function_param_list -> . function_param_list_empty
-    (158) function_param_list -> . function_param_list_element empty function_param_list_empty
-    (159) function_param_list -> . function_param_list_element , function_param_list
-    (157) function_param_list_empty -> . empty
-    (154) function_param_list_element -> . param_list_element
-    (155) function_param_list_element -> . operand
+    (122) function_call -> ns_ref ( . function_param_list )
+    (164) function_param_list -> . function_param_list_empty
+    (166) function_param_list -> . function_param_list_element empty function_param_list_empty
+    (167) function_param_list -> . function_param_list_element , function_param_list
+    (165) function_param_list_empty -> . empty
+    (162) function_param_list_element -> . param_list_element
+    (163) function_param_list_element -> . operand
     (14) empty -> .
-    (148) param_list_element -> . ID = operand
-    (149) param_list_element -> . wrapped_kwargs
-    (116) operand -> . expression
-    (147) wrapped_kwargs -> . * * operand
+    (156) param_list_element -> . ID = operand
+    (157) param_list_element -> . wrapped_kwargs
+    (117) operand -> . expression
+    (155) wrapped_kwargs -> . * * operand
     (97) expression -> . boolean_expression
     (98) expression -> . constant
     (99) expression -> . function_call
     (100) expression -> . var_ref
     (101) expression -> . constructor
     (102) expression -> . list_def
-    (103) expression -> . map_def
-    (104) expression -> . map_lookup
-    (105) expression -> . index_lookup
-    (106) expression -> . conditional_expression
-    (107) expression -> . ( expression )
-    (108) boolean_expression -> . expression CMP_OP expression
-    (109) boolean_expression -> . expression IN expression
-    (110) boolean_expression -> . expression AND expression
-    (111) boolean_expression -> . expression OR expression
-    (112) boolean_expression -> . NOT expression
-    (113) boolean_expression -> . var_ref . ID IS DEFINED
-    (114) boolean_expression -> . ID IS DEFINED
-    (115) boolean_expression -> . map_lookup IS DEFINED
-    (134) constant -> . INT
-    (135) constant -> . FLOAT
-    (136) constant -> . NULL
-    (137) constant -> . REGEX
-    (138) constant -> . TRUE
-    (139) constant -> . FALSE
-    (140) constant -> . STRING
-    (141) constant -> . RSTRING
-    (142) constant -> . MLS
-    (121) function_call -> . ns_ref ( function_param_list )
-    (122) function_call -> . attr_ref ( function_param_list )
-    (163) var_ref -> . attr_ref
-    (165) var_ref -> . ns_ref
-    (120) constructor -> . class_ref ( param_list )
-    (123) list_def -> . [ operand_list ]
-    (130) map_def -> . { pair_list }
-    (117) map_lookup -> . attr_ref [ operand ]
-    (118) map_lookup -> . var_ref [ operand ]
-    (119) map_lookup -> . map_lookup [ operand ]
-    (131) index_lookup -> . class_ref [ param_list ]
-    (132) index_lookup -> . attr_ref [ param_list ]
-    (133) conditional_expression -> . expression ? expression : expression
-    (173) ns_ref -> . ns_ref SEP ID
-    (174) ns_ref -> . ID
-    (164) attr_ref -> . var_ref . ID
-    (166) class_ref -> . CID
-    (167) class_ref -> . ns_ref SEP CID
-    (168) class_ref -> . var_ref . CID
+    (103) expression -> . list_comprehension
+    (104) expression -> . map_def
+    (105) expression -> . map_lookup
+    (106) expression -> . index_lookup
+    (107) expression -> . conditional_expression
+    (108) expression -> . ( expression )
+    (109) boolean_expression -> . expression CMP_OP expression
+    (110) boolean_expression -> . expression IN expression
+    (111) boolean_expression -> . expression AND expression
+    (112) boolean_expression -> . expression OR expression
+    (113) boolean_expression -> . NOT expression
+    (114) boolean_expression -> . var_ref . ID IS DEFINED
+    (115) boolean_expression -> . ID IS DEFINED
+    (116) boolean_expression -> . map_lookup IS DEFINED
+    (141) constant -> . INT
+    (142) constant -> . FLOAT
+    (143) constant -> . NULL
+    (144) constant -> . REGEX
+    (145) constant -> . TRUE
+    (146) constant -> . FALSE
+    (147) constant -> . STRING
+    (148) constant -> . FSTRING
+    (149) constant -> . RSTRING
+    (150) constant -> . MLS
+    (122) function_call -> . ns_ref ( function_param_list )
+    (123) function_call -> . attr_ref ( function_param_list )
+    (171) var_ref -> . attr_ref
+    (173) var_ref -> . ns_ref
+    (121) constructor -> . class_ref ( param_list )
+    (124) list_def -> . [ operand_list ]
+    (125) list_comprehension -> . [ expression list_comprehension_for list_comprehension_guard ]
+    (137) map_def -> . { pair_list }
+    (118) map_lookup -> . attr_ref [ operand ]
+    (119) map_lookup -> . var_ref [ operand ]
+    (120) map_lookup -> . map_lookup [ operand ]
+    (138) index_lookup -> . class_ref [ param_list ]
+    (139) index_lookup -> . attr_ref [ param_list ]
+    (140) conditional_expression -> . expression ? expression : expression
+    (181) ns_ref -> . ns_ref SEP ID
+    (182) ns_ref -> . ID
+    (172) attr_ref -> . var_ref . ID
+    (174) class_ref -> . CID
+    (175) class_ref -> . ns_ref SEP CID
+    (176) class_ref -> . var_ref . CID
 
     )               reduce using rule 14 (empty -> .)
-    ID              shift and go to state 150
-    *               shift and go to state 127
+    ID              shift and go to state 152
+    *               shift and go to state 129
     (               shift and go to state 30
-    NOT             shift and go to state 46
-    INT             shift and go to state 47
-    FLOAT           shift and go to state 48
-    NULL            shift and go to state 49
-    REGEX           shift and go to state 50
-    TRUE            shift and go to state 51
-    FALSE           shift and go to state 52
-    STRING          shift and go to state 53
-    RSTRING         shift and go to state 54
+    NOT             shift and go to state 47
+    INT             shift and go to state 48
+    FLOAT           shift and go to state 49
+    NULL            shift and go to state 50
+    REGEX           shift and go to state 51
+    TRUE            shift and go to state 52
+    FALSE           shift and go to state 53
+    STRING          shift and go to state 54
+    FSTRING         shift and go to state 55
+    RSTRING         shift and go to state 56
     MLS             shift and go to state 20
-    [               shift and go to state 55
-    {               shift and go to state 56
+    [               shift and go to state 57
+    {               shift and go to state 58
     CID             shift and go to state 16
 
-    ns_ref                         shift and go to state 83
-    function_param_list            shift and go to state 144
-    function_param_list_empty      shift and go to state 145
-    function_param_list_element    shift and go to state 146
-    empty                          shift and go to state 147
-    param_list_element             shift and go to state 148
-    operand                        shift and go to state 149
-    wrapped_kwargs                 shift and go to state 126
-    expression                     shift and go to state 104
+    ns_ref                         shift and go to state 85
+    function_param_list            shift and go to state 146
+    function_param_list_empty      shift and go to state 147
+    function_param_list_element    shift and go to state 148
+    empty                          shift and go to state 149
+    param_list_element             shift and go to state 150
+    operand                        shift and go to state 151
+    wrapped_kwargs                 shift and go to state 128
+    expression                     shift and go to state 153
     boolean_expression             shift and go to state 35
     constant                       shift and go to state 36
     function_call                  shift and go to state 37
-    var_ref                        shift and go to state 81
+    var_ref                        shift and go to state 83
     constructor                    shift and go to state 38
     list_def                       shift and go to state 39
-    map_def                        shift and go to state 40
-    map_lookup                     shift and go to state 41
-    index_lookup                   shift and go to state 42
-    conditional_expression         shift and go to state 43
-    attr_ref                       shift and go to state 84
-    class_ref                      shift and go to state 85
+    list_comprehension             shift and go to state 40
+    map_def                        shift and go to state 41
+    map_lookup                     shift and go to state 42
+    index_lookup                   shift and go to state 43
+    conditional_expression         shift and go to state 44
+    attr_ref                       shift and go to state 86
+    class_ref                      shift and go to state 87
 
-state 89
+state 91
 
-    (168) class_ref -> var_ref . . CID
-    (113) boolean_expression -> var_ref . . ID IS DEFINED
-    (164) attr_ref -> var_ref . . ID
+    (176) class_ref -> var_ref . . CID
+    (114) boolean_expression -> var_ref . . ID IS DEFINED
+    (172) attr_ref -> var_ref . . ID
 
-    CID             shift and go to state 151
-    ID              shift and go to state 152
+    CID             shift and go to state 154
+    ID              shift and go to state 155
 
 
-state 90
+state 92
 
     (23) assign -> var_ref = . operand
-    (116) operand -> . expression
+    (117) operand -> . expression
     (97) expression -> . boolean_expression
     (98) expression -> . constant
     (99) expression -> . function_call
     (100) expression -> . var_ref
     (101) expression -> . constructor
     (102) expression -> . list_def
-    (103) expression -> . map_def
-    (104) expression -> . map_lookup
-    (105) expression -> . index_lookup
-    (106) expression -> . conditional_expression
-    (107) expression -> . ( expression )
-    (108) boolean_expression -> . expression CMP_OP expression
-    (109) boolean_expression -> . expression IN expression
-    (110) boolean_expression -> . expression AND expression
-    (111) boolean_expression -> . expression OR expression
-    (112) boolean_expression -> . NOT expression
-    (113) boolean_expression -> . var_ref . ID IS DEFINED
-    (114) boolean_expression -> . ID IS DEFINED
-    (115) boolean_expression -> . map_lookup IS DEFINED
-    (134) constant -> . INT
-    (135) constant -> . FLOAT
-    (136) constant -> . NULL
-    (137) constant -> . REGEX
-    (138) constant -> . TRUE
-    (139) constant -> . FALSE
-    (140) constant -> . STRING
-    (141) constant -> . RSTRING
-    (142) constant -> . MLS
-    (121) function_call -> . ns_ref ( function_param_list )
-    (122) function_call -> . attr_ref ( function_param_list )
-    (163) var_ref -> . attr_ref
-    (165) var_ref -> . ns_ref
-    (120) constructor -> . class_ref ( param_list )
-    (123) list_def -> . [ operand_list ]
-    (130) map_def -> . { pair_list }
-    (117) map_lookup -> . attr_ref [ operand ]
-    (118) map_lookup -> . var_ref [ operand ]
-    (119) map_lookup -> . map_lookup [ operand ]
-    (131) index_lookup -> . class_ref [ param_list ]
-    (132) index_lookup -> . attr_ref [ param_list ]
-    (133) conditional_expression -> . expression ? expression : expression
-    (173) ns_ref -> . ns_ref SEP ID
-    (174) ns_ref -> . ID
-    (164) attr_ref -> . var_ref . ID
-    (166) class_ref -> . CID
-    (167) class_ref -> . ns_ref SEP CID
-    (168) class_ref -> . var_ref . CID
+    (103) expression -> . list_comprehension
+    (104) expression -> . map_def
+    (105) expression -> . map_lookup
+    (106) expression -> . index_lookup
+    (107) expression -> . conditional_expression
+    (108) expression -> . ( expression )
+    (109) boolean_expression -> . expression CMP_OP expression
+    (110) boolean_expression -> . expression IN expression
+    (111) boolean_expression -> . expression AND expression
+    (112) boolean_expression -> . expression OR expression
+    (113) boolean_expression -> . NOT expression
+    (114) boolean_expression -> . var_ref . ID IS DEFINED
+    (115) boolean_expression -> . ID IS DEFINED
+    (116) boolean_expression -> . map_lookup IS DEFINED
+    (141) constant -> . INT
+    (142) constant -> . FLOAT
+    (143) constant -> . NULL
+    (144) constant -> . REGEX
+    (145) constant -> . TRUE
+    (146) constant -> . FALSE
+    (147) constant -> . STRING
+    (148) constant -> . FSTRING
+    (149) constant -> . RSTRING
+    (150) constant -> . MLS
+    (122) function_call -> . ns_ref ( function_param_list )
+    (123) function_call -> . attr_ref ( function_param_list )
+    (171) var_ref -> . attr_ref
+    (173) var_ref -> . ns_ref
+    (121) constructor -> . class_ref ( param_list )
+    (124) list_def -> . [ operand_list ]
+    (125) list_comprehension -> . [ expression list_comprehension_for list_comprehension_guard ]
+    (137) map_def -> . { pair_list }
+    (118) map_lookup -> . attr_ref [ operand ]
+    (119) map_lookup -> . var_ref [ operand ]
+    (120) map_lookup -> . map_lookup [ operand ]
+    (138) index_lookup -> . class_ref [ param_list ]
+    (139) index_lookup -> . attr_ref [ param_list ]
+    (140) conditional_expression -> . expression ? expression : expression
+    (181) ns_ref -> . ns_ref SEP ID
+    (182) ns_ref -> . ID
+    (172) attr_ref -> . var_ref . ID
+    (174) class_ref -> . CID
+    (175) class_ref -> . ns_ref SEP CID
+    (176) class_ref -> . var_ref . CID
 
     (               shift and go to state 30
-    NOT             shift and go to state 46
-    ID              shift and go to state 82
-    INT             shift and go to state 47
-    FLOAT           shift and go to state 48
-    NULL            shift and go to state 49
-    REGEX           shift and go to state 50
-    TRUE            shift and go to state 51
-    FALSE           shift and go to state 52
-    STRING          shift and go to state 53
-    RSTRING         shift and go to state 54
+    NOT             shift and go to state 47
+    ID              shift and go to state 84
+    INT             shift and go to state 48
+    FLOAT           shift and go to state 49
+    NULL            shift and go to state 50
+    REGEX           shift and go to state 51
+    TRUE            shift and go to state 52
+    FALSE           shift and go to state 53
+    STRING          shift and go to state 54
+    FSTRING         shift and go to state 55
+    RSTRING         shift and go to state 56
     MLS             shift and go to state 20
-    [               shift and go to state 55
-    {               shift and go to state 56
+    [               shift and go to state 57
+    {               shift and go to state 58
     CID             shift and go to state 16
 
-    var_ref                        shift and go to state 81
-    operand                        shift and go to state 153
-    expression                     shift and go to state 104
+    var_ref                        shift and go to state 83
+    operand                        shift and go to state 156
+    expression                     shift and go to state 153
     boolean_expression             shift and go to state 35
     constant                       shift and go to state 36
     function_call                  shift and go to state 37
     constructor                    shift and go to state 38
     list_def                       shift and go to state 39
-    map_def                        shift and go to state 40
-    map_lookup                     shift and go to state 41
-    index_lookup                   shift and go to state 42
-    conditional_expression         shift and go to state 43
-    ns_ref                         shift and go to state 83
-    attr_ref                       shift and go to state 84
-    class_ref                      shift and go to state 85
+    list_comprehension             shift and go to state 40
+    map_def                        shift and go to state 41
+    map_lookup                     shift and go to state 42
+    index_lookup                   shift and go to state 43
+    conditional_expression         shift and go to state 44
+    ns_ref                         shift and go to state 85
+    attr_ref                       shift and go to state 86
+    class_ref                      shift and go to state 87
 
-state 91
+state 93
 
     (24) assign -> var_ref PEQ . operand
-    (116) operand -> . expression
+    (117) operand -> . expression
     (97) expression -> . boolean_expression
     (98) expression -> . constant
     (99) expression -> . function_call
     (100) expression -> . var_ref
     (101) expression -> . constructor
     (102) expression -> . list_def
-    (103) expression -> . map_def
-    (104) expression -> . map_lookup
-    (105) expression -> . index_lookup
-    (106) expression -> . conditional_expression
-    (107) expression -> . ( expression )
-    (108) boolean_expression -> . expression CMP_OP expression
-    (109) boolean_expression -> . expression IN expression
-    (110) boolean_expression -> . expression AND expression
-    (111) boolean_expression -> . expression OR expression
-    (112) boolean_expression -> . NOT expression
-    (113) boolean_expression -> . var_ref . ID IS DEFINED
-    (114) boolean_expression -> . ID IS DEFINED
-    (115) boolean_expression -> . map_lookup IS DEFINED
-    (134) constant -> . INT
-    (135) constant -> . FLOAT
-    (136) constant -> . NULL
-    (137) constant -> . REGEX
-    (138) constant -> . TRUE
-    (139) constant -> . FALSE
-    (140) constant -> . STRING
-    (141) constant -> . RSTRING
-    (142) constant -> . MLS
-    (121) function_call -> . ns_ref ( function_param_list )
-    (122) function_call -> . attr_ref ( function_param_list )
-    (163) var_ref -> . attr_ref
-    (165) var_ref -> . ns_ref
-    (120) constructor -> . class_ref ( param_list )
-    (123) list_def -> . [ operand_list ]
-    (130) map_def -> . { pair_list }
-    (117) map_lookup -> . attr_ref [ operand ]
-    (118) map_lookup -> . var_ref [ operand ]
-    (119) map_lookup -> . map_lookup [ operand ]
-    (131) index_lookup -> . class_ref [ param_list ]
-    (132) index_lookup -> . attr_ref [ param_list ]
-    (133) conditional_expression -> . expression ? expression : expression
-    (173) ns_ref -> . ns_ref SEP ID
-    (174) ns_ref -> . ID
-    (164) attr_ref -> . var_ref . ID
-    (166) class_ref -> . CID
-    (167) class_ref -> . ns_ref SEP CID
-    (168) class_ref -> . var_ref . CID
+    (103) expression -> . list_comprehension
+    (104) expression -> . map_def
+    (105) expression -> . map_lookup
+    (106) expression -> . index_lookup
+    (107) expression -> . conditional_expression
+    (108) expression -> . ( expression )
+    (109) boolean_expression -> . expression CMP_OP expression
+    (110) boolean_expression -> . expression IN expression
+    (111) boolean_expression -> . expression AND expression
+    (112) boolean_expression -> . expression OR expression
+    (113) boolean_expression -> . NOT expression
+    (114) boolean_expression -> . var_ref . ID IS DEFINED
+    (115) boolean_expression -> . ID IS DEFINED
+    (116) boolean_expression -> . map_lookup IS DEFINED
+    (141) constant -> . INT
+    (142) constant -> . FLOAT
+    (143) constant -> . NULL
+    (144) constant -> . REGEX
+    (145) constant -> . TRUE
+    (146) constant -> . FALSE
+    (147) constant -> . STRING
+    (148) constant -> . FSTRING
+    (149) constant -> . RSTRING
+    (150) constant -> . MLS
+    (122) function_call -> . ns_ref ( function_param_list )
+    (123) function_call -> . attr_ref ( function_param_list )
+    (171) var_ref -> . attr_ref
+    (173) var_ref -> . ns_ref
+    (121) constructor -> . class_ref ( param_list )
+    (124) list_def -> . [ operand_list ]
+    (125) list_comprehension -> . [ expression list_comprehension_for list_comprehension_guard ]
+    (137) map_def -> . { pair_list }
+    (118) map_lookup -> . attr_ref [ operand ]
+    (119) map_lookup -> . var_ref [ operand ]
+    (120) map_lookup -> . map_lookup [ operand ]
+    (138) index_lookup -> . class_ref [ param_list ]
+    (139) index_lookup -> . attr_ref [ param_list ]
+    (140) conditional_expression -> . expression ? expression : expression
+    (181) ns_ref -> . ns_ref SEP ID
+    (182) ns_ref -> . ID
+    (172) attr_ref -> . var_ref . ID
+    (174) class_ref -> . CID
+    (175) class_ref -> . ns_ref SEP CID
+    (176) class_ref -> . var_ref . CID
 
     (               shift and go to state 30
-    NOT             shift and go to state 46
-    ID              shift and go to state 82
-    INT             shift and go to state 47
-    FLOAT           shift and go to state 48
-    NULL            shift and go to state 49
-    REGEX           shift and go to state 50
-    TRUE            shift and go to state 51
-    FALSE           shift and go to state 52
-    STRING          shift and go to state 53
-    RSTRING         shift and go to state 54
+    NOT             shift and go to state 47
+    ID              shift and go to state 84
+    INT             shift and go to state 48
+    FLOAT           shift and go to state 49
+    NULL            shift and go to state 50
+    REGEX           shift and go to state 51
+    TRUE            shift and go to state 52
+    FALSE           shift and go to state 53
+    STRING          shift and go to state 54
+    FSTRING         shift and go to state 55
+    RSTRING         shift and go to state 56
     MLS             shift and go to state 20
-    [               shift and go to state 55
-    {               shift and go to state 56
+    [               shift and go to state 57
+    {               shift and go to state 58
     CID             shift and go to state 16
 
-    var_ref                        shift and go to state 81
-    operand                        shift and go to state 154
-    expression                     shift and go to state 104
+    var_ref                        shift and go to state 83
+    operand                        shift and go to state 157
+    expression                     shift and go to state 153
     boolean_expression             shift and go to state 35
     constant                       shift and go to state 36
     function_call                  shift and go to state 37
     constructor                    shift and go to state 38
     list_def                       shift and go to state 39
-    map_def                        shift and go to state 40
-    map_lookup                     shift and go to state 41
-    index_lookup                   shift and go to state 42
-    conditional_expression         shift and go to state 43
-    ns_ref                         shift and go to state 83
-    attr_ref                       shift and go to state 84
-    class_ref                      shift and go to state 85
+    list_comprehension             shift and go to state 40
+    map_def                        shift and go to state 41
+    map_lookup                     shift and go to state 42
+    index_lookup                   shift and go to state 43
+    conditional_expression         shift and go to state 44
+    ns_ref                         shift and go to state 85
+    attr_ref                       shift and go to state 86
+    class_ref                      shift and go to state 87
 
-state 92
+state 94
 
-    (118) map_lookup -> var_ref [ . operand ]
-    (116) operand -> . expression
+    (119) map_lookup -> var_ref [ . operand ]
+    (117) operand -> . expression
     (97) expression -> . boolean_expression
     (98) expression -> . constant
     (99) expression -> . function_call
     (100) expression -> . var_ref
     (101) expression -> . constructor
     (102) expression -> . list_def
-    (103) expression -> . map_def
-    (104) expression -> . map_lookup
-    (105) expression -> . index_lookup
-    (106) expression -> . conditional_expression
-    (107) expression -> . ( expression )
-    (108) boolean_expression -> . expression CMP_OP expression
-    (109) boolean_expression -> . expression IN expression
-    (110) boolean_expression -> . expression AND expression
-    (111) boolean_expression -> . expression OR expression
-    (112) boolean_expression -> . NOT expression
-    (113) boolean_expression -> . var_ref . ID IS DEFINED
-    (114) boolean_expression -> . ID IS DEFINED
-    (115) boolean_expression -> . map_lookup IS DEFINED
-    (134) constant -> . INT
-    (135) constant -> . FLOAT
-    (136) constant -> . NULL
-    (137) constant -> . REGEX
-    (138) constant -> . TRUE
-    (139) constant -> . FALSE
-    (140) constant -> . STRING
-    (141) constant -> . RSTRING
-    (142) constant -> . MLS
-    (121) function_call -> . ns_ref ( function_param_list )
-    (122) function_call -> . attr_ref ( function_param_list )
-    (163) var_ref -> . attr_ref
-    (165) var_ref -> . ns_ref
-    (120) constructor -> . class_ref ( param_list )
-    (123) list_def -> . [ operand_list ]
-    (130) map_def -> . { pair_list }
-    (117) map_lookup -> . attr_ref [ operand ]
-    (118) map_lookup -> . var_ref [ operand ]
-    (119) map_lookup -> . map_lookup [ operand ]
-    (131) index_lookup -> . class_ref [ param_list ]
-    (132) index_lookup -> . attr_ref [ param_list ]
-    (133) conditional_expression -> . expression ? expression : expression
-    (173) ns_ref -> . ns_ref SEP ID
-    (174) ns_ref -> . ID
-    (164) attr_ref -> . var_ref . ID
-    (166) class_ref -> . CID
-    (167) class_ref -> . ns_ref SEP CID
-    (168) class_ref -> . var_ref . CID
+    (103) expression -> . list_comprehension
+    (104) expression -> . map_def
+    (105) expression -> . map_lookup
+    (106) expression -> . index_lookup
+    (107) expression -> . conditional_expression
+    (108) expression -> . ( expression )
+    (109) boolean_expression -> . expression CMP_OP expression
+    (110) boolean_expression -> . expression IN expression
+    (111) boolean_expression -> . expression AND expression
+    (112) boolean_expression -> . expression OR expression
+    (113) boolean_expression -> . NOT expression
+    (114) boolean_expression -> . var_ref . ID IS DEFINED
+    (115) boolean_expression -> . ID IS DEFINED
+    (116) boolean_expression -> . map_lookup IS DEFINED
+    (141) constant -> . INT
+    (142) constant -> . FLOAT
+    (143) constant -> . NULL
+    (144) constant -> . REGEX
+    (145) constant -> . TRUE
+    (146) constant -> . FALSE
+    (147) constant -> . STRING
+    (148) constant -> . FSTRING
+    (149) constant -> . RSTRING
+    (150) constant -> . MLS
+    (122) function_call -> . ns_ref ( function_param_list )
+    (123) function_call -> . attr_ref ( function_param_list )
+    (171) var_ref -> . attr_ref
+    (173) var_ref -> . ns_ref
+    (121) constructor -> . class_ref ( param_list )
+    (124) list_def -> . [ operand_list ]
+    (125) list_comprehension -> . [ expression list_comprehension_for list_comprehension_guard ]
+    (137) map_def -> . { pair_list }
+    (118) map_lookup -> . attr_ref [ operand ]
+    (119) map_lookup -> . var_ref [ operand ]
+    (120) map_lookup -> . map_lookup [ operand ]
+    (138) index_lookup -> . class_ref [ param_list ]
+    (139) index_lookup -> . attr_ref [ param_list ]
+    (140) conditional_expression -> . expression ? expression : expression
+    (181) ns_ref -> . ns_ref SEP ID
+    (182) ns_ref -> . ID
+    (172) attr_ref -> . var_ref . ID
+    (174) class_ref -> . CID
+    (175) class_ref -> . ns_ref SEP CID
+    (176) class_ref -> . var_ref . CID
 
     (               shift and go to state 30
-    NOT             shift and go to state 46
-    ID              shift and go to state 82
-    INT             shift and go to state 47
-    FLOAT           shift and go to state 48
-    NULL            shift and go to state 49
-    REGEX           shift and go to state 50
-    TRUE            shift and go to state 51
-    FALSE           shift and go to state 52
-    STRING          shift and go to state 53
-    RSTRING         shift and go to state 54
+    NOT             shift and go to state 47
+    ID              shift and go to state 84
+    INT             shift and go to state 48
+    FLOAT           shift and go to state 49
+    NULL            shift and go to state 50
+    REGEX           shift and go to state 51
+    TRUE            shift and go to state 52
+    FALSE           shift and go to state 53
+    STRING          shift and go to state 54
+    FSTRING         shift and go to state 55
+    RSTRING         shift and go to state 56
     MLS             shift and go to state 20
-    [               shift and go to state 55
-    {               shift and go to state 56
+    [               shift and go to state 57
+    {               shift and go to state 58
     CID             shift and go to state 16
 
-    var_ref                        shift and go to state 81
-    operand                        shift and go to state 155
-    expression                     shift and go to state 104
+    var_ref                        shift and go to state 83
+    operand                        shift and go to state 158
+    expression                     shift and go to state 153
     boolean_expression             shift and go to state 35
     constant                       shift and go to state 36
     function_call                  shift and go to state 37
     constructor                    shift and go to state 38
     list_def                       shift and go to state 39
-    map_def                        shift and go to state 40
-    map_lookup                     shift and go to state 41
-    index_lookup                   shift and go to state 42
-    conditional_expression         shift and go to state 43
-    ns_ref                         shift and go to state 83
-    attr_ref                       shift and go to state 84
-    class_ref                      shift and go to state 85
+    list_comprehension             shift and go to state 40
+    map_def                        shift and go to state 41
+    map_lookup                     shift and go to state 42
+    index_lookup                   shift and go to state 43
+    conditional_expression         shift and go to state 44
+    ns_ref                         shift and go to state 85
+    attr_ref                       shift and go to state 86
+    class_ref                      shift and go to state 87
 
-state 93
+state 95
 
     (26) if -> IF if_body . END
 
-    END             shift and go to state 156
+    END             shift and go to state 159
 
 
-state 94
+state 96
 
     (27) if_body -> expression . : stmt_list if_next
-    (108) boolean_expression -> expression . CMP_OP expression
-    (109) boolean_expression -> expression . IN expression
-    (110) boolean_expression -> expression . AND expression
-    (111) boolean_expression -> expression . OR expression
-    (133) conditional_expression -> expression . ? expression : expression
-
-    :               shift and go to state 157
-    CMP_OP          shift and go to state 70
-    IN              shift and go to state 71
-    AND             shift and go to state 72
-    OR              shift and go to state 73
-    ?               shift and go to state 74
+    (109) boolean_expression -> expression . CMP_OP expression
+    (110) boolean_expression -> expression . IN expression
+    (111) boolean_expression -> expression . AND expression
+    (112) boolean_expression -> expression . OR expression
+    (140) conditional_expression -> expression . ? expression : expression
+
+    :               shift and go to state 160
+    CMP_OP          shift and go to state 72
+    IN              shift and go to state 73
+    AND             shift and go to state 74
+    OR              shift and go to state 75
+    ?               shift and go to state 76
 
 
-state 95
+state 97
 
-    (115) boolean_expression -> map_lookup IS . DEFINED
+    (116) boolean_expression -> map_lookup IS . DEFINED
 
-    DEFINED         shift and go to state 158
+    DEFINED         shift and go to state 161
 
 
-state 96
+state 98
 
-    (119) map_lookup -> map_lookup [ . operand ]
-    (116) operand -> . expression
+    (120) map_lookup -> map_lookup [ . operand ]
+    (117) operand -> . expression
     (97) expression -> . boolean_expression
     (98) expression -> . constant
     (99) expression -> . function_call
     (100) expression -> . var_ref
     (101) expression -> . constructor
     (102) expression -> . list_def
-    (103) expression -> . map_def
-    (104) expression -> . map_lookup
-    (105) expression -> . index_lookup
-    (106) expression -> . conditional_expression
-    (107) expression -> . ( expression )
-    (108) boolean_expression -> . expression CMP_OP expression
-    (109) boolean_expression -> . expression IN expression
-    (110) boolean_expression -> . expression AND expression
-    (111) boolean_expression -> . expression OR expression
-    (112) boolean_expression -> . NOT expression
-    (113) boolean_expression -> . var_ref . ID IS DEFINED
-    (114) boolean_expression -> . ID IS DEFINED
-    (115) boolean_expression -> . map_lookup IS DEFINED
-    (134) constant -> . INT
-    (135) constant -> . FLOAT
-    (136) constant -> . NULL
-    (137) constant -> . REGEX
-    (138) constant -> . TRUE
-    (139) constant -> . FALSE
-    (140) constant -> . STRING
-    (141) constant -> . RSTRING
-    (142) constant -> . MLS
-    (121) function_call -> . ns_ref ( function_param_list )
-    (122) function_call -> . attr_ref ( function_param_list )
-    (163) var_ref -> . attr_ref
-    (165) var_ref -> . ns_ref
-    (120) constructor -> . class_ref ( param_list )
-    (123) list_def -> . [ operand_list ]
-    (130) map_def -> . { pair_list }
-    (117) map_lookup -> . attr_ref [ operand ]
-    (118) map_lookup -> . var_ref [ operand ]
-    (119) map_lookup -> . map_lookup [ operand ]
-    (131) index_lookup -> . class_ref [ param_list ]
-    (132) index_lookup -> . attr_ref [ param_list ]
-    (133) conditional_expression -> . expression ? expression : expression
-    (173) ns_ref -> . ns_ref SEP ID
-    (174) ns_ref -> . ID
-    (164) attr_ref -> . var_ref . ID
-    (166) class_ref -> . CID
-    (167) class_ref -> . ns_ref SEP CID
-    (168) class_ref -> . var_ref . CID
+    (103) expression -> . list_comprehension
+    (104) expression -> . map_def
+    (105) expression -> . map_lookup
+    (106) expression -> . index_lookup
+    (107) expression -> . conditional_expression
+    (108) expression -> . ( expression )
+    (109) boolean_expression -> . expression CMP_OP expression
+    (110) boolean_expression -> . expression IN expression
+    (111) boolean_expression -> . expression AND expression
+    (112) boolean_expression -> . expression OR expression
+    (113) boolean_expression -> . NOT expression
+    (114) boolean_expression -> . var_ref . ID IS DEFINED
+    (115) boolean_expression -> . ID IS DEFINED
+    (116) boolean_expression -> . map_lookup IS DEFINED
+    (141) constant -> . INT
+    (142) constant -> . FLOAT
+    (143) constant -> . NULL
+    (144) constant -> . REGEX
+    (145) constant -> . TRUE
+    (146) constant -> . FALSE
+    (147) constant -> . STRING
+    (148) constant -> . FSTRING
+    (149) constant -> . RSTRING
+    (150) constant -> . MLS
+    (122) function_call -> . ns_ref ( function_param_list )
+    (123) function_call -> . attr_ref ( function_param_list )
+    (171) var_ref -> . attr_ref
+    (173) var_ref -> . ns_ref
+    (121) constructor -> . class_ref ( param_list )
+    (124) list_def -> . [ operand_list ]
+    (125) list_comprehension -> . [ expression list_comprehension_for list_comprehension_guard ]
+    (137) map_def -> . { pair_list }
+    (118) map_lookup -> . attr_ref [ operand ]
+    (119) map_lookup -> . var_ref [ operand ]
+    (120) map_lookup -> . map_lookup [ operand ]
+    (138) index_lookup -> . class_ref [ param_list ]
+    (139) index_lookup -> . attr_ref [ param_list ]
+    (140) conditional_expression -> . expression ? expression : expression
+    (181) ns_ref -> . ns_ref SEP ID
+    (182) ns_ref -> . ID
+    (172) attr_ref -> . var_ref . ID
+    (174) class_ref -> . CID
+    (175) class_ref -> . ns_ref SEP CID
+    (176) class_ref -> . var_ref . CID
 
     (               shift and go to state 30
-    NOT             shift and go to state 46
-    ID              shift and go to state 82
-    INT             shift and go to state 47
-    FLOAT           shift and go to state 48
-    NULL            shift and go to state 49
-    REGEX           shift and go to state 50
-    TRUE            shift and go to state 51
-    FALSE           shift and go to state 52
-    STRING          shift and go to state 53
-    RSTRING         shift and go to state 54
+    NOT             shift and go to state 47
+    ID              shift and go to state 84
+    INT             shift and go to state 48
+    FLOAT           shift and go to state 49
+    NULL            shift and go to state 50
+    REGEX           shift and go to state 51
+    TRUE            shift and go to state 52
+    FALSE           shift and go to state 53
+    STRING          shift and go to state 54
+    FSTRING         shift and go to state 55
+    RSTRING         shift and go to state 56
     MLS             shift and go to state 20
-    [               shift and go to state 55
-    {               shift and go to state 56
+    [               shift and go to state 57
+    {               shift and go to state 58
     CID             shift and go to state 16
 
-    map_lookup                     shift and go to state 41
-    operand                        shift and go to state 159
-    expression                     shift and go to state 104
+    map_lookup                     shift and go to state 42
+    operand                        shift and go to state 162
+    expression                     shift and go to state 153
     boolean_expression             shift and go to state 35
     constant                       shift and go to state 36
     function_call                  shift and go to state 37
-    var_ref                        shift and go to state 81
+    var_ref                        shift and go to state 83
     constructor                    shift and go to state 38
     list_def                       shift and go to state 39
-    map_def                        shift and go to state 40
-    index_lookup                   shift and go to state 42
-    conditional_expression         shift and go to state 43
-    ns_ref                         shift and go to state 83
-    attr_ref                       shift and go to state 84
-    class_ref                      shift and go to state 85
+    list_comprehension             shift and go to state 40
+    map_def                        shift and go to state 41
+    index_lookup                   shift and go to state 43
+    conditional_expression         shift and go to state 44
+    ns_ref                         shift and go to state 85
+    attr_ref                       shift and go to state 86
+    class_ref                      shift and go to state 87
 
-state 97
+state 99
 
     (94) typedef_inner -> TYPEDEF ID . AS ns_ref MATCHING expression
 
-    AS              shift and go to state 160
+    AS              shift and go to state 163
 
 
-state 98
+state 100
 
     (95) typedef_inner -> TYPEDEF CID . AS constructor
 
-    AS              shift and go to state 161
+    AS              shift and go to state 164
 
 
-state 99
+state 101
 
-    (122) function_call -> attr_ref ( . function_param_list )
-    (156) function_param_list -> . function_param_list_empty
-    (158) function_param_list -> . function_param_list_element empty function_param_list_empty
-    (159) function_param_list -> . function_param_list_element , function_param_list
-    (157) function_param_list_empty -> . empty
-    (154) function_param_list_element -> . param_list_element
-    (155) function_param_list_element -> . operand
+    (123) function_call -> attr_ref ( . function_param_list )
+    (164) function_param_list -> . function_param_list_empty
+    (166) function_param_list -> . function_param_list_element empty function_param_list_empty
+    (167) function_param_list -> . function_param_list_element , function_param_list
+    (165) function_param_list_empty -> . empty
+    (162) function_param_list_element -> . param_list_element
+    (163) function_param_list_element -> . operand
     (14) empty -> .
-    (148) param_list_element -> . ID = operand
-    (149) param_list_element -> . wrapped_kwargs
-    (116) operand -> . expression
-    (147) wrapped_kwargs -> . * * operand
+    (156) param_list_element -> . ID = operand
+    (157) param_list_element -> . wrapped_kwargs
+    (117) operand -> . expression
+    (155) wrapped_kwargs -> . * * operand
     (97) expression -> . boolean_expression
     (98) expression -> . constant
     (99) expression -> . function_call
     (100) expression -> . var_ref
     (101) expression -> . constructor
     (102) expression -> . list_def
-    (103) expression -> . map_def
-    (104) expression -> . map_lookup
-    (105) expression -> . index_lookup
-    (106) expression -> . conditional_expression
-    (107) expression -> . ( expression )
-    (108) boolean_expression -> . expression CMP_OP expression
-    (109) boolean_expression -> . expression IN expression
-    (110) boolean_expression -> . expression AND expression
-    (111) boolean_expression -> . expression OR expression
-    (112) boolean_expression -> . NOT expression
-    (113) boolean_expression -> . var_ref . ID IS DEFINED
-    (114) boolean_expression -> . ID IS DEFINED
-    (115) boolean_expression -> . map_lookup IS DEFINED
-    (134) constant -> . INT
-    (135) constant -> . FLOAT
-    (136) constant -> . NULL
-    (137) constant -> . REGEX
-    (138) constant -> . TRUE
-    (139) constant -> . FALSE
-    (140) constant -> . STRING
-    (141) constant -> . RSTRING
-    (142) constant -> . MLS
-    (121) function_call -> . ns_ref ( function_param_list )
-    (122) function_call -> . attr_ref ( function_param_list )
-    (163) var_ref -> . attr_ref
-    (165) var_ref -> . ns_ref
-    (120) constructor -> . class_ref ( param_list )
-    (123) list_def -> . [ operand_list ]
-    (130) map_def -> . { pair_list }
-    (117) map_lookup -> . attr_ref [ operand ]
-    (118) map_lookup -> . var_ref [ operand ]
-    (119) map_lookup -> . map_lookup [ operand ]
-    (131) index_lookup -> . class_ref [ param_list ]
-    (132) index_lookup -> . attr_ref [ param_list ]
-    (133) conditional_expression -> . expression ? expression : expression
-    (173) ns_ref -> . ns_ref SEP ID
-    (174) ns_ref -> . ID
-    (164) attr_ref -> . var_ref . ID
-    (166) class_ref -> . CID
-    (167) class_ref -> . ns_ref SEP CID
-    (168) class_ref -> . var_ref . CID
+    (103) expression -> . list_comprehension
+    (104) expression -> . map_def
+    (105) expression -> . map_lookup
+    (106) expression -> . index_lookup
+    (107) expression -> . conditional_expression
+    (108) expression -> . ( expression )
+    (109) boolean_expression -> . expression CMP_OP expression
+    (110) boolean_expression -> . expression IN expression
+    (111) boolean_expression -> . expression AND expression
+    (112) boolean_expression -> . expression OR expression
+    (113) boolean_expression -> . NOT expression
+    (114) boolean_expression -> . var_ref . ID IS DEFINED
+    (115) boolean_expression -> . ID IS DEFINED
+    (116) boolean_expression -> . map_lookup IS DEFINED
+    (141) constant -> . INT
+    (142) constant -> . FLOAT
+    (143) constant -> . NULL
+    (144) constant -> . REGEX
+    (145) constant -> . TRUE
+    (146) constant -> . FALSE
+    (147) constant -> . STRING
+    (148) constant -> . FSTRING
+    (149) constant -> . RSTRING
+    (150) constant -> . MLS
+    (122) function_call -> . ns_ref ( function_param_list )
+    (123) function_call -> . attr_ref ( function_param_list )
+    (171) var_ref -> . attr_ref
+    (173) var_ref -> . ns_ref
+    (121) constructor -> . class_ref ( param_list )
+    (124) list_def -> . [ operand_list ]
+    (125) list_comprehension -> . [ expression list_comprehension_for list_comprehension_guard ]
+    (137) map_def -> . { pair_list }
+    (118) map_lookup -> . attr_ref [ operand ]
+    (119) map_lookup -> . var_ref [ operand ]
+    (120) map_lookup -> . map_lookup [ operand ]
+    (138) index_lookup -> . class_ref [ param_list ]
+    (139) index_lookup -> . attr_ref [ param_list ]
+    (140) conditional_expression -> . expression ? expression : expression
+    (181) ns_ref -> . ns_ref SEP ID
+    (182) ns_ref -> . ID
+    (172) attr_ref -> . var_ref . ID
+    (174) class_ref -> . CID
+    (175) class_ref -> . ns_ref SEP CID
+    (176) class_ref -> . var_ref . CID
 
     )               reduce using rule 14 (empty -> .)
-    ID              shift and go to state 150
-    *               shift and go to state 127
+    ID              shift and go to state 152
+    *               shift and go to state 129
     (               shift and go to state 30
-    NOT             shift and go to state 46
-    INT             shift and go to state 47
-    FLOAT           shift and go to state 48
-    NULL            shift and go to state 49
-    REGEX           shift and go to state 50
-    TRUE            shift and go to state 51
-    FALSE           shift and go to state 52
-    STRING          shift and go to state 53
-    RSTRING         shift and go to state 54
+    NOT             shift and go to state 47
+    INT             shift and go to state 48
+    FLOAT           shift and go to state 49
+    NULL            shift and go to state 50
+    REGEX           shift and go to state 51
+    TRUE            shift and go to state 52
+    FALSE           shift and go to state 53
+    STRING          shift and go to state 54
+    FSTRING         shift and go to state 55
+    RSTRING         shift and go to state 56
     MLS             shift and go to state 20
-    [               shift and go to state 55
-    {               shift and go to state 56
+    [               shift and go to state 57
+    {               shift and go to state 58
     CID             shift and go to state 16
 
-    attr_ref                       shift and go to state 84
-    function_param_list            shift and go to state 162
-    function_param_list_empty      shift and go to state 145
-    function_param_list_element    shift and go to state 146
-    empty                          shift and go to state 147
-    param_list_element             shift and go to state 148
-    operand                        shift and go to state 149
-    wrapped_kwargs                 shift and go to state 126
-    expression                     shift and go to state 104
+    attr_ref                       shift and go to state 86
+    function_param_list            shift and go to state 165
+    function_param_list_empty      shift and go to state 147
+    function_param_list_element    shift and go to state 148
+    empty                          shift and go to state 149
+    param_list_element             shift and go to state 150
+    operand                        shift and go to state 151
+    wrapped_kwargs                 shift and go to state 128
+    expression                     shift and go to state 153
     boolean_expression             shift and go to state 35
     constant                       shift and go to state 36
     function_call                  shift and go to state 37
-    var_ref                        shift and go to state 81
+    var_ref                        shift and go to state 83
     constructor                    shift and go to state 38
     list_def                       shift and go to state 39
-    map_def                        shift and go to state 40
-    map_lookup                     shift and go to state 41
-    index_lookup                   shift and go to state 42
-    conditional_expression         shift and go to state 43
-    ns_ref                         shift and go to state 83
-    class_ref                      shift and go to state 85
+    list_comprehension             shift and go to state 40
+    map_def                        shift and go to state 41
+    map_lookup                     shift and go to state 42
+    index_lookup                   shift and go to state 43
+    conditional_expression         shift and go to state 44
+    ns_ref                         shift and go to state 85
+    class_ref                      shift and go to state 87
 
-state 100
+state 102
 
-    (117) map_lookup -> attr_ref [ . operand ]
-    (132) index_lookup -> attr_ref [ . param_list ]
-    (116) operand -> . expression
-    (150) param_list -> . param_list_empty
-    (152) param_list -> . param_list_element empty param_list_empty
-    (153) param_list -> . param_list_element , param_list
+    (118) map_lookup -> attr_ref [ . operand ]
+    (139) index_lookup -> attr_ref [ . param_list ]
+    (117) operand -> . expression
+    (158) param_list -> . param_list_empty
+    (160) param_list -> . param_list_element empty param_list_empty
+    (161) param_list -> . param_list_element , param_list
     (97) expression -> . boolean_expression
     (98) expression -> . constant
     (99) expression -> . function_call
     (100) expression -> . var_ref
     (101) expression -> . constructor
     (102) expression -> . list_def
-    (103) expression -> . map_def
-    (104) expression -> . map_lookup
-    (105) expression -> . index_lookup
-    (106) expression -> . conditional_expression
-    (107) expression -> . ( expression )
-    (151) param_list_empty -> . empty
-    (148) param_list_element -> . ID = operand
-    (149) param_list_element -> . wrapped_kwargs
-    (108) boolean_expression -> . expression CMP_OP expression
-    (109) boolean_expression -> . expression IN expression
-    (110) boolean_expression -> . expression AND expression
-    (111) boolean_expression -> . expression OR expression
-    (112) boolean_expression -> . NOT expression
-    (113) boolean_expression -> . var_ref . ID IS DEFINED
-    (114) boolean_expression -> . ID IS DEFINED
-    (115) boolean_expression -> . map_lookup IS DEFINED
-    (134) constant -> . INT
-    (135) constant -> . FLOAT
-    (136) constant -> . NULL
-    (137) constant -> . REGEX
-    (138) constant -> . TRUE
-    (139) constant -> . FALSE
-    (140) constant -> . STRING
-    (141) constant -> . RSTRING
-    (142) constant -> . MLS
-    (121) function_call -> . ns_ref ( function_param_list )
-    (122) function_call -> . attr_ref ( function_param_list )
-    (163) var_ref -> . attr_ref
-    (165) var_ref -> . ns_ref
-    (120) constructor -> . class_ref ( param_list )
-    (123) list_def -> . [ operand_list ]
-    (130) map_def -> . { pair_list }
-    (117) map_lookup -> . attr_ref [ operand ]
-    (118) map_lookup -> . var_ref [ operand ]
-    (119) map_lookup -> . map_lookup [ operand ]
-    (131) index_lookup -> . class_ref [ param_list ]
-    (132) index_lookup -> . attr_ref [ param_list ]
-    (133) conditional_expression -> . expression ? expression : expression
+    (103) expression -> . list_comprehension
+    (104) expression -> . map_def
+    (105) expression -> . map_lookup
+    (106) expression -> . index_lookup
+    (107) expression -> . conditional_expression
+    (108) expression -> . ( expression )
+    (159) param_list_empty -> . empty
+    (156) param_list_element -> . ID = operand
+    (157) param_list_element -> . wrapped_kwargs
+    (109) boolean_expression -> . expression CMP_OP expression
+    (110) boolean_expression -> . expression IN expression
+    (111) boolean_expression -> . expression AND expression
+    (112) boolean_expression -> . expression OR expression
+    (113) boolean_expression -> . NOT expression
+    (114) boolean_expression -> . var_ref . ID IS DEFINED
+    (115) boolean_expression -> . ID IS DEFINED
+    (116) boolean_expression -> . map_lookup IS DEFINED
+    (141) constant -> . INT
+    (142) constant -> . FLOAT
+    (143) constant -> . NULL
+    (144) constant -> . REGEX
+    (145) constant -> . TRUE
+    (146) constant -> . FALSE
+    (147) constant -> . STRING
+    (148) constant -> . FSTRING
+    (149) constant -> . RSTRING
+    (150) constant -> . MLS
+    (122) function_call -> . ns_ref ( function_param_list )
+    (123) function_call -> . attr_ref ( function_param_list )
+    (171) var_ref -> . attr_ref
+    (173) var_ref -> . ns_ref
+    (121) constructor -> . class_ref ( param_list )
+    (124) list_def -> . [ operand_list ]
+    (125) list_comprehension -> . [ expression list_comprehension_for list_comprehension_guard ]
+    (137) map_def -> . { pair_list }
+    (118) map_lookup -> . attr_ref [ operand ]
+    (119) map_lookup -> . var_ref [ operand ]
+    (120) map_lookup -> . map_lookup [ operand ]
+    (138) index_lookup -> . class_ref [ param_list ]
+    (139) index_lookup -> . attr_ref [ param_list ]
+    (140) conditional_expression -> . expression ? expression : expression
     (14) empty -> .
-    (147) wrapped_kwargs -> . * * operand
-    (173) ns_ref -> . ns_ref SEP ID
-    (174) ns_ref -> . ID
-    (164) attr_ref -> . var_ref . ID
-    (166) class_ref -> . CID
-    (167) class_ref -> . ns_ref SEP CID
-    (168) class_ref -> . var_ref . CID
+    (155) wrapped_kwargs -> . * * operand
+    (181) ns_ref -> . ns_ref SEP ID
+    (182) ns_ref -> . ID
+    (172) attr_ref -> . var_ref . ID
+    (174) class_ref -> . CID
+    (175) class_ref -> . ns_ref SEP CID
+    (176) class_ref -> . var_ref . CID
 
     (               shift and go to state 30
-    ID              shift and go to state 150
-    NOT             shift and go to state 46
-    INT             shift and go to state 47
-    FLOAT           shift and go to state 48
-    NULL            shift and go to state 49
-    REGEX           shift and go to state 50
-    TRUE            shift and go to state 51
-    FALSE           shift and go to state 52
-    STRING          shift and go to state 53
-    RSTRING         shift and go to state 54
+    ID              shift and go to state 152
+    NOT             shift and go to state 47
+    INT             shift and go to state 48
+    FLOAT           shift and go to state 49
+    NULL            shift and go to state 50
+    REGEX           shift and go to state 51
+    TRUE            shift and go to state 52
+    FALSE           shift and go to state 53
+    STRING          shift and go to state 54
+    FSTRING         shift and go to state 55
+    RSTRING         shift and go to state 56
     MLS             shift and go to state 20
-    [               shift and go to state 55
-    {               shift and go to state 56
+    [               shift and go to state 57
+    {               shift and go to state 58
     ]               reduce using rule 14 (empty -> .)
-    *               shift and go to state 127
+    *               shift and go to state 129
     CID             shift and go to state 16
 
-    attr_ref                       shift and go to state 84
-    operand                        shift and go to state 163
-    param_list                     shift and go to state 164
-    expression                     shift and go to state 104
-    param_list_empty               shift and go to state 122
-    param_list_element             shift and go to state 123
-    empty                          shift and go to state 124
+    attr_ref                       shift and go to state 86
+    operand                        shift and go to state 166
+    param_list                     shift and go to state 167
+    expression                     shift and go to state 153
+    param_list_empty               shift and go to state 124
+    param_list_element             shift and go to state 125
+    empty                          shift and go to state 126
     boolean_expression             shift and go to state 35
     constant                       shift and go to state 36
     function_call                  shift and go to state 37
-    var_ref                        shift and go to state 81
+    var_ref                        shift and go to state 83
     constructor                    shift and go to state 38
     list_def                       shift and go to state 39
-    map_def                        shift and go to state 40
-    map_lookup                     shift and go to state 41
-    index_lookup                   shift and go to state 42
-    conditional_expression         shift and go to state 43
-    wrapped_kwargs                 shift and go to state 126
-    ns_ref                         shift and go to state 83
-    class_ref                      shift and go to state 85
-
-state 101
-
-    (112) boolean_expression -> NOT expression .
-    (108) boolean_expression -> expression . CMP_OP expression
-    (109) boolean_expression -> expression . IN expression
-    (110) boolean_expression -> expression . AND expression
-    (111) boolean_expression -> expression . OR expression
-    (133) conditional_expression -> expression . ? expression : expression
-
-    CMP_OP          reduce using rule 112 (boolean_expression -> NOT expression .)
-    AND             reduce using rule 112 (boolean_expression -> NOT expression .)
-    OR              reduce using rule 112 (boolean_expression -> NOT expression .)
-    ?               reduce using rule 112 (boolean_expression -> NOT expression .)
-    ENTITY          reduce using rule 112 (boolean_expression -> NOT expression .)
-    IMPLEMENT       reduce using rule 112 (boolean_expression -> NOT expression .)
-    IMPLEMENTATION  reduce using rule 112 (boolean_expression -> NOT expression .)
-    INDEX           reduce using rule 112 (boolean_expression -> NOT expression .)
-    IMPORT          reduce using rule 112 (boolean_expression -> NOT expression .)
-    CID             reduce using rule 112 (boolean_expression -> NOT expression .)
-    FOR             reduce using rule 112 (boolean_expression -> NOT expression .)
-    IF              reduce using rule 112 (boolean_expression -> NOT expression .)
-    (               reduce using rule 112 (boolean_expression -> NOT expression .)
-    TYPEDEF         reduce using rule 112 (boolean_expression -> NOT expression .)
-    ID              reduce using rule 112 (boolean_expression -> NOT expression .)
-    NOT             reduce using rule 112 (boolean_expression -> NOT expression .)
-    INT             reduce using rule 112 (boolean_expression -> NOT expression .)
-    FLOAT           reduce using rule 112 (boolean_expression -> NOT expression .)
-    NULL            reduce using rule 112 (boolean_expression -> NOT expression .)
-    REGEX           reduce using rule 112 (boolean_expression -> NOT expression .)
-    TRUE            reduce using rule 112 (boolean_expression -> NOT expression .)
-    FALSE           reduce using rule 112 (boolean_expression -> NOT expression .)
-    STRING          reduce using rule 112 (boolean_expression -> NOT expression .)
-    RSTRING         reduce using rule 112 (boolean_expression -> NOT expression .)
-    MLS             reduce using rule 112 (boolean_expression -> NOT expression .)
-    [               reduce using rule 112 (boolean_expression -> NOT expression .)
-    {               reduce using rule 112 (boolean_expression -> NOT expression .)
-    $end            reduce using rule 112 (boolean_expression -> NOT expression .)
-    )               reduce using rule 112 (boolean_expression -> NOT expression .)
-    :               reduce using rule 112 (boolean_expression -> NOT expression .)
-    ,               reduce using rule 112 (boolean_expression -> NOT expression .)
-    ]               reduce using rule 112 (boolean_expression -> NOT expression .)
-    ELSE            reduce using rule 112 (boolean_expression -> NOT expression .)
-    ELIF            reduce using rule 112 (boolean_expression -> NOT expression .)
-    END             reduce using rule 112 (boolean_expression -> NOT expression .)
-    }               reduce using rule 112 (boolean_expression -> NOT expression .)
-    IN              shift and go to state 71
-
-  ! IN              [ reduce using rule 112 (boolean_expression -> NOT expression .) ]
-  ! CMP_OP          [ shift and go to state 70 ]
-  ! AND             [ shift and go to state 72 ]
-  ! OR              [ shift and go to state 73 ]
-  ! ?               [ shift and go to state 74 ]
-
-
-state 102
-
-    (123) list_def -> [ operand_list . ]
-
-    ]               shift and go to state 165
-
+    list_comprehension             shift and go to state 40
+    map_def                        shift and go to state 41
+    map_lookup                     shift and go to state 42
+    index_lookup                   shift and go to state 43
+    conditional_expression         shift and go to state 44
+    wrapped_kwargs                 shift and go to state 128
+    ns_ref                         shift and go to state 85
+    class_ref                      shift and go to state 87
 
 state 103
 
-    (160) operand_list -> operand . , operand_list
-    (161) operand_list -> operand .
-
-    ,               shift and go to state 166
-    ]               reduce using rule 161 (operand_list -> operand .)
-    CID             reduce using rule 161 (operand_list -> operand .)
-    ID              reduce using rule 161 (operand_list -> operand .)
+    (113) boolean_expression -> NOT expression .
+    (109) boolean_expression -> expression . CMP_OP expression
+    (110) boolean_expression -> expression . IN expression
+    (111) boolean_expression -> expression . AND expression
+    (112) boolean_expression -> expression . OR expression
+    (140) conditional_expression -> expression . ? expression : expression
+
+    CMP_OP          reduce using rule 113 (boolean_expression -> NOT expression .)
+    AND             reduce using rule 113 (boolean_expression -> NOT expression .)
+    OR              reduce using rule 113 (boolean_expression -> NOT expression .)
+    ?               reduce using rule 113 (boolean_expression -> NOT expression .)
+    ENTITY          reduce using rule 113 (boolean_expression -> NOT expression .)
+    IMPLEMENT       reduce using rule 113 (boolean_expression -> NOT expression .)
+    IMPLEMENTATION  reduce using rule 113 (boolean_expression -> NOT expression .)
+    INDEX           reduce using rule 113 (boolean_expression -> NOT expression .)
+    IMPORT          reduce using rule 113 (boolean_expression -> NOT expression .)
+    CID             reduce using rule 113 (boolean_expression -> NOT expression .)
+    FOR             reduce using rule 113 (boolean_expression -> NOT expression .)
+    IF              reduce using rule 113 (boolean_expression -> NOT expression .)
+    (               reduce using rule 113 (boolean_expression -> NOT expression .)
+    TYPEDEF         reduce using rule 113 (boolean_expression -> NOT expression .)
+    ID              reduce using rule 113 (boolean_expression -> NOT expression .)
+    NOT             reduce using rule 113 (boolean_expression -> NOT expression .)
+    INT             reduce using rule 113 (boolean_expression -> NOT expression .)
+    FLOAT           reduce using rule 113 (boolean_expression -> NOT expression .)
+    NULL            reduce using rule 113 (boolean_expression -> NOT expression .)
+    REGEX           reduce using rule 113 (boolean_expression -> NOT expression .)
+    TRUE            reduce using rule 113 (boolean_expression -> NOT expression .)
+    FALSE           reduce using rule 113 (boolean_expression -> NOT expression .)
+    STRING          reduce using rule 113 (boolean_expression -> NOT expression .)
+    FSTRING         reduce using rule 113 (boolean_expression -> NOT expression .)
+    RSTRING         reduce using rule 113 (boolean_expression -> NOT expression .)
+    MLS             reduce using rule 113 (boolean_expression -> NOT expression .)
+    [               reduce using rule 113 (boolean_expression -> NOT expression .)
+    {               reduce using rule 113 (boolean_expression -> NOT expression .)
+    $end            reduce using rule 113 (boolean_expression -> NOT expression .)
+    )               reduce using rule 113 (boolean_expression -> NOT expression .)
+    :               reduce using rule 113 (boolean_expression -> NOT expression .)
+    ,               reduce using rule 113 (boolean_expression -> NOT expression .)
+    ]               reduce using rule 113 (boolean_expression -> NOT expression .)
+    ELSE            reduce using rule 113 (boolean_expression -> NOT expression .)
+    ELIF            reduce using rule 113 (boolean_expression -> NOT expression .)
+    END             reduce using rule 113 (boolean_expression -> NOT expression .)
+    }               reduce using rule 113 (boolean_expression -> NOT expression .)
+    IN              shift and go to state 73
+
+  ! IN              [ reduce using rule 113 (boolean_expression -> NOT expression .) ]
+  ! CMP_OP          [ shift and go to state 72 ]
+  ! AND             [ shift and go to state 74 ]
+  ! OR              [ shift and go to state 75 ]
+  ! ?               [ shift and go to state 76 ]
 
 
 state 104
 
-    (116) operand -> expression .
-    (108) boolean_expression -> expression . CMP_OP expression
-    (109) boolean_expression -> expression . IN expression
-    (110) boolean_expression -> expression . AND expression
-    (111) boolean_expression -> expression . OR expression
-    (133) conditional_expression -> expression . ? expression : expression
-
-    ,               reduce using rule 116 (operand -> expression .)
-    ]               reduce using rule 116 (operand -> expression .)
-    )               reduce using rule 116 (operand -> expression .)
-    ENTITY          reduce using rule 116 (operand -> expression .)
-    IMPLEMENT       reduce using rule 116 (operand -> expression .)
-    IMPLEMENTATION  reduce using rule 116 (operand -> expression .)
-    INDEX           reduce using rule 116 (operand -> expression .)
-    IMPORT          reduce using rule 116 (operand -> expression .)
-    CID             reduce using rule 116 (operand -> expression .)
-    FOR             reduce using rule 116 (operand -> expression .)
-    IF              reduce using rule 116 (operand -> expression .)
-    (               reduce using rule 116 (operand -> expression .)
-    TYPEDEF         reduce using rule 116 (operand -> expression .)
-    ID              reduce using rule 116 (operand -> expression .)
-    NOT             reduce using rule 116 (operand -> expression .)
-    INT             reduce using rule 116 (operand -> expression .)
-    FLOAT           reduce using rule 116 (operand -> expression .)
-    NULL            reduce using rule 116 (operand -> expression .)
-    REGEX           reduce using rule 116 (operand -> expression .)
-    TRUE            reduce using rule 116 (operand -> expression .)
-    FALSE           reduce using rule 116 (operand -> expression .)
-    STRING          reduce using rule 116 (operand -> expression .)
-    RSTRING         reduce using rule 116 (operand -> expression .)
-    MLS             reduce using rule 116 (operand -> expression .)
-    [               reduce using rule 116 (operand -> expression .)
-    {               reduce using rule 116 (operand -> expression .)
-    $end            reduce using rule 116 (operand -> expression .)
-    ELSE            reduce using rule 116 (operand -> expression .)
-    ELIF            reduce using rule 116 (operand -> expression .)
-    END             reduce using rule 116 (operand -> expression .)
-    :               reduce using rule 116 (operand -> expression .)
-    }               reduce using rule 116 (operand -> expression .)
-    CMP_OP          shift and go to state 70
-    IN              shift and go to state 71
-    AND             shift and go to state 72
-    OR              shift and go to state 73
-    ?               shift and go to state 74
+    (124) list_def -> [ operand_list . ]
 
+    ]               shift and go to state 168
 
-state 105
 
-    (130) map_def -> { pair_list . }
+state 105
 
-    }               shift and go to state 167
+    (125) list_comprehension -> [ expression . list_comprehension_for list_comprehension_guard ]
+    (117) operand -> expression .
+    (109) boolean_expression -> expression . CMP_OP expression
+    (110) boolean_expression -> expression . IN expression
+    (111) boolean_expression -> expression . AND expression
+    (112) boolean_expression -> expression . OR expression
+    (140) conditional_expression -> expression . ? expression : expression
+    (127) list_comprehension_for -> . FOR ID IN expression list_comprehension_for_empty
+    (128) list_comprehension_for -> . FOR ID IN expression list_comprehension_for
+
+    ,               reduce using rule 117 (operand -> expression .)
+    ]               reduce using rule 117 (operand -> expression .)
+    CMP_OP          shift and go to state 72
+    IN              shift and go to state 73
+    AND             shift and go to state 74
+    OR              shift and go to state 75
+    ?               shift and go to state 76
+    FOR             shift and go to state 170
 
+    list_comprehension_for         shift and go to state 169
 
 state 106
 
-    (126) pair_list -> dict_key . : operand , pair_list
-    (127) pair_list -> dict_key . : operand empty pair_list_empty
+    (168) operand_list -> operand . , operand_list
+    (169) operand_list -> operand .
 
-    :               shift and go to state 168
+    ,               shift and go to state 171
+    ]               reduce using rule 169 (operand_list -> operand .)
+    CID             reduce using rule 169 (operand_list -> operand .)
+    ID              reduce using rule 169 (operand_list -> operand .)
 
 
 state 107
 
-    (129) pair_list_empty -> empty .
+    (137) map_def -> { pair_list . }
 
-    }               reduce using rule 129 (pair_list_empty -> empty .)
+    }               shift and go to state 172
 
 
 state 108
 
-    (128) pair_list -> pair_list_empty .
+    (133) pair_list -> dict_key . : operand , pair_list
+    (134) pair_list -> dict_key . : operand empty pair_list_empty
 
-    }               reduce using rule 128 (pair_list -> pair_list_empty .)
+    :               shift and go to state 173
 
 
 state 109
 
-    (124) dict_key -> RSTRING .
+    (136) pair_list_empty -> empty .
 
-    :               reduce using rule 124 (dict_key -> RSTRING .)
+    }               reduce using rule 136 (pair_list_empty -> empty .)
 
 
 state 110
 
-    (125) dict_key -> STRING .
+    (135) pair_list -> pair_list_empty .
 
-    :               reduce using rule 125 (dict_key -> STRING .)
+    }               reduce using rule 135 (pair_list -> pair_list_empty .)
 
 
 state 111
 
+    (131) dict_key -> RSTRING .
+
+    :               reduce using rule 131 (dict_key -> RSTRING .)
+
+
+state 112
+
+    (132) dict_key -> STRING .
+
+    :               reduce using rule 132 (dict_key -> STRING .)
+
+
+state 113
+
     (31) entity_def -> ENTITY CID : . entity_body_outer
     (35) entity_body_outer -> . MLS entity_body END
     (36) entity_body_outer -> . entity_body END
     (37) entity_body_outer -> . END
     (38) entity_body_outer -> . MLS END
     (39) entity_body -> . entity_body attr
     (40) entity_body -> . attr
@@ -4424,57 +4640,57 @@
     (45) attr_type -> . attr_type_opt
     (46) attr_type -> . attr_type_multi
     (47) attr_type -> . attr_base_type
     (43) attr_type_opt -> . attr_type_multi ?
     (44) attr_type_opt -> . attr_base_type ?
     (42) attr_type_multi -> . attr_base_type [ ]
     (41) attr_base_type -> . ns_ref
-    (173) ns_ref -> . ns_ref SEP ID
-    (174) ns_ref -> . ID
+    (181) ns_ref -> . ns_ref SEP ID
+    (182) ns_ref -> . ID
 
-    MLS             shift and go to state 170
-    END             shift and go to state 172
-    DICT            shift and go to state 175
-    ID              shift and go to state 64
-
-    entity_body_outer              shift and go to state 169
-    entity_body                    shift and go to state 171
-    attr                           shift and go to state 173
-    attr_type                      shift and go to state 174
-    attr_type_opt                  shift and go to state 176
-    attr_type_multi                shift and go to state 177
-    attr_base_type                 shift and go to state 178
-    ns_ref                         shift and go to state 179
+    MLS             shift and go to state 175
+    END             shift and go to state 177
+    DICT            shift and go to state 180
+    ID              shift and go to state 66
 
-state 112
+    entity_body_outer              shift and go to state 174
+    entity_body                    shift and go to state 176
+    attr                           shift and go to state 178
+    attr_type                      shift and go to state 179
+    attr_type_opt                  shift and go to state 181
+    attr_type_multi                shift and go to state 182
+    attr_base_type                 shift and go to state 183
+    ns_ref                         shift and go to state 184
+
+state 114
 
     (33) entity_def -> ENTITY CID EXTENDS . class_ref_list : entity_body_outer
-    (169) class_ref_list -> . class_ref , class_ref_list
-    (170) class_ref_list -> . var_ref , class_ref_list
-    (171) class_ref_list -> . class_ref
-    (172) class_ref_list -> . var_ref
-    (166) class_ref -> . CID
-    (167) class_ref -> . ns_ref SEP CID
-    (168) class_ref -> . var_ref . CID
-    (163) var_ref -> . attr_ref
-    (165) var_ref -> . ns_ref
-    (173) ns_ref -> . ns_ref SEP ID
-    (174) ns_ref -> . ID
-    (164) attr_ref -> . var_ref . ID
-
-    CID             shift and go to state 16
-    ID              shift and go to state 64
-
-    class_ref_list                 shift and go to state 180
-    class_ref                      shift and go to state 181
-    var_ref                        shift and go to state 182
-    ns_ref                         shift and go to state 183
-    attr_ref                       shift and go to state 65
+    (177) class_ref_list -> . class_ref , class_ref_list
+    (178) class_ref_list -> . var_ref , class_ref_list
+    (179) class_ref_list -> . class_ref
+    (180) class_ref_list -> . var_ref
+    (174) class_ref -> . CID
+    (175) class_ref -> . ns_ref SEP CID
+    (176) class_ref -> . var_ref . CID
+    (171) var_ref -> . attr_ref
+    (173) var_ref -> . ns_ref
+    (181) ns_ref -> . ns_ref SEP ID
+    (182) ns_ref -> . ID
+    (172) attr_ref -> . var_ref . ID
 
-state 113
+    CID             shift and go to state 16
+    ID              shift and go to state 66
+
+    class_ref_list                 shift and go to state 185
+    class_ref                      shift and go to state 186
+    var_ref                        shift and go to state 187
+    ns_ref                         shift and go to state 188
+    attr_ref                       shift and go to state 67
+
+state 115
 
     (32) entity_def -> ENTITY ID : . entity_body_outer
     (35) entity_body_outer -> . MLS entity_body END
     (36) entity_body_outer -> . entity_body END
     (37) entity_body_outer -> . END
     (38) entity_body_outer -> . MLS END
     (39) entity_body -> . entity_body attr
@@ -4502,886 +4718,950 @@
     (45) attr_type -> . attr_type_opt
     (46) attr_type -> . attr_type_multi
     (47) attr_type -> . attr_base_type
     (43) attr_type_opt -> . attr_type_multi ?
     (44) attr_type_opt -> . attr_base_type ?
     (42) attr_type_multi -> . attr_base_type [ ]
     (41) attr_base_type -> . ns_ref
-    (173) ns_ref -> . ns_ref SEP ID
-    (174) ns_ref -> . ID
+    (181) ns_ref -> . ns_ref SEP ID
+    (182) ns_ref -> . ID
 
-    MLS             shift and go to state 170
-    END             shift and go to state 172
-    DICT            shift and go to state 175
-    ID              shift and go to state 64
-
-    entity_body_outer              shift and go to state 184
-    entity_body                    shift and go to state 171
-    attr                           shift and go to state 173
-    attr_type                      shift and go to state 174
-    attr_type_opt                  shift and go to state 176
-    attr_type_multi                shift and go to state 177
-    attr_base_type                 shift and go to state 178
-    ns_ref                         shift and go to state 179
+    MLS             shift and go to state 175
+    END             shift and go to state 177
+    DICT            shift and go to state 180
+    ID              shift and go to state 66
 
-state 114
+    entity_body_outer              shift and go to state 189
+    entity_body                    shift and go to state 176
+    attr                           shift and go to state 178
+    attr_type                      shift and go to state 179
+    attr_type_opt                  shift and go to state 181
+    attr_type_multi                shift and go to state 182
+    attr_base_type                 shift and go to state 183
+    ns_ref                         shift and go to state 184
+
+state 116
 
     (34) entity_def -> ENTITY ID EXTENDS . class_ref_list : entity_body_outer
-    (169) class_ref_list -> . class_ref , class_ref_list
-    (170) class_ref_list -> . var_ref , class_ref_list
-    (171) class_ref_list -> . class_ref
-    (172) class_ref_list -> . var_ref
-    (166) class_ref -> . CID
-    (167) class_ref -> . ns_ref SEP CID
-    (168) class_ref -> . var_ref . CID
-    (163) var_ref -> . attr_ref
-    (165) var_ref -> . ns_ref
-    (173) ns_ref -> . ns_ref SEP ID
-    (174) ns_ref -> . ID
-    (164) attr_ref -> . var_ref . ID
+    (177) class_ref_list -> . class_ref , class_ref_list
+    (178) class_ref_list -> . var_ref , class_ref_list
+    (179) class_ref_list -> . class_ref
+    (180) class_ref_list -> . var_ref
+    (174) class_ref -> . CID
+    (175) class_ref -> . ns_ref SEP CID
+    (176) class_ref -> . var_ref . CID
+    (171) var_ref -> . attr_ref
+    (173) var_ref -> . ns_ref
+    (181) ns_ref -> . ns_ref SEP ID
+    (182) ns_ref -> . ID
+    (172) attr_ref -> . var_ref . ID
 
     CID             shift and go to state 16
-    ID              shift and go to state 64
+    ID              shift and go to state 66
 
-    class_ref_list                 shift and go to state 185
-    class_ref                      shift and go to state 181
-    var_ref                        shift and go to state 182
-    ns_ref                         shift and go to state 183
-    attr_ref                       shift and go to state 65
+    class_ref_list                 shift and go to state 190
+    class_ref                      shift and go to state 186
+    var_ref                        shift and go to state 187
+    ns_ref                         shift and go to state 188
+    attr_ref                       shift and go to state 67
 
-state 115
+state 117
 
-    (114) boolean_expression -> ID IS DEFINED .
+    (115) boolean_expression -> ID IS DEFINED .
 
-    CMP_OP          reduce using rule 114 (boolean_expression -> ID IS DEFINED .)
-    IN              reduce using rule 114 (boolean_expression -> ID IS DEFINED .)
-    AND             reduce using rule 114 (boolean_expression -> ID IS DEFINED .)
-    OR              reduce using rule 114 (boolean_expression -> ID IS DEFINED .)
-    ?               reduce using rule 114 (boolean_expression -> ID IS DEFINED .)
-    ENTITY          reduce using rule 114 (boolean_expression -> ID IS DEFINED .)
-    IMPLEMENT       reduce using rule 114 (boolean_expression -> ID IS DEFINED .)
-    IMPLEMENTATION  reduce using rule 114 (boolean_expression -> ID IS DEFINED .)
-    INDEX           reduce using rule 114 (boolean_expression -> ID IS DEFINED .)
-    IMPORT          reduce using rule 114 (boolean_expression -> ID IS DEFINED .)
-    CID             reduce using rule 114 (boolean_expression -> ID IS DEFINED .)
-    FOR             reduce using rule 114 (boolean_expression -> ID IS DEFINED .)
-    IF              reduce using rule 114 (boolean_expression -> ID IS DEFINED .)
-    (               reduce using rule 114 (boolean_expression -> ID IS DEFINED .)
-    TYPEDEF         reduce using rule 114 (boolean_expression -> ID IS DEFINED .)
-    ID              reduce using rule 114 (boolean_expression -> ID IS DEFINED .)
-    NOT             reduce using rule 114 (boolean_expression -> ID IS DEFINED .)
-    INT             reduce using rule 114 (boolean_expression -> ID IS DEFINED .)
-    FLOAT           reduce using rule 114 (boolean_expression -> ID IS DEFINED .)
-    NULL            reduce using rule 114 (boolean_expression -> ID IS DEFINED .)
-    REGEX           reduce using rule 114 (boolean_expression -> ID IS DEFINED .)
-    TRUE            reduce using rule 114 (boolean_expression -> ID IS DEFINED .)
-    FALSE           reduce using rule 114 (boolean_expression -> ID IS DEFINED .)
-    STRING          reduce using rule 114 (boolean_expression -> ID IS DEFINED .)
-    RSTRING         reduce using rule 114 (boolean_expression -> ID IS DEFINED .)
-    MLS             reduce using rule 114 (boolean_expression -> ID IS DEFINED .)
-    [               reduce using rule 114 (boolean_expression -> ID IS DEFINED .)
-    {               reduce using rule 114 (boolean_expression -> ID IS DEFINED .)
-    $end            reduce using rule 114 (boolean_expression -> ID IS DEFINED .)
-    )               reduce using rule 114 (boolean_expression -> ID IS DEFINED .)
-    :               reduce using rule 114 (boolean_expression -> ID IS DEFINED .)
-    ,               reduce using rule 114 (boolean_expression -> ID IS DEFINED .)
-    ]               reduce using rule 114 (boolean_expression -> ID IS DEFINED .)
-    ELSE            reduce using rule 114 (boolean_expression -> ID IS DEFINED .)
-    ELIF            reduce using rule 114 (boolean_expression -> ID IS DEFINED .)
-    END             reduce using rule 114 (boolean_expression -> ID IS DEFINED .)
-    }               reduce using rule 114 (boolean_expression -> ID IS DEFINED .)
+    CMP_OP          reduce using rule 115 (boolean_expression -> ID IS DEFINED .)
+    IN              reduce using rule 115 (boolean_expression -> ID IS DEFINED .)
+    AND             reduce using rule 115 (boolean_expression -> ID IS DEFINED .)
+    OR              reduce using rule 115 (boolean_expression -> ID IS DEFINED .)
+    ?               reduce using rule 115 (boolean_expression -> ID IS DEFINED .)
+    ENTITY          reduce using rule 115 (boolean_expression -> ID IS DEFINED .)
+    IMPLEMENT       reduce using rule 115 (boolean_expression -> ID IS DEFINED .)
+    IMPLEMENTATION  reduce using rule 115 (boolean_expression -> ID IS DEFINED .)
+    INDEX           reduce using rule 115 (boolean_expression -> ID IS DEFINED .)
+    IMPORT          reduce using rule 115 (boolean_expression -> ID IS DEFINED .)
+    CID             reduce using rule 115 (boolean_expression -> ID IS DEFINED .)
+    FOR             reduce using rule 115 (boolean_expression -> ID IS DEFINED .)
+    IF              reduce using rule 115 (boolean_expression -> ID IS DEFINED .)
+    (               reduce using rule 115 (boolean_expression -> ID IS DEFINED .)
+    TYPEDEF         reduce using rule 115 (boolean_expression -> ID IS DEFINED .)
+    ID              reduce using rule 115 (boolean_expression -> ID IS DEFINED .)
+    NOT             reduce using rule 115 (boolean_expression -> ID IS DEFINED .)
+    INT             reduce using rule 115 (boolean_expression -> ID IS DEFINED .)
+    FLOAT           reduce using rule 115 (boolean_expression -> ID IS DEFINED .)
+    NULL            reduce using rule 115 (boolean_expression -> ID IS DEFINED .)
+    REGEX           reduce using rule 115 (boolean_expression -> ID IS DEFINED .)
+    TRUE            reduce using rule 115 (boolean_expression -> ID IS DEFINED .)
+    FALSE           reduce using rule 115 (boolean_expression -> ID IS DEFINED .)
+    STRING          reduce using rule 115 (boolean_expression -> ID IS DEFINED .)
+    FSTRING         reduce using rule 115 (boolean_expression -> ID IS DEFINED .)
+    RSTRING         reduce using rule 115 (boolean_expression -> ID IS DEFINED .)
+    MLS             reduce using rule 115 (boolean_expression -> ID IS DEFINED .)
+    [               reduce using rule 115 (boolean_expression -> ID IS DEFINED .)
+    {               reduce using rule 115 (boolean_expression -> ID IS DEFINED .)
+    $end            reduce using rule 115 (boolean_expression -> ID IS DEFINED .)
+    )               reduce using rule 115 (boolean_expression -> ID IS DEFINED .)
+    :               reduce using rule 115 (boolean_expression -> ID IS DEFINED .)
+    ,               reduce using rule 115 (boolean_expression -> ID IS DEFINED .)
+    ]               reduce using rule 115 (boolean_expression -> ID IS DEFINED .)
+    ELSE            reduce using rule 115 (boolean_expression -> ID IS DEFINED .)
+    ELIF            reduce using rule 115 (boolean_expression -> ID IS DEFINED .)
+    END             reduce using rule 115 (boolean_expression -> ID IS DEFINED .)
+    }               reduce using rule 115 (boolean_expression -> ID IS DEFINED .)
 
 
-state 116
+state 118
 
     (71) implement_def -> IMPLEMENT class_ref USING . implement_ns_list empty
     (72) implement_def -> IMPLEMENT class_ref USING . implement_ns_list MLS
     (73) implement_def -> IMPLEMENT class_ref USING . implement_ns_list WHEN expression empty
     (74) implement_def -> IMPLEMENT class_ref USING . implement_ns_list WHEN expression MLS
     (68) implement_ns_list -> . ns_ref
     (69) implement_ns_list -> . PARENTS
     (70) implement_ns_list -> . implement_ns_list , implement_ns_list
-    (173) ns_ref -> . ns_ref SEP ID
-    (174) ns_ref -> . ID
+    (181) ns_ref -> . ns_ref SEP ID
+    (182) ns_ref -> . ID
 
-    PARENTS         shift and go to state 188
-    ID              shift and go to state 64
+    PARENTS         shift and go to state 193
+    ID              shift and go to state 66
 
-    implement_ns_list              shift and go to state 186
-    ns_ref                         shift and go to state 187
+    implement_ns_list              shift and go to state 191
+    ns_ref                         shift and go to state 192
 
-state 117
+state 119
 
-    (168) class_ref -> var_ref . . CID
-    (164) attr_ref -> var_ref . . ID
+    (176) class_ref -> var_ref . . CID
+    (172) attr_ref -> var_ref . . ID
 
-    CID             shift and go to state 151
-    ID              shift and go to state 189
+    CID             shift and go to state 154
+    ID              shift and go to state 194
 
 
-state 118
+state 120
 
     (80) relation -> class_ref ID multi . REL multi class_ref ID
     (81) relation -> class_ref ID multi . REL multi class_ref ID MLS
 
-    REL             shift and go to state 190
+    REL             shift and go to state 195
 
 
-state 119
+state 121
 
     (88) multi -> [ . INT ]
     (89) multi -> [ . INT : ]
     (90) multi -> [ . INT : INT ]
     (91) multi -> [ . : INT ]
 
-    INT             shift and go to state 191
-    :               shift and go to state 192
+    INT             shift and go to state 196
+    :               shift and go to state 197
 
 
-state 120
+state 122
 
     (84) relation_def -> class_ref . ID . multi REL class_ref . ID multi
     (85) relation_def -> class_ref . ID . multi REL class_ref
     (86) relation_def -> class_ref . ID . multi operand_list class_ref . ID multi
     (87) relation_def -> class_ref . ID . multi operand_list class_ref
     (88) multi -> . [ INT ]
     (89) multi -> . [ INT : ]
     (90) multi -> . [ INT : INT ]
     (91) multi -> . [ : INT ]
 
-    [               shift and go to state 119
-
-    multi                          shift and go to state 193
-
-state 121
-
-    (120) constructor -> class_ref ( param_list . )
-
-    )               shift and go to state 194
-
-
-state 122
-
-    (150) param_list -> param_list_empty .
-
-    )               reduce using rule 150 (param_list -> param_list_empty .)
-    ]               reduce using rule 150 (param_list -> param_list_empty .)
+    [               shift and go to state 121
 
+    multi                          shift and go to state 198
 
 state 123
 
-    (152) param_list -> param_list_element . empty param_list_empty
-    (153) param_list -> param_list_element . , param_list
-    (14) empty -> .
+    (121) constructor -> class_ref ( param_list . )
 
-    ,               shift and go to state 196
-    )               reduce using rule 14 (empty -> .)
-    ]               reduce using rule 14 (empty -> .)
+    )               shift and go to state 199
 
-    empty                          shift and go to state 195
 
 state 124
 
-    (151) param_list_empty -> empty .
+    (158) param_list -> param_list_empty .
 
-    )               reduce using rule 151 (param_list_empty -> empty .)
-    ]               reduce using rule 151 (param_list_empty -> empty .)
+    )               reduce using rule 158 (param_list -> param_list_empty .)
+    ]               reduce using rule 158 (param_list -> param_list_empty .)
 
 
 state 125
 
-    (148) param_list_element -> ID . = operand
+    (160) param_list -> param_list_element . empty param_list_empty
+    (161) param_list -> param_list_element . , param_list
+    (14) empty -> .
 
-    =               shift and go to state 197
+    ,               shift and go to state 201
+    )               reduce using rule 14 (empty -> .)
+    ]               reduce using rule 14 (empty -> .)
 
+    empty                          shift and go to state 200
 
 state 126
 
-    (149) param_list_element -> wrapped_kwargs .
+    (159) param_list_empty -> empty .
 
-    ,               reduce using rule 149 (param_list_element -> wrapped_kwargs .)
-    )               reduce using rule 149 (param_list_element -> wrapped_kwargs .)
-    ]               reduce using rule 149 (param_list_element -> wrapped_kwargs .)
+    )               reduce using rule 159 (param_list_empty -> empty .)
+    ]               reduce using rule 159 (param_list_empty -> empty .)
 
 
 state 127
 
-    (147) wrapped_kwargs -> * . * operand
+    (156) param_list_element -> ID . = operand
 
-    *               shift and go to state 198
+    =               shift and go to state 202
 
 
 state 128
 
-    (131) index_lookup -> class_ref [ param_list . ]
+    (157) param_list_element -> wrapped_kwargs .
 
-    ]               shift and go to state 199
+    ,               reduce using rule 157 (param_list_element -> wrapped_kwargs .)
+    )               reduce using rule 157 (param_list_element -> wrapped_kwargs .)
+    ]               reduce using rule 157 (param_list_element -> wrapped_kwargs .)
 
 
 state 129
 
-    (108) boolean_expression -> expression CMP_OP expression .
-    (108) boolean_expression -> expression . CMP_OP expression
-    (109) boolean_expression -> expression . IN expression
-    (110) boolean_expression -> expression . AND expression
-    (111) boolean_expression -> expression . OR expression
-    (133) conditional_expression -> expression . ? expression : expression
-
-    CMP_OP          reduce using rule 108 (boolean_expression -> expression CMP_OP expression .)
-    AND             reduce using rule 108 (boolean_expression -> expression CMP_OP expression .)
-    OR              reduce using rule 108 (boolean_expression -> expression CMP_OP expression .)
-    ?               reduce using rule 108 (boolean_expression -> expression CMP_OP expression .)
-    ENTITY          reduce using rule 108 (boolean_expression -> expression CMP_OP expression .)
-    IMPLEMENT       reduce using rule 108 (boolean_expression -> expression CMP_OP expression .)
-    IMPLEMENTATION  reduce using rule 108 (boolean_expression -> expression CMP_OP expression .)
-    INDEX           reduce using rule 108 (boolean_expression -> expression CMP_OP expression .)
-    IMPORT          reduce using rule 108 (boolean_expression -> expression CMP_OP expression .)
-    CID             reduce using rule 108 (boolean_expression -> expression CMP_OP expression .)
-    FOR             reduce using rule 108 (boolean_expression -> expression CMP_OP expression .)
-    IF              reduce using rule 108 (boolean_expression -> expression CMP_OP expression .)
-    (               reduce using rule 108 (boolean_expression -> expression CMP_OP expression .)
-    TYPEDEF         reduce using rule 108 (boolean_expression -> expression CMP_OP expression .)
-    ID              reduce using rule 108 (boolean_expression -> expression CMP_OP expression .)
-    NOT             reduce using rule 108 (boolean_expression -> expression CMP_OP expression .)
-    INT             reduce using rule 108 (boolean_expression -> expression CMP_OP expression .)
-    FLOAT           reduce using rule 108 (boolean_expression -> expression CMP_OP expression .)
-    NULL            reduce using rule 108 (boolean_expression -> expression CMP_OP expression .)
-    REGEX           reduce using rule 108 (boolean_expression -> expression CMP_OP expression .)
-    TRUE            reduce using rule 108 (boolean_expression -> expression CMP_OP expression .)
-    FALSE           reduce using rule 108 (boolean_expression -> expression CMP_OP expression .)
-    STRING          reduce using rule 108 (boolean_expression -> expression CMP_OP expression .)
-    RSTRING         reduce using rule 108 (boolean_expression -> expression CMP_OP expression .)
-    MLS             reduce using rule 108 (boolean_expression -> expression CMP_OP expression .)
-    [               reduce using rule 108 (boolean_expression -> expression CMP_OP expression .)
-    {               reduce using rule 108 (boolean_expression -> expression CMP_OP expression .)
-    $end            reduce using rule 108 (boolean_expression -> expression CMP_OP expression .)
-    )               reduce using rule 108 (boolean_expression -> expression CMP_OP expression .)
-    :               reduce using rule 108 (boolean_expression -> expression CMP_OP expression .)
-    ,               reduce using rule 108 (boolean_expression -> expression CMP_OP expression .)
-    ]               reduce using rule 108 (boolean_expression -> expression CMP_OP expression .)
-    ELSE            reduce using rule 108 (boolean_expression -> expression CMP_OP expression .)
-    ELIF            reduce using rule 108 (boolean_expression -> expression CMP_OP expression .)
-    END             reduce using rule 108 (boolean_expression -> expression CMP_OP expression .)
-    }               reduce using rule 108 (boolean_expression -> expression CMP_OP expression .)
-    IN              shift and go to state 71
-
-  ! IN              [ reduce using rule 108 (boolean_expression -> expression CMP_OP expression .) ]
-  ! CMP_OP          [ shift and go to state 70 ]
-  ! AND             [ shift and go to state 72 ]
-  ! OR              [ shift and go to state 73 ]
-  ! ?               [ shift and go to state 74 ]
+    (155) wrapped_kwargs -> * . * operand
+
+    *               shift and go to state 203
 
 
 state 130
 
-    (109) boolean_expression -> expression IN expression .
-    (108) boolean_expression -> expression . CMP_OP expression
-    (109) boolean_expression -> expression . IN expression
-    (110) boolean_expression -> expression . AND expression
-    (111) boolean_expression -> expression . OR expression
-    (133) conditional_expression -> expression . ? expression : expression
-
-    CMP_OP          reduce using rule 109 (boolean_expression -> expression IN expression .)
-    IN              reduce using rule 109 (boolean_expression -> expression IN expression .)
-    AND             reduce using rule 109 (boolean_expression -> expression IN expression .)
-    OR              reduce using rule 109 (boolean_expression -> expression IN expression .)
-    ?               reduce using rule 109 (boolean_expression -> expression IN expression .)
-    ENTITY          reduce using rule 109 (boolean_expression -> expression IN expression .)
-    IMPLEMENT       reduce using rule 109 (boolean_expression -> expression IN expression .)
-    IMPLEMENTATION  reduce using rule 109 (boolean_expression -> expression IN expression .)
-    INDEX           reduce using rule 109 (boolean_expression -> expression IN expression .)
-    IMPORT          reduce using rule 109 (boolean_expression -> expression IN expression .)
-    CID             reduce using rule 109 (boolean_expression -> expression IN expression .)
-    FOR             reduce using rule 109 (boolean_expression -> expression IN expression .)
-    IF              reduce using rule 109 (boolean_expression -> expression IN expression .)
-    (               reduce using rule 109 (boolean_expression -> expression IN expression .)
-    TYPEDEF         reduce using rule 109 (boolean_expression -> expression IN expression .)
-    ID              reduce using rule 109 (boolean_expression -> expression IN expression .)
-    NOT             reduce using rule 109 (boolean_expression -> expression IN expression .)
-    INT             reduce using rule 109 (boolean_expression -> expression IN expression .)
-    FLOAT           reduce using rule 109 (boolean_expression -> expression IN expression .)
-    NULL            reduce using rule 109 (boolean_expression -> expression IN expression .)
-    REGEX           reduce using rule 109 (boolean_expression -> expression IN expression .)
-    TRUE            reduce using rule 109 (boolean_expression -> expression IN expression .)
-    FALSE           reduce using rule 109 (boolean_expression -> expression IN expression .)
-    STRING          reduce using rule 109 (boolean_expression -> expression IN expression .)
-    RSTRING         reduce using rule 109 (boolean_expression -> expression IN expression .)
-    MLS             reduce using rule 109 (boolean_expression -> expression IN expression .)
-    [               reduce using rule 109 (boolean_expression -> expression IN expression .)
-    {               reduce using rule 109 (boolean_expression -> expression IN expression .)
-    $end            reduce using rule 109 (boolean_expression -> expression IN expression .)
-    )               reduce using rule 109 (boolean_expression -> expression IN expression .)
-    :               reduce using rule 109 (boolean_expression -> expression IN expression .)
-    ,               reduce using rule 109 (boolean_expression -> expression IN expression .)
-    ]               reduce using rule 109 (boolean_expression -> expression IN expression .)
-    ELSE            reduce using rule 109 (boolean_expression -> expression IN expression .)
-    ELIF            reduce using rule 109 (boolean_expression -> expression IN expression .)
-    END             reduce using rule 109 (boolean_expression -> expression IN expression .)
-    }               reduce using rule 109 (boolean_expression -> expression IN expression .)
-
-  ! CMP_OP          [ shift and go to state 70 ]
-  ! IN              [ shift and go to state 71 ]
-  ! AND             [ shift and go to state 72 ]
-  ! OR              [ shift and go to state 73 ]
-  ! ?               [ shift and go to state 74 ]
+    (138) index_lookup -> class_ref [ param_list . ]
+
+    ]               shift and go to state 204
 
 
 state 131
 
-    (110) boolean_expression -> expression AND expression .
-    (108) boolean_expression -> expression . CMP_OP expression
-    (109) boolean_expression -> expression . IN expression
-    (110) boolean_expression -> expression . AND expression
-    (111) boolean_expression -> expression . OR expression
-    (133) conditional_expression -> expression . ? expression : expression
-
-    AND             reduce using rule 110 (boolean_expression -> expression AND expression .)
-    OR              reduce using rule 110 (boolean_expression -> expression AND expression .)
-    ?               reduce using rule 110 (boolean_expression -> expression AND expression .)
-    ENTITY          reduce using rule 110 (boolean_expression -> expression AND expression .)
-    IMPLEMENT       reduce using rule 110 (boolean_expression -> expression AND expression .)
-    IMPLEMENTATION  reduce using rule 110 (boolean_expression -> expression AND expression .)
-    INDEX           reduce using rule 110 (boolean_expression -> expression AND expression .)
-    IMPORT          reduce using rule 110 (boolean_expression -> expression AND expression .)
-    CID             reduce using rule 110 (boolean_expression -> expression AND expression .)
-    FOR             reduce using rule 110 (boolean_expression -> expression AND expression .)
-    IF              reduce using rule 110 (boolean_expression -> expression AND expression .)
-    (               reduce using rule 110 (boolean_expression -> expression AND expression .)
-    TYPEDEF         reduce using rule 110 (boolean_expression -> expression AND expression .)
-    ID              reduce using rule 110 (boolean_expression -> expression AND expression .)
-    NOT             reduce using rule 110 (boolean_expression -> expression AND expression .)
-    INT             reduce using rule 110 (boolean_expression -> expression AND expression .)
-    FLOAT           reduce using rule 110 (boolean_expression -> expression AND expression .)
-    NULL            reduce using rule 110 (boolean_expression -> expression AND expression .)
-    REGEX           reduce using rule 110 (boolean_expression -> expression AND expression .)
-    TRUE            reduce using rule 110 (boolean_expression -> expression AND expression .)
-    FALSE           reduce using rule 110 (boolean_expression -> expression AND expression .)
-    STRING          reduce using rule 110 (boolean_expression -> expression AND expression .)
-    RSTRING         reduce using rule 110 (boolean_expression -> expression AND expression .)
-    MLS             reduce using rule 110 (boolean_expression -> expression AND expression .)
-    [               reduce using rule 110 (boolean_expression -> expression AND expression .)
-    {               reduce using rule 110 (boolean_expression -> expression AND expression .)
-    $end            reduce using rule 110 (boolean_expression -> expression AND expression .)
-    )               reduce using rule 110 (boolean_expression -> expression AND expression .)
-    :               reduce using rule 110 (boolean_expression -> expression AND expression .)
-    ,               reduce using rule 110 (boolean_expression -> expression AND expression .)
-    ]               reduce using rule 110 (boolean_expression -> expression AND expression .)
-    ELSE            reduce using rule 110 (boolean_expression -> expression AND expression .)
-    ELIF            reduce using rule 110 (boolean_expression -> expression AND expression .)
-    END             reduce using rule 110 (boolean_expression -> expression AND expression .)
-    }               reduce using rule 110 (boolean_expression -> expression AND expression .)
-    CMP_OP          shift and go to state 70
-    IN              shift and go to state 71
-
-  ! CMP_OP          [ reduce using rule 110 (boolean_expression -> expression AND expression .) ]
-  ! IN              [ reduce using rule 110 (boolean_expression -> expression AND expression .) ]
-  ! AND             [ shift and go to state 72 ]
-  ! OR              [ shift and go to state 73 ]
-  ! ?               [ shift and go to state 74 ]
+    (109) boolean_expression -> expression CMP_OP expression .
+    (109) boolean_expression -> expression . CMP_OP expression
+    (110) boolean_expression -> expression . IN expression
+    (111) boolean_expression -> expression . AND expression
+    (112) boolean_expression -> expression . OR expression
+    (140) conditional_expression -> expression . ? expression : expression
+
+    CMP_OP          reduce using rule 109 (boolean_expression -> expression CMP_OP expression .)
+    AND             reduce using rule 109 (boolean_expression -> expression CMP_OP expression .)
+    OR              reduce using rule 109 (boolean_expression -> expression CMP_OP expression .)
+    ?               reduce using rule 109 (boolean_expression -> expression CMP_OP expression .)
+    ENTITY          reduce using rule 109 (boolean_expression -> expression CMP_OP expression .)
+    IMPLEMENT       reduce using rule 109 (boolean_expression -> expression CMP_OP expression .)
+    IMPLEMENTATION  reduce using rule 109 (boolean_expression -> expression CMP_OP expression .)
+    INDEX           reduce using rule 109 (boolean_expression -> expression CMP_OP expression .)
+    IMPORT          reduce using rule 109 (boolean_expression -> expression CMP_OP expression .)
+    CID             reduce using rule 109 (boolean_expression -> expression CMP_OP expression .)
+    FOR             reduce using rule 109 (boolean_expression -> expression CMP_OP expression .)
+    IF              reduce using rule 109 (boolean_expression -> expression CMP_OP expression .)
+    (               reduce using rule 109 (boolean_expression -> expression CMP_OP expression .)
+    TYPEDEF         reduce using rule 109 (boolean_expression -> expression CMP_OP expression .)
+    ID              reduce using rule 109 (boolean_expression -> expression CMP_OP expression .)
+    NOT             reduce using rule 109 (boolean_expression -> expression CMP_OP expression .)
+    INT             reduce using rule 109 (boolean_expression -> expression CMP_OP expression .)
+    FLOAT           reduce using rule 109 (boolean_expression -> expression CMP_OP expression .)
+    NULL            reduce using rule 109 (boolean_expression -> expression CMP_OP expression .)
+    REGEX           reduce using rule 109 (boolean_expression -> expression CMP_OP expression .)
+    TRUE            reduce using rule 109 (boolean_expression -> expression CMP_OP expression .)
+    FALSE           reduce using rule 109 (boolean_expression -> expression CMP_OP expression .)
+    STRING          reduce using rule 109 (boolean_expression -> expression CMP_OP expression .)
+    FSTRING         reduce using rule 109 (boolean_expression -> expression CMP_OP expression .)
+    RSTRING         reduce using rule 109 (boolean_expression -> expression CMP_OP expression .)
+    MLS             reduce using rule 109 (boolean_expression -> expression CMP_OP expression .)
+    [               reduce using rule 109 (boolean_expression -> expression CMP_OP expression .)
+    {               reduce using rule 109 (boolean_expression -> expression CMP_OP expression .)
+    $end            reduce using rule 109 (boolean_expression -> expression CMP_OP expression .)
+    )               reduce using rule 109 (boolean_expression -> expression CMP_OP expression .)
+    :               reduce using rule 109 (boolean_expression -> expression CMP_OP expression .)
+    ,               reduce using rule 109 (boolean_expression -> expression CMP_OP expression .)
+    ]               reduce using rule 109 (boolean_expression -> expression CMP_OP expression .)
+    ELSE            reduce using rule 109 (boolean_expression -> expression CMP_OP expression .)
+    ELIF            reduce using rule 109 (boolean_expression -> expression CMP_OP expression .)
+    END             reduce using rule 109 (boolean_expression -> expression CMP_OP expression .)
+    }               reduce using rule 109 (boolean_expression -> expression CMP_OP expression .)
+    IN              shift and go to state 73
+
+  ! IN              [ reduce using rule 109 (boolean_expression -> expression CMP_OP expression .) ]
+  ! CMP_OP          [ shift and go to state 72 ]
+  ! AND             [ shift and go to state 74 ]
+  ! OR              [ shift and go to state 75 ]
+  ! ?               [ shift and go to state 76 ]
 
 
 state 132
 
-    (111) boolean_expression -> expression OR expression .
-    (108) boolean_expression -> expression . CMP_OP expression
-    (109) boolean_expression -> expression . IN expression
-    (110) boolean_expression -> expression . AND expression
-    (111) boolean_expression -> expression . OR expression
-    (133) conditional_expression -> expression . ? expression : expression
-
-    OR              reduce using rule 111 (boolean_expression -> expression OR expression .)
-    ?               reduce using rule 111 (boolean_expression -> expression OR expression .)
-    ENTITY          reduce using rule 111 (boolean_expression -> expression OR expression .)
-    IMPLEMENT       reduce using rule 111 (boolean_expression -> expression OR expression .)
-    IMPLEMENTATION  reduce using rule 111 (boolean_expression -> expression OR expression .)
-    INDEX           reduce using rule 111 (boolean_expression -> expression OR expression .)
-    IMPORT          reduce using rule 111 (boolean_expression -> expression OR expression .)
-    CID             reduce using rule 111 (boolean_expression -> expression OR expression .)
-    FOR             reduce using rule 111 (boolean_expression -> expression OR expression .)
-    IF              reduce using rule 111 (boolean_expression -> expression OR expression .)
-    (               reduce using rule 111 (boolean_expression -> expression OR expression .)
-    TYPEDEF         reduce using rule 111 (boolean_expression -> expression OR expression .)
-    ID              reduce using rule 111 (boolean_expression -> expression OR expression .)
-    NOT             reduce using rule 111 (boolean_expression -> expression OR expression .)
-    INT             reduce using rule 111 (boolean_expression -> expression OR expression .)
-    FLOAT           reduce using rule 111 (boolean_expression -> expression OR expression .)
-    NULL            reduce using rule 111 (boolean_expression -> expression OR expression .)
-    REGEX           reduce using rule 111 (boolean_expression -> expression OR expression .)
-    TRUE            reduce using rule 111 (boolean_expression -> expression OR expression .)
-    FALSE           reduce using rule 111 (boolean_expression -> expression OR expression .)
-    STRING          reduce using rule 111 (boolean_expression -> expression OR expression .)
-    RSTRING         reduce using rule 111 (boolean_expression -> expression OR expression .)
-    MLS             reduce using rule 111 (boolean_expression -> expression OR expression .)
-    [               reduce using rule 111 (boolean_expression -> expression OR expression .)
-    {               reduce using rule 111 (boolean_expression -> expression OR expression .)
-    $end            reduce using rule 111 (boolean_expression -> expression OR expression .)
-    )               reduce using rule 111 (boolean_expression -> expression OR expression .)
-    :               reduce using rule 111 (boolean_expression -> expression OR expression .)
-    ,               reduce using rule 111 (boolean_expression -> expression OR expression .)
-    ]               reduce using rule 111 (boolean_expression -> expression OR expression .)
-    ELSE            reduce using rule 111 (boolean_expression -> expression OR expression .)
-    ELIF            reduce using rule 111 (boolean_expression -> expression OR expression .)
-    END             reduce using rule 111 (boolean_expression -> expression OR expression .)
-    }               reduce using rule 111 (boolean_expression -> expression OR expression .)
-    CMP_OP          shift and go to state 70
-    IN              shift and go to state 71
-    AND             shift and go to state 72
-
-  ! CMP_OP          [ reduce using rule 111 (boolean_expression -> expression OR expression .) ]
-  ! IN              [ reduce using rule 111 (boolean_expression -> expression OR expression .) ]
-  ! AND             [ reduce using rule 111 (boolean_expression -> expression OR expression .) ]
-  ! OR              [ shift and go to state 73 ]
-  ! ?               [ shift and go to state 74 ]
+    (110) boolean_expression -> expression IN expression .
+    (109) boolean_expression -> expression . CMP_OP expression
+    (110) boolean_expression -> expression . IN expression
+    (111) boolean_expression -> expression . AND expression
+    (112) boolean_expression -> expression . OR expression
+    (140) conditional_expression -> expression . ? expression : expression
+
+    CMP_OP          reduce using rule 110 (boolean_expression -> expression IN expression .)
+    IN              reduce using rule 110 (boolean_expression -> expression IN expression .)
+    AND             reduce using rule 110 (boolean_expression -> expression IN expression .)
+    OR              reduce using rule 110 (boolean_expression -> expression IN expression .)
+    ?               reduce using rule 110 (boolean_expression -> expression IN expression .)
+    ENTITY          reduce using rule 110 (boolean_expression -> expression IN expression .)
+    IMPLEMENT       reduce using rule 110 (boolean_expression -> expression IN expression .)
+    IMPLEMENTATION  reduce using rule 110 (boolean_expression -> expression IN expression .)
+    INDEX           reduce using rule 110 (boolean_expression -> expression IN expression .)
+    IMPORT          reduce using rule 110 (boolean_expression -> expression IN expression .)
+    CID             reduce using rule 110 (boolean_expression -> expression IN expression .)
+    FOR             reduce using rule 110 (boolean_expression -> expression IN expression .)
+    IF              reduce using rule 110 (boolean_expression -> expression IN expression .)
+    (               reduce using rule 110 (boolean_expression -> expression IN expression .)
+    TYPEDEF         reduce using rule 110 (boolean_expression -> expression IN expression .)
+    ID              reduce using rule 110 (boolean_expression -> expression IN expression .)
+    NOT             reduce using rule 110 (boolean_expression -> expression IN expression .)
+    INT             reduce using rule 110 (boolean_expression -> expression IN expression .)
+    FLOAT           reduce using rule 110 (boolean_expression -> expression IN expression .)
+    NULL            reduce using rule 110 (boolean_expression -> expression IN expression .)
+    REGEX           reduce using rule 110 (boolean_expression -> expression IN expression .)
+    TRUE            reduce using rule 110 (boolean_expression -> expression IN expression .)
+    FALSE           reduce using rule 110 (boolean_expression -> expression IN expression .)
+    STRING          reduce using rule 110 (boolean_expression -> expression IN expression .)
+    FSTRING         reduce using rule 110 (boolean_expression -> expression IN expression .)
+    RSTRING         reduce using rule 110 (boolean_expression -> expression IN expression .)
+    MLS             reduce using rule 110 (boolean_expression -> expression IN expression .)
+    [               reduce using rule 110 (boolean_expression -> expression IN expression .)
+    {               reduce using rule 110 (boolean_expression -> expression IN expression .)
+    $end            reduce using rule 110 (boolean_expression -> expression IN expression .)
+    )               reduce using rule 110 (boolean_expression -> expression IN expression .)
+    :               reduce using rule 110 (boolean_expression -> expression IN expression .)
+    ,               reduce using rule 110 (boolean_expression -> expression IN expression .)
+    ]               reduce using rule 110 (boolean_expression -> expression IN expression .)
+    ELSE            reduce using rule 110 (boolean_expression -> expression IN expression .)
+    ELIF            reduce using rule 110 (boolean_expression -> expression IN expression .)
+    END             reduce using rule 110 (boolean_expression -> expression IN expression .)
+    }               reduce using rule 110 (boolean_expression -> expression IN expression .)
+
+  ! CMP_OP          [ shift and go to state 72 ]
+  ! IN              [ shift and go to state 73 ]
+  ! AND             [ shift and go to state 74 ]
+  ! OR              [ shift and go to state 75 ]
+  ! ?               [ shift and go to state 76 ]
 
 
 state 133
 
-    (133) conditional_expression -> expression ? expression . : expression
-    (108) boolean_expression -> expression . CMP_OP expression
-    (109) boolean_expression -> expression . IN expression
-    (110) boolean_expression -> expression . AND expression
-    (111) boolean_expression -> expression . OR expression
-    (133) conditional_expression -> expression . ? expression : expression
-
-    :               shift and go to state 200
-    CMP_OP          shift and go to state 70
-    IN              shift and go to state 71
-    AND             shift and go to state 72
-    OR              shift and go to state 73
-    ?               shift and go to state 74
+    (111) boolean_expression -> expression AND expression .
+    (109) boolean_expression -> expression . CMP_OP expression
+    (110) boolean_expression -> expression . IN expression
+    (111) boolean_expression -> expression . AND expression
+    (112) boolean_expression -> expression . OR expression
+    (140) conditional_expression -> expression . ? expression : expression
+
+    AND             reduce using rule 111 (boolean_expression -> expression AND expression .)
+    OR              reduce using rule 111 (boolean_expression -> expression AND expression .)
+    ?               reduce using rule 111 (boolean_expression -> expression AND expression .)
+    ENTITY          reduce using rule 111 (boolean_expression -> expression AND expression .)
+    IMPLEMENT       reduce using rule 111 (boolean_expression -> expression AND expression .)
+    IMPLEMENTATION  reduce using rule 111 (boolean_expression -> expression AND expression .)
+    INDEX           reduce using rule 111 (boolean_expression -> expression AND expression .)
+    IMPORT          reduce using rule 111 (boolean_expression -> expression AND expression .)
+    CID             reduce using rule 111 (boolean_expression -> expression AND expression .)
+    FOR             reduce using rule 111 (boolean_expression -> expression AND expression .)
+    IF              reduce using rule 111 (boolean_expression -> expression AND expression .)
+    (               reduce using rule 111 (boolean_expression -> expression AND expression .)
+    TYPEDEF         reduce using rule 111 (boolean_expression -> expression AND expression .)
+    ID              reduce using rule 111 (boolean_expression -> expression AND expression .)
+    NOT             reduce using rule 111 (boolean_expression -> expression AND expression .)
+    INT             reduce using rule 111 (boolean_expression -> expression AND expression .)
+    FLOAT           reduce using rule 111 (boolean_expression -> expression AND expression .)
+    NULL            reduce using rule 111 (boolean_expression -> expression AND expression .)
+    REGEX           reduce using rule 111 (boolean_expression -> expression AND expression .)
+    TRUE            reduce using rule 111 (boolean_expression -> expression AND expression .)
+    FALSE           reduce using rule 111 (boolean_expression -> expression AND expression .)
+    STRING          reduce using rule 111 (boolean_expression -> expression AND expression .)
+    FSTRING         reduce using rule 111 (boolean_expression -> expression AND expression .)
+    RSTRING         reduce using rule 111 (boolean_expression -> expression AND expression .)
+    MLS             reduce using rule 111 (boolean_expression -> expression AND expression .)
+    [               reduce using rule 111 (boolean_expression -> expression AND expression .)
+    {               reduce using rule 111 (boolean_expression -> expression AND expression .)
+    $end            reduce using rule 111 (boolean_expression -> expression AND expression .)
+    )               reduce using rule 111 (boolean_expression -> expression AND expression .)
+    :               reduce using rule 111 (boolean_expression -> expression AND expression .)
+    ,               reduce using rule 111 (boolean_expression -> expression AND expression .)
+    ]               reduce using rule 111 (boolean_expression -> expression AND expression .)
+    ELSE            reduce using rule 111 (boolean_expression -> expression AND expression .)
+    ELIF            reduce using rule 111 (boolean_expression -> expression AND expression .)
+    END             reduce using rule 111 (boolean_expression -> expression AND expression .)
+    }               reduce using rule 111 (boolean_expression -> expression AND expression .)
+    CMP_OP          shift and go to state 72
+    IN              shift and go to state 73
+
+  ! CMP_OP          [ reduce using rule 111 (boolean_expression -> expression AND expression .) ]
+  ! IN              [ reduce using rule 111 (boolean_expression -> expression AND expression .) ]
+  ! AND             [ shift and go to state 74 ]
+  ! OR              [ shift and go to state 75 ]
+  ! ?               [ shift and go to state 76 ]
 
 
 state 134
 
-    (75) implementation_def -> IMPLEMENTATION ID FOR . class_ref implementation
-    (166) class_ref -> . CID
-    (167) class_ref -> . ns_ref SEP CID
-    (168) class_ref -> . var_ref . CID
-    (173) ns_ref -> . ns_ref SEP ID
-    (174) ns_ref -> . ID
-    (163) var_ref -> . attr_ref
-    (165) var_ref -> . ns_ref
-    (164) attr_ref -> . var_ref . ID
-
-    CID             shift and go to state 16
-    ID              shift and go to state 64
-
-    class_ref                      shift and go to state 201
-    ns_ref                         shift and go to state 62
-    var_ref                        shift and go to state 63
-    attr_ref                       shift and go to state 65
+    (112) boolean_expression -> expression OR expression .
+    (109) boolean_expression -> expression . CMP_OP expression
+    (110) boolean_expression -> expression . IN expression
+    (111) boolean_expression -> expression . AND expression
+    (112) boolean_expression -> expression . OR expression
+    (140) conditional_expression -> expression . ? expression : expression
+
+    OR              reduce using rule 112 (boolean_expression -> expression OR expression .)
+    ?               reduce using rule 112 (boolean_expression -> expression OR expression .)
+    ENTITY          reduce using rule 112 (boolean_expression -> expression OR expression .)
+    IMPLEMENT       reduce using rule 112 (boolean_expression -> expression OR expression .)
+    IMPLEMENTATION  reduce using rule 112 (boolean_expression -> expression OR expression .)
+    INDEX           reduce using rule 112 (boolean_expression -> expression OR expression .)
+    IMPORT          reduce using rule 112 (boolean_expression -> expression OR expression .)
+    CID             reduce using rule 112 (boolean_expression -> expression OR expression .)
+    FOR             reduce using rule 112 (boolean_expression -> expression OR expression .)
+    IF              reduce using rule 112 (boolean_expression -> expression OR expression .)
+    (               reduce using rule 112 (boolean_expression -> expression OR expression .)
+    TYPEDEF         reduce using rule 112 (boolean_expression -> expression OR expression .)
+    ID              reduce using rule 112 (boolean_expression -> expression OR expression .)
+    NOT             reduce using rule 112 (boolean_expression -> expression OR expression .)
+    INT             reduce using rule 112 (boolean_expression -> expression OR expression .)
+    FLOAT           reduce using rule 112 (boolean_expression -> expression OR expression .)
+    NULL            reduce using rule 112 (boolean_expression -> expression OR expression .)
+    REGEX           reduce using rule 112 (boolean_expression -> expression OR expression .)
+    TRUE            reduce using rule 112 (boolean_expression -> expression OR expression .)
+    FALSE           reduce using rule 112 (boolean_expression -> expression OR expression .)
+    STRING          reduce using rule 112 (boolean_expression -> expression OR expression .)
+    FSTRING         reduce using rule 112 (boolean_expression -> expression OR expression .)
+    RSTRING         reduce using rule 112 (boolean_expression -> expression OR expression .)
+    MLS             reduce using rule 112 (boolean_expression -> expression OR expression .)
+    [               reduce using rule 112 (boolean_expression -> expression OR expression .)
+    {               reduce using rule 112 (boolean_expression -> expression OR expression .)
+    $end            reduce using rule 112 (boolean_expression -> expression OR expression .)
+    )               reduce using rule 112 (boolean_expression -> expression OR expression .)
+    :               reduce using rule 112 (boolean_expression -> expression OR expression .)
+    ,               reduce using rule 112 (boolean_expression -> expression OR expression .)
+    ]               reduce using rule 112 (boolean_expression -> expression OR expression .)
+    ELSE            reduce using rule 112 (boolean_expression -> expression OR expression .)
+    ELIF            reduce using rule 112 (boolean_expression -> expression OR expression .)
+    END             reduce using rule 112 (boolean_expression -> expression OR expression .)
+    }               reduce using rule 112 (boolean_expression -> expression OR expression .)
+    CMP_OP          shift and go to state 72
+    IN              shift and go to state 73
+    AND             shift and go to state 74
+
+  ! CMP_OP          [ reduce using rule 112 (boolean_expression -> expression OR expression .) ]
+  ! IN              [ reduce using rule 112 (boolean_expression -> expression OR expression .) ]
+  ! AND             [ reduce using rule 112 (boolean_expression -> expression OR expression .) ]
+  ! OR              [ shift and go to state 75 ]
+  ! ?               [ shift and go to state 76 ]
+
 
 state 135
 
+    (140) conditional_expression -> expression ? expression . : expression
+    (109) boolean_expression -> expression . CMP_OP expression
+    (110) boolean_expression -> expression . IN expression
+    (111) boolean_expression -> expression . AND expression
+    (112) boolean_expression -> expression . OR expression
+    (140) conditional_expression -> expression . ? expression : expression
+
+    :               shift and go to state 205
+    CMP_OP          shift and go to state 72
+    IN              shift and go to state 73
+    AND             shift and go to state 74
+    OR              shift and go to state 75
+    ?               shift and go to state 76
+
+
+state 136
+
+    (75) implementation_def -> IMPLEMENTATION ID FOR . class_ref implementation
+    (174) class_ref -> . CID
+    (175) class_ref -> . ns_ref SEP CID
+    (176) class_ref -> . var_ref . CID
+    (181) ns_ref -> . ns_ref SEP ID
+    (182) ns_ref -> . ID
+    (171) var_ref -> . attr_ref
+    (173) var_ref -> . ns_ref
+    (172) attr_ref -> . var_ref . ID
+
+    CID             shift and go to state 16
+    ID              shift and go to state 66
+
+    class_ref                      shift and go to state 206
+    ns_ref                         shift and go to state 64
+    var_ref                        shift and go to state 65
+    attr_ref                       shift and go to state 67
+
+state 137
+
     (25) for -> FOR ID IN . operand : block
-    (116) operand -> . expression
+    (117) operand -> . expression
     (97) expression -> . boolean_expression
     (98) expression -> . constant
     (99) expression -> . function_call
     (100) expression -> . var_ref
     (101) expression -> . constructor
     (102) expression -> . list_def
-    (103) expression -> . map_def
-    (104) expression -> . map_lookup
-    (105) expression -> . index_lookup
-    (106) expression -> . conditional_expression
-    (107) expression -> . ( expression )
-    (108) boolean_expression -> . expression CMP_OP expression
-    (109) boolean_expression -> . expression IN expression
-    (110) boolean_expression -> . expression AND expression
-    (111) boolean_expression -> . expression OR expression
-    (112) boolean_expression -> . NOT expression
-    (113) boolean_expression -> . var_ref . ID IS DEFINED
-    (114) boolean_expression -> . ID IS DEFINED
-    (115) boolean_expression -> . map_lookup IS DEFINED
-    (134) constant -> . INT
-    (135) constant -> . FLOAT
-    (136) constant -> . NULL
-    (137) constant -> . REGEX
-    (138) constant -> . TRUE
-    (139) constant -> . FALSE
-    (140) constant -> . STRING
-    (141) constant -> . RSTRING
-    (142) constant -> . MLS
-    (121) function_call -> . ns_ref ( function_param_list )
-    (122) function_call -> . attr_ref ( function_param_list )
-    (163) var_ref -> . attr_ref
-    (165) var_ref -> . ns_ref
-    (120) constructor -> . class_ref ( param_list )
-    (123) list_def -> . [ operand_list ]
-    (130) map_def -> . { pair_list }
-    (117) map_lookup -> . attr_ref [ operand ]
-    (118) map_lookup -> . var_ref [ operand ]
-    (119) map_lookup -> . map_lookup [ operand ]
-    (131) index_lookup -> . class_ref [ param_list ]
-    (132) index_lookup -> . attr_ref [ param_list ]
-    (133) conditional_expression -> . expression ? expression : expression
-    (173) ns_ref -> . ns_ref SEP ID
-    (174) ns_ref -> . ID
-    (164) attr_ref -> . var_ref . ID
-    (166) class_ref -> . CID
-    (167) class_ref -> . ns_ref SEP CID
-    (168) class_ref -> . var_ref . CID
+    (103) expression -> . list_comprehension
+    (104) expression -> . map_def
+    (105) expression -> . map_lookup
+    (106) expression -> . index_lookup
+    (107) expression -> . conditional_expression
+    (108) expression -> . ( expression )
+    (109) boolean_expression -> . expression CMP_OP expression
+    (110) boolean_expression -> . expression IN expression
+    (111) boolean_expression -> . expression AND expression
+    (112) boolean_expression -> . expression OR expression
+    (113) boolean_expression -> . NOT expression
+    (114) boolean_expression -> . var_ref . ID IS DEFINED
+    (115) boolean_expression -> . ID IS DEFINED
+    (116) boolean_expression -> . map_lookup IS DEFINED
+    (141) constant -> . INT
+    (142) constant -> . FLOAT
+    (143) constant -> . NULL
+    (144) constant -> . REGEX
+    (145) constant -> . TRUE
+    (146) constant -> . FALSE
+    (147) constant -> . STRING
+    (148) constant -> . FSTRING
+    (149) constant -> . RSTRING
+    (150) constant -> . MLS
+    (122) function_call -> . ns_ref ( function_param_list )
+    (123) function_call -> . attr_ref ( function_param_list )
+    (171) var_ref -> . attr_ref
+    (173) var_ref -> . ns_ref
+    (121) constructor -> . class_ref ( param_list )
+    (124) list_def -> . [ operand_list ]
+    (125) list_comprehension -> . [ expression list_comprehension_for list_comprehension_guard ]
+    (137) map_def -> . { pair_list }
+    (118) map_lookup -> . attr_ref [ operand ]
+    (119) map_lookup -> . var_ref [ operand ]
+    (120) map_lookup -> . map_lookup [ operand ]
+    (138) index_lookup -> . class_ref [ param_list ]
+    (139) index_lookup -> . attr_ref [ param_list ]
+    (140) conditional_expression -> . expression ? expression : expression
+    (181) ns_ref -> . ns_ref SEP ID
+    (182) ns_ref -> . ID
+    (172) attr_ref -> . var_ref . ID
+    (174) class_ref -> . CID
+    (175) class_ref -> . ns_ref SEP CID
+    (176) class_ref -> . var_ref . CID
 
     (               shift and go to state 30
-    NOT             shift and go to state 46
-    ID              shift and go to state 82
-    INT             shift and go to state 47
-    FLOAT           shift and go to state 48
-    NULL            shift and go to state 49
-    REGEX           shift and go to state 50
-    TRUE            shift and go to state 51
-    FALSE           shift and go to state 52
-    STRING          shift and go to state 53
-    RSTRING         shift and go to state 54
+    NOT             shift and go to state 47
+    ID              shift and go to state 84
+    INT             shift and go to state 48
+    FLOAT           shift and go to state 49
+    NULL            shift and go to state 50
+    REGEX           shift and go to state 51
+    TRUE            shift and go to state 52
+    FALSE           shift and go to state 53
+    STRING          shift and go to state 54
+    FSTRING         shift and go to state 55
+    RSTRING         shift and go to state 56
     MLS             shift and go to state 20
-    [               shift and go to state 55
-    {               shift and go to state 56
+    [               shift and go to state 57
+    {               shift and go to state 58
     CID             shift and go to state 16
 
-    operand                        shift and go to state 202
-    expression                     shift and go to state 104
+    operand                        shift and go to state 207
+    expression                     shift and go to state 153
     boolean_expression             shift and go to state 35
     constant                       shift and go to state 36
     function_call                  shift and go to state 37
-    var_ref                        shift and go to state 81
+    var_ref                        shift and go to state 83
     constructor                    shift and go to state 38
     list_def                       shift and go to state 39
-    map_def                        shift and go to state 40
-    map_lookup                     shift and go to state 41
-    index_lookup                   shift and go to state 42
-    conditional_expression         shift and go to state 43
-    ns_ref                         shift and go to state 83
-    attr_ref                       shift and go to state 84
-    class_ref                      shift and go to state 85
-
-state 136
-
-    (96) index -> INDEX class_ref ( . id_list )
-    (175) id_list -> . ID , id_list
-    (176) id_list -> . ID
-
-    ID              shift and go to state 204
-
-    id_list                        shift and go to state 203
-
-state 137
-
-    (107) expression -> ( expression ) .
-
-    CMP_OP          reduce using rule 107 (expression -> ( expression ) .)
-    IN              reduce using rule 107 (expression -> ( expression ) .)
-    AND             reduce using rule 107 (expression -> ( expression ) .)
-    OR              reduce using rule 107 (expression -> ( expression ) .)
-    ?               reduce using rule 107 (expression -> ( expression ) .)
-    ENTITY          reduce using rule 107 (expression -> ( expression ) .)
-    IMPLEMENT       reduce using rule 107 (expression -> ( expression ) .)
-    IMPLEMENTATION  reduce using rule 107 (expression -> ( expression ) .)
-    INDEX           reduce using rule 107 (expression -> ( expression ) .)
-    IMPORT          reduce using rule 107 (expression -> ( expression ) .)
-    CID             reduce using rule 107 (expression -> ( expression ) .)
-    FOR             reduce using rule 107 (expression -> ( expression ) .)
-    IF              reduce using rule 107 (expression -> ( expression ) .)
-    (               reduce using rule 107 (expression -> ( expression ) .)
-    TYPEDEF         reduce using rule 107 (expression -> ( expression ) .)
-    ID              reduce using rule 107 (expression -> ( expression ) .)
-    NOT             reduce using rule 107 (expression -> ( expression ) .)
-    INT             reduce using rule 107 (expression -> ( expression ) .)
-    FLOAT           reduce using rule 107 (expression -> ( expression ) .)
-    NULL            reduce using rule 107 (expression -> ( expression ) .)
-    REGEX           reduce using rule 107 (expression -> ( expression ) .)
-    TRUE            reduce using rule 107 (expression -> ( expression ) .)
-    FALSE           reduce using rule 107 (expression -> ( expression ) .)
-    STRING          reduce using rule 107 (expression -> ( expression ) .)
-    RSTRING         reduce using rule 107 (expression -> ( expression ) .)
-    MLS             reduce using rule 107 (expression -> ( expression ) .)
-    [               reduce using rule 107 (expression -> ( expression ) .)
-    {               reduce using rule 107 (expression -> ( expression ) .)
-    $end            reduce using rule 107 (expression -> ( expression ) .)
-    )               reduce using rule 107 (expression -> ( expression ) .)
-    :               reduce using rule 107 (expression -> ( expression ) .)
-    ,               reduce using rule 107 (expression -> ( expression ) .)
-    ]               reduce using rule 107 (expression -> ( expression ) .)
-    ELSE            reduce using rule 107 (expression -> ( expression ) .)
-    ELIF            reduce using rule 107 (expression -> ( expression ) .)
-    END             reduce using rule 107 (expression -> ( expression ) .)
-    }               reduce using rule 107 (expression -> ( expression ) .)
-
+    list_comprehension             shift and go to state 40
+    map_def                        shift and go to state 41
+    map_lookup                     shift and go to state 42
+    index_lookup                   shift and go to state 43
+    conditional_expression         shift and go to state 44
+    ns_ref                         shift and go to state 85
+    attr_ref                       shift and go to state 86
+    class_ref                      shift and go to state 87
 
 state 138
 
-    (113) boolean_expression -> var_ref . . ID IS DEFINED
-    (164) attr_ref -> var_ref . . ID
-    (168) class_ref -> var_ref . . CID
+    (96) index -> INDEX class_ref ( . id_list )
+    (183) id_list -> . ID , id_list
+    (184) id_list -> . ID
 
-    ID              shift and go to state 152
-    CID             shift and go to state 151
+    ID              shift and go to state 209
 
+    id_list                        shift and go to state 208
 
 state 139
 
-    (173) ns_ref -> ns_ref SEP . ID
-    (167) class_ref -> ns_ref SEP . CID
+    (108) expression -> ( expression ) .
 
-    ID              shift and go to state 143
-    CID             shift and go to state 142
+    CMP_OP          reduce using rule 108 (expression -> ( expression ) .)
+    IN              reduce using rule 108 (expression -> ( expression ) .)
+    AND             reduce using rule 108 (expression -> ( expression ) .)
+    OR              reduce using rule 108 (expression -> ( expression ) .)
+    ?               reduce using rule 108 (expression -> ( expression ) .)
+    ENTITY          reduce using rule 108 (expression -> ( expression ) .)
+    IMPLEMENT       reduce using rule 108 (expression -> ( expression ) .)
+    IMPLEMENTATION  reduce using rule 108 (expression -> ( expression ) .)
+    INDEX           reduce using rule 108 (expression -> ( expression ) .)
+    IMPORT          reduce using rule 108 (expression -> ( expression ) .)
+    CID             reduce using rule 108 (expression -> ( expression ) .)
+    FOR             reduce using rule 108 (expression -> ( expression ) .)
+    IF              reduce using rule 108 (expression -> ( expression ) .)
+    (               reduce using rule 108 (expression -> ( expression ) .)
+    TYPEDEF         reduce using rule 108 (expression -> ( expression ) .)
+    ID              reduce using rule 108 (expression -> ( expression ) .)
+    NOT             reduce using rule 108 (expression -> ( expression ) .)
+    INT             reduce using rule 108 (expression -> ( expression ) .)
+    FLOAT           reduce using rule 108 (expression -> ( expression ) .)
+    NULL            reduce using rule 108 (expression -> ( expression ) .)
+    REGEX           reduce using rule 108 (expression -> ( expression ) .)
+    TRUE            reduce using rule 108 (expression -> ( expression ) .)
+    FALSE           reduce using rule 108 (expression -> ( expression ) .)
+    STRING          reduce using rule 108 (expression -> ( expression ) .)
+    FSTRING         reduce using rule 108 (expression -> ( expression ) .)
+    RSTRING         reduce using rule 108 (expression -> ( expression ) .)
+    MLS             reduce using rule 108 (expression -> ( expression ) .)
+    [               reduce using rule 108 (expression -> ( expression ) .)
+    {               reduce using rule 108 (expression -> ( expression ) .)
+    $end            reduce using rule 108 (expression -> ( expression ) .)
+    )               reduce using rule 108 (expression -> ( expression ) .)
+    :               reduce using rule 108 (expression -> ( expression ) .)
+    ,               reduce using rule 108 (expression -> ( expression ) .)
+    ]               reduce using rule 108 (expression -> ( expression ) .)
+    ELSE            reduce using rule 108 (expression -> ( expression ) .)
+    ELIF            reduce using rule 108 (expression -> ( expression ) .)
+    END             reduce using rule 108 (expression -> ( expression ) .)
+    }               reduce using rule 108 (expression -> ( expression ) .)
 
 
 state 140
 
-    (16) import -> IMPORT ns_ref AS . ID
+    (114) boolean_expression -> var_ref . . ID IS DEFINED
+    (172) attr_ref -> var_ref . . ID
+    (176) class_ref -> var_ref . . CID
 
-    ID              shift and go to state 205
+    ID              shift and go to state 155
+    CID             shift and go to state 154
 
 
 state 141
 
-    (173) ns_ref -> ns_ref SEP . ID
+    (181) ns_ref -> ns_ref SEP . ID
+    (175) class_ref -> ns_ref SEP . CID
 
-    ID              shift and go to state 143
+    ID              shift and go to state 145
+    CID             shift and go to state 144
 
 
 state 142
 
-    (167) class_ref -> ns_ref SEP CID .
+    (16) import -> IMPORT ns_ref AS . ID
 
-    ID              reduce using rule 167 (class_ref -> ns_ref SEP CID .)
-    .               reduce using rule 167 (class_ref -> ns_ref SEP CID .)
-    (               reduce using rule 167 (class_ref -> ns_ref SEP CID .)
-    [               reduce using rule 167 (class_ref -> ns_ref SEP CID .)
-    USING           reduce using rule 167 (class_ref -> ns_ref SEP CID .)
-    ,               reduce using rule 167 (class_ref -> ns_ref SEP CID .)
-    :               reduce using rule 167 (class_ref -> ns_ref SEP CID .)
-    MLS             reduce using rule 167 (class_ref -> ns_ref SEP CID .)
-    ENTITY          reduce using rule 167 (class_ref -> ns_ref SEP CID .)
-    IMPLEMENT       reduce using rule 167 (class_ref -> ns_ref SEP CID .)
-    IMPLEMENTATION  reduce using rule 167 (class_ref -> ns_ref SEP CID .)
-    INDEX           reduce using rule 167 (class_ref -> ns_ref SEP CID .)
-    IMPORT          reduce using rule 167 (class_ref -> ns_ref SEP CID .)
-    CID             reduce using rule 167 (class_ref -> ns_ref SEP CID .)
-    FOR             reduce using rule 167 (class_ref -> ns_ref SEP CID .)
-    IF              reduce using rule 167 (class_ref -> ns_ref SEP CID .)
-    TYPEDEF         reduce using rule 167 (class_ref -> ns_ref SEP CID .)
-    NOT             reduce using rule 167 (class_ref -> ns_ref SEP CID .)
-    INT             reduce using rule 167 (class_ref -> ns_ref SEP CID .)
-    FLOAT           reduce using rule 167 (class_ref -> ns_ref SEP CID .)
-    NULL            reduce using rule 167 (class_ref -> ns_ref SEP CID .)
-    REGEX           reduce using rule 167 (class_ref -> ns_ref SEP CID .)
-    TRUE            reduce using rule 167 (class_ref -> ns_ref SEP CID .)
-    FALSE           reduce using rule 167 (class_ref -> ns_ref SEP CID .)
-    STRING          reduce using rule 167 (class_ref -> ns_ref SEP CID .)
-    RSTRING         reduce using rule 167 (class_ref -> ns_ref SEP CID .)
-    {               reduce using rule 167 (class_ref -> ns_ref SEP CID .)
-    $end            reduce using rule 167 (class_ref -> ns_ref SEP CID .)
+    ID              shift and go to state 210
 
 
 state 143
 
-    (173) ns_ref -> ns_ref SEP ID .
+    (181) ns_ref -> ns_ref SEP . ID
 
-    SEP             reduce using rule 173 (ns_ref -> ns_ref SEP ID .)
-    (               reduce using rule 173 (ns_ref -> ns_ref SEP ID .)
-    .               reduce using rule 173 (ns_ref -> ns_ref SEP ID .)
-    =               reduce using rule 173 (ns_ref -> ns_ref SEP ID .)
-    PEQ             reduce using rule 173 (ns_ref -> ns_ref SEP ID .)
-    [               reduce using rule 173 (ns_ref -> ns_ref SEP ID .)
-    CMP_OP          reduce using rule 173 (ns_ref -> ns_ref SEP ID .)
-    IN              reduce using rule 173 (ns_ref -> ns_ref SEP ID .)
-    AND             reduce using rule 173 (ns_ref -> ns_ref SEP ID .)
-    OR              reduce using rule 173 (ns_ref -> ns_ref SEP ID .)
-    ?               reduce using rule 173 (ns_ref -> ns_ref SEP ID .)
-    ENTITY          reduce using rule 173 (ns_ref -> ns_ref SEP ID .)
-    IMPLEMENT       reduce using rule 173 (ns_ref -> ns_ref SEP ID .)
-    IMPLEMENTATION  reduce using rule 173 (ns_ref -> ns_ref SEP ID .)
-    INDEX           reduce using rule 173 (ns_ref -> ns_ref SEP ID .)
-    IMPORT          reduce using rule 173 (ns_ref -> ns_ref SEP ID .)
-    CID             reduce using rule 173 (ns_ref -> ns_ref SEP ID .)
-    FOR             reduce using rule 173 (ns_ref -> ns_ref SEP ID .)
-    IF              reduce using rule 173 (ns_ref -> ns_ref SEP ID .)
-    TYPEDEF         reduce using rule 173 (ns_ref -> ns_ref SEP ID .)
-    ID              reduce using rule 173 (ns_ref -> ns_ref SEP ID .)
-    NOT             reduce using rule 173 (ns_ref -> ns_ref SEP ID .)
-    INT             reduce using rule 173 (ns_ref -> ns_ref SEP ID .)
-    FLOAT           reduce using rule 173 (ns_ref -> ns_ref SEP ID .)
-    NULL            reduce using rule 173 (ns_ref -> ns_ref SEP ID .)
-    REGEX           reduce using rule 173 (ns_ref -> ns_ref SEP ID .)
-    TRUE            reduce using rule 173 (ns_ref -> ns_ref SEP ID .)
-    FALSE           reduce using rule 173 (ns_ref -> ns_ref SEP ID .)
-    STRING          reduce using rule 173 (ns_ref -> ns_ref SEP ID .)
-    RSTRING         reduce using rule 173 (ns_ref -> ns_ref SEP ID .)
-    MLS             reduce using rule 173 (ns_ref -> ns_ref SEP ID .)
-    {               reduce using rule 173 (ns_ref -> ns_ref SEP ID .)
-    $end            reduce using rule 173 (ns_ref -> ns_ref SEP ID .)
-    )               reduce using rule 173 (ns_ref -> ns_ref SEP ID .)
-    AS              reduce using rule 173 (ns_ref -> ns_ref SEP ID .)
-    :               reduce using rule 173 (ns_ref -> ns_ref SEP ID .)
-    ,               reduce using rule 173 (ns_ref -> ns_ref SEP ID .)
-    ]               reduce using rule 173 (ns_ref -> ns_ref SEP ID .)
-    ELSE            reduce using rule 173 (ns_ref -> ns_ref SEP ID .)
-    ELIF            reduce using rule 173 (ns_ref -> ns_ref SEP ID .)
-    END             reduce using rule 173 (ns_ref -> ns_ref SEP ID .)
-    }               reduce using rule 173 (ns_ref -> ns_ref SEP ID .)
-    WHEN            reduce using rule 173 (ns_ref -> ns_ref SEP ID .)
-    MATCHING        reduce using rule 173 (ns_ref -> ns_ref SEP ID .)
+    ID              shift and go to state 145
 
 
 state 144
 
-    (121) function_call -> ns_ref ( function_param_list . )
+    (175) class_ref -> ns_ref SEP CID .
 
-    )               shift and go to state 206
+    ID              reduce using rule 175 (class_ref -> ns_ref SEP CID .)
+    .               reduce using rule 175 (class_ref -> ns_ref SEP CID .)
+    (               reduce using rule 175 (class_ref -> ns_ref SEP CID .)
+    [               reduce using rule 175 (class_ref -> ns_ref SEP CID .)
+    USING           reduce using rule 175 (class_ref -> ns_ref SEP CID .)
+    ,               reduce using rule 175 (class_ref -> ns_ref SEP CID .)
+    :               reduce using rule 175 (class_ref -> ns_ref SEP CID .)
+    MLS             reduce using rule 175 (class_ref -> ns_ref SEP CID .)
+    ENTITY          reduce using rule 175 (class_ref -> ns_ref SEP CID .)
+    IMPLEMENT       reduce using rule 175 (class_ref -> ns_ref SEP CID .)
+    IMPLEMENTATION  reduce using rule 175 (class_ref -> ns_ref SEP CID .)
+    INDEX           reduce using rule 175 (class_ref -> ns_ref SEP CID .)
+    IMPORT          reduce using rule 175 (class_ref -> ns_ref SEP CID .)
+    CID             reduce using rule 175 (class_ref -> ns_ref SEP CID .)
+    FOR             reduce using rule 175 (class_ref -> ns_ref SEP CID .)
+    IF              reduce using rule 175 (class_ref -> ns_ref SEP CID .)
+    TYPEDEF         reduce using rule 175 (class_ref -> ns_ref SEP CID .)
+    NOT             reduce using rule 175 (class_ref -> ns_ref SEP CID .)
+    INT             reduce using rule 175 (class_ref -> ns_ref SEP CID .)
+    FLOAT           reduce using rule 175 (class_ref -> ns_ref SEP CID .)
+    NULL            reduce using rule 175 (class_ref -> ns_ref SEP CID .)
+    REGEX           reduce using rule 175 (class_ref -> ns_ref SEP CID .)
+    TRUE            reduce using rule 175 (class_ref -> ns_ref SEP CID .)
+    FALSE           reduce using rule 175 (class_ref -> ns_ref SEP CID .)
+    STRING          reduce using rule 175 (class_ref -> ns_ref SEP CID .)
+    FSTRING         reduce using rule 175 (class_ref -> ns_ref SEP CID .)
+    RSTRING         reduce using rule 175 (class_ref -> ns_ref SEP CID .)
+    {               reduce using rule 175 (class_ref -> ns_ref SEP CID .)
+    $end            reduce using rule 175 (class_ref -> ns_ref SEP CID .)
 
 
 state 145
 
-    (156) function_param_list -> function_param_list_empty .
+    (181) ns_ref -> ns_ref SEP ID .
 
-    )               reduce using rule 156 (function_param_list -> function_param_list_empty .)
+    SEP             reduce using rule 181 (ns_ref -> ns_ref SEP ID .)
+    (               reduce using rule 181 (ns_ref -> ns_ref SEP ID .)
+    .               reduce using rule 181 (ns_ref -> ns_ref SEP ID .)
+    =               reduce using rule 181 (ns_ref -> ns_ref SEP ID .)
+    PEQ             reduce using rule 181 (ns_ref -> ns_ref SEP ID .)
+    [               reduce using rule 181 (ns_ref -> ns_ref SEP ID .)
+    CMP_OP          reduce using rule 181 (ns_ref -> ns_ref SEP ID .)
+    IN              reduce using rule 181 (ns_ref -> ns_ref SEP ID .)
+    AND             reduce using rule 181 (ns_ref -> ns_ref SEP ID .)
+    OR              reduce using rule 181 (ns_ref -> ns_ref SEP ID .)
+    ?               reduce using rule 181 (ns_ref -> ns_ref SEP ID .)
+    ENTITY          reduce using rule 181 (ns_ref -> ns_ref SEP ID .)
+    IMPLEMENT       reduce using rule 181 (ns_ref -> ns_ref SEP ID .)
+    IMPLEMENTATION  reduce using rule 181 (ns_ref -> ns_ref SEP ID .)
+    INDEX           reduce using rule 181 (ns_ref -> ns_ref SEP ID .)
+    IMPORT          reduce using rule 181 (ns_ref -> ns_ref SEP ID .)
+    CID             reduce using rule 181 (ns_ref -> ns_ref SEP ID .)
+    FOR             reduce using rule 181 (ns_ref -> ns_ref SEP ID .)
+    IF              reduce using rule 181 (ns_ref -> ns_ref SEP ID .)
+    TYPEDEF         reduce using rule 181 (ns_ref -> ns_ref SEP ID .)
+    ID              reduce using rule 181 (ns_ref -> ns_ref SEP ID .)
+    NOT             reduce using rule 181 (ns_ref -> ns_ref SEP ID .)
+    INT             reduce using rule 181 (ns_ref -> ns_ref SEP ID .)
+    FLOAT           reduce using rule 181 (ns_ref -> ns_ref SEP ID .)
+    NULL            reduce using rule 181 (ns_ref -> ns_ref SEP ID .)
+    REGEX           reduce using rule 181 (ns_ref -> ns_ref SEP ID .)
+    TRUE            reduce using rule 181 (ns_ref -> ns_ref SEP ID .)
+    FALSE           reduce using rule 181 (ns_ref -> ns_ref SEP ID .)
+    STRING          reduce using rule 181 (ns_ref -> ns_ref SEP ID .)
+    FSTRING         reduce using rule 181 (ns_ref -> ns_ref SEP ID .)
+    RSTRING         reduce using rule 181 (ns_ref -> ns_ref SEP ID .)
+    MLS             reduce using rule 181 (ns_ref -> ns_ref SEP ID .)
+    {               reduce using rule 181 (ns_ref -> ns_ref SEP ID .)
+    $end            reduce using rule 181 (ns_ref -> ns_ref SEP ID .)
+    )               reduce using rule 181 (ns_ref -> ns_ref SEP ID .)
+    AS              reduce using rule 181 (ns_ref -> ns_ref SEP ID .)
+    :               reduce using rule 181 (ns_ref -> ns_ref SEP ID .)
+    ,               reduce using rule 181 (ns_ref -> ns_ref SEP ID .)
+    ]               reduce using rule 181 (ns_ref -> ns_ref SEP ID .)
+    ELSE            reduce using rule 181 (ns_ref -> ns_ref SEP ID .)
+    ELIF            reduce using rule 181 (ns_ref -> ns_ref SEP ID .)
+    END             reduce using rule 181 (ns_ref -> ns_ref SEP ID .)
+    }               reduce using rule 181 (ns_ref -> ns_ref SEP ID .)
+    WHEN            reduce using rule 181 (ns_ref -> ns_ref SEP ID .)
+    MATCHING        reduce using rule 181 (ns_ref -> ns_ref SEP ID .)
 
 
 state 146
 
-    (158) function_param_list -> function_param_list_element . empty function_param_list_empty
-    (159) function_param_list -> function_param_list_element . , function_param_list
-    (14) empty -> .
+    (122) function_call -> ns_ref ( function_param_list . )
 
-    ,               shift and go to state 208
-    )               reduce using rule 14 (empty -> .)
+    )               shift and go to state 211
 
-    empty                          shift and go to state 207
 
 state 147
 
-    (157) function_param_list_empty -> empty .
+    (164) function_param_list -> function_param_list_empty .
 
-    )               reduce using rule 157 (function_param_list_empty -> empty .)
+    )               reduce using rule 164 (function_param_list -> function_param_list_empty .)
 
 
 state 148
 
-    (154) function_param_list_element -> param_list_element .
+    (166) function_param_list -> function_param_list_element . empty function_param_list_empty
+    (167) function_param_list -> function_param_list_element . , function_param_list
+    (14) empty -> .
 
-    ,               reduce using rule 154 (function_param_list_element -> param_list_element .)
-    )               reduce using rule 154 (function_param_list_element -> param_list_element .)
+    ,               shift and go to state 213
+    )               reduce using rule 14 (empty -> .)
 
+    empty                          shift and go to state 212
 
 state 149
 
-    (155) function_param_list_element -> operand .
+    (165) function_param_list_empty -> empty .
 
-    ,               reduce using rule 155 (function_param_list_element -> operand .)
-    )               reduce using rule 155 (function_param_list_element -> operand .)
+    )               reduce using rule 165 (function_param_list_empty -> empty .)
 
 
 state 150
 
-    (148) param_list_element -> ID . = operand
-    (114) boolean_expression -> ID . IS DEFINED
-    (174) ns_ref -> ID .
-
-    =               shift and go to state 197
-    IS              shift and go to state 60
-    (               reduce using rule 174 (ns_ref -> ID .)
-    SEP             reduce using rule 174 (ns_ref -> ID .)
-    .               reduce using rule 174 (ns_ref -> ID .)
-    [               reduce using rule 174 (ns_ref -> ID .)
-    CMP_OP          reduce using rule 174 (ns_ref -> ID .)
-    IN              reduce using rule 174 (ns_ref -> ID .)
-    AND             reduce using rule 174 (ns_ref -> ID .)
-    OR              reduce using rule 174 (ns_ref -> ID .)
-    ?               reduce using rule 174 (ns_ref -> ID .)
-    ,               reduce using rule 174 (ns_ref -> ID .)
-    )               reduce using rule 174 (ns_ref -> ID .)
-    ]               reduce using rule 174 (ns_ref -> ID .)
+    (162) function_param_list_element -> param_list_element .
+
+    ,               reduce using rule 162 (function_param_list_element -> param_list_element .)
+    )               reduce using rule 162 (function_param_list_element -> param_list_element .)
 
 
 state 151
 
-    (168) class_ref -> var_ref . CID .
+    (163) function_param_list_element -> operand .
 
-    ID              reduce using rule 168 (class_ref -> var_ref . CID .)
-    .               reduce using rule 168 (class_ref -> var_ref . CID .)
-    (               reduce using rule 168 (class_ref -> var_ref . CID .)
-    [               reduce using rule 168 (class_ref -> var_ref . CID .)
-    USING           reduce using rule 168 (class_ref -> var_ref . CID .)
-    ,               reduce using rule 168 (class_ref -> var_ref . CID .)
-    :               reduce using rule 168 (class_ref -> var_ref . CID .)
-    MLS             reduce using rule 168 (class_ref -> var_ref . CID .)
-    ENTITY          reduce using rule 168 (class_ref -> var_ref . CID .)
-    IMPLEMENT       reduce using rule 168 (class_ref -> var_ref . CID .)
-    IMPLEMENTATION  reduce using rule 168 (class_ref -> var_ref . CID .)
-    INDEX           reduce using rule 168 (class_ref -> var_ref . CID .)
-    IMPORT          reduce using rule 168 (class_ref -> var_ref . CID .)
-    CID             reduce using rule 168 (class_ref -> var_ref . CID .)
-    FOR             reduce using rule 168 (class_ref -> var_ref . CID .)
-    IF              reduce using rule 168 (class_ref -> var_ref . CID .)
-    TYPEDEF         reduce using rule 168 (class_ref -> var_ref . CID .)
-    NOT             reduce using rule 168 (class_ref -> var_ref . CID .)
-    INT             reduce using rule 168 (class_ref -> var_ref . CID .)
-    FLOAT           reduce using rule 168 (class_ref -> var_ref . CID .)
-    NULL            reduce using rule 168 (class_ref -> var_ref . CID .)
-    REGEX           reduce using rule 168 (class_ref -> var_ref . CID .)
-    TRUE            reduce using rule 168 (class_ref -> var_ref . CID .)
-    FALSE           reduce using rule 168 (class_ref -> var_ref . CID .)
-    STRING          reduce using rule 168 (class_ref -> var_ref . CID .)
-    RSTRING         reduce using rule 168 (class_ref -> var_ref . CID .)
-    {               reduce using rule 168 (class_ref -> var_ref . CID .)
-    $end            reduce using rule 168 (class_ref -> var_ref . CID .)
+    ,               reduce using rule 163 (function_param_list_element -> operand .)
+    )               reduce using rule 163 (function_param_list_element -> operand .)
 
 
 state 152
 
-    (113) boolean_expression -> var_ref . ID . IS DEFINED
-    (164) attr_ref -> var_ref . ID .
-
-    IS              shift and go to state 209
-    (               reduce using rule 164 (attr_ref -> var_ref . ID .)
-    [               reduce using rule 164 (attr_ref -> var_ref . ID .)
-    .               reduce using rule 164 (attr_ref -> var_ref . ID .)
-    =               reduce using rule 164 (attr_ref -> var_ref . ID .)
-    PEQ             reduce using rule 164 (attr_ref -> var_ref . ID .)
-    CMP_OP          reduce using rule 164 (attr_ref -> var_ref . ID .)
-    IN              reduce using rule 164 (attr_ref -> var_ref . ID .)
-    AND             reduce using rule 164 (attr_ref -> var_ref . ID .)
-    OR              reduce using rule 164 (attr_ref -> var_ref . ID .)
-    ?               reduce using rule 164 (attr_ref -> var_ref . ID .)
-    ENTITY          reduce using rule 164 (attr_ref -> var_ref . ID .)
-    IMPLEMENT       reduce using rule 164 (attr_ref -> var_ref . ID .)
-    IMPLEMENTATION  reduce using rule 164 (attr_ref -> var_ref . ID .)
-    INDEX           reduce using rule 164 (attr_ref -> var_ref . ID .)
-    IMPORT          reduce using rule 164 (attr_ref -> var_ref . ID .)
-    CID             reduce using rule 164 (attr_ref -> var_ref . ID .)
-    FOR             reduce using rule 164 (attr_ref -> var_ref . ID .)
-    IF              reduce using rule 164 (attr_ref -> var_ref . ID .)
-    TYPEDEF         reduce using rule 164 (attr_ref -> var_ref . ID .)
-    ID              reduce using rule 164 (attr_ref -> var_ref . ID .)
-    NOT             reduce using rule 164 (attr_ref -> var_ref . ID .)
-    INT             reduce using rule 164 (attr_ref -> var_ref . ID .)
-    FLOAT           reduce using rule 164 (attr_ref -> var_ref . ID .)
-    NULL            reduce using rule 164 (attr_ref -> var_ref . ID .)
-    REGEX           reduce using rule 164 (attr_ref -> var_ref . ID .)
-    TRUE            reduce using rule 164 (attr_ref -> var_ref . ID .)
-    FALSE           reduce using rule 164 (attr_ref -> var_ref . ID .)
-    STRING          reduce using rule 164 (attr_ref -> var_ref . ID .)
-    RSTRING         reduce using rule 164 (attr_ref -> var_ref . ID .)
-    MLS             reduce using rule 164 (attr_ref -> var_ref . ID .)
-    {               reduce using rule 164 (attr_ref -> var_ref . ID .)
-    $end            reduce using rule 164 (attr_ref -> var_ref . ID .)
-    )               reduce using rule 164 (attr_ref -> var_ref . ID .)
-    :               reduce using rule 164 (attr_ref -> var_ref . ID .)
-    ,               reduce using rule 164 (attr_ref -> var_ref . ID .)
-    ]               reduce using rule 164 (attr_ref -> var_ref . ID .)
-    ELSE            reduce using rule 164 (attr_ref -> var_ref . ID .)
-    ELIF            reduce using rule 164 (attr_ref -> var_ref . ID .)
-    END             reduce using rule 164 (attr_ref -> var_ref . ID .)
-    }               reduce using rule 164 (attr_ref -> var_ref . ID .)
+    (156) param_list_element -> ID . = operand
+    (115) boolean_expression -> ID . IS DEFINED
+    (182) ns_ref -> ID .
+
+    =               shift and go to state 202
+    IS              shift and go to state 62
+    (               reduce using rule 182 (ns_ref -> ID .)
+    SEP             reduce using rule 182 (ns_ref -> ID .)
+    .               reduce using rule 182 (ns_ref -> ID .)
+    [               reduce using rule 182 (ns_ref -> ID .)
+    CMP_OP          reduce using rule 182 (ns_ref -> ID .)
+    IN              reduce using rule 182 (ns_ref -> ID .)
+    AND             reduce using rule 182 (ns_ref -> ID .)
+    OR              reduce using rule 182 (ns_ref -> ID .)
+    ?               reduce using rule 182 (ns_ref -> ID .)
+    ,               reduce using rule 182 (ns_ref -> ID .)
+    )               reduce using rule 182 (ns_ref -> ID .)
+    ]               reduce using rule 182 (ns_ref -> ID .)
 
 
 state 153
 
+    (117) operand -> expression .
+    (109) boolean_expression -> expression . CMP_OP expression
+    (110) boolean_expression -> expression . IN expression
+    (111) boolean_expression -> expression . AND expression
+    (112) boolean_expression -> expression . OR expression
+    (140) conditional_expression -> expression . ? expression : expression
+
+    ,               reduce using rule 117 (operand -> expression .)
+    )               reduce using rule 117 (operand -> expression .)
+    ENTITY          reduce using rule 117 (operand -> expression .)
+    IMPLEMENT       reduce using rule 117 (operand -> expression .)
+    IMPLEMENTATION  reduce using rule 117 (operand -> expression .)
+    INDEX           reduce using rule 117 (operand -> expression .)
+    IMPORT          reduce using rule 117 (operand -> expression .)
+    CID             reduce using rule 117 (operand -> expression .)
+    FOR             reduce using rule 117 (operand -> expression .)
+    IF              reduce using rule 117 (operand -> expression .)
+    (               reduce using rule 117 (operand -> expression .)
+    TYPEDEF         reduce using rule 117 (operand -> expression .)
+    ID              reduce using rule 117 (operand -> expression .)
+    NOT             reduce using rule 117 (operand -> expression .)
+    INT             reduce using rule 117 (operand -> expression .)
+    FLOAT           reduce using rule 117 (operand -> expression .)
+    NULL            reduce using rule 117 (operand -> expression .)
+    REGEX           reduce using rule 117 (operand -> expression .)
+    TRUE            reduce using rule 117 (operand -> expression .)
+    FALSE           reduce using rule 117 (operand -> expression .)
+    STRING          reduce using rule 117 (operand -> expression .)
+    FSTRING         reduce using rule 117 (operand -> expression .)
+    RSTRING         reduce using rule 117 (operand -> expression .)
+    MLS             reduce using rule 117 (operand -> expression .)
+    [               reduce using rule 117 (operand -> expression .)
+    {               reduce using rule 117 (operand -> expression .)
+    $end            reduce using rule 117 (operand -> expression .)
+    ELSE            reduce using rule 117 (operand -> expression .)
+    ELIF            reduce using rule 117 (operand -> expression .)
+    END             reduce using rule 117 (operand -> expression .)
+    ]               reduce using rule 117 (operand -> expression .)
+    :               reduce using rule 117 (operand -> expression .)
+    }               reduce using rule 117 (operand -> expression .)
+    CMP_OP          shift and go to state 72
+    IN              shift and go to state 73
+    AND             shift and go to state 74
+    OR              shift and go to state 75
+    ?               shift and go to state 76
+
+
+state 154
+
+    (176) class_ref -> var_ref . CID .
+
+    ID              reduce using rule 176 (class_ref -> var_ref . CID .)
+    .               reduce using rule 176 (class_ref -> var_ref . CID .)
+    (               reduce using rule 176 (class_ref -> var_ref . CID .)
+    [               reduce using rule 176 (class_ref -> var_ref . CID .)
+    USING           reduce using rule 176 (class_ref -> var_ref . CID .)
+    ,               reduce using rule 176 (class_ref -> var_ref . CID .)
+    :               reduce using rule 176 (class_ref -> var_ref . CID .)
+    MLS             reduce using rule 176 (class_ref -> var_ref . CID .)
+    ENTITY          reduce using rule 176 (class_ref -> var_ref . CID .)
+    IMPLEMENT       reduce using rule 176 (class_ref -> var_ref . CID .)
+    IMPLEMENTATION  reduce using rule 176 (class_ref -> var_ref . CID .)
+    INDEX           reduce using rule 176 (class_ref -> var_ref . CID .)
+    IMPORT          reduce using rule 176 (class_ref -> var_ref . CID .)
+    CID             reduce using rule 176 (class_ref -> var_ref . CID .)
+    FOR             reduce using rule 176 (class_ref -> var_ref . CID .)
+    IF              reduce using rule 176 (class_ref -> var_ref . CID .)
+    TYPEDEF         reduce using rule 176 (class_ref -> var_ref . CID .)
+    NOT             reduce using rule 176 (class_ref -> var_ref . CID .)
+    INT             reduce using rule 176 (class_ref -> var_ref . CID .)
+    FLOAT           reduce using rule 176 (class_ref -> var_ref . CID .)
+    NULL            reduce using rule 176 (class_ref -> var_ref . CID .)
+    REGEX           reduce using rule 176 (class_ref -> var_ref . CID .)
+    TRUE            reduce using rule 176 (class_ref -> var_ref . CID .)
+    FALSE           reduce using rule 176 (class_ref -> var_ref . CID .)
+    STRING          reduce using rule 176 (class_ref -> var_ref . CID .)
+    FSTRING         reduce using rule 176 (class_ref -> var_ref . CID .)
+    RSTRING         reduce using rule 176 (class_ref -> var_ref . CID .)
+    {               reduce using rule 176 (class_ref -> var_ref . CID .)
+    $end            reduce using rule 176 (class_ref -> var_ref . CID .)
+
+
+state 155
+
+    (114) boolean_expression -> var_ref . ID . IS DEFINED
+    (172) attr_ref -> var_ref . ID .
+
+    IS              shift and go to state 214
+    (               reduce using rule 172 (attr_ref -> var_ref . ID .)
+    [               reduce using rule 172 (attr_ref -> var_ref . ID .)
+    .               reduce using rule 172 (attr_ref -> var_ref . ID .)
+    =               reduce using rule 172 (attr_ref -> var_ref . ID .)
+    PEQ             reduce using rule 172 (attr_ref -> var_ref . ID .)
+    CMP_OP          reduce using rule 172 (attr_ref -> var_ref . ID .)
+    IN              reduce using rule 172 (attr_ref -> var_ref . ID .)
+    AND             reduce using rule 172 (attr_ref -> var_ref . ID .)
+    OR              reduce using rule 172 (attr_ref -> var_ref . ID .)
+    ?               reduce using rule 172 (attr_ref -> var_ref . ID .)
+    ENTITY          reduce using rule 172 (attr_ref -> var_ref . ID .)
+    IMPLEMENT       reduce using rule 172 (attr_ref -> var_ref . ID .)
+    IMPLEMENTATION  reduce using rule 172 (attr_ref -> var_ref . ID .)
+    INDEX           reduce using rule 172 (attr_ref -> var_ref . ID .)
+    IMPORT          reduce using rule 172 (attr_ref -> var_ref . ID .)
+    CID             reduce using rule 172 (attr_ref -> var_ref . ID .)
+    FOR             reduce using rule 172 (attr_ref -> var_ref . ID .)
+    IF              reduce using rule 172 (attr_ref -> var_ref . ID .)
+    TYPEDEF         reduce using rule 172 (attr_ref -> var_ref . ID .)
+    ID              reduce using rule 172 (attr_ref -> var_ref . ID .)
+    NOT             reduce using rule 172 (attr_ref -> var_ref . ID .)
+    INT             reduce using rule 172 (attr_ref -> var_ref . ID .)
+    FLOAT           reduce using rule 172 (attr_ref -> var_ref . ID .)
+    NULL            reduce using rule 172 (attr_ref -> var_ref . ID .)
+    REGEX           reduce using rule 172 (attr_ref -> var_ref . ID .)
+    TRUE            reduce using rule 172 (attr_ref -> var_ref . ID .)
+    FALSE           reduce using rule 172 (attr_ref -> var_ref . ID .)
+    STRING          reduce using rule 172 (attr_ref -> var_ref . ID .)
+    FSTRING         reduce using rule 172 (attr_ref -> var_ref . ID .)
+    RSTRING         reduce using rule 172 (attr_ref -> var_ref . ID .)
+    MLS             reduce using rule 172 (attr_ref -> var_ref . ID .)
+    {               reduce using rule 172 (attr_ref -> var_ref . ID .)
+    $end            reduce using rule 172 (attr_ref -> var_ref . ID .)
+    )               reduce using rule 172 (attr_ref -> var_ref . ID .)
+    :               reduce using rule 172 (attr_ref -> var_ref . ID .)
+    ,               reduce using rule 172 (attr_ref -> var_ref . ID .)
+    ]               reduce using rule 172 (attr_ref -> var_ref . ID .)
+    ELSE            reduce using rule 172 (attr_ref -> var_ref . ID .)
+    ELIF            reduce using rule 172 (attr_ref -> var_ref . ID .)
+    END             reduce using rule 172 (attr_ref -> var_ref . ID .)
+    }               reduce using rule 172 (attr_ref -> var_ref . ID .)
+
+
+state 156
+
     (23) assign -> var_ref = operand .
 
     ENTITY          reduce using rule 23 (assign -> var_ref = operand .)
     IMPLEMENT       reduce using rule 23 (assign -> var_ref = operand .)
     IMPLEMENTATION  reduce using rule 23 (assign -> var_ref = operand .)
     INDEX           reduce using rule 23 (assign -> var_ref = operand .)
     IMPORT          reduce using rule 23 (assign -> var_ref = operand .)
@@ -5395,25 +5675,26 @@
     INT             reduce using rule 23 (assign -> var_ref = operand .)
     FLOAT           reduce using rule 23 (assign -> var_ref = operand .)
     NULL            reduce using rule 23 (assign -> var_ref = operand .)
     REGEX           reduce using rule 23 (assign -> var_ref = operand .)
     TRUE            reduce using rule 23 (assign -> var_ref = operand .)
     FALSE           reduce using rule 23 (assign -> var_ref = operand .)
     STRING          reduce using rule 23 (assign -> var_ref = operand .)
+    FSTRING         reduce using rule 23 (assign -> var_ref = operand .)
     RSTRING         reduce using rule 23 (assign -> var_ref = operand .)
     MLS             reduce using rule 23 (assign -> var_ref = operand .)
     [               reduce using rule 23 (assign -> var_ref = operand .)
     {               reduce using rule 23 (assign -> var_ref = operand .)
     $end            reduce using rule 23 (assign -> var_ref = operand .)
     ELSE            reduce using rule 23 (assign -> var_ref = operand .)
     ELIF            reduce using rule 23 (assign -> var_ref = operand .)
     END             reduce using rule 23 (assign -> var_ref = operand .)
 
 
-state 154
+state 157
 
     (24) assign -> var_ref PEQ operand .
 
     ENTITY          reduce using rule 24 (assign -> var_ref PEQ operand .)
     IMPLEMENT       reduce using rule 24 (assign -> var_ref PEQ operand .)
     IMPLEMENTATION  reduce using rule 24 (assign -> var_ref PEQ operand .)
     INDEX           reduce using rule 24 (assign -> var_ref PEQ operand .)
@@ -5428,32 +5709,33 @@
     INT             reduce using rule 24 (assign -> var_ref PEQ operand .)
     FLOAT           reduce using rule 24 (assign -> var_ref PEQ operand .)
     NULL            reduce using rule 24 (assign -> var_ref PEQ operand .)
     REGEX           reduce using rule 24 (assign -> var_ref PEQ operand .)
     TRUE            reduce using rule 24 (assign -> var_ref PEQ operand .)
     FALSE           reduce using rule 24 (assign -> var_ref PEQ operand .)
     STRING          reduce using rule 24 (assign -> var_ref PEQ operand .)
+    FSTRING         reduce using rule 24 (assign -> var_ref PEQ operand .)
     RSTRING         reduce using rule 24 (assign -> var_ref PEQ operand .)
     MLS             reduce using rule 24 (assign -> var_ref PEQ operand .)
     [               reduce using rule 24 (assign -> var_ref PEQ operand .)
     {               reduce using rule 24 (assign -> var_ref PEQ operand .)
     $end            reduce using rule 24 (assign -> var_ref PEQ operand .)
     ELSE            reduce using rule 24 (assign -> var_ref PEQ operand .)
     ELIF            reduce using rule 24 (assign -> var_ref PEQ operand .)
     END             reduce using rule 24 (assign -> var_ref PEQ operand .)
 
 
-state 155
+state 158
 
-    (118) map_lookup -> var_ref [ operand . ]
+    (119) map_lookup -> var_ref [ operand . ]
 
-    ]               shift and go to state 210
+    ]               shift and go to state 215
 
 
-state 156
+state 159
 
     (26) if -> IF if_body END .
 
     ENTITY          reduce using rule 26 (if -> IF if_body END .)
     IMPLEMENT       reduce using rule 26 (if -> IF if_body END .)
     IMPLEMENTATION  reduce using rule 26 (if -> IF if_body END .)
     INDEX           reduce using rule 26 (if -> IF if_body END .)
@@ -5468,25 +5750,26 @@
     INT             reduce using rule 26 (if -> IF if_body END .)
     FLOAT           reduce using rule 26 (if -> IF if_body END .)
     NULL            reduce using rule 26 (if -> IF if_body END .)
     REGEX           reduce using rule 26 (if -> IF if_body END .)
     TRUE            reduce using rule 26 (if -> IF if_body END .)
     FALSE           reduce using rule 26 (if -> IF if_body END .)
     STRING          reduce using rule 26 (if -> IF if_body END .)
+    FSTRING         reduce using rule 26 (if -> IF if_body END .)
     RSTRING         reduce using rule 26 (if -> IF if_body END .)
     MLS             reduce using rule 26 (if -> IF if_body END .)
     [               reduce using rule 26 (if -> IF if_body END .)
     {               reduce using rule 26 (if -> IF if_body END .)
     $end            reduce using rule 26 (if -> IF if_body END .)
     ELSE            reduce using rule 26 (if -> IF if_body END .)
     ELIF            reduce using rule 26 (if -> IF if_body END .)
     END             reduce using rule 26 (if -> IF if_body END .)
 
 
-state 157
+state 160
 
     (27) if_body -> expression : . stmt_list if_next
     (21) stmt_list -> . statement stmt_list
     (22) stmt_list -> . empty
     (17) statement -> . assign
     (18) statement -> . for
     (19) statement -> . if
@@ -5498,466 +5781,505 @@
     (26) if -> . IF if_body END
     (97) expression -> . boolean_expression
     (98) expression -> . constant
     (99) expression -> . function_call
     (100) expression -> . var_ref
     (101) expression -> . constructor
     (102) expression -> . list_def
-    (103) expression -> . map_def
-    (104) expression -> . map_lookup
-    (105) expression -> . index_lookup
-    (106) expression -> . conditional_expression
-    (107) expression -> . ( expression )
-    (163) var_ref -> . attr_ref
-    (165) var_ref -> . ns_ref
-    (108) boolean_expression -> . expression CMP_OP expression
-    (109) boolean_expression -> . expression IN expression
-    (110) boolean_expression -> . expression AND expression
-    (111) boolean_expression -> . expression OR expression
-    (112) boolean_expression -> . NOT expression
-    (113) boolean_expression -> . var_ref . ID IS DEFINED
-    (114) boolean_expression -> . ID IS DEFINED
-    (115) boolean_expression -> . map_lookup IS DEFINED
-    (134) constant -> . INT
-    (135) constant -> . FLOAT
-    (136) constant -> . NULL
-    (137) constant -> . REGEX
-    (138) constant -> . TRUE
-    (139) constant -> . FALSE
-    (140) constant -> . STRING
-    (141) constant -> . RSTRING
-    (142) constant -> . MLS
-    (121) function_call -> . ns_ref ( function_param_list )
-    (122) function_call -> . attr_ref ( function_param_list )
-    (120) constructor -> . class_ref ( param_list )
-    (123) list_def -> . [ operand_list ]
-    (130) map_def -> . { pair_list }
-    (117) map_lookup -> . attr_ref [ operand ]
-    (118) map_lookup -> . var_ref [ operand ]
-    (119) map_lookup -> . map_lookup [ operand ]
-    (131) index_lookup -> . class_ref [ param_list ]
-    (132) index_lookup -> . attr_ref [ param_list ]
-    (133) conditional_expression -> . expression ? expression : expression
-    (164) attr_ref -> . var_ref . ID
-    (173) ns_ref -> . ns_ref SEP ID
-    (174) ns_ref -> . ID
-    (166) class_ref -> . CID
-    (167) class_ref -> . ns_ref SEP CID
-    (168) class_ref -> . var_ref . CID
+    (103) expression -> . list_comprehension
+    (104) expression -> . map_def
+    (105) expression -> . map_lookup
+    (106) expression -> . index_lookup
+    (107) expression -> . conditional_expression
+    (108) expression -> . ( expression )
+    (171) var_ref -> . attr_ref
+    (173) var_ref -> . ns_ref
+    (109) boolean_expression -> . expression CMP_OP expression
+    (110) boolean_expression -> . expression IN expression
+    (111) boolean_expression -> . expression AND expression
+    (112) boolean_expression -> . expression OR expression
+    (113) boolean_expression -> . NOT expression
+    (114) boolean_expression -> . var_ref . ID IS DEFINED
+    (115) boolean_expression -> . ID IS DEFINED
+    (116) boolean_expression -> . map_lookup IS DEFINED
+    (141) constant -> . INT
+    (142) constant -> . FLOAT
+    (143) constant -> . NULL
+    (144) constant -> . REGEX
+    (145) constant -> . TRUE
+    (146) constant -> . FALSE
+    (147) constant -> . STRING
+    (148) constant -> . FSTRING
+    (149) constant -> . RSTRING
+    (150) constant -> . MLS
+    (122) function_call -> . ns_ref ( function_param_list )
+    (123) function_call -> . attr_ref ( function_param_list )
+    (121) constructor -> . class_ref ( param_list )
+    (124) list_def -> . [ operand_list ]
+    (125) list_comprehension -> . [ expression list_comprehension_for list_comprehension_guard ]
+    (137) map_def -> . { pair_list }
+    (118) map_lookup -> . attr_ref [ operand ]
+    (119) map_lookup -> . var_ref [ operand ]
+    (120) map_lookup -> . map_lookup [ operand ]
+    (138) index_lookup -> . class_ref [ param_list ]
+    (139) index_lookup -> . attr_ref [ param_list ]
+    (140) conditional_expression -> . expression ? expression : expression
+    (172) attr_ref -> . var_ref . ID
+    (181) ns_ref -> . ns_ref SEP ID
+    (182) ns_ref -> . ID
+    (174) class_ref -> . CID
+    (175) class_ref -> . ns_ref SEP CID
+    (176) class_ref -> . var_ref . CID
 
     ELSE            reduce using rule 14 (empty -> .)
     ELIF            reduce using rule 14 (empty -> .)
     END             reduce using rule 14 (empty -> .)
     FOR             shift and go to state 23
     IF              shift and go to state 34
     (               shift and go to state 30
-    NOT             shift and go to state 46
-    ID              shift and go to state 82
-    INT             shift and go to state 47
-    FLOAT           shift and go to state 48
-    NULL            shift and go to state 49
-    REGEX           shift and go to state 50
-    TRUE            shift and go to state 51
-    FALSE           shift and go to state 52
-    STRING          shift and go to state 53
-    RSTRING         shift and go to state 54
+    NOT             shift and go to state 47
+    ID              shift and go to state 84
+    INT             shift and go to state 48
+    FLOAT           shift and go to state 49
+    NULL            shift and go to state 50
+    REGEX           shift and go to state 51
+    TRUE            shift and go to state 52
+    FALSE           shift and go to state 53
+    STRING          shift and go to state 54
+    FSTRING         shift and go to state 55
+    RSTRING         shift and go to state 56
     MLS             shift and go to state 20
-    [               shift and go to state 55
-    {               shift and go to state 56
+    [               shift and go to state 57
+    {               shift and go to state 58
     CID             shift and go to state 16
 
     expression                     shift and go to state 21
-    stmt_list                      shift and go to state 211
-    statement                      shift and go to state 212
-    empty                          shift and go to state 213
+    stmt_list                      shift and go to state 216
+    statement                      shift and go to state 217
+    empty                          shift and go to state 218
     assign                         shift and go to state 25
     for                            shift and go to state 26
     if                             shift and go to state 27
-    var_ref                        shift and go to state 214
+    var_ref                        shift and go to state 219
     boolean_expression             shift and go to state 35
     constant                       shift and go to state 36
     function_call                  shift and go to state 37
     constructor                    shift and go to state 38
     list_def                       shift and go to state 39
-    map_def                        shift and go to state 40
-    map_lookup                     shift and go to state 41
-    index_lookup                   shift and go to state 42
-    conditional_expression         shift and go to state 43
-    attr_ref                       shift and go to state 45
-    ns_ref                         shift and go to state 215
-    class_ref                      shift and go to state 85
+    list_comprehension             shift and go to state 40
+    map_def                        shift and go to state 41
+    map_lookup                     shift and go to state 42
+    index_lookup                   shift and go to state 43
+    conditional_expression         shift and go to state 44
+    attr_ref                       shift and go to state 46
+    ns_ref                         shift and go to state 220
+    class_ref                      shift and go to state 87
 
-state 158
+state 161
 
-    (115) boolean_expression -> map_lookup IS DEFINED .
+    (116) boolean_expression -> map_lookup IS DEFINED .
 
-    CMP_OP          reduce using rule 115 (boolean_expression -> map_lookup IS DEFINED .)
-    IN              reduce using rule 115 (boolean_expression -> map_lookup IS DEFINED .)
-    AND             reduce using rule 115 (boolean_expression -> map_lookup IS DEFINED .)
-    OR              reduce using rule 115 (boolean_expression -> map_lookup IS DEFINED .)
-    ?               reduce using rule 115 (boolean_expression -> map_lookup IS DEFINED .)
-    ENTITY          reduce using rule 115 (boolean_expression -> map_lookup IS DEFINED .)
-    IMPLEMENT       reduce using rule 115 (boolean_expression -> map_lookup IS DEFINED .)
-    IMPLEMENTATION  reduce using rule 115 (boolean_expression -> map_lookup IS DEFINED .)
-    INDEX           reduce using rule 115 (boolean_expression -> map_lookup IS DEFINED .)
-    IMPORT          reduce using rule 115 (boolean_expression -> map_lookup IS DEFINED .)
-    CID             reduce using rule 115 (boolean_expression -> map_lookup IS DEFINED .)
-    FOR             reduce using rule 115 (boolean_expression -> map_lookup IS DEFINED .)
-    IF              reduce using rule 115 (boolean_expression -> map_lookup IS DEFINED .)
-    (               reduce using rule 115 (boolean_expression -> map_lookup IS DEFINED .)
-    TYPEDEF         reduce using rule 115 (boolean_expression -> map_lookup IS DEFINED .)
-    ID              reduce using rule 115 (boolean_expression -> map_lookup IS DEFINED .)
-    NOT             reduce using rule 115 (boolean_expression -> map_lookup IS DEFINED .)
-    INT             reduce using rule 115 (boolean_expression -> map_lookup IS DEFINED .)
-    FLOAT           reduce using rule 115 (boolean_expression -> map_lookup IS DEFINED .)
-    NULL            reduce using rule 115 (boolean_expression -> map_lookup IS DEFINED .)
-    REGEX           reduce using rule 115 (boolean_expression -> map_lookup IS DEFINED .)
-    TRUE            reduce using rule 115 (boolean_expression -> map_lookup IS DEFINED .)
-    FALSE           reduce using rule 115 (boolean_expression -> map_lookup IS DEFINED .)
-    STRING          reduce using rule 115 (boolean_expression -> map_lookup IS DEFINED .)
-    RSTRING         reduce using rule 115 (boolean_expression -> map_lookup IS DEFINED .)
-    MLS             reduce using rule 115 (boolean_expression -> map_lookup IS DEFINED .)
-    [               reduce using rule 115 (boolean_expression -> map_lookup IS DEFINED .)
-    {               reduce using rule 115 (boolean_expression -> map_lookup IS DEFINED .)
-    $end            reduce using rule 115 (boolean_expression -> map_lookup IS DEFINED .)
-    )               reduce using rule 115 (boolean_expression -> map_lookup IS DEFINED .)
-    :               reduce using rule 115 (boolean_expression -> map_lookup IS DEFINED .)
-    ,               reduce using rule 115 (boolean_expression -> map_lookup IS DEFINED .)
-    ]               reduce using rule 115 (boolean_expression -> map_lookup IS DEFINED .)
-    ELSE            reduce using rule 115 (boolean_expression -> map_lookup IS DEFINED .)
-    ELIF            reduce using rule 115 (boolean_expression -> map_lookup IS DEFINED .)
-    END             reduce using rule 115 (boolean_expression -> map_lookup IS DEFINED .)
-    }               reduce using rule 115 (boolean_expression -> map_lookup IS DEFINED .)
+    CMP_OP          reduce using rule 116 (boolean_expression -> map_lookup IS DEFINED .)
+    IN              reduce using rule 116 (boolean_expression -> map_lookup IS DEFINED .)
+    AND             reduce using rule 116 (boolean_expression -> map_lookup IS DEFINED .)
+    OR              reduce using rule 116 (boolean_expression -> map_lookup IS DEFINED .)
+    ?               reduce using rule 116 (boolean_expression -> map_lookup IS DEFINED .)
+    ENTITY          reduce using rule 116 (boolean_expression -> map_lookup IS DEFINED .)
+    IMPLEMENT       reduce using rule 116 (boolean_expression -> map_lookup IS DEFINED .)
+    IMPLEMENTATION  reduce using rule 116 (boolean_expression -> map_lookup IS DEFINED .)
+    INDEX           reduce using rule 116 (boolean_expression -> map_lookup IS DEFINED .)
+    IMPORT          reduce using rule 116 (boolean_expression -> map_lookup IS DEFINED .)
+    CID             reduce using rule 116 (boolean_expression -> map_lookup IS DEFINED .)
+    FOR             reduce using rule 116 (boolean_expression -> map_lookup IS DEFINED .)
+    IF              reduce using rule 116 (boolean_expression -> map_lookup IS DEFINED .)
+    (               reduce using rule 116 (boolean_expression -> map_lookup IS DEFINED .)
+    TYPEDEF         reduce using rule 116 (boolean_expression -> map_lookup IS DEFINED .)
+    ID              reduce using rule 116 (boolean_expression -> map_lookup IS DEFINED .)
+    NOT             reduce using rule 116 (boolean_expression -> map_lookup IS DEFINED .)
+    INT             reduce using rule 116 (boolean_expression -> map_lookup IS DEFINED .)
+    FLOAT           reduce using rule 116 (boolean_expression -> map_lookup IS DEFINED .)
+    NULL            reduce using rule 116 (boolean_expression -> map_lookup IS DEFINED .)
+    REGEX           reduce using rule 116 (boolean_expression -> map_lookup IS DEFINED .)
+    TRUE            reduce using rule 116 (boolean_expression -> map_lookup IS DEFINED .)
+    FALSE           reduce using rule 116 (boolean_expression -> map_lookup IS DEFINED .)
+    STRING          reduce using rule 116 (boolean_expression -> map_lookup IS DEFINED .)
+    FSTRING         reduce using rule 116 (boolean_expression -> map_lookup IS DEFINED .)
+    RSTRING         reduce using rule 116 (boolean_expression -> map_lookup IS DEFINED .)
+    MLS             reduce using rule 116 (boolean_expression -> map_lookup IS DEFINED .)
+    [               reduce using rule 116 (boolean_expression -> map_lookup IS DEFINED .)
+    {               reduce using rule 116 (boolean_expression -> map_lookup IS DEFINED .)
+    $end            reduce using rule 116 (boolean_expression -> map_lookup IS DEFINED .)
+    )               reduce using rule 116 (boolean_expression -> map_lookup IS DEFINED .)
+    :               reduce using rule 116 (boolean_expression -> map_lookup IS DEFINED .)
+    ,               reduce using rule 116 (boolean_expression -> map_lookup IS DEFINED .)
+    ]               reduce using rule 116 (boolean_expression -> map_lookup IS DEFINED .)
+    ELSE            reduce using rule 116 (boolean_expression -> map_lookup IS DEFINED .)
+    ELIF            reduce using rule 116 (boolean_expression -> map_lookup IS DEFINED .)
+    END             reduce using rule 116 (boolean_expression -> map_lookup IS DEFINED .)
+    }               reduce using rule 116 (boolean_expression -> map_lookup IS DEFINED .)
 
 
-state 159
+state 162
 
-    (119) map_lookup -> map_lookup [ operand . ]
+    (120) map_lookup -> map_lookup [ operand . ]
 
-    ]               shift and go to state 216
+    ]               shift and go to state 221
 
 
-state 160
+state 163
 
     (94) typedef_inner -> TYPEDEF ID AS . ns_ref MATCHING expression
-    (173) ns_ref -> . ns_ref SEP ID
-    (174) ns_ref -> . ID
+    (181) ns_ref -> . ns_ref SEP ID
+    (182) ns_ref -> . ID
 
-    ID              shift and go to state 64
+    ID              shift and go to state 66
 
-    ns_ref                         shift and go to state 217
+    ns_ref                         shift and go to state 222
 
-state 161
+state 164
 
     (95) typedef_inner -> TYPEDEF CID AS . constructor
-    (120) constructor -> . class_ref ( param_list )
-    (166) class_ref -> . CID
-    (167) class_ref -> . ns_ref SEP CID
-    (168) class_ref -> . var_ref . CID
-    (173) ns_ref -> . ns_ref SEP ID
-    (174) ns_ref -> . ID
-    (163) var_ref -> . attr_ref
-    (165) var_ref -> . ns_ref
-    (164) attr_ref -> . var_ref . ID
-
-    CID             shift and go to state 16
-    ID              shift and go to state 64
-
-    constructor                    shift and go to state 218
-    class_ref                      shift and go to state 219
-    ns_ref                         shift and go to state 62
-    var_ref                        shift and go to state 63
-    attr_ref                       shift and go to state 65
+    (121) constructor -> . class_ref ( param_list )
+    (174) class_ref -> . CID
+    (175) class_ref -> . ns_ref SEP CID
+    (176) class_ref -> . var_ref . CID
+    (181) ns_ref -> . ns_ref SEP ID
+    (182) ns_ref -> . ID
+    (171) var_ref -> . attr_ref
+    (173) var_ref -> . ns_ref
+    (172) attr_ref -> . var_ref . ID
 
-state 162
+    CID             shift and go to state 16
+    ID              shift and go to state 66
 
-    (122) function_call -> attr_ref ( function_param_list . )
+    constructor                    shift and go to state 223
+    class_ref                      shift and go to state 224
+    ns_ref                         shift and go to state 64
+    var_ref                        shift and go to state 65
+    attr_ref                       shift and go to state 67
 
-    )               shift and go to state 220
+state 165
 
+    (123) function_call -> attr_ref ( function_param_list . )
 
-state 163
+    )               shift and go to state 225
 
-    (117) map_lookup -> attr_ref [ operand . ]
 
-    ]               shift and go to state 221
+state 166
 
+    (118) map_lookup -> attr_ref [ operand . ]
 
-state 164
+    ]               shift and go to state 226
 
-    (132) index_lookup -> attr_ref [ param_list . ]
 
-    ]               shift and go to state 222
+state 167
 
+    (139) index_lookup -> attr_ref [ param_list . ]
+
+    ]               shift and go to state 227
 
-state 165
 
-    (123) list_def -> [ operand_list ] .
+state 168
 
-    CMP_OP          reduce using rule 123 (list_def -> [ operand_list ] .)
-    IN              reduce using rule 123 (list_def -> [ operand_list ] .)
-    AND             reduce using rule 123 (list_def -> [ operand_list ] .)
-    OR              reduce using rule 123 (list_def -> [ operand_list ] .)
-    ?               reduce using rule 123 (list_def -> [ operand_list ] .)
-    ENTITY          reduce using rule 123 (list_def -> [ operand_list ] .)
-    IMPLEMENT       reduce using rule 123 (list_def -> [ operand_list ] .)
-    IMPLEMENTATION  reduce using rule 123 (list_def -> [ operand_list ] .)
-    INDEX           reduce using rule 123 (list_def -> [ operand_list ] .)
-    IMPORT          reduce using rule 123 (list_def -> [ operand_list ] .)
-    CID             reduce using rule 123 (list_def -> [ operand_list ] .)
-    FOR             reduce using rule 123 (list_def -> [ operand_list ] .)
-    IF              reduce using rule 123 (list_def -> [ operand_list ] .)
-    (               reduce using rule 123 (list_def -> [ operand_list ] .)
-    TYPEDEF         reduce using rule 123 (list_def -> [ operand_list ] .)
-    ID              reduce using rule 123 (list_def -> [ operand_list ] .)
-    NOT             reduce using rule 123 (list_def -> [ operand_list ] .)
-    INT             reduce using rule 123 (list_def -> [ operand_list ] .)
-    FLOAT           reduce using rule 123 (list_def -> [ operand_list ] .)
-    NULL            reduce using rule 123 (list_def -> [ operand_list ] .)
-    REGEX           reduce using rule 123 (list_def -> [ operand_list ] .)
-    TRUE            reduce using rule 123 (list_def -> [ operand_list ] .)
-    FALSE           reduce using rule 123 (list_def -> [ operand_list ] .)
-    STRING          reduce using rule 123 (list_def -> [ operand_list ] .)
-    RSTRING         reduce using rule 123 (list_def -> [ operand_list ] .)
-    MLS             reduce using rule 123 (list_def -> [ operand_list ] .)
-    [               reduce using rule 123 (list_def -> [ operand_list ] .)
-    {               reduce using rule 123 (list_def -> [ operand_list ] .)
-    $end            reduce using rule 123 (list_def -> [ operand_list ] .)
-    )               reduce using rule 123 (list_def -> [ operand_list ] .)
-    :               reduce using rule 123 (list_def -> [ operand_list ] .)
-    ,               reduce using rule 123 (list_def -> [ operand_list ] .)
-    ]               reduce using rule 123 (list_def -> [ operand_list ] .)
-    ELSE            reduce using rule 123 (list_def -> [ operand_list ] .)
-    ELIF            reduce using rule 123 (list_def -> [ operand_list ] .)
-    END             reduce using rule 123 (list_def -> [ operand_list ] .)
-    }               reduce using rule 123 (list_def -> [ operand_list ] .)
+    (124) list_def -> [ operand_list ] .
 
+    CMP_OP          reduce using rule 124 (list_def -> [ operand_list ] .)
+    IN              reduce using rule 124 (list_def -> [ operand_list ] .)
+    AND             reduce using rule 124 (list_def -> [ operand_list ] .)
+    OR              reduce using rule 124 (list_def -> [ operand_list ] .)
+    ?               reduce using rule 124 (list_def -> [ operand_list ] .)
+    ENTITY          reduce using rule 124 (list_def -> [ operand_list ] .)
+    IMPLEMENT       reduce using rule 124 (list_def -> [ operand_list ] .)
+    IMPLEMENTATION  reduce using rule 124 (list_def -> [ operand_list ] .)
+    INDEX           reduce using rule 124 (list_def -> [ operand_list ] .)
+    IMPORT          reduce using rule 124 (list_def -> [ operand_list ] .)
+    CID             reduce using rule 124 (list_def -> [ operand_list ] .)
+    FOR             reduce using rule 124 (list_def -> [ operand_list ] .)
+    IF              reduce using rule 124 (list_def -> [ operand_list ] .)
+    (               reduce using rule 124 (list_def -> [ operand_list ] .)
+    TYPEDEF         reduce using rule 124 (list_def -> [ operand_list ] .)
+    ID              reduce using rule 124 (list_def -> [ operand_list ] .)
+    NOT             reduce using rule 124 (list_def -> [ operand_list ] .)
+    INT             reduce using rule 124 (list_def -> [ operand_list ] .)
+    FLOAT           reduce using rule 124 (list_def -> [ operand_list ] .)
+    NULL            reduce using rule 124 (list_def -> [ operand_list ] .)
+    REGEX           reduce using rule 124 (list_def -> [ operand_list ] .)
+    TRUE            reduce using rule 124 (list_def -> [ operand_list ] .)
+    FALSE           reduce using rule 124 (list_def -> [ operand_list ] .)
+    STRING          reduce using rule 124 (list_def -> [ operand_list ] .)
+    FSTRING         reduce using rule 124 (list_def -> [ operand_list ] .)
+    RSTRING         reduce using rule 124 (list_def -> [ operand_list ] .)
+    MLS             reduce using rule 124 (list_def -> [ operand_list ] .)
+    [               reduce using rule 124 (list_def -> [ operand_list ] .)
+    {               reduce using rule 124 (list_def -> [ operand_list ] .)
+    $end            reduce using rule 124 (list_def -> [ operand_list ] .)
+    )               reduce using rule 124 (list_def -> [ operand_list ] .)
+    :               reduce using rule 124 (list_def -> [ operand_list ] .)
+    ,               reduce using rule 124 (list_def -> [ operand_list ] .)
+    ]               reduce using rule 124 (list_def -> [ operand_list ] .)
+    ELSE            reduce using rule 124 (list_def -> [ operand_list ] .)
+    ELIF            reduce using rule 124 (list_def -> [ operand_list ] .)
+    END             reduce using rule 124 (list_def -> [ operand_list ] .)
+    }               reduce using rule 124 (list_def -> [ operand_list ] .)
 
-state 166
 
-    (160) operand_list -> operand , . operand_list
-    (160) operand_list -> . operand , operand_list
-    (161) operand_list -> . operand
-    (162) operand_list -> .
-    (116) operand -> . expression
+state 169
+
+    (125) list_comprehension -> [ expression list_comprehension_for . list_comprehension_guard ]
+    (129) list_comprehension_guard -> . empty
+    (130) list_comprehension_guard -> . IF expression list_comprehension_guard
+    (14) empty -> .
+
+    IF              shift and go to state 230
+    ]               reduce using rule 14 (empty -> .)
+
+    list_comprehension_guard       shift and go to state 228
+    empty                          shift and go to state 229
+
+state 170
+
+    (127) list_comprehension_for -> FOR . ID IN expression list_comprehension_for_empty
+    (128) list_comprehension_for -> FOR . ID IN expression list_comprehension_for
+
+    ID              shift and go to state 231
+
+
+state 171
+
+    (168) operand_list -> operand , . operand_list
+    (168) operand_list -> . operand , operand_list
+    (169) operand_list -> . operand
+    (170) operand_list -> .
+    (117) operand -> . expression
     (97) expression -> . boolean_expression
     (98) expression -> . constant
     (99) expression -> . function_call
     (100) expression -> . var_ref
     (101) expression -> . constructor
     (102) expression -> . list_def
-    (103) expression -> . map_def
-    (104) expression -> . map_lookup
-    (105) expression -> . index_lookup
-    (106) expression -> . conditional_expression
-    (107) expression -> . ( expression )
-    (108) boolean_expression -> . expression CMP_OP expression
-    (109) boolean_expression -> . expression IN expression
-    (110) boolean_expression -> . expression AND expression
-    (111) boolean_expression -> . expression OR expression
-    (112) boolean_expression -> . NOT expression
-    (113) boolean_expression -> . var_ref . ID IS DEFINED
-    (114) boolean_expression -> . ID IS DEFINED
-    (115) boolean_expression -> . map_lookup IS DEFINED
-    (134) constant -> . INT
-    (135) constant -> . FLOAT
-    (136) constant -> . NULL
-    (137) constant -> . REGEX
-    (138) constant -> . TRUE
-    (139) constant -> . FALSE
-    (140) constant -> . STRING
-    (141) constant -> . RSTRING
-    (142) constant -> . MLS
-    (121) function_call -> . ns_ref ( function_param_list )
-    (122) function_call -> . attr_ref ( function_param_list )
-    (163) var_ref -> . attr_ref
-    (165) var_ref -> . ns_ref
-    (120) constructor -> . class_ref ( param_list )
-    (123) list_def -> . [ operand_list ]
-    (130) map_def -> . { pair_list }
-    (117) map_lookup -> . attr_ref [ operand ]
-    (118) map_lookup -> . var_ref [ operand ]
-    (119) map_lookup -> . map_lookup [ operand ]
-    (131) index_lookup -> . class_ref [ param_list ]
-    (132) index_lookup -> . attr_ref [ param_list ]
-    (133) conditional_expression -> . expression ? expression : expression
-    (173) ns_ref -> . ns_ref SEP ID
-    (174) ns_ref -> . ID
-    (164) attr_ref -> . var_ref . ID
-    (166) class_ref -> . CID
-    (167) class_ref -> . ns_ref SEP CID
-    (168) class_ref -> . var_ref . CID
+    (103) expression -> . list_comprehension
+    (104) expression -> . map_def
+    (105) expression -> . map_lookup
+    (106) expression -> . index_lookup
+    (107) expression -> . conditional_expression
+    (108) expression -> . ( expression )
+    (109) boolean_expression -> . expression CMP_OP expression
+    (110) boolean_expression -> . expression IN expression
+    (111) boolean_expression -> . expression AND expression
+    (112) boolean_expression -> . expression OR expression
+    (113) boolean_expression -> . NOT expression
+    (114) boolean_expression -> . var_ref . ID IS DEFINED
+    (115) boolean_expression -> . ID IS DEFINED
+    (116) boolean_expression -> . map_lookup IS DEFINED
+    (141) constant -> . INT
+    (142) constant -> . FLOAT
+    (143) constant -> . NULL
+    (144) constant -> . REGEX
+    (145) constant -> . TRUE
+    (146) constant -> . FALSE
+    (147) constant -> . STRING
+    (148) constant -> . FSTRING
+    (149) constant -> . RSTRING
+    (150) constant -> . MLS
+    (122) function_call -> . ns_ref ( function_param_list )
+    (123) function_call -> . attr_ref ( function_param_list )
+    (171) var_ref -> . attr_ref
+    (173) var_ref -> . ns_ref
+    (121) constructor -> . class_ref ( param_list )
+    (124) list_def -> . [ operand_list ]
+    (125) list_comprehension -> . [ expression list_comprehension_for list_comprehension_guard ]
+    (137) map_def -> . { pair_list }
+    (118) map_lookup -> . attr_ref [ operand ]
+    (119) map_lookup -> . var_ref [ operand ]
+    (120) map_lookup -> . map_lookup [ operand ]
+    (138) index_lookup -> . class_ref [ param_list ]
+    (139) index_lookup -> . attr_ref [ param_list ]
+    (140) conditional_expression -> . expression ? expression : expression
+    (181) ns_ref -> . ns_ref SEP ID
+    (182) ns_ref -> . ID
+    (172) attr_ref -> . var_ref . ID
+    (174) class_ref -> . CID
+    (175) class_ref -> . ns_ref SEP CID
+    (176) class_ref -> . var_ref . CID
 
-    ]               reduce using rule 162 (operand_list -> .)
+    ]               reduce using rule 170 (operand_list -> .)
     (               shift and go to state 30
-    NOT             shift and go to state 46
-    ID              shift and go to state 82
-    INT             shift and go to state 47
-    FLOAT           shift and go to state 48
-    NULL            shift and go to state 49
-    REGEX           shift and go to state 50
-    TRUE            shift and go to state 51
-    FALSE           shift and go to state 52
-    STRING          shift and go to state 53
-    RSTRING         shift and go to state 54
+    NOT             shift and go to state 47
+    ID              shift and go to state 84
+    INT             shift and go to state 48
+    FLOAT           shift and go to state 49
+    NULL            shift and go to state 50
+    REGEX           shift and go to state 51
+    TRUE            shift and go to state 52
+    FALSE           shift and go to state 53
+    STRING          shift and go to state 54
+    FSTRING         shift and go to state 55
+    RSTRING         shift and go to state 56
     MLS             shift and go to state 20
-    [               shift and go to state 55
-    {               shift and go to state 56
+    [               shift and go to state 57
+    {               shift and go to state 58
     CID             shift and go to state 16
 
-  ! CID             [ reduce using rule 162 (operand_list -> .) ]
-  ! ID              [ reduce using rule 162 (operand_list -> .) ]
+  ! CID             [ reduce using rule 170 (operand_list -> .) ]
+  ! ID              [ reduce using rule 170 (operand_list -> .) ]
 
-    operand                        shift and go to state 103
-    operand_list                   shift and go to state 223
-    expression                     shift and go to state 104
+    operand                        shift and go to state 106
+    operand_list                   shift and go to state 232
+    expression                     shift and go to state 153
     boolean_expression             shift and go to state 35
     constant                       shift and go to state 36
     function_call                  shift and go to state 37
-    var_ref                        shift and go to state 81
+    var_ref                        shift and go to state 83
     constructor                    shift and go to state 38
     list_def                       shift and go to state 39
-    map_def                        shift and go to state 40
-    map_lookup                     shift and go to state 41
-    index_lookup                   shift and go to state 42
-    conditional_expression         shift and go to state 43
-    ns_ref                         shift and go to state 83
-    attr_ref                       shift and go to state 84
-    class_ref                      shift and go to state 85
+    list_comprehension             shift and go to state 40
+    map_def                        shift and go to state 41
+    map_lookup                     shift and go to state 42
+    index_lookup                   shift and go to state 43
+    conditional_expression         shift and go to state 44
+    ns_ref                         shift and go to state 85
+    attr_ref                       shift and go to state 86
+    class_ref                      shift and go to state 87
 
-state 167
+state 172
 
-    (130) map_def -> { pair_list } .
+    (137) map_def -> { pair_list } .
 
-    CMP_OP          reduce using rule 130 (map_def -> { pair_list } .)
-    IN              reduce using rule 130 (map_def -> { pair_list } .)
-    AND             reduce using rule 130 (map_def -> { pair_list } .)
-    OR              reduce using rule 130 (map_def -> { pair_list } .)
-    ?               reduce using rule 130 (map_def -> { pair_list } .)
-    ENTITY          reduce using rule 130 (map_def -> { pair_list } .)
-    IMPLEMENT       reduce using rule 130 (map_def -> { pair_list } .)
-    IMPLEMENTATION  reduce using rule 130 (map_def -> { pair_list } .)
-    INDEX           reduce using rule 130 (map_def -> { pair_list } .)
-    IMPORT          reduce using rule 130 (map_def -> { pair_list } .)
-    CID             reduce using rule 130 (map_def -> { pair_list } .)
-    FOR             reduce using rule 130 (map_def -> { pair_list } .)
-    IF              reduce using rule 130 (map_def -> { pair_list } .)
-    (               reduce using rule 130 (map_def -> { pair_list } .)
-    TYPEDEF         reduce using rule 130 (map_def -> { pair_list } .)
-    ID              reduce using rule 130 (map_def -> { pair_list } .)
-    NOT             reduce using rule 130 (map_def -> { pair_list } .)
-    INT             reduce using rule 130 (map_def -> { pair_list } .)
-    FLOAT           reduce using rule 130 (map_def -> { pair_list } .)
-    NULL            reduce using rule 130 (map_def -> { pair_list } .)
-    REGEX           reduce using rule 130 (map_def -> { pair_list } .)
-    TRUE            reduce using rule 130 (map_def -> { pair_list } .)
-    FALSE           reduce using rule 130 (map_def -> { pair_list } .)
-    STRING          reduce using rule 130 (map_def -> { pair_list } .)
-    RSTRING         reduce using rule 130 (map_def -> { pair_list } .)
-    MLS             reduce using rule 130 (map_def -> { pair_list } .)
-    [               reduce using rule 130 (map_def -> { pair_list } .)
-    {               reduce using rule 130 (map_def -> { pair_list } .)
-    $end            reduce using rule 130 (map_def -> { pair_list } .)
-    )               reduce using rule 130 (map_def -> { pair_list } .)
-    :               reduce using rule 130 (map_def -> { pair_list } .)
-    ,               reduce using rule 130 (map_def -> { pair_list } .)
-    ]               reduce using rule 130 (map_def -> { pair_list } .)
-    ELSE            reduce using rule 130 (map_def -> { pair_list } .)
-    ELIF            reduce using rule 130 (map_def -> { pair_list } .)
-    END             reduce using rule 130 (map_def -> { pair_list } .)
-    }               reduce using rule 130 (map_def -> { pair_list } .)
-    DICT            reduce using rule 130 (map_def -> { pair_list } .)
+    CMP_OP          reduce using rule 137 (map_def -> { pair_list } .)
+    IN              reduce using rule 137 (map_def -> { pair_list } .)
+    AND             reduce using rule 137 (map_def -> { pair_list } .)
+    OR              reduce using rule 137 (map_def -> { pair_list } .)
+    ?               reduce using rule 137 (map_def -> { pair_list } .)
+    ENTITY          reduce using rule 137 (map_def -> { pair_list } .)
+    IMPLEMENT       reduce using rule 137 (map_def -> { pair_list } .)
+    IMPLEMENTATION  reduce using rule 137 (map_def -> { pair_list } .)
+    INDEX           reduce using rule 137 (map_def -> { pair_list } .)
+    IMPORT          reduce using rule 137 (map_def -> { pair_list } .)
+    CID             reduce using rule 137 (map_def -> { pair_list } .)
+    FOR             reduce using rule 137 (map_def -> { pair_list } .)
+    IF              reduce using rule 137 (map_def -> { pair_list } .)
+    (               reduce using rule 137 (map_def -> { pair_list } .)
+    TYPEDEF         reduce using rule 137 (map_def -> { pair_list } .)
+    ID              reduce using rule 137 (map_def -> { pair_list } .)
+    NOT             reduce using rule 137 (map_def -> { pair_list } .)
+    INT             reduce using rule 137 (map_def -> { pair_list } .)
+    FLOAT           reduce using rule 137 (map_def -> { pair_list } .)
+    NULL            reduce using rule 137 (map_def -> { pair_list } .)
+    REGEX           reduce using rule 137 (map_def -> { pair_list } .)
+    TRUE            reduce using rule 137 (map_def -> { pair_list } .)
+    FALSE           reduce using rule 137 (map_def -> { pair_list } .)
+    STRING          reduce using rule 137 (map_def -> { pair_list } .)
+    FSTRING         reduce using rule 137 (map_def -> { pair_list } .)
+    RSTRING         reduce using rule 137 (map_def -> { pair_list } .)
+    MLS             reduce using rule 137 (map_def -> { pair_list } .)
+    [               reduce using rule 137 (map_def -> { pair_list } .)
+    {               reduce using rule 137 (map_def -> { pair_list } .)
+    $end            reduce using rule 137 (map_def -> { pair_list } .)
+    )               reduce using rule 137 (map_def -> { pair_list } .)
+    :               reduce using rule 137 (map_def -> { pair_list } .)
+    ,               reduce using rule 137 (map_def -> { pair_list } .)
+    ]               reduce using rule 137 (map_def -> { pair_list } .)
+    ELSE            reduce using rule 137 (map_def -> { pair_list } .)
+    ELIF            reduce using rule 137 (map_def -> { pair_list } .)
+    END             reduce using rule 137 (map_def -> { pair_list } .)
+    }               reduce using rule 137 (map_def -> { pair_list } .)
+    DICT            reduce using rule 137 (map_def -> { pair_list } .)
 
 
-state 168
+state 173
 
-    (126) pair_list -> dict_key : . operand , pair_list
-    (127) pair_list -> dict_key : . operand empty pair_list_empty
-    (116) operand -> . expression
+    (133) pair_list -> dict_key : . operand , pair_list
+    (134) pair_list -> dict_key : . operand empty pair_list_empty
+    (117) operand -> . expression
     (97) expression -> . boolean_expression
     (98) expression -> . constant
     (99) expression -> . function_call
     (100) expression -> . var_ref
     (101) expression -> . constructor
     (102) expression -> . list_def
-    (103) expression -> . map_def
-    (104) expression -> . map_lookup
-    (105) expression -> . index_lookup
-    (106) expression -> . conditional_expression
-    (107) expression -> . ( expression )
-    (108) boolean_expression -> . expression CMP_OP expression
-    (109) boolean_expression -> . expression IN expression
-    (110) boolean_expression -> . expression AND expression
-    (111) boolean_expression -> . expression OR expression
-    (112) boolean_expression -> . NOT expression
-    (113) boolean_expression -> . var_ref . ID IS DEFINED
-    (114) boolean_expression -> . ID IS DEFINED
-    (115) boolean_expression -> . map_lookup IS DEFINED
-    (134) constant -> . INT
-    (135) constant -> . FLOAT
-    (136) constant -> . NULL
-    (137) constant -> . REGEX
-    (138) constant -> . TRUE
-    (139) constant -> . FALSE
-    (140) constant -> . STRING
-    (141) constant -> . RSTRING
-    (142) constant -> . MLS
-    (121) function_call -> . ns_ref ( function_param_list )
-    (122) function_call -> . attr_ref ( function_param_list )
-    (163) var_ref -> . attr_ref
-    (165) var_ref -> . ns_ref
-    (120) constructor -> . class_ref ( param_list )
-    (123) list_def -> . [ operand_list ]
-    (130) map_def -> . { pair_list }
-    (117) map_lookup -> . attr_ref [ operand ]
-    (118) map_lookup -> . var_ref [ operand ]
-    (119) map_lookup -> . map_lookup [ operand ]
-    (131) index_lookup -> . class_ref [ param_list ]
-    (132) index_lookup -> . attr_ref [ param_list ]
-    (133) conditional_expression -> . expression ? expression : expression
-    (173) ns_ref -> . ns_ref SEP ID
-    (174) ns_ref -> . ID
-    (164) attr_ref -> . var_ref . ID
-    (166) class_ref -> . CID
-    (167) class_ref -> . ns_ref SEP CID
-    (168) class_ref -> . var_ref . CID
+    (103) expression -> . list_comprehension
+    (104) expression -> . map_def
+    (105) expression -> . map_lookup
+    (106) expression -> . index_lookup
+    (107) expression -> . conditional_expression
+    (108) expression -> . ( expression )
+    (109) boolean_expression -> . expression CMP_OP expression
+    (110) boolean_expression -> . expression IN expression
+    (111) boolean_expression -> . expression AND expression
+    (112) boolean_expression -> . expression OR expression
+    (113) boolean_expression -> . NOT expression
+    (114) boolean_expression -> . var_ref . ID IS DEFINED
+    (115) boolean_expression -> . ID IS DEFINED
+    (116) boolean_expression -> . map_lookup IS DEFINED
+    (141) constant -> . INT
+    (142) constant -> . FLOAT
+    (143) constant -> . NULL
+    (144) constant -> . REGEX
+    (145) constant -> . TRUE
+    (146) constant -> . FALSE
+    (147) constant -> . STRING
+    (148) constant -> . FSTRING
+    (149) constant -> . RSTRING
+    (150) constant -> . MLS
+    (122) function_call -> . ns_ref ( function_param_list )
+    (123) function_call -> . attr_ref ( function_param_list )
+    (171) var_ref -> . attr_ref
+    (173) var_ref -> . ns_ref
+    (121) constructor -> . class_ref ( param_list )
+    (124) list_def -> . [ operand_list ]
+    (125) list_comprehension -> . [ expression list_comprehension_for list_comprehension_guard ]
+    (137) map_def -> . { pair_list }
+    (118) map_lookup -> . attr_ref [ operand ]
+    (119) map_lookup -> . var_ref [ operand ]
+    (120) map_lookup -> . map_lookup [ operand ]
+    (138) index_lookup -> . class_ref [ param_list ]
+    (139) index_lookup -> . attr_ref [ param_list ]
+    (140) conditional_expression -> . expression ? expression : expression
+    (181) ns_ref -> . ns_ref SEP ID
+    (182) ns_ref -> . ID
+    (172) attr_ref -> . var_ref . ID
+    (174) class_ref -> . CID
+    (175) class_ref -> . ns_ref SEP CID
+    (176) class_ref -> . var_ref . CID
 
     (               shift and go to state 30
-    NOT             shift and go to state 46
-    ID              shift and go to state 82
-    INT             shift and go to state 47
-    FLOAT           shift and go to state 48
-    NULL            shift and go to state 49
-    REGEX           shift and go to state 50
-    TRUE            shift and go to state 51
-    FALSE           shift and go to state 52
-    STRING          shift and go to state 53
-    RSTRING         shift and go to state 54
+    NOT             shift and go to state 47
+    ID              shift and go to state 84
+    INT             shift and go to state 48
+    FLOAT           shift and go to state 49
+    NULL            shift and go to state 50
+    REGEX           shift and go to state 51
+    TRUE            shift and go to state 52
+    FALSE           shift and go to state 53
+    STRING          shift and go to state 54
+    FSTRING         shift and go to state 55
+    RSTRING         shift and go to state 56
     MLS             shift and go to state 20
-    [               shift and go to state 55
-    {               shift and go to state 56
+    [               shift and go to state 57
+    {               shift and go to state 58
     CID             shift and go to state 16
 
-    operand                        shift and go to state 224
-    expression                     shift and go to state 104
+    operand                        shift and go to state 233
+    expression                     shift and go to state 153
     boolean_expression             shift and go to state 35
     constant                       shift and go to state 36
     function_call                  shift and go to state 37
-    var_ref                        shift and go to state 81
+    var_ref                        shift and go to state 83
     constructor                    shift and go to state 38
     list_def                       shift and go to state 39
-    map_def                        shift and go to state 40
-    map_lookup                     shift and go to state 41
-    index_lookup                   shift and go to state 42
-    conditional_expression         shift and go to state 43
-    ns_ref                         shift and go to state 83
-    attr_ref                       shift and go to state 84
-    class_ref                      shift and go to state 85
+    list_comprehension             shift and go to state 40
+    map_def                        shift and go to state 41
+    map_lookup                     shift and go to state 42
+    index_lookup                   shift and go to state 43
+    conditional_expression         shift and go to state 44
+    ns_ref                         shift and go to state 85
+    attr_ref                       shift and go to state 86
+    class_ref                      shift and go to state 87
 
-state 169
+state 174
 
     (31) entity_def -> ENTITY CID : entity_body_outer .
 
     ENTITY          reduce using rule 31 (entity_def -> ENTITY CID : entity_body_outer .)
     IMPLEMENT       reduce using rule 31 (entity_def -> ENTITY CID : entity_body_outer .)
     IMPLEMENTATION  reduce using rule 31 (entity_def -> ENTITY CID : entity_body_outer .)
     INDEX           reduce using rule 31 (entity_def -> ENTITY CID : entity_body_outer .)
@@ -5972,22 +6294,23 @@
     INT             reduce using rule 31 (entity_def -> ENTITY CID : entity_body_outer .)
     FLOAT           reduce using rule 31 (entity_def -> ENTITY CID : entity_body_outer .)
     NULL            reduce using rule 31 (entity_def -> ENTITY CID : entity_body_outer .)
     REGEX           reduce using rule 31 (entity_def -> ENTITY CID : entity_body_outer .)
     TRUE            reduce using rule 31 (entity_def -> ENTITY CID : entity_body_outer .)
     FALSE           reduce using rule 31 (entity_def -> ENTITY CID : entity_body_outer .)
     STRING          reduce using rule 31 (entity_def -> ENTITY CID : entity_body_outer .)
+    FSTRING         reduce using rule 31 (entity_def -> ENTITY CID : entity_body_outer .)
     RSTRING         reduce using rule 31 (entity_def -> ENTITY CID : entity_body_outer .)
     MLS             reduce using rule 31 (entity_def -> ENTITY CID : entity_body_outer .)
     [               reduce using rule 31 (entity_def -> ENTITY CID : entity_body_outer .)
     {               reduce using rule 31 (entity_def -> ENTITY CID : entity_body_outer .)
     $end            reduce using rule 31 (entity_def -> ENTITY CID : entity_body_outer .)
 
 
-state 170
+state 175
 
     (35) entity_body_outer -> MLS . entity_body END
     (38) entity_body_outer -> MLS . END
     (39) entity_body -> . entity_body attr
     (40) entity_body -> . attr
     (48) attr -> . attr_type CID empty
     (49) attr -> . attr_type CID = constant
@@ -6012,30 +6335,30 @@
     (45) attr_type -> . attr_type_opt
     (46) attr_type -> . attr_type_multi
     (47) attr_type -> . attr_base_type
     (43) attr_type_opt -> . attr_type_multi ?
     (44) attr_type_opt -> . attr_base_type ?
     (42) attr_type_multi -> . attr_base_type [ ]
     (41) attr_base_type -> . ns_ref
-    (173) ns_ref -> . ns_ref SEP ID
-    (174) ns_ref -> . ID
+    (181) ns_ref -> . ns_ref SEP ID
+    (182) ns_ref -> . ID
 
-    END             shift and go to state 226
-    DICT            shift and go to state 175
-    ID              shift and go to state 64
-
-    entity_body                    shift and go to state 225
-    attr                           shift and go to state 173
-    attr_type                      shift and go to state 174
-    attr_type_opt                  shift and go to state 176
-    attr_type_multi                shift and go to state 177
-    attr_base_type                 shift and go to state 178
-    ns_ref                         shift and go to state 179
+    END             shift and go to state 235
+    DICT            shift and go to state 180
+    ID              shift and go to state 66
 
-state 171
+    entity_body                    shift and go to state 234
+    attr                           shift and go to state 178
+    attr_type                      shift and go to state 179
+    attr_type_opt                  shift and go to state 181
+    attr_type_multi                shift and go to state 182
+    attr_base_type                 shift and go to state 183
+    ns_ref                         shift and go to state 184
+
+state 176
 
     (36) entity_body_outer -> entity_body . END
     (39) entity_body -> entity_body . attr
     (48) attr -> . attr_type CID empty
     (49) attr -> . attr_type CID = constant
     (50) attr -> . attr_type CID = constant_list
     (51) attr -> . attr_type CID = UNDEF
@@ -6058,29 +6381,29 @@
     (45) attr_type -> . attr_type_opt
     (46) attr_type -> . attr_type_multi
     (47) attr_type -> . attr_base_type
     (43) attr_type_opt -> . attr_type_multi ?
     (44) attr_type_opt -> . attr_base_type ?
     (42) attr_type_multi -> . attr_base_type [ ]
     (41) attr_base_type -> . ns_ref
-    (173) ns_ref -> . ns_ref SEP ID
-    (174) ns_ref -> . ID
+    (181) ns_ref -> . ns_ref SEP ID
+    (182) ns_ref -> . ID
 
-    END             shift and go to state 227
-    DICT            shift and go to state 175
-    ID              shift and go to state 64
-
-    attr                           shift and go to state 228
-    attr_type                      shift and go to state 174
-    attr_type_opt                  shift and go to state 176
-    attr_type_multi                shift and go to state 177
-    attr_base_type                 shift and go to state 178
-    ns_ref                         shift and go to state 179
+    END             shift and go to state 236
+    DICT            shift and go to state 180
+    ID              shift and go to state 66
 
-state 172
+    attr                           shift and go to state 237
+    attr_type                      shift and go to state 179
+    attr_type_opt                  shift and go to state 181
+    attr_type_multi                shift and go to state 182
+    attr_base_type                 shift and go to state 183
+    ns_ref                         shift and go to state 184
+
+state 177
 
     (37) entity_body_outer -> END .
 
     ENTITY          reduce using rule 37 (entity_body_outer -> END .)
     IMPLEMENT       reduce using rule 37 (entity_body_outer -> END .)
     IMPLEMENTATION  reduce using rule 37 (entity_body_outer -> END .)
     INDEX           reduce using rule 37 (entity_body_outer -> END .)
@@ -6095,46 +6418,47 @@
     INT             reduce using rule 37 (entity_body_outer -> END .)
     FLOAT           reduce using rule 37 (entity_body_outer -> END .)
     NULL            reduce using rule 37 (entity_body_outer -> END .)
     REGEX           reduce using rule 37 (entity_body_outer -> END .)
     TRUE            reduce using rule 37 (entity_body_outer -> END .)
     FALSE           reduce using rule 37 (entity_body_outer -> END .)
     STRING          reduce using rule 37 (entity_body_outer -> END .)
+    FSTRING         reduce using rule 37 (entity_body_outer -> END .)
     RSTRING         reduce using rule 37 (entity_body_outer -> END .)
     MLS             reduce using rule 37 (entity_body_outer -> END .)
     [               reduce using rule 37 (entity_body_outer -> END .)
     {               reduce using rule 37 (entity_body_outer -> END .)
     $end            reduce using rule 37 (entity_body_outer -> END .)
 
 
-state 173
+state 178
 
     (40) entity_body -> attr .
 
     END             reduce using rule 40 (entity_body -> attr .)
     DICT            reduce using rule 40 (entity_body -> attr .)
     ID              reduce using rule 40 (entity_body -> attr .)
 
 
-state 174
+state 179
 
     (48) attr -> attr_type . CID empty
     (49) attr -> attr_type . CID = constant
     (50) attr -> attr_type . CID = constant_list
     (51) attr -> attr_type . CID = UNDEF
     (52) attr -> attr_type . ID
     (53) attr -> attr_type . ID = constant
     (54) attr -> attr_type . ID = constant_list
     (55) attr -> attr_type . ID = UNDEF
 
-    CID             shift and go to state 229
-    ID              shift and go to state 230
+    CID             shift and go to state 238
+    ID              shift and go to state 239
 
 
-state 175
+state 180
 
     (56) attr -> DICT . empty CID empty
     (57) attr -> DICT . empty CID = map_def
     (58) attr -> DICT . empty CID = NULL
     (59) attr -> DICT . ? CID empty
     (60) attr -> DICT . ? CID = map_def
     (61) attr -> DICT . ? CID = NULL
@@ -6142,103 +6466,103 @@
     (63) attr -> DICT . ID = map_def
     (64) attr -> DICT . ID = NULL
     (65) attr -> DICT . ? ID
     (66) attr -> DICT . ? ID = map_def
     (67) attr -> DICT . ? ID = NULL
     (14) empty -> .
 
-    ?               shift and go to state 232
-    ID              shift and go to state 233
+    ?               shift and go to state 241
+    ID              shift and go to state 242
     CID             reduce using rule 14 (empty -> .)
 
-    empty                          shift and go to state 231
+    empty                          shift and go to state 240
 
-state 176
+state 181
 
     (45) attr_type -> attr_type_opt .
 
     CID             reduce using rule 45 (attr_type -> attr_type_opt .)
     ID              reduce using rule 45 (attr_type -> attr_type_opt .)
 
 
-state 177
+state 182
 
     (46) attr_type -> attr_type_multi .
     (43) attr_type_opt -> attr_type_multi . ?
 
     CID             reduce using rule 46 (attr_type -> attr_type_multi .)
     ID              reduce using rule 46 (attr_type -> attr_type_multi .)
-    ?               shift and go to state 234
+    ?               shift and go to state 243
 
 
-state 178
+state 183
 
     (47) attr_type -> attr_base_type .
     (44) attr_type_opt -> attr_base_type . ?
     (42) attr_type_multi -> attr_base_type . [ ]
 
     CID             reduce using rule 47 (attr_type -> attr_base_type .)
     ID              reduce using rule 47 (attr_type -> attr_base_type .)
-    ?               shift and go to state 235
-    [               shift and go to state 236
+    ?               shift and go to state 244
+    [               shift and go to state 245
 
 
-state 179
+state 184
 
     (41) attr_base_type -> ns_ref .
-    (173) ns_ref -> ns_ref . SEP ID
+    (181) ns_ref -> ns_ref . SEP ID
 
     ?               reduce using rule 41 (attr_base_type -> ns_ref .)
     [               reduce using rule 41 (attr_base_type -> ns_ref .)
     CID             reduce using rule 41 (attr_base_type -> ns_ref .)
     ID              reduce using rule 41 (attr_base_type -> ns_ref .)
-    SEP             shift and go to state 141
+    SEP             shift and go to state 143
 
 
-state 180
+state 185
 
     (33) entity_def -> ENTITY CID EXTENDS class_ref_list . : entity_body_outer
 
-    :               shift and go to state 237
+    :               shift and go to state 246
 
 
-state 181
+state 186
 
-    (169) class_ref_list -> class_ref . , class_ref_list
-    (171) class_ref_list -> class_ref .
+    (177) class_ref_list -> class_ref . , class_ref_list
+    (179) class_ref_list -> class_ref .
 
-    ,               shift and go to state 238
-    :               reduce using rule 171 (class_ref_list -> class_ref .)
+    ,               shift and go to state 247
+    :               reduce using rule 179 (class_ref_list -> class_ref .)
 
 
-state 182
+state 187
 
-    (170) class_ref_list -> var_ref . , class_ref_list
-    (172) class_ref_list -> var_ref .
-    (168) class_ref -> var_ref . . CID
-    (164) attr_ref -> var_ref . . ID
-
-    ,               shift and go to state 239
-    :               reduce using rule 172 (class_ref_list -> var_ref .)
-    .               shift and go to state 117
+    (178) class_ref_list -> var_ref . , class_ref_list
+    (180) class_ref_list -> var_ref .
+    (176) class_ref -> var_ref . . CID
+    (172) attr_ref -> var_ref . . ID
+
+    ,               shift and go to state 248
+    :               reduce using rule 180 (class_ref_list -> var_ref .)
+    .               shift and go to state 119
 
 
-state 183
+state 188
 
-    (167) class_ref -> ns_ref . SEP CID
-    (165) var_ref -> ns_ref .
-    (173) ns_ref -> ns_ref . SEP ID
-
-    SEP             shift and go to state 87
-    ,               reduce using rule 165 (var_ref -> ns_ref .)
-    .               reduce using rule 165 (var_ref -> ns_ref .)
-    :               reduce using rule 165 (var_ref -> ns_ref .)
+    (175) class_ref -> ns_ref . SEP CID
+    (173) var_ref -> ns_ref .
+    (181) ns_ref -> ns_ref . SEP ID
+
+    SEP             shift and go to state 89
+    ,               reduce using rule 173 (var_ref -> ns_ref .)
+    .               reduce using rule 173 (var_ref -> ns_ref .)
+    :               reduce using rule 173 (var_ref -> ns_ref .)
 
 
-state 184
+state 189
 
     (32) entity_def -> ENTITY ID : entity_body_outer .
 
     ENTITY          reduce using rule 32 (entity_def -> ENTITY ID : entity_body_outer .)
     IMPLEMENT       reduce using rule 32 (entity_def -> ENTITY ID : entity_body_outer .)
     IMPLEMENTATION  reduce using rule 32 (entity_def -> ENTITY ID : entity_body_outer .)
     INDEX           reduce using rule 32 (entity_def -> ENTITY ID : entity_body_outer .)
@@ -6253,40 +6577,41 @@
     INT             reduce using rule 32 (entity_def -> ENTITY ID : entity_body_outer .)
     FLOAT           reduce using rule 32 (entity_def -> ENTITY ID : entity_body_outer .)
     NULL            reduce using rule 32 (entity_def -> ENTITY ID : entity_body_outer .)
     REGEX           reduce using rule 32 (entity_def -> ENTITY ID : entity_body_outer .)
     TRUE            reduce using rule 32 (entity_def -> ENTITY ID : entity_body_outer .)
     FALSE           reduce using rule 32 (entity_def -> ENTITY ID : entity_body_outer .)
     STRING          reduce using rule 32 (entity_def -> ENTITY ID : entity_body_outer .)
+    FSTRING         reduce using rule 32 (entity_def -> ENTITY ID : entity_body_outer .)
     RSTRING         reduce using rule 32 (entity_def -> ENTITY ID : entity_body_outer .)
     MLS             reduce using rule 32 (entity_def -> ENTITY ID : entity_body_outer .)
     [               reduce using rule 32 (entity_def -> ENTITY ID : entity_body_outer .)
     {               reduce using rule 32 (entity_def -> ENTITY ID : entity_body_outer .)
     $end            reduce using rule 32 (entity_def -> ENTITY ID : entity_body_outer .)
 
 
-state 185
+state 190
 
     (34) entity_def -> ENTITY ID EXTENDS class_ref_list . : entity_body_outer
 
-    :               shift and go to state 240
+    :               shift and go to state 249
 
 
-state 186
+state 191
 
     (71) implement_def -> IMPLEMENT class_ref USING implement_ns_list . empty
     (72) implement_def -> IMPLEMENT class_ref USING implement_ns_list . MLS
     (73) implement_def -> IMPLEMENT class_ref USING implement_ns_list . WHEN expression empty
     (74) implement_def -> IMPLEMENT class_ref USING implement_ns_list . WHEN expression MLS
     (70) implement_ns_list -> implement_ns_list . , implement_ns_list
     (14) empty -> .
 
-    MLS             shift and go to state 242
-    WHEN            shift and go to state 243
-    ,               shift and go to state 244
+    MLS             shift and go to state 251
+    WHEN            shift and go to state 252
+    ,               shift and go to state 253
     ENTITY          reduce using rule 14 (empty -> .)
     IMPLEMENT       reduce using rule 14 (empty -> .)
     IMPLEMENTATION  reduce using rule 14 (empty -> .)
     INDEX           reduce using rule 14 (empty -> .)
     IMPORT          reduce using rule 14 (empty -> .)
     CID             reduce using rule 14 (empty -> .)
     FOR             reduce using rule 14 (empty -> .)
@@ -6298,27 +6623,28 @@
     INT             reduce using rule 14 (empty -> .)
     FLOAT           reduce using rule 14 (empty -> .)
     NULL            reduce using rule 14 (empty -> .)
     REGEX           reduce using rule 14 (empty -> .)
     TRUE            reduce using rule 14 (empty -> .)
     FALSE           reduce using rule 14 (empty -> .)
     STRING          reduce using rule 14 (empty -> .)
+    FSTRING         reduce using rule 14 (empty -> .)
     RSTRING         reduce using rule 14 (empty -> .)
     [               reduce using rule 14 (empty -> .)
     {               reduce using rule 14 (empty -> .)
     $end            reduce using rule 14 (empty -> .)
 
   ! MLS             [ reduce using rule 14 (empty -> .) ]
 
-    empty                          shift and go to state 241
+    empty                          shift and go to state 250
 
-state 187
+state 192
 
     (68) implement_ns_list -> ns_ref .
-    (173) ns_ref -> ns_ref . SEP ID
+    (181) ns_ref -> ns_ref . SEP ID
 
     MLS             reduce using rule 68 (implement_ns_list -> ns_ref .)
     WHEN            reduce using rule 68 (implement_ns_list -> ns_ref .)
     ,               reduce using rule 68 (implement_ns_list -> ns_ref .)
     ENTITY          reduce using rule 68 (implement_ns_list -> ns_ref .)
     IMPLEMENT       reduce using rule 68 (implement_ns_list -> ns_ref .)
     IMPLEMENTATION  reduce using rule 68 (implement_ns_list -> ns_ref .)
@@ -6334,22 +6660,23 @@
     INT             reduce using rule 68 (implement_ns_list -> ns_ref .)
     FLOAT           reduce using rule 68 (implement_ns_list -> ns_ref .)
     NULL            reduce using rule 68 (implement_ns_list -> ns_ref .)
     REGEX           reduce using rule 68 (implement_ns_list -> ns_ref .)
     TRUE            reduce using rule 68 (implement_ns_list -> ns_ref .)
     FALSE           reduce using rule 68 (implement_ns_list -> ns_ref .)
     STRING          reduce using rule 68 (implement_ns_list -> ns_ref .)
+    FSTRING         reduce using rule 68 (implement_ns_list -> ns_ref .)
     RSTRING         reduce using rule 68 (implement_ns_list -> ns_ref .)
     [               reduce using rule 68 (implement_ns_list -> ns_ref .)
     {               reduce using rule 68 (implement_ns_list -> ns_ref .)
     $end            reduce using rule 68 (implement_ns_list -> ns_ref .)
-    SEP             shift and go to state 141
+    SEP             shift and go to state 143
 
 
-state 188
+state 193
 
     (69) implement_ns_list -> PARENTS .
 
     MLS             reduce using rule 69 (implement_ns_list -> PARENTS .)
     WHEN            reduce using rule 69 (implement_ns_list -> PARENTS .)
     ,               reduce using rule 69 (implement_ns_list -> PARENTS .)
     ENTITY          reduce using rule 69 (implement_ns_list -> PARENTS .)
@@ -6367,561 +6694,584 @@
     INT             reduce using rule 69 (implement_ns_list -> PARENTS .)
     FLOAT           reduce using rule 69 (implement_ns_list -> PARENTS .)
     NULL            reduce using rule 69 (implement_ns_list -> PARENTS .)
     REGEX           reduce using rule 69 (implement_ns_list -> PARENTS .)
     TRUE            reduce using rule 69 (implement_ns_list -> PARENTS .)
     FALSE           reduce using rule 69 (implement_ns_list -> PARENTS .)
     STRING          reduce using rule 69 (implement_ns_list -> PARENTS .)
+    FSTRING         reduce using rule 69 (implement_ns_list -> PARENTS .)
     RSTRING         reduce using rule 69 (implement_ns_list -> PARENTS .)
     [               reduce using rule 69 (implement_ns_list -> PARENTS .)
     {               reduce using rule 69 (implement_ns_list -> PARENTS .)
     $end            reduce using rule 69 (implement_ns_list -> PARENTS .)
 
 
-state 189
+state 194
 
-    (164) attr_ref -> var_ref . ID .
+    (172) attr_ref -> var_ref . ID .
 
-    .               reduce using rule 164 (attr_ref -> var_ref . ID .)
-    ,               reduce using rule 164 (attr_ref -> var_ref . ID .)
-    :               reduce using rule 164 (attr_ref -> var_ref . ID .)
+    .               reduce using rule 172 (attr_ref -> var_ref . ID .)
+    ,               reduce using rule 172 (attr_ref -> var_ref . ID .)
+    :               reduce using rule 172 (attr_ref -> var_ref . ID .)
 
 
-state 190
+state 195
 
     (80) relation -> class_ref ID multi REL . multi class_ref ID
     (81) relation -> class_ref ID multi REL . multi class_ref ID MLS
     (88) multi -> . [ INT ]
     (89) multi -> . [ INT : ]
     (90) multi -> . [ INT : INT ]
     (91) multi -> . [ : INT ]
 
-    [               shift and go to state 119
+    [               shift and go to state 121
 
-    multi                          shift and go to state 245
+    multi                          shift and go to state 254
 
-state 191
+state 196
 
     (88) multi -> [ INT . ]
     (89) multi -> [ INT . : ]
     (90) multi -> [ INT . : INT ]
 
-    ]               shift and go to state 246
-    :               shift and go to state 247
+    ]               shift and go to state 255
+    :               shift and go to state 256
 
 
-state 192
+state 197
 
     (91) multi -> [ : . INT ]
 
-    INT             shift and go to state 248
+    INT             shift and go to state 257
 
 
-state 193
+state 198
 
     (84) relation_def -> class_ref . ID multi . REL class_ref . ID multi
     (85) relation_def -> class_ref . ID multi . REL class_ref
     (86) relation_def -> class_ref . ID multi . operand_list class_ref . ID multi
     (87) relation_def -> class_ref . ID multi . operand_list class_ref
-    (160) operand_list -> . operand , operand_list
-    (161) operand_list -> . operand
-    (162) operand_list -> .
-    (116) operand -> . expression
+    (168) operand_list -> . operand , operand_list
+    (169) operand_list -> . operand
+    (170) operand_list -> .
+    (117) operand -> . expression
     (97) expression -> . boolean_expression
     (98) expression -> . constant
     (99) expression -> . function_call
     (100) expression -> . var_ref
     (101) expression -> . constructor
     (102) expression -> . list_def
-    (103) expression -> . map_def
-    (104) expression -> . map_lookup
-    (105) expression -> . index_lookup
-    (106) expression -> . conditional_expression
-    (107) expression -> . ( expression )
-    (108) boolean_expression -> . expression CMP_OP expression
-    (109) boolean_expression -> . expression IN expression
-    (110) boolean_expression -> . expression AND expression
-    (111) boolean_expression -> . expression OR expression
-    (112) boolean_expression -> . NOT expression
-    (113) boolean_expression -> . var_ref . ID IS DEFINED
-    (114) boolean_expression -> . ID IS DEFINED
-    (115) boolean_expression -> . map_lookup IS DEFINED
-    (134) constant -> . INT
-    (135) constant -> . FLOAT
-    (136) constant -> . NULL
-    (137) constant -> . REGEX
-    (138) constant -> . TRUE
-    (139) constant -> . FALSE
-    (140) constant -> . STRING
-    (141) constant -> . RSTRING
-    (142) constant -> . MLS
-    (121) function_call -> . ns_ref ( function_param_list )
-    (122) function_call -> . attr_ref ( function_param_list )
-    (163) var_ref -> . attr_ref
-    (165) var_ref -> . ns_ref
-    (120) constructor -> . class_ref ( param_list )
-    (123) list_def -> . [ operand_list ]
-    (130) map_def -> . { pair_list }
-    (117) map_lookup -> . attr_ref [ operand ]
-    (118) map_lookup -> . var_ref [ operand ]
-    (119) map_lookup -> . map_lookup [ operand ]
-    (131) index_lookup -> . class_ref [ param_list ]
-    (132) index_lookup -> . attr_ref [ param_list ]
-    (133) conditional_expression -> . expression ? expression : expression
-    (173) ns_ref -> . ns_ref SEP ID
-    (174) ns_ref -> . ID
-    (164) attr_ref -> . var_ref . ID
-    (166) class_ref -> . CID
-    (167) class_ref -> . ns_ref SEP CID
-    (168) class_ref -> . var_ref . CID
+    (103) expression -> . list_comprehension
+    (104) expression -> . map_def
+    (105) expression -> . map_lookup
+    (106) expression -> . index_lookup
+    (107) expression -> . conditional_expression
+    (108) expression -> . ( expression )
+    (109) boolean_expression -> . expression CMP_OP expression
+    (110) boolean_expression -> . expression IN expression
+    (111) boolean_expression -> . expression AND expression
+    (112) boolean_expression -> . expression OR expression
+    (113) boolean_expression -> . NOT expression
+    (114) boolean_expression -> . var_ref . ID IS DEFINED
+    (115) boolean_expression -> . ID IS DEFINED
+    (116) boolean_expression -> . map_lookup IS DEFINED
+    (141) constant -> . INT
+    (142) constant -> . FLOAT
+    (143) constant -> . NULL
+    (144) constant -> . REGEX
+    (145) constant -> . TRUE
+    (146) constant -> . FALSE
+    (147) constant -> . STRING
+    (148) constant -> . FSTRING
+    (149) constant -> . RSTRING
+    (150) constant -> . MLS
+    (122) function_call -> . ns_ref ( function_param_list )
+    (123) function_call -> . attr_ref ( function_param_list )
+    (171) var_ref -> . attr_ref
+    (173) var_ref -> . ns_ref
+    (121) constructor -> . class_ref ( param_list )
+    (124) list_def -> . [ operand_list ]
+    (125) list_comprehension -> . [ expression list_comprehension_for list_comprehension_guard ]
+    (137) map_def -> . { pair_list }
+    (118) map_lookup -> . attr_ref [ operand ]
+    (119) map_lookup -> . var_ref [ operand ]
+    (120) map_lookup -> . map_lookup [ operand ]
+    (138) index_lookup -> . class_ref [ param_list ]
+    (139) index_lookup -> . attr_ref [ param_list ]
+    (140) conditional_expression -> . expression ? expression : expression
+    (181) ns_ref -> . ns_ref SEP ID
+    (182) ns_ref -> . ID
+    (172) attr_ref -> . var_ref . ID
+    (174) class_ref -> . CID
+    (175) class_ref -> . ns_ref SEP CID
+    (176) class_ref -> . var_ref . CID
 
-    REL             shift and go to state 249
+    REL             shift and go to state 258
     (               shift and go to state 30
-    NOT             shift and go to state 46
-    ID              shift and go to state 82
-    INT             shift and go to state 47
-    FLOAT           shift and go to state 48
-    NULL            shift and go to state 49
-    REGEX           shift and go to state 50
-    TRUE            shift and go to state 51
-    FALSE           shift and go to state 52
-    STRING          shift and go to state 53
-    RSTRING         shift and go to state 54
+    NOT             shift and go to state 47
+    ID              shift and go to state 84
+    INT             shift and go to state 48
+    FLOAT           shift and go to state 49
+    NULL            shift and go to state 50
+    REGEX           shift and go to state 51
+    TRUE            shift and go to state 52
+    FALSE           shift and go to state 53
+    STRING          shift and go to state 54
+    FSTRING         shift and go to state 55
+    RSTRING         shift and go to state 56
     MLS             shift and go to state 20
-    [               shift and go to state 55
-    {               shift and go to state 56
+    [               shift and go to state 57
+    {               shift and go to state 58
     CID             shift and go to state 16
 
-  ! CID             [ reduce using rule 162 (operand_list -> .) ]
-  ! ID              [ reduce using rule 162 (operand_list -> .) ]
+  ! CID             [ reduce using rule 170 (operand_list -> .) ]
+  ! ID              [ reduce using rule 170 (operand_list -> .) ]
 
-    class_ref                      shift and go to state 85
-    operand_list                   shift and go to state 250
-    operand                        shift and go to state 103
-    expression                     shift and go to state 104
+    class_ref                      shift and go to state 87
+    operand_list                   shift and go to state 259
+    operand                        shift and go to state 106
+    expression                     shift and go to state 153
     boolean_expression             shift and go to state 35
     constant                       shift and go to state 36
     function_call                  shift and go to state 37
-    var_ref                        shift and go to state 81
+    var_ref                        shift and go to state 83
     constructor                    shift and go to state 38
     list_def                       shift and go to state 39
-    map_def                        shift and go to state 40
-    map_lookup                     shift and go to state 41
-    index_lookup                   shift and go to state 42
-    conditional_expression         shift and go to state 43
-    ns_ref                         shift and go to state 83
-    attr_ref                       shift and go to state 84
+    list_comprehension             shift and go to state 40
+    map_def                        shift and go to state 41
+    map_lookup                     shift and go to state 42
+    index_lookup                   shift and go to state 43
+    conditional_expression         shift and go to state 44
+    ns_ref                         shift and go to state 85
+    attr_ref                       shift and go to state 86
 
-state 194
+state 199
 
-    (120) constructor -> class_ref ( param_list ) .
+    (121) constructor -> class_ref ( param_list ) .
 
-    CMP_OP          reduce using rule 120 (constructor -> class_ref ( param_list ) .)
-    IN              reduce using rule 120 (constructor -> class_ref ( param_list ) .)
-    AND             reduce using rule 120 (constructor -> class_ref ( param_list ) .)
-    OR              reduce using rule 120 (constructor -> class_ref ( param_list ) .)
-    ?               reduce using rule 120 (constructor -> class_ref ( param_list ) .)
-    ENTITY          reduce using rule 120 (constructor -> class_ref ( param_list ) .)
-    IMPLEMENT       reduce using rule 120 (constructor -> class_ref ( param_list ) .)
-    IMPLEMENTATION  reduce using rule 120 (constructor -> class_ref ( param_list ) .)
-    INDEX           reduce using rule 120 (constructor -> class_ref ( param_list ) .)
-    IMPORT          reduce using rule 120 (constructor -> class_ref ( param_list ) .)
-    CID             reduce using rule 120 (constructor -> class_ref ( param_list ) .)
-    FOR             reduce using rule 120 (constructor -> class_ref ( param_list ) .)
-    IF              reduce using rule 120 (constructor -> class_ref ( param_list ) .)
-    (               reduce using rule 120 (constructor -> class_ref ( param_list ) .)
-    TYPEDEF         reduce using rule 120 (constructor -> class_ref ( param_list ) .)
-    ID              reduce using rule 120 (constructor -> class_ref ( param_list ) .)
-    NOT             reduce using rule 120 (constructor -> class_ref ( param_list ) .)
-    INT             reduce using rule 120 (constructor -> class_ref ( param_list ) .)
-    FLOAT           reduce using rule 120 (constructor -> class_ref ( param_list ) .)
-    NULL            reduce using rule 120 (constructor -> class_ref ( param_list ) .)
-    REGEX           reduce using rule 120 (constructor -> class_ref ( param_list ) .)
-    TRUE            reduce using rule 120 (constructor -> class_ref ( param_list ) .)
-    FALSE           reduce using rule 120 (constructor -> class_ref ( param_list ) .)
-    STRING          reduce using rule 120 (constructor -> class_ref ( param_list ) .)
-    RSTRING         reduce using rule 120 (constructor -> class_ref ( param_list ) .)
-    MLS             reduce using rule 120 (constructor -> class_ref ( param_list ) .)
-    [               reduce using rule 120 (constructor -> class_ref ( param_list ) .)
-    {               reduce using rule 120 (constructor -> class_ref ( param_list ) .)
-    $end            reduce using rule 120 (constructor -> class_ref ( param_list ) .)
-    )               reduce using rule 120 (constructor -> class_ref ( param_list ) .)
-    :               reduce using rule 120 (constructor -> class_ref ( param_list ) .)
-    ,               reduce using rule 120 (constructor -> class_ref ( param_list ) .)
-    ]               reduce using rule 120 (constructor -> class_ref ( param_list ) .)
-    ELSE            reduce using rule 120 (constructor -> class_ref ( param_list ) .)
-    ELIF            reduce using rule 120 (constructor -> class_ref ( param_list ) .)
-    END             reduce using rule 120 (constructor -> class_ref ( param_list ) .)
-    }               reduce using rule 120 (constructor -> class_ref ( param_list ) .)
+    CMP_OP          reduce using rule 121 (constructor -> class_ref ( param_list ) .)
+    IN              reduce using rule 121 (constructor -> class_ref ( param_list ) .)
+    AND             reduce using rule 121 (constructor -> class_ref ( param_list ) .)
+    OR              reduce using rule 121 (constructor -> class_ref ( param_list ) .)
+    ?               reduce using rule 121 (constructor -> class_ref ( param_list ) .)
+    ENTITY          reduce using rule 121 (constructor -> class_ref ( param_list ) .)
+    IMPLEMENT       reduce using rule 121 (constructor -> class_ref ( param_list ) .)
+    IMPLEMENTATION  reduce using rule 121 (constructor -> class_ref ( param_list ) .)
+    INDEX           reduce using rule 121 (constructor -> class_ref ( param_list ) .)
+    IMPORT          reduce using rule 121 (constructor -> class_ref ( param_list ) .)
+    CID             reduce using rule 121 (constructor -> class_ref ( param_list ) .)
+    FOR             reduce using rule 121 (constructor -> class_ref ( param_list ) .)
+    IF              reduce using rule 121 (constructor -> class_ref ( param_list ) .)
+    (               reduce using rule 121 (constructor -> class_ref ( param_list ) .)
+    TYPEDEF         reduce using rule 121 (constructor -> class_ref ( param_list ) .)
+    ID              reduce using rule 121 (constructor -> class_ref ( param_list ) .)
+    NOT             reduce using rule 121 (constructor -> class_ref ( param_list ) .)
+    INT             reduce using rule 121 (constructor -> class_ref ( param_list ) .)
+    FLOAT           reduce using rule 121 (constructor -> class_ref ( param_list ) .)
+    NULL            reduce using rule 121 (constructor -> class_ref ( param_list ) .)
+    REGEX           reduce using rule 121 (constructor -> class_ref ( param_list ) .)
+    TRUE            reduce using rule 121 (constructor -> class_ref ( param_list ) .)
+    FALSE           reduce using rule 121 (constructor -> class_ref ( param_list ) .)
+    STRING          reduce using rule 121 (constructor -> class_ref ( param_list ) .)
+    FSTRING         reduce using rule 121 (constructor -> class_ref ( param_list ) .)
+    RSTRING         reduce using rule 121 (constructor -> class_ref ( param_list ) .)
+    MLS             reduce using rule 121 (constructor -> class_ref ( param_list ) .)
+    [               reduce using rule 121 (constructor -> class_ref ( param_list ) .)
+    {               reduce using rule 121 (constructor -> class_ref ( param_list ) .)
+    $end            reduce using rule 121 (constructor -> class_ref ( param_list ) .)
+    )               reduce using rule 121 (constructor -> class_ref ( param_list ) .)
+    :               reduce using rule 121 (constructor -> class_ref ( param_list ) .)
+    ,               reduce using rule 121 (constructor -> class_ref ( param_list ) .)
+    ]               reduce using rule 121 (constructor -> class_ref ( param_list ) .)
+    ELSE            reduce using rule 121 (constructor -> class_ref ( param_list ) .)
+    ELIF            reduce using rule 121 (constructor -> class_ref ( param_list ) .)
+    END             reduce using rule 121 (constructor -> class_ref ( param_list ) .)
+    }               reduce using rule 121 (constructor -> class_ref ( param_list ) .)
 
 
-state 195
+state 200
 
-    (152) param_list -> param_list_element empty . param_list_empty
-    (151) param_list_empty -> . empty
+    (160) param_list -> param_list_element empty . param_list_empty
+    (159) param_list_empty -> . empty
     (14) empty -> .
 
     )               reduce using rule 14 (empty -> .)
     ]               reduce using rule 14 (empty -> .)
 
-    empty                          shift and go to state 124
-    param_list_empty               shift and go to state 251
+    empty                          shift and go to state 126
+    param_list_empty               shift and go to state 260
 
-state 196
+state 201
 
-    (153) param_list -> param_list_element , . param_list
-    (150) param_list -> . param_list_empty
-    (152) param_list -> . param_list_element empty param_list_empty
-    (153) param_list -> . param_list_element , param_list
-    (151) param_list_empty -> . empty
-    (148) param_list_element -> . ID = operand
-    (149) param_list_element -> . wrapped_kwargs
+    (161) param_list -> param_list_element , . param_list
+    (158) param_list -> . param_list_empty
+    (160) param_list -> . param_list_element empty param_list_empty
+    (161) param_list -> . param_list_element , param_list
+    (159) param_list_empty -> . empty
+    (156) param_list_element -> . ID = operand
+    (157) param_list_element -> . wrapped_kwargs
     (14) empty -> .
-    (147) wrapped_kwargs -> . * * operand
+    (155) wrapped_kwargs -> . * * operand
 
-    ID              shift and go to state 125
+    ID              shift and go to state 127
     )               reduce using rule 14 (empty -> .)
     ]               reduce using rule 14 (empty -> .)
-    *               shift and go to state 127
+    *               shift and go to state 129
 
-    param_list_element             shift and go to state 123
-    param_list                     shift and go to state 252
-    param_list_empty               shift and go to state 122
-    empty                          shift and go to state 124
-    wrapped_kwargs                 shift and go to state 126
+    param_list_element             shift and go to state 125
+    param_list                     shift and go to state 261
+    param_list_empty               shift and go to state 124
+    empty                          shift and go to state 126
+    wrapped_kwargs                 shift and go to state 128
 
-state 197
+state 202
 
-    (148) param_list_element -> ID = . operand
-    (116) operand -> . expression
+    (156) param_list_element -> ID = . operand
+    (117) operand -> . expression
     (97) expression -> . boolean_expression
     (98) expression -> . constant
     (99) expression -> . function_call
     (100) expression -> . var_ref
     (101) expression -> . constructor
     (102) expression -> . list_def
-    (103) expression -> . map_def
-    (104) expression -> . map_lookup
-    (105) expression -> . index_lookup
-    (106) expression -> . conditional_expression
-    (107) expression -> . ( expression )
-    (108) boolean_expression -> . expression CMP_OP expression
-    (109) boolean_expression -> . expression IN expression
-    (110) boolean_expression -> . expression AND expression
-    (111) boolean_expression -> . expression OR expression
-    (112) boolean_expression -> . NOT expression
-    (113) boolean_expression -> . var_ref . ID IS DEFINED
-    (114) boolean_expression -> . ID IS DEFINED
-    (115) boolean_expression -> . map_lookup IS DEFINED
-    (134) constant -> . INT
-    (135) constant -> . FLOAT
-    (136) constant -> . NULL
-    (137) constant -> . REGEX
-    (138) constant -> . TRUE
-    (139) constant -> . FALSE
-    (140) constant -> . STRING
-    (141) constant -> . RSTRING
-    (142) constant -> . MLS
-    (121) function_call -> . ns_ref ( function_param_list )
-    (122) function_call -> . attr_ref ( function_param_list )
-    (163) var_ref -> . attr_ref
-    (165) var_ref -> . ns_ref
-    (120) constructor -> . class_ref ( param_list )
-    (123) list_def -> . [ operand_list ]
-    (130) map_def -> . { pair_list }
-    (117) map_lookup -> . attr_ref [ operand ]
-    (118) map_lookup -> . var_ref [ operand ]
-    (119) map_lookup -> . map_lookup [ operand ]
-    (131) index_lookup -> . class_ref [ param_list ]
-    (132) index_lookup -> . attr_ref [ param_list ]
-    (133) conditional_expression -> . expression ? expression : expression
-    (173) ns_ref -> . ns_ref SEP ID
-    (174) ns_ref -> . ID
-    (164) attr_ref -> . var_ref . ID
-    (166) class_ref -> . CID
-    (167) class_ref -> . ns_ref SEP CID
-    (168) class_ref -> . var_ref . CID
+    (103) expression -> . list_comprehension
+    (104) expression -> . map_def
+    (105) expression -> . map_lookup
+    (106) expression -> . index_lookup
+    (107) expression -> . conditional_expression
+    (108) expression -> . ( expression )
+    (109) boolean_expression -> . expression CMP_OP expression
+    (110) boolean_expression -> . expression IN expression
+    (111) boolean_expression -> . expression AND expression
+    (112) boolean_expression -> . expression OR expression
+    (113) boolean_expression -> . NOT expression
+    (114) boolean_expression -> . var_ref . ID IS DEFINED
+    (115) boolean_expression -> . ID IS DEFINED
+    (116) boolean_expression -> . map_lookup IS DEFINED
+    (141) constant -> . INT
+    (142) constant -> . FLOAT
+    (143) constant -> . NULL
+    (144) constant -> . REGEX
+    (145) constant -> . TRUE
+    (146) constant -> . FALSE
+    (147) constant -> . STRING
+    (148) constant -> . FSTRING
+    (149) constant -> . RSTRING
+    (150) constant -> . MLS
+    (122) function_call -> . ns_ref ( function_param_list )
+    (123) function_call -> . attr_ref ( function_param_list )
+    (171) var_ref -> . attr_ref
+    (173) var_ref -> . ns_ref
+    (121) constructor -> . class_ref ( param_list )
+    (124) list_def -> . [ operand_list ]
+    (125) list_comprehension -> . [ expression list_comprehension_for list_comprehension_guard ]
+    (137) map_def -> . { pair_list }
+    (118) map_lookup -> . attr_ref [ operand ]
+    (119) map_lookup -> . var_ref [ operand ]
+    (120) map_lookup -> . map_lookup [ operand ]
+    (138) index_lookup -> . class_ref [ param_list ]
+    (139) index_lookup -> . attr_ref [ param_list ]
+    (140) conditional_expression -> . expression ? expression : expression
+    (181) ns_ref -> . ns_ref SEP ID
+    (182) ns_ref -> . ID
+    (172) attr_ref -> . var_ref . ID
+    (174) class_ref -> . CID
+    (175) class_ref -> . ns_ref SEP CID
+    (176) class_ref -> . var_ref . CID
 
     (               shift and go to state 30
-    NOT             shift and go to state 46
-    ID              shift and go to state 82
-    INT             shift and go to state 47
-    FLOAT           shift and go to state 48
-    NULL            shift and go to state 49
-    REGEX           shift and go to state 50
-    TRUE            shift and go to state 51
-    FALSE           shift and go to state 52
-    STRING          shift and go to state 53
-    RSTRING         shift and go to state 54
+    NOT             shift and go to state 47
+    ID              shift and go to state 84
+    INT             shift and go to state 48
+    FLOAT           shift and go to state 49
+    NULL            shift and go to state 50
+    REGEX           shift and go to state 51
+    TRUE            shift and go to state 52
+    FALSE           shift and go to state 53
+    STRING          shift and go to state 54
+    FSTRING         shift and go to state 55
+    RSTRING         shift and go to state 56
     MLS             shift and go to state 20
-    [               shift and go to state 55
-    {               shift and go to state 56
+    [               shift and go to state 57
+    {               shift and go to state 58
     CID             shift and go to state 16
 
-    operand                        shift and go to state 253
-    expression                     shift and go to state 104
+    operand                        shift and go to state 262
+    expression                     shift and go to state 153
     boolean_expression             shift and go to state 35
     constant                       shift and go to state 36
     function_call                  shift and go to state 37
-    var_ref                        shift and go to state 81
+    var_ref                        shift and go to state 83
     constructor                    shift and go to state 38
     list_def                       shift and go to state 39
-    map_def                        shift and go to state 40
-    map_lookup                     shift and go to state 41
-    index_lookup                   shift and go to state 42
-    conditional_expression         shift and go to state 43
-    ns_ref                         shift and go to state 83
-    attr_ref                       shift and go to state 84
-    class_ref                      shift and go to state 85
+    list_comprehension             shift and go to state 40
+    map_def                        shift and go to state 41
+    map_lookup                     shift and go to state 42
+    index_lookup                   shift and go to state 43
+    conditional_expression         shift and go to state 44
+    ns_ref                         shift and go to state 85
+    attr_ref                       shift and go to state 86
+    class_ref                      shift and go to state 87
 
-state 198
+state 203
 
-    (147) wrapped_kwargs -> * * . operand
-    (116) operand -> . expression
+    (155) wrapped_kwargs -> * * . operand
+    (117) operand -> . expression
     (97) expression -> . boolean_expression
     (98) expression -> . constant
     (99) expression -> . function_call
     (100) expression -> . var_ref
     (101) expression -> . constructor
     (102) expression -> . list_def
-    (103) expression -> . map_def
-    (104) expression -> . map_lookup
-    (105) expression -> . index_lookup
-    (106) expression -> . conditional_expression
-    (107) expression -> . ( expression )
-    (108) boolean_expression -> . expression CMP_OP expression
-    (109) boolean_expression -> . expression IN expression
-    (110) boolean_expression -> . expression AND expression
-    (111) boolean_expression -> . expression OR expression
-    (112) boolean_expression -> . NOT expression
-    (113) boolean_expression -> . var_ref . ID IS DEFINED
-    (114) boolean_expression -> . ID IS DEFINED
-    (115) boolean_expression -> . map_lookup IS DEFINED
-    (134) constant -> . INT
-    (135) constant -> . FLOAT
-    (136) constant -> . NULL
-    (137) constant -> . REGEX
-    (138) constant -> . TRUE
-    (139) constant -> . FALSE
-    (140) constant -> . STRING
-    (141) constant -> . RSTRING
-    (142) constant -> . MLS
-    (121) function_call -> . ns_ref ( function_param_list )
-    (122) function_call -> . attr_ref ( function_param_list )
-    (163) var_ref -> . attr_ref
-    (165) var_ref -> . ns_ref
-    (120) constructor -> . class_ref ( param_list )
-    (123) list_def -> . [ operand_list ]
-    (130) map_def -> . { pair_list }
-    (117) map_lookup -> . attr_ref [ operand ]
-    (118) map_lookup -> . var_ref [ operand ]
-    (119) map_lookup -> . map_lookup [ operand ]
-    (131) index_lookup -> . class_ref [ param_list ]
-    (132) index_lookup -> . attr_ref [ param_list ]
-    (133) conditional_expression -> . expression ? expression : expression
-    (173) ns_ref -> . ns_ref SEP ID
-    (174) ns_ref -> . ID
-    (164) attr_ref -> . var_ref . ID
-    (166) class_ref -> . CID
-    (167) class_ref -> . ns_ref SEP CID
-    (168) class_ref -> . var_ref . CID
+    (103) expression -> . list_comprehension
+    (104) expression -> . map_def
+    (105) expression -> . map_lookup
+    (106) expression -> . index_lookup
+    (107) expression -> . conditional_expression
+    (108) expression -> . ( expression )
+    (109) boolean_expression -> . expression CMP_OP expression
+    (110) boolean_expression -> . expression IN expression
+    (111) boolean_expression -> . expression AND expression
+    (112) boolean_expression -> . expression OR expression
+    (113) boolean_expression -> . NOT expression
+    (114) boolean_expression -> . var_ref . ID IS DEFINED
+    (115) boolean_expression -> . ID IS DEFINED
+    (116) boolean_expression -> . map_lookup IS DEFINED
+    (141) constant -> . INT
+    (142) constant -> . FLOAT
+    (143) constant -> . NULL
+    (144) constant -> . REGEX
+    (145) constant -> . TRUE
+    (146) constant -> . FALSE
+    (147) constant -> . STRING
+    (148) constant -> . FSTRING
+    (149) constant -> . RSTRING
+    (150) constant -> . MLS
+    (122) function_call -> . ns_ref ( function_param_list )
+    (123) function_call -> . attr_ref ( function_param_list )
+    (171) var_ref -> . attr_ref
+    (173) var_ref -> . ns_ref
+    (121) constructor -> . class_ref ( param_list )
+    (124) list_def -> . [ operand_list ]
+    (125) list_comprehension -> . [ expression list_comprehension_for list_comprehension_guard ]
+    (137) map_def -> . { pair_list }
+    (118) map_lookup -> . attr_ref [ operand ]
+    (119) map_lookup -> . var_ref [ operand ]
+    (120) map_lookup -> . map_lookup [ operand ]
+    (138) index_lookup -> . class_ref [ param_list ]
+    (139) index_lookup -> . attr_ref [ param_list ]
+    (140) conditional_expression -> . expression ? expression : expression
+    (181) ns_ref -> . ns_ref SEP ID
+    (182) ns_ref -> . ID
+    (172) attr_ref -> . var_ref . ID
+    (174) class_ref -> . CID
+    (175) class_ref -> . ns_ref SEP CID
+    (176) class_ref -> . var_ref . CID
 
     (               shift and go to state 30
-    NOT             shift and go to state 46
-    ID              shift and go to state 82
-    INT             shift and go to state 47
-    FLOAT           shift and go to state 48
-    NULL            shift and go to state 49
-    REGEX           shift and go to state 50
-    TRUE            shift and go to state 51
-    FALSE           shift and go to state 52
-    STRING          shift and go to state 53
-    RSTRING         shift and go to state 54
+    NOT             shift and go to state 47
+    ID              shift and go to state 84
+    INT             shift and go to state 48
+    FLOAT           shift and go to state 49
+    NULL            shift and go to state 50
+    REGEX           shift and go to state 51
+    TRUE            shift and go to state 52
+    FALSE           shift and go to state 53
+    STRING          shift and go to state 54
+    FSTRING         shift and go to state 55
+    RSTRING         shift and go to state 56
     MLS             shift and go to state 20
-    [               shift and go to state 55
-    {               shift and go to state 56
+    [               shift and go to state 57
+    {               shift and go to state 58
     CID             shift and go to state 16
 
-    operand                        shift and go to state 254
-    expression                     shift and go to state 104
+    operand                        shift and go to state 263
+    expression                     shift and go to state 153
     boolean_expression             shift and go to state 35
     constant                       shift and go to state 36
     function_call                  shift and go to state 37
-    var_ref                        shift and go to state 81
+    var_ref                        shift and go to state 83
     constructor                    shift and go to state 38
     list_def                       shift and go to state 39
-    map_def                        shift and go to state 40
-    map_lookup                     shift and go to state 41
-    index_lookup                   shift and go to state 42
-    conditional_expression         shift and go to state 43
-    ns_ref                         shift and go to state 83
-    attr_ref                       shift and go to state 84
-    class_ref                      shift and go to state 85
+    list_comprehension             shift and go to state 40
+    map_def                        shift and go to state 41
+    map_lookup                     shift and go to state 42
+    index_lookup                   shift and go to state 43
+    conditional_expression         shift and go to state 44
+    ns_ref                         shift and go to state 85
+    attr_ref                       shift and go to state 86
+    class_ref                      shift and go to state 87
 
-state 199
+state 204
 
-    (131) index_lookup -> class_ref [ param_list ] .
+    (138) index_lookup -> class_ref [ param_list ] .
 
-    CMP_OP          reduce using rule 131 (index_lookup -> class_ref [ param_list ] .)
-    IN              reduce using rule 131 (index_lookup -> class_ref [ param_list ] .)
-    AND             reduce using rule 131 (index_lookup -> class_ref [ param_list ] .)
-    OR              reduce using rule 131 (index_lookup -> class_ref [ param_list ] .)
-    ?               reduce using rule 131 (index_lookup -> class_ref [ param_list ] .)
-    ENTITY          reduce using rule 131 (index_lookup -> class_ref [ param_list ] .)
-    IMPLEMENT       reduce using rule 131 (index_lookup -> class_ref [ param_list ] .)
-    IMPLEMENTATION  reduce using rule 131 (index_lookup -> class_ref [ param_list ] .)
-    INDEX           reduce using rule 131 (index_lookup -> class_ref [ param_list ] .)
-    IMPORT          reduce using rule 131 (index_lookup -> class_ref [ param_list ] .)
-    CID             reduce using rule 131 (index_lookup -> class_ref [ param_list ] .)
-    FOR             reduce using rule 131 (index_lookup -> class_ref [ param_list ] .)
-    IF              reduce using rule 131 (index_lookup -> class_ref [ param_list ] .)
-    (               reduce using rule 131 (index_lookup -> class_ref [ param_list ] .)
-    TYPEDEF         reduce using rule 131 (index_lookup -> class_ref [ param_list ] .)
-    ID              reduce using rule 131 (index_lookup -> class_ref [ param_list ] .)
-    NOT             reduce using rule 131 (index_lookup -> class_ref [ param_list ] .)
-    INT             reduce using rule 131 (index_lookup -> class_ref [ param_list ] .)
-    FLOAT           reduce using rule 131 (index_lookup -> class_ref [ param_list ] .)
-    NULL            reduce using rule 131 (index_lookup -> class_ref [ param_list ] .)
-    REGEX           reduce using rule 131 (index_lookup -> class_ref [ param_list ] .)
-    TRUE            reduce using rule 131 (index_lookup -> class_ref [ param_list ] .)
-    FALSE           reduce using rule 131 (index_lookup -> class_ref [ param_list ] .)
-    STRING          reduce using rule 131 (index_lookup -> class_ref [ param_list ] .)
-    RSTRING         reduce using rule 131 (index_lookup -> class_ref [ param_list ] .)
-    MLS             reduce using rule 131 (index_lookup -> class_ref [ param_list ] .)
-    [               reduce using rule 131 (index_lookup -> class_ref [ param_list ] .)
-    {               reduce using rule 131 (index_lookup -> class_ref [ param_list ] .)
-    $end            reduce using rule 131 (index_lookup -> class_ref [ param_list ] .)
-    )               reduce using rule 131 (index_lookup -> class_ref [ param_list ] .)
-    :               reduce using rule 131 (index_lookup -> class_ref [ param_list ] .)
-    ,               reduce using rule 131 (index_lookup -> class_ref [ param_list ] .)
-    ]               reduce using rule 131 (index_lookup -> class_ref [ param_list ] .)
-    ELSE            reduce using rule 131 (index_lookup -> class_ref [ param_list ] .)
-    ELIF            reduce using rule 131 (index_lookup -> class_ref [ param_list ] .)
-    END             reduce using rule 131 (index_lookup -> class_ref [ param_list ] .)
-    }               reduce using rule 131 (index_lookup -> class_ref [ param_list ] .)
+    CMP_OP          reduce using rule 138 (index_lookup -> class_ref [ param_list ] .)
+    IN              reduce using rule 138 (index_lookup -> class_ref [ param_list ] .)
+    AND             reduce using rule 138 (index_lookup -> class_ref [ param_list ] .)
+    OR              reduce using rule 138 (index_lookup -> class_ref [ param_list ] .)
+    ?               reduce using rule 138 (index_lookup -> class_ref [ param_list ] .)
+    ENTITY          reduce using rule 138 (index_lookup -> class_ref [ param_list ] .)
+    IMPLEMENT       reduce using rule 138 (index_lookup -> class_ref [ param_list ] .)
+    IMPLEMENTATION  reduce using rule 138 (index_lookup -> class_ref [ param_list ] .)
+    INDEX           reduce using rule 138 (index_lookup -> class_ref [ param_list ] .)
+    IMPORT          reduce using rule 138 (index_lookup -> class_ref [ param_list ] .)
+    CID             reduce using rule 138 (index_lookup -> class_ref [ param_list ] .)
+    FOR             reduce using rule 138 (index_lookup -> class_ref [ param_list ] .)
+    IF              reduce using rule 138 (index_lookup -> class_ref [ param_list ] .)
+    (               reduce using rule 138 (index_lookup -> class_ref [ param_list ] .)
+    TYPEDEF         reduce using rule 138 (index_lookup -> class_ref [ param_list ] .)
+    ID              reduce using rule 138 (index_lookup -> class_ref [ param_list ] .)
+    NOT             reduce using rule 138 (index_lookup -> class_ref [ param_list ] .)
+    INT             reduce using rule 138 (index_lookup -> class_ref [ param_list ] .)
+    FLOAT           reduce using rule 138 (index_lookup -> class_ref [ param_list ] .)
+    NULL            reduce using rule 138 (index_lookup -> class_ref [ param_list ] .)
+    REGEX           reduce using rule 138 (index_lookup -> class_ref [ param_list ] .)
+    TRUE            reduce using rule 138 (index_lookup -> class_ref [ param_list ] .)
+    FALSE           reduce using rule 138 (index_lookup -> class_ref [ param_list ] .)
+    STRING          reduce using rule 138 (index_lookup -> class_ref [ param_list ] .)
+    FSTRING         reduce using rule 138 (index_lookup -> class_ref [ param_list ] .)
+    RSTRING         reduce using rule 138 (index_lookup -> class_ref [ param_list ] .)
+    MLS             reduce using rule 138 (index_lookup -> class_ref [ param_list ] .)
+    [               reduce using rule 138 (index_lookup -> class_ref [ param_list ] .)
+    {               reduce using rule 138 (index_lookup -> class_ref [ param_list ] .)
+    $end            reduce using rule 138 (index_lookup -> class_ref [ param_list ] .)
+    )               reduce using rule 138 (index_lookup -> class_ref [ param_list ] .)
+    :               reduce using rule 138 (index_lookup -> class_ref [ param_list ] .)
+    ,               reduce using rule 138 (index_lookup -> class_ref [ param_list ] .)
+    ]               reduce using rule 138 (index_lookup -> class_ref [ param_list ] .)
+    ELSE            reduce using rule 138 (index_lookup -> class_ref [ param_list ] .)
+    ELIF            reduce using rule 138 (index_lookup -> class_ref [ param_list ] .)
+    END             reduce using rule 138 (index_lookup -> class_ref [ param_list ] .)
+    }               reduce using rule 138 (index_lookup -> class_ref [ param_list ] .)
 
 
-state 200
+state 205
 
-    (133) conditional_expression -> expression ? expression : . expression
+    (140) conditional_expression -> expression ? expression : . expression
     (97) expression -> . boolean_expression
     (98) expression -> . constant
     (99) expression -> . function_call
     (100) expression -> . var_ref
     (101) expression -> . constructor
     (102) expression -> . list_def
-    (103) expression -> . map_def
-    (104) expression -> . map_lookup
-    (105) expression -> . index_lookup
-    (106) expression -> . conditional_expression
-    (107) expression -> . ( expression )
-    (108) boolean_expression -> . expression CMP_OP expression
-    (109) boolean_expression -> . expression IN expression
-    (110) boolean_expression -> . expression AND expression
-    (111) boolean_expression -> . expression OR expression
-    (112) boolean_expression -> . NOT expression
-    (113) boolean_expression -> . var_ref . ID IS DEFINED
-    (114) boolean_expression -> . ID IS DEFINED
-    (115) boolean_expression -> . map_lookup IS DEFINED
-    (134) constant -> . INT
-    (135) constant -> . FLOAT
-    (136) constant -> . NULL
-    (137) constant -> . REGEX
-    (138) constant -> . TRUE
-    (139) constant -> . FALSE
-    (140) constant -> . STRING
-    (141) constant -> . RSTRING
-    (142) constant -> . MLS
-    (121) function_call -> . ns_ref ( function_param_list )
-    (122) function_call -> . attr_ref ( function_param_list )
-    (163) var_ref -> . attr_ref
-    (165) var_ref -> . ns_ref
-    (120) constructor -> . class_ref ( param_list )
-    (123) list_def -> . [ operand_list ]
-    (130) map_def -> . { pair_list }
-    (117) map_lookup -> . attr_ref [ operand ]
-    (118) map_lookup -> . var_ref [ operand ]
-    (119) map_lookup -> . map_lookup [ operand ]
-    (131) index_lookup -> . class_ref [ param_list ]
-    (132) index_lookup -> . attr_ref [ param_list ]
-    (133) conditional_expression -> . expression ? expression : expression
-    (173) ns_ref -> . ns_ref SEP ID
-    (174) ns_ref -> . ID
-    (164) attr_ref -> . var_ref . ID
-    (166) class_ref -> . CID
-    (167) class_ref -> . ns_ref SEP CID
-    (168) class_ref -> . var_ref . CID
+    (103) expression -> . list_comprehension
+    (104) expression -> . map_def
+    (105) expression -> . map_lookup
+    (106) expression -> . index_lookup
+    (107) expression -> . conditional_expression
+    (108) expression -> . ( expression )
+    (109) boolean_expression -> . expression CMP_OP expression
+    (110) boolean_expression -> . expression IN expression
+    (111) boolean_expression -> . expression AND expression
+    (112) boolean_expression -> . expression OR expression
+    (113) boolean_expression -> . NOT expression
+    (114) boolean_expression -> . var_ref . ID IS DEFINED
+    (115) boolean_expression -> . ID IS DEFINED
+    (116) boolean_expression -> . map_lookup IS DEFINED
+    (141) constant -> . INT
+    (142) constant -> . FLOAT
+    (143) constant -> . NULL
+    (144) constant -> . REGEX
+    (145) constant -> . TRUE
+    (146) constant -> . FALSE
+    (147) constant -> . STRING
+    (148) constant -> . FSTRING
+    (149) constant -> . RSTRING
+    (150) constant -> . MLS
+    (122) function_call -> . ns_ref ( function_param_list )
+    (123) function_call -> . attr_ref ( function_param_list )
+    (171) var_ref -> . attr_ref
+    (173) var_ref -> . ns_ref
+    (121) constructor -> . class_ref ( param_list )
+    (124) list_def -> . [ operand_list ]
+    (125) list_comprehension -> . [ expression list_comprehension_for list_comprehension_guard ]
+    (137) map_def -> . { pair_list }
+    (118) map_lookup -> . attr_ref [ operand ]
+    (119) map_lookup -> . var_ref [ operand ]
+    (120) map_lookup -> . map_lookup [ operand ]
+    (138) index_lookup -> . class_ref [ param_list ]
+    (139) index_lookup -> . attr_ref [ param_list ]
+    (140) conditional_expression -> . expression ? expression : expression
+    (181) ns_ref -> . ns_ref SEP ID
+    (182) ns_ref -> . ID
+    (172) attr_ref -> . var_ref . ID
+    (174) class_ref -> . CID
+    (175) class_ref -> . ns_ref SEP CID
+    (176) class_ref -> . var_ref . CID
 
     (               shift and go to state 30
-    NOT             shift and go to state 46
-    ID              shift and go to state 82
-    INT             shift and go to state 47
-    FLOAT           shift and go to state 48
-    NULL            shift and go to state 49
-    REGEX           shift and go to state 50
-    TRUE            shift and go to state 51
-    FALSE           shift and go to state 52
-    STRING          shift and go to state 53
-    RSTRING         shift and go to state 54
+    NOT             shift and go to state 47
+    ID              shift and go to state 84
+    INT             shift and go to state 48
+    FLOAT           shift and go to state 49
+    NULL            shift and go to state 50
+    REGEX           shift and go to state 51
+    TRUE            shift and go to state 52
+    FALSE           shift and go to state 53
+    STRING          shift and go to state 54
+    FSTRING         shift and go to state 55
+    RSTRING         shift and go to state 56
     MLS             shift and go to state 20
-    [               shift and go to state 55
-    {               shift and go to state 56
+    [               shift and go to state 57
+    {               shift and go to state 58
     CID             shift and go to state 16
 
-    expression                     shift and go to state 255
+    expression                     shift and go to state 264
     boolean_expression             shift and go to state 35
     constant                       shift and go to state 36
     function_call                  shift and go to state 37
-    var_ref                        shift and go to state 81
+    var_ref                        shift and go to state 83
     constructor                    shift and go to state 38
     list_def                       shift and go to state 39
-    map_def                        shift and go to state 40
-    map_lookup                     shift and go to state 41
-    index_lookup                   shift and go to state 42
-    conditional_expression         shift and go to state 43
-    ns_ref                         shift and go to state 83
-    attr_ref                       shift and go to state 84
-    class_ref                      shift and go to state 85
+    list_comprehension             shift and go to state 40
+    map_def                        shift and go to state 41
+    map_lookup                     shift and go to state 42
+    index_lookup                   shift and go to state 43
+    conditional_expression         shift and go to state 44
+    ns_ref                         shift and go to state 85
+    attr_ref                       shift and go to state 86
+    class_ref                      shift and go to state 87
 
-state 201
+state 206
 
     (75) implementation_def -> IMPLEMENTATION ID FOR class_ref . implementation
     (76) implementation -> . implementation_head block
     (77) implementation_head -> . :
     (78) implementation_head -> . : MLS
 
-    :               shift and go to state 258
+    :               shift and go to state 267
 
-    implementation                 shift and go to state 256
-    implementation_head            shift and go to state 257
+    implementation                 shift and go to state 265
+    implementation_head            shift and go to state 266
 
-state 202
+state 207
 
     (25) for -> FOR ID IN operand . : block
 
-    :               shift and go to state 259
+    :               shift and go to state 268
 
 
-state 203
+state 208
 
     (96) index -> INDEX class_ref ( id_list . )
 
-    )               shift and go to state 260
+    )               shift and go to state 269
 
 
-state 204
+state 209
 
-    (175) id_list -> ID . , id_list
-    (176) id_list -> ID .
+    (183) id_list -> ID . , id_list
+    (184) id_list -> ID .
 
-    ,               shift and go to state 261
-    )               reduce using rule 176 (id_list -> ID .)
+    ,               shift and go to state 270
+    )               reduce using rule 184 (id_list -> ID .)
 
 
-state 205
+state 210
 
     (16) import -> IMPORT ns_ref AS ID .
 
     ENTITY          reduce using rule 16 (import -> IMPORT ns_ref AS ID .)
     IMPLEMENT       reduce using rule 16 (import -> IMPORT ns_ref AS ID .)
     IMPLEMENTATION  reduce using rule 16 (import -> IMPORT ns_ref AS ID .)
     INDEX           reduce using rule 16 (import -> IMPORT ns_ref AS ID .)
@@ -6936,244 +7286,252 @@
     INT             reduce using rule 16 (import -> IMPORT ns_ref AS ID .)
     FLOAT           reduce using rule 16 (import -> IMPORT ns_ref AS ID .)
     NULL            reduce using rule 16 (import -> IMPORT ns_ref AS ID .)
     REGEX           reduce using rule 16 (import -> IMPORT ns_ref AS ID .)
     TRUE            reduce using rule 16 (import -> IMPORT ns_ref AS ID .)
     FALSE           reduce using rule 16 (import -> IMPORT ns_ref AS ID .)
     STRING          reduce using rule 16 (import -> IMPORT ns_ref AS ID .)
+    FSTRING         reduce using rule 16 (import -> IMPORT ns_ref AS ID .)
     RSTRING         reduce using rule 16 (import -> IMPORT ns_ref AS ID .)
     MLS             reduce using rule 16 (import -> IMPORT ns_ref AS ID .)
     [               reduce using rule 16 (import -> IMPORT ns_ref AS ID .)
     {               reduce using rule 16 (import -> IMPORT ns_ref AS ID .)
     $end            reduce using rule 16 (import -> IMPORT ns_ref AS ID .)
 
 
-state 206
+state 211
 
-    (121) function_call -> ns_ref ( function_param_list ) .
+    (122) function_call -> ns_ref ( function_param_list ) .
 
-    CMP_OP          reduce using rule 121 (function_call -> ns_ref ( function_param_list ) .)
-    IN              reduce using rule 121 (function_call -> ns_ref ( function_param_list ) .)
-    AND             reduce using rule 121 (function_call -> ns_ref ( function_param_list ) .)
-    OR              reduce using rule 121 (function_call -> ns_ref ( function_param_list ) .)
-    ?               reduce using rule 121 (function_call -> ns_ref ( function_param_list ) .)
-    ENTITY          reduce using rule 121 (function_call -> ns_ref ( function_param_list ) .)
-    IMPLEMENT       reduce using rule 121 (function_call -> ns_ref ( function_param_list ) .)
-    IMPLEMENTATION  reduce using rule 121 (function_call -> ns_ref ( function_param_list ) .)
-    INDEX           reduce using rule 121 (function_call -> ns_ref ( function_param_list ) .)
-    IMPORT          reduce using rule 121 (function_call -> ns_ref ( function_param_list ) .)
-    CID             reduce using rule 121 (function_call -> ns_ref ( function_param_list ) .)
-    FOR             reduce using rule 121 (function_call -> ns_ref ( function_param_list ) .)
-    IF              reduce using rule 121 (function_call -> ns_ref ( function_param_list ) .)
-    (               reduce using rule 121 (function_call -> ns_ref ( function_param_list ) .)
-    TYPEDEF         reduce using rule 121 (function_call -> ns_ref ( function_param_list ) .)
-    ID              reduce using rule 121 (function_call -> ns_ref ( function_param_list ) .)
-    NOT             reduce using rule 121 (function_call -> ns_ref ( function_param_list ) .)
-    INT             reduce using rule 121 (function_call -> ns_ref ( function_param_list ) .)
-    FLOAT           reduce using rule 121 (function_call -> ns_ref ( function_param_list ) .)
-    NULL            reduce using rule 121 (function_call -> ns_ref ( function_param_list ) .)
-    REGEX           reduce using rule 121 (function_call -> ns_ref ( function_param_list ) .)
-    TRUE            reduce using rule 121 (function_call -> ns_ref ( function_param_list ) .)
-    FALSE           reduce using rule 121 (function_call -> ns_ref ( function_param_list ) .)
-    STRING          reduce using rule 121 (function_call -> ns_ref ( function_param_list ) .)
-    RSTRING         reduce using rule 121 (function_call -> ns_ref ( function_param_list ) .)
-    MLS             reduce using rule 121 (function_call -> ns_ref ( function_param_list ) .)
-    [               reduce using rule 121 (function_call -> ns_ref ( function_param_list ) .)
-    {               reduce using rule 121 (function_call -> ns_ref ( function_param_list ) .)
-    $end            reduce using rule 121 (function_call -> ns_ref ( function_param_list ) .)
-    )               reduce using rule 121 (function_call -> ns_ref ( function_param_list ) .)
-    :               reduce using rule 121 (function_call -> ns_ref ( function_param_list ) .)
-    ,               reduce using rule 121 (function_call -> ns_ref ( function_param_list ) .)
-    ]               reduce using rule 121 (function_call -> ns_ref ( function_param_list ) .)
-    ELSE            reduce using rule 121 (function_call -> ns_ref ( function_param_list ) .)
-    ELIF            reduce using rule 121 (function_call -> ns_ref ( function_param_list ) .)
-    END             reduce using rule 121 (function_call -> ns_ref ( function_param_list ) .)
-    }               reduce using rule 121 (function_call -> ns_ref ( function_param_list ) .)
+    CMP_OP          reduce using rule 122 (function_call -> ns_ref ( function_param_list ) .)
+    IN              reduce using rule 122 (function_call -> ns_ref ( function_param_list ) .)
+    AND             reduce using rule 122 (function_call -> ns_ref ( function_param_list ) .)
+    OR              reduce using rule 122 (function_call -> ns_ref ( function_param_list ) .)
+    ?               reduce using rule 122 (function_call -> ns_ref ( function_param_list ) .)
+    ENTITY          reduce using rule 122 (function_call -> ns_ref ( function_param_list ) .)
+    IMPLEMENT       reduce using rule 122 (function_call -> ns_ref ( function_param_list ) .)
+    IMPLEMENTATION  reduce using rule 122 (function_call -> ns_ref ( function_param_list ) .)
+    INDEX           reduce using rule 122 (function_call -> ns_ref ( function_param_list ) .)
+    IMPORT          reduce using rule 122 (function_call -> ns_ref ( function_param_list ) .)
+    CID             reduce using rule 122 (function_call -> ns_ref ( function_param_list ) .)
+    FOR             reduce using rule 122 (function_call -> ns_ref ( function_param_list ) .)
+    IF              reduce using rule 122 (function_call -> ns_ref ( function_param_list ) .)
+    (               reduce using rule 122 (function_call -> ns_ref ( function_param_list ) .)
+    TYPEDEF         reduce using rule 122 (function_call -> ns_ref ( function_param_list ) .)
+    ID              reduce using rule 122 (function_call -> ns_ref ( function_param_list ) .)
+    NOT             reduce using rule 122 (function_call -> ns_ref ( function_param_list ) .)
+    INT             reduce using rule 122 (function_call -> ns_ref ( function_param_list ) .)
+    FLOAT           reduce using rule 122 (function_call -> ns_ref ( function_param_list ) .)
+    NULL            reduce using rule 122 (function_call -> ns_ref ( function_param_list ) .)
+    REGEX           reduce using rule 122 (function_call -> ns_ref ( function_param_list ) .)
+    TRUE            reduce using rule 122 (function_call -> ns_ref ( function_param_list ) .)
+    FALSE           reduce using rule 122 (function_call -> ns_ref ( function_param_list ) .)
+    STRING          reduce using rule 122 (function_call -> ns_ref ( function_param_list ) .)
+    FSTRING         reduce using rule 122 (function_call -> ns_ref ( function_param_list ) .)
+    RSTRING         reduce using rule 122 (function_call -> ns_ref ( function_param_list ) .)
+    MLS             reduce using rule 122 (function_call -> ns_ref ( function_param_list ) .)
+    [               reduce using rule 122 (function_call -> ns_ref ( function_param_list ) .)
+    {               reduce using rule 122 (function_call -> ns_ref ( function_param_list ) .)
+    $end            reduce using rule 122 (function_call -> ns_ref ( function_param_list ) .)
+    )               reduce using rule 122 (function_call -> ns_ref ( function_param_list ) .)
+    :               reduce using rule 122 (function_call -> ns_ref ( function_param_list ) .)
+    ,               reduce using rule 122 (function_call -> ns_ref ( function_param_list ) .)
+    ]               reduce using rule 122 (function_call -> ns_ref ( function_param_list ) .)
+    ELSE            reduce using rule 122 (function_call -> ns_ref ( function_param_list ) .)
+    ELIF            reduce using rule 122 (function_call -> ns_ref ( function_param_list ) .)
+    END             reduce using rule 122 (function_call -> ns_ref ( function_param_list ) .)
+    }               reduce using rule 122 (function_call -> ns_ref ( function_param_list ) .)
 
 
-state 207
+state 212
 
-    (158) function_param_list -> function_param_list_element empty . function_param_list_empty
-    (157) function_param_list_empty -> . empty
+    (166) function_param_list -> function_param_list_element empty . function_param_list_empty
+    (165) function_param_list_empty -> . empty
     (14) empty -> .
 
     )               reduce using rule 14 (empty -> .)
 
-    empty                          shift and go to state 147
-    function_param_list_empty      shift and go to state 262
+    empty                          shift and go to state 149
+    function_param_list_empty      shift and go to state 271
 
-state 208
+state 213
 
-    (159) function_param_list -> function_param_list_element , . function_param_list
-    (156) function_param_list -> . function_param_list_empty
-    (158) function_param_list -> . function_param_list_element empty function_param_list_empty
-    (159) function_param_list -> . function_param_list_element , function_param_list
-    (157) function_param_list_empty -> . empty
-    (154) function_param_list_element -> . param_list_element
-    (155) function_param_list_element -> . operand
+    (167) function_param_list -> function_param_list_element , . function_param_list
+    (164) function_param_list -> . function_param_list_empty
+    (166) function_param_list -> . function_param_list_element empty function_param_list_empty
+    (167) function_param_list -> . function_param_list_element , function_param_list
+    (165) function_param_list_empty -> . empty
+    (162) function_param_list_element -> . param_list_element
+    (163) function_param_list_element -> . operand
     (14) empty -> .
-    (148) param_list_element -> . ID = operand
-    (149) param_list_element -> . wrapped_kwargs
-    (116) operand -> . expression
-    (147) wrapped_kwargs -> . * * operand
+    (156) param_list_element -> . ID = operand
+    (157) param_list_element -> . wrapped_kwargs
+    (117) operand -> . expression
+    (155) wrapped_kwargs -> . * * operand
     (97) expression -> . boolean_expression
     (98) expression -> . constant
     (99) expression -> . function_call
     (100) expression -> . var_ref
     (101) expression -> . constructor
     (102) expression -> . list_def
-    (103) expression -> . map_def
-    (104) expression -> . map_lookup
-    (105) expression -> . index_lookup
-    (106) expression -> . conditional_expression
-    (107) expression -> . ( expression )
-    (108) boolean_expression -> . expression CMP_OP expression
-    (109) boolean_expression -> . expression IN expression
-    (110) boolean_expression -> . expression AND expression
-    (111) boolean_expression -> . expression OR expression
-    (112) boolean_expression -> . NOT expression
-    (113) boolean_expression -> . var_ref . ID IS DEFINED
-    (114) boolean_expression -> . ID IS DEFINED
-    (115) boolean_expression -> . map_lookup IS DEFINED
-    (134) constant -> . INT
-    (135) constant -> . FLOAT
-    (136) constant -> . NULL
-    (137) constant -> . REGEX
-    (138) constant -> . TRUE
-    (139) constant -> . FALSE
-    (140) constant -> . STRING
-    (141) constant -> . RSTRING
-    (142) constant -> . MLS
-    (121) function_call -> . ns_ref ( function_param_list )
-    (122) function_call -> . attr_ref ( function_param_list )
-    (163) var_ref -> . attr_ref
-    (165) var_ref -> . ns_ref
-    (120) constructor -> . class_ref ( param_list )
-    (123) list_def -> . [ operand_list ]
-    (130) map_def -> . { pair_list }
-    (117) map_lookup -> . attr_ref [ operand ]
-    (118) map_lookup -> . var_ref [ operand ]
-    (119) map_lookup -> . map_lookup [ operand ]
-    (131) index_lookup -> . class_ref [ param_list ]
-    (132) index_lookup -> . attr_ref [ param_list ]
-    (133) conditional_expression -> . expression ? expression : expression
-    (173) ns_ref -> . ns_ref SEP ID
-    (174) ns_ref -> . ID
-    (164) attr_ref -> . var_ref . ID
-    (166) class_ref -> . CID
-    (167) class_ref -> . ns_ref SEP CID
-    (168) class_ref -> . var_ref . CID
+    (103) expression -> . list_comprehension
+    (104) expression -> . map_def
+    (105) expression -> . map_lookup
+    (106) expression -> . index_lookup
+    (107) expression -> . conditional_expression
+    (108) expression -> . ( expression )
+    (109) boolean_expression -> . expression CMP_OP expression
+    (110) boolean_expression -> . expression IN expression
+    (111) boolean_expression -> . expression AND expression
+    (112) boolean_expression -> . expression OR expression
+    (113) boolean_expression -> . NOT expression
+    (114) boolean_expression -> . var_ref . ID IS DEFINED
+    (115) boolean_expression -> . ID IS DEFINED
+    (116) boolean_expression -> . map_lookup IS DEFINED
+    (141) constant -> . INT
+    (142) constant -> . FLOAT
+    (143) constant -> . NULL
+    (144) constant -> . REGEX
+    (145) constant -> . TRUE
+    (146) constant -> . FALSE
+    (147) constant -> . STRING
+    (148) constant -> . FSTRING
+    (149) constant -> . RSTRING
+    (150) constant -> . MLS
+    (122) function_call -> . ns_ref ( function_param_list )
+    (123) function_call -> . attr_ref ( function_param_list )
+    (171) var_ref -> . attr_ref
+    (173) var_ref -> . ns_ref
+    (121) constructor -> . class_ref ( param_list )
+    (124) list_def -> . [ operand_list ]
+    (125) list_comprehension -> . [ expression list_comprehension_for list_comprehension_guard ]
+    (137) map_def -> . { pair_list }
+    (118) map_lookup -> . attr_ref [ operand ]
+    (119) map_lookup -> . var_ref [ operand ]
+    (120) map_lookup -> . map_lookup [ operand ]
+    (138) index_lookup -> . class_ref [ param_list ]
+    (139) index_lookup -> . attr_ref [ param_list ]
+    (140) conditional_expression -> . expression ? expression : expression
+    (181) ns_ref -> . ns_ref SEP ID
+    (182) ns_ref -> . ID
+    (172) attr_ref -> . var_ref . ID
+    (174) class_ref -> . CID
+    (175) class_ref -> . ns_ref SEP CID
+    (176) class_ref -> . var_ref . CID
 
     )               reduce using rule 14 (empty -> .)
-    ID              shift and go to state 150
-    *               shift and go to state 127
+    ID              shift and go to state 152
+    *               shift and go to state 129
     (               shift and go to state 30
-    NOT             shift and go to state 46
-    INT             shift and go to state 47
-    FLOAT           shift and go to state 48
-    NULL            shift and go to state 49
-    REGEX           shift and go to state 50
-    TRUE            shift and go to state 51
-    FALSE           shift and go to state 52
-    STRING          shift and go to state 53
-    RSTRING         shift and go to state 54
+    NOT             shift and go to state 47
+    INT             shift and go to state 48
+    FLOAT           shift and go to state 49
+    NULL            shift and go to state 50
+    REGEX           shift and go to state 51
+    TRUE            shift and go to state 52
+    FALSE           shift and go to state 53
+    STRING          shift and go to state 54
+    FSTRING         shift and go to state 55
+    RSTRING         shift and go to state 56
     MLS             shift and go to state 20
-    [               shift and go to state 55
-    {               shift and go to state 56
+    [               shift and go to state 57
+    {               shift and go to state 58
     CID             shift and go to state 16
 
-    function_param_list_element    shift and go to state 146
-    function_param_list            shift and go to state 263
-    function_param_list_empty      shift and go to state 145
-    empty                          shift and go to state 147
-    param_list_element             shift and go to state 148
-    operand                        shift and go to state 149
-    wrapped_kwargs                 shift and go to state 126
-    expression                     shift and go to state 104
+    function_param_list_element    shift and go to state 148
+    function_param_list            shift and go to state 272
+    function_param_list_empty      shift and go to state 147
+    empty                          shift and go to state 149
+    param_list_element             shift and go to state 150
+    operand                        shift and go to state 151
+    wrapped_kwargs                 shift and go to state 128
+    expression                     shift and go to state 153
     boolean_expression             shift and go to state 35
     constant                       shift and go to state 36
     function_call                  shift and go to state 37
-    var_ref                        shift and go to state 81
+    var_ref                        shift and go to state 83
     constructor                    shift and go to state 38
     list_def                       shift and go to state 39
-    map_def                        shift and go to state 40
-    map_lookup                     shift and go to state 41
-    index_lookup                   shift and go to state 42
-    conditional_expression         shift and go to state 43
-    ns_ref                         shift and go to state 83
-    attr_ref                       shift and go to state 84
-    class_ref                      shift and go to state 85
+    list_comprehension             shift and go to state 40
+    map_def                        shift and go to state 41
+    map_lookup                     shift and go to state 42
+    index_lookup                   shift and go to state 43
+    conditional_expression         shift and go to state 44
+    ns_ref                         shift and go to state 85
+    attr_ref                       shift and go to state 86
+    class_ref                      shift and go to state 87
 
-state 209
+state 214
 
-    (113) boolean_expression -> var_ref . ID IS . DEFINED
+    (114) boolean_expression -> var_ref . ID IS . DEFINED
 
-    DEFINED         shift and go to state 264
+    DEFINED         shift and go to state 273
 
 
-state 210
+state 215
 
-    (118) map_lookup -> var_ref [ operand ] .
+    (119) map_lookup -> var_ref [ operand ] .
 
-    IS              reduce using rule 118 (map_lookup -> var_ref [ operand ] .)
-    [               reduce using rule 118 (map_lookup -> var_ref [ operand ] .)
-    CMP_OP          reduce using rule 118 (map_lookup -> var_ref [ operand ] .)
-    IN              reduce using rule 118 (map_lookup -> var_ref [ operand ] .)
-    AND             reduce using rule 118 (map_lookup -> var_ref [ operand ] .)
-    OR              reduce using rule 118 (map_lookup -> var_ref [ operand ] .)
-    ?               reduce using rule 118 (map_lookup -> var_ref [ operand ] .)
-    ENTITY          reduce using rule 118 (map_lookup -> var_ref [ operand ] .)
-    IMPLEMENT       reduce using rule 118 (map_lookup -> var_ref [ operand ] .)
-    IMPLEMENTATION  reduce using rule 118 (map_lookup -> var_ref [ operand ] .)
-    INDEX           reduce using rule 118 (map_lookup -> var_ref [ operand ] .)
-    IMPORT          reduce using rule 118 (map_lookup -> var_ref [ operand ] .)
-    CID             reduce using rule 118 (map_lookup -> var_ref [ operand ] .)
-    FOR             reduce using rule 118 (map_lookup -> var_ref [ operand ] .)
-    IF              reduce using rule 118 (map_lookup -> var_ref [ operand ] .)
-    (               reduce using rule 118 (map_lookup -> var_ref [ operand ] .)
-    TYPEDEF         reduce using rule 118 (map_lookup -> var_ref [ operand ] .)
-    ID              reduce using rule 118 (map_lookup -> var_ref [ operand ] .)
-    NOT             reduce using rule 118 (map_lookup -> var_ref [ operand ] .)
-    INT             reduce using rule 118 (map_lookup -> var_ref [ operand ] .)
-    FLOAT           reduce using rule 118 (map_lookup -> var_ref [ operand ] .)
-    NULL            reduce using rule 118 (map_lookup -> var_ref [ operand ] .)
-    REGEX           reduce using rule 118 (map_lookup -> var_ref [ operand ] .)
-    TRUE            reduce using rule 118 (map_lookup -> var_ref [ operand ] .)
-    FALSE           reduce using rule 118 (map_lookup -> var_ref [ operand ] .)
-    STRING          reduce using rule 118 (map_lookup -> var_ref [ operand ] .)
-    RSTRING         reduce using rule 118 (map_lookup -> var_ref [ operand ] .)
-    MLS             reduce using rule 118 (map_lookup -> var_ref [ operand ] .)
-    {               reduce using rule 118 (map_lookup -> var_ref [ operand ] .)
-    $end            reduce using rule 118 (map_lookup -> var_ref [ operand ] .)
-    )               reduce using rule 118 (map_lookup -> var_ref [ operand ] .)
-    :               reduce using rule 118 (map_lookup -> var_ref [ operand ] .)
-    ,               reduce using rule 118 (map_lookup -> var_ref [ operand ] .)
-    ]               reduce using rule 118 (map_lookup -> var_ref [ operand ] .)
-    ELSE            reduce using rule 118 (map_lookup -> var_ref [ operand ] .)
-    ELIF            reduce using rule 118 (map_lookup -> var_ref [ operand ] .)
-    END             reduce using rule 118 (map_lookup -> var_ref [ operand ] .)
-    }               reduce using rule 118 (map_lookup -> var_ref [ operand ] .)
+    IS              reduce using rule 119 (map_lookup -> var_ref [ operand ] .)
+    [               reduce using rule 119 (map_lookup -> var_ref [ operand ] .)
+    CMP_OP          reduce using rule 119 (map_lookup -> var_ref [ operand ] .)
+    IN              reduce using rule 119 (map_lookup -> var_ref [ operand ] .)
+    AND             reduce using rule 119 (map_lookup -> var_ref [ operand ] .)
+    OR              reduce using rule 119 (map_lookup -> var_ref [ operand ] .)
+    ?               reduce using rule 119 (map_lookup -> var_ref [ operand ] .)
+    ENTITY          reduce using rule 119 (map_lookup -> var_ref [ operand ] .)
+    IMPLEMENT       reduce using rule 119 (map_lookup -> var_ref [ operand ] .)
+    IMPLEMENTATION  reduce using rule 119 (map_lookup -> var_ref [ operand ] .)
+    INDEX           reduce using rule 119 (map_lookup -> var_ref [ operand ] .)
+    IMPORT          reduce using rule 119 (map_lookup -> var_ref [ operand ] .)
+    CID             reduce using rule 119 (map_lookup -> var_ref [ operand ] .)
+    FOR             reduce using rule 119 (map_lookup -> var_ref [ operand ] .)
+    IF              reduce using rule 119 (map_lookup -> var_ref [ operand ] .)
+    (               reduce using rule 119 (map_lookup -> var_ref [ operand ] .)
+    TYPEDEF         reduce using rule 119 (map_lookup -> var_ref [ operand ] .)
+    ID              reduce using rule 119 (map_lookup -> var_ref [ operand ] .)
+    NOT             reduce using rule 119 (map_lookup -> var_ref [ operand ] .)
+    INT             reduce using rule 119 (map_lookup -> var_ref [ operand ] .)
+    FLOAT           reduce using rule 119 (map_lookup -> var_ref [ operand ] .)
+    NULL            reduce using rule 119 (map_lookup -> var_ref [ operand ] .)
+    REGEX           reduce using rule 119 (map_lookup -> var_ref [ operand ] .)
+    TRUE            reduce using rule 119 (map_lookup -> var_ref [ operand ] .)
+    FALSE           reduce using rule 119 (map_lookup -> var_ref [ operand ] .)
+    STRING          reduce using rule 119 (map_lookup -> var_ref [ operand ] .)
+    FSTRING         reduce using rule 119 (map_lookup -> var_ref [ operand ] .)
+    RSTRING         reduce using rule 119 (map_lookup -> var_ref [ operand ] .)
+    MLS             reduce using rule 119 (map_lookup -> var_ref [ operand ] .)
+    {               reduce using rule 119 (map_lookup -> var_ref [ operand ] .)
+    $end            reduce using rule 119 (map_lookup -> var_ref [ operand ] .)
+    )               reduce using rule 119 (map_lookup -> var_ref [ operand ] .)
+    :               reduce using rule 119 (map_lookup -> var_ref [ operand ] .)
+    ,               reduce using rule 119 (map_lookup -> var_ref [ operand ] .)
+    ]               reduce using rule 119 (map_lookup -> var_ref [ operand ] .)
+    ELSE            reduce using rule 119 (map_lookup -> var_ref [ operand ] .)
+    ELIF            reduce using rule 119 (map_lookup -> var_ref [ operand ] .)
+    END             reduce using rule 119 (map_lookup -> var_ref [ operand ] .)
+    }               reduce using rule 119 (map_lookup -> var_ref [ operand ] .)
 
 
-state 211
+state 216
 
     (27) if_body -> expression : stmt_list . if_next
     (28) if_next -> . empty
     (29) if_next -> . ELSE : stmt_list
     (30) if_next -> . ELIF if_body
     (14) empty -> .
 
-    ELSE            shift and go to state 267
-    ELIF            shift and go to state 268
+    ELSE            shift and go to state 276
+    ELIF            shift and go to state 277
     END             reduce using rule 14 (empty -> .)
 
-    if_next                        shift and go to state 265
-    empty                          shift and go to state 266
+    if_next                        shift and go to state 274
+    empty                          shift and go to state 275
 
-state 212
+state 217
 
     (21) stmt_list -> statement . stmt_list
     (21) stmt_list -> . statement stmt_list
     (22) stmt_list -> . empty
     (17) statement -> . assign
     (18) statement -> . for
     (19) statement -> . if
@@ -7185,119 +7543,124 @@
     (26) if -> . IF if_body END
     (97) expression -> . boolean_expression
     (98) expression -> . constant
     (99) expression -> . function_call
     (100) expression -> . var_ref
     (101) expression -> . constructor
     (102) expression -> . list_def
-    (103) expression -> . map_def
-    (104) expression -> . map_lookup
-    (105) expression -> . index_lookup
-    (106) expression -> . conditional_expression
-    (107) expression -> . ( expression )
-    (163) var_ref -> . attr_ref
-    (165) var_ref -> . ns_ref
-    (108) boolean_expression -> . expression CMP_OP expression
-    (109) boolean_expression -> . expression IN expression
-    (110) boolean_expression -> . expression AND expression
-    (111) boolean_expression -> . expression OR expression
-    (112) boolean_expression -> . NOT expression
-    (113) boolean_expression -> . var_ref . ID IS DEFINED
-    (114) boolean_expression -> . ID IS DEFINED
-    (115) boolean_expression -> . map_lookup IS DEFINED
-    (134) constant -> . INT
-    (135) constant -> . FLOAT
-    (136) constant -> . NULL
-    (137) constant -> . REGEX
-    (138) constant -> . TRUE
-    (139) constant -> . FALSE
-    (140) constant -> . STRING
-    (141) constant -> . RSTRING
-    (142) constant -> . MLS
-    (121) function_call -> . ns_ref ( function_param_list )
-    (122) function_call -> . attr_ref ( function_param_list )
-    (120) constructor -> . class_ref ( param_list )
-    (123) list_def -> . [ operand_list ]
-    (130) map_def -> . { pair_list }
-    (117) map_lookup -> . attr_ref [ operand ]
-    (118) map_lookup -> . var_ref [ operand ]
-    (119) map_lookup -> . map_lookup [ operand ]
-    (131) index_lookup -> . class_ref [ param_list ]
-    (132) index_lookup -> . attr_ref [ param_list ]
-    (133) conditional_expression -> . expression ? expression : expression
-    (164) attr_ref -> . var_ref . ID
-    (173) ns_ref -> . ns_ref SEP ID
-    (174) ns_ref -> . ID
-    (166) class_ref -> . CID
-    (167) class_ref -> . ns_ref SEP CID
-    (168) class_ref -> . var_ref . CID
+    (103) expression -> . list_comprehension
+    (104) expression -> . map_def
+    (105) expression -> . map_lookup
+    (106) expression -> . index_lookup
+    (107) expression -> . conditional_expression
+    (108) expression -> . ( expression )
+    (171) var_ref -> . attr_ref
+    (173) var_ref -> . ns_ref
+    (109) boolean_expression -> . expression CMP_OP expression
+    (110) boolean_expression -> . expression IN expression
+    (111) boolean_expression -> . expression AND expression
+    (112) boolean_expression -> . expression OR expression
+    (113) boolean_expression -> . NOT expression
+    (114) boolean_expression -> . var_ref . ID IS DEFINED
+    (115) boolean_expression -> . ID IS DEFINED
+    (116) boolean_expression -> . map_lookup IS DEFINED
+    (141) constant -> . INT
+    (142) constant -> . FLOAT
+    (143) constant -> . NULL
+    (144) constant -> . REGEX
+    (145) constant -> . TRUE
+    (146) constant -> . FALSE
+    (147) constant -> . STRING
+    (148) constant -> . FSTRING
+    (149) constant -> . RSTRING
+    (150) constant -> . MLS
+    (122) function_call -> . ns_ref ( function_param_list )
+    (123) function_call -> . attr_ref ( function_param_list )
+    (121) constructor -> . class_ref ( param_list )
+    (124) list_def -> . [ operand_list ]
+    (125) list_comprehension -> . [ expression list_comprehension_for list_comprehension_guard ]
+    (137) map_def -> . { pair_list }
+    (118) map_lookup -> . attr_ref [ operand ]
+    (119) map_lookup -> . var_ref [ operand ]
+    (120) map_lookup -> . map_lookup [ operand ]
+    (138) index_lookup -> . class_ref [ param_list ]
+    (139) index_lookup -> . attr_ref [ param_list ]
+    (140) conditional_expression -> . expression ? expression : expression
+    (172) attr_ref -> . var_ref . ID
+    (181) ns_ref -> . ns_ref SEP ID
+    (182) ns_ref -> . ID
+    (174) class_ref -> . CID
+    (175) class_ref -> . ns_ref SEP CID
+    (176) class_ref -> . var_ref . CID
 
     ELSE            reduce using rule 14 (empty -> .)
     ELIF            reduce using rule 14 (empty -> .)
     END             reduce using rule 14 (empty -> .)
     FOR             shift and go to state 23
     IF              shift and go to state 34
     (               shift and go to state 30
-    NOT             shift and go to state 46
-    ID              shift and go to state 82
-    INT             shift and go to state 47
-    FLOAT           shift and go to state 48
-    NULL            shift and go to state 49
-    REGEX           shift and go to state 50
-    TRUE            shift and go to state 51
-    FALSE           shift and go to state 52
-    STRING          shift and go to state 53
-    RSTRING         shift and go to state 54
+    NOT             shift and go to state 47
+    ID              shift and go to state 84
+    INT             shift and go to state 48
+    FLOAT           shift and go to state 49
+    NULL            shift and go to state 50
+    REGEX           shift and go to state 51
+    TRUE            shift and go to state 52
+    FALSE           shift and go to state 53
+    STRING          shift and go to state 54
+    FSTRING         shift and go to state 55
+    RSTRING         shift and go to state 56
     MLS             shift and go to state 20
-    [               shift and go to state 55
-    {               shift and go to state 56
+    [               shift and go to state 57
+    {               shift and go to state 58
     CID             shift and go to state 16
 
-    statement                      shift and go to state 212
-    stmt_list                      shift and go to state 269
-    empty                          shift and go to state 213
+    statement                      shift and go to state 217
+    stmt_list                      shift and go to state 278
+    empty                          shift and go to state 218
     assign                         shift and go to state 25
     for                            shift and go to state 26
     if                             shift and go to state 27
     expression                     shift and go to state 21
-    var_ref                        shift and go to state 214
+    var_ref                        shift and go to state 219
     boolean_expression             shift and go to state 35
     constant                       shift and go to state 36
     function_call                  shift and go to state 37
     constructor                    shift and go to state 38
     list_def                       shift and go to state 39
-    map_def                        shift and go to state 40
-    map_lookup                     shift and go to state 41
-    index_lookup                   shift and go to state 42
-    conditional_expression         shift and go to state 43
-    attr_ref                       shift and go to state 45
-    ns_ref                         shift and go to state 215
-    class_ref                      shift and go to state 85
+    list_comprehension             shift and go to state 40
+    map_def                        shift and go to state 41
+    map_lookup                     shift and go to state 42
+    index_lookup                   shift and go to state 43
+    conditional_expression         shift and go to state 44
+    attr_ref                       shift and go to state 46
+    ns_ref                         shift and go to state 220
+    class_ref                      shift and go to state 87
 
-state 213
+state 218
 
     (22) stmt_list -> empty .
 
     ELSE            reduce using rule 22 (stmt_list -> empty .)
     ELIF            reduce using rule 22 (stmt_list -> empty .)
     END             reduce using rule 22 (stmt_list -> empty .)
 
 
-state 214
+state 219
 
     (23) assign -> var_ref . = operand
     (24) assign -> var_ref . PEQ operand
     (100) expression -> var_ref .
-    (113) boolean_expression -> var_ref . . ID IS DEFINED
-    (118) map_lookup -> var_ref . [ operand ]
-    (164) attr_ref -> var_ref . . ID
-    (168) class_ref -> var_ref . . CID
+    (114) boolean_expression -> var_ref . . ID IS DEFINED
+    (119) map_lookup -> var_ref . [ operand ]
+    (172) attr_ref -> var_ref . . ID
+    (176) class_ref -> var_ref . . CID
 
-    =               shift and go to state 90
-    PEQ             shift and go to state 91
+    =               shift and go to state 92
+    PEQ             shift and go to state 93
     CMP_OP          reduce using rule 100 (expression -> var_ref .)
     IN              reduce using rule 100 (expression -> var_ref .)
     AND             reduce using rule 100 (expression -> var_ref .)
     OR              reduce using rule 100 (expression -> var_ref .)
     ?               reduce using rule 100 (expression -> var_ref .)
     FOR             reduce using rule 100 (expression -> var_ref .)
     IF              reduce using rule 100 (expression -> var_ref .)
@@ -7307,121 +7670,124 @@
     INT             reduce using rule 100 (expression -> var_ref .)
     FLOAT           reduce using rule 100 (expression -> var_ref .)
     NULL            reduce using rule 100 (expression -> var_ref .)
     REGEX           reduce using rule 100 (expression -> var_ref .)
     TRUE            reduce using rule 100 (expression -> var_ref .)
     FALSE           reduce using rule 100 (expression -> var_ref .)
     STRING          reduce using rule 100 (expression -> var_ref .)
+    FSTRING         reduce using rule 100 (expression -> var_ref .)
     RSTRING         reduce using rule 100 (expression -> var_ref .)
     MLS             reduce using rule 100 (expression -> var_ref .)
     {               reduce using rule 100 (expression -> var_ref .)
     CID             reduce using rule 100 (expression -> var_ref .)
     ELSE            reduce using rule 100 (expression -> var_ref .)
     ELIF            reduce using rule 100 (expression -> var_ref .)
     END             reduce using rule 100 (expression -> var_ref .)
-    .               shift and go to state 138
-    [               shift and go to state 92
+    .               shift and go to state 140
+    [               shift and go to state 94
 
   ! [               [ reduce using rule 100 (expression -> var_ref .) ]
 
 
-state 215
+state 220
 
-    (165) var_ref -> ns_ref .
-    (121) function_call -> ns_ref . ( function_param_list )
-    (173) ns_ref -> ns_ref . SEP ID
-    (167) class_ref -> ns_ref . SEP CID
-
-    =               reduce using rule 165 (var_ref -> ns_ref .)
-    PEQ             reduce using rule 165 (var_ref -> ns_ref .)
-    .               reduce using rule 165 (var_ref -> ns_ref .)
-    [               reduce using rule 165 (var_ref -> ns_ref .)
-    CMP_OP          reduce using rule 165 (var_ref -> ns_ref .)
-    IN              reduce using rule 165 (var_ref -> ns_ref .)
-    AND             reduce using rule 165 (var_ref -> ns_ref .)
-    OR              reduce using rule 165 (var_ref -> ns_ref .)
-    ?               reduce using rule 165 (var_ref -> ns_ref .)
-    FOR             reduce using rule 165 (var_ref -> ns_ref .)
-    IF              reduce using rule 165 (var_ref -> ns_ref .)
-    NOT             reduce using rule 165 (var_ref -> ns_ref .)
-    ID              reduce using rule 165 (var_ref -> ns_ref .)
-    INT             reduce using rule 165 (var_ref -> ns_ref .)
-    FLOAT           reduce using rule 165 (var_ref -> ns_ref .)
-    NULL            reduce using rule 165 (var_ref -> ns_ref .)
-    REGEX           reduce using rule 165 (var_ref -> ns_ref .)
-    TRUE            reduce using rule 165 (var_ref -> ns_ref .)
-    FALSE           reduce using rule 165 (var_ref -> ns_ref .)
-    STRING          reduce using rule 165 (var_ref -> ns_ref .)
-    RSTRING         reduce using rule 165 (var_ref -> ns_ref .)
-    MLS             reduce using rule 165 (var_ref -> ns_ref .)
-    {               reduce using rule 165 (var_ref -> ns_ref .)
-    CID             reduce using rule 165 (var_ref -> ns_ref .)
-    ELSE            reduce using rule 165 (var_ref -> ns_ref .)
-    ELIF            reduce using rule 165 (var_ref -> ns_ref .)
-    END             reduce using rule 165 (var_ref -> ns_ref .)
-    (               shift and go to state 88
-    SEP             shift and go to state 139
+    (173) var_ref -> ns_ref .
+    (122) function_call -> ns_ref . ( function_param_list )
+    (181) ns_ref -> ns_ref . SEP ID
+    (175) class_ref -> ns_ref . SEP CID
+
+    =               reduce using rule 173 (var_ref -> ns_ref .)
+    PEQ             reduce using rule 173 (var_ref -> ns_ref .)
+    .               reduce using rule 173 (var_ref -> ns_ref .)
+    [               reduce using rule 173 (var_ref -> ns_ref .)
+    CMP_OP          reduce using rule 173 (var_ref -> ns_ref .)
+    IN              reduce using rule 173 (var_ref -> ns_ref .)
+    AND             reduce using rule 173 (var_ref -> ns_ref .)
+    OR              reduce using rule 173 (var_ref -> ns_ref .)
+    ?               reduce using rule 173 (var_ref -> ns_ref .)
+    FOR             reduce using rule 173 (var_ref -> ns_ref .)
+    IF              reduce using rule 173 (var_ref -> ns_ref .)
+    NOT             reduce using rule 173 (var_ref -> ns_ref .)
+    ID              reduce using rule 173 (var_ref -> ns_ref .)
+    INT             reduce using rule 173 (var_ref -> ns_ref .)
+    FLOAT           reduce using rule 173 (var_ref -> ns_ref .)
+    NULL            reduce using rule 173 (var_ref -> ns_ref .)
+    REGEX           reduce using rule 173 (var_ref -> ns_ref .)
+    TRUE            reduce using rule 173 (var_ref -> ns_ref .)
+    FALSE           reduce using rule 173 (var_ref -> ns_ref .)
+    STRING          reduce using rule 173 (var_ref -> ns_ref .)
+    FSTRING         reduce using rule 173 (var_ref -> ns_ref .)
+    RSTRING         reduce using rule 173 (var_ref -> ns_ref .)
+    MLS             reduce using rule 173 (var_ref -> ns_ref .)
+    {               reduce using rule 173 (var_ref -> ns_ref .)
+    CID             reduce using rule 173 (var_ref -> ns_ref .)
+    ELSE            reduce using rule 173 (var_ref -> ns_ref .)
+    ELIF            reduce using rule 173 (var_ref -> ns_ref .)
+    END             reduce using rule 173 (var_ref -> ns_ref .)
+    (               shift and go to state 90
+    SEP             shift and go to state 141
 
-  ! (               [ reduce using rule 165 (var_ref -> ns_ref .) ]
+  ! (               [ reduce using rule 173 (var_ref -> ns_ref .) ]
 
 
-state 216
+state 221
 
-    (119) map_lookup -> map_lookup [ operand ] .
+    (120) map_lookup -> map_lookup [ operand ] .
 
-    IS              reduce using rule 119 (map_lookup -> map_lookup [ operand ] .)
-    [               reduce using rule 119 (map_lookup -> map_lookup [ operand ] .)
-    CMP_OP          reduce using rule 119 (map_lookup -> map_lookup [ operand ] .)
-    IN              reduce using rule 119 (map_lookup -> map_lookup [ operand ] .)
-    AND             reduce using rule 119 (map_lookup -> map_lookup [ operand ] .)
-    OR              reduce using rule 119 (map_lookup -> map_lookup [ operand ] .)
-    ?               reduce using rule 119 (map_lookup -> map_lookup [ operand ] .)
-    ENTITY          reduce using rule 119 (map_lookup -> map_lookup [ operand ] .)
-    IMPLEMENT       reduce using rule 119 (map_lookup -> map_lookup [ operand ] .)
-    IMPLEMENTATION  reduce using rule 119 (map_lookup -> map_lookup [ operand ] .)
-    INDEX           reduce using rule 119 (map_lookup -> map_lookup [ operand ] .)
-    IMPORT          reduce using rule 119 (map_lookup -> map_lookup [ operand ] .)
-    CID             reduce using rule 119 (map_lookup -> map_lookup [ operand ] .)
-    FOR             reduce using rule 119 (map_lookup -> map_lookup [ operand ] .)
-    IF              reduce using rule 119 (map_lookup -> map_lookup [ operand ] .)
-    (               reduce using rule 119 (map_lookup -> map_lookup [ operand ] .)
-    TYPEDEF         reduce using rule 119 (map_lookup -> map_lookup [ operand ] .)
-    ID              reduce using rule 119 (map_lookup -> map_lookup [ operand ] .)
-    NOT             reduce using rule 119 (map_lookup -> map_lookup [ operand ] .)
-    INT             reduce using rule 119 (map_lookup -> map_lookup [ operand ] .)
-    FLOAT           reduce using rule 119 (map_lookup -> map_lookup [ operand ] .)
-    NULL            reduce using rule 119 (map_lookup -> map_lookup [ operand ] .)
-    REGEX           reduce using rule 119 (map_lookup -> map_lookup [ operand ] .)
-    TRUE            reduce using rule 119 (map_lookup -> map_lookup [ operand ] .)
-    FALSE           reduce using rule 119 (map_lookup -> map_lookup [ operand ] .)
-    STRING          reduce using rule 119 (map_lookup -> map_lookup [ operand ] .)
-    RSTRING         reduce using rule 119 (map_lookup -> map_lookup [ operand ] .)
-    MLS             reduce using rule 119 (map_lookup -> map_lookup [ operand ] .)
-    {               reduce using rule 119 (map_lookup -> map_lookup [ operand ] .)
-    $end            reduce using rule 119 (map_lookup -> map_lookup [ operand ] .)
-    )               reduce using rule 119 (map_lookup -> map_lookup [ operand ] .)
-    :               reduce using rule 119 (map_lookup -> map_lookup [ operand ] .)
-    ,               reduce using rule 119 (map_lookup -> map_lookup [ operand ] .)
-    ]               reduce using rule 119 (map_lookup -> map_lookup [ operand ] .)
-    ELSE            reduce using rule 119 (map_lookup -> map_lookup [ operand ] .)
-    ELIF            reduce using rule 119 (map_lookup -> map_lookup [ operand ] .)
-    END             reduce using rule 119 (map_lookup -> map_lookup [ operand ] .)
-    }               reduce using rule 119 (map_lookup -> map_lookup [ operand ] .)
+    IS              reduce using rule 120 (map_lookup -> map_lookup [ operand ] .)
+    [               reduce using rule 120 (map_lookup -> map_lookup [ operand ] .)
+    CMP_OP          reduce using rule 120 (map_lookup -> map_lookup [ operand ] .)
+    IN              reduce using rule 120 (map_lookup -> map_lookup [ operand ] .)
+    AND             reduce using rule 120 (map_lookup -> map_lookup [ operand ] .)
+    OR              reduce using rule 120 (map_lookup -> map_lookup [ operand ] .)
+    ?               reduce using rule 120 (map_lookup -> map_lookup [ operand ] .)
+    ENTITY          reduce using rule 120 (map_lookup -> map_lookup [ operand ] .)
+    IMPLEMENT       reduce using rule 120 (map_lookup -> map_lookup [ operand ] .)
+    IMPLEMENTATION  reduce using rule 120 (map_lookup -> map_lookup [ operand ] .)
+    INDEX           reduce using rule 120 (map_lookup -> map_lookup [ operand ] .)
+    IMPORT          reduce using rule 120 (map_lookup -> map_lookup [ operand ] .)
+    CID             reduce using rule 120 (map_lookup -> map_lookup [ operand ] .)
+    FOR             reduce using rule 120 (map_lookup -> map_lookup [ operand ] .)
+    IF              reduce using rule 120 (map_lookup -> map_lookup [ operand ] .)
+    (               reduce using rule 120 (map_lookup -> map_lookup [ operand ] .)
+    TYPEDEF         reduce using rule 120 (map_lookup -> map_lookup [ operand ] .)
+    ID              reduce using rule 120 (map_lookup -> map_lookup [ operand ] .)
+    NOT             reduce using rule 120 (map_lookup -> map_lookup [ operand ] .)
+    INT             reduce using rule 120 (map_lookup -> map_lookup [ operand ] .)
+    FLOAT           reduce using rule 120 (map_lookup -> map_lookup [ operand ] .)
+    NULL            reduce using rule 120 (map_lookup -> map_lookup [ operand ] .)
+    REGEX           reduce using rule 120 (map_lookup -> map_lookup [ operand ] .)
+    TRUE            reduce using rule 120 (map_lookup -> map_lookup [ operand ] .)
+    FALSE           reduce using rule 120 (map_lookup -> map_lookup [ operand ] .)
+    STRING          reduce using rule 120 (map_lookup -> map_lookup [ operand ] .)
+    FSTRING         reduce using rule 120 (map_lookup -> map_lookup [ operand ] .)
+    RSTRING         reduce using rule 120 (map_lookup -> map_lookup [ operand ] .)
+    MLS             reduce using rule 120 (map_lookup -> map_lookup [ operand ] .)
+    {               reduce using rule 120 (map_lookup -> map_lookup [ operand ] .)
+    $end            reduce using rule 120 (map_lookup -> map_lookup [ operand ] .)
+    )               reduce using rule 120 (map_lookup -> map_lookup [ operand ] .)
+    :               reduce using rule 120 (map_lookup -> map_lookup [ operand ] .)
+    ,               reduce using rule 120 (map_lookup -> map_lookup [ operand ] .)
+    ]               reduce using rule 120 (map_lookup -> map_lookup [ operand ] .)
+    ELSE            reduce using rule 120 (map_lookup -> map_lookup [ operand ] .)
+    ELIF            reduce using rule 120 (map_lookup -> map_lookup [ operand ] .)
+    END             reduce using rule 120 (map_lookup -> map_lookup [ operand ] .)
+    }               reduce using rule 120 (map_lookup -> map_lookup [ operand ] .)
 
 
-state 217
+state 222
 
     (94) typedef_inner -> TYPEDEF ID AS ns_ref . MATCHING expression
-    (173) ns_ref -> ns_ref . SEP ID
+    (181) ns_ref -> ns_ref . SEP ID
 
-    MATCHING        shift and go to state 270
-    SEP             shift and go to state 141
+    MATCHING        shift and go to state 279
+    SEP             shift and go to state 143
 
 
-state 218
+state 223
 
     (95) typedef_inner -> TYPEDEF CID AS constructor .
 
     MLS             reduce using rule 95 (typedef_inner -> TYPEDEF CID AS constructor .)
     ENTITY          reduce using rule 95 (typedef_inner -> TYPEDEF CID AS constructor .)
     IMPLEMENT       reduce using rule 95 (typedef_inner -> TYPEDEF CID AS constructor .)
     IMPLEMENTATION  reduce using rule 95 (typedef_inner -> TYPEDEF CID AS constructor .)
@@ -7437,178 +7803,291 @@
     INT             reduce using rule 95 (typedef_inner -> TYPEDEF CID AS constructor .)
     FLOAT           reduce using rule 95 (typedef_inner -> TYPEDEF CID AS constructor .)
     NULL            reduce using rule 95 (typedef_inner -> TYPEDEF CID AS constructor .)
     REGEX           reduce using rule 95 (typedef_inner -> TYPEDEF CID AS constructor .)
     TRUE            reduce using rule 95 (typedef_inner -> TYPEDEF CID AS constructor .)
     FALSE           reduce using rule 95 (typedef_inner -> TYPEDEF CID AS constructor .)
     STRING          reduce using rule 95 (typedef_inner -> TYPEDEF CID AS constructor .)
+    FSTRING         reduce using rule 95 (typedef_inner -> TYPEDEF CID AS constructor .)
     RSTRING         reduce using rule 95 (typedef_inner -> TYPEDEF CID AS constructor .)
     [               reduce using rule 95 (typedef_inner -> TYPEDEF CID AS constructor .)
     {               reduce using rule 95 (typedef_inner -> TYPEDEF CID AS constructor .)
     $end            reduce using rule 95 (typedef_inner -> TYPEDEF CID AS constructor .)
 
 
-state 219
+state 224
 
-    (120) constructor -> class_ref . ( param_list )
+    (121) constructor -> class_ref . ( param_list )
 
-    (               shift and go to state 68
+    (               shift and go to state 70
 
 
-state 220
+state 225
 
-    (122) function_call -> attr_ref ( function_param_list ) .
+    (123) function_call -> attr_ref ( function_param_list ) .
 
-    CMP_OP          reduce using rule 122 (function_call -> attr_ref ( function_param_list ) .)
-    IN              reduce using rule 122 (function_call -> attr_ref ( function_param_list ) .)
-    AND             reduce using rule 122 (function_call -> attr_ref ( function_param_list ) .)
-    OR              reduce using rule 122 (function_call -> attr_ref ( function_param_list ) .)
-    ?               reduce using rule 122 (function_call -> attr_ref ( function_param_list ) .)
-    ENTITY          reduce using rule 122 (function_call -> attr_ref ( function_param_list ) .)
-    IMPLEMENT       reduce using rule 122 (function_call -> attr_ref ( function_param_list ) .)
-    IMPLEMENTATION  reduce using rule 122 (function_call -> attr_ref ( function_param_list ) .)
-    INDEX           reduce using rule 122 (function_call -> attr_ref ( function_param_list ) .)
-    IMPORT          reduce using rule 122 (function_call -> attr_ref ( function_param_list ) .)
-    CID             reduce using rule 122 (function_call -> attr_ref ( function_param_list ) .)
-    FOR             reduce using rule 122 (function_call -> attr_ref ( function_param_list ) .)
-    IF              reduce using rule 122 (function_call -> attr_ref ( function_param_list ) .)
-    (               reduce using rule 122 (function_call -> attr_ref ( function_param_list ) .)
-    TYPEDEF         reduce using rule 122 (function_call -> attr_ref ( function_param_list ) .)
-    ID              reduce using rule 122 (function_call -> attr_ref ( function_param_list ) .)
-    NOT             reduce using rule 122 (function_call -> attr_ref ( function_param_list ) .)
-    INT             reduce using rule 122 (function_call -> attr_ref ( function_param_list ) .)
-    FLOAT           reduce using rule 122 (function_call -> attr_ref ( function_param_list ) .)
-    NULL            reduce using rule 122 (function_call -> attr_ref ( function_param_list ) .)
-    REGEX           reduce using rule 122 (function_call -> attr_ref ( function_param_list ) .)
-    TRUE            reduce using rule 122 (function_call -> attr_ref ( function_param_list ) .)
-    FALSE           reduce using rule 122 (function_call -> attr_ref ( function_param_list ) .)
-    STRING          reduce using rule 122 (function_call -> attr_ref ( function_param_list ) .)
-    RSTRING         reduce using rule 122 (function_call -> attr_ref ( function_param_list ) .)
-    MLS             reduce using rule 122 (function_call -> attr_ref ( function_param_list ) .)
-    [               reduce using rule 122 (function_call -> attr_ref ( function_param_list ) .)
-    {               reduce using rule 122 (function_call -> attr_ref ( function_param_list ) .)
-    $end            reduce using rule 122 (function_call -> attr_ref ( function_param_list ) .)
-    )               reduce using rule 122 (function_call -> attr_ref ( function_param_list ) .)
-    :               reduce using rule 122 (function_call -> attr_ref ( function_param_list ) .)
-    ,               reduce using rule 122 (function_call -> attr_ref ( function_param_list ) .)
-    ]               reduce using rule 122 (function_call -> attr_ref ( function_param_list ) .)
-    ELSE            reduce using rule 122 (function_call -> attr_ref ( function_param_list ) .)
-    ELIF            reduce using rule 122 (function_call -> attr_ref ( function_param_list ) .)
-    END             reduce using rule 122 (function_call -> attr_ref ( function_param_list ) .)
-    }               reduce using rule 122 (function_call -> attr_ref ( function_param_list ) .)
+    CMP_OP          reduce using rule 123 (function_call -> attr_ref ( function_param_list ) .)
+    IN              reduce using rule 123 (function_call -> attr_ref ( function_param_list ) .)
+    AND             reduce using rule 123 (function_call -> attr_ref ( function_param_list ) .)
+    OR              reduce using rule 123 (function_call -> attr_ref ( function_param_list ) .)
+    ?               reduce using rule 123 (function_call -> attr_ref ( function_param_list ) .)
+    ENTITY          reduce using rule 123 (function_call -> attr_ref ( function_param_list ) .)
+    IMPLEMENT       reduce using rule 123 (function_call -> attr_ref ( function_param_list ) .)
+    IMPLEMENTATION  reduce using rule 123 (function_call -> attr_ref ( function_param_list ) .)
+    INDEX           reduce using rule 123 (function_call -> attr_ref ( function_param_list ) .)
+    IMPORT          reduce using rule 123 (function_call -> attr_ref ( function_param_list ) .)
+    CID             reduce using rule 123 (function_call -> attr_ref ( function_param_list ) .)
+    FOR             reduce using rule 123 (function_call -> attr_ref ( function_param_list ) .)
+    IF              reduce using rule 123 (function_call -> attr_ref ( function_param_list ) .)
+    (               reduce using rule 123 (function_call -> attr_ref ( function_param_list ) .)
+    TYPEDEF         reduce using rule 123 (function_call -> attr_ref ( function_param_list ) .)
+    ID              reduce using rule 123 (function_call -> attr_ref ( function_param_list ) .)
+    NOT             reduce using rule 123 (function_call -> attr_ref ( function_param_list ) .)
+    INT             reduce using rule 123 (function_call -> attr_ref ( function_param_list ) .)
+    FLOAT           reduce using rule 123 (function_call -> attr_ref ( function_param_list ) .)
+    NULL            reduce using rule 123 (function_call -> attr_ref ( function_param_list ) .)
+    REGEX           reduce using rule 123 (function_call -> attr_ref ( function_param_list ) .)
+    TRUE            reduce using rule 123 (function_call -> attr_ref ( function_param_list ) .)
+    FALSE           reduce using rule 123 (function_call -> attr_ref ( function_param_list ) .)
+    STRING          reduce using rule 123 (function_call -> attr_ref ( function_param_list ) .)
+    FSTRING         reduce using rule 123 (function_call -> attr_ref ( function_param_list ) .)
+    RSTRING         reduce using rule 123 (function_call -> attr_ref ( function_param_list ) .)
+    MLS             reduce using rule 123 (function_call -> attr_ref ( function_param_list ) .)
+    [               reduce using rule 123 (function_call -> attr_ref ( function_param_list ) .)
+    {               reduce using rule 123 (function_call -> attr_ref ( function_param_list ) .)
+    $end            reduce using rule 123 (function_call -> attr_ref ( function_param_list ) .)
+    )               reduce using rule 123 (function_call -> attr_ref ( function_param_list ) .)
+    :               reduce using rule 123 (function_call -> attr_ref ( function_param_list ) .)
+    ,               reduce using rule 123 (function_call -> attr_ref ( function_param_list ) .)
+    ]               reduce using rule 123 (function_call -> attr_ref ( function_param_list ) .)
+    ELSE            reduce using rule 123 (function_call -> attr_ref ( function_param_list ) .)
+    ELIF            reduce using rule 123 (function_call -> attr_ref ( function_param_list ) .)
+    END             reduce using rule 123 (function_call -> attr_ref ( function_param_list ) .)
+    }               reduce using rule 123 (function_call -> attr_ref ( function_param_list ) .)
 
 
-state 221
+state 226
 
-    (117) map_lookup -> attr_ref [ operand ] .
+    (118) map_lookup -> attr_ref [ operand ] .
 
-    IS              reduce using rule 117 (map_lookup -> attr_ref [ operand ] .)
-    [               reduce using rule 117 (map_lookup -> attr_ref [ operand ] .)
-    CMP_OP          reduce using rule 117 (map_lookup -> attr_ref [ operand ] .)
-    IN              reduce using rule 117 (map_lookup -> attr_ref [ operand ] .)
-    AND             reduce using rule 117 (map_lookup -> attr_ref [ operand ] .)
-    OR              reduce using rule 117 (map_lookup -> attr_ref [ operand ] .)
-    ?               reduce using rule 117 (map_lookup -> attr_ref [ operand ] .)
-    ENTITY          reduce using rule 117 (map_lookup -> attr_ref [ operand ] .)
-    IMPLEMENT       reduce using rule 117 (map_lookup -> attr_ref [ operand ] .)
-    IMPLEMENTATION  reduce using rule 117 (map_lookup -> attr_ref [ operand ] .)
-    INDEX           reduce using rule 117 (map_lookup -> attr_ref [ operand ] .)
-    IMPORT          reduce using rule 117 (map_lookup -> attr_ref [ operand ] .)
-    CID             reduce using rule 117 (map_lookup -> attr_ref [ operand ] .)
-    FOR             reduce using rule 117 (map_lookup -> attr_ref [ operand ] .)
-    IF              reduce using rule 117 (map_lookup -> attr_ref [ operand ] .)
-    (               reduce using rule 117 (map_lookup -> attr_ref [ operand ] .)
-    TYPEDEF         reduce using rule 117 (map_lookup -> attr_ref [ operand ] .)
-    ID              reduce using rule 117 (map_lookup -> attr_ref [ operand ] .)
-    NOT             reduce using rule 117 (map_lookup -> attr_ref [ operand ] .)
-    INT             reduce using rule 117 (map_lookup -> attr_ref [ operand ] .)
-    FLOAT           reduce using rule 117 (map_lookup -> attr_ref [ operand ] .)
-    NULL            reduce using rule 117 (map_lookup -> attr_ref [ operand ] .)
-    REGEX           reduce using rule 117 (map_lookup -> attr_ref [ operand ] .)
-    TRUE            reduce using rule 117 (map_lookup -> attr_ref [ operand ] .)
-    FALSE           reduce using rule 117 (map_lookup -> attr_ref [ operand ] .)
-    STRING          reduce using rule 117 (map_lookup -> attr_ref [ operand ] .)
-    RSTRING         reduce using rule 117 (map_lookup -> attr_ref [ operand ] .)
-    MLS             reduce using rule 117 (map_lookup -> attr_ref [ operand ] .)
-    {               reduce using rule 117 (map_lookup -> attr_ref [ operand ] .)
-    $end            reduce using rule 117 (map_lookup -> attr_ref [ operand ] .)
-    )               reduce using rule 117 (map_lookup -> attr_ref [ operand ] .)
-    :               reduce using rule 117 (map_lookup -> attr_ref [ operand ] .)
-    ,               reduce using rule 117 (map_lookup -> attr_ref [ operand ] .)
-    ]               reduce using rule 117 (map_lookup -> attr_ref [ operand ] .)
-    ELSE            reduce using rule 117 (map_lookup -> attr_ref [ operand ] .)
-    ELIF            reduce using rule 117 (map_lookup -> attr_ref [ operand ] .)
-    END             reduce using rule 117 (map_lookup -> attr_ref [ operand ] .)
-    }               reduce using rule 117 (map_lookup -> attr_ref [ operand ] .)
+    IS              reduce using rule 118 (map_lookup -> attr_ref [ operand ] .)
+    [               reduce using rule 118 (map_lookup -> attr_ref [ operand ] .)
+    CMP_OP          reduce using rule 118 (map_lookup -> attr_ref [ operand ] .)
+    IN              reduce using rule 118 (map_lookup -> attr_ref [ operand ] .)
+    AND             reduce using rule 118 (map_lookup -> attr_ref [ operand ] .)
+    OR              reduce using rule 118 (map_lookup -> attr_ref [ operand ] .)
+    ?               reduce using rule 118 (map_lookup -> attr_ref [ operand ] .)
+    ENTITY          reduce using rule 118 (map_lookup -> attr_ref [ operand ] .)
+    IMPLEMENT       reduce using rule 118 (map_lookup -> attr_ref [ operand ] .)
+    IMPLEMENTATION  reduce using rule 118 (map_lookup -> attr_ref [ operand ] .)
+    INDEX           reduce using rule 118 (map_lookup -> attr_ref [ operand ] .)
+    IMPORT          reduce using rule 118 (map_lookup -> attr_ref [ operand ] .)
+    CID             reduce using rule 118 (map_lookup -> attr_ref [ operand ] .)
+    FOR             reduce using rule 118 (map_lookup -> attr_ref [ operand ] .)
+    IF              reduce using rule 118 (map_lookup -> attr_ref [ operand ] .)
+    (               reduce using rule 118 (map_lookup -> attr_ref [ operand ] .)
+    TYPEDEF         reduce using rule 118 (map_lookup -> attr_ref [ operand ] .)
+    ID              reduce using rule 118 (map_lookup -> attr_ref [ operand ] .)
+    NOT             reduce using rule 118 (map_lookup -> attr_ref [ operand ] .)
+    INT             reduce using rule 118 (map_lookup -> attr_ref [ operand ] .)
+    FLOAT           reduce using rule 118 (map_lookup -> attr_ref [ operand ] .)
+    NULL            reduce using rule 118 (map_lookup -> attr_ref [ operand ] .)
+    REGEX           reduce using rule 118 (map_lookup -> attr_ref [ operand ] .)
+    TRUE            reduce using rule 118 (map_lookup -> attr_ref [ operand ] .)
+    FALSE           reduce using rule 118 (map_lookup -> attr_ref [ operand ] .)
+    STRING          reduce using rule 118 (map_lookup -> attr_ref [ operand ] .)
+    FSTRING         reduce using rule 118 (map_lookup -> attr_ref [ operand ] .)
+    RSTRING         reduce using rule 118 (map_lookup -> attr_ref [ operand ] .)
+    MLS             reduce using rule 118 (map_lookup -> attr_ref [ operand ] .)
+    {               reduce using rule 118 (map_lookup -> attr_ref [ operand ] .)
+    $end            reduce using rule 118 (map_lookup -> attr_ref [ operand ] .)
+    )               reduce using rule 118 (map_lookup -> attr_ref [ operand ] .)
+    :               reduce using rule 118 (map_lookup -> attr_ref [ operand ] .)
+    ,               reduce using rule 118 (map_lookup -> attr_ref [ operand ] .)
+    ]               reduce using rule 118 (map_lookup -> attr_ref [ operand ] .)
+    ELSE            reduce using rule 118 (map_lookup -> attr_ref [ operand ] .)
+    ELIF            reduce using rule 118 (map_lookup -> attr_ref [ operand ] .)
+    END             reduce using rule 118 (map_lookup -> attr_ref [ operand ] .)
+    }               reduce using rule 118 (map_lookup -> attr_ref [ operand ] .)
 
 
-state 222
+state 227
 
-    (132) index_lookup -> attr_ref [ param_list ] .
+    (139) index_lookup -> attr_ref [ param_list ] .
 
-    CMP_OP          reduce using rule 132 (index_lookup -> attr_ref [ param_list ] .)
-    IN              reduce using rule 132 (index_lookup -> attr_ref [ param_list ] .)
-    AND             reduce using rule 132 (index_lookup -> attr_ref [ param_list ] .)
-    OR              reduce using rule 132 (index_lookup -> attr_ref [ param_list ] .)
-    ?               reduce using rule 132 (index_lookup -> attr_ref [ param_list ] .)
-    ENTITY          reduce using rule 132 (index_lookup -> attr_ref [ param_list ] .)
-    IMPLEMENT       reduce using rule 132 (index_lookup -> attr_ref [ param_list ] .)
-    IMPLEMENTATION  reduce using rule 132 (index_lookup -> attr_ref [ param_list ] .)
-    INDEX           reduce using rule 132 (index_lookup -> attr_ref [ param_list ] .)
-    IMPORT          reduce using rule 132 (index_lookup -> attr_ref [ param_list ] .)
-    CID             reduce using rule 132 (index_lookup -> attr_ref [ param_list ] .)
-    FOR             reduce using rule 132 (index_lookup -> attr_ref [ param_list ] .)
-    IF              reduce using rule 132 (index_lookup -> attr_ref [ param_list ] .)
-    (               reduce using rule 132 (index_lookup -> attr_ref [ param_list ] .)
-    TYPEDEF         reduce using rule 132 (index_lookup -> attr_ref [ param_list ] .)
-    ID              reduce using rule 132 (index_lookup -> attr_ref [ param_list ] .)
-    NOT             reduce using rule 132 (index_lookup -> attr_ref [ param_list ] .)
-    INT             reduce using rule 132 (index_lookup -> attr_ref [ param_list ] .)
-    FLOAT           reduce using rule 132 (index_lookup -> attr_ref [ param_list ] .)
-    NULL            reduce using rule 132 (index_lookup -> attr_ref [ param_list ] .)
-    REGEX           reduce using rule 132 (index_lookup -> attr_ref [ param_list ] .)
-    TRUE            reduce using rule 132 (index_lookup -> attr_ref [ param_list ] .)
-    FALSE           reduce using rule 132 (index_lookup -> attr_ref [ param_list ] .)
-    STRING          reduce using rule 132 (index_lookup -> attr_ref [ param_list ] .)
-    RSTRING         reduce using rule 132 (index_lookup -> attr_ref [ param_list ] .)
-    MLS             reduce using rule 132 (index_lookup -> attr_ref [ param_list ] .)
-    [               reduce using rule 132 (index_lookup -> attr_ref [ param_list ] .)
-    {               reduce using rule 132 (index_lookup -> attr_ref [ param_list ] .)
-    $end            reduce using rule 132 (index_lookup -> attr_ref [ param_list ] .)
-    )               reduce using rule 132 (index_lookup -> attr_ref [ param_list ] .)
-    :               reduce using rule 132 (index_lookup -> attr_ref [ param_list ] .)
-    ,               reduce using rule 132 (index_lookup -> attr_ref [ param_list ] .)
-    ]               reduce using rule 132 (index_lookup -> attr_ref [ param_list ] .)
-    ELSE            reduce using rule 132 (index_lookup -> attr_ref [ param_list ] .)
-    ELIF            reduce using rule 132 (index_lookup -> attr_ref [ param_list ] .)
-    END             reduce using rule 132 (index_lookup -> attr_ref [ param_list ] .)
-    }               reduce using rule 132 (index_lookup -> attr_ref [ param_list ] .)
+    CMP_OP          reduce using rule 139 (index_lookup -> attr_ref [ param_list ] .)
+    IN              reduce using rule 139 (index_lookup -> attr_ref [ param_list ] .)
+    AND             reduce using rule 139 (index_lookup -> attr_ref [ param_list ] .)
+    OR              reduce using rule 139 (index_lookup -> attr_ref [ param_list ] .)
+    ?               reduce using rule 139 (index_lookup -> attr_ref [ param_list ] .)
+    ENTITY          reduce using rule 139 (index_lookup -> attr_ref [ param_list ] .)
+    IMPLEMENT       reduce using rule 139 (index_lookup -> attr_ref [ param_list ] .)
+    IMPLEMENTATION  reduce using rule 139 (index_lookup -> attr_ref [ param_list ] .)
+    INDEX           reduce using rule 139 (index_lookup -> attr_ref [ param_list ] .)
+    IMPORT          reduce using rule 139 (index_lookup -> attr_ref [ param_list ] .)
+    CID             reduce using rule 139 (index_lookup -> attr_ref [ param_list ] .)
+    FOR             reduce using rule 139 (index_lookup -> attr_ref [ param_list ] .)
+    IF              reduce using rule 139 (index_lookup -> attr_ref [ param_list ] .)
+    (               reduce using rule 139 (index_lookup -> attr_ref [ param_list ] .)
+    TYPEDEF         reduce using rule 139 (index_lookup -> attr_ref [ param_list ] .)
+    ID              reduce using rule 139 (index_lookup -> attr_ref [ param_list ] .)
+    NOT             reduce using rule 139 (index_lookup -> attr_ref [ param_list ] .)
+    INT             reduce using rule 139 (index_lookup -> attr_ref [ param_list ] .)
+    FLOAT           reduce using rule 139 (index_lookup -> attr_ref [ param_list ] .)
+    NULL            reduce using rule 139 (index_lookup -> attr_ref [ param_list ] .)
+    REGEX           reduce using rule 139 (index_lookup -> attr_ref [ param_list ] .)
+    TRUE            reduce using rule 139 (index_lookup -> attr_ref [ param_list ] .)
+    FALSE           reduce using rule 139 (index_lookup -> attr_ref [ param_list ] .)
+    STRING          reduce using rule 139 (index_lookup -> attr_ref [ param_list ] .)
+    FSTRING         reduce using rule 139 (index_lookup -> attr_ref [ param_list ] .)
+    RSTRING         reduce using rule 139 (index_lookup -> attr_ref [ param_list ] .)
+    MLS             reduce using rule 139 (index_lookup -> attr_ref [ param_list ] .)
+    [               reduce using rule 139 (index_lookup -> attr_ref [ param_list ] .)
+    {               reduce using rule 139 (index_lookup -> attr_ref [ param_list ] .)
+    $end            reduce using rule 139 (index_lookup -> attr_ref [ param_list ] .)
+    )               reduce using rule 139 (index_lookup -> attr_ref [ param_list ] .)
+    :               reduce using rule 139 (index_lookup -> attr_ref [ param_list ] .)
+    ,               reduce using rule 139 (index_lookup -> attr_ref [ param_list ] .)
+    ]               reduce using rule 139 (index_lookup -> attr_ref [ param_list ] .)
+    ELSE            reduce using rule 139 (index_lookup -> attr_ref [ param_list ] .)
+    ELIF            reduce using rule 139 (index_lookup -> attr_ref [ param_list ] .)
+    END             reduce using rule 139 (index_lookup -> attr_ref [ param_list ] .)
+    }               reduce using rule 139 (index_lookup -> attr_ref [ param_list ] .)
 
 
-state 223
+state 228
 
-    (160) operand_list -> operand , operand_list .
+    (125) list_comprehension -> [ expression list_comprehension_for list_comprehension_guard . ]
 
-    ]               reduce using rule 160 (operand_list -> operand , operand_list .)
-    CID             reduce using rule 160 (operand_list -> operand , operand_list .)
-    ID              reduce using rule 160 (operand_list -> operand , operand_list .)
+    ]               shift and go to state 280
 
 
-state 224
+state 229
+
+    (129) list_comprehension_guard -> empty .
 
-    (126) pair_list -> dict_key : operand . , pair_list
-    (127) pair_list -> dict_key : operand . empty pair_list_empty
+    ]               reduce using rule 129 (list_comprehension_guard -> empty .)
+
+
+state 230
+
+    (130) list_comprehension_guard -> IF . expression list_comprehension_guard
+    (97) expression -> . boolean_expression
+    (98) expression -> . constant
+    (99) expression -> . function_call
+    (100) expression -> . var_ref
+    (101) expression -> . constructor
+    (102) expression -> . list_def
+    (103) expression -> . list_comprehension
+    (104) expression -> . map_def
+    (105) expression -> . map_lookup
+    (106) expression -> . index_lookup
+    (107) expression -> . conditional_expression
+    (108) expression -> . ( expression )
+    (109) boolean_expression -> . expression CMP_OP expression
+    (110) boolean_expression -> . expression IN expression
+    (111) boolean_expression -> . expression AND expression
+    (112) boolean_expression -> . expression OR expression
+    (113) boolean_expression -> . NOT expression
+    (114) boolean_expression -> . var_ref . ID IS DEFINED
+    (115) boolean_expression -> . ID IS DEFINED
+    (116) boolean_expression -> . map_lookup IS DEFINED
+    (141) constant -> . INT
+    (142) constant -> . FLOAT
+    (143) constant -> . NULL
+    (144) constant -> . REGEX
+    (145) constant -> . TRUE
+    (146) constant -> . FALSE
+    (147) constant -> . STRING
+    (148) constant -> . FSTRING
+    (149) constant -> . RSTRING
+    (150) constant -> . MLS
+    (122) function_call -> . ns_ref ( function_param_list )
+    (123) function_call -> . attr_ref ( function_param_list )
+    (171) var_ref -> . attr_ref
+    (173) var_ref -> . ns_ref
+    (121) constructor -> . class_ref ( param_list )
+    (124) list_def -> . [ operand_list ]
+    (125) list_comprehension -> . [ expression list_comprehension_for list_comprehension_guard ]
+    (137) map_def -> . { pair_list }
+    (118) map_lookup -> . attr_ref [ operand ]
+    (119) map_lookup -> . var_ref [ operand ]
+    (120) map_lookup -> . map_lookup [ operand ]
+    (138) index_lookup -> . class_ref [ param_list ]
+    (139) index_lookup -> . attr_ref [ param_list ]
+    (140) conditional_expression -> . expression ? expression : expression
+    (181) ns_ref -> . ns_ref SEP ID
+    (182) ns_ref -> . ID
+    (172) attr_ref -> . var_ref . ID
+    (174) class_ref -> . CID
+    (175) class_ref -> . ns_ref SEP CID
+    (176) class_ref -> . var_ref . CID
+
+    (               shift and go to state 30
+    NOT             shift and go to state 47
+    ID              shift and go to state 84
+    INT             shift and go to state 48
+    FLOAT           shift and go to state 49
+    NULL            shift and go to state 50
+    REGEX           shift and go to state 51
+    TRUE            shift and go to state 52
+    FALSE           shift and go to state 53
+    STRING          shift and go to state 54
+    FSTRING         shift and go to state 55
+    RSTRING         shift and go to state 56
+    MLS             shift and go to state 20
+    [               shift and go to state 57
+    {               shift and go to state 58
+    CID             shift and go to state 16
+
+    expression                     shift and go to state 281
+    boolean_expression             shift and go to state 35
+    constant                       shift and go to state 36
+    function_call                  shift and go to state 37
+    var_ref                        shift and go to state 83
+    constructor                    shift and go to state 38
+    list_def                       shift and go to state 39
+    list_comprehension             shift and go to state 40
+    map_def                        shift and go to state 41
+    map_lookup                     shift and go to state 42
+    index_lookup                   shift and go to state 43
+    conditional_expression         shift and go to state 44
+    ns_ref                         shift and go to state 85
+    attr_ref                       shift and go to state 86
+    class_ref                      shift and go to state 87
+
+state 231
+
+    (127) list_comprehension_for -> FOR ID . IN expression list_comprehension_for_empty
+    (128) list_comprehension_for -> FOR ID . IN expression list_comprehension_for
+
+    IN              shift and go to state 282
+
+
+state 232
+
+    (168) operand_list -> operand , operand_list .
+
+    ]               reduce using rule 168 (operand_list -> operand , operand_list .)
+    CID             reduce using rule 168 (operand_list -> operand , operand_list .)
+    ID              reduce using rule 168 (operand_list -> operand , operand_list .)
+
+
+state 233
+
+    (133) pair_list -> dict_key : operand . , pair_list
+    (134) pair_list -> dict_key : operand . empty pair_list_empty
     (14) empty -> .
 
-    ,               shift and go to state 271
+    ,               shift and go to state 283
     }               reduce using rule 14 (empty -> .)
 
-    empty                          shift and go to state 272
+    empty                          shift and go to state 284
 
-state 225
+state 234
 
     (35) entity_body_outer -> MLS entity_body . END
     (39) entity_body -> entity_body . attr
     (48) attr -> . attr_type CID empty
     (49) attr -> . attr_type CID = constant
     (50) attr -> . attr_type CID = constant_list
     (51) attr -> . attr_type CID = UNDEF
@@ -7631,29 +8110,29 @@
     (45) attr_type -> . attr_type_opt
     (46) attr_type -> . attr_type_multi
     (47) attr_type -> . attr_base_type
     (43) attr_type_opt -> . attr_type_multi ?
     (44) attr_type_opt -> . attr_base_type ?
     (42) attr_type_multi -> . attr_base_type [ ]
     (41) attr_base_type -> . ns_ref
-    (173) ns_ref -> . ns_ref SEP ID
-    (174) ns_ref -> . ID
+    (181) ns_ref -> . ns_ref SEP ID
+    (182) ns_ref -> . ID
+
+    END             shift and go to state 285
+    DICT            shift and go to state 180
+    ID              shift and go to state 66
 
-    END             shift and go to state 273
-    DICT            shift and go to state 175
-    ID              shift and go to state 64
-
-    attr                           shift and go to state 228
-    attr_type                      shift and go to state 174
-    attr_type_opt                  shift and go to state 176
-    attr_type_multi                shift and go to state 177
-    attr_base_type                 shift and go to state 178
-    ns_ref                         shift and go to state 179
+    attr                           shift and go to state 237
+    attr_type                      shift and go to state 179
+    attr_type_opt                  shift and go to state 181
+    attr_type_multi                shift and go to state 182
+    attr_base_type                 shift and go to state 183
+    ns_ref                         shift and go to state 184
 
-state 226
+state 235
 
     (38) entity_body_outer -> MLS END .
 
     ENTITY          reduce using rule 38 (entity_body_outer -> MLS END .)
     IMPLEMENT       reduce using rule 38 (entity_body_outer -> MLS END .)
     IMPLEMENTATION  reduce using rule 38 (entity_body_outer -> MLS END .)
     INDEX           reduce using rule 38 (entity_body_outer -> MLS END .)
@@ -7668,22 +8147,23 @@
     INT             reduce using rule 38 (entity_body_outer -> MLS END .)
     FLOAT           reduce using rule 38 (entity_body_outer -> MLS END .)
     NULL            reduce using rule 38 (entity_body_outer -> MLS END .)
     REGEX           reduce using rule 38 (entity_body_outer -> MLS END .)
     TRUE            reduce using rule 38 (entity_body_outer -> MLS END .)
     FALSE           reduce using rule 38 (entity_body_outer -> MLS END .)
     STRING          reduce using rule 38 (entity_body_outer -> MLS END .)
+    FSTRING         reduce using rule 38 (entity_body_outer -> MLS END .)
     RSTRING         reduce using rule 38 (entity_body_outer -> MLS END .)
     MLS             reduce using rule 38 (entity_body_outer -> MLS END .)
     [               reduce using rule 38 (entity_body_outer -> MLS END .)
     {               reduce using rule 38 (entity_body_outer -> MLS END .)
     $end            reduce using rule 38 (entity_body_outer -> MLS END .)
 
 
-state 227
+state 236
 
     (36) entity_body_outer -> entity_body END .
 
     ENTITY          reduce using rule 36 (entity_body_outer -> entity_body END .)
     IMPLEMENT       reduce using rule 36 (entity_body_outer -> entity_body END .)
     IMPLEMENTATION  reduce using rule 36 (entity_body_outer -> entity_body END .)
     INDEX           reduce using rule 36 (entity_body_outer -> entity_body END .)
@@ -7698,116 +8178,117 @@
     INT             reduce using rule 36 (entity_body_outer -> entity_body END .)
     FLOAT           reduce using rule 36 (entity_body_outer -> entity_body END .)
     NULL            reduce using rule 36 (entity_body_outer -> entity_body END .)
     REGEX           reduce using rule 36 (entity_body_outer -> entity_body END .)
     TRUE            reduce using rule 36 (entity_body_outer -> entity_body END .)
     FALSE           reduce using rule 36 (entity_body_outer -> entity_body END .)
     STRING          reduce using rule 36 (entity_body_outer -> entity_body END .)
+    FSTRING         reduce using rule 36 (entity_body_outer -> entity_body END .)
     RSTRING         reduce using rule 36 (entity_body_outer -> entity_body END .)
     MLS             reduce using rule 36 (entity_body_outer -> entity_body END .)
     [               reduce using rule 36 (entity_body_outer -> entity_body END .)
     {               reduce using rule 36 (entity_body_outer -> entity_body END .)
     $end            reduce using rule 36 (entity_body_outer -> entity_body END .)
 
 
-state 228
+state 237
 
     (39) entity_body -> entity_body attr .
 
     END             reduce using rule 39 (entity_body -> entity_body attr .)
     DICT            reduce using rule 39 (entity_body -> entity_body attr .)
     ID              reduce using rule 39 (entity_body -> entity_body attr .)
 
 
-state 229
+state 238
 
     (48) attr -> attr_type CID . empty
     (49) attr -> attr_type CID . = constant
     (50) attr -> attr_type CID . = constant_list
     (51) attr -> attr_type CID . = UNDEF
     (14) empty -> .
 
-    =               shift and go to state 275
+    =               shift and go to state 287
     END             reduce using rule 14 (empty -> .)
     DICT            reduce using rule 14 (empty -> .)
     ID              reduce using rule 14 (empty -> .)
 
-    empty                          shift and go to state 274
+    empty                          shift and go to state 286
 
-state 230
+state 239
 
     (52) attr -> attr_type ID .
     (53) attr -> attr_type ID . = constant
     (54) attr -> attr_type ID . = constant_list
     (55) attr -> attr_type ID . = UNDEF
 
     END             reduce using rule 52 (attr -> attr_type ID .)
     DICT            reduce using rule 52 (attr -> attr_type ID .)
     ID              reduce using rule 52 (attr -> attr_type ID .)
-    =               shift and go to state 276
+    =               shift and go to state 288
 
 
-state 231
+state 240
 
     (56) attr -> DICT empty . CID empty
     (57) attr -> DICT empty . CID = map_def
     (58) attr -> DICT empty . CID = NULL
 
-    CID             shift and go to state 277
+    CID             shift and go to state 289
 
 
-state 232
+state 241
 
     (59) attr -> DICT ? . CID empty
     (60) attr -> DICT ? . CID = map_def
     (61) attr -> DICT ? . CID = NULL
     (65) attr -> DICT ? . ID
     (66) attr -> DICT ? . ID = map_def
     (67) attr -> DICT ? . ID = NULL
 
-    CID             shift and go to state 278
-    ID              shift and go to state 279
+    CID             shift and go to state 290
+    ID              shift and go to state 291
 
 
-state 233
+state 242
 
     (62) attr -> DICT ID .
     (63) attr -> DICT ID . = map_def
     (64) attr -> DICT ID . = NULL
 
     END             reduce using rule 62 (attr -> DICT ID .)
     DICT            reduce using rule 62 (attr -> DICT ID .)
     ID              reduce using rule 62 (attr -> DICT ID .)
-    =               shift and go to state 280
+    =               shift and go to state 292
 
 
-state 234
+state 243
 
     (43) attr_type_opt -> attr_type_multi ? .
 
     CID             reduce using rule 43 (attr_type_opt -> attr_type_multi ? .)
     ID              reduce using rule 43 (attr_type_opt -> attr_type_multi ? .)
 
 
-state 235
+state 244
 
     (44) attr_type_opt -> attr_base_type ? .
 
     CID             reduce using rule 44 (attr_type_opt -> attr_base_type ? .)
     ID              reduce using rule 44 (attr_type_opt -> attr_base_type ? .)
 
 
-state 236
+state 245
 
     (42) attr_type_multi -> attr_base_type [ . ]
 
-    ]               shift and go to state 281
+    ]               shift and go to state 293
 
 
-state 237
+state 246
 
     (33) entity_def -> ENTITY CID EXTENDS class_ref_list : . entity_body_outer
     (35) entity_body_outer -> . MLS entity_body END
     (36) entity_body_outer -> . entity_body END
     (37) entity_body_outer -> . END
     (38) entity_body_outer -> . MLS END
     (39) entity_body -> . entity_body attr
@@ -7835,82 +8316,82 @@
     (45) attr_type -> . attr_type_opt
     (46) attr_type -> . attr_type_multi
     (47) attr_type -> . attr_base_type
     (43) attr_type_opt -> . attr_type_multi ?
     (44) attr_type_opt -> . attr_base_type ?
     (42) attr_type_multi -> . attr_base_type [ ]
     (41) attr_base_type -> . ns_ref
-    (173) ns_ref -> . ns_ref SEP ID
-    (174) ns_ref -> . ID
+    (181) ns_ref -> . ns_ref SEP ID
+    (182) ns_ref -> . ID
 
-    MLS             shift and go to state 170
-    END             shift and go to state 172
-    DICT            shift and go to state 175
-    ID              shift and go to state 64
-
-    entity_body_outer              shift and go to state 282
-    entity_body                    shift and go to state 171
-    attr                           shift and go to state 173
-    attr_type                      shift and go to state 174
-    attr_type_opt                  shift and go to state 176
-    attr_type_multi                shift and go to state 177
-    attr_base_type                 shift and go to state 178
-    ns_ref                         shift and go to state 179
+    MLS             shift and go to state 175
+    END             shift and go to state 177
+    DICT            shift and go to state 180
+    ID              shift and go to state 66
 
-state 238
+    entity_body_outer              shift and go to state 294
+    entity_body                    shift and go to state 176
+    attr                           shift and go to state 178
+    attr_type                      shift and go to state 179
+    attr_type_opt                  shift and go to state 181
+    attr_type_multi                shift and go to state 182
+    attr_base_type                 shift and go to state 183
+    ns_ref                         shift and go to state 184
 
-    (169) class_ref_list -> class_ref , . class_ref_list
-    (169) class_ref_list -> . class_ref , class_ref_list
-    (170) class_ref_list -> . var_ref , class_ref_list
-    (171) class_ref_list -> . class_ref
-    (172) class_ref_list -> . var_ref
-    (166) class_ref -> . CID
-    (167) class_ref -> . ns_ref SEP CID
-    (168) class_ref -> . var_ref . CID
-    (163) var_ref -> . attr_ref
-    (165) var_ref -> . ns_ref
-    (173) ns_ref -> . ns_ref SEP ID
-    (174) ns_ref -> . ID
-    (164) attr_ref -> . var_ref . ID
-
-    CID             shift and go to state 16
-    ID              shift and go to state 64
-
-    class_ref                      shift and go to state 181
-    class_ref_list                 shift and go to state 283
-    var_ref                        shift and go to state 182
-    ns_ref                         shift and go to state 183
-    attr_ref                       shift and go to state 65
+state 247
 
-state 239
+    (177) class_ref_list -> class_ref , . class_ref_list
+    (177) class_ref_list -> . class_ref , class_ref_list
+    (178) class_ref_list -> . var_ref , class_ref_list
+    (179) class_ref_list -> . class_ref
+    (180) class_ref_list -> . var_ref
+    (174) class_ref -> . CID
+    (175) class_ref -> . ns_ref SEP CID
+    (176) class_ref -> . var_ref . CID
+    (171) var_ref -> . attr_ref
+    (173) var_ref -> . ns_ref
+    (181) ns_ref -> . ns_ref SEP ID
+    (182) ns_ref -> . ID
+    (172) attr_ref -> . var_ref . ID
+
+    CID             shift and go to state 16
+    ID              shift and go to state 66
 
-    (170) class_ref_list -> var_ref , . class_ref_list
-    (169) class_ref_list -> . class_ref , class_ref_list
-    (170) class_ref_list -> . var_ref , class_ref_list
-    (171) class_ref_list -> . class_ref
-    (172) class_ref_list -> . var_ref
-    (166) class_ref -> . CID
-    (167) class_ref -> . ns_ref SEP CID
-    (168) class_ref -> . var_ref . CID
-    (163) var_ref -> . attr_ref
-    (165) var_ref -> . ns_ref
-    (173) ns_ref -> . ns_ref SEP ID
-    (174) ns_ref -> . ID
-    (164) attr_ref -> . var_ref . ID
-
-    CID             shift and go to state 16
-    ID              shift and go to state 64
-
-    var_ref                        shift and go to state 182
-    class_ref_list                 shift and go to state 284
-    class_ref                      shift and go to state 181
-    ns_ref                         shift and go to state 183
-    attr_ref                       shift and go to state 65
+    class_ref                      shift and go to state 186
+    class_ref_list                 shift and go to state 295
+    var_ref                        shift and go to state 187
+    ns_ref                         shift and go to state 188
+    attr_ref                       shift and go to state 67
 
-state 240
+state 248
+
+    (178) class_ref_list -> var_ref , . class_ref_list
+    (177) class_ref_list -> . class_ref , class_ref_list
+    (178) class_ref_list -> . var_ref , class_ref_list
+    (179) class_ref_list -> . class_ref
+    (180) class_ref_list -> . var_ref
+    (174) class_ref -> . CID
+    (175) class_ref -> . ns_ref SEP CID
+    (176) class_ref -> . var_ref . CID
+    (171) var_ref -> . attr_ref
+    (173) var_ref -> . ns_ref
+    (181) ns_ref -> . ns_ref SEP ID
+    (182) ns_ref -> . ID
+    (172) attr_ref -> . var_ref . ID
+
+    CID             shift and go to state 16
+    ID              shift and go to state 66
+
+    var_ref                        shift and go to state 187
+    class_ref_list                 shift and go to state 296
+    class_ref                      shift and go to state 186
+    ns_ref                         shift and go to state 188
+    attr_ref                       shift and go to state 67
+
+state 249
 
     (34) entity_def -> ENTITY ID EXTENDS class_ref_list : . entity_body_outer
     (35) entity_body_outer -> . MLS entity_body END
     (36) entity_body_outer -> . entity_body END
     (37) entity_body_outer -> . END
     (38) entity_body_outer -> . MLS END
     (39) entity_body -> . entity_body attr
@@ -7938,32 +8419,32 @@
     (45) attr_type -> . attr_type_opt
     (46) attr_type -> . attr_type_multi
     (47) attr_type -> . attr_base_type
     (43) attr_type_opt -> . attr_type_multi ?
     (44) attr_type_opt -> . attr_base_type ?
     (42) attr_type_multi -> . attr_base_type [ ]
     (41) attr_base_type -> . ns_ref
-    (173) ns_ref -> . ns_ref SEP ID
-    (174) ns_ref -> . ID
+    (181) ns_ref -> . ns_ref SEP ID
+    (182) ns_ref -> . ID
+
+    MLS             shift and go to state 175
+    END             shift and go to state 177
+    DICT            shift and go to state 180
+    ID              shift and go to state 66
 
-    MLS             shift and go to state 170
-    END             shift and go to state 172
-    DICT            shift and go to state 175
-    ID              shift and go to state 64
-
-    entity_body_outer              shift and go to state 285
-    entity_body                    shift and go to state 171
-    attr                           shift and go to state 173
-    attr_type                      shift and go to state 174
-    attr_type_opt                  shift and go to state 176
-    attr_type_multi                shift and go to state 177
-    attr_base_type                 shift and go to state 178
-    ns_ref                         shift and go to state 179
+    entity_body_outer              shift and go to state 297
+    entity_body                    shift and go to state 176
+    attr                           shift and go to state 178
+    attr_type                      shift and go to state 179
+    attr_type_opt                  shift and go to state 181
+    attr_type_multi                shift and go to state 182
+    attr_base_type                 shift and go to state 183
+    ns_ref                         shift and go to state 184
 
-state 241
+state 250
 
     (71) implement_def -> IMPLEMENT class_ref USING implement_ns_list empty .
 
     ENTITY          reduce using rule 71 (implement_def -> IMPLEMENT class_ref USING implement_ns_list empty .)
     IMPLEMENT       reduce using rule 71 (implement_def -> IMPLEMENT class_ref USING implement_ns_list empty .)
     IMPLEMENTATION  reduce using rule 71 (implement_def -> IMPLEMENT class_ref USING implement_ns_list empty .)
     INDEX           reduce using rule 71 (implement_def -> IMPLEMENT class_ref USING implement_ns_list empty .)
@@ -7978,22 +8459,23 @@
     INT             reduce using rule 71 (implement_def -> IMPLEMENT class_ref USING implement_ns_list empty .)
     FLOAT           reduce using rule 71 (implement_def -> IMPLEMENT class_ref USING implement_ns_list empty .)
     NULL            reduce using rule 71 (implement_def -> IMPLEMENT class_ref USING implement_ns_list empty .)
     REGEX           reduce using rule 71 (implement_def -> IMPLEMENT class_ref USING implement_ns_list empty .)
     TRUE            reduce using rule 71 (implement_def -> IMPLEMENT class_ref USING implement_ns_list empty .)
     FALSE           reduce using rule 71 (implement_def -> IMPLEMENT class_ref USING implement_ns_list empty .)
     STRING          reduce using rule 71 (implement_def -> IMPLEMENT class_ref USING implement_ns_list empty .)
+    FSTRING         reduce using rule 71 (implement_def -> IMPLEMENT class_ref USING implement_ns_list empty .)
     RSTRING         reduce using rule 71 (implement_def -> IMPLEMENT class_ref USING implement_ns_list empty .)
     MLS             reduce using rule 71 (implement_def -> IMPLEMENT class_ref USING implement_ns_list empty .)
     [               reduce using rule 71 (implement_def -> IMPLEMENT class_ref USING implement_ns_list empty .)
     {               reduce using rule 71 (implement_def -> IMPLEMENT class_ref USING implement_ns_list empty .)
     $end            reduce using rule 71 (implement_def -> IMPLEMENT class_ref USING implement_ns_list empty .)
 
 
-state 242
+state 251
 
     (72) implement_def -> IMPLEMENT class_ref USING implement_ns_list MLS .
 
     ENTITY          reduce using rule 72 (implement_def -> IMPLEMENT class_ref USING implement_ns_list MLS .)
     IMPLEMENT       reduce using rule 72 (implement_def -> IMPLEMENT class_ref USING implement_ns_list MLS .)
     IMPLEMENTATION  reduce using rule 72 (implement_def -> IMPLEMENT class_ref USING implement_ns_list MLS .)
     INDEX           reduce using rule 72 (implement_def -> IMPLEMENT class_ref USING implement_ns_list MLS .)
@@ -8008,155 +8490,162 @@
     INT             reduce using rule 72 (implement_def -> IMPLEMENT class_ref USING implement_ns_list MLS .)
     FLOAT           reduce using rule 72 (implement_def -> IMPLEMENT class_ref USING implement_ns_list MLS .)
     NULL            reduce using rule 72 (implement_def -> IMPLEMENT class_ref USING implement_ns_list MLS .)
     REGEX           reduce using rule 72 (implement_def -> IMPLEMENT class_ref USING implement_ns_list MLS .)
     TRUE            reduce using rule 72 (implement_def -> IMPLEMENT class_ref USING implement_ns_list MLS .)
     FALSE           reduce using rule 72 (implement_def -> IMPLEMENT class_ref USING implement_ns_list MLS .)
     STRING          reduce using rule 72 (implement_def -> IMPLEMENT class_ref USING implement_ns_list MLS .)
+    FSTRING         reduce using rule 72 (implement_def -> IMPLEMENT class_ref USING implement_ns_list MLS .)
     RSTRING         reduce using rule 72 (implement_def -> IMPLEMENT class_ref USING implement_ns_list MLS .)
     MLS             reduce using rule 72 (implement_def -> IMPLEMENT class_ref USING implement_ns_list MLS .)
     [               reduce using rule 72 (implement_def -> IMPLEMENT class_ref USING implement_ns_list MLS .)
     {               reduce using rule 72 (implement_def -> IMPLEMENT class_ref USING implement_ns_list MLS .)
     $end            reduce using rule 72 (implement_def -> IMPLEMENT class_ref USING implement_ns_list MLS .)
 
 
-state 243
+state 252
 
     (73) implement_def -> IMPLEMENT class_ref USING implement_ns_list WHEN . expression empty
     (74) implement_def -> IMPLEMENT class_ref USING implement_ns_list WHEN . expression MLS
     (97) expression -> . boolean_expression
     (98) expression -> . constant
     (99) expression -> . function_call
     (100) expression -> . var_ref
     (101) expression -> . constructor
     (102) expression -> . list_def
-    (103) expression -> . map_def
-    (104) expression -> . map_lookup
-    (105) expression -> . index_lookup
-    (106) expression -> . conditional_expression
-    (107) expression -> . ( expression )
-    (108) boolean_expression -> . expression CMP_OP expression
-    (109) boolean_expression -> . expression IN expression
-    (110) boolean_expression -> . expression AND expression
-    (111) boolean_expression -> . expression OR expression
-    (112) boolean_expression -> . NOT expression
-    (113) boolean_expression -> . var_ref . ID IS DEFINED
-    (114) boolean_expression -> . ID IS DEFINED
-    (115) boolean_expression -> . map_lookup IS DEFINED
-    (134) constant -> . INT
-    (135) constant -> . FLOAT
-    (136) constant -> . NULL
-    (137) constant -> . REGEX
-    (138) constant -> . TRUE
-    (139) constant -> . FALSE
-    (140) constant -> . STRING
-    (141) constant -> . RSTRING
-    (142) constant -> . MLS
-    (121) function_call -> . ns_ref ( function_param_list )
-    (122) function_call -> . attr_ref ( function_param_list )
-    (163) var_ref -> . attr_ref
-    (165) var_ref -> . ns_ref
-    (120) constructor -> . class_ref ( param_list )
-    (123) list_def -> . [ operand_list ]
-    (130) map_def -> . { pair_list }
-    (117) map_lookup -> . attr_ref [ operand ]
-    (118) map_lookup -> . var_ref [ operand ]
-    (119) map_lookup -> . map_lookup [ operand ]
-    (131) index_lookup -> . class_ref [ param_list ]
-    (132) index_lookup -> . attr_ref [ param_list ]
-    (133) conditional_expression -> . expression ? expression : expression
-    (173) ns_ref -> . ns_ref SEP ID
-    (174) ns_ref -> . ID
-    (164) attr_ref -> . var_ref . ID
-    (166) class_ref -> . CID
-    (167) class_ref -> . ns_ref SEP CID
-    (168) class_ref -> . var_ref . CID
+    (103) expression -> . list_comprehension
+    (104) expression -> . map_def
+    (105) expression -> . map_lookup
+    (106) expression -> . index_lookup
+    (107) expression -> . conditional_expression
+    (108) expression -> . ( expression )
+    (109) boolean_expression -> . expression CMP_OP expression
+    (110) boolean_expression -> . expression IN expression
+    (111) boolean_expression -> . expression AND expression
+    (112) boolean_expression -> . expression OR expression
+    (113) boolean_expression -> . NOT expression
+    (114) boolean_expression -> . var_ref . ID IS DEFINED
+    (115) boolean_expression -> . ID IS DEFINED
+    (116) boolean_expression -> . map_lookup IS DEFINED
+    (141) constant -> . INT
+    (142) constant -> . FLOAT
+    (143) constant -> . NULL
+    (144) constant -> . REGEX
+    (145) constant -> . TRUE
+    (146) constant -> . FALSE
+    (147) constant -> . STRING
+    (148) constant -> . FSTRING
+    (149) constant -> . RSTRING
+    (150) constant -> . MLS
+    (122) function_call -> . ns_ref ( function_param_list )
+    (123) function_call -> . attr_ref ( function_param_list )
+    (171) var_ref -> . attr_ref
+    (173) var_ref -> . ns_ref
+    (121) constructor -> . class_ref ( param_list )
+    (124) list_def -> . [ operand_list ]
+    (125) list_comprehension -> . [ expression list_comprehension_for list_comprehension_guard ]
+    (137) map_def -> . { pair_list }
+    (118) map_lookup -> . attr_ref [ operand ]
+    (119) map_lookup -> . var_ref [ operand ]
+    (120) map_lookup -> . map_lookup [ operand ]
+    (138) index_lookup -> . class_ref [ param_list ]
+    (139) index_lookup -> . attr_ref [ param_list ]
+    (140) conditional_expression -> . expression ? expression : expression
+    (181) ns_ref -> . ns_ref SEP ID
+    (182) ns_ref -> . ID
+    (172) attr_ref -> . var_ref . ID
+    (174) class_ref -> . CID
+    (175) class_ref -> . ns_ref SEP CID
+    (176) class_ref -> . var_ref . CID
 
     (               shift and go to state 30
-    NOT             shift and go to state 46
-    ID              shift and go to state 82
-    INT             shift and go to state 47
-    FLOAT           shift and go to state 48
-    NULL            shift and go to state 49
-    REGEX           shift and go to state 50
-    TRUE            shift and go to state 51
-    FALSE           shift and go to state 52
-    STRING          shift and go to state 53
-    RSTRING         shift and go to state 54
+    NOT             shift and go to state 47
+    ID              shift and go to state 84
+    INT             shift and go to state 48
+    FLOAT           shift and go to state 49
+    NULL            shift and go to state 50
+    REGEX           shift and go to state 51
+    TRUE            shift and go to state 52
+    FALSE           shift and go to state 53
+    STRING          shift and go to state 54
+    FSTRING         shift and go to state 55
+    RSTRING         shift and go to state 56
     MLS             shift and go to state 20
-    [               shift and go to state 55
-    {               shift and go to state 56
+    [               shift and go to state 57
+    {               shift and go to state 58
     CID             shift and go to state 16
 
-    class_ref                      shift and go to state 85
-    expression                     shift and go to state 286
+    class_ref                      shift and go to state 87
+    expression                     shift and go to state 298
     boolean_expression             shift and go to state 35
     constant                       shift and go to state 36
     function_call                  shift and go to state 37
-    var_ref                        shift and go to state 81
+    var_ref                        shift and go to state 83
     constructor                    shift and go to state 38
     list_def                       shift and go to state 39
-    map_def                        shift and go to state 40
-    map_lookup                     shift and go to state 41
-    index_lookup                   shift and go to state 42
-    conditional_expression         shift and go to state 43
-    ns_ref                         shift and go to state 83
-    attr_ref                       shift and go to state 84
+    list_comprehension             shift and go to state 40
+    map_def                        shift and go to state 41
+    map_lookup                     shift and go to state 42
+    index_lookup                   shift and go to state 43
+    conditional_expression         shift and go to state 44
+    ns_ref                         shift and go to state 85
+    attr_ref                       shift and go to state 86
 
-state 244
+state 253
 
     (70) implement_ns_list -> implement_ns_list , . implement_ns_list
     (68) implement_ns_list -> . ns_ref
     (69) implement_ns_list -> . PARENTS
     (70) implement_ns_list -> . implement_ns_list , implement_ns_list
-    (173) ns_ref -> . ns_ref SEP ID
-    (174) ns_ref -> . ID
+    (181) ns_ref -> . ns_ref SEP ID
+    (182) ns_ref -> . ID
 
-    PARENTS         shift and go to state 188
-    ID              shift and go to state 64
+    PARENTS         shift and go to state 193
+    ID              shift and go to state 66
 
-    implement_ns_list              shift and go to state 287
-    ns_ref                         shift and go to state 187
+    implement_ns_list              shift and go to state 299
+    ns_ref                         shift and go to state 192
 
-state 245
+state 254
 
     (80) relation -> class_ref ID multi REL multi . class_ref ID
     (81) relation -> class_ref ID multi REL multi . class_ref ID MLS
-    (166) class_ref -> . CID
-    (167) class_ref -> . ns_ref SEP CID
-    (168) class_ref -> . var_ref . CID
-    (173) ns_ref -> . ns_ref SEP ID
-    (174) ns_ref -> . ID
-    (163) var_ref -> . attr_ref
-    (165) var_ref -> . ns_ref
-    (164) attr_ref -> . var_ref . ID
-
-    CID             shift and go to state 16
-    ID              shift and go to state 64
-
-    class_ref                      shift and go to state 288
-    ns_ref                         shift and go to state 62
-    var_ref                        shift and go to state 63
-    attr_ref                       shift and go to state 65
+    (174) class_ref -> . CID
+    (175) class_ref -> . ns_ref SEP CID
+    (176) class_ref -> . var_ref . CID
+    (181) ns_ref -> . ns_ref SEP ID
+    (182) ns_ref -> . ID
+    (171) var_ref -> . attr_ref
+    (173) var_ref -> . ns_ref
+    (172) attr_ref -> . var_ref . ID
 
-state 246
+    CID             shift and go to state 16
+    ID              shift and go to state 66
+
+    class_ref                      shift and go to state 300
+    ns_ref                         shift and go to state 64
+    var_ref                        shift and go to state 65
+    attr_ref                       shift and go to state 67
+
+state 255
 
     (88) multi -> [ INT ] .
 
     REL             reduce using rule 88 (multi -> [ INT ] .)
     (               reduce using rule 88 (multi -> [ INT ] .)
     NOT             reduce using rule 88 (multi -> [ INT ] .)
     ID              reduce using rule 88 (multi -> [ INT ] .)
     INT             reduce using rule 88 (multi -> [ INT ] .)
     FLOAT           reduce using rule 88 (multi -> [ INT ] .)
     NULL            reduce using rule 88 (multi -> [ INT ] .)
     REGEX           reduce using rule 88 (multi -> [ INT ] .)
     TRUE            reduce using rule 88 (multi -> [ INT ] .)
     FALSE           reduce using rule 88 (multi -> [ INT ] .)
     STRING          reduce using rule 88 (multi -> [ INT ] .)
+    FSTRING         reduce using rule 88 (multi -> [ INT ] .)
     RSTRING         reduce using rule 88 (multi -> [ INT ] .)
     MLS             reduce using rule 88 (multi -> [ INT ] .)
     [               reduce using rule 88 (multi -> [ INT ] .)
     {               reduce using rule 88 (multi -> [ INT ] .)
     CID             reduce using rule 88 (multi -> [ INT ] .)
     ENTITY          reduce using rule 88 (multi -> [ INT ] .)
     IMPLEMENT       reduce using rule 88 (multi -> [ INT ] .)
@@ -8165,161 +8654,162 @@
     IMPORT          reduce using rule 88 (multi -> [ INT ] .)
     FOR             reduce using rule 88 (multi -> [ INT ] .)
     IF              reduce using rule 88 (multi -> [ INT ] .)
     TYPEDEF         reduce using rule 88 (multi -> [ INT ] .)
     $end            reduce using rule 88 (multi -> [ INT ] .)
 
 
-state 247
+state 256
 
     (89) multi -> [ INT : . ]
     (90) multi -> [ INT : . INT ]
 
-    ]               shift and go to state 290
-    INT             shift and go to state 289
+    ]               shift and go to state 302
+    INT             shift and go to state 301
 
 
-state 248
+state 257
 
     (91) multi -> [ : INT . ]
 
-    ]               shift and go to state 291
+    ]               shift and go to state 303
 
 
-state 249
+state 258
 
     (84) relation_def -> class_ref . ID multi REL . class_ref . ID multi
     (85) relation_def -> class_ref . ID multi REL . class_ref
-    (166) class_ref -> . CID
-    (167) class_ref -> . ns_ref SEP CID
-    (168) class_ref -> . var_ref . CID
-    (173) ns_ref -> . ns_ref SEP ID
-    (174) ns_ref -> . ID
-    (163) var_ref -> . attr_ref
-    (165) var_ref -> . ns_ref
-    (164) attr_ref -> . var_ref . ID
-
-    CID             shift and go to state 16
-    ID              shift and go to state 64
-
-    class_ref                      shift and go to state 292
-    ns_ref                         shift and go to state 62
-    var_ref                        shift and go to state 63
-    attr_ref                       shift and go to state 65
+    (174) class_ref -> . CID
+    (175) class_ref -> . ns_ref SEP CID
+    (176) class_ref -> . var_ref . CID
+    (181) ns_ref -> . ns_ref SEP ID
+    (182) ns_ref -> . ID
+    (171) var_ref -> . attr_ref
+    (173) var_ref -> . ns_ref
+    (172) attr_ref -> . var_ref . ID
 
-state 250
+    CID             shift and go to state 16
+    ID              shift and go to state 66
+
+    class_ref                      shift and go to state 304
+    ns_ref                         shift and go to state 64
+    var_ref                        shift and go to state 65
+    attr_ref                       shift and go to state 67
+
+state 259
 
     (86) relation_def -> class_ref . ID multi operand_list . class_ref . ID multi
     (87) relation_def -> class_ref . ID multi operand_list . class_ref
-    (166) class_ref -> . CID
-    (167) class_ref -> . ns_ref SEP CID
-    (168) class_ref -> . var_ref . CID
-    (173) ns_ref -> . ns_ref SEP ID
-    (174) ns_ref -> . ID
-    (163) var_ref -> . attr_ref
-    (165) var_ref -> . ns_ref
-    (164) attr_ref -> . var_ref . ID
-
-    CID             shift and go to state 16
-    ID              shift and go to state 64
-
-    class_ref                      shift and go to state 293
-    ns_ref                         shift and go to state 62
-    var_ref                        shift and go to state 63
-    attr_ref                       shift and go to state 65
+    (174) class_ref -> . CID
+    (175) class_ref -> . ns_ref SEP CID
+    (176) class_ref -> . var_ref . CID
+    (181) ns_ref -> . ns_ref SEP ID
+    (182) ns_ref -> . ID
+    (171) var_ref -> . attr_ref
+    (173) var_ref -> . ns_ref
+    (172) attr_ref -> . var_ref . ID
 
-state 251
+    CID             shift and go to state 16
+    ID              shift and go to state 66
 
-    (152) param_list -> param_list_element empty param_list_empty .
+    class_ref                      shift and go to state 305
+    ns_ref                         shift and go to state 64
+    var_ref                        shift and go to state 65
+    attr_ref                       shift and go to state 67
 
-    )               reduce using rule 152 (param_list -> param_list_element empty param_list_empty .)
-    ]               reduce using rule 152 (param_list -> param_list_element empty param_list_empty .)
+state 260
 
+    (160) param_list -> param_list_element empty param_list_empty .
+
+    )               reduce using rule 160 (param_list -> param_list_element empty param_list_empty .)
+    ]               reduce using rule 160 (param_list -> param_list_element empty param_list_empty .)
 
-state 252
 
-    (153) param_list -> param_list_element , param_list .
+state 261
 
-    )               reduce using rule 153 (param_list -> param_list_element , param_list .)
-    ]               reduce using rule 153 (param_list -> param_list_element , param_list .)
+    (161) param_list -> param_list_element , param_list .
 
+    )               reduce using rule 161 (param_list -> param_list_element , param_list .)
+    ]               reduce using rule 161 (param_list -> param_list_element , param_list .)
 
-state 253
 
-    (148) param_list_element -> ID = operand .
+state 262
 
-    ,               reduce using rule 148 (param_list_element -> ID = operand .)
-    )               reduce using rule 148 (param_list_element -> ID = operand .)
-    ]               reduce using rule 148 (param_list_element -> ID = operand .)
+    (156) param_list_element -> ID = operand .
 
+    ,               reduce using rule 156 (param_list_element -> ID = operand .)
+    )               reduce using rule 156 (param_list_element -> ID = operand .)
+    ]               reduce using rule 156 (param_list_element -> ID = operand .)
 
-state 254
 
-    (147) wrapped_kwargs -> * * operand .
+state 263
 
-    ,               reduce using rule 147 (wrapped_kwargs -> * * operand .)
-    )               reduce using rule 147 (wrapped_kwargs -> * * operand .)
-    ]               reduce using rule 147 (wrapped_kwargs -> * * operand .)
+    (155) wrapped_kwargs -> * * operand .
 
+    ,               reduce using rule 155 (wrapped_kwargs -> * * operand .)
+    )               reduce using rule 155 (wrapped_kwargs -> * * operand .)
+    ]               reduce using rule 155 (wrapped_kwargs -> * * operand .)
 
-state 255
 
-    (133) conditional_expression -> expression ? expression : expression .
-    (108) boolean_expression -> expression . CMP_OP expression
-    (109) boolean_expression -> expression . IN expression
-    (110) boolean_expression -> expression . AND expression
-    (111) boolean_expression -> expression . OR expression
-    (133) conditional_expression -> expression . ? expression : expression
-
-    ENTITY          reduce using rule 133 (conditional_expression -> expression ? expression : expression .)
-    IMPLEMENT       reduce using rule 133 (conditional_expression -> expression ? expression : expression .)
-    IMPLEMENTATION  reduce using rule 133 (conditional_expression -> expression ? expression : expression .)
-    INDEX           reduce using rule 133 (conditional_expression -> expression ? expression : expression .)
-    IMPORT          reduce using rule 133 (conditional_expression -> expression ? expression : expression .)
-    CID             reduce using rule 133 (conditional_expression -> expression ? expression : expression .)
-    FOR             reduce using rule 133 (conditional_expression -> expression ? expression : expression .)
-    IF              reduce using rule 133 (conditional_expression -> expression ? expression : expression .)
-    (               reduce using rule 133 (conditional_expression -> expression ? expression : expression .)
-    TYPEDEF         reduce using rule 133 (conditional_expression -> expression ? expression : expression .)
-    ID              reduce using rule 133 (conditional_expression -> expression ? expression : expression .)
-    NOT             reduce using rule 133 (conditional_expression -> expression ? expression : expression .)
-    INT             reduce using rule 133 (conditional_expression -> expression ? expression : expression .)
-    FLOAT           reduce using rule 133 (conditional_expression -> expression ? expression : expression .)
-    NULL            reduce using rule 133 (conditional_expression -> expression ? expression : expression .)
-    REGEX           reduce using rule 133 (conditional_expression -> expression ? expression : expression .)
-    TRUE            reduce using rule 133 (conditional_expression -> expression ? expression : expression .)
-    FALSE           reduce using rule 133 (conditional_expression -> expression ? expression : expression .)
-    STRING          reduce using rule 133 (conditional_expression -> expression ? expression : expression .)
-    RSTRING         reduce using rule 133 (conditional_expression -> expression ? expression : expression .)
-    MLS             reduce using rule 133 (conditional_expression -> expression ? expression : expression .)
-    [               reduce using rule 133 (conditional_expression -> expression ? expression : expression .)
-    {               reduce using rule 133 (conditional_expression -> expression ? expression : expression .)
-    $end            reduce using rule 133 (conditional_expression -> expression ? expression : expression .)
-    )               reduce using rule 133 (conditional_expression -> expression ? expression : expression .)
-    :               reduce using rule 133 (conditional_expression -> expression ? expression : expression .)
-    ,               reduce using rule 133 (conditional_expression -> expression ? expression : expression .)
-    ]               reduce using rule 133 (conditional_expression -> expression ? expression : expression .)
-    ELSE            reduce using rule 133 (conditional_expression -> expression ? expression : expression .)
-    ELIF            reduce using rule 133 (conditional_expression -> expression ? expression : expression .)
-    END             reduce using rule 133 (conditional_expression -> expression ? expression : expression .)
-    }               reduce using rule 133 (conditional_expression -> expression ? expression : expression .)
-    CMP_OP          shift and go to state 70
-    IN              shift and go to state 71
-    AND             shift and go to state 72
-    OR              shift and go to state 73
-    ?               shift and go to state 74
-
-  ! CMP_OP          [ reduce using rule 133 (conditional_expression -> expression ? expression : expression .) ]
-  ! IN              [ reduce using rule 133 (conditional_expression -> expression ? expression : expression .) ]
-  ! AND             [ reduce using rule 133 (conditional_expression -> expression ? expression : expression .) ]
-  ! OR              [ reduce using rule 133 (conditional_expression -> expression ? expression : expression .) ]
-  ! ?               [ reduce using rule 133 (conditional_expression -> expression ? expression : expression .) ]
+state 264
 
+    (140) conditional_expression -> expression ? expression : expression .
+    (109) boolean_expression -> expression . CMP_OP expression
+    (110) boolean_expression -> expression . IN expression
+    (111) boolean_expression -> expression . AND expression
+    (112) boolean_expression -> expression . OR expression
+    (140) conditional_expression -> expression . ? expression : expression
+
+    ENTITY          reduce using rule 140 (conditional_expression -> expression ? expression : expression .)
+    IMPLEMENT       reduce using rule 140 (conditional_expression -> expression ? expression : expression .)
+    IMPLEMENTATION  reduce using rule 140 (conditional_expression -> expression ? expression : expression .)
+    INDEX           reduce using rule 140 (conditional_expression -> expression ? expression : expression .)
+    IMPORT          reduce using rule 140 (conditional_expression -> expression ? expression : expression .)
+    CID             reduce using rule 140 (conditional_expression -> expression ? expression : expression .)
+    FOR             reduce using rule 140 (conditional_expression -> expression ? expression : expression .)
+    IF              reduce using rule 140 (conditional_expression -> expression ? expression : expression .)
+    (               reduce using rule 140 (conditional_expression -> expression ? expression : expression .)
+    TYPEDEF         reduce using rule 140 (conditional_expression -> expression ? expression : expression .)
+    ID              reduce using rule 140 (conditional_expression -> expression ? expression : expression .)
+    NOT             reduce using rule 140 (conditional_expression -> expression ? expression : expression .)
+    INT             reduce using rule 140 (conditional_expression -> expression ? expression : expression .)
+    FLOAT           reduce using rule 140 (conditional_expression -> expression ? expression : expression .)
+    NULL            reduce using rule 140 (conditional_expression -> expression ? expression : expression .)
+    REGEX           reduce using rule 140 (conditional_expression -> expression ? expression : expression .)
+    TRUE            reduce using rule 140 (conditional_expression -> expression ? expression : expression .)
+    FALSE           reduce using rule 140 (conditional_expression -> expression ? expression : expression .)
+    STRING          reduce using rule 140 (conditional_expression -> expression ? expression : expression .)
+    FSTRING         reduce using rule 140 (conditional_expression -> expression ? expression : expression .)
+    RSTRING         reduce using rule 140 (conditional_expression -> expression ? expression : expression .)
+    MLS             reduce using rule 140 (conditional_expression -> expression ? expression : expression .)
+    [               reduce using rule 140 (conditional_expression -> expression ? expression : expression .)
+    {               reduce using rule 140 (conditional_expression -> expression ? expression : expression .)
+    $end            reduce using rule 140 (conditional_expression -> expression ? expression : expression .)
+    )               reduce using rule 140 (conditional_expression -> expression ? expression : expression .)
+    :               reduce using rule 140 (conditional_expression -> expression ? expression : expression .)
+    ,               reduce using rule 140 (conditional_expression -> expression ? expression : expression .)
+    ]               reduce using rule 140 (conditional_expression -> expression ? expression : expression .)
+    ELSE            reduce using rule 140 (conditional_expression -> expression ? expression : expression .)
+    ELIF            reduce using rule 140 (conditional_expression -> expression ? expression : expression .)
+    END             reduce using rule 140 (conditional_expression -> expression ? expression : expression .)
+    }               reduce using rule 140 (conditional_expression -> expression ? expression : expression .)
+    CMP_OP          shift and go to state 72
+    IN              shift and go to state 73
+    AND             shift and go to state 74
+    OR              shift and go to state 75
+    ?               shift and go to state 76
+
+  ! CMP_OP          [ reduce using rule 140 (conditional_expression -> expression ? expression : expression .) ]
+  ! IN              [ reduce using rule 140 (conditional_expression -> expression ? expression : expression .) ]
+  ! AND             [ reduce using rule 140 (conditional_expression -> expression ? expression : expression .) ]
+  ! OR              [ reduce using rule 140 (conditional_expression -> expression ? expression : expression .) ]
+  ! ?               [ reduce using rule 140 (conditional_expression -> expression ? expression : expression .) ]
 
-state 256
+
+state 265
 
     (75) implementation_def -> IMPLEMENTATION ID FOR class_ref implementation .
 
     ENTITY          reduce using rule 75 (implementation_def -> IMPLEMENTATION ID FOR class_ref implementation .)
     IMPLEMENT       reduce using rule 75 (implementation_def -> IMPLEMENTATION ID FOR class_ref implementation .)
     IMPLEMENTATION  reduce using rule 75 (implementation_def -> IMPLEMENTATION ID FOR class_ref implementation .)
     INDEX           reduce using rule 75 (implementation_def -> IMPLEMENTATION ID FOR class_ref implementation .)
@@ -8334,22 +8824,23 @@
     INT             reduce using rule 75 (implementation_def -> IMPLEMENTATION ID FOR class_ref implementation .)
     FLOAT           reduce using rule 75 (implementation_def -> IMPLEMENTATION ID FOR class_ref implementation .)
     NULL            reduce using rule 75 (implementation_def -> IMPLEMENTATION ID FOR class_ref implementation .)
     REGEX           reduce using rule 75 (implementation_def -> IMPLEMENTATION ID FOR class_ref implementation .)
     TRUE            reduce using rule 75 (implementation_def -> IMPLEMENTATION ID FOR class_ref implementation .)
     FALSE           reduce using rule 75 (implementation_def -> IMPLEMENTATION ID FOR class_ref implementation .)
     STRING          reduce using rule 75 (implementation_def -> IMPLEMENTATION ID FOR class_ref implementation .)
+    FSTRING         reduce using rule 75 (implementation_def -> IMPLEMENTATION ID FOR class_ref implementation .)
     RSTRING         reduce using rule 75 (implementation_def -> IMPLEMENTATION ID FOR class_ref implementation .)
     MLS             reduce using rule 75 (implementation_def -> IMPLEMENTATION ID FOR class_ref implementation .)
     [               reduce using rule 75 (implementation_def -> IMPLEMENTATION ID FOR class_ref implementation .)
     {               reduce using rule 75 (implementation_def -> IMPLEMENTATION ID FOR class_ref implementation .)
     $end            reduce using rule 75 (implementation_def -> IMPLEMENTATION ID FOR class_ref implementation .)
 
 
-state 257
+state 266
 
     (76) implementation -> implementation_head . block
     (79) block -> . stmt_list END
     (21) stmt_list -> . statement stmt_list
     (22) stmt_list -> . empty
     (17) statement -> . assign
     (18) statement -> . for
@@ -8362,98 +8853,103 @@
     (26) if -> . IF if_body END
     (97) expression -> . boolean_expression
     (98) expression -> . constant
     (99) expression -> . function_call
     (100) expression -> . var_ref
     (101) expression -> . constructor
     (102) expression -> . list_def
-    (103) expression -> . map_def
-    (104) expression -> . map_lookup
-    (105) expression -> . index_lookup
-    (106) expression -> . conditional_expression
-    (107) expression -> . ( expression )
-    (163) var_ref -> . attr_ref
-    (165) var_ref -> . ns_ref
-    (108) boolean_expression -> . expression CMP_OP expression
-    (109) boolean_expression -> . expression IN expression
-    (110) boolean_expression -> . expression AND expression
-    (111) boolean_expression -> . expression OR expression
-    (112) boolean_expression -> . NOT expression
-    (113) boolean_expression -> . var_ref . ID IS DEFINED
-    (114) boolean_expression -> . ID IS DEFINED
-    (115) boolean_expression -> . map_lookup IS DEFINED
-    (134) constant -> . INT
-    (135) constant -> . FLOAT
-    (136) constant -> . NULL
-    (137) constant -> . REGEX
-    (138) constant -> . TRUE
-    (139) constant -> . FALSE
-    (140) constant -> . STRING
-    (141) constant -> . RSTRING
-    (142) constant -> . MLS
-    (121) function_call -> . ns_ref ( function_param_list )
-    (122) function_call -> . attr_ref ( function_param_list )
-    (120) constructor -> . class_ref ( param_list )
-    (123) list_def -> . [ operand_list ]
-    (130) map_def -> . { pair_list }
-    (117) map_lookup -> . attr_ref [ operand ]
-    (118) map_lookup -> . var_ref [ operand ]
-    (119) map_lookup -> . map_lookup [ operand ]
-    (131) index_lookup -> . class_ref [ param_list ]
-    (132) index_lookup -> . attr_ref [ param_list ]
-    (133) conditional_expression -> . expression ? expression : expression
-    (164) attr_ref -> . var_ref . ID
-    (173) ns_ref -> . ns_ref SEP ID
-    (174) ns_ref -> . ID
-    (166) class_ref -> . CID
-    (167) class_ref -> . ns_ref SEP CID
-    (168) class_ref -> . var_ref . CID
+    (103) expression -> . list_comprehension
+    (104) expression -> . map_def
+    (105) expression -> . map_lookup
+    (106) expression -> . index_lookup
+    (107) expression -> . conditional_expression
+    (108) expression -> . ( expression )
+    (171) var_ref -> . attr_ref
+    (173) var_ref -> . ns_ref
+    (109) boolean_expression -> . expression CMP_OP expression
+    (110) boolean_expression -> . expression IN expression
+    (111) boolean_expression -> . expression AND expression
+    (112) boolean_expression -> . expression OR expression
+    (113) boolean_expression -> . NOT expression
+    (114) boolean_expression -> . var_ref . ID IS DEFINED
+    (115) boolean_expression -> . ID IS DEFINED
+    (116) boolean_expression -> . map_lookup IS DEFINED
+    (141) constant -> . INT
+    (142) constant -> . FLOAT
+    (143) constant -> . NULL
+    (144) constant -> . REGEX
+    (145) constant -> . TRUE
+    (146) constant -> . FALSE
+    (147) constant -> . STRING
+    (148) constant -> . FSTRING
+    (149) constant -> . RSTRING
+    (150) constant -> . MLS
+    (122) function_call -> . ns_ref ( function_param_list )
+    (123) function_call -> . attr_ref ( function_param_list )
+    (121) constructor -> . class_ref ( param_list )
+    (124) list_def -> . [ operand_list ]
+    (125) list_comprehension -> . [ expression list_comprehension_for list_comprehension_guard ]
+    (137) map_def -> . { pair_list }
+    (118) map_lookup -> . attr_ref [ operand ]
+    (119) map_lookup -> . var_ref [ operand ]
+    (120) map_lookup -> . map_lookup [ operand ]
+    (138) index_lookup -> . class_ref [ param_list ]
+    (139) index_lookup -> . attr_ref [ param_list ]
+    (140) conditional_expression -> . expression ? expression : expression
+    (172) attr_ref -> . var_ref . ID
+    (181) ns_ref -> . ns_ref SEP ID
+    (182) ns_ref -> . ID
+    (174) class_ref -> . CID
+    (175) class_ref -> . ns_ref SEP CID
+    (176) class_ref -> . var_ref . CID
 
     END             reduce using rule 14 (empty -> .)
     FOR             shift and go to state 23
     IF              shift and go to state 34
     (               shift and go to state 30
-    NOT             shift and go to state 46
-    ID              shift and go to state 82
-    INT             shift and go to state 47
-    FLOAT           shift and go to state 48
-    NULL            shift and go to state 49
-    REGEX           shift and go to state 50
-    TRUE            shift and go to state 51
-    FALSE           shift and go to state 52
-    STRING          shift and go to state 53
-    RSTRING         shift and go to state 54
+    NOT             shift and go to state 47
+    ID              shift and go to state 84
+    INT             shift and go to state 48
+    FLOAT           shift and go to state 49
+    NULL            shift and go to state 50
+    REGEX           shift and go to state 51
+    TRUE            shift and go to state 52
+    FALSE           shift and go to state 53
+    STRING          shift and go to state 54
+    FSTRING         shift and go to state 55
+    RSTRING         shift and go to state 56
     MLS             shift and go to state 20
-    [               shift and go to state 55
-    {               shift and go to state 56
+    [               shift and go to state 57
+    {               shift and go to state 58
     CID             shift and go to state 16
 
-    block                          shift and go to state 294
-    stmt_list                      shift and go to state 295
-    statement                      shift and go to state 212
-    empty                          shift and go to state 213
+    block                          shift and go to state 306
+    stmt_list                      shift and go to state 307
+    statement                      shift and go to state 217
+    empty                          shift and go to state 218
     assign                         shift and go to state 25
     for                            shift and go to state 26
     if                             shift and go to state 27
     expression                     shift and go to state 21
-    var_ref                        shift and go to state 214
+    var_ref                        shift and go to state 219
     boolean_expression             shift and go to state 35
     constant                       shift and go to state 36
     function_call                  shift and go to state 37
     constructor                    shift and go to state 38
     list_def                       shift and go to state 39
-    map_def                        shift and go to state 40
-    map_lookup                     shift and go to state 41
-    index_lookup                   shift and go to state 42
-    conditional_expression         shift and go to state 43
-    attr_ref                       shift and go to state 45
-    ns_ref                         shift and go to state 215
-    class_ref                      shift and go to state 85
+    list_comprehension             shift and go to state 40
+    map_def                        shift and go to state 41
+    map_lookup                     shift and go to state 42
+    index_lookup                   shift and go to state 43
+    conditional_expression         shift and go to state 44
+    attr_ref                       shift and go to state 46
+    ns_ref                         shift and go to state 220
+    class_ref                      shift and go to state 87
 
-state 258
+state 267
 
     (77) implementation_head -> : .
     (78) implementation_head -> : . MLS
 
     FOR             reduce using rule 77 (implementation_head -> : .)
     IF              reduce using rule 77 (implementation_head -> : .)
     (               reduce using rule 77 (implementation_head -> : .)
@@ -8462,25 +8958,26 @@
     INT             reduce using rule 77 (implementation_head -> : .)
     FLOAT           reduce using rule 77 (implementation_head -> : .)
     NULL            reduce using rule 77 (implementation_head -> : .)
     REGEX           reduce using rule 77 (implementation_head -> : .)
     TRUE            reduce using rule 77 (implementation_head -> : .)
     FALSE           reduce using rule 77 (implementation_head -> : .)
     STRING          reduce using rule 77 (implementation_head -> : .)
+    FSTRING         reduce using rule 77 (implementation_head -> : .)
     RSTRING         reduce using rule 77 (implementation_head -> : .)
     [               reduce using rule 77 (implementation_head -> : .)
     {               reduce using rule 77 (implementation_head -> : .)
     CID             reduce using rule 77 (implementation_head -> : .)
     END             reduce using rule 77 (implementation_head -> : .)
-    MLS             shift and go to state 296
+    MLS             shift and go to state 308
 
   ! MLS             [ reduce using rule 77 (implementation_head -> : .) ]
 
 
-state 259
+state 268
 
     (25) for -> FOR ID IN operand : . block
     (79) block -> . stmt_list END
     (21) stmt_list -> . statement stmt_list
     (22) stmt_list -> . empty
     (17) statement -> . assign
     (18) statement -> . for
@@ -8493,98 +8990,103 @@
     (26) if -> . IF if_body END
     (97) expression -> . boolean_expression
     (98) expression -> . constant
     (99) expression -> . function_call
     (100) expression -> . var_ref
     (101) expression -> . constructor
     (102) expression -> . list_def
-    (103) expression -> . map_def
-    (104) expression -> . map_lookup
-    (105) expression -> . index_lookup
-    (106) expression -> . conditional_expression
-    (107) expression -> . ( expression )
-    (163) var_ref -> . attr_ref
-    (165) var_ref -> . ns_ref
-    (108) boolean_expression -> . expression CMP_OP expression
-    (109) boolean_expression -> . expression IN expression
-    (110) boolean_expression -> . expression AND expression
-    (111) boolean_expression -> . expression OR expression
-    (112) boolean_expression -> . NOT expression
-    (113) boolean_expression -> . var_ref . ID IS DEFINED
-    (114) boolean_expression -> . ID IS DEFINED
-    (115) boolean_expression -> . map_lookup IS DEFINED
-    (134) constant -> . INT
-    (135) constant -> . FLOAT
-    (136) constant -> . NULL
-    (137) constant -> . REGEX
-    (138) constant -> . TRUE
-    (139) constant -> . FALSE
-    (140) constant -> . STRING
-    (141) constant -> . RSTRING
-    (142) constant -> . MLS
-    (121) function_call -> . ns_ref ( function_param_list )
-    (122) function_call -> . attr_ref ( function_param_list )
-    (120) constructor -> . class_ref ( param_list )
-    (123) list_def -> . [ operand_list ]
-    (130) map_def -> . { pair_list }
-    (117) map_lookup -> . attr_ref [ operand ]
-    (118) map_lookup -> . var_ref [ operand ]
-    (119) map_lookup -> . map_lookup [ operand ]
-    (131) index_lookup -> . class_ref [ param_list ]
-    (132) index_lookup -> . attr_ref [ param_list ]
-    (133) conditional_expression -> . expression ? expression : expression
-    (164) attr_ref -> . var_ref . ID
-    (173) ns_ref -> . ns_ref SEP ID
-    (174) ns_ref -> . ID
-    (166) class_ref -> . CID
-    (167) class_ref -> . ns_ref SEP CID
-    (168) class_ref -> . var_ref . CID
+    (103) expression -> . list_comprehension
+    (104) expression -> . map_def
+    (105) expression -> . map_lookup
+    (106) expression -> . index_lookup
+    (107) expression -> . conditional_expression
+    (108) expression -> . ( expression )
+    (171) var_ref -> . attr_ref
+    (173) var_ref -> . ns_ref
+    (109) boolean_expression -> . expression CMP_OP expression
+    (110) boolean_expression -> . expression IN expression
+    (111) boolean_expression -> . expression AND expression
+    (112) boolean_expression -> . expression OR expression
+    (113) boolean_expression -> . NOT expression
+    (114) boolean_expression -> . var_ref . ID IS DEFINED
+    (115) boolean_expression -> . ID IS DEFINED
+    (116) boolean_expression -> . map_lookup IS DEFINED
+    (141) constant -> . INT
+    (142) constant -> . FLOAT
+    (143) constant -> . NULL
+    (144) constant -> . REGEX
+    (145) constant -> . TRUE
+    (146) constant -> . FALSE
+    (147) constant -> . STRING
+    (148) constant -> . FSTRING
+    (149) constant -> . RSTRING
+    (150) constant -> . MLS
+    (122) function_call -> . ns_ref ( function_param_list )
+    (123) function_call -> . attr_ref ( function_param_list )
+    (121) constructor -> . class_ref ( param_list )
+    (124) list_def -> . [ operand_list ]
+    (125) list_comprehension -> . [ expression list_comprehension_for list_comprehension_guard ]
+    (137) map_def -> . { pair_list }
+    (118) map_lookup -> . attr_ref [ operand ]
+    (119) map_lookup -> . var_ref [ operand ]
+    (120) map_lookup -> . map_lookup [ operand ]
+    (138) index_lookup -> . class_ref [ param_list ]
+    (139) index_lookup -> . attr_ref [ param_list ]
+    (140) conditional_expression -> . expression ? expression : expression
+    (172) attr_ref -> . var_ref . ID
+    (181) ns_ref -> . ns_ref SEP ID
+    (182) ns_ref -> . ID
+    (174) class_ref -> . CID
+    (175) class_ref -> . ns_ref SEP CID
+    (176) class_ref -> . var_ref . CID
 
     END             reduce using rule 14 (empty -> .)
     FOR             shift and go to state 23
     IF              shift and go to state 34
     (               shift and go to state 30
-    NOT             shift and go to state 46
-    ID              shift and go to state 82
-    INT             shift and go to state 47
-    FLOAT           shift and go to state 48
-    NULL            shift and go to state 49
-    REGEX           shift and go to state 50
-    TRUE            shift and go to state 51
-    FALSE           shift and go to state 52
-    STRING          shift and go to state 53
-    RSTRING         shift and go to state 54
+    NOT             shift and go to state 47
+    ID              shift and go to state 84
+    INT             shift and go to state 48
+    FLOAT           shift and go to state 49
+    NULL            shift and go to state 50
+    REGEX           shift and go to state 51
+    TRUE            shift and go to state 52
+    FALSE           shift and go to state 53
+    STRING          shift and go to state 54
+    FSTRING         shift and go to state 55
+    RSTRING         shift and go to state 56
     MLS             shift and go to state 20
-    [               shift and go to state 55
-    {               shift and go to state 56
+    [               shift and go to state 57
+    {               shift and go to state 58
     CID             shift and go to state 16
 
-    block                          shift and go to state 297
-    stmt_list                      shift and go to state 295
-    statement                      shift and go to state 212
-    empty                          shift and go to state 213
+    block                          shift and go to state 309
+    stmt_list                      shift and go to state 307
+    statement                      shift and go to state 217
+    empty                          shift and go to state 218
     assign                         shift and go to state 25
     for                            shift and go to state 26
     if                             shift and go to state 27
     expression                     shift and go to state 21
-    var_ref                        shift and go to state 214
+    var_ref                        shift and go to state 219
     boolean_expression             shift and go to state 35
     constant                       shift and go to state 36
     function_call                  shift and go to state 37
     constructor                    shift and go to state 38
     list_def                       shift and go to state 39
-    map_def                        shift and go to state 40
-    map_lookup                     shift and go to state 41
-    index_lookup                   shift and go to state 42
-    conditional_expression         shift and go to state 43
-    attr_ref                       shift and go to state 45
-    ns_ref                         shift and go to state 215
-    class_ref                      shift and go to state 85
+    list_comprehension             shift and go to state 40
+    map_def                        shift and go to state 41
+    map_lookup                     shift and go to state 42
+    index_lookup                   shift and go to state 43
+    conditional_expression         shift and go to state 44
+    attr_ref                       shift and go to state 46
+    ns_ref                         shift and go to state 220
+    class_ref                      shift and go to state 87
 
-state 260
+state 269
 
     (96) index -> INDEX class_ref ( id_list ) .
 
     ENTITY          reduce using rule 96 (index -> INDEX class_ref ( id_list ) .)
     IMPLEMENT       reduce using rule 96 (index -> INDEX class_ref ( id_list ) .)
     IMPLEMENTATION  reduce using rule 96 (index -> INDEX class_ref ( id_list ) .)
     INDEX           reduce using rule 96 (index -> INDEX class_ref ( id_list ) .)
@@ -8599,316 +9101,483 @@
     INT             reduce using rule 96 (index -> INDEX class_ref ( id_list ) .)
     FLOAT           reduce using rule 96 (index -> INDEX class_ref ( id_list ) .)
     NULL            reduce using rule 96 (index -> INDEX class_ref ( id_list ) .)
     REGEX           reduce using rule 96 (index -> INDEX class_ref ( id_list ) .)
     TRUE            reduce using rule 96 (index -> INDEX class_ref ( id_list ) .)
     FALSE           reduce using rule 96 (index -> INDEX class_ref ( id_list ) .)
     STRING          reduce using rule 96 (index -> INDEX class_ref ( id_list ) .)
+    FSTRING         reduce using rule 96 (index -> INDEX class_ref ( id_list ) .)
     RSTRING         reduce using rule 96 (index -> INDEX class_ref ( id_list ) .)
     MLS             reduce using rule 96 (index -> INDEX class_ref ( id_list ) .)
     [               reduce using rule 96 (index -> INDEX class_ref ( id_list ) .)
     {               reduce using rule 96 (index -> INDEX class_ref ( id_list ) .)
     $end            reduce using rule 96 (index -> INDEX class_ref ( id_list ) .)
 
 
-state 261
+state 270
 
-    (175) id_list -> ID , . id_list
-    (175) id_list -> . ID , id_list
-    (176) id_list -> . ID
+    (183) id_list -> ID , . id_list
+    (183) id_list -> . ID , id_list
+    (184) id_list -> . ID
 
-    ID              shift and go to state 204
+    ID              shift and go to state 209
 
-    id_list                        shift and go to state 298
+    id_list                        shift and go to state 310
 
-state 262
+state 271
 
-    (158) function_param_list -> function_param_list_element empty function_param_list_empty .
+    (166) function_param_list -> function_param_list_element empty function_param_list_empty .
 
-    )               reduce using rule 158 (function_param_list -> function_param_list_element empty function_param_list_empty .)
+    )               reduce using rule 166 (function_param_list -> function_param_list_element empty function_param_list_empty .)
 
 
-state 263
+state 272
 
-    (159) function_param_list -> function_param_list_element , function_param_list .
+    (167) function_param_list -> function_param_list_element , function_param_list .
 
-    )               reduce using rule 159 (function_param_list -> function_param_list_element , function_param_list .)
+    )               reduce using rule 167 (function_param_list -> function_param_list_element , function_param_list .)
 
 
-state 264
+state 273
 
-    (113) boolean_expression -> var_ref . ID IS DEFINED .
+    (114) boolean_expression -> var_ref . ID IS DEFINED .
 
-    CMP_OP          reduce using rule 113 (boolean_expression -> var_ref . ID IS DEFINED .)
-    IN              reduce using rule 113 (boolean_expression -> var_ref . ID IS DEFINED .)
-    AND             reduce using rule 113 (boolean_expression -> var_ref . ID IS DEFINED .)
-    OR              reduce using rule 113 (boolean_expression -> var_ref . ID IS DEFINED .)
-    ?               reduce using rule 113 (boolean_expression -> var_ref . ID IS DEFINED .)
-    ENTITY          reduce using rule 113 (boolean_expression -> var_ref . ID IS DEFINED .)
-    IMPLEMENT       reduce using rule 113 (boolean_expression -> var_ref . ID IS DEFINED .)
-    IMPLEMENTATION  reduce using rule 113 (boolean_expression -> var_ref . ID IS DEFINED .)
-    INDEX           reduce using rule 113 (boolean_expression -> var_ref . ID IS DEFINED .)
-    IMPORT          reduce using rule 113 (boolean_expression -> var_ref . ID IS DEFINED .)
-    CID             reduce using rule 113 (boolean_expression -> var_ref . ID IS DEFINED .)
-    FOR             reduce using rule 113 (boolean_expression -> var_ref . ID IS DEFINED .)
-    IF              reduce using rule 113 (boolean_expression -> var_ref . ID IS DEFINED .)
-    (               reduce using rule 113 (boolean_expression -> var_ref . ID IS DEFINED .)
-    TYPEDEF         reduce using rule 113 (boolean_expression -> var_ref . ID IS DEFINED .)
-    ID              reduce using rule 113 (boolean_expression -> var_ref . ID IS DEFINED .)
-    NOT             reduce using rule 113 (boolean_expression -> var_ref . ID IS DEFINED .)
-    INT             reduce using rule 113 (boolean_expression -> var_ref . ID IS DEFINED .)
-    FLOAT           reduce using rule 113 (boolean_expression -> var_ref . ID IS DEFINED .)
-    NULL            reduce using rule 113 (boolean_expression -> var_ref . ID IS DEFINED .)
-    REGEX           reduce using rule 113 (boolean_expression -> var_ref . ID IS DEFINED .)
-    TRUE            reduce using rule 113 (boolean_expression -> var_ref . ID IS DEFINED .)
-    FALSE           reduce using rule 113 (boolean_expression -> var_ref . ID IS DEFINED .)
-    STRING          reduce using rule 113 (boolean_expression -> var_ref . ID IS DEFINED .)
-    RSTRING         reduce using rule 113 (boolean_expression -> var_ref . ID IS DEFINED .)
-    MLS             reduce using rule 113 (boolean_expression -> var_ref . ID IS DEFINED .)
-    [               reduce using rule 113 (boolean_expression -> var_ref . ID IS DEFINED .)
-    {               reduce using rule 113 (boolean_expression -> var_ref . ID IS DEFINED .)
-    $end            reduce using rule 113 (boolean_expression -> var_ref . ID IS DEFINED .)
-    )               reduce using rule 113 (boolean_expression -> var_ref . ID IS DEFINED .)
-    :               reduce using rule 113 (boolean_expression -> var_ref . ID IS DEFINED .)
-    ,               reduce using rule 113 (boolean_expression -> var_ref . ID IS DEFINED .)
-    ]               reduce using rule 113 (boolean_expression -> var_ref . ID IS DEFINED .)
-    ELSE            reduce using rule 113 (boolean_expression -> var_ref . ID IS DEFINED .)
-    ELIF            reduce using rule 113 (boolean_expression -> var_ref . ID IS DEFINED .)
-    END             reduce using rule 113 (boolean_expression -> var_ref . ID IS DEFINED .)
-    }               reduce using rule 113 (boolean_expression -> var_ref . ID IS DEFINED .)
+    CMP_OP          reduce using rule 114 (boolean_expression -> var_ref . ID IS DEFINED .)
+    IN              reduce using rule 114 (boolean_expression -> var_ref . ID IS DEFINED .)
+    AND             reduce using rule 114 (boolean_expression -> var_ref . ID IS DEFINED .)
+    OR              reduce using rule 114 (boolean_expression -> var_ref . ID IS DEFINED .)
+    ?               reduce using rule 114 (boolean_expression -> var_ref . ID IS DEFINED .)
+    ENTITY          reduce using rule 114 (boolean_expression -> var_ref . ID IS DEFINED .)
+    IMPLEMENT       reduce using rule 114 (boolean_expression -> var_ref . ID IS DEFINED .)
+    IMPLEMENTATION  reduce using rule 114 (boolean_expression -> var_ref . ID IS DEFINED .)
+    INDEX           reduce using rule 114 (boolean_expression -> var_ref . ID IS DEFINED .)
+    IMPORT          reduce using rule 114 (boolean_expression -> var_ref . ID IS DEFINED .)
+    CID             reduce using rule 114 (boolean_expression -> var_ref . ID IS DEFINED .)
+    FOR             reduce using rule 114 (boolean_expression -> var_ref . ID IS DEFINED .)
+    IF              reduce using rule 114 (boolean_expression -> var_ref . ID IS DEFINED .)
+    (               reduce using rule 114 (boolean_expression -> var_ref . ID IS DEFINED .)
+    TYPEDEF         reduce using rule 114 (boolean_expression -> var_ref . ID IS DEFINED .)
+    ID              reduce using rule 114 (boolean_expression -> var_ref . ID IS DEFINED .)
+    NOT             reduce using rule 114 (boolean_expression -> var_ref . ID IS DEFINED .)
+    INT             reduce using rule 114 (boolean_expression -> var_ref . ID IS DEFINED .)
+    FLOAT           reduce using rule 114 (boolean_expression -> var_ref . ID IS DEFINED .)
+    NULL            reduce using rule 114 (boolean_expression -> var_ref . ID IS DEFINED .)
+    REGEX           reduce using rule 114 (boolean_expression -> var_ref . ID IS DEFINED .)
+    TRUE            reduce using rule 114 (boolean_expression -> var_ref . ID IS DEFINED .)
+    FALSE           reduce using rule 114 (boolean_expression -> var_ref . ID IS DEFINED .)
+    STRING          reduce using rule 114 (boolean_expression -> var_ref . ID IS DEFINED .)
+    FSTRING         reduce using rule 114 (boolean_expression -> var_ref . ID IS DEFINED .)
+    RSTRING         reduce using rule 114 (boolean_expression -> var_ref . ID IS DEFINED .)
+    MLS             reduce using rule 114 (boolean_expression -> var_ref . ID IS DEFINED .)
+    [               reduce using rule 114 (boolean_expression -> var_ref . ID IS DEFINED .)
+    {               reduce using rule 114 (boolean_expression -> var_ref . ID IS DEFINED .)
+    $end            reduce using rule 114 (boolean_expression -> var_ref . ID IS DEFINED .)
+    )               reduce using rule 114 (boolean_expression -> var_ref . ID IS DEFINED .)
+    :               reduce using rule 114 (boolean_expression -> var_ref . ID IS DEFINED .)
+    ,               reduce using rule 114 (boolean_expression -> var_ref . ID IS DEFINED .)
+    ]               reduce using rule 114 (boolean_expression -> var_ref . ID IS DEFINED .)
+    ELSE            reduce using rule 114 (boolean_expression -> var_ref . ID IS DEFINED .)
+    ELIF            reduce using rule 114 (boolean_expression -> var_ref . ID IS DEFINED .)
+    END             reduce using rule 114 (boolean_expression -> var_ref . ID IS DEFINED .)
+    }               reduce using rule 114 (boolean_expression -> var_ref . ID IS DEFINED .)
 
 
-state 265
+state 274
 
     (27) if_body -> expression : stmt_list if_next .
 
     END             reduce using rule 27 (if_body -> expression : stmt_list if_next .)
 
 
-state 266
+state 275
 
     (28) if_next -> empty .
 
     END             reduce using rule 28 (if_next -> empty .)
 
 
-state 267
+state 276
 
     (29) if_next -> ELSE . : stmt_list
 
-    :               shift and go to state 299
+    :               shift and go to state 311
 
 
-state 268
+state 277
 
     (30) if_next -> ELIF . if_body
     (27) if_body -> . expression : stmt_list if_next
     (97) expression -> . boolean_expression
     (98) expression -> . constant
     (99) expression -> . function_call
     (100) expression -> . var_ref
     (101) expression -> . constructor
     (102) expression -> . list_def
-    (103) expression -> . map_def
-    (104) expression -> . map_lookup
-    (105) expression -> . index_lookup
-    (106) expression -> . conditional_expression
-    (107) expression -> . ( expression )
-    (108) boolean_expression -> . expression CMP_OP expression
-    (109) boolean_expression -> . expression IN expression
-    (110) boolean_expression -> . expression AND expression
-    (111) boolean_expression -> . expression OR expression
-    (112) boolean_expression -> . NOT expression
-    (113) boolean_expression -> . var_ref . ID IS DEFINED
-    (114) boolean_expression -> . ID IS DEFINED
-    (115) boolean_expression -> . map_lookup IS DEFINED
-    (134) constant -> . INT
-    (135) constant -> . FLOAT
-    (136) constant -> . NULL
-    (137) constant -> . REGEX
-    (138) constant -> . TRUE
-    (139) constant -> . FALSE
-    (140) constant -> . STRING
-    (141) constant -> . RSTRING
-    (142) constant -> . MLS
-    (121) function_call -> . ns_ref ( function_param_list )
-    (122) function_call -> . attr_ref ( function_param_list )
-    (163) var_ref -> . attr_ref
-    (165) var_ref -> . ns_ref
-    (120) constructor -> . class_ref ( param_list )
-    (123) list_def -> . [ operand_list ]
-    (130) map_def -> . { pair_list }
-    (117) map_lookup -> . attr_ref [ operand ]
-    (118) map_lookup -> . var_ref [ operand ]
-    (119) map_lookup -> . map_lookup [ operand ]
-    (131) index_lookup -> . class_ref [ param_list ]
-    (132) index_lookup -> . attr_ref [ param_list ]
-    (133) conditional_expression -> . expression ? expression : expression
-    (173) ns_ref -> . ns_ref SEP ID
-    (174) ns_ref -> . ID
-    (164) attr_ref -> . var_ref . ID
-    (166) class_ref -> . CID
-    (167) class_ref -> . ns_ref SEP CID
-    (168) class_ref -> . var_ref . CID
+    (103) expression -> . list_comprehension
+    (104) expression -> . map_def
+    (105) expression -> . map_lookup
+    (106) expression -> . index_lookup
+    (107) expression -> . conditional_expression
+    (108) expression -> . ( expression )
+    (109) boolean_expression -> . expression CMP_OP expression
+    (110) boolean_expression -> . expression IN expression
+    (111) boolean_expression -> . expression AND expression
+    (112) boolean_expression -> . expression OR expression
+    (113) boolean_expression -> . NOT expression
+    (114) boolean_expression -> . var_ref . ID IS DEFINED
+    (115) boolean_expression -> . ID IS DEFINED
+    (116) boolean_expression -> . map_lookup IS DEFINED
+    (141) constant -> . INT
+    (142) constant -> . FLOAT
+    (143) constant -> . NULL
+    (144) constant -> . REGEX
+    (145) constant -> . TRUE
+    (146) constant -> . FALSE
+    (147) constant -> . STRING
+    (148) constant -> . FSTRING
+    (149) constant -> . RSTRING
+    (150) constant -> . MLS
+    (122) function_call -> . ns_ref ( function_param_list )
+    (123) function_call -> . attr_ref ( function_param_list )
+    (171) var_ref -> . attr_ref
+    (173) var_ref -> . ns_ref
+    (121) constructor -> . class_ref ( param_list )
+    (124) list_def -> . [ operand_list ]
+    (125) list_comprehension -> . [ expression list_comprehension_for list_comprehension_guard ]
+    (137) map_def -> . { pair_list }
+    (118) map_lookup -> . attr_ref [ operand ]
+    (119) map_lookup -> . var_ref [ operand ]
+    (120) map_lookup -> . map_lookup [ operand ]
+    (138) index_lookup -> . class_ref [ param_list ]
+    (139) index_lookup -> . attr_ref [ param_list ]
+    (140) conditional_expression -> . expression ? expression : expression
+    (181) ns_ref -> . ns_ref SEP ID
+    (182) ns_ref -> . ID
+    (172) attr_ref -> . var_ref . ID
+    (174) class_ref -> . CID
+    (175) class_ref -> . ns_ref SEP CID
+    (176) class_ref -> . var_ref . CID
 
     (               shift and go to state 30
-    NOT             shift and go to state 46
-    ID              shift and go to state 82
-    INT             shift and go to state 47
-    FLOAT           shift and go to state 48
-    NULL            shift and go to state 49
-    REGEX           shift and go to state 50
-    TRUE            shift and go to state 51
-    FALSE           shift and go to state 52
-    STRING          shift and go to state 53
-    RSTRING         shift and go to state 54
+    NOT             shift and go to state 47
+    ID              shift and go to state 84
+    INT             shift and go to state 48
+    FLOAT           shift and go to state 49
+    NULL            shift and go to state 50
+    REGEX           shift and go to state 51
+    TRUE            shift and go to state 52
+    FALSE           shift and go to state 53
+    STRING          shift and go to state 54
+    FSTRING         shift and go to state 55
+    RSTRING         shift and go to state 56
     MLS             shift and go to state 20
-    [               shift and go to state 55
-    {               shift and go to state 56
+    [               shift and go to state 57
+    {               shift and go to state 58
     CID             shift and go to state 16
 
-    if_body                        shift and go to state 300
-    expression                     shift and go to state 94
+    if_body                        shift and go to state 312
+    expression                     shift and go to state 96
     boolean_expression             shift and go to state 35
     constant                       shift and go to state 36
     function_call                  shift and go to state 37
-    var_ref                        shift and go to state 81
+    var_ref                        shift and go to state 83
     constructor                    shift and go to state 38
     list_def                       shift and go to state 39
-    map_def                        shift and go to state 40
-    map_lookup                     shift and go to state 41
-    index_lookup                   shift and go to state 42
-    conditional_expression         shift and go to state 43
-    ns_ref                         shift and go to state 83
-    attr_ref                       shift and go to state 84
-    class_ref                      shift and go to state 85
+    list_comprehension             shift and go to state 40
+    map_def                        shift and go to state 41
+    map_lookup                     shift and go to state 42
+    index_lookup                   shift and go to state 43
+    conditional_expression         shift and go to state 44
+    ns_ref                         shift and go to state 85
+    attr_ref                       shift and go to state 86
+    class_ref                      shift and go to state 87
 
-state 269
+state 278
 
     (21) stmt_list -> statement stmt_list .
 
     ELSE            reduce using rule 21 (stmt_list -> statement stmt_list .)
     ELIF            reduce using rule 21 (stmt_list -> statement stmt_list .)
     END             reduce using rule 21 (stmt_list -> statement stmt_list .)
 
 
-state 270
+state 279
 
     (94) typedef_inner -> TYPEDEF ID AS ns_ref MATCHING . expression
     (97) expression -> . boolean_expression
     (98) expression -> . constant
     (99) expression -> . function_call
     (100) expression -> . var_ref
     (101) expression -> . constructor
     (102) expression -> . list_def
-    (103) expression -> . map_def
-    (104) expression -> . map_lookup
-    (105) expression -> . index_lookup
-    (106) expression -> . conditional_expression
-    (107) expression -> . ( expression )
-    (108) boolean_expression -> . expression CMP_OP expression
-    (109) boolean_expression -> . expression IN expression
-    (110) boolean_expression -> . expression AND expression
-    (111) boolean_expression -> . expression OR expression
-    (112) boolean_expression -> . NOT expression
-    (113) boolean_expression -> . var_ref . ID IS DEFINED
-    (114) boolean_expression -> . ID IS DEFINED
-    (115) boolean_expression -> . map_lookup IS DEFINED
-    (134) constant -> . INT
-    (135) constant -> . FLOAT
-    (136) constant -> . NULL
-    (137) constant -> . REGEX
-    (138) constant -> . TRUE
-    (139) constant -> . FALSE
-    (140) constant -> . STRING
-    (141) constant -> . RSTRING
-    (142) constant -> . MLS
-    (121) function_call -> . ns_ref ( function_param_list )
-    (122) function_call -> . attr_ref ( function_param_list )
-    (163) var_ref -> . attr_ref
-    (165) var_ref -> . ns_ref
-    (120) constructor -> . class_ref ( param_list )
-    (123) list_def -> . [ operand_list ]
-    (130) map_def -> . { pair_list }
-    (117) map_lookup -> . attr_ref [ operand ]
-    (118) map_lookup -> . var_ref [ operand ]
-    (119) map_lookup -> . map_lookup [ operand ]
-    (131) index_lookup -> . class_ref [ param_list ]
-    (132) index_lookup -> . attr_ref [ param_list ]
-    (133) conditional_expression -> . expression ? expression : expression
-    (173) ns_ref -> . ns_ref SEP ID
-    (174) ns_ref -> . ID
-    (164) attr_ref -> . var_ref . ID
-    (166) class_ref -> . CID
-    (167) class_ref -> . ns_ref SEP CID
-    (168) class_ref -> . var_ref . CID
+    (103) expression -> . list_comprehension
+    (104) expression -> . map_def
+    (105) expression -> . map_lookup
+    (106) expression -> . index_lookup
+    (107) expression -> . conditional_expression
+    (108) expression -> . ( expression )
+    (109) boolean_expression -> . expression CMP_OP expression
+    (110) boolean_expression -> . expression IN expression
+    (111) boolean_expression -> . expression AND expression
+    (112) boolean_expression -> . expression OR expression
+    (113) boolean_expression -> . NOT expression
+    (114) boolean_expression -> . var_ref . ID IS DEFINED
+    (115) boolean_expression -> . ID IS DEFINED
+    (116) boolean_expression -> . map_lookup IS DEFINED
+    (141) constant -> . INT
+    (142) constant -> . FLOAT
+    (143) constant -> . NULL
+    (144) constant -> . REGEX
+    (145) constant -> . TRUE
+    (146) constant -> . FALSE
+    (147) constant -> . STRING
+    (148) constant -> . FSTRING
+    (149) constant -> . RSTRING
+    (150) constant -> . MLS
+    (122) function_call -> . ns_ref ( function_param_list )
+    (123) function_call -> . attr_ref ( function_param_list )
+    (171) var_ref -> . attr_ref
+    (173) var_ref -> . ns_ref
+    (121) constructor -> . class_ref ( param_list )
+    (124) list_def -> . [ operand_list ]
+    (125) list_comprehension -> . [ expression list_comprehension_for list_comprehension_guard ]
+    (137) map_def -> . { pair_list }
+    (118) map_lookup -> . attr_ref [ operand ]
+    (119) map_lookup -> . var_ref [ operand ]
+    (120) map_lookup -> . map_lookup [ operand ]
+    (138) index_lookup -> . class_ref [ param_list ]
+    (139) index_lookup -> . attr_ref [ param_list ]
+    (140) conditional_expression -> . expression ? expression : expression
+    (181) ns_ref -> . ns_ref SEP ID
+    (182) ns_ref -> . ID
+    (172) attr_ref -> . var_ref . ID
+    (174) class_ref -> . CID
+    (175) class_ref -> . ns_ref SEP CID
+    (176) class_ref -> . var_ref . CID
 
     (               shift and go to state 30
-    NOT             shift and go to state 46
-    ID              shift and go to state 82
-    INT             shift and go to state 47
-    FLOAT           shift and go to state 48
-    NULL            shift and go to state 49
-    REGEX           shift and go to state 50
-    TRUE            shift and go to state 51
-    FALSE           shift and go to state 52
-    STRING          shift and go to state 53
-    RSTRING         shift and go to state 54
+    NOT             shift and go to state 47
+    ID              shift and go to state 84
+    INT             shift and go to state 48
+    FLOAT           shift and go to state 49
+    NULL            shift and go to state 50
+    REGEX           shift and go to state 51
+    TRUE            shift and go to state 52
+    FALSE           shift and go to state 53
+    STRING          shift and go to state 54
+    FSTRING         shift and go to state 55
+    RSTRING         shift and go to state 56
     MLS             shift and go to state 20
-    [               shift and go to state 55
-    {               shift and go to state 56
+    [               shift and go to state 57
+    {               shift and go to state 58
     CID             shift and go to state 16
 
-    ns_ref                         shift and go to state 83
-    expression                     shift and go to state 301
+    ns_ref                         shift and go to state 85
+    expression                     shift and go to state 313
     boolean_expression             shift and go to state 35
     constant                       shift and go to state 36
     function_call                  shift and go to state 37
-    var_ref                        shift and go to state 81
+    var_ref                        shift and go to state 83
     constructor                    shift and go to state 38
     list_def                       shift and go to state 39
-    map_def                        shift and go to state 40
-    map_lookup                     shift and go to state 41
-    index_lookup                   shift and go to state 42
-    conditional_expression         shift and go to state 43
-    attr_ref                       shift and go to state 84
-    class_ref                      shift and go to state 85
+    list_comprehension             shift and go to state 40
+    map_def                        shift and go to state 41
+    map_lookup                     shift and go to state 42
+    index_lookup                   shift and go to state 43
+    conditional_expression         shift and go to state 44
+    attr_ref                       shift and go to state 86
+    class_ref                      shift and go to state 87
+
+state 280
+
+    (125) list_comprehension -> [ expression list_comprehension_for list_comprehension_guard ] .
+
+    CMP_OP          reduce using rule 125 (list_comprehension -> [ expression list_comprehension_for list_comprehension_guard ] .)
+    IN              reduce using rule 125 (list_comprehension -> [ expression list_comprehension_for list_comprehension_guard ] .)
+    AND             reduce using rule 125 (list_comprehension -> [ expression list_comprehension_for list_comprehension_guard ] .)
+    OR              reduce using rule 125 (list_comprehension -> [ expression list_comprehension_for list_comprehension_guard ] .)
+    ?               reduce using rule 125 (list_comprehension -> [ expression list_comprehension_for list_comprehension_guard ] .)
+    ENTITY          reduce using rule 125 (list_comprehension -> [ expression list_comprehension_for list_comprehension_guard ] .)
+    IMPLEMENT       reduce using rule 125 (list_comprehension -> [ expression list_comprehension_for list_comprehension_guard ] .)
+    IMPLEMENTATION  reduce using rule 125 (list_comprehension -> [ expression list_comprehension_for list_comprehension_guard ] .)
+    INDEX           reduce using rule 125 (list_comprehension -> [ expression list_comprehension_for list_comprehension_guard ] .)
+    IMPORT          reduce using rule 125 (list_comprehension -> [ expression list_comprehension_for list_comprehension_guard ] .)
+    CID             reduce using rule 125 (list_comprehension -> [ expression list_comprehension_for list_comprehension_guard ] .)
+    FOR             reduce using rule 125 (list_comprehension -> [ expression list_comprehension_for list_comprehension_guard ] .)
+    IF              reduce using rule 125 (list_comprehension -> [ expression list_comprehension_for list_comprehension_guard ] .)
+    (               reduce using rule 125 (list_comprehension -> [ expression list_comprehension_for list_comprehension_guard ] .)
+    TYPEDEF         reduce using rule 125 (list_comprehension -> [ expression list_comprehension_for list_comprehension_guard ] .)
+    ID              reduce using rule 125 (list_comprehension -> [ expression list_comprehension_for list_comprehension_guard ] .)
+    NOT             reduce using rule 125 (list_comprehension -> [ expression list_comprehension_for list_comprehension_guard ] .)
+    INT             reduce using rule 125 (list_comprehension -> [ expression list_comprehension_for list_comprehension_guard ] .)
+    FLOAT           reduce using rule 125 (list_comprehension -> [ expression list_comprehension_for list_comprehension_guard ] .)
+    NULL            reduce using rule 125 (list_comprehension -> [ expression list_comprehension_for list_comprehension_guard ] .)
+    REGEX           reduce using rule 125 (list_comprehension -> [ expression list_comprehension_for list_comprehension_guard ] .)
+    TRUE            reduce using rule 125 (list_comprehension -> [ expression list_comprehension_for list_comprehension_guard ] .)
+    FALSE           reduce using rule 125 (list_comprehension -> [ expression list_comprehension_for list_comprehension_guard ] .)
+    STRING          reduce using rule 125 (list_comprehension -> [ expression list_comprehension_for list_comprehension_guard ] .)
+    FSTRING         reduce using rule 125 (list_comprehension -> [ expression list_comprehension_for list_comprehension_guard ] .)
+    RSTRING         reduce using rule 125 (list_comprehension -> [ expression list_comprehension_for list_comprehension_guard ] .)
+    MLS             reduce using rule 125 (list_comprehension -> [ expression list_comprehension_for list_comprehension_guard ] .)
+    [               reduce using rule 125 (list_comprehension -> [ expression list_comprehension_for list_comprehension_guard ] .)
+    {               reduce using rule 125 (list_comprehension -> [ expression list_comprehension_for list_comprehension_guard ] .)
+    $end            reduce using rule 125 (list_comprehension -> [ expression list_comprehension_for list_comprehension_guard ] .)
+    )               reduce using rule 125 (list_comprehension -> [ expression list_comprehension_for list_comprehension_guard ] .)
+    :               reduce using rule 125 (list_comprehension -> [ expression list_comprehension_for list_comprehension_guard ] .)
+    ,               reduce using rule 125 (list_comprehension -> [ expression list_comprehension_for list_comprehension_guard ] .)
+    ]               reduce using rule 125 (list_comprehension -> [ expression list_comprehension_for list_comprehension_guard ] .)
+    ELSE            reduce using rule 125 (list_comprehension -> [ expression list_comprehension_for list_comprehension_guard ] .)
+    ELIF            reduce using rule 125 (list_comprehension -> [ expression list_comprehension_for list_comprehension_guard ] .)
+    END             reduce using rule 125 (list_comprehension -> [ expression list_comprehension_for list_comprehension_guard ] .)
+    }               reduce using rule 125 (list_comprehension -> [ expression list_comprehension_for list_comprehension_guard ] .)
 
-state 271
 
-    (126) pair_list -> dict_key : operand , . pair_list
-    (126) pair_list -> . dict_key : operand , pair_list
-    (127) pair_list -> . dict_key : operand empty pair_list_empty
-    (128) pair_list -> . pair_list_empty
-    (124) dict_key -> . RSTRING
-    (125) dict_key -> . STRING
-    (129) pair_list_empty -> . empty
+state 281
+
+    (130) list_comprehension_guard -> IF expression . list_comprehension_guard
+    (109) boolean_expression -> expression . CMP_OP expression
+    (110) boolean_expression -> expression . IN expression
+    (111) boolean_expression -> expression . AND expression
+    (112) boolean_expression -> expression . OR expression
+    (140) conditional_expression -> expression . ? expression : expression
+    (129) list_comprehension_guard -> . empty
+    (130) list_comprehension_guard -> . IF expression list_comprehension_guard
     (14) empty -> .
 
-    RSTRING         shift and go to state 109
-    STRING          shift and go to state 110
+    CMP_OP          shift and go to state 72
+    IN              shift and go to state 73
+    AND             shift and go to state 74
+    OR              shift and go to state 75
+    ?               shift and go to state 76
+    IF              shift and go to state 230
+    ]               reduce using rule 14 (empty -> .)
+
+    list_comprehension_guard       shift and go to state 314
+    empty                          shift and go to state 229
+
+state 282
+
+    (127) list_comprehension_for -> FOR ID IN . expression list_comprehension_for_empty
+    (128) list_comprehension_for -> FOR ID IN . expression list_comprehension_for
+    (97) expression -> . boolean_expression
+    (98) expression -> . constant
+    (99) expression -> . function_call
+    (100) expression -> . var_ref
+    (101) expression -> . constructor
+    (102) expression -> . list_def
+    (103) expression -> . list_comprehension
+    (104) expression -> . map_def
+    (105) expression -> . map_lookup
+    (106) expression -> . index_lookup
+    (107) expression -> . conditional_expression
+    (108) expression -> . ( expression )
+    (109) boolean_expression -> . expression CMP_OP expression
+    (110) boolean_expression -> . expression IN expression
+    (111) boolean_expression -> . expression AND expression
+    (112) boolean_expression -> . expression OR expression
+    (113) boolean_expression -> . NOT expression
+    (114) boolean_expression -> . var_ref . ID IS DEFINED
+    (115) boolean_expression -> . ID IS DEFINED
+    (116) boolean_expression -> . map_lookup IS DEFINED
+    (141) constant -> . INT
+    (142) constant -> . FLOAT
+    (143) constant -> . NULL
+    (144) constant -> . REGEX
+    (145) constant -> . TRUE
+    (146) constant -> . FALSE
+    (147) constant -> . STRING
+    (148) constant -> . FSTRING
+    (149) constant -> . RSTRING
+    (150) constant -> . MLS
+    (122) function_call -> . ns_ref ( function_param_list )
+    (123) function_call -> . attr_ref ( function_param_list )
+    (171) var_ref -> . attr_ref
+    (173) var_ref -> . ns_ref
+    (121) constructor -> . class_ref ( param_list )
+    (124) list_def -> . [ operand_list ]
+    (125) list_comprehension -> . [ expression list_comprehension_for list_comprehension_guard ]
+    (137) map_def -> . { pair_list }
+    (118) map_lookup -> . attr_ref [ operand ]
+    (119) map_lookup -> . var_ref [ operand ]
+    (120) map_lookup -> . map_lookup [ operand ]
+    (138) index_lookup -> . class_ref [ param_list ]
+    (139) index_lookup -> . attr_ref [ param_list ]
+    (140) conditional_expression -> . expression ? expression : expression
+    (181) ns_ref -> . ns_ref SEP ID
+    (182) ns_ref -> . ID
+    (172) attr_ref -> . var_ref . ID
+    (174) class_ref -> . CID
+    (175) class_ref -> . ns_ref SEP CID
+    (176) class_ref -> . var_ref . CID
+
+    (               shift and go to state 30
+    NOT             shift and go to state 47
+    ID              shift and go to state 84
+    INT             shift and go to state 48
+    FLOAT           shift and go to state 49
+    NULL            shift and go to state 50
+    REGEX           shift and go to state 51
+    TRUE            shift and go to state 52
+    FALSE           shift and go to state 53
+    STRING          shift and go to state 54
+    FSTRING         shift and go to state 55
+    RSTRING         shift and go to state 56
+    MLS             shift and go to state 20
+    [               shift and go to state 57
+    {               shift and go to state 58
+    CID             shift and go to state 16
+
+    expression                     shift and go to state 315
+    boolean_expression             shift and go to state 35
+    constant                       shift and go to state 36
+    function_call                  shift and go to state 37
+    var_ref                        shift and go to state 83
+    constructor                    shift and go to state 38
+    list_def                       shift and go to state 39
+    list_comprehension             shift and go to state 40
+    map_def                        shift and go to state 41
+    map_lookup                     shift and go to state 42
+    index_lookup                   shift and go to state 43
+    conditional_expression         shift and go to state 44
+    ns_ref                         shift and go to state 85
+    attr_ref                       shift and go to state 86
+    class_ref                      shift and go to state 87
+
+state 283
+
+    (133) pair_list -> dict_key : operand , . pair_list
+    (133) pair_list -> . dict_key : operand , pair_list
+    (134) pair_list -> . dict_key : operand empty pair_list_empty
+    (135) pair_list -> . pair_list_empty
+    (131) dict_key -> . RSTRING
+    (132) dict_key -> . STRING
+    (136) pair_list_empty -> . empty
+    (14) empty -> .
+
+    RSTRING         shift and go to state 111
+    STRING          shift and go to state 112
     }               reduce using rule 14 (empty -> .)
 
-    dict_key                       shift and go to state 106
-    pair_list                      shift and go to state 302
-    empty                          shift and go to state 107
-    pair_list_empty                shift and go to state 108
+    dict_key                       shift and go to state 108
+    pair_list                      shift and go to state 316
+    empty                          shift and go to state 109
+    pair_list_empty                shift and go to state 110
 
-state 272
+state 284
 
-    (127) pair_list -> dict_key : operand empty . pair_list_empty
-    (129) pair_list_empty -> . empty
+    (134) pair_list -> dict_key : operand empty . pair_list_empty
+    (136) pair_list_empty -> . empty
     (14) empty -> .
 
     }               reduce using rule 14 (empty -> .)
 
-    empty                          shift and go to state 107
-    pair_list_empty                shift and go to state 303
+    empty                          shift and go to state 109
+    pair_list_empty                shift and go to state 317
 
-state 273
+state 285
 
     (35) entity_body_outer -> MLS entity_body END .
 
     ENTITY          reduce using rule 35 (entity_body_outer -> MLS entity_body END .)
     IMPLEMENT       reduce using rule 35 (entity_body_outer -> MLS entity_body END .)
     IMPLEMENTATION  reduce using rule 35 (entity_body_outer -> MLS entity_body END .)
     INDEX           reduce using rule 35 (entity_body_outer -> MLS entity_body END .)
@@ -8923,153 +9592,158 @@
     INT             reduce using rule 35 (entity_body_outer -> MLS entity_body END .)
     FLOAT           reduce using rule 35 (entity_body_outer -> MLS entity_body END .)
     NULL            reduce using rule 35 (entity_body_outer -> MLS entity_body END .)
     REGEX           reduce using rule 35 (entity_body_outer -> MLS entity_body END .)
     TRUE            reduce using rule 35 (entity_body_outer -> MLS entity_body END .)
     FALSE           reduce using rule 35 (entity_body_outer -> MLS entity_body END .)
     STRING          reduce using rule 35 (entity_body_outer -> MLS entity_body END .)
+    FSTRING         reduce using rule 35 (entity_body_outer -> MLS entity_body END .)
     RSTRING         reduce using rule 35 (entity_body_outer -> MLS entity_body END .)
     MLS             reduce using rule 35 (entity_body_outer -> MLS entity_body END .)
     [               reduce using rule 35 (entity_body_outer -> MLS entity_body END .)
     {               reduce using rule 35 (entity_body_outer -> MLS entity_body END .)
     $end            reduce using rule 35 (entity_body_outer -> MLS entity_body END .)
 
 
-state 274
+state 286
 
     (48) attr -> attr_type CID empty .
 
     END             reduce using rule 48 (attr -> attr_type CID empty .)
     DICT            reduce using rule 48 (attr -> attr_type CID empty .)
     ID              reduce using rule 48 (attr -> attr_type CID empty .)
 
 
-state 275
+state 287
 
     (49) attr -> attr_type CID = . constant
     (50) attr -> attr_type CID = . constant_list
     (51) attr -> attr_type CID = . UNDEF
-    (134) constant -> . INT
-    (135) constant -> . FLOAT
-    (136) constant -> . NULL
-    (137) constant -> . REGEX
-    (138) constant -> . TRUE
-    (139) constant -> . FALSE
-    (140) constant -> . STRING
-    (141) constant -> . RSTRING
-    (142) constant -> . MLS
-    (143) constant_list -> . [ constants ]
-
-    UNDEF           shift and go to state 306
-    INT             shift and go to state 47
-    FLOAT           shift and go to state 48
-    NULL            shift and go to state 49
-    REGEX           shift and go to state 50
-    TRUE            shift and go to state 51
-    FALSE           shift and go to state 52
-    STRING          shift and go to state 53
-    RSTRING         shift and go to state 54
+    (141) constant -> . INT
+    (142) constant -> . FLOAT
+    (143) constant -> . NULL
+    (144) constant -> . REGEX
+    (145) constant -> . TRUE
+    (146) constant -> . FALSE
+    (147) constant -> . STRING
+    (148) constant -> . FSTRING
+    (149) constant -> . RSTRING
+    (150) constant -> . MLS
+    (151) constant_list -> . [ constants ]
+
+    UNDEF           shift and go to state 320
+    INT             shift and go to state 48
+    FLOAT           shift and go to state 49
+    NULL            shift and go to state 50
+    REGEX           shift and go to state 51
+    TRUE            shift and go to state 52
+    FALSE           shift and go to state 53
+    STRING          shift and go to state 54
+    FSTRING         shift and go to state 55
+    RSTRING         shift and go to state 56
     MLS             shift and go to state 20
-    [               shift and go to state 307
+    [               shift and go to state 321
 
-    constant                       shift and go to state 304
-    constant_list                  shift and go to state 305
+    constant                       shift and go to state 318
+    constant_list                  shift and go to state 319
 
-state 276
+state 288
 
     (53) attr -> attr_type ID = . constant
     (54) attr -> attr_type ID = . constant_list
     (55) attr -> attr_type ID = . UNDEF
-    (134) constant -> . INT
-    (135) constant -> . FLOAT
-    (136) constant -> . NULL
-    (137) constant -> . REGEX
-    (138) constant -> . TRUE
-    (139) constant -> . FALSE
-    (140) constant -> . STRING
-    (141) constant -> . RSTRING
-    (142) constant -> . MLS
-    (143) constant_list -> . [ constants ]
-
-    UNDEF           shift and go to state 310
-    INT             shift and go to state 47
-    FLOAT           shift and go to state 48
-    NULL            shift and go to state 49
-    REGEX           shift and go to state 50
-    TRUE            shift and go to state 51
-    FALSE           shift and go to state 52
-    STRING          shift and go to state 53
-    RSTRING         shift and go to state 54
+    (141) constant -> . INT
+    (142) constant -> . FLOAT
+    (143) constant -> . NULL
+    (144) constant -> . REGEX
+    (145) constant -> . TRUE
+    (146) constant -> . FALSE
+    (147) constant -> . STRING
+    (148) constant -> . FSTRING
+    (149) constant -> . RSTRING
+    (150) constant -> . MLS
+    (151) constant_list -> . [ constants ]
+
+    UNDEF           shift and go to state 324
+    INT             shift and go to state 48
+    FLOAT           shift and go to state 49
+    NULL            shift and go to state 50
+    REGEX           shift and go to state 51
+    TRUE            shift and go to state 52
+    FALSE           shift and go to state 53
+    STRING          shift and go to state 54
+    FSTRING         shift and go to state 55
+    RSTRING         shift and go to state 56
     MLS             shift and go to state 20
-    [               shift and go to state 307
+    [               shift and go to state 321
 
-    constant                       shift and go to state 308
-    constant_list                  shift and go to state 309
+    constant                       shift and go to state 322
+    constant_list                  shift and go to state 323
 
-state 277
+state 289
 
     (56) attr -> DICT empty CID . empty
     (57) attr -> DICT empty CID . = map_def
     (58) attr -> DICT empty CID . = NULL
     (14) empty -> .
 
-    =               shift and go to state 312
+    =               shift and go to state 326
     END             reduce using rule 14 (empty -> .)
     DICT            reduce using rule 14 (empty -> .)
     ID              reduce using rule 14 (empty -> .)
 
-    empty                          shift and go to state 311
+    empty                          shift and go to state 325
 
-state 278
+state 290
 
     (59) attr -> DICT ? CID . empty
     (60) attr -> DICT ? CID . = map_def
     (61) attr -> DICT ? CID . = NULL
     (14) empty -> .
 
-    =               shift and go to state 314
+    =               shift and go to state 328
     END             reduce using rule 14 (empty -> .)
     DICT            reduce using rule 14 (empty -> .)
     ID              reduce using rule 14 (empty -> .)
 
-    empty                          shift and go to state 313
+    empty                          shift and go to state 327
 
-state 279
+state 291
 
     (65) attr -> DICT ? ID .
     (66) attr -> DICT ? ID . = map_def
     (67) attr -> DICT ? ID . = NULL
 
     END             reduce using rule 65 (attr -> DICT ? ID .)
     DICT            reduce using rule 65 (attr -> DICT ? ID .)
     ID              reduce using rule 65 (attr -> DICT ? ID .)
-    =               shift and go to state 315
+    =               shift and go to state 329
 
 
-state 280
+state 292
 
     (63) attr -> DICT ID = . map_def
     (64) attr -> DICT ID = . NULL
-    (130) map_def -> . { pair_list }
+    (137) map_def -> . { pair_list }
 
-    NULL            shift and go to state 317
-    {               shift and go to state 56
+    NULL            shift and go to state 331
+    {               shift and go to state 58
 
-    map_def                        shift and go to state 316
+    map_def                        shift and go to state 330
 
-state 281
+state 293
 
     (42) attr_type_multi -> attr_base_type [ ] .
 
     ?               reduce using rule 42 (attr_type_multi -> attr_base_type [ ] .)
     CID             reduce using rule 42 (attr_type_multi -> attr_base_type [ ] .)
     ID              reduce using rule 42 (attr_type_multi -> attr_base_type [ ] .)
 
 
-state 282
+state 294
 
     (33) entity_def -> ENTITY CID EXTENDS class_ref_list : entity_body_outer .
 
     ENTITY          reduce using rule 33 (entity_def -> ENTITY CID EXTENDS class_ref_list : entity_body_outer .)
     IMPLEMENT       reduce using rule 33 (entity_def -> ENTITY CID EXTENDS class_ref_list : entity_body_outer .)
     IMPLEMENTATION  reduce using rule 33 (entity_def -> ENTITY CID EXTENDS class_ref_list : entity_body_outer .)
     INDEX           reduce using rule 33 (entity_def -> ENTITY CID EXTENDS class_ref_list : entity_body_outer .)
@@ -9084,36 +9758,37 @@
     INT             reduce using rule 33 (entity_def -> ENTITY CID EXTENDS class_ref_list : entity_body_outer .)
     FLOAT           reduce using rule 33 (entity_def -> ENTITY CID EXTENDS class_ref_list : entity_body_outer .)
     NULL            reduce using rule 33 (entity_def -> ENTITY CID EXTENDS class_ref_list : entity_body_outer .)
     REGEX           reduce using rule 33 (entity_def -> ENTITY CID EXTENDS class_ref_list : entity_body_outer .)
     TRUE            reduce using rule 33 (entity_def -> ENTITY CID EXTENDS class_ref_list : entity_body_outer .)
     FALSE           reduce using rule 33 (entity_def -> ENTITY CID EXTENDS class_ref_list : entity_body_outer .)
     STRING          reduce using rule 33 (entity_def -> ENTITY CID EXTENDS class_ref_list : entity_body_outer .)
+    FSTRING         reduce using rule 33 (entity_def -> ENTITY CID EXTENDS class_ref_list : entity_body_outer .)
     RSTRING         reduce using rule 33 (entity_def -> ENTITY CID EXTENDS class_ref_list : entity_body_outer .)
     MLS             reduce using rule 33 (entity_def -> ENTITY CID EXTENDS class_ref_list : entity_body_outer .)
     [               reduce using rule 33 (entity_def -> ENTITY CID EXTENDS class_ref_list : entity_body_outer .)
     {               reduce using rule 33 (entity_def -> ENTITY CID EXTENDS class_ref_list : entity_body_outer .)
     $end            reduce using rule 33 (entity_def -> ENTITY CID EXTENDS class_ref_list : entity_body_outer .)
 
 
-state 283
+state 295
 
-    (169) class_ref_list -> class_ref , class_ref_list .
+    (177) class_ref_list -> class_ref , class_ref_list .
 
-    :               reduce using rule 169 (class_ref_list -> class_ref , class_ref_list .)
+    :               reduce using rule 177 (class_ref_list -> class_ref , class_ref_list .)
 
 
-state 284
+state 296
 
-    (170) class_ref_list -> var_ref , class_ref_list .
+    (178) class_ref_list -> var_ref , class_ref_list .
 
-    :               reduce using rule 170 (class_ref_list -> var_ref , class_ref_list .)
+    :               reduce using rule 178 (class_ref_list -> var_ref , class_ref_list .)
 
 
-state 285
+state 297
 
     (34) entity_def -> ENTITY ID EXTENDS class_ref_list : entity_body_outer .
 
     ENTITY          reduce using rule 34 (entity_def -> ENTITY ID EXTENDS class_ref_list : entity_body_outer .)
     IMPLEMENT       reduce using rule 34 (entity_def -> ENTITY ID EXTENDS class_ref_list : entity_body_outer .)
     IMPLEMENTATION  reduce using rule 34 (entity_def -> ENTITY ID EXTENDS class_ref_list : entity_body_outer .)
     INDEX           reduce using rule 34 (entity_def -> ENTITY ID EXTENDS class_ref_list : entity_body_outer .)
@@ -9128,38 +9803,39 @@
     INT             reduce using rule 34 (entity_def -> ENTITY ID EXTENDS class_ref_list : entity_body_outer .)
     FLOAT           reduce using rule 34 (entity_def -> ENTITY ID EXTENDS class_ref_list : entity_body_outer .)
     NULL            reduce using rule 34 (entity_def -> ENTITY ID EXTENDS class_ref_list : entity_body_outer .)
     REGEX           reduce using rule 34 (entity_def -> ENTITY ID EXTENDS class_ref_list : entity_body_outer .)
     TRUE            reduce using rule 34 (entity_def -> ENTITY ID EXTENDS class_ref_list : entity_body_outer .)
     FALSE           reduce using rule 34 (entity_def -> ENTITY ID EXTENDS class_ref_list : entity_body_outer .)
     STRING          reduce using rule 34 (entity_def -> ENTITY ID EXTENDS class_ref_list : entity_body_outer .)
+    FSTRING         reduce using rule 34 (entity_def -> ENTITY ID EXTENDS class_ref_list : entity_body_outer .)
     RSTRING         reduce using rule 34 (entity_def -> ENTITY ID EXTENDS class_ref_list : entity_body_outer .)
     MLS             reduce using rule 34 (entity_def -> ENTITY ID EXTENDS class_ref_list : entity_body_outer .)
     [               reduce using rule 34 (entity_def -> ENTITY ID EXTENDS class_ref_list : entity_body_outer .)
     {               reduce using rule 34 (entity_def -> ENTITY ID EXTENDS class_ref_list : entity_body_outer .)
     $end            reduce using rule 34 (entity_def -> ENTITY ID EXTENDS class_ref_list : entity_body_outer .)
 
 
-state 286
+state 298
 
     (73) implement_def -> IMPLEMENT class_ref USING implement_ns_list WHEN expression . empty
     (74) implement_def -> IMPLEMENT class_ref USING implement_ns_list WHEN expression . MLS
-    (108) boolean_expression -> expression . CMP_OP expression
-    (109) boolean_expression -> expression . IN expression
-    (110) boolean_expression -> expression . AND expression
-    (111) boolean_expression -> expression . OR expression
-    (133) conditional_expression -> expression . ? expression : expression
+    (109) boolean_expression -> expression . CMP_OP expression
+    (110) boolean_expression -> expression . IN expression
+    (111) boolean_expression -> expression . AND expression
+    (112) boolean_expression -> expression . OR expression
+    (140) conditional_expression -> expression . ? expression : expression
     (14) empty -> .
 
-    MLS             shift and go to state 319
-    CMP_OP          shift and go to state 70
-    IN              shift and go to state 71
-    AND             shift and go to state 72
-    OR              shift and go to state 73
-    ?               shift and go to state 74
+    MLS             shift and go to state 333
+    CMP_OP          shift and go to state 72
+    IN              shift and go to state 73
+    AND             shift and go to state 74
+    OR              shift and go to state 75
+    ?               shift and go to state 76
     ENTITY          reduce using rule 14 (empty -> .)
     IMPLEMENT       reduce using rule 14 (empty -> .)
     IMPLEMENTATION  reduce using rule 14 (empty -> .)
     INDEX           reduce using rule 14 (empty -> .)
     IMPORT          reduce using rule 14 (empty -> .)
     CID             reduce using rule 14 (empty -> .)
     FOR             reduce using rule 14 (empty -> .)
@@ -9171,24 +9847,25 @@
     INT             reduce using rule 14 (empty -> .)
     FLOAT           reduce using rule 14 (empty -> .)
     NULL            reduce using rule 14 (empty -> .)
     REGEX           reduce using rule 14 (empty -> .)
     TRUE            reduce using rule 14 (empty -> .)
     FALSE           reduce using rule 14 (empty -> .)
     STRING          reduce using rule 14 (empty -> .)
+    FSTRING         reduce using rule 14 (empty -> .)
     RSTRING         reduce using rule 14 (empty -> .)
     [               reduce using rule 14 (empty -> .)
     {               reduce using rule 14 (empty -> .)
     $end            reduce using rule 14 (empty -> .)
 
   ! MLS             [ reduce using rule 14 (empty -> .) ]
 
-    empty                          shift and go to state 318
+    empty                          shift and go to state 332
 
-state 287
+state 299
 
     (70) implement_ns_list -> implement_ns_list , implement_ns_list .
     (70) implement_ns_list -> implement_ns_list . , implement_ns_list
 
     MLS             reduce using rule 70 (implement_ns_list -> implement_ns_list , implement_ns_list .)
     WHEN            reduce using rule 70 (implement_ns_list -> implement_ns_list , implement_ns_list .)
     ENTITY          reduce using rule 70 (implement_ns_list -> implement_ns_list , implement_ns_list .)
@@ -9206,53 +9883,55 @@
     INT             reduce using rule 70 (implement_ns_list -> implement_ns_list , implement_ns_list .)
     FLOAT           reduce using rule 70 (implement_ns_list -> implement_ns_list , implement_ns_list .)
     NULL            reduce using rule 70 (implement_ns_list -> implement_ns_list , implement_ns_list .)
     REGEX           reduce using rule 70 (implement_ns_list -> implement_ns_list , implement_ns_list .)
     TRUE            reduce using rule 70 (implement_ns_list -> implement_ns_list , implement_ns_list .)
     FALSE           reduce using rule 70 (implement_ns_list -> implement_ns_list , implement_ns_list .)
     STRING          reduce using rule 70 (implement_ns_list -> implement_ns_list , implement_ns_list .)
+    FSTRING         reduce using rule 70 (implement_ns_list -> implement_ns_list , implement_ns_list .)
     RSTRING         reduce using rule 70 (implement_ns_list -> implement_ns_list , implement_ns_list .)
     [               reduce using rule 70 (implement_ns_list -> implement_ns_list , implement_ns_list .)
     {               reduce using rule 70 (implement_ns_list -> implement_ns_list , implement_ns_list .)
     $end            reduce using rule 70 (implement_ns_list -> implement_ns_list , implement_ns_list .)
-    ,               shift and go to state 244
+    ,               shift and go to state 253
 
   ! ,               [ reduce using rule 70 (implement_ns_list -> implement_ns_list , implement_ns_list .) ]
 
 
-state 288
+state 300
 
     (80) relation -> class_ref ID multi REL multi class_ref . ID
     (81) relation -> class_ref ID multi REL multi class_ref . ID MLS
 
-    ID              shift and go to state 320
+    ID              shift and go to state 334
 
 
-state 289
+state 301
 
     (90) multi -> [ INT : INT . ]
 
-    ]               shift and go to state 321
+    ]               shift and go to state 335
 
 
-state 290
+state 302
 
     (89) multi -> [ INT : ] .
 
     REL             reduce using rule 89 (multi -> [ INT : ] .)
     (               reduce using rule 89 (multi -> [ INT : ] .)
     NOT             reduce using rule 89 (multi -> [ INT : ] .)
     ID              reduce using rule 89 (multi -> [ INT : ] .)
     INT             reduce using rule 89 (multi -> [ INT : ] .)
     FLOAT           reduce using rule 89 (multi -> [ INT : ] .)
     NULL            reduce using rule 89 (multi -> [ INT : ] .)
     REGEX           reduce using rule 89 (multi -> [ INT : ] .)
     TRUE            reduce using rule 89 (multi -> [ INT : ] .)
     FALSE           reduce using rule 89 (multi -> [ INT : ] .)
     STRING          reduce using rule 89 (multi -> [ INT : ] .)
+    FSTRING         reduce using rule 89 (multi -> [ INT : ] .)
     RSTRING         reduce using rule 89 (multi -> [ INT : ] .)
     MLS             reduce using rule 89 (multi -> [ INT : ] .)
     [               reduce using rule 89 (multi -> [ INT : ] .)
     {               reduce using rule 89 (multi -> [ INT : ] .)
     CID             reduce using rule 89 (multi -> [ INT : ] .)
     ENTITY          reduce using rule 89 (multi -> [ INT : ] .)
     IMPLEMENT       reduce using rule 89 (multi -> [ INT : ] .)
@@ -9261,29 +9940,30 @@
     IMPORT          reduce using rule 89 (multi -> [ INT : ] .)
     FOR             reduce using rule 89 (multi -> [ INT : ] .)
     IF              reduce using rule 89 (multi -> [ INT : ] .)
     TYPEDEF         reduce using rule 89 (multi -> [ INT : ] .)
     $end            reduce using rule 89 (multi -> [ INT : ] .)
 
 
-state 291
+state 303
 
     (91) multi -> [ : INT ] .
 
     REL             reduce using rule 91 (multi -> [ : INT ] .)
     (               reduce using rule 91 (multi -> [ : INT ] .)
     NOT             reduce using rule 91 (multi -> [ : INT ] .)
     ID              reduce using rule 91 (multi -> [ : INT ] .)
     INT             reduce using rule 91 (multi -> [ : INT ] .)
     FLOAT           reduce using rule 91 (multi -> [ : INT ] .)
     NULL            reduce using rule 91 (multi -> [ : INT ] .)
     REGEX           reduce using rule 91 (multi -> [ : INT ] .)
     TRUE            reduce using rule 91 (multi -> [ : INT ] .)
     FALSE           reduce using rule 91 (multi -> [ : INT ] .)
     STRING          reduce using rule 91 (multi -> [ : INT ] .)
+    FSTRING         reduce using rule 91 (multi -> [ : INT ] .)
     RSTRING         reduce using rule 91 (multi -> [ : INT ] .)
     MLS             reduce using rule 91 (multi -> [ : INT ] .)
     [               reduce using rule 91 (multi -> [ : INT ] .)
     {               reduce using rule 91 (multi -> [ : INT ] .)
     CID             reduce using rule 91 (multi -> [ : INT ] .)
     ENTITY          reduce using rule 91 (multi -> [ : INT ] .)
     IMPLEMENT       reduce using rule 91 (multi -> [ : INT ] .)
@@ -9292,20 +9972,20 @@
     IMPORT          reduce using rule 91 (multi -> [ : INT ] .)
     FOR             reduce using rule 91 (multi -> [ : INT ] .)
     IF              reduce using rule 91 (multi -> [ : INT ] .)
     TYPEDEF         reduce using rule 91 (multi -> [ : INT ] .)
     $end            reduce using rule 91 (multi -> [ : INT ] .)
 
 
-state 292
+state 304
 
     (84) relation_def -> class_ref . ID multi REL class_ref . . ID multi
     (85) relation_def -> class_ref . ID multi REL class_ref .
 
-    .               shift and go to state 322
+    .               shift and go to state 336
     MLS             reduce using rule 85 (relation_def -> class_ref . ID multi REL class_ref .)
     ENTITY          reduce using rule 85 (relation_def -> class_ref . ID multi REL class_ref .)
     IMPLEMENT       reduce using rule 85 (relation_def -> class_ref . ID multi REL class_ref .)
     IMPLEMENTATION  reduce using rule 85 (relation_def -> class_ref . ID multi REL class_ref .)
     INDEX           reduce using rule 85 (relation_def -> class_ref . ID multi REL class_ref .)
     IMPORT          reduce using rule 85 (relation_def -> class_ref . ID multi REL class_ref .)
     CID             reduce using rule 85 (relation_def -> class_ref . ID multi REL class_ref .)
@@ -9318,26 +9998,27 @@
     INT             reduce using rule 85 (relation_def -> class_ref . ID multi REL class_ref .)
     FLOAT           reduce using rule 85 (relation_def -> class_ref . ID multi REL class_ref .)
     NULL            reduce using rule 85 (relation_def -> class_ref . ID multi REL class_ref .)
     REGEX           reduce using rule 85 (relation_def -> class_ref . ID multi REL class_ref .)
     TRUE            reduce using rule 85 (relation_def -> class_ref . ID multi REL class_ref .)
     FALSE           reduce using rule 85 (relation_def -> class_ref . ID multi REL class_ref .)
     STRING          reduce using rule 85 (relation_def -> class_ref . ID multi REL class_ref .)
+    FSTRING         reduce using rule 85 (relation_def -> class_ref . ID multi REL class_ref .)
     RSTRING         reduce using rule 85 (relation_def -> class_ref . ID multi REL class_ref .)
     [               reduce using rule 85 (relation_def -> class_ref . ID multi REL class_ref .)
     {               reduce using rule 85 (relation_def -> class_ref . ID multi REL class_ref .)
     $end            reduce using rule 85 (relation_def -> class_ref . ID multi REL class_ref .)
 
 
-state 293
+state 305
 
     (86) relation_def -> class_ref . ID multi operand_list class_ref . . ID multi
     (87) relation_def -> class_ref . ID multi operand_list class_ref .
 
-    .               shift and go to state 323
+    .               shift and go to state 337
     MLS             reduce using rule 87 (relation_def -> class_ref . ID multi operand_list class_ref .)
     ENTITY          reduce using rule 87 (relation_def -> class_ref . ID multi operand_list class_ref .)
     IMPLEMENT       reduce using rule 87 (relation_def -> class_ref . ID multi operand_list class_ref .)
     IMPLEMENTATION  reduce using rule 87 (relation_def -> class_ref . ID multi operand_list class_ref .)
     INDEX           reduce using rule 87 (relation_def -> class_ref . ID multi operand_list class_ref .)
     IMPORT          reduce using rule 87 (relation_def -> class_ref . ID multi operand_list class_ref .)
     CID             reduce using rule 87 (relation_def -> class_ref . ID multi operand_list class_ref .)
@@ -9350,21 +10031,22 @@
     INT             reduce using rule 87 (relation_def -> class_ref . ID multi operand_list class_ref .)
     FLOAT           reduce using rule 87 (relation_def -> class_ref . ID multi operand_list class_ref .)
     NULL            reduce using rule 87 (relation_def -> class_ref . ID multi operand_list class_ref .)
     REGEX           reduce using rule 87 (relation_def -> class_ref . ID multi operand_list class_ref .)
     TRUE            reduce using rule 87 (relation_def -> class_ref . ID multi operand_list class_ref .)
     FALSE           reduce using rule 87 (relation_def -> class_ref . ID multi operand_list class_ref .)
     STRING          reduce using rule 87 (relation_def -> class_ref . ID multi operand_list class_ref .)
+    FSTRING         reduce using rule 87 (relation_def -> class_ref . ID multi operand_list class_ref .)
     RSTRING         reduce using rule 87 (relation_def -> class_ref . ID multi operand_list class_ref .)
     [               reduce using rule 87 (relation_def -> class_ref . ID multi operand_list class_ref .)
     {               reduce using rule 87 (relation_def -> class_ref . ID multi operand_list class_ref .)
     $end            reduce using rule 87 (relation_def -> class_ref . ID multi operand_list class_ref .)
 
 
-state 294
+state 306
 
     (76) implementation -> implementation_head block .
 
     ENTITY          reduce using rule 76 (implementation -> implementation_head block .)
     IMPLEMENT       reduce using rule 76 (implementation -> implementation_head block .)
     IMPLEMENTATION  reduce using rule 76 (implementation -> implementation_head block .)
     INDEX           reduce using rule 76 (implementation -> implementation_head block .)
@@ -9379,29 +10061,30 @@
     INT             reduce using rule 76 (implementation -> implementation_head block .)
     FLOAT           reduce using rule 76 (implementation -> implementation_head block .)
     NULL            reduce using rule 76 (implementation -> implementation_head block .)
     REGEX           reduce using rule 76 (implementation -> implementation_head block .)
     TRUE            reduce using rule 76 (implementation -> implementation_head block .)
     FALSE           reduce using rule 76 (implementation -> implementation_head block .)
     STRING          reduce using rule 76 (implementation -> implementation_head block .)
+    FSTRING         reduce using rule 76 (implementation -> implementation_head block .)
     RSTRING         reduce using rule 76 (implementation -> implementation_head block .)
     MLS             reduce using rule 76 (implementation -> implementation_head block .)
     [               reduce using rule 76 (implementation -> implementation_head block .)
     {               reduce using rule 76 (implementation -> implementation_head block .)
     $end            reduce using rule 76 (implementation -> implementation_head block .)
 
 
-state 295
+state 307
 
     (79) block -> stmt_list . END
 
-    END             shift and go to state 324
+    END             shift and go to state 338
 
 
-state 296
+state 308
 
     (78) implementation_head -> : MLS .
 
     FOR             reduce using rule 78 (implementation_head -> : MLS .)
     IF              reduce using rule 78 (implementation_head -> : MLS .)
     (               reduce using rule 78 (implementation_head -> : MLS .)
     NOT             reduce using rule 78 (implementation_head -> : MLS .)
@@ -9409,23 +10092,24 @@
     INT             reduce using rule 78 (implementation_head -> : MLS .)
     FLOAT           reduce using rule 78 (implementation_head -> : MLS .)
     NULL            reduce using rule 78 (implementation_head -> : MLS .)
     REGEX           reduce using rule 78 (implementation_head -> : MLS .)
     TRUE            reduce using rule 78 (implementation_head -> : MLS .)
     FALSE           reduce using rule 78 (implementation_head -> : MLS .)
     STRING          reduce using rule 78 (implementation_head -> : MLS .)
+    FSTRING         reduce using rule 78 (implementation_head -> : MLS .)
     RSTRING         reduce using rule 78 (implementation_head -> : MLS .)
     MLS             reduce using rule 78 (implementation_head -> : MLS .)
     [               reduce using rule 78 (implementation_head -> : MLS .)
     {               reduce using rule 78 (implementation_head -> : MLS .)
     CID             reduce using rule 78 (implementation_head -> : MLS .)
     END             reduce using rule 78 (implementation_head -> : MLS .)
 
 
-state 297
+state 309
 
     (25) for -> FOR ID IN operand : block .
 
     ENTITY          reduce using rule 25 (for -> FOR ID IN operand : block .)
     IMPLEMENT       reduce using rule 25 (for -> FOR ID IN operand : block .)
     IMPLEMENTATION  reduce using rule 25 (for -> FOR ID IN operand : block .)
     INDEX           reduce using rule 25 (for -> FOR ID IN operand : block .)
@@ -9440,32 +10124,33 @@
     INT             reduce using rule 25 (for -> FOR ID IN operand : block .)
     FLOAT           reduce using rule 25 (for -> FOR ID IN operand : block .)
     NULL            reduce using rule 25 (for -> FOR ID IN operand : block .)
     REGEX           reduce using rule 25 (for -> FOR ID IN operand : block .)
     TRUE            reduce using rule 25 (for -> FOR ID IN operand : block .)
     FALSE           reduce using rule 25 (for -> FOR ID IN operand : block .)
     STRING          reduce using rule 25 (for -> FOR ID IN operand : block .)
+    FSTRING         reduce using rule 25 (for -> FOR ID IN operand : block .)
     RSTRING         reduce using rule 25 (for -> FOR ID IN operand : block .)
     MLS             reduce using rule 25 (for -> FOR ID IN operand : block .)
     [               reduce using rule 25 (for -> FOR ID IN operand : block .)
     {               reduce using rule 25 (for -> FOR ID IN operand : block .)
     $end            reduce using rule 25 (for -> FOR ID IN operand : block .)
     ELSE            reduce using rule 25 (for -> FOR ID IN operand : block .)
     ELIF            reduce using rule 25 (for -> FOR ID IN operand : block .)
     END             reduce using rule 25 (for -> FOR ID IN operand : block .)
 
 
-state 298
+state 310
 
-    (175) id_list -> ID , id_list .
+    (183) id_list -> ID , id_list .
 
-    )               reduce using rule 175 (id_list -> ID , id_list .)
+    )               reduce using rule 183 (id_list -> ID , id_list .)
 
 
-state 299
+state 311
 
     (29) if_next -> ELSE : . stmt_list
     (21) stmt_list -> . statement stmt_list
     (22) stmt_list -> . empty
     (17) statement -> . assign
     (18) statement -> . for
     (19) statement -> . if
@@ -9477,111 +10162,116 @@
     (26) if -> . IF if_body END
     (97) expression -> . boolean_expression
     (98) expression -> . constant
     (99) expression -> . function_call
     (100) expression -> . var_ref
     (101) expression -> . constructor
     (102) expression -> . list_def
-    (103) expression -> . map_def
-    (104) expression -> . map_lookup
-    (105) expression -> . index_lookup
-    (106) expression -> . conditional_expression
-    (107) expression -> . ( expression )
-    (163) var_ref -> . attr_ref
-    (165) var_ref -> . ns_ref
-    (108) boolean_expression -> . expression CMP_OP expression
-    (109) boolean_expression -> . expression IN expression
-    (110) boolean_expression -> . expression AND expression
-    (111) boolean_expression -> . expression OR expression
-    (112) boolean_expression -> . NOT expression
-    (113) boolean_expression -> . var_ref . ID IS DEFINED
-    (114) boolean_expression -> . ID IS DEFINED
-    (115) boolean_expression -> . map_lookup IS DEFINED
-    (134) constant -> . INT
-    (135) constant -> . FLOAT
-    (136) constant -> . NULL
-    (137) constant -> . REGEX
-    (138) constant -> . TRUE
-    (139) constant -> . FALSE
-    (140) constant -> . STRING
-    (141) constant -> . RSTRING
-    (142) constant -> . MLS
-    (121) function_call -> . ns_ref ( function_param_list )
-    (122) function_call -> . attr_ref ( function_param_list )
-    (120) constructor -> . class_ref ( param_list )
-    (123) list_def -> . [ operand_list ]
-    (130) map_def -> . { pair_list }
-    (117) map_lookup -> . attr_ref [ operand ]
-    (118) map_lookup -> . var_ref [ operand ]
-    (119) map_lookup -> . map_lookup [ operand ]
-    (131) index_lookup -> . class_ref [ param_list ]
-    (132) index_lookup -> . attr_ref [ param_list ]
-    (133) conditional_expression -> . expression ? expression : expression
-    (164) attr_ref -> . var_ref . ID
-    (173) ns_ref -> . ns_ref SEP ID
-    (174) ns_ref -> . ID
-    (166) class_ref -> . CID
-    (167) class_ref -> . ns_ref SEP CID
-    (168) class_ref -> . var_ref . CID
+    (103) expression -> . list_comprehension
+    (104) expression -> . map_def
+    (105) expression -> . map_lookup
+    (106) expression -> . index_lookup
+    (107) expression -> . conditional_expression
+    (108) expression -> . ( expression )
+    (171) var_ref -> . attr_ref
+    (173) var_ref -> . ns_ref
+    (109) boolean_expression -> . expression CMP_OP expression
+    (110) boolean_expression -> . expression IN expression
+    (111) boolean_expression -> . expression AND expression
+    (112) boolean_expression -> . expression OR expression
+    (113) boolean_expression -> . NOT expression
+    (114) boolean_expression -> . var_ref . ID IS DEFINED
+    (115) boolean_expression -> . ID IS DEFINED
+    (116) boolean_expression -> . map_lookup IS DEFINED
+    (141) constant -> . INT
+    (142) constant -> . FLOAT
+    (143) constant -> . NULL
+    (144) constant -> . REGEX
+    (145) constant -> . TRUE
+    (146) constant -> . FALSE
+    (147) constant -> . STRING
+    (148) constant -> . FSTRING
+    (149) constant -> . RSTRING
+    (150) constant -> . MLS
+    (122) function_call -> . ns_ref ( function_param_list )
+    (123) function_call -> . attr_ref ( function_param_list )
+    (121) constructor -> . class_ref ( param_list )
+    (124) list_def -> . [ operand_list ]
+    (125) list_comprehension -> . [ expression list_comprehension_for list_comprehension_guard ]
+    (137) map_def -> . { pair_list }
+    (118) map_lookup -> . attr_ref [ operand ]
+    (119) map_lookup -> . var_ref [ operand ]
+    (120) map_lookup -> . map_lookup [ operand ]
+    (138) index_lookup -> . class_ref [ param_list ]
+    (139) index_lookup -> . attr_ref [ param_list ]
+    (140) conditional_expression -> . expression ? expression : expression
+    (172) attr_ref -> . var_ref . ID
+    (181) ns_ref -> . ns_ref SEP ID
+    (182) ns_ref -> . ID
+    (174) class_ref -> . CID
+    (175) class_ref -> . ns_ref SEP CID
+    (176) class_ref -> . var_ref . CID
 
     END             reduce using rule 14 (empty -> .)
     FOR             shift and go to state 23
     IF              shift and go to state 34
     (               shift and go to state 30
-    NOT             shift and go to state 46
-    ID              shift and go to state 82
-    INT             shift and go to state 47
-    FLOAT           shift and go to state 48
-    NULL            shift and go to state 49
-    REGEX           shift and go to state 50
-    TRUE            shift and go to state 51
-    FALSE           shift and go to state 52
-    STRING          shift and go to state 53
-    RSTRING         shift and go to state 54
+    NOT             shift and go to state 47
+    ID              shift and go to state 84
+    INT             shift and go to state 48
+    FLOAT           shift and go to state 49
+    NULL            shift and go to state 50
+    REGEX           shift and go to state 51
+    TRUE            shift and go to state 52
+    FALSE           shift and go to state 53
+    STRING          shift and go to state 54
+    FSTRING         shift and go to state 55
+    RSTRING         shift and go to state 56
     MLS             shift and go to state 20
-    [               shift and go to state 55
-    {               shift and go to state 56
+    [               shift and go to state 57
+    {               shift and go to state 58
     CID             shift and go to state 16
 
-    stmt_list                      shift and go to state 325
-    statement                      shift and go to state 212
-    empty                          shift and go to state 213
+    stmt_list                      shift and go to state 339
+    statement                      shift and go to state 217
+    empty                          shift and go to state 218
     assign                         shift and go to state 25
     for                            shift and go to state 26
     if                             shift and go to state 27
     expression                     shift and go to state 21
-    var_ref                        shift and go to state 214
+    var_ref                        shift and go to state 219
     boolean_expression             shift and go to state 35
     constant                       shift and go to state 36
     function_call                  shift and go to state 37
     constructor                    shift and go to state 38
     list_def                       shift and go to state 39
-    map_def                        shift and go to state 40
-    map_lookup                     shift and go to state 41
-    index_lookup                   shift and go to state 42
-    conditional_expression         shift and go to state 43
-    attr_ref                       shift and go to state 45
-    ns_ref                         shift and go to state 215
-    class_ref                      shift and go to state 85
+    list_comprehension             shift and go to state 40
+    map_def                        shift and go to state 41
+    map_lookup                     shift and go to state 42
+    index_lookup                   shift and go to state 43
+    conditional_expression         shift and go to state 44
+    attr_ref                       shift and go to state 46
+    ns_ref                         shift and go to state 220
+    class_ref                      shift and go to state 87
 
-state 300
+state 312
 
     (30) if_next -> ELIF if_body .
 
     END             reduce using rule 30 (if_next -> ELIF if_body .)
 
 
-state 301
+state 313
 
     (94) typedef_inner -> TYPEDEF ID AS ns_ref MATCHING expression .
-    (108) boolean_expression -> expression . CMP_OP expression
-    (109) boolean_expression -> expression . IN expression
-    (110) boolean_expression -> expression . AND expression
-    (111) boolean_expression -> expression . OR expression
-    (133) conditional_expression -> expression . ? expression : expression
+    (109) boolean_expression -> expression . CMP_OP expression
+    (110) boolean_expression -> expression . IN expression
+    (111) boolean_expression -> expression . AND expression
+    (112) boolean_expression -> expression . OR expression
+    (140) conditional_expression -> expression . ? expression : expression
 
     MLS             reduce using rule 94 (typedef_inner -> TYPEDEF ID AS ns_ref MATCHING expression .)
     ENTITY          reduce using rule 94 (typedef_inner -> TYPEDEF ID AS ns_ref MATCHING expression .)
     IMPLEMENT       reduce using rule 94 (typedef_inner -> TYPEDEF ID AS ns_ref MATCHING expression .)
     IMPLEMENTATION  reduce using rule 94 (typedef_inner -> TYPEDEF ID AS ns_ref MATCHING expression .)
     INDEX           reduce using rule 94 (typedef_inner -> TYPEDEF ID AS ns_ref MATCHING expression .)
     IMPORT          reduce using rule 94 (typedef_inner -> TYPEDEF ID AS ns_ref MATCHING expression .)
@@ -9595,193 +10285,230 @@
     INT             reduce using rule 94 (typedef_inner -> TYPEDEF ID AS ns_ref MATCHING expression .)
     FLOAT           reduce using rule 94 (typedef_inner -> TYPEDEF ID AS ns_ref MATCHING expression .)
     NULL            reduce using rule 94 (typedef_inner -> TYPEDEF ID AS ns_ref MATCHING expression .)
     REGEX           reduce using rule 94 (typedef_inner -> TYPEDEF ID AS ns_ref MATCHING expression .)
     TRUE            reduce using rule 94 (typedef_inner -> TYPEDEF ID AS ns_ref MATCHING expression .)
     FALSE           reduce using rule 94 (typedef_inner -> TYPEDEF ID AS ns_ref MATCHING expression .)
     STRING          reduce using rule 94 (typedef_inner -> TYPEDEF ID AS ns_ref MATCHING expression .)
+    FSTRING         reduce using rule 94 (typedef_inner -> TYPEDEF ID AS ns_ref MATCHING expression .)
     RSTRING         reduce using rule 94 (typedef_inner -> TYPEDEF ID AS ns_ref MATCHING expression .)
     [               reduce using rule 94 (typedef_inner -> TYPEDEF ID AS ns_ref MATCHING expression .)
     {               reduce using rule 94 (typedef_inner -> TYPEDEF ID AS ns_ref MATCHING expression .)
     $end            reduce using rule 94 (typedef_inner -> TYPEDEF ID AS ns_ref MATCHING expression .)
-    CMP_OP          shift and go to state 70
-    IN              shift and go to state 71
-    AND             shift and go to state 72
-    OR              shift and go to state 73
-    ?               shift and go to state 74
+    CMP_OP          shift and go to state 72
+    IN              shift and go to state 73
+    AND             shift and go to state 74
+    OR              shift and go to state 75
+    ?               shift and go to state 76
 
 
-state 302
+state 314
 
-    (126) pair_list -> dict_key : operand , pair_list .
+    (130) list_comprehension_guard -> IF expression list_comprehension_guard .
 
-    }               reduce using rule 126 (pair_list -> dict_key : operand , pair_list .)
+    ]               reduce using rule 130 (list_comprehension_guard -> IF expression list_comprehension_guard .)
 
 
-state 303
+state 315
+
+    (127) list_comprehension_for -> FOR ID IN expression . list_comprehension_for_empty
+    (128) list_comprehension_for -> FOR ID IN expression . list_comprehension_for
+    (109) boolean_expression -> expression . CMP_OP expression
+    (110) boolean_expression -> expression . IN expression
+    (111) boolean_expression -> expression . AND expression
+    (112) boolean_expression -> expression . OR expression
+    (140) conditional_expression -> expression . ? expression : expression
+    (126) list_comprehension_for_empty -> . empty
+    (127) list_comprehension_for -> . FOR ID IN expression list_comprehension_for_empty
+    (128) list_comprehension_for -> . FOR ID IN expression list_comprehension_for
+    (14) empty -> .
 
-    (127) pair_list -> dict_key : operand empty pair_list_empty .
+    CMP_OP          shift and go to state 72
+    IN              shift and go to state 73
+    AND             shift and go to state 74
+    OR              shift and go to state 75
+    ?               shift and go to state 76
+    FOR             shift and go to state 170
+    IF              reduce using rule 14 (empty -> .)
+    ]               reduce using rule 14 (empty -> .)
+
+    list_comprehension_for_empty   shift and go to state 340
+    list_comprehension_for         shift and go to state 341
+    empty                          shift and go to state 342
 
-    }               reduce using rule 127 (pair_list -> dict_key : operand empty pair_list_empty .)
+state 316
 
+    (133) pair_list -> dict_key : operand , pair_list .
+
+    }               reduce using rule 133 (pair_list -> dict_key : operand , pair_list .)
 
-state 304
+
+state 317
+
+    (134) pair_list -> dict_key : operand empty pair_list_empty .
+
+    }               reduce using rule 134 (pair_list -> dict_key : operand empty pair_list_empty .)
+
+
+state 318
 
     (49) attr -> attr_type CID = constant .
 
     END             reduce using rule 49 (attr -> attr_type CID = constant .)
     DICT            reduce using rule 49 (attr -> attr_type CID = constant .)
     ID              reduce using rule 49 (attr -> attr_type CID = constant .)
 
 
-state 305
+state 319
 
     (50) attr -> attr_type CID = constant_list .
 
     END             reduce using rule 50 (attr -> attr_type CID = constant_list .)
     DICT            reduce using rule 50 (attr -> attr_type CID = constant_list .)
     ID              reduce using rule 50 (attr -> attr_type CID = constant_list .)
 
 
-state 306
+state 320
 
     (51) attr -> attr_type CID = UNDEF .
 
     END             reduce using rule 51 (attr -> attr_type CID = UNDEF .)
     DICT            reduce using rule 51 (attr -> attr_type CID = UNDEF .)
     ID              reduce using rule 51 (attr -> attr_type CID = UNDEF .)
 
 
-state 307
+state 321
 
-    (143) constant_list -> [ . constants ]
-    (144) constants -> . constant
-    (145) constants -> .
-    (146) constants -> . constant , constants
-    (134) constant -> . INT
-    (135) constant -> . FLOAT
-    (136) constant -> . NULL
-    (137) constant -> . REGEX
-    (138) constant -> . TRUE
-    (139) constant -> . FALSE
-    (140) constant -> . STRING
-    (141) constant -> . RSTRING
-    (142) constant -> . MLS
-
-    ]               reduce using rule 145 (constants -> .)
-    INT             shift and go to state 47
-    FLOAT           shift and go to state 48
-    NULL            shift and go to state 49
-    REGEX           shift and go to state 50
-    TRUE            shift and go to state 51
-    FALSE           shift and go to state 52
-    STRING          shift and go to state 53
-    RSTRING         shift and go to state 54
+    (151) constant_list -> [ . constants ]
+    (152) constants -> . constant
+    (153) constants -> .
+    (154) constants -> . constant , constants
+    (141) constant -> . INT
+    (142) constant -> . FLOAT
+    (143) constant -> . NULL
+    (144) constant -> . REGEX
+    (145) constant -> . TRUE
+    (146) constant -> . FALSE
+    (147) constant -> . STRING
+    (148) constant -> . FSTRING
+    (149) constant -> . RSTRING
+    (150) constant -> . MLS
+
+    ]               reduce using rule 153 (constants -> .)
+    INT             shift and go to state 48
+    FLOAT           shift and go to state 49
+    NULL            shift and go to state 50
+    REGEX           shift and go to state 51
+    TRUE            shift and go to state 52
+    FALSE           shift and go to state 53
+    STRING          shift and go to state 54
+    FSTRING         shift and go to state 55
+    RSTRING         shift and go to state 56
     MLS             shift and go to state 20
 
-    constants                      shift and go to state 326
-    constant                       shift and go to state 327
+    constants                      shift and go to state 343
+    constant                       shift and go to state 344
 
-state 308
+state 322
 
     (53) attr -> attr_type ID = constant .
 
     END             reduce using rule 53 (attr -> attr_type ID = constant .)
     DICT            reduce using rule 53 (attr -> attr_type ID = constant .)
     ID              reduce using rule 53 (attr -> attr_type ID = constant .)
 
 
-state 309
+state 323
 
     (54) attr -> attr_type ID = constant_list .
 
     END             reduce using rule 54 (attr -> attr_type ID = constant_list .)
     DICT            reduce using rule 54 (attr -> attr_type ID = constant_list .)
     ID              reduce using rule 54 (attr -> attr_type ID = constant_list .)
 
 
-state 310
+state 324
 
     (55) attr -> attr_type ID = UNDEF .
 
     END             reduce using rule 55 (attr -> attr_type ID = UNDEF .)
     DICT            reduce using rule 55 (attr -> attr_type ID = UNDEF .)
     ID              reduce using rule 55 (attr -> attr_type ID = UNDEF .)
 
 
-state 311
+state 325
 
     (56) attr -> DICT empty CID empty .
 
     END             reduce using rule 56 (attr -> DICT empty CID empty .)
     DICT            reduce using rule 56 (attr -> DICT empty CID empty .)
     ID              reduce using rule 56 (attr -> DICT empty CID empty .)
 
 
-state 312
+state 326
 
     (57) attr -> DICT empty CID = . map_def
     (58) attr -> DICT empty CID = . NULL
-    (130) map_def -> . { pair_list }
+    (137) map_def -> . { pair_list }
 
-    NULL            shift and go to state 329
-    {               shift and go to state 56
+    NULL            shift and go to state 346
+    {               shift and go to state 58
 
-    map_def                        shift and go to state 328
+    map_def                        shift and go to state 345
 
-state 313
+state 327
 
     (59) attr -> DICT ? CID empty .
 
     END             reduce using rule 59 (attr -> DICT ? CID empty .)
     DICT            reduce using rule 59 (attr -> DICT ? CID empty .)
     ID              reduce using rule 59 (attr -> DICT ? CID empty .)
 
 
-state 314
+state 328
 
     (60) attr -> DICT ? CID = . map_def
     (61) attr -> DICT ? CID = . NULL
-    (130) map_def -> . { pair_list }
+    (137) map_def -> . { pair_list }
 
-    NULL            shift and go to state 331
-    {               shift and go to state 56
+    NULL            shift and go to state 348
+    {               shift and go to state 58
 
-    map_def                        shift and go to state 330
+    map_def                        shift and go to state 347
 
-state 315
+state 329
 
     (66) attr -> DICT ? ID = . map_def
     (67) attr -> DICT ? ID = . NULL
-    (130) map_def -> . { pair_list }
+    (137) map_def -> . { pair_list }
 
-    NULL            shift and go to state 333
-    {               shift and go to state 56
+    NULL            shift and go to state 350
+    {               shift and go to state 58
 
-    map_def                        shift and go to state 332
+    map_def                        shift and go to state 349
 
-state 316
+state 330
 
     (63) attr -> DICT ID = map_def .
 
     END             reduce using rule 63 (attr -> DICT ID = map_def .)
     DICT            reduce using rule 63 (attr -> DICT ID = map_def .)
     ID              reduce using rule 63 (attr -> DICT ID = map_def .)
 
 
-state 317
+state 331
 
     (64) attr -> DICT ID = NULL .
 
     END             reduce using rule 64 (attr -> DICT ID = NULL .)
     DICT            reduce using rule 64 (attr -> DICT ID = NULL .)
     ID              reduce using rule 64 (attr -> DICT ID = NULL .)
 
 
-state 318
+state 332
 
     (73) implement_def -> IMPLEMENT class_ref USING implement_ns_list WHEN expression empty .
 
     ENTITY          reduce using rule 73 (implement_def -> IMPLEMENT class_ref USING implement_ns_list WHEN expression empty .)
     IMPLEMENT       reduce using rule 73 (implement_def -> IMPLEMENT class_ref USING implement_ns_list WHEN expression empty .)
     IMPLEMENTATION  reduce using rule 73 (implement_def -> IMPLEMENT class_ref USING implement_ns_list WHEN expression empty .)
     INDEX           reduce using rule 73 (implement_def -> IMPLEMENT class_ref USING implement_ns_list WHEN expression empty .)
@@ -9796,22 +10523,23 @@
     INT             reduce using rule 73 (implement_def -> IMPLEMENT class_ref USING implement_ns_list WHEN expression empty .)
     FLOAT           reduce using rule 73 (implement_def -> IMPLEMENT class_ref USING implement_ns_list WHEN expression empty .)
     NULL            reduce using rule 73 (implement_def -> IMPLEMENT class_ref USING implement_ns_list WHEN expression empty .)
     REGEX           reduce using rule 73 (implement_def -> IMPLEMENT class_ref USING implement_ns_list WHEN expression empty .)
     TRUE            reduce using rule 73 (implement_def -> IMPLEMENT class_ref USING implement_ns_list WHEN expression empty .)
     FALSE           reduce using rule 73 (implement_def -> IMPLEMENT class_ref USING implement_ns_list WHEN expression empty .)
     STRING          reduce using rule 73 (implement_def -> IMPLEMENT class_ref USING implement_ns_list WHEN expression empty .)
+    FSTRING         reduce using rule 73 (implement_def -> IMPLEMENT class_ref USING implement_ns_list WHEN expression empty .)
     RSTRING         reduce using rule 73 (implement_def -> IMPLEMENT class_ref USING implement_ns_list WHEN expression empty .)
     MLS             reduce using rule 73 (implement_def -> IMPLEMENT class_ref USING implement_ns_list WHEN expression empty .)
     [               reduce using rule 73 (implement_def -> IMPLEMENT class_ref USING implement_ns_list WHEN expression empty .)
     {               reduce using rule 73 (implement_def -> IMPLEMENT class_ref USING implement_ns_list WHEN expression empty .)
     $end            reduce using rule 73 (implement_def -> IMPLEMENT class_ref USING implement_ns_list WHEN expression empty .)
 
 
-state 319
+state 333
 
     (74) implement_def -> IMPLEMENT class_ref USING implement_ns_list WHEN expression MLS .
 
     ENTITY          reduce using rule 74 (implement_def -> IMPLEMENT class_ref USING implement_ns_list WHEN expression MLS .)
     IMPLEMENT       reduce using rule 74 (implement_def -> IMPLEMENT class_ref USING implement_ns_list WHEN expression MLS .)
     IMPLEMENTATION  reduce using rule 74 (implement_def -> IMPLEMENT class_ref USING implement_ns_list WHEN expression MLS .)
     INDEX           reduce using rule 74 (implement_def -> IMPLEMENT class_ref USING implement_ns_list WHEN expression MLS .)
@@ -9826,22 +10554,23 @@
     INT             reduce using rule 74 (implement_def -> IMPLEMENT class_ref USING implement_ns_list WHEN expression MLS .)
     FLOAT           reduce using rule 74 (implement_def -> IMPLEMENT class_ref USING implement_ns_list WHEN expression MLS .)
     NULL            reduce using rule 74 (implement_def -> IMPLEMENT class_ref USING implement_ns_list WHEN expression MLS .)
     REGEX           reduce using rule 74 (implement_def -> IMPLEMENT class_ref USING implement_ns_list WHEN expression MLS .)
     TRUE            reduce using rule 74 (implement_def -> IMPLEMENT class_ref USING implement_ns_list WHEN expression MLS .)
     FALSE           reduce using rule 74 (implement_def -> IMPLEMENT class_ref USING implement_ns_list WHEN expression MLS .)
     STRING          reduce using rule 74 (implement_def -> IMPLEMENT class_ref USING implement_ns_list WHEN expression MLS .)
+    FSTRING         reduce using rule 74 (implement_def -> IMPLEMENT class_ref USING implement_ns_list WHEN expression MLS .)
     RSTRING         reduce using rule 74 (implement_def -> IMPLEMENT class_ref USING implement_ns_list WHEN expression MLS .)
     MLS             reduce using rule 74 (implement_def -> IMPLEMENT class_ref USING implement_ns_list WHEN expression MLS .)
     [               reduce using rule 74 (implement_def -> IMPLEMENT class_ref USING implement_ns_list WHEN expression MLS .)
     {               reduce using rule 74 (implement_def -> IMPLEMENT class_ref USING implement_ns_list WHEN expression MLS .)
     $end            reduce using rule 74 (implement_def -> IMPLEMENT class_ref USING implement_ns_list WHEN expression MLS .)
 
 
-state 320
+state 334
 
     (80) relation -> class_ref ID multi REL multi class_ref ID .
     (81) relation -> class_ref ID multi REL multi class_ref ID . MLS
 
     ENTITY          reduce using rule 80 (relation -> class_ref ID multi REL multi class_ref ID .)
     IMPLEMENT       reduce using rule 80 (relation -> class_ref ID multi REL multi class_ref ID .)
     IMPLEMENTATION  reduce using rule 80 (relation -> class_ref ID multi REL multi class_ref ID .)
@@ -9857,38 +10586,40 @@
     INT             reduce using rule 80 (relation -> class_ref ID multi REL multi class_ref ID .)
     FLOAT           reduce using rule 80 (relation -> class_ref ID multi REL multi class_ref ID .)
     NULL            reduce using rule 80 (relation -> class_ref ID multi REL multi class_ref ID .)
     REGEX           reduce using rule 80 (relation -> class_ref ID multi REL multi class_ref ID .)
     TRUE            reduce using rule 80 (relation -> class_ref ID multi REL multi class_ref ID .)
     FALSE           reduce using rule 80 (relation -> class_ref ID multi REL multi class_ref ID .)
     STRING          reduce using rule 80 (relation -> class_ref ID multi REL multi class_ref ID .)
+    FSTRING         reduce using rule 80 (relation -> class_ref ID multi REL multi class_ref ID .)
     RSTRING         reduce using rule 80 (relation -> class_ref ID multi REL multi class_ref ID .)
     [               reduce using rule 80 (relation -> class_ref ID multi REL multi class_ref ID .)
     {               reduce using rule 80 (relation -> class_ref ID multi REL multi class_ref ID .)
     $end            reduce using rule 80 (relation -> class_ref ID multi REL multi class_ref ID .)
-    MLS             shift and go to state 334
+    MLS             shift and go to state 351
 
   ! MLS             [ reduce using rule 80 (relation -> class_ref ID multi REL multi class_ref ID .) ]
 
 
-state 321
+state 335
 
     (90) multi -> [ INT : INT ] .
 
     REL             reduce using rule 90 (multi -> [ INT : INT ] .)
     (               reduce using rule 90 (multi -> [ INT : INT ] .)
     NOT             reduce using rule 90 (multi -> [ INT : INT ] .)
     ID              reduce using rule 90 (multi -> [ INT : INT ] .)
     INT             reduce using rule 90 (multi -> [ INT : INT ] .)
     FLOAT           reduce using rule 90 (multi -> [ INT : INT ] .)
     NULL            reduce using rule 90 (multi -> [ INT : INT ] .)
     REGEX           reduce using rule 90 (multi -> [ INT : INT ] .)
     TRUE            reduce using rule 90 (multi -> [ INT : INT ] .)
     FALSE           reduce using rule 90 (multi -> [ INT : INT ] .)
     STRING          reduce using rule 90 (multi -> [ INT : INT ] .)
+    FSTRING         reduce using rule 90 (multi -> [ INT : INT ] .)
     RSTRING         reduce using rule 90 (multi -> [ INT : INT ] .)
     MLS             reduce using rule 90 (multi -> [ INT : INT ] .)
     [               reduce using rule 90 (multi -> [ INT : INT ] .)
     {               reduce using rule 90 (multi -> [ INT : INT ] .)
     CID             reduce using rule 90 (multi -> [ INT : INT ] .)
     ENTITY          reduce using rule 90 (multi -> [ INT : INT ] .)
     IMPLEMENT       reduce using rule 90 (multi -> [ INT : INT ] .)
@@ -9897,29 +10628,29 @@
     IMPORT          reduce using rule 90 (multi -> [ INT : INT ] .)
     FOR             reduce using rule 90 (multi -> [ INT : INT ] .)
     IF              reduce using rule 90 (multi -> [ INT : INT ] .)
     TYPEDEF         reduce using rule 90 (multi -> [ INT : INT ] .)
     $end            reduce using rule 90 (multi -> [ INT : INT ] .)
 
 
-state 322
+state 336
 
     (84) relation_def -> class_ref . ID multi REL class_ref . . ID multi
 
-    ID              shift and go to state 335
+    ID              shift and go to state 352
 
 
-state 323
+state 337
 
     (86) relation_def -> class_ref . ID multi operand_list class_ref . . ID multi
 
-    ID              shift and go to state 336
+    ID              shift and go to state 353
 
 
-state 324
+state 338
 
     (79) block -> stmt_list END .
 
     ENTITY          reduce using rule 79 (block -> stmt_list END .)
     IMPLEMENT       reduce using rule 79 (block -> stmt_list END .)
     IMPLEMENTATION  reduce using rule 79 (block -> stmt_list END .)
     INDEX           reduce using rule 79 (block -> stmt_list END .)
@@ -9934,102 +10665,127 @@
     INT             reduce using rule 79 (block -> stmt_list END .)
     FLOAT           reduce using rule 79 (block -> stmt_list END .)
     NULL            reduce using rule 79 (block -> stmt_list END .)
     REGEX           reduce using rule 79 (block -> stmt_list END .)
     TRUE            reduce using rule 79 (block -> stmt_list END .)
     FALSE           reduce using rule 79 (block -> stmt_list END .)
     STRING          reduce using rule 79 (block -> stmt_list END .)
+    FSTRING         reduce using rule 79 (block -> stmt_list END .)
     RSTRING         reduce using rule 79 (block -> stmt_list END .)
     MLS             reduce using rule 79 (block -> stmt_list END .)
     [               reduce using rule 79 (block -> stmt_list END .)
     {               reduce using rule 79 (block -> stmt_list END .)
     $end            reduce using rule 79 (block -> stmt_list END .)
     ELSE            reduce using rule 79 (block -> stmt_list END .)
     ELIF            reduce using rule 79 (block -> stmt_list END .)
     END             reduce using rule 79 (block -> stmt_list END .)
 
 
-state 325
+state 339
 
     (29) if_next -> ELSE : stmt_list .
 
     END             reduce using rule 29 (if_next -> ELSE : stmt_list .)
 
 
-state 326
+state 340
 
-    (143) constant_list -> [ constants . ]
+    (127) list_comprehension_for -> FOR ID IN expression list_comprehension_for_empty .
 
-    ]               shift and go to state 337
+    IF              reduce using rule 127 (list_comprehension_for -> FOR ID IN expression list_comprehension_for_empty .)
+    ]               reduce using rule 127 (list_comprehension_for -> FOR ID IN expression list_comprehension_for_empty .)
 
 
-state 327
+state 341
 
-    (144) constants -> constant .
-    (146) constants -> constant . , constants
+    (128) list_comprehension_for -> FOR ID IN expression list_comprehension_for .
 
-    ]               reduce using rule 144 (constants -> constant .)
-    ,               shift and go to state 338
+    IF              reduce using rule 128 (list_comprehension_for -> FOR ID IN expression list_comprehension_for .)
+    ]               reduce using rule 128 (list_comprehension_for -> FOR ID IN expression list_comprehension_for .)
 
 
-state 328
+state 342
+
+    (126) list_comprehension_for_empty -> empty .
+
+    IF              reduce using rule 126 (list_comprehension_for_empty -> empty .)
+    ]               reduce using rule 126 (list_comprehension_for_empty -> empty .)
+
+
+state 343
+
+    (151) constant_list -> [ constants . ]
+
+    ]               shift and go to state 354
+
+
+state 344
+
+    (152) constants -> constant .
+    (154) constants -> constant . , constants
+
+    ]               reduce using rule 152 (constants -> constant .)
+    ,               shift and go to state 355
+
+
+state 345
 
     (57) attr -> DICT empty CID = map_def .
 
     END             reduce using rule 57 (attr -> DICT empty CID = map_def .)
     DICT            reduce using rule 57 (attr -> DICT empty CID = map_def .)
     ID              reduce using rule 57 (attr -> DICT empty CID = map_def .)
 
 
-state 329
+state 346
 
     (58) attr -> DICT empty CID = NULL .
 
     END             reduce using rule 58 (attr -> DICT empty CID = NULL .)
     DICT            reduce using rule 58 (attr -> DICT empty CID = NULL .)
     ID              reduce using rule 58 (attr -> DICT empty CID = NULL .)
 
 
-state 330
+state 347
 
     (60) attr -> DICT ? CID = map_def .
 
     END             reduce using rule 60 (attr -> DICT ? CID = map_def .)
     DICT            reduce using rule 60 (attr -> DICT ? CID = map_def .)
     ID              reduce using rule 60 (attr -> DICT ? CID = map_def .)
 
 
-state 331
+state 348
 
     (61) attr -> DICT ? CID = NULL .
 
     END             reduce using rule 61 (attr -> DICT ? CID = NULL .)
     DICT            reduce using rule 61 (attr -> DICT ? CID = NULL .)
     ID              reduce using rule 61 (attr -> DICT ? CID = NULL .)
 
 
-state 332
+state 349
 
     (66) attr -> DICT ? ID = map_def .
 
     END             reduce using rule 66 (attr -> DICT ? ID = map_def .)
     DICT            reduce using rule 66 (attr -> DICT ? ID = map_def .)
     ID              reduce using rule 66 (attr -> DICT ? ID = map_def .)
 
 
-state 333
+state 350
 
     (67) attr -> DICT ? ID = NULL .
 
     END             reduce using rule 67 (attr -> DICT ? ID = NULL .)
     DICT            reduce using rule 67 (attr -> DICT ? ID = NULL .)
     ID              reduce using rule 67 (attr -> DICT ? ID = NULL .)
 
 
-state 334
+state 351
 
     (81) relation -> class_ref ID multi REL multi class_ref ID MLS .
 
     ENTITY          reduce using rule 81 (relation -> class_ref ID multi REL multi class_ref ID MLS .)
     IMPLEMENT       reduce using rule 81 (relation -> class_ref ID multi REL multi class_ref ID MLS .)
     IMPLEMENTATION  reduce using rule 81 (relation -> class_ref ID multi REL multi class_ref ID MLS .)
     INDEX           reduce using rule 81 (relation -> class_ref ID multi REL multi class_ref ID MLS .)
@@ -10044,85 +10800,88 @@
     INT             reduce using rule 81 (relation -> class_ref ID multi REL multi class_ref ID MLS .)
     FLOAT           reduce using rule 81 (relation -> class_ref ID multi REL multi class_ref ID MLS .)
     NULL            reduce using rule 81 (relation -> class_ref ID multi REL multi class_ref ID MLS .)
     REGEX           reduce using rule 81 (relation -> class_ref ID multi REL multi class_ref ID MLS .)
     TRUE            reduce using rule 81 (relation -> class_ref ID multi REL multi class_ref ID MLS .)
     FALSE           reduce using rule 81 (relation -> class_ref ID multi REL multi class_ref ID MLS .)
     STRING          reduce using rule 81 (relation -> class_ref ID multi REL multi class_ref ID MLS .)
+    FSTRING         reduce using rule 81 (relation -> class_ref ID multi REL multi class_ref ID MLS .)
     RSTRING         reduce using rule 81 (relation -> class_ref ID multi REL multi class_ref ID MLS .)
     MLS             reduce using rule 81 (relation -> class_ref ID multi REL multi class_ref ID MLS .)
     [               reduce using rule 81 (relation -> class_ref ID multi REL multi class_ref ID MLS .)
     {               reduce using rule 81 (relation -> class_ref ID multi REL multi class_ref ID MLS .)
     $end            reduce using rule 81 (relation -> class_ref ID multi REL multi class_ref ID MLS .)
 
 
-state 335
+state 352
 
     (84) relation_def -> class_ref . ID multi REL class_ref . ID . multi
     (88) multi -> . [ INT ]
     (89) multi -> . [ INT : ]
     (90) multi -> . [ INT : INT ]
     (91) multi -> . [ : INT ]
 
-    [               shift and go to state 119
+    [               shift and go to state 121
 
-    multi                          shift and go to state 339
+    multi                          shift and go to state 356
 
-state 336
+state 353
 
     (86) relation_def -> class_ref . ID multi operand_list class_ref . ID . multi
     (88) multi -> . [ INT ]
     (89) multi -> . [ INT : ]
     (90) multi -> . [ INT : INT ]
     (91) multi -> . [ : INT ]
 
-    [               shift and go to state 119
-
-    multi                          shift and go to state 340
-
-state 337
-
-    (143) constant_list -> [ constants ] .
+    [               shift and go to state 121
 
-    END             reduce using rule 143 (constant_list -> [ constants ] .)
-    DICT            reduce using rule 143 (constant_list -> [ constants ] .)
-    ID              reduce using rule 143 (constant_list -> [ constants ] .)
+    multi                          shift and go to state 357
 
+state 354
 
-state 338
+    (151) constant_list -> [ constants ] .
 
-    (146) constants -> constant , . constants
-    (144) constants -> . constant
-    (145) constants -> .
-    (146) constants -> . constant , constants
-    (134) constant -> . INT
-    (135) constant -> . FLOAT
-    (136) constant -> . NULL
-    (137) constant -> . REGEX
-    (138) constant -> . TRUE
-    (139) constant -> . FALSE
-    (140) constant -> . STRING
-    (141) constant -> . RSTRING
-    (142) constant -> . MLS
-
-    ]               reduce using rule 145 (constants -> .)
-    INT             shift and go to state 47
-    FLOAT           shift and go to state 48
-    NULL            shift and go to state 49
-    REGEX           shift and go to state 50
-    TRUE            shift and go to state 51
-    FALSE           shift and go to state 52
-    STRING          shift and go to state 53
-    RSTRING         shift and go to state 54
+    END             reduce using rule 151 (constant_list -> [ constants ] .)
+    DICT            reduce using rule 151 (constant_list -> [ constants ] .)
+    ID              reduce using rule 151 (constant_list -> [ constants ] .)
+
+
+state 355
+
+    (154) constants -> constant , . constants
+    (152) constants -> . constant
+    (153) constants -> .
+    (154) constants -> . constant , constants
+    (141) constant -> . INT
+    (142) constant -> . FLOAT
+    (143) constant -> . NULL
+    (144) constant -> . REGEX
+    (145) constant -> . TRUE
+    (146) constant -> . FALSE
+    (147) constant -> . STRING
+    (148) constant -> . FSTRING
+    (149) constant -> . RSTRING
+    (150) constant -> . MLS
+
+    ]               reduce using rule 153 (constants -> .)
+    INT             shift and go to state 48
+    FLOAT           shift and go to state 49
+    NULL            shift and go to state 50
+    REGEX           shift and go to state 51
+    TRUE            shift and go to state 52
+    FALSE           shift and go to state 53
+    STRING          shift and go to state 54
+    FSTRING         shift and go to state 55
+    RSTRING         shift and go to state 56
     MLS             shift and go to state 20
 
-    constant                       shift and go to state 327
-    constants                      shift and go to state 341
+    constant                       shift and go to state 344
+    constants                      shift and go to state 358
 
-state 339
+state 356
 
     (84) relation_def -> class_ref . ID multi REL class_ref . ID multi .
 
     MLS             reduce using rule 84 (relation_def -> class_ref . ID multi REL class_ref . ID multi .)
     ENTITY          reduce using rule 84 (relation_def -> class_ref . ID multi REL class_ref . ID multi .)
     IMPLEMENT       reduce using rule 84 (relation_def -> class_ref . ID multi REL class_ref . ID multi .)
     IMPLEMENTATION  reduce using rule 84 (relation_def -> class_ref . ID multi REL class_ref . ID multi .)
@@ -10138,21 +10897,22 @@
     INT             reduce using rule 84 (relation_def -> class_ref . ID multi REL class_ref . ID multi .)
     FLOAT           reduce using rule 84 (relation_def -> class_ref . ID multi REL class_ref . ID multi .)
     NULL            reduce using rule 84 (relation_def -> class_ref . ID multi REL class_ref . ID multi .)
     REGEX           reduce using rule 84 (relation_def -> class_ref . ID multi REL class_ref . ID multi .)
     TRUE            reduce using rule 84 (relation_def -> class_ref . ID multi REL class_ref . ID multi .)
     FALSE           reduce using rule 84 (relation_def -> class_ref . ID multi REL class_ref . ID multi .)
     STRING          reduce using rule 84 (relation_def -> class_ref . ID multi REL class_ref . ID multi .)
+    FSTRING         reduce using rule 84 (relation_def -> class_ref . ID multi REL class_ref . ID multi .)
     RSTRING         reduce using rule 84 (relation_def -> class_ref . ID multi REL class_ref . ID multi .)
     [               reduce using rule 84 (relation_def -> class_ref . ID multi REL class_ref . ID multi .)
     {               reduce using rule 84 (relation_def -> class_ref . ID multi REL class_ref . ID multi .)
     $end            reduce using rule 84 (relation_def -> class_ref . ID multi REL class_ref . ID multi .)
 
 
-state 340
+state 357
 
     (86) relation_def -> class_ref . ID multi operand_list class_ref . ID multi .
 
     MLS             reduce using rule 86 (relation_def -> class_ref . ID multi operand_list class_ref . ID multi .)
     ENTITY          reduce using rule 86 (relation_def -> class_ref . ID multi operand_list class_ref . ID multi .)
     IMPLEMENT       reduce using rule 86 (relation_def -> class_ref . ID multi operand_list class_ref . ID multi .)
     IMPLEMENTATION  reduce using rule 86 (relation_def -> class_ref . ID multi operand_list class_ref . ID multi .)
@@ -10168,19 +10928,20 @@
     INT             reduce using rule 86 (relation_def -> class_ref . ID multi operand_list class_ref . ID multi .)
     FLOAT           reduce using rule 86 (relation_def -> class_ref . ID multi operand_list class_ref . ID multi .)
     NULL            reduce using rule 86 (relation_def -> class_ref . ID multi operand_list class_ref . ID multi .)
     REGEX           reduce using rule 86 (relation_def -> class_ref . ID multi operand_list class_ref . ID multi .)
     TRUE            reduce using rule 86 (relation_def -> class_ref . ID multi operand_list class_ref . ID multi .)
     FALSE           reduce using rule 86 (relation_def -> class_ref . ID multi operand_list class_ref . ID multi .)
     STRING          reduce using rule 86 (relation_def -> class_ref . ID multi operand_list class_ref . ID multi .)
+    FSTRING         reduce using rule 86 (relation_def -> class_ref . ID multi operand_list class_ref . ID multi .)
     RSTRING         reduce using rule 86 (relation_def -> class_ref . ID multi operand_list class_ref . ID multi .)
     [               reduce using rule 86 (relation_def -> class_ref . ID multi operand_list class_ref . ID multi .)
     {               reduce using rule 86 (relation_def -> class_ref . ID multi operand_list class_ref . ID multi .)
     $end            reduce using rule 86 (relation_def -> class_ref . ID multi operand_list class_ref . ID multi .)
 
 
-state 341
+state 358
 
-    (146) constants -> constant , constants .
+    (154) constants -> constant , constants .
 
-    ]               reduce using rule 146 (constants -> constant , constants .)
+    ]               reduce using rule 154 (constants -> constant , constants .)
```

### Comparing `inmanta-core-8.3.0/src/inmanta/parser/parsetab.py` & `inmanta-core-9.3.0/src/inmanta/parser/parsetab.py`

 * *Files 7% similar despite different names*

```diff
@@ -2,205 +2,213 @@
 # parsetab.py
 # This file is automatically generated. Do not edit.
 # pylint: disable=W,C,R
 _tabversion = '3.10'
 
 _lr_method = 'LALR'
 
-_lr_signature = 'right,nonassoc:nonassoc?leftORleftANDleftCMP_OPnonassocNOTleftINleftRELATION_DEFTYPEDEF_INNEROPERAND_LISTEMPTYNS_REFVAR_REFMAP_LOOKUPleftCIDIDleft([leftMLSAND AS CID CMP_OP DEFINED DICT ELIF ELSE END ENTITY EXTENDS FALSE FLOAT FOR ID IF IMPLEMENT IMPLEMENTATION IMPORT IN INDEX INT IS MATCHING MLS NOT NULL OR PARENTS PEQ REGEX REL RSTRING SEP STRING TRUE TYPEDEF UNDEF USING WHENmain : head bodyhead : %prec EMPTYhead : MLSbody : top_stmt bodybody : emptytop_stmt : entity_def\n    | implement_def\n    | implementation_def\n    | relation\n    | statement\n    | typedef\n    | index\n    | importempty : %prec EMPTYimport : IMPORT ns_refimport : IMPORT ns_ref AS IDstatement : assign\n    | for\n    | if\n    | expressionstmt_list : statement stmt_liststmt_list : emptyassign : var_ref \'=\' operandassign : var_ref PEQ operandfor : FOR ID IN operand \':\' blockif : IF if_body ENDif_body : expression \':\' stmt_list if_nextif_next : emptyif_next : ELSE \':\' stmt_listif_next : ELIF if_bodyentity_def : ENTITY CID \':\' entity_body_outerentity_def : ENTITY ID \':\' entity_body_outerentity_def : ENTITY CID EXTENDS class_ref_list \':\' entity_body_outerentity_def : ENTITY ID EXTENDS class_ref_list \':\' entity_body_outerentity_body_outer : MLS entity_body ENDentity_body_outer : entity_body ENDentity_body_outer : ENDentity_body_outer : MLS ENDentity_body : entity_body attrentity_body : attrattr_base_type : ns_refattr_type_multi : attr_base_type \'[\' \']\'attr_type_opt : attr_type_multi \'?\'\n    | attr_base_type \'?\'attr_type : attr_type_opt\n    | attr_type_multi\n    | attr_base_typeattr : attr_type CID empty\n    | attr_type CID \'=\' constant\n    | attr_type CID \'=\' constant_list\n    | attr_type CID \'=\' UNDEFattr : attr_type IDattr : attr_type ID \'=\' constant\n    | attr_type ID \'=\' constant_listattr : attr_type ID \'=\' UNDEFattr : DICT empty CID empty\n    | DICT empty CID \'=\' map_def\n    | DICT empty CID \'=\' NULL\n    | DICT \'?\' CID empty\n    | DICT \'?\'  CID \'=\' map_def\n    | DICT \'?\'  CID \'=\' NULLattr : DICT IDattr : DICT ID \'=\' map_defattr : DICT ID \'=\' NULLattr : DICT \'?\' IDattr : DICT \'?\'  ID \'=\' map_defattr : DICT \'?\'  ID \'=\' NULLimplement_ns_list : ns_refimplement_ns_list : PARENTSimplement_ns_list : implement_ns_list \',\' implement_ns_listimplement_def : IMPLEMENT class_ref USING implement_ns_list empty\n    | IMPLEMENT class_ref USING implement_ns_list MLSimplement_def : IMPLEMENT class_ref USING implement_ns_list WHEN expression empty\n    | IMPLEMENT class_ref USING implement_ns_list WHEN expression MLSimplementation_def : IMPLEMENTATION ID FOR class_ref implementationimplementation : implementation_head blockimplementation_head : \':\'implementation_head : \':\' MLSblock : stmt_list ENDrelation : class_ref ID multi REL multi class_ref IDrelation : class_ref ID multi REL multi class_ref ID MLSrelation : relation_def MLSrelation : relation_def %prec RELATION_DEFrelation_def : class_ref \'.\' ID multi REL class_ref \'.\' ID multirelation_def : class_ref \'.\' ID multi REL class_refrelation_def : class_ref \'.\' ID multi operand_list class_ref \'.\' ID multirelation_def : class_ref \'.\' ID multi operand_list class_refmulti : \'[\' INT \']\'multi : \'[\' INT \':\' \']\'multi : \'[\' INT \':\' INT \']\'multi : \'[\'  \':\' INT \']\'typedef : typedef_inner %prec TYPEDEF_INNERtypedef : typedef_inner MLStypedef_inner : TYPEDEF ID AS ns_ref MATCHING expressiontypedef_inner : TYPEDEF CID AS constructorindex : INDEX class_ref \'(\' id_list \')\'expression : boolean_expression\n    | constant\n    | function_call\n    | var_ref %prec VAR_REF\n    | constructor\n    | list_def\n    | map_def\n    | map_lookup %prec MAP_LOOKUP\n    | index_lookup\n    | conditional_expressionexpression : \'(\' expression \')\'boolean_expression : expression CMP_OP expression\n    | expression IN expression\n    | expression AND expression\n    | expression OR expressionboolean_expression : NOT expressionboolean_expression : var_ref \'.\' ID IS DEFINEDboolean_expression : ID IS DEFINEDboolean_expression : map_lookup IS DEFINEDoperand : expressionmap_lookup : attr_ref \'[\' operand \']\'\n    | var_ref \'[\' operand \']\'\n    | map_lookup \'[\' operand \']\'constructor : class_ref \'(\' param_list \')\'function_call : ns_ref \'(\' function_param_list \')\'function_call : attr_ref \'(\' function_param_list \')\'list_def : \'[\' operand_list \']\'dict_key : RSTRINGdict_key : STRINGpair_list : dict_key \':\' operand \',\' pair_list\n    | dict_key \':\' operand empty pair_list_emptypair_list : pair_list_empty\n    pair_list_empty : emptymap_def : \'{\' pair_list \'}\'index_lookup : class_ref \'[\' param_list \']\'index_lookup : attr_ref \'[\' param_list \']\'conditional_expression : expression \'?\' expression \':\' expressionconstant : INT\n    | FLOAT\n    constant : NULLconstant : REGEXconstant : TRUEconstant : FALSEconstant : STRINGconstant : RSTRINGconstant : MLSconstant_list : \'[\' constants \']\'constants : constantconstants :constants : constant \',\' constantswrapped_kwargs : \'*\' \'*\' operandparam_list_element : ID \'=\' operandparam_list_element : wrapped_kwargsparam_list : param_list_empty\n    param_list_empty : emptyparam_list : param_list_element empty param_list_empty\n    | param_list_element \',\' param_listfunction_param_list_element : param_list_elementfunction_param_list_element : operandfunction_param_list : function_param_list_empty\n    function_param_list_empty : emptyfunction_param_list : function_param_list_element empty function_param_list_empty\n    | function_param_list_element \',\' function_param_listoperand_list : operand \',\' operand_listoperand_list : operandoperand_list : %prec OPERAND_LISTvar_ref : attr_ref %prec VAR_REFattr_ref : var_ref \'.\' IDvar_ref : ns_ref %prec NS_REFclass_ref : CIDclass_ref : ns_ref SEP CIDclass_ref : var_ref \'.\' CIDclass_ref_list : class_ref \',\' class_ref_listclass_ref_list : var_ref \',\' class_ref_listclass_ref_list : class_refclass_ref_list : var_refns_ref : ns_ref SEP IDns_ref : IDid_list : ID "," id_listid_list : ID'
+_lr_signature = 'right,nonassoc:nonassoc?leftORleftANDleftCMP_OPnonassocNOTleftINleftRELATION_DEFTYPEDEF_INNEROPERAND_LISTEMPTYNS_REFVAR_REFMAP_LOOKUPleftCIDIDleft([leftMLSAND AS CID CMP_OP DEFINED DICT ELIF ELSE END ENTITY EXTENDS FALSE FLOAT FOR FSTRING ID IF IMPLEMENT IMPLEMENTATION IMPORT IN INDEX INT IS MATCHING MLS NOT NULL OR PARENTS PEQ REGEX REL RSTRING SEP STRING TRUE TYPEDEF UNDEF USING WHENmain : head bodyhead : %prec EMPTYhead : MLSbody : top_stmt bodybody : emptytop_stmt : entity_def\n    | implement_def\n    | implementation_def\n    | relation\n    | statement\n    | typedef\n    | index\n    | importempty : %prec EMPTYimport : IMPORT ns_refimport : IMPORT ns_ref AS IDstatement : assign\n    | for\n    | if\n    | expressionstmt_list : statement stmt_liststmt_list : emptyassign : var_ref \'=\' operandassign : var_ref PEQ operandfor : FOR ID IN operand \':\' blockif : IF if_body ENDif_body : expression \':\' stmt_list if_nextif_next : emptyif_next : ELSE \':\' stmt_listif_next : ELIF if_bodyentity_def : ENTITY CID \':\' entity_body_outerentity_def : ENTITY ID \':\' entity_body_outerentity_def : ENTITY CID EXTENDS class_ref_list \':\' entity_body_outerentity_def : ENTITY ID EXTENDS class_ref_list \':\' entity_body_outerentity_body_outer : MLS entity_body ENDentity_body_outer : entity_body ENDentity_body_outer : ENDentity_body_outer : MLS ENDentity_body : entity_body attrentity_body : attrattr_base_type : ns_refattr_type_multi : attr_base_type \'[\' \']\'attr_type_opt : attr_type_multi \'?\'\n    | attr_base_type \'?\'attr_type : attr_type_opt\n    | attr_type_multi\n    | attr_base_typeattr : attr_type CID empty\n    | attr_type CID \'=\' constant\n    | attr_type CID \'=\' constant_list\n    | attr_type CID \'=\' UNDEFattr : attr_type IDattr : attr_type ID \'=\' constant\n    | attr_type ID \'=\' constant_listattr : attr_type ID \'=\' UNDEFattr : DICT empty CID empty\n    | DICT empty CID \'=\' map_def\n    | DICT empty CID \'=\' NULL\n    | DICT \'?\' CID empty\n    | DICT \'?\'  CID \'=\' map_def\n    | DICT \'?\'  CID \'=\' NULLattr : DICT IDattr : DICT ID \'=\' map_defattr : DICT ID \'=\' NULLattr : DICT \'?\' IDattr : DICT \'?\'  ID \'=\' map_defattr : DICT \'?\'  ID \'=\' NULLimplement_ns_list : ns_refimplement_ns_list : PARENTSimplement_ns_list : implement_ns_list \',\' implement_ns_listimplement_def : IMPLEMENT class_ref USING implement_ns_list empty\n    | IMPLEMENT class_ref USING implement_ns_list MLSimplement_def : IMPLEMENT class_ref USING implement_ns_list WHEN expression empty\n    | IMPLEMENT class_ref USING implement_ns_list WHEN expression MLSimplementation_def : IMPLEMENTATION ID FOR class_ref implementationimplementation : implementation_head blockimplementation_head : \':\'implementation_head : \':\' MLSblock : stmt_list ENDrelation : class_ref ID multi REL multi class_ref IDrelation : class_ref ID multi REL multi class_ref ID MLSrelation : relation_def MLSrelation : relation_def %prec RELATION_DEFrelation_def : class_ref \'.\' ID multi REL class_ref \'.\' ID multirelation_def : class_ref \'.\' ID multi REL class_refrelation_def : class_ref \'.\' ID multi operand_list class_ref \'.\' ID multirelation_def : class_ref \'.\' ID multi operand_list class_refmulti : \'[\' INT \']\'multi : \'[\' INT \':\' \']\'multi : \'[\' INT \':\' INT \']\'multi : \'[\'  \':\' INT \']\'typedef : typedef_inner %prec TYPEDEF_INNERtypedef : typedef_inner MLStypedef_inner : TYPEDEF ID AS ns_ref MATCHING expressiontypedef_inner : TYPEDEF CID AS constructorindex : INDEX class_ref \'(\' id_list \')\'expression : boolean_expression\n    | constant\n    | function_call\n    | var_ref %prec VAR_REF\n    | constructor\n    | list_def\n    | list_comprehension\n    | map_def\n    | map_lookup %prec MAP_LOOKUP\n    | index_lookup\n    | conditional_expressionexpression : \'(\' expression \')\'boolean_expression : expression CMP_OP expression\n    | expression IN expression\n    | expression AND expression\n    | expression OR expressionboolean_expression : NOT expressionboolean_expression : var_ref \'.\' ID IS DEFINEDboolean_expression : ID IS DEFINEDboolean_expression : map_lookup IS DEFINEDoperand : expressionmap_lookup : attr_ref \'[\' operand \']\'\n    | var_ref \'[\' operand \']\'\n    | map_lookup \'[\' operand \']\'constructor : class_ref \'(\' param_list \')\'function_call : ns_ref \'(\' function_param_list \')\'function_call : attr_ref \'(\' function_param_list \')\'list_def : \'[\' operand_list \']\'list_comprehension : \'[\' expression list_comprehension_for list_comprehension_guard \']\'list_comprehension_for_empty : emptylist_comprehension_for : FOR ID IN expression list_comprehension_for_empty\n    | FOR ID IN expression list_comprehension_forlist_comprehension_guard : emptylist_comprehension_guard : IF expression list_comprehension_guarddict_key : RSTRINGdict_key : STRINGpair_list : dict_key \':\' operand \',\' pair_list\n    | dict_key \':\' operand empty pair_list_emptypair_list : pair_list_empty\n    pair_list_empty : emptymap_def : \'{\' pair_list \'}\'index_lookup : class_ref \'[\' param_list \']\'index_lookup : attr_ref \'[\' param_list \']\'conditional_expression : expression \'?\' expression \':\' expressionconstant : INT\n    | FLOAT\n    constant : NULLconstant : REGEXconstant : TRUEconstant : FALSEconstant : STRINGconstant : FSTRINGconstant : RSTRINGconstant : MLSconstant_list : \'[\' constants \']\'constants : constantconstants :constants : constant \',\' constantswrapped_kwargs : \'*\' \'*\' operandparam_list_element : ID \'=\' operandparam_list_element : wrapped_kwargsparam_list : param_list_empty\n    param_list_empty : emptyparam_list : param_list_element empty param_list_empty\n    | param_list_element \',\' param_listfunction_param_list_element : param_list_elementfunction_param_list_element : operandfunction_param_list : function_param_list_empty\n    function_param_list_empty : emptyfunction_param_list : function_param_list_element empty function_param_list_empty\n    | function_param_list_element \',\' function_param_listoperand_list : operand \',\' operand_listoperand_list : operandoperand_list : %prec OPERAND_LISTvar_ref : attr_ref %prec VAR_REFattr_ref : var_ref \'.\' IDvar_ref : ns_ref %prec NS_REFclass_ref : CIDclass_ref : ns_ref SEP CIDclass_ref : var_ref \'.\' CIDclass_ref_list : class_ref \',\' class_ref_listclass_ref_list : var_ref \',\' class_ref_listclass_ref_list : class_refclass_ref_list : var_refns_ref : ns_ref SEP IDns_ref : IDid_list : ID "," id_listid_list : ID'
     
-_lr_action_items = {'ENTITY':([0,2,3,5,7,8,9,10,11,12,13,14,16,17,20,21,24,25,26,27,28,32,33,35,36,37,38,39,40,41,42,43,45,47,48,49,50,51,52,53,54,64,77,78,81,82,83,84,86,101,104,115,129,130,131,132,137,142,143,151,152,153,154,156,158,165,167,169,172,184,186,187,188,194,199,205,206,210,216,218,220,221,222,226,227,241,242,246,255,256,260,264,273,282,285,286,287,290,291,292,293,294,297,301,318,319,320,321,324,334,339,340,],[-2,15,-3,15,-6,-7,-8,-9,-10,-11,-12,-13,-166,-174,-142,-20,-83,-17,-18,-19,-92,-165,-100,-97,-98,-99,-101,-102,-103,-104,-105,-106,-163,-134,-135,-136,-137,-138,-139,-140,-141,-174,-82,-93,-100,-174,-165,-163,-15,-112,-116,-114,-108,-109,-110,-111,-107,-167,-173,-168,-164,-23,-24,-26,-115,-123,-130,-31,-37,-32,-14,-68,-69,-120,-131,-16,-121,-118,-119,-95,-122,-117,-132,-38,-36,-71,-72,-88,-133,-75,-96,-113,-35,-33,-34,-14,-70,-89,-91,-85,-87,-76,-25,-94,-73,-74,-80,-90,-79,-81,-84,-86,]),'IMPLEMENT':([0,2,3,5,7,8,9,10,11,12,13,14,16,17,20,21,24,25,26,27,28,32,33,35,36,37,38,39,40,41,42,43,45,47,48,49,50,51,52,53,54,64,77,78,81,82,83,84,86,101,104,115,129,130,131,132,137,142,143,151,152,153,154,156,158,165,167,169,172,184,186,187,188,194,199,205,206,210,216,218,220,221,222,226,227,241,242,246,255,256,260,264,273,282,285,286,287,290,291,292,293,294,297,301,318,319,320,321,324,334,339,340,],[-2,18,-3,18,-6,-7,-8,-9,-10,-11,-12,-13,-166,-174,-142,-20,-83,-17,-18,-19,-92,-165,-100,-97,-98,-99,-101,-102,-103,-104,-105,-106,-163,-134,-135,-136,-137,-138,-139,-140,-141,-174,-82,-93,-100,-174,-165,-163,-15,-112,-116,-114,-108,-109,-110,-111,-107,-167,-173,-168,-164,-23,-24,-26,-115,-123,-130,-31,-37,-32,-14,-68,-69,-120,-131,-16,-121,-118,-119,-95,-122,-117,-132,-38,-36,-71,-72,-88,-133,-75,-96,-113,-35,-33,-34,-14,-70,-89,-91,-85,-87,-76,-25,-94,-73,-74,-80,-90,-79,-81,-84,-86,]),'IMPLEMENTATION':([0,2,3,5,7,8,9,10,11,12,13,14,16,17,20,21,24,25,26,27,28,32,33,35,36,37,38,39,40,41,42,43,45,47,48,49,50,51,52,53,54,64,77,78,81,82,83,84,86,101,104,115,129,130,131,132,137,142,143,151,152,153,154,156,158,165,167,169,172,184,186,187,188,194,199,205,206,210,216,218,220,221,222,226,227,241,242,246,255,256,260,264,273,282,285,286,287,290,291,292,293,294,297,301,318,319,320,321,324,334,339,340,],[-2,22,-3,22,-6,-7,-8,-9,-10,-11,-12,-13,-166,-174,-142,-20,-83,-17,-18,-19,-92,-165,-100,-97,-98,-99,-101,-102,-103,-104,-105,-106,-163,-134,-135,-136,-137,-138,-139,-140,-141,-174,-82,-93,-100,-174,-165,-163,-15,-112,-116,-114,-108,-109,-110,-111,-107,-167,-173,-168,-164,-23,-24,-26,-115,-123,-130,-31,-37,-32,-14,-68,-69,-120,-131,-16,-121,-118,-119,-95,-122,-117,-132,-38,-36,-71,-72,-88,-133,-75,-96,-113,-35,-33,-34,-14,-70,-89,-91,-85,-87,-76,-25,-94,-73,-74,-80,-90,-79,-81,-84,-86,]),'INDEX':([0,2,3,5,7,8,9,10,11,12,13,14,16,17,20,21,24,25,26,27,28,32,33,35,36,37,38,39,40,41,42,43,45,47,48,49,50,51,52,53,54,64,77,78,81,82,83,84,86,101,104,115,129,130,131,132,137,142,143,151,152,153,154,156,158,165,167,169,172,184,186,187,188,194,199,205,206,210,216,218,220,221,222,226,227,241,242,246,255,256,260,264,273,282,285,286,287,290,291,292,293,294,297,301,318,319,320,321,324,334,339,340,],[-2,29,-3,29,-6,-7,-8,-9,-10,-11,-12,-13,-166,-174,-142,-20,-83,-17,-18,-19,-92,-165,-100,-97,-98,-99,-101,-102,-103,-104,-105,-106,-163,-134,-135,-136,-137,-138,-139,-140,-141,-174,-82,-93,-100,-174,-165,-163,-15,-112,-116,-114,-108,-109,-110,-111,-107,-167,-173,-168,-164,-23,-24,-26,-115,-123,-130,-31,-37,-32,-14,-68,-69,-120,-131,-16,-121,-118,-119,-95,-122,-117,-132,-38,-36,-71,-72,-88,-133,-75,-96,-113,-35,-33,-34,-14,-70,-89,-91,-85,-87,-76,-25,-94,-73,-74,-80,-90,-79,-81,-84,-86,]),'IMPORT':([0,2,3,5,7,8,9,10,11,12,13,14,16,17,20,21,24,25,26,27,28,32,33,35,36,37,38,39,40,41,42,43,45,47,48,49,50,51,52,53,54,64,77,78,81,82,83,84,86,101,104,115,129,130,131,132,137,142,143,151,152,153,154,156,158,165,167,169,172,184,186,187,188,194,199,205,206,210,216,218,220,221,222,226,227,241,242,246,255,256,260,264,273,282,285,286,287,290,291,292,293,294,297,301,318,319,320,321,324,334,339,340,],[-2,31,-3,31,-6,-7,-8,-9,-10,-11,-12,-13,-166,-174,-142,-20,-83,-17,-18,-19,-92,-165,-100,-97,-98,-99,-101,-102,-103,-104,-105,-106,-163,-134,-135,-136,-137,-138,-139,-140,-141,-174,-82,-93,-100,-174,-165,-163,-15,-112,-116,-114,-108,-109,-110,-111,-107,-167,-173,-168,-164,-23,-24,-26,-115,-123,-130,-31,-37,-32,-14,-68,-69,-120,-131,-16,-121,-118,-119,-95,-122,-117,-132,-38,-36,-71,-72,-88,-133,-75,-96,-113,-35,-33,-34,-14,-70,-89,-91,-85,-87,-76,-25,-94,-73,-74,-80,-90,-79,-81,-84,-86,]),'CID':([0,2,3,5,7,8,9,10,11,12,13,14,15,16,17,18,20,21,24,25,26,27,28,29,30,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,64,70,71,72,73,74,77,78,81,82,83,84,86,87,88,89,90,91,92,96,99,100,101,103,104,112,114,115,117,129,130,131,132,134,135,137,138,139,142,143,151,152,153,154,156,157,158,161,165,166,167,168,169,172,174,175,176,177,178,179,184,186,187,188,193,194,197,198,199,200,205,206,208,210,212,214,215,216,218,220,221,222,223,226,227,231,232,234,235,238,239,241,242,243,245,246,249,250,255,256,257,258,259,260,264,268,270,273,281,282,285,286,287,290,291,292,293,294,296,297,299,301,318,319,320,321,324,334,339,340,],[-2,16,-3,16,-6,-7,-8,-9,-10,-11,-12,-13,58,-166,-174,16,-142,-20,-83,-17,-18,-19,-92,16,16,-165,-100,16,-97,-98,-99,-101,-102,-103,-104,-105,-106,98,-163,16,-134,-135,-136,-137,-138,-139,-140,-141,16,-174,16,16,16,16,16,-82,-93,-100,-174,-165,-163,-15,142,16,151,16,16,16,16,16,16,-112,-161,-116,16,16,-114,151,-108,-109,-110,-111,16,16,-107,151,142,-167,-173,-168,-164,-23,-24,-26,16,-115,16,-123,16,-130,16,-31,-37,229,-14,-45,-46,-47,-41,-32,-14,-68,-69,16,-120,16,16,-131,16,-16,-121,16,-118,16,-100,-165,-119,-95,-122,-117,-132,-160,-38,-36,277,278,-43,-44,16,16,-71,-72,16,16,-88,16,16,-133,-75,16,-77,16,-96,-113,16,16,-35,-42,-33,-34,-14,-70,-89,-91,-85,-87,-76,-78,-25,16,-94,-73,-74,-80,-90,-79,-81,-84,-86,]),'FOR':([0,2,3,5,7,8,9,10,11,12,13,14,16,17,20,21,24,25,26,27,28,32,33,35,36,37,38,39,40,41,42,43,45,47,48,49,50,51,52,53,54,64,75,77,78,81,82,83,84,86,101,104,115,129,130,131,132,137,142,143,151,152,153,154,156,157,158,165,167,169,172,184,186,187,188,194,199,205,206,210,212,214,215,216,218,220,221,222,226,227,241,242,246,255,256,257,258,259,260,264,273,282,285,286,287,290,291,292,293,294,296,297,299,301,318,319,320,321,324,334,339,340,],[-2,23,-3,23,-6,-7,-8,-9,-10,-11,-12,-13,-166,-174,-142,-20,-83,-17,-18,-19,-92,-165,-100,-97,-98,-99,-101,-102,-103,-104,-105,-106,-163,-134,-135,-136,-137,-138,-139,-140,-141,-174,134,-82,-93,-100,-174,-165,-163,-15,-112,-116,-114,-108,-109,-110,-111,-107,-167,-173,-168,-164,-23,-24,-26,23,-115,-123,-130,-31,-37,-32,-14,-68,-69,-120,-131,-16,-121,-118,23,-100,-165,-119,-95,-122,-117,-132,-38,-36,-71,-72,-88,-133,-75,23,-77,23,-96,-113,-35,-33,-34,-14,-70,-89,-91,-85,-87,-76,-78,-25,23,-94,-73,-74,-80,-90,-79,-81,-84,-86,]),'IF':([0,2,3,5,7,8,9,10,11,12,13,14,16,17,20,21,24,25,26,27,28,32,33,35,36,37,38,39,40,41,42,43,45,47,48,49,50,51,52,53,54,64,77,78,81,82,83,84,86,101,104,115,129,130,131,132,137,142,143,151,152,153,154,156,157,158,165,167,169,172,184,186,187,188,194,199,205,206,210,212,214,215,216,218,220,221,222,226,227,241,242,246,255,256,257,258,259,260,264,273,282,285,286,287,290,291,292,293,294,296,297,299,301,318,319,320,321,324,334,339,340,],[-2,34,-3,34,-6,-7,-8,-9,-10,-11,-12,-13,-166,-174,-142,-20,-83,-17,-18,-19,-92,-165,-100,-97,-98,-99,-101,-102,-103,-104,-105,-106,-163,-134,-135,-136,-137,-138,-139,-140,-141,-174,-82,-93,-100,-174,-165,-163,-15,-112,-116,-114,-108,-109,-110,-111,-107,-167,-173,-168,-164,-23,-24,-26,34,-115,-123,-130,-31,-37,-32,-14,-68,-69,-120,-131,-16,-121,-118,34,-100,-165,-119,-95,-122,-117,-132,-38,-36,-71,-72,-88,-133,-75,34,-77,34,-96,-113,-35,-33,-34,-14,-70,-89,-91,-85,-87,-76,-78,-25,34,-94,-73,-74,-80,-90,-79,-81,-84,-86,]),'(':([0,2,3,5,7,8,9,10,11,12,13,14,16,17,19,20,21,24,25,26,27,28,30,32,33,34,35,36,37,38,39,40,41,42,43,45,46,47,48,49,50,51,52,53,54,55,64,70,71,72,73,74,77,78,79,81,82,83,84,85,86,88,90,91,92,96,99,100,101,104,115,129,130,131,132,135,137,142,143,150,151,152,153,154,156,157,158,165,166,167,168,169,172,184,186,187,188,193,194,197,198,199,200,205,206,208,210,212,214,215,216,218,219,220,221,222,226,227,241,242,243,246,255,256,257,258,259,260,264,268,270,273,282,285,286,287,290,291,292,293,294,296,297,299,301,318,319,320,321,324,334,339,340,],[-2,30,-3,30,-6,-7,-8,-9,-10,-11,-12,-13,-166,-174,68,-142,-20,-83,-17,-18,-19,-92,30,88,-100,30,-97,-98,-99,-101,-102,-103,-104,-105,-106,99,30,-134,-135,-136,-137,-138,-139,-140,-141,30,-174,30,30,30,30,30,-82,-93,136,-100,-174,88,99,68,-15,30,30,30,30,30,30,30,-112,-116,-114,-108,-109,-110,-111,30,-107,-167,-173,-174,-168,-164,-23,-24,-26,30,-115,-123,30,-130,30,-31,-37,-32,-14,-68,-69,30,-120,30,30,-131,30,-16,-121,30,-118,30,-100,88,-119,-95,68,-122,-117,-132,-38,-36,-71,-72,30,-88,-133,-75,30,-77,30,-96,-113,30,30,-35,-33,-34,-14,-70,-89,-91,-85,-87,-76,-78,-25,30,-94,-73,-74,-80,-90,-79,-81,-84,-86,]),'TYPEDEF':([0,2,3,5,7,8,9,10,11,12,13,14,16,17,20,21,24,25,26,27,28,32,33,35,36,37,38,39,40,41,42,43,45,47,48,49,50,51,52,53,54,64,77,78,81,82,83,84,86,101,104,115,129,130,131,132,137,142,143,151,152,153,154,156,158,165,167,169,172,184,186,187,188,194,199,205,206,210,216,218,220,221,222,226,227,241,242,246,255,256,260,264,273,282,285,286,287,290,291,292,293,294,297,301,318,319,320,321,324,334,339,340,],[-2,44,-3,44,-6,-7,-8,-9,-10,-11,-12,-13,-166,-174,-142,-20,-83,-17,-18,-19,-92,-165,-100,-97,-98,-99,-101,-102,-103,-104,-105,-106,-163,-134,-135,-136,-137,-138,-139,-140,-141,-174,-82,-93,-100,-174,-165,-163,-15,-112,-116,-114,-108,-109,-110,-111,-107,-167,-173,-168,-164,-23,-24,-26,-115,-123,-130,-31,-37,-32,-14,-68,-69,-120,-131,-16,-121,-118,-119,-95,-122,-117,-132,-38,-36,-71,-72,-88,-133,-75,-96,-113,-35,-33,-34,-14,-70,-89,-91,-85,-87,-76,-25,-94,-73,-74,-80,-90,-79,-81,-84,-86,]),'ID':([0,2,3,5,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,64,67,68,69,70,71,72,73,74,77,78,81,82,83,84,86,87,88,89,90,91,92,96,99,100,101,103,104,111,112,113,114,115,116,117,129,130,131,132,134,135,136,137,138,139,140,141,142,143,151,152,153,154,156,157,158,160,161,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,184,186,187,188,193,194,196,197,198,199,200,205,206,208,210,212,214,215,216,218,220,221,222,223,225,226,227,228,229,230,232,233,234,235,237,238,239,240,241,242,243,244,245,246,249,250,255,256,257,258,259,260,261,264,268,270,273,274,277,278,279,281,282,285,286,287,288,290,291,292,293,294,296,297,299,301,304,305,306,308,309,310,311,313,316,317,318,319,320,321,322,323,324,328,329,330,331,332,333,334,337,339,340,],[-2,17,-3,17,-6,-7,-8,-9,-10,-11,-12,-13,59,-166,-174,64,66,-142,-20,75,76,-83,-17,-18,-19,-92,64,82,64,-165,-100,82,-97,-98,-99,-101,-102,-103,-104,-105,-106,97,-163,82,-134,-135,-136,-137,-138,-139,-140,-141,82,-174,120,125,125,82,82,82,82,82,-82,-93,-100,-174,-165,-163,-15,143,150,152,82,82,82,82,150,150,-112,-161,-116,64,64,64,64,-114,64,189,-108,-109,-110,-111,64,82,204,-107,152,143,205,143,-167,-173,-168,-164,-23,-24,-26,82,-115,64,64,-123,82,-130,82,-31,64,64,-37,-40,230,233,-45,-46,-47,-41,-32,-14,-68,-69,82,-120,125,82,82,-131,82,-16,-121,150,-118,82,-100,-165,-119,-95,-122,-117,-132,-160,64,-38,-36,-39,-14,-52,279,-62,-43,-44,64,64,64,64,-71,-72,82,64,64,-88,64,64,-133,-75,82,-77,82,-96,204,-113,82,82,-35,-48,-14,-14,-65,-42,-33,-34,-14,-70,320,-89,-91,-85,-87,-76,-78,-25,82,-94,-49,-50,-51,-53,-54,-55,-56,-59,-63,-64,-73,-74,-80,-90,335,336,-79,-57,-58,-60,-61,-66,-67,-81,-143,-84,-86,]),'NOT':([0,2,3,5,7,8,9,10,11,12,13,14,16,17,20,21,24,25,26,27,28,30,32,33,34,35,36,37,38,39,40,41,42,43,45,46,47,48,49,50,51,52,53,54,55,64,70,71,72,73,74,77,78,81,82,83,84,86,88,90,91,92,96,99,100,101,104,115,129,130,131,132,135,137,142,143,151,152,153,154,156,157,158,165,166,167,168,169,172,184,186,187,188,193,194,197,198,199,200,205,206,208,210,212,214,215,216,218,220,221,222,226,227,241,242,243,246,255,256,257,258,259,260,264,268,270,273,282,285,286,287,290,291,292,293,294,296,297,299,301,318,319,320,321,324,334,339,340,],[-2,46,-3,46,-6,-7,-8,-9,-10,-11,-12,-13,-166,-174,-142,-20,-83,-17,-18,-19,-92,46,-165,-100,46,-97,-98,-99,-101,-102,-103,-104,-105,-106,-163,46,-134,-135,-136,-137,-138,-139,-140,-141,46,-174,46,46,46,46,46,-82,-93,-100,-174,-165,-163,-15,46,46,46,46,46,46,46,-112,-116,-114,-108,-109,-110,-111,46,-107,-167,-173,-168,-164,-23,-24,-26,46,-115,-123,46,-130,46,-31,-37,-32,-14,-68,-69,46,-120,46,46,-131,46,-16,-121,46,-118,46,-100,-165,-119,-95,-122,-117,-132,-38,-36,-71,-72,46,-88,-133,-75,46,-77,46,-96,-113,46,46,-35,-33,-34,-14,-70,-89,-91,-85,-87,-76,-78,-25,46,-94,-73,-74,-80,-90,-79,-81,-84,-86,]),'INT':([0,2,3,5,7,8,9,10,11,12,13,14,16,17,20,21,24,25,26,27,28,30,32,33,34,35,36,37,38,39,40,41,42,43,45,46,47,48,49,50,51,52,53,54,55,64,70,71,72,73,74,77,78,81,82,83,84,86,88,90,91,92,96,99,100,101,104,115,119,129,130,131,132,135,137,142,143,151,152,153,154,156,157,158,165,166,167,168,169,172,184,186,187,188,192,193,194,197,198,199,200,205,206,208,210,212,214,215,216,218,220,221,222,226,227,241,242,243,246,247,255,256,257,258,259,260,264,268,270,273,275,276,282,285,286,287,290,291,292,293,294,296,297,299,301,307,318,319,320,321,324,334,338,339,340,],[-2,47,-3,47,-6,-7,-8,-9,-10,-11,-12,-13,-166,-174,-142,-20,-83,-17,-18,-19,-92,47,-165,-100,47,-97,-98,-99,-101,-102,-103,-104,-105,-106,-163,47,-134,-135,-136,-137,-138,-139,-140,-141,47,-174,47,47,47,47,47,-82,-93,-100,-174,-165,-163,-15,47,47,47,47,47,47,47,-112,-116,-114,191,-108,-109,-110,-111,47,-107,-167,-173,-168,-164,-23,-24,-26,47,-115,-123,47,-130,47,-31,-37,-32,-14,-68,-69,248,47,-120,47,47,-131,47,-16,-121,47,-118,47,-100,-165,-119,-95,-122,-117,-132,-38,-36,-71,-72,47,-88,289,-133,-75,47,-77,47,-96,-113,47,47,-35,47,47,-33,-34,-14,-70,-89,-91,-85,-87,-76,-78,-25,47,-94,47,-73,-74,-80,-90,-79,-81,47,-84,-86,]),'FLOAT':([0,2,3,5,7,8,9,10,11,12,13,14,16,17,20,21,24,25,26,27,28,30,32,33,34,35,36,37,38,39,40,41,42,43,45,46,47,48,49,50,51,52,53,54,55,64,70,71,72,73,74,77,78,81,82,83,84,86,88,90,91,92,96,99,100,101,104,115,129,130,131,132,135,137,142,143,151,152,153,154,156,157,158,165,166,167,168,169,172,184,186,187,188,193,194,197,198,199,200,205,206,208,210,212,214,215,216,218,220,221,222,226,227,241,242,243,246,255,256,257,258,259,260,264,268,270,273,275,276,282,285,286,287,290,291,292,293,294,296,297,299,301,307,318,319,320,321,324,334,338,339,340,],[-2,48,-3,48,-6,-7,-8,-9,-10,-11,-12,-13,-166,-174,-142,-20,-83,-17,-18,-19,-92,48,-165,-100,48,-97,-98,-99,-101,-102,-103,-104,-105,-106,-163,48,-134,-135,-136,-137,-138,-139,-140,-141,48,-174,48,48,48,48,48,-82,-93,-100,-174,-165,-163,-15,48,48,48,48,48,48,48,-112,-116,-114,-108,-109,-110,-111,48,-107,-167,-173,-168,-164,-23,-24,-26,48,-115,-123,48,-130,48,-31,-37,-32,-14,-68,-69,48,-120,48,48,-131,48,-16,-121,48,-118,48,-100,-165,-119,-95,-122,-117,-132,-38,-36,-71,-72,48,-88,-133,-75,48,-77,48,-96,-113,48,48,-35,48,48,-33,-34,-14,-70,-89,-91,-85,-87,-76,-78,-25,48,-94,48,-73,-74,-80,-90,-79,-81,48,-84,-86,]),'NULL':([0,2,3,5,7,8,9,10,11,12,13,14,16,17,20,21,24,25,26,27,28,30,32,33,34,35,36,37,38,39,40,41,42,43,45,46,47,48,49,50,51,52,53,54,55,64,70,71,72,73,74,77,78,81,82,83,84,86,88,90,91,92,96,99,100,101,104,115,129,130,131,132,135,137,142,143,151,152,153,154,156,157,158,165,166,167,168,169,172,184,186,187,188,193,194,197,198,199,200,205,206,208,210,212,214,215,216,218,220,221,222,226,227,241,242,243,246,255,256,257,258,259,260,264,268,270,273,275,276,280,282,285,286,287,290,291,292,293,294,296,297,299,301,307,312,314,315,318,319,320,321,324,334,338,339,340,],[-2,49,-3,49,-6,-7,-8,-9,-10,-11,-12,-13,-166,-174,-142,-20,-83,-17,-18,-19,-92,49,-165,-100,49,-97,-98,-99,-101,-102,-103,-104,-105,-106,-163,49,-134,-135,-136,-137,-138,-139,-140,-141,49,-174,49,49,49,49,49,-82,-93,-100,-174,-165,-163,-15,49,49,49,49,49,49,49,-112,-116,-114,-108,-109,-110,-111,49,-107,-167,-173,-168,-164,-23,-24,-26,49,-115,-123,49,-130,49,-31,-37,-32,-14,-68,-69,49,-120,49,49,-131,49,-16,-121,49,-118,49,-100,-165,-119,-95,-122,-117,-132,-38,-36,-71,-72,49,-88,-133,-75,49,-77,49,-96,-113,49,49,-35,49,49,317,-33,-34,-14,-70,-89,-91,-85,-87,-76,-78,-25,49,-94,49,329,331,333,-73,-74,-80,-90,-79,-81,49,-84,-86,]),'REGEX':([0,2,3,5,7,8,9,10,11,12,13,14,16,17,20,21,24,25,26,27,28,30,32,33,34,35,36,37,38,39,40,41,42,43,45,46,47,48,49,50,51,52,53,54,55,64,70,71,72,73,74,77,78,81,82,83,84,86,88,90,91,92,96,99,100,101,104,115,129,130,131,132,135,137,142,143,151,152,153,154,156,157,158,165,166,167,168,169,172,184,186,187,188,193,194,197,198,199,200,205,206,208,210,212,214,215,216,218,220,221,222,226,227,241,242,243,246,255,256,257,258,259,260,264,268,270,273,275,276,282,285,286,287,290,291,292,293,294,296,297,299,301,307,318,319,320,321,324,334,338,339,340,],[-2,50,-3,50,-6,-7,-8,-9,-10,-11,-12,-13,-166,-174,-142,-20,-83,-17,-18,-19,-92,50,-165,-100,50,-97,-98,-99,-101,-102,-103,-104,-105,-106,-163,50,-134,-135,-136,-137,-138,-139,-140,-141,50,-174,50,50,50,50,50,-82,-93,-100,-174,-165,-163,-15,50,50,50,50,50,50,50,-112,-116,-114,-108,-109,-110,-111,50,-107,-167,-173,-168,-164,-23,-24,-26,50,-115,-123,50,-130,50,-31,-37,-32,-14,-68,-69,50,-120,50,50,-131,50,-16,-121,50,-118,50,-100,-165,-119,-95,-122,-117,-132,-38,-36,-71,-72,50,-88,-133,-75,50,-77,50,-96,-113,50,50,-35,50,50,-33,-34,-14,-70,-89,-91,-85,-87,-76,-78,-25,50,-94,50,-73,-74,-80,-90,-79,-81,50,-84,-86,]),'TRUE':([0,2,3,5,7,8,9,10,11,12,13,14,16,17,20,21,24,25,26,27,28,30,32,33,34,35,36,37,38,39,40,41,42,43,45,46,47,48,49,50,51,52,53,54,55,64,70,71,72,73,74,77,78,81,82,83,84,86,88,90,91,92,96,99,100,101,104,115,129,130,131,132,135,137,142,143,151,152,153,154,156,157,158,165,166,167,168,169,172,184,186,187,188,193,194,197,198,199,200,205,206,208,210,212,214,215,216,218,220,221,222,226,227,241,242,243,246,255,256,257,258,259,260,264,268,270,273,275,276,282,285,286,287,290,291,292,293,294,296,297,299,301,307,318,319,320,321,324,334,338,339,340,],[-2,51,-3,51,-6,-7,-8,-9,-10,-11,-12,-13,-166,-174,-142,-20,-83,-17,-18,-19,-92,51,-165,-100,51,-97,-98,-99,-101,-102,-103,-104,-105,-106,-163,51,-134,-135,-136,-137,-138,-139,-140,-141,51,-174,51,51,51,51,51,-82,-93,-100,-174,-165,-163,-15,51,51,51,51,51,51,51,-112,-116,-114,-108,-109,-110,-111,51,-107,-167,-173,-168,-164,-23,-24,-26,51,-115,-123,51,-130,51,-31,-37,-32,-14,-68,-69,51,-120,51,51,-131,51,-16,-121,51,-118,51,-100,-165,-119,-95,-122,-117,-132,-38,-36,-71,-72,51,-88,-133,-75,51,-77,51,-96,-113,51,51,-35,51,51,-33,-34,-14,-70,-89,-91,-85,-87,-76,-78,-25,51,-94,51,-73,-74,-80,-90,-79,-81,51,-84,-86,]),'FALSE':([0,2,3,5,7,8,9,10,11,12,13,14,16,17,20,21,24,25,26,27,28,30,32,33,34,35,36,37,38,39,40,41,42,43,45,46,47,48,49,50,51,52,53,54,55,64,70,71,72,73,74,77,78,81,82,83,84,86,88,90,91,92,96,99,100,101,104,115,129,130,131,132,135,137,142,143,151,152,153,154,156,157,158,165,166,167,168,169,172,184,186,187,188,193,194,197,198,199,200,205,206,208,210,212,214,215,216,218,220,221,222,226,227,241,242,243,246,255,256,257,258,259,260,264,268,270,273,275,276,282,285,286,287,290,291,292,293,294,296,297,299,301,307,318,319,320,321,324,334,338,339,340,],[-2,52,-3,52,-6,-7,-8,-9,-10,-11,-12,-13,-166,-174,-142,-20,-83,-17,-18,-19,-92,52,-165,-100,52,-97,-98,-99,-101,-102,-103,-104,-105,-106,-163,52,-134,-135,-136,-137,-138,-139,-140,-141,52,-174,52,52,52,52,52,-82,-93,-100,-174,-165,-163,-15,52,52,52,52,52,52,52,-112,-116,-114,-108,-109,-110,-111,52,-107,-167,-173,-168,-164,-23,-24,-26,52,-115,-123,52,-130,52,-31,-37,-32,-14,-68,-69,52,-120,52,52,-131,52,-16,-121,52,-118,52,-100,-165,-119,-95,-122,-117,-132,-38,-36,-71,-72,52,-88,-133,-75,52,-77,52,-96,-113,52,52,-35,52,52,-33,-34,-14,-70,-89,-91,-85,-87,-76,-78,-25,52,-94,52,-73,-74,-80,-90,-79,-81,52,-84,-86,]),'STRING':([0,2,3,5,7,8,9,10,11,12,13,14,16,17,20,21,24,25,26,27,28,30,32,33,34,35,36,37,38,39,40,41,42,43,45,46,47,48,49,50,51,52,53,54,55,56,64,70,71,72,73,74,77,78,81,82,83,84,86,88,90,91,92,96,99,100,101,104,115,129,130,131,132,135,137,142,143,151,152,153,154,156,157,158,165,166,167,168,169,172,184,186,187,188,193,194,197,198,199,200,205,206,208,210,212,214,215,216,218,220,221,222,226,227,241,242,243,246,255,256,257,258,259,260,264,268,270,271,273,275,276,282,285,286,287,290,291,292,293,294,296,297,299,301,307,318,319,320,321,324,334,338,339,340,],[-2,53,-3,53,-6,-7,-8,-9,-10,-11,-12,-13,-166,-174,-142,-20,-83,-17,-18,-19,-92,53,-165,-100,53,-97,-98,-99,-101,-102,-103,-104,-105,-106,-163,53,-134,-135,-136,-137,-138,-139,-140,-141,53,110,-174,53,53,53,53,53,-82,-93,-100,-174,-165,-163,-15,53,53,53,53,53,53,53,-112,-116,-114,-108,-109,-110,-111,53,-107,-167,-173,-168,-164,-23,-24,-26,53,-115,-123,53,-130,53,-31,-37,-32,-14,-68,-69,53,-120,53,53,-131,53,-16,-121,53,-118,53,-100,-165,-119,-95,-122,-117,-132,-38,-36,-71,-72,53,-88,-133,-75,53,-77,53,-96,-113,53,53,110,-35,53,53,-33,-34,-14,-70,-89,-91,-85,-87,-76,-78,-25,53,-94,53,-73,-74,-80,-90,-79,-81,53,-84,-86,]),'RSTRING':([0,2,3,5,7,8,9,10,11,12,13,14,16,17,20,21,24,25,26,27,28,30,32,33,34,35,36,37,38,39,40,41,42,43,45,46,47,48,49,50,51,52,53,54,55,56,64,70,71,72,73,74,77,78,81,82,83,84,86,88,90,91,92,96,99,100,101,104,115,129,130,131,132,135,137,142,143,151,152,153,154,156,157,158,165,166,167,168,169,172,184,186,187,188,193,194,197,198,199,200,205,206,208,210,212,214,215,216,218,220,221,222,226,227,241,242,243,246,255,256,257,258,259,260,264,268,270,271,273,275,276,282,285,286,287,290,291,292,293,294,296,297,299,301,307,318,319,320,321,324,334,338,339,340,],[-2,54,-3,54,-6,-7,-8,-9,-10,-11,-12,-13,-166,-174,-142,-20,-83,-17,-18,-19,-92,54,-165,-100,54,-97,-98,-99,-101,-102,-103,-104,-105,-106,-163,54,-134,-135,-136,-137,-138,-139,-140,-141,54,109,-174,54,54,54,54,54,-82,-93,-100,-174,-165,-163,-15,54,54,54,54,54,54,54,-112,-116,-114,-108,-109,-110,-111,54,-107,-167,-173,-168,-164,-23,-24,-26,54,-115,-123,54,-130,54,-31,-37,-32,-14,-68,-69,54,-120,54,54,-131,54,-16,-121,54,-118,54,-100,-165,-119,-95,-122,-117,-132,-38,-36,-71,-72,54,-88,-133,-75,54,-77,54,-96,-113,54,54,109,-35,54,54,-33,-34,-14,-70,-89,-91,-85,-87,-76,-78,-25,54,-94,54,-73,-74,-80,-90,-79,-81,54,-84,-86,]),'MLS':([0,2,3,5,7,8,9,10,11,12,13,14,16,17,20,21,24,25,26,27,28,30,32,33,34,35,36,37,38,39,40,41,42,43,45,46,47,48,49,50,51,52,53,54,55,64,70,71,72,73,74,77,78,81,82,83,84,86,88,90,91,92,96,99,100,101,104,111,113,115,129,130,131,132,135,137,142,143,151,152,153,154,156,157,158,165,166,167,168,169,172,184,186,187,188,193,194,197,198,199,200,205,206,208,210,212,214,215,216,218,220,221,222,226,227,237,240,241,242,243,246,255,256,257,258,259,260,264,268,270,273,275,276,282,285,286,287,290,291,292,293,294,296,297,299,301,307,318,319,320,321,324,334,338,339,340,],[3,20,-3,20,-6,-7,-8,-9,-10,-11,-12,-13,-166,-174,-142,-20,77,-17,-18,-19,78,20,-165,-100,20,-97,-98,-99,-101,-102,-103,-104,-105,-106,-163,20,-134,-135,-136,-137,-138,-139,-140,-141,20,-174,20,20,20,20,20,-82,-93,-100,-174,-165,-163,-15,20,20,20,20,20,20,20,-112,-116,170,170,-114,-108,-109,-110,-111,20,-107,-167,-173,-168,-164,-23,-24,-26,20,-115,-123,20,-130,20,-31,-37,-32,242,-68,-69,20,-120,20,20,-131,20,-16,-121,20,-118,20,-100,-165,-119,-95,-122,-117,-132,-38,-36,170,170,-71,-72,20,-88,-133,-75,20,296,20,-96,-113,20,20,-35,20,20,-33,-34,319,-70,-89,-91,-85,-87,-76,-78,-25,20,-94,20,-73,-74,334,-90,-79,-81,20,-84,-86,]),'[':([0,2,3,5,7,8,9,10,11,12,13,14,16,17,19,20,21,24,25,26,27,28,30,32,33,34,35,36,37,38,39,40,41,42,43,45,46,47,48,49,50,51,52,53,54,55,64,66,70,71,72,73,74,77,78,81,82,83,84,85,86,88,90,91,92,96,99,100,101,104,115,120,129,130,131,132,135,137,142,143,150,151,152,153,154,156,157,158,165,166,167,168,169,172,178,179,184,186,187,188,190,193,194,197,198,199,200,205,206,208,210,212,214,215,216,218,220,221,222,226,227,241,242,243,246,255,256,257,258,259,260,264,268,270,273,275,276,282,285,286,287,290,291,292,293,294,296,297,299,301,318,319,320,321,324,334,335,336,339,340,],[-2,55,-3,55,-6,-7,-8,-9,-10,-11,-12,-13,-166,-174,69,-142,-20,-83,-17,-18,-19,-92,55,-165,92,55,-97,-98,-99,-101,-102,-103,96,-105,-106,100,55,-134,-135,-136,-137,-138,-139,-140,-141,55,-174,119,55,55,55,55,55,-82,-93,92,-174,-165,100,69,-15,55,55,55,55,55,55,55,-112,-116,-114,119,-108,-109,-110,-111,55,-107,-167,-173,-174,-168,-164,-23,-24,-26,55,-115,-123,55,-130,55,-31,-37,236,-41,-32,-14,-68,-69,119,55,-120,55,55,-131,55,-16,-121,55,-118,55,92,-165,-119,-95,-122,-117,-132,-38,-36,-71,-72,55,-88,-133,-75,55,-77,55,-96,-113,55,55,-35,307,307,-33,-34,-14,-70,-89,-91,-85,-87,-76,-78,-25,55,-94,-73,-74,-80,-90,-79,-81,119,119,-84,-86,]),'{':([0,2,3,5,7,8,9,10,11,12,13,14,16,17,20,21,24,25,26,27,28,30,32,33,34,35,36,37,38,39,40,41,42,43,45,46,47,48,49,50,51,52,53,54,55,64,70,71,72,73,74,77,78,81,82,83,84,86,88,90,91,92,96,99,100,101,104,115,129,130,131,132,135,137,142,143,151,152,153,154,156,157,158,165,166,167,168,169,172,184,186,187,188,193,194,197,198,199,200,205,206,208,210,212,214,215,216,218,220,221,222,226,227,241,242,243,246,255,256,257,258,259,260,264,268,270,273,280,282,285,286,287,290,291,292,293,294,296,297,299,301,312,314,315,318,319,320,321,324,334,339,340,],[-2,56,-3,56,-6,-7,-8,-9,-10,-11,-12,-13,-166,-174,-142,-20,-83,-17,-18,-19,-92,56,-165,-100,56,-97,-98,-99,-101,-102,-103,-104,-105,-106,-163,56,-134,-135,-136,-137,-138,-139,-140,-141,56,-174,56,56,56,56,56,-82,-93,-100,-174,-165,-163,-15,56,56,56,56,56,56,56,-112,-116,-114,-108,-109,-110,-111,56,-107,-167,-173,-168,-164,-23,-24,-26,56,-115,-123,56,-130,56,-31,-37,-32,-14,-68,-69,56,-120,56,56,-131,56,-16,-121,56,-118,56,-100,-165,-119,-95,-122,-117,-132,-38,-36,-71,-72,56,-88,-133,-75,56,-77,56,-96,-113,56,56,-35,56,-33,-34,-14,-70,-89,-91,-85,-87,-76,-78,-25,56,-94,56,56,56,-73,-74,-80,-90,-79,-81,-84,-86,]),'$end':([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,16,17,20,21,24,25,26,27,28,32,33,35,36,37,38,39,40,41,42,43,45,47,48,49,50,51,52,53,54,57,64,77,78,81,82,83,84,86,101,104,115,129,130,131,132,137,142,143,151,152,153,154,156,158,165,167,169,172,184,186,187,188,194,199,205,206,210,216,218,220,221,222,226,227,241,242,246,255,256,260,264,273,282,285,286,287,290,291,292,293,294,297,301,318,319,320,321,324,334,339,340,],[-2,0,-14,-3,-1,-14,-5,-6,-7,-8,-9,-10,-11,-12,-13,-166,-174,-142,-20,-83,-17,-18,-19,-92,-165,-100,-97,-98,-99,-101,-102,-103,-104,-105,-106,-163,-134,-135,-136,-137,-138,-139,-140,-141,-4,-174,-82,-93,-100,-174,-165,-163,-15,-112,-116,-114,-108,-109,-110,-111,-107,-167,-173,-168,-164,-23,-24,-26,-115,-123,-130,-31,-37,-32,-14,-68,-69,-120,-131,-16,-121,-118,-119,-95,-122,-117,-132,-38,-36,-71,-72,-88,-133,-75,-96,-113,-35,-33,-34,-14,-70,-89,-91,-85,-87,-76,-25,-94,-73,-74,-80,-90,-79,-81,-84,-86,]),'.':([16,17,19,32,33,45,62,63,64,65,81,82,83,84,142,143,150,151,152,182,183,189,214,215,292,293,],[-166,-174,67,-165,89,-163,-165,117,-174,-163,138,-174,-165,-163,-167,-173,-174,-168,-164,117,-165,-164,138,-165,322,323,]),'USING':([16,61,142,151,],[-166,116,-167,-168,]),',':([16,20,35,36,37,38,39,40,41,42,43,47,48,49,50,51,52,53,54,64,65,81,82,83,84,101,103,104,115,123,126,129,130,131,132,137,142,143,146,148,149,150,151,152,158,165,167,181,182,183,186,187,188,189,194,199,204,206,210,216,220,221,222,224,253,254,255,264,287,327,],[-166,-142,-97,-98,-99,-101,-102,-103,-104,-105,-106,-134,-135,-136,-137,-138,-139,-140,-141,-174,-163,-100,-174,-165,-163,-112,166,-116,-114,196,-149,-108,-109,-110,-111,-107,-167,-173,208,-154,-155,-174,-168,-164,-115,-123,-130,238,239,-165,244,-68,-69,-164,-120,-131,261,-121,-118,-119,-122,-117,-132,271,-148,-147,-133,-113,244,338,]),':':([16,20,35,36,37,38,39,40,41,42,43,47,48,49,50,51,52,53,54,58,59,64,65,81,82,83,84,94,101,104,106,109,110,115,119,129,130,131,132,133,137,142,143,151,152,158,165,167,180,181,182,183,185,189,191,194,199,201,202,206,210,216,220,221,222,255,264,267,283,284,],[-166,-142,-97,-98,-99,-101,-102,-103,-104,-105,-106,-134,-135,-136,-137,-138,-139,-140,-141,111,113,-174,-163,-100,-174,-165,-163,157,-112,-116,168,-124,-125,-114,192,-108,-109,-110,-111,200,-107,-167,-173,-168,-164,-115,-123,-130,237,-171,-172,-165,240,-164,247,-120,-131,258,259,-121,-118,-119,-122,-117,-132,-133,-113,299,-169,-170,]),'SEP':([17,32,62,64,82,83,86,143,150,179,183,187,215,217,],[-174,87,87,-174,-174,139,141,-173,-174,141,87,141,139,141,]),'=':([17,32,33,45,82,125,143,150,152,214,215,229,230,233,277,278,279,],[-174,-165,90,-163,-174,197,-173,197,-164,90,-165,275,276,280,312,314,315,]),'PEQ':([17,32,33,45,82,143,152,214,215,],[-174,-165,91,-163,-174,-173,-164,91,-165,]),'CMP_OP':([17,20,21,32,33,35,36,37,38,39,40,41,42,43,45,47,48,49,50,51,52,53,54,80,81,82,83,84,94,101,104,115,129,130,131,132,133,137,143,150,152,158,165,167,194,199,206,210,214,215,216,220,221,222,255,264,286,301,],[-174,-142,70,-165,-100,-97,-98,-99,-101,-102,-103,-104,-105,-106,-163,-134,-135,-136,-137,-138,-139,-140,-141,70,-100,-174,-165,-163,70,-112,70,-114,-108,-109,70,70,70,-107,-173,-174,-164,-115,-123,-130,-120,-131,-121,-118,-100,-165,-119,-122,-117,-132,70,-113,70,70,]),'IN':([17,20,21,32,33,35,36,37,38,39,40,41,42,43,45,47,48,49,50,51,52,53,54,76,80,81,82,83,84,94,101,104,115,129,130,131,132,133,137,143,150,152,158,165,167,194,199,206,210,214,215,216,220,221,222,255,264,286,301,],[-174,-142,71,-165,-100,-97,-98,-99,-101,-102,-103,-104,-105,-106,-163,-134,-135,-136,-137,-138,-139,-140,-141,135,71,-100,-174,-165,-163,71,71,71,-114,71,-109,71,71,71,-107,-173,-174,-164,-115,-123,-130,-120,-131,-121,-118,-100,-165,-119,-122,-117,-132,71,-113,71,71,]),'AND':([17,20,21,32,33,35,36,37,38,39,40,41,42,43,45,47,48,49,50,51,52,53,54,80,81,82,83,84,94,101,104,115,129,130,131,132,133,137,143,150,152,158,165,167,194,199,206,210,214,215,216,220,221,222,255,264,286,301,],[-174,-142,72,-165,-100,-97,-98,-99,-101,-102,-103,-104,-105,-106,-163,-134,-135,-136,-137,-138,-139,-140,-141,72,-100,-174,-165,-163,72,-112,72,-114,-108,-109,-110,72,72,-107,-173,-174,-164,-115,-123,-130,-120,-131,-121,-118,-100,-165,-119,-122,-117,-132,72,-113,72,72,]),'OR':([17,20,21,32,33,35,36,37,38,39,40,41,42,43,45,47,48,49,50,51,52,53,54,80,81,82,83,84,94,101,104,115,129,130,131,132,133,137,143,150,152,158,165,167,194,199,206,210,214,215,216,220,221,222,255,264,286,301,],[-174,-142,73,-165,-100,-97,-98,-99,-101,-102,-103,-104,-105,-106,-163,-134,-135,-136,-137,-138,-139,-140,-141,73,-100,-174,-165,-163,73,-112,73,-114,-108,-109,-110,-111,73,-107,-173,-174,-164,-115,-123,-130,-120,-131,-121,-118,-100,-165,-119,-122,-117,-132,73,-113,73,73,]),'?':([17,20,21,32,33,35,36,37,38,39,40,41,42,43,45,47,48,49,50,51,52,53,54,64,80,81,82,83,84,94,101,104,115,129,130,131,132,133,137,143,150,152,158,165,167,175,177,178,179,194,199,206,210,214,215,216,220,221,222,255,264,281,286,301,],[-174,-142,74,-165,-100,-97,-98,-99,-101,-102,-103,-104,-105,-106,-163,-134,-135,-136,-137,-138,-139,-140,-141,-174,74,-100,-174,-165,-163,74,-112,74,-114,-108,-109,-110,-111,74,-107,-173,-174,-164,-115,-123,-130,232,234,235,-41,-120,-131,-121,-118,-100,-165,-119,-122,-117,-132,74,-113,-42,74,74,]),'IS':([17,41,82,150,152,210,216,221,],[60,95,60,60,209,-118,-119,-117,]),')':([20,35,36,37,38,39,40,41,42,43,47,48,49,50,51,52,53,54,68,80,81,82,83,84,88,99,101,104,115,121,122,123,124,126,129,130,131,132,137,143,144,145,146,147,148,149,150,152,158,162,165,167,194,195,196,199,203,204,206,207,208,210,216,220,221,222,251,252,253,254,255,262,263,264,298,],[-142,-97,-98,-99,-101,-102,-103,-104,-105,-106,-134,-135,-136,-137,-138,-139,-140,-141,-14,137,-100,-174,-165,-163,-14,-14,-112,-116,-114,194,-150,-14,-151,-149,-108,-109,-110,-111,-107,-173,206,-156,-14,-157,-154,-155,-174,-164,-115,220,-123,-130,-120,-14,-14,-131,260,-176,-121,-14,-14,-118,-119,-122,-117,-132,-152,-153,-148,-147,-133,-158,-159,-113,-175,]),']':([20,35,36,37,38,39,40,41,42,43,47,48,49,50,51,52,53,54,55,69,81,82,83,84,100,101,102,103,104,115,122,123,124,126,128,129,130,131,132,137,143,150,152,155,158,159,163,164,165,166,167,191,194,195,196,199,206,210,216,220,221,222,223,236,247,248,251,252,253,254,255,264,289,307,326,327,338,341,],[-142,-97,-98,-99,-101,-102,-103,-104,-105,-106,-134,-135,-136,-137,-138,-139,-140,-141,-162,-14,-100,-174,-165,-163,-14,-112,165,-161,-116,-114,-150,-14,-151,-149,199,-108,-109,-110,-111,-107,-173,-174,-164,210,-115,216,221,222,-123,-162,-130,246,-120,-14,-14,-131,-121,-118,-119,-122,-117,-132,-160,281,290,291,-152,-153,-148,-147,-133,-113,321,-145,337,-144,-145,-146,]),'ELSE':([20,21,25,26,27,35,36,37,38,39,40,41,42,43,45,47,48,49,50,51,52,53,54,81,82,83,84,101,104,115,129,130,131,132,137,143,152,153,154,156,157,158,165,167,194,199,206,210,211,212,213,214,215,216,220,221,222,255,264,269,297,324,],[-142,-20,-17,-18,-19,-97,-98,-99,-101,-102,-103,-104,-105,-106,-163,-134,-135,-136,-137,-138,-139,-140,-141,-100,-174,-165,-163,-112,-116,-114,-108,-109,-110,-111,-107,-173,-164,-23,-24,-26,-14,-115,-123,-130,-120,-131,-121,-118,267,-14,-22,-100,-165,-119,-122,-117,-132,-133,-113,-21,-25,-79,]),'ELIF':([20,21,25,26,27,35,36,37,38,39,40,41,42,43,45,47,48,49,50,51,52,53,54,81,82,83,84,101,104,115,129,130,131,132,137,143,152,153,154,156,157,158,165,167,194,199,206,210,211,212,213,214,215,216,220,221,222,255,264,269,297,324,],[-142,-20,-17,-18,-19,-97,-98,-99,-101,-102,-103,-104,-105,-106,-163,-134,-135,-136,-137,-138,-139,-140,-141,-100,-174,-165,-163,-112,-116,-114,-108,-109,-110,-111,-107,-173,-164,-23,-24,-26,-14,-115,-123,-130,-120,-131,-121,-118,268,-14,-22,-100,-165,-119,-122,-117,-132,-133,-113,-21,-25,-79,]),'END':([20,21,25,26,27,35,36,37,38,39,40,41,42,43,45,47,48,49,50,51,52,53,54,81,82,83,84,93,101,104,111,113,115,129,130,131,132,137,143,152,153,154,156,157,158,165,167,170,171,173,194,199,206,210,211,212,213,214,215,216,220,221,222,225,228,229,230,233,237,240,255,257,258,259,264,265,266,269,274,277,278,279,295,296,297,299,300,304,305,306,308,309,310,311,313,316,317,324,325,328,329,330,331,332,333,337,],[-142,-20,-17,-18,-19,-97,-98,-99,-101,-102,-103,-104,-105,-106,-163,-134,-135,-136,-137,-138,-139,-140,-141,-100,-174,-165,-163,156,-112,-116,172,172,-114,-108,-109,-110,-111,-107,-173,-164,-23,-24,-26,-14,-115,-123,-130,226,227,-40,-120,-131,-121,-118,-14,-14,-22,-100,-165,-119,-122,-117,-132,273,-39,-14,-52,-62,172,172,-133,-14,-77,-14,-113,-27,-28,-21,-48,-14,-14,-65,324,-78,-25,-14,-30,-49,-50,-51,-53,-54,-55,-56,-59,-63,-64,-79,-29,-57,-58,-60,-61,-66,-67,-143,]),'}':([20,35,36,37,38,39,40,41,42,43,47,48,49,50,51,52,53,54,56,81,82,83,84,101,104,105,107,108,115,129,130,131,132,137,143,152,158,165,167,194,199,206,210,216,220,221,222,224,255,264,271,272,302,303,],[-142,-97,-98,-99,-101,-102,-103,-104,-105,-106,-134,-135,-136,-137,-138,-139,-140,-141,-14,-100,-174,-165,-163,-112,-116,167,-129,-128,-114,-108,-109,-110,-111,-107,-173,-164,-115,-123,-130,-120,-131,-121,-118,-119,-122,-117,-132,-14,-133,-113,-14,-14,-126,-127,]),'DICT':([20,47,48,49,50,51,52,53,54,111,113,167,170,171,173,225,228,229,230,233,237,240,274,277,278,279,304,305,306,308,309,310,311,313,316,317,328,329,330,331,332,333,337,],[-142,-134,-135,-136,-137,-138,-139,-140,-141,175,175,-130,175,175,-40,175,-39,-14,-52,-62,175,175,-48,-14,-14,-65,-49,-50,-51,-53,-54,-55,-56,-59,-63,-64,-57,-58,-60,-61,-66,-67,-143,]),'EXTENDS':([58,59,],[112,114,]),'DEFINED':([60,95,209,],[115,158,264,]),'AS':([64,86,97,98,143,],[-174,140,160,161,-173,]),'WHEN':([64,143,186,187,188,287,],[-174,-173,243,-68,-69,-70,]),'MATCHING':([64,143,217,],[-174,-173,270,]),'*':([68,69,88,99,100,127,196,208,],[127,127,127,127,127,198,127,127,]),'PARENTS':([116,244,],[188,188,]),'REL':([118,193,246,290,291,321,],[190,249,-88,-89,-91,-90,]),'UNDEF':([275,276,],[306,310,]),}
+_lr_action_items = {'ENTITY':([0,2,3,5,7,8,9,10,11,12,13,14,16,17,20,21,24,25,26,27,28,32,33,35,36,37,38,39,40,41,42,43,44,46,48,49,50,51,52,53,54,55,56,66,79,80,83,84,85,86,88,103,117,131,132,133,134,139,144,145,153,154,155,156,157,159,161,168,172,174,177,189,191,192,193,199,204,210,211,215,221,223,225,226,227,235,236,250,251,255,264,265,269,273,280,285,294,297,298,299,302,303,304,305,306,309,313,332,333,334,335,338,351,356,357,],[-2,15,-3,15,-6,-7,-8,-9,-10,-11,-12,-13,-174,-182,-150,-20,-83,-17,-18,-19,-92,-173,-100,-97,-98,-99,-101,-102,-103,-104,-105,-106,-107,-171,-141,-142,-143,-144,-145,-146,-147,-148,-149,-182,-82,-93,-100,-182,-173,-171,-15,-113,-115,-109,-110,-111,-112,-108,-175,-181,-117,-176,-172,-23,-24,-26,-116,-124,-137,-31,-37,-32,-14,-68,-69,-121,-138,-16,-122,-119,-120,-95,-123,-118,-139,-38,-36,-71,-72,-88,-140,-75,-96,-114,-125,-35,-33,-34,-14,-70,-89,-91,-85,-87,-76,-25,-94,-73,-74,-80,-90,-79,-81,-84,-86,]),'IMPLEMENT':([0,2,3,5,7,8,9,10,11,12,13,14,16,17,20,21,24,25,26,27,28,32,33,35,36,37,38,39,40,41,42,43,44,46,48,49,50,51,52,53,54,55,56,66,79,80,83,84,85,86,88,103,117,131,132,133,134,139,144,145,153,154,155,156,157,159,161,168,172,174,177,189,191,192,193,199,204,210,211,215,221,223,225,226,227,235,236,250,251,255,264,265,269,273,280,285,294,297,298,299,302,303,304,305,306,309,313,332,333,334,335,338,351,356,357,],[-2,18,-3,18,-6,-7,-8,-9,-10,-11,-12,-13,-174,-182,-150,-20,-83,-17,-18,-19,-92,-173,-100,-97,-98,-99,-101,-102,-103,-104,-105,-106,-107,-171,-141,-142,-143,-144,-145,-146,-147,-148,-149,-182,-82,-93,-100,-182,-173,-171,-15,-113,-115,-109,-110,-111,-112,-108,-175,-181,-117,-176,-172,-23,-24,-26,-116,-124,-137,-31,-37,-32,-14,-68,-69,-121,-138,-16,-122,-119,-120,-95,-123,-118,-139,-38,-36,-71,-72,-88,-140,-75,-96,-114,-125,-35,-33,-34,-14,-70,-89,-91,-85,-87,-76,-25,-94,-73,-74,-80,-90,-79,-81,-84,-86,]),'IMPLEMENTATION':([0,2,3,5,7,8,9,10,11,12,13,14,16,17,20,21,24,25,26,27,28,32,33,35,36,37,38,39,40,41,42,43,44,46,48,49,50,51,52,53,54,55,56,66,79,80,83,84,85,86,88,103,117,131,132,133,134,139,144,145,153,154,155,156,157,159,161,168,172,174,177,189,191,192,193,199,204,210,211,215,221,223,225,226,227,235,236,250,251,255,264,265,269,273,280,285,294,297,298,299,302,303,304,305,306,309,313,332,333,334,335,338,351,356,357,],[-2,22,-3,22,-6,-7,-8,-9,-10,-11,-12,-13,-174,-182,-150,-20,-83,-17,-18,-19,-92,-173,-100,-97,-98,-99,-101,-102,-103,-104,-105,-106,-107,-171,-141,-142,-143,-144,-145,-146,-147,-148,-149,-182,-82,-93,-100,-182,-173,-171,-15,-113,-115,-109,-110,-111,-112,-108,-175,-181,-117,-176,-172,-23,-24,-26,-116,-124,-137,-31,-37,-32,-14,-68,-69,-121,-138,-16,-122,-119,-120,-95,-123,-118,-139,-38,-36,-71,-72,-88,-140,-75,-96,-114,-125,-35,-33,-34,-14,-70,-89,-91,-85,-87,-76,-25,-94,-73,-74,-80,-90,-79,-81,-84,-86,]),'INDEX':([0,2,3,5,7,8,9,10,11,12,13,14,16,17,20,21,24,25,26,27,28,32,33,35,36,37,38,39,40,41,42,43,44,46,48,49,50,51,52,53,54,55,56,66,79,80,83,84,85,86,88,103,117,131,132,133,134,139,144,145,153,154,155,156,157,159,161,168,172,174,177,189,191,192,193,199,204,210,211,215,221,223,225,226,227,235,236,250,251,255,264,265,269,273,280,285,294,297,298,299,302,303,304,305,306,309,313,332,333,334,335,338,351,356,357,],[-2,29,-3,29,-6,-7,-8,-9,-10,-11,-12,-13,-174,-182,-150,-20,-83,-17,-18,-19,-92,-173,-100,-97,-98,-99,-101,-102,-103,-104,-105,-106,-107,-171,-141,-142,-143,-144,-145,-146,-147,-148,-149,-182,-82,-93,-100,-182,-173,-171,-15,-113,-115,-109,-110,-111,-112,-108,-175,-181,-117,-176,-172,-23,-24,-26,-116,-124,-137,-31,-37,-32,-14,-68,-69,-121,-138,-16,-122,-119,-120,-95,-123,-118,-139,-38,-36,-71,-72,-88,-140,-75,-96,-114,-125,-35,-33,-34,-14,-70,-89,-91,-85,-87,-76,-25,-94,-73,-74,-80,-90,-79,-81,-84,-86,]),'IMPORT':([0,2,3,5,7,8,9,10,11,12,13,14,16,17,20,21,24,25,26,27,28,32,33,35,36,37,38,39,40,41,42,43,44,46,48,49,50,51,52,53,54,55,56,66,79,80,83,84,85,86,88,103,117,131,132,133,134,139,144,145,153,154,155,156,157,159,161,168,172,174,177,189,191,192,193,199,204,210,211,215,221,223,225,226,227,235,236,250,251,255,264,265,269,273,280,285,294,297,298,299,302,303,304,305,306,309,313,332,333,334,335,338,351,356,357,],[-2,31,-3,31,-6,-7,-8,-9,-10,-11,-12,-13,-174,-182,-150,-20,-83,-17,-18,-19,-92,-173,-100,-97,-98,-99,-101,-102,-103,-104,-105,-106,-107,-171,-141,-142,-143,-144,-145,-146,-147,-148,-149,-182,-82,-93,-100,-182,-173,-171,-15,-113,-115,-109,-110,-111,-112,-108,-175,-181,-117,-176,-172,-23,-24,-26,-116,-124,-137,-31,-37,-32,-14,-68,-69,-121,-138,-16,-122,-119,-120,-95,-123,-118,-139,-38,-36,-71,-72,-88,-140,-75,-96,-114,-125,-35,-33,-34,-14,-70,-89,-91,-85,-87,-76,-25,-94,-73,-74,-80,-90,-79,-81,-84,-86,]),'CID':([0,2,3,5,7,8,9,10,11,12,13,14,15,16,17,18,20,21,24,25,26,27,28,29,30,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,66,72,73,74,75,76,79,80,83,84,85,86,88,89,90,91,92,93,94,98,101,102,103,106,114,116,117,119,131,132,133,134,136,137,139,140,141,144,145,153,154,155,156,157,159,160,161,164,168,171,172,173,174,177,179,180,181,182,183,184,189,191,192,193,198,199,202,203,204,205,210,211,213,215,217,219,220,221,223,225,226,227,230,232,235,236,240,241,243,244,247,248,250,251,252,254,255,258,259,264,265,266,267,268,269,273,277,279,280,282,285,293,294,297,298,299,302,303,304,305,306,308,309,311,313,332,333,334,335,338,351,356,357,],[-2,16,-3,16,-6,-7,-8,-9,-10,-11,-12,-13,60,-174,-182,16,-150,-20,-83,-17,-18,-19,-92,16,16,-173,-100,16,-97,-98,-99,-101,-102,-103,-104,-105,-106,-107,100,-171,16,-141,-142,-143,-144,-145,-146,-147,-148,-149,16,-182,16,16,16,16,16,-82,-93,-100,-182,-173,-171,-15,144,16,154,16,16,16,16,16,16,-113,-169,16,16,-115,154,-109,-110,-111,-112,16,16,-108,154,144,-175,-181,-117,-176,-172,-23,-24,-26,16,-116,16,-124,16,-137,16,-31,-37,238,-14,-45,-46,-47,-41,-32,-14,-68,-69,16,-121,16,16,-138,16,-16,-122,16,-119,16,-100,-173,-120,-95,-123,-118,-139,16,-168,-38,-36,289,290,-43,-44,16,16,-71,-72,16,16,-88,16,16,-140,-75,16,-77,16,-96,-114,16,16,-125,16,-35,-42,-33,-34,-14,-70,-89,-91,-85,-87,-76,-78,-25,16,-94,-73,-74,-80,-90,-79,-81,-84,-86,]),'FOR':([0,2,3,5,7,8,9,10,11,12,13,14,16,17,20,21,24,25,26,27,28,32,33,35,36,37,38,39,40,41,42,43,44,46,48,49,50,51,52,53,54,55,56,66,77,79,80,83,84,85,86,88,103,105,117,131,132,133,134,139,144,145,153,154,155,156,157,159,160,161,168,172,174,177,189,191,192,193,199,204,210,211,215,217,219,220,221,223,225,226,227,235,236,250,251,255,264,265,266,267,268,269,273,280,285,294,297,298,299,302,303,304,305,306,308,309,311,313,315,332,333,334,335,338,351,356,357,],[-2,23,-3,23,-6,-7,-8,-9,-10,-11,-12,-13,-174,-182,-150,-20,-83,-17,-18,-19,-92,-173,-100,-97,-98,-99,-101,-102,-103,-104,-105,-106,-107,-171,-141,-142,-143,-144,-145,-146,-147,-148,-149,-182,136,-82,-93,-100,-182,-173,-171,-15,-113,170,-115,-109,-110,-111,-112,-108,-175,-181,-117,-176,-172,-23,-24,-26,23,-116,-124,-137,-31,-37,-32,-14,-68,-69,-121,-138,-16,-122,-119,23,-100,-173,-120,-95,-123,-118,-139,-38,-36,-71,-72,-88,-140,-75,23,-77,23,-96,-114,-125,-35,-33,-34,-14,-70,-89,-91,-85,-87,-76,-78,-25,23,-94,170,-73,-74,-80,-90,-79,-81,-84,-86,]),'IF':([0,2,3,5,7,8,9,10,11,12,13,14,16,17,20,21,24,25,26,27,28,32,33,35,36,37,38,39,40,41,42,43,44,46,48,49,50,51,52,53,54,55,56,66,79,80,83,84,85,86,88,103,117,131,132,133,134,139,144,145,153,154,155,156,157,159,160,161,168,169,172,174,177,189,191,192,193,199,204,210,211,215,217,219,220,221,223,225,226,227,235,236,250,251,255,264,265,266,267,268,269,273,280,281,285,294,297,298,299,302,303,304,305,306,308,309,311,313,315,332,333,334,335,338,340,341,342,351,356,357,],[-2,34,-3,34,-6,-7,-8,-9,-10,-11,-12,-13,-174,-182,-150,-20,-83,-17,-18,-19,-92,-173,-100,-97,-98,-99,-101,-102,-103,-104,-105,-106,-107,-171,-141,-142,-143,-144,-145,-146,-147,-148,-149,-182,-82,-93,-100,-182,-173,-171,-15,-113,-115,-109,-110,-111,-112,-108,-175,-181,-117,-176,-172,-23,-24,-26,34,-116,-124,230,-137,-31,-37,-32,-14,-68,-69,-121,-138,-16,-122,-119,34,-100,-173,-120,-95,-123,-118,-139,-38,-36,-71,-72,-88,-140,-75,34,-77,34,-96,-114,-125,230,-35,-33,-34,-14,-70,-89,-91,-85,-87,-76,-78,-25,34,-94,-14,-73,-74,-80,-90,-79,-127,-128,-126,-81,-84,-86,]),'(':([0,2,3,5,7,8,9,10,11,12,13,14,16,17,19,20,21,24,25,26,27,28,30,32,33,34,35,36,37,38,39,40,41,42,43,44,46,47,48,49,50,51,52,53,54,55,56,57,66,72,73,74,75,76,79,80,81,83,84,85,86,87,88,90,92,93,94,98,101,102,103,117,131,132,133,134,137,139,144,145,152,153,154,155,156,157,159,160,161,168,171,172,173,174,177,189,191,192,193,198,199,202,203,204,205,210,211,213,215,217,219,220,221,223,224,225,226,227,230,235,236,250,251,252,255,264,265,266,267,268,269,273,277,279,280,282,285,294,297,298,299,302,303,304,305,306,308,309,311,313,332,333,334,335,338,351,356,357,],[-2,30,-3,30,-6,-7,-8,-9,-10,-11,-12,-13,-174,-182,70,-150,-20,-83,-17,-18,-19,-92,30,90,-100,30,-97,-98,-99,-101,-102,-103,-104,-105,-106,-107,101,30,-141,-142,-143,-144,-145,-146,-147,-148,-149,30,-182,30,30,30,30,30,-82,-93,138,-100,-182,90,101,70,-15,30,30,30,30,30,30,30,-113,-115,-109,-110,-111,-112,30,-108,-175,-181,-182,-117,-176,-172,-23,-24,-26,30,-116,-124,30,-137,30,-31,-37,-32,-14,-68,-69,30,-121,30,30,-138,30,-16,-122,30,-119,30,-100,90,-120,-95,70,-123,-118,-139,30,-38,-36,-71,-72,30,-88,-140,-75,30,-77,30,-96,-114,30,30,-125,30,-35,-33,-34,-14,-70,-89,-91,-85,-87,-76,-78,-25,30,-94,-73,-74,-80,-90,-79,-81,-84,-86,]),'TYPEDEF':([0,2,3,5,7,8,9,10,11,12,13,14,16,17,20,21,24,25,26,27,28,32,33,35,36,37,38,39,40,41,42,43,44,46,48,49,50,51,52,53,54,55,56,66,79,80,83,84,85,86,88,103,117,131,132,133,134,139,144,145,153,154,155,156,157,159,161,168,172,174,177,189,191,192,193,199,204,210,211,215,221,223,225,226,227,235,236,250,251,255,264,265,269,273,280,285,294,297,298,299,302,303,304,305,306,309,313,332,333,334,335,338,351,356,357,],[-2,45,-3,45,-6,-7,-8,-9,-10,-11,-12,-13,-174,-182,-150,-20,-83,-17,-18,-19,-92,-173,-100,-97,-98,-99,-101,-102,-103,-104,-105,-106,-107,-171,-141,-142,-143,-144,-145,-146,-147,-148,-149,-182,-82,-93,-100,-182,-173,-171,-15,-113,-115,-109,-110,-111,-112,-108,-175,-181,-117,-176,-172,-23,-24,-26,-116,-124,-137,-31,-37,-32,-14,-68,-69,-121,-138,-16,-122,-119,-120,-95,-123,-118,-139,-38,-36,-71,-72,-88,-140,-75,-96,-114,-125,-35,-33,-34,-14,-70,-89,-91,-85,-87,-76,-25,-94,-73,-74,-80,-90,-79,-81,-84,-86,]),'ID':([0,2,3,5,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,66,69,70,71,72,73,74,75,76,79,80,83,84,85,86,88,89,90,91,92,93,94,98,101,102,103,106,113,114,115,116,117,118,119,131,132,133,134,136,137,138,139,140,141,142,143,144,145,153,154,155,156,157,159,160,161,163,164,168,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,189,191,192,193,198,199,201,202,203,204,205,210,211,213,215,217,219,220,221,223,225,226,227,230,232,234,235,236,237,238,239,241,242,243,244,246,247,248,249,250,251,252,253,254,255,258,259,264,265,266,267,268,269,270,273,277,279,280,282,285,286,289,290,291,293,294,297,298,299,300,302,303,304,305,306,308,309,311,313,318,319,320,322,323,324,325,327,330,331,332,333,334,335,336,337,338,345,346,347,348,349,350,351,354,356,357,],[-2,17,-3,17,-6,-7,-8,-9,-10,-11,-12,-13,61,-174,-182,66,68,-150,-20,77,78,-83,-17,-18,-19,-92,66,84,66,-173,-100,84,-97,-98,-99,-101,-102,-103,-104,-105,-106,-107,99,-171,84,-141,-142,-143,-144,-145,-146,-147,-148,-149,84,-182,122,127,127,84,84,84,84,84,-82,-93,-100,-182,-173,-171,-15,145,152,155,84,84,84,84,152,152,-113,-169,66,66,66,66,-115,66,194,-109,-110,-111,-112,66,84,209,-108,155,145,210,145,-175,-181,-117,-176,-172,-23,-24,-26,84,-116,66,66,-124,231,84,-137,84,-31,66,66,-37,-40,239,242,-45,-46,-47,-41,-32,-14,-68,-69,84,-121,127,84,84,-138,84,-16,-122,152,-119,84,-100,-173,-120,-95,-123,-118,-139,84,-168,66,-38,-36,-39,-14,-52,291,-62,-43,-44,66,66,66,66,-71,-72,84,66,66,-88,66,66,-140,-75,84,-77,84,-96,209,-114,84,84,-125,84,-35,-48,-14,-14,-65,-42,-33,-34,-14,-70,334,-89,-91,-85,-87,-76,-78,-25,84,-94,-49,-50,-51,-53,-54,-55,-56,-59,-63,-64,-73,-74,-80,-90,352,353,-79,-57,-58,-60,-61,-66,-67,-81,-151,-84,-86,]),'NOT':([0,2,3,5,7,8,9,10,11,12,13,14,16,17,20,21,24,25,26,27,28,30,32,33,34,35,36,37,38,39,40,41,42,43,44,46,47,48,49,50,51,52,53,54,55,56,57,66,72,73,74,75,76,79,80,83,84,85,86,88,90,92,93,94,98,101,102,103,117,131,132,133,134,137,139,144,145,153,154,155,156,157,159,160,161,168,171,172,173,174,177,189,191,192,193,198,199,202,203,204,205,210,211,213,215,217,219,220,221,223,225,226,227,230,235,236,250,251,252,255,264,265,266,267,268,269,273,277,279,280,282,285,294,297,298,299,302,303,304,305,306,308,309,311,313,332,333,334,335,338,351,356,357,],[-2,47,-3,47,-6,-7,-8,-9,-10,-11,-12,-13,-174,-182,-150,-20,-83,-17,-18,-19,-92,47,-173,-100,47,-97,-98,-99,-101,-102,-103,-104,-105,-106,-107,-171,47,-141,-142,-143,-144,-145,-146,-147,-148,-149,47,-182,47,47,47,47,47,-82,-93,-100,-182,-173,-171,-15,47,47,47,47,47,47,47,-113,-115,-109,-110,-111,-112,47,-108,-175,-181,-117,-176,-172,-23,-24,-26,47,-116,-124,47,-137,47,-31,-37,-32,-14,-68,-69,47,-121,47,47,-138,47,-16,-122,47,-119,47,-100,-173,-120,-95,-123,-118,-139,47,-38,-36,-71,-72,47,-88,-140,-75,47,-77,47,-96,-114,47,47,-125,47,-35,-33,-34,-14,-70,-89,-91,-85,-87,-76,-78,-25,47,-94,-73,-74,-80,-90,-79,-81,-84,-86,]),'INT':([0,2,3,5,7,8,9,10,11,12,13,14,16,17,20,21,24,25,26,27,28,30,32,33,34,35,36,37,38,39,40,41,42,43,44,46,47,48,49,50,51,52,53,54,55,56,57,66,72,73,74,75,76,79,80,83,84,85,86,88,90,92,93,94,98,101,102,103,117,121,131,132,133,134,137,139,144,145,153,154,155,156,157,159,160,161,168,171,172,173,174,177,189,191,192,193,197,198,199,202,203,204,205,210,211,213,215,217,219,220,221,223,225,226,227,230,235,236,250,251,252,255,256,264,265,266,267,268,269,273,277,279,280,282,285,287,288,294,297,298,299,302,303,304,305,306,308,309,311,313,321,332,333,334,335,338,351,355,356,357,],[-2,48,-3,48,-6,-7,-8,-9,-10,-11,-12,-13,-174,-182,-150,-20,-83,-17,-18,-19,-92,48,-173,-100,48,-97,-98,-99,-101,-102,-103,-104,-105,-106,-107,-171,48,-141,-142,-143,-144,-145,-146,-147,-148,-149,48,-182,48,48,48,48,48,-82,-93,-100,-182,-173,-171,-15,48,48,48,48,48,48,48,-113,-115,196,-109,-110,-111,-112,48,-108,-175,-181,-117,-176,-172,-23,-24,-26,48,-116,-124,48,-137,48,-31,-37,-32,-14,-68,-69,257,48,-121,48,48,-138,48,-16,-122,48,-119,48,-100,-173,-120,-95,-123,-118,-139,48,-38,-36,-71,-72,48,-88,301,-140,-75,48,-77,48,-96,-114,48,48,-125,48,-35,48,48,-33,-34,-14,-70,-89,-91,-85,-87,-76,-78,-25,48,-94,48,-73,-74,-80,-90,-79,-81,48,-84,-86,]),'FLOAT':([0,2,3,5,7,8,9,10,11,12,13,14,16,17,20,21,24,25,26,27,28,30,32,33,34,35,36,37,38,39,40,41,42,43,44,46,47,48,49,50,51,52,53,54,55,56,57,66,72,73,74,75,76,79,80,83,84,85,86,88,90,92,93,94,98,101,102,103,117,131,132,133,134,137,139,144,145,153,154,155,156,157,159,160,161,168,171,172,173,174,177,189,191,192,193,198,199,202,203,204,205,210,211,213,215,217,219,220,221,223,225,226,227,230,235,236,250,251,252,255,264,265,266,267,268,269,273,277,279,280,282,285,287,288,294,297,298,299,302,303,304,305,306,308,309,311,313,321,332,333,334,335,338,351,355,356,357,],[-2,49,-3,49,-6,-7,-8,-9,-10,-11,-12,-13,-174,-182,-150,-20,-83,-17,-18,-19,-92,49,-173,-100,49,-97,-98,-99,-101,-102,-103,-104,-105,-106,-107,-171,49,-141,-142,-143,-144,-145,-146,-147,-148,-149,49,-182,49,49,49,49,49,-82,-93,-100,-182,-173,-171,-15,49,49,49,49,49,49,49,-113,-115,-109,-110,-111,-112,49,-108,-175,-181,-117,-176,-172,-23,-24,-26,49,-116,-124,49,-137,49,-31,-37,-32,-14,-68,-69,49,-121,49,49,-138,49,-16,-122,49,-119,49,-100,-173,-120,-95,-123,-118,-139,49,-38,-36,-71,-72,49,-88,-140,-75,49,-77,49,-96,-114,49,49,-125,49,-35,49,49,-33,-34,-14,-70,-89,-91,-85,-87,-76,-78,-25,49,-94,49,-73,-74,-80,-90,-79,-81,49,-84,-86,]),'NULL':([0,2,3,5,7,8,9,10,11,12,13,14,16,17,20,21,24,25,26,27,28,30,32,33,34,35,36,37,38,39,40,41,42,43,44,46,47,48,49,50,51,52,53,54,55,56,57,66,72,73,74,75,76,79,80,83,84,85,86,88,90,92,93,94,98,101,102,103,117,131,132,133,134,137,139,144,145,153,154,155,156,157,159,160,161,168,171,172,173,174,177,189,191,192,193,198,199,202,203,204,205,210,211,213,215,217,219,220,221,223,225,226,227,230,235,236,250,251,252,255,264,265,266,267,268,269,273,277,279,280,282,285,287,288,292,294,297,298,299,302,303,304,305,306,308,309,311,313,321,326,328,329,332,333,334,335,338,351,355,356,357,],[-2,50,-3,50,-6,-7,-8,-9,-10,-11,-12,-13,-174,-182,-150,-20,-83,-17,-18,-19,-92,50,-173,-100,50,-97,-98,-99,-101,-102,-103,-104,-105,-106,-107,-171,50,-141,-142,-143,-144,-145,-146,-147,-148,-149,50,-182,50,50,50,50,50,-82,-93,-100,-182,-173,-171,-15,50,50,50,50,50,50,50,-113,-115,-109,-110,-111,-112,50,-108,-175,-181,-117,-176,-172,-23,-24,-26,50,-116,-124,50,-137,50,-31,-37,-32,-14,-68,-69,50,-121,50,50,-138,50,-16,-122,50,-119,50,-100,-173,-120,-95,-123,-118,-139,50,-38,-36,-71,-72,50,-88,-140,-75,50,-77,50,-96,-114,50,50,-125,50,-35,50,50,331,-33,-34,-14,-70,-89,-91,-85,-87,-76,-78,-25,50,-94,50,346,348,350,-73,-74,-80,-90,-79,-81,50,-84,-86,]),'REGEX':([0,2,3,5,7,8,9,10,11,12,13,14,16,17,20,21,24,25,26,27,28,30,32,33,34,35,36,37,38,39,40,41,42,43,44,46,47,48,49,50,51,52,53,54,55,56,57,66,72,73,74,75,76,79,80,83,84,85,86,88,90,92,93,94,98,101,102,103,117,131,132,133,134,137,139,144,145,153,154,155,156,157,159,160,161,168,171,172,173,174,177,189,191,192,193,198,199,202,203,204,205,210,211,213,215,217,219,220,221,223,225,226,227,230,235,236,250,251,252,255,264,265,266,267,268,269,273,277,279,280,282,285,287,288,294,297,298,299,302,303,304,305,306,308,309,311,313,321,332,333,334,335,338,351,355,356,357,],[-2,51,-3,51,-6,-7,-8,-9,-10,-11,-12,-13,-174,-182,-150,-20,-83,-17,-18,-19,-92,51,-173,-100,51,-97,-98,-99,-101,-102,-103,-104,-105,-106,-107,-171,51,-141,-142,-143,-144,-145,-146,-147,-148,-149,51,-182,51,51,51,51,51,-82,-93,-100,-182,-173,-171,-15,51,51,51,51,51,51,51,-113,-115,-109,-110,-111,-112,51,-108,-175,-181,-117,-176,-172,-23,-24,-26,51,-116,-124,51,-137,51,-31,-37,-32,-14,-68,-69,51,-121,51,51,-138,51,-16,-122,51,-119,51,-100,-173,-120,-95,-123,-118,-139,51,-38,-36,-71,-72,51,-88,-140,-75,51,-77,51,-96,-114,51,51,-125,51,-35,51,51,-33,-34,-14,-70,-89,-91,-85,-87,-76,-78,-25,51,-94,51,-73,-74,-80,-90,-79,-81,51,-84,-86,]),'TRUE':([0,2,3,5,7,8,9,10,11,12,13,14,16,17,20,21,24,25,26,27,28,30,32,33,34,35,36,37,38,39,40,41,42,43,44,46,47,48,49,50,51,52,53,54,55,56,57,66,72,73,74,75,76,79,80,83,84,85,86,88,90,92,93,94,98,101,102,103,117,131,132,133,134,137,139,144,145,153,154,155,156,157,159,160,161,168,171,172,173,174,177,189,191,192,193,198,199,202,203,204,205,210,211,213,215,217,219,220,221,223,225,226,227,230,235,236,250,251,252,255,264,265,266,267,268,269,273,277,279,280,282,285,287,288,294,297,298,299,302,303,304,305,306,308,309,311,313,321,332,333,334,335,338,351,355,356,357,],[-2,52,-3,52,-6,-7,-8,-9,-10,-11,-12,-13,-174,-182,-150,-20,-83,-17,-18,-19,-92,52,-173,-100,52,-97,-98,-99,-101,-102,-103,-104,-105,-106,-107,-171,52,-141,-142,-143,-144,-145,-146,-147,-148,-149,52,-182,52,52,52,52,52,-82,-93,-100,-182,-173,-171,-15,52,52,52,52,52,52,52,-113,-115,-109,-110,-111,-112,52,-108,-175,-181,-117,-176,-172,-23,-24,-26,52,-116,-124,52,-137,52,-31,-37,-32,-14,-68,-69,52,-121,52,52,-138,52,-16,-122,52,-119,52,-100,-173,-120,-95,-123,-118,-139,52,-38,-36,-71,-72,52,-88,-140,-75,52,-77,52,-96,-114,52,52,-125,52,-35,52,52,-33,-34,-14,-70,-89,-91,-85,-87,-76,-78,-25,52,-94,52,-73,-74,-80,-90,-79,-81,52,-84,-86,]),'FALSE':([0,2,3,5,7,8,9,10,11,12,13,14,16,17,20,21,24,25,26,27,28,30,32,33,34,35,36,37,38,39,40,41,42,43,44,46,47,48,49,50,51,52,53,54,55,56,57,66,72,73,74,75,76,79,80,83,84,85,86,88,90,92,93,94,98,101,102,103,117,131,132,133,134,137,139,144,145,153,154,155,156,157,159,160,161,168,171,172,173,174,177,189,191,192,193,198,199,202,203,204,205,210,211,213,215,217,219,220,221,223,225,226,227,230,235,236,250,251,252,255,264,265,266,267,268,269,273,277,279,280,282,285,287,288,294,297,298,299,302,303,304,305,306,308,309,311,313,321,332,333,334,335,338,351,355,356,357,],[-2,53,-3,53,-6,-7,-8,-9,-10,-11,-12,-13,-174,-182,-150,-20,-83,-17,-18,-19,-92,53,-173,-100,53,-97,-98,-99,-101,-102,-103,-104,-105,-106,-107,-171,53,-141,-142,-143,-144,-145,-146,-147,-148,-149,53,-182,53,53,53,53,53,-82,-93,-100,-182,-173,-171,-15,53,53,53,53,53,53,53,-113,-115,-109,-110,-111,-112,53,-108,-175,-181,-117,-176,-172,-23,-24,-26,53,-116,-124,53,-137,53,-31,-37,-32,-14,-68,-69,53,-121,53,53,-138,53,-16,-122,53,-119,53,-100,-173,-120,-95,-123,-118,-139,53,-38,-36,-71,-72,53,-88,-140,-75,53,-77,53,-96,-114,53,53,-125,53,-35,53,53,-33,-34,-14,-70,-89,-91,-85,-87,-76,-78,-25,53,-94,53,-73,-74,-80,-90,-79,-81,53,-84,-86,]),'STRING':([0,2,3,5,7,8,9,10,11,12,13,14,16,17,20,21,24,25,26,27,28,30,32,33,34,35,36,37,38,39,40,41,42,43,44,46,47,48,49,50,51,52,53,54,55,56,57,58,66,72,73,74,75,76,79,80,83,84,85,86,88,90,92,93,94,98,101,102,103,117,131,132,133,134,137,139,144,145,153,154,155,156,157,159,160,161,168,171,172,173,174,177,189,191,192,193,198,199,202,203,204,205,210,211,213,215,217,219,220,221,223,225,226,227,230,235,236,250,251,252,255,264,265,266,267,268,269,273,277,279,280,282,283,285,287,288,294,297,298,299,302,303,304,305,306,308,309,311,313,321,332,333,334,335,338,351,355,356,357,],[-2,54,-3,54,-6,-7,-8,-9,-10,-11,-12,-13,-174,-182,-150,-20,-83,-17,-18,-19,-92,54,-173,-100,54,-97,-98,-99,-101,-102,-103,-104,-105,-106,-107,-171,54,-141,-142,-143,-144,-145,-146,-147,-148,-149,54,112,-182,54,54,54,54,54,-82,-93,-100,-182,-173,-171,-15,54,54,54,54,54,54,54,-113,-115,-109,-110,-111,-112,54,-108,-175,-181,-117,-176,-172,-23,-24,-26,54,-116,-124,54,-137,54,-31,-37,-32,-14,-68,-69,54,-121,54,54,-138,54,-16,-122,54,-119,54,-100,-173,-120,-95,-123,-118,-139,54,-38,-36,-71,-72,54,-88,-140,-75,54,-77,54,-96,-114,54,54,-125,54,112,-35,54,54,-33,-34,-14,-70,-89,-91,-85,-87,-76,-78,-25,54,-94,54,-73,-74,-80,-90,-79,-81,54,-84,-86,]),'FSTRING':([0,2,3,5,7,8,9,10,11,12,13,14,16,17,20,21,24,25,26,27,28,30,32,33,34,35,36,37,38,39,40,41,42,43,44,46,47,48,49,50,51,52,53,54,55,56,57,66,72,73,74,75,76,79,80,83,84,85,86,88,90,92,93,94,98,101,102,103,117,131,132,133,134,137,139,144,145,153,154,155,156,157,159,160,161,168,171,172,173,174,177,189,191,192,193,198,199,202,203,204,205,210,211,213,215,217,219,220,221,223,225,226,227,230,235,236,250,251,252,255,264,265,266,267,268,269,273,277,279,280,282,285,287,288,294,297,298,299,302,303,304,305,306,308,309,311,313,321,332,333,334,335,338,351,355,356,357,],[-2,55,-3,55,-6,-7,-8,-9,-10,-11,-12,-13,-174,-182,-150,-20,-83,-17,-18,-19,-92,55,-173,-100,55,-97,-98,-99,-101,-102,-103,-104,-105,-106,-107,-171,55,-141,-142,-143,-144,-145,-146,-147,-148,-149,55,-182,55,55,55,55,55,-82,-93,-100,-182,-173,-171,-15,55,55,55,55,55,55,55,-113,-115,-109,-110,-111,-112,55,-108,-175,-181,-117,-176,-172,-23,-24,-26,55,-116,-124,55,-137,55,-31,-37,-32,-14,-68,-69,55,-121,55,55,-138,55,-16,-122,55,-119,55,-100,-173,-120,-95,-123,-118,-139,55,-38,-36,-71,-72,55,-88,-140,-75,55,-77,55,-96,-114,55,55,-125,55,-35,55,55,-33,-34,-14,-70,-89,-91,-85,-87,-76,-78,-25,55,-94,55,-73,-74,-80,-90,-79,-81,55,-84,-86,]),'RSTRING':([0,2,3,5,7,8,9,10,11,12,13,14,16,17,20,21,24,25,26,27,28,30,32,33,34,35,36,37,38,39,40,41,42,43,44,46,47,48,49,50,51,52,53,54,55,56,57,58,66,72,73,74,75,76,79,80,83,84,85,86,88,90,92,93,94,98,101,102,103,117,131,132,133,134,137,139,144,145,153,154,155,156,157,159,160,161,168,171,172,173,174,177,189,191,192,193,198,199,202,203,204,205,210,211,213,215,217,219,220,221,223,225,226,227,230,235,236,250,251,252,255,264,265,266,267,268,269,273,277,279,280,282,283,285,287,288,294,297,298,299,302,303,304,305,306,308,309,311,313,321,332,333,334,335,338,351,355,356,357,],[-2,56,-3,56,-6,-7,-8,-9,-10,-11,-12,-13,-174,-182,-150,-20,-83,-17,-18,-19,-92,56,-173,-100,56,-97,-98,-99,-101,-102,-103,-104,-105,-106,-107,-171,56,-141,-142,-143,-144,-145,-146,-147,-148,-149,56,111,-182,56,56,56,56,56,-82,-93,-100,-182,-173,-171,-15,56,56,56,56,56,56,56,-113,-115,-109,-110,-111,-112,56,-108,-175,-181,-117,-176,-172,-23,-24,-26,56,-116,-124,56,-137,56,-31,-37,-32,-14,-68,-69,56,-121,56,56,-138,56,-16,-122,56,-119,56,-100,-173,-120,-95,-123,-118,-139,56,-38,-36,-71,-72,56,-88,-140,-75,56,-77,56,-96,-114,56,56,-125,56,111,-35,56,56,-33,-34,-14,-70,-89,-91,-85,-87,-76,-78,-25,56,-94,56,-73,-74,-80,-90,-79,-81,56,-84,-86,]),'MLS':([0,2,3,5,7,8,9,10,11,12,13,14,16,17,20,21,24,25,26,27,28,30,32,33,34,35,36,37,38,39,40,41,42,43,44,46,47,48,49,50,51,52,53,54,55,56,57,66,72,73,74,75,76,79,80,83,84,85,86,88,90,92,93,94,98,101,102,103,113,115,117,131,132,133,134,137,139,144,145,153,154,155,156,157,159,160,161,168,171,172,173,174,177,189,191,192,193,198,199,202,203,204,205,210,211,213,215,217,219,220,221,223,225,226,227,230,235,236,246,249,250,251,252,255,264,265,266,267,268,269,273,277,279,280,282,285,287,288,294,297,298,299,302,303,304,305,306,308,309,311,313,321,332,333,334,335,338,351,355,356,357,],[3,20,-3,20,-6,-7,-8,-9,-10,-11,-12,-13,-174,-182,-150,-20,79,-17,-18,-19,80,20,-173,-100,20,-97,-98,-99,-101,-102,-103,-104,-105,-106,-107,-171,20,-141,-142,-143,-144,-145,-146,-147,-148,-149,20,-182,20,20,20,20,20,-82,-93,-100,-182,-173,-171,-15,20,20,20,20,20,20,20,-113,175,175,-115,-109,-110,-111,-112,20,-108,-175,-181,-117,-176,-172,-23,-24,-26,20,-116,-124,20,-137,20,-31,-37,-32,251,-68,-69,20,-121,20,20,-138,20,-16,-122,20,-119,20,-100,-173,-120,-95,-123,-118,-139,20,-38,-36,175,175,-71,-72,20,-88,-140,-75,20,308,20,-96,-114,20,20,-125,20,-35,20,20,-33,-34,333,-70,-89,-91,-85,-87,-76,-78,-25,20,-94,20,-73,-74,351,-90,-79,-81,20,-84,-86,]),'[':([0,2,3,5,7,8,9,10,11,12,13,14,16,17,19,20,21,24,25,26,27,28,30,32,33,34,35,36,37,38,39,40,41,42,43,44,46,47,48,49,50,51,52,53,54,55,56,57,66,68,72,73,74,75,76,79,80,83,84,85,86,87,88,90,92,93,94,98,101,102,103,117,122,131,132,133,134,137,139,144,145,152,153,154,155,156,157,159,160,161,168,171,172,173,174,177,183,184,189,191,192,193,195,198,199,202,203,204,205,210,211,213,215,217,219,220,221,223,225,226,227,230,235,236,250,251,252,255,264,265,266,267,268,269,273,277,279,280,282,285,287,288,294,297,298,299,302,303,304,305,306,308,309,311,313,332,333,334,335,338,351,352,353,356,357,],[-2,57,-3,57,-6,-7,-8,-9,-10,-11,-12,-13,-174,-182,71,-150,-20,-83,-17,-18,-19,-92,57,-173,94,57,-97,-98,-99,-101,-102,-103,-104,98,-106,-107,102,57,-141,-142,-143,-144,-145,-146,-147,-148,-149,57,-182,121,57,57,57,57,57,-82,-93,94,-182,-173,102,71,-15,57,57,57,57,57,57,57,-113,-115,121,-109,-110,-111,-112,57,-108,-175,-181,-182,-117,-176,-172,-23,-24,-26,57,-116,-124,57,-137,57,-31,-37,245,-41,-32,-14,-68,-69,121,57,-121,57,57,-138,57,-16,-122,57,-119,57,94,-173,-120,-95,-123,-118,-139,57,-38,-36,-71,-72,57,-88,-140,-75,57,-77,57,-96,-114,57,57,-125,57,-35,321,321,-33,-34,-14,-70,-89,-91,-85,-87,-76,-78,-25,57,-94,-73,-74,-80,-90,-79,-81,121,121,-84,-86,]),'{':([0,2,3,5,7,8,9,10,11,12,13,14,16,17,20,21,24,25,26,27,28,30,32,33,34,35,36,37,38,39,40,41,42,43,44,46,47,48,49,50,51,52,53,54,55,56,57,66,72,73,74,75,76,79,80,83,84,85,86,88,90,92,93,94,98,101,102,103,117,131,132,133,134,137,139,144,145,153,154,155,156,157,159,160,161,168,171,172,173,174,177,189,191,192,193,198,199,202,203,204,205,210,211,213,215,217,219,220,221,223,225,226,227,230,235,236,250,251,252,255,264,265,266,267,268,269,273,277,279,280,282,285,292,294,297,298,299,302,303,304,305,306,308,309,311,313,326,328,329,332,333,334,335,338,351,356,357,],[-2,58,-3,58,-6,-7,-8,-9,-10,-11,-12,-13,-174,-182,-150,-20,-83,-17,-18,-19,-92,58,-173,-100,58,-97,-98,-99,-101,-102,-103,-104,-105,-106,-107,-171,58,-141,-142,-143,-144,-145,-146,-147,-148,-149,58,-182,58,58,58,58,58,-82,-93,-100,-182,-173,-171,-15,58,58,58,58,58,58,58,-113,-115,-109,-110,-111,-112,58,-108,-175,-181,-117,-176,-172,-23,-24,-26,58,-116,-124,58,-137,58,-31,-37,-32,-14,-68,-69,58,-121,58,58,-138,58,-16,-122,58,-119,58,-100,-173,-120,-95,-123,-118,-139,58,-38,-36,-71,-72,58,-88,-140,-75,58,-77,58,-96,-114,58,58,-125,58,-35,58,-33,-34,-14,-70,-89,-91,-85,-87,-76,-78,-25,58,-94,58,58,58,-73,-74,-80,-90,-79,-81,-84,-86,]),'$end':([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,16,17,20,21,24,25,26,27,28,32,33,35,36,37,38,39,40,41,42,43,44,46,48,49,50,51,52,53,54,55,56,59,66,79,80,83,84,85,86,88,103,117,131,132,133,134,139,144,145,153,154,155,156,157,159,161,168,172,174,177,189,191,192,193,199,204,210,211,215,221,223,225,226,227,235,236,250,251,255,264,265,269,273,280,285,294,297,298,299,302,303,304,305,306,309,313,332,333,334,335,338,351,356,357,],[-2,0,-14,-3,-1,-14,-5,-6,-7,-8,-9,-10,-11,-12,-13,-174,-182,-150,-20,-83,-17,-18,-19,-92,-173,-100,-97,-98,-99,-101,-102,-103,-104,-105,-106,-107,-171,-141,-142,-143,-144,-145,-146,-147,-148,-149,-4,-182,-82,-93,-100,-182,-173,-171,-15,-113,-115,-109,-110,-111,-112,-108,-175,-181,-117,-176,-172,-23,-24,-26,-116,-124,-137,-31,-37,-32,-14,-68,-69,-121,-138,-16,-122,-119,-120,-95,-123,-118,-139,-38,-36,-71,-72,-88,-140,-75,-96,-114,-125,-35,-33,-34,-14,-70,-89,-91,-85,-87,-76,-25,-94,-73,-74,-80,-90,-79,-81,-84,-86,]),'.':([16,17,19,32,33,46,64,65,66,67,83,84,85,86,144,145,152,154,155,187,188,194,219,220,304,305,],[-174,-182,69,-173,91,-171,-173,119,-182,-171,140,-182,-173,-171,-175,-181,-182,-176,-172,119,-173,-172,140,-173,336,337,]),'USING':([16,63,144,154,],[-174,118,-175,-176,]),',':([16,20,35,36,37,38,39,40,41,42,43,44,48,49,50,51,52,53,54,55,56,66,67,83,84,85,86,103,105,106,117,125,128,131,132,133,134,139,144,145,148,150,151,152,153,154,155,161,168,172,186,187,188,191,192,193,194,199,204,209,211,215,221,225,226,227,233,262,263,264,273,280,299,344,],[-174,-150,-97,-98,-99,-101,-102,-103,-104,-105,-106,-107,-141,-142,-143,-144,-145,-146,-147,-148,-149,-182,-171,-100,-182,-173,-171,-113,-117,171,-115,201,-157,-109,-110,-111,-112,-108,-175,-181,213,-162,-163,-182,-117,-176,-172,-116,-124,-137,247,248,-173,253,-68,-69,-172,-121,-138,270,-122,-119,-120,-123,-118,-139,283,-156,-155,-140,-114,-125,253,355,]),':':([16,20,35,36,37,38,39,40,41,42,43,44,48,49,50,51,52,53,54,55,56,60,61,66,67,83,84,85,86,96,103,108,111,112,117,121,131,132,133,134,135,139,144,145,153,154,155,161,168,172,185,186,187,188,190,194,196,199,204,206,207,211,215,221,225,226,227,264,273,276,280,295,296,],[-174,-150,-97,-98,-99,-101,-102,-103,-104,-105,-106,-107,-141,-142,-143,-144,-145,-146,-147,-148,-149,113,115,-182,-171,-100,-182,-173,-171,160,-113,173,-131,-132,-115,197,-109,-110,-111,-112,205,-108,-175,-181,-117,-176,-172,-116,-124,-137,246,-179,-180,-173,249,-172,256,-121,-138,267,268,-122,-119,-120,-123,-118,-139,-140,-114,311,-125,-177,-178,]),'SEP':([17,32,64,66,84,85,88,145,152,184,188,192,220,222,],[-182,89,89,-182,-182,141,143,-181,-182,143,89,143,141,143,]),'=':([17,32,33,46,84,127,145,152,155,219,220,238,239,242,289,290,291,],[-182,-173,92,-171,-182,202,-181,202,-172,92,-173,287,288,292,326,328,329,]),'PEQ':([17,32,33,46,84,145,155,219,220,],[-182,-173,93,-171,-182,-181,-172,93,-173,]),'CMP_OP':([17,20,21,32,33,35,36,37,38,39,40,41,42,43,44,46,48,49,50,51,52,53,54,55,56,82,83,84,85,86,96,103,105,117,131,132,133,134,135,139,145,152,153,155,161,168,172,199,204,211,215,219,220,221,225,226,227,264,273,280,281,298,313,315,],[-182,-150,72,-173,-100,-97,-98,-99,-101,-102,-103,-104,-105,-106,-107,-171,-141,-142,-143,-144,-145,-146,-147,-148,-149,72,-100,-182,-173,-171,72,-113,72,-115,-109,-110,72,72,72,-108,-181,-182,72,-172,-116,-124,-137,-121,-138,-122,-119,-100,-173,-120,-123,-118,-139,72,-114,-125,72,72,72,72,]),'IN':([17,20,21,32,33,35,36,37,38,39,40,41,42,43,44,46,48,49,50,51,52,53,54,55,56,78,82,83,84,85,86,96,103,105,117,131,132,133,134,135,139,145,152,153,155,161,168,172,199,204,211,215,219,220,221,225,226,227,231,264,273,280,281,298,313,315,],[-182,-150,73,-173,-100,-97,-98,-99,-101,-102,-103,-104,-105,-106,-107,-171,-141,-142,-143,-144,-145,-146,-147,-148,-149,137,73,-100,-182,-173,-171,73,73,73,-115,73,-110,73,73,73,-108,-181,-182,73,-172,-116,-124,-137,-121,-138,-122,-119,-100,-173,-120,-123,-118,-139,282,73,-114,-125,73,73,73,73,]),'AND':([17,20,21,32,33,35,36,37,38,39,40,41,42,43,44,46,48,49,50,51,52,53,54,55,56,82,83,84,85,86,96,103,105,117,131,132,133,134,135,139,145,152,153,155,161,168,172,199,204,211,215,219,220,221,225,226,227,264,273,280,281,298,313,315,],[-182,-150,74,-173,-100,-97,-98,-99,-101,-102,-103,-104,-105,-106,-107,-171,-141,-142,-143,-144,-145,-146,-147,-148,-149,74,-100,-182,-173,-171,74,-113,74,-115,-109,-110,-111,74,74,-108,-181,-182,74,-172,-116,-124,-137,-121,-138,-122,-119,-100,-173,-120,-123,-118,-139,74,-114,-125,74,74,74,74,]),'OR':([17,20,21,32,33,35,36,37,38,39,40,41,42,43,44,46,48,49,50,51,52,53,54,55,56,82,83,84,85,86,96,103,105,117,131,132,133,134,135,139,145,152,153,155,161,168,172,199,204,211,215,219,220,221,225,226,227,264,273,280,281,298,313,315,],[-182,-150,75,-173,-100,-97,-98,-99,-101,-102,-103,-104,-105,-106,-107,-171,-141,-142,-143,-144,-145,-146,-147,-148,-149,75,-100,-182,-173,-171,75,-113,75,-115,-109,-110,-111,-112,75,-108,-181,-182,75,-172,-116,-124,-137,-121,-138,-122,-119,-100,-173,-120,-123,-118,-139,75,-114,-125,75,75,75,75,]),'?':([17,20,21,32,33,35,36,37,38,39,40,41,42,43,44,46,48,49,50,51,52,53,54,55,56,66,82,83,84,85,86,96,103,105,117,131,132,133,134,135,139,145,152,153,155,161,168,172,180,182,183,184,199,204,211,215,219,220,221,225,226,227,264,273,280,281,293,298,313,315,],[-182,-150,76,-173,-100,-97,-98,-99,-101,-102,-103,-104,-105,-106,-107,-171,-141,-142,-143,-144,-145,-146,-147,-148,-149,-182,76,-100,-182,-173,-171,76,-113,76,-115,-109,-110,-111,-112,76,-108,-181,-182,76,-172,-116,-124,-137,241,243,244,-41,-121,-138,-122,-119,-100,-173,-120,-123,-118,-139,76,-114,-125,76,-42,76,76,76,]),'IS':([17,42,84,152,155,215,221,226,],[62,97,62,62,214,-119,-120,-118,]),')':([20,35,36,37,38,39,40,41,42,43,44,48,49,50,51,52,53,54,55,56,70,82,83,84,85,86,90,101,103,117,123,124,125,126,128,131,132,133,134,139,145,146,147,148,149,150,151,152,153,155,161,165,168,172,199,200,201,204,208,209,211,212,213,215,221,225,226,227,260,261,262,263,264,271,272,273,280,310,],[-150,-97,-98,-99,-101,-102,-103,-104,-105,-106,-107,-141,-142,-143,-144,-145,-146,-147,-148,-149,-14,139,-100,-182,-173,-171,-14,-14,-113,-115,199,-158,-14,-159,-157,-109,-110,-111,-112,-108,-181,211,-164,-14,-165,-162,-163,-182,-117,-172,-116,225,-124,-137,-121,-14,-14,-138,269,-184,-122,-14,-14,-119,-120,-123,-118,-139,-160,-161,-156,-155,-140,-166,-167,-114,-125,-183,]),']':([20,35,36,37,38,39,40,41,42,43,44,48,49,50,51,52,53,54,55,56,57,71,83,84,85,86,102,103,104,105,106,117,124,125,126,128,130,131,132,133,134,139,145,152,153,155,158,161,162,166,167,168,169,171,172,196,199,200,201,204,211,215,221,225,226,227,228,229,232,245,256,257,260,261,262,263,264,273,280,281,301,314,315,321,340,341,342,343,344,355,358,],[-150,-97,-98,-99,-101,-102,-103,-104,-105,-106,-107,-141,-142,-143,-144,-145,-146,-147,-148,-149,-170,-14,-100,-182,-173,-171,-14,-113,168,-117,-169,-115,-158,-14,-159,-157,204,-109,-110,-111,-112,-108,-181,-182,-117,-172,215,-116,221,226,227,-124,-14,-170,-137,255,-121,-14,-14,-138,-122,-119,-120,-123,-118,-139,280,-129,-168,293,302,303,-160,-161,-156,-155,-140,-114,-125,-14,335,-130,-14,-153,-127,-128,-126,354,-152,-153,-154,]),'ELSE':([20,21,25,26,27,35,36,37,38,39,40,41,42,43,44,46,48,49,50,51,52,53,54,55,56,83,84,85,86,103,117,131,132,133,134,139,145,153,155,156,157,159,160,161,168,172,199,204,211,215,216,217,218,219,220,221,225,226,227,264,273,278,280,309,338,],[-150,-20,-17,-18,-19,-97,-98,-99,-101,-102,-103,-104,-105,-106,-107,-171,-141,-142,-143,-144,-145,-146,-147,-148,-149,-100,-182,-173,-171,-113,-115,-109,-110,-111,-112,-108,-181,-117,-172,-23,-24,-26,-14,-116,-124,-137,-121,-138,-122,-119,276,-14,-22,-100,-173,-120,-123,-118,-139,-140,-114,-21,-125,-25,-79,]),'ELIF':([20,21,25,26,27,35,36,37,38,39,40,41,42,43,44,46,48,49,50,51,52,53,54,55,56,83,84,85,86,103,117,131,132,133,134,139,145,153,155,156,157,159,160,161,168,172,199,204,211,215,216,217,218,219,220,221,225,226,227,264,273,278,280,309,338,],[-150,-20,-17,-18,-19,-97,-98,-99,-101,-102,-103,-104,-105,-106,-107,-171,-141,-142,-143,-144,-145,-146,-147,-148,-149,-100,-182,-173,-171,-113,-115,-109,-110,-111,-112,-108,-181,-117,-172,-23,-24,-26,-14,-116,-124,-137,-121,-138,-122,-119,277,-14,-22,-100,-173,-120,-123,-118,-139,-140,-114,-21,-125,-25,-79,]),'END':([20,21,25,26,27,35,36,37,38,39,40,41,42,43,44,46,48,49,50,51,52,53,54,55,56,83,84,85,86,95,103,113,115,117,131,132,133,134,139,145,153,155,156,157,159,160,161,168,172,175,176,178,199,204,211,215,216,217,218,219,220,221,225,226,227,234,237,238,239,242,246,249,264,266,267,268,273,274,275,278,280,286,289,290,291,307,308,309,311,312,318,319,320,322,323,324,325,327,330,331,338,339,345,346,347,348,349,350,354,],[-150,-20,-17,-18,-19,-97,-98,-99,-101,-102,-103,-104,-105,-106,-107,-171,-141,-142,-143,-144,-145,-146,-147,-148,-149,-100,-182,-173,-171,159,-113,177,177,-115,-109,-110,-111,-112,-108,-181,-117,-172,-23,-24,-26,-14,-116,-124,-137,235,236,-40,-121,-138,-122,-119,-14,-14,-22,-100,-173,-120,-123,-118,-139,285,-39,-14,-52,-62,177,177,-140,-14,-77,-14,-114,-27,-28,-21,-125,-48,-14,-14,-65,338,-78,-25,-14,-30,-49,-50,-51,-53,-54,-55,-56,-59,-63,-64,-79,-29,-57,-58,-60,-61,-66,-67,-151,]),'}':([20,35,36,37,38,39,40,41,42,43,44,48,49,50,51,52,53,54,55,56,58,83,84,85,86,103,107,109,110,117,131,132,133,134,139,145,153,155,161,168,172,199,204,211,215,221,225,226,227,233,264,273,280,283,284,316,317,],[-150,-97,-98,-99,-101,-102,-103,-104,-105,-106,-107,-141,-142,-143,-144,-145,-146,-147,-148,-149,-14,-100,-182,-173,-171,-113,172,-136,-135,-115,-109,-110,-111,-112,-108,-181,-117,-172,-116,-124,-137,-121,-138,-122,-119,-120,-123,-118,-139,-14,-140,-114,-125,-14,-14,-133,-134,]),'DICT':([20,48,49,50,51,52,53,54,55,56,113,115,172,175,176,178,234,237,238,239,242,246,249,286,289,290,291,318,319,320,322,323,324,325,327,330,331,345,346,347,348,349,350,354,],[-150,-141,-142,-143,-144,-145,-146,-147,-148,-149,180,180,-137,180,180,-40,180,-39,-14,-52,-62,180,180,-48,-14,-14,-65,-49,-50,-51,-53,-54,-55,-56,-59,-63,-64,-57,-58,-60,-61,-66,-67,-151,]),'EXTENDS':([60,61,],[114,116,]),'DEFINED':([62,97,214,],[117,161,273,]),'AS':([66,88,99,100,145,],[-182,142,163,164,-181,]),'WHEN':([66,145,191,192,193,299,],[-182,-181,252,-68,-69,-70,]),'MATCHING':([66,145,222,],[-182,-181,279,]),'*':([70,71,90,101,102,129,201,213,],[129,129,129,129,129,203,129,129,]),'PARENTS':([118,253,],[193,193,]),'REL':([120,198,255,302,303,335,],[195,258,-88,-89,-91,-90,]),'UNDEF':([287,288,],[320,324,]),}
 
 _lr_action = {}
 for _k, _v in _lr_action_items.items():
    for _x,_y in zip(_v[0],_v[1]):
       if not _x in _lr_action:  _lr_action[_x] = {}
       _lr_action[_x][_k] = _y
 del _lr_action_items
 
-_lr_goto_items = {'main':([0,],[1,]),'head':([0,],[2,]),'body':([2,5,],[4,57,]),'top_stmt':([2,5,],[5,5,]),'empty':([2,5,56,68,69,88,99,100,123,146,157,175,186,195,196,207,208,211,212,224,229,257,259,271,272,277,278,286,299,],[6,6,107,124,124,147,147,124,195,207,213,231,241,124,124,147,147,266,213,272,274,213,213,107,107,311,313,318,213,]),'entity_def':([2,5,],[7,7,]),'implement_def':([2,5,],[8,8,]),'implementation_def':([2,5,],[9,9,]),'relation':([2,5,],[10,10,]),'statement':([2,5,157,212,257,259,299,],[11,11,212,212,212,212,212,]),'typedef':([2,5,],[12,12,]),'index':([2,5,],[13,13,]),'import':([2,5,],[14,14,]),'class_ref':([2,5,18,29,30,34,46,55,70,71,72,73,74,88,90,91,92,96,99,100,112,114,134,135,157,161,166,168,193,197,198,200,208,212,238,239,243,245,249,250,257,259,268,270,299,],[19,19,61,79,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,181,181,201,85,85,219,85,85,85,85,85,85,85,85,181,181,85,288,292,293,85,85,85,85,85,]),'expression':([2,5,30,34,46,55,70,71,72,73,74,88,90,91,92,96,99,100,135,157,166,168,193,197,198,200,208,212,243,257,259,268,270,299,],[21,21,80,94,101,104,129,130,131,132,133,104,104,104,104,104,104,104,104,21,104,104,104,104,104,255,104,21,286,21,21,94,301,21,]),'relation_def':([2,5,],[24,24,]),'assign':([2,5,157,212,257,259,299,],[25,25,25,25,25,25,25,]),'for':([2,5,157,212,257,259,299,],[26,26,26,26,26,26,26,]),'if':([2,5,157,212,257,259,299,],[27,27,27,27,27,27,27,]),'typedef_inner':([2,5,],[28,28,]),'ns_ref':([2,5,18,29,30,31,34,46,55,70,71,72,73,74,88,90,91,92,96,99,100,111,112,113,114,116,134,135,157,160,161,166,168,170,171,193,197,198,200,208,212,225,237,238,239,240,243,244,245,249,250,257,259,268,270,299,],[32,32,62,62,83,86,83,83,83,83,83,83,83,83,83,83,83,83,83,83,83,179,183,179,183,187,62,83,215,217,62,83,83,179,179,83,83,83,83,83,215,179,179,183,183,179,83,187,62,62,62,215,215,83,83,215,]),'var_ref':([2,5,18,29,30,34,46,55,70,71,72,73,74,88,90,91,92,96,99,100,112,114,134,135,157,161,166,168,193,197,198,200,208,212,238,239,243,245,249,250,257,259,268,270,299,],[33,33,63,63,81,81,81,81,81,81,81,81,81,81,81,81,81,81,81,81,182,182,63,81,214,63,81,81,81,81,81,81,81,214,182,182,81,63,63,63,214,214,81,81,214,]),'boolean_expression':([2,5,30,34,46,55,70,71,72,73,74,88,90,91,92,96,99,100,135,157,166,168,193,197,198,200,208,212,243,257,259,268,270,299,],[35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,]),'constant':([2,5,30,34,46,55,70,71,72,73,74,88,90,91,92,96,99,100,135,157,166,168,193,197,198,200,208,212,243,257,259,268,270,275,276,299,307,338,],[36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,304,308,36,327,327,]),'function_call':([2,5,30,34,46,55,70,71,72,73,74,88,90,91,92,96,99,100,135,157,166,168,193,197,198,200,208,212,243,257,259,268,270,299,],[37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,]),'constructor':([2,5,30,34,46,55,70,71,72,73,74,88,90,91,92,96,99,100,135,157,161,166,168,193,197,198,200,208,212,243,257,259,268,270,299,],[38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,218,38,38,38,38,38,38,38,38,38,38,38,38,38,38,]),'list_def':([2,5,30,34,46,55,70,71,72,73,74,88,90,91,92,96,99,100,135,157,166,168,193,197,198,200,208,212,243,257,259,268,270,299,],[39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,]),'map_def':([2,5,30,34,46,55,70,71,72,73,74,88,90,91,92,96,99,100,135,157,166,168,193,197,198,200,208,212,243,257,259,268,270,280,299,312,314,315,],[40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,316,40,328,330,332,]),'map_lookup':([2,5,30,34,46,55,70,71,72,73,74,88,90,91,92,96,99,100,135,157,166,168,193,197,198,200,208,212,243,257,259,268,270,299,],[41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,]),'index_lookup':([2,5,30,34,46,55,70,71,72,73,74,88,90,91,92,96,99,100,135,157,166,168,193,197,198,200,208,212,243,257,259,268,270,299,],[42,42,42,42,42,42,42,42,42,42,42,42,42,42,42,42,42,42,42,42,42,42,42,42,42,42,42,42,42,42,42,42,42,42,]),'conditional_expression':([2,5,30,34,46,55,70,71,72,73,74,88,90,91,92,96,99,100,135,157,166,168,193,197,198,200,208,212,243,257,259,268,270,299,],[43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,]),'attr_ref':([2,5,18,29,30,34,46,55,70,71,72,73,74,88,90,91,92,96,99,100,112,114,134,135,157,161,166,168,193,197,198,200,208,212,238,239,243,245,249,250,257,259,268,270,299,],[45,45,65,65,84,84,84,84,84,84,84,84,84,84,84,84,84,84,84,84,65,65,65,84,45,65,84,84,84,84,84,84,84,45,65,65,84,65,65,65,45,45,84,84,45,]),'if_body':([34,268,],[93,300,]),'operand_list':([55,166,193,],[102,223,250,]),'operand':([55,88,90,91,92,96,99,100,135,166,168,193,197,198,208,],[103,149,153,154,155,159,149,163,202,103,224,103,253,254,149,]),'pair_list':([56,271,],[105,302,]),'dict_key':([56,271,],[106,106,]),'pair_list_empty':([56,271,272,],[108,108,303,]),'multi':([66,120,190,335,336,],[118,193,245,339,340,]),'param_list':([68,69,100,196,],[121,128,164,252,]),'param_list_empty':([68,69,100,195,196,],[122,122,122,251,122,]),'param_list_element':([68,69,88,99,100,196,208,],[123,123,148,148,123,123,148,]),'wrapped_kwargs':([68,69,88,99,100,196,208,],[126,126,126,126,126,126,126,]),'function_param_list':([88,99,208,],[144,162,263,]),'function_param_list_empty':([88,99,207,208,],[145,145,262,145,]),'function_param_list_element':([88,99,208,],[146,146,146,]),'entity_body_outer':([111,113,237,240,],[169,184,282,285,]),'entity_body':([111,113,170,237,240,],[171,171,225,171,171,]),'attr':([111,113,170,171,225,237,240,],[173,173,173,228,228,173,173,]),'attr_type':([111,113,170,171,225,237,240,],[174,174,174,174,174,174,174,]),'attr_type_opt':([111,113,170,171,225,237,240,],[176,176,176,176,176,176,176,]),'attr_type_multi':([111,113,170,171,225,237,240,],[177,177,177,177,177,177,177,]),'attr_base_type':([111,113,170,171,225,237,240,],[178,178,178,178,178,178,178,]),'class_ref_list':([112,114,238,239,],[180,185,283,284,]),'implement_ns_list':([116,244,],[186,287,]),'id_list':([136,261,],[203,298,]),'stmt_list':([157,212,257,259,299,],[211,269,295,295,325,]),'implementation':([201,],[256,]),'implementation_head':([201,],[257,]),'if_next':([211,],[265,]),'block':([257,259,],[294,297,]),'constant_list':([275,276,],[305,309,]),'constants':([307,338,],[326,341,]),}
+_lr_goto_items = {'main':([0,],[1,]),'head':([0,],[2,]),'body':([2,5,],[4,59,]),'top_stmt':([2,5,],[5,5,]),'empty':([2,5,58,70,71,90,101,102,125,148,160,169,180,191,200,201,212,213,216,217,233,238,266,268,281,283,284,289,290,298,311,315,],[6,6,109,126,126,149,149,126,200,212,218,229,240,250,126,126,149,149,275,218,284,286,218,218,229,109,109,325,327,332,218,342,]),'entity_def':([2,5,],[7,7,]),'implement_def':([2,5,],[8,8,]),'implementation_def':([2,5,],[9,9,]),'relation':([2,5,],[10,10,]),'statement':([2,5,160,217,266,268,311,],[11,11,217,217,217,217,217,]),'typedef':([2,5,],[12,12,]),'index':([2,5,],[13,13,]),'import':([2,5,],[14,14,]),'class_ref':([2,5,18,29,30,34,47,57,72,73,74,75,76,90,92,93,94,98,101,102,114,116,136,137,160,164,171,173,198,202,203,205,213,217,230,247,248,252,254,258,259,266,268,277,279,282,311,],[19,19,63,81,87,87,87,87,87,87,87,87,87,87,87,87,87,87,87,87,186,186,206,87,87,224,87,87,87,87,87,87,87,87,87,186,186,87,300,304,305,87,87,87,87,87,87,]),'expression':([2,5,30,34,47,57,72,73,74,75,76,90,92,93,94,98,101,102,137,160,171,173,198,202,203,205,213,217,230,252,266,268,277,279,282,311,],[21,21,82,96,103,105,131,132,133,134,135,153,153,153,153,153,153,153,153,21,153,153,153,153,153,264,153,21,281,298,21,21,96,313,315,21,]),'relation_def':([2,5,],[24,24,]),'assign':([2,5,160,217,266,268,311,],[25,25,25,25,25,25,25,]),'for':([2,5,160,217,266,268,311,],[26,26,26,26,26,26,26,]),'if':([2,5,160,217,266,268,311,],[27,27,27,27,27,27,27,]),'typedef_inner':([2,5,],[28,28,]),'ns_ref':([2,5,18,29,30,31,34,47,57,72,73,74,75,76,90,92,93,94,98,101,102,113,114,115,116,118,136,137,160,163,164,171,173,175,176,198,202,203,205,213,217,230,234,246,247,248,249,252,253,254,258,259,266,268,277,279,282,311,],[32,32,64,64,85,88,85,85,85,85,85,85,85,85,85,85,85,85,85,85,85,184,188,184,188,192,64,85,220,222,64,85,85,184,184,85,85,85,85,85,220,85,184,184,188,188,184,85,192,64,64,64,220,220,85,85,85,220,]),'var_ref':([2,5,18,29,30,34,47,57,72,73,74,75,76,90,92,93,94,98,101,102,114,116,136,137,160,164,171,173,198,202,203,205,213,217,230,247,248,252,254,258,259,266,268,277,279,282,311,],[33,33,65,65,83,83,83,83,83,83,83,83,83,83,83,83,83,83,83,83,187,187,65,83,219,65,83,83,83,83,83,83,83,219,83,187,187,83,65,65,65,219,219,83,83,83,219,]),'boolean_expression':([2,5,30,34,47,57,72,73,74,75,76,90,92,93,94,98,101,102,137,160,171,173,198,202,203,205,213,217,230,252,266,268,277,279,282,311,],[35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,]),'constant':([2,5,30,34,47,57,72,73,74,75,76,90,92,93,94,98,101,102,137,160,171,173,198,202,203,205,213,217,230,252,266,268,277,279,282,287,288,311,321,355,],[36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,318,322,36,344,344,]),'function_call':([2,5,30,34,47,57,72,73,74,75,76,90,92,93,94,98,101,102,137,160,171,173,198,202,203,205,213,217,230,252,266,268,277,279,282,311,],[37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,]),'constructor':([2,5,30,34,47,57,72,73,74,75,76,90,92,93,94,98,101,102,137,160,164,171,173,198,202,203,205,213,217,230,252,266,268,277,279,282,311,],[38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,223,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,]),'list_def':([2,5,30,34,47,57,72,73,74,75,76,90,92,93,94,98,101,102,137,160,171,173,198,202,203,205,213,217,230,252,266,268,277,279,282,311,],[39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,]),'list_comprehension':([2,5,30,34,47,57,72,73,74,75,76,90,92,93,94,98,101,102,137,160,171,173,198,202,203,205,213,217,230,252,266,268,277,279,282,311,],[40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,]),'map_def':([2,5,30,34,47,57,72,73,74,75,76,90,92,93,94,98,101,102,137,160,171,173,198,202,203,205,213,217,230,252,266,268,277,279,282,292,311,326,328,329,],[41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,330,41,345,347,349,]),'map_lookup':([2,5,30,34,47,57,72,73,74,75,76,90,92,93,94,98,101,102,137,160,171,173,198,202,203,205,213,217,230,252,266,268,277,279,282,311,],[42,42,42,42,42,42,42,42,42,42,42,42,42,42,42,42,42,42,42,42,42,42,42,42,42,42,42,42,42,42,42,42,42,42,42,42,]),'index_lookup':([2,5,30,34,47,57,72,73,74,75,76,90,92,93,94,98,101,102,137,160,171,173,198,202,203,205,213,217,230,252,266,268,277,279,282,311,],[43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,]),'conditional_expression':([2,5,30,34,47,57,72,73,74,75,76,90,92,93,94,98,101,102,137,160,171,173,198,202,203,205,213,217,230,252,266,268,277,279,282,311,],[44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,44,]),'attr_ref':([2,5,18,29,30,34,47,57,72,73,74,75,76,90,92,93,94,98,101,102,114,116,136,137,160,164,171,173,198,202,203,205,213,217,230,247,248,252,254,258,259,266,268,277,279,282,311,],[46,46,67,67,86,86,86,86,86,86,86,86,86,86,86,86,86,86,86,86,67,67,67,86,46,67,86,86,86,86,86,86,86,46,86,67,67,86,67,67,67,46,46,86,86,86,46,]),'if_body':([34,277,],[95,312,]),'operand_list':([57,171,198,],[104,232,259,]),'operand':([57,90,92,93,94,98,101,102,137,171,173,198,202,203,213,],[106,151,156,157,158,162,151,166,207,106,233,106,262,263,151,]),'pair_list':([58,283,],[107,316,]),'dict_key':([58,283,],[108,108,]),'pair_list_empty':([58,283,284,],[110,110,317,]),'multi':([68,122,195,352,353,],[120,198,254,356,357,]),'param_list':([70,71,102,201,],[123,130,167,261,]),'param_list_empty':([70,71,102,200,201,],[124,124,124,260,124,]),'param_list_element':([70,71,90,101,102,201,213,],[125,125,150,150,125,125,150,]),'wrapped_kwargs':([70,71,90,101,102,201,213,],[128,128,128,128,128,128,128,]),'function_param_list':([90,101,213,],[146,165,272,]),'function_param_list_empty':([90,101,212,213,],[147,147,271,147,]),'function_param_list_element':([90,101,213,],[148,148,148,]),'list_comprehension_for':([105,315,],[169,341,]),'entity_body_outer':([113,115,246,249,],[174,189,294,297,]),'entity_body':([113,115,175,246,249,],[176,176,234,176,176,]),'attr':([113,115,175,176,234,246,249,],[178,178,178,237,237,178,178,]),'attr_type':([113,115,175,176,234,246,249,],[179,179,179,179,179,179,179,]),'attr_type_opt':([113,115,175,176,234,246,249,],[181,181,181,181,181,181,181,]),'attr_type_multi':([113,115,175,176,234,246,249,],[182,182,182,182,182,182,182,]),'attr_base_type':([113,115,175,176,234,246,249,],[183,183,183,183,183,183,183,]),'class_ref_list':([114,116,247,248,],[185,190,295,296,]),'implement_ns_list':([118,253,],[191,299,]),'id_list':([138,270,],[208,310,]),'stmt_list':([160,217,266,268,311,],[216,278,307,307,339,]),'list_comprehension_guard':([169,281,],[228,314,]),'implementation':([206,],[265,]),'implementation_head':([206,],[266,]),'if_next':([216,],[274,]),'block':([266,268,],[306,309,]),'constant_list':([287,288,],[319,323,]),'list_comprehension_for_empty':([315,],[340,]),'constants':([321,355,],[343,358,]),}
 
 _lr_goto = {}
 for _k, _v in _lr_goto_items.items():
    for _x, _y in zip(_v[0], _v[1]):
        if not _x in _lr_goto: _lr_goto[_x] = {}
        _lr_goto[_x][_k] = _y
 del _lr_goto_items
 _lr_productions = [
   ("S' -> main","S'",1,None,None,None),
-  ('main -> head body','main',2,'p_main','plyInmantaParser.py',116),
-  ('head -> <empty>','head',0,'p_main_head','plyInmantaParser.py',124),
-  ('head -> MLS','head',1,'p_main_head_doc','plyInmantaParser.py',129),
-  ('body -> top_stmt body','body',2,'p_body_collect','plyInmantaParser.py',134),
-  ('body -> empty','body',1,'p_body_term','plyInmantaParser.py',141),
-  ('top_stmt -> entity_def','top_stmt',1,'p_top_stmt','plyInmantaParser.py',146),
-  ('top_stmt -> implement_def','top_stmt',1,'p_top_stmt','plyInmantaParser.py',147),
-  ('top_stmt -> implementation_def','top_stmt',1,'p_top_stmt','plyInmantaParser.py',148),
-  ('top_stmt -> relation','top_stmt',1,'p_top_stmt','plyInmantaParser.py',149),
-  ('top_stmt -> statement','top_stmt',1,'p_top_stmt','plyInmantaParser.py',150),
-  ('top_stmt -> typedef','top_stmt',1,'p_top_stmt','plyInmantaParser.py',151),
-  ('top_stmt -> index','top_stmt',1,'p_top_stmt','plyInmantaParser.py',152),
-  ('top_stmt -> import','top_stmt',1,'p_top_stmt','plyInmantaParser.py',153),
-  ('empty -> <empty>','empty',0,'p_empty','plyInmantaParser.py',158),
-  ('import -> IMPORT ns_ref','import',2,'p_import','plyInmantaParser.py',168),
-  ('import -> IMPORT ns_ref AS ID','import',4,'p_import_1','plyInmantaParser.py',174),
-  ('statement -> assign','statement',1,'p_stmt','plyInmantaParser.py',185),
-  ('statement -> for','statement',1,'p_stmt','plyInmantaParser.py',186),
-  ('statement -> if','statement',1,'p_stmt','plyInmantaParser.py',187),
-  ('statement -> expression','statement',1,'p_stmt','plyInmantaParser.py',188),
-  ('stmt_list -> statement stmt_list','stmt_list',2,'p_stmt_list_collect','plyInmantaParser.py',202),
-  ('stmt_list -> empty','stmt_list',1,'p_stmt_list_empty','plyInmantaParser.py',209),
-  ('assign -> var_ref = operand','assign',3,'p_assign','plyInmantaParser.py',214),
-  ('assign -> var_ref PEQ operand','assign',3,'p_assign_extend','plyInmantaParser.py',220),
-  ('for -> FOR ID IN operand : block','for',6,'p_for','plyInmantaParser.py',226),
-  ('if -> IF if_body END','if',3,'p_if_start','plyInmantaParser.py',233),
-  ('if_body -> expression : stmt_list if_next','if_body',4,'p_if_body','plyInmantaParser.py',239),
-  ('if_next -> empty','if_next',1,'p_if_end','plyInmantaParser.py',246),
-  ('if_next -> ELSE : stmt_list','if_next',3,'p_if_else','plyInmantaParser.py',252),
-  ('if_next -> ELIF if_body','if_next',2,'p_if_elif','plyInmantaParser.py',258),
-  ('entity_def -> ENTITY CID : entity_body_outer','entity_def',4,'p_entity','plyInmantaParser.py',270),
-  ('entity_def -> ENTITY ID : entity_body_outer','entity_def',4,'p_entity_err_1','plyInmantaParser.py',277),
-  ('entity_def -> ENTITY CID EXTENDS class_ref_list : entity_body_outer','entity_def',6,'p_entity_extends','plyInmantaParser.py',282),
-  ('entity_def -> ENTITY ID EXTENDS class_ref_list : entity_body_outer','entity_def',6,'p_entity_extends_err','plyInmantaParser.py',289),
-  ('entity_body_outer -> MLS entity_body END','entity_body_outer',3,'p_entity_body_outer','plyInmantaParser.py',294),
-  ('entity_body_outer -> entity_body END','entity_body_outer',2,'p_entity_body_outer_1','plyInmantaParser.py',299),
-  ('entity_body_outer -> END','entity_body_outer',1,'p_entity_body_outer_none','plyInmantaParser.py',304),
-  ('entity_body_outer -> MLS END','entity_body_outer',2,'p_entity_body_outer_4','plyInmantaParser.py',309),
-  ('entity_body -> entity_body attr','entity_body',2,'p_entity_body_collect','plyInmantaParser.py',314),
-  ('entity_body -> attr','entity_body',1,'p_entity_body','plyInmantaParser.py',320),
-  ('attr_base_type -> ns_ref','attr_base_type',1,'p_attribute_base_type','plyInmantaParser.py',325),
-  ('attr_type_multi -> attr_base_type [ ]','attr_type_multi',3,'p_attribute_type_multi','plyInmantaParser.py',331),
-  ('attr_type_opt -> attr_type_multi ?','attr_type_opt',2,'p_attribute_type_opt','plyInmantaParser.py',337),
-  ('attr_type_opt -> attr_base_type ?','attr_type_opt',2,'p_attribute_type_opt','plyInmantaParser.py',338),
-  ('attr_type -> attr_type_opt','attr_type',1,'p_attribute_type','plyInmantaParser.py',344),
-  ('attr_type -> attr_type_multi','attr_type',1,'p_attribute_type','plyInmantaParser.py',345),
-  ('attr_type -> attr_base_type','attr_type',1,'p_attribute_type','plyInmantaParser.py',346),
-  ('attr -> attr_type CID empty','attr',3,'p_attr_err','plyInmantaParser.py',351),
-  ('attr -> attr_type CID = constant','attr',4,'p_attr_err','plyInmantaParser.py',352),
-  ('attr -> attr_type CID = constant_list','attr',4,'p_attr_err','plyInmantaParser.py',353),
-  ('attr -> attr_type CID = UNDEF','attr',4,'p_attr_err','plyInmantaParser.py',354),
-  ('attr -> attr_type ID','attr',2,'p_attr','plyInmantaParser.py',361),
-  ('attr -> attr_type ID = constant','attr',4,'p_attr_cte','plyInmantaParser.py',367),
-  ('attr -> attr_type ID = constant_list','attr',4,'p_attr_cte','plyInmantaParser.py',368),
-  ('attr -> attr_type ID = UNDEF','attr',4,'p_attr_undef','plyInmantaParser.py',374),
-  ('attr -> DICT empty CID empty','attr',4,'p_attr_dict_err','plyInmantaParser.py',380),
-  ('attr -> DICT empty CID = map_def','attr',5,'p_attr_dict_err','plyInmantaParser.py',381),
-  ('attr -> DICT empty CID = NULL','attr',5,'p_attr_dict_err','plyInmantaParser.py',382),
-  ('attr -> DICT ? CID empty','attr',4,'p_attr_dict_err','plyInmantaParser.py',383),
-  ('attr -> DICT ? CID = map_def','attr',5,'p_attr_dict_err','plyInmantaParser.py',384),
-  ('attr -> DICT ? CID = NULL','attr',5,'p_attr_dict_err','plyInmantaParser.py',385),
-  ('attr -> DICT ID','attr',2,'p_attr_dict','plyInmantaParser.py',392),
-  ('attr -> DICT ID = map_def','attr',4,'p_attr_list_dict','plyInmantaParser.py',398),
-  ('attr -> DICT ID = NULL','attr',4,'p_attr_list_dict_null_err','plyInmantaParser.py',404),
-  ('attr -> DICT ? ID','attr',3,'p_attr_dict_nullable','plyInmantaParser.py',409),
-  ('attr -> DICT ? ID = map_def','attr',5,'p_attr_list_dict_nullable','plyInmantaParser.py',415),
-  ('attr -> DICT ? ID = NULL','attr',5,'p_attr_list_dict_null','plyInmantaParser.py',421),
-  ('implement_ns_list -> ns_ref','implement_ns_list',1,'p_implement_ns_list_ref','plyInmantaParser.py',428),
-  ('implement_ns_list -> PARENTS','implement_ns_list',1,'p_implement_ns_list_parents','plyInmantaParser.py',433),
-  ('implement_ns_list -> implement_ns_list , implement_ns_list','implement_ns_list',3,'p_implement_ns_list_collect','plyInmantaParser.py',438),
-  ('implement_def -> IMPLEMENT class_ref USING implement_ns_list empty','implement_def',5,'p_implement','plyInmantaParser.py',443),
-  ('implement_def -> IMPLEMENT class_ref USING implement_ns_list MLS','implement_def',5,'p_implement','plyInmantaParser.py',444),
-  ('implement_def -> IMPLEMENT class_ref USING implement_ns_list WHEN expression empty','implement_def',7,'p_implement_when','plyInmantaParser.py',453),
-  ('implement_def -> IMPLEMENT class_ref USING implement_ns_list WHEN expression MLS','implement_def',7,'p_implement_when','plyInmantaParser.py',454),
-  ('implementation_def -> IMPLEMENTATION ID FOR class_ref implementation','implementation_def',5,'p_implementation_def','plyInmantaParser.py',464),
-  ('implementation -> implementation_head block','implementation',2,'p_implementation','plyInmantaParser.py',477),
-  ('implementation_head -> :','implementation_head',1,'p_implementation_head','plyInmantaParser.py',482),
-  ('implementation_head -> : MLS','implementation_head',2,'p_implementation_head_doc','plyInmantaParser.py',487),
-  ('block -> stmt_list END','block',2,'p_block','plyInmantaParser.py',492),
-  ('relation -> class_ref ID multi REL multi class_ref ID','relation',7,'p_relation_deprecated','plyInmantaParser.py',498),
-  ('relation -> class_ref ID multi REL multi class_ref ID MLS','relation',8,'p_relation_deprecated_comment','plyInmantaParser.py',509),
-  ('relation -> relation_def MLS','relation',2,'p_relation_outer_comment','plyInmantaParser.py',548),
-  ('relation -> relation_def','relation',1,'p_relation_outer','plyInmantaParser.py',555),
-  ('relation_def -> class_ref . ID multi REL class_ref . ID multi','relation_def',9,'p_relation','plyInmantaParser.py',560),
-  ('relation_def -> class_ref . ID multi REL class_ref','relation_def',6,'p_relation_unidir','plyInmantaParser.py',566),
-  ('relation_def -> class_ref . ID multi operand_list class_ref . ID multi','relation_def',9,'p_relation_annotated','plyInmantaParser.py',572),
-  ('relation_def -> class_ref . ID multi operand_list class_ref','relation_def',6,'p_relation_annotated_unidir','plyInmantaParser.py',578),
-  ('multi -> [ INT ]','multi',3,'p_multi_1','plyInmantaParser.py',584),
-  ('multi -> [ INT : ]','multi',4,'p_multi_2','plyInmantaParser.py',589),
-  ('multi -> [ INT : INT ]','multi',5,'p_multi_3','plyInmantaParser.py',594),
-  ('multi -> [ : INT ]','multi',4,'p_multi_4','plyInmantaParser.py',599),
-  ('typedef -> typedef_inner','typedef',1,'p_typedef_outer','plyInmantaParser.py',607),
-  ('typedef -> typedef_inner MLS','typedef',2,'p_typedef_outer_comment','plyInmantaParser.py',612),
-  ('typedef_inner -> TYPEDEF ID AS ns_ref MATCHING expression','typedef_inner',6,'p_typedef_1','plyInmantaParser.py',619),
-  ('typedef_inner -> TYPEDEF CID AS constructor','typedef_inner',4,'p_typedef_cls','plyInmantaParser.py',626),
-  ('index -> INDEX class_ref ( id_list )','index',5,'p_index','plyInmantaParser.py',634),
-  ('expression -> boolean_expression','expression',1,'p_expression','plyInmantaParser.py',644),
-  ('expression -> constant','expression',1,'p_expression','plyInmantaParser.py',645),
-  ('expression -> function_call','expression',1,'p_expression','plyInmantaParser.py',646),
-  ('expression -> var_ref','expression',1,'p_expression','plyInmantaParser.py',647),
-  ('expression -> constructor','expression',1,'p_expression','plyInmantaParser.py',648),
-  ('expression -> list_def','expression',1,'p_expression','plyInmantaParser.py',649),
-  ('expression -> map_def','expression',1,'p_expression','plyInmantaParser.py',650),
-  ('expression -> map_lookup','expression',1,'p_expression','plyInmantaParser.py',651),
-  ('expression -> index_lookup','expression',1,'p_expression','plyInmantaParser.py',652),
-  ('expression -> conditional_expression','expression',1,'p_expression','plyInmantaParser.py',653),
-  ('expression -> ( expression )','expression',3,'p_expression_parentheses','plyInmantaParser.py',658),
-  ('boolean_expression -> expression CMP_OP expression','boolean_expression',3,'p_boolean_expression','plyInmantaParser.py',663),
-  ('boolean_expression -> expression IN expression','boolean_expression',3,'p_boolean_expression','plyInmantaParser.py',664),
-  ('boolean_expression -> expression AND expression','boolean_expression',3,'p_boolean_expression','plyInmantaParser.py',665),
-  ('boolean_expression -> expression OR expression','boolean_expression',3,'p_boolean_expression','plyInmantaParser.py',666),
-  ('boolean_expression -> NOT expression','boolean_expression',2,'p_boolean_expression_not','plyInmantaParser.py',675),
-  ('boolean_expression -> var_ref . ID IS DEFINED','boolean_expression',5,'p_boolean_expression_is_defined','plyInmantaParser.py',681),
-  ('boolean_expression -> ID IS DEFINED','boolean_expression',3,'p_boolean_expression_is_defined_short','plyInmantaParser.py',687),
-  ('boolean_expression -> map_lookup IS DEFINED','boolean_expression',3,'p_boolean_expression_is_defined_map_lookup','plyInmantaParser.py',693),
-  ('operand -> expression','operand',1,'p_operand','plyInmantaParser.py',713),
-  ('map_lookup -> attr_ref [ operand ]','map_lookup',4,'p_map_lookup','plyInmantaParser.py',718),
-  ('map_lookup -> var_ref [ operand ]','map_lookup',4,'p_map_lookup','plyInmantaParser.py',719),
-  ('map_lookup -> map_lookup [ operand ]','map_lookup',4,'p_map_lookup','plyInmantaParser.py',720),
-  ('constructor -> class_ref ( param_list )','constructor',4,'p_constructor','plyInmantaParser.py',725),
-  ('function_call -> ns_ref ( function_param_list )','function_call',4,'p_function_call','plyInmantaParser.py',731),
-  ('function_call -> attr_ref ( function_param_list )','function_call',4,'p_function_call_err_dot','plyInmantaParser.py',738),
-  ('list_def -> [ operand_list ]','list_def',3,'p_list_def','plyInmantaParser.py',743),
-  ('dict_key -> RSTRING','dict_key',1,'p_r_string_dict_key','plyInmantaParser.py',749),
-  ('dict_key -> STRING','dict_key',1,'p_string_dict_key','plyInmantaParser.py',754),
-  ('pair_list -> dict_key : operand , pair_list','pair_list',5,'p_pair_list_collect','plyInmantaParser.py',768),
-  ('pair_list -> dict_key : operand empty pair_list_empty','pair_list',5,'p_pair_list_collect','plyInmantaParser.py',769),
-  ('pair_list -> pair_list_empty','pair_list',1,'p_pair_list_empty','plyInmantaParser.py',778),
-  ('pair_list_empty -> empty','pair_list_empty',1,'p_pair_list_empty','plyInmantaParser.py',779),
-  ('map_def -> { pair_list }','map_def',3,'p_map_def','plyInmantaParser.py',784),
-  ('index_lookup -> class_ref [ param_list ]','index_lookup',4,'p_index_lookup','plyInmantaParser.py',790),
-  ('index_lookup -> attr_ref [ param_list ]','index_lookup',4,'p_short_index_lookup','plyInmantaParser.py',796),
-  ('conditional_expression -> expression ? expression : expression','conditional_expression',5,'p_conditional_expression','plyInmantaParser.py',803),
-  ('constant -> INT','constant',1,'p_constant','plyInmantaParser.py',813),
-  ('constant -> FLOAT','constant',1,'p_constant','plyInmantaParser.py',814),
-  ('constant -> NULL','constant',1,'p_constant_none','plyInmantaParser.py',821),
-  ('constant -> REGEX','constant',1,'p_constant_regex','plyInmantaParser.py',827),
-  ('constant -> TRUE','constant',1,'p_constant_true','plyInmantaParser.py',833),
-  ('constant -> FALSE','constant',1,'p_constant_false','plyInmantaParser.py',839),
-  ('constant -> STRING','constant',1,'p_constant_string','plyInmantaParser.py',845),
-  ('constant -> RSTRING','constant',1,'p_constant_rstring','plyInmantaParser.py',851),
-  ('constant -> MLS','constant',1,'p_constant_mls','plyInmantaParser.py',857),
-  ('constant_list -> [ constants ]','constant_list',3,'p_constant_list','plyInmantaParser.py',936),
-  ('constants -> constant','constants',1,'p_constants_term','plyInmantaParser.py',942),
-  ('constants -> <empty>','constants',0,'p_constants_term_2','plyInmantaParser.py',947),
-  ('constants -> constant , constants','constants',3,'p_constants_collect','plyInmantaParser.py',952),
-  ('wrapped_kwargs -> * * operand','wrapped_kwargs',3,'p_wrapped_kwargs','plyInmantaParser.py',958),
-  ('param_list_element -> ID = operand','param_list_element',3,'p_param_list_element_explicit','plyInmantaParser.py',964),
-  ('param_list_element -> wrapped_kwargs','param_list_element',1,'p_param_list_element_kwargs','plyInmantaParser.py',970),
-  ('param_list -> param_list_empty','param_list',1,'p_param_list_empty','plyInmantaParser.py',976),
-  ('param_list_empty -> empty','param_list_empty',1,'p_param_list_empty','plyInmantaParser.py',977),
-  ('param_list -> param_list_element empty param_list_empty','param_list',3,'p_param_list_nonempty','plyInmantaParser.py',983),
-  ('param_list -> param_list_element , param_list','param_list',3,'p_param_list_nonempty','plyInmantaParser.py',984),
-  ('function_param_list_element -> param_list_element','function_param_list_element',1,'p_function_param_list_element','plyInmantaParser.py',999),
-  ('function_param_list_element -> operand','function_param_list_element',1,'p_function_param_list_element_arg','plyInmantaParser.py',1006),
-  ('function_param_list -> function_param_list_empty','function_param_list',1,'p_function_param_list_empty','plyInmantaParser.py',1012),
-  ('function_param_list_empty -> empty','function_param_list_empty',1,'p_function_param_list_empty','plyInmantaParser.py',1013),
-  ('function_param_list -> function_param_list_element empty function_param_list_empty','function_param_list',3,'p_function_param_list_nonempty','plyInmantaParser.py',1019),
-  ('function_param_list -> function_param_list_element , function_param_list','function_param_list',3,'p_function_param_list_nonempty','plyInmantaParser.py',1020),
-  ('operand_list -> operand , operand_list','operand_list',3,'p_operand_list_collect','plyInmantaParser.py',1038),
-  ('operand_list -> operand','operand_list',1,'p_operand_list_term','plyInmantaParser.py',1044),
-  ('operand_list -> <empty>','operand_list',0,'p_operand_list_term_2','plyInmantaParser.py',1049),
-  ('var_ref -> attr_ref','var_ref',1,'p_var_ref','plyInmantaParser.py',1054),
-  ('attr_ref -> var_ref . ID','attr_ref',3,'p_attr_ref','plyInmantaParser.py',1059),
-  ('var_ref -> ns_ref','var_ref',1,'p_var_ref_2','plyInmantaParser.py',1065),
-  ('class_ref -> CID','class_ref',1,'p_class_ref_direct','plyInmantaParser.py',1071),
-  ('class_ref -> ns_ref SEP CID','class_ref',3,'p_class_ref','plyInmantaParser.py',1082),
-  ('class_ref -> var_ref . CID','class_ref',3,'p_class_ref_err_dot','plyInmantaParser.py',1088),
-  ('class_ref_list -> class_ref , class_ref_list','class_ref_list',3,'p_class_ref_list_collect','plyInmantaParser.py',1103),
-  ('class_ref_list -> var_ref , class_ref_list','class_ref_list',3,'p_class_ref_list_collect_err','plyInmantaParser.py',1109),
-  ('class_ref_list -> class_ref','class_ref_list',1,'p_class_ref_list_term','plyInmantaParser.py',1114),
-  ('class_ref_list -> var_ref','class_ref_list',1,'p_class_ref_list_term_err','plyInmantaParser.py',1119),
-  ('ns_ref -> ns_ref SEP ID','ns_ref',3,'p_ns_ref','plyInmantaParser.py',1125),
-  ('ns_ref -> ID','ns_ref',1,'p_ns_ref_term','plyInmantaParser.py',1131),
-  ('id_list -> ID , id_list','id_list',3,'p_id_list_collect','plyInmantaParser.py',1136),
-  ('id_list -> ID','id_list',1,'p_id_list_term','plyInmantaParser.py',1142),
+  ('main -> head body','main',2,'p_main','plyInmantaParser.py',127),
+  ('head -> <empty>','head',0,'p_main_head','plyInmantaParser.py',135),
+  ('head -> MLS','head',1,'p_main_head_doc','plyInmantaParser.py',140),
+  ('body -> top_stmt body','body',2,'p_body_collect','plyInmantaParser.py',145),
+  ('body -> empty','body',1,'p_body_term','plyInmantaParser.py',152),
+  ('top_stmt -> entity_def','top_stmt',1,'p_top_stmt','plyInmantaParser.py',157),
+  ('top_stmt -> implement_def','top_stmt',1,'p_top_stmt','plyInmantaParser.py',158),
+  ('top_stmt -> implementation_def','top_stmt',1,'p_top_stmt','plyInmantaParser.py',159),
+  ('top_stmt -> relation','top_stmt',1,'p_top_stmt','plyInmantaParser.py',160),
+  ('top_stmt -> statement','top_stmt',1,'p_top_stmt','plyInmantaParser.py',161),
+  ('top_stmt -> typedef','top_stmt',1,'p_top_stmt','plyInmantaParser.py',162),
+  ('top_stmt -> index','top_stmt',1,'p_top_stmt','plyInmantaParser.py',163),
+  ('top_stmt -> import','top_stmt',1,'p_top_stmt','plyInmantaParser.py',164),
+  ('empty -> <empty>','empty',0,'p_empty','plyInmantaParser.py',169),
+  ('import -> IMPORT ns_ref','import',2,'p_import','plyInmantaParser.py',179),
+  ('import -> IMPORT ns_ref AS ID','import',4,'p_import_1','plyInmantaParser.py',185),
+  ('statement -> assign','statement',1,'p_stmt','plyInmantaParser.py',196),
+  ('statement -> for','statement',1,'p_stmt','plyInmantaParser.py',197),
+  ('statement -> if','statement',1,'p_stmt','plyInmantaParser.py',198),
+  ('statement -> expression','statement',1,'p_stmt','plyInmantaParser.py',199),
+  ('stmt_list -> statement stmt_list','stmt_list',2,'p_stmt_list_collect','plyInmantaParser.py',213),
+  ('stmt_list -> empty','stmt_list',1,'p_stmt_list_empty','plyInmantaParser.py',220),
+  ('assign -> var_ref = operand','assign',3,'p_assign','plyInmantaParser.py',225),
+  ('assign -> var_ref PEQ operand','assign',3,'p_assign_extend','plyInmantaParser.py',231),
+  ('for -> FOR ID IN operand : block','for',6,'p_for','plyInmantaParser.py',237),
+  ('if -> IF if_body END','if',3,'p_if_start','plyInmantaParser.py',244),
+  ('if_body -> expression : stmt_list if_next','if_body',4,'p_if_body','plyInmantaParser.py',250),
+  ('if_next -> empty','if_next',1,'p_if_end','plyInmantaParser.py',257),
+  ('if_next -> ELSE : stmt_list','if_next',3,'p_if_else','plyInmantaParser.py',263),
+  ('if_next -> ELIF if_body','if_next',2,'p_if_elif','plyInmantaParser.py',269),
+  ('entity_def -> ENTITY CID : entity_body_outer','entity_def',4,'p_entity','plyInmantaParser.py',281),
+  ('entity_def -> ENTITY ID : entity_body_outer','entity_def',4,'p_entity_err_1','plyInmantaParser.py',288),
+  ('entity_def -> ENTITY CID EXTENDS class_ref_list : entity_body_outer','entity_def',6,'p_entity_extends','plyInmantaParser.py',293),
+  ('entity_def -> ENTITY ID EXTENDS class_ref_list : entity_body_outer','entity_def',6,'p_entity_extends_err','plyInmantaParser.py',300),
+  ('entity_body_outer -> MLS entity_body END','entity_body_outer',3,'p_entity_body_outer','plyInmantaParser.py',305),
+  ('entity_body_outer -> entity_body END','entity_body_outer',2,'p_entity_body_outer_1','plyInmantaParser.py',310),
+  ('entity_body_outer -> END','entity_body_outer',1,'p_entity_body_outer_none','plyInmantaParser.py',315),
+  ('entity_body_outer -> MLS END','entity_body_outer',2,'p_entity_body_outer_4','plyInmantaParser.py',320),
+  ('entity_body -> entity_body attr','entity_body',2,'p_entity_body_collect','plyInmantaParser.py',325),
+  ('entity_body -> attr','entity_body',1,'p_entity_body','plyInmantaParser.py',331),
+  ('attr_base_type -> ns_ref','attr_base_type',1,'p_attribute_base_type','plyInmantaParser.py',336),
+  ('attr_type_multi -> attr_base_type [ ]','attr_type_multi',3,'p_attribute_type_multi','plyInmantaParser.py',342),
+  ('attr_type_opt -> attr_type_multi ?','attr_type_opt',2,'p_attribute_type_opt','plyInmantaParser.py',348),
+  ('attr_type_opt -> attr_base_type ?','attr_type_opt',2,'p_attribute_type_opt','plyInmantaParser.py',349),
+  ('attr_type -> attr_type_opt','attr_type',1,'p_attribute_type','plyInmantaParser.py',355),
+  ('attr_type -> attr_type_multi','attr_type',1,'p_attribute_type','plyInmantaParser.py',356),
+  ('attr_type -> attr_base_type','attr_type',1,'p_attribute_type','plyInmantaParser.py',357),
+  ('attr -> attr_type CID empty','attr',3,'p_attr_err','plyInmantaParser.py',362),
+  ('attr -> attr_type CID = constant','attr',4,'p_attr_err','plyInmantaParser.py',363),
+  ('attr -> attr_type CID = constant_list','attr',4,'p_attr_err','plyInmantaParser.py',364),
+  ('attr -> attr_type CID = UNDEF','attr',4,'p_attr_err','plyInmantaParser.py',365),
+  ('attr -> attr_type ID','attr',2,'p_attr','plyInmantaParser.py',372),
+  ('attr -> attr_type ID = constant','attr',4,'p_attr_cte','plyInmantaParser.py',378),
+  ('attr -> attr_type ID = constant_list','attr',4,'p_attr_cte','plyInmantaParser.py',379),
+  ('attr -> attr_type ID = UNDEF','attr',4,'p_attr_undef','plyInmantaParser.py',385),
+  ('attr -> DICT empty CID empty','attr',4,'p_attr_dict_err','plyInmantaParser.py',391),
+  ('attr -> DICT empty CID = map_def','attr',5,'p_attr_dict_err','plyInmantaParser.py',392),
+  ('attr -> DICT empty CID = NULL','attr',5,'p_attr_dict_err','plyInmantaParser.py',393),
+  ('attr -> DICT ? CID empty','attr',4,'p_attr_dict_err','plyInmantaParser.py',394),
+  ('attr -> DICT ? CID = map_def','attr',5,'p_attr_dict_err','plyInmantaParser.py',395),
+  ('attr -> DICT ? CID = NULL','attr',5,'p_attr_dict_err','plyInmantaParser.py',396),
+  ('attr -> DICT ID','attr',2,'p_attr_dict','plyInmantaParser.py',403),
+  ('attr -> DICT ID = map_def','attr',4,'p_attr_list_dict','plyInmantaParser.py',409),
+  ('attr -> DICT ID = NULL','attr',4,'p_attr_list_dict_null_err','plyInmantaParser.py',415),
+  ('attr -> DICT ? ID','attr',3,'p_attr_dict_nullable','plyInmantaParser.py',420),
+  ('attr -> DICT ? ID = map_def','attr',5,'p_attr_list_dict_nullable','plyInmantaParser.py',426),
+  ('attr -> DICT ? ID = NULL','attr',5,'p_attr_list_dict_null','plyInmantaParser.py',432),
+  ('implement_ns_list -> ns_ref','implement_ns_list',1,'p_implement_ns_list_ref','plyInmantaParser.py',439),
+  ('implement_ns_list -> PARENTS','implement_ns_list',1,'p_implement_ns_list_parents','plyInmantaParser.py',444),
+  ('implement_ns_list -> implement_ns_list , implement_ns_list','implement_ns_list',3,'p_implement_ns_list_collect','plyInmantaParser.py',449),
+  ('implement_def -> IMPLEMENT class_ref USING implement_ns_list empty','implement_def',5,'p_implement','plyInmantaParser.py',454),
+  ('implement_def -> IMPLEMENT class_ref USING implement_ns_list MLS','implement_def',5,'p_implement','plyInmantaParser.py',455),
+  ('implement_def -> IMPLEMENT class_ref USING implement_ns_list WHEN expression empty','implement_def',7,'p_implement_when','plyInmantaParser.py',464),
+  ('implement_def -> IMPLEMENT class_ref USING implement_ns_list WHEN expression MLS','implement_def',7,'p_implement_when','plyInmantaParser.py',465),
+  ('implementation_def -> IMPLEMENTATION ID FOR class_ref implementation','implementation_def',5,'p_implementation_def','plyInmantaParser.py',475),
+  ('implementation -> implementation_head block','implementation',2,'p_implementation','plyInmantaParser.py',488),
+  ('implementation_head -> :','implementation_head',1,'p_implementation_head','plyInmantaParser.py',493),
+  ('implementation_head -> : MLS','implementation_head',2,'p_implementation_head_doc','plyInmantaParser.py',498),
+  ('block -> stmt_list END','block',2,'p_block','plyInmantaParser.py',503),
+  ('relation -> class_ref ID multi REL multi class_ref ID','relation',7,'p_relation_deprecated','plyInmantaParser.py',509),
+  ('relation -> class_ref ID multi REL multi class_ref ID MLS','relation',8,'p_relation_deprecated_comment','plyInmantaParser.py',520),
+  ('relation -> relation_def MLS','relation',2,'p_relation_outer_comment','plyInmantaParser.py',559),
+  ('relation -> relation_def','relation',1,'p_relation_outer','plyInmantaParser.py',566),
+  ('relation_def -> class_ref . ID multi REL class_ref . ID multi','relation_def',9,'p_relation','plyInmantaParser.py',571),
+  ('relation_def -> class_ref . ID multi REL class_ref','relation_def',6,'p_relation_unidir','plyInmantaParser.py',577),
+  ('relation_def -> class_ref . ID multi operand_list class_ref . ID multi','relation_def',9,'p_relation_annotated','plyInmantaParser.py',583),
+  ('relation_def -> class_ref . ID multi operand_list class_ref','relation_def',6,'p_relation_annotated_unidir','plyInmantaParser.py',589),
+  ('multi -> [ INT ]','multi',3,'p_multi_1','plyInmantaParser.py',595),
+  ('multi -> [ INT : ]','multi',4,'p_multi_2','plyInmantaParser.py',600),
+  ('multi -> [ INT : INT ]','multi',5,'p_multi_3','plyInmantaParser.py',605),
+  ('multi -> [ : INT ]','multi',4,'p_multi_4','plyInmantaParser.py',610),
+  ('typedef -> typedef_inner','typedef',1,'p_typedef_outer','plyInmantaParser.py',618),
+  ('typedef -> typedef_inner MLS','typedef',2,'p_typedef_outer_comment','plyInmantaParser.py',623),
+  ('typedef_inner -> TYPEDEF ID AS ns_ref MATCHING expression','typedef_inner',6,'p_typedef_1','plyInmantaParser.py',630),
+  ('typedef_inner -> TYPEDEF CID AS constructor','typedef_inner',4,'p_typedef_cls','plyInmantaParser.py',637),
+  ('index -> INDEX class_ref ( id_list )','index',5,'p_index','plyInmantaParser.py',645),
+  ('expression -> boolean_expression','expression',1,'p_expression','plyInmantaParser.py',655),
+  ('expression -> constant','expression',1,'p_expression','plyInmantaParser.py',656),
+  ('expression -> function_call','expression',1,'p_expression','plyInmantaParser.py',657),
+  ('expression -> var_ref','expression',1,'p_expression','plyInmantaParser.py',658),
+  ('expression -> constructor','expression',1,'p_expression','plyInmantaParser.py',659),
+  ('expression -> list_def','expression',1,'p_expression','plyInmantaParser.py',660),
+  ('expression -> list_comprehension','expression',1,'p_expression','plyInmantaParser.py',661),
+  ('expression -> map_def','expression',1,'p_expression','plyInmantaParser.py',662),
+  ('expression -> map_lookup','expression',1,'p_expression','plyInmantaParser.py',663),
+  ('expression -> index_lookup','expression',1,'p_expression','plyInmantaParser.py',664),
+  ('expression -> conditional_expression','expression',1,'p_expression','plyInmantaParser.py',665),
+  ('expression -> ( expression )','expression',3,'p_expression_parentheses','plyInmantaParser.py',670),
+  ('boolean_expression -> expression CMP_OP expression','boolean_expression',3,'p_boolean_expression','plyInmantaParser.py',675),
+  ('boolean_expression -> expression IN expression','boolean_expression',3,'p_boolean_expression','plyInmantaParser.py',676),
+  ('boolean_expression -> expression AND expression','boolean_expression',3,'p_boolean_expression','plyInmantaParser.py',677),
+  ('boolean_expression -> expression OR expression','boolean_expression',3,'p_boolean_expression','plyInmantaParser.py',678),
+  ('boolean_expression -> NOT expression','boolean_expression',2,'p_boolean_expression_not','plyInmantaParser.py',687),
+  ('boolean_expression -> var_ref . ID IS DEFINED','boolean_expression',5,'p_boolean_expression_is_defined','plyInmantaParser.py',693),
+  ('boolean_expression -> ID IS DEFINED','boolean_expression',3,'p_boolean_expression_is_defined_short','plyInmantaParser.py',699),
+  ('boolean_expression -> map_lookup IS DEFINED','boolean_expression',3,'p_boolean_expression_is_defined_map_lookup','plyInmantaParser.py',705),
+  ('operand -> expression','operand',1,'p_operand','plyInmantaParser.py',725),
+  ('map_lookup -> attr_ref [ operand ]','map_lookup',4,'p_map_lookup','plyInmantaParser.py',730),
+  ('map_lookup -> var_ref [ operand ]','map_lookup',4,'p_map_lookup','plyInmantaParser.py',731),
+  ('map_lookup -> map_lookup [ operand ]','map_lookup',4,'p_map_lookup','plyInmantaParser.py',732),
+  ('constructor -> class_ref ( param_list )','constructor',4,'p_constructor','plyInmantaParser.py',737),
+  ('function_call -> ns_ref ( function_param_list )','function_call',4,'p_function_call','plyInmantaParser.py',743),
+  ('function_call -> attr_ref ( function_param_list )','function_call',4,'p_function_call_err_dot','plyInmantaParser.py',750),
+  ('list_def -> [ operand_list ]','list_def',3,'p_list_def','plyInmantaParser.py',755),
+  ('list_comprehension -> [ expression list_comprehension_for list_comprehension_guard ]','list_comprehension',5,'p_list_comprehension','plyInmantaParser.py',768),
+  ('list_comprehension_for_empty -> empty','list_comprehension_for_empty',1,'p_list_comprehension_for_empty','plyInmantaParser.py',793),
+  ('list_comprehension_for -> FOR ID IN expression list_comprehension_for_empty','list_comprehension_for',5,'p_list_comprehension_for','plyInmantaParser.py',798),
+  ('list_comprehension_for -> FOR ID IN expression list_comprehension_for','list_comprehension_for',5,'p_list_comprehension_for','plyInmantaParser.py',799),
+  ('list_comprehension_guard -> empty','list_comprehension_guard',1,'p_list_comprehension_guard_empty','plyInmantaParser.py',806),
+  ('list_comprehension_guard -> IF expression list_comprehension_guard','list_comprehension_guard',3,'p_list_comprehension_guard','plyInmantaParser.py',811),
+  ('dict_key -> RSTRING','dict_key',1,'p_r_string_dict_key','plyInmantaParser.py',821),
+  ('dict_key -> STRING','dict_key',1,'p_string_dict_key','plyInmantaParser.py',826),
+  ('pair_list -> dict_key : operand , pair_list','pair_list',5,'p_pair_list_collect','plyInmantaParser.py',840),
+  ('pair_list -> dict_key : operand empty pair_list_empty','pair_list',5,'p_pair_list_collect','plyInmantaParser.py',841),
+  ('pair_list -> pair_list_empty','pair_list',1,'p_pair_list_empty','plyInmantaParser.py',850),
+  ('pair_list_empty -> empty','pair_list_empty',1,'p_pair_list_empty','plyInmantaParser.py',851),
+  ('map_def -> { pair_list }','map_def',3,'p_map_def','plyInmantaParser.py',856),
+  ('index_lookup -> class_ref [ param_list ]','index_lookup',4,'p_index_lookup','plyInmantaParser.py',862),
+  ('index_lookup -> attr_ref [ param_list ]','index_lookup',4,'p_short_index_lookup','plyInmantaParser.py',868),
+  ('conditional_expression -> expression ? expression : expression','conditional_expression',5,'p_conditional_expression','plyInmantaParser.py',875),
+  ('constant -> INT','constant',1,'p_constant','plyInmantaParser.py',885),
+  ('constant -> FLOAT','constant',1,'p_constant','plyInmantaParser.py',886),
+  ('constant -> NULL','constant',1,'p_constant_none','plyInmantaParser.py',893),
+  ('constant -> REGEX','constant',1,'p_constant_regex','plyInmantaParser.py',899),
+  ('constant -> TRUE','constant',1,'p_constant_true','plyInmantaParser.py',905),
+  ('constant -> FALSE','constant',1,'p_constant_false','plyInmantaParser.py',911),
+  ('constant -> STRING','constant',1,'p_constant_string','plyInmantaParser.py',917),
+  ('constant -> FSTRING','constant',1,'p_constant_fstring','plyInmantaParser.py',923),
+  ('constant -> RSTRING','constant',1,'p_constant_rstring','plyInmantaParser.py',980),
+  ('constant -> MLS','constant',1,'p_constant_mls','plyInmantaParser.py',986),
+  ('constant_list -> [ constants ]','constant_list',3,'p_constant_list','plyInmantaParser.py',1075),
+  ('constants -> constant','constants',1,'p_constants_term','plyInmantaParser.py',1081),
+  ('constants -> <empty>','constants',0,'p_constants_term_2','plyInmantaParser.py',1086),
+  ('constants -> constant , constants','constants',3,'p_constants_collect','plyInmantaParser.py',1091),
+  ('wrapped_kwargs -> * * operand','wrapped_kwargs',3,'p_wrapped_kwargs','plyInmantaParser.py',1097),
+  ('param_list_element -> ID = operand','param_list_element',3,'p_param_list_element_explicit','plyInmantaParser.py',1103),
+  ('param_list_element -> wrapped_kwargs','param_list_element',1,'p_param_list_element_kwargs','plyInmantaParser.py',1109),
+  ('param_list -> param_list_empty','param_list',1,'p_param_list_empty','plyInmantaParser.py',1115),
+  ('param_list_empty -> empty','param_list_empty',1,'p_param_list_empty','plyInmantaParser.py',1116),
+  ('param_list -> param_list_element empty param_list_empty','param_list',3,'p_param_list_nonempty','plyInmantaParser.py',1122),
+  ('param_list -> param_list_element , param_list','param_list',3,'p_param_list_nonempty','plyInmantaParser.py',1123),
+  ('function_param_list_element -> param_list_element','function_param_list_element',1,'p_function_param_list_element','plyInmantaParser.py',1138),
+  ('function_param_list_element -> operand','function_param_list_element',1,'p_function_param_list_element_arg','plyInmantaParser.py',1145),
+  ('function_param_list -> function_param_list_empty','function_param_list',1,'p_function_param_list_empty','plyInmantaParser.py',1151),
+  ('function_param_list_empty -> empty','function_param_list_empty',1,'p_function_param_list_empty','plyInmantaParser.py',1152),
+  ('function_param_list -> function_param_list_element empty function_param_list_empty','function_param_list',3,'p_function_param_list_nonempty','plyInmantaParser.py',1158),
+  ('function_param_list -> function_param_list_element , function_param_list','function_param_list',3,'p_function_param_list_nonempty','plyInmantaParser.py',1159),
+  ('operand_list -> operand , operand_list','operand_list',3,'p_operand_list_collect','plyInmantaParser.py',1177),
+  ('operand_list -> operand','operand_list',1,'p_operand_list_term','plyInmantaParser.py',1183),
+  ('operand_list -> <empty>','operand_list',0,'p_operand_list_term_2','plyInmantaParser.py',1188),
+  ('var_ref -> attr_ref','var_ref',1,'p_var_ref','plyInmantaParser.py',1193),
+  ('attr_ref -> var_ref . ID','attr_ref',3,'p_attr_ref','plyInmantaParser.py',1198),
+  ('var_ref -> ns_ref','var_ref',1,'p_var_ref_2','plyInmantaParser.py',1204),
+  ('class_ref -> CID','class_ref',1,'p_class_ref_direct','plyInmantaParser.py',1210),
+  ('class_ref -> ns_ref SEP CID','class_ref',3,'p_class_ref','plyInmantaParser.py',1221),
+  ('class_ref -> var_ref . CID','class_ref',3,'p_class_ref_err_dot','plyInmantaParser.py',1227),
+  ('class_ref_list -> class_ref , class_ref_list','class_ref_list',3,'p_class_ref_list_collect','plyInmantaParser.py',1242),
+  ('class_ref_list -> var_ref , class_ref_list','class_ref_list',3,'p_class_ref_list_collect_err','plyInmantaParser.py',1248),
+  ('class_ref_list -> class_ref','class_ref_list',1,'p_class_ref_list_term','plyInmantaParser.py',1253),
+  ('class_ref_list -> var_ref','class_ref_list',1,'p_class_ref_list_term_err','plyInmantaParser.py',1258),
+  ('ns_ref -> ns_ref SEP ID','ns_ref',3,'p_ns_ref','plyInmantaParser.py',1264),
+  ('ns_ref -> ID','ns_ref',1,'p_ns_ref_term','plyInmantaParser.py',1270),
+  ('id_list -> ID , id_list','id_list',3,'p_id_list_collect','plyInmantaParser.py',1275),
+  ('id_list -> ID','id_list',1,'p_id_list_term','plyInmantaParser.py',1281),
 ]
```

### Comparing `inmanta-core-8.3.0/src/inmanta/parser/pickle.py` & `inmanta-core-9.3.0/src/inmanta/parser/pickle.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/parser/plyInmantaLex.py` & `inmanta-core-9.3.0/src/inmanta/parser/plyInmantaLex.py`

 * *Files 6% similar despite different names*

```diff
@@ -56,19 +56,35 @@
     "else",
     "elif",
 ]
 literals = [":", "[", "]", "(", ")", "=", ",", ".", "{", "}", "?", "*"]
 reserved = {k: k.upper() for k in keyworldlist}
 
 # List of token names.   This is always required
-tokens = ["INT", "FLOAT", "ID", "CID", "SEP", "STRING", "MLS", "CMP_OP", "REGEX", "REL", "PEQ", "RSTRING"] + sorted(
+tokens = ["INT", "FLOAT", "ID", "CID", "SEP", "STRING", "MLS", "CMP_OP", "REGEX", "REL", "PEQ", "RSTRING", "FSTRING"] + sorted(
     list(reserved.values())
 )
 
 
+def t_FSTRING(t: lex.LexToken) -> lex.LexToken:  # noqa: N802
+    r"f(\"([^\\\"\n]|\\.)*\")|f(\'([^\\\'\n]|\\.)*\')"
+    t.value = t.value[2:-1]
+    lexer = t.lexer
+
+    end = lexer.lexpos - lexer.linestart + 1
+    (s, e) = lexer.lexmatch.span()
+    start = end - (e - s)
+
+    t.value = LocatableString(
+        t.value, Range(lexer.inmfile, lexer.lineno, start, lexer.lineno, end), lexer.lexpos, lexer.namespace
+    )
+
+    return t
+
+
 def t_RSTRING(t: lex.LexToken) -> lex.LexToken:  # noqa: N802
     r"r(\"([^\\\"\n]|\\.)*\")|r(\'([^\\\'\n]|\\.)*\')"
     t.value = t.value[2:-1]
     lexer = t.lexer
 
     end = lexer.lexpos - lexer.linestart + 1
     (s, e) = lexer.lexmatch.span()
```

### Comparing `inmanta-core-8.3.0/src/inmanta/parser/plyInmantaParser.py` & `inmanta-core-9.3.0/src/inmanta/parser/plyInmantaParser.py`

 * *Files 19% similar despite different names*

```diff
@@ -11,52 +11,63 @@
     distributed under the License is distributed on an "AS IS" BASIS,
     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     See the License for the specific language governing permissions and
     limitations under the License.
 
     Contact: code@inmanta.com
 """
+import functools
 import logging
 import re
+import string
 import warnings
+from collections import abc
+from dataclasses import dataclass
 from itertools import accumulate
-from typing import Iterator, List, Optional, Tuple, Union
+from typing import Iterable, Iterator, List, Optional, Tuple, Union
 
 import ply.yacc as yacc
 from ply.yacc import YaccProduction
 
 from inmanta.ast import LocatableString, Location, Namespace, Range
 from inmanta.ast.blocks import BasicBlock
 from inmanta.ast.constraint.expression import And, In, IsDefined, Not, NotEqual, Operator
 from inmanta.ast.statements import ExpressionStatement, Literal, Statement
-from inmanta.ast.statements.assign import CreateDict, CreateList, IndexLookup, MapLookup, ShortIndexLookup, StringFormat
+from inmanta.ast.statements.assign import (
+    CreateDict,
+    CreateList,
+    IndexLookup,
+    MapLookup,
+    ShortIndexLookup,
+    StringFormat,
+    StringFormatV2,
+)
 from inmanta.ast.statements.call import FunctionCall
 from inmanta.ast.statements.define import (
     DefineAttribute,
     DefineEntity,
     DefineImplement,
     DefineImplementation,
     DefineImport,
     DefineIndex,
     DefineRelation,
     DefineTypeConstraint,
     TypeDeclaration,
 )
-from inmanta.ast.statements.generator import ConditionalExpression, Constructor, For, If, WrappedKwargs
+from inmanta.ast.statements.generator import ConditionalExpression, Constructor, For, If, ListComprehension, WrappedKwargs
 from inmanta.ast.variables import AttributeReference, Reference
 from inmanta.execute.util import NoneValue
 from inmanta.parser import InvalidNamespaceAccess, ParserException, SyntaxDeprecationWarning, plyInmantaLex
 from inmanta.parser.cache import CacheManager
 from inmanta.parser.plyInmantaLex import reserved, tokens  # NOQA
 
 # the token map is imported from the lexer. This is required.
 
 LOGGER = logging.getLogger()
 
-
 file = "NOFILE"
 namespace: Optional[Namespace] = None
 
 precedence = (
     ("right", ","),
     ("nonassoc", ":"),
     ("nonassoc", "?"),
@@ -643,14 +654,15 @@
 def p_expression(p: YaccProduction) -> None:
     """expression : boolean_expression
     | constant
     | function_call
     | var_ref %prec VAR_REF
     | constructor
     | list_def
+    | list_comprehension
     | map_def
     | map_lookup %prec MAP_LOOKUP
     | index_lookup
     | conditional_expression"""
     p[0] = p[1]
 
 
@@ -741,14 +753,74 @@
 
 def p_list_def(p: YaccProduction) -> None:
     "list_def : '[' operand_list ']'"
     p[0] = CreateList(p[2])
     attach_lnr(p, 1)
 
 
+@dataclass
+class ForSpecifier:
+    variable: LocatableString
+    iterable: ExpressionStatement
+    guard: Optional[ExpressionStatement] = None
+
+
+def p_list_comprehension(p: YaccProduction) -> None:
+    "list_comprehension : '[' expression list_comprehension_for list_comprehension_guard ']'"
+
+    def create_list_comprehension(value_expression: ExpressionStatement, for_specifier: ForSpecifier) -> ListComprehension:
+        result: ListComprehension = ListComprehension(
+            value_expression, for_specifier.variable, for_specifier.iterable, for_specifier.guard
+        )
+        line_nb_token: int = 1
+        result.location = Location(file, p.lineno(line_nb_token))
+        result.namespace = namespace
+        result.lexpos = p.lexpos(line_nb_token)
+        return result
+
+    # for-specifiers in reverse order
+    loops: abc.Sequence[ForSpecifier] = p[3]
+    loops[0].guard = p[4]
+    # `[z for y in x.y for z in y.z if y > 0 if z > 0]` is syntactic sugar for
+    # `[[z for z in y.z if y > 0 and z > 0] for y in x.y]`, loops = [(z, y.z), (y, x.y)]
+    p[0] = functools.reduce(
+        lambda acc, for_spec: create_list_comprehension(value_expression=acc, for_specifier=for_spec),
+        loops,
+        p[2],
+    )
+
+
+def p_list_comprehension_for_empty(p: YaccProduction) -> None:
+    "list_comprehension_for_empty : empty"
+    p[0] = []  # list[ForSpecifier]
+
+
+def p_list_comprehension_for(p: YaccProduction) -> None:
+    """list_comprehension_for : FOR ID IN expression list_comprehension_for_empty
+    | FOR ID IN expression list_comprehension_for"""
+    p[0] = p[5]  # list[ForSpecifier]
+    # for-specifiers in reverse order
+    p[0].append(ForSpecifier(variable=p[2], iterable=p[4]))
+
+
+def p_list_comprehension_guard_empty(p: YaccProduction) -> None:
+    "list_comprehension_guard : empty"
+    p[0] = None
+
+
+def p_list_comprehension_guard(p: YaccProduction) -> None:
+    "list_comprehension_guard : IF expression list_comprehension_guard"
+    if p[3] is None:
+        p[0] = p[2]
+    else:
+        # `if x if y` is syntactic sugar for `if x and y`
+        p[0] = And(p[2], p[3])
+        attach_lnr(p, 1)
+
+
 def p_r_string_dict_key(p: YaccProduction) -> None:
     """dict_key : RSTRING"""
     p[0] = p[1]
 
 
 def p_string_dict_key(p: YaccProduction) -> None:
     """dict_key : STRING"""
@@ -843,14 +915,71 @@
 
 def p_constant_string(p: YaccProduction) -> None:
     "constant : STRING"
     p[0] = get_string_ast_node(p[1], False)
     attach_lnr(p)
 
 
+def p_constant_fstring(p: YaccProduction) -> None:
+    "constant : FSTRING"
+    formatter = string.Formatter()
+
+    # formatter.parse returns an iterable of tuple (literal_text, field_name, format_spec, conversion)
+    parsed: Iterable[Tuple[str, Optional[str], Optional[str], Optional[str]]] = formatter.parse(str(p[1]))
+
+    start_lnr = p[1].location.lnr
+    start_char_pos = p[1].location.start_char + 2  # FSTRING tokens begin with `f"` or `f'` of length 2
+
+    locatable_matches: List[Tuple[str, LocatableString]] = []
+
+    def locate_match(match: Tuple[str, Optional[str], Optional[str], Optional[str]]) -> None:
+        """
+        Associates a parsed field name with a locatable string
+        """
+        range: Range = Range(p[1].location.file, start_lnr, start_char_pos, start_lnr, end_char)
+        assert match[1]  # make mypy happy
+        locatable_string = LocatableString(match[1], range, p[1].lexpos, p[1].namespace)
+        locatable_matches.append((match[1], locatable_string))
+
+    for match in parsed:
+        if not match[1]:
+            # Happens when the format string ends with literal text (and not a replacement field): we're done parsing.
+            break
+        literal_text_len = len(match[0])
+        field_name_len = len(match[1])
+        brackets_length = 1 if field_name_len else 0
+        start_char_pos += literal_text_len + brackets_length
+        end_char = start_char_pos + field_name_len
+
+        locate_match(match)
+        start_char_pos += field_name_len
+
+        if match[2]:
+            # A format specifier was provided
+            start_char_pos += 1  # Account for the ":" character
+            sub_parsed: Iterable[Tuple[str, Optional[str], Optional[str], Optional[str]]] = formatter.parse(match[2])
+            for submatch in sub_parsed:
+                if not submatch[1]:
+                    # Happens when the format string ends with literal text (and not a replacement field): we're done parsing.
+                    break
+                literal_text_len = len(submatch[0])
+                inner_field_name_len = len(submatch[1])
+                inner_brackets_len = 1 if inner_field_name_len else 0
+                start_char_pos += literal_text_len + inner_brackets_len
+                end_char = start_char_pos + inner_field_name_len
+
+                locate_match(submatch)
+                start_char_pos += inner_field_name_len + inner_brackets_len
+
+        start_char_pos += brackets_length
+
+    p[0] = StringFormatV2(str(p[1]), convert_to_references(locatable_matches))
+    attach_from_string(p)
+
+
 def p_constant_rstring(p: YaccProduction) -> None:
     "constant : RSTRING"
     p[0] = Literal(str(p[1]))
     attach_from_string(p)
 
 
 def p_constant_mls(p: YaccProduction) -> None:
@@ -885,29 +1014,38 @@
     locatable_matches: List[Tuple[str, LocatableString]] = []
     for match in matches:
         start_line, start_char = char_count_to_lnr_char(match.start(2))
         end_line, end_char = char_count_to_lnr_char(match.end(2))
         range: Range = Range(string_ast.location.file, start_line, start_char, end_line, end_char)
         locatable_string = LocatableString(match[2], range, string_ast.lexpos, string_ast.namespace)
         locatable_matches.append((match[1], locatable_string))
-    return create_string_format(string_ast, locatable_matches)
 
+    return StringFormat(str(string_ast), convert_to_references(locatable_matches))
 
-def create_string_format(format_string: LocatableString, variables: List[Tuple[str, LocatableString]]) -> StringFormat:
-    """
-    Create a string interpolation statement. This function assumes that the variables of a match are on the same line.
 
-    :param format_string: the LocatableString as it was received by get_string_ast_node()
-    :param variables: A list of tuples where each tuple is a combination of a string and LocatableString
-                        The string is the match containing the {{}} (ex: {{a.b}}) and the LocatableString is composed of
-                        just the variables and the range for those variables.
-                        (ex. LocatableString("a.b", range(a.b), lexpos, namespace))
+def convert_to_references(variables: List[Tuple[str, LocatableString]]) -> List[Tuple["Reference", str]]:
+    """
+    This function is used in a context of string formatting. It expects variables that are part of a single line
+    format string and converts them to a format that can be processed by StringFormat (for regular
+    string interpolation) or by StringFormatV2 (for f-string formatting).
+
+    :param variables: A list of tuples where each tuple is a combination of a string and LocatableString.
+        For regular string interpolation:
+            - The string is the match containing the {{}} (ex: {{a.b}})
+            - The LocatableString is composed of just the variables and the range for those variables.
+            (ex. LocatableString("a.b", range(a.b), lexpos, namespace))
+
+        For f-strings:
+            - The string is the plain variable name without brackets (ex: 'a.b')
+            - The LocatableString is the same as for regular string interpolation
+    :returns: A tuple where all LocatableString have been converted to Reference. The matching str holding the variable
+        name is left untouched
     """
     assert namespace
-    _vars = []
+    _vars: List[Tuple[Reference, str]] = []
     for match, var in variables:
         var_name: str = str(var)
         var_parts: List[str] = var_name.split(".")
         start_char = var.location.start_char
         end_char = start_char + len(var_parts[0])
         range: Range = Range(var.location.file, var.location.lnr, start_char, var.location.lnr, end_char)
         ref_locatable_string = LocatableString(var_parts[0], range, var.lexpos, var.namespace)
@@ -922,18 +1060,19 @@
                 range_attr: Range = Range(
                     var.location.file, var.location.lnr, char_offset, var.location.lnr, char_offset + len(attr)
                 )
                 attr_locatable_string: LocatableString = LocatableString(attr, range_attr, var.lexpos, var.namespace)
                 ref = AttributeReference(ref, attr_locatable_string)
                 ref.location = range_attr
                 ref.namespace = namespace
+            # For a composite variable e.g. 'a.b.c', we only add the reference to the innermost attribute (e.g. 'c')
             _vars.append((ref, match))
         else:
             _vars.append((ref, match))
-    return StringFormat(str(format_string), _vars)
+    return _vars
 
 
 def p_constant_list(p: YaccProduction) -> None:
     "constant_list : '[' constants ']'"
     p[0] = CreateList(p[2])
     attach_lnr(p, 1)
```

### Comparing `inmanta-core-8.3.0/src/inmanta/plugins.py` & `inmanta-core-9.3.0/src/inmanta/plugins.py`

 * *Files 8% similar despite different names*

```diff
@@ -11,24 +11,25 @@
     distributed under the License is distributed on an "AS IS" BASIS,
     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     See the License for the specific language governing permissions and
     limitations under the License.
 
     Contact: code@inmanta.com
 """
+import asyncio
 import inspect
 import os
 import subprocess
 import warnings
 from collections import abc
 from functools import reduce
 from typing import TYPE_CHECKING, Any, Callable, Dict, FrozenSet, List, Optional, Tuple, Type, TypeVar
 
 import inmanta.ast.type as inmanta_type
-from inmanta import const, protocol
+from inmanta import const, protocol, util
 from inmanta.ast import (
     CompilerException,
     LocatableString,
     Location,
     Namespace,
     Range,
     RuntimeException,
@@ -121,28 +122,28 @@
         return self.__class__.__get_client()
 
     def get_sync_client(self) -> "protocol.SyncClient":
         if self.__class__.__sync_client is None:
             self.__class__.__sync_client = protocol.SyncClient("compiler")
         return self.__class__.__sync_client
 
-    def run_sync(self, function: Callable[..., T], timeout: int = 5) -> T:
+    def run_sync(self, function: Callable[[], abc.Awaitable[T]], timeout: int = 5) -> T:
         """
-        Execute the async function and return its result. This method takes care of starting and stopping the ioloop. The
-        main use for this function is to use the inmanta internal rpc to communicate with the server.
+        Execute the async function and return its result. This method uses this thread's current (not running) event loop if
+        there is one, otherwise it creates a new one. The main use for this function is to use the inmanta internal rpc to
+        communicate with the server.
 
         :param function: The async function to execute. This function should return a yieldable object.
         :param timeout: A timeout for the async function.
         :return: The result of the async call.
         :raises ConnectionRefusedError: When the function timeouts this exception is raised.
         """
-        from tornado.ioloop import IOLoop, TimeoutError
-
+        with_timeout: abc.Awaitable[T] = asyncio.wait_for(function(), timeout)
         try:
-            return IOLoop.current().run_sync(function, timeout)
+            return util.ensure_event_loop().run_until_complete(with_timeout)
         except TimeoutError:
             raise ConnectionRefusedError()
 
 
 @stable_api
 class PluginMeta(type):
     """
@@ -186,30 +187,60 @@
                 for fq_name, plugin_class in cls.__functions.items()
                 if plugin_class.__module__ != top_level and not plugin_class.__module__.startswith(f"{top_level}.")
             }
         else:
             cls.__functions = {}
 
 
+class PluginArgument:
+    """
+    Represents the argument of an Inmanta plugin.
+    """
+
+    # Marker used to indicate that a plugin argument has no default value.
+    NO_DEFAULT_VALUE_SET = object()
+
+    def __init__(
+        self, arg_name: str, arg_type: object, is_kw_only_argument: bool, default_value: object = NO_DEFAULT_VALUE_SET
+    ) -> None:
+        self.arg_name = arg_name
+        self.arg_type = arg_type
+        self.is_kw_only_argument = is_kw_only_argument
+        self._default_value = default_value
+
+    @property
+    def default_value(self) -> Optional[object]:
+        if not self.has_default_value():
+            raise Exception("PluginArgument doesn't have a default value")
+        return self._default_value
+
+    def has_default_value(self) -> bool:
+        """
+        Return True iff this plugin argument has a default value set.
+        """
+        return self._default_value is not self.NO_DEFAULT_VALUE_SET
+
+
 class Plugin(NamedType, WithComment, metaclass=PluginMeta):
     """
     This class models a plugin that can be called from the language.
     """
 
     deprecated: bool = False
     replaced_by: Optional[str] = None
 
     def __init__(self, namespace: Namespace) -> None:
         self.ns = namespace
         self.namespace = namespace
 
-        self._context = -1
+        # The index of the Context attribute.
+        self._context: int = -1
         self._return = None
 
-        self.arguments: List[Tuple]
+        self.arguments: List[PluginArgument]
         if hasattr(self.__class__, "__function__"):
             self.arguments = self._load_signature(self.__class__.__function__)
         else:
             self.arguments = []
 
         self.new_statement = None
 
@@ -224,64 +255,81 @@
         if self.__class__.__function__.__doc__:
             self.comment = self.__class__.__function__.__doc__
 
         self.location = Location(filename, line)
 
     def normalize(self) -> None:
         self.resolver = self.namespace
-        self.argtypes = [self.to_type(x[1], self.namespace) for x in self.arguments]
+        self.argtypes = [self.to_type(arg.arg_type, self.namespace) for arg in self.arguments]
         self.returntype = self.to_type(self._return, self.namespace)
 
-    def _load_signature(self, function: Callable[..., object]) -> List[Tuple]:
+    def _load_signature(self, function: Callable[..., object]) -> List[PluginArgument]:
         """
         Load the signature from the given python function
         """
         arg_spec = inspect.getfullargspec(function)
+
+        # Calculate at which index the default values start (for the non-keyword-only attributes)
+        default_start_for_args: Optional[int]
         if arg_spec.defaults is not None:
-            default_start = len(arg_spec.args) - len(arg_spec.defaults)
+            default_start_for_args = len(arg_spec.args) - len(arg_spec.defaults)
         else:
-            default_start = None
+            default_start_for_args = None
 
-        arguments = []
-        for i in range(len(arg_spec.args)):
-            arg = arg_spec.args[i]
+        arguments: List[PluginArgument] = []
 
-            if arg not in arg_spec.annotations:
-                raise Exception("All arguments of plugin '%s' should be annotated" % function.__name__)
+        def process_kw_only_args(argument_name: str, annotation: object) -> PluginArgument:
+            if arg_spec.kwonlydefaults and argument_name in arg_spec.kwonlydefaults:
+                default_value = arg_spec.kwonlydefaults[argument_name]
+                return PluginArgument(argument_name, annotation, is_kw_only_argument=True, default_value=default_value)
+            else:
+                return PluginArgument(argument_name, annotation, is_kw_only_argument=True)
 
-            spec_type = arg_spec.annotations[arg]
-            if spec_type == Context:
-                self._context = i
+        def process_regular_args(index: int, argument_name: str, annotation: object) -> PluginArgument:
+            if default_start_for_args is not None and default_start_for_args <= index:
+                default_value = arg_spec.defaults[default_start_for_args - index]
+                return PluginArgument(argument_name, annotation, is_kw_only_argument=False, default_value=default_value)
             else:
-                if default_start is not None and default_start <= i:
-                    default_value = arg_spec.defaults[default_start - i]
+                return PluginArgument(argument_name, annotation, is_kw_only_argument=False)
 
-                    arguments.append((arg, spec_type, default_value))
+        def process_arg(index: int, argument_name: str, is_kwonly_arg: bool) -> None:
+            if argument_name not in arg_spec.annotations:
+                raise CompilerException(f"All arguments of plugin '{function.__name__}' should be annotated")
+            annotation = arg_spec.annotations[argument_name]
+            if annotation == Context:
+                self._context = index
+            else:
+                if is_kwonly_arg:
+                    plugin_argument = process_kw_only_args(argument_name, annotation)
                 else:
-                    arguments.append((arg, spec_type))
+                    plugin_argument = process_regular_args(index, argument_name, annotation)
+                arguments.append(plugin_argument)
+
+        # Process regular arguments
+        for i in range(len(arg_spec.args)):
+            process_arg(i, arg_spec.args[i], is_kwonly_arg=False)
+        # Process keyword-only arguments
+        for i in range(len(arg_spec.kwonlyargs)):
+            process_arg(i, arg_spec.kwonlyargs[i], is_kwonly_arg=True)
 
         if "return" in arg_spec.annotations:
             self._return = arg_spec.annotations["return"]
 
         return arguments
 
     def get_signature(self) -> str:
         """
         Generate the signature of this plugin
         """
         arg_list = []
         for arg in self.arguments:
-            if len(arg) == 3:
-                arg_list.append("%s: %s=%s" % (arg[0], arg[1], str(arg[2])))
-
-            elif len(arg) == 2:
-                arg_list.append("%s: %s" % (arg[0], arg[1]))
-
+            if arg.has_default_value():
+                arg_list.append("%s: %s=%s" % (arg.arg_name, arg.arg_type, str(arg.default_value)))
             else:
-                arg_list.append(arg[0])
+                arg_list.append("%s: %s" % (arg.arg_name, arg.arg_type))
 
         args = ", ".join(arg_list)
 
         if self._return is None:
             return "%s(%s)" % (self.__class__.__function_name__, args)
         return "%s(%s) -> %s" % (self.__class__.__function_name__, args, self._return)
 
@@ -341,58 +389,54 @@
         return isinstance(value, arg_type)
 
     def check_args(self, args: List[object], kwargs: Dict[str, object]) -> bool:
         """
         Check if the arguments of the call match the function signature
         """
         max_arg = len(self.arguments)
-        required_args = [x[0] for x in self.arguments if len(x) == 2]
-
         if len(args) + len(kwargs) > max_arg:
             raise Exception(
                 "Incorrect number of arguments for %s. Expected at most %d, got %d"
                 % (self.get_signature(), max_arg, len(args) + len(kwargs))
             )
-        present_kwargs: FrozenSet[str] = frozenset(kwargs.keys())
         # check for missing arguments
-        if len(args) < len(required_args):
-            required_kwargs: FrozenSet[str] = frozenset(arg[0] for arg in self.arguments[len(args) : len(required_args)])
-            if not required_kwargs.issubset(present_kwargs):
-                missing: FrozenSet[str] = required_kwargs.difference(present_kwargs)
-                raise RuntimeException(
-                    None,
-                    "Missing %d required arguments for %s(): %s"
-                    % (len(missing), self.__class__.__function_name__, ",".join(missing)),
-                )
-        present_positional_args: FrozenSet[str] = frozenset(arg[0] for arg in self.arguments[: len(args)])
+        required_args: FrozenSet[str] = frozenset(arg.arg_name for arg in self.arguments if not arg.has_default_value())
+        present_positional_args: FrozenSet[str] = frozenset(arg.arg_name for arg in self.arguments[: len(args)])
+        present_kwargs: FrozenSet[str] = frozenset(kwargs.keys())
+        missing_args = required_args.difference({*present_positional_args, *present_kwargs})
+        if missing_args:
+            raise RuntimeException(
+                None,
+                "Missing %d required arguments for %s(): %s"
+                % (len(missing_args), self.__class__.__function_name__, ",".join(missing_args)),
+            )
         # check for kwargs overlap with positional arguments
-        if not present_kwargs.isdisjoint(present_positional_args):
+        overlapping_args: FrozenSet[str] = present_kwargs.intersection(present_positional_args)
+        if overlapping_args:
             raise RuntimeException(
                 None,
-                "Multiple values for %s in %s()"
-                % (",".join(present_kwargs.intersection(present_positional_args)), self.__class__.__function_name__),
+                "Multiple values for %s in %s()" % (",".join(overlapping_args), self.__class__.__function_name__),
             )
 
-        def is_valid(expected_arg: Tuple[Optional[Type[object]], str], expected_type: Type[object], arg: object) -> bool:
+        def is_valid(expected_arg: PluginArgument, expected_type: Type[object], arg: object) -> bool:
             if isinstance(arg, Unknown):
                 return False
 
-            if expected_arg[0] is not None and not self._is_instance(arg, expected_type):
+            if not self._is_instance(arg, expected_type):
                 raise Exception(
-                    ("Invalid type for argument %d of '%s', it should be " "%s and %s given.")
-                    % (i + 1, self.__class__.__function_name__, expected_arg[1], arg.__class__.__name__)
+                    "Invalid type for argument %s of '%s', it should be %s and %s given."
+                    % (expected_arg.arg_name, self.__class__.__function_name__, expected_arg.arg_type, arg.__class__.__name__)
                 )
             return True
 
         for i in range(len(args)):
             if not is_valid(self.arguments[i], self.argtypes[i], args[i]):
                 return False
-        Argument = Tuple[str, ...]
-        arg_types: Dict[str, Tuple[Argument, Optional[inmanta_type.Type]]] = {
-            arg[0]: (arg, self.argtypes[i]) for i, arg in enumerate(self.arguments)
+        arg_types: Dict[str, Tuple[PluginArgument, Optional[inmanta_type.Type]]] = {
+            arg.arg_name: (arg, self.argtypes[i]) for i, arg in enumerate(self.arguments)
         }
         for k, v in kwargs.items():
             try:
                 (expected_arg, expected_type) = arg_types[k]
                 if not is_valid(expected_arg, expected_type, v):
                     return False
             except KeyError:
```

### Comparing `inmanta-core-8.3.0/src/inmanta/postgresproc.py` & `inmanta-core-9.3.0/src/inmanta/postgresproc.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/profile_mem.py` & `inmanta-core-9.3.0/src/inmanta/profile_mem.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/protocol/__init__.py` & `inmanta-core-9.3.0/src/inmanta/protocol/__init__.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/protocol/common.py` & `inmanta-core-9.3.0/src/inmanta/protocol/common.py`

 * *Files 1% similar despite different names*

```diff
@@ -354,20 +354,23 @@
     This class stores the information from a method definition
     """
 
     methods: Dict[str, List["MethodProperties"]] = defaultdict(list)
 
     @classmethod
     def register_method(cls, properties: "MethodProperties") -> None:
-        """Register new method properties. Multiple properties on a method is supported but versions have to be unique."""
-        current_list = [x.api_version for x in cls.methods[properties.function.__name__]]
-        if properties.api_version in current_list:
+        """
+        Register new method properties. Multiple properties on a method is supported but the (URL, API version) combination has
+        to be unique.
+        """
+        current_list = [(x.path, x.api_version) for x in cls.methods[properties.function.__name__]]
+        if (properties.path, properties.api_version) in current_list:
             raise Exception(
                 f"Method {properties.function.__name__} already has a "
-                f"method definition for api version {properties.api_version}"
+                f"method definition for api path {properties.path} and API version {properties.api_version}"
             )
 
         cls.methods[properties.function.__name__].append(properties)
 
     def __init__(
         self,
         function: MethodType,
@@ -418,14 +421,15 @@
         if api is None:
             api = not server_agent and not agent_server
 
         if validate_sid is None:
             validate_sid = agent_server and not api
 
         self._path = UrlPath(path)
+        self.path = path
         self._operation = operation
         self._reply = reply
         self._arg_options = arg_options
         self._timeout = timeout
         self._server_agent = server_agent
         self._api: bool = api
         self._agent_server = agent_server
```

### Comparing `inmanta-core-8.3.0/src/inmanta/protocol/decorators.py` & `inmanta-core-9.3.0/src/inmanta/protocol/decorators.py`

 * *Files 2% similar despite different names*

```diff
@@ -12,30 +12,30 @@
     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     See the License for the specific language governing permissions and
     limitations under the License.
 
     Contact: code@inmanta.com
 """
 import inspect
-from typing import Callable, Dict, List, Optional, TypeVar
+from typing import Callable, Dict, List, Optional, TypeVar, Union
 
 from inmanta import const
 from inmanta.types import Apireturn, HandlerType, MethodType
 
 from . import common
 
 FuncT = TypeVar("FuncT", bound=HandlerType)
 
 
 class handle(object):  # noqa: N801
     """
     Decorator for subclasses of an endpoint to handle protocol methods
 
     :param method: A subclass of method that defines the method
-    :param api_version: When specific this handler is only associated with a method of the specific api verision. If the
+    :param api_version: When specific this handler is only associated with a method of the specific api version. If the
                         version is not defined, the handler is not associated with a rest endpoint.
     :param kwargs: Map arguments in the message from one name to an other
     """
 
     def __init__(self, method: Callable[..., Apireturn], api_version: Optional[int] = None, **kwargs: str) -> None:
         self.method = method
         self.mapping: Dict[str, str] = kwargs
@@ -124,15 +124,15 @@
         common.MethodProperties.register_method(properties)
         return func
 
     return wrapper
 
 
 def typedmethod(
-    path: str,
+    path: Union[str, list[str]],
     operation: str = "POST",
     reply: bool = True,
     arg_options: Dict[str, common.ArgOption] = {},
     timeout: Optional[int] = None,
     server_agent: bool = False,
     api: Optional[bool] = None,
     agent_server: bool = False,
@@ -145,15 +145,15 @@
     enforce_auth: bool = True,
     varkw: bool = False,
 ) -> Callable[..., Callable]:
     """
     Decorator to identify a method as a RPC call. The arguments of the decorator are used by each transport to build
     and model the protocol.
 
-    :param path: The url path to use for this call. This path can contain parameter names of the function. These names
+    :param path: The url path(s) to use for this call. This path can contain parameter names of the function. These names
                  should be enclosed in < > brackets.
     :param operation: The type of HTTP operation (verb)
     :param timeout: nr of seconds before request it terminated
     :param api: This is a call from the client to the Server (True if not server_agent and not agent_server)
     :param server_agent: This is a call from the Server to the Agent (reverse http channel through long poll)
     :param agent_server: This is a call from the Agent to the Server
     :param validate_sid: This call requires a valid session, true by default if agent_server and not api
@@ -174,32 +174,34 @@
     :param enforce_auth: When set to true authentication is enforced on this endpoint. When set to false, authentication is not
                          enforced, even if auth is enabled.
     :param varkw: If true, additional arguments are allowed and will be dispatched to the handler. The handler is
                   responsible for the validation.
     """
 
     def wrapper(func: MethodT) -> MethodT:
-        properties = common.MethodProperties(
-            func,
-            path,
-            operation,
-            reply,
-            arg_options,
-            timeout,
-            server_agent,
-            api,
-            agent_server,
-            validate_sid,
-            client_types,
-            api_version,
-            api_prefix,
-            True,
-            True,
-            envelope_key,
-            strict_typing=strict_typing,
-            enforce_auth=enforce_auth,
-            varkw=varkw,
-        )
-        common.MethodProperties.register_method(properties)
+        paths = path if isinstance(path, list) else [path]
+        for current_path in paths:
+            properties = common.MethodProperties(
+                func,
+                current_path,
+                operation,
+                reply,
+                arg_options,
+                timeout,
+                server_agent,
+                api,
+                agent_server,
+                validate_sid,
+                client_types,
+                api_version,
+                api_prefix,
+                True,
+                True,
+                envelope_key,
+                strict_typing=strict_typing,
+                enforce_auth=enforce_auth,
+                varkw=varkw,
+            )
+            common.MethodProperties.register_method(properties)
         return func
 
     return wrapper
```

### Comparing `inmanta-core-8.3.0/src/inmanta/protocol/endpoints.py` & `inmanta-core-9.3.0/src/inmanta/protocol/endpoints.py`

 * *Files 4% similar despite different names*

```diff
@@ -11,27 +11,25 @@
     distributed under the License is distributed on an "AS IS" BASIS,
     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     See the License for the specific language governing permissions and
     limitations under the License.
 
     Contact: code@inmanta.com
 """
+import asyncio
 import inspect
 import logging
 import socket
 import uuid
 from asyncio import CancelledError, run_coroutine_threadsafe, sleep
-from collections import defaultdict
+from collections import abc, defaultdict
 from enum import Enum
-from typing import Any, Callable, Coroutine, Dict, Generator, List, Optional, Set, Tuple, Union  # noqa: F401
+from typing import Any, Callable, Coroutine, Dict, List, Optional, Set, Tuple
 from urllib import parse
 
-from tornado import ioloop
-from tornado.platform.asyncio import BaseAsyncIOLoop
-
 from inmanta import config as inmanta_config
 from inmanta import util
 from inmanta.protocol.common import UrlMethod
 from inmanta.util import TaskHandler
 
 from . import common
 from .rest import client
@@ -361,17 +359,15 @@
         methods = common.MethodProperties.methods[name]
 
         if self._version_match is VersionMatch.lowest:
             return min(methods, key=lambda x: x.api_version)
         elif self._version_match is VersionMatch.highest:
             return max(methods, key=lambda x: x.api_version)
         elif self._version_match is VersionMatch.exact:
-            for method in methods:
-                if method.api_version == self._exact_version:
-                    return method
+            return next((m for m in methods if m.api_version == self._exact_version), None)
 
         return None
 
     def __getattr__(self, name: str) -> Callable[..., Coroutine[Any, Any, common.Result]]:
         """
         Return a function that will call self._call with the correct method properties associated
         """
@@ -394,58 +390,54 @@
     """
 
     def __init__(
         self,
         name: Optional[str] = None,
         timeout: int = 120,
         client: Optional[Client] = None,
-        ioloop: Optional[ioloop.IOLoop] = None,
+        ioloop: Optional[asyncio.AbstractEventLoop] = None,
     ) -> None:
         """
         either name or client is required.
         they can not be used at the same time
 
         :param name: name of the configuration to use for this endpoint. The config section used is "{name}_rest_transport"
         :param client: the client to use for this sync_client
         :param timeout: http timeout on all requests
 
-        :param ioloop: the specific (running) ioloop to schedule this request on.
-        if no ioloop is passed,we assume there is no running ioloop in the context where this syncclient is used.
+        :param ioloop: the specific (running) ioloop to schedule this request on. The loop should run on a different thread
+            than the one the client methods are called on. If no ioloop is passed, we assume there is no running ioloop in the
+            context where this syncclient is used.
         """
         if (name is None) == (client is None):
             # Exactly one must be set
             raise Exception("Either name or client needs to be provided.")
 
         self.timeout = timeout
-        self._ioloop = ioloop
+        self._ioloop: Optional[asyncio.AbstractEventLoop] = ioloop
         if client is None:
             assert name is not None  # Make mypy happy
             self.name = name
             self._client = Client(name, self.timeout)
         else:
             self.name = client.name
             self._client = client
 
     def __getattr__(self, name: str) -> Callable[..., common.Result]:
         def async_call(*args: List[object], **kwargs: Dict[str, object]) -> common.Result:
-            method: Callable[..., Coroutine[Any, Any, common.Result]] = getattr(self._client, name)
-
-            def method_call() -> Coroutine[Any, Any, common.Result]:
-                return method(*args, **kwargs)
+            method: Callable[..., abc.Awaitable[common.Result]] = getattr(self._client, name)
+            with_timeout: abc.Awaitable[common.Result] = asyncio.wait_for(method(*args, **kwargs), self.timeout)
 
             try:
                 if self._ioloop is None:
-                    # No specific IOLoop if given, so we assume we can start one in this context
-                    return ioloop.IOLoop.current().run_sync(method_call, self.timeout)
+                    # no loop is running: create a loop for this thread if it doesn't exist already and run it
+                    return util.ensure_event_loop().run_until_complete(with_timeout)
                 else:
-                    # a specific IOloop is passed
-                    # we unwrap the tornado loop to get the native python loop
-                    # and safely tap into it using run_coroutine_threadsafe
-                    assert isinstance(self._ioloop, BaseAsyncIOLoop)  # make mypy happy
-                    return run_coroutine_threadsafe(method_call(), self._ioloop.asyncio_loop).result(self.timeout)
+                    # loop is running on different thread
+                    return run_coroutine_threadsafe(with_timeout, self._ioloop).result()
             except TimeoutError:
                 raise ConnectionRefusedError()
 
         return async_call
 
 
 class SessionClient(Client):
```

### Comparing `inmanta-core-8.3.0/src/inmanta/protocol/exceptions.py` & `inmanta-core-9.3.0/src/inmanta/protocol/exceptions.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/protocol/methods.py` & `inmanta-core-9.3.0/src/inmanta/protocol/methods.py`

 * *Files 2% similar despite different names*

```diff
@@ -245,37 +245,14 @@
     :param tid: The environment id
     :param client_types: The client types for which this token is valid (api, agent, compiler)
     :param idempotent: The token should be idempotent, such tokens do not have an expire or issued at set so their
                        value will not change.
     """
 
 
-#  Decomission an environment
-
-
-@method(
-    path="/decommission/<id>",
-    operation="POST",
-    arg_options={"id": ArgOption(getter=convert_environment)},
-    client_types=[const.ClientType.api],
-    api_version=1,
-)
-def decomission_environment(id: uuid.UUID, metadata: dict = None):
-    """
-    Decommision an environment. This is done by uploading an empty model to the server and let purge_on_delete handle
-    removal.
-
-    :param id: The uuid of the environment.
-    :param metadata: Optional metadata associated with the decommissioning
-
-    :raises NotFound: The given environment doesn't exist.
-    :raises Forbidden: The given environment is protected.
-    """
-
-
 @method(
     path="/decommission/<id>",
     operation="DELETE",
     arg_options={"id": ArgOption(getter=convert_environment)},
     client_types=[const.ClientType.api],
 )
 def clear_environment(id: uuid.UUID):
@@ -412,15 +389,15 @@
 def get_resource(
     tid: uuid.UUID, id: str, logs: bool = None, status: bool = None, log_action: const.ResourceAction = None, log_limit: int = 0
 ):
     """
     Return a resource with the given id.
 
     :param tid: The id of the environment this resource belongs to
-    :param id: Get the resource with the given id
+    :param id: Get the resource with the given resource version id
     :param logs: Include the logs in the response
     :param status: Only return the status of the resource
     :param log_action: The log action to include, leave empty/none for all actions. Valid actions are one of
                       the action strings in const.ResourceAction
     :param log_limit: Limit the number of logs included in the response, up to a maximum of 1000.
                       To retrieve more entries, use  /api/v2/resource_actions
                       (:func:`~inmanta.protocol.methods_v2.get_resource_actions`)
```

### Comparing `inmanta-core-8.3.0/src/inmanta/protocol/methods_v2.py` & `inmanta-core-9.3.0/src/inmanta/protocol/methods_v2.py`

 * *Files 3% similar despite different names*

```diff
@@ -22,15 +22,15 @@
 from typing import Dict, List, Literal, Optional, Union
 
 from inmanta.const import AgentAction, ApiDocsFormat, Change, ClientType, ResourceState
 from inmanta.data import model
 from inmanta.protocol.common import ReturnValue
 from inmanta.types import PrimitiveTypes
 
-from ..data.model import ResourceIdStr
+from ..data.model import DiscoveredResource, ResourceIdStr
 from . import methods
 from .decorators import typedmethod
 from .openapi.model import OpenAPI
 
 
 @typedmethod(
     path="/version/partial",
@@ -245,34 +245,14 @@
 
     :raises NotFound: The given environment doesn't exist.
     """
 
 
 @typedmethod(
     path="/decommission/<id>",
-    operation="POST",
-    arg_options={"id": methods.ArgOption(getter=methods.convert_environment)},
-    client_types=[ClientType.api],
-    api_version=2,
-)
-def environment_decommission(id: uuid.UUID, metadata: Optional[model.ModelMetadata] = None) -> int:
-    """
-    Decommission an environment. This is done by uploading an empty model to the server and let purge_on_delete handle
-    removal.
-
-    :param id: The uuid of the environment.
-    :param metadata: Optional metadata associated with the decommissioning
-
-    :raises NotFound: The given environment doesn't exist.
-    :raises Forbidden: The given environment is protected.
-    """
-
-
-@typedmethod(
-    path="/decommission/<id>",
     operation="DELETE",
     arg_options={"id": methods.ArgOption(getter=methods.convert_environment)},
     client_types=[ClientType.api],
     api_version=2,
 )
 def environment_clear(id: uuid.UUID) -> None:
     """
@@ -1373,7 +1353,90 @@
     """Change the password of a user
 
     :param username: The username of the user
     :param password: The password of this new user. The password should be at least 8 characters long.
     :raises NotFound: Raised when the user does not exist
     :raises BadRequest: Raised when server authentication is not enabled
     """
+
+
+@typedmethod(
+    path="/discovered/<discovered_resource_id>",
+    operation="POST",
+    agent_server=True,
+    arg_options=methods.ENV_OPTS,
+    client_types=[ClientType.agent],
+    api_version=2,
+    varkw=True,
+)
+def discovered_resource_create(
+    tid: uuid.UUID, discovered_resource_id: str, **kwargs: object  # bypass the type checking for the values
+) -> None:
+    """
+    create a discovered resource.
+    :param tid: The id of the environment this resource belongs to
+    :param discovered_resource_id: The id of the discovered_resource
+    :param **kwargs: The following arguments are supported:
+           values: The values associated with the discovered_resource
+    """
+
+
+@typedmethod(
+    path="/discovered/",
+    operation="POST",
+    agent_server=True,
+    arg_options=methods.ENV_OPTS,
+    client_types=[ClientType.agent],
+    api_version=2,
+)
+def discovered_resource_create_batch(tid: uuid.UUID, discovered_resources: List[DiscoveredResource]) -> None:
+    """
+    create multiple discovered resource in the DB
+    :param tid: The id of the environment this resource belongs to
+    :param discovered_resources: List of discovered_resources containing the discovered_resource_id and values for each resource
+    """
+
+
+@typedmethod(
+    path="/discovered/<discovered_resource_id>",
+    operation="GET",
+    arg_options=methods.ENV_OPTS,
+    client_types=[ClientType.api],
+    api_version=2,
+)
+def discovered_resources_get(tid: uuid.UUID, discovered_resource_id: ResourceIdStr) -> model.DiscoveredResource:
+    """
+    Get a single discovered resource.
+
+    :param tid: the id of the environment in which to get the discovered resource.
+    :param discovered_resource_id: The id of the discovered resource
+    """
+
+
+@typedmethod(
+    path="/discovered",
+    operation="GET",
+    arg_options=methods.ENV_OPTS,
+    client_types=[ClientType.api],
+    api_version=2,
+)
+def discovered_resources_get_batch(
+    tid: uuid.UUID,
+    limit: Optional[int] = None,
+    start: Optional[str] = None,
+    end: Optional[str] = None,
+    sort: str = "discovered_resource_id.asc",
+) -> List[model.DiscoveredResource]:
+    """
+    :param tid: The id of the environment this resource belongs to
+    :param limit: Limit the number of instances that are returned
+    :param start: The lower limit for the order by column (exclusive).
+                Only one of 'start' and 'end' should be specified at the same time.
+    :param end: The upper limit for the order by column (exclusive).
+                Only one of 'start' and 'end' should be specified at the same time.
+    :param sort: Return the results sorted according to the parameter value.
+            The following sorting attributes are supported: 'discovered_resource_id'.
+            The following orders are supported: 'asc', 'desc'
+    :return: A list of all matching released resources
+    :raise NotFound: This exception is raised when the referenced environment is not found
+    :raise BadRequest: When the parameters used for filtering, sorting or paging are not valid
+    """
```

### Comparing `inmanta-core-8.3.0/src/inmanta/protocol/openapi/__init__.py` & `inmanta-core-9.3.0/src/inmanta/protocol/openapi/__init__.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/protocol/openapi/converter.py` & `inmanta-core-9.3.0/src/inmanta/protocol/openapi/converter.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/protocol/openapi/model.py` & `inmanta-core-9.3.0/src/inmanta/protocol/openapi/model.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/protocol/rest/__init__.py` & `inmanta-core-9.3.0/src/inmanta/protocol/rest/__init__.py`

 * *Files 6% similar despite different names*

```diff
@@ -119,23 +119,42 @@
     def metadata(self) -> Dict[str, object]:
         if not self._processed:
             raise Exception("Process call first before accessing property")
 
         return self._metadata
 
     def _is_header_param(self, arg: str) -> bool:
+        """
+        Return True if the given call argument can be provided using a header parameter.
+        """
         if arg not in self._properties.arg_options:
             return False
 
         opts = self._properties.arg_options[arg]
+        return opts.header is not None
 
-        if opts.header is None:
-            return False
+    def _is_header_param_provided(self, arg: str) -> bool:
+        """
+        Return True iff a value for the given call argument was provided using a header parameter.
+
+        :raise Exception: The given call argument is not a header parameter.
+        """
+        value = self._get_header_value_for(arg)
+        return value is not None
 
-        return True
+    def _get_header_value_for(self, arg: str) -> Optional[str]:
+        """
+        Return the header value that belongs to the given call argument or None when the header was not set.
+
+        :raise Exception: The given call argument is not a header parameter.
+        """
+        if not self._is_header_param(arg):
+            raise Exception(f"Parameter {arg} is not a header parameter")
+        opts = self._properties.arg_options[arg]
+        return self._request_headers.get(opts.header)
 
     def _map_headers(self, arg: str) -> Optional[object]:
         if not self._is_header_param(arg):
             return None
 
         opts = self._properties.arg_options[arg]
         assert opts.header is not None
@@ -179,60 +198,69 @@
             args.remove("self")
 
         all_fields = set(self._message.keys())  # Track all processed fields to warn user
         defaults_start: int = -1
         if self._argspec.defaults is not None:
             defaults_start = len(args) - len(self._argspec.defaults)
 
+        # Make sure that an argument is not passed both using the header and a non-header value with a different value
+        for arg in args:
+            if arg in self._message and self._is_header_param(arg) and self._is_header_param_provided(arg):
+                message_value = self._message[arg]
+                header_value = self._get_header_value_for(arg)
+                if message_value != header_value:
+                    raise exceptions.BadRequest(
+                        f"Value for argument {arg} was provided via a header and a non-header argument, but both values"
+                        f" don't match (header={header_value}; non-header={message_value})"
+                    )
+
         call_args = {}
 
         for i, arg in enumerate(args):
-            # get value from headers, defaults or message
-            value = self._map_headers(arg)
-            if value is None:
-                if not self._is_header_param(arg):
-                    arg_type: Optional[Type[object]] = self._argspec.annotations.get(arg)
-                    if arg in self._message:
-                        if (
-                            arg_type
-                            and self._properties.operation == "GET"
-                            and typing_inspect.is_generic_type(arg_type)
-                            and issubclass(typing_inspect.get_origin(arg_type), list)
-                            and not isinstance(self._message[arg], list)
-                            and len(typing_inspect.get_args(arg_type, evaluate=True)) == 1
-                            and isinstance(self._message[arg], typing_inspect.get_args(arg_type)[0])
-                        ):
-                            # If a GET endpoint has a parameter of type list that is encoded as a URL query parameter and the
-                            # specific request provides a list with one element, urllib doesn't parse it as a list.
-                            # Map it here explicitly to a list.
-                            value = [self._message[arg]]
-                        else:
-                            value = self._message[arg]
-                        all_fields.remove(arg)
-                    # Pre-process dict params for GET
-                    elif arg_type and self._properties.operation == "GET" and self._is_dict_or_optional_dict(arg_type):
-                        dict_prefix = f"{arg}."
-                        dict_with_prefixed_names = {
-                            param_name: param_value
-                            for param_name, param_value in self._message.items()
-                            if param_name.startswith(dict_prefix) and len(param_name) > len(dict_prefix)
-                        }
-                        value = (
-                            await self._get_dict_value_from_message(arg, dict_prefix, dict_with_prefixed_names)
-                            if dict_with_prefixed_names
-                            else None
-                        )
-
-                        for key in dict_with_prefixed_names.keys():
-                            all_fields.remove(key)
-
-                    else:  # get default value
-                        value = self.get_default_value(arg, i, defaults_start)
-                else:  # get default value
+            arg_type: Optional[Type[object]] = self._argspec.annotations.get(arg)
+            if arg in self._message:
+                # Argument is parameter in body of path of HTTP request
+                if (
+                    arg_type
+                    and self._properties.operation == "GET"
+                    and typing_inspect.is_generic_type(arg_type)
+                    and issubclass(typing_inspect.get_origin(arg_type), list)
+                    and not isinstance(self._message[arg], list)
+                    and len(typing_inspect.get_args(arg_type, evaluate=True)) == 1
+                    and isinstance(self._message[arg], typing_inspect.get_args(arg_type)[0])
+                ):
+                    # If a GET endpoint has a parameter of type list that is encoded as a URL query parameter and the
+                    # specific request provides a list with one element, urllib doesn't parse it as a list.
+                    # Map it here explicitly to a list.
+                    value = [self._message[arg]]
+                else:
+                    value = self._message[arg]
+                all_fields.remove(arg)
+            elif arg_type and self._properties.operation == "GET" and self._is_dict_or_optional_dict(arg_type):
+                # Argument is dictionary-based expression in query parameters of GET operation
+                dict_prefix = f"{arg}."
+                dict_with_prefixed_names = {
+                    param_name: param_value
+                    for param_name, param_value in self._message.items()
+                    if param_name.startswith(dict_prefix) and len(param_name) > len(dict_prefix)
+                }
+                value = (
+                    await self._get_dict_value_from_message(arg, dict_prefix, dict_with_prefixed_names)
+                    if dict_with_prefixed_names
+                    else None
+                )
+
+                for key in dict_with_prefixed_names.keys():
+                    all_fields.remove(key)
+            elif self._is_header_param(arg):
+                value = self._map_headers(arg)
+                if value is None:
                     value = self.get_default_value(arg, i, defaults_start)
+            else:
+                value = self.get_default_value(arg, i, defaults_start)
 
             call_args[arg] = value
 
         # validate types
         call_args = self._properties.validate_arguments(call_args)
 
         for arg, value in call_args.items():
```

### Comparing `inmanta-core-8.3.0/src/inmanta/protocol/rest/client.py` & `inmanta-core-9.3.0/src/inmanta/protocol/rest/client.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/protocol/rest/server.py` & `inmanta-core-9.3.0/src/inmanta/protocol/rest/server.py`

 * *Files 2% similar despite different names*

```diff
@@ -154,14 +154,15 @@
                 self.respond({"message": error_message}, {}, 400)
 
             except ValueError:
                 LOGGER.exception("An exception occured")
                 self.respond({"message": "Unable to decode request body"}, {}, 400)
 
             except exceptions.BaseHttpException as e:
+                LOGGER.warning("Received an exception with status code %d and message %s", e.to_status(), e.to_body())
                 self.respond(e.to_body(), {}, e.to_status())
 
             except CancelledError:
                 self.respond({"message": "Request is cancelled on the server"}, {}, 500)
 
             finally:
                 try:
```

### Comparing `inmanta-core-8.3.0/src/inmanta/protocol/return_value_meta.py` & `inmanta-core-9.3.0/src/inmanta/protocol/return_value_meta.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/reporter.py` & `inmanta-core-9.3.0/src/inmanta/reporter.py`

 * *Files 3% similar despite different names*

```diff
@@ -42,26 +42,29 @@
     def __init__(self, registry: Optional[MetricsRegistry] = None, reporting_interval: int = 30) -> None:
         self.registry = registry or global_registry()
         self.reporting_interval = reporting_interval
         self._stopped = False
         self._handle: Optional[Task[None]] = None
 
     def start(self) -> bool:
+        """
+        Starts the reporter loop. Expects to be called in a context with a running event loop.
+        """
         if self._stopped:
             return False
-        self._handle = asyncio.get_event_loop().create_task(self._loop())
+        self._handle = asyncio.get_running_loop().create_task(self._loop())
         return True
 
     def stop(self) -> None:
         self._stopped = True
         if self._handle is not None:
             self._handle.cancel()
 
     async def _loop(self) -> None:
-        loop = asyncio.get_event_loop()
+        loop = asyncio.get_running_loop()
         next_loop_time = loop.time()
         while not self._stopped:
             try:
                 await self.report_now(self.registry)
             except Exception:
                 LOGGER.warning("Could not send metrics report", exc_info=True)
             next_loop_time += self.reporting_interval
```

### Comparing `inmanta-core-8.3.0/src/inmanta/resources.py` & `inmanta-core-9.3.0/src/inmanta/resources.py`

 * *Files 2% similar despite different names*

```diff
@@ -70,14 +70,16 @@
     :param id_attribute: The attribute of `this` resource that uniquely identifies a resource on an agent. This attribute
                          can be mapped.
     :param agent: This string indicates how the agent of this resource is determined. This string points to an attribute,
                   but it can navigate relations (this value cannot be mapped). For example, the agent argument could be
                   ``host.name``
     """
 
+    # The _resources dict is accessed by the compile function in pytest-inmanta.
+    # see https://github.com/inmanta/pytest-inmanta/pull/381
     _resources: Dict[str, Tuple[Type["Resource"], Dict[str, str]]] = {}
 
     def __init__(self, name: str, id_attribute: str, agent: str):
         if not isinstance(agent, str):
             raise ResourceException(f"The agent parameter has to be a string, got {agent} of type {type(agent)}")
         self._cls_name = name
         self._options = {"agent": agent, "name": id_attribute}
@@ -374,25 +376,26 @@
             if field in RESERVED_FOR_RESOURCE:
                 raise ResourceException(
                     "Resource %s is a reserved keyword and not a valid field name, reported in %s" % (field, cls.__name__)
                 )
 
     def __init__(self, _id: "Id") -> None:
         self.id = _id
-        self.version = 0
         self.requires: Set[Id] = set()
         self.resource_requires: Set[Resource] = set()
         self.unknowns: Set[str] = set()
 
         if not hasattr(self.__class__, "fields"):
             raise Exception("A resource should have a list of fields")
 
         for field in self.__class__.fields:
             setattr(self, field, None)
 
+        self.version = _id.version
+
     def populate(self, fields: Dict[str, Any], force_fields: bool = False) -> None:
         for field in self.__class__.fields:
             if field in fields or force_fields:
                 setattr(self, field, fields[field])
             else:
                 raise Exception("Resource with id %s does not have field %s" % (fields["id"], field))
         if "requires" in fields:
@@ -625,14 +628,22 @@
     def is_resource_version_id(cls, value: str) -> bool:
         """
         Check whether the given value is a resource version id
         """
         result = PARSE_RVID_REGEX.search(value)
         return result is not None
 
+    @classmethod
+    def is_resource_id(cls, value: str) -> bool:
+        """
+        Check whether the given value is a resource id
+        """
+        result = PARSE_ID_REGEX.search(value)
+        return result is not None
+
     def is_resource_version_id_obj(self) -> bool:
         """
         Check whether this object represents a resource version id
         """
         return self.version != 0
 
     @classmethod
```

### Comparing `inmanta-core-8.3.0/src/inmanta/server/__init__.py` & `inmanta-core-9.3.0/src/inmanta/server/__init__.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/server/agentmanager.py` & `inmanta-core-9.3.0/src/inmanta/server/agentmanager.py`

 * *Files 0% similar despite different names*

```diff
@@ -26,14 +26,15 @@
 from enum import Enum
 from typing import Any, Dict, Iterable, List, Optional, Sequence, Set, Tuple, Union, cast
 from uuid import UUID
 
 import asyncpg.connection
 
 from inmanta import const, data, util
+from inmanta.agent import config as agent_cfg
 from inmanta.config import Config
 from inmanta.const import AgentAction, AgentStatus
 from inmanta.data import APILIMIT, InvalidSort, model
 from inmanta.data.model import ResourceIdStr
 from inmanta.protocol import encode_token, handle, methods, methods_v2
 from inmanta.protocol.common import ReturnValue
 from inmanta.protocol.exceptions import BadRequest, Forbidden, NotFound, ShutdownInProgress
@@ -406,18 +407,18 @@
     ) -> None:
         """
         Note: This method call is allowed to fail when the database connection is lost.
         """
         now = datetime.now().astimezone()
         async with data.AgentProcess.get_connection() as connection:
             async with connection.transaction():
+                await data.AgentProcess.update_last_seen(session.id, now, connection)
                 await data.AgentInstance.log_instance_creation(session.tid, session.id, endpoints_to_add, connection)
                 await data.AgentInstance.log_instance_expiry(session.id, endpoints_to_remove, now, connection)
                 await data.Agent.update_primary(session.tid, endpoints_with_new_primary, now, connection)
-                await data.AgentProcess.update_last_seen(session.id, now, connection)
 
     # Session registration
     async def _register_session(self, session: protocol.Session, endpoint_names_snapshot: Set[str], now: datetime) -> None:
         """
         This method registers a new session in memory and asynchronously updates the agent
         session log in the database. When the database connection is lost, the get_statuses()
         call fails and the new session will be refused.
@@ -1191,27 +1192,30 @@
 environment=%(env_id)s
 
 agent-deploy-splay-time=%(agent_deploy_splay)d
 agent-deploy-interval=%(agent_deploy_interval)d
 agent-repair-splay-time=%(agent_repair_splay)d
 agent-repair-interval=%(agent_repair_interval)d
 
+agent-get-resource-backoff=%(agent_get_resource_backoff)f
+
 [agent_rest_transport]
 port=%(port)s
 host=%(serveradress)s
 """ % {
             "agents": ",".join(agent_names),
             "env_id": environment_id,
             "port": port,
             "statedir": privatestatedir,
             "agent_deploy_splay": agent_deploy_splay,
             "agent_deploy_interval": agent_deploy_interval,
             "agent_repair_splay": agent_repair_splay,
             "agent_repair_interval": agent_repair_interval,
             "serveradress": server_config.server_address.get(),
+            "agent_get_resource_backoff": agent_cfg.agent_get_resource_backoff.get(),
         }
 
         if server_config.server_enable_auth.get():
             token = encode_token(["agent"], environment_id)
             config += """
 token=%s
     """ % (
```

### Comparing `inmanta-core-8.3.0/src/inmanta/server/bootloader.py` & `inmanta-core-9.3.0/src/inmanta/server/bootloader.py`

 * *Files 5% similar despite different names*

```diff
@@ -183,15 +183,17 @@
         """
         if not hasattr(ext_mod, "setup"):
             raise PluginLoadFailed("extension.py doesn't have a setup method.")
 
     def _load_extensions(self, load_all_extensions: bool = False) -> Dict[str, ModuleType]:
         """Discover all extensions, validate correct naming and load its setup function"""
         plugins: Dict[str, ModuleType] = {}
-        for name in self._discover_plugin_packages(load_all_extensions):
+        enabled_extensions: List[str] = self._discover_plugin_packages(load_all_extensions)
+        LOGGER.info("Enabled extensions: %s", ", ".join(enabled_extensions))
+        for name in enabled_extensions:
             try:
                 module = self._load_extension(name)
                 assert name.startswith(f"{EXTENSION_NAMESPACE}.")
                 name = name[len(EXTENSION_NAMESPACE) + 1 :]
                 plugins[name] = module
             except PluginLoadFailed:
                 LOGGER.warning("Could not load extension %s", name, exc_info=True)
```

### Comparing `inmanta-core-8.3.0/src/inmanta/server/compilerservice.py` & `inmanta-core-9.3.0/src/inmanta/server/compilerservice.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/server/config.py` & `inmanta-core-9.3.0/src/inmanta/server/config.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/server/diff.py` & `inmanta-core-9.3.0/src/inmanta/server/diff.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/server/extensions.py` & `inmanta-core-9.3.0/src/inmanta/server/extensions.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/server/protocol.py` & `inmanta-core-9.3.0/src/inmanta/server/protocol.py`

 * *Files 2% similar despite different names*

```diff
@@ -17,22 +17,21 @@
 """
 import asyncio
 import logging
 import socket
 import time
 import uuid
 from collections import defaultdict
+from datetime import timedelta
 from typing import TYPE_CHECKING, Callable, Dict, List, Optional, Sequence, Set, Tuple, Union
 
 import importlib_metadata
 from tornado import gen, queues, routing, web
-from tornado.ioloop import IOLoop
 
 import inmanta.protocol.endpoints
-from inmanta import config as inmanta_config
 from inmanta.data.model import ExtensionStatus
 from inmanta.protocol import Client, common, endpoints, handle, methods
 from inmanta.protocol.exceptions import ShutdownInProgress
 from inmanta.protocol.rest import server
 from inmanta.server import SLICE_SESSION_MANAGER, SLICE_TRANSPORT
 from inmanta.server import config as opt
 from inmanta.types import ArgumentTypes, JsonType
@@ -95,15 +94,14 @@
 # Server Side
 class Server(endpoints.Endpoint):
     def __init__(self, connection_timout: int = 120) -> None:
         super().__init__("server")
         self._slices: Dict[str, ServerSlice] = {}
         self._slice_sequence: Optional[List[ServerSlice]] = None
         self._handlers: List[routing.Rule] = []
-        self.token: Optional[str] = inmanta_config.Config.get(self.id, "token", None)
         self.connection_timout = connection_timout
         self.sessions_handler = SessionManager()
         self.add_slice(self.sessions_handler)
 
         self._transport = server.RESTServer(self.sessions_handler, self.id)
         self.add_slice(TransportSlice(self))
         self.running = False
@@ -301,24 +299,31 @@
 
     def get_handlers(self) -> List[routing.Rule]:
         """Get the list of"""
         return self._handlers
 
     # utility methods for extensions developers
     def schedule(
-        self, call: TaskMethod, interval: int = 60, initial_delay: Optional[float] = None, cancel_on_stop: bool = True
+        self,
+        call: TaskMethod,
+        interval: float = 60,
+        initial_delay: Optional[float] = None,
+        cancel_on_stop: bool = True,
+        quiet_mode: bool = False,
     ) -> None:
         """
         Schedule a task repeatedly with a given interval. Tasks with the same call and the same schedule are considered the
         same. Clients that wish to be able to delete tasks should make sure to use a unique `call` function.
 
         :param interval: The interval between executions of the task.
         :param initial_delay: The delay to execute the task for the first time. If not set, interval is used.
+        :quiet_mode: Set to true to disable logging the recurring notification that the action is being called. Use this to
+        avoid polluting the server log for very frequent actions.
         """
-        self._sched.add_action(call, IntervalSchedule(float(interval), initial_delay), cancel_on_stop)
+        self._sched.add_action(call, IntervalSchedule(interval, initial_delay), cancel_on_stop, quiet_mode)
 
     def schedule_cron(self, call: TaskMethod, cron: str, cancel_on_stop: bool = True) -> None:
         """
         Schedule a task according to a cron specifier. Tasks with the same call and the same schedule are considered the same.
         Clients that wish to be able to delete tasks should make sure to use a unique `call` function.
 
         :param cron: The cron specifier to schedule the task by.
@@ -395,15 +400,15 @@
     def define_features(self) -> List["Feature[object]"]:
         """Return a list of feature that this slice offers"""
         return []
 
 
 class Session(object):
     """
-    An environment that segments agents connected to the server
+    An environment that segments agents connected to the server. Should only be created in a context with a running event loop.
     """
 
     def __init__(
         self,
         sessionstore: "SessionManager",
         sid: uuid.UUID,
         hang_interval: int,
@@ -414,15 +419,15 @@
         disable_expire_check: bool = False,
     ) -> None:
         self._sid = sid
         self._interval = hang_interval
         self._timeout = timout
         self._sessionstore: SessionManager = sessionstore
         self._seen: float = time.time()
-        self._callhandle = None
+        self._callhandle: Optional[asyncio.TimerHandle] = None
         self.expired: bool = False
 
         self.tid: uuid.UUID = tid
         self.endpoint_names: Set[str] = endpoint_names
         self.nodename: str = nodename
 
         self._replies: Dict[uuid.UUID, asyncio.Future] = {}
@@ -438,27 +443,27 @@
         if self.expired:
             LOGGER.exception("Tried to expire session already expired")
         ttw = self._timeout + self._seen - time.time()
         if ttw < 0:
             expire_coroutine = self.expire(self._seen - time.time())
             self._sessionstore.add_background_task(expire_coroutine)
         else:
-            self._callhandle = IOLoop.current().call_later(ttw, self.check_expire)
+            self._callhandle = asyncio.get_running_loop().call_later(ttw, self.check_expire)
 
     def get_id(self) -> uuid.UUID:
         return self._sid
 
     id = property(get_id)
 
     async def expire(self, timeout: float) -> None:
         if self.expired:
             return
         self.expired = True
         if self._callhandle is not None:
-            IOLoop.current().remove_timeout(self._callhandle)
+            self._callhandle.cancel()
         await self._sessionstore.expire(self, timeout)
 
     def seen(self, endpoint_names: Set[str]) -> None:
         self._seen = time.time()
         self.endpoint_names = endpoint_names
 
     async def _handle_timeout(self, future: asyncio.Future, timeout: int, log_message: str) -> None:
@@ -498,19 +503,21 @@
         Get all calls queued for a node. If no work is available, wait until timeout. This method returns none if a call
         fails.
         """
         try:
             call_list: List[common.Request] = []
 
             if no_hang:
-                timeout = IOLoop.current().time() + 0.1
+                timeout = 0.1
             else:
-                timeout = IOLoop.current().time() + self._interval
-
-            call = await self._queue.get(timeout=timeout)
+                timeout = self._interval if self._interval > 0.1 else 0.1
+                # We choose to have a minimum of 0.1 as timeout as this is also the value used for no_hang.
+                # Furthermore, the timeout value cannot be zero as this causes an issue with Tornado:
+                # https://github.com/tornadoweb/tornado/issues/3271
+            call = await self._queue.get(timeout=timedelta(seconds=timeout))
             if call is None:
                 # aborting session
                 return None
             call_list.append(call)
             while self._queue.qsize() > 0:
                 call = await self._queue.get()
                 if call is None:
```

### Comparing `inmanta-core-8.3.0/src/inmanta/server/server.py` & `inmanta-core-9.3.0/src/inmanta/server/server.py`

 * *Files 5% similar despite different names*

```diff
@@ -11,14 +11,15 @@
     distributed under the License is distributed on an "AS IS" BASIS,
     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     See the License for the specific language governing permissions and
     limitations under the License.
 
     Contact: code@inmanta.com
 """
+import asyncio
 import json
 import logging
 import os
 import uuid
 from typing import TYPE_CHECKING, Dict, List, Optional, Union, cast
 
 from tornado import routing, web
@@ -124,23 +125,35 @@
         product_metadata = self.feature_manager.get_product_metadata()
         if product_metadata.version is None:
             raise exceptions.ServerError(
                 "Could not find version number for the inmanta compiler."
                 "Is inmanta installed? Use setuptools install or setuptools dev to install."
             )
 
-        slices = []
-        for slice_name, slice in self._server.get_slices().items():
+        async def collect_for_slice(slice_name: str, slice: protocol.ServerSlice) -> SliceStatus:
             try:
-                slices.append(SliceStatus(name=slice_name, status=await slice.get_status()))
+                return SliceStatus(name=slice_name, status=await asyncio.wait_for(slice.get_status(), 0.1))
+            except asyncio.TimeoutError:
+                return SliceStatus(
+                    name=slice_name,
+                    status={
+                        "error": f"timeout on data collection for {slice_name}, "
+                        "consult the server log for additional information"
+                    },
+                )
             except Exception:
                 LOGGER.error(
                     f"The following error occured while trying to determine the status of slice {slice_name}",
                     exc_info=True,
                 )
+                return SliceStatus(name=slice_name, status={"error": "An unexpected error occurred, reported to server log"})
+
+        slices = await asyncio.gather(
+            *(collect_for_slice(slice_name, slice) for slice_name, slice in self._server.get_slices().items())
+        )
 
         response = StatusResponse(
             product=product_metadata.product,
             edition=product_metadata.edition,
             version=product_metadata.version,
             license=product_metadata.license,
             extensions=self.get_extension_statuses(list(self._server.get_slices().values())),
```

### Comparing `inmanta-core-8.3.0/src/inmanta/server/services/__init__.py` & `inmanta-core-9.3.0/src/inmanta/server/services/__init__.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/server/services/codeservice.py` & `inmanta-core-9.3.0/src/inmanta/server/services/codeservice.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/server/services/compilerservice.py` & `inmanta-core-9.3.0/src/inmanta/server/services/compilerservice.py`

 * *Files 4% similar despite different names*

```diff
@@ -24,36 +24,37 @@
 import re
 import subprocess
 import traceback
 import uuid
 from asyncio import CancelledError, Task
 from asyncio.subprocess import Process
 from collections.abc import Mapping
-from functools import partial
 from itertools import chain
 from logging import Logger
 from tempfile import NamedTemporaryFile
 from typing import AsyncIterator, Awaitable, Dict, Hashable, List, Optional, Sequence, Tuple, cast
 
 import dateutil
 import dateutil.parser
 import pydantic
+from asyncpg import Connection
 
 import inmanta.data.model as model
 from inmanta import config, const, data, protocol, server
 from inmanta.config import Config
 from inmanta.data import APILIMIT, InvalidSort
 from inmanta.data.dataview import CompileReportView
 from inmanta.env import PipCommandBuilder, PythonEnvironment, VenvCreationFailedError, VirtualEnv
 from inmanta.protocol import encode_token, methods, methods_v2
 from inmanta.protocol.common import ReturnValue
 from inmanta.protocol.exceptions import BadRequest, NotFound
 from inmanta.server import SLICE_COMPILER, SLICE_DATABASE, SLICE_ENVIRONMENT, SLICE_SERVER, SLICE_TRANSPORT
 from inmanta.server import config as opt
 from inmanta.server.protocol import ServerSlice
+from inmanta.server.services import environmentservice
 from inmanta.server.validate_filter import InvalidFilter
 from inmanta.types import Apireturn, ArgumentTypes, JsonType, Warnings
 from inmanta.util import TaskMethod, ensure_directory_exist
 
 RETURNCODE_INTERNAL_ERROR = -1
 
 LOGGER: Logger = logging.getLogger(__name__)
@@ -220,16 +221,14 @@
     async def run(self, force_update: Optional[bool] = False) -> Tuple[bool, Optional[model.CompileData]]:
         """
         Runs this compile run.
 
         :return: Tuple of a boolean representing success and the compile data, if any.
         """
         success = False
-        now = datetime.datetime.now().astimezone()
-        await self.request.update_fields(started=now)
 
         compile_data_json_file = NamedTemporaryFile()
         try:
             await self._start_stage("Init", "")
 
             environment_id = self.request.environment
             project_dir = self._project_dir
@@ -468,15 +467,15 @@
                         await warn(
                             "Failed to parse compile data for compile %s. Json does not match CompileData model: '%s'"
                             % (self.request.id, compile_data_json)
                         )
             return success, None
 
 
-class CompilerService(ServerSlice):
+class CompilerService(ServerSlice, environmentservice.EnvironmentListener):
     """
     Compiler services offers:
 
     1. service slice API for lifecyclemanagement
     2. internal api for requesting compiles: :meth:`~CompilerService.request_recompile`
     3. internal api for watching complete compiles: :meth:`~CompilerService.add_listener`
     4. api endpoints: is_compiling, get_report, get_reports
@@ -501,16 +500,18 @@
 
     def __init__(self) -> None:
         super(CompilerService, self).__init__(SLICE_COMPILER)
         self._recompiles: Dict[uuid.UUID, Task] = {}
         self._global_lock = asyncio.locks.Lock()
         self.listeners: List[CompileStateListener] = []
         self._scheduled_full_compiles: Dict[uuid.UUID, Tuple[TaskMethod, str]] = {}
-        # cache the queue count for DB-less and lock-less access to number of tasks
+        # In-memory cache to keep track of the total length of all the compile queues on this Inmanta server.
+        # This cache is used by the /serverstatus endpoint.
         self._queue_count_cache: int = 0
+        self._queue_count_cache_lock = asyncio.locks.Lock()
 
     async def get_status(self) -> Dict[str, ArgumentTypes]:
         return {"task_queue": self._queue_count_cache, "listeners": len(self.listeners)}
 
     def add_listener(self, listener: CompileStateListener) -> None:
         self.listeners.append(listener)
 
@@ -557,45 +558,70 @@
             del self._scheduled_full_compiles[env.id]
         # set up new schedule
         if schedule_cron:
             metadata: Dict[str, str] = {
                 "type": "schedule",
                 "message": "Full recompile triggered by AUTO_FULL_COMPILE cron schedule",
             }
-            recompile: TaskMethod = partial(
-                self.request_recompile, env, force_update=False, do_export=True, remote_id=uuid.uuid4(), metadata=metadata
-            )
-            self.schedule_cron(recompile, schedule_cron, cancel_on_stop=False)
-            self._scheduled_full_compiles[env.id] = (recompile, schedule_cron)
+
+            async def _request_recompile_task() -> Tuple[Optional[uuid.UUID], Warnings]:
+                """
+                Creates a new task for the full compile schedule.
+                If the environment is halted, the task does nothing.
+                Otherwise, it requests a recompile.
+                """
+                latest_env = await data.Environment.get_by_id(env.id)
+                if not latest_env or latest_env.halted:
+                    return None, []
+
+                return await self.request_recompile(
+                    env,
+                    force_update=False,
+                    do_export=True,
+                    remote_id=uuid.uuid4(),
+                    metadata=metadata,
+                )
+
+            self.schedule_cron(_request_recompile_task, schedule_cron, cancel_on_stop=False)
+            self._scheduled_full_compiles[env.id] = (_request_recompile_task, schedule_cron)
 
     async def request_recompile(
         self,
         env: data.Environment,
         force_update: bool,
         do_export: bool,
         remote_id: uuid.UUID,
         metadata: Optional[JsonType] = None,
         env_vars: Optional[Mapping[str, str]] = None,
         partial: bool = False,
         removed_resource_sets: Optional[List[str]] = None,
         exporter_plugin: Optional[str] = None,
         notify_failed_compile: Optional[bool] = None,
         failed_compile_message: Optional[str] = None,
+        in_db_transaction: bool = False,
+        connection: Optional[Connection] = None,
     ) -> Tuple[Optional[uuid.UUID], Warnings]:
         """
         Recompile an environment in a different thread and taking wait time into account.
 
         :param notify_failed_compile: if set to True, errors during compilation will be notified using the
-        "failed_compile_message".
-        if set to false, nothing will be notified. If not set then the default notifications are
-        sent (failed pull stage and errors during the do_export)
+                                      "failed_compile_message".
+                                      if set to false, nothing will be notified. If not set then the default notifications are
+                                      sent (failed pull stage and errors during the do_export)
         :param failed_compile_message: the message used in notifications if notify_failed_compile is set to True.
+        :param connection: Perform the database changes using this database connection.
+        :param in_db_transaction: If set to True, the connection must be provided and the connection must be part of an ongoing
+                                  database transaction. If this parameter is set to True, is required to call
+                                  `CompileService.notify_compile_request_committed()` right after the transaction commits.
         :return: the compile id of the requested compile and any warnings produced during the request
-
         """
+        if in_db_transaction and not connection:
+            raise Exception("A connection should be provided when in_db_transaction is True.")
+        if in_db_transaction and connection and not connection.is_in_transaction():
+            raise Exception("in_db_transaction is True, but the given connection is not executing a transaction.")
         if removed_resource_sets is None:
             removed_resource_sets = []
         if metadata is None:
             metadata = {}
         if env_vars is None:
             env_vars = {}
 
@@ -616,18 +642,45 @@
             environment_variables=env_vars,
             partial=partial,
             removed_resource_sets=removed_resource_sets,
             exporter_plugin=exporter_plugin,
             notify_failed_compile=notify_failed_compile,
             failed_compile_message=failed_compile_message,
         )
-        await compile.insert()
-        await self._queue(compile)
+        if not in_db_transaction:
+            async with self._queue_count_cache_lock:
+                await compile.insert(connection)
+                self._queue_count_cache += 1
+            await self._queue(compile)
+        else:
+            # We are running inside a transaction. The changes will only be applied after the transaction commits.
+            # We cannot increment the queue count yet or schedule the requested compile for execution. This will be
+            # done when the notify_compile_request_committed() method is invoked.
+            await compile.insert(connection)
+
         return compile.id, None
 
+    async def notify_compile_request_committed(self, compile_id: uuid.UUID) -> None:
+        """
+        This method must be called when the `request_recompile()` method was called with in_db_transaction=True. It must be
+        called right after the transaction committed. If the transaction was aborted, this method most not be called.
+
+        This method is safe with respect to server restarts. If the server restarts after the transaction was committed,
+        but before this method was invoked, the server will automatically recover from this and run the requested compile
+        without any need to call this method.
+        """
+        compile_obj: Optional[data.Compile] = await data.Compile.get_by_id(compile_id)
+        if not compile_obj:
+            raise Exception(f"Compile with id {compile_id} not found.")
+        async with self._queue_count_cache_lock:
+            self._queue_count_cache += 1
+        async with self._global_lock:
+            if compile_obj.environment not in self._recompiles:
+                await self.process_next_compile_in_queue(compile_obj.environment)
+
     @staticmethod
     def _compile_merge_key(c: data.Compile) -> Hashable:
         """
         Returns a key used to determine whether two compiles c1 and c2 are eligible for merging. They are iff
         _compile_merge_key(c1) == _compile_merge_key(c2).
         """
         return c.to_dto().json(
@@ -641,32 +694,34 @@
             env: Optional[data.Environment] = await data.Environment.get_by_id(compile.environment)
             if env is None:
                 raise Exception("Can't queue compile: environment %s does not exist" % compile.environment)
             assert env is not None
             # don't execute any compiles in a halted environment
             if env.halted:
                 return
-            self._queue_count_cache += 1
             if compile.environment not in self._recompiles or self._recompiles[compile.environment].done():
                 task = self.add_background_task(self._run(compile))
                 self._recompiles[compile.environment] = task
 
     async def _dequeue(self, environment: uuid.UUID) -> None:
         async with self._global_lock:
-            if self.is_stopping():
-                return
-            env: Optional[data.Environment] = await data.Environment.get_by_id(environment)
-            if env is None:
-                raise Exception("Can't dequeue compile: environment %s does not exist" % environment)
-            nextrun = await data.Compile.get_next_run(environment)
-            if nextrun and not env.halted:
-                task = self.add_background_task(self._run(nextrun))
-                self._recompiles[environment] = task
-            else:
-                del self._recompiles[environment]
+            await self.process_next_compile_in_queue(environment)
+
+    async def process_next_compile_in_queue(self, environment: uuid.UUID) -> None:
+        if self.is_stopping():
+            return
+        env: Optional[data.Environment] = await data.Environment.get_by_id(environment)
+        if env is None:
+            raise Exception("Can't dequeue compile: environment %s does not exist" % environment)
+        nextrun = await data.Compile.get_next_run(environment)
+        if nextrun and not env.halted:
+            task = self.add_background_task(self._run(nextrun))
+            self._recompiles[environment] = task
+        elif environment in self._recompiles:
+            del self._recompiles[environment]
 
     async def _notify_listeners(self, compile: data.Compile) -> None:
         async def notify(listener: CompileStateListener) -> None:
             try:
                 await listener.compile_done(compile)
             except CancelledError:
                 """Propagate Cancel"""
@@ -676,17 +731,18 @@
 
         await asyncio.gather(*[notify(listener) for listener in self.listeners])
         await compile.update_fields(handled=True)
         LOGGER.log(const.LOG_LEVEL_TRACE, "listeners notified for %s", compile.id)
 
     async def _recover(self) -> None:
         """Restart runs after server restart"""
+        async with self._queue_count_cache_lock:
+            self._queue_count_cache = await data.Compile.get_total_length_of_all_compile_queues(exclude_started_compiles=False)
         # one run per env max to get started
         runs = await data.Compile.get_next_run_all()
-        self._queue_count_cache = await data.Compile.get_next_compiles_count() - len(runs)
         for run in runs:
             await self._queue(run)
         unhandled = await data.Compile.get_unhandled_compiles()
         for u in unhandled:
             self.add_background_task(self._notify_listeners(u))
 
     async def resume_environment(self, environment: uuid.UUID) -> None:
@@ -753,25 +809,30 @@
         await asyncio.sleep(wait)
 
     async def _run(self, compile: data.Compile) -> None:
         """
         Runs a compile request. At completion, looks for similar compile requests based on _compile_merge_key and marks
         those as completed as well.
         """
-        self._queue_count_cache -= 1
         await self._auto_recompile_wait(compile)
 
         compile_merge_key: Hashable = CompilerService._compile_merge_key(compile)
         merge_candidates: List[data.Compile] = [
             c
             for c in await data.Compile.get_next_compiles_for_environment(compile.environment)
             if not c.id == compile.id and CompilerService._compile_merge_key(c) == compile_merge_key
         ]
 
         runner = self._get_compile_runner(compile, project_dir=os.path.join(self._env_folder, str(compile.environment)))
+
+        started = datetime.datetime.now().astimezone()
+        async with self._queue_count_cache_lock:
+            await compile.update_fields(started=started)
+            self._queue_count_cache -= 1
+
         # set force_update == True iff any compile request has force_update == True
         compile_data: Optional[model.CompileData]
         success, compile_data = await runner.run(force_update=any(c.force_update for c in chain([compile], merge_candidates)))
 
         version = runner.version
 
         end = datetime.datetime.now().astimezone()
@@ -785,19 +846,20 @@
                 version=version,
                 substitute_compile_id=compile.id,
                 compile_data=compile_data_json,
             )
             for merge_candidate in merge_candidates
         ]
 
-        await asyncio.gather(*awaitables)
+        async with self._queue_count_cache_lock:
+            await asyncio.gather(*awaitables)
+            self._queue_count_cache -= len(merge_candidates)
         if self.is_stopping():
             return
         self.add_background_task(self._notify_listeners(compile))
-        self._queue_count_cache -= len(merge_candidates)
         for merge_candidate in merge_candidates:
             self.add_background_task(self._notify_listeners(merge_candidate))
         await self._dequeue(compile.environment)
 
     def _get_compile_runner(self, compile: data.Compile, project_dir: str) -> CompileRun:
         return CompileRun(compile, project_dir)
 
@@ -878,7 +940,27 @@
 
     @protocol.handle(methods_v2.compile_details, env="tid")
     async def compile_details(self, env: data.Environment, id: uuid.UUID) -> model.CompileDetails:
         details = await data.Compile.get_compile_details(env.id, id)
         if not details:
             raise NotFound("The compile with the given id does not exist.")
         return details
+
+    async def environment_action_cleared(self, env: model.Environment) -> None:
+        """
+        Will be called when the environment is cleared
+
+        :param env: The environment that is cleared
+        """
+        await self.recalculate_queue_count_cache()
+
+    async def environment_action_deleted(self, env: model.Environment) -> None:
+        """
+        Will be called when the environment is deleted
+
+        :param env: The environment that is deleted
+        """
+        await self.recalculate_queue_count_cache()
+
+    async def recalculate_queue_count_cache(self) -> None:
+        async with self._queue_count_cache_lock:
+            self._queue_count_cache = await data.Compile.get_total_length_of_all_compile_queues()
```

### Comparing `inmanta-core-8.3.0/src/inmanta/server/services/dryrunservice.py` & `inmanta-core-9.3.0/src/inmanta/server/services/dryrunservice.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/server/services/environment_metrics_service.py` & `inmanta-core-9.3.0/src/inmanta/server/services/environment_metrics_service.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/server/services/environmentservice.py` & `inmanta-core-9.3.0/src/inmanta/server/services/environmentservice.py`

 * *Files 2% similar despite different names*

```diff
@@ -46,19 +46,18 @@
     SLICE_RESOURCE,
     SLICE_SERVER,
     SLICE_TRANSPORT,
     protocol,
 )
 from inmanta.server.agentmanager import AgentManager, AutostartedAgentManager
 from inmanta.server.server import Server
-from inmanta.server.services.compilerservice import CompilerService
+from inmanta.server.services import compilerservice
 from inmanta.server.services.orchestrationservice import OrchestrationService
 from inmanta.server.services.resourceservice import ResourceService
 from inmanta.types import Apireturn, JsonType, Warnings
-from inmanta.util import get_compiler_version
 
 LOGGER = logging.getLogger(__name__)
 
 
 def rename_fields(env: model.Environment) -> JsonType:
     env_dict = env.dict()
     env_dict["project"] = env_dict["project_id"]
@@ -143,17 +142,22 @@
         return [SLICE_TRANSPORT]
 
     async def prestart(self, server: protocol.Server) -> None:
         await super().prestart(server)
         self.server_slice = cast(Server, server.get_slice(SLICE_SERVER))
         self.agent_manager = cast(AgentManager, server.get_slice(SLICE_AGENT_MANAGER))
         self.autostarted_agent_manager = cast(AutostartedAgentManager, server.get_slice(SLICE_AUTOSTARTED_AGENT_MANAGER))
-        self.compiler_service = cast(CompilerService, server.get_slice(SLICE_COMPILER))
+        self.compiler_service = cast(compilerservice.CompilerService, server.get_slice(SLICE_COMPILER))
         self.orchestration_service = cast(OrchestrationService, server.get_slice(SLICE_ORCHESTRATION))
         self.resource_service = cast(ResourceService, server.get_slice(SLICE_RESOURCE))
+        # Register the compiler service here to the environment service listener. Registering it within the compiler service
+        # would result in a circular dependency between the environment slice and the compiler service slice.
+        self.register_listener_for_multiple_actions(
+            self.compiler_service, {EnvironmentAction.cleared, EnvironmentAction.deleted}
+        )
 
     async def start(self) -> None:
         await super().start()
         await self._enable_schedules_all_envs()
 
     async def _enable_schedules_all_envs(self) -> None:
         """
@@ -279,23 +283,14 @@
                         return
 
                     await refreshed_env.update_fields(halted=False, connection=connection)
                     await self.agent_manager.resume_agents(refreshed_env, connection=connection)
             await self.autostarted_agent_manager.restart_agents(refreshed_env)
         await self.server_slice.compiler.resume_environment(refreshed_env.id)
 
-    @handle(methods.decomission_environment, env="id")
-    async def decommission_environment(self, env: data.Environment, metadata: Optional[JsonType]) -> Apireturn:
-        data: Optional[model.ModelMetadata] = None
-        if metadata:
-            data = model.ModelMetadata(message=metadata.get("message", ""), type=metadata.get("type", ""))
-
-        version = await self.environment_decommission(env, data)
-        return 200, {"version": version}
-
     @handle(methods.clear_environment, env="id")
     async def clear_environment(self, env: data.Environment) -> Apireturn:
         await self.environment_clear(env)
         return 200
 
     @handle(methods.create_token, env="tid")
     async def create_token(self, env: data.Environment, client_types: List[str], idempotent: bool) -> Apireturn:
@@ -483,46 +478,30 @@
 
         self._disable_schedules(env)
         await asyncio.gather(self.autostarted_agent_manager.stop_agents(env), env.delete_cascade())
 
         self.resource_service.close_resource_action_logger(environment_id)
         await self.notify_listeners(EnvironmentAction.deleted, env.to_dto())
 
-    @handle(methods_v2.environment_decommission, env="id")
-    async def environment_decommission(self, env: data.Environment, metadata: Optional[model.ModelMetadata]) -> int:
-        is_protected_environment = await env.get(data.PROTECTED_ENVIRONMENT)
-        if is_protected_environment:
-            raise Forbidden(f"Environment {env.id} is protected. See environment setting: {data.PROTECTED_ENVIRONMENT}")
-        version = await env.get_next_version()
-        if metadata is None:
-            metadata = model.ModelMetadata(message="Decommission of environment", type="api")
-        version_info = model.ModelVersionInfo(export_metadata=metadata)
-        await self.orchestration_service.put_version(env, version, [], {}, [], version_info.dict(), get_compiler_version())
-        return version
+        self._delete_environment_dir(environment_id)
 
     @handle(methods_v2.environment_clear, env="id")
     async def environment_clear(self, env: data.Environment) -> None:
         """
         Clear the environment
         """
         is_protected_environment = await env.get(data.PROTECTED_ENVIRONMENT)
         if is_protected_environment:
             raise Forbidden(f"Environment {env.id} is protected. See environment setting: {data.PROTECTED_ENVIRONMENT}")
 
         await self.autostarted_agent_manager.stop_agents(env)
         await env.delete_cascade(only_content=True)
 
         await self.notify_listeners(EnvironmentAction.cleared, env.to_dto())
-
-        project_dir = os.path.join(self.server_slice._server_storage["environments"], str(env.id))
-        if os.path.exists(project_dir):
-            # This call might fail when someone manually creates a directory or file that is owned
-            # by another user than the user running the inmanta server. Execute rmtree() after
-            # notify_listeners() to ensure that the listeners are notified.
-            shutil.rmtree(project_dir)
+        self._delete_environment_dir(env.id)
 
     @handle(methods_v2.environment_create_token, env="tid")
     async def environment_create_token(self, env: data.Environment, client_types: List[str], idempotent: bool) -> str:
         """
         Create a new auth token for this environment
         """
         if not config.Config.getboolean("server", "auth", False):
@@ -592,14 +571,38 @@
         :param action: type of action the listener is interested in
         """
         self.listeners[action].append(listener)
 
     def remove_listener(self, action: EnvironmentAction, listener: EnvironmentListener) -> None:
         self.listeners[action].remove(listener)
 
+    def _delete_environment_dir(self, environment_id: uuid.UUID) -> None:
+        """
+        Deletes an environment from the server's state_dir directory. This method should be called after
+        notify_listeners() to ensure that the listeners are notified.
+
+        :param environment_id: The uuid of the environment to remove from the state directory.
+
+        :raises ServerError: When a file or directory has been created by a user different than the
+        one running the Inmanta server inside the environment directory marked for removal.
+        """
+        state_dir = config.state_dir.get()
+        environment_dir = os.path.join(state_dir, "server", "environments", str(environment_id))
+
+        if os.path.exists(environment_dir):
+            # This call might fail when someone manually creates a directory or file that is owned
+            # by another user than the user running the inmanta server.
+            try:
+                shutil.rmtree(environment_dir)
+            except PermissionError:
+                raise ServerError(
+                    f"Environment {environment_id} cannot be deleted because it contains files owned"
+                    " by a different user than the one running the Inmanta server."
+                )
+
     async def notify_listeners(
         self, action: EnvironmentAction, updated_env: model.Environment, original_env: Optional[model.Environment] = None
     ) -> None:
         for listener in self.listeners[action]:
             try:
                 if action == EnvironmentAction.created:
                     await listener.environment_action_created(updated_env)
```

### Comparing `inmanta-core-8.3.0/src/inmanta/server/services/fileservice.py` & `inmanta-core-9.3.0/src/inmanta/server/services/fileservice.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/server/services/metricservice.py` & `inmanta-core-9.3.0/src/inmanta/server/services/metricservice.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/server/services/notificationservice.py` & `inmanta-core-9.3.0/src/inmanta/server/services/notificationservice.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/server/services/orchestrationservice.py` & `inmanta-core-9.3.0/src/inmanta/server/services/orchestrationservice.py`

 * *Files 3% similar despite different names*

```diff
@@ -24,15 +24,15 @@
 import asyncpg
 import asyncpg.connection
 import asyncpg.exceptions
 import pydantic
 
 from inmanta import const, data
 from inmanta.const import ResourceState
-from inmanta.data import APILIMIT, AVAILABLE_VERSIONS_TO_KEEP, ENVIRONMENT_AGENT_TRIGGER_METHOD, PURGE_ON_DELETE, InvalidSort
+from inmanta.data import APILIMIT, AVAILABLE_VERSIONS_TO_KEEP, ENVIRONMENT_AGENT_TRIGGER_METHOD, InvalidSort
 from inmanta.data.dataview import DesiredStateVersionView
 from inmanta.data.model import (
     DesiredStateVersion,
     PromoteTriggerMethod,
     ResourceDiff,
     ResourceIdStr,
     ResourceMinimal,
@@ -390,15 +390,15 @@
         await super().start()
 
     async def _purge_versions(self) -> None:
         """
         Purge versions from the database
         """
         # TODO: move to data and use queries for delete
-        envs = await data.Environment.get_list()
+        envs = await data.Environment.get_list(halted=False)
         for env_item in envs:
             # get available versions
             n_versions = await env_item.get(AVAILABLE_VERSIONS_TO_KEEP)
             assert isinstance(n_versions, int)
             versions = await data.ConfigurationModel.get_list(environment=env_item.id)
             if len(versions) > n_versions:
                 LOGGER.info("Removing %s available versions from environment %s", len(versions) - n_versions, env_item.id)
@@ -626,16 +626,15 @@
         removed_resource_sets: Optional[List[str]] = None,
         *,
         connection: asyncpg.connection.Connection,
     ) -> None:
         """
         :param rid_to_resource: This parameter should contain all the resources when a full compile is done.
                                 When a partial compile is done, it should contain all the resources that belong to the
-                                updated resource sets or the shared resource sets. This method updates this object with
-                                purge-on-delete resources.
+                                updated resource sets or the shared resource sets.
         :param unknowns: This parameter should contain all the unknowns for all the resources in the new version of the model.
                          Also the unknowns for resources that are not present in rid_to_resource.
         :param partial_base_version: When a partial compile is done, this parameter contains the version of the
                                      configurationmodel this partial compile was based on. Otherwise this parameter should be
                                      None.
         :param removed_resource_sets: When a partial compile is done, this parameter should indicate the names of the resource
                                       sets that are removed by the partial compile. When no resource sets are removed by
@@ -645,21 +644,14 @@
             * The requires and provides relationships of the resources in rid_to_resource must be set correctly. For a
               partial compile, this means it is assumed to be valid with respect to all absolute constraints that apply to
               partial compiles. Constraints that are relative to the base version will be verified by this method.
             * When a partial compile was done, all resources in rid_to_resource must meet the constraints of a partial compile.
             * The resource sets defined in the removed_resource_sets argument must not overlap with the resource sets present
               in the resource_sets argument.
 
-        This method adds resources to the model that are no longer present in the new version of the model and had the
-        purge_on_delete flag set to true. This method makes sure that the requires and provides relationships of these
-        additional resources are set correctly. This dependency wiring is also safe for a partial compile because
-        a partial compile cannot delete shared resources and because resources that belong to a non-shared resource set cannot
-        reference resources in another non-shared resource set. That way all dependencies of the deleted resources are present
-        in the rid_to_resource parameter.
-
         When a partial compile is done, the undeployable and skipped_for_undeployable resources of a configurationmodel are
         copied from the old version to the new version. This operation is safe because the only resources missing from
         rid_to_resource are resources that belong to an unchanged, non-shared resource set. Those resources can only have
         cross resource set dependencies in a non-shared resource set and the latter resource set cannot be changed by a partial
         compile.
 
         Validations done by this method:
@@ -740,42 +732,38 @@
             except asyncpg.exceptions.UniqueViolationError:
                 raise ServerError("The given version is already defined. Versions should be unique.")
 
             all_ids: set[Id] = set(Id.parse_id(rid, version) for rid in rid_to_resource.keys())
             if is_partial_update:
                 # Make mypy happy
                 assert partial_base_version is not None
-                rids_unchanged_resource_sets: abc.Set[
-                    ResourceIdStr
+                # This dict maps a resource id to its resource set for unchanged resource sets.
+                rids_unchanged_resource_sets: dict[
+                    ResourceIdStr, str
                 ] = await data.Resource.copy_resources_from_unchanged_resource_set(
                     environment=env.id,
                     source_version=partial_base_version,
                     destination_version=version,
                     updated_resource_sets=set(sr for sr in resource_sets.values() if sr is not None),
                     deleted_resource_sets=set(removed_resource_sets),
                     connection=connection,
                 )
-                resources_that_moved_resource_sets = rids_unchanged_resource_sets & set(rid_to_resource.keys())
+                resources_that_moved_resource_sets = rids_unchanged_resource_sets.keys() & rid_to_resource.keys()
                 if resources_that_moved_resource_sets:
-                    raise BadRequest(
-                        f"A partial compile cannot migrate resources {list(resources_that_moved_resource_sets)} to another"
-                        " resource set"
+                    msg = (
+                        "The following Resource(s) cannot be migrated to a different resource set using a partial compile, "
+                        "a full compile is necessary for this process:\n"
+                    )
+                    msg += "\n".join(
+                        f"    {rid} moved from {rids_unchanged_resource_sets[rid]} to {resource_sets[rid]}"
+                        for rid in resources_that_moved_resource_sets
                     )
-                all_ids |= {Id.parse_id(rid, version) for rid in rids_unchanged_resource_sets}
 
-            purge_on_delete_resources: Dict[ResourceIdStr, data.Resource] = await self._get_resources_for_purge_on_delete(
-                env=env,
-                version=version,
-                rid_to_resource=rid_to_resource,
-                all_resource_ids=[i.resource_str() for i in all_ids],
-                version_info=version_info,
-                connection=connection,
-            )
-            rid_to_resource.update(purge_on_delete_resources)
-            all_ids |= {Id.parse_id(rid, version) for rid in purge_on_delete_resources.keys()}
+                    raise BadRequest(msg)
+                all_ids |= {Id.parse_id(rid, version) for rid in rids_unchanged_resource_sets.keys()}
 
             await data.Resource.insert_many(list(rid_to_resource.values()), connection=connection)
             await cm.recalculate_total(connection=connection)
 
             await data.UnknownParameter.insert_many(unknowns, connection=connection)
 
             all_agents: abc.Set[str] = {res.agent for res in rid_to_resource.values()}
@@ -799,91 +787,14 @@
                     finished=now,
                     messages=[log_line],
                 )
                 await ra.insert(connection=connection)
 
         LOGGER.debug("Successfully stored version %d", version)
 
-    async def _get_resources_for_purge_on_delete(
-        self,
-        env: data.Environment,
-        version: int,
-        rid_to_resource: abc.Mapping[ResourceIdStr, data.Resource],
-        all_resource_ids: abc.Sequence[ResourceIdStr],
-        version_info: Optional[JsonType] = None,
-        *,
-        connection: asyncpg.connection.Connection,
-    ) -> dict[ResourceIdStr, data.Resource]:
-        """
-        Return a dictionary of resources that were present in the old version of the model but that no longer exist in this
-        version (in rid_to_resource) and had the purge_on_delete flag set to true. The returned resources will have the purged
-        attribute set to True and their requires/provides relationships inverted.
-
-        :param env: The environment we are discovering purged resources for.
-        :param version: The new version of the configuration model in which the purge_on_delete resources should be added.
-        :param rid_to_resource: When a full compile is done, this dictionary contains an entry for all resources that are
-                                part of the full compile. When a partial compile is done, this dictionary contains an entry
-                                for each resource in the new version of the model that belongs to an updated or shared
-                                resource set.
-        :param all_resource_ids: All the resource ids of all the resources present in the new version of the model. When
-                                 a partial compile is done, this sequence also includes the resource ids of resources that were
-                                 not updated by the partial compile.
-        """
-
-        def safe_get(input: object, key: str, default: object) -> object:
-            if not isinstance(input, dict):
-                return default
-            if key not in input:
-                return default
-            return input[key]
-
-        rid_to_resource = dict(rid_to_resource)
-
-        # detect failed compiles
-        metadata: object = safe_get(version_info, const.EXPORT_META_DATA, {})
-        compile_state = safe_get(metadata, const.META_DATA_COMPILE_STATE, "")
-        failed = compile_state == const.Compilestate.failed
-
-        result = {}
-        if not failed and (await env.get(PURGE_ON_DELETE)):
-            # search for deleted resources (purge_on_delete)
-            resources_to_purge: List[data.Resource] = await data.Resource.get_deleted_resources(
-                env.id, version, all_resource_ids, connection=connection
-            )
-
-            previous_requires = {}
-            for res in resources_to_purge:
-                LOGGER.warning("Purging %s, purged resource based on %s", res.resource_id, res.resource_version_id)
-
-                attributes = res.attributes.copy()
-                attributes["purged"] = True
-                attributes["requires"] = []
-                res_obj = data.Resource.new(
-                    env.id,
-                    resource_version_id=ResourceVersionIdStr("%s,v=%s" % (res.resource_id, version)),
-                    attributes=attributes,
-                )
-
-                previous_requires[res_obj.resource_id] = res.attributes["requires"]
-                rid_to_resource[res_obj.resource_id] = res_obj
-                result[res_obj.resource_id] = res_obj
-
-            # invert dependencies on purges
-            for res_id, requires in previous_requires.items():
-                res_obj = rid_to_resource[res_id]
-                for require in requires:
-                    req_id = Id.parse_id(require)
-
-                    if req_id.resource_str() in rid_to_resource:
-                        req_res = rid_to_resource[req_id.resource_str()]
-                        req_res.attributes["requires"].append(res_obj.resource_id)
-                        if res_obj.agent != req_res.agent:
-                            res_obj.provides.append(req_res.resource_id)
-        return result
-
     async def _trigger_auto_deploy(
         self,
         env: data.Environment,
         version: int,
     ) -> None:
         """
         Triggers auto-deploy for stored resources. Must be called only after transaction that stores resources has been allowed
```

### Comparing `inmanta-core-8.3.0/src/inmanta/server/services/paramservice.py` & `inmanta-core-9.3.0/src/inmanta/server/services/paramservice.py`

 * *Files 4% similar despite different names*

```diff
@@ -69,44 +69,52 @@
     async def renew_facts(self) -> None:
         """
         Send out requests to renew facts.
         """
         LOGGER.info("Renewing parameters")
 
         updated_before = datetime.datetime.now().astimezone() - datetime.timedelta(0, self._fact_renew)
-        params_to_renew = await data.Parameter.get_updated_before(updated_before)
+        params_to_renew = await data.Parameter.get_updated_before_active_env(updated_before)
 
         LOGGER.debug("Renewing %d parameters", len(params_to_renew))
 
+        environments = await data.Environment.get_list(halted=False)
+        ids_non_halted_envs = [env.id for env in environments]
+
         for param in params_to_renew:
-            if param.environment is None:
-                LOGGER.warning(
-                    "Found parameter without environment (%s for resource %s). Deleting it.", param.name, param.resource_id
-                )
-                await param.delete()
-            else:
+            if param.environment in ids_non_halted_envs:
                 LOGGER.debug(
                     "Requesting new parameter value for %s of resource %s in env %s",
                     param.name,
                     param.resource_id,
                     param.environment,
                 )
                 await self.agentmanager.request_parameter(param.environment, param.resource_id)
+            else:
+                LOGGER.debug(
+                    "Not Requesting value for unknown parameter %s of resource %s in env %s as the env is halted",
+                    param.name,
+                    param.resource_id,
+                    param.environment,
+                )
 
         unknown_parameters = await data.UnknownParameter.get_list(resolved=False)
         for u in unknown_parameters:
-            if u.environment is None:
-                LOGGER.warning(
-                    "Found unknown parameter without environment (%s for resource %s). Deleting it.", u.name, u.resource_id
+            if u.environment in ids_non_halted_envs:
+                LOGGER.debug(
+                    "Requesting value for unknown parameter %s of resource %s in env %s", u.name, u.resource_id, u.environment
                 )
-                await u.delete()
-            else:
-                LOGGER.debug("Requesting value for unknown parameter %s of resource %s in env %s", u.name, u.resource_id, u.id)
                 await self.agentmanager.request_parameter(u.environment, u.resource_id)
-
+            else:
+                LOGGER.debug(
+                    "Not Requesting value for unknown parameter %s of resource %s in env %s as the env is halted",
+                    u.name,
+                    u.resource_id,
+                    u.environment,
+                )
         LOGGER.info("Done renewing parameters")
 
     @handle(methods.get_param, param_id="id", env="tid")
     async def get_param(self, env: data.Environment, param_id: str, resource_id: Optional[str] = None) -> Apireturn:
         if resource_id is None:
             params = await data.Parameter.get_list(environment=env.id, name=param_id)
         else:
```

### Comparing `inmanta-core-8.3.0/src/inmanta/server/services/projectservice.py` & `inmanta-core-9.3.0/src/inmanta/server/services/projectservice.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/server/services/resourceservice.py` & `inmanta-core-9.3.0/src/inmanta/server/services/resourceservice.py`

 * *Files 4% similar despite different names*

```diff
@@ -21,22 +21,30 @@
 import os
 import uuid
 from collections import abc, defaultdict
 from typing import Any, Callable, Dict, List, Optional, Sequence, Union, cast
 
 from asyncpg.connection import Connection
 from asyncpg.exceptions import UniqueViolationError
+from pydantic import ValidationError
 from tornado.httputil import url_concat
 
 from inmanta import const, data, util
 from inmanta.const import STATE_UPDATE, TERMINAL_STATES, TRANSIENT_STATES, VALID_STATES_ON_STATE_UPDATE, Change, ResourceState
 from inmanta.data import APILIMIT, InvalidSort
-from inmanta.data.dataview import ResourceHistoryView, ResourceLogsView, ResourcesInVersionView, ResourceView
+from inmanta.data.dataview import (
+    DiscoveredResourceView,
+    ResourceHistoryView,
+    ResourceLogsView,
+    ResourcesInVersionView,
+    ResourceView,
+)
 from inmanta.data.model import (
     AttributeStateChange,
+    DiscoveredResource,
     LatestReleasedResource,
     LogLine,
     ReleasedResourceDetails,
     Resource,
     ResourceAction,
     ResourceHistory,
     ResourceIdStr,
@@ -52,15 +60,15 @@
 from inmanta.protocol.return_value_meta import ReturnValueWithMeta
 from inmanta.resources import Id
 from inmanta.server import SLICE_AGENT_MANAGER, SLICE_DATABASE, SLICE_RESOURCE, SLICE_TRANSPORT
 from inmanta.server import config as opt
 from inmanta.server import protocol
 from inmanta.server.agentmanager import AgentManager
 from inmanta.server.validate_filter import InvalidFilter
-from inmanta.types import Apireturn, PrimitiveTypes
+from inmanta.types import Apireturn, JsonType, PrimitiveTypes
 
 LOGGER = logging.getLogger(__name__)
 
 
 def error_and_log(message: str, **context: Any) -> None:
     """
     :param message: message to return both to logger and to remote caller
@@ -209,14 +217,20 @@
         env: data.Environment,
         resource_id: ResourceVersionIdStr,
         logs: bool,
         status: bool,
         log_action: const.ResourceAction,
         log_limit: int,
     ) -> Apireturn:
+        # Validate resource version id
+        try:
+            Id.parse_resource_version_id(resource_id)
+        except ValueError:
+            return 400, {"message": f"{resource_id} is not a valid resource version id"}
+
         resv = await data.Resource.get(env.id, resource_id)
         if resv is None:
             return 404, {"message": "The resource with the given id does not exist in the given environment"}
 
         if status is not None and status:
             return 200, {"status": resv.status}
 
@@ -228,15 +242,15 @@
 
             actions = await data.ResourceAction.get_log(
                 environment=env.id, resource_version_id=resource_id, action=action_name, limit=log_limit
             )
 
         return 200, {"resource": resv, "logs": actions}
 
-    # This endpoint does't have a method associated yet.
+    # This endpoint doesn't have a method associated yet.
     # Intended for use by other slices
     async def get_resources_in_latest_version(
         self,
         environment: data.Environment,
         resource_type: Optional[ResourceType] = None,
         attributes: Dict[PrimitiveTypes, PrimitiveTypes] = {},
     ) -> List[Resource]:
@@ -1034,7 +1048,59 @@
     async def versioned_resource_details(
         self, env: data.Environment, version: int, rid: ResourceIdStr
     ) -> VersionedResourceDetails:
         resource = await data.Resource.get_versioned_resource_details(environment=env.id, version=version, resource_id=rid)
         if not resource:
             raise NotFound("The resource with the given id does not exist")
         return resource
+
+    @handle(methods_v2.discovered_resource_create, env="tid")
+    async def discovered_resource_create(self, env: data.Environment, discovered_resource_id: str, values: JsonType) -> None:
+        try:
+            discovered_resource = DiscoveredResource(discovered_resource_id=discovered_resource_id, values=values)
+        except ValidationError as e:
+            # this part was copy/pasted from protocol.common.MethodProperties.validate_arguments.
+            error_msg = f"Failed to validate argument\n{str(e)}"
+            LOGGER.exception(error_msg)
+            raise BadRequest(error_msg, {"validation_errors": e.errors()})
+
+        dao = discovered_resource.to_dao(env.id)
+        await dao.insert_with_overwrite()
+
+    @handle(methods_v2.discovered_resource_create_batch, env="tid")
+    async def discovered_resources_create_batch(
+        self, env: data.Environment, discovered_resources: List[DiscoveredResource]
+    ) -> None:
+        dao_list = [res.to_dao(env.id) for res in discovered_resources]
+        await data.DiscoveredResource.insert_many_with_overwrite(dao_list)
+
+    @handle(methods_v2.discovered_resources_get, env="tid")
+    async def discovered_resources_get(
+        self, env: data.Environment, discovered_resource_id: ResourceIdStr
+    ) -> DiscoveredResource:
+        result = await data.DiscoveredResource.get_one(environment=env.id, discovered_resource_id=discovered_resource_id)
+        if not result:
+            raise NotFound(f"discovered_resource with name {discovered_resource_id} not found in env {env.id}")
+        dto = result.to_dto()
+        return dto
+
+    @protocol.handle(methods_v2.discovered_resources_get_batch, env="tid")
+    async def discovered_resources_get_batch(
+        self,
+        env: data.Environment,
+        limit: Optional[int] = None,
+        start: Optional[str] = None,
+        end: Optional[str] = None,
+        sort: str = "discovered_resource_id.asc",
+    ) -> ReturnValue[Sequence[DiscoveredResource]]:
+        try:
+            handler = DiscoveredResourceView(
+                environment=env,
+                limit=limit,
+                sort=sort,
+                start=start,
+                end=end,
+            )
+            out = await handler.execute()
+            return out
+        except (InvalidFilter, InvalidSort, data.InvalidQueryParameter, data.InvalidFieldNameException) as e:
+            raise BadRequest(e.message) from e
```

### Comparing `inmanta-core-8.3.0/src/inmanta/server/services/userservice.py` & `inmanta-core-9.3.0/src/inmanta/server/services/userservice.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/server/validate_filter.py` & `inmanta-core-9.3.0/src/inmanta/server/validate_filter.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/stable_api.py` & `inmanta-core-9.3.0/src/inmanta/stable_api.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/types.py` & `inmanta-core-9.3.0/src/inmanta/types.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/user_setup.py` & `inmanta-core-9.3.0/src/inmanta/user_setup.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta/util.py` & `inmanta-core-9.3.0/src/inmanta/util.py`

 * *Files 2% similar despite different names*

```diff
@@ -36,16 +36,16 @@
 from collections import abc, defaultdict
 from concurrent.futures import ThreadPoolExecutor
 from dataclasses import dataclass
 from logging import Logger
 from types import TracebackType
 from typing import Awaitable, BinaryIO, Callable, Coroutine, Dict, Iterator, List, Optional, Set, Tuple, Type, TypeVar, Union
 
+import asyncpg
 from tornado import gen
-from tornado.ioloop import IOLoop
 
 from crontab import CronTab
 from inmanta import COMPILER_VERSION
 from inmanta.stable_api import stable_api
 from inmanta.types import JsonType, PrimitiveTypes, ReturnTypes
 
 LOGGER = logging.getLogger(__name__)
@@ -237,19 +237,20 @@
 
 @stable_api
 class Scheduler(object):
     """
     An event scheduler class. Identifies tasks based on an action and a schedule. Considers tasks with the same action and the
     same schedule to be the same. Callers that wish to be able to delete the tasks they add should make sure to use unique
     `call` functions.
+    Assumes an event loop is already running on this thread.
     """
 
     def __init__(self, name: str) -> None:
         self.name = name
-        self._scheduled: Dict[ScheduledTask, object] = {}
+        self._scheduled: Dict[ScheduledTask, asyncio.TimerHandle] = {}
         self._stopped = False
         # Keep track of all tasks that are currently executing to be
         # able to cancel them when the scheduler is stopped.
         self._executing_tasks: Dict[TaskMethod, List[asyncio.Task[object]]] = defaultdict(list)
         # Keep track of tasks that should be awaited before the scheduler is stopped
         self._await_tasks: Dict[TaskMethod, List[asyncio.Task[object]]] = defaultdict(list)
 
@@ -280,21 +281,24 @@
 
     @stable_api
     def add_action(
         self,
         action: TaskMethod,
         schedule: Union[TaskSchedule, int],  # int for backward compatibility,
         cancel_on_stop: bool = True,
+        quiet_mode: bool = False,
     ) -> ScheduledTask:
         """
         Add a new action
 
         :param action: A function to call periodically
         :param schedule: The schedule for this action
         :param cancel_on_stop: Cancel the task when the scheduler is stopped. If false, the coroutine will be awaited.
+        :param quiet_mode: Set to true to disable logging the recurring  notification that the action is being called.
+        Use this to avoid polluting the server log for very frequent actions.
         """
         assert is_coroutine(action)
 
         if self._stopped:
             LOGGER.warning("Scheduling action '%s', while scheduler is stopped", action.__name__)
             return
 
@@ -308,55 +312,56 @@
 
         task_spec: ScheduledTask = ScheduledTask(action, schedule_typed)
         if task_spec in self._scheduled:
             # start fresh to respect initial delay, if set
             self.remove(task_spec)
 
         def action_function() -> None:
-            LOGGER.info("Calling %s" % action)
+            if not quiet_mode:
+                LOGGER.info("Calling %s", action)
             if task_spec in self._scheduled:
                 try:
                     task = ensure_future_and_handle_exception(
                         logger=LOGGER,
                         msg="Uncaught exception while executing scheduled action",
                         action=action(),
                         notify_done_callback=functools.partial(self._notify_done, action),
                     )
                     self._add_to_executing_tasks(action, task, cancel_on_stop)
                 except Exception:
                     LOGGER.exception("Uncaught exception while executing scheduled action")
                 finally:
                     # next iteration
-                    ihandle = IOLoop.current().call_later(schedule_typed.get_next_delay(), action_function)
+                    ihandle = asyncio.get_running_loop().call_later(schedule_typed.get_next_delay(), action_function)
                     self._scheduled[task_spec] = ihandle
 
-        handle = IOLoop.current().call_later(schedule_typed.get_initial_delay(), action_function)
+        handle: asyncio.TimerHandle = asyncio.get_running_loop().call_later(schedule_typed.get_initial_delay(), action_function)
         self._scheduled[task_spec] = handle
         return task_spec
 
     @stable_api
     def remove(self, task: ScheduledTask) -> None:
         """
         Remove a scheduled action
         """
         if task in self._scheduled:
-            IOLoop.current().remove_timeout(self._scheduled[task])
+            self._scheduled[task].cancel()
             del self._scheduled[task]
 
     @stable_api
     async def stop(self) -> None:
         """
         Stop the scheduler
         """
         self._stopped = True
         try:
             # remove can still run during stop. That is why we loop until we get a keyerror == the dict is empty
             while True:
                 _, handle = self._scheduled.popitem()
-                IOLoop.current().remove_timeout(handle)
+                handle.cancel()
         except KeyError:
             pass
 
         # Cancel all tasks that are already executing
         for action, tasks in self._executing_tasks.items():
             for task in tasks:
                 if task not in self._await_tasks[action]:
@@ -712,15 +717,15 @@
     We implemented this method because:
     1. ThreadPoolExecutor.shutdown(wait=True)` is a blocking call, blocking the ioloop.
        This doesn't work because we often have back-and-forth between the ioloop and the thread
        due to our `ResourceHandler.run_sync` method.
     2.The python sdk has no support for async awaiting threadpool shutdown (except for the default pool)
     """
 
-    loop = asyncio.get_event_loop()
+    loop = asyncio.get_running_loop()
     future = loop.create_future()
 
     def join() -> None:
         for threadpool in threadpools:
             try:
                 threadpool.shutdown(wait=True)
             except Exception:
@@ -729,7 +734,53 @@
 
     thread = threading.Thread(target=join)
     thread.start()
     try:
         await future
     finally:
         thread.join()
+
+
+def ensure_event_loop() -> asyncio.AbstractEventLoop:
+    """
+    Returns the event loop for this thread. Creates a new one if none exists yet and registers it with asyncio's active event
+    loop policy. Does not ensure that the event loop is running.
+    """
+    try:
+        # nothing needs to be done if this thread already has an event loop
+        return asyncio.get_event_loop()
+    except RuntimeError:
+        # asyncio.set_event_loop sets the event loop for this thread only
+        new_loop = asyncio.new_event_loop()
+        asyncio.set_event_loop(new_loop)
+        return new_loop
+
+
+class ExhaustedPoolWatcher:
+    """
+    This class keeps track of database pool exhaustion events and offers reporting capabilities.
+
+    """
+
+    def __init__(self, pool: asyncpg.pool.Pool) -> None:
+        self._exhausted_pool_events_count: int = 0
+        self._pool: asyncpg.pool.Pool = pool
+
+    def report_and_reset(self, logger: logging.Logger) -> None:
+        """
+        Log how many exhausted pool events were recorded since the last time the counter
+        was reset, if any, and reset the counter.
+        """
+        if self._exhausted_pool_events_count > 0:
+            logger.warning("Database pool was exhausted %d times in the past 24h.", self._exhausted_pool_events_count)
+            self._reset_counter()
+
+    def check_for_pool_exhaustion(self) -> None:
+        """
+        Checks if the database pool is exhausted
+        """
+        pool_exhausted: bool = self._pool.get_size() == self._pool.get_max_size() and self._pool.get_idle_size() == 0
+        if pool_exhausted:
+            self._exhausted_pool_events_count += 1
+
+    def _reset_counter(self) -> None:
+        self._exhausted_pool_events_count = 0
```

### Comparing `inmanta-core-8.3.0/src/inmanta/warnings.py` & `inmanta-core-9.3.0/src/inmanta/warnings.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta_core.egg-info/PKG-INFO` & `inmanta-core-9.3.0/src/inmanta_core.egg-info/PKG-INFO`

 * *Files 0% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: inmanta-core
-Version: 8.3.0
+Version: 9.3.0
 Summary: Inmanta deployment tool
 Home-page: https://github.com/inmanta/inmanta-core
 Author: Inmanta
 Author-email: code@inmanta.com
 License: Apache Software License 2
 Project-URL: Bug Tracker, https://github.com/inmanta/inmanta-core/issues
 Project-URL: Documentation, https://docs.inmanta.com/community/latest/
```

### Comparing `inmanta-core-8.3.0/src/inmanta_core.egg-info/SOURCES.txt` & `inmanta-core-9.3.0/src/inmanta_core.egg-info/SOURCES.txt`

 * *Files 1% similar despite different names*

```diff
@@ -20,14 +20,15 @@
 src/inmanta/const.py
 src/inmanta/deploy.py
 src/inmanta/docstring_parser.py
 src/inmanta/env.py
 src/inmanta/export.py
 src/inmanta/file_parser.py
 src/inmanta/loader.py
+src/inmanta/logging.py
 src/inmanta/main.py
 src/inmanta/model.py
 src/inmanta/module.py
 src/inmanta/moduletool.py
 src/inmanta/plugins.py
 src/inmanta/postgresproc.py
 src/inmanta/profile_mem.py
@@ -102,14 +103,17 @@
 src/inmanta/db/versions/v202301160.py
 src/inmanta/db/versions/v202301170.py
 src/inmanta/db/versions/v202301190.py
 src/inmanta/db/versions/v202302200.py
 src/inmanta/db/versions/v202302270.py
 src/inmanta/db/versions/v202303070.py
 src/inmanta/db/versions/v202303071.py
+src/inmanta/db/versions/v202304060.py
+src/inmanta/db/versions/v202304070.py
+src/inmanta/db/versions/v202306060.py
 src/inmanta/db/versions/v3.py
 src/inmanta/db/versions/v4.py
 src/inmanta/db/versions/v5.py
 src/inmanta/db/versions/v6.py
 src/inmanta/db/versions/v7.py
 src/inmanta/execute/__init__.py
 src/inmanta/execute/proxy.py
@@ -188,26 +192,28 @@
 tests/test_compiler_entrypoints.py
 tests/test_config.py
 tests/test_const.py
 tests/test_data.py
 tests/test_data_concurrency.py
 tests/test_data_model.py
 tests/test_deploy.py
+tests/test_discovered_resources.py
 tests/test_docs_snippets.py
 tests/test_docstring_parser.py
 tests/test_env.py
 tests/test_export.py
 tests/test_extension_loading.py
 tests/test_file_parser.py
 tests/test_handler.py
 tests/test_import_entry_points.py
 tests/test_influxdbreporting.py
 tests/test_io.py
 tests/test_jwt.py
 tests/test_loader.py
+tests/test_logging.py
 tests/test_module_loader.py
 tests/test_modules.py
 tests/test_openapi.py
 tests/test_param.py
 tests/test_parser.py
 tests/test_postgres.py
 tests/test_postgres_proc.py
```

### Comparing `inmanta-core-8.3.0/src/inmanta_core.egg-info/requires.txt` & `inmanta-core-9.3.0/src/inmanta_core.egg-info/requires.txt`

 * *Files 7% similar despite different names*

```diff
@@ -1,38 +1,38 @@
 asyncpg<0.28,~=0.25
 click-plugins~=1.0
 click<8.2,>=8.0
 colorlog~=6.4
 cookiecutter<3,>=1
 crontab<2.0,>=0.23
-cryptography<41,>=36
+cryptography<42,>=36
 docstring-parser<0.16,>=0.10
-email-validator~=1.0
+email-validator<3,>=1
 execnet~=1.0
 importlib_metadata<7,>=4
 jinja2~=3.0
 more-itertools<10,>=8
 netifaces~=0.11
 packaging>=21.3
 pip>=21.3
 ply~=3.0
-pydantic!=1.9.0a1,~=1.0
+pydantic<2,>=1.10.8
 pyformance~=0.4
 PyJWT~=2.0
 pynacl~=1.5
 python-dateutil~=2.0
 pyyaml~=6.0
 texttable~=1.0
 tornado~=6.0
-typing_inspect~=0.7
+typing_inspect~=0.9
 build~=0.7
 ruamel.yaml~=0.17
 toml~=0.10
 
 [datatrace]
 graphviz
 
 [debug]
 rpdb
 
 [pytest-inmanta-extensions]
-pytest-inmanta-extensions~=8.3.0.0.dev
+pytest-inmanta-extensions~=9.3.0.0.dev
```

### Comparing `inmanta-core-8.3.0/src/inmanta_ext/core/__init__.py` & `inmanta-core-9.3.0/src/inmanta_ext/core/__init__.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta_ext/core/extension.py` & `inmanta-core-9.3.0/src/inmanta_ext/core/extension.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/src/inmanta_plugins/1/__init__.py` & `inmanta-core-9.3.0/src/inmanta_plugins/1/__init__.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/tests/test_2way_protocol.py` & `inmanta-core-9.3.0/tests/test_2way_protocol.py`

 * *Files 2% similar despite different names*

```diff
@@ -142,14 +142,15 @@
     await agent.stop()
     await assert_agent_counter(agent, 1, 0)
 
 
 async def check_sessions(sessions):
     for s in sessions:
         a = await s.client.get_agent_status_x("X")
+        assert a.code == 200, a.result
         result = a.get_result()
         assert result["status"] == "ok", result
 
 
 @pytest.mark.slowtest
 async def test_agent_timeout(unused_tcp_port, no_tid_check, async_finalizer, postgres_db, database_name):
     from inmanta.config import Config
```

### Comparing `inmanta-core-8.3.0/tests/test_agent.py` & `inmanta-core-9.3.0/tests/test_agent.py`

 * *Files 2% similar despite different names*

```diff
@@ -19,15 +19,15 @@
 import asyncio
 import concurrent
 import logging
 import uuid
 
 import pytest
 
-from inmanta import config, protocol
+from inmanta import config, data, protocol
 from inmanta.agent import Agent, reporting
 from inmanta.agent.handler import HandlerContext, InvalidOperation
 from inmanta.data.model import AttributeStateChange
 from inmanta.resources import Id, PurgeableResource
 from inmanta.server import SLICE_AGENT_MANAGER, SLICE_SESSION_MANAGER
 from inmanta.server.bootloader import InmantaBootloader
 from utils import retry_limited
@@ -89,16 +89,15 @@
     """
     Start agent with the use_autostart_agent_map option to true.
     agent.start() is executed in the background, since connection to the server will fail.
     """
     config.Config.set("config", "use_autostart_agent_map", "true")
 
     env_id = uuid.uuid4()
-    a = Agent(hostname="node1", environment=env_id, agent_map={"agent1": "localhost"}, code_loader=False)
-    await a.add_end_point_name("agent1")
+    a = Agent(hostname="node1", environment=env_id, agent_map=None, code_loader=False)
     task = asyncio.ensure_future(a.start())
     yield a
     task.cancel()
     while not task.done():
         # The CancelledError is only thrown on the next invocation of the event loop.
         # Wait until the cancellation has finished.
         await asyncio.sleep(0)
@@ -138,14 +137,24 @@
     assert result.code == 200
     project_id = result.result["project"]["id"]
 
     # Create environment
     result = await client.create_environment(project_id=project_id, name="dev", environment_id=async_started_agent.environment)
     assert result.code == 200
 
+    # set agent in agent map
+    result = await client.get_setting(tid=async_started_agent.environment, id=data.AUTOSTART_AGENT_MAP)
+    assert result.code == 200
+    result = await client.set_setting(
+        tid=async_started_agent.environment,
+        id=data.AUTOSTART_AGENT_MAP,
+        value={"agent1": "localhost"} | result.result["value"],
+    )
+    assert result.code == 200
+
     # Assert agent managed to establish session with the server
     agent_manager = startable_server.restserver.get_slice(SLICE_AGENT_MANAGER)
     await retry_limited(lambda: (async_started_agent.environment, "agent1") in agent_manager.tid_endpoint_to_session, 10)
 
 
 async def test_set_agent_map(server, environment, agent_factory):
     """
```

### Comparing `inmanta-core-8.3.0/tests/test_agent_manager.py` & `inmanta-core-9.3.0/tests/test_agent_manager.py`

 * *Files 0% similar despite different names*

```diff
@@ -1204,15 +1204,14 @@
 
 
 async def test_are_agents_active(server, client, environment, agent_factory) -> None:
     """
     Ensure that the `AgentManager.are_agents_active()` method returns True when an agent
     is in the up or the paused state.
     """
-    agent_config.use_autostart_agent_map.set("True")
     agentmanager = server.get_slice(SLICE_AGENT_MANAGER)
     agent_name = "agent1"
     env_id = UUID(environment)
     env = await data.Environment.get_by_id(env_id)
 
     # The agent is not started yet ->  it should not be active
     assert not await agentmanager.are_agents_active(tid=env_id, endpoints=[agent_name])
```

### Comparing `inmanta-core-8.3.0/tests/test_app.py` & `inmanta-core-9.3.0/tests/test_app.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/tests/test_app_cli.py` & `inmanta-core-9.3.0/tests/test_app_cli.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/tests/test_cache.py` & `inmanta-core-9.3.0/tests/test_cache.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/tests/test_cli.py` & `inmanta-core-9.3.0/tests/test_cli.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/tests/test_compilation.py` & `inmanta-core-9.3.0/tests/test_compilation.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/tests/test_compiler_entrypoints.py` & `inmanta-core-9.3.0/tests/test_compiler_entrypoints.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/tests/test_config.py` & `inmanta-core-9.3.0/tests/test_config.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/tests/test_const.py` & `inmanta-core-9.3.0/tests/test_const.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/tests/test_data.py` & `inmanta-core-9.3.0/tests/test_data.py`

 * *Files 1% similar despite different names*

```diff
@@ -14,14 +14,15 @@
     limitations under the License.
 
     Contact: code@inmanta.com
 """
 import asyncio
 import datetime
 import enum
+import json
 import logging
 import time
 import uuid
 from collections import abc
 from typing import Dict, List, Optional, Type, cast
 
 import asyncpg
@@ -380,14 +381,50 @@
         await env.set("set_non_existing_parameter", 1)
     with pytest.raises(KeyError):
         await env.get("get_non_existing_parameter")
     with pytest.raises(AttributeError):
         await env.set(data.AUTO_DEPLOY, 5)
 
 
+async def test_population_settings_dict_on_get_of_setting(init_dataclasses_and_load_schema):
+    """
+    Verify that executing the `Environment.get(<name_env_setting>)` method on an environment object which doesn't have the
+    <name_env_setting> in its settings dictionary, doesn't override the value of the setting with the default value in
+    the database when another transaction has written a value for this setting to the database.
+    """
+    # Create project and environment
+    project = data.Project(name="proj")
+    await project.insert()
+    env = data.Environment(name="dev", project=project.id, repo_url="", repo_branch="")
+    await env.insert()
+
+    async def assert_setting_in_db(expected_autostart_agent_map: Dict[str, object]) -> None:
+        """
+        Verify that the state of the setting.autostart_agent_map setting in the database matches the given
+        expected_autostart_agent_map dictionary.
+        """
+        async with data.Environment.get_connection() as connection:
+            query = f"SELECT setting->'{data.AUTOSTART_AGENT_MAP}' FROM {data.Environment.table_name()} WHERE id=$1"
+            result = await connection.fetchval(query, env.id)
+            assert json.loads(result) == expected_autostart_agent_map
+
+    # Get two environment object with an empty settings dict.
+    env_obj1 = await data.Environment.get_by_id(env.id)
+    env_obj2 = await data.Environment.get_by_id(env.id)
+
+    # Add autostart_agent_map key to settings dict
+    autostart_agent_map = {"test": ":local", "internal": ":local"}
+    await env_obj1.set(data.AUTOSTART_AGENT_MAP, dict(autostart_agent_map))
+
+    assert assert_setting_in_db(autostart_agent_map)
+    # Make sure that get for autostart_agent_map on env_obj2 object doesn't override setting with default value.
+    assert await env_obj2.get(data.AUTOSTART_AGENT_MAP) == autostart_agent_map
+    assert assert_setting_in_db(autostart_agent_map)
+
+
 async def test_environment_deprecated_setting(init_dataclasses_and_load_schema, caplog):
     project = data.Project(name="proj")
     await project.insert()
 
     env = data.Environment(name="dev", project=project.id, repo_url="", repo_branch="")
     await env.insert()
 
@@ -459,15 +496,19 @@
     await agent_proc.delete_cascade()
 
     assert (await data.AgentProcess.get_one(sid=agent_proc.sid)) is None
     assert (await data.AgentInstance.get_by_id(agi1.id)) is None
     assert (await data.AgentInstance.get_by_id(agi2.id)) is None
 
 
-async def test_agentprocess_cleanup(init_dataclasses_and_load_schema, postgresql_client):
+@pytest.mark.parametrize("env1_halted", [True, False])
+@pytest.mark.parametrize("env2_halted", [True, False])
+async def test_agentprocess_cleanup(init_dataclasses_and_load_schema, postgresql_client, env1_halted, env2_halted):
+    # tests the agent process cleanup function with different combinations of halted environments
+
     project = data.Project(name="test")
     await project.insert()
 
     env1 = data.Environment(name="env1", project=project.id, repo_url="", repo_branch="")
     await env1.insert()
     env2 = data.Environment(name="env2", project=project.id, repo_url="", repo_branch="")
     await env2.insert()
@@ -504,31 +545,42 @@
     await insert_agent_proc_and_instances(env1.id, "proc2", None, [None])
     # Setup env2
     await insert_agent_proc_and_instances(env2.id, "proc2", None, [None, None])
     await insert_agent_proc_and_instances(env2.id, "proc2", datetime.datetime(2020, 1, 1, 1, 0), [now, now, now])
     await insert_agent_proc_and_instances(env2.id, "proc2", datetime.datetime(2020, 1, 1, 2, 0), [now, now])
     await insert_agent_proc_and_instances(env2.id, "proc2", datetime.datetime(2020, 1, 1, 3, 0), [now])
 
+    if env1_halted:
+        await env1.update_fields(halted=True)
+    if env2_halted:
+        await env2.update_fields(halted=True)
+
     # Run cleanup twice to verify stability
     for i in range(2):
         # Perform cleanup
         await data.AgentProcess.cleanup(nr_expired_records_to_keep=1)
         # Assert outcome
+        # Halting env1 has no impact on the cleanup: an expired instance will be kept in both cases
+        # Halting env2 has an impact on the cleanup: if it's halted 5 expired instances in 2 processes will not be removed.
         await verify_nr_of_records(env1.id, hostname="proc1", expected_nr_procs=2, expected_nr_instances=2)
         await verify_nr_of_records(env1.id, hostname="proc2", expected_nr_procs=1, expected_nr_instances=1)
-        await verify_nr_of_records(env2.id, hostname="proc2", expected_nr_procs=2, expected_nr_instances=3)
+        await verify_nr_of_records(
+            env2.id, hostname="proc2", expected_nr_procs=4 if env2_halted else 2, expected_nr_instances=8 if env2_halted else 3
+        )
         # Assert records are deleted in the correct order
         query = """
             SELECT expired
             FROM agentprocess
             WHERE environment=$1 AND hostname=$2 AND expired IS NOT NULL
         """
         result = await postgresql_client.fetch(query, env2.id, "proc2")
-        assert len(result) == 1
-        assert result[0]["expired"] == datetime.datetime(2020, 1, 1, 3, 0).astimezone()
+        assert len(result) == 3 if env2_halted else 1
+        if len(result) == 1:
+            # if the cleanup was done (env2 not halted), verify the expired record that was kept is the right one.
+            assert result[0]["expired"] == datetime.datetime(2020, 1, 1, 3, 0).astimezone()
 
 
 async def test_delete_agentinstance_which_is_primary(init_dataclasses_and_load_schema):
     """
     It should be impossible to delete an AgentInstance record which is references
     from the Agent stable.
     """
@@ -1146,163 +1198,14 @@
     res4 = get_resource(4, [3])
     await res4.insert()
 
     res5 = get_resource(5, [4])
     await res5.insert()
 
 
-async def test_resource_purge_on_delete(init_dataclasses_and_load_schema):
-    project = data.Project(name="test")
-    await project.insert()
-
-    env = data.Environment(name="dev", project=project.id, repo_url="", repo_branch="")
-    await env.insert()
-
-    # model 1
-    version = 1
-    cm1 = data.ConfigurationModel(
-        environment=env.id,
-        version=version,
-        date=datetime.datetime.now(),
-        total=2,
-        version_info={},
-        released=True,
-        deployed=True,
-        is_suitable_for_partial_compiles=False,
-    )
-    await cm1.insert()
-
-    res11 = data.Resource.new(
-        environment=env.id,
-        resource_version_id="std::File[agent1,path=/etc/motd],v=%s" % version,
-        status=const.ResourceState.deployed,
-        attributes={"path": "/etc/motd", "purge_on_delete": True, "purged": False},
-    )
-    await res11.insert()
-
-    res12 = data.Resource.new(
-        environment=env.id,
-        resource_version_id="std::File[agent2,path=/etc/motd],v=%s" % version,
-        status=const.ResourceState.deployed,
-        attributes={"path": "/etc/motd", "purge_on_delete": True, "purged": True},
-    )
-    await res12.insert()
-
-    # model 2 (multiple undeployed versions)
-    while version < 10:
-        version += 1
-        cm2 = data.ConfigurationModel(
-            environment=env.id,
-            version=version,
-            date=datetime.datetime.now(),
-            total=1,
-            version_info={},
-            released=False,
-            deployed=False,
-            is_suitable_for_partial_compiles=False,
-        )
-        await cm2.insert()
-
-        res21 = data.Resource.new(
-            environment=env.id,
-            resource_version_id="std::File[agent5,path=/etc/motd],v=%s" % version,
-            status=const.ResourceState.available,
-            attributes={"path": "/etc/motd", "purge_on_delete": True, "purged": False},
-        )
-        await res21.insert()
-
-    # model 3
-    version += 1
-    cm3 = data.ConfigurationModel(
-        environment=env.id,
-        version=version,
-        date=datetime.datetime.now(),
-        total=0,
-        version_info={},
-        is_suitable_for_partial_compiles=False,
-    )
-    await cm3.insert()
-
-    to_purge = await data.Resource.get_deleted_resources(env.id, version, set())
-
-    assert len(to_purge) == 1
-    assert to_purge[0].model == 1
-    assert to_purge[0].resource_id == "std::File[agent1,path=/etc/motd]"
-
-
-async def test_issue_422(init_dataclasses_and_load_schema):
-    project = data.Project(name="test")
-    await project.insert()
-
-    env = data.Environment(name="dev", project=project.id, repo_url="", repo_branch="")
-    await env.insert()
-
-    # model 1
-    version = 1
-    cm1 = data.ConfigurationModel(
-        environment=env.id,
-        version=version,
-        date=datetime.datetime.now(),
-        total=1,
-        version_info={},
-        released=True,
-        deployed=True,
-        is_suitable_for_partial_compiles=False,
-    )
-    await cm1.insert()
-
-    res11 = data.Resource.new(
-        environment=env.id,
-        resource_version_id="std::File[agent1,path=/etc/motd],v=%s" % version,
-        status=const.ResourceState.deployed,
-        attributes={"path": "/etc/motd", "purge_on_delete": True, "purged": False},
-    )
-    await res11.insert()
-
-    # model 2 (multiple undeployed versions)
-    version += 1
-    cm2 = data.ConfigurationModel(
-        environment=env.id,
-        version=version,
-        date=datetime.datetime.now(),
-        total=1,
-        version_info={},
-        released=False,
-        deployed=False,
-        is_suitable_for_partial_compiles=False,
-    )
-    await cm2.insert()
-
-    res21 = data.Resource.new(
-        environment=env.id,
-        resource_version_id="std::File[agent1,path=/etc/motd],v=%s" % version,
-        status=const.ResourceState.available,
-        attributes={"path": "/etc/motd", "purge_on_delete": True, "purged": False},
-    )
-    await res21.insert()
-
-    # model 3
-    version += 1
-    cm3 = data.ConfigurationModel(
-        environment=env.id,
-        version=version,
-        date=datetime.datetime.now(),
-        total=0,
-        version_info={},
-        is_suitable_for_partial_compiles=False,
-    )
-    await cm3.insert()
-
-    to_purge = await data.Resource.get_deleted_resources(env.id, version, set())
-
-    assert len(to_purge) == 1
-    assert to_purge[0].model == 1
-    assert to_purge[0].resource_id == "std::File[agent1,path=/etc/motd]"
-
-
 async def test_get_latest_resource(init_dataclasses_and_load_schema, postgresql_client):
     project = data.Project(name="test")
     await project.insert()
 
     env = data.Environment(name="dev", project=project.id, repo_url="", repo_branch="")
     await env.insert()
 
@@ -1754,14 +1657,100 @@
 
     assert res1.attribute_hash is not None
     assert res1.attribute_hash == res2.attribute_hash
     assert res3.attribute_hash is not None
     assert res1.attribute_hash != res3.attribute_hash
 
 
+async def test_get_resource_type_count_for_latest_version(init_dataclasses_and_load_schema):
+    """
+    Test for the get_resource_type_count_for_latest_version query
+    """
+    project = data.Project(name="test")
+    await project.insert()
+
+    env = data.Environment(name="dev", project=project.id, repo_url="", repo_branch="")
+    await env.insert()
+
+    async def assert_expected_count(expected_report: Dict[str, int]):
+        # Checks the expected_report against the actual one
+        report = await data.Resource.get_resource_type_count_for_latest_version(env.id)
+        assert report == expected_report
+
+    # model 1
+    version = 1
+    cm1 = data.ConfigurationModel(
+        environment=env.id,
+        version=version,
+        date=datetime.datetime.now(),
+        total=1,
+        version_info={},
+        released=True,
+        deployed=True,
+        is_suitable_for_partial_compiles=False,
+    )
+    await cm1.insert()
+
+    res1_1 = data.Resource.new(
+        environment=env.id,
+        resource_version_id="std::File[agent1,path=/etc/file1],v=%s" % version,
+        status=const.ResourceState.deployed,
+        last_deploy=datetime.datetime(2018, 7, 14, 14, 30),
+        attributes={"path": "/etc/file1"},
+    )
+    await res1_1.insert()
+
+    await assert_expected_count({"std::File": 1})  # 1 File resource in model v1
+
+    res2_1 = data.Resource.new(
+        environment=env.id,
+        resource_version_id="std::File[agent1,path=/etc/file2],v=%s" % version,
+        status=const.ResourceState.deployed,
+        last_deploy=datetime.datetime(2018, 7, 14, 14, 30),
+        attributes={"path": "/etc/file2"},
+    )
+    await res2_1.insert()
+
+    await assert_expected_count({"std::File": 2})  # 2 File resources in model v1
+
+    version += 1
+    cm2 = data.ConfigurationModel(
+        environment=env.id,
+        version=version,
+        date=datetime.datetime.now(),
+        total=1,
+        version_info={},
+        released=True,
+        deployed=True,
+        is_suitable_for_partial_compiles=False,
+    )
+    await cm2.insert()
+
+    res2_2 = data.Resource.new(
+        environment=env.id,
+        resource_version_id="std::File[agent1,path=/etc/file2],v=%s" % version,
+        status=const.ResourceState.deployed,
+        last_deploy=datetime.datetime(2018, 7, 14, 14, 30),
+        attributes={"path": "/etc/file2"},
+    )
+    await res2_2.insert()
+
+    await assert_expected_count({"std::File": 1})  # 1 File resource in model v2
+
+    res3_2 = data.Resource.new(
+        environment=env.id,
+        resource_version_id="std::Dummy[agent1,path=/etc/file3],v=%s" % version,
+        status=const.ResourceState.deployed,
+        last_deploy=datetime.datetime(2018, 7, 14, 14, 30),
+    )
+    await res3_2.insert()
+
+    await assert_expected_count({"std::File": 1, "std::Dummy": 1})  # 1 File resource and 1 Dummy resource in model v2
+
+
 async def test_resources_report(init_dataclasses_and_load_schema):
     project = data.Project(name="test")
     await project.insert()
 
     env = data.Environment(name="dev", project=project.id, repo_url="", repo_branch="")
     await env.insert()
 
@@ -2194,44 +2183,51 @@
 
     # make sure deleting the base code does not delete the copied code
     await code3.delete()
     assert len(await data.Code.get_versions(env.id, code3.version)) == 0
     assert len(await data.Code.get_versions(env.id, code3.version + 1)) == 1
 
 
-async def test_parameter(init_dataclasses_and_load_schema):
+@pytest.mark.parametrize("halted", [True, False])
+async def test_parameter(init_dataclasses_and_load_schema, halted):
+    # verify the call to "get_updated_before". If the env is halted it shouldn't return any result
     project = data.Project(name="test")
     await project.insert()
 
     env = data.Environment(name="dev", project=project.id, repo_url="", repo_branch="")
     await env.insert()
 
+    if halted:
+        await env.update_fields(halted=True)
+
     time1 = datetime.datetime(2018, 7, 14, 12, 30)
     time2 = datetime.datetime(2018, 7, 16, 12, 30)
     time3 = datetime.datetime(2018, 7, 12, 12, 30)
 
     parameters = []
     for current_time in [time1, time2, time3]:
         t = current_time.strftime("%Y-%m-%dT%H:%M:%S.%f")
         parameter = data.Parameter(
             name="param_" + t, value="test_val_" + t, environment=env.id, source="test", updated=current_time
         )
         parameters.append(parameter)
         await parameter.insert()
 
-    updated_before = await data.Parameter.get_updated_before(datetime.datetime(2018, 7, 12, 12, 30))
+    updated_before = await data.Parameter.get_updated_before_active_env(datetime.datetime(2018, 7, 12, 12, 30))
     assert len(updated_before) == 0
-    updated_before = await data.Parameter.get_updated_before(datetime.datetime(2018, 7, 14, 12, 30))
-    assert len(updated_before) == 1
-    assert (updated_before[0].environment, updated_before[0].name) == (parameters[2].environment, parameters[2].name)
-    updated_before = await data.Parameter.get_updated_before(datetime.datetime(2018, 7, 15, 12, 30))
+    updated_before = await data.Parameter.get_updated_before_active_env(datetime.datetime(2018, 7, 14, 12, 30))
+    assert len(updated_before) == (0 if halted else 1)
+    if not halted:
+        assert (updated_before[0].environment, updated_before[0].name) == (parameters[2].environment, parameters[2].name)
+    updated_before = await data.Parameter.get_updated_before_active_env(datetime.datetime(2018, 7, 15, 12, 30))
     list_of_ids = [(x.environment, x.name) for x in updated_before]
-    assert len(updated_before) == 2
-    assert (parameters[0].environment, parameters[0].name) in list_of_ids
-    assert (parameters[2].environment, parameters[2].name) in list_of_ids
+    assert len(updated_before) == (0 if halted else 2)
+    if not halted:
+        assert (parameters[0].environment, parameters[0].name) in list_of_ids
+        assert (parameters[2].environment, parameters[2].name) in list_of_ids
 
 
 async def test_parameter_list_parameters(init_dataclasses_and_load_schema):
     project = data.Project(name="test")
     await project.insert()
 
     env = data.Environment(name="dev", project=project.id, repo_url="", repo_branch="")
@@ -2477,89 +2473,111 @@
     for item in table_names_in_classes_list:
         # The DB table name for the User class is named inmanta_user
         if item == "user":
             item = "inmanta_user"
         assert item in table_names_in_database
 
 
-async def test_purgelog_test(init_dataclasses_and_load_schema):
+@pytest.mark.parametrize("env1_halted", [True, False])
+@pytest.mark.parametrize("env2_halted", [True, False])
+async def test_purgelog_test(init_dataclasses_and_load_schema, env1_halted, env2_halted):
     project = data.Project(name="test")
     await project.insert()
 
-    env = data.Environment(name="dev", project=project.id, repo_url="", repo_branch="")
-    await env.insert()
+    envs = []
 
-    version = 1
-    cm = data.ConfigurationModel(
-        environment=env.id,
-        version=version,
-        date=datetime.datetime.now(),
-        total=1,
-        version_info={},
-        released=True,
-        deployed=True,
-        is_suitable_for_partial_compiles=False,
-    )
-    await cm.insert()
+    timestamp_eight_days_ago = datetime.datetime.now().astimezone() - datetime.timedelta(days=8)
+    timestamp_six_days_ago = datetime.datetime.now().astimezone() - datetime.timedelta(days=6)
 
-    res1 = data.Resource.new(
-        environment=env.id,
-        resource_version_id="std::File[agent1,path=/etc/file1],v=1",
-        status=const.ResourceState.deployed,
-        last_deploy=datetime.datetime(2018, 7, 14, 14, 30),
-        attributes={"path": "/etc/file2"},
-    )
-    await res1.insert()
+    for i in range(2):
+        env = data.Environment(name=f"dev-{i}", project=project.id, repo_url="", repo_branch="")
+        await env.insert()
+        envs.append(env)
 
-    # ResourceAction 1
-    timestamp_ra1 = datetime.datetime.now() - datetime.timedelta(days=8)
-    log_line_ra1 = data.LogLine.log(logging.INFO, "Successfully stored version %(version)d", version=1)
-    action_id = uuid.uuid4()
-    ra1 = data.ResourceAction(
-        environment=env.id,
-        version=version,
-        resource_version_ids=[res1.resource_version_id],
-        action_id=action_id,
-        action=const.ResourceAction.store,
-        started=timestamp_ra1,
-        finished=datetime.datetime.now(),
-        messages=[log_line_ra1],
-    )
-    await ra1.insert()
+        version = 1
+        cm = data.ConfigurationModel(
+            environment=env.id,
+            version=version,
+            date=datetime.datetime.now(),
+            total=1,
+            version_info={},
+            released=True,
+            deployed=True,
+            is_suitable_for_partial_compiles=False,
+        )
+        await cm.insert()
 
-    res2 = data.Resource.new(
-        environment=env.id,
-        resource_version_id="std::File[agent1,path=/etc/file2],v=1",
-        status=const.ResourceState.deployed,
-        last_deploy=datetime.datetime(2018, 7, 14, 14, 30),
-        attributes={"path": "/etc/file2"},
-    )
-    await res2.insert()
+        res1 = data.Resource.new(
+            environment=env.id,
+            resource_version_id="std::File[agent1,path=/etc/file1],v=1",
+            status=const.ResourceState.deployed,
+            last_deploy=datetime.datetime(2018, 7, 14, 14, 30),
+            attributes={"path": "/etc/file2"},
+        )
+        await res1.insert()
 
-    # ResourceAction 2
-    timestamp_ra2 = datetime.datetime.now() - datetime.timedelta(days=6)
-    log_line_ra2 = data.LogLine.log(logging.INFO, "Successfully stored version %(version)d", version=2)
-    action_id = uuid.uuid4()
-    ra2 = data.ResourceAction(
-        environment=env.id,
-        version=version,
-        resource_version_ids=[res2.resource_version_id],
-        action_id=action_id,
-        action=const.ResourceAction.store,
-        started=timestamp_ra2,
-        finished=datetime.datetime.now(),
-        messages=[log_line_ra2],
-    )
-    await ra2.insert()
+        # ResourceAction 1
 
-    assert len(await data.ResourceAction.get_list()) == 2
+        log_line_ra1 = data.LogLine.log(logging.INFO, "Successfully stored version %(version)d", version=1)
+        action_id = uuid.uuid4()
+        ra1 = data.ResourceAction(
+            environment=env.id,
+            version=version,
+            resource_version_ids=[res1.resource_version_id],
+            action_id=action_id,
+            action=const.ResourceAction.store,
+            started=timestamp_eight_days_ago,
+            finished=datetime.datetime.now(),
+            messages=[log_line_ra1],
+        )
+        await ra1.insert()
+
+        res2 = data.Resource.new(
+            environment=env.id,
+            resource_version_id="std::File[agent1,path=/etc/file2],v=1",
+            status=const.ResourceState.deployed,
+            last_deploy=datetime.datetime(2018, 7, 14, 14, 30),
+            attributes={"path": "/etc/file2"},
+        )
+        await res2.insert()
+
+        # ResourceAction 2
+        log_line_ra2 = data.LogLine.log(logging.INFO, "Successfully stored version %(version)d", version=2)
+        action_id = uuid.uuid4()
+        ra2 = data.ResourceAction(
+            environment=env.id,
+            version=version,
+            resource_version_ids=[res2.resource_version_id],
+            action_id=action_id,
+            action=const.ResourceAction.store,
+            started=timestamp_six_days_ago,
+            finished=datetime.datetime.now(),
+            messages=[log_line_ra2],
+        )
+        await ra2.insert()
+
+    if env1_halted:
+        await envs[0].update_fields(halted=True)
+    if env2_halted:
+        await envs[1].update_fields(halted=True)
+
+    # Make the retention time for the second environment shorter than the default 7 days
+    await envs[1].set(data.RESOURCE_ACTION_LOGS_RETENTION, value=2)
+
+    assert len(await data.ResourceAction.get_list()) == 4  # Two ra's in each environment
     await data.ResourceAction.purge_logs()
-    assert len(await data.ResourceAction.get_list()) == 1
+    number_ra_env1 = 2 if env1_halted else 1  # if not halted one is cleaned up
+    number_ra_env2 = 2 if env2_halted else 0  # if not halted both are cleaned up
+    assert len(await data.ResourceAction.get_list()) == number_ra_env1 + number_ra_env2
     remaining_resource_action = (await data.ResourceAction.get_list())[0]
-    assert remaining_resource_action.action_id == ra2.action_id
+
+    # verify that after a cleanup (without halted envs) the remaining record is the right one.
+    if not (env1_halted or env2_halted):
+        assert remaining_resource_action.environment == envs[0].id
+        assert remaining_resource_action.started == timestamp_six_days_ago
 
 
 async def test_insert_many(init_dataclasses_and_load_schema, postgresql_client):
     project1 = data.Project(name="proj1")
     project2 = data.Project(name="proj2")
     projects = [project1, project2]
     await data.Project.insert_many(projects)
```

### Comparing `inmanta-core-8.3.0/tests/test_data_concurrency.py` & `inmanta-core-9.3.0/tests/test_data_concurrency.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/tests/test_data_model.py` & `inmanta-core-9.3.0/tests/test_data_model.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/tests/test_deploy.py` & `inmanta-core-9.3.0/tests/test_deploy.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/tests/test_docs_snippets.py` & `inmanta-core-9.3.0/tests/test_docs_snippets.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/tests/test_docstring_parser.py` & `inmanta-core-9.3.0/tests/test_docstring_parser.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/tests/test_env.py` & `inmanta-core-9.3.0/tests/test_env.py`

 * *Files 4% similar despite different names*

```diff
@@ -43,14 +43,15 @@
         "because the build tag on the development branch is set to .dev0 by default. The inmanta package protection feature "
         "would make pip install a non-editable version of the same package. But no version with build tag .dev0 exists "
         "on the python package repository.",
         allow_module_level=True,
     )
 
 
+@pytest.mark.slowtest
 def test_venv_pyton_env_empty_string(tmpdir):
     """test that an exception is raised if the venv path is an empty string"""
     with pytest.raises(ValueError) as e:
         env.VirtualEnv("")
     assert e.value.args[0] == "The env_path cannot be an empty string."
 
     env_dir1 = tmpdir.mkdir("env1").strpath
@@ -69,14 +70,15 @@
     assert e.value.args[0] == "The python_path cannot be an empty string."
 
     with pytest.raises(ValueError) as e:
         env.PythonEnvironment(env_path="")
     assert e.value.args[0] == "The env_path cannot be an empty string."
 
 
+@pytest.mark.slowtest
 def test_basic_install(tmpdir):
     """If this test fails, try running "pip uninstall lorem dummy-yummy iplib" before running it."""
     env_dir1 = tmpdir.mkdir("env1").strpath
 
     with pytest.raises(ImportError):
         import lorem  # NOQA
 
@@ -109,14 +111,15 @@
         )
     except CalledProcessError as ep:
         print(ep.stdout)
         raise
     import iplib  # NOQA
 
 
+@pytest.mark.slowtest
 def test_install_fails(tmpdir, caplog, monkeypatch):
     venv = env.VirtualEnv(tmpdir)
     venv.use_virtual_env()
     caplog.clear()
     caplog.set_level(logging.INFO)
     package_name = "non-existing-pkg-inmanta"
 
@@ -134,14 +137,15 @@
     with pytest.raises(Exception):
         venv.install_from_list([package_name])
 
     log_sequence = LogSequence(caplog)
     log_sequence.contains("inmanta.env", logging.INFO, f"requirements:\n{package_name}")
 
 
+@pytest.mark.slowtest
 def test_install_package_already_installed_in_parent_env(tmpdir):
     """Test using and installing a package that is already present in the parent virtual environment."""
     # get all packages in the parent
     parent_installed = list(env.process_env.get_installed_packages().keys())
 
     # create a venv and list all packages available in the venv
     venv = env.VirtualEnv(tmpdir)
@@ -224,14 +228,15 @@
         # python version is not included in path on windows
         with patch("sys.platform", new="linux"):
             assert env.PythonEnvironment(env_path=str(tmpdir)).site_packages_dir == os.path.join(
                 str(tmpdir), "lib", "python3.123", "site-packages"
             )
 
 
+@pytest.mark.slowtest
 @pytest.mark.parametrize_any("version", [None, version.Version("8.6.0")])
 def test_process_env_install_from_index(
     tmpdir: str,
     tmpvenv_active: Tuple[py.path.local, py.path.local],
     version: Optional[version.Version],
 ) -> None:
     """
@@ -242,37 +247,40 @@
     env.process_env.install_from_index([Requirement.parse(package_name + (f"=={version}" if version is not None else ""))])
     installed: Dict[str, version.Version] = env.process_env.get_installed_packages()
     assert package_name in installed
     if version is not None:
         assert installed[package_name] == version
 
 
+@pytest.mark.slowtest
 def test_process_env_install_from_index_not_found(tmpvenv_active: Tuple[py.path.local, py.path.local]) -> None:
     """
     Attempt to install a package that does not exist from a pip index. Assert the appropriate error is raised.
     """
     with pytest.raises(env.PackageNotFound):
         # pass empty index list for security reasons (anyone could publish this package to PyPi)
         env.process_env.install_from_index([Requirement.parse("this-package-does-not-exist")], index_urls=[])
 
 
+@pytest.mark.slowtest
 def test_process_env_install_from_index_conflicting_reqs(
     tmpdir: str, tmpvenv_active: Tuple[py.path.local, py.path.local]
 ) -> None:
     """
     Attempt to install a package with conflicting version requirements from a pip index. Make sure this fails and the
     package remains uninstalled.
     """
     package_name: str = "more-itertools"
     with pytest.raises(env.ConflictingRequirements) as e:
         env.process_env.install_from_index([Requirement.parse(f"{package_name}{version}") for version in [">8.5", "<=8"]])
     assert "conflicting dependencies" in e.value.msg
     assert package_name not in env.process_env.get_installed_packages()
 
 
+@pytest.mark.slowtest
 @pytest.mark.parametrize("editable", [True, False])
 def test_process_env_install_from_source(
     tmpvenv_active: Tuple[py.path.local, py.path.local],
     modules_v2_dir: str,
     editable: bool,
 ) -> None:
     """
@@ -334,14 +342,15 @@
     # verify that the package was installed in the development venv
     assert str(venv_dir) in module_file
     importlib.import_module(module_name)
     assert module_name in sys.modules
     assert sys.modules[module_name].__file__ == module_file
 
 
+@pytest.mark.slowtest
 def test_active_env_get_module_file_editable_namespace_package(
     tmpdir: str,
     tmpvenv_active: Tuple[py.path.local, py.path.local],
     modules_v2_dir: str,
 ) -> None:
     """
     Verify that get_module_file works after installing an editable namespace package in an active environment.
@@ -449,14 +458,15 @@
             False,
             "Incompatibility between constraint test-package-one~=1.0 and installed version 2.0.0 (from test-package-two)",
         ),
         expect_nonext=(True, error_msg + " test-package-one~=1.0 and installed version 2.0.0 (from test-package-two)"),
     )
 
 
+@pytest.mark.slowtest
 def test_active_env_check_constraints(caplog, tmpvenv_active_inherit: str) -> None:
     """
     Verify that the env.ActiveEnv.check() method's constraints parameter is taken into account as expected.
     """
     caplog.set_level(logging.WARNING)
     in_scope: Pattern[str] = re.compile("test-package-.*")
     constraints: List[Requirement] = [Requirement.parse("test-package-one~=1.0")]
@@ -492,14 +502,15 @@
     )
 
     caplog.clear()
     with pytest.raises(env.ConflictingRequirements):
         env.ActiveEnv.check(in_scope, constraints)
 
 
+@pytest.mark.slowtest
 def test_override_inmanta_package(tmpvenv_active_inherit: env.VirtualEnv) -> None:
     """
     Ensure that an ActiveEnv cannot override the main inmanta packages: inmanta-service-orchestrator, inmanta, inmanta-core.
     """
     installed_pkgs = tmpvenv_active_inherit.get_installed_packages()
     assert "inmanta-core" in installed_pkgs, "The inmanta-core package should be installed to run the tests"
 
@@ -510,14 +521,15 @@
         r"Cannot install inmanta-core==4\.0\.0 and inmanta-core=.* because these "
         r"package versions have conflicting dependencies",
         excinfo.value.msg,
     )
     assert match is not None
 
 
+@pytest.mark.slowtest
 def test_pip_binary_when_venv_path_contains_double_quote(tmpdir) -> None:
     """
     Test whether the pip binary generated by the VirtualEnv class works correctly when the
     pip binary contains a double quote.
     """
     venv_dir = os.path.join(tmpdir, 'tes t"test')
     venv = env.VirtualEnv(venv_dir)
@@ -532,14 +544,15 @@
         encoding="utf-8",
     )
     parsed_output = json.loads(result)
     # Ensure inheritance works correctly
     assert "inmanta-core" in [elem["name"] for elem in parsed_output]
 
 
+@pytest.mark.slowtest
 def test_cache_on_active_env(tmpvenv_active_inherit: env.ActiveEnv, local_module_package_index: str) -> None:
     """
     Test whether the cache on an active env works correctly.
     """
 
     def _assert_install(requirement: str, installed: bool) -> None:
         parsed_requirement = Requirement.parse(requirement)
@@ -571,27 +584,29 @@
     assert content.strip() == "dep[opt] == 1.2.3"
 
     dependency = "dep[opt,dev]==1.2.3"
     content: str = env.ActiveEnv._gen_content_requirements_file([dependency])
     assert content.strip() == "dep[dev,opt] == 1.2.3"
 
 
+@pytest.mark.slowtest
 def test_basic_logging(tmpdir, caplog):
     with caplog.at_level(logging.INFO):
         env_dir1 = tmpdir.mkdir("env1").strpath
 
         venv1 = env.VirtualEnv(env_dir1)
 
         venv1.use_virtual_env()
 
         log_sequence = LogSequence(caplog)
         log_sequence.assert_not("inmanta.env", logging.INFO, f"Creating new virtual environment in {env_dir1}")
         log_sequence.contains("inmanta.env", logging.INFO, f"Using virtual environment at {env_dir1}")
 
 
+@pytest.mark.slowtest
 def test_are_installed_dependency_cycle_on_extra(tmpdir, tmpvenv_active_inherit: env.VirtualEnv) -> None:
     """
     Ensure that the `ActiveEnv.are_installed()` method doesn't go into an infinite loop when there is a circular dependency
     involving an extra.
 
     Dependency loop:
         pkg[optional]
@@ -619,14 +634,15 @@
     )
 
     requirements = [Requirement.parse("pkg[optional-pkg]")]
     tmpvenv_active_inherit.install_from_index(requirements=requirements, index_urls=[pip_index.url])
     assert tmpvenv_active_inherit.are_installed(requirements=requirements)
 
 
+@pytest.mark.slowtest
 def test_pip_logs(caplog, tmpvenv_active_inherit: str) -> None:
     """
     Verify the logs of a pip install:
         - all records start with 'inmanta.pip'
         - content of requirements and constraints files are logged
         - the pip command is logged
     """
```

### Comparing `inmanta-core-8.3.0/tests/test_export.py` & `inmanta-core-9.3.0/tests/test_export.py`

 * *Files 3% similar despite different names*

```diff
@@ -19,19 +19,22 @@
 import logging
 import os
 import shutil
 from typing import Dict, List, Optional
 
 import pytest
 
+import inmanta.resources
 from inmanta import config, const
 from inmanta.ast import CompilerException, ExternalException
 from inmanta.const import ResourceState
-from inmanta.data import Resource
+from inmanta.data import Environment, Resource
 from inmanta.export import DependencyCycleException
+from inmanta.server import SLICE_RESOURCE
+from inmanta.server.server import Server
 from utils import LogSequence, v1_module_from_template
 
 
 async def assert_resource_set_assignment(environment, assignment: Dict[str, Optional[str]]) -> None:
     """
     Verify whether the resources on the server are assignment to the resource sets given via the assignment argument.
 
@@ -206,28 +209,43 @@
     await snippetcompiler.do_export_and_deploy()
 
     response = await client.list_versions(tid=environment)
     assert response.code == 200
     assert len(response.result["versions"]) == 1
 
 
-async def test_server_export(snippetcompiler, server, client, environment):
+async def test_server_export(snippetcompiler, server: Server, client, environment):
     snippetcompiler.setup_for_snippet(
         """
             h = std::Host(name="test", os=std::linux)
             f = std::ConfigFile(host=h, path="/etc/motd", content="test")
         """
     )
     await snippetcompiler.do_export_and_deploy()
 
     result = await client.list_versions(tid=environment)
     assert result.code == 200
     assert len(result.result["versions"]) == 1
     assert result.result["versions"][0]["total"] == 1
 
+    version = result.result["versions"][0]["version"]
+    result = await client.get_version(tid=environment, id=result.result["versions"][0]["version"])
+    assert result.code == 200
+
+    for res in result.result["resources"]:
+        res["attributes"]["id"] = res["id"]
+        resource = inmanta.resources.Resource.deserialize(res["attributes"])
+        assert resource.version == resource.id.version == version
+
+    resources = await server.get_slice(SLICE_RESOURCE).get_resources_in_latest_version(
+        environment=await Environment.get_by_id(environment)
+    )
+
+    assert resources[0].attributes["version"] == version
+
 
 async def test_dict_export_server(snippetcompiler, server, client, environment):
     config.Config.set("config", "environment", environment)
     snippetcompiler.setup_for_snippet(
         """
 import exp
```

### Comparing `inmanta-core-8.3.0/tests/test_extension_loading.py` & `inmanta-core-9.3.0/tests/test_extension_loading.py`

 * *Files 2% similar despite different names*

```diff
@@ -80,20 +80,27 @@
 
 def test_phase_1(caplog):
     with splice_extension_in("test_module_path"):
         ibl = InmantaBootloader()
 
         config.server_enabled_extensions.set("testplugin,noext")
 
-        all = ibl._load_extensions()
+        with caplog.at_level(logging.INFO):
+            all = ibl._load_extensions()
 
-        assert "testplugin" in all
-        assert all["testplugin"] == inmanta_ext.testplugin.extension
+            assert "testplugin" in all
+            assert all["testplugin"] == inmanta_ext.testplugin.extension
 
-        log_contains(caplog, "inmanta.server.bootloader", logging.WARNING, "Could not load extension inmanta_ext.noext")
+            log_contains(
+                caplog,
+                "inmanta.server.bootloader",
+                logging.INFO,
+                "Enabled extensions: inmanta_ext.testplugin, inmanta_ext.noext, inmanta_ext.core",
+            )
+            log_contains(caplog, "inmanta.server.bootloader", logging.WARNING, "Could not load extension inmanta_ext.noext")
 
 
 def test_phase_2():
     with splice_extension_in("test_module_path"):
         import inmanta_ext.testplugin.extension
 
         ibl = InmantaBootloader()
```

### Comparing `inmanta-core-8.3.0/tests/test_file_parser.py` & `inmanta-core-9.3.0/tests/test_file_parser.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/tests/test_handler.py` & `inmanta-core-9.3.0/tests/test_handler.py`

 * *Files 7% similar despite different names*

```diff
@@ -16,16 +16,16 @@
     Contact: code@inmanta.com
 """
 import logging
 from typing import Any, Dict
 
 import pytest
 
-from inmanta import resources
-from inmanta.agent.handler import CRUDHandler, HandlerContext, ResourcePurged
+from inmanta.agent.handler import CRUDHandlerGeneric as CRUDHandler
+from inmanta.agent.handler import HandlerContext, ResourcePurged
 from inmanta.const import ResourceState
 from inmanta.resources import Id, PurgeableResource, resource
 from utils import log_contains, no_error_in_logs
 
 
 @pytest.mark.parametrize(
     "purged_desired,purged_actual,excn,create,delete",
@@ -43,40 +43,40 @@
 @pytest.mark.parametrize("updated", [True, False])
 def test_CRUD_handler_purged_response(purged_desired, purged_actual, excn, create, delete, updated, caplog):
     """
     purged_actual and excn are conceptually equivalent, this test case serves to prove that they are in fact, equivalent
     """
     caplog.set_level(logging.DEBUG)
 
-    class DummyCrud(CRUDHandler):
+    @resource("aa::Aa", "aa", "aa")
+    class TestResource(PurgeableResource):
+        fields = ("value",)
+
+    class DummyCrud(CRUDHandler[TestResource]):
         def __init__(self):
             self.updated = False
             self.created = False
             self.deleted = False
 
-        def read_resource(self, ctx: HandlerContext, resource: resources.PurgeableResource) -> None:
+        def read_resource(self, ctx: HandlerContext, resource: TestResource) -> None:
             resource.purged = purged_actual
             if updated:
                 resource.value = "b"
             if excn:
                 raise ResourcePurged()
 
-        def update_resource(self, ctx: HandlerContext, changes: dict, resource: resources.PurgeableResource) -> None:
+        def update_resource(self, ctx: HandlerContext, changes: dict, resource: TestResource) -> None:
             self.updated = True
 
-        def create_resource(self, ctx: HandlerContext, resource: resources.PurgeableResource) -> None:
+        def create_resource(self, ctx: HandlerContext, resource: TestResource) -> None:
             self.created = True
 
-        def delete_resource(self, ctx: HandlerContext, resource: resources.PurgeableResource) -> None:
+        def delete_resource(self, ctx: HandlerContext, resource: TestResource) -> None:
             self.deleted = True
 
-    @resource("aa::Aa", "aa", "aa")
-    class TestResource(PurgeableResource):
-        fields = ("value",)
-
     res = TestResource(Id("aa::Aa", "aa", "aa", "aa", 1))
     res.purged = purged_desired
     res.value = "a"
 
     ctx = HandlerContext(res, False)
 
     handler = DummyCrud()
@@ -99,30 +99,28 @@
     the CRUD handler hang in production and that an exception is raised when the
     RUNNING_TEST variable is set to True.
     """
     import inmanta
 
     monkeypatch.setattr(inmanta, "RUNNING_TESTS", running_test)
 
-    class DummyCrud(CRUDHandler):
+    @resource(name="aa::Aa", id_attribute="aa", agent="aa")
+    class TestResource(PurgeableResource):
+        fields = ("value",)
+
+    class DummyCrud(CRUDHandler[TestResource]):
         def __init__(self):
             self.updated = False
 
-        def read_resource(self, ctx: HandlerContext, resource: resources.PurgeableResource) -> None:
+        def read_resource(self, ctx: HandlerContext, resource: TestResource) -> None:
             resource.value = "b"
 
-        def update_resource(
-            self, ctx: HandlerContext, changes: Dict[str, Dict[str, Any]], resource: resources.PurgeableResource
-        ) -> None:
+        def update_resource(self, ctx: HandlerContext, changes: Dict[str, Dict[str, Any]], resource: TestResource) -> None:
             self.updated = True
 
-    @resource(name="aa::Aa", id_attribute="aa", agent="aa")
-    class TestResource(PurgeableResource):
-        fields = ("value",)
-
     res = TestResource(Id(entity_type="aa::Aa", agent_name="aa", attribute="aa", attribute_value="aa", version=1))
 
     # Sets are not JSON serializable
     res.value = {"a"}
     res.purged = False
 
     ctx = HandlerContext(res, dry_run=False)
@@ -152,32 +150,30 @@
     the CRUD handler hang in production and that an exception is raised when the
     RUNNING_TEST variable is set to True.
     """
     import inmanta
 
     monkeypatch.setattr(inmanta, "RUNNING_TESTS", running_test)
 
-    class DummyCrud(CRUDHandler):
+    @resource(name="aa::Aa", id_attribute="aa", agent="aa")
+    class TestResource(PurgeableResource):
+        fields = ("value",)
+
+    class DummyCrud(CRUDHandler[TestResource]):
         def __init__(self):
             self.updated = False
 
-        def read_resource(self, ctx: HandlerContext, resource: resources.PurgeableResource) -> None:
+        def read_resource(self, ctx: HandlerContext, resource: TestResource) -> None:
             resource.value = "b"
             unserializable_set = {"b"}
             ctx.debug(msg="Unserializable kwargs: ", kwargs={"unserializable": unserializable_set})
 
-        def update_resource(
-            self, ctx: HandlerContext, changes: Dict[str, Dict[str, Any]], resource: resources.PurgeableResource
-        ) -> None:
+        def update_resource(self, ctx: HandlerContext, changes: Dict[str, Dict[str, Any]], resource: TestResource) -> None:
             self.updated = True
 
-    @resource(name="aa::Aa", id_attribute="aa", agent="aa")
-    class TestResource(PurgeableResource):
-        fields = ("value",)
-
     res = TestResource(Id(entity_type="aa::Aa", agent_name="aa", attribute="aa", attribute_value="aa", version=1))
 
     res.value = "a"
     res.purged = False
 
     ctx = HandlerContext(res, dry_run=False)
```

### Comparing `inmanta-core-8.3.0/tests/test_import_entry_points.py` & `inmanta-core-9.3.0/tests/test_import_entry_points.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/tests/test_influxdbreporting.py` & `inmanta-core-9.3.0/tests/test_influxdbreporting.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/tests/test_io.py` & `inmanta-core-9.3.0/tests/test_io.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/tests/test_jwt.py` & `inmanta-core-9.3.0/tests/test_jwt.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/tests/test_loader.py` & `inmanta-core-9.3.0/tests/test_loader.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/tests/test_module_loader.py` & `inmanta-core-9.3.0/tests/test_module_loader.py`

 * *Files 2% similar despite different names*

```diff
@@ -17,21 +17,21 @@
 """
 import logging
 import os
 import py_compile
 import shutil
 import sys
 from collections import abc
-from typing import List, Optional, Set
+from typing import Dict, List, Optional, Sequence, Set
 
 import py
 import pytest
 from pkg_resources import Requirement
 
-from inmanta import const, loader, plugins, resources
+from inmanta import compiler, const, loader, plugins, resources
 from inmanta.ast import CompilerException
 from inmanta.const import CF_CACHE_DIR
 from inmanta.env import ConflictingRequirements, LocalPackagePath, process_env
 from inmanta.module import (
     DummyProject,
     InmantaModuleRequirement,
     InvalidModuleException,
@@ -170,17 +170,22 @@
             snippet=f"import {module_name}",
             install_project=True,
             python_package_sources=[],
             python_requires=[
                 InmantaModuleRequirement.parse(module_name).get_python_package_requirement(),
             ],
         )
+
     message: str = (
-        "Attempting to install a v2 module non_existing_module but no v2 module source is configured. Add at least one repo of "
-        'type "package" to the project config file.'
+        "Attempting to install a v2 module non_existing_module but no v2 module source is configured. Add the relevant pip "
+        "indexes to the project config file. e.g. to add PyPi as a module source, add the following to "
+        "the `pip` section of the project's `project.yml`:"
+        "\n\t  index_urls:"
+        "\n\t\t  - https://pypi.org/simple"
+        "\nAnother option is to set the use_config_file project option to true to use the system's pip config file."
     )
     assert message in e.value.format_trace()
 
 
 @pytest.mark.parametrize("allow_v1", [True, False])
 def test_load_module_v1_already_installed(snippetcompiler, modules_dir: str, allow_v1: bool) -> None:
     """
@@ -1359,7 +1364,118 @@
     shutil.rmtree(module_dir_site_packages)
     os.symlink(os.path.join(module_dir, rel_path_src), module_dir_site_packages)
 
     # verify that module can be found
     module: Optional[ModuleV2] = ModuleV2Source([]).get_installed_module(DummyProject(autostd=False), "minimalv2module")
     assert module is not None
     assert module.path == module_dir
+
+
+def test_cross_module_dependency(local_module_package_index: str, snippetcompiler, capsys) -> None:
+    """
+    This test checks that the python code living in the inmanta_plugins dir of a module ('anothermod' in this test case)
+    that is not loaded, can be used from the plugins of another module. ('cross_module_dependency' in this test case)
+    """
+
+    def check_name_space(name_space: Dict[str, object], includes: Sequence[str], excludes: Sequence[str]) -> None:
+        """
+        Check that all the items in `includes` are present in `name_space`
+        and that no item in `excludes` is present in `name_space`
+        """
+        for x in includes:
+            assert x in name_space
+        for x in excludes:
+            assert x not in name_space
+
+    project: Project = snippetcompiler.setup_for_snippet(
+        """
+import cross_module_dependency
+
+cross_module_dependency::print_message('message from project model')
+cross_module_dependency::call_to_triple_from_another_mod('triple this string')
+
+        """.strip(),
+        python_package_sources=[local_module_package_index],
+        python_requires=[
+            InmantaModuleRequirement.parse("minimalv2module").get_python_package_requirement(),
+            InmantaModuleRequirement.parse("cross_module_dependency").get_python_package_requirement(),
+        ],
+        autostd=False,
+    )
+
+    check_name_space(
+        name_space=project.modules, includes=["cross_module_dependency"], excludes=["minimalv2module", "anothermod"]
+    )
+    check_name_space(
+        name_space=sys.modules,
+        includes=[],
+        excludes=["inmanta_plugins.cross_module_dependency", "inmanta_plugins.minimalv2module", "inmanta_plugins.anothermod"],
+    )
+
+    types, _ = compiler.do_compile()
+
+    out, _ = capsys.readouterr()
+    output = out.strip()
+
+    expected_output: List[str] = [
+        "message from project model",
+        "triple this string" * 3,
+        "message from cross_module_dependency model",
+    ]
+    for line in expected_output:
+        assert line in output
+
+    check_name_space(
+        name_space=project.modules, includes=["cross_module_dependency"], excludes=["minimalv2module", "anothermod"]
+    )
+    check_name_space(
+        name_space=sys.modules,
+        includes=["inmanta_plugins.cross_module_dependency", "inmanta_plugins.anothermod"],
+        excludes=["inmanta_plugins.minimalv2module"],
+    )
+    # Check that the flag_plugin Plugin object is kept in PluginMeta
+    check_name_space(
+        name_space=plugins.PluginMeta.get_functions(),
+        includes=[
+            "cross_module_dependency::print_message",
+            "cross_module_dependency::call_to_triple_from_another_mod",
+            "anothermod::flag_plugin",
+        ],
+        excludes=[],
+    )
+    # ...but that the corresponding statement is NOT created
+    check_name_space(
+        name_space=types,
+        includes=[
+            "cross_module_dependency::print_message",
+            "cross_module_dependency::call_to_triple_from_another_mod",
+        ],
+        excludes=["anothermod::flag_plugin"],
+    )
+
+
+def test_cross_module_dependency_sub_module(local_module_package_index: str, snippetcompiler, capsys) -> None:
+    """
+    This test checks that the plugins of a top-level module still work even if one of its sub-modules is not loaded.
+    """
+
+    snippetcompiler.setup_for_snippet(
+        """
+import complex_module_dependencies_mod2
+
+complex_module_dependencies_mod2::cmd_mod2()
+        """.strip(),
+        python_package_sources=[local_module_package_index],
+        python_requires=[
+            InmantaModuleRequirement.parse("complex_module_dependencies_mod2").get_python_package_requirement(),
+        ],
+        autostd=False,
+    )
+
+    compiler.do_compile()
+
+    out, _ = capsys.readouterr()
+    output = out.strip()
+
+    expected_output: str = "Hello from complex_module_dependencies_mod2"
+
+    assert expected_output in output
```

### Comparing `inmanta-core-8.3.0/tests/test_modules.py` & `inmanta-core-9.3.0/tests/test_modules.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/tests/test_openapi.py` & `inmanta-core-9.3.0/tests/test_openapi.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/tests/test_param.py` & `inmanta-core-9.3.0/tests/test_param.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/tests/test_parser.py` & `inmanta-core-9.3.0/tests/test_parser.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/tests/test_postgres.py` & `inmanta-core-9.3.0/tests/test_postgres.py`

 * *Files 1% similar despite different names*

```diff
@@ -25,15 +25,15 @@
 from collections import abc
 
 import asyncpg
 import pytest
 
 
 @pytest.mark.slowtest
-async def test_postgres_cascade_locking_order(postgresql_pool) -> None:
+async def test_postgres_cascade_locking_order(postgresql_pool, run_without_keeping_psql_logs) -> None:
     """
     Verifies that Postgres' cascade deletion acquires locks top-down. This is important because in order to avoid deadlocks
     we define a corresponding locking order for all transactions. See `TableLockMode`, `RowLockMode` and `ConfigurationModel`
     docstrings in `inmanta.data`.
     """
     async with postgresql_pool.acquire() as connection:
         await connection.execute(
@@ -91,15 +91,17 @@
             lock_bottom_up(),
             delete(),
         )
 
 
 @pytest.mark.slowtest
 @pytest.mark.parametrize("definition_order_one_two", [True, False])
-async def test_postgres_cascade_locking_order_siblings(postgresql_pool, definition_order_one_two: bool) -> None:
+async def test_postgres_cascade_locking_order_siblings(
+    postgresql_pool, definition_order_one_two: bool, run_without_keeping_psql_logs
+) -> None:
     """
     Verifies locking order for siblings in the cascade tree. Locking order seems to be based on definition order of the
     referencing columns. Locking order may shift in case of updates to the definition of these columns.
     """
     leaf_definitions: tuple[str] = tuple(
         f"CREATE TABLE IF NOT EXISTS {name} (name varchar PRIMARY KEY, myroot varchar REFERENCES root(name) ON DELETE CASCADE);"
         for name in ("leafone", "leaftwo")
```

### Comparing `inmanta-core-8.3.0/tests/test_postgres_proc.py` & `inmanta-core-9.3.0/tests/test_postgres_proc.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/tests/test_project.py` & `inmanta-core-9.3.0/tests/test_project.py`

 * *Files 1% similar despite different names*

```diff
@@ -208,18 +208,14 @@
     # Operation on non existing
     result = await client_v2.environment_get(id=uuid.uuid4())
     assert result.code == 404
 
     result = await client_v2.environment_delete(id=uuid.uuid4())
     assert result.code == 404
 
-    # Decommission
-    result = await client_v2.environment_decommission(id=env1_id)
-    assert result.code == 200
-
 
 async def test_modify_environment_project(client_v2):
     """Test modifying the project of an environment"""
 
     # Create two projects and two environments
     result = await client_v2.project_create("dev-project")
     assert result.code == 200
@@ -394,18 +390,14 @@
     result = await client_v2.environment_get(id=env1_id)
     assert result.code == 200
     assert result.result["data"]["name"] == "dev"
 
     result = await client_v2.environment_delete(id=uuid.uuid4())
     assert result.code == 404
 
-    # Decommission
-    result = await client_v2.environment_decommission(id=env1_id)
-    assert result.code == 200
-
     # Clear
     result = await client_v2.environment_clear(id=env1_id)
     assert result.code == 200
 
     # Delete
     result = await client_v2.environment_delete(id=env1_id)
     assert result.code == 200
```

### Comparing `inmanta-core-8.3.0/tests/test_projectmetadata.py` & `inmanta-core-9.3.0/tests/test_projectmetadata.py`

 * *Files 24% similar despite different names*

```diff
@@ -17,15 +17,15 @@
 """
 import logging
 from typing import List, Optional
 
 import pytest
 
 from inmanta.module import ModuleRepoType, Project, ProjectMetadata, RelationPrecedenceRule
-from utils import assert_no_warning
+from utils import assert_no_warning, log_contains
 
 
 @pytest.mark.parametrize(
     "repo",
     [
         ("https://github.com/inmanta/{}.git"),
         ("git@github.com:inmanta/{}.git"),
@@ -86,15 +86,76 @@
 def test_no_module_path(tmp_path, caplog):
     with caplog.at_level(logging.WARNING):
         with (tmp_path / "project.yml").open("w") as fh:
             fh.write(
                 """
     name: testproject
     downloadpath: libs
+    pip:
+        index_urls:
+            - https://pypi.org/simple
+    """
+            )
+
+        Project(tmp_path, autostd=False)
+    assert_no_warning(caplog)
+
+
+def test_deprecation_warning_repo_of_type_package(tmp_path, caplog):
+    with caplog.at_level(logging.WARNING):
+        with (tmp_path / "project.yml").open("w") as fh:
+            fh.write(
+                """
+    name: testproject
+    downloadpath: libs
     repo:
-        - url: https://pypi.org/simple
-          type: package
+       - url: https://pypi.org/simple
+         type: package
+    pip:
+        index_urls:
+            - https://pypi.org/simple
     """
             )
 
         Project(tmp_path, autostd=False)
+    log_contains(
+        caplog,
+        "inmanta.module",
+        logging.WARNING,
+        (
+            "Setting a pip index through the `repo -> url` option with type `package` in the project.yml file is deprecated. "
+            "Please set the pip index url through the `pip -> index_urls` option instead."
+        ),
+    )
+
+
+@pytest.mark.parametrize("use_pip_config_file, value", [(True, True), (True, False), (False, False)])
+def test_pip_config(tmp_path, caplog, use_pip_config_file, value):
+    """
+    Verify that "use_config_file" can be specified in a project.yml file but that it isn't mandatory
+    If it is not specified, verify that the default value "False" is used in the project.
+    """
+    pip_config_file = """
+    pip:
+        index_urls:
+            - https://pypi.org/simple
+
+    """
+    pip_config_file += (
+        f"""
+        use_config_file: {value}
+        """
+        if use_pip_config_file
+        else ""
+    )
+    with caplog.at_level(logging.WARNING):
+        with (tmp_path / "project.yml").open("w") as fh:
+            fh.write(
+                f"""
+    name: testproject
+    downloadpath: libs
+    {pip_config_file}
+    """
+            )
+    project = Project(tmp_path, autostd=False)
     assert_no_warning(caplog)
+    assert project.metadata.pip.use_config_file == value
```

### Comparing `inmanta-core-8.3.0/tests/test_protocol.py` & `inmanta-core-9.3.0/tests/test_protocol.py`

 * *Files 1% similar despite different names*

```diff
@@ -17,30 +17,28 @@
 """
 import asyncio
 import base64
 import datetime
 import json
 import os
 import random
-import threading
 import time
 import urllib.parse
 import uuid
 from enum import Enum
 from itertools import chain
 from typing import Any, Dict, Iterator, List, Optional, Union
 
 import pydantic
 import pytest
 import tornado
 from pydantic.types import StrictBool
-from tornado import gen, web
+from tornado import web
 from tornado.httpclient import AsyncHTTPClient, HTTPRequest
 from tornado.httputil import url_concat
-from tornado.platform.asyncio import AnyThreadEventLoopPolicy
 
 from inmanta import config, const, protocol
 from inmanta.const import ClientType
 from inmanta.data.model import BaseModel
 from inmanta.protocol import VersionMatch, exceptions, json_encode
 from inmanta.protocol.common import (
     HTML_CONTENT,
@@ -107,20 +105,15 @@
 
     # Get the file
     result = await client.get_file(id=hash)
     assert result.code == 404
 
 
 async def test_sync_client_files(client):
-    # work around for https://github.com/pytest-dev/pytest-asyncio/issues/168
-    asyncio.set_event_loop_policy(AnyThreadEventLoopPolicy())
-
     done = []
-    limit = 100
-    sleep = 0.01
 
     def do_test():
         sync_client = protocol.SyncClient("client")
 
         (hash, content, body) = make_random_file()
 
         # Check if the file exists
@@ -135,22 +128,15 @@
         result = sync_client.get_file(id=hash)
         assert result.code == 200
         assert "content" in result.result
         assert result.result["content"] == body
 
         done.append(True)
 
-    thread = threading.Thread(target=do_test)
-    thread.start()
-
-    while len(done) == 0 and limit > 0:
-        await gen.sleep(sleep)
-        limit -= 1
-
-    thread.join()
+    await asyncio.wait_for(asyncio.get_running_loop().run_in_executor(None, do_test), timeout=1)
     assert len(done) > 0
 
 
 async def test_client_files_stat(client):
     file_names = []
     i = 0
     while i < 10:
@@ -1567,33 +1553,60 @@
     server_slice: ServerSlice = TestSlice("my_test_slice")
     server.add_slice(server_slice)
     await server.start()
     async_finalizer.add(server_slice.stop)
     async_finalizer.add(server.stop)
 
     client = tornado.httpclient.AsyncHTTPClient()
+    param_value = "header_param_value"
 
-    # valid request should succeed
+    # Only parameter as header: should succeed
     request = tornado.httpclient.HTTPRequest(
         url=f"http://localhost:{opt.get_bind_port()}/api/v1/testmethod",
         method="POST",
         body=json_encode({"body_param": "body_param_value"}),
-        headers={"X-Inmanta-Header-Param": "header_param_value"},
+        headers={"X-Inmanta-Header-Param": param_value},
+    )
+    response: tornado.httpclient.HTTPResponse = await client.fetch(request)
+    assert response.code == 200
+
+    # Only provide parameter in body: should succeed
+    request = tornado.httpclient.HTTPRequest(
+        url=f"http://localhost:{opt.get_bind_port()}/api/v1/testmethod",
+        method="POST",
+        body=json_encode({"header_param": param_value, "body_param": "body_param_value"}),
+    )
+    response: tornado.httpclient.HTTPResponse = await client.fetch(request)
+    assert response.code == 200
+
+    # Body and header contain the same value for parameter: should succeed
+    request = tornado.httpclient.HTTPRequest(
+        url=f"http://localhost:{opt.get_bind_port()}/api/v1/testmethod",
+        method="POST",
+        body=json_encode({"header_param": param_value, "body_param": "body_param_value"}),
+        headers={"X-Inmanta-Header-Param": param_value},
     )
     response: tornado.httpclient.HTTPResponse = await client.fetch(request)
     assert response.code == 200
 
-    # invalid request should fail
+    # Body and header contain different value for parameter: should fail
+    param_different_value = "different_value"
     request = tornado.httpclient.HTTPRequest(
         url=f"http://localhost:{opt.get_bind_port()}/api/v1/testmethod",
         method="POST",
-        body=json_encode({"header_param": "header_param_value", "body_param": "body_param_value"}),
+        body=json_encode({"header_param": param_value, "body_param": "body_param_value"}),
+        headers={"X-Inmanta-Header-Param": param_different_value},
+    )
+    response = await client.fetch(request, raise_error=False)
+    assert response.code == 400
+    body = json.loads(response.body)
+    assert (
+        "Value for argument header_param was provided via a header and a non-header argument, but both"
+        f" values don't match (header={param_different_value}; non-header={param_value})" in body["message"]
     )
-    with pytest.raises(tornado.httpclient.HTTPClientError):
-        await client.fetch(request)
 
 
 @pytest.mark.parametrize("return_value,valid", [(1, True), (None, True), ("Hello World!", False)])
 async def test_2277_typedmethod_return_optional(async_finalizer, return_value: object, valid: bool, unused_tcp_port) -> None:
     @protocol.typedmethod(
         path="/typedtestmethod",
         operation="GET",
```

### Comparing `inmanta-core-8.3.0/tests/test_proxy.py` & `inmanta-core-9.3.0/tests/test_proxy.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/tests/test_resource.py` & `inmanta-core-9.3.0/tests/test_resource.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/tests/test_server.py` & `inmanta-core-9.3.0/tests/test_server.py`

 * *Files 2% similar despite different names*

```diff
@@ -82,22 +82,22 @@
     autostarted_agentmanager._agent_procs[env.id].terminate()
     await autostarted_agentmanager._agent_procs[env.id].wait()
     await retry_limited(lambda: len(sessionendpoint._sessions) == 0, 20)
     # Prevent race condition
     await retry_limited(lambda: len(agentmanager.tid_endpoint_to_session) == 0, 20)
     res = await autostarted_agentmanager._ensure_agents(env, ["iaas_agent"])
     assert res
-    await retry_limited(lambda: len(sessionendpoint._sessions) == 1, 3)
-    assert len(sessionendpoint._sessions) == 1
-
-    # second agent for same env
-    res = await autostarted_agentmanager._ensure_agents(env, ["iaas_agentx"])
-    assert res
-    await retry_limited(lambda: len(sessionendpoint._sessions) == 1, 20)
-    assert len(sessionendpoint._sessions) == 1
+    await retry_limited(
+        lambda: (
+            len(sessionendpoint._sessions) == 1
+            # starting any agent eventually causes it to reload the agent map, starting all three
+            and len(agentmanager.tid_endpoint_to_session.keys()) == 3
+        ),
+        5,
+    )
 
     # Test stopping all agents
     await autostarted_agentmanager.stop_agents(env)
     assert len(sessionendpoint._sessions) == 0
     assert len(autostarted_agentmanager._agent_procs) == 0
 
     log_doesnt_contain(caplog, "inmanta.config", logging.WARNING, "rest_transport not defined")
@@ -568,14 +568,25 @@
     assert result.code == 200
 
     result = await client.get_version(environment, version)
     assert result.code == 200
     assert result.result["model"]["done"] == 10
 
 
+async def test_get_resource_on_invalid_resource_id(server, client, environment) -> None:
+    """
+    Verify that a clear error message is returned when the resource version id passed to the
+    get_resource() endpoint has an invalid structure.
+    """
+    invalid_resource_version_id = "invalid resource version id"
+    result = await client.get_resource(tid=environment, id=invalid_resource_version_id)
+    assert result.code == 400
+    assert f"{invalid_resource_version_id} is not a valid resource version id" in result.result["message"]
+
+
 async def test_clear_environment(client, server, clienthelper, environment):
     """
     Test clearing out an environment
     """
     version = await clienthelper.get_version()
     result = await client.put_version(
         tid=environment, version=version, resources=[], unknowns=[], version_info={}, compiler_version=get_compiler_version()
@@ -1409,33 +1420,50 @@
     request = HTTPRequest(
         url=base_url,
     )
     response = await http_client.fetch(request, raise_error=False)
     assert result_url == response.effective_url
 
 
-async def test_cleanup_old_agents(server):
+@pytest.mark.parametrize("env1_halted", [True, False])
+@pytest.mark.parametrize("env2_halted", [True, False])
+async def test_cleanup_old_agents(server, client, env1_halted, env2_halted):
     """
     This test is testing the functionality of cleaning up old agents in the database.
     The test creates 2 environments and adds agents with various properties (some used in a version,
     some in the agent map, and some with the primary ID set), and then tests that
     the cleanup function correctly removes only the agents that meet the criteria for deletion.
+    Also verifies that only agents in envs that are not halted are cleaned up
     """
 
     project = data.Project(name="test")
     await project.insert()
 
     env1 = data.Environment(name="env1", project=project.id)
     await env1.insert()
     env2 = data.Environment(name="env2", project=project.id)
     await env2.insert()
 
     await env1.set(data.AUTOSTART_AGENT_MAP, {"agent3": "", "internal": ""})
     await env2.set(data.AUTOSTART_AGENT_MAP, {"agent1": "", "internal": ""})
 
+    # these checks are here to investigate the fact that the test case is flaky and that we have a suspicion
+    # that it is an issue with the agent map
+    agentmap_env1 = await client.get_setting(tid=env1.id, id=data.AUTOSTART_AGENT_MAP)
+    agentmap_env2 = await client.get_setting(tid=env2.id, id=data.AUTOSTART_AGENT_MAP)
+    assert agentmap_env1.result["value"] == {"agent3": "", "internal": ""}
+    assert agentmap_env2.result["value"] == {"agent1": "", "internal": ""}
+
+    if env1_halted:
+        result = await client.halt_environment(env1.id)
+        assert result.code == 200
+    if env2_halted:
+        result = await client.halt_environment(env2.id)
+        assert result.code == 200
+
     process_sid = uuid.uuid4()
     await data.AgentProcess(hostname="localhost-dummy", environment=env1.id, sid=process_sid, last_seen=datetime.now()).insert()
 
     id_primary = uuid.uuid4()
     await data.AgentInstance(id=id_primary, process=process_sid, name="dummy-instance", tid=env1.id).insert()
 
     version = 1
@@ -1493,24 +1521,42 @@
         paused=False,
         id_primary=None,
     ).insert()
 
     agents_before_purge = await data.Agent.get_list()
     assert len(agents_before_purge) == 6
 
+    # these checks are here to investigate the fact that the test case is flaky and that we have a suspicion
+    # that it is an issue with the agent map
+    agentmap_env1 = await client.get_setting(tid=env1.id, id=data.AUTOSTART_AGENT_MAP)
+    agentmap_env2 = await client.get_setting(tid=env2.id, id=data.AUTOSTART_AGENT_MAP)
+    assert agentmap_env1.result["value"] == {"agent3": "", "internal": ""}
+    assert agentmap_env2.result["value"] == {"agent1": "", "internal": ""}
+
     await server.get_slice(SLICE_ORCHESTRATION)._purge_versions()
+
+    # these checks are here to investigate the fact that the test case is flaky and that we have a suspicion
+    # that it is an issue with the agent map
+    agentmap_env1 = await client.get_setting(tid=env1.id, id=data.AUTOSTART_AGENT_MAP)
+    agentmap_env2 = await client.get_setting(tid=env2.id, id=data.AUTOSTART_AGENT_MAP)
+    assert agentmap_env1.result["value"] == {"agent3": "", "internal": ""}
+    assert agentmap_env2.result["value"] == {"agent1": "", "internal": ""}
+
     agents_after_purge = [(agent.environment, agent.name) for agent in await data.Agent.get_list()]
-    assert len(agents_after_purge) == 4
-    expected_agents_after_purge = [
-        (env1.id, "agent2"),
-        (env1.id, "agent3"),
-        (env1.id, "agent4"),
-        (env2.id, "agent1"),
-    ]
-    assert sorted(agents_after_purge) == sorted(expected_agents_after_purge)
+    number_agents_env1_after_purge = 4 if env1_halted else 3
+    number_agents_env2_after_purge = 2 if env2_halted else 1
+    assert len(agents_after_purge) == number_agents_env1_after_purge + number_agents_env2_after_purge
+    if not (env1_halted or env2_halted):
+        expected_agents_after_purge = [
+            (env1.id, "agent2"),
+            (env1.id, "agent3"),
+            (env1.id, "agent4"),
+            (env2.id, "agent1"),
+        ]
+        assert sorted(agents_after_purge) == sorted(expected_agents_after_purge)
 
 
 async def test_serialization_attributes_of_resource_to_api(client, server, environment, clienthelper) -> None:
     """
     Due to a bug, the version of a resource was always included in the attribute dictionary.
     This issue has been patched in the database, but at the API boundary we still serve the version
     field in the attributes dictionary for backwards compatibility. This test verifies that behavior.
```

### Comparing `inmanta-core-8.3.0/tests/test_type.py` & `inmanta-core-9.3.0/tests/test_type.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/tests/test_usersetup.py` & `inmanta-core-9.3.0/tests/test_usersetup.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/tests/test_util.py` & `inmanta-core-9.3.0/tests/test_util.py`

 * *Files identical despite different names*

### Comparing `inmanta-core-8.3.0/tox.ini` & `inmanta-core-9.3.0/tox.ini`

 * *Files identical despite different names*

