# Comparing `tmp/finplot-1.9.1.tar.gz` & `tmp/finplot-1.9.2.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "finplot-1.9.1.tar", last modified: Mon Apr 17 09:39:10 2023, max compression
+gzip compressed data, was "finplot-1.9.2.tar", last modified: Mon Jul  3 22:40:09 2023, max compression
```

## Comparing `finplot-1.9.1.tar` & `finplot-1.9.2.tar`

### file list

```diff
@@ -1,16 +1,17 @@
-drwxrwxrwx   0        0        0        0 2023-04-17 09:39:10.033070 finplot-1.9.1/
--rw-rw-rw-   0        0        0     1092 2018-08-22 23:30:28.000000 finplot-1.9.1/LICENSE.txt
--rw-rw-rw-   0        0        0     3195 2023-04-17 09:39:10.032101 finplot-1.9.1/PKG-INFO
--rw-rw-rw-   0        0        0     2783 2021-05-22 08:27:11.000000 finplot-1.9.1/README.md
-drwxrwxrwx   0        0        0        0 2023-04-17 09:39:10.028070 finplot-1.9.1/finplot/
--rw-rw-rw-   0        0        0   115518 2023-04-03 18:21:46.000000 finplot-1.9.1/finplot/__init__.py
--rw-rw-rw-   0        0        0     1992 2023-02-11 18:57:39.000000 finplot-1.9.1/finplot/live.py
--rw-rw-rw-   0        0        0     1929 2022-09-01 21:08:58.000000 finplot-1.9.1/finplot/pdplot.py
-drwxrwxrwx   0        0        0        0 2023-04-17 09:39:10.031083 finplot-1.9.1/finplot.egg-info/
--rw-rw-rw-   0        0        0     3195 2023-04-17 09:39:09.000000 finplot-1.9.1/finplot.egg-info/PKG-INFO
--rw-rw-rw-   0        0        0      238 2023-04-17 09:39:09.000000 finplot-1.9.1/finplot.egg-info/SOURCES.txt
--rw-rw-rw-   0        0        0        1 2023-04-17 09:39:09.000000 finplot-1.9.1/finplot.egg-info/dependency_links.txt
--rw-rw-rw-   0        0        0       75 2023-04-17 09:39:09.000000 finplot-1.9.1/finplot.egg-info/requires.txt
--rw-rw-rw-   0        0        0        8 2023-04-17 09:39:09.000000 finplot-1.9.1/finplot.egg-info/top_level.txt
--rw-rw-rw-   0        0        0       42 2023-04-17 09:39:10.033070 finplot-1.9.1/setup.cfg
--rw-rw-rw-   0        0        0      750 2023-04-17 09:37:32.000000 finplot-1.9.1/setup.py
+drwxrwxrwx   0        0        0        0 2023-07-03 22:40:09.261468 finplot-1.9.2/
+-rw-rw-rw-   0        0        0     1092 2018-08-22 23:30:28.000000 finplot-1.9.2/LICENSE.txt
+-rw-rw-rw-   0        0        0     3195 2023-07-03 22:40:09.261468 finplot-1.9.2/PKG-INFO
+-rw-rw-rw-   0        0        0     2783 2021-05-22 08:27:11.000000 finplot-1.9.2/README.md
+drwxrwxrwx   0        0        0        0 2023-07-03 22:40:09.261468 finplot-1.9.2/finplot/
+-rw-rw-rw-   0        0        0   115970 2023-06-14 22:40:13.000000 finplot-1.9.2/finplot/__init__.py
+-rw-rw-rw-   0        0        0       23 2023-07-03 22:38:45.000000 finplot-1.9.2/finplot/_version.py
+-rw-rw-rw-   0        0        0     1992 2023-02-11 18:57:39.000000 finplot-1.9.2/finplot/live.py
+-rw-rw-rw-   0        0        0     1929 2022-09-01 21:08:58.000000 finplot-1.9.2/finplot/pdplot.py
+drwxrwxrwx   0        0        0        0 2023-07-03 22:40:09.261468 finplot-1.9.2/finplot.egg-info/
+-rw-rw-rw-   0        0        0     3195 2023-07-03 22:40:08.000000 finplot-1.9.2/finplot.egg-info/PKG-INFO
+-rw-rw-rw-   0        0        0      258 2023-07-03 22:40:09.000000 finplot-1.9.2/finplot.egg-info/SOURCES.txt
+-rw-rw-rw-   0        0        0        1 2023-07-03 22:40:08.000000 finplot-1.9.2/finplot.egg-info/dependency_links.txt
+-rw-rw-rw-   0        0        0       75 2023-07-03 22:40:08.000000 finplot-1.9.2/finplot.egg-info/requires.txt
+-rw-rw-rw-   0        0        0        8 2023-07-03 22:40:08.000000 finplot-1.9.2/finplot.egg-info/top_level.txt
+-rw-rw-rw-   0        0        0       42 2023-07-03 22:40:09.261468 finplot-1.9.2/setup.cfg
+-rw-rw-rw-   0        0        0      796 2023-05-26 21:03:00.000000 finplot-1.9.2/setup.py
```

### Comparing `finplot-1.9.1/LICENSE.txt` & `finplot-1.9.2/LICENSE.txt`

 * *Files identical despite different names*

### Comparing `finplot-1.9.1/PKG-INFO` & `finplot-1.9.2/PKG-INFO`

 * *Files 0% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: finplot
-Version: 1.9.1
+Version: 1.9.2
 Summary: Finance plotting
 Home-page: https://github.com/highfestiva/finplot
 Author: Jonas BystrÃ¶m
 Author-email: highfestiva@gmail.com
 Classifier: Programming Language :: Python :: 3
 Classifier: License :: OSI Approved :: MIT License
 Classifier: Operating System :: OS Independent
```

### Comparing `finplot-1.9.1/README.md` & `finplot-1.9.2/README.md`

 * *Files identical despite different names*

### Comparing `finplot-1.9.1/finplot/__init__.py` & `finplot-1.9.2/finplot/__init__.py`

 * *Files 0% similar despite different names*

```diff
@@ -18,7203 +18,7232 @@
 00000110: 6374 2066 6f72 2066 696e 616e 6369 616c  ct for financial
 00000120: 2064 6174 612c 0d0a 7768 6572 6520 7468   data,..where th
 00000130: 6520 592d 6178 6973 2069 7320 6175 746f  e Y-axis is auto
 00000140: 2d73 6361 6c65 6420 746f 2068 6967 6865  -scaled to highe
 00000150: 7374 2068 6967 6820 616e 6420 6c6f 7765  st high and lowe
 00000160: 7374 206c 6f77 2069 6e20 7468 6520 6163  st low in the ac
 00000170: 7469 7665 0d0a 7265 6769 6f6e 2e0d 0a27  tive..region...'
-00000180: 2727 0d0a 0d0a 6672 6f6d 2061 7374 2069  ''....from ast i
-00000190: 6d70 6f72 7420 6c69 7465 7261 6c5f 6576  mport literal_ev
-000001a0: 616c 0d0a 6672 6f6d 2063 6f6c 6c65 6374  al..from collect
-000001b0: 696f 6e73 2069 6d70 6f72 7420 4f72 6465  ions import Orde
-000001c0: 7265 6444 6963 742c 2064 6566 6175 6c74  redDict, default
-000001d0: 6469 6374 0d0a 6672 6f6d 2064 6174 6574  dict..from datet
-000001e0: 696d 6520 696d 706f 7274 2064 6174 6574  ime import datet
-000001f0: 696d 652c 2074 696d 657a 6f6e 650d 0a66  ime, timezone..f
-00000200: 726f 6d20 6461 7465 7574 696c 2e74 7a20  rom dateutil.tz 
-00000210: 696d 706f 7274 2074 7a6c 6f63 616c 0d0a  import tzlocal..
-00000220: 6672 6f6d 2064 6563 696d 616c 2069 6d70  from decimal imp
-00000230: 6f72 7420 4465 6369 6d61 6c0d 0a66 726f  ort Decimal..fro
-00000240: 6d20 6675 6e63 746f 6f6c 7320 696d 706f  m functools impo
-00000250: 7274 2070 6172 7469 616c 2c20 7061 7274  rt partial, part
-00000260: 6961 6c6d 6574 686f 640d 0a66 726f 6d20  ialmethod..from 
-00000270: 6669 6e70 6c6f 742e 6c69 7665 2069 6d70  finplot.live imp
-00000280: 6f72 7420 4c69 7665 0d0a 6672 6f6d 206d  ort Live..from m
-00000290: 6174 6820 696d 706f 7274 2063 6569 6c2c  ath import ceil,
-000002a0: 2066 6c6f 6f72 2c20 666d 6f64 0d0a 696d   floor, fmod..im
-000002b0: 706f 7274 206e 756d 7079 2061 7320 6e70  port numpy as np
-000002c0: 0d0a 696d 706f 7274 206f 732e 7061 7468  ..import os.path
-000002d0: 0d0a 696d 706f 7274 2070 616e 6461 7320  ..import pandas 
-000002e0: 6173 2070 640d 0a69 6d70 6f72 7420 7079  as pd..import py
-000002f0: 7174 6772 6170 6820 6173 2070 670d 0a66  qtgraph as pg..f
-00000300: 726f 6d20 7079 7174 6772 6170 6820 696d  rom pyqtgraph im
-00000310: 706f 7274 2051 7443 6f72 652c 2051 7447  port QtCore, QtG
-00000320: 7569 0d0a 0d0a 0d0a 0d0a 2320 6170 7072  ui........# appr
-00000330: 6f70 7269 6174 6520 7479 7065 730d 0a43  opriate types..C
-00000340: 6f6c 6f72 4d61 7020 3d20 7067 2e43 6f6c  olorMap = pg.Col
-00000350: 6f72 4d61 700d 0a0d 0a23 206d 6f64 756c  orMap....# modul
-00000360: 6520 6465 6669 6e69 7469 6f6e 732c 206d  e definitions, m
-00000370: 6f73 746c 7920 636f 6c6f 7273 0d0a 6c65  ostly colors..le
-00000380: 6765 6e64 5f62 6f72 6465 725f 636f 6c6f  gend_border_colo
-00000390: 7220 3d20 2723 3737 3727 0d0a 6c65 6765  r = '#777'..lege
-000003a0: 6e64 5f66 696c 6c5f 636f 6c6f 7220 2020  nd_fill_color   
-000003b0: 3d20 2723 3636 3638 270d 0a6c 6567 656e  = '#6668'..legen
-000003c0: 645f 7465 7874 5f63 6f6c 6f72 2020 203d  d_text_color   =
-000003d0: 2027 2364 6464 3627 0d0a 736f 6674 5f63   '#ddd6'..soft_c
-000003e0: 6f6c 6f72 7320 3d20 5b27 2331 6637 3762  olors = ['#1f77b
-000003f0: 3427 2c20 2723 6666 3766 3065 272c 2027  4', '#ff7f0e', '
-00000400: 2332 6361 3032 6327 2c20 2723 6436 3237  #2ca02c', '#d627
-00000410: 3238 272c 2027 2339 3436 3762 6427 2c20  28', '#9467bd', 
-00000420: 2723 3863 3536 3462 272c 2027 2365 3337  '#8c564b', '#e37
-00000430: 3763 3227 2c20 2723 3766 3766 3766 272c  7c2', '#7f7f7f',
-00000440: 2027 2362 6362 6432 3227 2c20 2723 3137   '#bcbd22', '#17
-00000450: 6265 6366 275d 0d0a 6861 7264 5f63 6f6c  becf']..hard_col
-00000460: 6f72 7320 3d20 5b27 2330 3030 3030 3027  ors = ['#000000'
-00000470: 2c20 2723 3737 3232 3131 272c 2027 2330  , '#772211', '#0
-00000480: 3030 3036 3627 2c20 2723 3535 3535 3535  00066', '#555555
-00000490: 272c 2027 2330 3032 3263 6327 2c20 2723  ', '#0022cc', '#
-000004a0: 6666 6363 3030 275d 0d0a 636f 6c6d 6170  ffcc00']..colmap
-000004b0: 5f63 6c61 7368 203d 2043 6f6c 6f72 4d61  _clash = ColorMa
-000004c0: 7028 5b30 2e30 2c20 302e 322c 2030 2e36  p([0.0, 0.2, 0.6
-000004d0: 2c20 312e 305d 2c20 5b5b 3132 372c 2031  , 1.0], [[127, 1
-000004e0: 3237 2c20 3235 352c 2035 315d 2c20 5b30  27, 255, 51], [0
-000004f0: 2c20 302c 2031 3237 2c20 3531 5d2c 205b  , 0, 127, 51], [
-00000500: 3235 352c 2035 312c 2031 3032 2c20 3531  255, 51, 102, 51
-00000510: 5d2c 205b 3235 352c 2031 3738 2c20 3736  ], [255, 178, 76
-00000520: 2c20 3531 5d5d 290d 0a66 6f72 6567 726f  , 51]])..foregro
-00000530: 756e 6420 3d20 2723 3030 3027 0d0a 6261  und = '#000'..ba
-00000540: 636b 6772 6f75 6e64 203d 2027 2366 6666  ckground = '#fff
-00000550: 270d 0a6f 6464 5f70 6c6f 745f 6261 636b  '..odd_plot_back
-00000560: 6772 6f75 6e64 203d 2027 2365 6165 6165  ground = '#eaeae
-00000570: 6127 0d0a 6361 6e64 6c65 5f62 756c 6c5f  a'..candle_bull_
-00000580: 636f 6c6f 7220 3d20 2723 3236 6136 3961  color = '#26a69a
-00000590: 270d 0a63 616e 646c 655f 6265 6172 5f63  '..candle_bear_c
-000005a0: 6f6c 6f72 203d 2027 2365 6635 3335 3027  olor = '#ef5350'
-000005b0: 0d0a 6361 6e64 6c65 5f62 756c 6c5f 626f  ..candle_bull_bo
-000005c0: 6479 5f63 6f6c 6f72 203d 2062 6163 6b67  dy_color = backg
-000005d0: 726f 756e 640d 0a63 616e 646c 655f 6265  round..candle_be
-000005e0: 6172 5f62 6f64 795f 636f 6c6f 7220 3d20  ar_body_color = 
-000005f0: 6361 6e64 6c65 5f62 6561 725f 636f 6c6f  candle_bear_colo
-00000600: 720d 0a63 616e 646c 655f 7368 6164 6f77  r..candle_shadow
-00000610: 5f77 6964 7468 203d 2031 0d0a 766f 6c75  _width = 1..volu
-00000620: 6d65 5f62 756c 6c5f 636f 6c6f 7220 3d20  me_bull_color = 
-00000630: 2723 3932 6432 6363 270d 0a76 6f6c 756d  '#92d2cc'..volum
-00000640: 655f 6265 6172 5f63 6f6c 6f72 203d 2027  e_bear_color = '
-00000650: 2366 3761 3961 3727 0d0a 766f 6c75 6d65  #f7a9a7'..volume
-00000660: 5f62 756c 6c5f 626f 6479 5f63 6f6c 6f72  _bull_body_color
-00000670: 203d 2076 6f6c 756d 655f 6275 6c6c 5f63   = volume_bull_c
-00000680: 6f6c 6f72 0d0a 766f 6c75 6d65 5f6e 6575  olor..volume_neu
-00000690: 7472 616c 5f63 6f6c 6f72 203d 2027 2362  tral_color = '#b
-000006a0: 6262 270d 0a70 6f63 5f63 6f6c 6f72 203d  bb'..poc_color =
-000006b0: 2027 2330 3036 270d 0a62 616e 645f 636f   '#006'..band_co
-000006c0: 6c6f 7220 3d20 2723 6432 6466 6536 270d  lor = '#d2dfe6'.
-000006d0: 0a63 726f 7373 5f68 6169 725f 636f 6c6f  .cross_hair_colo
-000006e0: 7220 3d20 2723 3030 3037 270d 0a64 7261  r = '#0007'..dra
-000006f0: 775f 6c69 6e65 5f63 6f6c 6f72 203d 2027  w_line_color = '
-00000700: 2330 3030 270d 0a64 7261 775f 646f 6e65  #000'..draw_done
-00000710: 5f63 6f6c 6f72 203d 2027 2335 3535 270d  _color = '#555'.
-00000720: 0a73 6967 6e69 6669 6361 6e74 5f64 6563  .significant_dec
-00000730: 696d 616c 7320 3d20 380d 0a73 6967 6e69  imals = 8..signi
-00000740: 6669 6361 6e74 5f65 7073 203d 2031 652d  ficant_eps = 1e-
-00000750: 380d 0a6d 6178 5f64 6563 696d 616c 7320  8..max_decimals 
-00000760: 3d20 3130 0d0a 6d61 785f 7a6f 6f6d 5f70  = 10..max_zoom_p
-00000770: 6f69 6e74 7320 3d20 3230 2023 206e 756d  oints = 20 # num
-00000780: 6265 7220 6f66 2076 6973 6962 6c65 2063  ber of visible c
-00000790: 616e 646c 6573 2077 6865 6e20 6d61 7869  andles when maxi
-000007a0: 6d75 6d20 7a6f 6f6d 6564 2069 6e0d 0a74  mum zoomed in..t
-000007b0: 6f70 5f67 7261 7068 5f73 6361 6c65 203d  op_graph_scale =
-000007c0: 2032 0d0a 636c 616d 705f 6772 6964 203d   2..clamp_grid =
-000007d0: 2054 7275 650d 0a72 6967 6874 5f6d 6172   True..right_mar
-000007e0: 6769 6e5f 6361 6e64 6c65 7320 3d20 3520  gin_candles = 5 
-000007f0: 2320 7768 6974 6573 7061 6365 2061 7420  # whitespace at 
-00000800: 7468 6520 7269 6768 742d 6861 6e64 2073  the right-hand s
-00000810: 6964 650d 0a73 6964 655f 6d61 7267 696e  ide..side_margin
-00000820: 203d 2030 2e35 0d0a 6c6f 645f 6361 6e64   = 0.5..lod_cand
-00000830: 6c65 7320 3d20 3330 3030 0d0a 6c6f 645f  les = 3000..lod_
-00000840: 6c61 6265 6c73 203d 2037 3030 0d0a 6361  labels = 700..ca
-00000850: 6368 655f 6361 6e64 6c65 5f66 6163 746f  che_candle_facto
-00000860: 7220 3d20 3320 2320 6661 6374 6f72 2065  r = 3 # factor e
-00000870: 7874 7261 2063 616e 646c 6573 2072 656e  xtra candles ren
-00000880: 6465 7265 6420 746f 2062 7566 6665 720d  dered to buffer.
-00000890: 0a79 5f70 6164 203d 2030 2e30 3320 2320  .y_pad = 0.03 # 
-000008a0: 3325 2070 6164 6469 6e67 2061 7420 746f  3% padding at to
-000008b0: 7020 616e 6420 626f 7474 6f6d 206f 6620  p and bottom of 
-000008c0: 6175 746f 7a6f 6f6d 2070 6c6f 7473 0d0a  autozoom plots..
-000008d0: 795f 6c61 6265 6c5f 7769 6474 6820 3d20  y_label_width = 
-000008e0: 3635 0d0a 6469 7370 6c61 795f 7469 6d65  65..display_time
-000008f0: 7a6f 6e65 203d 2074 7a6c 6f63 616c 2829  zone = tzlocal()
-00000900: 2023 2064 6566 6175 6c74 2074 6f20 6c6f   # default to lo
-00000910: 6361 6c0d 0a77 696e 782c 7769 6e79 2c77  cal..winx,winy,w
-00000920: 696e 772c 7769 6e68 203d 2033 3030 2c31  inw,winh = 300,1
-00000930: 3530 2c38 3030 2c34 3030 0d0a 6c6f 675f  50,800,400..log_
-00000940: 706c 6f74 5f6f 6666 7365 7420 3d20 2d32  plot_offset = -2
-00000950: 2e32 3232 3232 3232 652d 3136 2023 2049  .2222222e-16 # I
-00000960: 2063 6f75 6c64 2066 696c 6520 6120 6275   could file a bu
-00000970: 6720 7265 706f 7274 2c20 7072 6f62 6162  g report, probab
-00000980: 6c79 2069 6e20 5079 5174 2c20 6275 7420  ly in PyQt, but 
-00000990: 7468 6973 2069 7320 6d6f 7265 2066 756e  this is more fun
-000009a0: 0d0a 2320 666f 726d 6174 3a20 6d6f 6465  ..# format: mode
-000009b0: 2c20 6d69 6e2d 6475 7261 7469 6f6e 2c20  , min-duration, 
-000009c0: 7064 2d66 7265 712d 666d 742c 2074 6963  pd-freq-fmt, tic
-000009d0: 6b2d 7374 722d 6c65 6e0d 0a74 696d 655f  k-str-len..time_
-000009e0: 7370 6c69 7473 203d 205b 2827 7965 6172  splits = [('year
-000009f0: 7327 2c20 322a 3336 352a 3234 2a36 302a  s', 2*365*24*60*
-00000a00: 3630 2c20 2027 5953 272c 2020 3429 2c20  60,  'YS',  4), 
-00000a10: 2827 6d6f 6e74 6873 272c 2033 2a33 302a  ('months', 3*30*
-00000a20: 3234 2a36 302a 3630 2c20 274d 5327 2c20  24*60*60, 'MS', 
-00000a30: 3130 292c 2028 2777 6565 6b73 272c 2020  10), ('weeks',  
-00000a40: 2033 2a37 2a32 342a 3630 2a36 302c 2027   3*7*24*60*60, '
-00000a50: 572d 4d4f 4e27 2c20 3130 292c 0d0a 2020  W-MON', 10),..  
-00000a60: 2020 2020 2020 2020 2020 2020 2028 2764               ('d
-00000a70: 6179 7327 2c20 2020 2020 2033 2a32 342a  ays',      3*24*
-00000a80: 3630 2a36 302c 2020 2027 4427 2c20 3130  60*60,   'D', 10
-00000a90: 292c 2028 2768 6f75 7273 272c 2020 2020  ), ('hours',    
-00000aa0: 2020 2020 392a 3630 2a36 302c 2027 3348      9*60*60, '3H
-00000ab0: 272c 2031 3629 2c20 2827 686f 7572 7327  ', 16), ('hours'
-00000ac0: 2c20 2020 2020 2020 2033 2a36 302a 3630  ,        3*60*60
-00000ad0: 2c20 2020 2020 2748 272c 2031 3629 2c0d  ,     'H', 16),.
-00000ae0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00000af0: 2827 6d69 6e75 7465 7327 2c20 2020 2020  ('minutes',     
-00000b00: 2020 2034 352a 3630 2c20 2731 3554 272c     45*60, '15T',
-00000b10: 2031 3629 2c20 2827 6d69 6e75 7465 7327   16), ('minutes'
-00000b20: 2c20 2020 2020 2020 2031 352a 3630 2c20  ,        15*60, 
-00000b30: 2735 5427 2c20 3136 292c 2028 276d 696e  '5T', 16), ('min
-00000b40: 7574 6573 272c 2020 2020 2020 2020 2033  utes',         3
-00000b50: 2a36 302c 2020 2020 2027 5427 2c20 3136  *60,     'T', 16
-00000b60: 292c 0d0a 2020 2020 2020 2020 2020 2020  ),..            
-00000b70: 2020 2028 2773 6563 6f6e 6473 272c 2020     ('seconds',  
-00000b80: 2020 2020 2020 2020 2034 352c 2027 3135           45, '15
-00000b90: 5327 2c20 3139 292c 2028 2773 6563 6f6e  S', 19), ('secon
-00000ba0: 6473 272c 2020 2020 2020 2020 2020 2031  ds',           1
-00000bb0: 352c 2027 3553 272c 2031 3929 2c20 2827  5, '5S', 19), ('
-00000bc0: 7365 636f 6e64 7327 2c20 2020 2020 2020  seconds',       
-00000bd0: 2020 2020 2033 2c20 2020 2020 2753 272c       3,     'S',
-00000be0: 2031 3929 2c0d 0a20 2020 2020 2020 2020   19),..         
-00000bf0: 2020 2020 2020 2827 6d69 6c6c 6973 6563        ('millisec
-00000c00: 6f6e 6473 272c 2020 2020 2020 2030 2c20  onds',       0, 
-00000c10: 2020 274c 272c 2032 3329 5d0d 0a0d 0a61    'L', 23)]....a
-00000c20: 7070 203d 204e 6f6e 650d 0a77 696e 646f  pp = None..windo
-00000c30: 7773 203d 205b 5d20 2320 6e6f 2067 630d  ws = [] # no gc.
-00000c40: 0a74 696d 6572 7320 3d20 5b5d 2023 206e  .timers = [] # n
-00000c50: 6f20 6763 0d0a 736f 756e 6473 203d 207b  o gc..sounds = {
-00000c60: 7d20 2320 6e6f 2067 630d 0a65 706f 6368  } # no gc..epoch
-00000c70: 5f70 6572 696f 6420 3d20 3165 3330 0d0a  _period = 1e30..
-00000c80: 6c61 7374 5f61 7820 3d20 4e6f 6e65 2023  last_ax = None #
-00000c90: 2061 6c77 6179 7320 6173 7375 6d65 2077   always assume w
-00000ca0: 6520 7761 6e74 2074 6f20 706c 6f74 2069  e want to plot i
-00000cb0: 6e20 7468 6520 6c61 7374 2061 7869 732c  n the last axis,
-00000cc0: 2075 6e6c 6573 7320 6578 706c 6963 6974   unless explicit
-00000cd0: 6c79 2073 7065 6369 6669 6564 0d0a 6f76  ly specified..ov
-00000ce0: 6572 6c61 795f 6178 7320 3d20 5b5d 2023  erlay_axs = [] #
-00000cf0: 2066 6f72 206b 6565 7069 6e67 2074 7261   for keeping tra
-00000d00: 636b 206f 6620 6361 6e64 6c65 7374 6963  ck of candlestic
-00000d10: 6b73 2069 6e20 6f76 6572 6c61 7973 0d0a  ks in overlays..
-00000d20: 7669 6577 7265 7374 6f72 6520 3d20 4661  viewrestore = Fa
-00000d30: 6c73 650d 0a6b 6579 5f65 7363 5f63 6c6f  lse..key_esc_clo
-00000d40: 7365 203d 2054 7275 6520 2320 4553 4320  se = True # ESC 
-00000d50: 6b65 7920 636c 6f73 6573 2077 696e 646f  key closes windo
-00000d60: 770d 0a6d 6173 7465 725f 6461 7461 203d  w..master_data =
-00000d70: 207b 7d0d 0a0d 0a0d 0a0d 0a6c 6572 7020   {}........lerp 
-00000d80: 3d20 6c61 6d62 6461 2074 2c61 2c62 3a20  = lambda t,a,b: 
-00000d90: 742a 622b 2831 2d74 292a 610d 0a0d 0a0d  t*b+(1-t)*a.....
-00000da0: 0a0d 0a63 6c61 7373 2045 706f 6368 4178  ...class EpochAx
-00000db0: 6973 4974 656d 2870 672e 4178 6973 4974  isItem(pg.AxisIt
-00000dc0: 656d 293a 0d0a 2020 2020 6465 6620 5f5f  em):..    def __
-00000dd0: 696e 6974 5f5f 2873 656c 662c 2076 622c  init__(self, vb,
-00000de0: 202a 6172 6773 2c20 2a2a 6b77 6172 6773   *args, **kwargs
-00000df0: 293a 0d0a 2020 2020 2020 2020 7375 7065  ):..        supe
-00000e00: 7228 292e 5f5f 696e 6974 5f5f 282a 6172  r().__init__(*ar
-00000e10: 6773 2c20 2a2a 6b77 6172 6773 290d 0a20  gs, **kwargs).. 
-00000e20: 2020 2020 2020 2073 656c 662e 7662 203d         self.vb =
-00000e30: 2076 620d 0a0d 0a20 2020 2064 6566 2074   vb....    def t
-00000e40: 6963 6b53 7472 696e 6773 2873 656c 662c  ickStrings(self,
-00000e50: 2076 616c 7565 732c 2073 6361 6c65 2c20   values, scale, 
-00000e60: 7370 6163 696e 6729 3a0d 0a20 2020 2020  spacing):..     
-00000e70: 2020 2069 6620 7365 6c66 2e6d 6f64 6520     if self.mode 
-00000e80: 3d3d 2027 6e75 6d27 3a0d 0a20 2020 2020  == 'num':..     
-00000e90: 2020 2020 2020 2072 6574 7572 6e20 5b27         return ['
-00000ea0: 2567 2725 7620 666f 7220 7620 696e 2076  %g'%v for v in v
-00000eb0: 616c 7565 735d 0d0a 2020 2020 2020 2020  alues]..        
-00000ec0: 636f 6e76 203d 205f 7832 7965 6172 2069  conv = _x2year i
-00000ed0: 6620 7365 6c66 2e6d 6f64 653d 3d27 7965  f self.mode=='ye
-00000ee0: 6172 7327 2065 6c73 6520 5f78 326c 6f63  ars' else _x2loc
-00000ef0: 616c 5f74 0d0a 2020 2020 2020 2020 7374  al_t..        st
-00000f00: 7273 203d 205b 636f 6e76 2873 656c 662e  rs = [conv(self.
-00000f10: 7662 2e64 6174 6173 7263 2c20 7661 6c75  vb.datasrc, valu
-00000f20: 6529 5b30 5d20 666f 7220 7661 6c75 6520  e)[0] for value 
-00000f30: 696e 2076 616c 7565 735d 0d0a 2020 2020  in values]..    
-00000f40: 2020 2020 6966 2061 6c6c 2873 2e65 6e64      if all(s.end
-00000f50: 7377 6974 6828 2720 3030 3a30 3027 2920  swith(' 00:00') 
-00000f60: 666f 7220 7320 696e 2073 7472 7320 6966  for s in strs if
-00000f70: 2073 293a 2023 2061 6c6c 2061 7420 6d69   s): # all at mi
-00000f80: 646e 6967 6874 202d 3e20 726f 756e 6420  dnight -> round 
-00000f90: 746f 2064 6179 730d 0a20 2020 2020 2020  to days..       
-00000fa0: 2020 2020 2073 7472 7320 3d20 5b73 2e70       strs = [s.p
-00000fb0: 6172 7469 7469 6f6e 2827 2027 295b 305d  artition(' ')[0]
-00000fc0: 2066 6f72 2073 2069 6e20 7374 7273 5d0d   for s in strs].
-00000fd0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00000fe0: 7374 7273 0d0a 0d0a 2020 2020 6465 6620  strs....    def 
-00000ff0: 7469 636b 5661 6c75 6573 2873 656c 662c  tickValues(self,
-00001000: 206d 696e 5661 6c2c 206d 6178 5661 6c2c   minVal, maxVal,
-00001010: 2073 697a 6529 3a0d 0a20 2020 2020 2020   size):..       
-00001020: 2073 656c 662e 6d6f 6465 203d 2027 6e75   self.mode = 'nu
-00001030: 6d27 0d0a 2020 2020 2020 2020 6178 203d  m'..        ax =
-00001040: 2073 656c 662e 7662 2e70 6172 656e 7428   self.vb.parent(
-00001050: 290d 0a20 2020 2020 2020 2064 6174 6173  )..        datas
-00001060: 7263 203d 205f 6765 745f 6461 7461 7372  rc = _get_datasr
-00001070: 6328 6178 2c20 7265 7175 6972 653d 4661  c(ax, require=Fa
-00001080: 6c73 6529 0d0a 2020 2020 2020 2020 6966  lse)..        if
-00001090: 2064 6174 6173 7263 2069 7320 4e6f 6e65   datasrc is None
-000010a0: 206f 7220 6e6f 7420 7365 6c66 2e76 622e   or not self.vb.
-000010b0: 785f 696e 6465 7865 643a 0d0a 2020 2020  x_indexed:..    
-000010c0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-000010d0: 7570 6572 2829 2e74 6963 6b56 616c 7565  uper().tickValue
-000010e0: 7328 6d69 6e56 616c 2c20 6d61 7856 616c  s(minVal, maxVal
-000010f0: 2c20 7369 7a65 290d 0a20 2020 2020 2020  , size)..       
-00001100: 2023 2063 616c 6375 6c61 7465 2069 6620   # calculate if 
-00001110: 7765 2075 7365 2079 6561 7273 2c20 6461  we use years, da
-00001120: 7973 2c20 6574 632e 0d0a 2020 2020 2020  ys, etc...      
-00001130: 2020 7430 2c74 312c 5f2c 5f2c 5f20 3d20    t0,t1,_,_,_ = 
-00001140: 6461 7461 7372 632e 6869 6c6f 286d 696e  datasrc.hilo(min
-00001150: 5661 6c2c 206d 6178 5661 6c29 0d0a 2020  Val, maxVal)..  
-00001160: 2020 2020 2020 7430 2c74 3120 3d20 7064        t0,t1 = pd
-00001170: 2e74 6f5f 6461 7465 7469 6d65 2874 3029  .to_datetime(t0)
-00001180: 2c20 7064 2e74 6f5f 6461 7465 7469 6d65  , pd.to_datetime
-00001190: 2874 3129 0d0a 2020 2020 2020 2020 6474  (t1)..        dt
-000011a0: 7320 3d20 2874 312d 7430 292e 746f 7461  s = (t1-t0).tota
-000011b0: 6c5f 7365 636f 6e64 7328 290d 0a20 2020  l_seconds()..   
-000011c0: 2020 2020 2067 6678 5f77 6964 7468 203d       gfx_width =
-000011d0: 2069 6e74 2873 697a 6529 0d0a 2020 2020   int(size)..    
-000011e0: 2020 2020 666f 7220 6d6f 6465 2c20 6474      for mode, dt
-000011f0: 742c 2066 7265 712c 2074 6963 6b6c 656e  t, freq, ticklen
-00001200: 2069 6e20 7469 6d65 5f73 706c 6974 733a   in time_splits:
-00001210: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-00001220: 2064 7473 203e 2064 7474 3a0d 0a20 2020   dts > dtt:..   
-00001230: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00001240: 662e 6d6f 6465 203d 206d 6f64 650d 0a20  f.mode = mode.. 
-00001250: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-00001260: 6573 6972 6564 5f74 6963 6b73 203d 2067  esired_ticks = g
-00001270: 6678 5f77 6964 7468 202f 2028 2874 6963  fx_width / ((tic
-00001280: 6b6c 656e 2b32 2920 2a20 3130 2920 2d20  klen+2) * 10) - 
-00001290: 3120 2320 616e 2061 7070 726f 7869 6d61  1 # an approxima
-000012a0: 7469 6f6e 2069 7320 6669 6e65 0d0a 2020  tion is fine..  
-000012b0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-000012c0: 2073 656c 662e 7662 2e64 6174 6173 7263   self.vb.datasrc
-000012d0: 2069 7320 6e6f 7420 4e6f 6e65 2061 6e64   is not None and
-000012e0: 206e 6f74 2073 656c 662e 7662 2e64 6174   not self.vb.dat
-000012f0: 6173 7263 2e69 735f 736d 6f6f 7468 5f74  asrc.is_smooth_t
-00001300: 696d 6528 293a 0d0a 2020 2020 2020 2020  ime():..        
-00001310: 2020 2020 2020 2020 2020 2020 6465 7369              desi
-00001320: 7265 645f 7469 636b 7320 2d3d 2031 2023  red_ticks -= 1 #
-00001330: 206c 6561 7665 206d 6f72 6520 7370 6163   leave more spac
-00001340: 6520 666f 7220 756e 6576 656e 6c79 2073  e for unevenly s
-00001350: 7061 6365 6420 7469 636b 730d 0a20 2020  paced ticks..   
-00001360: 2020 2020 2020 2020 2020 2020 2064 6573               des
-00001370: 6972 6564 5f74 6963 6b73 203d 206d 6178  ired_ticks = max
-00001380: 2864 6573 6972 6564 5f74 6963 6b73 2c20  (desired_ticks, 
-00001390: 3429 0d0a 2020 2020 2020 2020 2020 2020  4)..            
-000013a0: 2020 2020 746f 5f6d 6964 6e69 6768 7420      to_midnight 
-000013b0: 3d20 6672 6571 2069 6e20 2827 5953 272c  = freq in ('YS',
-000013c0: 274d 5327 2c20 2757 2d4d 4f4e 272c 2027  'MS', 'W-MON', '
-000013d0: 4427 290d 0a20 2020 2020 2020 2020 2020  D')..           
-000013e0: 2020 2020 2074 7a20 3d20 6469 7370 6c61       tz = displa
-000013f0: 795f 7469 6d65 7a6f 6e65 2069 6620 746f  y_timezone if to
-00001400: 5f6d 6964 6e69 6768 7420 656c 7365 204e  _midnight else N
-00001410: 6f6e 6520 2320 666f 7220 7368 6f72 7465  one # for shorte
-00001420: 7220 7469 6d65 6672 616d 6573 2c20 7469  r timeframes, ti
-00001430: 6d65 7a6f 6e65 2073 6565 6d73 2062 7567  mezone seems bug
-00001440: 6779 0d0a 2020 2020 2020 2020 2020 2020  gy..            
-00001450: 2020 2020 726e 6720 3d20 7064 2e64 6174      rng = pd.dat
-00001460: 655f 7261 6e67 6528 7430 2c20 7431 2c20  e_range(t0, t1, 
-00001470: 747a 3d74 7a2c 206e 6f72 6d61 6c69 7a65  tz=tz, normalize
-00001480: 3d74 6f5f 6d69 646e 6967 6874 2c20 6672  =to_midnight, fr
-00001490: 6571 3d66 7265 7129 0d0a 2020 2020 2020  eq=freq)..      
-000014a0: 2020 2020 2020 2020 2020 7374 6570 7320            steps 
-000014b0: 3d20 6c65 6e28 726e 6729 2069 6620 6c65  = len(rng) if le
-000014c0: 6e28 726e 6729 2631 3d3d 3020 656c 7365  n(rng)&1==0 else
-000014d0: 206c 656e 2872 6e67 292b 3120 2320 7265   len(rng)+1 # re
-000014e0: 6475 6365 206a 6974 7465 7220 6265 7477  duce jitter betw
-000014f0: 6565 6e20 652e 672e 2035 3c2d 2d3e 3130  een e.g. 5<-->10
-00001500: 2074 6963 6b73 2066 6f72 2072 6573 6f6c   ticks for resol
-00001510: 7574 696f 6e20 636c 6f73 6520 746f 206c  ution close to l
-00001520: 696d 6974 0d0a 2020 2020 2020 2020 2020  imit..          
-00001530: 2020 2020 2020 7374 6570 203d 2069 6e74        step = int
-00001540: 2873 7465 7073 2f64 6573 6972 6564 5f74  (steps/desired_t
-00001550: 6963 6b73 2920 6f72 2031 0d0a 2020 2020  icks) or 1..    
-00001560: 2020 2020 2020 2020 2020 2020 726e 6720              rng 
-00001570: 3d20 726e 675b 3a3a 7374 6570 5d0d 0a20  = rng[::step].. 
-00001580: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00001590: 6620 6e6f 7420 746f 5f6d 6964 6e69 6768  f not to_midnigh
-000015a0: 743a 0d0a 2020 2020 2020 2020 2020 2020  t:..            
-000015b0: 2020 2020 2020 2020 7472 793a 2020 2020          try:    
-000015c0: 726e 6720 3d20 726e 672e 726f 756e 6428  rng = rng.round(
-000015d0: 6672 6571 3d66 7265 7129 0d0a 2020 2020  freq=freq)..    
-000015e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000015f0: 6578 6365 7074 3a20 7061 7373 0d0a 2020  except: pass..  
-00001600: 2020 2020 2020 2020 2020 2020 2020 6178                ax
-00001610: 203d 2073 656c 662e 7662 2e70 6172 656e   = self.vb.paren
-00001620: 7428 290d 0a20 2020 2020 2020 2020 2020  t()..           
-00001630: 2020 2020 2072 6e67 203d 205f 7064 7469       rng = _pdti
-00001640: 6d65 3269 6e64 6578 2861 783d 6178 2c20  me2index(ax=ax, 
-00001650: 7473 3d70 642e 5365 7269 6573 2872 6e67  ts=pd.Series(rng
-00001660: 292c 2072 6571 7569 7265 5f74 696d 653d  ), require_time=
-00001670: 5472 7565 290d 0a20 2020 2020 2020 2020  True)..         
-00001680: 2020 2020 2020 2069 6e64 6963 6573 203d         indices =
-00001690: 205b 6365 696c 2869 2920 666f 7220 6920   [ceil(i) for i 
-000016a0: 696e 2072 6e67 5d0d 0a20 2020 2020 2020  in rng]..       
-000016b0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-000016c0: 5b28 302c 2069 6e64 6963 6573 295d 0d0a  [(0, indices)]..
-000016d0: 2020 2020 2020 2020 7265 7475 726e 205b          return [
-000016e0: 2830 2c5b 5d29 5d0d 0a0d 0a20 2020 2064  (0,[])]....    d
-000016f0: 6566 2067 656e 6572 6174 6544 7261 7753  ef generateDrawS
-00001700: 7065 6373 2873 656c 662c 2070 293a 0d0a  pecs(self, p):..
-00001710: 2020 2020 2020 2020 7370 6563 7320 3d20          specs = 
-00001720: 7375 7065 7228 292e 6765 6e65 7261 7465  super().generate
-00001730: 4472 6177 5370 6563 7328 7029 0d0a 2020  DrawSpecs(p)..  
-00001740: 2020 2020 2020 6966 2073 7065 6373 3a0d        if specs:.
-00001750: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00001760: 6e6f 7420 7365 6c66 2e73 7479 6c65 5b27  not self.style['
-00001770: 7368 6f77 5661 6c75 6573 275d 3a0d 0a20  showValues']:.. 
-00001780: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00001790: 656e 2c70 302c 7031 203d 2073 7065 6373  en,p0,p1 = specs
-000017a0: 5b30 5d20 2320 6178 6973 2073 7065 6373  [0] # axis specs
-000017b0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000017c0: 2020 7370 6563 7320 3d20 5b28 5f6d 616b    specs = [(_mak
-000017d0: 6570 656e 2827 2366 6666 3027 292c 7030  epen('#fff0'),p0
-000017e0: 2c70 3129 5d20 2b20 6c69 7374 2873 7065  ,p1)] + list(spe
-000017f0: 6373 5b31 3a5d 2920 2320 646f 6e27 7420  cs[1:]) # don't 
-00001800: 6472 6177 2061 7869 7320 6966 2068 6964  draw axis if hid
-00001810: 696e 6720 7661 6c75 6573 0d0a 2020 2020  ing values..    
-00001820: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
-00001830: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00001840: 2074 6872 6f77 206f 7574 2074 6963 6b73   throw out ticks
-00001850: 2074 6861 7420 6172 6520 6f75 7420 6f66   that are out of
-00001860: 2062 6f75 6e64 730d 0a20 2020 2020 2020   bounds..       
-00001870: 2020 2020 2020 2020 2074 6578 745f 7370           text_sp
-00001880: 6563 7320 3d20 7370 6563 735b 325d 0d0a  ecs = specs[2]..
-00001890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000018a0: 6966 206c 656e 2874 6578 745f 7370 6563  if len(text_spec
-000018b0: 7329 203e 3d20 343a 0d0a 2020 2020 2020  s) >= 4:..      
-000018c0: 2020 2020 2020 2020 2020 2020 2020 7265                re
-000018d0: 6374 2c66 6c61 6773 2c74 6578 7420 3d20  ct,flags,text = 
-000018e0: 7465 7874 5f73 7065 6373 5b30 5d0d 0a20  text_specs[0].. 
-000018f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001900: 2020 2069 6620 7265 6374 2e6c 6566 7428     if rect.left(
-00001910: 2920 3c20 303a 0d0a 2020 2020 2020 2020  ) < 0:..        
-00001920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001930: 6465 6c20 7465 7874 5f73 7065 6373 5b30  del text_specs[0
-00001940: 5d0d 0a20 2020 2020 2020 2020 2020 2020  ]..             
-00001950: 2020 2020 2020 2072 6563 742c 666c 6167         rect,flag
-00001960: 732c 7465 7874 203d 2074 6578 745f 7370  s,text = text_sp
-00001970: 6563 735b 2d31 5d0d 0a20 2020 2020 2020  ecs[-1]..       
-00001980: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00001990: 7265 6374 2e72 6967 6874 2829 203e 2073  rect.right() > s
-000019a0: 656c 662e 6765 6f6d 6574 7279 2829 2e77  elf.geometry().w
-000019b0: 6964 7468 2829 3a0d 0a20 2020 2020 2020  idth():..       
-000019c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000019d0: 2064 656c 2074 6578 745f 7370 6563 735b   del text_specs[
-000019e0: 2d31 5d0d 0a20 2020 2020 2020 2020 2020  -1]..           
-000019f0: 2020 2020 2023 202e 2e2e 2061 6e64 2074       # ... and t
-00001a00: 686f 7365 2074 6861 7420 6f76 6572 6c61  hose that overla
-00001a10: 700d 0a20 2020 2020 2020 2020 2020 2020  p..             
-00001a20: 2020 2078 203d 2031 6536 0d0a 2020 2020     x = 1e6..    
-00001a30: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00001a40: 692c 2872 6563 742c 666c 6167 732c 7465  i,(rect,flags,te
-00001a50: 7874 2920 696e 2072 6576 6572 7365 6428  xt) in reversed(
-00001a60: 6c69 7374 2865 6e75 6d65 7261 7465 2874  list(enumerate(t
-00001a70: 6578 745f 7370 6563 7329 2929 3a0d 0a20  ext_specs))):.. 
-00001a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001a90: 2020 2069 6620 7265 6374 2e72 6967 6874     if rect.right
-00001aa0: 2829 203e 3d20 783a 0d0a 2020 2020 2020  () >= x:..      
-00001ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001ac0: 2020 6465 6c20 7465 7874 5f73 7065 6373    del text_specs
-00001ad0: 5b69 5d0d 0a20 2020 2020 2020 2020 2020  [i]..           
-00001ae0: 2020 2020 2020 2020 2065 6c73 653a 0d0a           else:..
+00000180: 2727 0d0a 0d0a 6672 6f6d 202e 5f76 6572  ''....from ._ver
+00000190: 7369 6f6e 2069 6d70 6f72 7420 5f5f 7665  sion import __ve
+000001a0: 7273 696f 6e5f 5f0d 0a0d 0a66 726f 6d20  rsion__....from 
+000001b0: 6173 7420 696d 706f 7274 206c 6974 6572  ast import liter
+000001c0: 616c 5f65 7661 6c0d 0a66 726f 6d20 636f  al_eval..from co
+000001d0: 6c6c 6563 7469 6f6e 7320 696d 706f 7274  llections import
+000001e0: 204f 7264 6572 6564 4469 6374 2c20 6465   OrderedDict, de
+000001f0: 6661 756c 7464 6963 740d 0a66 726f 6d20  faultdict..from 
+00000200: 6461 7465 7469 6d65 2069 6d70 6f72 7420  datetime import 
+00000210: 6461 7465 7469 6d65 2c20 7469 6d65 7a6f  datetime, timezo
+00000220: 6e65 0d0a 6672 6f6d 2064 6174 6575 7469  ne..from dateuti
+00000230: 6c2e 747a 2069 6d70 6f72 7420 747a 6c6f  l.tz import tzlo
+00000240: 6361 6c0d 0a66 726f 6d20 6465 6369 6d61  cal..from decima
+00000250: 6c20 696d 706f 7274 2044 6563 696d 616c  l import Decimal
+00000260: 0d0a 6672 6f6d 2066 756e 6374 6f6f 6c73  ..from functools
+00000270: 2069 6d70 6f72 7420 7061 7274 6961 6c2c   import partial,
+00000280: 2070 6172 7469 616c 6d65 7468 6f64 0d0a   partialmethod..
+00000290: 6672 6f6d 2066 696e 706c 6f74 2e6c 6976  from finplot.liv
+000002a0: 6520 696d 706f 7274 204c 6976 650d 0a66  e import Live..f
+000002b0: 726f 6d20 6d61 7468 2069 6d70 6f72 7420  rom math import 
+000002c0: 6365 696c 2c20 666c 6f6f 722c 2066 6d6f  ceil, floor, fmo
+000002d0: 640d 0a69 6d70 6f72 7420 6e75 6d70 7920  d..import numpy 
+000002e0: 6173 206e 700d 0a69 6d70 6f72 7420 6f73  as np..import os
+000002f0: 2e70 6174 680d 0a69 6d70 6f72 7420 7061  .path..import pa
+00000300: 6e64 6173 2061 7320 7064 0d0a 696d 706f  ndas as pd..impo
+00000310: 7274 2070 7971 7467 7261 7068 2061 7320  rt pyqtgraph as 
+00000320: 7067 0d0a 6672 6f6d 2070 7971 7467 7261  pg..from pyqtgra
+00000330: 7068 2069 6d70 6f72 7420 5174 436f 7265  ph import QtCore
+00000340: 2c20 5174 4775 690d 0a0d 0a0d 0a0d 0a23  , QtGui........#
+00000350: 2061 7070 726f 7072 6961 7465 2074 7970   appropriate typ
+00000360: 6573 0d0a 436f 6c6f 724d 6170 203d 2070  es..ColorMap = p
+00000370: 672e 436f 6c6f 724d 6170 0d0a 0d0a 2320  g.ColorMap....# 
+00000380: 6d6f 6475 6c65 2064 6566 696e 6974 696f  module definitio
+00000390: 6e73 2c20 6d6f 7374 6c79 2063 6f6c 6f72  ns, mostly color
+000003a0: 730d 0a6c 6567 656e 645f 626f 7264 6572  s..legend_border
+000003b0: 5f63 6f6c 6f72 203d 2027 2337 3737 270d  _color = '#777'.
+000003c0: 0a6c 6567 656e 645f 6669 6c6c 5f63 6f6c  .legend_fill_col
+000003d0: 6f72 2020 203d 2027 2336 3636 3827 0d0a  or   = '#6668'..
+000003e0: 6c65 6765 6e64 5f74 6578 745f 636f 6c6f  legend_text_colo
+000003f0: 7220 2020 3d20 2723 6464 6436 270d 0a73  r   = '#ddd6'..s
+00000400: 6f66 745f 636f 6c6f 7273 203d 205b 2723  oft_colors = ['#
+00000410: 3166 3737 6234 272c 2027 2366 6637 6630  1f77b4', '#ff7f0
+00000420: 6527 2c20 2723 3263 6130 3263 272c 2027  e', '#2ca02c', '
+00000430: 2364 3632 3732 3827 2c20 2723 3934 3637  #d62728', '#9467
+00000440: 6264 272c 2027 2338 6335 3634 6227 2c20  bd', '#8c564b', 
+00000450: 2723 6533 3737 6332 272c 2027 2337 6637  '#e377c2', '#7f7
+00000460: 6637 6627 2c20 2723 6263 6264 3232 272c  f7f', '#bcbd22',
+00000470: 2027 2331 3762 6563 6627 5d0d 0a68 6172   '#17becf']..har
+00000480: 645f 636f 6c6f 7273 203d 205b 2723 3030  d_colors = ['#00
+00000490: 3030 3030 272c 2027 2337 3732 3231 3127  0000', '#772211'
+000004a0: 2c20 2723 3030 3030 3636 272c 2027 2335  , '#000066', '#5
+000004b0: 3535 3535 3527 2c20 2723 3030 3232 6363  55555', '#0022cc
+000004c0: 272c 2027 2366 6663 6330 3027 5d0d 0a63  ', '#ffcc00']..c
+000004d0: 6f6c 6d61 705f 636c 6173 6820 3d20 436f  olmap_clash = Co
+000004e0: 6c6f 724d 6170 285b 302e 302c 2030 2e32  lorMap([0.0, 0.2
+000004f0: 2c20 302e 362c 2031 2e30 5d2c 205b 5b31  , 0.6, 1.0], [[1
+00000500: 3237 2c20 3132 372c 2032 3535 2c20 3531  27, 127, 255, 51
+00000510: 5d2c 205b 302c 2030 2c20 3132 372c 2035  ], [0, 0, 127, 5
+00000520: 315d 2c20 5b32 3535 2c20 3531 2c20 3130  1], [255, 51, 10
+00000530: 322c 2035 315d 2c20 5b32 3535 2c20 3137  2, 51], [255, 17
+00000540: 382c 2037 362c 2035 315d 5d29 0d0a 666f  8, 76, 51]])..fo
+00000550: 7265 6772 6f75 6e64 203d 2027 2330 3030  reground = '#000
+00000560: 270d 0a62 6163 6b67 726f 756e 6420 3d20  '..background = 
+00000570: 2723 6666 6627 0d0a 6f64 645f 706c 6f74  '#fff'..odd_plot
+00000580: 5f62 6163 6b67 726f 756e 6420 3d20 2723  _background = '#
+00000590: 6561 6561 6561 270d 0a63 616e 646c 655f  eaeaea'..candle_
+000005a0: 6275 6c6c 5f63 6f6c 6f72 203d 2027 2332  bull_color = '#2
+000005b0: 3661 3639 6127 0d0a 6361 6e64 6c65 5f62  6a69a'..candle_b
+000005c0: 6561 725f 636f 6c6f 7220 3d20 2723 6566  ear_color = '#ef
+000005d0: 3533 3530 270d 0a63 616e 646c 655f 6275  5350'..candle_bu
+000005e0: 6c6c 5f62 6f64 795f 636f 6c6f 7220 3d20  ll_body_color = 
+000005f0: 6261 636b 6772 6f75 6e64 0d0a 6361 6e64  background..cand
+00000600: 6c65 5f62 6561 725f 626f 6479 5f63 6f6c  le_bear_body_col
+00000610: 6f72 203d 2063 616e 646c 655f 6265 6172  or = candle_bear
+00000620: 5f63 6f6c 6f72 0d0a 6361 6e64 6c65 5f73  _color..candle_s
+00000630: 6861 646f 775f 7769 6474 6820 3d20 310d  hadow_width = 1.
+00000640: 0a76 6f6c 756d 655f 6275 6c6c 5f63 6f6c  .volume_bull_col
+00000650: 6f72 203d 2027 2339 3264 3263 6327 0d0a  or = '#92d2cc'..
+00000660: 766f 6c75 6d65 5f62 6561 725f 636f 6c6f  volume_bear_colo
+00000670: 7220 3d20 2723 6637 6139 6137 270d 0a76  r = '#f7a9a7'..v
+00000680: 6f6c 756d 655f 6275 6c6c 5f62 6f64 795f  olume_bull_body_
+00000690: 636f 6c6f 7220 3d20 766f 6c75 6d65 5f62  color = volume_b
+000006a0: 756c 6c5f 636f 6c6f 720d 0a76 6f6c 756d  ull_color..volum
+000006b0: 655f 6e65 7574 7261 6c5f 636f 6c6f 7220  e_neutral_color 
+000006c0: 3d20 2723 6262 6227 0d0a 706f 635f 636f  = '#bbb'..poc_co
+000006d0: 6c6f 7220 3d20 2723 3030 3627 0d0a 6261  lor = '#006'..ba
+000006e0: 6e64 5f63 6f6c 6f72 203d 2027 2364 3264  nd_color = '#d2d
+000006f0: 6665 3627 0d0a 6372 6f73 735f 6861 6972  fe6'..cross_hair
+00000700: 5f63 6f6c 6f72 203d 2027 2330 3030 3727  _color = '#0007'
+00000710: 0d0a 6472 6177 5f6c 696e 655f 636f 6c6f  ..draw_line_colo
+00000720: 7220 3d20 2723 3030 3027 0d0a 6472 6177  r = '#000'..draw
+00000730: 5f64 6f6e 655f 636f 6c6f 7220 3d20 2723  _done_color = '#
+00000740: 3535 3527 0d0a 7369 676e 6966 6963 616e  555'..significan
+00000750: 745f 6465 6369 6d61 6c73 203d 2038 0d0a  t_decimals = 8..
+00000760: 7369 676e 6966 6963 616e 745f 6570 7320  significant_eps 
+00000770: 3d20 3165 2d38 0d0a 6d61 785f 6465 6369  = 1e-8..max_deci
+00000780: 6d61 6c73 203d 2031 300d 0a6d 6178 5f7a  mals = 10..max_z
+00000790: 6f6f 6d5f 706f 696e 7473 203d 2032 3020  oom_points = 20 
+000007a0: 2320 6e75 6d62 6572 206f 6620 7669 7369  # number of visi
+000007b0: 626c 6520 6361 6e64 6c65 7320 7768 656e  ble candles when
+000007c0: 206d 6178 696d 756d 207a 6f6f 6d65 6420   maximum zoomed 
+000007d0: 696e 0d0a 746f 705f 6772 6170 685f 7363  in..top_graph_sc
+000007e0: 616c 6520 3d20 320d 0a63 6c61 6d70 5f67  ale = 2..clamp_g
+000007f0: 7269 6420 3d20 5472 7565 0d0a 7269 6768  rid = True..righ
+00000800: 745f 6d61 7267 696e 5f63 616e 646c 6573  t_margin_candles
+00000810: 203d 2035 2023 2077 6869 7465 7370 6163   = 5 # whitespac
+00000820: 6520 6174 2074 6865 2072 6967 6874 2d68  e at the right-h
+00000830: 616e 6420 7369 6465 0d0a 7369 6465 5f6d  and side..side_m
+00000840: 6172 6769 6e20 3d20 302e 350d 0a6c 6f64  argin = 0.5..lod
+00000850: 5f63 616e 646c 6573 203d 2033 3030 300d  _candles = 3000.
+00000860: 0a6c 6f64 5f6c 6162 656c 7320 3d20 3730  .lod_labels = 70
+00000870: 300d 0a63 6163 6865 5f63 616e 646c 655f  0..cache_candle_
+00000880: 6661 6374 6f72 203d 2033 2023 2066 6163  factor = 3 # fac
+00000890: 746f 7220 6578 7472 6120 6361 6e64 6c65  tor extra candle
+000008a0: 7320 7265 6e64 6572 6564 2074 6f20 6275  s rendered to bu
+000008b0: 6666 6572 0d0a 795f 7061 6420 3d20 302e  ffer..y_pad = 0.
+000008c0: 3033 2023 2033 2520 7061 6464 696e 6720  03 # 3% padding 
+000008d0: 6174 2074 6f70 2061 6e64 2062 6f74 746f  at top and botto
+000008e0: 6d20 6f66 2061 7574 6f7a 6f6f 6d20 706c  m of autozoom pl
+000008f0: 6f74 730d 0a79 5f6c 6162 656c 5f77 6964  ots..y_label_wid
+00000900: 7468 203d 2036 350d 0a64 6973 706c 6179  th = 65..display
+00000910: 5f74 696d 657a 6f6e 6520 3d20 747a 6c6f  _timezone = tzlo
+00000920: 6361 6c28 2920 2320 6465 6661 756c 7420  cal() # default 
+00000930: 746f 206c 6f63 616c 0d0a 7769 6e78 2c77  to local..winx,w
+00000940: 696e 792c 7769 6e77 2c77 696e 6820 3d20  iny,winw,winh = 
+00000950: 3330 302c 3135 302c 3830 302c 3430 300d  300,150,800,400.
+00000960: 0a77 696e 5f72 6563 7265 6174 655f 6465  .win_recreate_de
+00000970: 6c74 6120 3d20 3330 0d0a 6c6f 675f 706c  lta = 30..log_pl
+00000980: 6f74 5f6f 6666 7365 7420 3d20 2d32 2e32  ot_offset = -2.2
+00000990: 3232 3232 3232 652d 3136 2023 2049 2063  222222e-16 # I c
+000009a0: 6f75 6c64 2066 696c 6520 6120 6275 6720  ould file a bug 
+000009b0: 7265 706f 7274 2c20 7072 6f62 6162 6c79  report, probably
+000009c0: 2069 6e20 5079 5174 2c20 6275 7420 7468   in PyQt, but th
+000009d0: 6973 2069 7320 6d6f 7265 2066 756e 0d0a  is is more fun..
+000009e0: 2320 666f 726d 6174 3a20 6d6f 6465 2c20  # format: mode, 
+000009f0: 6d69 6e2d 6475 7261 7469 6f6e 2c20 7064  min-duration, pd
+00000a00: 2d66 7265 712d 666d 742c 2074 6963 6b2d  -freq-fmt, tick-
+00000a10: 7374 722d 6c65 6e0d 0a74 696d 655f 7370  str-len..time_sp
+00000a20: 6c69 7473 203d 205b 2827 7965 6172 7327  lits = [('years'
+00000a30: 2c20 322a 3336 352a 3234 2a36 302a 3630  , 2*365*24*60*60
+00000a40: 2c20 2027 5953 272c 2020 3429 2c20 2827  ,  'YS',  4), ('
+00000a50: 6d6f 6e74 6873 272c 2033 2a33 302a 3234  months', 3*30*24
+00000a60: 2a36 302a 3630 2c20 274d 5327 2c20 3130  *60*60, 'MS', 10
+00000a70: 292c 2028 2777 6565 6b73 272c 2020 2033  ), ('weeks',   3
+00000a80: 2a37 2a32 342a 3630 2a36 302c 2027 572d  *7*24*60*60, 'W-
+00000a90: 4d4f 4e27 2c20 3130 292c 0d0a 2020 2020  MON', 10),..    
+00000aa0: 2020 2020 2020 2020 2020 2028 2764 6179             ('day
+00000ab0: 7327 2c20 2020 2020 2033 2a32 342a 3630  s',      3*24*60
+00000ac0: 2a36 302c 2020 2027 4427 2c20 3130 292c  *60,   'D', 10),
+00000ad0: 2028 2768 6f75 7273 272c 2020 2020 2020   ('hours',      
+00000ae0: 2020 392a 3630 2a36 302c 2027 3348 272c    9*60*60, '3H',
+00000af0: 2031 3629 2c20 2827 686f 7572 7327 2c20   16), ('hours', 
+00000b00: 2020 2020 2020 2033 2a36 302a 3630 2c20         3*60*60, 
+00000b10: 2020 2020 2748 272c 2031 3629 2c0d 0a20      'H', 16),.. 
+00000b20: 2020 2020 2020 2020 2020 2020 2020 2827                ('
+00000b30: 6d69 6e75 7465 7327 2c20 2020 2020 2020  minutes',       
+00000b40: 2034 352a 3630 2c20 2731 3554 272c 2031   45*60, '15T', 1
+00000b50: 3629 2c20 2827 6d69 6e75 7465 7327 2c20  6), ('minutes', 
+00000b60: 2020 2020 2020 2031 352a 3630 2c20 2735         15*60, '5
+00000b70: 5427 2c20 3136 292c 2028 276d 696e 7574  T', 16), ('minut
+00000b80: 6573 272c 2020 2020 2020 2020 2033 2a36  es',         3*6
+00000b90: 302c 2020 2020 2027 5427 2c20 3136 292c  0,     'T', 16),
+00000ba0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00000bb0: 2028 2773 6563 6f6e 6473 272c 2020 2020   ('seconds',    
+00000bc0: 2020 2020 2020 2034 352c 2027 3135 5327         45, '15S'
+00000bd0: 2c20 3139 292c 2028 2773 6563 6f6e 6473  , 19), ('seconds
+00000be0: 272c 2020 2020 2020 2020 2020 2031 352c  ',           15,
+00000bf0: 2027 3553 272c 2031 3929 2c20 2827 7365   '5S', 19), ('se
+00000c00: 636f 6e64 7327 2c20 2020 2020 2020 2020  conds',         
+00000c10: 2020 2033 2c20 2020 2020 2753 272c 2031     3,     'S', 1
+00000c20: 3929 2c0d 0a20 2020 2020 2020 2020 2020  9),..           
+00000c30: 2020 2020 2827 6d69 6c6c 6973 6563 6f6e      ('millisecon
+00000c40: 6473 272c 2020 2020 2020 2030 2c20 2020  ds',       0,   
+00000c50: 274c 272c 2032 3329 5d0d 0a0d 0a61 7070  'L', 23)]....app
+00000c60: 203d 204e 6f6e 650d 0a77 696e 646f 7773   = None..windows
+00000c70: 203d 205b 5d20 2320 6e6f 2067 630d 0a74   = [] # no gc..t
+00000c80: 696d 6572 7320 3d20 5b5d 2023 206e 6f20  imers = [] # no 
+00000c90: 6763 0d0a 736f 756e 6473 203d 207b 7d20  gc..sounds = {} 
+00000ca0: 2320 6e6f 2067 630d 0a65 706f 6368 5f70  # no gc..epoch_p
+00000cb0: 6572 696f 6420 3d20 3165 3330 0d0a 6c61  eriod = 1e30..la
+00000cc0: 7374 5f61 7820 3d20 4e6f 6e65 2023 2061  st_ax = None # a
+00000cd0: 6c77 6179 7320 6173 7375 6d65 2077 6520  lways assume we 
+00000ce0: 7761 6e74 2074 6f20 706c 6f74 2069 6e20  want to plot in 
+00000cf0: 7468 6520 6c61 7374 2061 7869 732c 2075  the last axis, u
+00000d00: 6e6c 6573 7320 6578 706c 6963 6974 6c79  nless explicitly
+00000d10: 2073 7065 6369 6669 6564 0d0a 6f76 6572   specified..over
+00000d20: 6c61 795f 6178 7320 3d20 5b5d 2023 2066  lay_axs = [] # f
+00000d30: 6f72 206b 6565 7069 6e67 2074 7261 636b  or keeping track
+00000d40: 206f 6620 6361 6e64 6c65 7374 6963 6b73   of candlesticks
+00000d50: 2069 6e20 6f76 6572 6c61 7973 0d0a 7669   in overlays..vi
+00000d60: 6577 7265 7374 6f72 6520 3d20 4661 6c73  ewrestore = Fals
+00000d70: 650d 0a6b 6579 5f65 7363 5f63 6c6f 7365  e..key_esc_close
+00000d80: 203d 2054 7275 6520 2320 4553 4320 6b65   = True # ESC ke
+00000d90: 7920 636c 6f73 6573 2077 696e 646f 770d  y closes window.
+00000da0: 0a6d 6173 7465 725f 6461 7461 203d 207b  .master_data = {
+00000db0: 7d0d 0a0d 0a0d 0a0d 0a6c 6572 7020 3d20  }........lerp = 
+00000dc0: 6c61 6d62 6461 2074 2c61 2c62 3a20 742a  lambda t,a,b: t*
+00000dd0: 622b 2831 2d74 292a 610d 0a0d 0a0d 0a0d  b+(1-t)*a.......
+00000de0: 0a63 6c61 7373 2045 706f 6368 4178 6973  .class EpochAxis
+00000df0: 4974 656d 2870 672e 4178 6973 4974 656d  Item(pg.AxisItem
+00000e00: 293a 0d0a 2020 2020 6465 6620 5f5f 696e  ):..    def __in
+00000e10: 6974 5f5f 2873 656c 662c 2076 622c 202a  it__(self, vb, *
+00000e20: 6172 6773 2c20 2a2a 6b77 6172 6773 293a  args, **kwargs):
+00000e30: 0d0a 2020 2020 2020 2020 7375 7065 7228  ..        super(
+00000e40: 292e 5f5f 696e 6974 5f5f 282a 6172 6773  ).__init__(*args
+00000e50: 2c20 2a2a 6b77 6172 6773 290d 0a20 2020  , **kwargs)..   
+00000e60: 2020 2020 2073 656c 662e 7662 203d 2076       self.vb = v
+00000e70: 620d 0a0d 0a20 2020 2064 6566 2074 6963  b....    def tic
+00000e80: 6b53 7472 696e 6773 2873 656c 662c 2076  kStrings(self, v
+00000e90: 616c 7565 732c 2073 6361 6c65 2c20 7370  alues, scale, sp
+00000ea0: 6163 696e 6729 3a0d 0a20 2020 2020 2020  acing):..       
+00000eb0: 2069 6620 7365 6c66 2e6d 6f64 6520 3d3d   if self.mode ==
+00000ec0: 2027 6e75 6d27 3a0d 0a20 2020 2020 2020   'num':..       
+00000ed0: 2020 2020 2072 6574 7572 6e20 5b27 2567       return ['%g
+00000ee0: 2725 7620 666f 7220 7620 696e 2076 616c  '%v for v in val
+00000ef0: 7565 735d 0d0a 2020 2020 2020 2020 636f  ues]..        co
+00000f00: 6e76 203d 205f 7832 7965 6172 2069 6620  nv = _x2year if 
+00000f10: 7365 6c66 2e6d 6f64 653d 3d27 7965 6172  self.mode=='year
+00000f20: 7327 2065 6c73 6520 5f78 326c 6f63 616c  s' else _x2local
+00000f30: 5f74 0d0a 2020 2020 2020 2020 7374 7273  _t..        strs
+00000f40: 203d 205b 636f 6e76 2873 656c 662e 7662   = [conv(self.vb
+00000f50: 2e64 6174 6173 7263 2c20 7661 6c75 6529  .datasrc, value)
+00000f60: 5b30 5d20 666f 7220 7661 6c75 6520 696e  [0] for value in
+00000f70: 2076 616c 7565 735d 0d0a 2020 2020 2020   values]..      
+00000f80: 2020 6966 2061 6c6c 2873 2e65 6e64 7377    if all(s.endsw
+00000f90: 6974 6828 2720 3030 3a30 3027 2920 666f  ith(' 00:00') fo
+00000fa0: 7220 7320 696e 2073 7472 7320 6966 2073  r s in strs if s
+00000fb0: 293a 2023 2061 6c6c 2061 7420 6d69 646e  ): # all at midn
+00000fc0: 6967 6874 202d 3e20 726f 756e 6420 746f  ight -> round to
+00000fd0: 2064 6179 730d 0a20 2020 2020 2020 2020   days..         
+00000fe0: 2020 2073 7472 7320 3d20 5b73 2e70 6172     strs = [s.par
+00000ff0: 7469 7469 6f6e 2827 2027 295b 305d 2066  tition(' ')[0] f
+00001000: 6f72 2073 2069 6e20 7374 7273 5d0d 0a20  or s in strs].. 
+00001010: 2020 2020 2020 2072 6574 7572 6e20 7374         return st
+00001020: 7273 0d0a 0d0a 2020 2020 6465 6620 7469  rs....    def ti
+00001030: 636b 5661 6c75 6573 2873 656c 662c 206d  ckValues(self, m
+00001040: 696e 5661 6c2c 206d 6178 5661 6c2c 2073  inVal, maxVal, s
+00001050: 697a 6529 3a0d 0a20 2020 2020 2020 2073  ize):..        s
+00001060: 656c 662e 6d6f 6465 203d 2027 6e75 6d27  elf.mode = 'num'
+00001070: 0d0a 2020 2020 2020 2020 6178 203d 2073  ..        ax = s
+00001080: 656c 662e 7662 2e70 6172 656e 7428 290d  elf.vb.parent().
+00001090: 0a20 2020 2020 2020 2064 6174 6173 7263  .        datasrc
+000010a0: 203d 205f 6765 745f 6461 7461 7372 6328   = _get_datasrc(
+000010b0: 6178 2c20 7265 7175 6972 653d 4661 6c73  ax, require=Fals
+000010c0: 6529 0d0a 2020 2020 2020 2020 6966 2064  e)..        if d
+000010d0: 6174 6173 7263 2069 7320 4e6f 6e65 206f  atasrc is None o
+000010e0: 7220 6e6f 7420 7365 6c66 2e76 622e 785f  r not self.vb.x_
+000010f0: 696e 6465 7865 643a 0d0a 2020 2020 2020  indexed:..      
+00001100: 2020 2020 2020 7265 7475 726e 2073 7570        return sup
+00001110: 6572 2829 2e74 6963 6b56 616c 7565 7328  er().tickValues(
+00001120: 6d69 6e56 616c 2c20 6d61 7856 616c 2c20  minVal, maxVal, 
+00001130: 7369 7a65 290d 0a20 2020 2020 2020 2023  size)..        #
+00001140: 2063 616c 6375 6c61 7465 2069 6620 7765   calculate if we
+00001150: 2075 7365 2079 6561 7273 2c20 6461 7973   use years, days
+00001160: 2c20 6574 632e 0d0a 2020 2020 2020 2020  , etc...        
+00001170: 7430 2c74 312c 5f2c 5f2c 5f20 3d20 6461  t0,t1,_,_,_ = da
+00001180: 7461 7372 632e 6869 6c6f 286d 696e 5661  tasrc.hilo(minVa
+00001190: 6c2c 206d 6178 5661 6c29 0d0a 2020 2020  l, maxVal)..    
+000011a0: 2020 2020 7430 2c74 3120 3d20 7064 2e74      t0,t1 = pd.t
+000011b0: 6f5f 6461 7465 7469 6d65 2874 3029 2c20  o_datetime(t0), 
+000011c0: 7064 2e74 6f5f 6461 7465 7469 6d65 2874  pd.to_datetime(t
+000011d0: 3129 0d0a 2020 2020 2020 2020 6474 7320  1)..        dts 
+000011e0: 3d20 2874 312d 7430 292e 746f 7461 6c5f  = (t1-t0).total_
+000011f0: 7365 636f 6e64 7328 290d 0a20 2020 2020  seconds()..     
+00001200: 2020 2067 6678 5f77 6964 7468 203d 2069     gfx_width = i
+00001210: 6e74 2873 697a 6529 0d0a 2020 2020 2020  nt(size)..      
+00001220: 2020 666f 7220 6d6f 6465 2c20 6474 742c    for mode, dtt,
+00001230: 2066 7265 712c 2074 6963 6b6c 656e 2069   freq, ticklen i
+00001240: 6e20 7469 6d65 5f73 706c 6974 733a 0d0a  n time_splits:..
+00001250: 2020 2020 2020 2020 2020 2020 6966 2064              if d
+00001260: 7473 203e 2064 7474 3a0d 0a20 2020 2020  ts > dtt:..     
+00001270: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00001280: 6d6f 6465 203d 206d 6f64 650d 0a20 2020  mode = mode..   
+00001290: 2020 2020 2020 2020 2020 2020 2064 6573               des
+000012a0: 6972 6564 5f74 6963 6b73 203d 2067 6678  ired_ticks = gfx
+000012b0: 5f77 6964 7468 202f 2028 2874 6963 6b6c  _width / ((tickl
+000012c0: 656e 2b32 2920 2a20 3130 2920 2d20 3120  en+2) * 10) - 1 
+000012d0: 2320 616e 2061 7070 726f 7869 6d61 7469  # an approximati
+000012e0: 6f6e 2069 7320 6669 6e65 0d0a 2020 2020  on is fine..    
+000012f0: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+00001300: 656c 662e 7662 2e64 6174 6173 7263 2069  elf.vb.datasrc i
+00001310: 7320 6e6f 7420 4e6f 6e65 2061 6e64 206e  s not None and n
+00001320: 6f74 2073 656c 662e 7662 2e64 6174 6173  ot self.vb.datas
+00001330: 7263 2e69 735f 736d 6f6f 7468 5f74 696d  rc.is_smooth_tim
+00001340: 6528 293a 0d0a 2020 2020 2020 2020 2020  e():..          
+00001350: 2020 2020 2020 2020 2020 6465 7369 7265            desire
+00001360: 645f 7469 636b 7320 2d3d 2031 2023 206c  d_ticks -= 1 # l
+00001370: 6561 7665 206d 6f72 6520 7370 6163 6520  eave more space 
+00001380: 666f 7220 756e 6576 656e 6c79 2073 7061  for unevenly spa
+00001390: 6365 6420 7469 636b 730d 0a20 2020 2020  ced ticks..     
+000013a0: 2020 2020 2020 2020 2020 2064 6573 6972             desir
+000013b0: 6564 5f74 6963 6b73 203d 206d 6178 2864  ed_ticks = max(d
+000013c0: 6573 6972 6564 5f74 6963 6b73 2c20 3429  esired_ticks, 4)
+000013d0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000013e0: 2020 746f 5f6d 6964 6e69 6768 7420 3d20    to_midnight = 
+000013f0: 6672 6571 2069 6e20 2827 5953 272c 274d  freq in ('YS','M
+00001400: 5327 2c20 2757 2d4d 4f4e 272c 2027 4427  S', 'W-MON', 'D'
+00001410: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+00001420: 2020 2074 7a20 3d20 6469 7370 6c61 795f     tz = display_
+00001430: 7469 6d65 7a6f 6e65 2069 6620 746f 5f6d  timezone if to_m
+00001440: 6964 6e69 6768 7420 656c 7365 204e 6f6e  idnight else Non
+00001450: 6520 2320 666f 7220 7368 6f72 7465 7220  e # for shorter 
+00001460: 7469 6d65 6672 616d 6573 2c20 7469 6d65  timeframes, time
+00001470: 7a6f 6e65 2073 6565 6d73 2062 7567 6779  zone seems buggy
+00001480: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00001490: 2020 726e 6720 3d20 7064 2e64 6174 655f    rng = pd.date_
+000014a0: 7261 6e67 6528 7430 2c20 7431 2c20 747a  range(t0, t1, tz
+000014b0: 3d74 7a2c 206e 6f72 6d61 6c69 7a65 3d74  =tz, normalize=t
+000014c0: 6f5f 6d69 646e 6967 6874 2c20 6672 6571  o_midnight, freq
+000014d0: 3d66 7265 7129 0d0a 2020 2020 2020 2020  =freq)..        
+000014e0: 2020 2020 2020 2020 7374 6570 7320 3d20          steps = 
+000014f0: 6c65 6e28 726e 6729 2069 6620 6c65 6e28  len(rng) if len(
+00001500: 726e 6729 2631 3d3d 3020 656c 7365 206c  rng)&1==0 else l
+00001510: 656e 2872 6e67 292b 3120 2320 7265 6475  en(rng)+1 # redu
+00001520: 6365 206a 6974 7465 7220 6265 7477 6565  ce jitter betwee
+00001530: 6e20 652e 672e 2035 3c2d 2d3e 3130 2074  n e.g. 5<-->10 t
+00001540: 6963 6b73 2066 6f72 2072 6573 6f6c 7574  icks for resolut
+00001550: 696f 6e20 636c 6f73 6520 746f 206c 696d  ion close to lim
+00001560: 6974 0d0a 2020 2020 2020 2020 2020 2020  it..            
+00001570: 2020 2020 7374 6570 203d 2069 6e74 2873      step = int(s
+00001580: 7465 7073 2f64 6573 6972 6564 5f74 6963  teps/desired_tic
+00001590: 6b73 2920 6f72 2031 0d0a 2020 2020 2020  ks) or 1..      
+000015a0: 2020 2020 2020 2020 2020 726e 6720 3d20            rng = 
+000015b0: 726e 675b 3a3a 7374 6570 5d0d 0a20 2020  rng[::step]..   
+000015c0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+000015d0: 6e6f 7420 746f 5f6d 6964 6e69 6768 743a  not to_midnight:
+000015e0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000015f0: 2020 2020 2020 7472 793a 2020 2020 726e        try:    rn
+00001600: 6720 3d20 726e 672e 726f 756e 6428 6672  g = rng.round(fr
+00001610: 6571 3d66 7265 7129 0d0a 2020 2020 2020  eq=freq)..      
+00001620: 2020 2020 2020 2020 2020 2020 2020 6578                ex
+00001630: 6365 7074 3a20 7061 7373 0d0a 2020 2020  cept: pass..    
+00001640: 2020 2020 2020 2020 2020 2020 6178 203d              ax =
+00001650: 2073 656c 662e 7662 2e70 6172 656e 7428   self.vb.parent(
+00001660: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+00001670: 2020 2072 6e67 203d 205f 7064 7469 6d65     rng = _pdtime
+00001680: 3269 6e64 6578 2861 783d 6178 2c20 7473  2index(ax=ax, ts
+00001690: 3d70 642e 5365 7269 6573 2872 6e67 292c  =pd.Series(rng),
+000016a0: 2072 6571 7569 7265 5f74 696d 653d 5472   require_time=Tr
+000016b0: 7565 290d 0a20 2020 2020 2020 2020 2020  ue)..           
+000016c0: 2020 2020 2069 6e64 6963 6573 203d 205b       indices = [
+000016d0: 6365 696c 2869 2920 666f 7220 6920 696e  ceil(i) for i in
+000016e0: 2072 6e67 5d0d 0a20 2020 2020 2020 2020   rng]..         
+000016f0: 2020 2020 2020 2072 6574 7572 6e20 5b28         return [(
+00001700: 302c 2069 6e64 6963 6573 295d 0d0a 2020  0, indices)]..  
+00001710: 2020 2020 2020 7265 7475 726e 205b 2830        return [(0
+00001720: 2c5b 5d29 5d0d 0a0d 0a20 2020 2064 6566  ,[])]....    def
+00001730: 2067 656e 6572 6174 6544 7261 7753 7065   generateDrawSpe
+00001740: 6373 2873 656c 662c 2070 293a 0d0a 2020  cs(self, p):..  
+00001750: 2020 2020 2020 7370 6563 7320 3d20 7375        specs = su
+00001760: 7065 7228 292e 6765 6e65 7261 7465 4472  per().generateDr
+00001770: 6177 5370 6563 7328 7029 0d0a 2020 2020  awSpecs(p)..    
+00001780: 2020 2020 6966 2073 7065 6373 3a0d 0a20      if specs:.. 
+00001790: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
+000017a0: 7420 7365 6c66 2e73 7479 6c65 5b27 7368  t self.style['sh
+000017b0: 6f77 5661 6c75 6573 275d 3a0d 0a20 2020  owValues']:..   
+000017c0: 2020 2020 2020 2020 2020 2020 2070 656e               pen
+000017d0: 2c70 302c 7031 203d 2073 7065 6373 5b30  ,p0,p1 = specs[0
+000017e0: 5d20 2320 6178 6973 2073 7065 6373 0d0a  ] # axis specs..
+000017f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001800: 7370 6563 7320 3d20 5b28 5f6d 616b 6570  specs = [(_makep
+00001810: 656e 2827 2366 6666 3027 292c 7030 2c70  en('#fff0'),p0,p
+00001820: 3129 5d20 2b20 6c69 7374 2873 7065 6373  1)] + list(specs
+00001830: 5b31 3a5d 2920 2320 646f 6e27 7420 6472  [1:]) # don't dr
+00001840: 6177 2061 7869 7320 6966 2068 6964 696e  aw axis if hidin
+00001850: 6720 7661 6c75 6573 0d0a 2020 2020 2020  g values..      
+00001860: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
+00001870: 2020 2020 2020 2020 2020 2020 2023 2074               # t
+00001880: 6872 6f77 206f 7574 2074 6963 6b73 2074  hrow out ticks t
+00001890: 6861 7420 6172 6520 6f75 7420 6f66 2062  hat are out of b
+000018a0: 6f75 6e64 730d 0a20 2020 2020 2020 2020  ounds..         
+000018b0: 2020 2020 2020 2074 6578 745f 7370 6563         text_spec
+000018c0: 7320 3d20 7370 6563 735b 325d 0d0a 2020  s = specs[2]..  
+000018d0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+000018e0: 206c 656e 2874 6578 745f 7370 6563 7329   len(text_specs)
+000018f0: 203e 3d20 343a 0d0a 2020 2020 2020 2020   >= 4:..        
+00001900: 2020 2020 2020 2020 2020 2020 7265 6374              rect
+00001910: 2c66 6c61 6773 2c74 6578 7420 3d20 7465  ,flags,text = te
+00001920: 7874 5f73 7065 6373 5b30 5d0d 0a20 2020  xt_specs[0]..   
+00001930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001940: 2069 6620 7265 6374 2e6c 6566 7428 2920   if rect.left() 
+00001950: 3c20 303a 0d0a 2020 2020 2020 2020 2020  < 0:..          
+00001960: 2020 2020 2020 2020 2020 2020 2020 6465                de
+00001970: 6c20 7465 7874 5f73 7065 6373 5b30 5d0d  l text_specs[0].
+00001980: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00001990: 2020 2020 2072 6563 742c 666c 6167 732c       rect,flags,
+000019a0: 7465 7874 203d 2074 6578 745f 7370 6563  text = text_spec
+000019b0: 735b 2d31 5d0d 0a20 2020 2020 2020 2020  s[-1]..         
+000019c0: 2020 2020 2020 2020 2020 2069 6620 7265             if re
+000019d0: 6374 2e72 6967 6874 2829 203e 2073 656c  ct.right() > sel
+000019e0: 662e 6765 6f6d 6574 7279 2829 2e77 6964  f.geometry().wid
+000019f0: 7468 2829 3a0d 0a20 2020 2020 2020 2020  th():..         
+00001a00: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+00001a10: 656c 2074 6578 745f 7370 6563 735b 2d31  el text_specs[-1
+00001a20: 5d0d 0a20 2020 2020 2020 2020 2020 2020  ]..             
+00001a30: 2020 2023 202e 2e2e 2061 6e64 2074 686f     # ... and tho
+00001a40: 7365 2074 6861 7420 6f76 6572 6c61 700d  se that overlap.
+00001a50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00001a60: 2078 203d 2031 6536 0d0a 2020 2020 2020   x = 1e6..      
+00001a70: 2020 2020 2020 2020 2020 666f 7220 692c            for i,
+00001a80: 2872 6563 742c 666c 6167 732c 7465 7874  (rect,flags,text
+00001a90: 2920 696e 2072 6576 6572 7365 6428 6c69  ) in reversed(li
+00001aa0: 7374 2865 6e75 6d65 7261 7465 2874 6578  st(enumerate(tex
+00001ab0: 745f 7370 6563 7329 2929 3a0d 0a20 2020  t_specs))):..   
+00001ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001ad0: 2069 6620 7265 6374 2e72 6967 6874 2829   if rect.right()
+00001ae0: 203e 3d20 783a 0d0a 2020 2020 2020 2020   >= x:..        
 00001af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001b00: 2020 2020 2020 2020 7820 3d20 7265 6374          x = rect
-00001b10: 2e6c 6566 7428 290d 0a20 2020 2020 2020  .left()..       
-00001b20: 2072 6574 7572 6e20 7370 6563 730d 0a0d   return specs...
-00001b30: 0a0d 0a0d 0a63 6c61 7373 2059 4178 6973  .....class YAxis
-00001b40: 4974 656d 2870 672e 4178 6973 4974 656d  Item(pg.AxisItem
-00001b50: 293a 0d0a 2020 2020 6465 6620 5f5f 696e  ):..    def __in
-00001b60: 6974 5f5f 2873 656c 662c 2076 622c 202a  it__(self, vb, *
-00001b70: 6172 6773 2c20 2a2a 6b77 6172 6773 293a  args, **kwargs):
-00001b80: 0d0a 2020 2020 2020 2020 7375 7065 7228  ..        super(
-00001b90: 292e 5f5f 696e 6974 5f5f 282a 6172 6773  ).__init__(*args
-00001ba0: 2c20 2a2a 6b77 6172 6773 290d 0a20 2020  , **kwargs)..   
-00001bb0: 2020 2020 2073 656c 662e 7662 203d 2076       self.vb = v
-00001bc0: 620d 0a20 2020 2020 2020 2073 656c 662e  b..        self.
-00001bd0: 6869 6465 5f73 7472 696e 6773 203d 2046  hide_strings = F
-00001be0: 616c 7365 0d0a 2020 2020 2020 2020 7365  alse..        se
-00001bf0: 6c66 2e73 7479 6c65 5b27 6175 746f 4578  lf.style['autoEx
-00001c00: 7061 6e64 5465 7874 5370 6163 6527 5d20  pandTextSpace'] 
-00001c10: 3d20 4661 6c73 650d 0a20 2020 2020 2020  = False..       
-00001c20: 2073 656c 662e 7374 796c 655b 2761 7574   self.style['aut
-00001c30: 6f52 6564 7563 6554 6578 7453 7061 6365  oReduceTextSpace
-00001c40: 275d 203d 2046 616c 7365 0d0a 2020 2020  '] = False..    
-00001c50: 2020 2020 7365 6c66 2e6e 6578 745f 666d      self.next_fm
-00001c60: 7420 3d20 2725 6727 0d0a 0d0a 2020 2020  t = '%g'....    
-00001c70: 6465 6620 7469 636b 5661 6c75 6573 2873  def tickValues(s
-00001c80: 656c 662c 206d 696e 5661 6c2c 206d 6178  elf, minVal, max
-00001c90: 5661 6c2c 2073 697a 6529 3a0d 0a20 2020  Val, size):..   
-00001ca0: 2020 2020 2076 7320 3d20 7375 7065 7228       vs = super(
-00001cb0: 292e 7469 636b 5661 6c75 6573 286d 696e  ).tickValues(min
-00001cc0: 5661 6c2c 206d 6178 5661 6c2c 2073 697a  Val, maxVal, siz
-00001cd0: 6529 0d0a 2020 2020 2020 2020 6966 206c  e)..        if l
-00001ce0: 656e 2876 7329 203c 2033 3a0d 0a20 2020  en(vs) < 3:..   
-00001cf0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00001d00: 7673 0d0a 2020 2020 2020 2020 7265 7475  vs..        retu
-00001d10: 726e 2073 656c 662e 666d 745f 7661 6c75  rn self.fmt_valu
-00001d20: 6573 2876 7329 0d0a 0d0a 2020 2020 6465  es(vs)....    de
-00001d30: 6620 6c6f 6754 6963 6b56 616c 7565 7328  f logTickValues(
-00001d40: 7365 6c66 2c20 6d69 6e56 616c 2c20 6d61  self, minVal, ma
-00001d50: 7856 616c 2c20 7369 7a65 2c20 7374 6454  xVal, size, stdT
-00001d60: 6963 6b73 293a 0d0a 2020 2020 2020 2020  icks):..        
-00001d70: 7631 203d 2069 6e74 2866 6c6f 6f72 286d  v1 = int(floor(m
-00001d80: 696e 5661 6c29 290d 0a20 2020 2020 2020  inVal))..       
-00001d90: 2076 3220 3d20 696e 7428 6365 696c 286d   v2 = int(ceil(m
-00001da0: 6178 5661 6c29 290d 0a20 2020 2020 2020  axVal))..       
-00001db0: 206d 696e 6f72 203d 205b 5d0d 0a20 2020   minor = []..   
-00001dc0: 2020 2020 2066 6f72 2076 2069 6e20 7261       for v in ra
-00001dd0: 6e67 6528 7631 2c20 7632 293a 0d0a 2020  nge(v1, v2):..  
-00001de0: 2020 2020 2020 2020 2020 6d69 6e6f 722e            minor.
-00001df0: 6578 7465 6e64 285b 762b 6c20 666f 7220  extend([v+l for 
-00001e00: 6c20 696e 206e 702e 6c6f 6731 3028 6e70  l in np.log10(np
-00001e10: 2e6c 696e 7370 6163 6528 312c 2039 2e39  .linspace(1, 9.9
-00001e20: 2c20 3930 2929 5d29 0d0a 2020 2020 2020  , 90))])..      
-00001e30: 2020 6d69 6e6f 7220 3d20 5b78 2066 6f72    minor = [x for
-00001e40: 2078 2069 6e20 6d69 6e6f 7220 6966 2078   x in minor if x
-00001e50: 3e6d 696e 5661 6c20 616e 6420 783c 6d61  >minVal and x<ma
-00001e60: 7856 616c 5d0d 0a20 2020 2020 2020 2069  xVal]..        i
-00001e70: 6620 6e6f 7420 6d69 6e6f 723a 0d0a 2020  f not minor:..  
-00001e80: 2020 2020 2020 2020 2020 6d69 6e6f 722e            minor.
-00001e90: 6578 7465 6e64 286e 702e 6765 6f6d 7370  extend(np.geomsp
-00001ea0: 6163 6528 6d69 6e56 616c 2c20 6d61 7856  ace(minVal, maxV
-00001eb0: 616c 2c20 3729 5b31 3a2d 315d 290d 0a20  al, 7)[1:-1]).. 
-00001ec0: 2020 2020 2020 2069 6620 6c65 6e28 6d69         if len(mi
-00001ed0: 6e6f 7229 203e 2031 303a 0d0a 2020 2020  nor) > 10:..    
-00001ee0: 2020 2020 2020 2020 6d69 6e6f 7220 3d20          minor = 
-00001ef0: 6d69 6e6f 725b 3a3a 6c65 6e28 6d69 6e6f  minor[::len(mino
-00001f00: 7229 2f2f 355d 0d0a 2020 2020 2020 2020  r)//5]..        
-00001f10: 7673 203d 205b 284e 6f6e 652c 206d 696e  vs = [(None, min
-00001f20: 6f72 295d 0d0a 2020 2020 2020 2020 7265  or)]..        re
-00001f30: 7475 726e 2073 656c 662e 666d 745f 7661  turn self.fmt_va
-00001f40: 6c75 6573 2876 7329 0d0a 0d0a 2020 2020  lues(vs)....    
-00001f50: 6465 6620 7469 636b 5374 7269 6e67 7328  def tickStrings(
-00001f60: 7365 6c66 2c20 7661 6c75 6573 2c20 7363  self, values, sc
-00001f70: 616c 652c 2073 7061 6369 6e67 293a 0d0a  ale, spacing):..
-00001f80: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-00001f90: 6869 6465 5f73 7472 696e 6773 3a0d 0a20  hide_strings:.. 
-00001fa0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00001fb0: 6e20 5b5d 0d0a 2020 2020 2020 2020 7866  n []..        xf
-00001fc0: 6f72 6d20 3d20 7365 6c66 2e76 622e 7973  orm = self.vb.ys
-00001fd0: 6361 6c65 2e78 666f 726d 0d0a 2020 2020  cale.xform..    
-00001fe0: 2020 2020 7265 7475 726e 205b 7365 6c66      return [self
-00001ff0: 2e6e 6578 745f 666d 7425 7866 6f72 6d28  .next_fmt%xform(
-00002000: 7661 6c75 6529 2066 6f72 2076 616c 7565  value) for value
-00002010: 2069 6e20 7661 6c75 6573 5d0d 0a0d 0a20   in values].... 
-00002020: 2020 2064 6566 2066 6d74 5f76 616c 7565     def fmt_value
-00002030: 7328 7365 6c66 2c20 7673 293a 0d0a 2020  s(self, vs):..  
-00002040: 2020 2020 2020 7866 6f72 6d20 3d20 7365        xform = se
-00002050: 6c66 2e76 622e 7973 6361 6c65 2e78 666f  lf.vb.yscale.xfo
-00002060: 726d 0d0a 2020 2020 2020 2020 6773 203d  rm..        gs =
-00002070: 205b 2725 6727 2578 666f 726d 2876 2920   ['%g'%xform(v) 
-00002080: 666f 7220 7620 696e 2076 735b 2d31 5d5b  for v in vs[-1][
-00002090: 315d 5d0d 0a20 2020 2020 2020 2069 6620  1]]..        if 
-000020a0: 6e6f 7420 6773 3a0d 0a20 2020 2020 2020  not gs:..       
-000020b0: 2020 2020 2072 6574 7572 6e20 7673 0d0a       return vs..
-000020c0: 2020 2020 2020 2020 6966 2061 6e79 285b          if any([
-000020d0: 2765 2720 696e 2067 2066 6f72 2067 2069  'e' in g for g i
-000020e0: 6e20 6773 5d29 3a0d 0a20 2020 2020 2020  n gs]):..       
-000020f0: 2020 2020 206d 6178 6465 6320 3d20 6d61       maxdec = ma
-00002100: 7828 5b6c 656e 2828 6729 2e70 6172 7469  x([len((g).parti
-00002110: 7469 6f6e 2827 2e27 295b 325d 2e70 6172  tion('.')[2].par
-00002120: 7469 7469 6f6e 2827 6527 295b 305d 2920  tition('e')[0]) 
-00002130: 666f 7220 6720 696e 2067 7320 6966 2027  for g in gs if '
-00002140: 6527 2069 6e20 675d 290d 0a20 2020 2020  e' in g])..     
-00002150: 2020 2020 2020 2073 656c 662e 6e65 7874         self.next
-00002160: 5f66 6d74 203d 2027 2525 2e25 6965 2720  _fmt = '%%.%ie' 
-00002170: 2520 6d61 7864 6563 0d0a 2020 2020 2020  % maxdec..      
-00002180: 2020 656c 6966 2067 733a 0d0a 2020 2020    elif gs:..    
-00002190: 2020 2020 2020 2020 6d61 7864 6563 203d          maxdec =
-000021a0: 206d 6178 285b 6c65 6e28 2867 292e 7061   max([len((g).pa
-000021b0: 7274 6974 696f 6e28 272e 2729 5b32 5d29  rtition('.')[2])
-000021c0: 2066 6f72 2067 2069 6e20 6773 5d29 0d0a   for g in gs])..
-000021d0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-000021e0: 2e6e 6578 745f 666d 7420 3d20 2725 252e  .next_fmt = '%%.
-000021f0: 2569 6627 2025 206d 6178 6465 630d 0a20  %if' % maxdec.. 
-00002200: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
+00001b00: 6465 6c20 7465 7874 5f73 7065 6373 5b69  del text_specs[i
+00001b10: 5d0d 0a20 2020 2020 2020 2020 2020 2020  ]..             
+00001b20: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
+00001b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001b40: 2020 2020 2020 7820 3d20 7265 6374 2e6c        x = rect.l
+00001b50: 6566 7428 290d 0a20 2020 2020 2020 2072  eft()..        r
+00001b60: 6574 7572 6e20 7370 6563 730d 0a0d 0a0d  eturn specs.....
+00001b70: 0a0d 0a63 6c61 7373 2059 4178 6973 4974  ...class YAxisIt
+00001b80: 656d 2870 672e 4178 6973 4974 656d 293a  em(pg.AxisItem):
+00001b90: 0d0a 2020 2020 6465 6620 5f5f 696e 6974  ..    def __init
+00001ba0: 5f5f 2873 656c 662c 2076 622c 202a 6172  __(self, vb, *ar
+00001bb0: 6773 2c20 2a2a 6b77 6172 6773 293a 0d0a  gs, **kwargs):..
+00001bc0: 2020 2020 2020 2020 7375 7065 7228 292e          super().
+00001bd0: 5f5f 696e 6974 5f5f 282a 6172 6773 2c20  __init__(*args, 
+00001be0: 2a2a 6b77 6172 6773 290d 0a20 2020 2020  **kwargs)..     
+00001bf0: 2020 2073 656c 662e 7662 203d 2076 620d     self.vb = vb.
+00001c00: 0a20 2020 2020 2020 2073 656c 662e 6869  .        self.hi
+00001c10: 6465 5f73 7472 696e 6773 203d 2046 616c  de_strings = Fal
+00001c20: 7365 0d0a 2020 2020 2020 2020 7365 6c66  se..        self
+00001c30: 2e73 7479 6c65 5b27 6175 746f 4578 7061  .style['autoExpa
+00001c40: 6e64 5465 7874 5370 6163 6527 5d20 3d20  ndTextSpace'] = 
+00001c50: 4661 6c73 650d 0a20 2020 2020 2020 2073  False..        s
+00001c60: 656c 662e 7374 796c 655b 2761 7574 6f52  elf.style['autoR
+00001c70: 6564 7563 6554 6578 7453 7061 6365 275d  educeTextSpace']
+00001c80: 203d 2046 616c 7365 0d0a 2020 2020 2020   = False..      
+00001c90: 2020 7365 6c66 2e6e 6578 745f 666d 7420    self.next_fmt 
+00001ca0: 3d20 2725 6727 0d0a 0d0a 2020 2020 6465  = '%g'....    de
+00001cb0: 6620 7469 636b 5661 6c75 6573 2873 656c  f tickValues(sel
+00001cc0: 662c 206d 696e 5661 6c2c 206d 6178 5661  f, minVal, maxVa
+00001cd0: 6c2c 2073 697a 6529 3a0d 0a20 2020 2020  l, size):..     
+00001ce0: 2020 2076 7320 3d20 7375 7065 7228 292e     vs = super().
+00001cf0: 7469 636b 5661 6c75 6573 286d 696e 5661  tickValues(minVa
+00001d00: 6c2c 206d 6178 5661 6c2c 2073 697a 6529  l, maxVal, size)
+00001d10: 0d0a 2020 2020 2020 2020 6966 206c 656e  ..        if len
+00001d20: 2876 7329 203c 2033 3a0d 0a20 2020 2020  (vs) < 3:..     
+00001d30: 2020 2020 2020 2072 6574 7572 6e20 7673         return vs
+00001d40: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+00001d50: 2073 656c 662e 666d 745f 7661 6c75 6573   self.fmt_values
+00001d60: 2876 7329 0d0a 0d0a 2020 2020 6465 6620  (vs)....    def 
+00001d70: 6c6f 6754 6963 6b56 616c 7565 7328 7365  logTickValues(se
+00001d80: 6c66 2c20 6d69 6e56 616c 2c20 6d61 7856  lf, minVal, maxV
+00001d90: 616c 2c20 7369 7a65 2c20 7374 6454 6963  al, size, stdTic
+00001da0: 6b73 293a 0d0a 2020 2020 2020 2020 7631  ks):..        v1
+00001db0: 203d 2069 6e74 2866 6c6f 6f72 286d 696e   = int(floor(min
+00001dc0: 5661 6c29 290d 0a20 2020 2020 2020 2076  Val))..        v
+00001dd0: 3220 3d20 696e 7428 6365 696c 286d 6178  2 = int(ceil(max
+00001de0: 5661 6c29 290d 0a20 2020 2020 2020 206d  Val))..        m
+00001df0: 696e 6f72 203d 205b 5d0d 0a20 2020 2020  inor = []..     
+00001e00: 2020 2066 6f72 2076 2069 6e20 7261 6e67     for v in rang
+00001e10: 6528 7631 2c20 7632 293a 0d0a 2020 2020  e(v1, v2):..    
+00001e20: 2020 2020 2020 2020 6d69 6e6f 722e 6578          minor.ex
+00001e30: 7465 6e64 285b 762b 6c20 666f 7220 6c20  tend([v+l for l 
+00001e40: 696e 206e 702e 6c6f 6731 3028 6e70 2e6c  in np.log10(np.l
+00001e50: 696e 7370 6163 6528 312c 2039 2e39 2c20  inspace(1, 9.9, 
+00001e60: 3930 2929 5d29 0d0a 2020 2020 2020 2020  90))])..        
+00001e70: 6d69 6e6f 7220 3d20 5b78 2066 6f72 2078  minor = [x for x
+00001e80: 2069 6e20 6d69 6e6f 7220 6966 2078 3e6d   in minor if x>m
+00001e90: 696e 5661 6c20 616e 6420 783c 6d61 7856  inVal and x<maxV
+00001ea0: 616c 5d0d 0a20 2020 2020 2020 2069 6620  al]..        if 
+00001eb0: 6e6f 7420 6d69 6e6f 723a 0d0a 2020 2020  not minor:..    
+00001ec0: 2020 2020 2020 2020 6d69 6e6f 722e 6578          minor.ex
+00001ed0: 7465 6e64 286e 702e 6765 6f6d 7370 6163  tend(np.geomspac
+00001ee0: 6528 6d69 6e56 616c 2c20 6d61 7856 616c  e(minVal, maxVal
+00001ef0: 2c20 3729 5b31 3a2d 315d 290d 0a20 2020  , 7)[1:-1])..   
+00001f00: 2020 2020 2069 6620 6c65 6e28 6d69 6e6f       if len(mino
+00001f10: 7229 203e 2031 303a 0d0a 2020 2020 2020  r) > 10:..      
+00001f20: 2020 2020 2020 6d69 6e6f 7220 3d20 6d69        minor = mi
+00001f30: 6e6f 725b 3a3a 6c65 6e28 6d69 6e6f 7229  nor[::len(minor)
+00001f40: 2f2f 355d 0d0a 2020 2020 2020 2020 7673  //5]..        vs
+00001f50: 203d 205b 284e 6f6e 652c 206d 696e 6f72   = [(None, minor
+00001f60: 295d 0d0a 2020 2020 2020 2020 7265 7475  )]..        retu
+00001f70: 726e 2073 656c 662e 666d 745f 7661 6c75  rn self.fmt_valu
+00001f80: 6573 2876 7329 0d0a 0d0a 2020 2020 6465  es(vs)....    de
+00001f90: 6620 7469 636b 5374 7269 6e67 7328 7365  f tickStrings(se
+00001fa0: 6c66 2c20 7661 6c75 6573 2c20 7363 616c  lf, values, scal
+00001fb0: 652c 2073 7061 6369 6e67 293a 0d0a 2020  e, spacing):..  
+00001fc0: 2020 2020 2020 6966 2073 656c 662e 6869        if self.hi
+00001fd0: 6465 5f73 7472 696e 6773 3a0d 0a20 2020  de_strings:..   
+00001fe0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00001ff0: 5b5d 0d0a 2020 2020 2020 2020 7866 6f72  []..        xfor
+00002000: 6d20 3d20 7365 6c66 2e76 622e 7973 6361  m = self.vb.ysca
+00002010: 6c65 2e78 666f 726d 0d0a 2020 2020 2020  le.xform..      
+00002020: 2020 7265 7475 726e 205b 7365 6c66 2e6e    return [self.n
+00002030: 6578 745f 666d 7425 7866 6f72 6d28 7661  ext_fmt%xform(va
+00002040: 6c75 6529 2066 6f72 2076 616c 7565 2069  lue) for value i
+00002050: 6e20 7661 6c75 6573 5d0d 0a0d 0a20 2020  n values]....   
+00002060: 2064 6566 2066 6d74 5f76 616c 7565 7328   def fmt_values(
+00002070: 7365 6c66 2c20 7673 293a 0d0a 2020 2020  self, vs):..    
+00002080: 2020 2020 7866 6f72 6d20 3d20 7365 6c66      xform = self
+00002090: 2e76 622e 7973 6361 6c65 2e78 666f 726d  .vb.yscale.xform
+000020a0: 0d0a 2020 2020 2020 2020 6773 203d 205b  ..        gs = [
+000020b0: 2725 6727 2578 666f 726d 2876 2920 666f  '%g'%xform(v) fo
+000020c0: 7220 7620 696e 2076 735b 2d31 5d5b 315d  r v in vs[-1][1]
+000020d0: 5d0d 0a20 2020 2020 2020 2069 6620 6e6f  ]..        if no
+000020e0: 7420 6773 3a0d 0a20 2020 2020 2020 2020  t gs:..         
+000020f0: 2020 2072 6574 7572 6e20 7673 0d0a 2020     return vs..  
+00002100: 2020 2020 2020 6966 2061 6e79 285b 2765        if any(['e
+00002110: 2720 696e 2067 2066 6f72 2067 2069 6e20  ' in g for g in 
+00002120: 6773 5d29 3a0d 0a20 2020 2020 2020 2020  gs]):..         
+00002130: 2020 206d 6178 6465 6320 3d20 6d61 7828     maxdec = max(
+00002140: 5b6c 656e 2828 6729 2e70 6172 7469 7469  [len((g).partiti
+00002150: 6f6e 2827 2e27 295b 325d 2e70 6172 7469  on('.')[2].parti
+00002160: 7469 6f6e 2827 6527 295b 305d 2920 666f  tion('e')[0]) fo
+00002170: 7220 6720 696e 2067 7320 6966 2027 6527  r g in gs if 'e'
+00002180: 2069 6e20 675d 290d 0a20 2020 2020 2020   in g])..       
+00002190: 2020 2020 2073 656c 662e 6e65 7874 5f66       self.next_f
+000021a0: 6d74 203d 2027 2525 2e25 6965 2720 2520  mt = '%%.%ie' % 
+000021b0: 6d61 7864 6563 0d0a 2020 2020 2020 2020  maxdec..        
+000021c0: 656c 6966 2067 733a 0d0a 2020 2020 2020  elif gs:..      
+000021d0: 2020 2020 2020 6d61 7864 6563 203d 206d        maxdec = m
+000021e0: 6178 285b 6c65 6e28 2867 292e 7061 7274  ax([len((g).part
+000021f0: 6974 696f 6e28 272e 2729 5b32 5d29 2066  ition('.')[2]) f
+00002200: 6f72 2067 2069 6e20 6773 5d29 0d0a 2020  or g in gs])..  
 00002210: 2020 2020 2020 2020 2020 7365 6c66 2e6e            self.n
-00002220: 6578 745f 666d 7420 3d20 2725 6727 0d0a  ext_fmt = '%g'..
-00002230: 2020 2020 2020 2020 7265 7475 726e 2076          return v
-00002240: 730d 0a0d 0a0d 0a0d 0a63 6c61 7373 2059  s........class Y
-00002250: 5363 616c 653a 0d0a 2020 2020 6465 6620  Scale:..    def 
-00002260: 5f5f 696e 6974 5f5f 2873 656c 662c 2073  __init__(self, s
-00002270: 6361 6c65 7479 7065 2c20 7363 616c 6566  caletype, scalef
-00002280: 293a 0d0a 2020 2020 2020 2020 7365 6c66  ):..        self
-00002290: 2e73 6361 6c65 7479 7065 203d 2073 6361  .scaletype = sca
-000022a0: 6c65 7479 7065 0d0a 2020 2020 2020 2020  letype..        
-000022b0: 7365 6c66 2e73 6574 5f73 6361 6c65 2873  self.set_scale(s
-000022c0: 6361 6c65 6629 0d0a 0d0a 2020 2020 6465  calef)....    de
-000022d0: 6620 7365 745f 7363 616c 6528 7365 6c66  f set_scale(self
-000022e0: 2c20 7363 616c 6529 3a0d 0a20 2020 2020  , scale):..     
-000022f0: 2020 2073 656c 662e 7363 616c 6566 203d     self.scalef =
-00002300: 2073 6361 6c65 0d0a 0d0a 2020 2020 6465   scale....    de
-00002310: 6620 7866 6f72 6d28 7365 6c66 2c20 7929  f xform(self, y)
-00002320: 3a0d 0a20 2020 2020 2020 2069 6620 7365  :..        if se
-00002330: 6c66 2e73 6361 6c65 7479 7065 203d 3d20  lf.scaletype == 
-00002340: 276c 6f67 273a 0d0a 2020 2020 2020 2020  'log':..        
-00002350: 2020 2020 7920 3d20 3130 2a2a 790d 0a20      y = 10**y.. 
-00002360: 2020 2020 2020 2079 203d 2079 202a 2073         y = y * s
-00002370: 656c 662e 7363 616c 6566 0d0a 2020 2020  elf.scalef..    
-00002380: 2020 2020 7265 7475 726e 2079 0d0a 0d0a      return y....
-00002390: 2020 2020 6465 6620 696e 7678 666f 726d      def invxform
-000023a0: 2873 656c 662c 2079 2c20 7665 7269 6679  (self, y, verify
-000023b0: 3d46 616c 7365 293a 0d0a 2020 2020 2020  =False):..      
-000023c0: 2020 7920 2f3d 2073 656c 662e 7363 616c    y /= self.scal
-000023d0: 6566 0d0a 2020 2020 2020 2020 6966 2073  ef..        if s
-000023e0: 656c 662e 7363 616c 6574 7970 6520 3d3d  elf.scaletype ==
-000023f0: 2027 6c6f 6727 3a0d 0a20 2020 2020 2020   'log':..       
-00002400: 2020 2020 2069 6620 7665 7269 6679 2061       if verify a
-00002410: 6e64 2079 203c 3d20 303a 0d0a 2020 2020  nd y <= 0:..    
-00002420: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00002430: 726e 202d 3165 3620 2f20 7365 6c66 2e73  rn -1e6 / self.s
-00002440: 6361 6c65 660d 0a20 2020 2020 2020 2020  calef..         
-00002450: 2020 2079 203d 206e 702e 6c6f 6731 3028     y = np.log10(
-00002460: 7929 0d0a 2020 2020 2020 2020 7265 7475  y)..        retu
-00002470: 726e 2079 0d0a 0d0a 0d0a 0d0a 636c 6173  rn y........clas
-00002480: 7320 5061 6e64 6173 4461 7461 536f 7572  s PandasDataSour
-00002490: 6365 3a0d 0a20 2020 2027 2727 4361 6e64  ce:..    '''Cand
-000024a0: 6c65 2073 7469 636b 733a 2063 7265 6174  le sticks: creat
-000024b0: 6520 7769 7468 2066 6976 6520 636f 6c75  e with five colu
-000024c0: 6d6e 733a 2074 696d 652c 206f 7065 6e2c  mns: time, open,
-000024d0: 2063 6c6f 7365 2c20 6869 2c20 6c6f 202d   close, hi, lo -
-000024e0: 2069 6e20 7468 6174 206f 7264 6572 2e0d   in that order..
-000024f0: 0a20 2020 2020 2020 566f 6c75 6d65 2062  .       Volume b
-00002500: 6172 733a 2063 7265 6174 6520 7769 7468  ars: create with
-00002510: 2074 6872 6565 2063 6f6c 756d 6e73 3a20   three columns: 
-00002520: 7469 6d65 2c20 6f70 656e 2c20 636c 6f73  time, open, clos
-00002530: 652c 2076 6f6c 756d 6520 2d20 696e 2074  e, volume - in t
-00002540: 6861 7420 6f72 6465 722e 0d0a 2020 2020  hat order...    
-00002550: 2020 2046 6f72 2061 6c6c 206f 7468 6572     For all other
-00002560: 2074 7970 6573 2c20 7469 6d65 206e 6565   types, time nee
-00002570: 6473 2074 6f20 6265 2066 6972 7374 2c20  ds to be first, 
-00002580: 7573 7561 6c6c 7920 666f 6c6c 6f77 6564  usually followed
-00002590: 2062 7920 6f6e 6520 6f72 206d 6f72 6520   by one or more 
-000025a0: 592d 636f 6c75 6d6e 732e 2727 270d 0a20  Y-columns.'''.. 
-000025b0: 2020 2064 6566 205f 5f69 6e69 745f 5f28     def __init__(
-000025c0: 7365 6c66 2c20 6466 293a 0d0a 2020 2020  self, df):..    
-000025d0: 2020 2020 6966 2074 7970 6528 6466 2e69      if type(df.i
-000025e0: 6e64 6578 2920 3d3d 2070 642e 4461 7465  ndex) == pd.Date
-000025f0: 7469 6d65 496e 6465 7820 6f72 2064 662e  timeIndex or df.
-00002600: 696e 6465 785b 2d31 5d3e 3165 3820 6f72  index[-1]>1e8 or
-00002610: 2027 2e52 616e 6765 496e 6465 7827 206e   '.RangeIndex' n
-00002620: 6f74 2069 6e20 7374 7228 7479 7065 2864  ot in str(type(d
-00002630: 662e 696e 6465 7829 293a 0d0a 2020 2020  f.index)):..    
-00002640: 2020 2020 2020 2020 6466 203d 2064 662e          df = df.
-00002650: 7265 7365 745f 696e 6465 7828 290d 0a20  reset_index().. 
-00002660: 2020 2020 2020 2073 656c 662e 6466 203d         self.df =
-00002670: 2064 662e 636f 7079 2829 0d0a 2020 2020   df.copy()..    
-00002680: 2020 2020 2320 6d61 6e61 6765 2074 696d      # manage tim
-00002690: 6520 636f 6c75 6d6e 0d0a 2020 2020 2020  e column..      
-000026a0: 2020 6966 205f 6861 735f 7469 6d65 636f    if _has_timeco
-000026b0: 6c28 7365 6c66 2e64 6629 3a0d 0a20 2020  l(self.df):..   
-000026c0: 2020 2020 2020 2020 2074 696d 6563 6f6c           timecol
-000026d0: 203d 2073 656c 662e 6466 2e63 6f6c 756d   = self.df.colum
-000026e0: 6e73 5b30 5d0d 0a20 2020 2020 2020 2020  ns[0]..         
-000026f0: 2020 2064 7479 7065 203d 2073 7472 2864     dtype = str(d
-00002700: 665b 7469 6d65 636f 6c5d 2e64 7479 7065  f[timecol].dtype
-00002710: 290d 0a20 2020 2020 2020 2020 2020 2069  )..            i
-00002720: 736e 756d 203d 2028 2769 6e74 2720 696e  snum = ('int' in
-00002730: 2064 7479 7065 206f 7220 2766 6c6f 6174   dtype or 'float
-00002740: 2720 696e 2064 7479 7065 2920 616e 6420  ' in dtype) and 
-00002750: 6466 5b74 696d 6563 6f6c 5d2e 696c 6f63  df[timecol].iloc
-00002760: 5b2d 315d 203c 2031 6537 0d0a 2020 2020  [-1] < 1e7..    
-00002770: 2020 2020 2020 2020 6966 206e 6f74 2069          if not i
-00002780: 736e 756d 3a0d 0a20 2020 2020 2020 2020  snum:..         
-00002790: 2020 2020 2020 2073 656c 662e 6466 5b74         self.df[t
-000027a0: 696d 6563 6f6c 5d20 3d20 5f70 6474 696d  imecol] = _pdtim
-000027b0: 6532 6570 6f63 6828 6466 5b74 696d 6563  e2epoch(df[timec
-000027c0: 6f6c 5d29 0d0a 2020 2020 2020 2020 2020  ol])..          
-000027d0: 2020 7365 6c66 2e73 7461 6e64 616c 6f6e    self.standalon
-000027e0: 6520 3d20 5f69 735f 7374 616e 6461 6c6f  e = _is_standalo
-000027f0: 6e65 2873 656c 662e 6466 5b74 696d 6563  ne(self.df[timec
-00002800: 6f6c 5d29 0d0a 2020 2020 2020 2020 2020  ol])..          
-00002810: 2020 7365 6c66 2e63 6f6c 5f64 6174 615f    self.col_data_
-00002820: 6f66 6673 6574 203d 2031 2023 206e 6f2e  offset = 1 # no.
-00002830: 206f 6620 7072 6563 6565 6469 6e67 2063   of preceeding c
-00002840: 6f6c 756d 6e73 2066 6f72 206f 7468 6572  olumns for other
-00002850: 2070 6c6f 7473 2061 6e64 2074 696d 6520   plots and time 
-00002860: 636f 6c75 6d6e 0d0a 2020 2020 2020 2020  column..        
-00002870: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
-00002880: 2020 2073 656c 662e 7374 616e 6461 6c6f     self.standalo
-00002890: 6e65 203d 2046 616c 7365 0d0a 2020 2020  ne = False..    
-000028a0: 2020 2020 2020 2020 7365 6c66 2e63 6f6c          self.col
-000028b0: 5f64 6174 615f 6f66 6673 6574 203d 2030  _data_offset = 0
-000028c0: 2023 206e 6f2e 206f 6620 7072 6563 6565   # no. of precee
-000028d0: 6469 6e67 2063 6f6c 756d 6e73 2066 6f72  ding columns for
-000028e0: 206f 7468 6572 2070 6c6f 7473 2061 6e64   other plots and
-000028f0: 2074 696d 6520 636f 6c75 6d6e 0d0a 2020   time column..  
-00002900: 2020 2020 2020 2320 7365 7475 7020 6461        # setup da
-00002910: 7461 2066 6f72 206a 6f69 6e69 6e67 2064  ta for joining d
-00002920: 6174 6120 736f 7572 6365 7320 616e 6420  ata sources and 
-00002930: 7a6f 6f6d 696e 670d 0a20 2020 2020 2020  zooming..       
-00002940: 2073 656c 662e 7363 616c 655f 636f 6c73   self.scale_cols
-00002950: 203d 205b 6920 666f 7220 6920 696e 2072   = [i for i in r
-00002960: 616e 6765 2873 656c 662e 636f 6c5f 6461  ange(self.col_da
-00002970: 7461 5f6f 6666 7365 742c 6c65 6e28 7365  ta_offset,len(se
-00002980: 6c66 2e64 662e 636f 6c75 6d6e 7329 2920  lf.df.columns)) 
-00002990: 6966 2073 656c 662e 6466 2e69 6c6f 635b  if self.df.iloc[
-000029a0: 3a2c 695d 2e64 7479 7065 213d 6f62 6a65  :,i].dtype!=obje
-000029b0: 6374 5d0d 0a20 2020 2020 2020 2073 656c  ct]..        sel
-000029c0: 662e 6361 6368 655f 6869 6c6f 203d 204f  f.cache_hilo = O
-000029d0: 7264 6572 6564 4469 6374 2829 0d0a 2020  rderedDict()..  
-000029e0: 2020 2020 2020 7365 6c66 2e72 656e 616d        self.renam
-000029f0: 6573 203d 207b 7d0d 0a20 2020 2020 2020  es = {}..       
-00002a00: 206e 6577 636f 6c73 203d 205b 5d0d 0a20   newcols = [].. 
-00002a10: 2020 2020 2020 2066 6f72 2063 6f6c 2069         for col i
-00002a20: 6e20 7365 6c66 2e64 662e 636f 6c75 6d6e  n self.df.column
-00002a30: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
-00002a40: 6f6c 6463 6f6c 203d 2063 6f6c 0d0a 2020  oldcol = col..  
-00002a50: 2020 2020 2020 2020 2020 7768 696c 6520            while 
-00002a60: 636f 6c20 696e 206e 6577 636f 6c73 3a0d  col in newcols:.
-00002a70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00002a80: 2063 6f6c 203d 2073 7472 2863 6f6c 292b   col = str(col)+
-00002a90: 272b 270d 0a20 2020 2020 2020 2020 2020  '+'..           
-00002aa0: 206e 6577 636f 6c73 2e61 7070 656e 6428   newcols.append(
-00002ab0: 636f 6c29 0d0a 2020 2020 2020 2020 2020  col)..          
-00002ac0: 2020 6966 206f 6c64 636f 6c20 213d 2063    if oldcol != c
-00002ad0: 6f6c 3a0d 0a20 2020 2020 2020 2020 2020  ol:..           
-00002ae0: 2020 2020 2073 656c 662e 7265 6e61 6d65       self.rename
-00002af0: 735b 6f6c 6463 6f6c 5d20 3d20 636f 6c0d  s[oldcol] = col.
-00002b00: 0a20 2020 2020 2020 2073 656c 662e 6466  .        self.df
-00002b10: 2e63 6f6c 756d 6e73 203d 206e 6577 636f  .columns = newco
-00002b20: 6c73 0d0a 2020 2020 2020 2020 7365 6c66  ls..        self
-00002b30: 2e70 7265 5f75 7064 6174 6520 3d20 6c61  .pre_update = la
-00002b40: 6d62 6461 2064 663a 2064 660d 0a20 2020  mbda df: df..   
-00002b50: 2020 2020 2073 656c 662e 706f 7374 5f75       self.post_u
-00002b60: 7064 6174 6520 3d20 6c61 6d62 6461 2064  pdate = lambda d
-00002b70: 663a 2064 660d 0a20 2020 2020 2020 2073  f: df..        s
-00002b80: 656c 662e 5f70 6572 696f 6420 3d20 4e6f  elf._period = No
-00002b90: 6e65 0d0a 2020 2020 2020 2020 7365 6c66  ne..        self
-00002ba0: 2e5f 736d 6f6f 7468 5f74 696d 6520 3d20  ._smooth_time = 
-00002bb0: 4e6f 6e65 0d0a 2020 2020 2020 2020 7365  None..        se
-00002bc0: 6c66 2e69 735f 7370 6172 7365 203d 2073  lf.is_sparse = s
-00002bd0: 656c 662e 6466 5b73 656c 662e 6466 2e63  elf.df[self.df.c
-00002be0: 6f6c 756d 6e73 5b73 656c 662e 636f 6c5f  olumns[self.col_
-00002bf0: 6461 7461 5f6f 6666 7365 745d 5d2e 6973  data_offset]].is
-00002c00: 6e75 6c6c 2829 2e73 756d 2829 2e6d 6178  null().sum().max
-00002c10: 2829 203e 206c 656e 2873 656c 662e 6466  () > len(self.df
-00002c20: 292f 2f32 0d0a 0d0a 2020 2020 4070 726f  )//2....    @pro
-00002c30: 7065 7274 790d 0a20 2020 2064 6566 2070  perty..    def p
-00002c40: 6572 696f 645f 6e73 2873 656c 6629 3a0d  eriod_ns(self):.
-00002c50: 0a20 2020 2020 2020 2069 6620 6c65 6e28  .        if len(
-00002c60: 7365 6c66 2e64 6629 203c 3d20 313a 0d0a  self.df) <= 1:..
-00002c70: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00002c80: 726e 2031 0d0a 2020 2020 2020 2020 6966  rn 1..        if
-00002c90: 206e 6f74 2073 656c 662e 5f70 6572 696f   not self._perio
-00002ca0: 643a 0d0a 2020 2020 2020 2020 2020 2020  d:..            
-00002cb0: 7469 6d65 636f 6c20 3d20 7365 6c66 2e64  timecol = self.d
-00002cc0: 662e 636f 6c75 6d6e 735b 305d 0d0a 2020  f.columns[0]..  
-00002cd0: 2020 2020 2020 2020 2020 7469 6d65 7320            times 
-00002ce0: 3d20 7365 6c66 2e64 665b 7469 6d65 636f  = self.df[timeco
-00002cf0: 6c5d 2e69 6c6f 635b 303a 3130 305d 0d0a  l].iloc[0:100]..
-00002d00: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00002d10: 2e5f 7065 7269 6f64 203d 2069 6e74 2874  ._period = int(t
-00002d20: 696d 6573 2e64 6966 6628 292e 6d65 6469  imes.diff().medi
-00002d30: 616e 2829 2920 6966 206c 656e 2874 696d  an()) if len(tim
-00002d40: 6573 293e 3120 656c 7365 2031 0d0a 2020  es)>1 else 1..  
-00002d50: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-00002d60: 662e 5f70 6572 696f 640d 0a0d 0a20 2020  f._period....   
-00002d70: 2040 7072 6f70 6572 7479 0d0a 2020 2020   @property..    
-00002d80: 6465 6620 696e 6465 7828 7365 6c66 293a  def index(self):
-00002d90: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-00002da0: 2073 656c 662e 6466 2e69 6e64 6578 0d0a   self.df.index..
-00002db0: 0d0a 2020 2020 4070 726f 7065 7274 790d  ..    @property.
-00002dc0: 0a20 2020 2064 6566 2078 2873 656c 6629  .    def x(self)
-00002dd0: 3a0d 0a20 2020 2020 2020 2074 696d 6563  :..        timec
-00002de0: 6f6c 203d 2073 656c 662e 6466 2e63 6f6c  ol = self.df.col
-00002df0: 756d 6e73 5b30 5d0d 0a20 2020 2020 2020  umns[0]..       
-00002e00: 2072 6574 7572 6e20 7365 6c66 2e64 665b   return self.df[
-00002e10: 7469 6d65 636f 6c5d 0d0a 0d0a 2020 2020  timecol]....    
-00002e20: 4070 726f 7065 7274 790d 0a20 2020 2064  @property..    d
-00002e30: 6566 2079 2873 656c 6629 3a0d 0a20 2020  ef y(self):..   
-00002e40: 2020 2020 2063 6f6c 203d 2073 656c 662e       col = self.
-00002e50: 6466 2e63 6f6c 756d 6e73 5b73 656c 662e  df.columns[self.
-00002e60: 636f 6c5f 6461 7461 5f6f 6666 7365 745d  col_data_offset]
-00002e70: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-00002e80: 2073 656c 662e 6466 5b63 6f6c 5d0d 0a0d   self.df[col]...
-00002e90: 0a20 2020 2040 7072 6f70 6572 7479 0d0a  .    @property..
-00002ea0: 2020 2020 6465 6620 7a28 7365 6c66 293a      def z(self):
-00002eb0: 0d0a 2020 2020 2020 2020 636f 6c20 3d20  ..        col = 
-00002ec0: 7365 6c66 2e64 662e 636f 6c75 6d6e 735b  self.df.columns[
-00002ed0: 7365 6c66 2e63 6f6c 5f64 6174 615f 6f66  self.col_data_of
-00002ee0: 6673 6574 2b31 5d0d 0a20 2020 2020 2020  fset+1]..       
-00002ef0: 2072 6574 7572 6e20 7365 6c66 2e64 665b   return self.df[
-00002f00: 636f 6c5d 0d0a 0d0a 2020 2020 4070 726f  col]....    @pro
-00002f10: 7065 7274 790d 0a20 2020 2064 6566 2078  perty..    def x
-00002f20: 6c65 6e28 7365 6c66 293a 0d0a 2020 2020  len(self):..    
-00002f30: 2020 2020 7265 7475 726e 206c 656e 2873      return len(s
-00002f40: 656c 662e 6466 290d 0a0d 0a20 2020 2064  elf.df)....    d
-00002f50: 6566 2063 616c 635f 7369 676e 6966 6963  ef calc_signific
-00002f60: 616e 745f 6465 6369 6d61 6c73 2873 656c  ant_decimals(sel
-00002f70: 662c 2066 756c 6c29 3a0d 0a20 2020 2020  f, full):..     
-00002f80: 2020 2064 6566 2066 6c6f 6174 5f72 6f75     def float_rou
-00002f90: 6e64 2866 293a 0d0a 2020 2020 2020 2020  nd(f):..        
-00002fa0: 2020 2020 7265 7475 726e 2066 6c6f 6174      return float
-00002fb0: 2827 252e 3365 2725 6629 2023 2030 2e30  ('%.3e'%f) # 0.0
-00002fc0: 3039 3939 3734 3820 2d3e 2030 2e30 310d  0999748 -> 0.01.
-00002fd0: 0a20 2020 2020 2020 2064 6566 2072 656d  .        def rem
-00002fe0: 6169 6e64 6572 5f6f 6b28 612c 2062 293a  ainder_ok(a, b):
-00002ff0: 0d0a 2020 2020 2020 2020 2020 2020 6320  ..            c 
-00003000: 3d20 6120 2520 620d 0a20 2020 2020 2020  = a % b..       
-00003010: 2020 2020 2069 6620 6320 2f20 6220 3e20       if c / b > 
-00003020: 302e 3938 3a20 2320 7265 6d61 696e 6465  0.98: # remainde
-00003030: 7220 616c 6d6f 7374 2073 616d 6520 6173  r almost same as
-00003040: 2064 656e 6f6d 696e 6174 6f72 0d0a 2020   denominator..  
-00003050: 2020 2020 2020 2020 2020 2020 2020 6320                c 
-00003060: 3d20 6162 7328 632d 6229 0d0a 2020 2020  = abs(c-b)..    
-00003070: 2020 2020 2020 2020 7265 7475 726e 2063          return c
-00003080: 203c 2062 2a30 2e36 2023 2068 616c 6620   < b*0.6 # half 
-00003090: 6973 2066 696e 650d 0a20 2020 2020 2020  is fine..       
-000030a0: 2064 6566 2063 616c 635f 7364 2873 6572   def calc_sd(ser
-000030b0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-000030c0: 7365 7220 3d20 7365 722e 696c 6f63 5b3a  ser = ser.iloc[:
-000030d0: 3130 3030 5d0d 0a20 2020 2020 2020 2020  1000]..         
-000030e0: 2020 2061 6273 6469 6666 203d 2073 6572     absdiff = ser
-000030f0: 2e64 6966 6628 292e 6162 7328 290d 0a20  .diff().abs().. 
-00003100: 2020 2020 2020 2020 2020 2061 6273 6469             absdi
-00003110: 6666 5b61 6273 6469 6666 3c31 652d 3330  ff[absdiff<1e-30
-00003120: 5d20 3d20 3165 3330 0d0a 2020 2020 2020  ] = 1e30..      
-00003130: 2020 2020 2020 736d 616c 6c65 7374 5f64        smallest_d
-00003140: 6966 6620 3d20 6162 7364 6966 662e 6d69  iff = absdiff.mi
-00003150: 6e28 290d 0a20 2020 2020 2020 2020 2020  n()..           
-00003160: 2069 6620 736d 616c 6c65 7374 5f64 6966   if smallest_dif
-00003170: 6620 3e20 3165 3239 3a20 2320 6a75 7374  f > 1e29: # just
-00003180: 2030 733f 0d0a 2020 2020 2020 2020 2020   0s?..          
-00003190: 2020 2020 2020 7265 7475 726e 2030 0d0a        return 0..
-000031a0: 2020 2020 2020 2020 2020 2020 736d 616c              smal
-000031b0: 6c65 7374 5f64 6966 6620 3d20 666c 6f61  lest_diff = floa
-000031c0: 745f 726f 756e 6428 736d 616c 6c65 7374  t_round(smallest
-000031d0: 5f64 6966 6629 0d0a 2020 2020 2020 2020  _diff)..        
-000031e0: 2020 2020 6162 7373 6572 203d 2073 6572      absser = ser
-000031f0: 2e69 6c6f 635b 3a31 3030 5d2e 6162 7328  .iloc[:100].abs(
-00003200: 290d 0a20 2020 2020 2020 2020 2020 2066  )..            f
-00003210: 6f72 205f 2069 6e20 7261 6e67 6528 3229  or _ in range(2)
-00003220: 3a20 2320 6368 6563 6b20 6966 2077 6520  : # check if we 
-00003230: 6861 7665 2061 2072 656d 6169 6e64 6572  have a remainder
-00003240: 2074 6861 7420 6973 2061 2062 6574 7465   that is a bette
-00003250: 7220 6570 7369 6c6f 6e0d 0a20 2020 2020  r epsilon..     
-00003260: 2020 2020 2020 2020 2020 2072 656d 6169             remai
-00003270: 6e64 6572 203d 205b 666d 6f64 2876 2c73  nder = [fmod(v,s
-00003280: 6d61 6c6c 6573 745f 6469 6666 2920 666f  mallest_diff) fo
-00003290: 7220 7620 696e 2061 6273 7365 725d 0d0a  r v in absser]..
-000032a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000032b0: 7265 6d61 696e 6465 7220 3d20 5b76 2066  remainder = [v f
-000032c0: 6f72 2076 2069 6e20 7265 6d61 696e 6465  or v in remainde
-000032d0: 7220 6966 2076 3e73 6d61 6c6c 6573 745f  r if v>smallest_
-000032e0: 6469 6666 2f32 305d 0d0a 2020 2020 2020  diff/20]..      
-000032f0: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
-00003300: 2072 656d 6169 6e64 6572 3a0d 0a20 2020   remainder:..   
-00003310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003320: 2062 7265 616b 0d0a 2020 2020 2020 2020   break..        
-00003330: 2020 2020 2020 2020 736d 616c 6c65 7374          smallest
-00003340: 5f64 6966 665f 7220 3d20 6d69 6e28 7265  _diff_r = min(re
-00003350: 6d61 696e 6465 7229 0d0a 2020 2020 2020  mainder)..      
-00003360: 2020 2020 2020 2020 2020 6966 2073 6d61            if sma
-00003370: 6c6c 6573 745f 6469 6666 2a30 2e30 3520  llest_diff*0.05 
-00003380: 3c20 736d 616c 6c65 7374 5f64 6966 665f  < smallest_diff_
-00003390: 7220 3c20 736d 616c 6c65 7374 5f64 6966  r < smallest_dif
-000033a0: 6620 2a20 302e 3720 616e 6420 7265 6d61  f * 0.7 and rema
-000033b0: 696e 6465 725f 6f6b 2873 6d61 6c6c 6573  inder_ok(smalles
-000033c0: 745f 6469 6666 2c20 736d 616c 6c65 7374  t_diff, smallest
-000033d0: 5f64 6966 665f 7229 3a0d 0a20 2020 2020  _diff_r):..     
-000033e0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-000033f0: 6d61 6c6c 6573 745f 6469 6666 203d 2073  mallest_diff = s
-00003400: 6d61 6c6c 6573 745f 6469 6666 5f72 0d0a  mallest_diff_r..
-00003410: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003420: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
-00003430: 2020 2020 2020 2020 2020 2062 7265 616b             break
-00003440: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
-00003450: 7475 726e 2073 6d61 6c6c 6573 745f 6469  turn smallest_di
-00003460: 6666 0d0a 2020 2020 2020 2020 6465 6620  ff..        def 
-00003470: 6361 6c63 5f64 6563 2873 6572 2c20 736d  calc_dec(ser, sm
-00003480: 616c 6c65 7374 5f64 6966 6629 3a0d 0a20  allest_diff):.. 
-00003490: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
-000034a0: 7420 6675 6c6c 3a20 2320 6c69 6e65 2070  t full: # line p
-000034b0: 6c6f 7473 2075 7375 616c 6c79 2068 6176  lots usually hav
-000034c0: 6520 6578 7472 656d 6520 7265 736f 6c75  e extreme resolu
-000034d0: 7469 6f6e 0d0a 2020 2020 2020 2020 2020  tion..          
-000034e0: 2020 2020 2020 6162 736d 6178 203d 2073        absmax = s
-000034f0: 6572 2e69 6c6f 635b 3a33 3030 5d2e 6162  er.iloc[:300].ab
-00003500: 7328 292e 6d61 7828 290d 0a20 2020 2020  s().max()..     
-00003510: 2020 2020 2020 2020 2020 2073 203d 2027             s = '
-00003520: 252e 3365 2720 2520 6162 736d 6178 0d0a  %.3e' % absmax..
-00003530: 2020 2020 2020 2020 2020 2020 656c 7365              else
-00003540: 3a20 2320 6361 6e64 6c65 730d 0a20 2020  : # candles..   
-00003550: 2020 2020 2020 2020 2020 2020 2073 203d               s =
-00003560: 2027 252e 3265 2720 2520 736d 616c 6c65   '%.2e' % smalle
-00003570: 7374 5f64 6966 660d 0a20 2020 2020 2020  st_diff..       
-00003580: 2020 2020 2062 6173 652c 5f2c 6578 7020       base,_,exp 
-00003590: 3d20 732e 7061 7274 6974 696f 6e28 2765  = s.partition('e
-000035a0: 2729 0d0a 2020 2020 2020 2020 2020 2020  ')..            
-000035b0: 6261 7365 203d 2062 6173 652e 7273 7472  base = base.rstr
-000035c0: 6970 2827 3027 290d 0a20 2020 2020 2020  ip('0')..       
-000035d0: 2020 2020 2065 7870 203d 202d 696e 7428       exp = -int(
-000035e0: 6578 7029 0d0a 2020 2020 2020 2020 2020  exp)..          
-000035f0: 2020 6d61 785f 6261 7365 5f64 6563 696d    max_base_decim
-00003600: 616c 7320 3d20 6d69 6e28 352c 202d 6578  als = min(5, -ex
-00003610: 702b 3229 2069 6620 6578 7020 3c20 3020  p+2) if exp < 0 
-00003620: 656c 7365 2033 0d0a 2020 2020 2020 2020  else 3..        
-00003630: 2020 2020 6261 7365 5f64 6563 696d 616c      base_decimal
-00003640: 7320 3d20 6d61 7828 302c 206d 696e 286d  s = max(0, min(m
-00003650: 6178 5f62 6173 655f 6465 6369 6d61 6c73  ax_base_decimals
-00003660: 2c20 6c65 6e28 6261 7365 292d 3229 290d  , len(base)-2)).
-00003670: 0a20 2020 2020 2020 2020 2020 2064 6563  .            dec
-00003680: 696d 616c 7320 3d20 6578 7020 2b20 6261  imals = exp + ba
-00003690: 7365 5f64 6563 696d 616c 730d 0a20 2020  se_decimals..   
-000036a0: 2020 2020 2020 2020 2064 6563 696d 616c           decimal
-000036b0: 7320 3d20 6d61 7828 302c 206d 696e 286d  s = max(0, min(m
-000036c0: 6178 5f64 6563 696d 616c 732c 2064 6563  ax_decimals, dec
-000036d0: 696d 616c 7329 290d 0a20 2020 2020 2020  imals))..       
-000036e0: 2020 2020 2069 6620 6e6f 7420 6675 6c6c       if not full
-000036f0: 3a20 2320 6170 706c 7920 6772 6964 2066  : # apply grid f
-00003700: 6f72 206c 696e 6520 706c 6f74 7320 6f6e  or line plots on
-00003710: 6c79 0d0a 2020 2020 2020 2020 2020 2020  ly..            
-00003720: 2020 2020 736d 616c 6c65 7374 5f64 6966      smallest_dif
-00003730: 6620 3d20 6d61 7828 3130 2a2a 282d 6465  f = max(10**(-de
-00003740: 6369 6d61 6c73 292c 2073 6d61 6c6c 6573  cimals), smalles
-00003750: 745f 6469 6666 290d 0a20 2020 2020 2020  t_diff)..       
-00003760: 2020 2020 2072 6574 7572 6e20 6465 6369       return deci
-00003770: 6d61 6c73 2c20 736d 616c 6c65 7374 5f64  mals, smallest_d
-00003780: 6966 660d 0a20 2020 2020 2020 2023 2066  iff..        # f
-00003790: 6972 7374 2063 616c 6375 6c61 7465 2045  irst calculate E
-000037a0: 5053 2066 6f72 2073 6572 6965 7320 3026  PS for series 0&
-000037b0: 312c 2074 6865 6e20 646f 2064 6563 696d  1, then do decim
-000037c0: 616c 730d 0a20 2020 2020 2020 2073 6473  als..        sds
-000037d0: 203d 205b 6361 6c63 5f73 6428 7365 6c66   = [calc_sd(self
-000037e0: 2e79 295d 2023 206d 6967 6874 2062 6520  .y)] # might be 
-000037f0: 616c 6c20 7a65 726f 7320 666f 7220 6261  all zeros for ba
-00003800: 7220 6368 6172 7473 0d0a 2020 2020 2020  r charts..      
-00003810: 2020 6966 206c 656e 2873 656c 662e 7363    if len(self.sc
-00003820: 616c 655f 636f 6c73 2920 3e20 313a 0d0a  ale_cols) > 1:..
-00003830: 2020 2020 2020 2020 2020 2020 7364 732e              sds.
-00003840: 6170 7065 6e64 2863 616c 635f 7364 2873  append(calc_sd(s
-00003850: 656c 662e 7a29 2920 2320 6966 2066 6972  elf.z)) # if fir
-00003860: 7374 2069 7320 6f70 656e 2c20 7468 6973  st is open, this
-00003870: 206d 6967 6874 2062 6520 636c 6f73 650d   might be close.
-00003880: 0a20 2020 2020 2020 2073 6473 203d 205b  .        sds = [
-00003890: 7364 2066 6f72 2073 6420 696e 2073 6473  sd for sd in sds
-000038a0: 2069 6620 7364 3e30 5d0d 0a20 2020 2020   if sd>0]..     
-000038b0: 2020 2062 6967 5f64 6966 6620 3d20 6d61     big_diff = ma
-000038c0: 7828 7364 7329 0d0a 2020 2020 2020 2020  x(sds)..        
-000038d0: 736d 616c 6c65 7374 5f64 6966 6620 3d20  smallest_diff = 
-000038e0: 6d69 6e28 5b73 6420 666f 7220 7364 2069  min([sd for sd i
-000038f0: 6e20 7364 7320 6966 2073 643e 6269 675f  n sds if sd>big_
-00003900: 6469 6666 2f31 3030 5d29 2023 2066 696c  diff/100]) # fil
-00003910: 7465 7220 6f75 7420 6578 7472 656d 656c  ter out extremel
-00003920: 7920 736d 616c 6c20 6570 7369 6c6f 6e73  y small epsilons
-00003930: 0d0a 2020 2020 2020 2020 7365 7220 3d20  ..        ser = 
-00003940: 7365 6c66 2e7a 2069 6620 6c65 6e28 7365  self.z if len(se
-00003950: 6c66 2e73 6361 6c65 5f63 6f6c 7329 203e  lf.scale_cols) >
-00003960: 2031 2065 6c73 6520 7365 6c66 2e79 0d0a   1 else self.y..
-00003970: 2020 2020 2020 2020 7265 7475 726e 2063          return c
-00003980: 616c 635f 6465 6328 7365 722c 2073 6d61  alc_dec(ser, sma
-00003990: 6c6c 6573 745f 6469 6666 290d 0a0d 0a20  llest_diff).... 
-000039a0: 2020 2064 6566 2075 7064 6174 655f 696e     def update_in
-000039b0: 6974 5f78 2873 656c 662c 2069 6e69 745f  it_x(self, init_
-000039c0: 7374 6570 7329 3a0d 0a20 2020 2020 2020  steps):..       
-000039d0: 2073 656c 662e 696e 6974 5f78 302c 2073   self.init_x0, s
-000039e0: 656c 662e 696e 6974 5f78 3120 3d20 5f78  elf.init_x1 = _x
-000039f0: 6d69 6e6d 6178 2873 656c 662c 2078 5f69  minmax(self, x_i
-00003a00: 6e64 6578 6564 3d54 7275 652c 2069 6e69  ndexed=True, ini
-00003a10: 745f 7374 6570 733d 696e 6974 5f73 7465  t_steps=init_ste
-00003a20: 7073 290d 0a0d 0a20 2020 2064 6566 2063  ps)....    def c
-00003a30: 6c6f 7365 7374 5f74 696d 6528 7365 6c66  losest_time(self
-00003a40: 2c20 7829 3a0d 0a20 2020 2020 2020 2074  , x):..        t
-00003a50: 696d 6563 6f6c 203d 2073 656c 662e 6466  imecol = self.df
-00003a60: 2e63 6f6c 756d 6e73 5b30 5d0d 0a20 2020  .columns[0]..   
-00003a70: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-00003a80: 2e64 662e 6c6f 635b 696e 7428 7829 2c20  .df.loc[int(x), 
-00003a90: 7469 6d65 636f 6c5d 0d0a 0d0a 2020 2020  timecol]....    
-00003aa0: 6465 6620 7469 6d65 6261 7365 6428 7365  def timebased(se
-00003ab0: 6c66 293a 0d0a 2020 2020 2020 2020 7265  lf):..        re
-00003ac0: 7475 726e 2073 656c 662e 6466 2e69 6c6f  turn self.df.ilo
-00003ad0: 635b 2d31 2c30 5d20 3e20 3165 370d 0a0d  c[-1,0] > 1e7...
-00003ae0: 0a20 2020 2064 6566 2069 735f 736d 6f6f  .    def is_smoo
-00003af0: 7468 5f74 696d 6528 7365 6c66 293a 0d0a  th_time(self):..
-00003b00: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-00003b10: 5f73 6d6f 6f74 685f 7469 6d65 2069 7320  _smooth_time is 
-00003b20: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
-00003b30: 2020 2023 206c 6573 7320 7468 616e 2031     # less than 1
-00003b40: 2520 7469 6d65 2064 656c 7461 2069 7320  % time delta is 
-00003b50: 736d 6f6f 7468 0d0a 2020 2020 2020 2020  smooth..        
-00003b60: 2020 2020 7365 6c66 2e5f 736d 6f6f 7468      self._smooth
-00003b70: 5f74 696d 6520 3d20 7365 6c66 2e74 696d  _time = self.tim
-00003b80: 6562 6173 6564 2829 2061 6e64 2028 6e70  ebased() and (np
-00003b90: 2e61 6273 286e 702e 6469 6666 2873 656c  .abs(np.diff(sel
-00003ba0: 662e 782e 7661 6c75 6573 5b31 3a31 3030  f.x.values[1:100
-00003bb0: 5d29 5b31 3a5d 2f2f 2873 656c 662e 7065  ])[1:]//(self.pe
-00003bc0: 7269 6f64 5f6e 732f 2f31 3030 3029 2d31  riod_ns//1000)-1
-00003bd0: 3030 3029 203c 2031 3029 2e61 6c6c 2829  000) < 10).all()
-00003be0: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-00003bf0: 2073 656c 662e 5f73 6d6f 6f74 685f 7469   self._smooth_ti
-00003c00: 6d65 0d0a 0d0a 2020 2020 6465 6620 6164  me....    def ad
-00003c10: 6463 6f6c 7328 7365 6c66 2c20 6461 7461  dcols(self, data
-00003c20: 7372 6329 3a0d 0a20 2020 2020 2020 206e  src):..        n
-00003c30: 6577 5f73 6361 6c65 5f63 6f6c 7320 3d20  ew_scale_cols = 
-00003c40: 5b63 2b6c 656e 2873 656c 662e 6466 2e63  [c+len(self.df.c
-00003c50: 6f6c 756d 6e73 292d 6461 7461 7372 632e  olumns)-datasrc.
-00003c60: 636f 6c5f 6461 7461 5f6f 6666 7365 7420  col_data_offset 
-00003c70: 666f 7220 6320 696e 2064 6174 6173 7263  for c in datasrc
-00003c80: 2e73 6361 6c65 5f63 6f6c 735d 0d0a 2020  .scale_cols]..  
-00003c90: 2020 2020 2020 7365 6c66 2e73 6361 6c65        self.scale
-00003ca0: 5f63 6f6c 7320 2b3d 206e 6577 5f73 6361  _cols += new_sca
-00003cb0: 6c65 5f63 6f6c 730d 0a20 2020 2020 2020  le_cols..       
-00003cc0: 206f 7269 675f 636f 6c5f 6461 7461 5f63   orig_col_data_c
-00003cd0: 6e74 203d 206c 656e 2873 656c 662e 6466  nt = len(self.df
-00003ce0: 2e63 6f6c 756d 6e73 290d 0a20 2020 2020  .columns)..     
-00003cf0: 2020 2069 6620 5f68 6173 5f74 696d 6563     if _has_timec
-00003d00: 6f6c 2864 6174 6173 7263 2e64 6629 3a0d  ol(datasrc.df):.
-00003d10: 0a20 2020 2020 2020 2020 2020 2074 696d  .            tim
-00003d20: 6563 6f6c 203d 2073 656c 662e 6466 2e63  ecol = self.df.c
-00003d30: 6f6c 756d 6e73 5b30 5d0d 0a20 2020 2020  olumns[0]..     
-00003d40: 2020 2020 2020 2064 6620 3d20 7365 6c66         df = self
-00003d50: 2e64 662e 7365 745f 696e 6465 7828 7469  .df.set_index(ti
-00003d60: 6d65 636f 6c29 0d0a 2020 2020 2020 2020  mecol)..        
-00003d70: 2020 2020 7469 6d65 636f 6c20 3d20 7469      timecol = ti
-00003d80: 6d65 636f 6c20 6966 2074 696d 6563 6f6c  mecol if timecol
-00003d90: 2069 6e20 6461 7461 7372 632e 6466 2e63   in datasrc.df.c
-00003da0: 6f6c 756d 6e73 2065 6c73 6520 6461 7461  olumns else data
-00003db0: 7372 632e 6466 2e63 6f6c 756d 6e73 5b30  src.df.columns[0
-00003dc0: 5d0d 0a20 2020 2020 2020 2020 2020 206e  ]..            n
-00003dd0: 6577 636f 6c73 203d 2064 6174 6173 7263  ewcols = datasrc
-00003de0: 2e64 662e 7365 745f 696e 6465 7828 7469  .df.set_index(ti
-00003df0: 6d65 636f 6c29 0d0a 2020 2020 2020 2020  mecol)..        
-00003e00: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
-00003e10: 2020 2064 6620 3d20 7365 6c66 2e64 660d     df = self.df.
-00003e20: 0a20 2020 2020 2020 2020 2020 206e 6577  .            new
-00003e30: 636f 6c73 203d 2064 6174 6173 7263 2e64  cols = datasrc.d
-00003e40: 660d 0a20 2020 2020 2020 2063 6f6c 7320  f..        cols 
-00003e50: 3d20 6c69 7374 286e 6577 636f 6c73 2e63  = list(newcols.c
-00003e60: 6f6c 756d 6e73 290d 0a20 2020 2020 2020  olumns)..       
-00003e70: 2066 6f72 2069 2c63 6f6c 2069 6e20 656e   for i,col in en
-00003e80: 756d 6572 6174 6528 636f 6c73 293a 0d0a  umerate(cols):..
-00003e90: 2020 2020 2020 2020 2020 2020 6f6c 645f              old_
-00003ea0: 636f 6c20 3d20 636f 6c0d 0a20 2020 2020  col = col..     
-00003eb0: 2020 2020 2020 2077 6869 6c65 2063 6f6c         while col
-00003ec0: 2069 6e20 7365 6c66 2e64 662e 636f 6c75   in self.df.colu
-00003ed0: 6d6e 733a 0d0a 2020 2020 2020 2020 2020  mns:..          
-00003ee0: 2020 2020 2020 636f 6c73 5b69 5d20 3d20        cols[i] = 
-00003ef0: 636f 6c20 3d20 7374 7228 636f 6c29 2b27  col = str(col)+'
-00003f00: 2b27 0d0a 2020 2020 2020 2020 2020 2020  +'..            
-00003f10: 6966 206f 6c64 5f63 6f6c 2021 3d20 636f  if old_col != co
-00003f20: 6c3a 0d0a 2020 2020 2020 2020 2020 2020  l:..            
-00003f30: 2020 2020 6461 7461 7372 632e 7265 6e61      datasrc.rena
-00003f40: 6d65 735b 6f6c 645f 636f 6c5d 203d 2063  mes[old_col] = c
-00003f50: 6f6c 0d0a 2020 2020 2020 2020 6e65 7763  ol..        newc
-00003f60: 6f6c 732e 636f 6c75 6d6e 7320 3d20 636f  ols.columns = co
-00003f70: 6c73 0d0a 2020 2020 2020 2020 7365 6c66  ls..        self
-00003f80: 2e64 6620 3d20 6466 2e6a 6f69 6e28 6e65  .df = df.join(ne
-00003f90: 7763 6f6c 732c 2068 6f77 3d27 6f75 7465  wcols, how='oute
-00003fa0: 7227 290d 0a20 2020 2020 2020 2069 6620  r')..        if 
-00003fb0: 5f68 6173 5f74 696d 6563 6f6c 2864 6174  _has_timecol(dat
-00003fc0: 6173 7263 2e64 6629 3a0d 0a20 2020 2020  asrc.df):..     
-00003fd0: 2020 2020 2020 2073 656c 662e 6466 2e72         self.df.r
-00003fe0: 6573 6574 5f69 6e64 6578 2869 6e70 6c61  eset_index(inpla
-00003ff0: 6365 3d54 7275 6529 0d0a 2020 2020 2020  ce=True)..      
-00004000: 2020 6461 7461 7372 632e 6466 203d 2073    datasrc.df = s
-00004010: 656c 662e 6466 2023 2074 6865 7920 6172  elf.df # they ar
-00004020: 6520 7468 6520 7361 6d65 206e 6f77 0d0a  e the same now..
-00004030: 2020 2020 2020 2020 6461 7461 7372 632e          datasrc.
-00004040: 696e 6974 5f78 3020 3d20 7365 6c66 2e69  init_x0 = self.i
-00004050: 6e69 745f 7830 0d0a 2020 2020 2020 2020  nit_x0..        
-00004060: 6461 7461 7372 632e 696e 6974 5f78 3120  datasrc.init_x1 
-00004070: 3d20 7365 6c66 2e69 6e69 745f 7831 0d0a  = self.init_x1..
-00004080: 2020 2020 2020 2020 6461 7461 7372 632e          datasrc.
-00004090: 636f 6c5f 6461 7461 5f6f 6666 7365 7420  col_data_offset 
-000040a0: 3d20 6f72 6967 5f63 6f6c 5f64 6174 615f  = orig_col_data_
-000040b0: 636e 740d 0a20 2020 2020 2020 2064 6174  cnt..        dat
-000040c0: 6173 7263 2e73 6361 6c65 5f63 6f6c 7320  asrc.scale_cols 
-000040d0: 3d20 6e65 775f 7363 616c 655f 636f 6c73  = new_scale_cols
-000040e0: 0d0a 2020 2020 2020 2020 7365 6c66 2e63  ..        self.c
-000040f0: 6163 6865 5f68 696c 6f20 3d20 4f72 6465  ache_hilo = Orde
-00004100: 7265 6444 6963 7428 290d 0a20 2020 2020  redDict()..     
-00004110: 2020 2073 656c 662e 5f70 6572 696f 6420     self._period 
-00004120: 3d20 7365 6c66 2e5f 736d 6f6f 7468 5f74  = self._smooth_t
-00004130: 696d 6520 3d20 4e6f 6e65 0d0a 2020 2020  ime = None..    
-00004140: 2020 2020 6461 7461 7372 632e 5f70 6572      datasrc._per
-00004150: 696f 6420 3d20 6461 7461 7372 632e 5f73  iod = datasrc._s
-00004160: 6d6f 6f74 685f 7469 6d65 203d 204e 6f6e  mooth_time = Non
-00004170: 650d 0a20 2020 2020 2020 206c 6466 3220  e..        ldf2 
-00004180: 3d20 6c65 6e28 7365 6c66 2e64 6629 202f  = len(self.df) /
-00004190: 2f20 320d 0a20 2020 2020 2020 2073 656c  / 2..        sel
-000041a0: 662e 6973 5f73 7061 7273 6520 3d20 7365  f.is_sparse = se
-000041b0: 6c66 2e69 735f 7370 6172 7365 206f 7220  lf.is_sparse or 
-000041c0: 7365 6c66 2e64 665b 7365 6c66 2e64 662e  self.df[self.df.
-000041d0: 636f 6c75 6d6e 735b 7365 6c66 2e63 6f6c  columns[self.col
-000041e0: 5f64 6174 615f 6f66 6673 6574 5d5d 2e69  _data_offset]].i
-000041f0: 736e 756c 6c28 292e 7375 6d28 292e 6d61  snull().sum().ma
-00004200: 7828 2920 3e20 6c64 6632 0d0a 2020 2020  x() > ldf2..    
-00004210: 2020 2020 6461 7461 7372 632e 6973 5f73      datasrc.is_s
-00004220: 7061 7273 6520 3d20 6461 7461 7372 632e  parse = datasrc.
-00004230: 6973 5f73 7061 7273 6520 6f72 2064 6174  is_sparse or dat
-00004240: 6173 7263 2e64 665b 6461 7461 7372 632e  asrc.df[datasrc.
-00004250: 6466 2e63 6f6c 756d 6e73 5b64 6174 6173  df.columns[datas
-00004260: 7263 2e63 6f6c 5f64 6174 615f 6f66 6673  rc.col_data_offs
-00004270: 6574 5d5d 2e69 736e 756c 6c28 292e 7375  et]].isnull().su
-00004280: 6d28 292e 6d61 7828 2920 3e20 6c64 6632  m().max() > ldf2
-00004290: 0d0a 0d0a 2020 2020 6465 6620 7570 6461  ....    def upda
-000042a0: 7465 2873 656c 662c 2064 6174 6173 7263  te(self, datasrc
-000042b0: 293a 0d0a 2020 2020 2020 2020 6466 203d  ):..        df =
-000042c0: 2073 656c 662e 7072 655f 7570 6461 7465   self.pre_update
-000042d0: 2873 656c 662e 6466 290d 0a20 2020 2020  (self.df)..     
-000042e0: 2020 206f 7269 675f 636f 6c73 203d 206c     orig_cols = l
-000042f0: 6973 7428 6466 2e63 6f6c 756d 6e73 290d  ist(df.columns).
-00004300: 0a20 2020 2020 2020 2074 696d 6563 6f6c  .        timecol
-00004310: 2c6f 7269 675f 636f 6c73 203d 206f 7269  ,orig_cols = ori
-00004320: 675f 636f 6c73 5b30 5d2c 6f72 6967 5f63  g_cols[0],orig_c
-00004330: 6f6c 735b 313a 5d0d 0a20 2020 2020 2020  ols[1:]..       
-00004340: 2064 6620 3d20 6466 2e73 6574 5f69 6e64   df = df.set_ind
-00004350: 6578 2874 696d 6563 6f6c 290d 0a20 2020  ex(timecol)..   
-00004360: 2020 2020 2069 6e70 7574 5f64 6620 3d20       input_df = 
-00004370: 6461 7461 7372 632e 6466 2e73 6574 5f69  datasrc.df.set_i
-00004380: 6e64 6578 2864 6174 6173 7263 2e64 662e  ndex(datasrc.df.
-00004390: 636f 6c75 6d6e 735b 305d 290d 0a20 2020  columns[0])..   
-000043a0: 2020 2020 2069 6e70 7574 5f64 662e 636f       input_df.co
-000043b0: 6c75 6d6e 7320 3d20 5b73 656c 662e 7265  lumns = [self.re
-000043c0: 6e61 6d65 732e 6765 7428 636f 6c2c 2063  names.get(col, c
-000043d0: 6f6c 2920 666f 7220 636f 6c20 696e 2069  ol) for col in i
-000043e0: 6e70 7574 5f64 662e 636f 6c75 6d6e 735d  nput_df.columns]
-000043f0: 0d0a 2020 2020 2020 2020 2320 7061 6420  ..        # pad 
-00004400: 696e 6465 7820 6966 2074 6865 2069 6e70  index if the inp
-00004410: 7574 2064 6174 6120 6973 2061 2073 7562  ut data is a sub
-00004420: 2d73 6574 0d0a 2020 2020 2020 2020 6f75  -set..        ou
-00004430: 7470 7574 5f64 6620 3d20 7064 2e6d 6572  tput_df = pd.mer
-00004440: 6765 2869 6e70 7574 5f64 662c 2064 665b  ge(input_df, df[
-00004450: 5b5d 5d2c 2068 6f77 3d27 6f75 7465 7227  []], how='outer'
-00004460: 2c20 6c65 6674 5f69 6e64 6578 3d54 7275  , left_index=Tru
-00004470: 652c 2072 6967 6874 5f69 6e64 6578 3d54  e, right_index=T
-00004480: 7275 6529 0d0a 2020 2020 2020 2020 666f  rue)..        fo
-00004490: 7220 636f 6c20 696e 2064 662e 636f 6c75  r col in df.colu
-000044a0: 6d6e 733a 0d0a 2020 2020 2020 2020 2020  mns:..          
-000044b0: 2020 6966 2063 6f6c 206e 6f74 2069 6e20    if col not in 
-000044c0: 6f75 7470 7574 5f64 662e 636f 6c75 6d6e  output_df.column
-000044d0: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
-000044e0: 2020 2020 6f75 7470 7574 5f64 665b 636f      output_df[co
-000044f0: 6c5d 203d 2064 665b 636f 6c5d 0d0a 2020  l] = df[col]..  
-00004500: 2020 2020 2020 2320 6966 206e 6563 6365        # if necce
-00004510: 7373 6172 792c 2063 7574 206f 7574 2075  ssary, cut out u
-00004520: 6e77 616e 7465 6420 6461 7461 0d0a 2020  nwanted data..  
-00004530: 2020 2020 2020 6966 206c 656e 2869 6e70        if len(inp
-00004540: 7574 5f64 6629 203e 2030 2061 6e64 206c  ut_df) > 0 and l
-00004550: 656e 2864 6629 203e 2030 3a0d 0a20 2020  en(df) > 0:..   
-00004560: 2020 2020 2020 2020 2073 7461 7274 5f69           start_i
-00004570: 6478 203d 2065 6e64 5f69 6478 203d 204e  dx = end_idx = N
-00004580: 6f6e 650d 0a20 2020 2020 2020 2020 2020  one..           
-00004590: 2069 6620 696e 7075 745f 6466 2e69 6e64   if input_df.ind
-000045a0: 6578 5b30 5d20 3e20 6466 2e69 6e64 6578  ex[0] > df.index
-000045b0: 5b30 5d3a 0d0a 2020 2020 2020 2020 2020  [0]:..          
-000045c0: 2020 2020 2020 7374 6172 745f 6964 7820        start_idx 
-000045d0: 3d20 300d 0a20 2020 2020 2020 2020 2020  = 0..           
-000045e0: 2069 6620 696e 7075 745f 6466 2e69 6e64   if input_df.ind
-000045f0: 6578 5b2d 315d 203c 2064 662e 696e 6465  ex[-1] < df.inde
-00004600: 785b 2d31 5d3a 0d0a 2020 2020 2020 2020  x[-1]:..        
-00004610: 2020 2020 2020 2020 656e 645f 6964 7820          end_idx 
-00004620: 3d20 2d31 0d0a 2020 2020 2020 2020 2020  = -1..          
-00004630: 2020 6966 2073 7461 7274 5f69 6478 2069    if start_idx i
-00004640: 7320 6e6f 7420 4e6f 6e65 206f 7220 656e  s not None or en
-00004650: 645f 6964 7820 6973 206e 6f74 204e 6f6e  d_idx is not Non
-00004660: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-00004670: 2020 2020 6f75 7470 7574 5f64 6620 3d20      output_df = 
-00004680: 6f75 7470 7574 5f64 662e 6c6f 635b 696e  output_df.loc[in
-00004690: 7075 745f 6466 2e69 6e64 6578 5b73 7461  put_df.index[sta
-000046a0: 7274 5f69 6478 3a65 6e64 5f69 6478 5d2c  rt_idx:end_idx],
-000046b0: 203a 5d0d 0a20 2020 2020 2020 206f 7574   :]..        out
-000046c0: 7075 745f 6466 203d 2073 656c 662e 706f  put_df = self.po
-000046d0: 7374 5f75 7064 6174 6528 6f75 7470 7574  st_update(output
-000046e0: 5f64 6629 0d0a 2020 2020 2020 2020 6f75  _df)..        ou
-000046f0: 7470 7574 5f64 6620 3d20 6f75 7470 7574  tput_df = output
-00004700: 5f64 662e 7265 7365 745f 696e 6465 7828  _df.reset_index(
-00004710: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-00004720: 6466 203d 206f 7574 7075 745f 6466 5b5b  df = output_df[[
-00004730: 6f75 7470 7574 5f64 662e 636f 6c75 6d6e  output_df.column
-00004740: 735b 305d 5d2b 6f72 6967 5f63 6f6c 735d  s[0]]+orig_cols]
-00004750: 2069 6620 6f72 6967 5f63 6f6c 7320 656c   if orig_cols el
-00004760: 7365 206f 7574 7075 745f 6466 0d0a 2020  se output_df..  
-00004770: 2020 2020 2020 7365 6c66 2e69 6e69 745f        self.init_
-00004780: 7831 203d 2073 656c 662e 786c 656e 202b  x1 = self.xlen +
-00004790: 2072 6967 6874 5f6d 6172 6769 6e5f 6361   right_margin_ca
-000047a0: 6e64 6c65 7320 2d20 7369 6465 5f6d 6172  ndles - side_mar
-000047b0: 6769 6e0d 0a20 2020 2020 2020 2073 656c  gin..        sel
-000047c0: 662e 6361 6368 655f 6869 6c6f 203d 204f  f.cache_hilo = O
-000047d0: 7264 6572 6564 4469 6374 2829 0d0a 2020  rderedDict()..  
-000047e0: 2020 2020 2020 7365 6c66 2e5f 7065 7269        self._peri
-000047f0: 6f64 203d 2073 656c 662e 5f73 6d6f 6f74  od = self._smoot
-00004800: 685f 7469 6d65 203d 204e 6f6e 650d 0a0d  h_time = None...
-00004810: 0a20 2020 2064 6566 2073 6574 5f64 6628  .    def set_df(
-00004820: 7365 6c66 2c20 6466 293a 0d0a 2020 2020  self, df):..    
-00004830: 2020 2020 7365 6c66 2e64 6620 3d20 6466      self.df = df
-00004840: 0d0a 2020 2020 2020 2020 7365 6c66 2e63  ..        self.c
-00004850: 6163 6865 5f68 696c 6f20 3d20 4f72 6465  ache_hilo = Orde
-00004860: 7265 6444 6963 7428 290d 0a20 2020 2020  redDict()..     
-00004870: 2020 2073 656c 662e 5f70 6572 696f 6420     self._period 
-00004880: 3d20 7365 6c66 2e5f 736d 6f6f 7468 5f74  = self._smooth_t
-00004890: 696d 6520 3d20 4e6f 6e65 0d0a 0d0a 2020  ime = None....  
-000048a0: 2020 6465 6620 6869 6c6f 2873 656c 662c    def hilo(self,
-000048b0: 2078 302c 2078 3129 3a0d 0a20 2020 2020   x0, x1):..     
-000048c0: 2020 2027 2727 5265 7475 726e 2066 6976     '''Return fiv
-000048d0: 6520 7661 6c75 6573 2069 6e20 7469 6d65  e values in time
-000048e0: 2072 616e 6765 3a20 7430 2c20 7431 2c20   range: t0, t1, 
-000048f0: 6869 6768 6573 742c 206c 6f77 6573 742c  highest, lowest,
-00004900: 206e 756d 6265 7220 6f66 2072 6f77 732e   number of rows.
-00004910: 2727 270d 0a20 2020 2020 2020 2069 6620  '''..        if 
-00004920: 7830 203d 3d20 7831 3a0d 0a20 2020 2020  x0 == x1:..     
-00004930: 2020 2020 2020 2078 3020 3d20 7831 203d         x0 = x1 =
-00004940: 2069 6e74 2878 3129 0d0a 2020 2020 2020   int(x1)..      
-00004950: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
-00004960: 2020 2020 2078 302c 7831 203d 2069 6e74       x0,x1 = int
-00004970: 2878 302b 302e 3529 2c69 6e74 2878 3129  (x0+0.5),int(x1)
-00004980: 0d0a 2020 2020 2020 2020 7175 6572 7920  ..        query 
-00004990: 3d20 2725 692c 2569 2720 2520 2878 302c  = '%i,%i' % (x0,
-000049a0: 7831 290d 0a20 2020 2020 2020 2069 6620  x1)..        if 
-000049b0: 7175 6572 7920 6e6f 7420 696e 2073 656c  query not in sel
-000049c0: 662e 6361 6368 655f 6869 6c6f 3a0d 0a20  f.cache_hilo:.. 
-000049d0: 2020 2020 2020 2020 2020 2076 203d 2073             v = s
-000049e0: 656c 662e 6361 6368 655f 6869 6c6f 5b71  elf.cache_hilo[q
-000049f0: 7565 7279 5d20 3d20 7365 6c66 2e5f 6869  uery] = self._hi
-00004a00: 6c6f 2878 302c 2078 3129 0d0a 2020 2020  lo(x0, x1)..    
-00004a10: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
-00004a20: 2020 2020 2020 2023 2072 652d 696e 7365         # re-inse
-00004a30: 7274 2074 6f20 7261 6973 6520 7072 696f  rt to raise prio
-00004a40: 0d0a 2020 2020 2020 2020 2020 2020 7620  ..            v 
-00004a50: 3d20 7365 6c66 2e63 6163 6865 5f68 696c  = self.cache_hil
-00004a60: 6f5b 7175 6572 795d 203d 2073 656c 662e  o[query] = self.
-00004a70: 6361 6368 655f 6869 6c6f 2e70 6f70 2871  cache_hilo.pop(q
-00004a80: 7565 7279 290d 0a20 2020 2020 2020 2069  uery)..        i
-00004a90: 6620 6c65 6e28 7365 6c66 2e63 6163 6865  f len(self.cache
-00004aa0: 5f68 696c 6f29 203e 2031 3030 3a20 2320  _hilo) > 100: # 
-00004ab0: 6472 6f70 2069 6620 746f 6f20 6d61 6e79  drop if too many
-00004ac0: 0d0a 2020 2020 2020 2020 2020 2020 6465  ..            de
-00004ad0: 6c20 7365 6c66 2e63 6163 6865 5f68 696c  l self.cache_hil
-00004ae0: 6f5b 6e65 7874 2869 7465 7228 7365 6c66  o[next(iter(self
-00004af0: 2e63 6163 6865 5f68 696c 6f29 295d 0d0a  .cache_hilo))]..
-00004b00: 2020 2020 2020 2020 7265 7475 726e 2076          return v
-00004b10: 0d0a 0d0a 2020 2020 6465 6620 5f68 696c  ....    def _hil
-00004b20: 6f28 7365 6c66 2c20 7830 2c20 7831 293a  o(self, x0, x1):
-00004b30: 0d0a 2020 2020 2020 2020 6466 203d 2073  ..        df = s
-00004b40: 656c 662e 6466 2e6c 6f63 5b78 303a 7831  elf.df.loc[x0:x1
-00004b50: 2c20 3a5d 0d0a 2020 2020 2020 2020 6966  , :]..        if
-00004b60: 206e 6f74 206c 656e 2864 6629 3a0d 0a20   not len(df):.. 
-00004b70: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00004b80: 6e20 302c 302c 302c 302c 300d 0a20 2020  n 0,0,0,0,0..   
-00004b90: 2020 2020 2074 696d 6563 6f6c 203d 2064       timecol = d
-00004ba0: 662e 636f 6c75 6d6e 735b 305d 0d0a 2020  f.columns[0]..  
-00004bb0: 2020 2020 2020 7430 203d 2064 665b 7469        t0 = df[ti
-00004bc0: 6d65 636f 6c5d 2e69 6c6f 635b 305d 0d0a  mecol].iloc[0]..
-00004bd0: 2020 2020 2020 2020 7431 203d 2064 665b          t1 = df[
-00004be0: 7469 6d65 636f 6c5d 2e69 6c6f 635b 2d31  timecol].iloc[-1
-00004bf0: 5d0d 0a20 2020 2020 2020 2076 616c 636f  ]..        valco
-00004c00: 6c73 203d 2064 662e 636f 6c75 6d6e 735b  ls = df.columns[
-00004c10: 7365 6c66 2e73 6361 6c65 5f63 6f6c 735d  self.scale_cols]
-00004c20: 0d0a 2020 2020 2020 2020 6869 203d 2064  ..        hi = d
-00004c30: 665b 7661 6c63 6f6c 735d 2e6d 6178 2829  f[valcols].max()
-00004c40: 2e6d 6178 2829 0d0a 2020 2020 2020 2020  .max()..        
-00004c50: 6c6f 203d 2064 665b 7661 6c63 6f6c 735d  lo = df[valcols]
-00004c60: 2e6d 696e 2829 2e6d 696e 2829 0d0a 2020  .min().min()..  
-00004c70: 2020 2020 2020 7265 7475 726e 2074 302c        return t0,
-00004c80: 7431 2c68 692c 6c6f 2c6c 656e 2864 6629  t1,hi,lo,len(df)
-00004c90: 0d0a 0d0a 2020 2020 6465 6620 726f 7773  ....    def rows
-00004ca0: 2873 656c 662c 2063 6f6c 636e 742c 2078  (self, colcnt, x
-00004cb0: 302c 2078 312c 2079 7363 616c 652c 206c  0, x1, yscale, l
-00004cc0: 6f64 3d54 7275 652c 2072 6573 616d 703d  od=True, resamp=
-00004cd0: 4e6f 6e65 293a 0d0a 2020 2020 2020 2020  None):..        
-00004ce0: 6466 203d 2073 656c 662e 6466 2e6c 6f63  df = self.df.loc
-00004cf0: 5b78 303a 7831 2c20 3a5d 0d0a 2020 2020  [x0:x1, :]..    
-00004d00: 2020 2020 6966 2073 656c 662e 6973 5f73      if self.is_s
-00004d10: 7061 7273 653a 0d0a 2020 2020 2020 2020  parse:..        
-00004d20: 2020 2020 6466 203d 2064 662e 6c6f 635b      df = df.loc[
-00004d30: 6466 2e69 6c6f 635b 3a2c 7365 6c66 2e63  df.iloc[:,self.c
-00004d40: 6f6c 5f64 6174 615f 6f66 6673 6574 5d2e  ol_data_offset].
-00004d50: 6e6f 746e 6128 292c 203a 5d0d 0a20 2020  notna(), :]..   
-00004d60: 2020 2020 206f 7269 676c 656e 203d 206c       origlen = l
-00004d70: 656e 2864 6629 0d0a 2020 2020 2020 2020  en(df)..        
-00004d80: 7265 7475 726e 2073 656c 662e 5f72 6f77  return self._row
-00004d90: 7328 6466 2c20 636f 6c63 6e74 2c20 7973  s(df, colcnt, ys
-00004da0: 6361 6c65 3d79 7363 616c 652c 206c 6f64  cale=yscale, lod
-00004db0: 3d6c 6f64 2c20 7265 7361 6d70 3d72 6573  =lod, resamp=res
-00004dc0: 616d 7029 2c20 6f72 6967 6c65 6e0d 0a0d  amp), origlen...
-00004dd0: 0a20 2020 2064 6566 205f 726f 7773 2873  .    def _rows(s
-00004de0: 656c 662c 2064 662c 2063 6f6c 636e 742c  elf, df, colcnt,
-00004df0: 2079 7363 616c 652c 206c 6f64 2c20 7265   yscale, lod, re
-00004e00: 7361 6d70 293a 0d0a 2020 2020 2020 2020  samp):..        
-00004e10: 6966 206c 6f64 2061 6e64 206c 656e 2864  if lod and len(d
-00004e20: 6629 203e 206c 6f64 5f63 616e 646c 6573  f) > lod_candles
-00004e30: 3a0d 0a20 2020 2020 2020 2020 2020 2069  :..            i
-00004e40: 6620 7265 7361 6d70 3a0d 0a20 2020 2020  f resamp:..     
-00004e50: 2020 2020 2020 2020 2020 2064 6620 3d20             df = 
-00004e60: 7365 6c66 2e5f 7265 7361 6d70 6c65 2864  self._resample(d
-00004e70: 662c 2063 6f6c 636e 742c 2072 6573 616d  f, colcnt, resam
-00004e80: 7029 0d0a 2020 2020 2020 2020 2020 2020  p)..            
-00004e90: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
-00004ea0: 2020 2020 2020 2064 6620 3d20 6466 2e69         df = df.i
-00004eb0: 6c6f 635b 3a3a 6c65 6e28 6466 292f 2f6c  loc[::len(df)//l
-00004ec0: 6f64 5f63 616e 646c 6573 5d0d 0a20 2020  od_candles]..   
-00004ed0: 2020 2020 2063 6f6c 636e 7420 2d3d 2031       colcnt -= 1
-00004ee0: 2023 2074 696d 6520 6973 2061 6c77 6179   # time is alway
-00004ef0: 7320 696d 706c 6965 640d 0a20 2020 2020  s implied..     
-00004f00: 2020 2063 6f6c 6964 7873 203d 205b 305d     colidxs = [0]
-00004f10: 202b 206c 6973 7428 7261 6e67 6528 7365   + list(range(se
-00004f20: 6c66 2e63 6f6c 5f64 6174 615f 6f66 6673  lf.col_data_offs
-00004f30: 6574 2c20 7365 6c66 2e63 6f6c 5f64 6174  et, self.col_dat
-00004f40: 615f 6f66 6673 6574 2b63 6f6c 636e 7429  a_offset+colcnt)
-00004f50: 290d 0a20 2020 2020 2020 2064 6672 203d  )..        dfr =
-00004f60: 2064 662e 696c 6f63 5b3a 2c63 6f6c 6964   df.iloc[:,colid
-00004f70: 7873 5d0d 0a20 2020 2020 2020 2069 6620  xs]..        if 
-00004f80: 7973 6361 6c65 2e73 6361 6c65 7479 7065  yscale.scaletype
-00004f90: 203d 3d20 276c 6f67 2720 6f72 2079 7363   == 'log' or ysc
-00004fa0: 616c 652e 7363 616c 6566 2021 3d20 313a  ale.scalef != 1:
-00004fb0: 0d0a 2020 2020 2020 2020 2020 2020 6466  ..            df
-00004fc0: 7220 3d20 6466 722e 636f 7079 2829 0d0a  r = dfr.copy()..
-00004fd0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00004fe0: 6920 696e 2072 616e 6765 2831 2c20 636f  i in range(1, co
-00004ff0: 6c63 6e74 2b31 293a 0d0a 2020 2020 2020  lcnt+1):..      
-00005000: 2020 2020 2020 2020 2020 636f 6c6e 616d            colnam
-00005010: 6520 3d20 6466 722e 636f 6c75 6d6e 735b  e = dfr.columns[
-00005020: 695d 0d0a 2020 2020 2020 2020 2020 2020  i]..            
-00005030: 2020 2020 6966 2064 6672 5b63 6f6c 6e61      if dfr[colna
-00005040: 6d65 5d2e 6474 7970 6520 213d 206f 626a  me].dtype != obj
-00005050: 6563 743a 0d0a 2020 2020 2020 2020 2020  ect:..          
-00005060: 2020 2020 2020 2020 2020 6466 725b 636f            dfr[co
-00005070: 6c6e 616d 655d 203d 2079 7363 616c 652e  lname] = yscale.
-00005080: 696e 7678 666f 726d 2864 6672 2e69 6c6f  invxform(dfr.ilo
-00005090: 635b 3a2c 695d 290d 0a20 2020 2020 2020  c[:,i])..       
-000050a0: 2072 6574 7572 6e20 6466 720d 0a0d 0a20   return dfr.... 
-000050b0: 2020 2064 6566 205f 7265 7361 6d70 6c65     def _resample
-000050c0: 2873 656c 662c 2064 662c 2063 6f6c 636e  (self, df, colcn
-000050d0: 742c 2072 6573 616d 7029 3a0d 0a20 2020  t, resamp):..   
-000050e0: 2020 2020 2063 646f 203d 2073 656c 662e       cdo = self.
-000050f0: 636f 6c5f 6461 7461 5f6f 6666 7365 740d  col_data_offset.
-00005100: 0a20 2020 2020 2020 2073 616d 706c 655f  .        sample_
-00005110: 7261 7465 203d 206c 656e 2864 6629 202a  rate = len(df) *
-00005120: 2035 202f 2f20 6c6f 645f 6361 6e64 6c65   5 // lod_candle
-00005130: 730d 0a20 2020 2020 2020 206f 6666 7365  s..        offse
-00005140: 7420 3d20 6c65 6e28 6466 2920 2520 7361  t = len(df) % sa
-00005150: 6d70 6c65 5f72 6174 650d 0a20 2020 2020  mple_rate..     
-00005160: 2020 2064 6664 203d 2064 665b 5b64 662e     dfd = df[[df.
-00005170: 636f 6c75 6d6e 735b 305d 5d2b 5b64 662e  columns[0]]+[df.
-00005180: 636f 6c75 6d6e 735b 6364 6f5d 5d5d 2e69  columns[cdo]]].i
-00005190: 6c6f 635b 6f66 6673 6574 3a3a 7361 6d70  loc[offset::samp
-000051a0: 6c65 5f72 6174 655d 0d0a 2020 2020 2020  le_rate]..      
-000051b0: 2020 6320 3d20 6466 5b64 662e 636f 6c75    c = df[df.colu
-000051c0: 6d6e 735b 6364 6f2b 315d 5d2e 696c 6f63  mns[cdo+1]].iloc
-000051d0: 5b6f 6666 7365 742b 7361 6d70 6c65 5f72  [offset+sample_r
-000051e0: 6174 652d 313a 3a73 616d 706c 655f 7261  ate-1::sample_ra
-000051f0: 7465 5d0d 0a20 2020 2020 2020 2063 2e69  te]..        c.i
-00005200: 6e64 6578 202d 3d20 7361 6d70 6c65 5f72  ndex -= sample_r
-00005210: 6174 6520 2d20 310d 0a20 2020 2020 2020  ate - 1..       
-00005220: 2064 6664 5b64 662e 636f 6c75 6d6e 735b   dfd[df.columns[
-00005230: 6364 6f2b 315d 5d20 3d20 630d 0a20 2020  cdo+1]] = c..   
-00005240: 2020 2020 2069 6620 7265 7361 6d70 203d       if resamp =
-00005250: 3d20 2768 696c 6f27 3a0d 0a20 2020 2020  = 'hilo':..     
-00005260: 2020 2020 2020 2064 6664 5b64 662e 636f         dfd[df.co
-00005270: 6c75 6d6e 735b 6364 6f2b 325d 5d20 3d20  lumns[cdo+2]] = 
-00005280: 6466 5b64 662e 636f 6c75 6d6e 735b 6364  df[df.columns[cd
-00005290: 6f2b 325d 5d2e 726f 6c6c 696e 6728 7361  o+2]].rolling(sa
-000052a0: 6d70 6c65 5f72 6174 6529 2e6d 6178 2829  mple_rate).max()
-000052b0: 2e73 6869 6674 282d 7361 6d70 6c65 5f72  .shift(-sample_r
-000052c0: 6174 652b 3129 0d0a 2020 2020 2020 2020  ate+1)..        
-000052d0: 2020 2020 6466 645b 6466 2e63 6f6c 756d      dfd[df.colum
-000052e0: 6e73 5b63 646f 2b33 5d5d 203d 2064 665b  ns[cdo+3]] = df[
-000052f0: 6466 2e63 6f6c 756d 6e73 5b63 646f 2b33  df.columns[cdo+3
-00005300: 5d5d 2e72 6f6c 6c69 6e67 2873 616d 706c  ]].rolling(sampl
-00005310: 655f 7261 7465 292e 6d69 6e28 292e 7368  e_rate).min().sh
-00005320: 6966 7428 2d73 616d 706c 655f 7261 7465  ift(-sample_rate
-00005330: 2b31 290d 0a20 2020 2020 2020 2065 6c73  +1)..        els
-00005340: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-00005350: 6466 645b 6466 2e63 6f6c 756d 6e73 5b63  dfd[df.columns[c
-00005360: 646f 2b32 5d5d 203d 2064 665b 6466 2e63  do+2]] = df[df.c
-00005370: 6f6c 756d 6e73 5b63 646f 2b32 5d5d 2e72  olumns[cdo+2]].r
-00005380: 6f6c 6c69 6e67 2873 616d 706c 655f 7261  olling(sample_ra
-00005390: 7465 292e 7375 6d28 292e 7368 6966 7428  te).sum().shift(
-000053a0: 2d73 616d 706c 655f 7261 7465 2b31 290d  -sample_rate+1).
-000053b0: 0a20 2020 2020 2020 2020 2020 2064 6664  .            dfd
-000053c0: 5b64 662e 636f 6c75 6d6e 735b 6364 6f2b  [df.columns[cdo+
-000053d0: 335d 5d20 3d20 6466 5b64 662e 636f 6c75  3]] = df[df.colu
-000053e0: 6d6e 735b 6364 6f2b 335d 5d2e 726f 6c6c  mns[cdo+3]].roll
-000053f0: 696e 6728 7361 6d70 6c65 5f72 6174 6529  ing(sample_rate)
-00005400: 2e73 756d 2829 2e73 6869 6674 282d 7361  .sum().shift(-sa
-00005410: 6d70 6c65 5f72 6174 652b 3129 0d0a 2020  mple_rate+1)..  
-00005420: 2020 2020 2020 2320 6170 7065 6e64 2074        # append t
-00005430: 7261 696c 696e 6720 636f 6c75 6d6e 730d  railing columns.
-00005440: 0a20 2020 2020 2020 2074 7261 696c 696e  .        trailin
-00005450: 675f 636f 6c69 6478 203d 2063 646f 202b  g_colidx = cdo +
-00005460: 2034 0d0a 2020 2020 2020 2020 666f 7220   4..        for 
-00005470: 6920 696e 2072 616e 6765 2874 7261 696c  i in range(trail
-00005480: 696e 675f 636f 6c69 6478 2c20 636f 6c63  ing_colidx, colc
-00005490: 6e74 293a 0d0a 2020 2020 2020 2020 2020  nt):..          
-000054a0: 2020 636f 6c20 3d20 6466 2e63 6f6c 756d    col = df.colum
-000054b0: 6e73 5b69 5d0d 0a20 2020 2020 2020 2020  ns[i]..         
-000054c0: 2020 2064 6664 5b63 6f6c 5d20 3d20 6466     dfd[col] = df
-000054d0: 5b63 6f6c 5d2e 696c 6f63 5b6f 6666 7365  [col].iloc[offse
-000054e0: 743a 3a73 616d 706c 655f 7261 7465 5d0d  t::sample_rate].
-000054f0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00005500: 6466 640d 0a0d 0a20 2020 2064 6566 205f  dfd....    def _
-00005510: 5f65 715f 5f28 7365 6c66 2c20 6f74 6865  _eq__(self, othe
-00005520: 7229 3a0d 0a20 2020 2020 2020 2072 6574  r):..        ret
-00005530: 7572 6e20 6964 2873 656c 6629 203d 3d20  urn id(self) == 
-00005540: 6964 286f 7468 6572 2920 6f72 2069 6428  id(other) or id(
-00005550: 7365 6c66 2e64 6629 203d 3d20 6964 286f  self.df) == id(o
-00005560: 7468 6572 2e64 6629 0d0a 0d0a 2020 2020  ther.df)....    
-00005570: 6465 6620 5f5f 6861 7368 5f5f 2873 656c  def __hash__(sel
-00005580: 6629 3a0d 0a20 2020 2020 2020 2072 6574  f):..        ret
-00005590: 7572 6e20 6964 2873 656c 6629 0d0a 0d0a  urn id(self)....
-000055a0: 0d0a 636c 6173 7320 4669 6e57 696e 646f  ..class FinWindo
-000055b0: 7728 7067 2e47 7261 7068 6963 734c 6179  w(pg.GraphicsLay
-000055c0: 6f75 7457 6964 6765 7429 3a0d 0a20 2020  outWidget):..   
-000055d0: 2064 6566 205f 5f69 6e69 745f 5f28 7365   def __init__(se
-000055e0: 6c66 2c20 7469 746c 652c 202a 2a6b 7761  lf, title, **kwa
-000055f0: 7267 7329 3a0d 0a20 2020 2020 2020 2067  rgs):..        g
-00005600: 6c6f 6261 6c20 7769 6e78 2c20 7769 6e79  lobal winx, winy
-00005610: 0d0a 2020 2020 2020 2020 7365 6c66 2e74  ..        self.t
-00005620: 6974 6c65 203d 2074 6974 6c65 0d0a 2020  itle = title..  
-00005630: 2020 2020 2020 7067 2e6d 6b51 4170 7028        pg.mkQApp(
-00005640: 290d 0a20 2020 2020 2020 2073 7570 6572  )..        super
-00005650: 2829 2e5f 5f69 6e69 745f 5f28 2a2a 6b77  ().__init__(**kw
-00005660: 6172 6773 290d 0a20 2020 2020 2020 2073  args)..        s
-00005670: 656c 662e 7365 7457 696e 646f 7754 6974  elf.setWindowTit
-00005680: 6c65 2874 6974 6c65 290d 0a20 2020 2020  le(title)..     
-00005690: 2020 2073 656c 662e 7365 7447 656f 6d65     self.setGeome
-000056a0: 7472 7928 7769 6e78 2c20 7769 6e79 2c20  try(winx, winy, 
-000056b0: 7769 6e77 2c20 7769 6e68 290d 0a20 2020  winw, winh)..   
-000056c0: 2020 2020 2077 696e 7820 2b3d 2034 300d       winx += 40.
-000056d0: 0a20 2020 2020 2020 2077 696e 7920 2b3d  .        winy +=
-000056e0: 2034 300d 0a20 2020 2020 2020 2073 656c   40..        sel
-000056f0: 662e 6365 6e74 7261 6c57 6964 6765 742e  f.centralWidget.
-00005700: 696e 7374 616c 6c45 7665 6e74 4669 6c74  installEventFilt
-00005710: 6572 2873 656c 6629 0d0a 2020 2020 2020  er(self)..      
-00005720: 2020 7365 6c66 2e63 692e 7365 7443 6f6e    self.ci.setCon
-00005730: 7465 6e74 734d 6172 6769 6e73 2830 2c20  tentsMargins(0, 
-00005740: 302c 2030 2c20 3029 0d0a 2020 2020 2020  0, 0, 0)..      
-00005750: 2020 7365 6c66 2e63 692e 7365 7453 7061    self.ci.setSpa
-00005760: 6369 6e67 282d 3129 0d0a 2020 2020 2020  cing(-1)..      
-00005770: 2020 7365 6c66 2e63 6c6f 7369 6e67 203d    self.closing =
-00005780: 2046 616c 7365 0d0a 0d0a 2020 2020 4070   False....    @p
-00005790: 726f 7065 7274 790d 0a20 2020 2064 6566  roperty..    def
-000057a0: 2061 7873 2873 656c 6629 3a0d 0a20 2020   axs(self):..   
-000057b0: 2020 2020 2072 6574 7572 6e20 5b61 7820       return [ax 
-000057c0: 666f 7220 6178 2069 6e20 7365 6c66 2e63  for ax in self.c
-000057d0: 692e 6974 656d 7320 6966 2069 7369 6e73  i.items if isins
-000057e0: 7461 6e63 6528 6178 2c20 7067 2e50 6c6f  tance(ax, pg.Plo
-000057f0: 7449 7465 6d29 5d0d 0a0d 0a20 2020 2064  tItem)]....    d
-00005800: 6566 2061 7574 6f52 616e 6765 456e 6162  ef autoRangeEnab
-00005810: 6c65 6428 7365 6c66 293a 0d0a 2020 2020  led(self):..    
-00005820: 2020 2020 7265 7475 726e 205b 5472 7565      return [True
-00005830: 2c20 5472 7565 5d0d 0a0d 0a20 2020 2064  , True]....    d
-00005840: 6566 2063 6c6f 7365 2873 656c 6629 3a0d  ef close(self):.
-00005850: 0a20 2020 2020 2020 2073 656c 662e 636c  .        self.cl
-00005860: 6f73 696e 6720 3d20 5472 7565 0d0a 2020  osing = True..  
-00005870: 2020 2020 2020 5f73 6176 6577 696e 6461        _savewinda
-00005880: 7461 2873 656c 6629 0d0a 2020 2020 2020  ta(self)..      
-00005890: 2020 5f63 6c65 6172 5f74 696d 6572 7328    _clear_timers(
-000058a0: 290d 0a20 2020 2020 2020 2072 6574 7572  )..        retur
-000058b0: 6e20 7375 7065 7228 292e 636c 6f73 6528  n super().close(
-000058c0: 290d 0a0d 0a20 2020 2064 6566 2065 7665  )....    def eve
-000058d0: 6e74 4669 6c74 6572 2873 656c 662c 206f  ntFilter(self, o
-000058e0: 626a 2c20 6576 293a 0d0a 2020 2020 2020  bj, ev):..      
-000058f0: 2020 6966 2065 762e 7479 7065 2829 3d3d    if ev.type()==
-00005900: 2051 7443 6f72 652e 5145 7665 6e74 2e54   QtCore.QEvent.T
-00005910: 7970 652e 5769 6e64 6f77 4465 6163 7469  ype.WindowDeacti
-00005920: 7661 7465 3a0d 0a20 2020 2020 2020 2020  vate:..         
-00005930: 2020 205f 7361 7665 7769 6e64 6174 6128     _savewindata(
-00005940: 7365 6c66 290d 0a20 2020 2020 2020 2072  self)..        r
-00005950: 6574 7572 6e20 4661 6c73 650d 0a0d 0a20  eturn False.... 
-00005960: 2020 2064 6566 206c 6561 7665 4576 656e     def leaveEven
-00005970: 7428 7365 6c66 2c20 6576 293a 0d0a 2020  t(self, ev):..  
-00005980: 2020 2020 2020 6966 206e 6f74 2073 656c        if not sel
-00005990: 662e 636c 6f73 696e 673a 0d0a 2020 2020  f.closing:..    
-000059a0: 2020 2020 2020 2020 7375 7065 7228 292e          super().
-000059b0: 6c65 6176 6545 7665 6e74 2865 7629 0d0a  leaveEvent(ev)..
-000059c0: 0d0a 0d0a 636c 6173 7320 4669 6e43 726f  ....class FinCro
-000059d0: 7373 4861 6972 3a0d 0a20 2020 2064 6566  ssHair:..    def
-000059e0: 205f 5f69 6e69 745f 5f28 7365 6c66 2c20   __init__(self, 
-000059f0: 6178 2c20 636f 6c6f 7229 3a0d 0a20 2020  ax, color):..   
-00005a00: 2020 2020 2073 656c 662e 6178 203d 2061       self.ax = a
-00005a10: 780d 0a20 2020 2020 2020 2073 656c 662e  x..        self.
-00005a20: 7820 3d20 300d 0a20 2020 2020 2020 2073  x = 0..        s
-00005a30: 656c 662e 7920 3d20 300d 0a20 2020 2020  elf.y = 0..     
-00005a40: 2020 2073 656c 662e 636c 616d 705f 7820     self.clamp_x 
-00005a50: 3d20 300d 0a20 2020 2020 2020 2073 656c  = 0..        sel
-00005a60: 662e 636c 616d 705f 7920 3d20 300d 0a20  f.clamp_y = 0.. 
-00005a70: 2020 2020 2020 2073 656c 662e 696e 666f         self.info
-00005a80: 7320 3d20 5b5d 0d0a 2020 2020 2020 2020  s = []..        
-00005a90: 7065 6e20 3d20 7067 2e6d 6b50 656e 2863  pen = pg.mkPen(c
-00005aa0: 6f6c 6f72 3d63 6f6c 6f72 2c20 7374 796c  olor=color, styl
-00005ab0: 653d 5174 436f 7265 2e51 742e 5065 6e53  e=QtCore.Qt.PenS
-00005ac0: 7479 6c65 2e43 7573 746f 6d44 6173 684c  tyle.CustomDashL
-00005ad0: 696e 652c 2064 6173 683d 5b37 2c20 375d  ine, dash=[7, 7]
-00005ae0: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-00005af0: 766c 696e 6520 3d20 7067 2e49 6e66 696e  vline = pg.Infin
-00005b00: 6974 654c 696e 6528 616e 676c 653d 3930  iteLine(angle=90
-00005b10: 2c20 6d6f 7661 626c 653d 4661 6c73 652c  , movable=False,
-00005b20: 2070 656e 3d70 656e 290d 0a20 2020 2020   pen=pen)..     
-00005b30: 2020 2073 656c 662e 686c 696e 6520 3d20     self.hline = 
-00005b40: 7067 2e49 6e66 696e 6974 654c 696e 6528  pg.InfiniteLine(
-00005b50: 616e 676c 653d 302c 206d 6f76 6162 6c65  angle=0, movable
-00005b60: 3d46 616c 7365 2c20 7065 6e3d 7065 6e29  =False, pen=pen)
-00005b70: 0d0a 2020 2020 2020 2020 7365 6c66 2e78  ..        self.x
-00005b80: 7465 7874 203d 2070 672e 5465 7874 4974  text = pg.TextIt
-00005b90: 656d 2863 6f6c 6f72 3d63 6f6c 6f72 2c20  em(color=color, 
-00005ba0: 616e 6368 6f72 3d28 302c 3129 290d 0a20  anchor=(0,1)).. 
-00005bb0: 2020 2020 2020 2073 656c 662e 7974 6578         self.ytex
-00005bc0: 7420 3d20 7067 2e54 6578 7449 7465 6d28  t = pg.TextItem(
-00005bd0: 636f 6c6f 723d 636f 6c6f 722c 2061 6e63  color=color, anc
-00005be0: 686f 723d 2830 2c30 2929 0d0a 2020 2020  hor=(0,0))..    
-00005bf0: 2020 2020 7365 6c66 2e76 6c69 6e65 2e73      self.vline.s
-00005c00: 6574 5a56 616c 7565 2835 3029 0d0a 2020  etZValue(50)..  
-00005c10: 2020 2020 2020 7365 6c66 2e68 6c69 6e65        self.hline
-00005c20: 2e73 6574 5a56 616c 7565 2835 3029 0d0a  .setZValue(50)..
-00005c30: 2020 2020 2020 2020 7365 6c66 2e78 7465          self.xte
-00005c40: 7874 2e73 6574 5a56 616c 7565 2835 3029  xt.setZValue(50)
-00005c50: 0d0a 2020 2020 2020 2020 7365 6c66 2e79  ..        self.y
-00005c60: 7465 7874 2e73 6574 5a56 616c 7565 2835  text.setZValue(5
-00005c70: 3029 0d0a 2020 2020 2020 2020 7365 6c66  0)..        self
-00005c80: 2e73 686f 7728 290d 0a0d 0a20 2020 2064  .show()....    d
-00005c90: 6566 2075 7064 6174 6528 7365 6c66 2c20  ef update(self, 
-00005ca0: 706f 696e 743d 4e6f 6e65 293a 0d0a 2020  point=None):..  
-00005cb0: 2020 2020 2020 6966 2070 6f69 6e74 2069        if point i
-00005cc0: 7320 6e6f 7420 4e6f 6e65 3a0d 0a20 2020  s not None:..   
-00005cd0: 2020 2020 2020 2020 2073 656c 662e 782c           self.x,
-00005ce0: 7365 6c66 2e79 203d 2078 2c79 203d 2070  self.y = x,y = p
-00005cf0: 6f69 6e74 2e78 2829 2c70 6f69 6e74 2e79  oint.x(),point.y
-00005d00: 2829 0d0a 2020 2020 2020 2020 656c 7365  ()..        else
-00005d10: 3a0d 0a20 2020 2020 2020 2020 2020 2078  :..            x
-00005d20: 2c79 203d 2073 656c 662e 782c 7365 6c66  ,y = self.x,self
-00005d30: 2e79 0d0a 2020 2020 2020 2020 782c 7920  .y..        x,y 
-00005d40: 3d20 5f63 6c61 6d70 5f78 7928 7365 6c66  = _clamp_xy(self
-00005d50: 2e61 782c 2078 2c79 290d 0a20 2020 2020  .ax, x,y)..     
-00005d60: 2020 2069 6620 7820 3d3d 2073 656c 662e     if x == self.
-00005d70: 636c 616d 705f 7820 616e 6420 7920 3d3d  clamp_x and y ==
-00005d80: 2073 656c 662e 636c 616d 705f 793a 0d0a   self.clamp_y:..
-00005d90: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00005da0: 726e 0d0a 2020 2020 2020 2020 7365 6c66  rn..        self
-00005db0: 2e63 6c61 6d70 5f78 2c73 656c 662e 636c  .clamp_x,self.cl
-00005dc0: 616d 705f 7920 3d20 782c 790d 0a20 2020  amp_y = x,y..   
-00005dd0: 2020 2020 2073 656c 662e 766c 696e 652e       self.vline.
-00005de0: 7365 7450 6f73 2878 290d 0a20 2020 2020  setPos(x)..     
-00005df0: 2020 2073 656c 662e 686c 696e 652e 7365     self.hline.se
-00005e00: 7450 6f73 2879 290d 0a20 2020 2020 2020  tPos(y)..       
-00005e10: 2073 656c 662e 7874 6578 742e 7365 7450   self.xtext.setP
-00005e20: 6f73 2878 2c20 7929 0d0a 2020 2020 2020  os(x, y)..      
-00005e30: 2020 7365 6c66 2e79 7465 7874 2e73 6574    self.ytext.set
-00005e40: 506f 7328 782c 2079 290d 0a20 2020 2020  Pos(x, y)..     
-00005e50: 2020 2072 6e67 203d 2073 656c 662e 6178     rng = self.ax
-00005e60: 2e76 622e 795f 6d61 7820 2d20 7365 6c66  .vb.y_max - self
-00005e70: 2e61 782e 7662 2e79 5f6d 696e 0d0a 2020  .ax.vb.y_min..  
-00005e80: 2020 2020 2020 726e 676d 6178 203d 2061        rngmax = a
-00005e90: 6273 2873 656c 662e 6178 2e76 622e 795f  bs(self.ax.vb.y_
-00005ea0: 6d69 6e29 202b 2072 6e67 2023 2061 6e79  min) + rng # any
-00005eb0: 2061 7070 726f 7869 6d61 7469 6f6e 2069   approximation i
-00005ec0: 7320 6669 6e65 0d0a 2020 2020 2020 2020  s fine..        
-00005ed0: 7364 2c73 6520 3d20 2873 656c 662e 6178  sd,se = (self.ax
-00005ee0: 2e73 6967 6e69 6669 6361 6e74 5f64 6563  .significant_dec
-00005ef0: 696d 616c 732c 7365 6c66 2e61 782e 7369  imals,self.ax.si
-00005f00: 676e 6966 6963 616e 745f 6570 7329 2069  gnificant_eps) i
-00005f10: 6620 636c 616d 705f 6772 6964 2065 6c73  f clamp_grid els
-00005f20: 6520 2873 6967 6e69 6669 6361 6e74 5f64  e (significant_d
-00005f30: 6563 696d 616c 732c 7369 676e 6966 6963  ecimals,signific
-00005f40: 616e 745f 6570 7329 0d0a 2020 2020 2020  ant_eps)..      
-00005f50: 2020 7469 6d65 6261 7365 6420 3d20 4661    timebased = Fa
-00005f60: 6c73 650d 0a20 2020 2020 2020 2069 6620  lse..        if 
-00005f70: 7365 6c66 2e61 782e 7662 2e78 5f69 6e64  self.ax.vb.x_ind
-00005f80: 6578 6564 3a0d 0a20 2020 2020 2020 2020  exed:..         
-00005f90: 2020 2078 7465 7874 2c74 696d 6562 6173     xtext,timebas
-00005fa0: 6564 203d 205f 7832 6c6f 6361 6c5f 7428  ed = _x2local_t(
-00005fb0: 7365 6c66 2e61 782e 7662 2e64 6174 6173  self.ax.vb.datas
-00005fc0: 7263 2c20 7829 0d0a 2020 2020 2020 2020  rc, x)..        
-00005fd0: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
-00005fe0: 2020 2078 7465 7874 203d 205f 726f 756e     xtext = _roun
-00005ff0: 645f 746f 5f73 6967 6e69 6669 6361 6e74  d_to_significant
-00006000: 2872 6e67 2c20 726e 676d 6178 2c20 782c  (rng, rngmax, x,
-00006010: 2073 642c 2073 6529 0d0a 2020 2020 2020   sd, se)..      
-00006020: 2020 6c69 6e65 6172 5f79 203d 2079 0d0a    linear_y = y..
-00006030: 2020 2020 2020 2020 7920 3d20 7365 6c66          y = self
-00006040: 2e61 782e 7662 2e79 7363 616c 652e 7866  .ax.vb.yscale.xf
-00006050: 6f72 6d28 7929 0d0a 2020 2020 2020 2020  orm(y)..        
-00006060: 7974 6578 7420 3d20 5f72 6f75 6e64 5f74  ytext = _round_t
-00006070: 6f5f 7369 676e 6966 6963 616e 7428 726e  o_significant(rn
-00006080: 672c 2072 6e67 6d61 782c 2079 2c20 7364  g, rngmax, y, sd
-00006090: 2c20 7365 290d 0a20 2020 2020 2020 2069  , se)..        i
-000060a0: 6620 6e6f 7420 7469 6d65 6261 7365 643a  f not timebased:
-000060b0: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-000060c0: 2078 7465 7874 3a0d 0a20 2020 2020 2020   xtext:..       
-000060d0: 2020 2020 2020 2020 2078 7465 7874 203d           xtext =
-000060e0: 2027 7820 2720 2b20 7874 6578 740d 0a20   'x ' + xtext.. 
-000060f0: 2020 2020 2020 2020 2020 2079 7465 7874             ytext
-00006100: 203d 2027 7920 2720 2b20 7974 6578 740d   = 'y ' + ytext.
-00006110: 0a20 2020 2020 2020 2066 6172 5f72 6967  .        far_rig
-00006120: 6874 203d 2073 656c 662e 6178 2e76 6965  ht = self.ax.vie
-00006130: 7752 6563 7428 292e 7828 2920 2b20 7365  wRect().x() + se
-00006140: 6c66 2e61 782e 7669 6577 5265 6374 2829  lf.ax.viewRect()
-00006150: 2e77 6964 7468 2829 2a30 2e39 0d0a 2020  .width()*0.9..  
-00006160: 2020 2020 2020 6661 725f 626f 7474 6f6d        far_bottom
-00006170: 203d 2073 656c 662e 6178 2e76 6965 7752   = self.ax.viewR
-00006180: 6563 7428 292e 7928 2920 2b20 7365 6c66  ect().y() + self
-00006190: 2e61 782e 7669 6577 5265 6374 2829 2e68  .ax.viewRect().h
-000061a0: 6569 6768 7428 292a 302e 310d 0a20 2020  eight()*0.1..   
-000061b0: 2020 2020 2063 6c6f 7365 3272 6967 6874       close2right
-000061c0: 203d 2078 203e 2066 6172 5f72 6967 6874   = x > far_right
-000061d0: 0d0a 2020 2020 2020 2020 636c 6f73 6532  ..        close2
-000061e0: 626f 7474 6f6d 203d 206c 696e 6561 725f  bottom = linear_
-000061f0: 7920 3c20 6661 725f 626f 7474 6f6d 0d0a  y < far_bottom..
-00006200: 2020 2020 2020 2020 7472 793a 0d0a 2020          try:..  
-00006210: 2020 2020 2020 2020 2020 666f 7220 696e            for in
-00006220: 666f 2069 6e20 7365 6c66 2e69 6e66 6f73  fo in self.infos
-00006230: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00006240: 2020 2078 7465 7874 2c79 7465 7874 203d     xtext,ytext =
-00006250: 2069 6e66 6f28 782c 792c 7874 6578 742c   info(x,y,xtext,
-00006260: 7974 6578 7429 0d0a 2020 2020 2020 2020  ytext)..        
-00006270: 6578 6365 7074 2045 7863 6570 7469 6f6e  except Exception
-00006280: 2061 7320 653a 0d0a 2020 2020 2020 2020   as e:..        
-00006290: 2020 2020 7072 696e 7428 2743 726f 7373      print('Cross
-000062a0: 6861 6972 2065 7272 6f72 3a27 2c20 7479  hair error:', ty
-000062b0: 7065 2865 292c 2065 290d 0a20 2020 2020  pe(e), e)..     
-000062c0: 2020 2073 7061 6365 203d 2027 2020 2020     space = '    
-000062d0: 2020 270d 0a20 2020 2020 2020 2069 6620    '..        if 
-000062e0: 636c 6f73 6532 7269 6768 743a 0d0a 2020  close2right:..  
-000062f0: 2020 2020 2020 2020 2020 7874 6578 7420            xtext 
-00006300: 3d20 7874 6578 7420 2b20 7370 6163 650d  = xtext + space.
-00006310: 0a20 2020 2020 2020 2020 2020 2079 7465  .            yte
-00006320: 7874 203d 2079 7465 7874 202b 2073 7061  xt = ytext + spa
-00006330: 6365 0d0a 2020 2020 2020 2020 2020 2020  ce..            
-00006340: 7861 6e63 686f 7220 3d20 5b31 2c31 5d0d  xanchor = [1,1].
-00006350: 0a20 2020 2020 2020 2020 2020 2079 616e  .            yan
-00006360: 6368 6f72 203d 205b 312c 305d 0d0a 2020  chor = [1,0]..  
-00006370: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
-00006380: 2020 2020 2020 2020 2078 7465 7874 203d           xtext =
-00006390: 2073 7061 6365 202b 2078 7465 7874 0d0a   space + xtext..
-000063a0: 2020 2020 2020 2020 2020 2020 7974 6578              ytex
-000063b0: 7420 3d20 7370 6163 6520 2b20 7974 6578  t = space + ytex
-000063c0: 740d 0a20 2020 2020 2020 2020 2020 2078  t..            x
-000063d0: 616e 6368 6f72 203d 205b 302c 315d 0d0a  anchor = [0,1]..
-000063e0: 2020 2020 2020 2020 2020 2020 7961 6e63              yanc
-000063f0: 686f 7220 3d20 5b30 2c30 5d0d 0a20 2020  hor = [0,0]..   
-00006400: 2020 2020 2069 6620 636c 6f73 6532 626f       if close2bo
-00006410: 7474 6f6d 3a0d 0a20 2020 2020 2020 2020  ttom:..         
-00006420: 2020 2079 7465 7874 203d 2079 7465 7874     ytext = ytext
-00006430: 202b 2073 7061 6365 0d0a 2020 2020 2020   + space..      
-00006440: 2020 2020 2020 7961 6e63 686f 7220 3d20        yanchor = 
-00006450: 5b31 2c31 5d0d 0a20 2020 2020 2020 2020  [1,1]..         
-00006460: 2020 2069 6620 636c 6f73 6532 7269 6768     if close2righ
-00006470: 743a 0d0a 2020 2020 2020 2020 2020 2020  t:..            
-00006480: 2020 2020 7861 6e63 686f 7220 3d20 5b31      xanchor = [1
-00006490: 2c32 5d0d 0a20 2020 2020 2020 2073 656c  ,2]..        sel
-000064a0: 662e 7874 6578 742e 7365 7441 6e63 686f  f.xtext.setAncho
-000064b0: 7228 7861 6e63 686f 7229 0d0a 2020 2020  r(xanchor)..    
-000064c0: 2020 2020 7365 6c66 2e79 7465 7874 2e73      self.ytext.s
-000064d0: 6574 416e 6368 6f72 2879 616e 6368 6f72  etAnchor(yanchor
-000064e0: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-000064f0: 7874 6578 742e 7365 7454 6578 7428 7874  xtext.setText(xt
-00006500: 6578 7429 0d0a 2020 2020 2020 2020 7365  ext)..        se
-00006510: 6c66 2e79 7465 7874 2e73 6574 5465 7874  lf.ytext.setText
-00006520: 2879 7465 7874 290d 0a0d 0a20 2020 2064  (ytext)....    d
-00006530: 6566 2073 686f 7728 7365 6c66 293a 0d0a  ef show(self):..
-00006540: 2020 2020 2020 2020 7365 6c66 2e61 782e          self.ax.
-00006550: 6164 6449 7465 6d28 7365 6c66 2e76 6c69  addItem(self.vli
-00006560: 6e65 2c20 6967 6e6f 7265 426f 756e 6473  ne, ignoreBounds
-00006570: 3d54 7275 6529 0d0a 2020 2020 2020 2020  =True)..        
-00006580: 7365 6c66 2e61 782e 6164 6449 7465 6d28  self.ax.addItem(
-00006590: 7365 6c66 2e68 6c69 6e65 2c20 6967 6e6f  self.hline, igno
-000065a0: 7265 426f 756e 6473 3d54 7275 6529 0d0a  reBounds=True)..
-000065b0: 2020 2020 2020 2020 7365 6c66 2e61 782e          self.ax.
-000065c0: 6164 6449 7465 6d28 7365 6c66 2e78 7465  addItem(self.xte
-000065d0: 7874 2c20 6967 6e6f 7265 426f 756e 6473  xt, ignoreBounds
-000065e0: 3d54 7275 6529 0d0a 2020 2020 2020 2020  =True)..        
-000065f0: 7365 6c66 2e61 782e 6164 6449 7465 6d28  self.ax.addItem(
-00006600: 7365 6c66 2e79 7465 7874 2c20 6967 6e6f  self.ytext, igno
-00006610: 7265 426f 756e 6473 3d54 7275 6529 0d0a  reBounds=True)..
-00006620: 0d0a 2020 2020 6465 6620 6869 6465 2873  ..    def hide(s
-00006630: 656c 6629 3a0d 0a20 2020 2020 2020 2073  elf):..        s
-00006640: 656c 662e 6178 2e72 656d 6f76 6549 7465  elf.ax.removeIte
-00006650: 6d28 7365 6c66 2e78 7465 7874 290d 0a20  m(self.xtext).. 
-00006660: 2020 2020 2020 2073 656c 662e 6178 2e72         self.ax.r
-00006670: 656d 6f76 6549 7465 6d28 7365 6c66 2e79  emoveItem(self.y
-00006680: 7465 7874 290d 0a20 2020 2020 2020 2073  text)..        s
-00006690: 656c 662e 6178 2e72 656d 6f76 6549 7465  elf.ax.removeIte
-000066a0: 6d28 7365 6c66 2e76 6c69 6e65 290d 0a20  m(self.vline).. 
-000066b0: 2020 2020 2020 2073 656c 662e 6178 2e72         self.ax.r
-000066c0: 656d 6f76 6549 7465 6d28 7365 6c66 2e68  emoveItem(self.h
-000066d0: 6c69 6e65 290d 0a0d 0a0d 0a0d 0a63 6c61  line)........cla
-000066e0: 7373 2046 696e 4c65 6765 6e64 4974 656d  ss FinLegendItem
-000066f0: 2870 672e 4c65 6765 6e64 4974 656d 293a  (pg.LegendItem):
-00006700: 0d0a 2020 2020 6465 6620 5f5f 696e 6974  ..    def __init
-00006710: 5f5f 2873 656c 662c 2062 6f72 6465 725f  __(self, border_
-00006720: 636f 6c6f 722c 2066 696c 6c5f 636f 6c6f  color, fill_colo
-00006730: 722c 202a 2a6b 7761 7267 7329 3a0d 0a20  r, **kwargs):.. 
-00006740: 2020 2020 2020 2073 7570 6572 2829 2e5f         super()._
-00006750: 5f69 6e69 745f 5f28 2a2a 6b77 6172 6773  _init__(**kwargs
-00006760: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-00006770: 6c61 796f 7574 2e73 6574 5665 7274 6963  layout.setVertic
-00006780: 616c 5370 6163 696e 6728 3229 0d0a 2020  alSpacing(2)..  
-00006790: 2020 2020 2020 7365 6c66 2e6c 6179 6f75        self.layou
-000067a0: 742e 7365 7448 6f72 697a 6f6e 7461 6c53  t.setHorizontalS
-000067b0: 7061 6369 6e67 2832 3029 0d0a 2020 2020  pacing(20)..    
-000067c0: 2020 2020 7365 6c66 2e6c 6179 6f75 742e      self.layout.
-000067d0: 7365 7443 6f6e 7465 6e74 734d 6172 6769  setContentsMargi
-000067e0: 6e73 2832 2c20 322c 2031 302c 2032 290d  ns(2, 2, 10, 2).
-000067f0: 0a20 2020 2020 2020 2073 656c 662e 626f  .        self.bo
-00006800: 7264 6572 5f63 6f6c 6f72 203d 2062 6f72  rder_color = bor
-00006810: 6465 725f 636f 6c6f 720d 0a20 2020 2020  der_color..     
-00006820: 2020 2073 656c 662e 6669 6c6c 5f63 6f6c     self.fill_col
-00006830: 6f72 203d 2066 696c 6c5f 636f 6c6f 720d  or = fill_color.
-00006840: 0a0d 0a20 2020 2064 6566 2070 6169 6e74  ...    def paint
-00006850: 2873 656c 662c 2070 2c20 2a61 7267 7329  (self, p, *args)
-00006860: 3a0d 0a20 2020 2020 2020 2070 2e73 6574  :..        p.set
-00006870: 5065 6e28 7067 2e6d 6b50 656e 2873 656c  Pen(pg.mkPen(sel
-00006880: 662e 626f 7264 6572 5f63 6f6c 6f72 2929  f.border_color))
-00006890: 0d0a 2020 2020 2020 2020 702e 7365 7442  ..        p.setB
-000068a0: 7275 7368 2870 672e 6d6b 4272 7573 6828  rush(pg.mkBrush(
-000068b0: 7365 6c66 2e66 696c 6c5f 636f 6c6f 7229  self.fill_color)
-000068c0: 290d 0a20 2020 2020 2020 2070 2e64 7261  )..        p.dra
-000068d0: 7752 6563 7428 7365 6c66 2e62 6f75 6e64  wRect(self.bound
-000068e0: 696e 6752 6563 7428 2929 0d0a 0d0a 0d0a  ingRect())......
-000068f0: 0d0a 636c 6173 7320 4669 6e50 6f6c 794c  ..class FinPolyL
-00006900: 696e 6528 7067 2e50 6f6c 794c 696e 6552  ine(pg.PolyLineR
-00006910: 4f49 293a 0d0a 2020 2020 6465 6620 5f5f  OI):..    def __
-00006920: 696e 6974 5f5f 2873 656c 662c 2076 622c  init__(self, vb,
-00006930: 202a 6172 6773 2c20 2a2a 6b77 6172 6773   *args, **kwargs
-00006940: 293a 0d0a 2020 2020 2020 2020 7365 6c66  ):..        self
-00006950: 2e76 6220 3d20 7662 2023 2069 6e69 7420  .vb = vb # init 
-00006960: 6265 666f 7265 2070 6172 656e 7420 636f  before parent co
-00006970: 6e73 7472 7563 746f 720d 0a20 2020 2020  nstructor..     
-00006980: 2020 2073 656c 662e 7465 7874 7320 3d20     self.texts = 
-00006990: 5b5d 0d0a 2020 2020 2020 2020 7375 7065  []..        supe
-000069a0: 7228 292e 5f5f 696e 6974 5f5f 282a 6172  r().__init__(*ar
-000069b0: 6773 2c20 2a2a 6b77 6172 6773 290d 0a0d  gs, **kwargs)...
-000069c0: 0a20 2020 2064 6566 2061 6464 5365 676d  .    def addSegm
-000069d0: 656e 7428 7365 6c66 2c20 6831 2c20 6832  ent(self, h1, h2
-000069e0: 2c20 696e 6465 783d 4e6f 6e65 293a 0d0a  , index=None):..
-000069f0: 2020 2020 2020 2020 7375 7065 7228 292e          super().
-00006a00: 6164 6453 6567 6d65 6e74 2868 312c 2068  addSegment(h1, h
-00006a10: 322c 2069 6e64 6578 290d 0a20 2020 2020  2, index)..     
-00006a20: 2020 2074 6578 7420 3d20 7067 2e54 6578     text = pg.Tex
-00006a30: 7449 7465 6d28 636f 6c6f 723d 6472 6177  tItem(color=draw
-00006a40: 5f6c 696e 655f 636f 6c6f 7229 0d0a 2020  _line_color)..  
-00006a50: 2020 2020 2020 7465 7874 2e73 6574 5a56        text.setZV
-00006a60: 616c 7565 2835 3029 0d0a 2020 2020 2020  alue(50)..      
-00006a70: 2020 7465 7874 2e73 6567 6d65 6e74 203d    text.segment =
-00006a80: 2073 656c 662e 7365 676d 656e 7473 5b2d   self.segments[-
-00006a90: 3120 6966 2069 6e64 6578 2069 7320 4e6f  1 if index is No
-00006aa0: 6e65 2065 6c73 6520 696e 6465 785d 0d0a  ne else index]..
-00006ab0: 2020 2020 2020 2020 6966 2069 6e64 6578          if index
-00006ac0: 2069 7320 4e6f 6e65 3a0d 0a20 2020 2020   is None:..     
-00006ad0: 2020 2020 2020 2073 656c 662e 7465 7874         self.text
-00006ae0: 732e 6170 7065 6e64 2874 6578 7429 0d0a  s.append(text)..
-00006af0: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
-00006b00: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00006b10: 7465 7874 732e 696e 7365 7274 2869 6e64  texts.insert(ind
-00006b20: 6578 2c20 7465 7874 290d 0a20 2020 2020  ex, text)..     
-00006b30: 2020 2073 656c 662e 7570 6461 7465 5f74     self.update_t
-00006b40: 6578 7428 7465 7874 290d 0a20 2020 2020  ext(text)..     
-00006b50: 2020 2073 656c 662e 7662 2e61 6464 4974     self.vb.addIt
-00006b60: 656d 2874 6578 742c 2069 676e 6f72 6542  em(text, ignoreB
-00006b70: 6f75 6e64 733d 5472 7565 290d 0a0d 0a20  ounds=True).... 
-00006b80: 2020 2064 6566 2072 656d 6f76 6553 6567     def removeSeg
-00006b90: 6d65 6e74 2873 656c 662c 2073 6567 293a  ment(self, seg):
-00006ba0: 0d0a 2020 2020 2020 2020 7375 7065 7228  ..        super(
-00006bb0: 292e 7265 6d6f 7665 5365 676d 656e 7428  ).removeSegment(
-00006bc0: 7365 6729 0d0a 2020 2020 2020 2020 666f  seg)..        fo
-00006bd0: 7220 7465 7874 2069 6e20 6c69 7374 2873  r text in list(s
-00006be0: 656c 662e 7465 7874 7329 3a0d 0a20 2020  elf.texts):..   
-00006bf0: 2020 2020 2020 2020 2069 6620 7465 7874           if text
-00006c00: 2e73 6567 6d65 6e74 203d 3d20 7365 673a  .segment == seg:
-00006c10: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00006c20: 2020 7365 6c66 2e76 622e 7265 6d6f 7665    self.vb.remove
-00006c30: 4974 656d 2874 6578 7429 0d0a 2020 2020  Item(text)..    
-00006c40: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00006c50: 2e74 6578 7473 2e72 656d 6f76 6528 7465  .texts.remove(te
-00006c60: 7874 290d 0a0d 0a20 2020 2064 6566 2075  xt)....    def u
-00006c70: 7064 6174 655f 7465 7874 2873 656c 662c  pdate_text(self,
-00006c80: 2074 6578 7429 3a0d 0a20 2020 2020 2020   text):..       
-00006c90: 2068 3020 3d20 7465 7874 2e73 6567 6d65   h0 = text.segme
-00006ca0: 6e74 2e68 616e 646c 6573 5b30 5d5b 2769  nt.handles[0]['i
-00006cb0: 7465 6d27 5d0d 0a20 2020 2020 2020 2068  tem']..        h
-00006cc0: 3120 3d20 7465 7874 2e73 6567 6d65 6e74  1 = text.segment
-00006cd0: 2e68 616e 646c 6573 5b31 5d5b 2769 7465  .handles[1]['ite
-00006ce0: 6d27 5d0d 0a20 2020 2020 2020 2064 6966  m']..        dif
-00006cf0: 6620 3d20 6831 2e70 6f73 2829 202d 2068  f = h1.pos() - h
-00006d00: 302e 706f 7328 290d 0a20 2020 2020 2020  0.pos()..       
-00006d10: 2069 6620 6469 6666 2e79 2829 203c 2030   if diff.y() < 0
-00006d20: 3a0d 0a20 2020 2020 2020 2020 2020 2074  :..            t
-00006d30: 6578 742e 7365 7441 6e63 686f 7228 2830  ext.setAnchor((0
-00006d40: 2e35 2c30 2929 0d0a 2020 2020 2020 2020  .5,0))..        
-00006d50: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
-00006d60: 2020 2074 6578 742e 7365 7441 6e63 686f     text.setAncho
-00006d70: 7228 2830 2e35 2c31 2929 0d0a 2020 2020  r((0.5,1))..    
-00006d80: 2020 2020 7465 7874 2e73 6574 506f 7328      text.setPos(
-00006d90: 6831 2e70 6f73 2829 290d 0a20 2020 2020  h1.pos())..     
-00006da0: 2020 2074 6578 742e 7365 7454 6578 7428     text.setText(
-00006db0: 5f64 7261 775f 6c69 6e65 5f73 6567 6d65  _draw_line_segme
-00006dc0: 6e74 5f74 6578 7428 7365 6c66 2c20 7465  nt_text(self, te
-00006dd0: 7874 2e73 6567 6d65 6e74 2c20 6830 2e70  xt.segment, h0.p
-00006de0: 6f73 2829 2c20 6831 2e70 6f73 2829 2929  os(), h1.pos()))
-00006df0: 0d0a 0d0a 2020 2020 6465 6620 7570 6461  ....    def upda
-00006e00: 7465 5f74 6578 7473 2873 656c 6629 3a0d  te_texts(self):.
-00006e10: 0a20 2020 2020 2020 2066 6f72 2074 6578  .        for tex
-00006e20: 7420 696e 2073 656c 662e 7465 7874 733a  t in self.texts:
-00006e30: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-00006e40: 6c66 2e75 7064 6174 655f 7465 7874 2874  lf.update_text(t
-00006e50: 6578 7429 0d0a 0d0a 2020 2020 6465 6620  ext)....    def 
-00006e60: 6d6f 7665 506f 696e 7428 7365 6c66 2c20  movePoint(self, 
-00006e70: 6861 6e64 6c65 2c20 706f 732c 206d 6f64  handle, pos, mod
-00006e80: 6966 6965 7273 3d51 7443 6f72 652e 5174  ifiers=QtCore.Qt
-00006e90: 2e4b 6579 626f 6172 644d 6f64 6966 6965  .KeyboardModifie
-00006ea0: 722c 2066 696e 6973 683d 5472 7565 2c20  r, finish=True, 
-00006eb0: 636f 6f72 6473 3d27 7061 7265 6e74 2729  coords='parent')
-00006ec0: 3a0d 0a20 2020 2020 2020 2073 7570 6572  :..        super
-00006ed0: 2829 2e6d 6f76 6550 6f69 6e74 2868 616e  ().movePoint(han
-00006ee0: 646c 652c 2070 6f73 2c20 6d6f 6469 6669  dle, pos, modifi
-00006ef0: 6572 732c 2066 696e 6973 682c 2063 6f6f  ers, finish, coo
-00006f00: 7264 7329 0d0a 2020 2020 2020 2020 7365  rds)..        se
-00006f10: 6c66 2e75 7064 6174 655f 7465 7874 7328  lf.update_texts(
-00006f20: 290d 0a0d 0a20 2020 2064 6566 2073 6567  )....    def seg
-00006f30: 6d65 6e74 436c 6963 6b65 6428 7365 6c66  mentClicked(self
-00006f40: 2c20 7365 676d 656e 742c 2065 763d 4e6f  , segment, ev=No
-00006f50: 6e65 2c20 706f 733d 4e6f 6e65 293a 0d0a  ne, pos=None):..
-00006f60: 2020 2020 2020 2020 706f 7320 3d20 7365          pos = se
-00006f70: 676d 656e 742e 6d61 7054 6f50 6172 656e  gment.mapToParen
-00006f80: 7428 6576 2e70 6f73 2829 290d 0a20 2020  t(ev.pos())..   
-00006f90: 2020 2020 2070 6f73 203d 205f 636c 616d       pos = _clam
-00006fa0: 705f 706f 696e 7428 7365 6c66 2e76 622e  p_point(self.vb.
-00006fb0: 7061 7265 6e74 2829 2c20 706f 7329 0d0a  parent(), pos)..
-00006fc0: 2020 2020 2020 2020 7375 7065 7228 292e          super().
-00006fd0: 7365 676d 656e 7443 6c69 636b 6564 2873  segmentClicked(s
-00006fe0: 6567 6d65 6e74 2c20 706f 733d 706f 7329  egment, pos=pos)
-00006ff0: 0d0a 2020 2020 2020 2020 7365 6c66 2e75  ..        self.u
-00007000: 7064 6174 655f 7465 7874 7328 290d 0a0d  pdate_texts()...
-00007010: 0a20 2020 2064 6566 2061 6464 4861 6e64  .    def addHand
-00007020: 6c65 2873 656c 662c 2069 6e66 6f2c 2069  le(self, info, i
-00007030: 6e64 6578 3d4e 6f6e 6529 3a0d 0a20 2020  ndex=None):..   
-00007040: 2020 2020 2068 616e 646c 6520 3d20 7375       handle = su
-00007050: 7065 7228 292e 6164 6448 616e 646c 6528  per().addHandle(
-00007060: 696e 666f 2c20 696e 6465 7829 0d0a 2020  info, index)..  
-00007070: 2020 2020 2020 6861 6e64 6c65 2e6d 6f76        handle.mov
-00007080: 6550 6f69 6e74 203d 2070 6172 7469 616c  ePoint = partial
-00007090: 285f 726f 6968 616e 646c 655f 6d6f 7665  (_roihandle_move
-000070a0: 5f73 6e61 702c 2073 656c 662e 7662 2c20  _snap, self.vb, 
-000070b0: 6861 6e64 6c65 2e6d 6f76 6550 6f69 6e74  handle.movePoint
-000070c0: 290d 0a20 2020 2020 2020 2072 6574 7572  )..        retur
-000070d0: 6e20 6861 6e64 6c65 0d0a 0d0a 0d0a 636c  n handle......cl
-000070e0: 6173 7320 4669 6e4c 696e 6528 7067 2e47  ass FinLine(pg.G
-000070f0: 7261 7068 6963 734f 626a 6563 7429 3a0d  raphicsObject):.
-00007100: 0a20 2020 2064 6566 205f 5f69 6e69 745f  .    def __init_
-00007110: 5f28 7365 6c66 2c20 706f 696e 7473 2c20  _(self, points, 
-00007120: 7065 6e29 3a0d 0a20 2020 2020 2020 2073  pen):..        s
-00007130: 7570 6572 2829 2e5f 5f69 6e69 745f 5f28  uper().__init__(
-00007140: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-00007150: 706f 696e 7473 203d 2070 6f69 6e74 730d  points = points.
-00007160: 0a20 2020 2020 2020 2073 656c 662e 7065  .        self.pe
-00007170: 6e20 3d20 7065 6e0d 0a0d 0a20 2020 2064  n = pen....    d
-00007180: 6566 2070 6169 6e74 2873 656c 662c 2070  ef paint(self, p
-00007190: 2c20 2a61 7267 7329 3a0d 0a20 2020 2020  , *args):..     
-000071a0: 2020 2070 2e73 6574 5065 6e28 7365 6c66     p.setPen(self
-000071b0: 2e70 656e 290d 0a20 2020 2020 2020 2070  .pen)..        p
-000071c0: 2e64 7261 7750 6174 6828 7365 6c66 2e73  .drawPath(self.s
-000071d0: 6861 7065 2829 290d 0a0d 0a20 2020 2064  hape())....    d
-000071e0: 6566 2073 6861 7065 2873 656c 6629 3a0d  ef shape(self):.
-000071f0: 0a20 2020 2020 2020 2070 203d 2051 7447  .        p = QtG
-00007200: 7569 2e51 5061 696e 7465 7250 6174 6828  ui.QPainterPath(
-00007210: 290d 0a20 2020 2020 2020 2070 2e6d 6f76  )..        p.mov
-00007220: 6554 6f28 2a73 656c 662e 706f 696e 7473  eTo(*self.points
-00007230: 5b30 5d29 0d0a 2020 2020 2020 2020 702e  [0])..        p.
-00007240: 6c69 6e65 546f 282a 7365 6c66 2e70 6f69  lineTo(*self.poi
-00007250: 6e74 735b 315d 290d 0a20 2020 2020 2020  nts[1])..       
-00007260: 2072 6574 7572 6e20 700d 0a0d 0a20 2020   return p....   
-00007270: 2064 6566 2062 6f75 6e64 696e 6752 6563   def boundingRec
-00007280: 7428 7365 6c66 293a 0d0a 2020 2020 2020  t(self):..      
-00007290: 2020 7265 7475 726e 2073 656c 662e 7368    return self.sh
-000072a0: 6170 6528 292e 626f 756e 6469 6e67 5265  ape().boundingRe
-000072b0: 6374 2829 0d0a 0d0a 0d0a 636c 6173 7320  ct()......class 
-000072c0: 4669 6e45 6c6c 6970 7365 2870 672e 456c  FinEllipse(pg.El
-000072d0: 6c69 7073 6552 4f49 293a 0d0a 2020 2020  lipseROI):..    
-000072e0: 6465 6620 6164 6452 6f74 6174 6548 616e  def addRotateHan
-000072f0: 646c 6528 7365 6c66 2c20 2a61 7267 732c  dle(self, *args,
-00007300: 202a 2a6b 7761 7267 7329 3a0d 0a20 2020   **kwargs):..   
-00007310: 2020 2020 2070 6173 730d 0a0d 0a0d 0a63       pass......c
-00007320: 6c61 7373 2046 696e 5265 6374 2870 672e  lass FinRect(pg.
-00007330: 5265 6374 524f 4929 3a0d 0a20 2020 2064  RectROI):..    d
-00007340: 6566 205f 5f69 6e69 745f 5f28 7365 6c66  ef __init__(self
-00007350: 2c20 6178 2c20 6272 7573 682c 202a 6172  , ax, brush, *ar
-00007360: 6773 2c20 2a2a 6b77 6172 6773 293a 0d0a  gs, **kwargs):..
-00007370: 2020 2020 2020 2020 7365 6c66 2e61 7820          self.ax 
-00007380: 3d20 6178 0d0a 2020 2020 2020 2020 7365  = ax..        se
-00007390: 6c66 2e62 7275 7368 203d 2062 7275 7368  lf.brush = brush
-000073a0: 0d0a 2020 2020 2020 2020 7375 7065 7228  ..        super(
-000073b0: 292e 5f5f 696e 6974 5f5f 282a 6172 6773  ).__init__(*args
-000073c0: 2c20 2a2a 6b77 6172 6773 290d 0a0d 0a20  , **kwargs).... 
-000073d0: 2020 2064 6566 2070 6169 6e74 2873 656c     def paint(sel
-000073e0: 662c 2070 2c20 2a61 7267 7329 3a0d 0a20  f, p, *args):.. 
-000073f0: 2020 2020 2020 2072 203d 2051 7443 6f72         r = QtCor
-00007400: 652e 5152 6563 7446 2830 2c20 302c 2073  e.QRectF(0, 0, s
-00007410: 656c 662e 7374 6174 655b 2773 697a 6527  elf.state['size'
-00007420: 5d5b 305d 2c20 7365 6c66 2e73 7461 7465  ][0], self.state
-00007430: 5b27 7369 7a65 275d 5b31 5d29 2e6e 6f72  ['size'][1]).nor
-00007440: 6d61 6c69 7a65 6428 290d 0a20 2020 2020  malized()..     
-00007450: 2020 2070 2e73 6574 5065 6e28 7365 6c66     p.setPen(self
-00007460: 2e63 7572 7265 6e74 5065 6e29 0d0a 2020  .currentPen)..  
-00007470: 2020 2020 2020 702e 7365 7442 7275 7368        p.setBrush
-00007480: 2873 656c 662e 6272 7573 6829 0d0a 2020  (self.brush)..  
-00007490: 2020 2020 2020 702e 7472 616e 736c 6174        p.translat
-000074a0: 6528 722e 6c65 6674 2829 2c20 722e 746f  e(r.left(), r.to
-000074b0: 7028 2929 0d0a 2020 2020 2020 2020 702e  p())..        p.
-000074c0: 7363 616c 6528 722e 7769 6474 6828 292c  scale(r.width(),
-000074d0: 2072 2e68 6569 6768 7428 2929 0d0a 2020   r.height())..  
-000074e0: 2020 2020 2020 702e 6472 6177 5265 6374        p.drawRect
-000074f0: 2830 2c20 302c 2031 2c20 3129 0d0a 0d0a  (0, 0, 1, 1)....
-00007500: 2020 2020 6465 6620 6164 6453 6361 6c65      def addScale
-00007510: 4861 6e64 6c65 2873 656c 662c 202a 6172  Handle(self, *ar
-00007520: 6773 2c20 2a2a 6b77 6172 6773 293a 0d0a  gs, **kwargs):..
-00007530: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-00007540: 7265 7369 7a61 626c 653a 0d0a 2020 2020  resizable:..    
-00007550: 2020 2020 2020 2020 7375 7065 7228 292e          super().
-00007560: 6164 6453 6361 6c65 4861 6e64 6c65 282a  addScaleHandle(*
-00007570: 6172 6773 2c20 2a2a 6b77 6172 6773 290d  args, **kwargs).
-00007580: 0a0d 0a0d 0a63 6c61 7373 2046 696e 5669  .....class FinVi
-00007590: 6577 426f 7828 7067 2e56 6965 7742 6f78  ewBox(pg.ViewBox
-000075a0: 293a 0d0a 2020 2020 6465 6620 5f5f 696e  ):..    def __in
-000075b0: 6974 5f5f 2873 656c 662c 2077 696e 2c20  it__(self, win, 
-000075c0: 696e 6974 5f73 7465 7073 3d33 3030 2c20  init_steps=300, 
-000075d0: 7973 6361 6c65 3d59 5363 616c 6528 276c  yscale=YScale('l
-000075e0: 696e 6561 7227 2c20 3129 2c20 765f 7a6f  inear', 1), v_zo
-000075f0: 6f6d 5f73 6361 6c65 3d31 2c20 2a61 7267  om_scale=1, *arg
-00007600: 732c 202a 2a6b 7761 7267 7329 3a0d 0a20  s, **kwargs):.. 
-00007610: 2020 2020 2020 2073 7570 6572 2829 2e5f         super()._
-00007620: 5f69 6e69 745f 5f28 2a61 7267 732c 202a  _init__(*args, *
-00007630: 2a6b 7761 7267 7329 0d0a 2020 2020 2020  *kwargs)..      
-00007640: 2020 7365 6c66 2e77 696e 203d 2077 696e    self.win = win
-00007650: 0d0a 2020 2020 2020 2020 7365 6c66 2e69  ..        self.i
-00007660: 6e69 745f 7374 6570 7320 3d20 696e 6974  nit_steps = init
-00007670: 5f73 7465 7073 0d0a 2020 2020 2020 2020  _steps..        
-00007680: 7365 6c66 2e79 7363 616c 6520 3d20 7973  self.yscale = ys
-00007690: 6361 6c65 0d0a 2020 2020 2020 2020 7365  cale..        se
-000076a0: 6c66 2e76 5f7a 6f6f 6d5f 7363 616c 6520  lf.v_zoom_scale 
-000076b0: 3d20 765f 7a6f 6f6d 5f73 6361 6c65 0d0a  = v_zoom_scale..
-000076c0: 2020 2020 2020 2020 7365 6c66 2e6d 6173          self.mas
-000076d0: 7465 725f 7669 6577 626f 7820 3d20 4e6f  ter_viewbox = No
-000076e0: 6e65 0d0a 2020 2020 2020 2020 7365 6c66  ne..        self
-000076f0: 2e72 6f69 7320 3d20 5b5d 0d0a 2020 2020  .rois = []..    
-00007700: 2020 2020 7365 6c66 2e77 696e 2e5f 6973      self.win._is
-00007710: 4d6f 7573 654c 6566 7444 7261 6720 3d20  MouseLeftDrag = 
-00007720: 4661 6c73 650d 0a20 2020 2020 2020 2073  False..        s
-00007730: 656c 662e 7265 7365 7428 290d 0a0d 0a20  elf.reset().... 
-00007740: 2020 2064 6566 2072 6573 6574 2873 656c     def reset(sel
-00007750: 6629 3a0d 0a20 2020 2020 2020 2073 656c  f):..        sel
-00007760: 662e 765f 7a6f 6f6d 5f62 6173 656c 696e  f.v_zoom_baselin
-00007770: 6520 3d20 302e 350d 0a20 2020 2020 2020  e = 0.5..       
-00007780: 2073 656c 662e 765f 6175 746f 7a6f 6f6d   self.v_autozoom
-00007790: 203d 2054 7275 650d 0a20 2020 2020 2020   = True..       
-000077a0: 2073 656c 662e 6d61 785f 7a6f 6f6d 5f70   self.max_zoom_p
-000077b0: 6f69 6e74 735f 6620 3d20 310d 0a20 2020  oints_f = 1..   
-000077c0: 2020 2020 2073 656c 662e 795f 6d61 7820       self.y_max 
-000077d0: 3d20 3130 3030 0d0a 2020 2020 2020 2020  = 1000..        
-000077e0: 7365 6c66 2e79 5f6d 696e 203d 2030 0d0a  self.y_min = 0..
-000077f0: 2020 2020 2020 2020 7365 6c66 2e79 5f70          self.y_p
-00007800: 6f73 6974 6976 6520 3d20 5472 7565 0d0a  ositive = True..
-00007810: 2020 2020 2020 2020 7365 6c66 2e78 5f69          self.x_i
-00007820: 6e64 6578 6564 203d 2054 7275 650d 0a20  ndexed = True.. 
-00007830: 2020 2020 2020 2073 656c 662e 666f 7263         self.forc
-00007840: 655f 7261 6e67 655f 7570 6461 7465 203d  e_range_update =
-00007850: 2030 0d0a 2020 2020 2020 2020 7768 696c   0..        whil
-00007860: 6520 7365 6c66 2e72 6f69 733a 0d0a 2020  e self.rois:..  
-00007870: 2020 2020 2020 2020 2020 7365 6c66 2e72            self.r
-00007880: 656d 6f76 655f 6c61 7374 5f72 6f69 2829  emove_last_roi()
-00007890: 0d0a 2020 2020 2020 2020 7365 6c66 2e64  ..        self.d
-000078a0: 7261 775f 6c69 6e65 203d 204e 6f6e 650d  raw_line = None.
-000078b0: 0a20 2020 2020 2020 2073 656c 662e 6472  .        self.dr
-000078c0: 6177 696e 6720 3d20 4661 6c73 650d 0a20  awing = False.. 
-000078d0: 2020 2020 2020 2073 656c 662e 7374 616e         self.stan
-000078e0: 6461 6c6f 6e65 7320 3d20 7365 7428 290d  dalones = set().
-000078f0: 0a20 2020 2020 2020 2073 656c 662e 7570  .        self.up
-00007900: 6461 7469 6e67 5f6c 696e 6b65 6420 3d20  dating_linked = 
-00007910: 4661 6c73 650d 0a20 2020 2020 2020 2073  False..        s
-00007920: 656c 662e 7365 745f 6461 7461 7372 6328  elf.set_datasrc(
-00007930: 4e6f 6e65 290d 0a20 2020 2020 2020 2073  None)..        s
-00007940: 656c 662e 7365 744d 6f75 7365 456e 6162  elf.setMouseEnab
-00007950: 6c65 6428 783d 5472 7565 2c20 793d 4661  led(x=True, y=Fa
-00007960: 6c73 6529 0d0a 2020 2020 2020 2020 7365  lse)..        se
-00007970: 6c66 2e73 6574 5261 6e67 6528 5174 436f  lf.setRange(QtCo
-00007980: 7265 2e51 5265 6374 4628 7067 2e50 6f69  re.QRectF(pg.Poi
-00007990: 6e74 2830 2c20 3029 2c20 7067 2e50 6f69  nt(0, 0), pg.Poi
-000079a0: 6e74 2831 2c20 3129 2929 0d0a 0d0a 2020  nt(1, 1)))....  
-000079b0: 2020 6465 6620 7365 745f 6461 7461 7372    def set_datasr
-000079c0: 6328 7365 6c66 2c20 6461 7461 7372 6329  c(self, datasrc)
-000079d0: 3a0d 0a20 2020 2020 2020 2073 656c 662e  :..        self.
-000079e0: 6461 7461 7372 6320 3d20 6461 7461 7372  datasrc = datasr
-000079f0: 630d 0a20 2020 2020 2020 2069 6620 6e6f  c..        if no
-00007a00: 7420 7365 6c66 2e64 6174 6173 7263 3a0d  t self.datasrc:.
-00007a10: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00007a20: 7572 6e0d 0a20 2020 2020 2020 2064 6174  urn..        dat
-00007a30: 6173 7263 2e75 7064 6174 655f 696e 6974  asrc.update_init
-00007a40: 5f78 2873 656c 662e 696e 6974 5f73 7465  _x(self.init_ste
-00007a50: 7073 290d 0a0d 0a20 2020 2064 6566 2070  ps)....    def p
-00007a60: 7265 5f70 726f 6365 7373 5f64 6174 6128  re_process_data(
-00007a70: 7365 6c66 293a 0d0a 2020 2020 2020 2020  self):..        
-00007a80: 6966 2073 656c 662e 6461 7461 7372 6320  if self.datasrc 
-00007a90: 616e 6420 7365 6c66 2e64 6174 6173 7263  and self.datasrc
-00007aa0: 2e73 6361 6c65 5f63 6f6c 733a 0d0a 2020  .scale_cols:..  
-00007ab0: 2020 2020 2020 2020 2020 6466 203d 2073            df = s
-00007ac0: 656c 662e 6461 7461 7372 632e 6466 2e69  elf.datasrc.df.i
-00007ad0: 6c6f 635b 3a2c 2073 656c 662e 6461 7461  loc[:, self.data
-00007ae0: 7372 632e 7363 616c 655f 636f 6c73 5d0d  src.scale_cols].
-00007af0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00007b00: 662e 795f 6d61 7820 3d20 6466 2e6d 6178  f.y_max = df.max
-00007b10: 2829 2e6d 6178 2829 0d0a 2020 2020 2020  ().max()..      
-00007b20: 2020 2020 2020 7365 6c66 2e79 5f6d 696e        self.y_min
-00007b30: 203d 2064 662e 6d69 6e28 292e 6d69 6e28   = df.min().min(
-00007b40: 290d 0a20 2020 2020 2020 2020 2020 2069  )..            i
-00007b50: 6620 7365 6c66 2e79 5f6d 696e 203c 3d20  f self.y_min <= 
-00007b60: 303a 0d0a 2020 2020 2020 2020 2020 2020  0:..            
-00007b70: 2020 2020 7365 6c66 2e79 5f70 6f73 6974      self.y_posit
-00007b80: 6976 6520 3d20 4661 6c73 650d 0a0d 0a20  ive = False.... 
-00007b90: 2020 2040 7072 6f70 6572 7479 0d0a 2020     @property..  
-00007ba0: 2020 6465 6620 6461 7461 7372 635f 6f72    def datasrc_or
-00007bb0: 5f73 7461 6e64 616c 6f6e 6528 7365 6c66  _standalone(self
-00007bc0: 293a 0d0a 2020 2020 2020 2020 6473 203d  ):..        ds =
-00007bd0: 2073 656c 662e 6461 7461 7372 630d 0a20   self.datasrc.. 
-00007be0: 2020 2020 2020 2069 6620 6e6f 7420 6473         if not ds
-00007bf0: 2061 6e64 2073 656c 662e 7374 616e 6461   and self.standa
-00007c00: 6c6f 6e65 733a 0d0a 2020 2020 2020 2020  lones:..        
-00007c10: 2020 2020 6473 203d 206e 6578 7428 6974      ds = next(it
-00007c20: 6572 2873 656c 662e 7374 616e 6461 6c6f  er(self.standalo
-00007c30: 6e65 7329 290d 0a20 2020 2020 2020 2072  nes))..        r
-00007c40: 6574 7572 6e20 6473 0d0a 0d0a 2020 2020  eturn ds....    
-00007c50: 6465 6620 7768 6565 6c45 7665 6e74 2873  def wheelEvent(s
-00007c60: 656c 662c 2065 762c 2061 7869 733d 4e6f  elf, ev, axis=No
-00007c70: 6e65 293a 0d0a 2020 2020 2020 2020 6966  ne):..        if
-00007c80: 2073 656c 662e 6d61 7374 6572 5f76 6965   self.master_vie
-00007c90: 7762 6f78 3a0d 0a20 2020 2020 2020 2020  wbox:..         
-00007ca0: 2020 2072 6574 7572 6e20 7365 6c66 2e6d     return self.m
-00007cb0: 6173 7465 725f 7669 6577 626f 782e 7768  aster_viewbox.wh
-00007cc0: 6565 6c45 7665 6e74 2865 762c 2061 7869  eelEvent(ev, axi
-00007cd0: 733d 6178 6973 290d 0a20 2020 2020 2020  s=axis)..       
-00007ce0: 2069 6620 6576 2e6d 6f64 6966 6965 7273   if ev.modifiers
-00007cf0: 2829 203d 3d20 5174 436f 7265 2e51 742e  () == QtCore.Qt.
-00007d00: 4b65 7962 6f61 7264 4d6f 6469 6669 6572  KeyboardModifier
-00007d10: 2e43 6f6e 7472 6f6c 4d6f 6469 6669 6572  .ControlModifier
-00007d20: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
-00007d30: 6361 6c65 5f66 6163 7420 3d20 310d 0a20  cale_fact = 1.. 
-00007d40: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00007d50: 765f 7a6f 6f6d 5f73 6361 6c65 202f 3d20  v_zoom_scale /= 
-00007d60: 312e 3032 202a 2a20 2865 762e 6465 6c74  1.02 ** (ev.delt
-00007d70: 6128 2920 2a20 7365 6c66 2e73 7461 7465  a() * self.state
-00007d80: 5b27 7768 6565 6c53 6361 6c65 4661 6374  ['wheelScaleFact
-00007d90: 6f72 275d 290d 0a20 2020 2020 2020 2065  or'])..        e
-00007da0: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
-00007db0: 2020 7363 616c 655f 6661 6374 203d 2031    scale_fact = 1
-00007dc0: 2e30 3220 2a2a 2028 6576 2e64 656c 7461  .02 ** (ev.delta
-00007dd0: 2829 202a 2073 656c 662e 7374 6174 655b  () * self.state[
-00007de0: 2777 6865 656c 5363 616c 6546 6163 746f  'wheelScaleFacto
-00007df0: 7227 5d29 0d0a 2020 2020 2020 2020 7672  r'])..        vr
-00007e00: 203d 2073 656c 662e 7461 7267 6574 5265   = self.targetRe
-00007e10: 6374 2829 0d0a 2020 2020 2020 2020 6365  ct()..        ce
-00007e20: 6e74 6572 203d 2073 656c 662e 6d61 7054  nter = self.mapT
-00007e30: 6f56 6965 7728 6576 2e73 6365 6e65 506f  oView(ev.scenePo
-00007e40: 7328 2929 0d0a 2020 2020 2020 2020 7063  s())..        pc
-00007e50: 745f 7820 3d20 2863 656e 7465 722e 7828  t_x = (center.x(
-00007e60: 292d 7672 2e6c 6566 7428 2929 202f 2076  )-vr.left()) / v
-00007e70: 722e 7769 6474 6828 290d 0a20 2020 2020  r.width()..     
-00007e80: 2020 2069 6620 7063 745f 7820 3c20 302e     if pct_x < 0.
-00007e90: 3035 3a20 2320 7a6f 6f6d 2074 6f20 6661  05: # zoom to fa
-00007ea0: 7220 6c65 6674 203d 3e20 616c 6c20 7468  r left => all th
-00007eb0: 6520 7761 7920 6c65 6674 0d0a 2020 2020  e way left..    
-00007ec0: 2020 2020 2020 2020 6365 6e74 6572 203d          center =
-00007ed0: 2070 672e 506f 696e 7428 7672 2e6c 6566   pg.Point(vr.lef
-00007ee0: 7428 292c 2063 656e 7465 722e 7928 2929  t(), center.y())
-00007ef0: 0d0a 2020 2020 2020 2020 656c 6966 2070  ..        elif p
-00007f00: 6374 5f78 203e 2030 2e39 353a 2023 207a  ct_x > 0.95: # z
-00007f10: 6f6f 6d20 746f 2066 6172 2072 6967 6874  oom to far right
-00007f20: 203d 3e20 616c 6c20 7468 6520 7761 7920   => all the way 
-00007f30: 7269 6768 740d 0a20 2020 2020 2020 2020  right..         
-00007f40: 2020 2063 656e 7465 7220 3d20 7067 2e50     center = pg.P
-00007f50: 6f69 6e74 2876 722e 7269 6768 7428 292c  oint(vr.right(),
-00007f60: 2063 656e 7465 722e 7928 2929 0d0a 2020   center.y())..  
-00007f70: 2020 2020 2020 7365 6c66 2e7a 6f6f 6d5f        self.zoom_
-00007f80: 7265 6374 2876 722c 2073 6361 6c65 5f66  rect(vr, scale_f
-00007f90: 6163 742c 2063 656e 7465 7229 0d0a 2020  act, center)..  
-00007fa0: 2020 2020 2020 2320 7570 6461 7465 2063        # update c
-00007fb0: 726f 7373 6861 6972 0d0a 2020 2020 2020  rosshair..      
-00007fc0: 2020 5f6d 6f75 7365 5f6d 6f76 6564 2873    _mouse_moved(s
-00007fd0: 656c 662e 7769 6e2c 2073 656c 662c 204e  elf.win, self, N
-00007fe0: 6f6e 6529 0d0a 2020 2020 2020 2020 6576  one)..        ev
-00007ff0: 2e61 6363 6570 7428 290d 0a0d 0a20 2020  .accept()....   
-00008000: 2064 6566 206d 6f75 7365 4472 6167 4576   def mouseDragEv
-00008010: 656e 7428 7365 6c66 2c20 6576 2c20 6178  ent(self, ev, ax
-00008020: 6973 3d4e 6f6e 6529 3a0d 0a20 2020 2020  is=None):..     
-00008030: 2020 2061 7869 7320 3d20 3020 2320 646f     axis = 0 # do
-00008040: 6e27 7420 636f 6e73 7472 6169 6e20 6472  n't constrain dr
-00008050: 6167 2064 6972 6563 7469 6f6e 0d0a 2020  ag direction..  
-00008060: 2020 2020 2020 6966 2073 656c 662e 6d61        if self.ma
-00008070: 7374 6572 5f76 6965 7762 6f78 3a0d 0a20  ster_viewbox:.. 
-00008080: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00008090: 6e20 7365 6c66 2e6d 6173 7465 725f 7669  n self.master_vi
-000080a0: 6577 626f 782e 6d6f 7573 6544 7261 6745  ewbox.mouseDragE
-000080b0: 7665 6e74 2865 762c 2061 7869 733d 6178  vent(ev, axis=ax
-000080c0: 6973 290d 0a20 2020 2020 2020 2069 6620  is)..        if 
-000080d0: 6e6f 7420 7365 6c66 2e64 6174 6173 7263  not self.datasrc
-000080e0: 3a0d 0a20 2020 2020 2020 2020 2020 2072  :..            r
-000080f0: 6574 7572 6e0d 0a20 2020 2020 2020 2069  eturn..        i
-00008100: 6620 6576 2e62 7574 746f 6e28 2920 3d3d  f ev.button() ==
-00008110: 2051 7443 6f72 652e 5174 2e4d 6f75 7365   QtCore.Qt.Mouse
-00008120: 4275 7474 6f6e 2e4c 6566 7442 7574 746f  Button.LeftButto
-00008130: 6e3a 0d0a 2020 2020 2020 2020 2020 2020  n:..            
-00008140: 7365 6c66 2e6d 6f75 7365 4c65 6674 4472  self.mouseLeftDr
-00008150: 6167 2865 762c 2061 7869 7329 0d0a 2020  ag(ev, axis)..  
-00008160: 2020 2020 2020 656c 6966 2065 762e 6275        elif ev.bu
-00008170: 7474 6f6e 2829 203d 3d20 5174 436f 7265  tton() == QtCore
-00008180: 2e51 742e 4d6f 7573 6542 7574 746f 6e2e  .Qt.MouseButton.
-00008190: 4d69 6464 6c65 4275 7474 6f6e 3a0d 0a20  MiddleButton:.. 
-000081a0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-000081b0: 6d6f 7573 654d 6964 646c 6544 7261 6728  mouseMiddleDrag(
-000081c0: 6576 2c20 6178 6973 290d 0a20 2020 2020  ev, axis)..     
-000081d0: 2020 2065 6c69 6620 6576 2e62 7574 746f     elif ev.butto
-000081e0: 6e28 2920 3d3d 2051 7443 6f72 652e 5174  n() == QtCore.Qt
-000081f0: 2e4d 6f75 7365 4275 7474 6f6e 2e52 6967  .MouseButton.Rig
-00008200: 6874 4275 7474 6f6e 3a0d 0a20 2020 2020  htButton:..     
-00008210: 2020 2020 2020 2073 656c 662e 6d6f 7573         self.mous
-00008220: 6552 6967 6874 4472 6167 2865 762c 2061  eRightDrag(ev, a
-00008230: 7869 7329 0d0a 2020 2020 2020 2020 656c  xis)..        el
-00008240: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
-00008250: 2073 7570 6572 2829 2e6d 6f75 7365 4472   super().mouseDr
-00008260: 6167 4576 656e 7428 6576 2c20 6178 6973  agEvent(ev, axis
-00008270: 290d 0a0d 0a20 2020 2064 6566 206d 6f75  )....    def mou
-00008280: 7365 4c65 6674 4472 6167 2873 656c 662c  seLeftDrag(self,
-00008290: 2065 762c 2061 7869 7329 3a0d 0a20 2020   ev, axis):..   
-000082a0: 2020 2020 2027 2727 4374 726c 2b4c 4275       '''Ctrl+LBu
-000082b0: 7474 6f6e 2064 7261 7720 6c69 6e65 732e  tton draw lines.
-000082c0: 2727 270d 0a20 2020 2020 2020 2069 6620  '''..        if 
-000082d0: 6576 2e6d 6f64 6966 6965 7273 2829 2021  ev.modifiers() !
-000082e0: 3d20 5174 436f 7265 2e51 742e 4b65 7962  = QtCore.Qt.Keyb
-000082f0: 6f61 7264 4d6f 6469 6669 6572 2e43 6f6e  oardModifier.Con
-00008300: 7472 6f6c 4d6f 6469 6669 6572 3a0d 0a20  trolModifier:.. 
-00008310: 2020 2020 2020 2020 2020 2073 7570 6572             super
-00008320: 2829 2e6d 6f75 7365 4472 6167 4576 656e  ().mouseDragEven
-00008330: 7428 6576 2c20 6178 6973 290d 0a20 2020  t(ev, axis)..   
-00008340: 2020 2020 2020 2020 2069 6620 6576 2e69           if ev.i
-00008350: 7346 696e 6973 6828 293a 0d0a 2020 2020  sFinish():..    
-00008360: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00008370: 2e77 696e 2e5f 6973 4d6f 7573 654c 6566  .win._isMouseLef
-00008380: 7444 7261 6720 3d20 4661 6c73 650d 0a20  tDrag = False.. 
-00008390: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-000083a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000083b0: 2020 7365 6c66 2e77 696e 2e5f 6973 4d6f    self.win._isMo
-000083c0: 7573 654c 6566 7444 7261 6720 3d20 5472  useLeftDrag = Tr
-000083d0: 7565 0d0a 2020 2020 2020 2020 2020 2020  ue..            
-000083e0: 6966 2065 762e 6973 4669 6e69 7368 2829  if ev.isFinish()
-000083f0: 206f 7220 7365 6c66 2e64 7261 7769 6e67   or self.drawing
-00008400: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00008410: 2020 2073 656c 662e 7265 6672 6573 685f     self.refresh_
-00008420: 616c 6c5f 795f 7a6f 6f6d 2829 0d0a 2020  all_y_zoom()..  
-00008430: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
-00008440: 2073 656c 662e 6472 6177 696e 673a 0d0a   self.drawing:..
-00008450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008460: 7265 7475 726e 0d0a 2020 2020 2020 2020  return..        
-00008470: 6966 2073 656c 662e 6472 6177 5f6c 696e  if self.draw_lin
-00008480: 6520 616e 6420 6e6f 7420 7365 6c66 2e64  e and not self.d
-00008490: 7261 7769 6e67 3a0d 0a20 2020 2020 2020  rawing:..       
-000084a0: 2020 2020 2073 656c 662e 7365 745f 6472       self.set_dr
-000084b0: 6177 5f6c 696e 655f 636f 6c6f 7228 6472  aw_line_color(dr
-000084c0: 6177 5f64 6f6e 655f 636f 6c6f 7229 0d0a  aw_done_color)..
-000084d0: 2020 2020 2020 2020 7031 203d 2073 656c          p1 = sel
-000084e0: 662e 6d61 7054 6f56 6965 7728 6576 2e70  f.mapToView(ev.p
-000084f0: 6f73 2829 290d 0a20 2020 2020 2020 2070  os())..        p
-00008500: 3120 3d20 5f63 6c61 6d70 5f70 6f69 6e74  1 = _clamp_point
-00008510: 2873 656c 662e 7061 7265 6e74 2829 2c20  (self.parent(), 
-00008520: 7031 290d 0a20 2020 2020 2020 2069 6620  p1)..        if 
-00008530: 6e6f 7420 7365 6c66 2e64 7261 7769 6e67  not self.drawing
-00008540: 3a0d 0a20 2020 2020 2020 2020 2020 2023  :..            #
-00008550: 2061 6464 206e 6577 206c 696e 650d 0a20   add new line.. 
-00008560: 2020 2020 2020 2020 2020 2070 3020 3d20             p0 = 
-00008570: 7365 6c66 2e6d 6170 546f 5669 6577 2865  self.mapToView(e
-00008580: 762e 6c61 7374 506f 7328 2929 0d0a 2020  v.lastPos())..  
-00008590: 2020 2020 2020 2020 2020 7030 203d 205f            p0 = _
-000085a0: 636c 616d 705f 706f 696e 7428 7365 6c66  clamp_point(self
-000085b0: 2e70 6172 656e 7428 292c 2070 3029 0d0a  .parent(), p0)..
-000085c0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-000085d0: 2e64 7261 775f 6c69 6e65 203d 2046 696e  .draw_line = Fin
-000085e0: 506f 6c79 4c69 6e65 2873 656c 662c 205b  PolyLine(self, [
-000085f0: 7030 2c20 7031 5d2c 2063 6c6f 7365 643d  p0, p1], closed=
-00008600: 4661 6c73 652c 2070 656e 3d70 672e 6d6b  False, pen=pg.mk
-00008610: 5065 6e28 6472 6177 5f6c 696e 655f 636f  Pen(draw_line_co
-00008620: 6c6f 7229 2c20 6d6f 7661 626c 653d 4661  lor), movable=Fa
-00008630: 6c73 6529 0d0a 2020 2020 2020 2020 2020  lse)..          
+00002220: 6578 745f 666d 7420 3d20 2725 252e 2569  ext_fmt = '%%.%i
+00002230: 6627 2025 206d 6178 6465 630d 0a20 2020  f' % maxdec..   
+00002240: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
+00002250: 2020 2020 2020 2020 7365 6c66 2e6e 6578          self.nex
+00002260: 745f 666d 7420 3d20 2725 6727 0d0a 2020  t_fmt = '%g'..  
+00002270: 2020 2020 2020 7265 7475 726e 2076 730d        return vs.
+00002280: 0a0d 0a0d 0a0d 0a63 6c61 7373 2059 5363  .......class YSc
+00002290: 616c 653a 0d0a 2020 2020 6465 6620 5f5f  ale:..    def __
+000022a0: 696e 6974 5f5f 2873 656c 662c 2073 6361  init__(self, sca
+000022b0: 6c65 7479 7065 2c20 7363 616c 6566 293a  letype, scalef):
+000022c0: 0d0a 2020 2020 2020 2020 7365 6c66 2e73  ..        self.s
+000022d0: 6361 6c65 7479 7065 203d 2073 6361 6c65  caletype = scale
+000022e0: 7479 7065 0d0a 2020 2020 2020 2020 7365  type..        se
+000022f0: 6c66 2e73 6574 5f73 6361 6c65 2873 6361  lf.set_scale(sca
+00002300: 6c65 6629 0d0a 0d0a 2020 2020 6465 6620  lef)....    def 
+00002310: 7365 745f 7363 616c 6528 7365 6c66 2c20  set_scale(self, 
+00002320: 7363 616c 6529 3a0d 0a20 2020 2020 2020  scale):..       
+00002330: 2073 656c 662e 7363 616c 6566 203d 2073   self.scalef = s
+00002340: 6361 6c65 0d0a 0d0a 2020 2020 6465 6620  cale....    def 
+00002350: 7866 6f72 6d28 7365 6c66 2c20 7929 3a0d  xform(self, y):.
+00002360: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+00002370: 2e73 6361 6c65 7479 7065 203d 3d20 276c  .scaletype == 'l
+00002380: 6f67 273a 0d0a 2020 2020 2020 2020 2020  og':..          
+00002390: 2020 7920 3d20 3130 2a2a 790d 0a20 2020    y = 10**y..   
+000023a0: 2020 2020 2079 203d 2079 202a 2073 656c       y = y * sel
+000023b0: 662e 7363 616c 6566 0d0a 2020 2020 2020  f.scalef..      
+000023c0: 2020 7265 7475 726e 2079 0d0a 0d0a 2020    return y....  
+000023d0: 2020 6465 6620 696e 7678 666f 726d 2873    def invxform(s
+000023e0: 656c 662c 2079 2c20 7665 7269 6679 3d46  elf, y, verify=F
+000023f0: 616c 7365 293a 0d0a 2020 2020 2020 2020  alse):..        
+00002400: 7920 2f3d 2073 656c 662e 7363 616c 6566  y /= self.scalef
+00002410: 0d0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
+00002420: 662e 7363 616c 6574 7970 6520 3d3d 2027  f.scaletype == '
+00002430: 6c6f 6727 3a0d 0a20 2020 2020 2020 2020  log':..         
+00002440: 2020 2069 6620 7665 7269 6679 2061 6e64     if verify and
+00002450: 2079 203c 3d20 303a 0d0a 2020 2020 2020   y <= 0:..      
+00002460: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00002470: 202d 3165 3620 2f20 7365 6c66 2e73 6361   -1e6 / self.sca
+00002480: 6c65 660d 0a20 2020 2020 2020 2020 2020  lef..           
+00002490: 2079 203d 206e 702e 6c6f 6731 3028 7929   y = np.log10(y)
+000024a0: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+000024b0: 2079 0d0a 0d0a 0d0a 0d0a 636c 6173 7320   y........class 
+000024c0: 5061 6e64 6173 4461 7461 536f 7572 6365  PandasDataSource
+000024d0: 3a0d 0a20 2020 2027 2727 4361 6e64 6c65  :..    '''Candle
+000024e0: 2073 7469 636b 733a 2063 7265 6174 6520   sticks: create 
+000024f0: 7769 7468 2066 6976 6520 636f 6c75 6d6e  with five column
+00002500: 733a 2074 696d 652c 206f 7065 6e2c 2063  s: time, open, c
+00002510: 6c6f 7365 2c20 6869 2c20 6c6f 202d 2069  lose, hi, lo - i
+00002520: 6e20 7468 6174 206f 7264 6572 2e0d 0a20  n that order... 
+00002530: 2020 2020 2020 566f 6c75 6d65 2062 6172        Volume bar
+00002540: 733a 2063 7265 6174 6520 7769 7468 2074  s: create with t
+00002550: 6872 6565 2063 6f6c 756d 6e73 3a20 7469  hree columns: ti
+00002560: 6d65 2c20 6f70 656e 2c20 636c 6f73 652c  me, open, close,
+00002570: 2076 6f6c 756d 6520 2d20 696e 2074 6861   volume - in tha
+00002580: 7420 6f72 6465 722e 0d0a 2020 2020 2020  t order...      
+00002590: 2046 6f72 2061 6c6c 206f 7468 6572 2074   For all other t
+000025a0: 7970 6573 2c20 7469 6d65 206e 6565 6473  ypes, time needs
+000025b0: 2074 6f20 6265 2066 6972 7374 2c20 7573   to be first, us
+000025c0: 7561 6c6c 7920 666f 6c6c 6f77 6564 2062  ually followed b
+000025d0: 7920 6f6e 6520 6f72 206d 6f72 6520 592d  y one or more Y-
+000025e0: 636f 6c75 6d6e 732e 2727 270d 0a20 2020  columns.'''..   
+000025f0: 2064 6566 205f 5f69 6e69 745f 5f28 7365   def __init__(se
+00002600: 6c66 2c20 6466 293a 0d0a 2020 2020 2020  lf, df):..      
+00002610: 2020 6966 2074 7970 6528 6466 2e69 6e64    if type(df.ind
+00002620: 6578 2920 3d3d 2070 642e 4461 7465 7469  ex) == pd.Dateti
+00002630: 6d65 496e 6465 7820 6f72 2064 662e 696e  meIndex or df.in
+00002640: 6465 785b 2d31 5d3e 3165 3820 6f72 2027  dex[-1]>1e8 or '
+00002650: 2e52 616e 6765 496e 6465 7827 206e 6f74  .RangeIndex' not
+00002660: 2069 6e20 7374 7228 7479 7065 2864 662e   in str(type(df.
+00002670: 696e 6465 7829 293a 0d0a 2020 2020 2020  index)):..      
+00002680: 2020 2020 2020 6466 203d 2064 662e 7265        df = df.re
+00002690: 7365 745f 696e 6465 7828 290d 0a20 2020  set_index()..   
+000026a0: 2020 2020 2073 656c 662e 6466 203d 2064       self.df = d
+000026b0: 662e 636f 7079 2829 0d0a 2020 2020 2020  f.copy()..      
+000026c0: 2020 2320 6d61 6e61 6765 2074 696d 6520    # manage time 
+000026d0: 636f 6c75 6d6e 0d0a 2020 2020 2020 2020  column..        
+000026e0: 6966 205f 6861 735f 7469 6d65 636f 6c28  if _has_timecol(
+000026f0: 7365 6c66 2e64 6629 3a0d 0a20 2020 2020  self.df):..     
+00002700: 2020 2020 2020 2074 696d 6563 6f6c 203d         timecol =
+00002710: 2073 656c 662e 6466 2e63 6f6c 756d 6e73   self.df.columns
+00002720: 5b30 5d0d 0a20 2020 2020 2020 2020 2020  [0]..           
+00002730: 2064 7479 7065 203d 2073 7472 2864 665b   dtype = str(df[
+00002740: 7469 6d65 636f 6c5d 2e64 7479 7065 290d  timecol].dtype).
+00002750: 0a20 2020 2020 2020 2020 2020 2069 736e  .            isn
+00002760: 756d 203d 2028 2769 6e74 2720 696e 2064  um = ('int' in d
+00002770: 7479 7065 206f 7220 2766 6c6f 6174 2720  type or 'float' 
+00002780: 696e 2064 7479 7065 2920 616e 6420 6466  in dtype) and df
+00002790: 5b74 696d 6563 6f6c 5d2e 696c 6f63 5b2d  [timecol].iloc[-
+000027a0: 315d 203c 2031 6537 0d0a 2020 2020 2020  1] < 1e7..      
+000027b0: 2020 2020 2020 6966 206e 6f74 2069 736e        if not isn
+000027c0: 756d 3a0d 0a20 2020 2020 2020 2020 2020  um:..           
+000027d0: 2020 2020 2073 656c 662e 6466 5b74 696d       self.df[tim
+000027e0: 6563 6f6c 5d20 3d20 5f70 6474 696d 6532  ecol] = _pdtime2
+000027f0: 6570 6f63 6828 6466 5b74 696d 6563 6f6c  epoch(df[timecol
+00002800: 5d29 0d0a 2020 2020 2020 2020 2020 2020  ])..            
+00002810: 7365 6c66 2e73 7461 6e64 616c 6f6e 6520  self.standalone 
+00002820: 3d20 5f69 735f 7374 616e 6461 6c6f 6e65  = _is_standalone
+00002830: 2873 656c 662e 6466 5b74 696d 6563 6f6c  (self.df[timecol
+00002840: 5d29 0d0a 2020 2020 2020 2020 2020 2020  ])..            
+00002850: 7365 6c66 2e63 6f6c 5f64 6174 615f 6f66  self.col_data_of
+00002860: 6673 6574 203d 2031 2023 206e 6f2e 206f  fset = 1 # no. o
+00002870: 6620 7072 6563 6565 6469 6e67 2063 6f6c  f preceeding col
+00002880: 756d 6e73 2066 6f72 206f 7468 6572 2070  umns for other p
+00002890: 6c6f 7473 2061 6e64 2074 696d 6520 636f  lots and time co
+000028a0: 6c75 6d6e 0d0a 2020 2020 2020 2020 656c  lumn..        el
+000028b0: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
+000028c0: 2073 656c 662e 7374 616e 6461 6c6f 6e65   self.standalone
+000028d0: 203d 2046 616c 7365 0d0a 2020 2020 2020   = False..      
+000028e0: 2020 2020 2020 7365 6c66 2e63 6f6c 5f64        self.col_d
+000028f0: 6174 615f 6f66 6673 6574 203d 2030 2023  ata_offset = 0 #
+00002900: 206e 6f2e 206f 6620 7072 6563 6565 6469   no. of preceedi
+00002910: 6e67 2063 6f6c 756d 6e73 2066 6f72 206f  ng columns for o
+00002920: 7468 6572 2070 6c6f 7473 2061 6e64 2074  ther plots and t
+00002930: 696d 6520 636f 6c75 6d6e 0d0a 2020 2020  ime column..    
+00002940: 2020 2020 2320 7365 7475 7020 6461 7461      # setup data
+00002950: 2066 6f72 206a 6f69 6e69 6e67 2064 6174   for joining dat
+00002960: 6120 736f 7572 6365 7320 616e 6420 7a6f  a sources and zo
+00002970: 6f6d 696e 670d 0a20 2020 2020 2020 2073  oming..        s
+00002980: 656c 662e 7363 616c 655f 636f 6c73 203d  elf.scale_cols =
+00002990: 205b 6920 666f 7220 6920 696e 2072 616e   [i for i in ran
+000029a0: 6765 2873 656c 662e 636f 6c5f 6461 7461  ge(self.col_data
+000029b0: 5f6f 6666 7365 742c 6c65 6e28 7365 6c66  _offset,len(self
+000029c0: 2e64 662e 636f 6c75 6d6e 7329 2920 6966  .df.columns)) if
+000029d0: 2073 656c 662e 6466 2e69 6c6f 635b 3a2c   self.df.iloc[:,
+000029e0: 695d 2e64 7479 7065 213d 6f62 6a65 6374  i].dtype!=object
+000029f0: 5d0d 0a20 2020 2020 2020 2073 656c 662e  ]..        self.
+00002a00: 6361 6368 655f 6869 6c6f 203d 204f 7264  cache_hilo = Ord
+00002a10: 6572 6564 4469 6374 2829 0d0a 2020 2020  eredDict()..    
+00002a20: 2020 2020 7365 6c66 2e72 656e 616d 6573      self.renames
+00002a30: 203d 207b 7d0d 0a20 2020 2020 2020 206e   = {}..        n
+00002a40: 6577 636f 6c73 203d 205b 5d0d 0a20 2020  ewcols = []..   
+00002a50: 2020 2020 2066 6f72 2063 6f6c 2069 6e20       for col in 
+00002a60: 7365 6c66 2e64 662e 636f 6c75 6d6e 733a  self.df.columns:
+00002a70: 0d0a 2020 2020 2020 2020 2020 2020 6f6c  ..            ol
+00002a80: 6463 6f6c 203d 2063 6f6c 0d0a 2020 2020  dcol = col..    
+00002a90: 2020 2020 2020 2020 7768 696c 6520 636f          while co
+00002aa0: 6c20 696e 206e 6577 636f 6c73 3a0d 0a20  l in newcols:.. 
+00002ab0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00002ac0: 6f6c 203d 2073 7472 2863 6f6c 292b 272b  ol = str(col)+'+
+00002ad0: 270d 0a20 2020 2020 2020 2020 2020 206e  '..            n
+00002ae0: 6577 636f 6c73 2e61 7070 656e 6428 636f  ewcols.append(co
+00002af0: 6c29 0d0a 2020 2020 2020 2020 2020 2020  l)..            
+00002b00: 6966 206f 6c64 636f 6c20 213d 2063 6f6c  if oldcol != col
+00002b10: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00002b20: 2020 2073 656c 662e 7265 6e61 6d65 735b     self.renames[
+00002b30: 6f6c 6463 6f6c 5d20 3d20 636f 6c0d 0a20  oldcol] = col.. 
+00002b40: 2020 2020 2020 2073 656c 662e 6466 2e63         self.df.c
+00002b50: 6f6c 756d 6e73 203d 206e 6577 636f 6c73  olumns = newcols
+00002b60: 0d0a 2020 2020 2020 2020 7365 6c66 2e70  ..        self.p
+00002b70: 7265 5f75 7064 6174 6520 3d20 6c61 6d62  re_update = lamb
+00002b80: 6461 2064 663a 2064 660d 0a20 2020 2020  da df: df..     
+00002b90: 2020 2073 656c 662e 706f 7374 5f75 7064     self.post_upd
+00002ba0: 6174 6520 3d20 6c61 6d62 6461 2064 663a  ate = lambda df:
+00002bb0: 2064 660d 0a20 2020 2020 2020 2073 656c   df..        sel
+00002bc0: 662e 5f70 6572 696f 6420 3d20 4e6f 6e65  f._period = None
+00002bd0: 0d0a 2020 2020 2020 2020 7365 6c66 2e5f  ..        self._
+00002be0: 736d 6f6f 7468 5f74 696d 6520 3d20 4e6f  smooth_time = No
+00002bf0: 6e65 0d0a 2020 2020 2020 2020 7365 6c66  ne..        self
+00002c00: 2e69 735f 7370 6172 7365 203d 2073 656c  .is_sparse = sel
+00002c10: 662e 6466 5b73 656c 662e 6466 2e63 6f6c  f.df[self.df.col
+00002c20: 756d 6e73 5b73 656c 662e 636f 6c5f 6461  umns[self.col_da
+00002c30: 7461 5f6f 6666 7365 745d 5d2e 6973 6e75  ta_offset]].isnu
+00002c40: 6c6c 2829 2e73 756d 2829 2e6d 6178 2829  ll().sum().max()
+00002c50: 203e 206c 656e 2873 656c 662e 6466 292f   > len(self.df)/
+00002c60: 2f32 0d0a 0d0a 2020 2020 4070 726f 7065  /2....    @prope
+00002c70: 7274 790d 0a20 2020 2064 6566 2070 6572  rty..    def per
+00002c80: 696f 645f 6e73 2873 656c 6629 3a0d 0a20  iod_ns(self):.. 
+00002c90: 2020 2020 2020 2069 6620 6c65 6e28 7365         if len(se
+00002ca0: 6c66 2e64 6629 203c 3d20 313a 0d0a 2020  lf.df) <= 1:..  
+00002cb0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00002cc0: 2031 0d0a 2020 2020 2020 2020 6966 206e   1..        if n
+00002cd0: 6f74 2073 656c 662e 5f70 6572 696f 643a  ot self._period:
+00002ce0: 0d0a 2020 2020 2020 2020 2020 2020 7469  ..            ti
+00002cf0: 6d65 636f 6c20 3d20 7365 6c66 2e64 662e  mecol = self.df.
+00002d00: 636f 6c75 6d6e 735b 305d 0d0a 2020 2020  columns[0]..    
+00002d10: 2020 2020 2020 2020 7469 6d65 7320 3d20          times = 
+00002d20: 7365 6c66 2e64 665b 7469 6d65 636f 6c5d  self.df[timecol]
+00002d30: 2e69 6c6f 635b 303a 3130 305d 0d0a 2020  .iloc[0:100]..  
+00002d40: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
+00002d50: 7065 7269 6f64 203d 2069 6e74 2874 696d  period = int(tim
+00002d60: 6573 2e64 6966 6628 292e 6d65 6469 616e  es.diff().median
+00002d70: 2829 2920 6966 206c 656e 2874 696d 6573  ()) if len(times
+00002d80: 293e 3120 656c 7365 2031 0d0a 2020 2020  )>1 else 1..    
+00002d90: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+00002da0: 5f70 6572 696f 640d 0a0d 0a20 2020 2040  _period....    @
+00002db0: 7072 6f70 6572 7479 0d0a 2020 2020 6465  property..    de
+00002dc0: 6620 696e 6465 7828 7365 6c66 293a 0d0a  f index(self):..
+00002dd0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+00002de0: 656c 662e 6466 2e69 6e64 6578 0d0a 0d0a  elf.df.index....
+00002df0: 2020 2020 4070 726f 7065 7274 790d 0a20      @property.. 
+00002e00: 2020 2064 6566 2078 2873 656c 6629 3a0d     def x(self):.
+00002e10: 0a20 2020 2020 2020 2074 696d 6563 6f6c  .        timecol
+00002e20: 203d 2073 656c 662e 6466 2e63 6f6c 756d   = self.df.colum
+00002e30: 6e73 5b30 5d0d 0a20 2020 2020 2020 2072  ns[0]..        r
+00002e40: 6574 7572 6e20 7365 6c66 2e64 665b 7469  eturn self.df[ti
+00002e50: 6d65 636f 6c5d 0d0a 0d0a 2020 2020 4070  mecol]....    @p
+00002e60: 726f 7065 7274 790d 0a20 2020 2064 6566  roperty..    def
+00002e70: 2079 2873 656c 6629 3a0d 0a20 2020 2020   y(self):..     
+00002e80: 2020 2063 6f6c 203d 2073 656c 662e 6466     col = self.df
+00002e90: 2e63 6f6c 756d 6e73 5b73 656c 662e 636f  .columns[self.co
+00002ea0: 6c5f 6461 7461 5f6f 6666 7365 745d 0d0a  l_data_offset]..
+00002eb0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+00002ec0: 656c 662e 6466 5b63 6f6c 5d0d 0a0d 0a20  elf.df[col].... 
+00002ed0: 2020 2040 7072 6f70 6572 7479 0d0a 2020     @property..  
+00002ee0: 2020 6465 6620 7a28 7365 6c66 293a 0d0a    def z(self):..
+00002ef0: 2020 2020 2020 2020 636f 6c20 3d20 7365          col = se
+00002f00: 6c66 2e64 662e 636f 6c75 6d6e 735b 7365  lf.df.columns[se
+00002f10: 6c66 2e63 6f6c 5f64 6174 615f 6f66 6673  lf.col_data_offs
+00002f20: 6574 2b31 5d0d 0a20 2020 2020 2020 2072  et+1]..        r
+00002f30: 6574 7572 6e20 7365 6c66 2e64 665b 636f  eturn self.df[co
+00002f40: 6c5d 0d0a 0d0a 2020 2020 4070 726f 7065  l]....    @prope
+00002f50: 7274 790d 0a20 2020 2064 6566 2078 6c65  rty..    def xle
+00002f60: 6e28 7365 6c66 293a 0d0a 2020 2020 2020  n(self):..      
+00002f70: 2020 7265 7475 726e 206c 656e 2873 656c    return len(sel
+00002f80: 662e 6466 290d 0a0d 0a20 2020 2064 6566  f.df)....    def
+00002f90: 2063 616c 635f 7369 676e 6966 6963 616e   calc_significan
+00002fa0: 745f 6465 6369 6d61 6c73 2873 656c 662c  t_decimals(self,
+00002fb0: 2066 756c 6c29 3a0d 0a20 2020 2020 2020   full):..       
+00002fc0: 2064 6566 2066 6c6f 6174 5f72 6f75 6e64   def float_round
+00002fd0: 2866 293a 0d0a 2020 2020 2020 2020 2020  (f):..          
+00002fe0: 2020 7265 7475 726e 2066 6c6f 6174 2827    return float('
+00002ff0: 252e 3365 2725 6629 2023 2030 2e30 3039  %.3e'%f) # 0.009
+00003000: 3939 3734 3820 2d3e 2030 2e30 310d 0a20  99748 -> 0.01.. 
+00003010: 2020 2020 2020 2064 6566 2072 656d 6169         def remai
+00003020: 6e64 6572 5f6f 6b28 612c 2062 293a 0d0a  nder_ok(a, b):..
+00003030: 2020 2020 2020 2020 2020 2020 6320 3d20              c = 
+00003040: 6120 2520 620d 0a20 2020 2020 2020 2020  a % b..         
+00003050: 2020 2069 6620 6320 2f20 6220 3e20 302e     if c / b > 0.
+00003060: 3938 3a20 2320 7265 6d61 696e 6465 7220  98: # remainder 
+00003070: 616c 6d6f 7374 2073 616d 6520 6173 2064  almost same as d
+00003080: 656e 6f6d 696e 6174 6f72 0d0a 2020 2020  enominator..    
+00003090: 2020 2020 2020 2020 2020 2020 6320 3d20              c = 
+000030a0: 6162 7328 632d 6229 0d0a 2020 2020 2020  abs(c-b)..      
+000030b0: 2020 2020 2020 7265 7475 726e 2063 203c        return c <
+000030c0: 2062 2a30 2e36 2023 2068 616c 6620 6973   b*0.6 # half is
+000030d0: 2066 696e 650d 0a20 2020 2020 2020 2064   fine..        d
+000030e0: 6566 2063 616c 635f 7364 2873 6572 293a  ef calc_sd(ser):
+000030f0: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+00003100: 7220 3d20 7365 722e 696c 6f63 5b3a 3130  r = ser.iloc[:10
+00003110: 3030 5d0d 0a20 2020 2020 2020 2020 2020  00]..           
+00003120: 2061 6273 6469 6666 203d 2073 6572 2e64   absdiff = ser.d
+00003130: 6966 6628 292e 6162 7328 290d 0a20 2020  iff().abs()..   
+00003140: 2020 2020 2020 2020 2061 6273 6469 6666           absdiff
+00003150: 5b61 6273 6469 6666 3c31 652d 3330 5d20  [absdiff<1e-30] 
+00003160: 3d20 3165 3330 0d0a 2020 2020 2020 2020  = 1e30..        
+00003170: 2020 2020 736d 616c 6c65 7374 5f64 6966      smallest_dif
+00003180: 6620 3d20 6162 7364 6966 662e 6d69 6e28  f = absdiff.min(
+00003190: 290d 0a20 2020 2020 2020 2020 2020 2069  )..            i
+000031a0: 6620 736d 616c 6c65 7374 5f64 6966 6620  f smallest_diff 
+000031b0: 3e20 3165 3239 3a20 2320 6a75 7374 2030  > 1e29: # just 0
+000031c0: 733f 0d0a 2020 2020 2020 2020 2020 2020  s?..            
+000031d0: 2020 2020 7265 7475 726e 2030 0d0a 2020      return 0..  
+000031e0: 2020 2020 2020 2020 2020 736d 616c 6c65            smalle
+000031f0: 7374 5f64 6966 6620 3d20 666c 6f61 745f  st_diff = float_
+00003200: 726f 756e 6428 736d 616c 6c65 7374 5f64  round(smallest_d
+00003210: 6966 6629 0d0a 2020 2020 2020 2020 2020  iff)..          
+00003220: 2020 6162 7373 6572 203d 2073 6572 2e69    absser = ser.i
+00003230: 6c6f 635b 3a31 3030 5d2e 6162 7328 290d  loc[:100].abs().
+00003240: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+00003250: 205f 2069 6e20 7261 6e67 6528 3229 3a20   _ in range(2): 
+00003260: 2320 6368 6563 6b20 6966 2077 6520 6861  # check if we ha
+00003270: 7665 2061 2072 656d 6169 6e64 6572 2074  ve a remainder t
+00003280: 6861 7420 6973 2061 2062 6574 7465 7220  hat is a better 
+00003290: 6570 7369 6c6f 6e0d 0a20 2020 2020 2020  epsilon..       
+000032a0: 2020 2020 2020 2020 2072 656d 6169 6e64           remaind
+000032b0: 6572 203d 205b 666d 6f64 2876 2c73 6d61  er = [fmod(v,sma
+000032c0: 6c6c 6573 745f 6469 6666 2920 666f 7220  llest_diff) for 
+000032d0: 7620 696e 2061 6273 7365 725d 0d0a 2020  v in absser]..  
+000032e0: 2020 2020 2020 2020 2020 2020 2020 7265                re
+000032f0: 6d61 696e 6465 7220 3d20 5b76 2066 6f72  mainder = [v for
+00003300: 2076 2069 6e20 7265 6d61 696e 6465 7220   v in remainder 
+00003310: 6966 2076 3e73 6d61 6c6c 6573 745f 6469  if v>smallest_di
+00003320: 6666 2f32 305d 0d0a 2020 2020 2020 2020  ff/20]..        
+00003330: 2020 2020 2020 2020 6966 206e 6f74 2072          if not r
+00003340: 656d 6169 6e64 6572 3a0d 0a20 2020 2020  emainder:..     
+00003350: 2020 2020 2020 2020 2020 2020 2020 2062                 b
+00003360: 7265 616b 0d0a 2020 2020 2020 2020 2020  reak..          
+00003370: 2020 2020 2020 736d 616c 6c65 7374 5f64        smallest_d
+00003380: 6966 665f 7220 3d20 6d69 6e28 7265 6d61  iff_r = min(rema
+00003390: 696e 6465 7229 0d0a 2020 2020 2020 2020  inder)..        
+000033a0: 2020 2020 2020 2020 6966 2073 6d61 6c6c          if small
+000033b0: 6573 745f 6469 6666 2a30 2e30 3520 3c20  est_diff*0.05 < 
+000033c0: 736d 616c 6c65 7374 5f64 6966 665f 7220  smallest_diff_r 
+000033d0: 3c20 736d 616c 6c65 7374 5f64 6966 6620  < smallest_diff 
+000033e0: 2a20 302e 3720 616e 6420 7265 6d61 696e  * 0.7 and remain
+000033f0: 6465 725f 6f6b 2873 6d61 6c6c 6573 745f  der_ok(smallest_
+00003400: 6469 6666 2c20 736d 616c 6c65 7374 5f64  diff, smallest_d
+00003410: 6966 665f 7229 3a0d 0a20 2020 2020 2020  iff_r):..       
+00003420: 2020 2020 2020 2020 2020 2020 2073 6d61               sma
+00003430: 6c6c 6573 745f 6469 6666 203d 2073 6d61  llest_diff = sma
+00003440: 6c6c 6573 745f 6469 6666 5f72 0d0a 2020  llest_diff_r..  
+00003450: 2020 2020 2020 2020 2020 2020 2020 656c                el
+00003460: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
+00003470: 2020 2020 2020 2020 2062 7265 616b 0d0a           break..
+00003480: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00003490: 726e 2073 6d61 6c6c 6573 745f 6469 6666  rn smallest_diff
+000034a0: 0d0a 2020 2020 2020 2020 6465 6620 6361  ..        def ca
+000034b0: 6c63 5f64 6563 2873 6572 2c20 736d 616c  lc_dec(ser, smal
+000034c0: 6c65 7374 5f64 6966 6629 3a0d 0a20 2020  lest_diff):..   
+000034d0: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
+000034e0: 6675 6c6c 3a20 2320 6c69 6e65 2070 6c6f  full: # line plo
+000034f0: 7473 2075 7375 616c 6c79 2068 6176 6520  ts usually have 
+00003500: 6578 7472 656d 6520 7265 736f 6c75 7469  extreme resoluti
+00003510: 6f6e 0d0a 2020 2020 2020 2020 2020 2020  on..            
+00003520: 2020 2020 6162 736d 6178 203d 2073 6572      absmax = ser
+00003530: 2e69 6c6f 635b 3a33 3030 5d2e 6162 7328  .iloc[:300].abs(
+00003540: 292e 6d61 7828 290d 0a20 2020 2020 2020  ).max()..       
+00003550: 2020 2020 2020 2020 2073 203d 2027 252e           s = '%.
+00003560: 3365 2720 2520 6162 736d 6178 0d0a 2020  3e' % absmax..  
+00003570: 2020 2020 2020 2020 2020 656c 7365 3a20            else: 
+00003580: 2320 6361 6e64 6c65 730d 0a20 2020 2020  # candles..     
+00003590: 2020 2020 2020 2020 2020 2073 203d 2027             s = '
+000035a0: 252e 3265 2720 2520 736d 616c 6c65 7374  %.2e' % smallest
+000035b0: 5f64 6966 660d 0a20 2020 2020 2020 2020  _diff..         
+000035c0: 2020 2062 6173 652c 5f2c 6578 7020 3d20     base,_,exp = 
+000035d0: 732e 7061 7274 6974 696f 6e28 2765 2729  s.partition('e')
+000035e0: 0d0a 2020 2020 2020 2020 2020 2020 6261  ..            ba
+000035f0: 7365 203d 2062 6173 652e 7273 7472 6970  se = base.rstrip
+00003600: 2827 3027 290d 0a20 2020 2020 2020 2020  ('0')..         
+00003610: 2020 2065 7870 203d 202d 696e 7428 6578     exp = -int(ex
+00003620: 7029 0d0a 2020 2020 2020 2020 2020 2020  p)..            
+00003630: 6d61 785f 6261 7365 5f64 6563 696d 616c  max_base_decimal
+00003640: 7320 3d20 6d69 6e28 352c 202d 6578 702b  s = min(5, -exp+
+00003650: 3229 2069 6620 6578 7020 3c20 3020 656c  2) if exp < 0 el
+00003660: 7365 2033 0d0a 2020 2020 2020 2020 2020  se 3..          
+00003670: 2020 6261 7365 5f64 6563 696d 616c 7320    base_decimals 
+00003680: 3d20 6d61 7828 302c 206d 696e 286d 6178  = max(0, min(max
+00003690: 5f62 6173 655f 6465 6369 6d61 6c73 2c20  _base_decimals, 
+000036a0: 6c65 6e28 6261 7365 292d 3229 290d 0a20  len(base)-2)).. 
+000036b0: 2020 2020 2020 2020 2020 2064 6563 696d             decim
+000036c0: 616c 7320 3d20 6578 7020 2b20 6261 7365  als = exp + base
+000036d0: 5f64 6563 696d 616c 730d 0a20 2020 2020  _decimals..     
+000036e0: 2020 2020 2020 2064 6563 696d 616c 7320         decimals 
+000036f0: 3d20 6d61 7828 302c 206d 696e 286d 6178  = max(0, min(max
+00003700: 5f64 6563 696d 616c 732c 2064 6563 696d  _decimals, decim
+00003710: 616c 7329 290d 0a20 2020 2020 2020 2020  als))..         
+00003720: 2020 2069 6620 6e6f 7420 6675 6c6c 3a20     if not full: 
+00003730: 2320 6170 706c 7920 6772 6964 2066 6f72  # apply grid for
+00003740: 206c 696e 6520 706c 6f74 7320 6f6e 6c79   line plots only
+00003750: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00003760: 2020 736d 616c 6c65 7374 5f64 6966 6620    smallest_diff 
+00003770: 3d20 6d61 7828 3130 2a2a 282d 6465 6369  = max(10**(-deci
+00003780: 6d61 6c73 292c 2073 6d61 6c6c 6573 745f  mals), smallest_
+00003790: 6469 6666 290d 0a20 2020 2020 2020 2020  diff)..         
+000037a0: 2020 2072 6574 7572 6e20 6465 6369 6d61     return decima
+000037b0: 6c73 2c20 736d 616c 6c65 7374 5f64 6966  ls, smallest_dif
+000037c0: 660d 0a20 2020 2020 2020 2023 2066 6972  f..        # fir
+000037d0: 7374 2063 616c 6375 6c61 7465 2045 5053  st calculate EPS
+000037e0: 2066 6f72 2073 6572 6965 7320 3026 312c   for series 0&1,
+000037f0: 2074 6865 6e20 646f 2064 6563 696d 616c   then do decimal
+00003800: 730d 0a20 2020 2020 2020 2073 6473 203d  s..        sds =
+00003810: 205b 6361 6c63 5f73 6428 7365 6c66 2e79   [calc_sd(self.y
+00003820: 295d 2023 206d 6967 6874 2062 6520 616c  )] # might be al
+00003830: 6c20 7a65 726f 7320 666f 7220 6261 7220  l zeros for bar 
+00003840: 6368 6172 7473 0d0a 2020 2020 2020 2020  charts..        
+00003850: 6966 206c 656e 2873 656c 662e 7363 616c  if len(self.scal
+00003860: 655f 636f 6c73 2920 3e20 313a 0d0a 2020  e_cols) > 1:..  
+00003870: 2020 2020 2020 2020 2020 7364 732e 6170            sds.ap
+00003880: 7065 6e64 2863 616c 635f 7364 2873 656c  pend(calc_sd(sel
+00003890: 662e 7a29 2920 2320 6966 2066 6972 7374  f.z)) # if first
+000038a0: 2069 7320 6f70 656e 2c20 7468 6973 206d   is open, this m
+000038b0: 6967 6874 2062 6520 636c 6f73 650d 0a20  ight be close.. 
+000038c0: 2020 2020 2020 2073 6473 203d 205b 7364         sds = [sd
+000038d0: 2066 6f72 2073 6420 696e 2073 6473 2069   for sd in sds i
+000038e0: 6620 7364 3e30 5d0d 0a20 2020 2020 2020  f sd>0]..       
+000038f0: 2062 6967 5f64 6966 6620 3d20 6d61 7828   big_diff = max(
+00003900: 7364 7329 0d0a 2020 2020 2020 2020 736d  sds)..        sm
+00003910: 616c 6c65 7374 5f64 6966 6620 3d20 6d69  allest_diff = mi
+00003920: 6e28 5b73 6420 666f 7220 7364 2069 6e20  n([sd for sd in 
+00003930: 7364 7320 6966 2073 643e 6269 675f 6469  sds if sd>big_di
+00003940: 6666 2f31 3030 5d29 2023 2066 696c 7465  ff/100]) # filte
+00003950: 7220 6f75 7420 6578 7472 656d 656c 7920  r out extremely 
+00003960: 736d 616c 6c20 6570 7369 6c6f 6e73 0d0a  small epsilons..
+00003970: 2020 2020 2020 2020 7365 7220 3d20 7365          ser = se
+00003980: 6c66 2e7a 2069 6620 6c65 6e28 7365 6c66  lf.z if len(self
+00003990: 2e73 6361 6c65 5f63 6f6c 7329 203e 2031  .scale_cols) > 1
+000039a0: 2065 6c73 6520 7365 6c66 2e79 0d0a 2020   else self.y..  
+000039b0: 2020 2020 2020 7265 7475 726e 2063 616c        return cal
+000039c0: 635f 6465 6328 7365 722c 2073 6d61 6c6c  c_dec(ser, small
+000039d0: 6573 745f 6469 6666 290d 0a0d 0a20 2020  est_diff)....   
+000039e0: 2064 6566 2075 7064 6174 655f 696e 6974   def update_init
+000039f0: 5f78 2873 656c 662c 2069 6e69 745f 7374  _x(self, init_st
+00003a00: 6570 7329 3a0d 0a20 2020 2020 2020 2073  eps):..        s
+00003a10: 656c 662e 696e 6974 5f78 302c 2073 656c  elf.init_x0, sel
+00003a20: 662e 696e 6974 5f78 3120 3d20 5f78 6d69  f.init_x1 = _xmi
+00003a30: 6e6d 6178 2873 656c 662c 2078 5f69 6e64  nmax(self, x_ind
+00003a40: 6578 6564 3d54 7275 652c 2069 6e69 745f  exed=True, init_
+00003a50: 7374 6570 733d 696e 6974 5f73 7465 7073  steps=init_steps
+00003a60: 290d 0a0d 0a20 2020 2064 6566 2063 6c6f  )....    def clo
+00003a70: 7365 7374 5f74 696d 6528 7365 6c66 2c20  sest_time(self, 
+00003a80: 7829 3a0d 0a20 2020 2020 2020 2074 696d  x):..        tim
+00003a90: 6563 6f6c 203d 2073 656c 662e 6466 2e63  ecol = self.df.c
+00003aa0: 6f6c 756d 6e73 5b30 5d0d 0a20 2020 2020  olumns[0]..     
+00003ab0: 2020 2072 6574 7572 6e20 7365 6c66 2e64     return self.d
+00003ac0: 662e 6c6f 635b 696e 7428 7829 2c20 7469  f.loc[int(x), ti
+00003ad0: 6d65 636f 6c5d 0d0a 0d0a 2020 2020 6465  mecol]....    de
+00003ae0: 6620 7469 6d65 6261 7365 6428 7365 6c66  f timebased(self
+00003af0: 293a 0d0a 2020 2020 2020 2020 7265 7475  ):..        retu
+00003b00: 726e 2073 656c 662e 6466 2e69 6c6f 635b  rn self.df.iloc[
+00003b10: 2d31 2c30 5d20 3e20 3165 370d 0a0d 0a20  -1,0] > 1e7.... 
+00003b20: 2020 2064 6566 2069 735f 736d 6f6f 7468     def is_smooth
+00003b30: 5f74 696d 6528 7365 6c66 293a 0d0a 2020  _time(self):..  
+00003b40: 2020 2020 2020 6966 2073 656c 662e 5f73        if self._s
+00003b50: 6d6f 6f74 685f 7469 6d65 2069 7320 4e6f  mooth_time is No
+00003b60: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
+00003b70: 2023 206c 6573 7320 7468 616e 2031 2520   # less than 1% 
+00003b80: 7469 6d65 2064 656c 7461 2069 7320 736d  time delta is sm
+00003b90: 6f6f 7468 0d0a 2020 2020 2020 2020 2020  ooth..          
+00003ba0: 2020 7365 6c66 2e5f 736d 6f6f 7468 5f74    self._smooth_t
+00003bb0: 696d 6520 3d20 7365 6c66 2e74 696d 6562  ime = self.timeb
+00003bc0: 6173 6564 2829 2061 6e64 2028 6e70 2e61  ased() and (np.a
+00003bd0: 6273 286e 702e 6469 6666 2873 656c 662e  bs(np.diff(self.
+00003be0: 782e 7661 6c75 6573 5b31 3a31 3030 5d29  x.values[1:100])
+00003bf0: 5b31 3a5d 2f2f 2873 656c 662e 7065 7269  [1:]//(self.peri
+00003c00: 6f64 5f6e 732f 2f31 3030 3029 2d31 3030  od_ns//1000)-100
+00003c10: 3029 203c 2031 3029 2e61 6c6c 2829 0d0a  0) < 10).all()..
+00003c20: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+00003c30: 656c 662e 5f73 6d6f 6f74 685f 7469 6d65  elf._smooth_time
+00003c40: 0d0a 0d0a 2020 2020 6465 6620 6164 6463  ....    def addc
+00003c50: 6f6c 7328 7365 6c66 2c20 6461 7461 7372  ols(self, datasr
+00003c60: 6329 3a0d 0a20 2020 2020 2020 206e 6577  c):..        new
+00003c70: 5f73 6361 6c65 5f63 6f6c 7320 3d20 5b63  _scale_cols = [c
+00003c80: 2b6c 656e 2873 656c 662e 6466 2e63 6f6c  +len(self.df.col
+00003c90: 756d 6e73 292d 6461 7461 7372 632e 636f  umns)-datasrc.co
+00003ca0: 6c5f 6461 7461 5f6f 6666 7365 7420 666f  l_data_offset fo
+00003cb0: 7220 6320 696e 2064 6174 6173 7263 2e73  r c in datasrc.s
+00003cc0: 6361 6c65 5f63 6f6c 735d 0d0a 2020 2020  cale_cols]..    
+00003cd0: 2020 2020 7365 6c66 2e73 6361 6c65 5f63      self.scale_c
+00003ce0: 6f6c 7320 2b3d 206e 6577 5f73 6361 6c65  ols += new_scale
+00003cf0: 5f63 6f6c 730d 0a20 2020 2020 2020 206f  _cols..        o
+00003d00: 7269 675f 636f 6c5f 6461 7461 5f63 6e74  rig_col_data_cnt
+00003d10: 203d 206c 656e 2873 656c 662e 6466 2e63   = len(self.df.c
+00003d20: 6f6c 756d 6e73 290d 0a20 2020 2020 2020  olumns)..       
+00003d30: 2069 6620 5f68 6173 5f74 696d 6563 6f6c   if _has_timecol
+00003d40: 2864 6174 6173 7263 2e64 6629 3a0d 0a20  (datasrc.df):.. 
+00003d50: 2020 2020 2020 2020 2020 2074 696d 6563             timec
+00003d60: 6f6c 203d 2073 656c 662e 6466 2e63 6f6c  ol = self.df.col
+00003d70: 756d 6e73 5b30 5d0d 0a20 2020 2020 2020  umns[0]..       
+00003d80: 2020 2020 2064 6620 3d20 7365 6c66 2e64       df = self.d
+00003d90: 662e 7365 745f 696e 6465 7828 7469 6d65  f.set_index(time
+00003da0: 636f 6c29 0d0a 2020 2020 2020 2020 2020  col)..          
+00003db0: 2020 7469 6d65 636f 6c20 3d20 7469 6d65    timecol = time
+00003dc0: 636f 6c20 6966 2074 696d 6563 6f6c 2069  col if timecol i
+00003dd0: 6e20 6461 7461 7372 632e 6466 2e63 6f6c  n datasrc.df.col
+00003de0: 756d 6e73 2065 6c73 6520 6461 7461 7372  umns else datasr
+00003df0: 632e 6466 2e63 6f6c 756d 6e73 5b30 5d0d  c.df.columns[0].
+00003e00: 0a20 2020 2020 2020 2020 2020 206e 6577  .            new
+00003e10: 636f 6c73 203d 2064 6174 6173 7263 2e64  cols = datasrc.d
+00003e20: 662e 7365 745f 696e 6465 7828 7469 6d65  f.set_index(time
+00003e30: 636f 6c29 0d0a 2020 2020 2020 2020 656c  col)..        el
+00003e40: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
+00003e50: 2064 6620 3d20 7365 6c66 2e64 660d 0a20   df = self.df.. 
+00003e60: 2020 2020 2020 2020 2020 206e 6577 636f             newco
+00003e70: 6c73 203d 2064 6174 6173 7263 2e64 660d  ls = datasrc.df.
+00003e80: 0a20 2020 2020 2020 2063 6f6c 7320 3d20  .        cols = 
+00003e90: 6c69 7374 286e 6577 636f 6c73 2e63 6f6c  list(newcols.col
+00003ea0: 756d 6e73 290d 0a20 2020 2020 2020 2066  umns)..        f
+00003eb0: 6f72 2069 2c63 6f6c 2069 6e20 656e 756d  or i,col in enum
+00003ec0: 6572 6174 6528 636f 6c73 293a 0d0a 2020  erate(cols):..  
+00003ed0: 2020 2020 2020 2020 2020 6f6c 645f 636f            old_co
+00003ee0: 6c20 3d20 636f 6c0d 0a20 2020 2020 2020  l = col..       
+00003ef0: 2020 2020 2077 6869 6c65 2063 6f6c 2069       while col i
+00003f00: 6e20 7365 6c66 2e64 662e 636f 6c75 6d6e  n self.df.column
+00003f10: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
+00003f20: 2020 2020 636f 6c73 5b69 5d20 3d20 636f      cols[i] = co
+00003f30: 6c20 3d20 7374 7228 636f 6c29 2b27 2b27  l = str(col)+'+'
+00003f40: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+00003f50: 206f 6c64 5f63 6f6c 2021 3d20 636f 6c3a   old_col != col:
+00003f60: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00003f70: 2020 6461 7461 7372 632e 7265 6e61 6d65    datasrc.rename
+00003f80: 735b 6f6c 645f 636f 6c5d 203d 2063 6f6c  s[old_col] = col
+00003f90: 0d0a 2020 2020 2020 2020 6e65 7763 6f6c  ..        newcol
+00003fa0: 732e 636f 6c75 6d6e 7320 3d20 636f 6c73  s.columns = cols
+00003fb0: 0d0a 2020 2020 2020 2020 7365 6c66 2e64  ..        self.d
+00003fc0: 6620 3d20 6466 2e6a 6f69 6e28 6e65 7763  f = df.join(newc
+00003fd0: 6f6c 732c 2068 6f77 3d27 6f75 7465 7227  ols, how='outer'
+00003fe0: 290d 0a20 2020 2020 2020 2069 6620 5f68  )..        if _h
+00003ff0: 6173 5f74 696d 6563 6f6c 2864 6174 6173  as_timecol(datas
+00004000: 7263 2e64 6629 3a0d 0a20 2020 2020 2020  rc.df):..       
+00004010: 2020 2020 2073 656c 662e 6466 2e72 6573       self.df.res
+00004020: 6574 5f69 6e64 6578 2869 6e70 6c61 6365  et_index(inplace
+00004030: 3d54 7275 6529 0d0a 2020 2020 2020 2020  =True)..        
+00004040: 6461 7461 7372 632e 6466 203d 2073 656c  datasrc.df = sel
+00004050: 662e 6466 2023 2074 6865 7920 6172 6520  f.df # they are 
+00004060: 7468 6520 7361 6d65 206e 6f77 0d0a 2020  the same now..  
+00004070: 2020 2020 2020 6461 7461 7372 632e 696e        datasrc.in
+00004080: 6974 5f78 3020 3d20 7365 6c66 2e69 6e69  it_x0 = self.ini
+00004090: 745f 7830 0d0a 2020 2020 2020 2020 6461  t_x0..        da
+000040a0: 7461 7372 632e 696e 6974 5f78 3120 3d20  tasrc.init_x1 = 
+000040b0: 7365 6c66 2e69 6e69 745f 7831 0d0a 2020  self.init_x1..  
+000040c0: 2020 2020 2020 6461 7461 7372 632e 636f        datasrc.co
+000040d0: 6c5f 6461 7461 5f6f 6666 7365 7420 3d20  l_data_offset = 
+000040e0: 6f72 6967 5f63 6f6c 5f64 6174 615f 636e  orig_col_data_cn
+000040f0: 740d 0a20 2020 2020 2020 2064 6174 6173  t..        datas
+00004100: 7263 2e73 6361 6c65 5f63 6f6c 7320 3d20  rc.scale_cols = 
+00004110: 6e65 775f 7363 616c 655f 636f 6c73 0d0a  new_scale_cols..
+00004120: 2020 2020 2020 2020 7365 6c66 2e63 6163          self.cac
+00004130: 6865 5f68 696c 6f20 3d20 4f72 6465 7265  he_hilo = Ordere
+00004140: 6444 6963 7428 290d 0a20 2020 2020 2020  dDict()..       
+00004150: 2073 656c 662e 5f70 6572 696f 6420 3d20   self._period = 
+00004160: 7365 6c66 2e5f 736d 6f6f 7468 5f74 696d  self._smooth_tim
+00004170: 6520 3d20 4e6f 6e65 0d0a 2020 2020 2020  e = None..      
+00004180: 2020 6461 7461 7372 632e 5f70 6572 696f    datasrc._perio
+00004190: 6420 3d20 6461 7461 7372 632e 5f73 6d6f  d = datasrc._smo
+000041a0: 6f74 685f 7469 6d65 203d 204e 6f6e 650d  oth_time = None.
+000041b0: 0a20 2020 2020 2020 206c 6466 3220 3d20  .        ldf2 = 
+000041c0: 6c65 6e28 7365 6c66 2e64 6629 202f 2f20  len(self.df) // 
+000041d0: 320d 0a20 2020 2020 2020 2073 656c 662e  2..        self.
+000041e0: 6973 5f73 7061 7273 6520 3d20 7365 6c66  is_sparse = self
+000041f0: 2e69 735f 7370 6172 7365 206f 7220 7365  .is_sparse or se
+00004200: 6c66 2e64 665b 7365 6c66 2e64 662e 636f  lf.df[self.df.co
+00004210: 6c75 6d6e 735b 7365 6c66 2e63 6f6c 5f64  lumns[self.col_d
+00004220: 6174 615f 6f66 6673 6574 5d5d 2e69 736e  ata_offset]].isn
+00004230: 756c 6c28 292e 7375 6d28 292e 6d61 7828  ull().sum().max(
+00004240: 2920 3e20 6c64 6632 0d0a 2020 2020 2020  ) > ldf2..      
+00004250: 2020 6461 7461 7372 632e 6973 5f73 7061    datasrc.is_spa
+00004260: 7273 6520 3d20 6461 7461 7372 632e 6973  rse = datasrc.is
+00004270: 5f73 7061 7273 6520 6f72 2064 6174 6173  _sparse or datas
+00004280: 7263 2e64 665b 6461 7461 7372 632e 6466  rc.df[datasrc.df
+00004290: 2e63 6f6c 756d 6e73 5b64 6174 6173 7263  .columns[datasrc
+000042a0: 2e63 6f6c 5f64 6174 615f 6f66 6673 6574  .col_data_offset
+000042b0: 5d5d 2e69 736e 756c 6c28 292e 7375 6d28  ]].isnull().sum(
+000042c0: 292e 6d61 7828 2920 3e20 6c64 6632 0d0a  ).max() > ldf2..
+000042d0: 0d0a 2020 2020 6465 6620 7570 6461 7465  ..    def update
+000042e0: 2873 656c 662c 2064 6174 6173 7263 293a  (self, datasrc):
+000042f0: 0d0a 2020 2020 2020 2020 6466 203d 2073  ..        df = s
+00004300: 656c 662e 7072 655f 7570 6461 7465 2873  elf.pre_update(s
+00004310: 656c 662e 6466 290d 0a20 2020 2020 2020  elf.df)..       
+00004320: 206f 7269 675f 636f 6c73 203d 206c 6973   orig_cols = lis
+00004330: 7428 6466 2e63 6f6c 756d 6e73 290d 0a20  t(df.columns).. 
+00004340: 2020 2020 2020 2074 696d 6563 6f6c 2c6f         timecol,o
+00004350: 7269 675f 636f 6c73 203d 206f 7269 675f  rig_cols = orig_
+00004360: 636f 6c73 5b30 5d2c 6f72 6967 5f63 6f6c  cols[0],orig_col
+00004370: 735b 313a 5d0d 0a20 2020 2020 2020 2064  s[1:]..        d
+00004380: 6620 3d20 6466 2e73 6574 5f69 6e64 6578  f = df.set_index
+00004390: 2874 696d 6563 6f6c 290d 0a20 2020 2020  (timecol)..     
+000043a0: 2020 2069 6e70 7574 5f64 6620 3d20 6461     input_df = da
+000043b0: 7461 7372 632e 6466 2e73 6574 5f69 6e64  tasrc.df.set_ind
+000043c0: 6578 2864 6174 6173 7263 2e64 662e 636f  ex(datasrc.df.co
+000043d0: 6c75 6d6e 735b 305d 290d 0a20 2020 2020  lumns[0])..     
+000043e0: 2020 2069 6e70 7574 5f64 662e 636f 6c75     input_df.colu
+000043f0: 6d6e 7320 3d20 5b73 656c 662e 7265 6e61  mns = [self.rena
+00004400: 6d65 732e 6765 7428 636f 6c2c 2063 6f6c  mes.get(col, col
+00004410: 2920 666f 7220 636f 6c20 696e 2069 6e70  ) for col in inp
+00004420: 7574 5f64 662e 636f 6c75 6d6e 735d 0d0a  ut_df.columns]..
+00004430: 2020 2020 2020 2020 2320 7061 6420 696e          # pad in
+00004440: 6465 7820 6966 2074 6865 2069 6e70 7574  dex if the input
+00004450: 2064 6174 6120 6973 2061 2073 7562 2d73   data is a sub-s
+00004460: 6574 0d0a 2020 2020 2020 2020 6f75 7470  et..        outp
+00004470: 7574 5f64 6620 3d20 7064 2e6d 6572 6765  ut_df = pd.merge
+00004480: 2869 6e70 7574 5f64 662c 2064 665b 5b5d  (input_df, df[[]
+00004490: 5d2c 2068 6f77 3d27 6f75 7465 7227 2c20  ], how='outer', 
+000044a0: 6c65 6674 5f69 6e64 6578 3d54 7275 652c  left_index=True,
+000044b0: 2072 6967 6874 5f69 6e64 6578 3d54 7275   right_index=Tru
+000044c0: 6529 0d0a 2020 2020 2020 2020 666f 7220  e)..        for 
+000044d0: 636f 6c20 696e 2064 662e 636f 6c75 6d6e  col in df.column
+000044e0: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
+000044f0: 6966 2063 6f6c 206e 6f74 2069 6e20 6f75  if col not in ou
+00004500: 7470 7574 5f64 662e 636f 6c75 6d6e 733a  tput_df.columns:
+00004510: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00004520: 2020 6f75 7470 7574 5f64 665b 636f 6c5d    output_df[col]
+00004530: 203d 2064 665b 636f 6c5d 0d0a 2020 2020   = df[col]..    
+00004540: 2020 2020 2320 6966 206e 6563 6365 7373      # if neccess
+00004550: 6172 792c 2063 7574 206f 7574 2075 6e77  ary, cut out unw
+00004560: 616e 7465 6420 6461 7461 0d0a 2020 2020  anted data..    
+00004570: 2020 2020 6966 206c 656e 2869 6e70 7574      if len(input
+00004580: 5f64 6629 203e 2030 2061 6e64 206c 656e  _df) > 0 and len
+00004590: 2864 6629 203e 2030 3a0d 0a20 2020 2020  (df) > 0:..     
+000045a0: 2020 2020 2020 2073 7461 7274 5f69 6478         start_idx
+000045b0: 203d 2065 6e64 5f69 6478 203d 204e 6f6e   = end_idx = Non
+000045c0: 650d 0a20 2020 2020 2020 2020 2020 2069  e..            i
+000045d0: 6620 696e 7075 745f 6466 2e69 6e64 6578  f input_df.index
+000045e0: 5b30 5d20 3e20 6466 2e69 6e64 6578 5b30  [0] > df.index[0
+000045f0: 5d3a 0d0a 2020 2020 2020 2020 2020 2020  ]:..            
+00004600: 2020 2020 7374 6172 745f 6964 7820 3d20      start_idx = 
+00004610: 300d 0a20 2020 2020 2020 2020 2020 2069  0..            i
+00004620: 6620 696e 7075 745f 6466 2e69 6e64 6578  f input_df.index
+00004630: 5b2d 315d 203c 2064 662e 696e 6465 785b  [-1] < df.index[
+00004640: 2d31 5d3a 0d0a 2020 2020 2020 2020 2020  -1]:..          
+00004650: 2020 2020 2020 656e 645f 6964 7820 3d20        end_idx = 
+00004660: 2d31 0d0a 2020 2020 2020 2020 2020 2020  -1..            
+00004670: 6966 2073 7461 7274 5f69 6478 2069 7320  if start_idx is 
+00004680: 6e6f 7420 4e6f 6e65 206f 7220 656e 645f  not None or end_
+00004690: 6964 7820 6973 206e 6f74 204e 6f6e 653a  idx is not None:
+000046a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000046b0: 2020 6f75 7470 7574 5f64 6620 3d20 6f75    output_df = ou
+000046c0: 7470 7574 5f64 662e 6c6f 635b 696e 7075  tput_df.loc[inpu
+000046d0: 745f 6466 2e69 6e64 6578 5b73 7461 7274  t_df.index[start
+000046e0: 5f69 6478 3a65 6e64 5f69 6478 5d2c 203a  _idx:end_idx], :
+000046f0: 5d0d 0a20 2020 2020 2020 206f 7574 7075  ]..        outpu
+00004700: 745f 6466 203d 2073 656c 662e 706f 7374  t_df = self.post
+00004710: 5f75 7064 6174 6528 6f75 7470 7574 5f64  _update(output_d
+00004720: 6629 0d0a 2020 2020 2020 2020 6f75 7470  f)..        outp
+00004730: 7574 5f64 6620 3d20 6f75 7470 7574 5f64  ut_df = output_d
+00004740: 662e 7265 7365 745f 696e 6465 7828 290d  f.reset_index().
+00004750: 0a20 2020 2020 2020 2073 656c 662e 6466  .        self.df
+00004760: 203d 206f 7574 7075 745f 6466 5b5b 6f75   = output_df[[ou
+00004770: 7470 7574 5f64 662e 636f 6c75 6d6e 735b  tput_df.columns[
+00004780: 305d 5d2b 6f72 6967 5f63 6f6c 735d 2069  0]]+orig_cols] i
+00004790: 6620 6f72 6967 5f63 6f6c 7320 656c 7365  f orig_cols else
+000047a0: 206f 7574 7075 745f 6466 0d0a 2020 2020   output_df..    
+000047b0: 2020 2020 7365 6c66 2e69 6e69 745f 7831      self.init_x1
+000047c0: 203d 2073 656c 662e 786c 656e 202b 2072   = self.xlen + r
+000047d0: 6967 6874 5f6d 6172 6769 6e5f 6361 6e64  ight_margin_cand
+000047e0: 6c65 7320 2d20 7369 6465 5f6d 6172 6769  les - side_margi
+000047f0: 6e0d 0a20 2020 2020 2020 2073 656c 662e  n..        self.
+00004800: 6361 6368 655f 6869 6c6f 203d 204f 7264  cache_hilo = Ord
+00004810: 6572 6564 4469 6374 2829 0d0a 2020 2020  eredDict()..    
+00004820: 2020 2020 7365 6c66 2e5f 7065 7269 6f64      self._period
+00004830: 203d 2073 656c 662e 5f73 6d6f 6f74 685f   = self._smooth_
+00004840: 7469 6d65 203d 204e 6f6e 650d 0a0d 0a20  time = None.... 
+00004850: 2020 2064 6566 2073 6574 5f64 6628 7365     def set_df(se
+00004860: 6c66 2c20 6466 293a 0d0a 2020 2020 2020  lf, df):..      
+00004870: 2020 7365 6c66 2e64 6620 3d20 6466 0d0a    self.df = df..
+00004880: 2020 2020 2020 2020 7365 6c66 2e63 6163          self.cac
+00004890: 6865 5f68 696c 6f20 3d20 4f72 6465 7265  he_hilo = Ordere
+000048a0: 6444 6963 7428 290d 0a20 2020 2020 2020  dDict()..       
+000048b0: 2073 656c 662e 5f70 6572 696f 6420 3d20   self._period = 
+000048c0: 7365 6c66 2e5f 736d 6f6f 7468 5f74 696d  self._smooth_tim
+000048d0: 6520 3d20 4e6f 6e65 0d0a 0d0a 2020 2020  e = None....    
+000048e0: 6465 6620 6869 6c6f 2873 656c 662c 2078  def hilo(self, x
+000048f0: 302c 2078 3129 3a0d 0a20 2020 2020 2020  0, x1):..       
+00004900: 2027 2727 5265 7475 726e 2066 6976 6520   '''Return five 
+00004910: 7661 6c75 6573 2069 6e20 7469 6d65 2072  values in time r
+00004920: 616e 6765 3a20 7430 2c20 7431 2c20 6869  ange: t0, t1, hi
+00004930: 6768 6573 742c 206c 6f77 6573 742c 206e  ghest, lowest, n
+00004940: 756d 6265 7220 6f66 2072 6f77 732e 2727  umber of rows.''
+00004950: 270d 0a20 2020 2020 2020 2069 6620 7830  '..        if x0
+00004960: 203d 3d20 7831 3a0d 0a20 2020 2020 2020   == x1:..       
+00004970: 2020 2020 2078 3020 3d20 7831 203d 2069       x0 = x1 = i
+00004980: 6e74 2878 3129 0d0a 2020 2020 2020 2020  nt(x1)..        
+00004990: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
+000049a0: 2020 2078 302c 7831 203d 2069 6e74 2878     x0,x1 = int(x
+000049b0: 302b 302e 3529 2c69 6e74 2878 3129 0d0a  0+0.5),int(x1)..
+000049c0: 2020 2020 2020 2020 7175 6572 7920 3d20          query = 
+000049d0: 2725 692c 2569 2720 2520 2878 302c 7831  '%i,%i' % (x0,x1
+000049e0: 290d 0a20 2020 2020 2020 2069 6620 7175  )..        if qu
+000049f0: 6572 7920 6e6f 7420 696e 2073 656c 662e  ery not in self.
+00004a00: 6361 6368 655f 6869 6c6f 3a0d 0a20 2020  cache_hilo:..   
+00004a10: 2020 2020 2020 2020 2076 203d 2073 656c           v = sel
+00004a20: 662e 6361 6368 655f 6869 6c6f 5b71 7565  f.cache_hilo[que
+00004a30: 7279 5d20 3d20 7365 6c66 2e5f 6869 6c6f  ry] = self._hilo
+00004a40: 2878 302c 2078 3129 0d0a 2020 2020 2020  (x0, x1)..      
+00004a50: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
+00004a60: 2020 2020 2023 2072 652d 696e 7365 7274       # re-insert
+00004a70: 2074 6f20 7261 6973 6520 7072 696f 0d0a   to raise prio..
+00004a80: 2020 2020 2020 2020 2020 2020 7620 3d20              v = 
+00004a90: 7365 6c66 2e63 6163 6865 5f68 696c 6f5b  self.cache_hilo[
+00004aa0: 7175 6572 795d 203d 2073 656c 662e 6361  query] = self.ca
+00004ab0: 6368 655f 6869 6c6f 2e70 6f70 2871 7565  che_hilo.pop(que
+00004ac0: 7279 290d 0a20 2020 2020 2020 2069 6620  ry)..        if 
+00004ad0: 6c65 6e28 7365 6c66 2e63 6163 6865 5f68  len(self.cache_h
+00004ae0: 696c 6f29 203e 2031 3030 3a20 2320 6472  ilo) > 100: # dr
+00004af0: 6f70 2069 6620 746f 6f20 6d61 6e79 0d0a  op if too many..
+00004b00: 2020 2020 2020 2020 2020 2020 6465 6c20              del 
+00004b10: 7365 6c66 2e63 6163 6865 5f68 696c 6f5b  self.cache_hilo[
+00004b20: 6e65 7874 2869 7465 7228 7365 6c66 2e63  next(iter(self.c
+00004b30: 6163 6865 5f68 696c 6f29 295d 0d0a 2020  ache_hilo))]..  
+00004b40: 2020 2020 2020 7265 7475 726e 2076 0d0a        return v..
+00004b50: 0d0a 2020 2020 6465 6620 5f68 696c 6f28  ..    def _hilo(
+00004b60: 7365 6c66 2c20 7830 2c20 7831 293a 0d0a  self, x0, x1):..
+00004b70: 2020 2020 2020 2020 6466 203d 2073 656c          df = sel
+00004b80: 662e 6466 2e6c 6f63 5b78 303a 7831 2c20  f.df.loc[x0:x1, 
+00004b90: 3a5d 0d0a 2020 2020 2020 2020 6966 206e  :]..        if n
+00004ba0: 6f74 206c 656e 2864 6629 3a0d 0a20 2020  ot len(df):..   
+00004bb0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00004bc0: 302c 302c 302c 302c 300d 0a20 2020 2020  0,0,0,0,0..     
+00004bd0: 2020 2074 696d 6563 6f6c 203d 2064 662e     timecol = df.
+00004be0: 636f 6c75 6d6e 735b 305d 0d0a 2020 2020  columns[0]..    
+00004bf0: 2020 2020 7430 203d 2064 665b 7469 6d65      t0 = df[time
+00004c00: 636f 6c5d 2e69 6c6f 635b 305d 0d0a 2020  col].iloc[0]..  
+00004c10: 2020 2020 2020 7431 203d 2064 665b 7469        t1 = df[ti
+00004c20: 6d65 636f 6c5d 2e69 6c6f 635b 2d31 5d0d  mecol].iloc[-1].
+00004c30: 0a20 2020 2020 2020 2076 616c 636f 6c73  .        valcols
+00004c40: 203d 2064 662e 636f 6c75 6d6e 735b 7365   = df.columns[se
+00004c50: 6c66 2e73 6361 6c65 5f63 6f6c 735d 0d0a  lf.scale_cols]..
+00004c60: 2020 2020 2020 2020 6869 203d 2064 665b          hi = df[
+00004c70: 7661 6c63 6f6c 735d 2e6d 6178 2829 2e6d  valcols].max().m
+00004c80: 6178 2829 0d0a 2020 2020 2020 2020 6c6f  ax()..        lo
+00004c90: 203d 2064 665b 7661 6c63 6f6c 735d 2e6d   = df[valcols].m
+00004ca0: 696e 2829 2e6d 696e 2829 0d0a 2020 2020  in().min()..    
+00004cb0: 2020 2020 7265 7475 726e 2074 302c 7431      return t0,t1
+00004cc0: 2c68 692c 6c6f 2c6c 656e 2864 6629 0d0a  ,hi,lo,len(df)..
+00004cd0: 0d0a 2020 2020 6465 6620 726f 7773 2873  ..    def rows(s
+00004ce0: 656c 662c 2063 6f6c 636e 742c 2078 302c  elf, colcnt, x0,
+00004cf0: 2078 312c 2079 7363 616c 652c 206c 6f64   x1, yscale, lod
+00004d00: 3d54 7275 652c 2072 6573 616d 703d 4e6f  =True, resamp=No
+00004d10: 6e65 293a 0d0a 2020 2020 2020 2020 6466  ne):..        df
+00004d20: 203d 2073 656c 662e 6466 2e6c 6f63 5b78   = self.df.loc[x
+00004d30: 303a 7831 2c20 3a5d 0d0a 2020 2020 2020  0:x1, :]..      
+00004d40: 2020 6966 2073 656c 662e 6973 5f73 7061    if self.is_spa
+00004d50: 7273 653a 0d0a 2020 2020 2020 2020 2020  rse:..          
+00004d60: 2020 6466 203d 2064 662e 6c6f 635b 6466    df = df.loc[df
+00004d70: 2e69 6c6f 635b 3a2c 7365 6c66 2e63 6f6c  .iloc[:,self.col
+00004d80: 5f64 6174 615f 6f66 6673 6574 5d2e 6e6f  _data_offset].no
+00004d90: 746e 6128 292c 203a 5d0d 0a20 2020 2020  tna(), :]..     
+00004da0: 2020 206f 7269 676c 656e 203d 206c 656e     origlen = len
+00004db0: 2864 6629 0d0a 2020 2020 2020 2020 7265  (df)..        re
+00004dc0: 7475 726e 2073 656c 662e 5f72 6f77 7328  turn self._rows(
+00004dd0: 6466 2c20 636f 6c63 6e74 2c20 7973 6361  df, colcnt, ysca
+00004de0: 6c65 3d79 7363 616c 652c 206c 6f64 3d6c  le=yscale, lod=l
+00004df0: 6f64 2c20 7265 7361 6d70 3d72 6573 616d  od, resamp=resam
+00004e00: 7029 2c20 6f72 6967 6c65 6e0d 0a0d 0a20  p), origlen.... 
+00004e10: 2020 2064 6566 205f 726f 7773 2873 656c     def _rows(sel
+00004e20: 662c 2064 662c 2063 6f6c 636e 742c 2079  f, df, colcnt, y
+00004e30: 7363 616c 652c 206c 6f64 2c20 7265 7361  scale, lod, resa
+00004e40: 6d70 293a 0d0a 2020 2020 2020 2020 6966  mp):..        if
+00004e50: 206c 6f64 2061 6e64 206c 656e 2864 6629   lod and len(df)
+00004e60: 203e 206c 6f64 5f63 616e 646c 6573 3a0d   > lod_candles:.
+00004e70: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00004e80: 7265 7361 6d70 3a0d 0a20 2020 2020 2020  resamp:..       
+00004e90: 2020 2020 2020 2020 2064 6620 3d20 7365           df = se
+00004ea0: 6c66 2e5f 7265 7361 6d70 6c65 2864 662c  lf._resample(df,
+00004eb0: 2063 6f6c 636e 742c 2072 6573 616d 7029   colcnt, resamp)
+00004ec0: 0d0a 2020 2020 2020 2020 2020 2020 656c  ..            el
+00004ed0: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
+00004ee0: 2020 2020 2064 6620 3d20 6466 2e69 6c6f       df = df.ilo
+00004ef0: 635b 3a3a 6c65 6e28 6466 292f 2f6c 6f64  c[::len(df)//lod
+00004f00: 5f63 616e 646c 6573 5d0d 0a20 2020 2020  _candles]..     
+00004f10: 2020 2063 6f6c 636e 7420 2d3d 2031 2023     colcnt -= 1 #
+00004f20: 2074 696d 6520 6973 2061 6c77 6179 7320   time is always 
+00004f30: 696d 706c 6965 640d 0a20 2020 2020 2020  implied..       
+00004f40: 2063 6f6c 6964 7873 203d 205b 305d 202b   colidxs = [0] +
+00004f50: 206c 6973 7428 7261 6e67 6528 7365 6c66   list(range(self
+00004f60: 2e63 6f6c 5f64 6174 615f 6f66 6673 6574  .col_data_offset
+00004f70: 2c20 7365 6c66 2e63 6f6c 5f64 6174 615f  , self.col_data_
+00004f80: 6f66 6673 6574 2b63 6f6c 636e 7429 290d  offset+colcnt)).
+00004f90: 0a20 2020 2020 2020 2064 6672 203d 2064  .        dfr = d
+00004fa0: 662e 696c 6f63 5b3a 2c63 6f6c 6964 7873  f.iloc[:,colidxs
+00004fb0: 5d0d 0a20 2020 2020 2020 2069 6620 7973  ]..        if ys
+00004fc0: 6361 6c65 2e73 6361 6c65 7479 7065 203d  cale.scaletype =
+00004fd0: 3d20 276c 6f67 2720 6f72 2079 7363 616c  = 'log' or yscal
+00004fe0: 652e 7363 616c 6566 2021 3d20 313a 0d0a  e.scalef != 1:..
+00004ff0: 2020 2020 2020 2020 2020 2020 6466 7220              dfr 
+00005000: 3d20 6466 722e 636f 7079 2829 0d0a 2020  = dfr.copy()..  
+00005010: 2020 2020 2020 2020 2020 666f 7220 6920            for i 
+00005020: 696e 2072 616e 6765 2831 2c20 636f 6c63  in range(1, colc
+00005030: 6e74 2b31 293a 0d0a 2020 2020 2020 2020  nt+1):..        
+00005040: 2020 2020 2020 2020 636f 6c6e 616d 6520          colname 
+00005050: 3d20 6466 722e 636f 6c75 6d6e 735b 695d  = dfr.columns[i]
+00005060: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00005070: 2020 6966 2064 6672 5b63 6f6c 6e61 6d65    if dfr[colname
+00005080: 5d2e 6474 7970 6520 213d 206f 626a 6563  ].dtype != objec
+00005090: 743a 0d0a 2020 2020 2020 2020 2020 2020  t:..            
+000050a0: 2020 2020 2020 2020 6466 725b 636f 6c6e          dfr[coln
+000050b0: 616d 655d 203d 2079 7363 616c 652e 696e  ame] = yscale.in
+000050c0: 7678 666f 726d 2864 6672 2e69 6c6f 635b  vxform(dfr.iloc[
+000050d0: 3a2c 695d 290d 0a20 2020 2020 2020 2072  :,i])..        r
+000050e0: 6574 7572 6e20 6466 720d 0a0d 0a20 2020  eturn dfr....   
+000050f0: 2064 6566 205f 7265 7361 6d70 6c65 2873   def _resample(s
+00005100: 656c 662c 2064 662c 2063 6f6c 636e 742c  elf, df, colcnt,
+00005110: 2072 6573 616d 7029 3a0d 0a20 2020 2020   resamp):..     
+00005120: 2020 2063 646f 203d 2073 656c 662e 636f     cdo = self.co
+00005130: 6c5f 6461 7461 5f6f 6666 7365 740d 0a20  l_data_offset.. 
+00005140: 2020 2020 2020 2073 616d 706c 655f 7261         sample_ra
+00005150: 7465 203d 206c 656e 2864 6629 202a 2035  te = len(df) * 5
+00005160: 202f 2f20 6c6f 645f 6361 6e64 6c65 730d   // lod_candles.
+00005170: 0a20 2020 2020 2020 206f 6666 7365 7420  .        offset 
+00005180: 3d20 6c65 6e28 6466 2920 2520 7361 6d70  = len(df) % samp
+00005190: 6c65 5f72 6174 650d 0a20 2020 2020 2020  le_rate..       
+000051a0: 2064 6664 203d 2064 665b 5b64 662e 636f   dfd = df[[df.co
+000051b0: 6c75 6d6e 735b 305d 5d2b 5b64 662e 636f  lumns[0]]+[df.co
+000051c0: 6c75 6d6e 735b 6364 6f5d 5d5d 2e69 6c6f  lumns[cdo]]].ilo
+000051d0: 635b 6f66 6673 6574 3a3a 7361 6d70 6c65  c[offset::sample
+000051e0: 5f72 6174 655d 0d0a 2020 2020 2020 2020  _rate]..        
+000051f0: 6320 3d20 6466 5b64 662e 636f 6c75 6d6e  c = df[df.column
+00005200: 735b 6364 6f2b 315d 5d2e 696c 6f63 5b6f  s[cdo+1]].iloc[o
+00005210: 6666 7365 742b 7361 6d70 6c65 5f72 6174  ffset+sample_rat
+00005220: 652d 313a 3a73 616d 706c 655f 7261 7465  e-1::sample_rate
+00005230: 5d0d 0a20 2020 2020 2020 2063 2e69 6e64  ]..        c.ind
+00005240: 6578 202d 3d20 7361 6d70 6c65 5f72 6174  ex -= sample_rat
+00005250: 6520 2d20 310d 0a20 2020 2020 2020 2064  e - 1..        d
+00005260: 6664 5b64 662e 636f 6c75 6d6e 735b 6364  fd[df.columns[cd
+00005270: 6f2b 315d 5d20 3d20 630d 0a20 2020 2020  o+1]] = c..     
+00005280: 2020 2069 6620 7265 7361 6d70 203d 3d20     if resamp == 
+00005290: 2768 696c 6f27 3a0d 0a20 2020 2020 2020  'hilo':..       
+000052a0: 2020 2020 2064 6664 5b64 662e 636f 6c75       dfd[df.colu
+000052b0: 6d6e 735b 6364 6f2b 325d 5d20 3d20 6466  mns[cdo+2]] = df
+000052c0: 5b64 662e 636f 6c75 6d6e 735b 6364 6f2b  [df.columns[cdo+
+000052d0: 325d 5d2e 726f 6c6c 696e 6728 7361 6d70  2]].rolling(samp
+000052e0: 6c65 5f72 6174 6529 2e6d 6178 2829 2e73  le_rate).max().s
+000052f0: 6869 6674 282d 7361 6d70 6c65 5f72 6174  hift(-sample_rat
+00005300: 652b 3129 0d0a 2020 2020 2020 2020 2020  e+1)..          
+00005310: 2020 6466 645b 6466 2e63 6f6c 756d 6e73    dfd[df.columns
+00005320: 5b63 646f 2b33 5d5d 203d 2064 665b 6466  [cdo+3]] = df[df
+00005330: 2e63 6f6c 756d 6e73 5b63 646f 2b33 5d5d  .columns[cdo+3]]
+00005340: 2e72 6f6c 6c69 6e67 2873 616d 706c 655f  .rolling(sample_
+00005350: 7261 7465 292e 6d69 6e28 292e 7368 6966  rate).min().shif
+00005360: 7428 2d73 616d 706c 655f 7261 7465 2b31  t(-sample_rate+1
+00005370: 290d 0a20 2020 2020 2020 2065 6c73 653a  )..        else:
+00005380: 0d0a 2020 2020 2020 2020 2020 2020 6466  ..            df
+00005390: 645b 6466 2e63 6f6c 756d 6e73 5b63 646f  d[df.columns[cdo
+000053a0: 2b32 5d5d 203d 2064 665b 6466 2e63 6f6c  +2]] = df[df.col
+000053b0: 756d 6e73 5b63 646f 2b32 5d5d 2e72 6f6c  umns[cdo+2]].rol
+000053c0: 6c69 6e67 2873 616d 706c 655f 7261 7465  ling(sample_rate
+000053d0: 292e 7375 6d28 292e 7368 6966 7428 2d73  ).sum().shift(-s
+000053e0: 616d 706c 655f 7261 7465 2b31 290d 0a20  ample_rate+1).. 
+000053f0: 2020 2020 2020 2020 2020 2064 6664 5b64             dfd[d
+00005400: 662e 636f 6c75 6d6e 735b 6364 6f2b 335d  f.columns[cdo+3]
+00005410: 5d20 3d20 6466 5b64 662e 636f 6c75 6d6e  ] = df[df.column
+00005420: 735b 6364 6f2b 335d 5d2e 726f 6c6c 696e  s[cdo+3]].rollin
+00005430: 6728 7361 6d70 6c65 5f72 6174 6529 2e73  g(sample_rate).s
+00005440: 756d 2829 2e73 6869 6674 282d 7361 6d70  um().shift(-samp
+00005450: 6c65 5f72 6174 652b 3129 0d0a 2020 2020  le_rate+1)..    
+00005460: 2020 2020 2320 6170 7065 6e64 2074 7261      # append tra
+00005470: 696c 696e 6720 636f 6c75 6d6e 730d 0a20  iling columns.. 
+00005480: 2020 2020 2020 2074 7261 696c 696e 675f         trailing_
+00005490: 636f 6c69 6478 203d 2063 646f 202b 2034  colidx = cdo + 4
+000054a0: 0d0a 2020 2020 2020 2020 666f 7220 6920  ..        for i 
+000054b0: 696e 2072 616e 6765 2874 7261 696c 696e  in range(trailin
+000054c0: 675f 636f 6c69 6478 2c20 636f 6c63 6e74  g_colidx, colcnt
+000054d0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+000054e0: 636f 6c20 3d20 6466 2e63 6f6c 756d 6e73  col = df.columns
+000054f0: 5b69 5d0d 0a20 2020 2020 2020 2020 2020  [i]..           
+00005500: 2064 6664 5b63 6f6c 5d20 3d20 6466 5b63   dfd[col] = df[c
+00005510: 6f6c 5d2e 696c 6f63 5b6f 6666 7365 743a  ol].iloc[offset:
+00005520: 3a73 616d 706c 655f 7261 7465 5d0d 0a20  :sample_rate].. 
+00005530: 2020 2020 2020 2072 6574 7572 6e20 6466         return df
+00005540: 640d 0a0d 0a20 2020 2064 6566 205f 5f65  d....    def __e
+00005550: 715f 5f28 7365 6c66 2c20 6f74 6865 7229  q__(self, other)
+00005560: 3a0d 0a20 2020 2020 2020 2072 6574 7572  :..        retur
+00005570: 6e20 6964 2873 656c 6629 203d 3d20 6964  n id(self) == id
+00005580: 286f 7468 6572 2920 6f72 2069 6428 7365  (other) or id(se
+00005590: 6c66 2e64 6629 203d 3d20 6964 286f 7468  lf.df) == id(oth
+000055a0: 6572 2e64 6629 0d0a 0d0a 2020 2020 6465  er.df)....    de
+000055b0: 6620 5f5f 6861 7368 5f5f 2873 656c 6629  f __hash__(self)
+000055c0: 3a0d 0a20 2020 2020 2020 2072 6574 7572  :..        retur
+000055d0: 6e20 6964 2873 656c 6629 0d0a 0d0a 0d0a  n id(self)......
+000055e0: 636c 6173 7320 4669 6e57 696e 646f 7728  class FinWindow(
+000055f0: 7067 2e47 7261 7068 6963 734c 6179 6f75  pg.GraphicsLayou
+00005600: 7457 6964 6765 7429 3a0d 0a20 2020 2064  tWidget):..    d
+00005610: 6566 205f 5f69 6e69 745f 5f28 7365 6c66  ef __init__(self
+00005620: 2c20 7469 746c 652c 202a 2a6b 7761 7267  , title, **kwarg
+00005630: 7329 3a0d 0a20 2020 2020 2020 2067 6c6f  s):..        glo
+00005640: 6261 6c20 7769 6e78 2c20 7769 6e79 0d0a  bal winx, winy..
+00005650: 2020 2020 2020 2020 7365 6c66 2e74 6974          self.tit
+00005660: 6c65 203d 2074 6974 6c65 0d0a 2020 2020  le = title..    
+00005670: 2020 2020 7067 2e6d 6b51 4170 7028 290d      pg.mkQApp().
+00005680: 0a20 2020 2020 2020 2073 7570 6572 2829  .        super()
+00005690: 2e5f 5f69 6e69 745f 5f28 2a2a 6b77 6172  .__init__(**kwar
+000056a0: 6773 290d 0a20 2020 2020 2020 2073 656c  gs)..        sel
+000056b0: 662e 7365 7457 696e 646f 7754 6974 6c65  f.setWindowTitle
+000056c0: 2874 6974 6c65 290d 0a20 2020 2020 2020  (title)..       
+000056d0: 2073 656c 662e 7365 7447 656f 6d65 7472   self.setGeometr
+000056e0: 7928 7769 6e78 2c20 7769 6e79 2c20 7769  y(winx, winy, wi
+000056f0: 6e77 2c20 7769 6e68 290d 0a20 2020 2020  nw, winh)..     
+00005700: 2020 2077 696e 7820 3d20 2877 696e 782b     winx = (winx+
+00005710: 7769 6e5f 7265 6372 6561 7465 5f64 656c  win_recreate_del
+00005720: 7461 2920 2520 3830 300d 0a20 2020 2020  ta) % 800..     
+00005730: 2020 2077 696e 7920 3d20 2877 696e 792b     winy = (winy+
+00005740: 7769 6e5f 7265 6372 6561 7465 5f64 656c  win_recreate_del
+00005750: 7461 2920 2520 3530 300d 0a20 2020 2020  ta) % 500..     
+00005760: 2020 2073 656c 662e 6365 6e74 7261 6c57     self.centralW
+00005770: 6964 6765 742e 696e 7374 616c 6c45 7665  idget.installEve
+00005780: 6e74 4669 6c74 6572 2873 656c 6629 0d0a  ntFilter(self)..
+00005790: 2020 2020 2020 2020 7365 6c66 2e63 692e          self.ci.
+000057a0: 7365 7443 6f6e 7465 6e74 734d 6172 6769  setContentsMargi
+000057b0: 6e73 2830 2c20 302c 2030 2c20 3029 0d0a  ns(0, 0, 0, 0)..
+000057c0: 2020 2020 2020 2020 7365 6c66 2e63 692e          self.ci.
+000057d0: 7365 7453 7061 6369 6e67 282d 3129 0d0a  setSpacing(-1)..
+000057e0: 2020 2020 2020 2020 7365 6c66 2e63 6c6f          self.clo
+000057f0: 7369 6e67 203d 2046 616c 7365 0d0a 0d0a  sing = False....
+00005800: 2020 2020 4070 726f 7065 7274 790d 0a20      @property.. 
+00005810: 2020 2064 6566 2061 7873 2873 656c 6629     def axs(self)
+00005820: 3a0d 0a20 2020 2020 2020 2072 6574 7572  :..        retur
+00005830: 6e20 5b61 7820 666f 7220 6178 2069 6e20  n [ax for ax in 
+00005840: 7365 6c66 2e63 692e 6974 656d 7320 6966  self.ci.items if
+00005850: 2069 7369 6e73 7461 6e63 6528 6178 2c20   isinstance(ax, 
+00005860: 7067 2e50 6c6f 7449 7465 6d29 5d0d 0a0d  pg.PlotItem)]...
+00005870: 0a20 2020 2064 6566 2061 7574 6f52 616e  .    def autoRan
+00005880: 6765 456e 6162 6c65 6428 7365 6c66 293a  geEnabled(self):
+00005890: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+000058a0: 205b 5472 7565 2c20 5472 7565 5d0d 0a0d   [True, True]...
+000058b0: 0a20 2020 2064 6566 2063 6c6f 7365 2873  .    def close(s
+000058c0: 656c 6629 3a0d 0a20 2020 2020 2020 2073  elf):..        s
+000058d0: 656c 662e 636c 6f73 696e 6720 3d20 5472  elf.closing = Tr
+000058e0: 7565 0d0a 2020 2020 2020 2020 5f73 6176  ue..        _sav
+000058f0: 6577 696e 6461 7461 2873 656c 6629 0d0a  ewindata(self)..
+00005900: 2020 2020 2020 2020 5f63 6c65 6172 5f74          _clear_t
+00005910: 696d 6572 7328 290d 0a20 2020 2020 2020  imers()..       
+00005920: 2072 6574 7572 6e20 7375 7065 7228 292e   return super().
+00005930: 636c 6f73 6528 290d 0a0d 0a20 2020 2064  close()....    d
+00005940: 6566 2065 7665 6e74 4669 6c74 6572 2873  ef eventFilter(s
+00005950: 656c 662c 206f 626a 2c20 6576 293a 0d0a  elf, obj, ev):..
+00005960: 2020 2020 2020 2020 6966 2065 762e 7479          if ev.ty
+00005970: 7065 2829 3d3d 2051 7443 6f72 652e 5145  pe()== QtCore.QE
+00005980: 7665 6e74 2e54 7970 652e 5769 6e64 6f77  vent.Type.Window
+00005990: 4465 6163 7469 7661 7465 3a0d 0a20 2020  Deactivate:..   
+000059a0: 2020 2020 2020 2020 205f 7361 7665 7769           _savewi
+000059b0: 6e64 6174 6128 7365 6c66 290d 0a20 2020  ndata(self)..   
+000059c0: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
+000059d0: 650d 0a0d 0a20 2020 2064 6566 206c 6561  e....    def lea
+000059e0: 7665 4576 656e 7428 7365 6c66 2c20 6576  veEvent(self, ev
+000059f0: 293a 0d0a 2020 2020 2020 2020 6966 206e  ):..        if n
+00005a00: 6f74 2073 656c 662e 636c 6f73 696e 673a  ot self.closing:
+00005a10: 0d0a 2020 2020 2020 2020 2020 2020 7375  ..            su
+00005a20: 7065 7228 292e 6c65 6176 6545 7665 6e74  per().leaveEvent
+00005a30: 2865 7629 0d0a 0d0a 0d0a 636c 6173 7320  (ev)......class 
+00005a40: 4669 6e43 726f 7373 4861 6972 3a0d 0a20  FinCrossHair:.. 
+00005a50: 2020 2064 6566 205f 5f69 6e69 745f 5f28     def __init__(
+00005a60: 7365 6c66 2c20 6178 2c20 636f 6c6f 7229  self, ax, color)
+00005a70: 3a0d 0a20 2020 2020 2020 2073 656c 662e  :..        self.
+00005a80: 6178 203d 2061 780d 0a20 2020 2020 2020  ax = ax..       
+00005a90: 2073 656c 662e 7820 3d20 300d 0a20 2020   self.x = 0..   
+00005aa0: 2020 2020 2073 656c 662e 7920 3d20 300d       self.y = 0.
+00005ab0: 0a20 2020 2020 2020 2073 656c 662e 636c  .        self.cl
+00005ac0: 616d 705f 7820 3d20 300d 0a20 2020 2020  amp_x = 0..     
+00005ad0: 2020 2073 656c 662e 636c 616d 705f 7920     self.clamp_y 
+00005ae0: 3d20 300d 0a20 2020 2020 2020 2073 656c  = 0..        sel
+00005af0: 662e 696e 666f 7320 3d20 5b5d 0d0a 2020  f.infos = []..  
+00005b00: 2020 2020 2020 7065 6e20 3d20 7067 2e6d        pen = pg.m
+00005b10: 6b50 656e 2863 6f6c 6f72 3d63 6f6c 6f72  kPen(color=color
+00005b20: 2c20 7374 796c 653d 5174 436f 7265 2e51  , style=QtCore.Q
+00005b30: 742e 5065 6e53 7479 6c65 2e43 7573 746f  t.PenStyle.Custo
+00005b40: 6d44 6173 684c 696e 652c 2064 6173 683d  mDashLine, dash=
+00005b50: 5b37 2c20 375d 290d 0a20 2020 2020 2020  [7, 7])..       
+00005b60: 2073 656c 662e 766c 696e 6520 3d20 7067   self.vline = pg
+00005b70: 2e49 6e66 696e 6974 654c 696e 6528 616e  .InfiniteLine(an
+00005b80: 676c 653d 3930 2c20 6d6f 7661 626c 653d  gle=90, movable=
+00005b90: 4661 6c73 652c 2070 656e 3d70 656e 290d  False, pen=pen).
+00005ba0: 0a20 2020 2020 2020 2073 656c 662e 686c  .        self.hl
+00005bb0: 696e 6520 3d20 7067 2e49 6e66 696e 6974  ine = pg.Infinit
+00005bc0: 654c 696e 6528 616e 676c 653d 302c 206d  eLine(angle=0, m
+00005bd0: 6f76 6162 6c65 3d46 616c 7365 2c20 7065  ovable=False, pe
+00005be0: 6e3d 7065 6e29 0d0a 2020 2020 2020 2020  n=pen)..        
+00005bf0: 7365 6c66 2e78 7465 7874 203d 2070 672e  self.xtext = pg.
+00005c00: 5465 7874 4974 656d 2863 6f6c 6f72 3d63  TextItem(color=c
+00005c10: 6f6c 6f72 2c20 616e 6368 6f72 3d28 302c  olor, anchor=(0,
+00005c20: 3129 290d 0a20 2020 2020 2020 2073 656c  1))..        sel
+00005c30: 662e 7974 6578 7420 3d20 7067 2e54 6578  f.ytext = pg.Tex
+00005c40: 7449 7465 6d28 636f 6c6f 723d 636f 6c6f  tItem(color=colo
+00005c50: 722c 2061 6e63 686f 723d 2830 2c30 2929  r, anchor=(0,0))
+00005c60: 0d0a 2020 2020 2020 2020 7365 6c66 2e76  ..        self.v
+00005c70: 6c69 6e65 2e73 6574 5a56 616c 7565 2835  line.setZValue(5
+00005c80: 3029 0d0a 2020 2020 2020 2020 7365 6c66  0)..        self
+00005c90: 2e68 6c69 6e65 2e73 6574 5a56 616c 7565  .hline.setZValue
+00005ca0: 2835 3029 0d0a 2020 2020 2020 2020 7365  (50)..        se
+00005cb0: 6c66 2e78 7465 7874 2e73 6574 5a56 616c  lf.xtext.setZVal
+00005cc0: 7565 2835 3029 0d0a 2020 2020 2020 2020  ue(50)..        
+00005cd0: 7365 6c66 2e79 7465 7874 2e73 6574 5a56  self.ytext.setZV
+00005ce0: 616c 7565 2835 3029 0d0a 2020 2020 2020  alue(50)..      
+00005cf0: 2020 7365 6c66 2e73 686f 7728 290d 0a0d    self.show()...
+00005d00: 0a20 2020 2064 6566 2075 7064 6174 6528  .    def update(
+00005d10: 7365 6c66 2c20 706f 696e 743d 4e6f 6e65  self, point=None
+00005d20: 293a 0d0a 2020 2020 2020 2020 6966 2070  ):..        if p
+00005d30: 6f69 6e74 2069 7320 6e6f 7420 4e6f 6e65  oint is not None
+00005d40: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
+00005d50: 656c 662e 782c 7365 6c66 2e79 203d 2078  elf.x,self.y = x
+00005d60: 2c79 203d 2070 6f69 6e74 2e78 2829 2c70  ,y = point.x(),p
+00005d70: 6f69 6e74 2e79 2829 0d0a 2020 2020 2020  oint.y()..      
+00005d80: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
+00005d90: 2020 2020 2078 2c79 203d 2073 656c 662e       x,y = self.
+00005da0: 782c 7365 6c66 2e79 0d0a 2020 2020 2020  x,self.y..      
+00005db0: 2020 782c 7920 3d20 5f63 6c61 6d70 5f78    x,y = _clamp_x
+00005dc0: 7928 7365 6c66 2e61 782c 2078 2c79 290d  y(self.ax, x,y).
+00005dd0: 0a20 2020 2020 2020 2069 6620 7820 3d3d  .        if x ==
+00005de0: 2073 656c 662e 636c 616d 705f 7820 616e   self.clamp_x an
+00005df0: 6420 7920 3d3d 2073 656c 662e 636c 616d  d y == self.clam
+00005e00: 705f 793a 0d0a 2020 2020 2020 2020 2020  p_y:..          
+00005e10: 2020 7265 7475 726e 0d0a 2020 2020 2020    return..      
+00005e20: 2020 7365 6c66 2e63 6c61 6d70 5f78 2c73    self.clamp_x,s
+00005e30: 656c 662e 636c 616d 705f 7920 3d20 782c  elf.clamp_y = x,
+00005e40: 790d 0a20 2020 2020 2020 2073 656c 662e  y..        self.
+00005e50: 766c 696e 652e 7365 7450 6f73 2878 290d  vline.setPos(x).
+00005e60: 0a20 2020 2020 2020 2073 656c 662e 686c  .        self.hl
+00005e70: 696e 652e 7365 7450 6f73 2879 290d 0a20  ine.setPos(y).. 
+00005e80: 2020 2020 2020 2073 656c 662e 7874 6578         self.xtex
+00005e90: 742e 7365 7450 6f73 2878 2c20 7929 0d0a  t.setPos(x, y)..
+00005ea0: 2020 2020 2020 2020 7365 6c66 2e79 7465          self.yte
+00005eb0: 7874 2e73 6574 506f 7328 782c 2079 290d  xt.setPos(x, y).
+00005ec0: 0a20 2020 2020 2020 2072 6e67 203d 2073  .        rng = s
+00005ed0: 656c 662e 6178 2e76 622e 795f 6d61 7820  elf.ax.vb.y_max 
+00005ee0: 2d20 7365 6c66 2e61 782e 7662 2e79 5f6d  - self.ax.vb.y_m
+00005ef0: 696e 0d0a 2020 2020 2020 2020 726e 676d  in..        rngm
+00005f00: 6178 203d 2061 6273 2873 656c 662e 6178  ax = abs(self.ax
+00005f10: 2e76 622e 795f 6d69 6e29 202b 2072 6e67  .vb.y_min) + rng
+00005f20: 2023 2061 6e79 2061 7070 726f 7869 6d61   # any approxima
+00005f30: 7469 6f6e 2069 7320 6669 6e65 0d0a 2020  tion is fine..  
+00005f40: 2020 2020 2020 7364 2c73 6520 3d20 2873        sd,se = (s
+00005f50: 656c 662e 6178 2e73 6967 6e69 6669 6361  elf.ax.significa
+00005f60: 6e74 5f64 6563 696d 616c 732c 7365 6c66  nt_decimals,self
+00005f70: 2e61 782e 7369 676e 6966 6963 616e 745f  .ax.significant_
+00005f80: 6570 7329 2069 6620 636c 616d 705f 6772  eps) if clamp_gr
+00005f90: 6964 2065 6c73 6520 2873 6967 6e69 6669  id else (signifi
+00005fa0: 6361 6e74 5f64 6563 696d 616c 732c 7369  cant_decimals,si
+00005fb0: 676e 6966 6963 616e 745f 6570 7329 0d0a  gnificant_eps)..
+00005fc0: 2020 2020 2020 2020 7469 6d65 6261 7365          timebase
+00005fd0: 6420 3d20 4661 6c73 650d 0a20 2020 2020  d = False..     
+00005fe0: 2020 2069 6620 7365 6c66 2e61 782e 7662     if self.ax.vb
+00005ff0: 2e78 5f69 6e64 6578 6564 3a0d 0a20 2020  .x_indexed:..   
+00006000: 2020 2020 2020 2020 2078 7465 7874 2c74           xtext,t
+00006010: 696d 6562 6173 6564 203d 205f 7832 6c6f  imebased = _x2lo
+00006020: 6361 6c5f 7428 7365 6c66 2e61 782e 7662  cal_t(self.ax.vb
+00006030: 2e64 6174 6173 7263 2c20 7829 0d0a 2020  .datasrc, x)..  
+00006040: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
+00006050: 2020 2020 2020 2020 2078 7465 7874 203d           xtext =
+00006060: 205f 726f 756e 645f 746f 5f73 6967 6e69   _round_to_signi
+00006070: 6669 6361 6e74 2872 6e67 2c20 726e 676d  ficant(rng, rngm
+00006080: 6178 2c20 782c 2073 642c 2073 6529 0d0a  ax, x, sd, se)..
+00006090: 2020 2020 2020 2020 6c69 6e65 6172 5f79          linear_y
+000060a0: 203d 2079 0d0a 2020 2020 2020 2020 7920   = y..        y 
+000060b0: 3d20 7365 6c66 2e61 782e 7662 2e79 7363  = self.ax.vb.ysc
+000060c0: 616c 652e 7866 6f72 6d28 7929 0d0a 2020  ale.xform(y)..  
+000060d0: 2020 2020 2020 7974 6578 7420 3d20 5f72        ytext = _r
+000060e0: 6f75 6e64 5f74 6f5f 7369 676e 6966 6963  ound_to_signific
+000060f0: 616e 7428 726e 672c 2072 6e67 6d61 782c  ant(rng, rngmax,
+00006100: 2079 2c20 7364 2c20 7365 290d 0a20 2020   y, sd, se)..   
+00006110: 2020 2020 2069 6620 6e6f 7420 7469 6d65       if not time
+00006120: 6261 7365 643a 0d0a 2020 2020 2020 2020  based:..        
+00006130: 2020 2020 6966 2078 7465 7874 3a0d 0a20      if xtext:.. 
+00006140: 2020 2020 2020 2020 2020 2020 2020 2078                 x
+00006150: 7465 7874 203d 2027 7820 2720 2b20 7874  text = 'x ' + xt
+00006160: 6578 740d 0a20 2020 2020 2020 2020 2020  ext..           
+00006170: 2079 7465 7874 203d 2027 7920 2720 2b20   ytext = 'y ' + 
+00006180: 7974 6578 740d 0a20 2020 2020 2020 2066  ytext..        f
+00006190: 6172 5f72 6967 6874 203d 2073 656c 662e  ar_right = self.
+000061a0: 6178 2e76 6965 7752 6563 7428 292e 7828  ax.viewRect().x(
+000061b0: 2920 2b20 7365 6c66 2e61 782e 7669 6577  ) + self.ax.view
+000061c0: 5265 6374 2829 2e77 6964 7468 2829 2a30  Rect().width()*0
+000061d0: 2e39 0d0a 2020 2020 2020 2020 6661 725f  .9..        far_
+000061e0: 626f 7474 6f6d 203d 2073 656c 662e 6178  bottom = self.ax
+000061f0: 2e76 6965 7752 6563 7428 292e 7928 2920  .viewRect().y() 
+00006200: 2b20 7365 6c66 2e61 782e 7669 6577 5265  + self.ax.viewRe
+00006210: 6374 2829 2e68 6569 6768 7428 292a 302e  ct().height()*0.
+00006220: 310d 0a20 2020 2020 2020 2063 6c6f 7365  1..        close
+00006230: 3272 6967 6874 203d 2078 203e 2066 6172  2right = x > far
+00006240: 5f72 6967 6874 0d0a 2020 2020 2020 2020  _right..        
+00006250: 636c 6f73 6532 626f 7474 6f6d 203d 206c  close2bottom = l
+00006260: 696e 6561 725f 7920 3c20 6661 725f 626f  inear_y < far_bo
+00006270: 7474 6f6d 0d0a 2020 2020 2020 2020 7472  ttom..        tr
+00006280: 793a 0d0a 2020 2020 2020 2020 2020 2020  y:..            
+00006290: 666f 7220 696e 666f 2069 6e20 7365 6c66  for info in self
+000062a0: 2e69 6e66 6f73 3a0d 0a20 2020 2020 2020  .infos:..       
+000062b0: 2020 2020 2020 2020 2078 7465 7874 2c79           xtext,y
+000062c0: 7465 7874 203d 2069 6e66 6f28 782c 792c  text = info(x,y,
+000062d0: 7874 6578 742c 7974 6578 7429 0d0a 2020  xtext,ytext)..  
+000062e0: 2020 2020 2020 6578 6365 7074 2045 7863        except Exc
+000062f0: 6570 7469 6f6e 2061 7320 653a 0d0a 2020  eption as e:..  
+00006300: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+00006310: 2743 726f 7373 6861 6972 2065 7272 6f72  'Crosshair error
+00006320: 3a27 2c20 7479 7065 2865 292c 2065 290d  :', type(e), e).
+00006330: 0a20 2020 2020 2020 2073 7061 6365 203d  .        space =
+00006340: 2027 2020 2020 2020 270d 0a20 2020 2020   '      '..     
+00006350: 2020 2069 6620 636c 6f73 6532 7269 6768     if close2righ
+00006360: 743a 0d0a 2020 2020 2020 2020 2020 2020  t:..            
+00006370: 7874 6578 7420 3d20 7874 6578 7420 2b20  xtext = xtext + 
+00006380: 7370 6163 650d 0a20 2020 2020 2020 2020  space..         
+00006390: 2020 2079 7465 7874 203d 2079 7465 7874     ytext = ytext
+000063a0: 202b 2073 7061 6365 0d0a 2020 2020 2020   + space..      
+000063b0: 2020 2020 2020 7861 6e63 686f 7220 3d20        xanchor = 
+000063c0: 5b31 2c31 5d0d 0a20 2020 2020 2020 2020  [1,1]..         
+000063d0: 2020 2079 616e 6368 6f72 203d 205b 312c     yanchor = [1,
+000063e0: 305d 0d0a 2020 2020 2020 2020 656c 7365  0]..        else
+000063f0: 3a0d 0a20 2020 2020 2020 2020 2020 2078  :..            x
+00006400: 7465 7874 203d 2073 7061 6365 202b 2078  text = space + x
+00006410: 7465 7874 0d0a 2020 2020 2020 2020 2020  text..          
+00006420: 2020 7974 6578 7420 3d20 7370 6163 6520    ytext = space 
+00006430: 2b20 7974 6578 740d 0a20 2020 2020 2020  + ytext..       
+00006440: 2020 2020 2078 616e 6368 6f72 203d 205b       xanchor = [
+00006450: 302c 315d 0d0a 2020 2020 2020 2020 2020  0,1]..          
+00006460: 2020 7961 6e63 686f 7220 3d20 5b30 2c30    yanchor = [0,0
+00006470: 5d0d 0a20 2020 2020 2020 2069 6620 636c  ]..        if cl
+00006480: 6f73 6532 626f 7474 6f6d 3a0d 0a20 2020  ose2bottom:..   
+00006490: 2020 2020 2020 2020 2079 7465 7874 203d           ytext =
+000064a0: 2079 7465 7874 202b 2073 7061 6365 0d0a   ytext + space..
+000064b0: 2020 2020 2020 2020 2020 2020 7961 6e63              yanc
+000064c0: 686f 7220 3d20 5b31 2c31 5d0d 0a20 2020  hor = [1,1]..   
+000064d0: 2020 2020 2020 2020 2069 6620 636c 6f73           if clos
+000064e0: 6532 7269 6768 743a 0d0a 2020 2020 2020  e2right:..      
+000064f0: 2020 2020 2020 2020 2020 7861 6e63 686f            xancho
+00006500: 7220 3d20 5b31 2c32 5d0d 0a20 2020 2020  r = [1,2]..     
+00006510: 2020 2073 656c 662e 7874 6578 742e 7365     self.xtext.se
+00006520: 7441 6e63 686f 7228 7861 6e63 686f 7229  tAnchor(xanchor)
+00006530: 0d0a 2020 2020 2020 2020 7365 6c66 2e79  ..        self.y
+00006540: 7465 7874 2e73 6574 416e 6368 6f72 2879  text.setAnchor(y
+00006550: 616e 6368 6f72 290d 0a20 2020 2020 2020  anchor)..       
+00006560: 2073 656c 662e 7874 6578 742e 7365 7454   self.xtext.setT
+00006570: 6578 7428 7874 6578 7429 0d0a 2020 2020  ext(xtext)..    
+00006580: 2020 2020 7365 6c66 2e79 7465 7874 2e73      self.ytext.s
+00006590: 6574 5465 7874 2879 7465 7874 290d 0a0d  etText(ytext)...
+000065a0: 0a20 2020 2064 6566 2073 686f 7728 7365  .    def show(se
+000065b0: 6c66 293a 0d0a 2020 2020 2020 2020 7365  lf):..        se
+000065c0: 6c66 2e61 782e 6164 6449 7465 6d28 7365  lf.ax.addItem(se
+000065d0: 6c66 2e76 6c69 6e65 2c20 6967 6e6f 7265  lf.vline, ignore
+000065e0: 426f 756e 6473 3d54 7275 6529 0d0a 2020  Bounds=True)..  
+000065f0: 2020 2020 2020 7365 6c66 2e61 782e 6164        self.ax.ad
+00006600: 6449 7465 6d28 7365 6c66 2e68 6c69 6e65  dItem(self.hline
+00006610: 2c20 6967 6e6f 7265 426f 756e 6473 3d54  , ignoreBounds=T
+00006620: 7275 6529 0d0a 2020 2020 2020 2020 7365  rue)..        se
+00006630: 6c66 2e61 782e 6164 6449 7465 6d28 7365  lf.ax.addItem(se
+00006640: 6c66 2e78 7465 7874 2c20 6967 6e6f 7265  lf.xtext, ignore
+00006650: 426f 756e 6473 3d54 7275 6529 0d0a 2020  Bounds=True)..  
+00006660: 2020 2020 2020 7365 6c66 2e61 782e 6164        self.ax.ad
+00006670: 6449 7465 6d28 7365 6c66 2e79 7465 7874  dItem(self.ytext
+00006680: 2c20 6967 6e6f 7265 426f 756e 6473 3d54  , ignoreBounds=T
+00006690: 7275 6529 0d0a 0d0a 2020 2020 6465 6620  rue)....    def 
+000066a0: 6869 6465 2873 656c 6629 3a0d 0a20 2020  hide(self):..   
+000066b0: 2020 2020 2073 656c 662e 6178 2e72 656d       self.ax.rem
+000066c0: 6f76 6549 7465 6d28 7365 6c66 2e78 7465  oveItem(self.xte
+000066d0: 7874 290d 0a20 2020 2020 2020 2073 656c  xt)..        sel
+000066e0: 662e 6178 2e72 656d 6f76 6549 7465 6d28  f.ax.removeItem(
+000066f0: 7365 6c66 2e79 7465 7874 290d 0a20 2020  self.ytext)..   
+00006700: 2020 2020 2073 656c 662e 6178 2e72 656d       self.ax.rem
+00006710: 6f76 6549 7465 6d28 7365 6c66 2e76 6c69  oveItem(self.vli
+00006720: 6e65 290d 0a20 2020 2020 2020 2073 656c  ne)..        sel
+00006730: 662e 6178 2e72 656d 6f76 6549 7465 6d28  f.ax.removeItem(
+00006740: 7365 6c66 2e68 6c69 6e65 290d 0a0d 0a0d  self.hline).....
+00006750: 0a0d 0a63 6c61 7373 2046 696e 4c65 6765  ...class FinLege
+00006760: 6e64 4974 656d 2870 672e 4c65 6765 6e64  ndItem(pg.Legend
+00006770: 4974 656d 293a 0d0a 2020 2020 6465 6620  Item):..    def 
+00006780: 5f5f 696e 6974 5f5f 2873 656c 662c 2062  __init__(self, b
+00006790: 6f72 6465 725f 636f 6c6f 722c 2066 696c  order_color, fil
+000067a0: 6c5f 636f 6c6f 722c 202a 2a6b 7761 7267  l_color, **kwarg
+000067b0: 7329 3a0d 0a20 2020 2020 2020 2073 7570  s):..        sup
+000067c0: 6572 2829 2e5f 5f69 6e69 745f 5f28 2a2a  er().__init__(**
+000067d0: 6b77 6172 6773 290d 0a20 2020 2020 2020  kwargs)..       
+000067e0: 2073 656c 662e 6c61 796f 7574 2e73 6574   self.layout.set
+000067f0: 5665 7274 6963 616c 5370 6163 696e 6728  VerticalSpacing(
+00006800: 3229 0d0a 2020 2020 2020 2020 7365 6c66  2)..        self
+00006810: 2e6c 6179 6f75 742e 7365 7448 6f72 697a  .layout.setHoriz
+00006820: 6f6e 7461 6c53 7061 6369 6e67 2832 3029  ontalSpacing(20)
+00006830: 0d0a 2020 2020 2020 2020 7365 6c66 2e6c  ..        self.l
+00006840: 6179 6f75 742e 7365 7443 6f6e 7465 6e74  ayout.setContent
+00006850: 734d 6172 6769 6e73 2832 2c20 322c 2031  sMargins(2, 2, 1
+00006860: 302c 2032 290d 0a20 2020 2020 2020 2073  0, 2)..        s
+00006870: 656c 662e 626f 7264 6572 5f63 6f6c 6f72  elf.border_color
+00006880: 203d 2062 6f72 6465 725f 636f 6c6f 720d   = border_color.
+00006890: 0a20 2020 2020 2020 2073 656c 662e 6669  .        self.fi
+000068a0: 6c6c 5f63 6f6c 6f72 203d 2066 696c 6c5f  ll_color = fill_
+000068b0: 636f 6c6f 720d 0a0d 0a20 2020 2064 6566  color....    def
+000068c0: 2070 6169 6e74 2873 656c 662c 2070 2c20   paint(self, p, 
+000068d0: 2a61 7267 7329 3a0d 0a20 2020 2020 2020  *args):..       
+000068e0: 2070 2e73 6574 5065 6e28 7067 2e6d 6b50   p.setPen(pg.mkP
+000068f0: 656e 2873 656c 662e 626f 7264 6572 5f63  en(self.border_c
+00006900: 6f6c 6f72 2929 0d0a 2020 2020 2020 2020  olor))..        
+00006910: 702e 7365 7442 7275 7368 2870 672e 6d6b  p.setBrush(pg.mk
+00006920: 4272 7573 6828 7365 6c66 2e66 696c 6c5f  Brush(self.fill_
+00006930: 636f 6c6f 7229 290d 0a20 2020 2020 2020  color))..       
+00006940: 2070 2e64 7261 7752 6563 7428 7365 6c66   p.drawRect(self
+00006950: 2e62 6f75 6e64 696e 6752 6563 7428 2929  .boundingRect())
+00006960: 0d0a 0d0a 0d0a 0d0a 636c 6173 7320 4669  ........class Fi
+00006970: 6e50 6f6c 794c 696e 6528 7067 2e50 6f6c  nPolyLine(pg.Pol
+00006980: 794c 696e 6552 4f49 293a 0d0a 2020 2020  yLineROI):..    
+00006990: 6465 6620 5f5f 696e 6974 5f5f 2873 656c  def __init__(sel
+000069a0: 662c 2076 622c 202a 6172 6773 2c20 2a2a  f, vb, *args, **
+000069b0: 6b77 6172 6773 293a 0d0a 2020 2020 2020  kwargs):..      
+000069c0: 2020 7365 6c66 2e76 6220 3d20 7662 2023    self.vb = vb #
+000069d0: 2069 6e69 7420 6265 666f 7265 2070 6172   init before par
+000069e0: 656e 7420 636f 6e73 7472 7563 746f 720d  ent constructor.
+000069f0: 0a20 2020 2020 2020 2073 656c 662e 7465  .        self.te
+00006a00: 7874 7320 3d20 5b5d 0d0a 2020 2020 2020  xts = []..      
+00006a10: 2020 7375 7065 7228 292e 5f5f 696e 6974    super().__init
+00006a20: 5f5f 282a 6172 6773 2c20 2a2a 6b77 6172  __(*args, **kwar
+00006a30: 6773 290d 0a0d 0a20 2020 2064 6566 2061  gs)....    def a
+00006a40: 6464 5365 676d 656e 7428 7365 6c66 2c20  ddSegment(self, 
+00006a50: 6831 2c20 6832 2c20 696e 6465 783d 4e6f  h1, h2, index=No
+00006a60: 6e65 293a 0d0a 2020 2020 2020 2020 7375  ne):..        su
+00006a70: 7065 7228 292e 6164 6453 6567 6d65 6e74  per().addSegment
+00006a80: 2868 312c 2068 322c 2069 6e64 6578 290d  (h1, h2, index).
+00006a90: 0a20 2020 2020 2020 2074 6578 7420 3d20  .        text = 
+00006aa0: 7067 2e54 6578 7449 7465 6d28 636f 6c6f  pg.TextItem(colo
+00006ab0: 723d 6472 6177 5f6c 696e 655f 636f 6c6f  r=draw_line_colo
+00006ac0: 7229 0d0a 2020 2020 2020 2020 7465 7874  r)..        text
+00006ad0: 2e73 6574 5a56 616c 7565 2835 3029 0d0a  .setZValue(50)..
+00006ae0: 2020 2020 2020 2020 7465 7874 2e73 6567          text.seg
+00006af0: 6d65 6e74 203d 2073 656c 662e 7365 676d  ment = self.segm
+00006b00: 656e 7473 5b2d 3120 6966 2069 6e64 6578  ents[-1 if index
+00006b10: 2069 7320 4e6f 6e65 2065 6c73 6520 696e   is None else in
+00006b20: 6465 785d 0d0a 2020 2020 2020 2020 6966  dex]..        if
+00006b30: 2069 6e64 6578 2069 7320 4e6f 6e65 3a0d   index is None:.
+00006b40: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00006b50: 662e 7465 7874 732e 6170 7065 6e64 2874  f.texts.append(t
+00006b60: 6578 7429 0d0a 2020 2020 2020 2020 656c  ext)..        el
+00006b70: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
+00006b80: 2073 656c 662e 7465 7874 732e 696e 7365   self.texts.inse
+00006b90: 7274 2869 6e64 6578 2c20 7465 7874 290d  rt(index, text).
+00006ba0: 0a20 2020 2020 2020 2073 656c 662e 7570  .        self.up
+00006bb0: 6461 7465 5f74 6578 7428 7465 7874 290d  date_text(text).
+00006bc0: 0a20 2020 2020 2020 2073 656c 662e 7662  .        self.vb
+00006bd0: 2e61 6464 4974 656d 2874 6578 742c 2069  .addItem(text, i
+00006be0: 676e 6f72 6542 6f75 6e64 733d 5472 7565  gnoreBounds=True
+00006bf0: 290d 0a0d 0a20 2020 2064 6566 2072 656d  )....    def rem
+00006c00: 6f76 6553 6567 6d65 6e74 2873 656c 662c  oveSegment(self,
+00006c10: 2073 6567 293a 0d0a 2020 2020 2020 2020   seg):..        
+00006c20: 7375 7065 7228 292e 7265 6d6f 7665 5365  super().removeSe
+00006c30: 676d 656e 7428 7365 6729 0d0a 2020 2020  gment(seg)..    
+00006c40: 2020 2020 666f 7220 7465 7874 2069 6e20      for text in 
+00006c50: 6c69 7374 2873 656c 662e 7465 7874 7329  list(self.texts)
+00006c60: 3a0d 0a20 2020 2020 2020 2020 2020 2069  :..            i
+00006c70: 6620 7465 7874 2e73 6567 6d65 6e74 203d  f text.segment =
+00006c80: 3d20 7365 673a 0d0a 2020 2020 2020 2020  = seg:..        
+00006c90: 2020 2020 2020 2020 7365 6c66 2e76 622e          self.vb.
+00006ca0: 7265 6d6f 7665 4974 656d 2874 6578 7429  removeItem(text)
+00006cb0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00006cc0: 2020 7365 6c66 2e74 6578 7473 2e72 656d    self.texts.rem
+00006cd0: 6f76 6528 7465 7874 290d 0a0d 0a20 2020  ove(text)....   
+00006ce0: 2064 6566 2075 7064 6174 655f 7465 7874   def update_text
+00006cf0: 2873 656c 662c 2074 6578 7429 3a0d 0a20  (self, text):.. 
+00006d00: 2020 2020 2020 2068 3020 3d20 7465 7874         h0 = text
+00006d10: 2e73 6567 6d65 6e74 2e68 616e 646c 6573  .segment.handles
+00006d20: 5b30 5d5b 2769 7465 6d27 5d0d 0a20 2020  [0]['item']..   
+00006d30: 2020 2020 2068 3120 3d20 7465 7874 2e73       h1 = text.s
+00006d40: 6567 6d65 6e74 2e68 616e 646c 6573 5b31  egment.handles[1
+00006d50: 5d5b 2769 7465 6d27 5d0d 0a20 2020 2020  ]['item']..     
+00006d60: 2020 2064 6966 6620 3d20 6831 2e70 6f73     diff = h1.pos
+00006d70: 2829 202d 2068 302e 706f 7328 290d 0a20  () - h0.pos().. 
+00006d80: 2020 2020 2020 2069 6620 6469 6666 2e79         if diff.y
+00006d90: 2829 203c 2030 3a0d 0a20 2020 2020 2020  () < 0:..       
+00006da0: 2020 2020 2074 6578 742e 7365 7441 6e63       text.setAnc
+00006db0: 686f 7228 2830 2e35 2c30 2929 0d0a 2020  hor((0.5,0))..  
+00006dc0: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
+00006dd0: 2020 2020 2020 2020 2074 6578 742e 7365           text.se
+00006de0: 7441 6e63 686f 7228 2830 2e35 2c31 2929  tAnchor((0.5,1))
+00006df0: 0d0a 2020 2020 2020 2020 7465 7874 2e73  ..        text.s
+00006e00: 6574 506f 7328 6831 2e70 6f73 2829 290d  etPos(h1.pos()).
+00006e10: 0a20 2020 2020 2020 2074 6578 742e 7365  .        text.se
+00006e20: 7454 6578 7428 5f64 7261 775f 6c69 6e65  tText(_draw_line
+00006e30: 5f73 6567 6d65 6e74 5f74 6578 7428 7365  _segment_text(se
+00006e40: 6c66 2c20 7465 7874 2e73 6567 6d65 6e74  lf, text.segment
+00006e50: 2c20 6830 2e70 6f73 2829 2c20 6831 2e70  , h0.pos(), h1.p
+00006e60: 6f73 2829 2929 0d0a 0d0a 2020 2020 6465  os()))....    de
+00006e70: 6620 7570 6461 7465 5f74 6578 7473 2873  f update_texts(s
+00006e80: 656c 6629 3a0d 0a20 2020 2020 2020 2066  elf):..        f
+00006e90: 6f72 2074 6578 7420 696e 2073 656c 662e  or text in self.
+00006ea0: 7465 7874 733a 0d0a 2020 2020 2020 2020  texts:..        
+00006eb0: 2020 2020 7365 6c66 2e75 7064 6174 655f      self.update_
+00006ec0: 7465 7874 2874 6578 7429 0d0a 0d0a 2020  text(text)....  
+00006ed0: 2020 6465 6620 6d6f 7665 506f 696e 7428    def movePoint(
+00006ee0: 7365 6c66 2c20 6861 6e64 6c65 2c20 706f  self, handle, po
+00006ef0: 732c 206d 6f64 6966 6965 7273 3d51 7443  s, modifiers=QtC
+00006f00: 6f72 652e 5174 2e4b 6579 626f 6172 644d  ore.Qt.KeyboardM
+00006f10: 6f64 6966 6965 722c 2066 696e 6973 683d  odifier, finish=
+00006f20: 5472 7565 2c20 636f 6f72 6473 3d27 7061  True, coords='pa
+00006f30: 7265 6e74 2729 3a0d 0a20 2020 2020 2020  rent'):..       
+00006f40: 2073 7570 6572 2829 2e6d 6f76 6550 6f69   super().movePoi
+00006f50: 6e74 2868 616e 646c 652c 2070 6f73 2c20  nt(handle, pos, 
+00006f60: 6d6f 6469 6669 6572 732c 2066 696e 6973  modifiers, finis
+00006f70: 682c 2063 6f6f 7264 7329 0d0a 2020 2020  h, coords)..    
+00006f80: 2020 2020 7365 6c66 2e75 7064 6174 655f      self.update_
+00006f90: 7465 7874 7328 290d 0a0d 0a20 2020 2064  texts()....    d
+00006fa0: 6566 2073 6567 6d65 6e74 436c 6963 6b65  ef segmentClicke
+00006fb0: 6428 7365 6c66 2c20 7365 676d 656e 742c  d(self, segment,
+00006fc0: 2065 763d 4e6f 6e65 2c20 706f 733d 4e6f   ev=None, pos=No
+00006fd0: 6e65 293a 0d0a 2020 2020 2020 2020 706f  ne):..        po
+00006fe0: 7320 3d20 7365 676d 656e 742e 6d61 7054  s = segment.mapT
+00006ff0: 6f50 6172 656e 7428 6576 2e70 6f73 2829  oParent(ev.pos()
+00007000: 290d 0a20 2020 2020 2020 2070 6f73 203d  )..        pos =
+00007010: 205f 636c 616d 705f 706f 696e 7428 7365   _clamp_point(se
+00007020: 6c66 2e76 622e 7061 7265 6e74 2829 2c20  lf.vb.parent(), 
+00007030: 706f 7329 0d0a 2020 2020 2020 2020 7375  pos)..        su
+00007040: 7065 7228 292e 7365 676d 656e 7443 6c69  per().segmentCli
+00007050: 636b 6564 2873 6567 6d65 6e74 2c20 706f  cked(segment, po
+00007060: 733d 706f 7329 0d0a 2020 2020 2020 2020  s=pos)..        
+00007070: 7365 6c66 2e75 7064 6174 655f 7465 7874  self.update_text
+00007080: 7328 290d 0a0d 0a20 2020 2064 6566 2061  s()....    def a
+00007090: 6464 4861 6e64 6c65 2873 656c 662c 2069  ddHandle(self, i
+000070a0: 6e66 6f2c 2069 6e64 6578 3d4e 6f6e 6529  nfo, index=None)
+000070b0: 3a0d 0a20 2020 2020 2020 2068 616e 646c  :..        handl
+000070c0: 6520 3d20 7375 7065 7228 292e 6164 6448  e = super().addH
+000070d0: 616e 646c 6528 696e 666f 2c20 696e 6465  andle(info, inde
+000070e0: 7829 0d0a 2020 2020 2020 2020 6861 6e64  x)..        hand
+000070f0: 6c65 2e6d 6f76 6550 6f69 6e74 203d 2070  le.movePoint = p
+00007100: 6172 7469 616c 285f 726f 6968 616e 646c  artial(_roihandl
+00007110: 655f 6d6f 7665 5f73 6e61 702c 2073 656c  e_move_snap, sel
+00007120: 662e 7662 2c20 6861 6e64 6c65 2e6d 6f76  f.vb, handle.mov
+00007130: 6550 6f69 6e74 290d 0a20 2020 2020 2020  ePoint)..       
+00007140: 2072 6574 7572 6e20 6861 6e64 6c65 0d0a   return handle..
+00007150: 0d0a 0d0a 636c 6173 7320 4669 6e4c 696e  ....class FinLin
+00007160: 6528 7067 2e47 7261 7068 6963 734f 626a  e(pg.GraphicsObj
+00007170: 6563 7429 3a0d 0a20 2020 2064 6566 205f  ect):..    def _
+00007180: 5f69 6e69 745f 5f28 7365 6c66 2c20 706f  _init__(self, po
+00007190: 696e 7473 2c20 7065 6e29 3a0d 0a20 2020  ints, pen):..   
+000071a0: 2020 2020 2073 7570 6572 2829 2e5f 5f69       super().__i
+000071b0: 6e69 745f 5f28 290d 0a20 2020 2020 2020  nit__()..       
+000071c0: 2073 656c 662e 706f 696e 7473 203d 2070   self.points = p
+000071d0: 6f69 6e74 730d 0a20 2020 2020 2020 2073  oints..        s
+000071e0: 656c 662e 7065 6e20 3d20 7065 6e0d 0a0d  elf.pen = pen...
+000071f0: 0a20 2020 2064 6566 2070 6169 6e74 2873  .    def paint(s
+00007200: 656c 662c 2070 2c20 2a61 7267 7329 3a0d  elf, p, *args):.
+00007210: 0a20 2020 2020 2020 2070 2e73 6574 5065  .        p.setPe
+00007220: 6e28 7365 6c66 2e70 656e 290d 0a20 2020  n(self.pen)..   
+00007230: 2020 2020 2070 2e64 7261 7750 6174 6828       p.drawPath(
+00007240: 7365 6c66 2e73 6861 7065 2829 290d 0a0d  self.shape())...
+00007250: 0a20 2020 2064 6566 2073 6861 7065 2873  .    def shape(s
+00007260: 656c 6629 3a0d 0a20 2020 2020 2020 2070  elf):..        p
+00007270: 203d 2051 7447 7569 2e51 5061 696e 7465   = QtGui.QPainte
+00007280: 7250 6174 6828 290d 0a20 2020 2020 2020  rPath()..       
+00007290: 2070 2e6d 6f76 6554 6f28 2a73 656c 662e   p.moveTo(*self.
+000072a0: 706f 696e 7473 5b30 5d29 0d0a 2020 2020  points[0])..    
+000072b0: 2020 2020 702e 6c69 6e65 546f 282a 7365      p.lineTo(*se
+000072c0: 6c66 2e70 6f69 6e74 735b 315d 290d 0a20  lf.points[1]).. 
+000072d0: 2020 2020 2020 2072 6574 7572 6e20 700d         return p.
+000072e0: 0a0d 0a20 2020 2064 6566 2062 6f75 6e64  ...    def bound
+000072f0: 696e 6752 6563 7428 7365 6c66 293a 0d0a  ingRect(self):..
+00007300: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+00007310: 656c 662e 7368 6170 6528 292e 626f 756e  elf.shape().boun
+00007320: 6469 6e67 5265 6374 2829 0d0a 0d0a 0d0a  dingRect()......
+00007330: 636c 6173 7320 4669 6e45 6c6c 6970 7365  class FinEllipse
+00007340: 2870 672e 456c 6c69 7073 6552 4f49 293a  (pg.EllipseROI):
+00007350: 0d0a 2020 2020 6465 6620 6164 6452 6f74  ..    def addRot
+00007360: 6174 6548 616e 646c 6528 7365 6c66 2c20  ateHandle(self, 
+00007370: 2a61 7267 732c 202a 2a6b 7761 7267 7329  *args, **kwargs)
+00007380: 3a0d 0a20 2020 2020 2020 2070 6173 730d  :..        pass.
+00007390: 0a0d 0a0d 0a63 6c61 7373 2046 696e 5265  .....class FinRe
+000073a0: 6374 2870 672e 5265 6374 524f 4929 3a0d  ct(pg.RectROI):.
+000073b0: 0a20 2020 2064 6566 205f 5f69 6e69 745f  .    def __init_
+000073c0: 5f28 7365 6c66 2c20 6178 2c20 6272 7573  _(self, ax, brus
+000073d0: 682c 202a 6172 6773 2c20 2a2a 6b77 6172  h, *args, **kwar
+000073e0: 6773 293a 0d0a 2020 2020 2020 2020 7365  gs):..        se
+000073f0: 6c66 2e61 7820 3d20 6178 0d0a 2020 2020  lf.ax = ax..    
+00007400: 2020 2020 7365 6c66 2e62 7275 7368 203d      self.brush =
+00007410: 2062 7275 7368 0d0a 2020 2020 2020 2020   brush..        
+00007420: 7375 7065 7228 292e 5f5f 696e 6974 5f5f  super().__init__
+00007430: 282a 6172 6773 2c20 2a2a 6b77 6172 6773  (*args, **kwargs
+00007440: 290d 0a0d 0a20 2020 2064 6566 2070 6169  )....    def pai
+00007450: 6e74 2873 656c 662c 2070 2c20 2a61 7267  nt(self, p, *arg
+00007460: 7329 3a0d 0a20 2020 2020 2020 2072 203d  s):..        r =
+00007470: 2051 7443 6f72 652e 5152 6563 7446 2830   QtCore.QRectF(0
+00007480: 2c20 302c 2073 656c 662e 7374 6174 655b  , 0, self.state[
+00007490: 2773 697a 6527 5d5b 305d 2c20 7365 6c66  'size'][0], self
+000074a0: 2e73 7461 7465 5b27 7369 7a65 275d 5b31  .state['size'][1
+000074b0: 5d29 2e6e 6f72 6d61 6c69 7a65 6428 290d  ]).normalized().
+000074c0: 0a20 2020 2020 2020 2070 2e73 6574 5065  .        p.setPe
+000074d0: 6e28 7365 6c66 2e63 7572 7265 6e74 5065  n(self.currentPe
+000074e0: 6e29 0d0a 2020 2020 2020 2020 702e 7365  n)..        p.se
+000074f0: 7442 7275 7368 2873 656c 662e 6272 7573  tBrush(self.brus
+00007500: 6829 0d0a 2020 2020 2020 2020 702e 7472  h)..        p.tr
+00007510: 616e 736c 6174 6528 722e 6c65 6674 2829  anslate(r.left()
+00007520: 2c20 722e 746f 7028 2929 0d0a 2020 2020  , r.top())..    
+00007530: 2020 2020 702e 7363 616c 6528 722e 7769      p.scale(r.wi
+00007540: 6474 6828 292c 2072 2e68 6569 6768 7428  dth(), r.height(
+00007550: 2929 0d0a 2020 2020 2020 2020 702e 6472  ))..        p.dr
+00007560: 6177 5265 6374 2830 2c20 302c 2031 2c20  awRect(0, 0, 1, 
+00007570: 3129 0d0a 0d0a 2020 2020 6465 6620 6164  1)....    def ad
+00007580: 6453 6361 6c65 4861 6e64 6c65 2873 656c  dScaleHandle(sel
+00007590: 662c 202a 6172 6773 2c20 2a2a 6b77 6172  f, *args, **kwar
+000075a0: 6773 293a 0d0a 2020 2020 2020 2020 6966  gs):..        if
+000075b0: 2073 656c 662e 7265 7369 7a61 626c 653a   self.resizable:
+000075c0: 0d0a 2020 2020 2020 2020 2020 2020 7375  ..            su
+000075d0: 7065 7228 292e 6164 6453 6361 6c65 4861  per().addScaleHa
+000075e0: 6e64 6c65 282a 6172 6773 2c20 2a2a 6b77  ndle(*args, **kw
+000075f0: 6172 6773 290d 0a0d 0a0d 0a63 6c61 7373  args)......class
+00007600: 2046 696e 5669 6577 426f 7828 7067 2e56   FinViewBox(pg.V
+00007610: 6965 7742 6f78 293a 0d0a 2020 2020 6465  iewBox):..    de
+00007620: 6620 5f5f 696e 6974 5f5f 2873 656c 662c  f __init__(self,
+00007630: 2077 696e 2c20 696e 6974 5f73 7465 7073   win, init_steps
+00007640: 3d33 3030 2c20 7973 6361 6c65 3d59 5363  =300, yscale=YSc
+00007650: 616c 6528 276c 696e 6561 7227 2c20 3129  ale('linear', 1)
+00007660: 2c20 765f 7a6f 6f6d 5f73 6361 6c65 3d31  , v_zoom_scale=1
+00007670: 2c20 2a61 7267 732c 202a 2a6b 7761 7267  , *args, **kwarg
+00007680: 7329 3a0d 0a20 2020 2020 2020 2073 7570  s):..        sup
+00007690: 6572 2829 2e5f 5f69 6e69 745f 5f28 2a61  er().__init__(*a
+000076a0: 7267 732c 202a 2a6b 7761 7267 7329 0d0a  rgs, **kwargs)..
+000076b0: 2020 2020 2020 2020 7365 6c66 2e77 696e          self.win
+000076c0: 203d 2077 696e 0d0a 2020 2020 2020 2020   = win..        
+000076d0: 7365 6c66 2e69 6e69 745f 7374 6570 7320  self.init_steps 
+000076e0: 3d20 696e 6974 5f73 7465 7073 0d0a 2020  = init_steps..  
+000076f0: 2020 2020 2020 7365 6c66 2e79 7363 616c        self.yscal
+00007700: 6520 3d20 7973 6361 6c65 0d0a 2020 2020  e = yscale..    
+00007710: 2020 2020 7365 6c66 2e76 5f7a 6f6f 6d5f      self.v_zoom_
+00007720: 7363 616c 6520 3d20 765f 7a6f 6f6d 5f73  scale = v_zoom_s
+00007730: 6361 6c65 0d0a 2020 2020 2020 2020 7365  cale..        se
+00007740: 6c66 2e6d 6173 7465 725f 7669 6577 626f  lf.master_viewbo
+00007750: 7820 3d20 4e6f 6e65 0d0a 2020 2020 2020  x = None..      
+00007760: 2020 7365 6c66 2e72 6f69 7320 3d20 5b5d    self.rois = []
+00007770: 0d0a 2020 2020 2020 2020 7365 6c66 2e77  ..        self.w
+00007780: 696e 2e5f 6973 4d6f 7573 654c 6566 7444  in._isMouseLeftD
+00007790: 7261 6720 3d20 4661 6c73 650d 0a20 2020  rag = False..   
+000077a0: 2020 2020 2073 656c 662e 7265 7365 7428       self.reset(
+000077b0: 290d 0a0d 0a20 2020 2064 6566 2072 6573  )....    def res
+000077c0: 6574 2873 656c 6629 3a0d 0a20 2020 2020  et(self):..     
+000077d0: 2020 2073 656c 662e 765f 7a6f 6f6d 5f62     self.v_zoom_b
+000077e0: 6173 656c 696e 6520 3d20 302e 350d 0a20  aseline = 0.5.. 
+000077f0: 2020 2020 2020 2073 656c 662e 765f 6175         self.v_au
+00007800: 746f 7a6f 6f6d 203d 2054 7275 650d 0a20  tozoom = True.. 
+00007810: 2020 2020 2020 2073 656c 662e 6d61 785f         self.max_
+00007820: 7a6f 6f6d 5f70 6f69 6e74 735f 6620 3d20  zoom_points_f = 
+00007830: 310d 0a20 2020 2020 2020 2073 656c 662e  1..        self.
+00007840: 795f 6d61 7820 3d20 3130 3030 0d0a 2020  y_max = 1000..  
+00007850: 2020 2020 2020 7365 6c66 2e79 5f6d 696e        self.y_min
+00007860: 203d 2030 0d0a 2020 2020 2020 2020 7365   = 0..        se
+00007870: 6c66 2e79 5f70 6f73 6974 6976 6520 3d20  lf.y_positive = 
+00007880: 5472 7565 0d0a 2020 2020 2020 2020 7365  True..        se
+00007890: 6c66 2e78 5f69 6e64 6578 6564 203d 2054  lf.x_indexed = T
+000078a0: 7275 650d 0a20 2020 2020 2020 2073 656c  rue..        sel
+000078b0: 662e 666f 7263 655f 7261 6e67 655f 7570  f.force_range_up
+000078c0: 6461 7465 203d 2030 0d0a 2020 2020 2020  date = 0..      
+000078d0: 2020 7768 696c 6520 7365 6c66 2e72 6f69    while self.roi
+000078e0: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
+000078f0: 7365 6c66 2e72 656d 6f76 655f 6c61 7374  self.remove_last
+00007900: 5f72 6f69 2829 0d0a 2020 2020 2020 2020  _roi()..        
+00007910: 7365 6c66 2e64 7261 775f 6c69 6e65 203d  self.draw_line =
+00007920: 204e 6f6e 650d 0a20 2020 2020 2020 2073   None..        s
+00007930: 656c 662e 6472 6177 696e 6720 3d20 4661  elf.drawing = Fa
+00007940: 6c73 650d 0a20 2020 2020 2020 2073 656c  lse..        sel
+00007950: 662e 7374 616e 6461 6c6f 6e65 7320 3d20  f.standalones = 
+00007960: 7365 7428 290d 0a20 2020 2020 2020 2073  set()..        s
+00007970: 656c 662e 7570 6461 7469 6e67 5f6c 696e  elf.updating_lin
+00007980: 6b65 6420 3d20 4661 6c73 650d 0a20 2020  ked = False..   
+00007990: 2020 2020 2073 656c 662e 7365 745f 6461       self.set_da
+000079a0: 7461 7372 6328 4e6f 6e65 290d 0a20 2020  tasrc(None)..   
+000079b0: 2020 2020 2073 656c 662e 7365 744d 6f75       self.setMou
+000079c0: 7365 456e 6162 6c65 6428 783d 5472 7565  seEnabled(x=True
+000079d0: 2c20 793d 4661 6c73 6529 0d0a 2020 2020  , y=False)..    
+000079e0: 2020 2020 7365 6c66 2e73 6574 5261 6e67      self.setRang
+000079f0: 6528 5174 436f 7265 2e51 5265 6374 4628  e(QtCore.QRectF(
+00007a00: 7067 2e50 6f69 6e74 2830 2c20 3029 2c20  pg.Point(0, 0), 
+00007a10: 7067 2e50 6f69 6e74 2831 2c20 3129 2929  pg.Point(1, 1)))
+00007a20: 0d0a 0d0a 2020 2020 6465 6620 7365 745f  ....    def set_
+00007a30: 6461 7461 7372 6328 7365 6c66 2c20 6461  datasrc(self, da
+00007a40: 7461 7372 6329 3a0d 0a20 2020 2020 2020  tasrc):..       
+00007a50: 2073 656c 662e 6461 7461 7372 6320 3d20   self.datasrc = 
+00007a60: 6461 7461 7372 630d 0a20 2020 2020 2020  datasrc..       
+00007a70: 2069 6620 6e6f 7420 7365 6c66 2e64 6174   if not self.dat
+00007a80: 6173 7263 3a0d 0a20 2020 2020 2020 2020  asrc:..         
+00007a90: 2020 2072 6574 7572 6e0d 0a20 2020 2020     return..     
+00007aa0: 2020 2064 6174 6173 7263 2e75 7064 6174     datasrc.updat
+00007ab0: 655f 696e 6974 5f78 2873 656c 662e 696e  e_init_x(self.in
+00007ac0: 6974 5f73 7465 7073 290d 0a0d 0a20 2020  it_steps)....   
+00007ad0: 2064 6566 2070 7265 5f70 726f 6365 7373   def pre_process
+00007ae0: 5f64 6174 6128 7365 6c66 293a 0d0a 2020  _data(self):..  
+00007af0: 2020 2020 2020 6966 2073 656c 662e 6461        if self.da
+00007b00: 7461 7372 6320 616e 6420 7365 6c66 2e64  tasrc and self.d
+00007b10: 6174 6173 7263 2e73 6361 6c65 5f63 6f6c  atasrc.scale_col
+00007b20: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
+00007b30: 6466 203d 2073 656c 662e 6461 7461 7372  df = self.datasr
+00007b40: 632e 6466 2e69 6c6f 635b 3a2c 2073 656c  c.df.iloc[:, sel
+00007b50: 662e 6461 7461 7372 632e 7363 616c 655f  f.datasrc.scale_
+00007b60: 636f 6c73 5d0d 0a20 2020 2020 2020 2020  cols]..         
+00007b70: 2020 2073 656c 662e 795f 6d61 7820 3d20     self.y_max = 
+00007b80: 6466 2e6d 6178 2829 2e6d 6178 2829 0d0a  df.max().max()..
+00007b90: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00007ba0: 2e79 5f6d 696e 203d 2064 662e 6d69 6e28  .y_min = df.min(
+00007bb0: 292e 6d69 6e28 290d 0a20 2020 2020 2020  ).min()..       
+00007bc0: 2020 2020 2069 6620 7365 6c66 2e79 5f6d       if self.y_m
+00007bd0: 696e 203c 3d20 303a 0d0a 2020 2020 2020  in <= 0:..      
+00007be0: 2020 2020 2020 2020 2020 7365 6c66 2e79            self.y
+00007bf0: 5f70 6f73 6974 6976 6520 3d20 4661 6c73  _positive = Fals
+00007c00: 650d 0a0d 0a20 2020 2040 7072 6f70 6572  e....    @proper
+00007c10: 7479 0d0a 2020 2020 6465 6620 6461 7461  ty..    def data
+00007c20: 7372 635f 6f72 5f73 7461 6e64 616c 6f6e  src_or_standalon
+00007c30: 6528 7365 6c66 293a 0d0a 2020 2020 2020  e(self):..      
+00007c40: 2020 6473 203d 2073 656c 662e 6461 7461    ds = self.data
+00007c50: 7372 630d 0a20 2020 2020 2020 2069 6620  src..        if 
+00007c60: 6e6f 7420 6473 2061 6e64 2073 656c 662e  not ds and self.
+00007c70: 7374 616e 6461 6c6f 6e65 733a 0d0a 2020  standalones:..  
+00007c80: 2020 2020 2020 2020 2020 6473 203d 206e            ds = n
+00007c90: 6578 7428 6974 6572 2873 656c 662e 7374  ext(iter(self.st
+00007ca0: 616e 6461 6c6f 6e65 7329 290d 0a20 2020  andalones))..   
+00007cb0: 2020 2020 2072 6574 7572 6e20 6473 0d0a       return ds..
+00007cc0: 0d0a 2020 2020 6465 6620 7768 6565 6c45  ..    def wheelE
+00007cd0: 7665 6e74 2873 656c 662c 2065 762c 2061  vent(self, ev, a
+00007ce0: 7869 733d 4e6f 6e65 293a 0d0a 2020 2020  xis=None):..    
+00007cf0: 2020 2020 6966 2073 656c 662e 6d61 7374      if self.mast
+00007d00: 6572 5f76 6965 7762 6f78 3a0d 0a20 2020  er_viewbox:..   
+00007d10: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00007d20: 7365 6c66 2e6d 6173 7465 725f 7669 6577  self.master_view
+00007d30: 626f 782e 7768 6565 6c45 7665 6e74 2865  box.wheelEvent(e
+00007d40: 762c 2061 7869 733d 6178 6973 290d 0a20  v, axis=axis).. 
+00007d50: 2020 2020 2020 2069 6620 6576 2e6d 6f64         if ev.mod
+00007d60: 6966 6965 7273 2829 203d 3d20 5174 436f  ifiers() == QtCo
+00007d70: 7265 2e51 742e 4b65 7962 6f61 7264 4d6f  re.Qt.KeyboardMo
+00007d80: 6469 6669 6572 2e43 6f6e 7472 6f6c 4d6f  difier.ControlMo
+00007d90: 6469 6669 6572 3a0d 0a20 2020 2020 2020  difier:..       
+00007da0: 2020 2020 2073 6361 6c65 5f66 6163 7420       scale_fact 
+00007db0: 3d20 310d 0a20 2020 2020 2020 2020 2020  = 1..           
+00007dc0: 2073 656c 662e 765f 7a6f 6f6d 5f73 6361   self.v_zoom_sca
+00007dd0: 6c65 202f 3d20 312e 3032 202a 2a20 2865  le /= 1.02 ** (e
+00007de0: 762e 6465 6c74 6128 2920 2a20 7365 6c66  v.delta() * self
+00007df0: 2e73 7461 7465 5b27 7768 6565 6c53 6361  .state['wheelSca
+00007e00: 6c65 4661 6374 6f72 275d 290d 0a20 2020  leFactor'])..   
+00007e10: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
+00007e20: 2020 2020 2020 2020 7363 616c 655f 6661          scale_fa
+00007e30: 6374 203d 2031 2e30 3220 2a2a 2028 6576  ct = 1.02 ** (ev
+00007e40: 2e64 656c 7461 2829 202a 2073 656c 662e  .delta() * self.
+00007e50: 7374 6174 655b 2777 6865 656c 5363 616c  state['wheelScal
+00007e60: 6546 6163 746f 7227 5d29 0d0a 2020 2020  eFactor'])..    
+00007e70: 2020 2020 7672 203d 2073 656c 662e 7461      vr = self.ta
+00007e80: 7267 6574 5265 6374 2829 0d0a 2020 2020  rgetRect()..    
+00007e90: 2020 2020 6365 6e74 6572 203d 2073 656c      center = sel
+00007ea0: 662e 6d61 7054 6f56 6965 7728 6576 2e73  f.mapToView(ev.s
+00007eb0: 6365 6e65 506f 7328 2929 0d0a 2020 2020  cenePos())..    
+00007ec0: 2020 2020 7063 745f 7820 3d20 2863 656e      pct_x = (cen
+00007ed0: 7465 722e 7828 292d 7672 2e6c 6566 7428  ter.x()-vr.left(
+00007ee0: 2929 202f 2076 722e 7769 6474 6828 290d  )) / vr.width().
+00007ef0: 0a20 2020 2020 2020 2069 6620 7063 745f  .        if pct_
+00007f00: 7820 3c20 302e 3035 3a20 2320 7a6f 6f6d  x < 0.05: # zoom
+00007f10: 2074 6f20 6661 7220 6c65 6674 203d 3e20   to far left => 
+00007f20: 616c 6c20 7468 6520 7761 7920 6c65 6674  all the way left
+00007f30: 0d0a 2020 2020 2020 2020 2020 2020 6365  ..            ce
+00007f40: 6e74 6572 203d 2070 672e 506f 696e 7428  nter = pg.Point(
+00007f50: 7672 2e6c 6566 7428 292c 2063 656e 7465  vr.left(), cente
+00007f60: 722e 7928 2929 0d0a 2020 2020 2020 2020  r.y())..        
+00007f70: 656c 6966 2070 6374 5f78 203e 2030 2e39  elif pct_x > 0.9
+00007f80: 353a 2023 207a 6f6f 6d20 746f 2066 6172  5: # zoom to far
+00007f90: 2072 6967 6874 203d 3e20 616c 6c20 7468   right => all th
+00007fa0: 6520 7761 7920 7269 6768 740d 0a20 2020  e way right..   
+00007fb0: 2020 2020 2020 2020 2063 656e 7465 7220           center 
+00007fc0: 3d20 7067 2e50 6f69 6e74 2876 722e 7269  = pg.Point(vr.ri
+00007fd0: 6768 7428 292c 2063 656e 7465 722e 7928  ght(), center.y(
+00007fe0: 2929 0d0a 2020 2020 2020 2020 7365 6c66  ))..        self
+00007ff0: 2e7a 6f6f 6d5f 7265 6374 2876 722c 2073  .zoom_rect(vr, s
+00008000: 6361 6c65 5f66 6163 742c 2063 656e 7465  cale_fact, cente
+00008010: 7229 0d0a 2020 2020 2020 2020 2320 7570  r)..        # up
+00008020: 6461 7465 2063 726f 7373 6861 6972 0d0a  date crosshair..
+00008030: 2020 2020 2020 2020 5f6d 6f75 7365 5f6d          _mouse_m
+00008040: 6f76 6564 2873 656c 662e 7769 6e2c 2073  oved(self.win, s
+00008050: 656c 662c 204e 6f6e 6529 0d0a 2020 2020  elf, None)..    
+00008060: 2020 2020 6576 2e61 6363 6570 7428 290d      ev.accept().
+00008070: 0a0d 0a20 2020 2064 6566 206d 6f75 7365  ...    def mouse
+00008080: 4472 6167 4576 656e 7428 7365 6c66 2c20  DragEvent(self, 
+00008090: 6576 2c20 6178 6973 3d4e 6f6e 6529 3a0d  ev, axis=None):.
+000080a0: 0a20 2020 2020 2020 2061 7869 7320 3d20  .        axis = 
+000080b0: 3020 2320 646f 6e27 7420 636f 6e73 7472  0 # don't constr
+000080c0: 6169 6e20 6472 6167 2064 6972 6563 7469  ain drag directi
+000080d0: 6f6e 0d0a 2020 2020 2020 2020 6966 2073  on..        if s
+000080e0: 656c 662e 6d61 7374 6572 5f76 6965 7762  elf.master_viewb
+000080f0: 6f78 3a0d 0a20 2020 2020 2020 2020 2020  ox:..           
+00008100: 2072 6574 7572 6e20 7365 6c66 2e6d 6173   return self.mas
+00008110: 7465 725f 7669 6577 626f 782e 6d6f 7573  ter_viewbox.mous
+00008120: 6544 7261 6745 7665 6e74 2865 762c 2061  eDragEvent(ev, a
+00008130: 7869 733d 6178 6973 290d 0a20 2020 2020  xis=axis)..     
+00008140: 2020 2069 6620 6e6f 7420 7365 6c66 2e64     if not self.d
+00008150: 6174 6173 7263 3a0d 0a20 2020 2020 2020  atasrc:..       
+00008160: 2020 2020 2072 6574 7572 6e0d 0a20 2020       return..   
+00008170: 2020 2020 2069 6620 6576 2e62 7574 746f       if ev.butto
+00008180: 6e28 2920 3d3d 2051 7443 6f72 652e 5174  n() == QtCore.Qt
+00008190: 2e4d 6f75 7365 4275 7474 6f6e 2e4c 6566  .MouseButton.Lef
+000081a0: 7442 7574 746f 6e3a 0d0a 2020 2020 2020  tButton:..      
+000081b0: 2020 2020 2020 7365 6c66 2e6d 6f75 7365        self.mouse
+000081c0: 4c65 6674 4472 6167 2865 762c 2061 7869  LeftDrag(ev, axi
+000081d0: 7329 0d0a 2020 2020 2020 2020 656c 6966  s)..        elif
+000081e0: 2065 762e 6275 7474 6f6e 2829 203d 3d20   ev.button() == 
+000081f0: 5174 436f 7265 2e51 742e 4d6f 7573 6542  QtCore.Qt.MouseB
+00008200: 7574 746f 6e2e 4d69 6464 6c65 4275 7474  utton.MiddleButt
+00008210: 6f6e 3a0d 0a20 2020 2020 2020 2020 2020  on:..           
+00008220: 2073 656c 662e 6d6f 7573 654d 6964 646c   self.mouseMiddl
+00008230: 6544 7261 6728 6576 2c20 6178 6973 290d  eDrag(ev, axis).
+00008240: 0a20 2020 2020 2020 2065 6c69 6620 6576  .        elif ev
+00008250: 2e62 7574 746f 6e28 2920 3d3d 2051 7443  .button() == QtC
+00008260: 6f72 652e 5174 2e4d 6f75 7365 4275 7474  ore.Qt.MouseButt
+00008270: 6f6e 2e52 6967 6874 4275 7474 6f6e 3a0d  on.RightButton:.
+00008280: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00008290: 662e 6d6f 7573 6552 6967 6874 4472 6167  f.mouseRightDrag
+000082a0: 2865 762c 2061 7869 7329 0d0a 2020 2020  (ev, axis)..    
+000082b0: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
+000082c0: 2020 2020 2020 2073 7570 6572 2829 2e6d         super().m
+000082d0: 6f75 7365 4472 6167 4576 656e 7428 6576  ouseDragEvent(ev
+000082e0: 2c20 6178 6973 290d 0a0d 0a20 2020 2064  , axis)....    d
+000082f0: 6566 206d 6f75 7365 4c65 6674 4472 6167  ef mouseLeftDrag
+00008300: 2873 656c 662c 2065 762c 2061 7869 7329  (self, ev, axis)
+00008310: 3a0d 0a20 2020 2020 2020 2027 2727 4374  :..        '''Ct
+00008320: 726c 2b4c 4275 7474 6f6e 2064 7261 7720  rl+LButton draw 
+00008330: 6c69 6e65 732e 2727 270d 0a20 2020 2020  lines.'''..     
+00008340: 2020 2069 6620 6576 2e6d 6f64 6966 6965     if ev.modifie
+00008350: 7273 2829 2021 3d20 5174 436f 7265 2e51  rs() != QtCore.Q
+00008360: 742e 4b65 7962 6f61 7264 4d6f 6469 6669  t.KeyboardModifi
+00008370: 6572 2e43 6f6e 7472 6f6c 4d6f 6469 6669  er.ControlModifi
+00008380: 6572 3a0d 0a20 2020 2020 2020 2020 2020  er:..           
+00008390: 2073 7570 6572 2829 2e6d 6f75 7365 4472   super().mouseDr
+000083a0: 6167 4576 656e 7428 6576 2c20 6178 6973  agEvent(ev, axis
+000083b0: 290d 0a20 2020 2020 2020 2020 2020 2069  )..            i
+000083c0: 6620 6576 2e69 7346 696e 6973 6828 293a  f ev.isFinish():
+000083d0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000083e0: 2020 7365 6c66 2e77 696e 2e5f 6973 4d6f    self.win._isMo
+000083f0: 7573 654c 6566 7444 7261 6720 3d20 4661  useLeftDrag = Fa
+00008400: 6c73 650d 0a20 2020 2020 2020 2020 2020  lse..           
+00008410: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
+00008420: 2020 2020 2020 2020 7365 6c66 2e77 696e          self.win
+00008430: 2e5f 6973 4d6f 7573 654c 6566 7444 7261  ._isMouseLeftDra
+00008440: 6720 3d20 5472 7565 0d0a 2020 2020 2020  g = True..      
+00008450: 2020 2020 2020 6966 2065 762e 6973 4669        if ev.isFi
+00008460: 6e69 7368 2829 206f 7220 7365 6c66 2e64  nish() or self.d
+00008470: 7261 7769 6e67 3a0d 0a20 2020 2020 2020  rawing:..       
+00008480: 2020 2020 2020 2020 2073 656c 662e 7265           self.re
+00008490: 6672 6573 685f 616c 6c5f 795f 7a6f 6f6d  fresh_all_y_zoom
+000084a0: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
+000084b0: 6966 206e 6f74 2073 656c 662e 6472 6177  if not self.draw
+000084c0: 696e 673a 0d0a 2020 2020 2020 2020 2020  ing:..          
+000084d0: 2020 2020 2020 7265 7475 726e 0d0a 2020        return..  
+000084e0: 2020 2020 2020 6966 2073 656c 662e 6472        if self.dr
+000084f0: 6177 5f6c 696e 6520 616e 6420 6e6f 7420  aw_line and not 
+00008500: 7365 6c66 2e64 7261 7769 6e67 3a0d 0a20  self.drawing:.. 
+00008510: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00008520: 7365 745f 6472 6177 5f6c 696e 655f 636f  set_draw_line_co
+00008530: 6c6f 7228 6472 6177 5f64 6f6e 655f 636f  lor(draw_done_co
+00008540: 6c6f 7229 0d0a 2020 2020 2020 2020 7031  lor)..        p1
+00008550: 203d 2073 656c 662e 6d61 7054 6f56 6965   = self.mapToVie
+00008560: 7728 6576 2e70 6f73 2829 290d 0a20 2020  w(ev.pos())..   
+00008570: 2020 2020 2070 3120 3d20 5f63 6c61 6d70       p1 = _clamp
+00008580: 5f70 6f69 6e74 2873 656c 662e 7061 7265  _point(self.pare
+00008590: 6e74 2829 2c20 7031 290d 0a20 2020 2020  nt(), p1)..     
+000085a0: 2020 2069 6620 6e6f 7420 7365 6c66 2e64     if not self.d
+000085b0: 7261 7769 6e67 3a0d 0a20 2020 2020 2020  rawing:..       
+000085c0: 2020 2020 2023 2061 6464 206e 6577 206c       # add new l
+000085d0: 696e 650d 0a20 2020 2020 2020 2020 2020  ine..           
+000085e0: 2070 3020 3d20 7365 6c66 2e6d 6170 546f   p0 = self.mapTo
+000085f0: 5669 6577 2865 762e 6c61 7374 506f 7328  View(ev.lastPos(
+00008600: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
+00008610: 7030 203d 205f 636c 616d 705f 706f 696e  p0 = _clamp_poin
+00008620: 7428 7365 6c66 2e70 6172 656e 7428 292c  t(self.parent(),
+00008630: 2070 3029 0d0a 2020 2020 2020 2020 2020   p0)..          
 00008640: 2020 7365 6c66 2e64 7261 775f 6c69 6e65    self.draw_line
-00008650: 2e73 6574 5a56 616c 7565 2834 3029 0d0a  .setZValue(40)..
-00008660: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00008670: 2e72 6f69 732e 6170 7065 6e64 2873 656c  .rois.append(sel
-00008680: 662e 6472 6177 5f6c 696e 6529 0d0a 2020  f.draw_line)..  
-00008690: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-000086a0: 6464 4974 656d 2873 656c 662e 6472 6177  ddItem(self.draw
-000086b0: 5f6c 696e 6529 0d0a 2020 2020 2020 2020  _line)..        
-000086c0: 2020 2020 7365 6c66 2e64 7261 7769 6e67      self.drawing
-000086d0: 203d 2054 7275 650d 0a20 2020 2020 2020   = True..       
-000086e0: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
-000086f0: 2020 2020 2320 6472 6177 2070 6c61 6365      # draw place
-00008700: 6420 706f 696e 7420 6174 2065 6e64 206f  d point at end o
-00008710: 6620 706f 6c79 2d6c 696e 650d 0a20 2020  f poly-line..   
-00008720: 2020 2020 2020 2020 2073 656c 662e 6472           self.dr
-00008730: 6177 5f6c 696e 652e 6d6f 7665 506f 696e  aw_line.movePoin
-00008740: 7428 2d31 2c20 7031 290d 0a20 2020 2020  t(-1, p1)..     
-00008750: 2020 2069 6620 6576 2e69 7346 696e 6973     if ev.isFinis
-00008760: 6828 293a 0d0a 2020 2020 2020 2020 2020  h():..          
-00008770: 2020 7365 6c66 2e64 7261 7769 6e67 203d    self.drawing =
-00008780: 2046 616c 7365 0d0a 2020 2020 2020 2020   False..        
-00008790: 6576 2e61 6363 6570 7428 290d 0a0d 0a20  ev.accept().... 
-000087a0: 2020 2064 6566 206d 6f75 7365 4d69 6464     def mouseMidd
-000087b0: 6c65 4472 6167 2873 656c 662c 2065 762c  leDrag(self, ev,
-000087c0: 2061 7869 7329 3a0d 0a20 2020 2020 2020   axis):..       
-000087d0: 2027 2727 4374 726c 2b4d 4275 7474 6f6e   '''Ctrl+MButton
-000087e0: 2064 7261 7720 656c 6c69 7073 6573 2e27   draw ellipses.'
-000087f0: 2727 0d0a 2020 2020 2020 2020 6966 2065  ''..        if e
-00008800: 762e 6d6f 6469 6669 6572 7328 2920 213d  v.modifiers() !=
-00008810: 2051 7443 6f72 652e 5174 2e4b 6579 626f   QtCore.Qt.Keybo
-00008820: 6172 644d 6f64 6966 6965 722e 436f 6e74  ardModifier.Cont
-00008830: 726f 6c4d 6f64 6966 6965 723a 0d0a 2020  rolModifier:..  
-00008840: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00008850: 2073 7570 6572 2829 2e6d 6f75 7365 4472   super().mouseDr
-00008860: 6167 4576 656e 7428 6576 2c20 6178 6973  agEvent(ev, axis
-00008870: 290d 0a20 2020 2020 2020 2070 3120 3d20  )..        p1 = 
-00008880: 7365 6c66 2e6d 6170 546f 5669 6577 2865  self.mapToView(e
-00008890: 762e 706f 7328 2929 0d0a 2020 2020 2020  v.pos())..      
-000088a0: 2020 7031 203d 205f 636c 616d 705f 706f    p1 = _clamp_po
-000088b0: 696e 7428 7365 6c66 2e70 6172 656e 7428  int(self.parent(
-000088c0: 292c 2070 3129 0d0a 2020 2020 2020 2020  ), p1)..        
-000088d0: 6465 6620 6e6f 6e7a 6572 6f73 697a 6528  def nonzerosize(
-000088e0: 612c 2062 293a 0d0a 2020 2020 2020 2020  a, b):..        
-000088f0: 2020 2020 6320 3d20 622d 610d 0a20 2020      c = b-a..   
-00008900: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00008910: 7067 2e50 6f69 6e74 2861 6273 2863 2e78  pg.Point(abs(c.x
-00008920: 2829 2920 6f72 2031 2c20 6162 7328 632e  ()) or 1, abs(c.
-00008930: 7928 2929 206f 7220 3165 2d33 290d 0a20  y()) or 1e-3).. 
-00008940: 2020 2020 2020 2069 6620 6e6f 7420 7365         if not se
-00008950: 6c66 2e64 7261 7769 6e67 3a0d 0a20 2020  lf.drawing:..   
-00008960: 2020 2020 2020 2020 2023 2061 6464 206e           # add n
-00008970: 6577 2065 6c6c 6970 7365 0d0a 2020 2020  ew ellipse..    
-00008980: 2020 2020 2020 2020 7030 203d 2073 656c          p0 = sel
-00008990: 662e 6d61 7054 6f56 6965 7728 6576 2e6c  f.mapToView(ev.l
-000089a0: 6173 7450 6f73 2829 290d 0a20 2020 2020  astPos())..     
-000089b0: 2020 2020 2020 2070 3020 3d20 5f63 6c61         p0 = _cla
-000089c0: 6d70 5f70 6f69 6e74 2873 656c 662e 7061  mp_point(self.pa
-000089d0: 7265 6e74 2829 2c20 7030 290d 0a20 2020  rent(), p0)..   
-000089e0: 2020 2020 2020 2020 2073 203d 206e 6f6e           s = non
-000089f0: 7a65 726f 7369 7a65 2870 302c 2070 3129  zerosize(p0, p1)
-00008a00: 0d0a 2020 2020 2020 2020 2020 2020 7030  ..            p0
-00008a10: 203d 2051 7443 6f72 652e 5150 6f69 6e74   = QtCore.QPoint
-00008a20: 4628 7030 2e78 2829 2d73 2e78 2829 2f32  F(p0.x()-s.x()/2
-00008a30: 2c20 7030 2e79 2829 2d73 2e79 2829 2f32  , p0.y()-s.y()/2
-00008a40: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
-00008a50: 656c 662e 6472 6177 5f65 6c6c 6970 7365  elf.draw_ellipse
-00008a60: 203d 2046 696e 456c 6c69 7073 6528 7030   = FinEllipse(p0
-00008a70: 2c20 732c 2070 656e 3d70 672e 6d6b 5065  , s, pen=pg.mkPe
-00008a80: 6e28 6472 6177 5f6c 696e 655f 636f 6c6f  n(draw_line_colo
-00008a90: 7229 2c20 6d6f 7661 626c 653d 5472 7565  r), movable=True
-00008aa0: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
-00008ab0: 656c 662e 6472 6177 5f65 6c6c 6970 7365  elf.draw_ellipse
-00008ac0: 2e73 6574 5a56 616c 7565 2838 3029 0d0a  .setZValue(80)..
-00008ad0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00008ae0: 2e72 6f69 732e 6170 7065 6e64 2873 656c  .rois.append(sel
-00008af0: 662e 6472 6177 5f65 6c6c 6970 7365 290d  f.draw_ellipse).
-00008b00: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00008b10: 662e 6164 6449 7465 6d28 7365 6c66 2e64  f.addItem(self.d
-00008b20: 7261 775f 656c 6c69 7073 6529 0d0a 2020  raw_ellipse)..  
-00008b30: 2020 2020 2020 2020 2020 7365 6c66 2e64            self.d
-00008b40: 7261 7769 6e67 203d 2054 7275 650d 0a20  rawing = True.. 
-00008b50: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
-00008b60: 2020 2020 2020 2020 2020 6320 3d20 7365            c = se
-00008b70: 6c66 2e64 7261 775f 656c 6c69 7073 652e  lf.draw_ellipse.
-00008b80: 706f 7328 2920 2b20 7365 6c66 2e64 7261  pos() + self.dra
-00008b90: 775f 656c 6c69 7073 652e 7369 7a65 2829  w_ellipse.size()
-00008ba0: 2a30 2e35 0d0a 2020 2020 2020 2020 2020  *0.5..          
-00008bb0: 2020 7320 3d20 6e6f 6e7a 6572 6f73 697a    s = nonzerosiz
-00008bc0: 6528 632c 2070 3129 0d0a 2020 2020 2020  e(c, p1)..      
-00008bd0: 2020 2020 2020 7365 6c66 2e64 7261 775f        self.draw_
-00008be0: 656c 6c69 7073 652e 7365 7453 697a 6528  ellipse.setSize(
-00008bf0: 732a 322c 2075 7064 6174 653d 4661 6c73  s*2, update=Fals
-00008c00: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
-00008c10: 7365 6c66 2e64 7261 775f 656c 6c69 7073  self.draw_ellips
-00008c20: 652e 7365 7450 6f73 2863 2d73 290d 0a20  e.setPos(c-s).. 
-00008c30: 2020 2020 2020 2069 6620 6576 2e69 7346         if ev.isF
-00008c40: 696e 6973 6828 293a 0d0a 2020 2020 2020  inish():..      
-00008c50: 2020 2020 2020 7365 6c66 2e64 7261 7769        self.drawi
-00008c60: 6e67 203d 2046 616c 7365 0d0a 2020 2020  ng = False..    
-00008c70: 2020 2020 6576 2e61 6363 6570 7428 290d      ev.accept().
-00008c80: 0a0d 0a20 2020 2064 6566 206d 6f75 7365  ...    def mouse
-00008c90: 5269 6768 7444 7261 6728 7365 6c66 2c20  RightDrag(self, 
-00008ca0: 6576 2c20 6178 6973 293a 0d0a 2020 2020  ev, axis):..    
-00008cb0: 2020 2020 2727 2752 4275 7474 6f6e 2069      '''RButton i
-00008cc0: 7320 626f 7820 7a6f 6f6d 2e20 4174 206c  s box zoom. At l
-00008cd0: 6561 7374 2066 6f72 206e 6f77 2e27 2727  east for now.'''
+00008650: 203d 2046 696e 506f 6c79 4c69 6e65 2873   = FinPolyLine(s
+00008660: 656c 662c 205b 7030 2c20 7031 5d2c 2063  elf, [p0, p1], c
+00008670: 6c6f 7365 643d 4661 6c73 652c 2070 656e  losed=False, pen
+00008680: 3d70 672e 6d6b 5065 6e28 6472 6177 5f6c  =pg.mkPen(draw_l
+00008690: 696e 655f 636f 6c6f 7229 2c20 6d6f 7661  ine_color), mova
+000086a0: 626c 653d 4661 6c73 6529 0d0a 2020 2020  ble=False)..    
+000086b0: 2020 2020 2020 2020 7365 6c66 2e64 7261          self.dra
+000086c0: 775f 6c69 6e65 2e73 6574 5a56 616c 7565  w_line.setZValue
+000086d0: 2834 3029 0d0a 2020 2020 2020 2020 2020  (40)..          
+000086e0: 2020 7365 6c66 2e72 6f69 732e 6170 7065    self.rois.appe
+000086f0: 6e64 2873 656c 662e 6472 6177 5f6c 696e  nd(self.draw_lin
+00008700: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
+00008710: 7365 6c66 2e61 6464 4974 656d 2873 656c  self.addItem(sel
+00008720: 662e 6472 6177 5f6c 696e 6529 0d0a 2020  f.draw_line)..  
+00008730: 2020 2020 2020 2020 2020 7365 6c66 2e64            self.d
+00008740: 7261 7769 6e67 203d 2054 7275 650d 0a20  rawing = True.. 
+00008750: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
+00008760: 2020 2020 2020 2020 2020 2320 6472 6177            # draw
+00008770: 2070 6c61 6365 6420 706f 696e 7420 6174   placed point at
+00008780: 2065 6e64 206f 6620 706f 6c79 2d6c 696e   end of poly-lin
+00008790: 650d 0a20 2020 2020 2020 2020 2020 2073  e..            s
+000087a0: 656c 662e 6472 6177 5f6c 696e 652e 6d6f  elf.draw_line.mo
+000087b0: 7665 506f 696e 7428 2d31 2c20 7031 290d  vePoint(-1, p1).
+000087c0: 0a20 2020 2020 2020 2069 6620 6576 2e69  .        if ev.i
+000087d0: 7346 696e 6973 6828 293a 0d0a 2020 2020  sFinish():..    
+000087e0: 2020 2020 2020 2020 7365 6c66 2e64 7261          self.dra
+000087f0: 7769 6e67 203d 2046 616c 7365 0d0a 2020  wing = False..  
+00008800: 2020 2020 2020 6576 2e61 6363 6570 7428        ev.accept(
+00008810: 290d 0a0d 0a20 2020 2064 6566 206d 6f75  )....    def mou
+00008820: 7365 4d69 6464 6c65 4472 6167 2873 656c  seMiddleDrag(sel
+00008830: 662c 2065 762c 2061 7869 7329 3a0d 0a20  f, ev, axis):.. 
+00008840: 2020 2020 2020 2027 2727 4374 726c 2b4d         '''Ctrl+M
+00008850: 4275 7474 6f6e 2064 7261 7720 656c 6c69  Button draw elli
+00008860: 7073 6573 2e27 2727 0d0a 2020 2020 2020  pses.'''..      
+00008870: 2020 6966 2065 762e 6d6f 6469 6669 6572    if ev.modifier
+00008880: 7328 2920 213d 2051 7443 6f72 652e 5174  s() != QtCore.Qt
+00008890: 2e4b 6579 626f 6172 644d 6f64 6966 6965  .KeyboardModifie
+000088a0: 722e 436f 6e74 726f 6c4d 6f64 6966 6965  r.ControlModifie
+000088b0: 723a 0d0a 2020 2020 2020 2020 2020 2020  r:..            
+000088c0: 7265 7475 726e 2073 7570 6572 2829 2e6d  return super().m
+000088d0: 6f75 7365 4472 6167 4576 656e 7428 6576  ouseDragEvent(ev
+000088e0: 2c20 6178 6973 290d 0a20 2020 2020 2020  , axis)..       
+000088f0: 2070 3120 3d20 7365 6c66 2e6d 6170 546f   p1 = self.mapTo
+00008900: 5669 6577 2865 762e 706f 7328 2929 0d0a  View(ev.pos())..
+00008910: 2020 2020 2020 2020 7031 203d 205f 636c          p1 = _cl
+00008920: 616d 705f 706f 696e 7428 7365 6c66 2e70  amp_point(self.p
+00008930: 6172 656e 7428 292c 2070 3129 0d0a 2020  arent(), p1)..  
+00008940: 2020 2020 2020 6465 6620 6e6f 6e7a 6572        def nonzer
+00008950: 6f73 697a 6528 612c 2062 293a 0d0a 2020  osize(a, b):..  
+00008960: 2020 2020 2020 2020 2020 6320 3d20 622d            c = b-
+00008970: 610d 0a20 2020 2020 2020 2020 2020 2072  a..            r
+00008980: 6574 7572 6e20 7067 2e50 6f69 6e74 2861  eturn pg.Point(a
+00008990: 6273 2863 2e78 2829 2920 6f72 2031 2c20  bs(c.x()) or 1, 
+000089a0: 6162 7328 632e 7928 2929 206f 7220 3165  abs(c.y()) or 1e
+000089b0: 2d33 290d 0a20 2020 2020 2020 2069 6620  -3)..        if 
+000089c0: 6e6f 7420 7365 6c66 2e64 7261 7769 6e67  not self.drawing
+000089d0: 3a0d 0a20 2020 2020 2020 2020 2020 2023  :..            #
+000089e0: 2061 6464 206e 6577 2065 6c6c 6970 7365   add new ellipse
+000089f0: 0d0a 2020 2020 2020 2020 2020 2020 7030  ..            p0
+00008a00: 203d 2073 656c 662e 6d61 7054 6f56 6965   = self.mapToVie
+00008a10: 7728 6576 2e6c 6173 7450 6f73 2829 290d  w(ev.lastPos()).
+00008a20: 0a20 2020 2020 2020 2020 2020 2070 3020  .            p0 
+00008a30: 3d20 5f63 6c61 6d70 5f70 6f69 6e74 2873  = _clamp_point(s
+00008a40: 656c 662e 7061 7265 6e74 2829 2c20 7030  elf.parent(), p0
+00008a50: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
+00008a60: 203d 206e 6f6e 7a65 726f 7369 7a65 2870   = nonzerosize(p
+00008a70: 302c 2070 3129 0d0a 2020 2020 2020 2020  0, p1)..        
+00008a80: 2020 2020 7030 203d 2051 7443 6f72 652e      p0 = QtCore.
+00008a90: 5150 6f69 6e74 4628 7030 2e78 2829 2d73  QPointF(p0.x()-s
+00008aa0: 2e78 2829 2f32 2c20 7030 2e79 2829 2d73  .x()/2, p0.y()-s
+00008ab0: 2e79 2829 2f32 290d 0a20 2020 2020 2020  .y()/2)..       
+00008ac0: 2020 2020 2073 656c 662e 6472 6177 5f65       self.draw_e
+00008ad0: 6c6c 6970 7365 203d 2046 696e 456c 6c69  llipse = FinElli
+00008ae0: 7073 6528 7030 2c20 732c 2070 656e 3d70  pse(p0, s, pen=p
+00008af0: 672e 6d6b 5065 6e28 6472 6177 5f6c 696e  g.mkPen(draw_lin
+00008b00: 655f 636f 6c6f 7229 2c20 6d6f 7661 626c  e_color), movabl
+00008b10: 653d 5472 7565 290d 0a20 2020 2020 2020  e=True)..       
+00008b20: 2020 2020 2073 656c 662e 6472 6177 5f65       self.draw_e
+00008b30: 6c6c 6970 7365 2e73 6574 5a56 616c 7565  llipse.setZValue
+00008b40: 2838 3029 0d0a 2020 2020 2020 2020 2020  (80)..          
+00008b50: 2020 7365 6c66 2e72 6f69 732e 6170 7065    self.rois.appe
+00008b60: 6e64 2873 656c 662e 6472 6177 5f65 6c6c  nd(self.draw_ell
+00008b70: 6970 7365 290d 0a20 2020 2020 2020 2020  ipse)..         
+00008b80: 2020 2073 656c 662e 6164 6449 7465 6d28     self.addItem(
+00008b90: 7365 6c66 2e64 7261 775f 656c 6c69 7073  self.draw_ellips
+00008ba0: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
+00008bb0: 7365 6c66 2e64 7261 7769 6e67 203d 2054  self.drawing = T
+00008bc0: 7275 650d 0a20 2020 2020 2020 2065 6c73  rue..        els
+00008bd0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+00008be0: 6320 3d20 7365 6c66 2e64 7261 775f 656c  c = self.draw_el
+00008bf0: 6c69 7073 652e 706f 7328 2920 2b20 7365  lipse.pos() + se
+00008c00: 6c66 2e64 7261 775f 656c 6c69 7073 652e  lf.draw_ellipse.
+00008c10: 7369 7a65 2829 2a30 2e35 0d0a 2020 2020  size()*0.5..    
+00008c20: 2020 2020 2020 2020 7320 3d20 6e6f 6e7a          s = nonz
+00008c30: 6572 6f73 697a 6528 632c 2070 3129 0d0a  erosize(c, p1)..
+00008c40: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00008c50: 2e64 7261 775f 656c 6c69 7073 652e 7365  .draw_ellipse.se
+00008c60: 7453 697a 6528 732a 322c 2075 7064 6174  tSize(s*2, updat
+00008c70: 653d 4661 6c73 6529 0d0a 2020 2020 2020  e=False)..      
+00008c80: 2020 2020 2020 7365 6c66 2e64 7261 775f        self.draw_
+00008c90: 656c 6c69 7073 652e 7365 7450 6f73 2863  ellipse.setPos(c
+00008ca0: 2d73 290d 0a20 2020 2020 2020 2069 6620  -s)..        if 
+00008cb0: 6576 2e69 7346 696e 6973 6828 293a 0d0a  ev.isFinish():..
+00008cc0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00008cd0: 2e64 7261 7769 6e67 203d 2046 616c 7365  .drawing = False
 00008ce0: 0d0a 2020 2020 2020 2020 6576 2e61 6363  ..        ev.acc
-00008cf0: 6570 7428 290d 0a20 2020 2020 2020 2069  ept()..        i
-00008d00: 6620 6e6f 7420 6576 2e69 7346 696e 6973  f not ev.isFinis
-00008d10: 6828 293a 0d0a 2020 2020 2020 2020 2020  h():..          
-00008d20: 2020 7365 6c66 2e75 7064 6174 6553 6361    self.updateSca
-00008d30: 6c65 426f 7828 6576 2e62 7574 746f 6e44  leBox(ev.buttonD
-00008d40: 6f77 6e50 6f73 2829 2c20 6576 2e70 6f73  ownPos(), ev.pos
-00008d50: 2829 290d 0a20 2020 2020 2020 2065 6c73  ())..        els
-00008d60: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-00008d70: 7365 6c66 2e72 6253 6361 6c65 426f 782e  self.rbScaleBox.
-00008d80: 6869 6465 2829 0d0a 2020 2020 2020 2020  hide()..        
-00008d90: 2020 2020 6178 203d 2051 7443 6f72 652e      ax = QtCore.
-00008da0: 5152 6563 7446 2870 672e 506f 696e 7428  QRectF(pg.Point(
-00008db0: 6576 2e62 7574 746f 6e44 6f77 6e50 6f73  ev.buttonDownPos
-00008dc0: 2865 762e 6275 7474 6f6e 2829 2929 2c20  (ev.button())), 
-00008dd0: 7067 2e50 6f69 6e74 2865 762e 706f 7328  pg.Point(ev.pos(
-00008de0: 2929 290d 0a20 2020 2020 2020 2020 2020  )))..           
-00008df0: 2061 7820 3d20 7365 6c66 2e63 6869 6c64   ax = self.child
-00008e00: 4772 6f75 702e 6d61 7052 6563 7446 726f  Group.mapRectFro
-00008e10: 6d50 6172 656e 7428 6178 290d 0a20 2020  mParent(ax)..   
-00008e20: 2020 2020 2020 2020 2069 6620 6178 2e77           if ax.w
-00008e30: 6964 7468 2829 203c 2032 3a20 2320 7a6f  idth() < 2: # zo
-00008e40: 6f6d 696e 6720 7468 6973 206e 6172 726f  oming this narro
-00008e50: 7720 6973 2070 726f 6261 626c 7920 6120  w is probably a 
-00008e60: 6d69 7374 616b 650d 0a20 2020 2020 2020  mistake..       
-00008e70: 2020 2020 2020 2020 2061 782e 6164 6a75           ax.adju
-00008e80: 7374 282d 312c 2030 2c20 2b31 2c20 3029  st(-1, 0, +1, 0)
-00008e90: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-00008ea0: 6c66 2e73 686f 7741 7852 6563 7428 6178  lf.showAxRect(ax
-00008eb0: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
-00008ec0: 656c 662e 6178 4869 7374 6f72 7950 6f69  elf.axHistoryPoi
-00008ed0: 6e74 6572 202b 3d20 310d 0a20 2020 2020  nter += 1..     
-00008ee0: 2020 2020 2020 2073 656c 662e 6178 4869         self.axHi
-00008ef0: 7374 6f72 7920 3d20 7365 6c66 2e61 7848  story = self.axH
-00008f00: 6973 746f 7279 5b3a 7365 6c66 2e61 7848  istory[:self.axH
-00008f10: 6973 746f 7279 506f 696e 7465 725d 202b  istoryPointer] +
-00008f20: 205b 6178 5d0d 0a0d 0a20 2020 2064 6566   [ax]....    def
-00008f30: 206d 6f75 7365 436c 6963 6b45 7665 6e74   mouseClickEvent
-00008f40: 2873 656c 662c 2065 7629 3a0d 0a20 2020  (self, ev):..   
-00008f50: 2020 2020 2069 6620 7365 6c66 2e6d 6173       if self.mas
-00008f60: 7465 725f 7669 6577 626f 783a 0d0a 2020  ter_viewbox:..  
-00008f70: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00008f80: 2073 656c 662e 6d61 7374 6572 5f76 6965   self.master_vie
-00008f90: 7762 6f78 2e6d 6f75 7365 436c 6963 6b45  wbox.mouseClickE
-00008fa0: 7665 6e74 2865 7629 0d0a 2020 2020 2020  vent(ev)..      
-00008fb0: 2020 6966 205f 6d6f 7573 655f 636c 6963    if _mouse_clic
-00008fc0: 6b65 6428 7365 6c66 2c20 6576 293a 0d0a  ked(self, ev):..
-00008fd0: 2020 2020 2020 2020 2020 2020 6576 2e61              ev.a
-00008fe0: 6363 6570 7428 290d 0a20 2020 2020 2020  ccept()..       
-00008ff0: 2020 2020 2072 6574 7572 6e0d 0a20 2020       return..   
-00009000: 2020 2020 2069 6620 6576 2e62 7574 746f       if ev.butto
-00009010: 6e28 2920 213d 2051 7443 6f72 652e 5174  n() != QtCore.Qt
-00009020: 2e4d 6f75 7365 4275 7474 6f6e 2e4c 6566  .MouseButton.Lef
-00009030: 7442 7574 746f 6e20 6f72 2065 762e 6d6f  tButton or ev.mo
-00009040: 6469 6669 6572 7328 2920 213d 2051 7443  difiers() != QtC
-00009050: 6f72 652e 5174 2e4b 6579 626f 6172 644d  ore.Qt.KeyboardM
-00009060: 6f64 6966 6965 722e 436f 6e74 726f 6c4d  odifier.ControlM
-00009070: 6f64 6966 6965 7220 6f72 206e 6f74 2073  odifier or not s
-00009080: 656c 662e 6472 6177 5f6c 696e 653a 0d0a  elf.draw_line:..
-00009090: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-000090a0: 726e 2073 7570 6572 2829 2e6d 6f75 7365  rn super().mouse
-000090b0: 436c 6963 6b45 7665 6e74 2865 7629 0d0a  ClickEvent(ev)..
-000090c0: 2020 2020 2020 2020 2320 6164 6420 616e          # add an
-000090d0: 6f74 6865 7220 7365 676d 656e 7420 746f  other segment to
-000090e0: 2074 6865 2063 7572 7265 6e74 6c79 2064   the currently d
-000090f0: 7261 776e 206c 696e 650d 0a20 2020 2020  rawn line..     
-00009100: 2020 2070 203d 2073 656c 662e 6d61 7043     p = self.mapC
-00009110: 6c69 636b 546f 5669 6577 2865 762e 706f  lickToView(ev.po
-00009120: 7328 2929 0d0a 2020 2020 2020 2020 7020  s())..        p 
-00009130: 3d20 5f63 6c61 6d70 5f70 6f69 6e74 2873  = _clamp_point(s
-00009140: 656c 662e 7061 7265 6e74 2829 2c20 7029  elf.parent(), p)
-00009150: 0d0a 2020 2020 2020 2020 7365 6c66 2e61  ..        self.a
-00009160: 7070 656e 645f 6472 6177 5f73 6567 6d65  ppend_draw_segme
-00009170: 6e74 2870 290d 0a20 2020 2020 2020 2073  nt(p)..        s
-00009180: 656c 662e 6472 6177 696e 6720 3d20 4661  elf.drawing = Fa
-00009190: 6c73 650d 0a20 2020 2020 2020 2065 762e  lse..        ev.
-000091a0: 6163 6365 7074 2829 0d0a 0d0a 2020 2020  accept()....    
-000091b0: 6465 6620 6d61 7043 6c69 636b 546f 5669  def mapClickToVi
-000091c0: 6577 2873 656c 662c 2070 6f73 293a 0d0a  ew(self, pos):..
-000091d0: 2020 2020 2020 2020 2727 276d 6170 546f          '''mapTo
-000091e0: 5669 6577 2829 2064 6f65 7320 6e6f 7420  View() does not 
-000091f0: 646f 2067 7269 6473 2070 726f 7065 726c  do grids properl
-00009200: 7920 696e 2065 6d62 6564 6465 6420 7769  y in embedded wi
-00009210: 6467 6574 732e 2053 7472 616e 6765 6c79  dgets. Strangely
-00009220: 2c20 6f6e 6c79 2061 6666 6563 7420 636c  , only affect cl
-00009230: 6963 6b73 2c20 6e6f 7420 6472 6167 732e  icks, not drags.
-00009240: 2727 270d 0a20 2020 2020 2020 2069 6620  '''..        if 
-00009250: 7365 6c66 2e77 696e 2e70 6172 656e 7428  self.win.parent(
-00009260: 2920 6973 206e 6f74 204e 6f6e 653a 0d0a  ) is not None:..
-00009270: 2020 2020 2020 2020 2020 2020 6178 203d              ax =
-00009280: 2073 656c 662e 7061 7265 6e74 2829 0d0a   self.parent()..
-00009290: 2020 2020 2020 2020 2020 2020 6966 2061              if a
-000092a0: 782e 6765 7441 7869 7328 2772 6967 6874  x.getAxis('right
-000092b0: 2729 2e67 7269 643a 0d0a 2020 2020 2020  ').grid:..      
-000092c0: 2020 2020 2020 2020 2020 706f 732e 7365            pos.se
-000092d0: 7458 2870 6f73 2e78 2829 202b 2073 656c  tX(pos.x() + sel
-000092e0: 662e 7769 6474 6828 2929 0d0a 2020 2020  f.width())..    
-000092f0: 2020 2020 2020 2020 656c 6966 2061 782e          elif ax.
-00009300: 6765 7441 7869 7328 2762 6f74 746f 6d27  getAxis('bottom'
-00009310: 292e 6772 6964 3a0d 0a20 2020 2020 2020  ).grid:..       
-00009320: 2020 2020 2020 2020 2070 6f73 2e73 6574           pos.set
-00009330: 5928 706f 732e 7928 2920 2b20 7365 6c66  Y(pos.y() + self
-00009340: 2e68 6569 6768 7428 2929 0d0a 2020 2020  .height())..    
-00009350: 2020 2020 7265 7475 726e 2073 7570 6572      return super
-00009360: 2829 2e6d 6170 546f 5669 6577 2870 6f73  ().mapToView(pos
-00009370: 290d 0a0d 0a20 2020 2064 6566 206b 6579  )....    def key
-00009380: 5072 6573 7345 7665 6e74 2873 656c 662c  PressEvent(self,
-00009390: 2065 7629 3a0d 0a20 2020 2020 2020 2069   ev):..        i
-000093a0: 6620 7365 6c66 2e6d 6173 7465 725f 7669  f self.master_vi
-000093b0: 6577 626f 783a 0d0a 2020 2020 2020 2020  ewbox:..        
-000093c0: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-000093d0: 6d61 7374 6572 5f76 6965 7762 6f78 2e6b  master_viewbox.k
-000093e0: 6579 5072 6573 7345 7665 6e74 2865 7629  eyPressEvent(ev)
-000093f0: 0d0a 2020 2020 2020 2020 6966 205f 6b65  ..        if _ke
-00009400: 795f 7072 6573 7365 6428 7365 6c66 2c20  y_pressed(self, 
-00009410: 6576 293a 0d0a 2020 2020 2020 2020 2020  ev):..          
-00009420: 2020 6576 2e61 6363 6570 7428 290d 0a20    ev.accept().. 
-00009430: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00009440: 6e0d 0a20 2020 2020 2020 2073 7570 6572  n..        super
-00009450: 2829 2e6b 6579 5072 6573 7345 7665 6e74  ().keyPressEvent
-00009460: 2865 7629 0d0a 0d0a 2020 2020 6465 6620  (ev)....    def 
-00009470: 6c69 6e6b 6564 5669 6577 4368 616e 6765  linkedViewChange
-00009480: 6428 7365 6c66 2c20 7669 6577 2c20 6178  d(self, view, ax
-00009490: 6973 293a 0d0a 2020 2020 2020 2020 6966  is):..        if
-000094a0: 206e 6f74 2073 656c 662e 6461 7461 7372   not self.datasr
-000094b0: 6320 6f72 2073 656c 662e 7570 6461 7469  c or self.updati
-000094c0: 6e67 5f6c 696e 6b65 643a 0d0a 2020 2020  ng_linked:..    
-000094d0: 2020 2020 2020 2020 7265 7475 726e 0d0a          return..
-000094e0: 2020 2020 2020 2020 6966 2076 6965 7720          if view 
-000094f0: 616e 6420 7365 6c66 2e64 6174 6173 7263  and self.datasrc
-00009500: 2061 6e64 2076 6965 772e 6461 7461 7372   and view.datasr
-00009510: 633a 0d0a 2020 2020 2020 2020 2020 2020  c:..            
-00009520: 7365 6c66 2e75 7064 6174 696e 675f 6c69  self.updating_li
-00009530: 6e6b 6564 203d 2054 7275 650d 0a20 2020  nked = True..   
-00009540: 2020 2020 2020 2020 2074 7220 3d20 7365           tr = se
-00009550: 6c66 2e74 6172 6765 7452 6563 7428 290d  lf.targetRect().
-00009560: 0a20 2020 2020 2020 2020 2020 2076 7220  .            vr 
-00009570: 3d20 7669 6577 2e74 6172 6765 7452 6563  = view.targetRec
-00009580: 7428 290d 0a20 2020 2020 2020 2020 2020  t()..           
-00009590: 2069 735f 6469 7274 7920 3d20 7669 6577   is_dirty = view
-000095a0: 2e66 6f72 6365 5f72 616e 6765 5f75 7064  .force_range_upd
-000095b0: 6174 6520 3e20 300d 0a20 2020 2020 2020  ate > 0..       
-000095c0: 2020 2020 2069 735f 7361 6d65 5f73 6361       is_same_sca
-000095d0: 6c65 203d 2073 656c 662e 6461 7461 7372  le = self.datasr
-000095e0: 632e 786c 656e 203d 3d20 7669 6577 2e64  c.xlen == view.d
-000095f0: 6174 6173 7263 2e78 6c65 6e0d 0a20 2020  atasrc.xlen..   
-00009600: 2020 2020 2020 2020 2069 6620 6973 5f73           if is_s
-00009610: 616d 655f 7363 616c 653a 2023 2073 7461  ame_scale: # sta
-00009620: 626c 6520 7a6f 6f6d 2062 6173 6564 206f  ble zoom based o
-00009630: 6e20 696e 6465 780d 0a20 2020 2020 2020  n index..       
-00009640: 2020 2020 2020 2020 2069 6620 6973 5f64           if is_d
-00009650: 6972 7479 206f 7220 6162 7328 7672 2e6c  irty or abs(vr.l
-00009660: 6566 7428 292d 7472 2e6c 6566 7428 2929  eft()-tr.left())
-00009670: 203e 3d20 3120 6f72 2061 6273 2876 722e   >= 1 or abs(vr.
-00009680: 7269 6768 7428 292d 7472 2e72 6967 6874  right()-tr.right
-00009690: 2829 2920 3e3d 2031 3a0d 0a20 2020 2020  ()) >= 1:..     
-000096a0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-000096b0: 6620 6973 5f64 6972 7479 3a0d 0a20 2020  f is_dirty:..   
-000096c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000096d0: 2020 2020 2076 6965 772e 666f 7263 655f       view.force_
-000096e0: 7261 6e67 655f 7570 6461 7465 202d 3d20  range_update -= 
-000096f0: 310d 0a20 2020 2020 2020 2020 2020 2020  1..             
-00009700: 2020 2020 2020 2073 656c 662e 7570 6461         self.upda
-00009710: 7465 5f79 5f7a 6f6f 6d28 7672 2e6c 6566  te_y_zoom(vr.lef
-00009720: 7428 292c 2076 722e 7269 6768 7428 2929  t(), vr.right())
-00009730: 0d0a 2020 2020 2020 2020 2020 2020 656c  ..            el
-00009740: 7365 3a20 2320 736c 6f70 7079 206f 6e65  se: # sloppy one
-00009750: 2062 6173 6564 206f 6e20 7469 6d65 2073   based on time s
-00009760: 7461 6d70 730d 0a20 2020 2020 2020 2020  tamps..         
-00009770: 2020 2020 2020 2074 7430 2c74 7431 2c5f         tt0,tt1,_
-00009780: 2c5f 2c5f 203d 2073 656c 662e 6461 7461  ,_,_ = self.data
-00009790: 7372 632e 6869 6c6f 2874 722e 6c65 6674  src.hilo(tr.left
-000097a0: 2829 2c20 7472 2e72 6967 6874 2829 290d  (), tr.right()).
-000097b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000097c0: 2076 7430 2c76 7431 2c5f 2c5f 2c5f 203d   vt0,vt1,_,_,_ =
-000097d0: 2076 6965 772e 6461 7461 7372 632e 6869   view.datasrc.hi
-000097e0: 6c6f 2876 722e 6c65 6674 2829 2c20 7672  lo(vr.left(), vr
-000097f0: 2e72 6967 6874 2829 290d 0a20 2020 2020  .right())..     
-00009800: 2020 2020 2020 2020 2020 2070 6572 696f             perio
-00009810: 6432 203d 2073 656c 662e 6461 7461 7372  d2 = self.datasr
-00009820: 632e 7065 7269 6f64 5f6e 7320 2a20 302e  c.period_ns * 0.
-00009830: 350d 0a20 2020 2020 2020 2020 2020 2020  5..             
-00009840: 2020 2069 6620 6973 5f64 6972 7479 206f     if is_dirty o
-00009850: 7220 6162 7328 7674 302d 7474 3029 203e  r abs(vt0-tt0) >
-00009860: 3d20 7065 7269 6f64 3220 6f72 2061 6273  = period2 or abs
-00009870: 2876 7431 2d74 7431 2920 3e3d 2070 6572  (vt1-tt1) >= per
-00009880: 696f 6432 3a0d 0a20 2020 2020 2020 2020  iod2:..         
-00009890: 2020 2020 2020 2020 2020 2069 6620 6973             if is
-000098a0: 5f64 6972 7479 3a0d 0a20 2020 2020 2020  _dirty:..       
-000098b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000098c0: 2076 6965 772e 666f 7263 655f 7261 6e67   view.force_rang
-000098d0: 655f 7570 6461 7465 202d 3d20 310d 0a20  e_update -= 1.. 
-000098e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000098f0: 2020 2069 6620 7365 6c66 2e70 6172 656e     if self.paren
-00009900: 7428 293a 0d0a 2020 2020 2020 2020 2020  t():..          
-00009910: 2020 2020 2020 2020 2020 2020 2020 7830                x0
-00009920: 2c78 3120 3d20 5f70 6474 696d 6532 696e  ,x1 = _pdtime2in
-00009930: 6465 7828 7365 6c66 2e70 6172 656e 7428  dex(self.parent(
-00009940: 292c 2070 642e 5365 7269 6573 285b 7674  ), pd.Series([vt
-00009950: 302c 7674 315d 292c 2061 6e79 5f65 6e64  0,vt1]), any_end
-00009960: 3d54 7275 6529 0d0a 2020 2020 2020 2020  =True)..        
-00009970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009980: 7365 6c66 2e75 7064 6174 655f 795f 7a6f  self.update_y_zo
-00009990: 6f6d 2878 302c 2078 3129 0d0a 2020 2020  om(x0, x1)..    
-000099a0: 2020 2020 2020 2020 7365 6c66 2e75 7064          self.upd
-000099b0: 6174 696e 675f 6c69 6e6b 6564 203d 2046  ating_linked = F
-000099c0: 616c 7365 0d0a 0d0a 2020 2020 6465 6620  alse....    def 
-000099d0: 7a6f 6f6d 5f72 6563 7428 7365 6c66 2c20  zoom_rect(self, 
-000099e0: 7672 2c20 7363 616c 655f 6661 6374 2c20  vr, scale_fact, 
-000099f0: 6365 6e74 6572 293a 0d0a 2020 2020 2020  center):..      
-00009a00: 2020 6966 206e 6f74 2073 656c 662e 6461    if not self.da
-00009a10: 7461 7372 633a 0d0a 2020 2020 2020 2020  tasrc:..        
-00009a20: 2020 2020 7265 7475 726e 0d0a 2020 2020      return..    
-00009a30: 2020 2020 7830 203d 2063 656e 7465 722e      x0 = center.
-00009a40: 7828 2920 2b20 2876 722e 6c65 6674 2829  x() + (vr.left()
-00009a50: 2d63 656e 7465 722e 7828 2929 202a 2073  -center.x()) * s
-00009a60: 6361 6c65 5f66 6163 740d 0a20 2020 2020  cale_fact..     
-00009a70: 2020 2078 3120 3d20 6365 6e74 6572 2e78     x1 = center.x
-00009a80: 2829 202b 2028 7672 2e72 6967 6874 2829  () + (vr.right()
-00009a90: 2d63 656e 7465 722e 7828 2929 202a 2073  -center.x()) * s
-00009aa0: 6361 6c65 5f66 6163 740d 0a20 2020 2020  cale_fact..     
-00009ab0: 2020 2073 656c 662e 7570 6461 7465 5f79     self.update_y
-00009ac0: 5f7a 6f6f 6d28 7830 2c20 7831 290d 0a0d  _zoom(x0, x1)...
-00009ad0: 0a20 2020 2064 6566 2070 616e 5f78 2873  .    def pan_x(s
-00009ae0: 656c 662c 2073 7465 7073 3d4e 6f6e 652c  elf, steps=None,
-00009af0: 2070 6572 6365 6e74 3d4e 6f6e 6529 3a0d   percent=None):.
-00009b00: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-00009b10: 2e64 6174 6173 7263 2069 7320 4e6f 6e65  .datasrc is None
-00009b20: 3a0d 0a20 2020 2020 2020 2020 2020 2072  :..            r
-00009b30: 6574 7572 6e0d 0a20 2020 2020 2020 2069  eturn..        i
-00009b40: 6620 7374 6570 7320 6973 204e 6f6e 653a  f steps is None:
-00009b50: 0d0a 2020 2020 2020 2020 2020 2020 7374  ..            st
-00009b60: 6570 7320 3d20 696e 7428 7065 7263 656e  eps = int(percen
-00009b70: 742f 3130 302a 7365 6c66 2e74 6172 6765  t/100*self.targe
-00009b80: 7452 6563 7428 292e 7769 6474 6828 2929  tRect().width())
-00009b90: 0d0a 2020 2020 2020 2020 7472 203d 2073  ..        tr = s
-00009ba0: 656c 662e 7461 7267 6574 5265 6374 2829  elf.targetRect()
-00009bb0: 0d0a 2020 2020 2020 2020 7831 203d 2074  ..        x1 = t
-00009bc0: 722e 7269 6768 7428 2920 2b20 7374 6570  r.right() + step
-00009bd0: 730d 0a20 2020 2020 2020 2073 7461 7274  s..        start
-00009be0: 7820 3d20 2d73 6964 655f 6d61 7267 696e  x = -side_margin
-00009bf0: 0d0a 2020 2020 2020 2020 656e 6478 203d  ..        endx =
-00009c00: 2073 656c 662e 6461 7461 7372 632e 786c   self.datasrc.xl
-00009c10: 656e 202b 2072 6967 6874 5f6d 6172 6769  en + right_margi
-00009c20: 6e5f 6361 6e64 6c65 7320 2d20 7369 6465  n_candles - side
-00009c30: 5f6d 6172 6769 6e0d 0a20 2020 2020 2020  _margin..       
-00009c40: 2069 6620 7831 203e 2065 6e64 783a 0d0a   if x1 > endx:..
-00009c50: 2020 2020 2020 2020 2020 2020 7831 203d              x1 =
-00009c60: 2065 6e64 780d 0a20 2020 2020 2020 2078   endx..        x
-00009c70: 3020 3d20 7831 202d 2074 722e 7769 6474  0 = x1 - tr.widt
-00009c80: 6828 290d 0a20 2020 2020 2020 2069 6620  h()..        if 
-00009c90: 7830 203c 2073 7461 7274 783a 0d0a 2020  x0 < startx:..  
-00009ca0: 2020 2020 2020 2020 2020 7830 203d 2073            x0 = s
-00009cb0: 7461 7274 780d 0a20 2020 2020 2020 2020  tartx..         
-00009cc0: 2020 2078 3120 3d20 7830 202b 2074 722e     x1 = x0 + tr.
-00009cd0: 7769 6474 6828 290d 0a20 2020 2020 2020  width()..       
-00009ce0: 2073 656c 662e 7570 6461 7465 5f79 5f7a   self.update_y_z
-00009cf0: 6f6f 6d28 7830 2c20 7831 290d 0a0d 0a20  oom(x0, x1).... 
-00009d00: 2020 2064 6566 2072 6566 7265 7368 5f61     def refresh_a
-00009d10: 6c6c 5f79 5f7a 6f6f 6d28 7365 6c66 293a  ll_y_zoom(self):
-00009d20: 0d0a 2020 2020 2020 2020 2727 2754 6869  ..        '''Thi
-00009d30: 7320 7570 6461 7465 7320 5920 7a6f 6f6d  s updates Y zoom
-00009d40: 206f 6e20 616c 6c20 7669 6577 732c 2073   on all views, s
-00009d50: 7563 6820 6173 2077 6865 6e20 6120 6d6f  uch as when a mo
-00009d60: 7573 6520 6472 6167 2069 7320 636f 6d70  use drag is comp
-00009d70: 6c65 7465 642e 2727 270d 0a20 2020 2020  leted.'''..     
-00009d80: 2020 206d 6169 6e5f 7662 203d 2073 656c     main_vb = sel
-00009d90: 660d 0a20 2020 2020 2020 2069 6620 7365  f..        if se
-00009da0: 6c66 2e6c 696e 6b65 6456 6965 7728 3029  lf.linkedView(0)
-00009db0: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
-00009dc0: 656c 662e 666f 7263 655f 7261 6e67 655f  elf.force_range_
-00009dd0: 7570 6461 7465 203d 2031 2023 206d 6169  update = 1 # mai
-00009de0: 6e20 6e65 6564 2074 6f20 7570 6461 7465  n need to update
-00009df0: 206f 6e6c 7920 6f6e 6365 2074 6f20 7573   only once to us
-00009e00: 0d0a 2020 2020 2020 2020 2020 2020 6d61  ..            ma
-00009e10: 696e 5f76 6220 3d20 6c69 7374 2873 656c  in_vb = list(sel
-00009e20: 662e 7769 6e2e 6178 7329 5b30 5d2e 7662  f.win.axs)[0].vb
-00009e30: 0d0a 2020 2020 2020 2020 6d61 696e 5f76  ..        main_v
-00009e40: 622e 666f 7263 655f 7261 6e67 655f 7570  b.force_range_up
-00009e50: 6461 7465 203d 206c 656e 2873 656c 662e  date = len(self.
-00009e60: 7769 6e2e 6178 7329 2d31 2023 2075 7064  win.axs)-1 # upd
-00009e70: 6174 6520 6d61 696e 2061 7320 6d61 6e79  ate main as many
-00009e80: 2074 696d 6573 2061 7320 7468 6572 6520   times as there 
-00009e90: 6172 6520 6f74 6865 7220 726f 7773 0d0a  are other rows..
-00009ea0: 2020 2020 2020 2020 7365 6c66 2e75 7064          self.upd
-00009eb0: 6174 655f 795f 7a6f 6f6d 2829 0d0a 2020  ate_y_zoom()..  
-00009ec0: 2020 2020 2020 2320 7265 6672 6573 6820        # refresh 
-00009ed0: 6372 6f73 7368 6169 7220 7768 656e 2064  crosshair when d
-00009ee0: 6f6e 650d 0a20 2020 2020 2020 205f 6d6f  one..        _mo
-00009ef0: 7573 655f 6d6f 7665 6428 7365 6c66 2e77  use_moved(self.w
-00009f00: 696e 2c20 7365 6c66 2c20 4e6f 6e65 290d  in, self, None).
-00009f10: 0a0d 0a20 2020 2064 6566 2075 7064 6174  ...    def updat
-00009f20: 655f 795f 7a6f 6f6d 2873 656c 662c 2078  e_y_zoom(self, x
-00009f30: 303d 4e6f 6e65 2c20 7831 3d4e 6f6e 6529  0=None, x1=None)
-00009f40: 3a0d 0a20 2020 2020 2020 2064 6174 6173  :..        datas
-00009f50: 7263 203d 2073 656c 662e 6461 7461 7372  rc = self.datasr
-00009f60: 635f 6f72 5f73 7461 6e64 616c 6f6e 650d  c_or_standalone.
-00009f70: 0a20 2020 2020 2020 2069 6620 6461 7461  .        if data
-00009f80: 7372 6320 6973 204e 6f6e 653a 0d0a 2020  src is None:..  
-00009f90: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00009fa0: 0d0a 2020 2020 2020 2020 6966 2078 3020  ..        if x0 
-00009fb0: 6973 204e 6f6e 6520 6f72 2078 3120 6973  is None or x1 is
-00009fc0: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
-00009fd0: 2020 2020 7472 203d 2073 656c 662e 7461      tr = self.ta
-00009fe0: 7267 6574 5265 6374 2829 0d0a 2020 2020  rgetRect()..    
-00009ff0: 2020 2020 2020 2020 7830 203d 2074 722e          x0 = tr.
-0000a000: 6c65 6674 2829 0d0a 2020 2020 2020 2020  left()..        
-0000a010: 2020 2020 7831 203d 2074 722e 7269 6768      x1 = tr.righ
-0000a020: 7428 290d 0a20 2020 2020 2020 2020 2020  t()..           
-0000a030: 2069 6620 7831 2d78 3020 3c3d 2031 3a0d   if x1-x0 <= 1:.
-0000a040: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000a050: 2072 6574 7572 6e0d 0a20 2020 2020 2020   return..       
-0000a060: 2023 206d 616b 6520 6564 6765 7320 7269   # make edges ri
-0000a070: 6769 640d 0a20 2020 2020 2020 2078 6c20  gid..        xl 
-0000a080: 3d20 6d61 7828 5f72 6f75 6e64 2878 302d  = max(_round(x0-
-0000a090: 7369 6465 5f6d 6172 6769 6e29 2b73 6964  side_margin)+sid
-0000a0a0: 655f 6d61 7267 696e 2c20 2d73 6964 655f  e_margin, -side_
-0000a0b0: 6d61 7267 696e 290d 0a20 2020 2020 2020  margin)..       
-0000a0c0: 2078 7220 3d20 6d69 6e28 5f72 6f75 6e64   xr = min(_round
-0000a0d0: 2878 312d 7369 6465 5f6d 6172 6769 6e29  (x1-side_margin)
-0000a0e0: 2b73 6964 655f 6d61 7267 696e 2c20 6461  +side_margin, da
-0000a0f0: 7461 7372 632e 786c 656e 2b72 6967 6874  tasrc.xlen+right
-0000a100: 5f6d 6172 6769 6e5f 6361 6e64 6c65 732d  _margin_candles-
-0000a110: 7369 6465 5f6d 6172 6769 6e29 0d0a 2020  side_margin)..  
-0000a120: 2020 2020 2020 6478 6c20 3d20 786c 2d78        dxl = xl-x
-0000a130: 300d 0a20 2020 2020 2020 2064 7872 203d  0..        dxr =
-0000a140: 2078 722d 7831 0d0a 2020 2020 2020 2020   xr-x1..        
-0000a150: 6966 2064 786c 203e 2030 3a0d 0a20 2020  if dxl > 0:..   
-0000a160: 2020 2020 2020 2020 2078 3120 2b3d 2064           x1 += d
-0000a170: 786c 0d0a 2020 2020 2020 2020 6966 2064  xl..        if d
-0000a180: 7872 203c 2030 3a0d 0a20 2020 2020 2020  xr < 0:..       
-0000a190: 2020 2020 2078 3020 2b3d 2064 7872 0d0a       x0 += dxr..
-0000a1a0: 2020 2020 2020 2020 7830 203d 206d 6178          x0 = max
-0000a1b0: 285f 726f 756e 6428 7830 2d73 6964 655f  (_round(x0-side_
-0000a1c0: 6d61 7267 696e 292b 7369 6465 5f6d 6172  margin)+side_mar
-0000a1d0: 6769 6e2c 202d 7369 6465 5f6d 6172 6769  gin, -side_margi
-0000a1e0: 6e29 0d0a 2020 2020 2020 2020 7831 203d  n)..        x1 =
-0000a1f0: 206d 696e 285f 726f 756e 6428 7831 2d73   min(_round(x1-s
-0000a200: 6964 655f 6d61 7267 696e 292b 7369 6465  ide_margin)+side
-0000a210: 5f6d 6172 6769 6e2c 2064 6174 6173 7263  _margin, datasrc
-0000a220: 2e78 6c65 6e2b 7269 6768 745f 6d61 7267  .xlen+right_marg
-0000a230: 696e 5f63 616e 646c 6573 2d73 6964 655f  in_candles-side_
-0000a240: 6d61 7267 696e 290d 0a20 2020 2020 2020  margin)..       
-0000a250: 2023 2066 6574 6368 2068 692d 6c6f 2061   # fetch hi-lo a
-0000a260: 6e64 2073 6574 2072 616e 6765 0d0a 2020  nd set range..  
-0000a270: 2020 2020 2020 5f2c 5f2c 6869 2c6c 6f2c        _,_,hi,lo,
-0000a280: 636e 7420 3d20 6461 7461 7372 632e 6869  cnt = datasrc.hi
-0000a290: 6c6f 2878 302c 2078 3129 0d0a 2020 2020  lo(x0, x1)..    
-0000a2a0: 2020 2020 7672 203d 2073 656c 662e 7669      vr = self.vi
-0000a2b0: 6577 5265 6374 2829 0d0a 2020 2020 2020  ewRect()..      
-0000a2c0: 2020 6d69 6e6c 656e 203d 2069 6e74 2828    minlen = int((
-0000a2d0: 6d61 785f 7a6f 6f6d 5f70 6f69 6e74 732d  max_zoom_points-
-0000a2e0: 302e 3529 202a 2073 656c 662e 6d61 785f  0.5) * self.max_
-0000a2f0: 7a6f 6f6d 5f70 6f69 6e74 735f 6620 2b20  zoom_points_f + 
-0000a300: 302e 3531 290d 0a20 2020 2020 2020 2069  0.51)..        i
-0000a310: 6620 2878 312d 7830 2920 3c20 7672 2e77  f (x1-x0) < vr.w
-0000a320: 6964 7468 2829 2061 6e64 2063 6e74 203c  idth() and cnt <
-0000a330: 206d 696e 6c65 6e3a 0d0a 2020 2020 2020   minlen:..      
-0000a340: 2020 2020 2020 7265 7475 726e 0d0a 2020        return..  
-0000a350: 2020 2020 2020 6966 206e 6f74 2073 656c        if not sel
-0000a360: 662e 765f 6175 746f 7a6f 6f6d 3a0d 0a20  f.v_autozoom:.. 
-0000a370: 2020 2020 2020 2020 2020 2068 6920 3d20             hi = 
-0000a380: 7672 2e62 6f74 746f 6d28 290d 0a20 2020  vr.bottom()..   
-0000a390: 2020 2020 2020 2020 206c 6f20 3d20 7672           lo = vr
-0000a3a0: 2e74 6f70 2829 0d0a 2020 2020 2020 2020  .top()..        
-0000a3b0: 6966 2073 656c 662e 7973 6361 6c65 2e73  if self.yscale.s
-0000a3c0: 6361 6c65 7479 7065 203d 3d20 276c 6f67  caletype == 'log
-0000a3d0: 273a 0d0a 2020 2020 2020 2020 2020 2020  ':..            
-0000a3e0: 6966 206c 6f20 3c20 303a 0d0a 2020 2020  if lo < 0:..    
-0000a3f0: 2020 2020 2020 2020 2020 2020 6c6f 203d              lo =
-0000a400: 2030 2e30 3520 2a20 7365 6c66 2e79 7363   0.05 * self.ysc
-0000a410: 616c 652e 7363 616c 6566 2023 2073 7472  ale.scalef # str
-0000a420: 616e 6765 2051 5420 6c6f 6720 7363 616c  ange QT log scal
-0000a430: 6520 7265 6e64 6572 696e 672c 2077 6869  e rendering, whi
-0000a440: 6368 2049 276d 2075 6e61 626c 6520 746f  ch I'm unable to
-0000a450: 2063 6f6d 7065 6e73 6174 6520 666f 720d   compensate for.
-0000a460: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-0000a470: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-0000a480: 2020 2020 6c6f 203d 206d 6178 2831 652d      lo = max(1e-
-0000a490: 3130 302c 206c 6f29 0d0a 2020 2020 2020  100, lo)..      
-0000a4a0: 2020 2020 2020 726e 6720 3d20 2868 6920        rng = (hi 
-0000a4b0: 2f20 6c6f 2920 2a2a 2028 312f 7365 6c66  / lo) ** (1/self
-0000a4c0: 2e76 5f7a 6f6f 6d5f 7363 616c 6529 0d0a  .v_zoom_scale)..
-0000a4d0: 2020 2020 2020 2020 2020 2020 726e 6720              rng 
-0000a4e0: 3d20 6d69 6e28 726e 672c 2031 6535 3029  = min(rng, 1e50)
-0000a4f0: 2023 2061 766f 6964 2066 6c6f 6174 206f   # avoid float o
-0000a500: 7665 7266 6c6f 770d 0a20 2020 2020 2020  verflow..       
-0000a510: 2020 2020 2062 6173 6520 3d20 2868 692a       base = (hi*
-0000a520: 6c6f 2920 2a2a 2073 656c 662e 765f 7a6f  lo) ** self.v_zo
-0000a530: 6f6d 5f62 6173 656c 696e 650d 0a20 2020  om_baseline..   
-0000a540: 2020 2020 2020 2020 2079 3020 3d20 6261           y0 = ba
-0000a550: 7365 202f 2072 6e67 2a2a 7365 6c66 2e76  se / rng**self.v
-0000a560: 5f7a 6f6f 6d5f 6261 7365 6c69 6e65 0d0a  _zoom_baseline..
-0000a570: 2020 2020 2020 2020 2020 2020 7931 203d              y1 =
-0000a580: 2062 6173 6520 2a20 726e 672a 2a28 312d   base * rng**(1-
-0000a590: 7365 6c66 2e76 5f7a 6f6f 6d5f 6261 7365  self.v_zoom_base
-0000a5a0: 6c69 6e65 290d 0a20 2020 2020 2020 2065  line)..        e
-0000a5b0: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
-0000a5c0: 2020 726e 6720 3d20 2868 692d 6c6f 2920    rng = (hi-lo) 
-0000a5d0: 2f20 7365 6c66 2e76 5f7a 6f6f 6d5f 7363  / self.v_zoom_sc
-0000a5e0: 616c 650d 0a20 2020 2020 2020 2020 2020  ale..           
-0000a5f0: 2072 6e67 203d 206d 6178 2872 6e67 2c20   rng = max(rng, 
-0000a600: 3265 2d37 2920 2320 736f 6d65 2076 6572  2e-7) # some ver
-0000a610: 7920 7765 6972 6420 6275 6720 7768 6572  y weird bug wher
-0000a620: 6520 6869 6768 2f6c 6f77 2065 7870 6f6e  e high/low expon
-0000a630: 656e 7473 2073 746f 7073 2072 656e 6465  ents stops rende
-0000a640: 7269 6e67 0d0a 2020 2020 2020 2020 2020  ring..          
-0000a650: 2020 6261 7365 203d 2028 6869 2b6c 6f29    base = (hi+lo)
-0000a660: 202a 2073 656c 662e 765f 7a6f 6f6d 5f62   * self.v_zoom_b
-0000a670: 6173 656c 696e 650d 0a20 2020 2020 2020  aseline..       
-0000a680: 2020 2020 2079 3020 3d20 6261 7365 202d       y0 = base -
-0000a690: 2072 6e67 2a73 656c 662e 765f 7a6f 6f6d   rng*self.v_zoom
-0000a6a0: 5f62 6173 656c 696e 650d 0a20 2020 2020  _baseline..     
-0000a6b0: 2020 2020 2020 2079 3120 3d20 6261 7365         y1 = base
-0000a6c0: 202b 2072 6e67 2a28 312d 7365 6c66 2e76   + rng*(1-self.v
-0000a6d0: 5f7a 6f6f 6d5f 6261 7365 6c69 6e65 290d  _zoom_baseline).
-0000a6e0: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-0000a6f0: 7365 6c66 2e78 5f69 6e64 6578 6564 3a0d  self.x_indexed:.
-0000a700: 0a20 2020 2020 2020 2020 2020 2078 302c  .            x0,
-0000a710: 7831 203d 205f 786d 696e 6d61 7828 6461  x1 = _xminmax(da
-0000a720: 7461 7372 632c 2078 5f69 6e64 6578 6564  tasrc, x_indexed
-0000a730: 3d46 616c 7365 2c20 6578 7472 615f 6d61  =False, extra_ma
-0000a740: 7267 696e 3d30 290d 0a20 2020 2020 2020  rgin=0)..       
-0000a750: 2072 6574 7572 6e20 7365 6c66 2e73 6574   return self.set
-0000a760: 5f72 616e 6765 2878 302c 2079 302c 2078  _range(x0, y0, x
-0000a770: 312c 2079 3129 0d0a 0d0a 2020 2020 6465  1, y1)....    de
-0000a780: 6620 7365 745f 7261 6e67 6528 7365 6c66  f set_range(self
-0000a790: 2c20 7830 2c20 7930 2c20 7831 2c20 7931  , x0, y0, x1, y1
-0000a7a0: 293a 0d0a 2020 2020 2020 2020 6966 2078  ):..        if x
-0000a7b0: 3020 6973 204e 6f6e 6520 6f72 2078 3120  0 is None or x1 
-0000a7c0: 6973 204e 6f6e 653a 0d0a 2020 2020 2020  is None:..      
-0000a7d0: 2020 2020 2020 7472 203d 2073 656c 662e        tr = self.
-0000a7e0: 7461 7267 6574 5265 6374 2829 0d0a 2020  targetRect()..  
-0000a7f0: 2020 2020 2020 2020 2020 7830 203d 2074            x0 = t
-0000a800: 722e 6c65 6674 2829 0d0a 2020 2020 2020  r.left()..      
-0000a810: 2020 2020 2020 7831 203d 2074 722e 7269        x1 = tr.ri
-0000a820: 6768 7428 290d 0a20 2020 2020 2020 2069  ght()..        i
-0000a830: 6620 6e70 2e69 736e 616e 2879 3029 206f  f np.isnan(y0) o
-0000a840: 7220 6e70 2e69 736e 616e 2879 3129 3a0d  r np.isnan(y1):.
-0000a850: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-0000a860: 7572 6e0d 0a20 2020 2020 2020 205f 7930  urn..        _y0
-0000a870: 203d 2073 656c 662e 7973 6361 6c65 2e69   = self.yscale.i
-0000a880: 6e76 7866 6f72 6d28 7930 2c20 7665 7269  nvxform(y0, veri
-0000a890: 6679 3d54 7275 6529 0d0a 2020 2020 2020  fy=True)..      
-0000a8a0: 2020 5f79 3120 3d20 7365 6c66 2e79 7363    _y1 = self.ysc
-0000a8b0: 616c 652e 696e 7678 666f 726d 2879 312c  ale.invxform(y1,
-0000a8c0: 2076 6572 6966 793d 5472 7565 290d 0a20   verify=True).. 
-0000a8d0: 2020 2020 2020 2073 656c 662e 7365 7452         self.setR
-0000a8e0: 616e 6765 2851 7443 6f72 652e 5152 6563  ange(QtCore.QRec
-0000a8f0: 7446 2870 672e 506f 696e 7428 7830 2c20  tF(pg.Point(x0, 
-0000a900: 5f79 3029 2c20 7067 2e50 6f69 6e74 2878  _y0), pg.Point(x
-0000a910: 312c 205f 7931 2929 2c20 7061 6464 696e  1, _y1)), paddin
-0000a920: 673d 3029 0d0a 2020 2020 2020 2020 7265  g=0)..        re
-0000a930: 7475 726e 2054 7275 650d 0a0d 0a20 2020  turn True....   
-0000a940: 2064 6566 2072 656d 6f76 655f 6c61 7374   def remove_last
-0000a950: 5f72 6f69 2873 656c 6629 3a0d 0a20 2020  _roi(self):..   
-0000a960: 2020 2020 2069 6620 7365 6c66 2e72 6f69       if self.roi
-0000a970: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
-0000a980: 6966 206e 6f74 2069 7369 6e73 7461 6e63  if not isinstanc
-0000a990: 6528 7365 6c66 2e72 6f69 735b 2d31 5d2c  e(self.rois[-1],
-0000a9a0: 2070 672e 506f 6c79 4c69 6e65 524f 4929   pg.PolyLineROI)
-0000a9b0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-0000a9c0: 2020 2073 656c 662e 7265 6d6f 7665 4974     self.removeIt
-0000a9d0: 656d 2873 656c 662e 726f 6973 5b2d 315d  em(self.rois[-1]
-0000a9e0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-0000a9f0: 2020 2073 656c 662e 726f 6973 203d 2073     self.rois = s
-0000aa00: 656c 662e 726f 6973 5b3a 2d31 5d0d 0a20  elf.rois[:-1].. 
-0000aa10: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-0000aa20: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000aa30: 2020 6820 3d20 7365 6c66 2e72 6f69 735b    h = self.rois[
-0000aa40: 2d31 5d2e 6861 6e64 6c65 735b 2d31 5d5b  -1].handles[-1][
-0000aa50: 2769 7465 6d27 5d0d 0a20 2020 2020 2020  'item']..       
+00008cf0: 6570 7428 290d 0a0d 0a20 2020 2064 6566  ept()....    def
+00008d00: 206d 6f75 7365 5269 6768 7444 7261 6728   mouseRightDrag(
+00008d10: 7365 6c66 2c20 6576 2c20 6178 6973 293a  self, ev, axis):
+00008d20: 0d0a 2020 2020 2020 2020 2727 2752 4275  ..        '''RBu
+00008d30: 7474 6f6e 2069 7320 626f 7820 7a6f 6f6d  tton is box zoom
+00008d40: 2e20 4174 206c 6561 7374 2066 6f72 206e  . At least for n
+00008d50: 6f77 2e27 2727 0d0a 2020 2020 2020 2020  ow.'''..        
+00008d60: 6576 2e61 6363 6570 7428 290d 0a20 2020  ev.accept()..   
+00008d70: 2020 2020 2069 6620 6e6f 7420 6576 2e69       if not ev.i
+00008d80: 7346 696e 6973 6828 293a 0d0a 2020 2020  sFinish():..    
+00008d90: 2020 2020 2020 2020 7365 6c66 2e75 7064          self.upd
+00008da0: 6174 6553 6361 6c65 426f 7828 6576 2e62  ateScaleBox(ev.b
+00008db0: 7574 746f 6e44 6f77 6e50 6f73 2829 2c20  uttonDownPos(), 
+00008dc0: 6576 2e70 6f73 2829 290d 0a20 2020 2020  ev.pos())..     
+00008dd0: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
+00008de0: 2020 2020 2020 7365 6c66 2e72 6253 6361        self.rbSca
+00008df0: 6c65 426f 782e 6869 6465 2829 0d0a 2020  leBox.hide()..  
+00008e00: 2020 2020 2020 2020 2020 6178 203d 2051            ax = Q
+00008e10: 7443 6f72 652e 5152 6563 7446 2870 672e  tCore.QRectF(pg.
+00008e20: 506f 696e 7428 6576 2e62 7574 746f 6e44  Point(ev.buttonD
+00008e30: 6f77 6e50 6f73 2865 762e 6275 7474 6f6e  ownPos(ev.button
+00008e40: 2829 2929 2c20 7067 2e50 6f69 6e74 2865  ())), pg.Point(e
+00008e50: 762e 706f 7328 2929 290d 0a20 2020 2020  v.pos()))..     
+00008e60: 2020 2020 2020 2061 7820 3d20 7365 6c66         ax = self
+00008e70: 2e63 6869 6c64 4772 6f75 702e 6d61 7052  .childGroup.mapR
+00008e80: 6563 7446 726f 6d50 6172 656e 7428 6178  ectFromParent(ax
+00008e90: 290d 0a20 2020 2020 2020 2020 2020 2069  )..            i
+00008ea0: 6620 6178 2e77 6964 7468 2829 203c 2032  f ax.width() < 2
+00008eb0: 3a20 2320 7a6f 6f6d 696e 6720 7468 6973  : # zooming this
+00008ec0: 206e 6172 726f 7720 6973 2070 726f 6261   narrow is proba
+00008ed0: 626c 7920 6120 6d69 7374 616b 650d 0a20  bly a mistake.. 
+00008ee0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+00008ef0: 782e 6164 6a75 7374 282d 312c 2030 2c20  x.adjust(-1, 0, 
+00008f00: 2b31 2c20 3029 0d0a 2020 2020 2020 2020  +1, 0)..        
+00008f10: 2020 2020 7365 6c66 2e73 686f 7741 7852      self.showAxR
+00008f20: 6563 7428 6178 290d 0a20 2020 2020 2020  ect(ax)..       
+00008f30: 2020 2020 2073 656c 662e 6178 4869 7374       self.axHist
+00008f40: 6f72 7950 6f69 6e74 6572 202b 3d20 310d  oryPointer += 1.
+00008f50: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00008f60: 662e 6178 4869 7374 6f72 7920 3d20 7365  f.axHistory = se
+00008f70: 6c66 2e61 7848 6973 746f 7279 5b3a 7365  lf.axHistory[:se
+00008f80: 6c66 2e61 7848 6973 746f 7279 506f 696e  lf.axHistoryPoin
+00008f90: 7465 725d 202b 205b 6178 5d0d 0a0d 0a20  ter] + [ax].... 
+00008fa0: 2020 2064 6566 206d 6f75 7365 436c 6963     def mouseClic
+00008fb0: 6b45 7665 6e74 2873 656c 662c 2065 7629  kEvent(self, ev)
+00008fc0: 3a0d 0a20 2020 2020 2020 2069 6620 7365  :..        if se
+00008fd0: 6c66 2e6d 6173 7465 725f 7669 6577 626f  lf.master_viewbo
+00008fe0: 783a 0d0a 2020 2020 2020 2020 2020 2020  x:..            
+00008ff0: 7265 7475 726e 2073 656c 662e 6d61 7374  return self.mast
+00009000: 6572 5f76 6965 7762 6f78 2e6d 6f75 7365  er_viewbox.mouse
+00009010: 436c 6963 6b45 7665 6e74 2865 7629 0d0a  ClickEvent(ev)..
+00009020: 2020 2020 2020 2020 6966 205f 6d6f 7573          if _mous
+00009030: 655f 636c 6963 6b65 6428 7365 6c66 2c20  e_clicked(self, 
+00009040: 6576 293a 0d0a 2020 2020 2020 2020 2020  ev):..          
+00009050: 2020 6576 2e61 6363 6570 7428 290d 0a20    ev.accept().. 
+00009060: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00009070: 6e0d 0a20 2020 2020 2020 2069 6620 6576  n..        if ev
+00009080: 2e62 7574 746f 6e28 2920 213d 2051 7443  .button() != QtC
+00009090: 6f72 652e 5174 2e4d 6f75 7365 4275 7474  ore.Qt.MouseButt
+000090a0: 6f6e 2e4c 6566 7442 7574 746f 6e20 6f72  on.LeftButton or
+000090b0: 2065 762e 6d6f 6469 6669 6572 7328 2920   ev.modifiers() 
+000090c0: 213d 2051 7443 6f72 652e 5174 2e4b 6579  != QtCore.Qt.Key
+000090d0: 626f 6172 644d 6f64 6966 6965 722e 436f  boardModifier.Co
+000090e0: 6e74 726f 6c4d 6f64 6966 6965 7220 6f72  ntrolModifier or
+000090f0: 206e 6f74 2073 656c 662e 6472 6177 5f6c   not self.draw_l
+00009100: 696e 653a 0d0a 2020 2020 2020 2020 2020  ine:..          
+00009110: 2020 7265 7475 726e 2073 7570 6572 2829    return super()
+00009120: 2e6d 6f75 7365 436c 6963 6b45 7665 6e74  .mouseClickEvent
+00009130: 2865 7629 0d0a 2020 2020 2020 2020 2320  (ev)..        # 
+00009140: 6164 6420 616e 6f74 6865 7220 7365 676d  add another segm
+00009150: 656e 7420 746f 2074 6865 2063 7572 7265  ent to the curre
+00009160: 6e74 6c79 2064 7261 776e 206c 696e 650d  ntly drawn line.
+00009170: 0a20 2020 2020 2020 2070 203d 2073 656c  .        p = sel
+00009180: 662e 6d61 7043 6c69 636b 546f 5669 6577  f.mapClickToView
+00009190: 2865 762e 706f 7328 2929 0d0a 2020 2020  (ev.pos())..    
+000091a0: 2020 2020 7020 3d20 5f63 6c61 6d70 5f70      p = _clamp_p
+000091b0: 6f69 6e74 2873 656c 662e 7061 7265 6e74  oint(self.parent
+000091c0: 2829 2c20 7029 0d0a 2020 2020 2020 2020  (), p)..        
+000091d0: 7365 6c66 2e61 7070 656e 645f 6472 6177  self.append_draw
+000091e0: 5f73 6567 6d65 6e74 2870 290d 0a20 2020  _segment(p)..   
+000091f0: 2020 2020 2073 656c 662e 6472 6177 696e       self.drawin
+00009200: 6720 3d20 4661 6c73 650d 0a20 2020 2020  g = False..     
+00009210: 2020 2065 762e 6163 6365 7074 2829 0d0a     ev.accept()..
+00009220: 0d0a 2020 2020 6465 6620 6d61 7043 6c69  ..    def mapCli
+00009230: 636b 546f 5669 6577 2873 656c 662c 2070  ckToView(self, p
+00009240: 6f73 293a 0d0a 2020 2020 2020 2020 2727  os):..        ''
+00009250: 276d 6170 546f 5669 6577 2829 2064 6f65  'mapToView() doe
+00009260: 7320 6e6f 7420 646f 2067 7269 6473 2070  s not do grids p
+00009270: 726f 7065 726c 7920 696e 2065 6d62 6564  roperly in embed
+00009280: 6465 6420 7769 6467 6574 732e 2053 7472  ded widgets. Str
+00009290: 616e 6765 6c79 2c20 6f6e 6c79 2061 6666  angely, only aff
+000092a0: 6563 7420 636c 6963 6b73 2c20 6e6f 7420  ect clicks, not 
+000092b0: 6472 6167 732e 2727 270d 0a20 2020 2020  drags.'''..     
+000092c0: 2020 2069 6620 7365 6c66 2e77 696e 2e70     if self.win.p
+000092d0: 6172 656e 7428 2920 6973 206e 6f74 204e  arent() is not N
+000092e0: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
+000092f0: 2020 6178 203d 2073 656c 662e 7061 7265    ax = self.pare
+00009300: 6e74 2829 0d0a 2020 2020 2020 2020 2020  nt()..          
+00009310: 2020 6966 2061 782e 6765 7441 7869 7328    if ax.getAxis(
+00009320: 2772 6967 6874 2729 2e67 7269 643a 0d0a  'right').grid:..
+00009330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009340: 706f 732e 7365 7458 2870 6f73 2e78 2829  pos.setX(pos.x()
+00009350: 202b 2073 656c 662e 7769 6474 6828 2929   + self.width())
+00009360: 0d0a 2020 2020 2020 2020 2020 2020 656c  ..            el
+00009370: 6966 2061 782e 6765 7441 7869 7328 2762  if ax.getAxis('b
+00009380: 6f74 746f 6d27 292e 6772 6964 3a0d 0a20  ottom').grid:.. 
+00009390: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+000093a0: 6f73 2e73 6574 5928 706f 732e 7928 2920  os.setY(pos.y() 
+000093b0: 2b20 7365 6c66 2e68 6569 6768 7428 2929  + self.height())
+000093c0: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+000093d0: 2073 7570 6572 2829 2e6d 6170 546f 5669   super().mapToVi
+000093e0: 6577 2870 6f73 290d 0a0d 0a20 2020 2064  ew(pos)....    d
+000093f0: 6566 206b 6579 5072 6573 7345 7665 6e74  ef keyPressEvent
+00009400: 2873 656c 662c 2065 7629 3a0d 0a20 2020  (self, ev):..   
+00009410: 2020 2020 2069 6620 7365 6c66 2e6d 6173       if self.mas
+00009420: 7465 725f 7669 6577 626f 783a 0d0a 2020  ter_viewbox:..  
+00009430: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00009440: 2073 656c 662e 6d61 7374 6572 5f76 6965   self.master_vie
+00009450: 7762 6f78 2e6b 6579 5072 6573 7345 7665  wbox.keyPressEve
+00009460: 6e74 2865 7629 0d0a 2020 2020 2020 2020  nt(ev)..        
+00009470: 6966 205f 6b65 795f 7072 6573 7365 6428  if _key_pressed(
+00009480: 7365 6c66 2c20 6576 293a 0d0a 2020 2020  self, ev):..    
+00009490: 2020 2020 2020 2020 6576 2e61 6363 6570          ev.accep
+000094a0: 7428 290d 0a20 2020 2020 2020 2020 2020  t()..           
+000094b0: 2072 6574 7572 6e0d 0a20 2020 2020 2020   return..       
+000094c0: 2073 7570 6572 2829 2e6b 6579 5072 6573   super().keyPres
+000094d0: 7345 7665 6e74 2865 7629 0d0a 0d0a 2020  sEvent(ev)....  
+000094e0: 2020 6465 6620 6c69 6e6b 6564 5669 6577    def linkedView
+000094f0: 4368 616e 6765 6428 7365 6c66 2c20 7669  Changed(self, vi
+00009500: 6577 2c20 6178 6973 293a 0d0a 2020 2020  ew, axis):..    
+00009510: 2020 2020 6966 206e 6f74 2073 656c 662e      if not self.
+00009520: 6461 7461 7372 6320 6f72 2073 656c 662e  datasrc or self.
+00009530: 7570 6461 7469 6e67 5f6c 696e 6b65 643a  updating_linked:
+00009540: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
+00009550: 7475 726e 0d0a 2020 2020 2020 2020 6966  turn..        if
+00009560: 2076 6965 7720 616e 6420 7365 6c66 2e64   view and self.d
+00009570: 6174 6173 7263 2061 6e64 2076 6965 772e  atasrc and view.
+00009580: 6461 7461 7372 633a 0d0a 2020 2020 2020  datasrc:..      
+00009590: 2020 2020 2020 7365 6c66 2e75 7064 6174        self.updat
+000095a0: 696e 675f 6c69 6e6b 6564 203d 2054 7275  ing_linked = Tru
+000095b0: 650d 0a20 2020 2020 2020 2020 2020 2074  e..            t
+000095c0: 7220 3d20 7365 6c66 2e74 6172 6765 7452  r = self.targetR
+000095d0: 6563 7428 290d 0a20 2020 2020 2020 2020  ect()..         
+000095e0: 2020 2076 7220 3d20 7669 6577 2e74 6172     vr = view.tar
+000095f0: 6765 7452 6563 7428 290d 0a20 2020 2020  getRect()..     
+00009600: 2020 2020 2020 2069 735f 6469 7274 7920         is_dirty 
+00009610: 3d20 7669 6577 2e66 6f72 6365 5f72 616e  = view.force_ran
+00009620: 6765 5f75 7064 6174 6520 3e20 300d 0a20  ge_update > 0.. 
+00009630: 2020 2020 2020 2020 2020 2069 735f 7361             is_sa
+00009640: 6d65 5f73 6361 6c65 203d 2073 656c 662e  me_scale = self.
+00009650: 6461 7461 7372 632e 786c 656e 203d 3d20  datasrc.xlen == 
+00009660: 7669 6577 2e64 6174 6173 7263 2e78 6c65  view.datasrc.xle
+00009670: 6e0d 0a20 2020 2020 2020 2020 2020 2069  n..            i
+00009680: 6620 6973 5f73 616d 655f 7363 616c 653a  f is_same_scale:
+00009690: 2023 2073 7461 626c 6520 7a6f 6f6d 2062   # stable zoom b
+000096a0: 6173 6564 206f 6e20 696e 6465 780d 0a20  ased on index.. 
+000096b0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+000096c0: 6620 6973 5f64 6972 7479 206f 7220 6162  f is_dirty or ab
+000096d0: 7328 7672 2e6c 6566 7428 292d 7472 2e6c  s(vr.left()-tr.l
+000096e0: 6566 7428 2929 203e 3d20 3120 6f72 2061  eft()) >= 1 or a
+000096f0: 6273 2876 722e 7269 6768 7428 292d 7472  bs(vr.right()-tr
+00009700: 2e72 6967 6874 2829 2920 3e3d 2031 3a0d  .right()) >= 1:.
+00009710: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00009720: 2020 2020 2069 6620 6973 5f64 6972 7479       if is_dirty
+00009730: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00009740: 2020 2020 2020 2020 2020 2076 6965 772e             view.
+00009750: 666f 7263 655f 7261 6e67 655f 7570 6461  force_range_upda
+00009760: 7465 202d 3d20 310d 0a20 2020 2020 2020  te -= 1..       
+00009770: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00009780: 662e 7570 6461 7465 5f79 5f7a 6f6f 6d28  f.update_y_zoom(
+00009790: 7672 2e6c 6566 7428 292c 2076 722e 7269  vr.left(), vr.ri
+000097a0: 6768 7428 2929 0d0a 2020 2020 2020 2020  ght())..        
+000097b0: 2020 2020 656c 7365 3a20 2320 736c 6f70      else: # slop
+000097c0: 7079 206f 6e65 2062 6173 6564 206f 6e20  py one based on 
+000097d0: 7469 6d65 2073 7461 6d70 730d 0a20 2020  time stamps..   
+000097e0: 2020 2020 2020 2020 2020 2020 2074 7430               tt0
+000097f0: 2c74 7431 2c5f 2c5f 2c5f 203d 2073 656c  ,tt1,_,_,_ = sel
+00009800: 662e 6461 7461 7372 632e 6869 6c6f 2874  f.datasrc.hilo(t
+00009810: 722e 6c65 6674 2829 2c20 7472 2e72 6967  r.left(), tr.rig
+00009820: 6874 2829 290d 0a20 2020 2020 2020 2020  ht())..         
+00009830: 2020 2020 2020 2076 7430 2c76 7431 2c5f         vt0,vt1,_
+00009840: 2c5f 2c5f 203d 2076 6965 772e 6461 7461  ,_,_ = view.data
+00009850: 7372 632e 6869 6c6f 2876 722e 6c65 6674  src.hilo(vr.left
+00009860: 2829 2c20 7672 2e72 6967 6874 2829 290d  (), vr.right()).
+00009870: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00009880: 2070 6572 696f 6432 203d 2073 656c 662e   period2 = self.
+00009890: 6461 7461 7372 632e 7065 7269 6f64 5f6e  datasrc.period_n
+000098a0: 7320 2a20 302e 350d 0a20 2020 2020 2020  s * 0.5..       
+000098b0: 2020 2020 2020 2020 2069 6620 6973 5f64           if is_d
+000098c0: 6972 7479 206f 7220 6162 7328 7674 302d  irty or abs(vt0-
+000098d0: 7474 3029 203e 3d20 7065 7269 6f64 3220  tt0) >= period2 
+000098e0: 6f72 2061 6273 2876 7431 2d74 7431 2920  or abs(vt1-tt1) 
+000098f0: 3e3d 2070 6572 696f 6432 3a0d 0a20 2020  >= period2:..   
+00009900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009910: 2069 6620 6973 5f64 6972 7479 3a0d 0a20   if is_dirty:.. 
+00009920: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009930: 2020 2020 2020 2076 6965 772e 666f 7263         view.forc
+00009940: 655f 7261 6e67 655f 7570 6461 7465 202d  e_range_update -
+00009950: 3d20 310d 0a20 2020 2020 2020 2020 2020  = 1..           
+00009960: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
+00009970: 2e70 6172 656e 7428 293a 0d0a 2020 2020  .parent():..    
+00009980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009990: 2020 2020 7830 2c78 3120 3d20 5f70 6474      x0,x1 = _pdt
+000099a0: 696d 6532 696e 6465 7828 7365 6c66 2e70  ime2index(self.p
+000099b0: 6172 656e 7428 292c 2070 642e 5365 7269  arent(), pd.Seri
+000099c0: 6573 285b 7674 302c 7674 315d 292c 2061  es([vt0,vt1]), a
+000099d0: 6e79 5f65 6e64 3d54 7275 6529 0d0a 2020  ny_end=True)..  
+000099e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000099f0: 2020 2020 2020 7365 6c66 2e75 7064 6174        self.updat
+00009a00: 655f 795f 7a6f 6f6d 2878 302c 2078 3129  e_y_zoom(x0, x1)
+00009a10: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+00009a20: 6c66 2e75 7064 6174 696e 675f 6c69 6e6b  lf.updating_link
+00009a30: 6564 203d 2046 616c 7365 0d0a 0d0a 2020  ed = False....  
+00009a40: 2020 6465 6620 7a6f 6f6d 5f72 6563 7428    def zoom_rect(
+00009a50: 7365 6c66 2c20 7672 2c20 7363 616c 655f  self, vr, scale_
+00009a60: 6661 6374 2c20 6365 6e74 6572 293a 0d0a  fact, center):..
+00009a70: 2020 2020 2020 2020 6966 206e 6f74 2073          if not s
+00009a80: 656c 662e 6461 7461 7372 633a 0d0a 2020  elf.datasrc:..  
+00009a90: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00009aa0: 0d0a 2020 2020 2020 2020 7830 203d 2063  ..        x0 = c
+00009ab0: 656e 7465 722e 7828 2920 2b20 2876 722e  enter.x() + (vr.
+00009ac0: 6c65 6674 2829 2d63 656e 7465 722e 7828  left()-center.x(
+00009ad0: 2929 202a 2073 6361 6c65 5f66 6163 740d  )) * scale_fact.
+00009ae0: 0a20 2020 2020 2020 2078 3120 3d20 6365  .        x1 = ce
+00009af0: 6e74 6572 2e78 2829 202b 2028 7672 2e72  nter.x() + (vr.r
+00009b00: 6967 6874 2829 2d63 656e 7465 722e 7828  ight()-center.x(
+00009b10: 2929 202a 2073 6361 6c65 5f66 6163 740d  )) * scale_fact.
+00009b20: 0a20 2020 2020 2020 2073 656c 662e 7570  .        self.up
+00009b30: 6461 7465 5f79 5f7a 6f6f 6d28 7830 2c20  date_y_zoom(x0, 
+00009b40: 7831 290d 0a0d 0a20 2020 2064 6566 2070  x1)....    def p
+00009b50: 616e 5f78 2873 656c 662c 2073 7465 7073  an_x(self, steps
+00009b60: 3d4e 6f6e 652c 2070 6572 6365 6e74 3d4e  =None, percent=N
+00009b70: 6f6e 6529 3a0d 0a20 2020 2020 2020 2069  one):..        i
+00009b80: 6620 7365 6c66 2e64 6174 6173 7263 2069  f self.datasrc i
+00009b90: 7320 4e6f 6e65 3a0d 0a20 2020 2020 2020  s None:..       
+00009ba0: 2020 2020 2072 6574 7572 6e0d 0a20 2020       return..   
+00009bb0: 2020 2020 2069 6620 7374 6570 7320 6973       if steps is
+00009bc0: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
+00009bd0: 2020 2020 7374 6570 7320 3d20 696e 7428      steps = int(
+00009be0: 7065 7263 656e 742f 3130 302a 7365 6c66  percent/100*self
+00009bf0: 2e74 6172 6765 7452 6563 7428 292e 7769  .targetRect().wi
+00009c00: 6474 6828 2929 0d0a 2020 2020 2020 2020  dth())..        
+00009c10: 7472 203d 2073 656c 662e 7461 7267 6574  tr = self.target
+00009c20: 5265 6374 2829 0d0a 2020 2020 2020 2020  Rect()..        
+00009c30: 7831 203d 2074 722e 7269 6768 7428 2920  x1 = tr.right() 
+00009c40: 2b20 7374 6570 730d 0a20 2020 2020 2020  + steps..       
+00009c50: 2073 7461 7274 7820 3d20 2d73 6964 655f   startx = -side_
+00009c60: 6d61 7267 696e 0d0a 2020 2020 2020 2020  margin..        
+00009c70: 656e 6478 203d 2073 656c 662e 6461 7461  endx = self.data
+00009c80: 7372 632e 786c 656e 202b 2072 6967 6874  src.xlen + right
+00009c90: 5f6d 6172 6769 6e5f 6361 6e64 6c65 7320  _margin_candles 
+00009ca0: 2d20 7369 6465 5f6d 6172 6769 6e0d 0a20  - side_margin.. 
+00009cb0: 2020 2020 2020 2069 6620 7831 203e 2065         if x1 > e
+00009cc0: 6e64 783a 0d0a 2020 2020 2020 2020 2020  ndx:..          
+00009cd0: 2020 7831 203d 2065 6e64 780d 0a20 2020    x1 = endx..   
+00009ce0: 2020 2020 2078 3020 3d20 7831 202d 2074       x0 = x1 - t
+00009cf0: 722e 7769 6474 6828 290d 0a20 2020 2020  r.width()..     
+00009d00: 2020 2069 6620 7830 203c 2073 7461 7274     if x0 < start
+00009d10: 783a 0d0a 2020 2020 2020 2020 2020 2020  x:..            
+00009d20: 7830 203d 2073 7461 7274 780d 0a20 2020  x0 = startx..   
+00009d30: 2020 2020 2020 2020 2078 3120 3d20 7830           x1 = x0
+00009d40: 202b 2074 722e 7769 6474 6828 290d 0a20   + tr.width().. 
+00009d50: 2020 2020 2020 2073 656c 662e 7570 6461         self.upda
+00009d60: 7465 5f79 5f7a 6f6f 6d28 7830 2c20 7831  te_y_zoom(x0, x1
+00009d70: 290d 0a0d 0a20 2020 2064 6566 2072 6566  )....    def ref
+00009d80: 7265 7368 5f61 6c6c 5f79 5f7a 6f6f 6d28  resh_all_y_zoom(
+00009d90: 7365 6c66 293a 0d0a 2020 2020 2020 2020  self):..        
+00009da0: 2727 2754 6869 7320 7570 6461 7465 7320  '''This updates 
+00009db0: 5920 7a6f 6f6d 206f 6e20 616c 6c20 7669  Y zoom on all vi
+00009dc0: 6577 732c 2073 7563 6820 6173 2077 6865  ews, such as whe
+00009dd0: 6e20 6120 6d6f 7573 6520 6472 6167 2069  n a mouse drag i
+00009de0: 7320 636f 6d70 6c65 7465 642e 2727 270d  s completed.'''.
+00009df0: 0a20 2020 2020 2020 206d 6169 6e5f 7662  .        main_vb
+00009e00: 203d 2073 656c 660d 0a20 2020 2020 2020   = self..       
+00009e10: 2069 6620 7365 6c66 2e6c 696e 6b65 6456   if self.linkedV
+00009e20: 6965 7728 3029 3a0d 0a20 2020 2020 2020  iew(0):..       
+00009e30: 2020 2020 2073 656c 662e 666f 7263 655f       self.force_
+00009e40: 7261 6e67 655f 7570 6461 7465 203d 2031  range_update = 1
+00009e50: 2023 206d 6169 6e20 6e65 6564 2074 6f20   # main need to 
+00009e60: 7570 6461 7465 206f 6e6c 7920 6f6e 6365  update only once
+00009e70: 2074 6f20 7573 0d0a 2020 2020 2020 2020   to us..        
+00009e80: 2020 2020 6d61 696e 5f76 6220 3d20 6c69      main_vb = li
+00009e90: 7374 2873 656c 662e 7769 6e2e 6178 7329  st(self.win.axs)
+00009ea0: 5b30 5d2e 7662 0d0a 2020 2020 2020 2020  [0].vb..        
+00009eb0: 6d61 696e 5f76 622e 666f 7263 655f 7261  main_vb.force_ra
+00009ec0: 6e67 655f 7570 6461 7465 203d 206c 656e  nge_update = len
+00009ed0: 2873 656c 662e 7769 6e2e 6178 7329 2d31  (self.win.axs)-1
+00009ee0: 2023 2075 7064 6174 6520 6d61 696e 2061   # update main a
+00009ef0: 7320 6d61 6e79 2074 696d 6573 2061 7320  s many times as 
+00009f00: 7468 6572 6520 6172 6520 6f74 6865 7220  there are other 
+00009f10: 726f 7773 0d0a 2020 2020 2020 2020 7365  rows..        se
+00009f20: 6c66 2e75 7064 6174 655f 795f 7a6f 6f6d  lf.update_y_zoom
+00009f30: 2829 0d0a 2020 2020 2020 2020 2320 7265  ()..        # re
+00009f40: 6672 6573 6820 6372 6f73 7368 6169 7220  fresh crosshair 
+00009f50: 7768 656e 2064 6f6e 650d 0a20 2020 2020  when done..     
+00009f60: 2020 205f 6d6f 7573 655f 6d6f 7665 6428     _mouse_moved(
+00009f70: 7365 6c66 2e77 696e 2c20 7365 6c66 2c20  self.win, self, 
+00009f80: 4e6f 6e65 290d 0a0d 0a20 2020 2064 6566  None)....    def
+00009f90: 2075 7064 6174 655f 795f 7a6f 6f6d 2873   update_y_zoom(s
+00009fa0: 656c 662c 2078 303d 4e6f 6e65 2c20 7831  elf, x0=None, x1
+00009fb0: 3d4e 6f6e 6529 3a0d 0a20 2020 2020 2020  =None):..       
+00009fc0: 2064 6174 6173 7263 203d 2073 656c 662e   datasrc = self.
+00009fd0: 6461 7461 7372 635f 6f72 5f73 7461 6e64  datasrc_or_stand
+00009fe0: 616c 6f6e 650d 0a20 2020 2020 2020 2069  alone..        i
+00009ff0: 6620 6461 7461 7372 6320 6973 204e 6f6e  f datasrc is Non
+0000a000: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+0000a010: 7265 7475 726e 0d0a 2020 2020 2020 2020  return..        
+0000a020: 6966 2078 3020 6973 204e 6f6e 6520 6f72  if x0 is None or
+0000a030: 2078 3120 6973 204e 6f6e 653a 0d0a 2020   x1 is None:..  
+0000a040: 2020 2020 2020 2020 2020 7472 203d 2073            tr = s
+0000a050: 656c 662e 7461 7267 6574 5265 6374 2829  elf.targetRect()
+0000a060: 0d0a 2020 2020 2020 2020 2020 2020 7830  ..            x0
+0000a070: 203d 2074 722e 6c65 6674 2829 0d0a 2020   = tr.left()..  
+0000a080: 2020 2020 2020 2020 2020 7831 203d 2074            x1 = t
+0000a090: 722e 7269 6768 7428 290d 0a20 2020 2020  r.right()..     
+0000a0a0: 2020 2020 2020 2069 6620 7831 2d78 3020         if x1-x0 
+0000a0b0: 3c3d 2031 3a0d 0a20 2020 2020 2020 2020  <= 1:..         
+0000a0c0: 2020 2020 2020 2072 6574 7572 6e0d 0a20         return.. 
+0000a0d0: 2020 2020 2020 2023 206d 616b 6520 6564         # make ed
+0000a0e0: 6765 7320 7269 6769 640d 0a20 2020 2020  ges rigid..     
+0000a0f0: 2020 2078 6c20 3d20 6d61 7828 5f72 6f75     xl = max(_rou
+0000a100: 6e64 2878 302d 7369 6465 5f6d 6172 6769  nd(x0-side_margi
+0000a110: 6e29 2b73 6964 655f 6d61 7267 696e 2c20  n)+side_margin, 
+0000a120: 2d73 6964 655f 6d61 7267 696e 290d 0a20  -side_margin).. 
+0000a130: 2020 2020 2020 2078 7220 3d20 6d69 6e28         xr = min(
+0000a140: 5f72 6f75 6e64 2878 312d 7369 6465 5f6d  _round(x1-side_m
+0000a150: 6172 6769 6e29 2b73 6964 655f 6d61 7267  argin)+side_marg
+0000a160: 696e 2c20 6461 7461 7372 632e 786c 656e  in, datasrc.xlen
+0000a170: 2b72 6967 6874 5f6d 6172 6769 6e5f 6361  +right_margin_ca
+0000a180: 6e64 6c65 732d 7369 6465 5f6d 6172 6769  ndles-side_margi
+0000a190: 6e29 0d0a 2020 2020 2020 2020 6478 6c20  n)..        dxl 
+0000a1a0: 3d20 786c 2d78 300d 0a20 2020 2020 2020  = xl-x0..       
+0000a1b0: 2064 7872 203d 2078 722d 7831 0d0a 2020   dxr = xr-x1..  
+0000a1c0: 2020 2020 2020 6966 2064 786c 203e 2030        if dxl > 0
+0000a1d0: 3a0d 0a20 2020 2020 2020 2020 2020 2078  :..            x
+0000a1e0: 3120 2b3d 2064 786c 0d0a 2020 2020 2020  1 += dxl..      
+0000a1f0: 2020 6966 2064 7872 203c 2030 3a0d 0a20    if dxr < 0:.. 
+0000a200: 2020 2020 2020 2020 2020 2078 3020 2b3d             x0 +=
+0000a210: 2064 7872 0d0a 2020 2020 2020 2020 7830   dxr..        x0
+0000a220: 203d 206d 6178 285f 726f 756e 6428 7830   = max(_round(x0
+0000a230: 2d73 6964 655f 6d61 7267 696e 292b 7369  -side_margin)+si
+0000a240: 6465 5f6d 6172 6769 6e2c 202d 7369 6465  de_margin, -side
+0000a250: 5f6d 6172 6769 6e29 0d0a 2020 2020 2020  _margin)..      
+0000a260: 2020 7831 203d 206d 696e 285f 726f 756e    x1 = min(_roun
+0000a270: 6428 7831 2d73 6964 655f 6d61 7267 696e  d(x1-side_margin
+0000a280: 292b 7369 6465 5f6d 6172 6769 6e2c 2064  )+side_margin, d
+0000a290: 6174 6173 7263 2e78 6c65 6e2b 7269 6768  atasrc.xlen+righ
+0000a2a0: 745f 6d61 7267 696e 5f63 616e 646c 6573  t_margin_candles
+0000a2b0: 2d73 6964 655f 6d61 7267 696e 290d 0a20  -side_margin).. 
+0000a2c0: 2020 2020 2020 2023 2066 6574 6368 2068         # fetch h
+0000a2d0: 692d 6c6f 2061 6e64 2073 6574 2072 616e  i-lo and set ran
+0000a2e0: 6765 0d0a 2020 2020 2020 2020 5f2c 5f2c  ge..        _,_,
+0000a2f0: 6869 2c6c 6f2c 636e 7420 3d20 6461 7461  hi,lo,cnt = data
+0000a300: 7372 632e 6869 6c6f 2878 302c 2078 3129  src.hilo(x0, x1)
+0000a310: 0d0a 2020 2020 2020 2020 7672 203d 2073  ..        vr = s
+0000a320: 656c 662e 7669 6577 5265 6374 2829 0d0a  elf.viewRect()..
+0000a330: 2020 2020 2020 2020 6d69 6e6c 656e 203d          minlen =
+0000a340: 2069 6e74 2828 6d61 785f 7a6f 6f6d 5f70   int((max_zoom_p
+0000a350: 6f69 6e74 732d 302e 3529 202a 2073 656c  oints-0.5) * sel
+0000a360: 662e 6d61 785f 7a6f 6f6d 5f70 6f69 6e74  f.max_zoom_point
+0000a370: 735f 6620 2b20 302e 3531 290d 0a20 2020  s_f + 0.51)..   
+0000a380: 2020 2020 2069 6620 2878 312d 7830 2920       if (x1-x0) 
+0000a390: 3c20 7672 2e77 6964 7468 2829 2061 6e64  < vr.width() and
+0000a3a0: 2063 6e74 203c 206d 696e 6c65 6e3a 0d0a   cnt < minlen:..
+0000a3b0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0000a3c0: 726e 0d0a 2020 2020 2020 2020 6966 206e  rn..        if n
+0000a3d0: 6f74 2073 656c 662e 765f 6175 746f 7a6f  ot self.v_autozo
+0000a3e0: 6f6d 3a0d 0a20 2020 2020 2020 2020 2020  om:..           
+0000a3f0: 2068 6920 3d20 7672 2e62 6f74 746f 6d28   hi = vr.bottom(
+0000a400: 290d 0a20 2020 2020 2020 2020 2020 206c  )..            l
+0000a410: 6f20 3d20 7672 2e74 6f70 2829 0d0a 2020  o = vr.top()..  
+0000a420: 2020 2020 2020 6966 2073 656c 662e 7973        if self.ys
+0000a430: 6361 6c65 2e73 6361 6c65 7479 7065 203d  cale.scaletype =
+0000a440: 3d20 276c 6f67 273a 0d0a 2020 2020 2020  = 'log':..      
+0000a450: 2020 2020 2020 6966 206c 6f20 3c20 303a        if lo < 0:
+0000a460: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000a470: 2020 6c6f 203d 2030 2e30 3520 2a20 7365    lo = 0.05 * se
+0000a480: 6c66 2e79 7363 616c 652e 7363 616c 6566  lf.yscale.scalef
+0000a490: 2023 2073 7472 616e 6765 2051 5420 6c6f   # strange QT lo
+0000a4a0: 6720 7363 616c 6520 7265 6e64 6572 696e  g scale renderin
+0000a4b0: 672c 2077 6869 6368 2049 276d 2075 6e61  g, which I'm una
+0000a4c0: 626c 6520 746f 2063 6f6d 7065 6e73 6174  ble to compensat
+0000a4d0: 6520 666f 720d 0a20 2020 2020 2020 2020  e for..         
+0000a4e0: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
+0000a4f0: 2020 2020 2020 2020 2020 6c6f 203d 206d            lo = m
+0000a500: 6178 2831 652d 3130 302c 206c 6f29 0d0a  ax(1e-100, lo)..
+0000a510: 2020 2020 2020 2020 2020 2020 726e 6720              rng 
+0000a520: 3d20 2868 6920 2f20 6c6f 2920 2a2a 2028  = (hi / lo) ** (
+0000a530: 312f 7365 6c66 2e76 5f7a 6f6f 6d5f 7363  1/self.v_zoom_sc
+0000a540: 616c 6529 0d0a 2020 2020 2020 2020 2020  ale)..          
+0000a550: 2020 726e 6720 3d20 6d69 6e28 726e 672c    rng = min(rng,
+0000a560: 2031 6535 3029 2023 2061 766f 6964 2066   1e50) # avoid f
+0000a570: 6c6f 6174 206f 7665 7266 6c6f 770d 0a20  loat overflow.. 
+0000a580: 2020 2020 2020 2020 2020 2062 6173 6520             base 
+0000a590: 3d20 2868 692a 6c6f 2920 2a2a 2073 656c  = (hi*lo) ** sel
+0000a5a0: 662e 765f 7a6f 6f6d 5f62 6173 656c 696e  f.v_zoom_baselin
+0000a5b0: 650d 0a20 2020 2020 2020 2020 2020 2079  e..            y
+0000a5c0: 3020 3d20 6261 7365 202f 2072 6e67 2a2a  0 = base / rng**
+0000a5d0: 7365 6c66 2e76 5f7a 6f6f 6d5f 6261 7365  self.v_zoom_base
+0000a5e0: 6c69 6e65 0d0a 2020 2020 2020 2020 2020  line..          
+0000a5f0: 2020 7931 203d 2062 6173 6520 2a20 726e    y1 = base * rn
+0000a600: 672a 2a28 312d 7365 6c66 2e76 5f7a 6f6f  g**(1-self.v_zoo
+0000a610: 6d5f 6261 7365 6c69 6e65 290d 0a20 2020  m_baseline)..   
+0000a620: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
+0000a630: 2020 2020 2020 2020 726e 6720 3d20 2868          rng = (h
+0000a640: 692d 6c6f 2920 2f20 7365 6c66 2e76 5f7a  i-lo) / self.v_z
+0000a650: 6f6f 6d5f 7363 616c 650d 0a20 2020 2020  oom_scale..     
+0000a660: 2020 2020 2020 2072 6e67 203d 206d 6178         rng = max
+0000a670: 2872 6e67 2c20 3265 2d37 2920 2320 736f  (rng, 2e-7) # so
+0000a680: 6d65 2076 6572 7920 7765 6972 6420 6275  me very weird bu
+0000a690: 6720 7768 6572 6520 6869 6768 2f6c 6f77  g where high/low
+0000a6a0: 2065 7870 6f6e 656e 7473 2073 746f 7073   exponents stops
+0000a6b0: 2072 656e 6465 7269 6e67 0d0a 2020 2020   rendering..    
+0000a6c0: 2020 2020 2020 2020 6261 7365 203d 2028          base = (
+0000a6d0: 6869 2b6c 6f29 202a 2073 656c 662e 765f  hi+lo) * self.v_
+0000a6e0: 7a6f 6f6d 5f62 6173 656c 696e 650d 0a20  zoom_baseline.. 
+0000a6f0: 2020 2020 2020 2020 2020 2079 3020 3d20             y0 = 
+0000a700: 6261 7365 202d 2072 6e67 2a73 656c 662e  base - rng*self.
+0000a710: 765f 7a6f 6f6d 5f62 6173 656c 696e 650d  v_zoom_baseline.
+0000a720: 0a20 2020 2020 2020 2020 2020 2079 3120  .            y1 
+0000a730: 3d20 6261 7365 202b 2072 6e67 2a28 312d  = base + rng*(1-
+0000a740: 7365 6c66 2e76 5f7a 6f6f 6d5f 6261 7365  self.v_zoom_base
+0000a750: 6c69 6e65 290d 0a20 2020 2020 2020 2069  line)..        i
+0000a760: 6620 6e6f 7420 7365 6c66 2e78 5f69 6e64  f not self.x_ind
+0000a770: 6578 6564 3a0d 0a20 2020 2020 2020 2020  exed:..         
+0000a780: 2020 2078 302c 7831 203d 205f 786d 696e     x0,x1 = _xmin
+0000a790: 6d61 7828 6461 7461 7372 632c 2078 5f69  max(datasrc, x_i
+0000a7a0: 6e64 6578 6564 3d46 616c 7365 2c20 6578  ndexed=False, ex
+0000a7b0: 7472 615f 6d61 7267 696e 3d30 290d 0a20  tra_margin=0).. 
+0000a7c0: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+0000a7d0: 6c66 2e73 6574 5f72 616e 6765 2878 302c  lf.set_range(x0,
+0000a7e0: 2079 302c 2078 312c 2079 3129 0d0a 0d0a   y0, x1, y1)....
+0000a7f0: 2020 2020 6465 6620 7365 745f 7261 6e67      def set_rang
+0000a800: 6528 7365 6c66 2c20 7830 2c20 7930 2c20  e(self, x0, y0, 
+0000a810: 7831 2c20 7931 293a 0d0a 2020 2020 2020  x1, y1):..      
+0000a820: 2020 6966 2078 3020 6973 204e 6f6e 6520    if x0 is None 
+0000a830: 6f72 2078 3120 6973 204e 6f6e 653a 0d0a  or x1 is None:..
+0000a840: 2020 2020 2020 2020 2020 2020 7472 203d              tr =
+0000a850: 2073 656c 662e 7461 7267 6574 5265 6374   self.targetRect
+0000a860: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
+0000a870: 7830 203d 2074 722e 6c65 6674 2829 0d0a  x0 = tr.left()..
+0000a880: 2020 2020 2020 2020 2020 2020 7831 203d              x1 =
+0000a890: 2074 722e 7269 6768 7428 290d 0a20 2020   tr.right()..   
+0000a8a0: 2020 2020 2069 6620 6e70 2e69 736e 616e       if np.isnan
+0000a8b0: 2879 3029 206f 7220 6e70 2e69 736e 616e  (y0) or np.isnan
+0000a8c0: 2879 3129 3a0d 0a20 2020 2020 2020 2020  (y1):..         
+0000a8d0: 2020 2072 6574 7572 6e0d 0a20 2020 2020     return..     
+0000a8e0: 2020 205f 7930 203d 2073 656c 662e 7973     _y0 = self.ys
+0000a8f0: 6361 6c65 2e69 6e76 7866 6f72 6d28 7930  cale.invxform(y0
+0000a900: 2c20 7665 7269 6679 3d54 7275 6529 0d0a  , verify=True)..
+0000a910: 2020 2020 2020 2020 5f79 3120 3d20 7365          _y1 = se
+0000a920: 6c66 2e79 7363 616c 652e 696e 7678 666f  lf.yscale.invxfo
+0000a930: 726d 2879 312c 2076 6572 6966 793d 5472  rm(y1, verify=Tr
+0000a940: 7565 290d 0a20 2020 2020 2020 2073 656c  ue)..        sel
+0000a950: 662e 7365 7452 616e 6765 2851 7443 6f72  f.setRange(QtCor
+0000a960: 652e 5152 6563 7446 2870 672e 506f 696e  e.QRectF(pg.Poin
+0000a970: 7428 7830 2c20 5f79 3029 2c20 7067 2e50  t(x0, _y0), pg.P
+0000a980: 6f69 6e74 2878 312c 205f 7931 2929 2c20  oint(x1, _y1)), 
+0000a990: 7061 6464 696e 673d 3029 0d0a 2020 2020  padding=0)..    
+0000a9a0: 2020 2020 7265 7475 726e 2054 7275 650d      return True.
+0000a9b0: 0a0d 0a20 2020 2064 6566 2072 656d 6f76  ...    def remov
+0000a9c0: 655f 6c61 7374 5f72 6f69 2873 656c 6629  e_last_roi(self)
+0000a9d0: 3a0d 0a20 2020 2020 2020 2069 6620 7365  :..        if se
+0000a9e0: 6c66 2e72 6f69 733a 0d0a 2020 2020 2020  lf.rois:..      
+0000a9f0: 2020 2020 2020 6966 206e 6f74 2069 7369        if not isi
+0000aa00: 6e73 7461 6e63 6528 7365 6c66 2e72 6f69  nstance(self.roi
+0000aa10: 735b 2d31 5d2c 2070 672e 506f 6c79 4c69  s[-1], pg.PolyLi
+0000aa20: 6e65 524f 4929 3a0d 0a20 2020 2020 2020  neROI):..       
+0000aa30: 2020 2020 2020 2020 2073 656c 662e 7265           self.re
+0000aa40: 6d6f 7665 4974 656d 2873 656c 662e 726f  moveItem(self.ro
+0000aa50: 6973 5b2d 315d 290d 0a20 2020 2020 2020  is[-1])..       
 0000aa60: 2020 2020 2020 2020 2073 656c 662e 726f           self.ro
-0000aa70: 6973 5b2d 315d 2e72 656d 6f76 6548 616e  is[-1].removeHan
-0000aa80: 646c 6528 6829 0d0a 2020 2020 2020 2020  dle(h)..        
-0000aa90: 2020 2020 2020 2020 6966 206e 6f74 2073          if not s
-0000aaa0: 656c 662e 726f 6973 5b2d 315d 2e73 6567  elf.rois[-1].seg
-0000aab0: 6d65 6e74 733a 0d0a 2020 2020 2020 2020  ments:..        
-0000aac0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0000aad0: 2e72 656d 6f76 6549 7465 6d28 7365 6c66  .removeItem(self
-0000aae0: 2e72 6f69 735b 2d31 5d29 0d0a 2020 2020  .rois[-1])..    
-0000aaf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ab00: 7365 6c66 2e72 6f69 7320 3d20 7365 6c66  self.rois = self
-0000ab10: 2e72 6f69 735b 3a2d 315d 0d0a 2020 2020  .rois[:-1]..    
-0000ab20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ab30: 7365 6c66 2e64 7261 775f 6c69 6e65 203d  self.draw_line =
-0000ab40: 204e 6f6e 650d 0a20 2020 2020 2020 2020   None..         
-0000ab50: 2020 2069 6620 7365 6c66 2e72 6f69 733a     if self.rois:
+0000aa70: 6973 203d 2073 656c 662e 726f 6973 5b3a  is = self.rois[:
+0000aa80: 2d31 5d0d 0a20 2020 2020 2020 2020 2020  -1]..           
+0000aa90: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
+0000aaa0: 2020 2020 2020 2020 6820 3d20 7365 6c66          h = self
+0000aab0: 2e72 6f69 735b 2d31 5d2e 6861 6e64 6c65  .rois[-1].handle
+0000aac0: 735b 2d31 5d5b 2769 7465 6d27 5d0d 0a20  s[-1]['item'].. 
+0000aad0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0000aae0: 656c 662e 726f 6973 5b2d 315d 2e72 656d  elf.rois[-1].rem
+0000aaf0: 6f76 6548 616e 646c 6528 6829 0d0a 2020  oveHandle(h)..  
+0000ab00: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0000ab10: 206e 6f74 2073 656c 662e 726f 6973 5b2d   not self.rois[-
+0000ab20: 315d 2e73 6567 6d65 6e74 733a 0d0a 2020  1].segments:..  
+0000ab30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ab40: 2020 7365 6c66 2e72 656d 6f76 6549 7465    self.removeIte
+0000ab50: 6d28 7365 6c66 2e72 6f69 735b 2d31 5d29  m(self.rois[-1])
 0000ab60: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000ab70: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
-0000ab80: 7365 6c66 2e72 6f69 735b 2d31 5d2c 2070  self.rois[-1], p
-0000ab90: 672e 506f 6c79 4c69 6e65 524f 4929 3a0d  g.PolyLineROI):.
-0000aba0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000abb0: 2020 2020 2073 656c 662e 6472 6177 5f6c       self.draw_l
-0000abc0: 696e 6520 3d20 7365 6c66 2e72 6f69 735b  ine = self.rois[
-0000abd0: 2d31 5d0d 0a20 2020 2020 2020 2020 2020  -1]..           
-0000abe0: 2020 2020 2020 2020 2073 656c 662e 7365           self.se
-0000abf0: 745f 6472 6177 5f6c 696e 655f 636f 6c6f  t_draw_line_colo
-0000ac00: 7228 6472 6177 5f6c 696e 655f 636f 6c6f  r(draw_line_colo
-0000ac10: 7229 0d0a 2020 2020 2020 2020 2020 2020  r)..            
-0000ac20: 7265 7475 726e 2054 7275 650d 0a0d 0a20  return True.... 
-0000ac30: 2020 2064 6566 2061 7070 656e 645f 6472     def append_dr
-0000ac40: 6177 5f73 6567 6d65 6e74 2873 656c 662c  aw_segment(self,
-0000ac50: 2070 293a 0d0a 2020 2020 2020 2020 6830   p):..        h0
-0000ac60: 203d 2073 656c 662e 6472 6177 5f6c 696e   = self.draw_lin
-0000ac70: 652e 6861 6e64 6c65 735b 2d31 5d5b 2769  e.handles[-1]['i
-0000ac80: 7465 6d27 5d0d 0a20 2020 2020 2020 2068  tem']..        h
-0000ac90: 3120 3d20 7365 6c66 2e64 7261 775f 6c69  1 = self.draw_li
-0000aca0: 6e65 2e61 6464 4672 6565 4861 6e64 6c65  ne.addFreeHandle
-0000acb0: 2870 290d 0a20 2020 2020 2020 2073 656c  (p)..        sel
-0000acc0: 662e 6472 6177 5f6c 696e 652e 6164 6453  f.draw_line.addS
-0000acd0: 6567 6d65 6e74 2868 302c 2068 3129 0d0a  egment(h0, h1)..
-0000ace0: 2020 2020 2020 2020 7365 6c66 2e64 7261          self.dra
-0000acf0: 7769 6e67 203d 2054 7275 650d 0a0d 0a20  wing = True.... 
-0000ad00: 2020 2064 6566 2073 6574 5f64 7261 775f     def set_draw_
-0000ad10: 6c69 6e65 5f63 6f6c 6f72 2873 656c 662c  line_color(self,
-0000ad20: 2063 6f6c 6f72 293a 0d0a 2020 2020 2020   color):..      
-0000ad30: 2020 6966 2073 656c 662e 6472 6177 5f6c    if self.draw_l
-0000ad40: 696e 653a 0d0a 2020 2020 2020 2020 2020  ine:..          
-0000ad50: 2020 7065 6e20 3d20 7067 2e6d 6b50 656e    pen = pg.mkPen
-0000ad60: 2863 6f6c 6f72 290d 0a20 2020 2020 2020  (color)..       
-0000ad70: 2020 2020 2066 6f72 2073 6567 6d65 6e74       for segment
-0000ad80: 2069 6e20 7365 6c66 2e64 7261 775f 6c69   in self.draw_li
-0000ad90: 6e65 2e73 6567 6d65 6e74 733a 0d0a 2020  ne.segments:..  
-0000ada0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-0000adb0: 676d 656e 742e 6375 7272 656e 7450 656e  gment.currentPen
-0000adc0: 203d 2073 6567 6d65 6e74 2e70 656e 203d   = segment.pen =
-0000add0: 2070 656e 0d0a 2020 2020 2020 2020 2020   pen..          
-0000ade0: 2020 2020 2020 7365 676d 656e 742e 7570        segment.up
-0000adf0: 6461 7465 2829 0d0a 0d0a 2020 2020 6465  date()....    de
-0000ae00: 6620 7375 6767 6573 7450 6164 6469 6e67  f suggestPadding
-0000ae10: 2873 656c 662c 2061 7869 7329 3a0d 0a20  (self, axis):.. 
-0000ae20: 2020 2020 2020 2072 6574 7572 6e20 300d         return 0.
-0000ae30: 0a0d 0a0d 0a0d 0a63 6c61 7373 2046 696e  .......class Fin
-0000ae40: 506c 6f74 4974 656d 2870 672e 4772 6170  PlotItem(pg.Grap
-0000ae50: 6869 6373 4f62 6a65 6374 293a 0d0a 2020  hicsObject):..  
-0000ae60: 2020 6465 6620 5f5f 696e 6974 5f5f 2873    def __init__(s
-0000ae70: 656c 662c 2061 782c 2064 6174 6173 7263  elf, ax, datasrc
-0000ae80: 2c20 6c6f 6429 3a0d 0a20 2020 2020 2020  , lod):..       
-0000ae90: 2073 7570 6572 2829 2e5f 5f69 6e69 745f   super().__init_
-0000aea0: 5f28 290d 0a20 2020 2020 2020 2073 656c  _()..        sel
-0000aeb0: 662e 6178 203d 2061 780d 0a20 2020 2020  f.ax = ax..     
-0000aec0: 2020 2073 656c 662e 6461 7461 7372 6320     self.datasrc 
-0000aed0: 3d20 6461 7461 7372 630d 0a20 2020 2020  = datasrc..     
-0000aee0: 2020 2073 656c 662e 7069 6374 7572 6520     self.picture 
-0000aef0: 3d20 5174 4775 692e 5150 6963 7475 7265  = QtGui.QPicture
-0000af00: 2829 0d0a 2020 2020 2020 2020 7365 6c66  ()..        self
-0000af10: 2e70 6169 6e74 6572 203d 2051 7447 7569  .painter = QtGui
-0000af20: 2e51 5061 696e 7465 7228 290d 0a20 2020  .QPainter()..   
-0000af30: 2020 2020 2073 656c 662e 6469 7274 7920       self.dirty 
-0000af40: 3d20 5472 7565 0d0a 2020 2020 2020 2020  = True..        
-0000af50: 7365 6c66 2e6c 6f64 203d 206c 6f64 0d0a  self.lod = lod..
-0000af60: 2020 2020 2020 2020 7365 6c66 2e63 6163          self.cac
-0000af70: 6865 6452 6563 7420 3d20 4e6f 6e65 0d0a  hedRect = None..
-0000af80: 0d0a 2020 2020 6465 6620 7265 7061 696e  ..    def repain
-0000af90: 7428 7365 6c66 293a 0d0a 2020 2020 2020  t(self):..      
-0000afa0: 2020 7365 6c66 2e64 6972 7479 203d 2054    self.dirty = T
-0000afb0: 7275 650d 0a20 2020 2020 2020 2073 656c  rue..        sel
-0000afc0: 662e 7061 696e 7428 7365 6c66 2e70 6169  f.paint(self.pai
-0000afd0: 6e74 6572 290d 0a0d 0a20 2020 2064 6566  nter)....    def
-0000afe0: 2070 6169 6e74 2873 656c 662c 2070 2c20   paint(self, p, 
-0000aff0: 2a61 7267 7329 3a0d 0a20 2020 2020 2020  *args):..       
-0000b000: 2069 6620 7365 6c66 2e64 6174 6173 7263   if self.datasrc
-0000b010: 2e69 735f 7370 6172 7365 3a0d 0a20 2020  .is_sparse:..   
-0000b020: 2020 2020 2020 2020 2073 656c 662e 6469           self.di
-0000b030: 7274 7920 3d20 5472 7565 0d0a 2020 2020  rty = True..    
-0000b040: 2020 2020 7365 6c66 2e75 7064 6174 655f      self.update_
-0000b050: 6469 7274 795f 7069 6374 7572 6528 7365  dirty_picture(se
-0000b060: 6c66 2e76 6965 7752 6563 7428 2929 0d0a  lf.viewRect())..
-0000b070: 2020 2020 2020 2020 702e 6472 6177 5069          p.drawPi
-0000b080: 6374 7572 6528 302c 2030 2c20 7365 6c66  cture(0, 0, self
-0000b090: 2e70 6963 7475 7265 290d 0a0d 0a20 2020  .picture)....   
-0000b0a0: 2064 6566 2075 7064 6174 655f 6469 7274   def update_dirt
-0000b0b0: 795f 7069 6374 7572 6528 7365 6c66 2c20  y_picture(self, 
-0000b0c0: 7669 7369 626c 6552 6563 7429 3a0d 0a20  visibleRect):.. 
-0000b0d0: 2020 2020 2020 2069 6620 7365 6c66 2e64         if self.d
-0000b0e0: 6972 7479 206f 7220 5c0d 0a20 2020 2020  irty or \..     
-0000b0f0: 2020 2020 2020 2028 7365 6c66 2e6c 6f64         (self.lod
-0000b100: 2061 6e64 2023 2072 6567 656e 6572 6174   and # regenerat
-0000b110: 6520 7768 656e 207a 6f6f 6d20 6368 616e  e when zoom chan
-0000b120: 6765 733f 0d0a 2020 2020 2020 2020 2020  ges?..          
-0000b130: 2020 2020 2020 2876 6973 6962 6c65 5265        (visibleRe
-0000b140: 6374 2e6c 6566 7428 2920 3c20 7365 6c66  ct.left() < self
-0000b150: 2e63 6163 6865 6452 6563 742e 6c65 6674  .cachedRect.left
-0000b160: 2829 206f 7220 5c0d 0a20 2020 2020 2020  () or \..       
-0000b170: 2020 2020 2020 2020 2020 7669 7369 626c            visibl
-0000b180: 6552 6563 742e 7269 6768 7428 2920 3e20  eRect.right() > 
-0000b190: 7365 6c66 2e63 6163 6865 6452 6563 742e  self.cachedRect.
-0000b1a0: 7269 6768 7428 2920 6f72 205c 0d0a 2020  right() or \..  
-0000b1b0: 2020 2020 2020 2020 2020 2020 2020 2076                 v
-0000b1c0: 6973 6962 6c65 5265 6374 2e77 6964 7468  isibleRect.width
-0000b1d0: 2829 203c 2073 656c 662e 6361 6368 6564  () < self.cached
-0000b1e0: 5265 6374 2e77 6964 7468 2829 202f 2063  Rect.width() / c
-0000b1f0: 6163 6865 5f63 616e 646c 655f 6661 6374  ache_candle_fact
-0000b200: 6f72 2929 3a20 2320 6f70 7469 6d69 7a65  or)): # optimize
-0000b210: 2077 6865 6e20 7a6f 6f6d 696e 6720 696e   when zooming in
-0000b220: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-0000b230: 6c66 2e5f 6765 6e65 7261 7465 5f70 6963  lf._generate_pic
-0000b240: 7475 7265 2876 6973 6962 6c65 5265 6374  ture(visibleRect
-0000b250: 290d 0a0d 0a20 2020 2064 6566 205f 6765  )....    def _ge
-0000b260: 6e65 7261 7465 5f70 6963 7475 7265 2873  nerate_picture(s
-0000b270: 656c 662c 2062 6f75 6e64 696e 6752 6563  elf, boundingRec
-0000b280: 7429 3a0d 0a20 2020 2020 2020 2077 203d  t):..        w =
-0000b290: 2062 6f75 6e64 696e 6752 6563 742e 7769   boundingRect.wi
-0000b2a0: 6474 6828 290d 0a20 2020 2020 2020 2073  dth()..        s
-0000b2b0: 656c 662e 6361 6368 6564 5265 6374 203d  elf.cachedRect =
-0000b2c0: 2051 7443 6f72 652e 5152 6563 7446 2862   QtCore.QRectF(b
-0000b2d0: 6f75 6e64 696e 6752 6563 742e 6c65 6674  oundingRect.left
-0000b2e0: 2829 2d28 6361 6368 655f 6361 6e64 6c65  ()-(cache_candle
-0000b2f0: 5f66 6163 746f 722d 3129 2a30 2e35 2a77  _factor-1)*0.5*w
-0000b300: 2c20 302c 2063 6163 6865 5f63 616e 646c  , 0, cache_candl
-0000b310: 655f 6661 6374 6f72 2a77 2c20 3029 0d0a  e_factor*w, 0)..
-0000b320: 2020 2020 2020 2020 7365 6c66 2e70 6169          self.pai
-0000b330: 6e74 6572 2e62 6567 696e 2873 656c 662e  nter.begin(self.
-0000b340: 7069 6374 7572 6529 0d0a 2020 2020 2020  picture)..      
-0000b350: 2020 7365 6c66 2e5f 6765 6e65 7261 7465    self._generate
-0000b360: 5f64 756d 6d79 5f70 6963 7475 7265 2873  _dummy_picture(s
-0000b370: 656c 662e 7669 6577 5265 6374 2829 290d  elf.viewRect()).
-0000b380: 0a20 2020 2020 2020 2073 656c 662e 6765  .        self.ge
-0000b390: 6e65 7261 7465 5f70 6963 7475 7265 2873  nerate_picture(s
-0000b3a0: 656c 662e 6361 6368 6564 5265 6374 290d  elf.cachedRect).
-0000b3b0: 0a20 2020 2020 2020 2073 656c 662e 7061  .        self.pa
-0000b3c0: 696e 7465 722e 656e 6428 290d 0a20 2020  inter.end()..   
-0000b3d0: 2020 2020 2073 656c 662e 6469 7274 7920       self.dirty 
-0000b3e0: 3d20 4661 6c73 650d 0a0d 0a20 2020 2064  = False....    d
-0000b3f0: 6566 205f 6765 6e65 7261 7465 5f64 756d  ef _generate_dum
-0000b400: 6d79 5f70 6963 7475 7265 2873 656c 662c  my_picture(self,
-0000b410: 2062 6f75 6e64 696e 6752 6563 7429 3a0d   boundingRect):.
-0000b420: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-0000b430: 2e64 6174 6173 7263 2e69 735f 7370 6172  .datasrc.is_spar
-0000b440: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
-0000b450: 2023 206a 7573 7420 6472 6177 2073 6f6d   # just draw som
-0000b460: 6574 6869 6e67 2074 6f20 656e 7375 7265  ething to ensure
-0000b470: 2050 7951 7420 7769 6c6c 2070 6169 6e74   PyQt will paint
-0000b480: 2075 7320 6167 6169 6e0d 0a20 2020 2020   us again..     
-0000b490: 2020 2020 2020 2073 656c 662e 7061 696e         self.pain
-0000b4a0: 7465 722e 7365 7450 656e 2870 672e 6d6b  ter.setPen(pg.mk
-0000b4b0: 5065 6e28 6261 636b 6772 6f75 6e64 2929  Pen(background))
-0000b4c0: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-0000b4d0: 6c66 2e70 6169 6e74 6572 2e73 6574 4272  lf.painter.setBr
-0000b4e0: 7573 6828 7067 2e6d 6b42 7275 7368 2862  ush(pg.mkBrush(b
-0000b4f0: 6163 6b67 726f 756e 6429 290d 0a20 2020  ackground))..   
-0000b500: 2020 2020 2020 2020 206c 2c72 203d 2062           l,r = b
-0000b510: 6f75 6e64 696e 6752 6563 742e 6c65 6674  oundingRect.left
-0000b520: 2829 2c20 626f 756e 6469 6e67 5265 6374  (), boundingRect
-0000b530: 2e72 6967 6874 2829 0d0a 2020 2020 2020  .right()..      
-0000b540: 2020 2020 2020 7365 6c66 2e70 6169 6e74        self.paint
-0000b550: 6572 2e64 7261 7752 6563 7428 5174 436f  er.drawRect(QtCo
-0000b560: 7265 2e51 5265 6374 4628 6c2c 2062 6f75  re.QRectF(l, bou
-0000b570: 6e64 696e 6752 6563 742e 746f 7028 292c  ndingRect.top(),
-0000b580: 2031 652d 332c 2062 6f75 6e64 696e 6752   1e-3, boundingR
-0000b590: 6563 742e 6865 6967 6874 2829 2a31 652d  ect.height()*1e-
-0000b5a0: 3529 290d 0a20 2020 2020 2020 2020 2020  5))..           
-0000b5b0: 2073 656c 662e 7061 696e 7465 722e 6472   self.painter.dr
-0000b5c0: 6177 5265 6374 2851 7443 6f72 652e 5152  awRect(QtCore.QR
-0000b5d0: 6563 7446 2872 2c20 626f 756e 6469 6e67  ectF(r, bounding
-0000b5e0: 5265 6374 2e62 6f74 746f 6d28 292c 202d  Rect.bottom(), -
-0000b5f0: 3165 2d33 2c20 2d62 6f75 6e64 696e 6752  1e-3, -boundingR
-0000b600: 6563 742e 6865 6967 6874 2829 2a31 652d  ect.height()*1e-
-0000b610: 3529 290d 0a0d 0a20 2020 2064 6566 2062  5))....    def b
-0000b620: 6f75 6e64 696e 6752 6563 7428 7365 6c66  oundingRect(self
-0000b630: 293a 0d0a 2020 2020 2020 2020 7265 7475  ):..        retu
-0000b640: 726e 2051 7443 6f72 652e 5152 6563 7446  rn QtCore.QRectF
-0000b650: 2873 656c 662e 7069 6374 7572 652e 626f  (self.picture.bo
-0000b660: 756e 6469 6e67 5265 6374 2829 290d 0a0d  undingRect())...
-0000b670: 0a0d 0a0d 0a63 6c61 7373 2043 616e 646c  .....class Candl
-0000b680: 6573 7469 636b 4974 656d 2846 696e 506c  estickItem(FinPl
-0000b690: 6f74 4974 656d 293a 0d0a 2020 2020 6465  otItem):..    de
-0000b6a0: 6620 5f5f 696e 6974 5f5f 2873 656c 662c  f __init__(self,
-0000b6b0: 2061 782c 2064 6174 6173 7263 2c20 6472   ax, datasrc, dr
-0000b6c0: 6177 5f62 6f64 792c 2064 7261 775f 7368  aw_body, draw_sh
-0000b6d0: 6164 6f77 2c20 6361 6e64 6c65 5f77 6964  adow, candle_wid
-0000b6e0: 7468 2c20 636f 6c6f 7266 756e 632c 2072  th, colorfunc, r
-0000b6f0: 6573 616d 703d 4e6f 6e65 293a 0d0a 2020  esamp=None):..  
-0000b700: 2020 2020 2020 7365 6c66 2e63 6f6c 6f72        self.color
-0000b710: 7320 3d20 6469 6374 2862 756c 6c5f 7368  s = dict(bull_sh
-0000b720: 6164 6f77 2020 2020 2020 3d20 6361 6e64  adow      = cand
-0000b730: 6c65 5f62 756c 6c5f 636f 6c6f 722c 0d0a  le_bull_color,..
-0000b740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b750: 2020 2020 2020 2020 2020 2062 756c 6c5f             bull_
-0000b760: 6672 616d 6520 2020 2020 2020 3d20 6361  frame       = ca
-0000b770: 6e64 6c65 5f62 756c 6c5f 636f 6c6f 722c  ndle_bull_color,
-0000b780: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000b790: 2020 2020 2020 2020 2020 2020 2062 756c               bul
-0000b7a0: 6c5f 626f 6479 2020 2020 2020 2020 3d20  l_body        = 
-0000b7b0: 6361 6e64 6c65 5f62 756c 6c5f 626f 6479  candle_bull_body
-0000b7c0: 5f63 6f6c 6f72 2c0d 0a20 2020 2020 2020  _color,..       
-0000b7d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b7e0: 2020 2020 6265 6172 5f73 6861 646f 7720      bear_shadow 
-0000b7f0: 2020 2020 203d 2063 616e 646c 655f 6265       = candle_be
-0000b800: 6172 5f63 6f6c 6f72 2c0d 0a20 2020 2020  ar_color,..     
-0000b810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b820: 2020 2020 2020 6265 6172 5f66 7261 6d65        bear_frame
-0000b830: 2020 2020 2020 203d 2063 616e 646c 655f         = candle_
-0000b840: 6265 6172 5f63 6f6c 6f72 2c0d 0a20 2020  bear_color,..   
-0000b850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b860: 2020 2020 2020 2020 6265 6172 5f62 6f64          bear_bod
-0000b870: 7920 2020 2020 2020 203d 2063 616e 646c  y        = candl
-0000b880: 655f 6265 6172 5f62 6f64 795f 636f 6c6f  e_bear_body_colo
-0000b890: 722c 0d0a 2020 2020 2020 2020 2020 2020  r,..            
-0000b8a0: 2020 2020 2020 2020 2020 2020 2020 2077                 w
-0000b8b0: 6561 6b5f 6275 6c6c 5f73 6861 646f 7720  eak_bull_shadow 
-0000b8c0: 3d20 6272 6967 6874 656e 2863 616e 646c  = brighten(candl
-0000b8d0: 655f 6275 6c6c 5f63 6f6c 6f72 2c20 312e  e_bull_color, 1.
-0000b8e0: 3229 2c0d 0a20 2020 2020 2020 2020 2020  2),..           
-0000b8f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b900: 7765 616b 5f62 756c 6c5f 6672 616d 6520  weak_bull_frame 
-0000b910: 203d 2062 7269 6768 7465 6e28 6361 6e64   = brighten(cand
-0000b920: 6c65 5f62 756c 6c5f 636f 6c6f 722c 2031  le_bull_color, 1
-0000b930: 2e32 292c 0d0a 2020 2020 2020 2020 2020  .2),..          
-0000b940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b950: 2077 6561 6b5f 6275 6c6c 5f62 6f64 7920   weak_bull_body 
-0000b960: 2020 3d20 6272 6967 6874 656e 2863 616e    = brighten(can
-0000b970: 646c 655f 6275 6c6c 5f63 6f6c 6f72 2c20  dle_bull_color, 
-0000b980: 312e 3229 2c0d 0a20 2020 2020 2020 2020  1.2),..         
-0000b990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b9a0: 2020 7765 616b 5f62 6561 725f 7368 6164    weak_bear_shad
-0000b9b0: 6f77 203d 2062 7269 6768 7465 6e28 6361  ow = brighten(ca
-0000b9c0: 6e64 6c65 5f62 6561 725f 636f 6c6f 722c  ndle_bear_color,
-0000b9d0: 2031 2e35 292c 0d0a 2020 2020 2020 2020   1.5),..        
-0000b9e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b9f0: 2020 2077 6561 6b5f 6265 6172 5f66 7261     weak_bear_fra
-0000ba00: 6d65 2020 3d20 6272 6967 6874 656e 2863  me  = brighten(c
-0000ba10: 616e 646c 655f 6265 6172 5f63 6f6c 6f72  andle_bear_color
-0000ba20: 2c20 312e 3529 2c0d 0a20 2020 2020 2020  , 1.5),..       
-0000ba30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ba40: 2020 2020 7765 616b 5f62 6561 725f 626f      weak_bear_bo
-0000ba50: 6479 2020 203d 2062 7269 6768 7465 6e28  dy   = brighten(
-0000ba60: 6361 6e64 6c65 5f62 6561 725f 636f 6c6f  candle_bear_colo
-0000ba70: 722c 2031 2e35 2929 0d0a 2020 2020 2020  r, 1.5))..      
-0000ba80: 2020 7365 6c66 2e64 7261 775f 626f 6479    self.draw_body
-0000ba90: 203d 2064 7261 775f 626f 6479 0d0a 2020   = draw_body..  
-0000baa0: 2020 2020 2020 7365 6c66 2e64 7261 775f        self.draw_
-0000bab0: 7368 6164 6f77 203d 2064 7261 775f 7368  shadow = draw_sh
-0000bac0: 6164 6f77 0d0a 2020 2020 2020 2020 7365  adow..        se
-0000bad0: 6c66 2e63 616e 646c 655f 7769 6474 6820  lf.candle_width 
-0000bae0: 3d20 6361 6e64 6c65 5f77 6964 7468 0d0a  = candle_width..
-0000baf0: 2020 2020 2020 2020 7365 6c66 2e73 6861          self.sha
-0000bb00: 646f 775f 7769 6474 6820 3d20 6361 6e64  dow_width = cand
-0000bb10: 6c65 5f73 6861 646f 775f 7769 6474 680d  le_shadow_width.
-0000bb20: 0a20 2020 2020 2020 2073 656c 662e 636f  .        self.co
-0000bb30: 6c6f 7266 756e 6320 3d20 636f 6c6f 7266  lorfunc = colorf
-0000bb40: 756e 630d 0a20 2020 2020 2020 2073 656c  unc..        sel
-0000bb50: 662e 7265 7361 6d70 203d 2072 6573 616d  f.resamp = resam
-0000bb60: 700d 0a20 2020 2020 2020 2073 656c 662e  p..        self.
-0000bb70: 785f 6f66 6673 6574 203d 2030 0d0a 2020  x_offset = 0..  
-0000bb80: 2020 2020 2020 7375 7065 7228 292e 5f5f        super().__
-0000bb90: 696e 6974 5f5f 2861 782c 2064 6174 6173  init__(ax, datas
-0000bba0: 7263 2c20 6c6f 643d 5472 7565 290d 0a0d  rc, lod=True)...
-0000bbb0: 0a20 2020 2064 6566 2067 656e 6572 6174  .    def generat
-0000bbc0: 655f 7069 6374 7572 6528 7365 6c66 2c20  e_picture(self, 
-0000bbd0: 626f 756e 6469 6e67 5265 6374 293a 0d0a  boundingRect):..
-0000bbe0: 2020 2020 2020 2020 6c65 6674 2c72 6967          left,rig
-0000bbf0: 6874 203d 2062 6f75 6e64 696e 6752 6563  ht = boundingRec
-0000bc00: 742e 6c65 6674 2829 2c20 626f 756e 6469  t.left(), boundi
-0000bc10: 6e67 5265 6374 2e72 6967 6874 2829 0d0a  ngRect.right()..
-0000bc20: 2020 2020 2020 2020 7020 3d20 7365 6c66          p = self
-0000bc30: 2e70 6169 6e74 6572 0d0a 2020 2020 2020  .painter..      
-0000bc40: 2020 6466 2c6f 7269 676c 656e 203d 2073    df,origlen = s
-0000bc50: 656c 662e 6461 7461 7372 632e 726f 7773  elf.datasrc.rows
-0000bc60: 2835 2c20 6c65 6674 2c20 7269 6768 742c  (5, left, right,
-0000bc70: 2079 7363 616c 653d 7365 6c66 2e61 782e   yscale=self.ax.
-0000bc80: 7662 2e79 7363 616c 652c 2072 6573 616d  vb.yscale, resam
-0000bc90: 703d 7365 6c66 2e72 6573 616d 7029 0d0a  p=self.resamp)..
-0000bca0: 2020 2020 2020 2020 6620 3d20 6f72 6967          f = orig
-0000bcb0: 6c65 6e20 2f20 6c65 6e28 6466 2920 6966  len / len(df) if
-0000bcc0: 206c 656e 2864 6629 2065 6c73 6520 310d   len(df) else 1.
-0000bcd0: 0a20 2020 2020 2020 2077 203d 2073 656c  .        w = sel
-0000bce0: 662e 6361 6e64 6c65 5f77 6964 7468 202a  f.candle_width *
-0000bcf0: 2066 0d0a 2020 2020 2020 2020 7732 203d   f..        w2 =
-0000bd00: 2077 202a 2030 2e35 0d0a 2020 2020 2020   w * 0.5..      
-0000bd10: 2020 666f 7220 7368 6164 6f77 2c66 7261    for shadow,fra
-0000bd20: 6d65 2c62 6f64 792c 6466 5f72 6f77 7320  me,body,df_rows 
-0000bd30: 696e 2073 656c 662e 636f 6c6f 7266 756e  in self.colorfun
-0000bd40: 6328 7365 6c66 2c20 7365 6c66 2e64 6174  c(self, self.dat
-0000bd50: 6173 7263 2c20 6466 293a 0d0a 2020 2020  asrc, df):..    
-0000bd60: 2020 2020 2020 2020 6964 7873 203d 2064          idxs = d
-0000bd70: 665f 726f 7773 2e69 6e64 6578 0d0a 2020  f_rows.index..  
-0000bd80: 2020 2020 2020 2020 2020 726f 7773 203d            rows =
-0000bd90: 2064 665f 726f 7773 2e76 616c 7565 730d   df_rows.values.
-0000bda0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0000bdb0: 7365 6c66 2e78 5f6f 6666 7365 743a 0d0a  self.x_offset:..
-0000bdc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bdd0: 6964 7873 202b 3d20 7365 6c66 2e78 5f6f  idxs += self.x_o
-0000bde0: 6666 7365 740d 0a20 2020 2020 2020 2020  ffset..         
-0000bdf0: 2020 2069 6620 7365 6c66 2e64 7261 775f     if self.draw_
-0000be00: 7368 6164 6f77 3a0d 0a20 2020 2020 2020  shadow:..       
-0000be10: 2020 2020 2020 2020 2070 2e73 6574 5065           p.setPe
-0000be20: 6e28 7067 2e6d 6b50 656e 2873 6861 646f  n(pg.mkPen(shado
-0000be30: 772c 2077 6964 7468 3d73 656c 662e 7368  w, width=self.sh
-0000be40: 6164 6f77 5f77 6964 7468 2929 0d0a 2020  adow_width))..  
-0000be50: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-0000be60: 7220 782c 2874 2c6f 7065 6e2c 636c 6f73  r x,(t,open,clos
-0000be70: 652c 6869 6768 2c6c 6f77 2920 696e 207a  e,high,low) in z
-0000be80: 6970 2869 6478 732c 2072 6f77 7329 3a0d  ip(idxs, rows):.
-0000be90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000bea0: 2020 2020 2069 6620 6869 6768 203e 206c       if high > l
-0000beb0: 6f77 3a0d 0a20 2020 2020 2020 2020 2020  ow:..           
-0000bec0: 2020 2020 2020 2020 2020 2020 2070 2e64               p.d
-0000bed0: 7261 774c 696e 6528 5174 436f 7265 2e51  rawLine(QtCore.Q
-0000bee0: 506f 696e 7446 2878 2c20 6c6f 7729 2c20  PointF(x, low), 
-0000bef0: 5174 436f 7265 2e51 506f 696e 7446 2878  QtCore.QPointF(x
-0000bf00: 2c20 6869 6768 2929 0d0a 2020 2020 2020  , high))..      
-0000bf10: 2020 2020 2020 6966 2073 656c 662e 6472        if self.dr
-0000bf20: 6177 5f62 6f64 793a 0d0a 2020 2020 2020  aw_body:..      
-0000bf30: 2020 2020 2020 2020 2020 702e 7365 7450            p.setP
-0000bf40: 656e 2870 672e 6d6b 5065 6e28 6672 616d  en(pg.mkPen(fram
-0000bf50: 6529 290d 0a20 2020 2020 2020 2020 2020  e))..           
-0000bf60: 2020 2020 2070 2e73 6574 4272 7573 6828       p.setBrush(
-0000bf70: 7067 2e6d 6b42 7275 7368 2862 6f64 7929  pg.mkBrush(body)
-0000bf80: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-0000bf90: 2020 2066 6f72 2078 2c28 742c 6f70 656e     for x,(t,open
-0000bfa0: 2c63 6c6f 7365 2c68 6967 682c 6c6f 7729  ,close,high,low)
-0000bfb0: 2069 6e20 7a69 7028 6964 7873 2c20 726f   in zip(idxs, ro
-0000bfc0: 7773 293a 0d0a 2020 2020 2020 2020 2020  ws):..          
-0000bfd0: 2020 2020 2020 2020 2020 702e 6472 6177            p.draw
-0000bfe0: 5265 6374 2851 7443 6f72 652e 5152 6563  Rect(QtCore.QRec
-0000bff0: 7446 2878 2d77 322c 206f 7065 6e2c 2077  tF(x-w2, open, w
-0000c000: 2c20 636c 6f73 652d 6f70 656e 2929 0d0a  , close-open))..
-0000c010: 0d0a 2020 2020 6465 6620 726f 7763 6f6c  ..    def rowcol
-0000c020: 6f72 7328 7365 6c66 2c20 7072 6566 6978  ors(self, prefix
-0000c030: 293a 0d0a 2020 2020 2020 2020 7265 7475  ):..        retu
-0000c040: 726e 205b 7365 6c66 2e63 6f6c 6f72 735b  rn [self.colors[
-0000c050: 7072 6566 6978 2b27 5f73 6861 646f 7727  prefix+'_shadow'
-0000c060: 5d2c 2073 656c 662e 636f 6c6f 7273 5b70  ], self.colors[p
-0000c070: 7265 6669 782b 275f 6672 616d 6527 5d2c  refix+'_frame'],
-0000c080: 2073 656c 662e 636f 6c6f 7273 5b70 7265   self.colors[pre
-0000c090: 6669 782b 275f 626f 6479 275d 5d0d 0a0d  fix+'_body']]...
-0000c0a0: 0a0d 0a0d 0a63 6c61 7373 2048 6561 746d  .....class Heatm
-0000c0b0: 6170 4974 656d 2846 696e 506c 6f74 4974  apItem(FinPlotIt
-0000c0c0: 656d 293a 0d0a 2020 2020 6465 6620 5f5f  em):..    def __
-0000c0d0: 696e 6974 5f5f 2873 656c 662c 2061 782c  init__(self, ax,
-0000c0e0: 2064 6174 6173 7263 2c20 7265 6374 5f73   datasrc, rect_s
-0000c0f0: 697a 653d 302e 392c 2066 696c 7465 725f  ize=0.9, filter_
-0000c100: 6c69 6d69 743d 302c 2063 6f6c 6d61 703d  limit=0, colmap=
-0000c110: 636f 6c6d 6170 5f63 6c61 7368 2c20 7768  colmap_clash, wh
-0000c120: 6974 656f 7574 3d30 2e30 2c20 636f 6c63  iteout=0.0, colc
-0000c130: 7572 7665 3d6c 616d 6264 6120 783a 706f  urve=lambda x:po
-0000c140: 7728 782c 3429 293a 0d0a 2020 2020 2020  w(x,4)):..      
-0000c150: 2020 7365 6c66 2e72 6563 745f 7369 7a65    self.rect_size
-0000c160: 203d 2072 6563 745f 7369 7a65 0d0a 2020   = rect_size..  
-0000c170: 2020 2020 2020 7365 6c66 2e66 696c 7465        self.filte
-0000c180: 725f 6c69 6d69 7420 3d20 6669 6c74 6572  r_limit = filter
-0000c190: 5f6c 696d 6974 0d0a 2020 2020 2020 2020  _limit..        
-0000c1a0: 7365 6c66 2e63 6f6c 6d61 7020 3d20 636f  self.colmap = co
-0000c1b0: 6c6d 6170 0d0a 2020 2020 2020 2020 7365  lmap..        se
-0000c1c0: 6c66 2e77 6869 7465 6f75 7420 3d20 7768  lf.whiteout = wh
-0000c1d0: 6974 656f 7574 0d0a 2020 2020 2020 2020  iteout..        
-0000c1e0: 7365 6c66 2e63 6f6c 6375 7276 6520 3d20  self.colcurve = 
-0000c1f0: 636f 6c63 7572 7665 0d0a 2020 2020 2020  colcurve..      
-0000c200: 2020 7365 6c66 2e63 6f6c 5f64 6174 615f    self.col_data_
-0000c210: 656e 6420 3d20 6c65 6e28 6461 7461 7372  end = len(datasr
-0000c220: 632e 6466 2e63 6f6c 756d 6e73 290d 0a20  c.df.columns).. 
-0000c230: 2020 2020 2020 2073 7570 6572 2829 2e5f         super()._
-0000c240: 5f69 6e69 745f 5f28 6178 2c20 6461 7461  _init__(ax, data
-0000c250: 7372 632c 206c 6f64 3d46 616c 7365 290d  src, lod=False).
-0000c260: 0a0d 0a20 2020 2064 6566 2067 656e 6572  ...    def gener
-0000c270: 6174 655f 7069 6374 7572 6528 7365 6c66  ate_picture(self
-0000c280: 2c20 626f 756e 6469 6e67 5265 6374 293a  , boundingRect):
-0000c290: 0d0a 2020 2020 2020 2020 7072 6963 6573  ..        prices
-0000c2a0: 203d 2073 656c 662e 6461 7461 7372 632e   = self.datasrc.
-0000c2b0: 6466 2e63 6f6c 756d 6e73 5b73 656c 662e  df.columns[self.
-0000c2c0: 6461 7461 7372 632e 636f 6c5f 6461 7461  datasrc.col_data
-0000c2d0: 5f6f 6666 7365 743a 7365 6c66 2e63 6f6c  _offset:self.col
-0000c2e0: 5f64 6174 615f 656e 645d 0d0a 2020 2020  _data_end]..    
-0000c2f0: 2020 2020 6830 203d 2028 7072 6963 6573      h0 = (prices
-0000c300: 5b30 5d20 2d20 7072 6963 6573 5b31 5d29  [0] - prices[1])
-0000c310: 202a 2028 312d 7365 6c66 2e72 6563 745f   * (1-self.rect_
-0000c320: 7369 7a65 290d 0a20 2020 2020 2020 2068  size)..        h
-0000c330: 3120 3d20 2870 7269 6365 735b 305d 202d  1 = (prices[0] -
-0000c340: 2070 7269 6365 735b 315d 2920 2a20 2831   prices[1]) * (1
-0000c350: 2d28 312d 7365 6c66 2e72 6563 745f 7369  -(1-self.rect_si
-0000c360: 7a65 292a 3229 0d0a 2020 2020 2020 2020  ze)*2)..        
-0000c370: 7265 6374 5f73 697a 6532 203d 2030 2e35  rect_size2 = 0.5
-0000c380: 202a 2073 656c 662e 7265 6374 5f73 697a   * self.rect_siz
-0000c390: 650d 0a20 2020 2020 2020 2064 6620 3d20  e..        df = 
-0000c3a0: 7365 6c66 2e64 6174 6173 7263 2e64 662e  self.datasrc.df.
-0000c3b0: 696c 6f63 5b3a 2c20 7365 6c66 2e64 6174  iloc[:, self.dat
-0000c3c0: 6173 7263 2e63 6f6c 5f64 6174 615f 6f66  asrc.col_data_of
-0000c3d0: 6673 6574 3a73 656c 662e 636f 6c5f 6461  fset:self.col_da
-0000c3e0: 7461 5f65 6e64 5d0d 0a20 2020 2020 2020  ta_end]..       
-0000c3f0: 2076 616c 7565 7320 3d20 6466 2e76 616c   values = df.val
-0000c400: 7565 730d 0a20 2020 2020 2020 2023 206e  ues..        # n
-0000c410: 6f72 6d61 6c69 7a65 0d0a 2020 2020 2020  ormalize..      
-0000c420: 2020 7661 6c75 6573 202d 3d20 6e70 2e6e    values -= np.n
-0000c430: 616e 6d69 6e28 7661 6c75 6573 290d 0a20  anmin(values).. 
-0000c440: 2020 2020 2020 2076 616c 7565 7320 3d20         values = 
-0000c450: 7661 6c75 6573 202f 2028 6e70 2e6e 616e  values / (np.nan
-0000c460: 6d61 7828 7661 6c75 6573 2920 2f20 2831  max(values) / (1
-0000c470: 2b73 656c 662e 7768 6974 656f 7574 2929  +self.whiteout))
-0000c480: 2023 206f 7665 7273 686f 6f74 2066 6f72   # overshoot for
-0000c490: 2063 6f6c 6f72 696e 670d 0a20 2020 2020   coloring..     
-0000c4a0: 2020 206c 696d 203d 2073 656c 662e 6669     lim = self.fi
-0000c4b0: 6c74 6572 5f6c 696d 6974 202a 2028 312b  lter_limit * (1+
-0000c4c0: 7365 6c66 2e77 6869 7465 6f75 7429 0d0a  self.whiteout)..
-0000c4d0: 2020 2020 2020 2020 7020 3d20 7365 6c66          p = self
-0000c4e0: 2e70 6169 6e74 6572 0d0a 2020 2020 2020  .painter..      
-0000c4f0: 2020 666f 7220 742c 726f 7720 696e 2065    for t,row in e
-0000c500: 6e75 6d65 7261 7465 2876 616c 7565 7329  numerate(values)
-0000c510: 3a0d 0a20 2020 2020 2020 2020 2020 2066  :..            f
-0000c520: 6f72 2063 692c 7072 6963 6520 696e 2065  or ci,price in e
-0000c530: 6e75 6d65 7261 7465 2870 7269 6365 7329  numerate(prices)
-0000c540: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-0000c550: 2020 2076 203d 2072 6f77 5b63 695d 0d0a     v = row[ci]..
-0000c560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c570: 6966 2076 203e 3d20 6c69 6d3a 0d0a 2020  if v >= lim:..  
-0000c580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c590: 2020 7620 3d20 3120 2d20 7365 6c66 2e63    v = 1 - self.c
-0000c5a0: 6f6c 6375 7276 6528 3120 2d20 2876 2d6c  olcurve(1 - (v-l
-0000c5b0: 696d 292f 2831 2d6c 696d 2929 0d0a 2020  im)/(1-lim))..  
-0000c5c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c5d0: 2020 636f 6c6f 7220 3d20 7365 6c66 2e63    color = self.c
-0000c5e0: 6f6c 6d61 702e 6d61 7028 762c 206d 6f64  olmap.map(v, mod
-0000c5f0: 653d 2771 636f 6c6f 7227 290d 0a20 2020  e='qcolor')..   
-0000c600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c610: 2070 2e66 696c 6c52 6563 7428 5174 436f   p.fillRect(QtCo
-0000c620: 7265 2e51 5265 6374 4628 742d 7265 6374  re.QRectF(t-rect
-0000c630: 5f73 697a 6532 2c20 7365 6c66 2e61 782e  _size2, self.ax.
-0000c640: 7662 2e79 7363 616c 652e 696e 7678 666f  vb.yscale.invxfo
-0000c650: 726d 2870 7269 6365 2b68 3029 2c20 7365  rm(price+h0), se
-0000c660: 6c66 2e72 6563 745f 7369 7a65 2c20 7365  lf.rect_size, se
-0000c670: 6c66 2e61 782e 7662 2e79 7363 616c 652e  lf.ax.vb.yscale.
-0000c680: 696e 7678 666f 726d 2868 3129 292c 2063  invxform(h1)), c
-0000c690: 6f6c 6f72 290d 0a0d 0a0d 0a0d 0a63 6c61  olor)........cla
-0000c6a0: 7373 2048 6f72 697a 6f6e 7461 6c54 696d  ss HorizontalTim
-0000c6b0: 6556 6f6c 756d 6549 7465 6d28 4361 6e64  eVolumeItem(Cand
-0000c6c0: 6c65 7374 6963 6b49 7465 6d29 3a0d 0a20  lestickItem):.. 
-0000c6d0: 2020 2064 6566 205f 5f69 6e69 745f 5f28     def __init__(
-0000c6e0: 7365 6c66 2c20 6178 2c20 6461 7461 7372  self, ax, datasr
-0000c6f0: 632c 2063 616e 646c 655f 7769 6474 683d  c, candle_width=
-0000c700: 302e 382c 2064 7261 775f 7661 3d30 2e30  0.8, draw_va=0.0
-0000c710: 2c20 6472 6177 5f62 6f64 793d 302e 342c  , draw_body=0.4,
-0000c720: 2064 7261 775f 706f 633d 302e 302c 2063   draw_poc=0.0, c
-0000c730: 6f6c 6f72 6675 6e63 3d4e 6f6e 6529 3a0d  olorfunc=None):.
-0000c740: 0a20 2020 2020 2020 2027 2727 4120 6e65  .        '''A ne
-0000c750: 6761 7469 7665 2064 7261 775f 626f 6479  gative draw_body
-0000c760: 2064 6f65 7320 6e6f 7420 6d65 616e 2074   does not mean t
-0000c770: 6861 7420 7468 6520 6361 6e64 6c65 2069  hat the candle i
-0000c780: 7320 6472 6177 6e20 696e 2074 6865 206f  s drawn in the o
-0000c790: 7070 6f73 6974 6520 6469 7265 6374 696f  pposite directio
-0000c7a0: 6e20 2875 7365 206e 6567 6174 6976 6520  n (use negative 
-0000c7b0: 766f 6c75 6d65 2066 6f72 2074 6861 7429  volume for that)
-0000c7c0: 2c0d 0a20 2020 2020 2020 2020 2020 6275  ,..           bu
-0000c7d0: 7420 696e 7374 6561 6420 7468 6174 2073  t instead that s
-0000c7e0: 6372 6565 6e20 7363 616c 6520 7769 6c6c  creen scale will
-0000c7f0: 2062 6520 7573 6564 2069 6e73 7465 6164   be used instead
-0000c800: 206f 6620 696e 7465 7276 616c 2d72 656c   of interval-rel
-0000c810: 6174 6976 6520 7363 616c 652e 2727 270d  ative scale.'''.
-0000c820: 0a20 2020 2020 2020 2073 656c 662e 6472  .        self.dr
-0000c830: 6177 5f76 6120 3d20 6472 6177 5f76 610d  aw_va = draw_va.
-0000c840: 0a20 2020 2020 2020 2073 656c 662e 6472  .        self.dr
-0000c850: 6177 5f70 6f63 203d 2064 7261 775f 706f  aw_poc = draw_po
-0000c860: 630d 0a20 2020 2020 2020 2023 2320 7365  c..        ## se
-0000c870: 6c66 2e63 6f6c 5f64 6174 615f 656e 6420  lf.col_data_end 
-0000c880: 3d20 6c65 6e28 6461 7461 7372 632e 6466  = len(datasrc.df
-0000c890: 2e63 6f6c 756d 6e73 290d 0a20 2020 2020  .columns)..     
-0000c8a0: 2020 2063 6f6c 6f72 6675 6e63 203d 2063     colorfunc = c
-0000c8b0: 6f6c 6f72 6675 6e63 206f 7220 686f 7269  olorfunc or hori
-0000c8c0: 7a76 6f6c 5f63 6f6c 6f72 6669 6c74 6572  zvol_colorfilter
-0000c8d0: 2829 2023 2072 6573 6f6c 7665 2066 756e  () # resolve fun
-0000c8e0: 6374 696f 6e20 6c6f 7765 7220 646f 776e  ction lower down
-0000c8f0: 2069 6e20 736f 7572 6365 2063 6f64 650d   in source code.
-0000c900: 0a20 2020 2020 2020 2073 7570 6572 2829  .        super()
-0000c910: 2e5f 5f69 6e69 745f 5f28 6178 2c20 6461  .__init__(ax, da
-0000c920: 7461 7372 632c 2064 7261 775f 7368 6164  tasrc, draw_shad
-0000c930: 6f77 3d46 616c 7365 2c20 6361 6e64 6c65  ow=False, candle
-0000c940: 5f77 6964 7468 3d63 616e 646c 655f 7769  _width=candle_wi
-0000c950: 6474 682c 2064 7261 775f 626f 6479 3d64  dth, draw_body=d
-0000c960: 7261 775f 626f 6479 2c20 636f 6c6f 7266  raw_body, colorf
-0000c970: 756e 633d 636f 6c6f 7266 756e 6329 0d0a  unc=colorfunc)..
-0000c980: 2020 2020 2020 2020 7365 6c66 2e6c 6f64          self.lod
-0000c990: 203d 2046 616c 7365 0d0a 2020 2020 2020   = False..      
-0000c9a0: 2020 7365 6c66 2e63 6f6c 6f72 732e 7570    self.colors.up
-0000c9b0: 6461 7465 2864 6963 7428 6e65 7574 7261  date(dict(neutra
-0000c9c0: 6c5f 7368 6164 6f77 2020 3d20 766f 6c75  l_shadow  = volu
-0000c9d0: 6d65 5f6e 6575 7472 616c 5f63 6f6c 6f72  me_neutral_color
-0000c9e0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-0000c9f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ca00: 2020 206e 6575 7472 616c 5f66 7261 6d65     neutral_frame
-0000ca10: 2020 203d 2076 6f6c 756d 655f 6e65 7574     = volume_neut
-0000ca20: 7261 6c5f 636f 6c6f 722c 0d0a 2020 2020  ral_color,..    
-0000ca30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ca40: 2020 2020 2020 2020 2020 2020 6e65 7574              neut
-0000ca50: 7261 6c5f 626f 6479 2020 2020 3d20 766f  ral_body    = vo
-0000ca60: 6c75 6d65 5f6e 6575 7472 616c 5f63 6f6c  lume_neutral_col
-0000ca70: 6f72 2c0d 0a20 2020 2020 2020 2020 2020  or,..           
-0000ca80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ca90: 2020 2020 2062 756c 6c5f 626f 6479 2020       bull_body  
-0000caa0: 2020 2020 203d 2063 616e 646c 655f 6275       = candle_bu
-0000cab0: 6c6c 5f63 6f6c 6f72 2929 0d0a 0d0a 2020  ll_color))....  
-0000cac0: 2020 6465 6620 6765 6e65 7261 7465 5f70    def generate_p
-0000cad0: 6963 7475 7265 2873 656c 662c 2062 6f75  icture(self, bou
-0000cae0: 6e64 696e 6752 6563 7429 3a0d 0a20 2020  ndingRect):..   
-0000caf0: 2020 2020 2074 696d 6573 203d 2073 656c       times = sel
-0000cb00: 662e 6461 7461 7372 632e 6466 2e69 6c6f  f.datasrc.df.ilo
-0000cb10: 635b 3a2c 2030 5d0d 0a20 2020 2020 2020  c[:, 0]..       
-0000cb20: 2076 616c 7320 3d20 7365 6c66 2e64 6174   vals = self.dat
-0000cb30: 6173 7263 2e64 662e 7661 6c75 6573 0d0a  asrc.df.values..
-0000cb40: 2020 2020 2020 2020 7072 6963 6573 203d          prices =
-0000cb50: 2076 616c 735b 3a2c 2073 656c 662e 6461   vals[:, self.da
-0000cb60: 7461 7372 632e 636f 6c5f 6461 7461 5f6f  tasrc.col_data_o
-0000cb70: 6666 7365 743a 3a32 5d0d 0a20 2020 2020  ffset::2]..     
-0000cb80: 2020 2076 6f6c 756d 6573 203d 2076 616c     volumes = val
-0000cb90: 735b 3a2c 2073 656c 662e 6461 7461 7372  s[:, self.datasr
-0000cba0: 632e 636f 6c5f 6461 7461 5f6f 6666 7365  c.col_data_offse
-0000cbb0: 742b 313a 3a32 5d2e 540d 0a20 2020 2020  t+1::2].T..     
-0000cbc0: 2020 2023 206e 6f72 6d61 6c69 7a65 0d0a     # normalize..
-0000cbd0: 2020 2020 2020 2020 7472 793a 0d0a 2020          try:..  
-0000cbe0: 2020 2020 2020 2020 2020 6620 3d20 7365            f = se
-0000cbf0: 6c66 2e64 6174 6173 7263 2e70 6572 696f  lf.datasrc.perio
-0000cc00: 645f 6e73 202f 205f 6765 745f 6461 7461  d_ns / _get_data
-0000cc10: 7372 6328 7365 6c66 2e61 7829 2e70 6572  src(self.ax).per
-0000cc20: 696f 645f 6e73 0d0a 2020 2020 2020 2020  iod_ns..        
-0000cc30: 2020 2020 7469 6d65 7320 3d20 5f70 6474      times = _pdt
-0000cc40: 696d 6532 696e 6465 7828 7365 6c66 2e61  ime2index(self.a
-0000cc50: 782c 2074 696d 6573 2c20 7265 7175 6972  x, times, requir
-0000cc60: 655f 7469 6d65 3d54 7275 6529 0d0a 2020  e_time=True)..  
-0000cc70: 2020 2020 2020 6578 6365 7074 2041 7373        except Ass
-0000cc80: 6572 7469 6f6e 4572 726f 723a 0d0a 2020  ertionError:..  
-0000cc90: 2020 2020 2020 2020 2020 6620 3d20 310d            f = 1.
-0000cca0: 0a20 2020 2020 2020 2064 7261 775f 626f  .        draw_bo
-0000ccb0: 6479 203d 2073 656c 662e 6472 6177 5f62  dy = self.draw_b
-0000ccc0: 6f64 790d 0a20 2020 2020 2020 2069 6620  ody..        if 
-0000ccd0: 6472 6177 5f62 6f64 7920 3c20 303a 0d0a  draw_body < 0:..
-0000cce0: 2020 2020 2020 2020 2020 2020 6620 2a3d              f *=
-0000ccf0: 202d 6472 6177 5f62 6f64 7920 2a20 7365   -draw_body * se
-0000cd00: 6c66 2e61 782e 7662 2e74 6172 6765 7452  lf.ax.vb.targetR
-0000cd10: 6563 7428 292e 7769 6474 6828 290d 0a20  ect().width().. 
-0000cd20: 2020 2020 2020 2020 2020 2064 7261 775f             draw_
-0000cd30: 626f 6479 203d 2031 0d0a 2020 2020 2020  body = 1..      
-0000cd40: 2020 6269 6e63 203d 206c 656e 2876 6f6c    binc = len(vol
-0000cd50: 756d 6573 290d 0a20 2020 2020 2020 2069  umes)..        i
-0000cd60: 6620 6e6f 7420 6269 6e63 3a0d 0a20 2020  f not binc:..   
-0000cd70: 2020 2020 2020 2020 2072 6574 7572 6e0d           return.
-0000cd80: 0a20 2020 2020 2020 2064 6976 766f 6c20  .        divvol 
-0000cd90: 3d20 6e70 2e6e 616e 6d61 7828 6e70 2e61  = np.nanmax(np.a
-0000cda0: 6273 2876 6f6c 756d 6573 292c 2061 7869  bs(volumes), axi
-0000cdb0: 733d 3029 0d0a 2020 2020 2020 2020 6469  s=0)..        di
-0000cdc0: 7676 6f6c 5b64 6976 766f 6c3d 3d30 5d20  vvol[divvol==0] 
-0000cdd0: 3d20 310d 0a20 2020 2020 2020 2076 6f6c  = 1..        vol
-0000cde0: 756d 6573 203d 2028 766f 6c75 6d65 7320  umes = (volumes 
-0000cdf0: 2a20 6620 2f20 6469 7676 6f6c 292e 540d  * f / divvol).T.
-0000ce00: 0a20 2020 2020 2020 2070 203d 2073 656c  .        p = sel
-0000ce10: 662e 7061 696e 7465 720d 0a20 2020 2020  f.painter..     
-0000ce20: 2020 2068 203d 2031 652d 3130 0d0a 2020     h = 1e-10..  
-0000ce30: 2020 2020 2020 666f 7220 6920 696e 2072        for i in r
-0000ce40: 616e 6765 286c 656e 2870 7269 6365 7329  ange(len(prices)
-0000ce50: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-0000ce60: 7072 6372 203d 2070 7269 6365 735b 695d  prcr = prices[i]
-0000ce70: 0d0a 2020 2020 2020 2020 2020 2020 7072  ..            pr
-0000ce80: 7620 3d20 7072 6372 5b7e 6e70 2e69 736e  v = prcr[~np.isn
-0000ce90: 616e 2870 7263 7229 5d0d 0a20 2020 2020  an(prcr)]..     
-0000cea0: 2020 2020 2020 2069 6620 6c65 6e28 7072         if len(pr
-0000ceb0: 7629 203e 2031 3a0d 0a20 2020 2020 2020  v) > 1:..       
-0000cec0: 2020 2020 2020 2020 2068 203d 206e 702e           h = np.
-0000ced0: 6469 6666 2870 7276 292e 6d69 6e28 290d  diff(prv).min().
-0000cee0: 0a20 2020 2020 2020 2020 2020 2074 203d  .            t =
-0000cef0: 2074 696d 6573 5b69 5d0d 0a20 2020 2020   times[i]..     
-0000cf00: 2020 2020 2020 2076 6f6c 7220 3d20 6e70         volr = np
-0000cf10: 2e6e 616e 5f74 6f5f 6e75 6d28 766f 6c75  .nan_to_num(volu
-0000cf20: 6d65 735b 695d 290d 0a0d 0a20 2020 2020  mes[i])....     
-0000cf30: 2020 2020 2020 2023 2063 616c 6320 706f         # calc po
-0000cf40: 630d 0a20 2020 2020 2020 2020 2020 2070  c..            p
-0000cf50: 6f63 6964 7820 3d20 6e70 2e6e 616e 6172  ocidx = np.nanar
-0000cf60: 676d 6178 2876 6f6c 7229 0d0a 0d0a 2020  gmax(volr)....  
-0000cf70: 2020 2020 2020 2020 2020 2320 6472 6177            # draw
-0000cf80: 2076 616c 7565 2061 7265 610d 0a20 2020   value area..   
-0000cf90: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
-0000cfa0: 2e64 7261 775f 7661 3a0d 0a20 2020 2020  .draw_va:..     
-0000cfb0: 2020 2020 2020 2020 2020 2076 6f6c 7273             volrs
-0000cfc0: 203d 2076 6f6c 7220 2f20 6e70 2e6e 616e   = volr / np.nan
-0000cfd0: 7375 6d28 766f 6c72 290d 0a20 2020 2020  sum(volr)..     
-0000cfe0: 2020 2020 2020 2020 2020 2076 203d 2076             v = v
-0000cff0: 6f6c 7273 5b70 6f63 6964 785d 0d0a 2020  olrs[pocidx]..  
-0000d000: 2020 2020 2020 2020 2020 2020 2020 6120                a 
-0000d010: 3d20 6220 3d20 706f 6369 6478 0d0a 2020  = b = pocidx..  
-0000d020: 2020 2020 2020 2020 2020 2020 2020 7768                wh
-0000d030: 696c 6520 613e 3d30 206f 7220 623c 6269  ile a>=0 or b<bi
-0000d040: 6e63 3a0d 0a20 2020 2020 2020 2020 2020  nc:..           
-0000d050: 2020 2020 2020 2020 2069 6620 7620 3e3d           if v >=
-0000d060: 2073 656c 662e 6472 6177 5f76 613a 0d0a   self.draw_va:..
-0000d070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d080: 2020 2020 2020 2020 6272 6561 6b0d 0a20          break.. 
-0000d090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d0a0: 2020 2061 6120 3d20 6120 2d20 310d 0a20     aa = a - 1.. 
-0000d0b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d0c0: 2020 2062 6220 3d20 6220 2b20 310d 0a20     bb = b + 1.. 
-0000d0d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d0e0: 2020 2076 6120 3d20 766f 6c72 735b 6161     va = volrs[aa
-0000d0f0: 5d20 6966 2061 613e 3d30 2065 6c73 6520  ] if aa>=0 else 
-0000d100: 300d 0a20 2020 2020 2020 2020 2020 2020  0..             
-0000d110: 2020 2020 2020 2076 6220 3d20 766f 6c72         vb = volr
-0000d120: 735b 6262 5d20 6966 2062 623c 6269 6e63  s[bb] if bb<binc
-0000d130: 2065 6c73 6520 300d 0a20 2020 2020 2020   else 0..       
-0000d140: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0000d150: 7661 203e 3d20 7662 3a20 2320 4e4f 5445  va >= vb: # NOTE
-0000d160: 2062 6f74 6820 3d3d 2069 7320 616c 736f   both == is also
-0000d170: 206f 6b0d 0a20 2020 2020 2020 2020 2020   ok..           
-0000d180: 2020 2020 2020 2020 2020 2020 2061 203d               a =
-0000d190: 206d 6178 2830 2c20 6161 290d 0a20 2020   max(0, aa)..   
-0000d1a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d1b0: 2020 2020 2076 202b 3d20 7661 0d0a 2020       v += va..  
-0000d1c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d1d0: 2020 6966 2076 6120 3c3d 2076 623a 2023    if va <= vb: #
-0000d1e0: 204e 4f54 4520 626f 7468 203d 3d20 6973   NOTE both == is
-0000d1f0: 2061 6c73 6f20 6f6b 0d0a 2020 2020 2020   also ok..      
-0000d200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d210: 2020 6220 3d20 6d69 6e28 6269 6e63 2d31    b = min(binc-1
-0000d220: 2c20 6262 290d 0a20 2020 2020 2020 2020  , bb)..         
-0000d230: 2020 2020 2020 2020 2020 2020 2020 2076                 v
-0000d240: 202b 3d20 7662 0d0a 2020 2020 2020 2020   += vb..        
-0000d250: 2020 2020 2020 2020 636f 6c6f 7220 3d20          color = 
-0000d260: 7067 2e6d 6b43 6f6c 6f72 2862 616e 645f  pg.mkColor(band_
-0000d270: 636f 6c6f 7229 0d0a 2020 2020 2020 2020  color)..        
-0000d280: 2020 2020 2020 2020 702e 6669 6c6c 5265          p.fillRe
-0000d290: 6374 2851 7443 6f72 652e 5152 6563 7446  ct(QtCore.QRectF
-0000d2a0: 2874 2c20 7072 6372 5b61 5d2c 2066 2c20  (t, prcr[a], f, 
-0000d2b0: 7072 6372 5b62 5d2d 7072 6372 5b61 5d2b  prcr[b]-prcr[a]+
-0000d2c0: 6829 2c20 636f 6c6f 7229 0d0a 0d0a 2020  h), color)....  
-0000d2d0: 2020 2020 2020 2020 2020 2320 6472 6177            # draw
-0000d2e0: 2068 6f72 697a 6f6e 7461 6c20 6261 7273   horizontal bars
-0000d2f0: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-0000d300: 2064 7261 775f 626f 6479 3a0d 0a20 2020   draw_body:..   
-0000d310: 2020 2020 2020 2020 2020 2020 2068 3020               h0 
-0000d320: 3d20 6820 2a20 2831 2d73 656c 662e 6361  = h * (1-self.ca
-0000d330: 6e64 6c65 5f77 6964 7468 292f 320d 0a20  ndle_width)/2.. 
-0000d340: 2020 2020 2020 2020 2020 2020 2020 2068                 h
-0000d350: 3120 3d20 6820 2a20 7365 6c66 2e63 616e  1 = h * self.can
-0000d360: 646c 655f 7769 6474 680d 0a20 2020 2020  dle_width..     
-0000d370: 2020 2020 2020 2020 2020 2066 6f72 2073             for s
-0000d380: 6861 646f 772c 6672 616d 652c 626f 6479  hadow,frame,body
-0000d390: 2c64 6174 6120 696e 2073 656c 662e 636f  ,data in self.co
-0000d3a0: 6c6f 7266 756e 6328 7365 6c66 2c20 7365  lorfunc(self, se
-0000d3b0: 6c66 2e64 6174 6173 7263 2c20 6e70 2e61  lf.datasrc, np.a
-0000d3c0: 7272 6179 285b 7072 6372 2c20 766f 6c72  rray([prcr, volr
-0000d3d0: 5d29 293a 0d0a 2020 2020 2020 2020 2020  ])):..          
-0000d3e0: 2020 2020 2020 2020 2020 702e 7365 7450            p.setP
-0000d3f0: 656e 2870 672e 6d6b 5065 6e28 6672 616d  en(pg.mkPen(fram
-0000d400: 6529 290d 0a20 2020 2020 2020 2020 2020  e))..           
-0000d410: 2020 2020 2020 2020 2070 2e73 6574 4272           p.setBr
-0000d420: 7573 6828 7067 2e6d 6b42 7275 7368 2862  ush(pg.mkBrush(b
-0000d430: 6f64 7929 290d 0a20 2020 2020 2020 2020  ody))..         
-0000d440: 2020 2020 2020 2020 2020 2070 7263 725f             prcr_
-0000d450: 2c76 6f6c 725f 203d 2064 6174 610d 0a20  ,volr_ = data.. 
-0000d460: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d470: 2020 2066 6f72 2077 2c79 2069 6e20 7a69     for w,y in zi
-0000d480: 7028 766f 6c72 5f2c 2070 7263 725f 293a  p(volr_, prcr_):
-0000d490: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000d4a0: 2020 2020 2020 2020 2020 6966 2061 6273            if abs
-0000d4b0: 2877 2920 3e20 3165 2d31 353a 0d0a 2020  (w) > 1e-15:..  
-0000d4c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d4d0: 2020 2020 2020 2020 2020 702e 6472 6177            p.draw
-0000d4e0: 5265 6374 2851 7443 6f72 652e 5152 6563  Rect(QtCore.QRec
-0000d4f0: 7446 2874 2c20 792b 6830 2c20 772a 6472  tF(t, y+h0, w*dr
-0000d500: 6177 5f62 6f64 792c 2068 3129 290d 0a0d  aw_body, h1))...
-0000d510: 0a20 2020 2020 2020 2020 2020 2023 2064  .            # d
-0000d520: 7261 7720 706f 6320 6c69 6e65 0d0a 2020  raw poc line..  
-0000d530: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
-0000d540: 662e 6472 6177 5f70 6f63 3a0d 0a20 2020  f.draw_poc:..   
-0000d550: 2020 2020 2020 2020 2020 2020 2079 203d               y =
-0000d560: 2070 7263 725b 706f 6369 6478 5d20 2b20   prcr[pocidx] + 
-0000d570: 6820 2f20 320d 0a20 2020 2020 2020 2020  h / 2..         
-0000d580: 2020 2020 2020 2070 2e73 6574 5065 6e28         p.setPen(
-0000d590: 7067 2e6d 6b50 656e 2870 6f63 5f63 6f6c  pg.mkPen(poc_col
-0000d5a0: 6f72 2929 0d0a 2020 2020 2020 2020 2020  or))..          
-0000d5b0: 2020 2020 2020 702e 6472 6177 4c69 6e65        p.drawLine
-0000d5c0: 2851 7443 6f72 652e 5150 6f69 6e74 4628  (QtCore.QPointF(
-0000d5d0: 742c 2079 292c 2051 7443 6f72 652e 5150  t, y), QtCore.QP
-0000d5e0: 6f69 6e74 4628 742b 662a 7365 6c66 2e64  ointF(t+f*self.d
-0000d5f0: 7261 775f 706f 632c 2079 2929 0d0a 0d0a  raw_poc, y))....
-0000d600: 0d0a 0d0a 636c 6173 7320 5363 6174 7465  ....class Scatte
-0000d610: 724c 6162 656c 4974 656d 2846 696e 506c  rLabelItem(FinPl
-0000d620: 6f74 4974 656d 293a 0d0a 2020 2020 6465  otItem):..    de
-0000d630: 6620 5f5f 696e 6974 5f5f 2873 656c 662c  f __init__(self,
-0000d640: 2061 782c 2064 6174 6173 7263 2c20 636f   ax, datasrc, co
-0000d650: 6c6f 722c 2061 6e63 686f 7229 3a0d 0a20  lor, anchor):.. 
-0000d660: 2020 2020 2020 2073 656c 662e 636f 6c6f         self.colo
-0000d670: 7220 3d20 636f 6c6f 720d 0a20 2020 2020  r = color..     
-0000d680: 2020 2073 656c 662e 7465 7874 5f69 7465     self.text_ite
-0000d690: 6d73 203d 207b 7d0d 0a20 2020 2020 2020  ms = {}..       
-0000d6a0: 2073 656c 662e 616e 6368 6f72 203d 2061   self.anchor = a
-0000d6b0: 6e63 686f 720d 0a20 2020 2020 2020 2073  nchor..        s
-0000d6c0: 656c 662e 7368 6f77 203d 2046 616c 7365  elf.show = False
-0000d6d0: 0d0a 2020 2020 2020 2020 7375 7065 7228  ..        super(
-0000d6e0: 292e 5f5f 696e 6974 5f5f 2861 782c 2064  ).__init__(ax, d
-0000d6f0: 6174 6173 7263 2c20 6c6f 643d 5472 7565  atasrc, lod=True
-0000d700: 290d 0a0d 0a20 2020 2064 6566 2067 656e  )....    def gen
-0000d710: 6572 6174 655f 7069 6374 7572 6528 7365  erate_picture(se
-0000d720: 6c66 2c20 626f 756e 6469 6e67 5f72 6563  lf, bounding_rec
-0000d730: 7429 3a0d 0a20 2020 2020 2020 2072 6f77  t):..        row
-0000d740: 7320 3d20 7365 6c66 2e67 6574 726f 7773  s = self.getrows
-0000d750: 2862 6f75 6e64 696e 675f 7265 6374 290d  (bounding_rect).
-0000d760: 0a20 2020 2020 2020 2069 6620 6c65 6e28  .        if len(
-0000d770: 726f 7773 2920 3e20 6c6f 645f 6c61 6265  rows) > lod_labe
-0000d780: 6c73 3a20 2320 646f 6e27 7420 6576 656e  ls: # don't even
-0000d790: 2067 656e 6572 6174 6520 7768 656e 2074   generate when t
-0000d7a0: 6865 7265 2773 2074 6f6f 206d 616e 7920  here's too many 
-0000d7b0: 6f66 2074 6865 6d0d 0a20 2020 2020 2020  of them..       
-0000d7c0: 2020 2020 2073 656c 662e 636c 6561 725f       self.clear_
-0000d7d0: 6974 656d 7328 6c69 7374 2873 656c 662e  items(list(self.
-0000d7e0: 7465 7874 5f69 7465 6d73 2e6b 6579 7328  text_items.keys(
-0000d7f0: 2929 290d 0a20 2020 2020 2020 2020 2020  )))..           
-0000d800: 2072 6574 7572 6e0d 0a20 2020 2020 2020   return..       
-0000d810: 2064 726f 7073 203d 2073 6574 2873 656c   drops = set(sel
-0000d820: 662e 7465 7874 5f69 7465 6d73 2e6b 6579  f.text_items.key
-0000d830: 7328 2929 0d0a 2020 2020 2020 2020 6372  s())..        cr
-0000d840: 6561 7465 6420 3d20 300d 0a20 2020 2020  eated = 0..     
-0000d850: 2020 2066 6f72 2078 2c74 2c79 2c74 7874     for x,t,y,txt
-0000d860: 2069 6e20 726f 7773 3a0d 0a20 2020 2020   in rows:..     
-0000d870: 2020 2020 2020 2074 7874 203d 2073 7472         txt = str
-0000d880: 2874 7874 290d 0a20 2020 2020 2020 2020  (txt)..         
-0000d890: 2020 2069 7368 746d 6c20 3d20 273c 2720     ishtml = '<' 
-0000d8a0: 696e 2074 7874 2061 6e64 2027 3e27 2069  in txt and '>' i
-0000d8b0: 6e20 7478 740d 0a20 2020 2020 2020 2020  n txt..         
-0000d8c0: 2020 206b 6579 203d 2027 2573 3a25 2e38     key = '%s:%.8
-0000d8d0: 6627 2025 2028 742c 2079 290d 0a20 2020  f' % (t, y)..   
-0000d8e0: 2020 2020 2020 2020 2069 6620 6b65 7920           if key 
-0000d8f0: 696e 2073 656c 662e 7465 7874 5f69 7465  in self.text_ite
-0000d900: 6d73 3a0d 0a20 2020 2020 2020 2020 2020  ms:..           
-0000d910: 2020 2020 2069 7465 6d20 3d20 7365 6c66       item = self
-0000d920: 2e74 6578 745f 6974 656d 735b 6b65 795d  .text_items[key]
-0000d930: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000d940: 2020 2869 7465 6d2e 7365 7448 746d 6c20    (item.setHtml 
-0000d950: 6966 2069 7368 746d 6c20 656c 7365 2069  if ishtml else i
-0000d960: 7465 6d2e 7365 7454 6578 7429 2874 7874  tem.setText)(txt
-0000d970: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-0000d980: 2020 2069 7465 6d2e 7365 7450 6f73 2878     item.setPos(x
-0000d990: 2c20 7929 0d0a 2020 2020 2020 2020 2020  , y)..          
-0000d9a0: 2020 2020 2020 6472 6f70 732e 7265 6d6f        drops.remo
-0000d9b0: 7665 286b 6579 290d 0a20 2020 2020 2020  ve(key)..       
-0000d9c0: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
-0000d9d0: 2020 2020 2020 2020 2020 2020 6b77 7320              kws 
-0000d9e0: 3d20 7b27 6874 6d6c 273a 7478 747d 2069  = {'html':txt} i
-0000d9f0: 6620 6973 6874 6d6c 2065 6c73 6520 7b27  f ishtml else {'
-0000da00: 7465 7874 273a 7478 747d 0d0a 2020 2020  text':txt}..    
-0000da10: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0000da20: 2e74 6578 745f 6974 656d 735b 6b65 795d  .text_items[key]
-0000da30: 203d 2069 7465 6d20 3d20 7067 2e54 6578   = item = pg.Tex
-0000da40: 7449 7465 6d28 636f 6c6f 723d 7365 6c66  tItem(color=self
-0000da50: 2e63 6f6c 6f72 2c20 616e 6368 6f72 3d73  .color, anchor=s
-0000da60: 656c 662e 616e 6368 6f72 2c20 2a2a 6b77  elf.anchor, **kw
-0000da70: 7329 0d0a 2020 2020 2020 2020 2020 2020  s)..            
-0000da80: 2020 2020 6974 656d 2e73 6574 506f 7328      item.setPos(
-0000da90: 782c 2079 290d 0a20 2020 2020 2020 2020  x, y)..         
-0000daa0: 2020 2020 2020 2069 7465 6d2e 7365 7450         item.setP
-0000dab0: 6172 656e 7449 7465 6d28 7365 6c66 290d  arentItem(self).
-0000dac0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000dad0: 2063 7265 6174 6564 202b 3d20 310d 0a20   created += 1.. 
-0000dae0: 2020 2020 2020 2069 6620 6372 6561 7465         if create
-0000daf0: 6420 3e20 3020 6f72 2073 656c 662e 6469  d > 0 or self.di
-0000db00: 7274 793a 2023 206f 6e6c 7920 7265 6475  rty: # only redu
-0000db10: 6365 2063 6163 6865 2069 6620 7765 2776  ce cache if we'v
-0000db20: 6520 6164 6465 6420 736f 6d65 206e 6577  e added some new
-0000db30: 206f 7220 7570 6461 7465 640d 0a20 2020   or updated..   
-0000db40: 2020 2020 2020 2020 2073 656c 662e 636c           self.cl
-0000db50: 6561 725f 6974 656d 7328 6472 6f70 7329  ear_items(drops)
-0000db60: 0d0a 0d0a 2020 2020 6465 6620 636c 6561  ....    def clea
-0000db70: 725f 6974 656d 7328 7365 6c66 2c20 6472  r_items(self, dr
-0000db80: 6f70 5f6b 6579 7329 3a0d 0a20 2020 2020  op_keys):..     
-0000db90: 2020 2066 6f72 206b 6579 2069 6e20 6472     for key in dr
-0000dba0: 6f70 5f6b 6579 733a 0d0a 2020 2020 2020  op_keys:..      
-0000dbb0: 2020 2020 2020 6974 656d 203d 2073 656c        item = sel
-0000dbc0: 662e 7465 7874 5f69 7465 6d73 5b6b 6579  f.text_items[key
-0000dbd0: 5d0d 0a20 2020 2020 2020 2020 2020 2069  ]..            i
-0000dbe0: 7465 6d2e 7363 656e 6528 292e 7265 6d6f  tem.scene().remo
-0000dbf0: 7665 4974 656d 2869 7465 6d29 0d0a 2020  veItem(item)..  
-0000dc00: 2020 2020 2020 2020 2020 6465 6c20 7365            del se
-0000dc10: 6c66 2e74 6578 745f 6974 656d 735b 6b65  lf.text_items[ke
-0000dc20: 795d 0d0a 0d0a 2020 2020 6465 6620 6765  y]....    def ge
-0000dc30: 7472 6f77 7328 7365 6c66 2c20 626f 756e  trows(self, boun
-0000dc40: 6469 6e67 5f72 6563 7429 3a0d 0a20 2020  ding_rect):..   
-0000dc50: 2020 2020 206c 6566 742c 7269 6768 7420       left,right 
-0000dc60: 3d20 626f 756e 6469 6e67 5f72 6563 742e  = bounding_rect.
-0000dc70: 6c65 6674 2829 2c20 626f 756e 6469 6e67  left(), bounding
-0000dc80: 5f72 6563 742e 7269 6768 7428 290d 0a20  _rect.right().. 
-0000dc90: 2020 2020 2020 2064 662c 5f20 3d20 7365         df,_ = se
-0000dca0: 6c66 2e64 6174 6173 7263 2e72 6f77 7328  lf.datasrc.rows(
-0000dcb0: 332c 206c 6566 742c 2072 6967 6874 2c20  3, left, right, 
-0000dcc0: 7973 6361 6c65 3d73 656c 662e 6178 2e76  yscale=self.ax.v
-0000dcd0: 622e 7973 6361 6c65 2c20 6c6f 643d 4661  b.yscale, lod=Fa
-0000dce0: 6c73 6529 0d0a 2020 2020 2020 2020 726f  lse)..        ro
-0000dcf0: 7773 203d 2064 662e 6472 6f70 6e61 2829  ws = df.dropna()
-0000dd00: 0d0a 2020 2020 2020 2020 6964 7873 203d  ..        idxs =
-0000dd10: 2072 6f77 732e 696e 6465 780d 0a20 2020   rows.index..   
-0000dd20: 2020 2020 2072 6f77 7320 3d20 726f 7773       rows = rows
-0000dd30: 2e76 616c 7565 730d 0a20 2020 2020 2020  .values..       
-0000dd40: 2072 6f77 7320 3d20 5b28 692c 742c 792c   rows = [(i,t,y,
-0000dd50: 7478 7429 2066 6f72 2069 2c28 742c 792c  txt) for i,(t,y,
-0000dd60: 7478 7429 2069 6e20 7a69 7028 6964 7873  txt) in zip(idxs
-0000dd70: 2c20 726f 7773 2920 6966 2074 7874 5d0d  , rows) if txt].
-0000dd80: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0000dd90: 726f 7773 0d0a 0d0a 2020 2020 6465 6620  rows....    def 
-0000dda0: 626f 756e 6469 6e67 5265 6374 2873 656c  boundingRect(sel
-0000ddb0: 6629 3a0d 0a20 2020 2020 2020 2072 6574  f):..        ret
-0000ddc0: 7572 6e20 7365 6c66 2e76 6965 7752 6563  urn self.viewRec
-0000ddd0: 7428 290d 0a0d 0a0d 0a64 6566 2063 7265  t()......def cre
-0000dde0: 6174 655f 706c 6f74 2874 6974 6c65 3d27  ate_plot(title='
-0000ddf0: 4669 6e61 6e63 6520 506c 6f74 272c 2072  Finance Plot', r
-0000de00: 6f77 733d 312c 2069 6e69 745f 7a6f 6f6d  ows=1, init_zoom
-0000de10: 5f70 6572 696f 6473 3d31 6531 302c 206d  _periods=1e10, m
-0000de20: 6178 696d 697a 653d 5472 7565 2c20 7973  aximize=True, ys
-0000de30: 6361 6c65 3d27 6c69 6e65 6172 2729 3a0d  cale='linear'):.
-0000de40: 0a20 2020 2070 672e 7365 7443 6f6e 6669  .    pg.setConfi
-0000de50: 674f 7074 696f 6e73 2866 6f72 6567 726f  gOptions(foregro
-0000de60: 756e 643d 666f 7265 6772 6f75 6e64 2c20  und=foreground, 
-0000de70: 6261 636b 6772 6f75 6e64 3d62 6163 6b67  background=backg
-0000de80: 726f 756e 6429 0d0a 2020 2020 7769 6e20  round)..    win 
-0000de90: 3d20 4669 6e57 696e 646f 7728 7469 746c  = FinWindow(titl
-0000dea0: 6529 0d0a 2020 2020 2320 6e6f 726d 616c  e)..    # normal
-0000deb0: 6c79 2066 6972 7374 2067 7261 7068 2069  ly first graph i
-0000dec0: 7320 6f66 2068 6967 6865 7220 7369 676e  s of higher sign
-0000ded0: 6966 6963 616e 6365 2c20 736f 2065 6e6c  ificance, so enl
-0000dee0: 6172 6765 0d0a 2020 2020 7769 6e2e 6369  arge..    win.ci
-0000def0: 2e6c 6179 6f75 742e 7365 7452 6f77 5374  .layout.setRowSt
-0000df00: 7265 7463 6846 6163 746f 7228 302c 2074  retchFactor(0, t
-0000df10: 6f70 5f67 7261 7068 5f73 6361 6c65 290d  op_graph_scale).
-0000df20: 0a20 2020 2077 696e 2e73 686f 775f 6d61  .    win.show_ma
-0000df30: 7869 6d69 7a65 6420 3d20 6d61 7869 6d69  ximized = maximi
-0000df40: 7a65 0d0a 2020 2020 6178 3020 3d20 6178  ze..    ax0 = ax
-0000df50: 7320 3d20 6372 6561 7465 5f70 6c6f 745f  s = create_plot_
-0000df60: 7769 6467 6574 286d 6173 7465 723d 7769  widget(master=wi
-0000df70: 6e2c 2072 6f77 733d 726f 7773 2c20 696e  n, rows=rows, in
-0000df80: 6974 5f7a 6f6f 6d5f 7065 7269 6f64 733d  it_zoom_periods=
-0000df90: 696e 6974 5f7a 6f6f 6d5f 7065 7269 6f64  init_zoom_period
-0000dfa0: 732c 2079 7363 616c 653d 7973 6361 6c65  s, yscale=yscale
-0000dfb0: 290d 0a20 2020 2061 7873 203d 2061 7873  )..    axs = axs
-0000dfc0: 2069 6620 7479 7065 2861 7873 2920 696e   if type(axs) in
-0000dfd0: 2028 7475 706c 652c 6c69 7374 2920 656c   (tuple,list) el
-0000dfe0: 7365 205b 6178 735d 0d0a 2020 2020 666f  se [axs]..    fo
-0000dff0: 7220 6178 2069 6e20 6178 733a 0d0a 2020  r ax in axs:..  
-0000e000: 2020 2020 2020 7769 6e2e 6164 6449 7465        win.addIte
-0000e010: 6d28 6178 2c20 636f 6c3d 3129 0d0a 2020  m(ax, col=1)..  
-0000e020: 2020 2020 2020 7769 6e2e 6e65 7874 526f        win.nextRo
-0000e030: 7728 290d 0a20 2020 2072 6574 7572 6e20  w()..    return 
-0000e040: 6178 300d 0a0d 0a0d 0a64 6566 2063 7265  ax0......def cre
-0000e050: 6174 655f 706c 6f74 5f77 6964 6765 7428  ate_plot_widget(
-0000e060: 6d61 7374 6572 2c20 726f 7773 3d31 2c20  master, rows=1, 
-0000e070: 696e 6974 5f7a 6f6f 6d5f 7065 7269 6f64  init_zoom_period
-0000e080: 733d 3165 3130 2c20 7973 6361 6c65 3d27  s=1e10, yscale='
-0000e090: 6c69 6e65 6172 2729 3a0d 0a20 2020 2070  linear'):..    p
-0000e0a0: 672e 7365 7443 6f6e 6669 674f 7074 696f  g.setConfigOptio
-0000e0b0: 6e73 2866 6f72 6567 726f 756e 643d 666f  ns(foreground=fo
-0000e0c0: 7265 6772 6f75 6e64 2c20 6261 636b 6772  reground, backgr
-0000e0d0: 6f75 6e64 3d62 6163 6b67 726f 756e 6429  ound=background)
-0000e0e0: 0d0a 2020 2020 676c 6f62 616c 206c 6173  ..    global las
-0000e0f0: 745f 6178 0d0a 2020 2020 6966 206d 6173  t_ax..    if mas
-0000e100: 7465 7220 6e6f 7420 696e 2077 696e 646f  ter not in windo
-0000e110: 7773 3a0d 0a20 2020 2020 2020 2077 696e  ws:..        win
-0000e120: 646f 7773 2e61 7070 656e 6428 6d61 7374  dows.append(mast
-0000e130: 6572 290d 0a20 2020 2061 7873 203d 205b  er)..    axs = [
-0000e140: 5d0d 0a20 2020 2070 7265 765f 6178 203d  ]..    prev_ax =
-0000e150: 204e 6f6e 650d 0a20 2020 2066 6f72 206e   None..    for n
-0000e160: 2069 6e20 7261 6e67 6528 726f 7773 293a   in range(rows):
-0000e170: 0d0a 2020 2020 2020 2020 7973 6320 3d20  ..        ysc = 
-0000e180: 7973 6361 6c65 5b6e 5d20 6966 2074 7970  yscale[n] if typ
-0000e190: 6528 7973 6361 6c65 2920 696e 2028 6c69  e(yscale) in (li
-0000e1a0: 7374 2c74 7570 6c65 2920 656c 7365 2079  st,tuple) else y
-0000e1b0: 7363 616c 650d 0a20 2020 2020 2020 2079  scale..        y
-0000e1c0: 7363 203d 2059 5363 616c 6528 7973 632c  sc = YScale(ysc,
-0000e1d0: 2031 290d 0a20 2020 2020 2020 2076 6965   1)..        vie
-0000e1e0: 7762 6f78 203d 2046 696e 5669 6577 426f  wbox = FinViewBo
-0000e1f0: 7828 6d61 7374 6572 2c20 696e 6974 5f73  x(master, init_s
-0000e200: 7465 7073 3d69 6e69 745f 7a6f 6f6d 5f70  teps=init_zoom_p
-0000e210: 6572 696f 6473 2c20 7973 6361 6c65 3d79  eriods, yscale=y
-0000e220: 7363 2c20 765f 7a6f 6f6d 5f73 6361 6c65  sc, v_zoom_scale
-0000e230: 3d31 2d79 5f70 6164 2c20 656e 6162 6c65  =1-y_pad, enable
-0000e240: 4d65 6e75 3d46 616c 7365 290d 0a20 2020  Menu=False)..   
-0000e250: 2020 2020 2061 7820 3d20 7072 6576 5f61       ax = prev_a
-0000e260: 7820 3d20 5f61 6464 5f74 696d 6573 7461  x = _add_timesta
-0000e270: 6d70 5f70 6c6f 7428 6d61 7374 6572 3d6d  mp_plot(master=m
-0000e280: 6173 7465 722c 2070 7265 765f 6178 3d70  aster, prev_ax=p
-0000e290: 7265 765f 6178 2c20 7669 6577 626f 783d  rev_ax, viewbox=
-0000e2a0: 7669 6577 626f 782c 2069 6e64 6578 3d6e  viewbox, index=n
-0000e2b0: 2c20 7973 6361 6c65 3d79 7363 290d 0a20  , yscale=ysc).. 
-0000e2c0: 2020 2020 2020 2069 6620 6178 733a 0d0a         if axs:..
-0000e2d0: 2020 2020 2020 2020 2020 2020 6178 2e73              ax.s
-0000e2e0: 6574 584c 696e 6b28 6178 735b 305d 2e76  etXLink(axs[0].v
-0000e2f0: 6229 0d0a 2020 2020 2020 2020 656c 7365  b)..        else
-0000e300: 3a0d 0a20 2020 2020 2020 2020 2020 2076  :..            v
-0000e310: 6965 7762 6f78 2e73 6574 466f 6375 7328  iewbox.setFocus(
-0000e320: 290d 0a20 2020 2020 2020 2061 7873 202b  )..        axs +
-0000e330: 3d20 5b61 785d 0d0a 2020 2020 6966 206d  = [ax]..    if m
-0000e340: 6173 7465 7220 6e6f 7420 696e 206d 6173  aster not in mas
-0000e350: 7465 725f 6461 7461 3a0d 0a20 2020 2020  ter_data:..     
-0000e360: 2020 206d 6173 7465 725f 6461 7461 5b6d     master_data[m
-0000e370: 6173 7465 725d 203d 207b 7d0d 0a20 2020  aster] = {}..   
-0000e380: 2069 6620 6973 696e 7374 616e 6365 286d   if isinstance(m
-0000e390: 6173 7465 722c 2070 672e 4772 6170 6869  aster, pg.Graphi
-0000e3a0: 6373 4c61 796f 7574 5769 6467 6574 293a  csLayoutWidget):
-0000e3b0: 0d0a 2020 2020 2020 2020 7072 6f78 7920  ..        proxy 
-0000e3c0: 3d20 7067 2e53 6967 6e61 6c50 726f 7879  = pg.SignalProxy
-0000e3d0: 286d 6173 7465 722e 7363 656e 6528 292e  (master.scene().
-0000e3e0: 7369 674d 6f75 7365 4d6f 7665 642c 2072  sigMouseMoved, r
-0000e3f0: 6174 654c 696d 6974 3d31 3434 2c20 736c  ateLimit=144, sl
-0000e400: 6f74 3d70 6172 7469 616c 285f 6d6f 7573  ot=partial(_mous
-0000e410: 655f 6d6f 7665 642c 206d 6173 7465 722c  e_moved, master,
-0000e420: 2061 7873 5b30 5d2e 7662 2929 0d0a 2020   axs[0].vb))..  
-0000e430: 2020 2020 2020 6d61 7374 6572 5f64 6174        master_dat
-0000e440: 615b 6d61 7374 6572 5d5b 6178 735b 305d  a[master][axs[0]
-0000e450: 2e76 625d 203d 2064 6963 7428 7072 6f78  .vb] = dict(prox
-0000e460: 796d 6d3d 7072 6f78 792c 206c 6173 745f  ymm=proxy, last_
-0000e470: 6d6f 7573 655f 6576 733d 4e6f 6e65 2c20  mouse_evs=None, 
-0000e480: 6c61 7374 5f6d 6f75 7365 5f79 3d30 290d  last_mouse_y=0).
-0000e490: 0a20 2020 2020 2020 2069 6620 2764 6566  .        if 'def
-0000e4a0: 6175 6c74 2720 6e6f 7420 696e 206d 6173  ault' not in mas
-0000e4b0: 7465 725f 6461 7461 5b6d 6173 7465 725d  ter_data[master]
-0000e4c0: 3a0d 0a20 2020 2020 2020 2020 2020 206d  :..            m
-0000e4d0: 6173 7465 725f 6461 7461 5b6d 6173 7465  aster_data[maste
-0000e4e0: 725d 5b27 6465 6661 756c 7427 5d20 3d20  r]['default'] = 
-0000e4f0: 6d61 7374 6572 5f64 6174 615b 6d61 7374  master_data[mast
-0000e500: 6572 5d5b 6178 735b 305d 2e76 625d 0d0a  er][axs[0].vb]..
-0000e510: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
-0000e520: 2020 2066 6f72 2061 7820 696e 2061 7873     for ax in axs
-0000e530: 3a0d 0a20 2020 2020 2020 2020 2020 2070  :..            p
-0000e540: 726f 7879 203d 2070 672e 5369 676e 616c  roxy = pg.Signal
-0000e550: 5072 6f78 7928 6178 2e61 785f 7769 6467  Proxy(ax.ax_widg
-0000e560: 6574 2e73 6365 6e65 2829 2e73 6967 4d6f  et.scene().sigMo
-0000e570: 7573 654d 6f76 6564 2c20 7261 7465 4c69  useMoved, rateLi
-0000e580: 6d69 743d 3134 342c 2073 6c6f 743d 7061  mit=144, slot=pa
-0000e590: 7274 6961 6c28 5f6d 6f75 7365 5f6d 6f76  rtial(_mouse_mov
-0000e5a0: 6564 2c20 6d61 7374 6572 2c20 6178 2e76  ed, master, ax.v
-0000e5b0: 6229 290d 0a20 2020 2020 2020 2020 2020  b))..           
-0000e5c0: 206d 6173 7465 725f 6461 7461 5b6d 6173   master_data[mas
-0000e5d0: 7465 725d 5b61 782e 7662 5d20 3d20 6469  ter][ax.vb] = di
-0000e5e0: 6374 2870 726f 7879 6d6d 3d70 726f 7879  ct(proxymm=proxy
-0000e5f0: 2c20 6c61 7374 5f6d 6f75 7365 5f65 7673  , last_mouse_evs
-0000e600: 3d4e 6f6e 652c 206c 6173 745f 6d6f 7573  =None, last_mous
-0000e610: 655f 793d 3029 0d0a 2020 2020 6c61 7374  e_y=0)..    last
-0000e620: 5f61 7820 3d20 6178 735b 305d 0d0a 2020  _ax = axs[0]..  
-0000e630: 2020 7265 7475 726e 2061 7873 5b30 5d20    return axs[0] 
-0000e640: 6966 206c 656e 2861 7873 2920 3d3d 2031  if len(axs) == 1
-0000e650: 2065 6c73 6520 6178 730d 0a0d 0a0d 0a64   else axs......d
-0000e660: 6566 2063 6c6f 7365 2829 3a0d 0a20 2020  ef close():..   
-0000e670: 2066 6f72 2077 696e 2069 6e20 7769 6e64   for win in wind
-0000e680: 6f77 733a 0d0a 2020 2020 2020 2020 7472  ows:..        tr
-0000e690: 793a 0d0a 2020 2020 2020 2020 2020 2020  y:..            
-0000e6a0: 7769 6e2e 636c 6f73 6528 290d 0a20 2020  win.close()..   
-0000e6b0: 2020 2020 2065 7863 6570 7420 4578 6365       except Exce
-0000e6c0: 7074 696f 6e20 6173 2065 3a0d 0a20 2020  ption as e:..   
-0000e6d0: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
-0000e6e0: 5769 6e64 6f77 2063 6c6f 7369 6e67 2065  Window closing e
-0000e6f0: 7272 6f72 3a27 2c20 7479 7065 2865 292c  rror:', type(e),
-0000e700: 2065 290d 0a20 2020 2067 6c6f 6261 6c20   e)..    global 
-0000e710: 6c61 7374 5f61 780d 0a20 2020 2077 696e  last_ax..    win
-0000e720: 646f 7773 2e63 6c65 6172 2829 0d0a 2020  dows.clear()..  
-0000e730: 2020 6f76 6572 6c61 795f 6178 732e 636c    overlay_axs.cl
-0000e740: 6561 7228 290d 0a20 2020 205f 636c 6561  ear()..    _clea
-0000e750: 725f 7469 6d65 7273 2829 0d0a 2020 2020  r_timers()..    
-0000e760: 736f 756e 6473 2e63 6c65 6172 2829 0d0a  sounds.clear()..
-0000e770: 2020 2020 6d61 7374 6572 5f64 6174 612e      master_data.
-0000e780: 636c 6561 7228 290d 0a20 2020 206c 6173  clear()..    las
-0000e790: 745f 6178 203d 204e 6f6e 650d 0a0d 0a0d  t_ax = None.....
-0000e7a0: 0a64 6566 2070 7269 6365 5f63 6f6c 6f72  .def price_color
-0000e7b0: 6669 6c74 6572 2869 7465 6d2c 2064 6174  filter(item, dat
-0000e7c0: 6173 7263 2c20 6466 293a 0d0a 2020 2020  asrc, df):..    
-0000e7d0: 6f70 656e 636f 6c20 3d20 6466 2e63 6f6c  opencol = df.col
-0000e7e0: 756d 6e73 5b31 5d0d 0a20 2020 2063 6c6f  umns[1]..    clo
-0000e7f0: 7365 636f 6c20 3d20 6466 2e63 6f6c 756d  secol = df.colum
-0000e800: 6e73 5b32 5d0d 0a20 2020 2069 735f 7570  ns[2]..    is_up
-0000e810: 203d 2064 665b 6f70 656e 636f 6c5d 203c   = df[opencol] <
-0000e820: 3d20 6466 5b63 6c6f 7365 636f 6c5d 2023  = df[closecol] #
-0000e830: 206f 7065 6e20 6c6f 7765 7220 7468 616e   open lower than
-0000e840: 2063 6c6f 7365 203d 2067 6f65 7320 7570   close = goes up
-0000e850: 0d0a 2020 2020 7969 656c 6420 6974 656d  ..    yield item
-0000e860: 2e72 6f77 636f 6c6f 7273 2827 6275 6c6c  .rowcolors('bull
-0000e870: 2729 202b 205b 6466 2e6c 6f63 5b69 735f  ') + [df.loc[is_
-0000e880: 7570 2c20 3a5d 5d0d 0a20 2020 2079 6965  up, :]]..    yie
-0000e890: 6c64 2069 7465 6d2e 726f 7763 6f6c 6f72  ld item.rowcolor
-0000e8a0: 7328 2762 6561 7227 2920 2b20 5b64 662e  s('bear') + [df.
-0000e8b0: 6c6f 635b 7e69 735f 7570 2c20 3a5d 5d0d  loc[~is_up, :]].
-0000e8c0: 0a0d 0a0d 0a64 6566 2076 6f6c 756d 655f  .....def volume_
-0000e8d0: 636f 6c6f 7266 696c 7465 7228 6974 656d  colorfilter(item
-0000e8e0: 2c20 6461 7461 7372 632c 2064 6629 3a0d  , datasrc, df):.
-0000e8f0: 0a20 2020 206f 7065 6e63 6f6c 203d 2064  .    opencol = d
-0000e900: 662e 636f 6c75 6d6e 735b 335d 0d0a 2020  f.columns[3]..  
-0000e910: 2020 636c 6f73 6563 6f6c 203d 2064 662e    closecol = df.
-0000e920: 636f 6c75 6d6e 735b 345d 0d0a 2020 2020  columns[4]..    
-0000e930: 6973 5f75 7020 3d20 6466 5b6f 7065 6e63  is_up = df[openc
-0000e940: 6f6c 5d20 3c3d 2064 665b 636c 6f73 6563  ol] <= df[closec
-0000e950: 6f6c 5d20 2320 6f70 656e 206c 6f77 6572  ol] # open lower
-0000e960: 2074 6861 6e20 636c 6f73 6520 3d20 676f   than close = go
-0000e970: 6573 2075 700d 0a20 2020 2079 6965 6c64  es up..    yield
-0000e980: 2069 7465 6d2e 726f 7763 6f6c 6f72 7328   item.rowcolors(
-0000e990: 2762 756c 6c27 2920 2b20 5b64 662e 6c6f  'bull') + [df.lo
-0000e9a0: 635b 6973 5f75 702c 203a 5d5d 0d0a 2020  c[is_up, :]]..  
-0000e9b0: 2020 7969 656c 6420 6974 656d 2e72 6f77    yield item.row
-0000e9c0: 636f 6c6f 7273 2827 6265 6172 2729 202b  colors('bear') +
-0000e9d0: 205b 6466 2e6c 6f63 5b7e 6973 5f75 702c   [df.loc[~is_up,
-0000e9e0: 203a 5d5d 0d0a 0d0a 0d0a 6465 6620 7374   :]]......def st
-0000e9f0: 7265 6e67 7468 5f63 6f6c 6f72 6669 6c74  rength_colorfilt
-0000ea00: 6572 2869 7465 6d2c 2064 6174 6173 7263  er(item, datasrc
-0000ea10: 2c20 6466 293a 0d0a 2020 2020 6f70 656e  , df):..    open
-0000ea20: 636f 6c20 3d20 6466 2e63 6f6c 756d 6e73  col = df.columns
-0000ea30: 5b31 5d0d 0a20 2020 2063 6c6f 7365 636f  [1]..    closeco
-0000ea40: 6c20 3d20 6466 2e63 6f6c 756d 6e73 5b32  l = df.columns[2
-0000ea50: 5d0d 0a20 2020 2073 7461 7274 636f 6c20  ]..    startcol 
-0000ea60: 3d20 6466 2e63 6f6c 756d 6e73 5b33 5d0d  = df.columns[3].
-0000ea70: 0a20 2020 2065 6e64 636f 6c20 3d20 6466  .    endcol = df
-0000ea80: 2e63 6f6c 756d 6e73 5b34 5d0d 0a20 2020  .columns[4]..   
-0000ea90: 2069 735f 7570 203d 2064 665b 6f70 656e   is_up = df[open
-0000eaa0: 636f 6c5d 203c 3d20 6466 5b63 6c6f 7365  col] <= df[close
-0000eab0: 636f 6c5d 2023 206f 7065 6e20 6c6f 7765  col] # open lowe
-0000eac0: 7220 7468 616e 2063 6c6f 7365 203d 2067  r than close = g
-0000ead0: 6f65 7320 7570 0d0a 2020 2020 6973 5f73  oes up..    is_s
-0000eae0: 7472 6f6e 6720 3d20 6466 5b73 7461 7274  trong = df[start
-0000eaf0: 636f 6c5d 203c 3d20 6466 5b65 6e64 636f  col] <= df[endco
-0000eb00: 6c5d 0d0a 2020 2020 7969 656c 6420 6974  l]..    yield it
-0000eb10: 656d 2e72 6f77 636f 6c6f 7273 2827 6275  em.rowcolors('bu
-0000eb20: 6c6c 2729 202b 205b 6466 2e6c 6f63 5b69  ll') + [df.loc[i
-0000eb30: 735f 7570 2669 735f 7374 726f 6e67 2c20  s_up&is_strong, 
-0000eb40: 3a5d 5d0d 0a20 2020 2079 6965 6c64 2069  :]]..    yield i
-0000eb50: 7465 6d2e 726f 7763 6f6c 6f72 7328 2777  tem.rowcolors('w
-0000eb60: 6561 6b5f 6275 6c6c 2729 202b 205b 6466  eak_bull') + [df
-0000eb70: 2e6c 6f63 5b69 735f 7570 2628 7e69 735f  .loc[is_up&(~is_
-0000eb80: 7374 726f 6e67 292c 203a 5d5d 0d0a 2020  strong), :]]..  
-0000eb90: 2020 7969 656c 6420 6974 656d 2e72 6f77    yield item.row
-0000eba0: 636f 6c6f 7273 2827 7765 616b 5f62 6561  colors('weak_bea
-0000ebb0: 7227 2920 2b20 5b64 662e 6c6f 635b 287e  r') + [df.loc[(~
-0000ebc0: 6973 5f75 7029 2669 735f 7374 726f 6e67  is_up)&is_strong
-0000ebd0: 2c20 3a5d 5d0d 0a20 2020 2079 6965 6c64  , :]]..    yield
-0000ebe0: 2069 7465 6d2e 726f 7763 6f6c 6f72 7328   item.rowcolors(
-0000ebf0: 2762 6561 7227 2920 2b20 5b64 662e 6c6f  'bear') + [df.lo
-0000ec00: 635b 287e 6973 5f75 7029 2628 7e69 735f  c[(~is_up)&(~is_
-0000ec10: 7374 726f 6e67 292c 203a 5d5d 0d0a 0d0a  strong), :]]....
-0000ec20: 0d0a 6465 6620 766f 6c75 6d65 5f63 6f6c  ..def volume_col
-0000ec30: 6f72 6669 6c74 6572 5f73 6563 7469 6f6e  orfilter_section
-0000ec40: 2873 6563 7469 6f6e 733d 5b5d 293a 0d0a  (sections=[]):..
-0000ec50: 2020 2020 2727 2754 6865 2073 6563 7469      '''The secti
-0000ec60: 6f6e 7320 6172 6775 6d65 6e74 2069 7320  ons argument is 
-0000ec70: 6120 2873 7461 7274 696e 675f 696e 6465  a (starting_inde
-0000ec80: 782c 2063 6f6c 6f72 5f6e 616d 6529 2061  x, color_name) a
-0000ec90: 7272 6179 2e27 2727 0d0a 2020 2020 6465  rray.'''..    de
-0000eca0: 6620 5f63 6f6c 6f72 6669 6c74 6572 2873  f _colorfilter(s
-0000ecb0: 6563 7469 6f6e 732c 2069 7465 6d2c 2064  ections, item, d
-0000ecc0: 6174 6173 7263 2c20 6466 293a 0d0a 2020  atasrc, df):..  
-0000ecd0: 2020 2020 2020 6966 206e 6f74 2073 6563        if not sec
-0000ece0: 7469 6f6e 733a 0d0a 2020 2020 2020 2020  tions:..        
-0000ecf0: 2020 2020 7265 7475 726e 2076 6f6c 756d      return volum
-0000ed00: 655f 636f 6c6f 7266 696c 7465 7228 6974  e_colorfilter(it
-0000ed10: 656d 2c20 6461 7461 7372 632c 2064 6629  em, datasrc, df)
-0000ed20: 0d0a 2020 2020 2020 2020 666f 7220 2869  ..        for (i
-0000ed30: 302c 636f 6c6e 616d 6529 2c28 6931 2c5f  0,colname),(i1,_
-0000ed40: 2920 696e 207a 6970 2873 6563 7469 6f6e  ) in zip(section
-0000ed50: 732c 2073 6563 7469 6f6e 735b 313a 5d2b  s, sections[1:]+
-0000ed60: 5b28 4e6f 6e65 2c27 6e65 7574 7261 6c27  [(None,'neutral'
-0000ed70: 295d 293a 0d0a 2020 2020 2020 2020 2020  )]):..          
-0000ed80: 2020 726f 7773 203d 2064 662e 696c 6f63    rows = df.iloc
-0000ed90: 5b69 303a 6931 2c20 3a5d 0d0a 2020 2020  [i0:i1, :]..    
-0000eda0: 2020 2020 2020 2020 7969 656c 6420 6974          yield it
-0000edb0: 656d 2e72 6f77 636f 6c6f 7273 2863 6f6c  em.rowcolors(col
-0000edc0: 6e61 6d65 2920 2b20 5b72 6f77 735d 0d0a  name) + [rows]..
-0000edd0: 2020 2020 7265 7475 726e 2070 6172 7469      return parti
-0000ede0: 616c 285f 636f 6c6f 7266 696c 7465 722c  al(_colorfilter,
-0000edf0: 2073 6563 7469 6f6e 7329 0d0a 0d0a 0d0a   sections)......
-0000ee00: 6465 6620 686f 7269 7a76 6f6c 5f63 6f6c  def horizvol_col
-0000ee10: 6f72 6669 6c74 6572 2873 6563 7469 6f6e  orfilter(section
-0000ee20: 733d 5b5d 293a 0d0a 2020 2020 2727 2754  s=[]):..    '''T
-0000ee30: 6865 2073 6563 7469 6f6e 7320 6172 6775  he sections argu
-0000ee40: 6d65 6e74 2069 7320 6120 2873 7461 7274  ment is a (start
-0000ee50: 696e 675f 696e 6465 782c 2063 6f6c 6f72  ing_index, color
-0000ee60: 5f6e 616d 6529 2061 7272 6179 2e27 2727  _name) array.'''
-0000ee70: 0d0a 2020 2020 6465 6620 5f63 6f6c 6f72  ..    def _color
-0000ee80: 6669 6c74 6572 2873 6563 7469 6f6e 732c  filter(sections,
-0000ee90: 2069 7465 6d2c 2064 6174 6173 7263 2c20   item, datasrc, 
-0000eea0: 6461 7461 293a 0d0a 2020 2020 2020 2020  data):..        
-0000eeb0: 6966 206e 6f74 2073 6563 7469 6f6e 733a  if not sections:
-0000eec0: 0d0a 2020 2020 2020 2020 2020 2020 7969  ..            yi
-0000eed0: 656c 6420 6974 656d 2e72 6f77 636f 6c6f  eld item.rowcolo
-0000eee0: 7273 2827 6e65 7574 7261 6c27 2920 2b20  rs('neutral') + 
-0000eef0: 5b64 6174 615d 0d0a 2020 2020 2020 2020  [data]..        
-0000ef00: 666f 7220 2869 302c 636f 6c6e 616d 6529  for (i0,colname)
-0000ef10: 2c28 6931 2c5f 2920 696e 207a 6970 2873  ,(i1,_) in zip(s
-0000ef20: 6563 7469 6f6e 732c 2073 6563 7469 6f6e  ections, section
-0000ef30: 735b 313a 5d2b 5b28 4e6f 6e65 2c27 6e65  s[1:]+[(None,'ne
-0000ef40: 7574 7261 6c27 295d 293a 0d0a 2020 2020  utral')]):..    
-0000ef50: 2020 2020 2020 2020 726f 7773 203d 2064          rows = d
-0000ef60: 6174 615b 3a2c 2069 303a 6931 5d0d 0a20  ata[:, i0:i1].. 
-0000ef70: 2020 2020 2020 2020 2020 2079 6965 6c64             yield
-0000ef80: 2069 7465 6d2e 726f 7763 6f6c 6f72 7328   item.rowcolors(
-0000ef90: 636f 6c6e 616d 6529 202b 205b 726f 7773  colname) + [rows
-0000efa0: 5d0d 0a20 2020 2072 6574 7572 6e20 7061  ]..    return pa
-0000efb0: 7274 6961 6c28 5f63 6f6c 6f72 6669 6c74  rtial(_colorfilt
-0000efc0: 6572 2c20 7365 6374 696f 6e73 290d 0a0d  er, sections)...
-0000efd0: 0a0d 0a64 6566 2063 616e 646c 6573 7469  ...def candlesti
-0000efe0: 636b 5f6f 6368 6c28 6461 7461 7372 632c  ck_ochl(datasrc,
-0000eff0: 2064 7261 775f 626f 6479 3d54 7275 652c   draw_body=True,
-0000f000: 2064 7261 775f 7368 6164 6f77 3d54 7275   draw_shadow=Tru
-0000f010: 652c 2063 616e 646c 655f 7769 6474 683d  e, candle_width=
-0000f020: 302e 362c 2061 783d 4e6f 6e65 2c20 636f  0.6, ax=None, co
-0000f030: 6c6f 7266 756e 633d 7072 6963 655f 636f  lorfunc=price_co
-0000f040: 6c6f 7266 696c 7465 7229 3a0d 0a20 2020  lorfilter):..   
-0000f050: 2061 7820 3d20 5f63 7265 6174 655f 706c   ax = _create_pl
-0000f060: 6f74 2861 783d 6178 2c20 6d61 7869 6d69  ot(ax=ax, maximi
-0000f070: 7a65 3d46 616c 7365 290d 0a20 2020 2064  ze=False)..    d
-0000f080: 6174 6173 7263 203d 205f 6372 6561 7465  atasrc = _create
-0000f090: 5f64 6174 6173 7263 2861 782c 2064 6174  _datasrc(ax, dat
-0000f0a0: 6173 7263 2c20 6e63 6f6c 733d 3529 0d0a  asrc, ncols=5)..
-0000f0b0: 2020 2020 6461 7461 7372 632e 7363 616c      datasrc.scal
-0000f0c0: 655f 636f 6c73 203d 205b 332c 345d 2023  e_cols = [3,4] #
-0000f0d0: 206f 6e6c 7920 6869 2b6c 6f20 7363 616c   only hi+lo scal
-0000f0e0: 6573 0d0a 2020 2020 5f73 6574 5f64 6174  es..    _set_dat
-0000f0f0: 6173 7263 2861 782c 2064 6174 6173 7263  asrc(ax, datasrc
-0000f100: 290d 0a20 2020 2069 7465 6d20 3d20 4361  )..    item = Ca
-0000f110: 6e64 6c65 7374 6963 6b49 7465 6d28 6178  ndlestickItem(ax
-0000f120: 3d61 782c 2064 6174 6173 7263 3d64 6174  =ax, datasrc=dat
-0000f130: 6173 7263 2c20 6472 6177 5f62 6f64 793d  asrc, draw_body=
-0000f140: 6472 6177 5f62 6f64 792c 2064 7261 775f  draw_body, draw_
-0000f150: 7368 6164 6f77 3d64 7261 775f 7368 6164  shadow=draw_shad
-0000f160: 6f77 2c20 6361 6e64 6c65 5f77 6964 7468  ow, candle_width
-0000f170: 3d63 616e 646c 655f 7769 6474 682c 2063  =candle_width, c
-0000f180: 6f6c 6f72 6675 6e63 3d63 6f6c 6f72 6675  olorfunc=colorfu
-0000f190: 6e63 2c20 7265 7361 6d70 3d27 6869 6c6f  nc, resamp='hilo
-0000f1a0: 2729 0d0a 2020 2020 5f75 7064 6174 655f  ')..    _update_
-0000f1b0: 7369 676e 6966 6963 616e 7473 2861 782c  significants(ax,
-0000f1c0: 2064 6174 6173 7263 2c20 666f 7263 653d   datasrc, force=
-0000f1d0: 5472 7565 290d 0a20 2020 2069 7465 6d2e  True)..    item.
-0000f1e0: 7570 6461 7465 5f64 6174 6120 3d20 7061  update_data = pa
-0000f1f0: 7274 6961 6c28 5f75 7064 6174 655f 6461  rtial(_update_da
-0000f200: 7461 2c20 4e6f 6e65 2c20 4e6f 6e65 2c20  ta, None, None, 
-0000f210: 6974 656d 290d 0a20 2020 2069 7465 6d2e  item)..    item.
-0000f220: 7570 6461 7465 5f67 6678 203d 2070 6172  update_gfx = par
-0000f230: 7469 616c 285f 7570 6461 7465 5f67 6678  tial(_update_gfx
-0000f240: 2c20 6974 656d 290d 0a20 2020 2061 782e  , item)..    ax.
-0000f250: 6164 6449 7465 6d28 6974 656d 290d 0a20  addItem(item).. 
-0000f260: 2020 2072 6574 7572 6e20 6974 656d 0d0a     return item..
-0000f270: 0d0a 0d0a 6465 6620 7265 6e6b 6f28 782c  ....def renko(x,
-0000f280: 2079 3d4e 6f6e 652c 2062 696e 733d 4e6f   y=None, bins=No
-0000f290: 6e65 2c20 7374 6570 3d4e 6f6e 652c 2061  ne, step=None, a
-0000f2a0: 783d 4e6f 6e65 2c20 636f 6c6f 7266 756e  x=None, colorfun
-0000f2b0: 633d 7072 6963 655f 636f 6c6f 7266 696c  c=price_colorfil
-0000f2c0: 7465 7229 3a0d 0a20 2020 2061 7820 3d20  ter):..    ax = 
-0000f2d0: 5f63 7265 6174 655f 706c 6f74 2861 783d  _create_plot(ax=
-0000f2e0: 6178 2c20 6d61 7869 6d69 7a65 3d46 616c  ax, maximize=Fal
-0000f2f0: 7365 290d 0a20 2020 2064 6174 6173 7263  se)..    datasrc
-0000f300: 203d 205f 6372 6561 7465 5f64 6174 6173   = _create_datas
-0000f310: 7263 2861 782c 2078 2c20 792c 206e 636f  rc(ax, x, y, nco
-0000f320: 6c73 3d33 290d 0a20 2020 206f 7269 6764  ls=3)..    origd
-0000f330: 6620 3d20 6461 7461 7372 632e 6466 0d0a  f = datasrc.df..
-0000f340: 2020 2020 6164 6a20 3d20 5f61 646a 7573      adj = _adjus
-0000f350: 745f 7265 6e6b 6f5f 6c6f 675f 6461 7461  t_renko_log_data
-0000f360: 7372 6320 6966 2061 782e 7662 2e79 7363  src if ax.vb.ysc
-0000f370: 616c 652e 7363 616c 6574 7970 6520 3d3d  ale.scaletype ==
-0000f380: 2027 6c6f 6727 2065 6c73 6520 5f61 646a   'log' else _adj
-0000f390: 7573 745f 7265 6e6b 6f5f 6461 7461 7372  ust_renko_datasr
-0000f3a0: 630d 0a20 2020 2073 7465 705f 6164 6a75  c..    step_adju
-0000f3b0: 7374 5f72 656e 6b6f 5f64 6174 6173 7263  st_renko_datasrc
-0000f3c0: 203d 2070 6172 7469 616c 2861 646a 2c20   = partial(adj, 
-0000f3d0: 6269 6e73 2c20 7374 6570 290d 0a20 2020  bins, step)..   
-0000f3e0: 2073 7465 705f 6164 6a75 7374 5f72 656e   step_adjust_ren
-0000f3f0: 6b6f 5f64 6174 6173 7263 2864 6174 6173  ko_datasrc(datas
-0000f400: 7263 290d 0a20 2020 2061 782e 6465 636f  rc)..    ax.deco
-0000f410: 7570 6c65 2829 0d0a 2020 2020 6974 656d  uple()..    item
-0000f420: 203d 2063 616e 646c 6573 7469 636b 5f6f   = candlestick_o
-0000f430: 6368 6c28 6461 7461 7372 632c 2064 7261  chl(datasrc, dra
-0000f440: 775f 7368 6164 6f77 3d46 616c 7365 2c20  w_shadow=False, 
-0000f450: 6361 6e64 6c65 5f77 6964 7468 3d31 2c20  candle_width=1, 
-0000f460: 6178 3d61 782c 2063 6f6c 6f72 6675 6e63  ax=ax, colorfunc
-0000f470: 3d63 6f6c 6f72 6675 6e63 290d 0a20 2020  =colorfunc)..   
-0000f480: 2069 7465 6d2e 636f 6c6f 7273 5b27 6275   item.colors['bu
-0000f490: 6c6c 5f62 6f64 7927 5d20 3d20 6974 656d  ll_body'] = item
-0000f4a0: 2e63 6f6c 6f72 735b 2762 756c 6c5f 6672  .colors['bull_fr
-0000f4b0: 616d 6527 5d0d 0a20 2020 2069 7465 6d2e  ame']..    item.
-0000f4c0: 7570 6461 7465 5f64 6174 6120 3d20 7061  update_data = pa
-0000f4d0: 7274 6961 6c28 5f75 7064 6174 655f 6461  rtial(_update_da
-0000f4e0: 7461 2c20 4e6f 6e65 2c20 7374 6570 5f61  ta, None, step_a
-0000f4f0: 646a 7573 745f 7265 6e6b 6f5f 6461 7461  djust_renko_data
-0000f500: 7372 632c 2069 7465 6d29 0d0a 2020 2020  src, item)..    
-0000f510: 6974 656d 2e75 7064 6174 655f 6766 7820  item.update_gfx 
-0000f520: 3d20 7061 7274 6961 6c28 5f75 7064 6174  = partial(_updat
-0000f530: 655f 6766 782c 2069 7465 6d29 0d0a 2020  e_gfx, item)..  
-0000f540: 2020 676c 6f62 616c 2065 706f 6368 5f70    global epoch_p
-0000f550: 6572 696f 640d 0a20 2020 2065 706f 6368  eriod..    epoch
-0000f560: 5f70 6572 696f 6420 3d20 286f 7269 6764  _period = (origd
-0000f570: 662e 696c 6f63 5b31 2c30 5d20 2d20 6f72  f.iloc[1,0] - or
-0000f580: 6967 6466 2e69 6c6f 635b 302c 305d 2920  igdf.iloc[0,0]) 
-0000f590: 2f2f 2069 6e74 2831 6539 290d 0a20 2020  // int(1e9)..   
-0000f5a0: 2072 6574 7572 6e20 6974 656d 0d0a 0d0a   return item....
-0000f5b0: 0d0a 6465 6620 766f 6c75 6d65 5f6f 6376  ..def volume_ocv
-0000f5c0: 2864 6174 6173 7263 2c20 6361 6e64 6c65  (datasrc, candle
-0000f5d0: 5f77 6964 7468 3d30 2e38 2c20 6178 3d4e  _width=0.8, ax=N
-0000f5e0: 6f6e 652c 2063 6f6c 6f72 6675 6e63 3d76  one, colorfunc=v
-0000f5f0: 6f6c 756d 655f 636f 6c6f 7266 696c 7465  olume_colorfilte
-0000f600: 7229 3a0d 0a20 2020 2061 7820 3d20 5f63  r):..    ax = _c
-0000f610: 7265 6174 655f 706c 6f74 2861 783d 6178  reate_plot(ax=ax
-0000f620: 2c20 6d61 7869 6d69 7a65 3d46 616c 7365  , maximize=False
-0000f630: 290d 0a20 2020 2064 6174 6173 7263 203d  )..    datasrc =
-0000f640: 205f 6372 6561 7465 5f64 6174 6173 7263   _create_datasrc
-0000f650: 2861 782c 2064 6174 6173 7263 2c20 6e63  (ax, datasrc, nc
-0000f660: 6f6c 733d 3429 0d0a 2020 2020 5f61 646a  ols=4)..    _adj
-0000f670: 7573 745f 766f 6c75 6d65 5f64 6174 6173  ust_volume_datas
-0000f680: 7263 2864 6174 6173 7263 290d 0a20 2020  rc(datasrc)..   
-0000f690: 205f 7365 745f 6461 7461 7372 6328 6178   _set_datasrc(ax
-0000f6a0: 2c20 6461 7461 7372 6329 0d0a 2020 2020  , datasrc)..    
-0000f6b0: 6974 656d 203d 2043 616e 646c 6573 7469  item = Candlesti
-0000f6c0: 636b 4974 656d 2861 783d 6178 2c20 6461  ckItem(ax=ax, da
-0000f6d0: 7461 7372 633d 6461 7461 7372 632c 2064  tasrc=datasrc, d
-0000f6e0: 7261 775f 626f 6479 3d54 7275 652c 2064  raw_body=True, d
-0000f6f0: 7261 775f 7368 6164 6f77 3d46 616c 7365  raw_shadow=False
-0000f700: 2c20 6361 6e64 6c65 5f77 6964 7468 3d63  , candle_width=c
-0000f710: 616e 646c 655f 7769 6474 682c 2063 6f6c  andle_width, col
-0000f720: 6f72 6675 6e63 3d63 6f6c 6f72 6675 6e63  orfunc=colorfunc
-0000f730: 2c20 7265 7361 6d70 3d27 7375 6d27 290d  , resamp='sum').
-0000f740: 0a20 2020 205f 7570 6461 7465 5f73 6967  .    _update_sig
-0000f750: 6e69 6669 6361 6e74 7328 6178 2c20 6461  nificants(ax, da
-0000f760: 7461 7372 632c 2066 6f72 6365 3d54 7275  tasrc, force=Tru
-0000f770: 6529 0d0a 2020 2020 6974 656d 2e63 6f6c  e)..    item.col
-0000f780: 6f72 735b 2762 756c 6c5f 626f 6479 275d  ors['bull_body']
-0000f790: 203d 2069 7465 6d2e 636f 6c6f 7273 5b27   = item.colors['
-0000f7a0: 6275 6c6c 5f66 7261 6d65 275d 0d0a 2020  bull_frame']..  
-0000f7b0: 2020 6966 2063 6f6c 6f72 6675 6e63 203d    if colorfunc =
-0000f7c0: 3d20 766f 6c75 6d65 5f63 6f6c 6f72 6669  = volume_colorfi
-0000f7d0: 6c74 6572 3a20 2320 6173 7375 6d65 206e  lter: # assume n
-0000f7e0: 6f72 6d61 6c20 766f 6c75 6d65 2070 6c6f  ormal volume plo
-0000f7f0: 740d 0a20 2020 2020 2020 2069 7465 6d2e  t..        item.
-0000f800: 636f 6c6f 7273 5b27 6275 6c6c 5f66 7261  colors['bull_fra
-0000f810: 6d65 275d 203d 2076 6f6c 756d 655f 6275  me'] = volume_bu
-0000f820: 6c6c 5f63 6f6c 6f72 0d0a 2020 2020 2020  ll_color..      
-0000f830: 2020 6974 656d 2e63 6f6c 6f72 735b 2762    item.colors['b
-0000f840: 756c 6c5f 626f 6479 275d 2020 3d20 766f  ull_body']  = vo
-0000f850: 6c75 6d65 5f62 756c 6c5f 626f 6479 5f63  lume_bull_body_c
-0000f860: 6f6c 6f72 0d0a 2020 2020 2020 2020 6974  olor..        it
-0000f870: 656d 2e63 6f6c 6f72 735b 2762 6561 725f  em.colors['bear_
-0000f880: 6672 616d 6527 5d20 3d20 766f 6c75 6d65  frame'] = volume
-0000f890: 5f62 6561 725f 636f 6c6f 720d 0a20 2020  _bear_color..   
-0000f8a0: 2020 2020 2069 7465 6d2e 636f 6c6f 7273       item.colors
-0000f8b0: 5b27 6265 6172 5f62 6f64 7927 5d20 203d  ['bear_body']  =
-0000f8c0: 2076 6f6c 756d 655f 6265 6172 5f63 6f6c   volume_bear_col
-0000f8d0: 6f72 0d0a 2020 2020 2020 2020 6178 2e76  or..        ax.v
-0000f8e0: 622e 765f 7a6f 6f6d 5f62 6173 656c 696e  b.v_zoom_baselin
-0000f8f0: 6520 3d20 300d 0a20 2020 2065 6c73 653a  e = 0..    else:
-0000f900: 0d0a 2020 2020 2020 2020 6974 656d 2e63  ..        item.c
-0000f910: 6f6c 6f72 735b 2777 6561 6b5f 6275 6c6c  olors['weak_bull
-0000f920: 5f66 7261 6d65 275d 203d 2062 7269 6768  _frame'] = brigh
-0000f930: 7465 6e28 766f 6c75 6d65 5f62 756c 6c5f  ten(volume_bull_
-0000f940: 636f 6c6f 722c 2031 2e32 290d 0a20 2020  color, 1.2)..   
-0000f950: 2020 2020 2069 7465 6d2e 636f 6c6f 7273       item.colors
-0000f960: 5b27 7765 616b 5f62 756c 6c5f 626f 6479  ['weak_bull_body
-0000f970: 275d 2020 3d20 6272 6967 6874 656e 2876  ']  = brighten(v
-0000f980: 6f6c 756d 655f 6275 6c6c 5f63 6f6c 6f72  olume_bull_color
-0000f990: 2c20 312e 3229 0d0a 2020 2020 6974 656d  , 1.2)..    item
-0000f9a0: 2e75 7064 6174 655f 6461 7461 203d 2070  .update_data = p
-0000f9b0: 6172 7469 616c 285f 7570 6461 7465 5f64  artial(_update_d
-0000f9c0: 6174 612c 204e 6f6e 652c 205f 6164 6a75  ata, None, _adju
-0000f9d0: 7374 5f76 6f6c 756d 655f 6461 7461 7372  st_volume_datasr
-0000f9e0: 632c 2069 7465 6d29 0d0a 2020 2020 6974  c, item)..    it
-0000f9f0: 656d 2e75 7064 6174 655f 6766 7820 3d20  em.update_gfx = 
-0000fa00: 7061 7274 6961 6c28 5f75 7064 6174 655f  partial(_update_
-0000fa10: 6766 782c 2069 7465 6d29 0d0a 2020 2020  gfx, item)..    
-0000fa20: 6178 2e61 6464 4974 656d 2869 7465 6d29  ax.addItem(item)
-0000fa30: 0d0a 2020 2020 6974 656d 2e73 6574 5a56  ..    item.setZV
-0000fa40: 616c 7565 282d 3230 290d 0a20 2020 2072  alue(-20)..    r
-0000fa50: 6574 7572 6e20 6974 656d 0d0a 0d0a 0d0a  eturn item......
-0000fa60: 6465 6620 686f 7269 7a5f 7469 6d65 5f76  def horiz_time_v
-0000fa70: 6f6c 756d 6528 6461 7461 7372 632c 2061  olume(datasrc, a
-0000fa80: 783d 4e6f 6e65 2c20 2a2a 6b77 6172 6773  x=None, **kwargs
-0000fa90: 293a 0d0a 2020 2020 2727 2744 7261 7773  ):..    '''Draws
-0000faa0: 206d 756c 7469 706c 6520 6669 7865 6420   multiple fixed 
-0000fab0: 686f 7269 7a6f 6e74 616c 2076 6f6c 756d  horizontal volum
-0000fac0: 6573 2e20 5468 6520 696e 7075 7420 666f  es. The input fo
-0000fad0: 726d 6174 2069 733a 0d0a 2020 2020 2020  rmat is:..      
-0000fae0: 205b 5b74 696d 6530 2c20 5b28 7072 6963   [[time0, [(pric
-0000faf0: 6530 2c76 6f6c 756d 6530 292c 2870 7269  e0,volume0),(pri
-0000fb00: 6365 312c 766f 6c75 6d65 3129 2c2e 2e2e  ce1,volume1),...
-0000fb10: 5d5d 2c20 2e2e 2e5d 0d0a 0d0a 2020 2020  ]], ...]....    
-0000fb20: 2020 2054 6869 7320 6368 6172 7420 6e65     This chart ne
-0000fb30: 6564 7320 746f 2062 6520 706c 6f74 206c  eds to be plot l
-0000fb40: 6173 742c 2073 6f20 6974 206b 6e6f 7773  ast, so it knows
-0000fb50: 2069 6620 6974 2063 6f6e 7472 6f6c 730d   if it controls.
-0000fb60: 0a20 2020 2020 2020 7768 6174 2074 696d  .       what tim
-0000fb70: 6520 7065 7269 6f64 7320 6172 6520 7368  e periods are sh
-0000fb80: 6f77 6e2c 206f 7220 6966 2069 7473 2075  own, or if its u
-0000fb90: 7369 6e67 2074 696d 6520 616c 7265 6164  sing time alread
-0000fba0: 7920 696e 0d0a 2020 2020 2020 2070 6c61  y in..       pla
-0000fbb0: 6365 2062 7920 616e 6f74 6865 7220 706c  ce by another pl
-0000fbc0: 6f74 2e27 2727 0d0a 2020 2020 2320 7570  ot.'''..    # up
-0000fbd0: 6461 7465 2068 616e 646c 696e 6720 6465  date handling de
-0000fbe0: 6661 756c 7420 6966 206e 6563 6573 7361  fault if necessa
-0000fbf0: 7279 0d0a 2020 2020 676c 6f62 616c 206d  ry..    global m
-0000fc00: 6178 5f7a 6f6f 6d5f 706f 696e 7473 2c20  ax_zoom_points, 
-0000fc10: 7269 6768 745f 6d61 7267 696e 5f63 616e  right_margin_can
-0000fc20: 646c 6573 0d0a 2020 2020 6966 206d 6178  dles..    if max
-0000fc30: 5f7a 6f6f 6d5f 706f 696e 7473 203e 2031  _zoom_points > 1
-0000fc40: 353a 0d0a 2020 2020 2020 2020 6d61 785f  5:..        max_
-0000fc50: 7a6f 6f6d 5f70 6f69 6e74 7320 3d20 340d  zoom_points = 4.
-0000fc60: 0a20 2020 2069 6620 7269 6768 745f 6d61  .    if right_ma
-0000fc70: 7267 696e 5f63 616e 646c 6573 203e 2033  rgin_candles > 3
-0000fc80: 3a0d 0a20 2020 2020 2020 2072 6967 6874  :..        right
-0000fc90: 5f6d 6172 6769 6e5f 6361 6e64 6c65 7320  _margin_candles 
-0000fca0: 3d20 310d 0a0d 0a20 2020 2061 7820 3d20  = 1....    ax = 
-0000fcb0: 5f63 7265 6174 655f 706c 6f74 2861 783d  _create_plot(ax=
-0000fcc0: 6178 2c20 6d61 7869 6d69 7a65 3d46 616c  ax, maximize=Fal
-0000fcd0: 7365 290d 0a20 2020 2064 6174 6173 7263  se)..    datasrc
-0000fce0: 203d 205f 7072 6561 646a 7573 745f 686f   = _preadjust_ho
-0000fcf0: 7269 7a5f 6461 7461 7372 6328 6461 7461  riz_datasrc(data
-0000fd00: 7372 6329 0d0a 2020 2020 6461 7461 7372  src)..    datasr
-0000fd10: 6320 3d20 5f63 7265 6174 655f 6461 7461  c = _create_data
-0000fd20: 7372 6328 6178 2c20 6461 7461 7372 6329  src(ax, datasrc)
-0000fd30: 0d0a 2020 2020 5f61 646a 7573 745f 686f  ..    _adjust_ho
-0000fd40: 7269 7a5f 6461 7461 7372 6328 6461 7461  riz_datasrc(data
-0000fd50: 7372 6329 0d0a 2020 2020 6966 2061 782e  src)..    if ax.
-0000fd60: 7662 2e64 6174 6173 7263 2069 7320 6e6f  vb.datasrc is no
-0000fd70: 7420 4e6f 6e65 3a0d 0a20 2020 2020 2020  t None:..       
-0000fd80: 2064 6174 6173 7263 2e73 7461 6e64 616c   datasrc.standal
-0000fd90: 6f6e 6520 3d20 5472 7565 2023 206f 6e6c  one = True # onl
-0000fda0: 7920 666f 7263 6520 7374 616e 6461 6c6f  y force standalo
-0000fdb0: 6e65 2069 6620 7468 6572 6520 6973 2073  ne if there is s
-0000fdc0: 6f6d 6574 6869 6e67 206f 6e20 6f75 7220  omething on our 
-0000fdd0: 6368 6172 7473 2061 6c72 6561 6479 0d0a  charts already..
-0000fde0: 2020 2020 6461 7461 7372 632e 7363 616c      datasrc.scal
-0000fdf0: 655f 636f 6c73 203d 205b 6461 7461 7372  e_cols = [datasr
-0000fe00: 632e 636f 6c5f 6461 7461 5f6f 6666 7365  c.col_data_offse
-0000fe10: 742c 206c 656e 2864 6174 6173 7263 2e64  t, len(datasrc.d
-0000fe20: 662e 636f 6c75 6d6e 7329 2d32 5d20 2320  f.columns)-2] # 
-0000fe30: 6669 7273 7420 616e 6420 6c61 7374 2070  first and last p
-0000fe40: 7269 6365 2063 6f6c 756d 6e73 0d0a 2020  rice columns..  
-0000fe50: 2020 6461 7461 7372 632e 7072 655f 7570    datasrc.pre_up
-0000fe60: 6461 7465 203d 206c 616d 6264 6120 6466  date = lambda df
-0000fe70: 3a20 6466 2e6c 6f63 5b3a 2c20 3a64 662e  : df.loc[:, :df.
-0000fe80: 636f 6c75 6d6e 735b 305d 5d20 2320 7468  columns[0]] # th
-0000fe90: 726f 7720 6177 6179 2070 7265 7669 6f75  row away previou
-0000fea0: 7320 6461 7461 0d0a 2020 2020 6461 7461  s data..    data
-0000feb0: 7372 632e 706f 7374 5f75 7064 6174 6520  src.post_update 
-0000fec0: 3d20 6c61 6d62 6461 2064 663a 2064 662e  = lambda df: df.
-0000fed0: 6472 6f70 6e61 2868 6f77 3d27 616c 6c27  dropna(how='all'
-0000fee0: 2920 2320 6b69 6c6c 2061 6c6c 2d4e 614e  ) # kill all-NaN
-0000fef0: 730d 0a20 2020 205f 7365 745f 6461 7461  s..    _set_data
-0000ff00: 7372 6328 6178 2c20 6461 7461 7372 6329  src(ax, datasrc)
-0000ff10: 0d0a 2020 2020 6974 656d 203d 2048 6f72  ..    item = Hor
-0000ff20: 697a 6f6e 7461 6c54 696d 6556 6f6c 756d  izontalTimeVolum
-0000ff30: 6549 7465 6d28 6178 3d61 782c 2064 6174  eItem(ax=ax, dat
-0000ff40: 6173 7263 3d64 6174 6173 7263 2c20 2a2a  asrc=datasrc, **
-0000ff50: 6b77 6172 6773 290d 0a20 2020 2069 7465  kwargs)..    ite
-0000ff60: 6d2e 7570 6461 7465 5f64 6174 6120 3d20  m.update_data = 
-0000ff70: 7061 7274 6961 6c28 5f75 7064 6174 655f  partial(_update_
-0000ff80: 6461 7461 2c20 5f70 7265 6164 6a75 7374  data, _preadjust
-0000ff90: 5f68 6f72 697a 5f64 6174 6173 7263 2c20  _horiz_datasrc, 
-0000ffa0: 5f61 646a 7573 745f 686f 7269 7a5f 6461  _adjust_horiz_da
-0000ffb0: 7461 7372 632c 2069 7465 6d29 0d0a 2020  tasrc, item)..  
-0000ffc0: 2020 6974 656d 2e75 7064 6174 655f 6766    item.update_gf
-0000ffd0: 7820 3d20 7061 7274 6961 6c28 5f75 7064  x = partial(_upd
-0000ffe0: 6174 655f 6766 782c 2069 7465 6d29 0d0a  ate_gfx, item)..
-0000fff0: 2020 2020 6974 656d 2e73 6574 5a56 616c      item.setZVal
-00010000: 7565 282d 3130 290d 0a20 2020 2061 782e  ue(-10)..    ax.
-00010010: 6164 6449 7465 6d28 6974 656d 290d 0a20  addItem(item).. 
-00010020: 2020 2072 6574 7572 6e20 6974 656d 0d0a     return item..
-00010030: 0d0a 0d0a 6465 6620 6865 6174 6d61 7028  ....def heatmap(
-00010040: 6461 7461 7372 632c 2061 783d 4e6f 6e65  datasrc, ax=None
-00010050: 2c20 2a2a 6b77 6172 6773 293a 0d0a 2020  , **kwargs):..  
-00010060: 2020 2727 2745 7870 656e 7369 7665 2066    '''Expensive f
-00010070: 756e 6374 696f 6e2e 204f 6e6c 7920 7573  unction. Only us
-00010080: 6520 6f6e 2073 6d61 6c6c 2064 6174 6120  e on small data 
-00010090: 7365 7473 2e20 5365 6520 4865 6174 6d61  sets. See Heatma
-000100a0: 7049 7465 6d20 666f 7220 6b77 6172 6773  pItem for kwargs
-000100b0: 2e20 496e 7075 7420 6461 7461 7372 630d  . Input datasrc.
-000100c0: 0a20 2020 2020 2020 6861 7320 7820 2874  .       has x (t
-000100d0: 696d 6529 2069 6e20 696e 6465 7820 6f72  ime) in index or
-000100e0: 2066 6972 7374 2063 6f6c 756d 6e2c 2079   first column, y
-000100f0: 2028 7072 6963 6529 2061 7320 636f 6c75   (price) as colu
-00010100: 6d6e 206e 616d 6573 2c20 616e 6420 696e  mn names, and in
-00010110: 7465 6e73 6974 7920 2863 6f6c 6f72 2920  tensity (color) 
-00010120: 6173 0d0a 2020 2020 2020 2063 656c 6c20  as..       cell 
-00010130: 7661 6c75 6573 2e27 2727 0d0a 2020 2020  values.'''..    
-00010140: 6178 203d 205f 6372 6561 7465 5f70 6c6f  ax = _create_plo
-00010150: 7428 6178 3d61 782c 206d 6178 696d 697a  t(ax=ax, maximiz
-00010160: 653d 4661 6c73 6529 0d0a 2020 2020 6966  e=False)..    if
-00010170: 2061 782e 7662 2e76 5f7a 6f6f 6d5f 7363   ax.vb.v_zoom_sc
-00010180: 616c 6520 3e3d 2030 2e39 3a0d 0a20 2020  ale >= 0.9:..   
-00010190: 2020 2020 2061 782e 7662 2e76 5f7a 6f6f       ax.vb.v_zoo
-000101a0: 6d5f 7363 616c 6520 3d20 302e 360d 0a20  m_scale = 0.6.. 
-000101b0: 2020 2064 6174 6173 7263 203d 205f 6372     datasrc = _cr
-000101c0: 6561 7465 5f64 6174 6173 7263 2861 782c  eate_datasrc(ax,
-000101d0: 2064 6174 6173 7263 290d 0a20 2020 2064   datasrc)..    d
-000101e0: 6174 6173 7263 2e73 6361 6c65 5f63 6f6c  atasrc.scale_col
-000101f0: 7320 3d20 5b5d 2023 2064 6f65 736e 2774  s = [] # doesn't
-00010200: 2073 6361 6c65 0d0a 2020 2020 5f73 6574   scale..    _set
-00010210: 5f64 6174 6173 7263 2861 782c 2064 6174  _datasrc(ax, dat
-00010220: 6173 7263 290d 0a20 2020 2069 7465 6d20  asrc)..    item 
-00010230: 3d20 4865 6174 6d61 7049 7465 6d28 6178  = HeatmapItem(ax
-00010240: 3d61 782c 2064 6174 6173 7263 3d64 6174  =ax, datasrc=dat
-00010250: 6173 7263 2c20 2a2a 6b77 6172 6773 290d  asrc, **kwargs).
-00010260: 0a20 2020 2069 7465 6d2e 7570 6461 7465  .    item.update
-00010270: 5f64 6174 6120 3d20 7061 7274 6961 6c28  _data = partial(
-00010280: 5f75 7064 6174 655f 6461 7461 2c20 4e6f  _update_data, No
-00010290: 6e65 2c20 4e6f 6e65 2c20 6974 656d 290d  ne, None, item).
-000102a0: 0a20 2020 2069 7465 6d2e 7570 6461 7465  .    item.update
-000102b0: 5f67 6678 203d 2070 6172 7469 616c 285f  _gfx = partial(_
-000102c0: 7570 6461 7465 5f67 6678 2c20 6974 656d  update_gfx, item
-000102d0: 290d 0a20 2020 2069 7465 6d2e 7365 745a  )..    item.setZ
-000102e0: 5661 6c75 6528 2d33 3029 0d0a 2020 2020  Value(-30)..    
-000102f0: 6178 2e61 6464 4974 656d 2869 7465 6d29  ax.addItem(item)
-00010300: 0d0a 2020 2020 6966 2061 782e 7662 2e64  ..    if ax.vb.d
-00010310: 6174 6173 7263 2069 7320 6e6f 7420 4e6f  atasrc is not No
-00010320: 6e65 2061 6e64 206e 6f74 2061 782e 7662  ne and not ax.vb
-00010330: 2e64 6174 6173 7263 2e74 696d 6562 6173  .datasrc.timebas
-00010340: 6564 2829 3a20 2320 6d61 6e75 616c 207a  ed(): # manual z
-00010350: 6f6f 6d20 7570 6461 7465 0d0a 2020 2020  oom update..    
-00010360: 2020 2020 6178 2e73 6574 584c 696e 6b28      ax.setXLink(
-00010370: 4e6f 6e65 290d 0a20 2020 2020 2020 2069  None)..        i
-00010380: 6620 6178 2e70 7265 765f 6178 3a0d 0a20  f ax.prev_ax:.. 
-00010390: 2020 2020 2020 2020 2020 2061 782e 7072             ax.pr
-000103a0: 6576 5f61 782e 7365 745f 7669 7369 626c  ev_ax.set_visibl
-000103b0: 6528 7861 7869 733d 5472 7565 290d 0a20  e(xaxis=True).. 
-000103c0: 2020 2020 2020 2064 6620 3d20 6178 2e76         df = ax.v
-000103d0: 622e 6461 7461 7372 632e 6466 0d0a 2020  b.datasrc.df..  
-000103e0: 2020 2020 2020 7072 6963 6573 203d 2064        prices = d
-000103f0: 662e 636f 6c75 6d6e 735b 6178 2e76 622e  f.columns[ax.vb.
-00010400: 6461 7461 7372 632e 636f 6c5f 6461 7461  datasrc.col_data
-00010410: 5f6f 6666 7365 743a 6974 656d 2e63 6f6c  _offset:item.col
-00010420: 5f64 6174 615f 656e 645d 0d0a 2020 2020  _data_end]..    
-00010430: 2020 2020 6465 6c74 615f 7072 6963 6520      delta_price 
-00010440: 3d20 6162 7328 7072 6963 6573 5b30 5d20  = abs(prices[0] 
-00010450: 2d20 7072 6963 6573 5b31 5d29 0d0a 2020  - prices[1])..  
-00010460: 2020 2020 2020 6178 2e76 622e 7365 745f        ax.vb.set_
-00010470: 7261 6e67 6528 302c 206d 696e 2864 662e  range(0, min(df.
-00010480: 636f 6c75 6d6e 735b 313a 5d29 2c20 6c65  columns[1:]), le
-00010490: 6e28 6466 292c 206d 6178 2864 662e 636f  n(df), max(df.co
-000104a0: 6c75 6d6e 735b 313a 5d29 2b64 656c 7461  lumns[1:])+delta
-000104b0: 5f70 7269 6365 290d 0a20 2020 2072 6574  _price)..    ret
-000104c0: 7572 6e20 6974 656d 0d0a 0d0a 0d0a 6465  urn item......de
-000104d0: 6620 6261 7228 782c 2079 3d4e 6f6e 652c  f bar(x, y=None,
-000104e0: 2077 6964 7468 3d30 2e38 2c20 6178 3d4e   width=0.8, ax=N
-000104f0: 6f6e 652c 2063 6f6c 6f72 6675 6e63 3d73  one, colorfunc=s
-00010500: 7472 656e 6774 685f 636f 6c6f 7266 696c  trength_colorfil
-00010510: 7465 722c 202a 2a6b 7761 7267 7329 3a0d  ter, **kwargs):.
-00010520: 0a20 2020 2027 2727 4261 7220 706c 6f74  .    '''Bar plot
-00010530: 7320 6172 6520 6465 636f 7570 6c65 642e  s are decoupled.
-00010540: 2055 7365 2076 6f6c 756d 655f 6f63 7628   Use volume_ocv(
-00010550: 2920 6966 2079 6f75 2077 616e 7420 6120  ) if you want a 
-00010560: 6261 7220 706c 6f74 2077 6869 6368 2072  bar plot which r
-00010570: 656c 6174 6573 2074 6f20 6f74 6865 7220  elates to other 
-00010580: 7469 6d65 2070 6c6f 7473 2e27 2727 0d0a  time plots.'''..
-00010590: 2020 2020 676c 6f62 616c 2072 6967 6874      global right
-000105a0: 5f6d 6172 6769 6e5f 6361 6e64 6c65 732c  _margin_candles,
-000105b0: 206d 6178 5f7a 6f6f 6d5f 706f 696e 7473   max_zoom_points
-000105c0: 0d0a 2020 2020 7269 6768 745f 6d61 7267  ..    right_marg
-000105d0: 696e 5f63 616e 646c 6573 203d 2030 0d0a  in_candles = 0..
-000105e0: 2020 2020 6d61 785f 7a6f 6f6d 5f70 6f69      max_zoom_poi
-000105f0: 6e74 7320 3d20 6d69 6e28 6d61 785f 7a6f  nts = min(max_zo
-00010600: 6f6d 5f70 6f69 6e74 732c 2038 290d 0a20  om_points, 8).. 
-00010610: 2020 2061 7820 3d20 5f63 7265 6174 655f     ax = _create_
-00010620: 706c 6f74 2861 783d 6178 2c20 6d61 7869  plot(ax=ax, maxi
-00010630: 6d69 7a65 3d46 616c 7365 290d 0a20 2020  mize=False)..   
-00010640: 2061 782e 6465 636f 7570 6c65 2829 0d0a   ax.decouple()..
-00010650: 2020 2020 6461 7461 7372 6320 3d20 5f63      datasrc = _c
-00010660: 7265 6174 655f 6461 7461 7372 6328 6178  reate_datasrc(ax
-00010670: 2c20 782c 2079 2c20 6e63 6f6c 733d 3129  , x, y, ncols=1)
-00010680: 0d0a 2020 2020 5f61 646a 7573 745f 6261  ..    _adjust_ba
-00010690: 725f 6461 7461 7372 6328 6461 7461 7372  r_datasrc(datasr
-000106a0: 632c 206f 7264 6572 5f63 6f6c 733d 4661  c, order_cols=Fa
-000106b0: 6c73 6529 2023 2064 6f6e 2774 2072 6561  lse) # don't rea
-000106c0: 7272 616e 6765 2063 6f6c 756d 6e73 2c20  rrange columns, 
-000106d0: 646f 6e65 2066 6f72 2075 7320 696e 2076  done for us in v
-000106e0: 6f6c 756d 655f 6f63 7628 290d 0a20 2020  olume_ocv()..   
-000106f0: 2069 7465 6d20 3d20 766f 6c75 6d65 5f6f   item = volume_o
-00010700: 6376 2864 6174 6173 7263 2c20 6361 6e64  cv(datasrc, cand
-00010710: 6c65 5f77 6964 7468 3d77 6964 7468 2c20  le_width=width, 
-00010720: 6178 3d61 782c 2063 6f6c 6f72 6675 6e63  ax=ax, colorfunc
-00010730: 3d63 6f6c 6f72 6675 6e63 290d 0a20 2020  =colorfunc)..   
-00010740: 2069 7465 6d2e 7570 6461 7465 5f64 6174   item.update_dat
-00010750: 6120 3d20 7061 7274 6961 6c28 5f75 7064  a = partial(_upd
-00010760: 6174 655f 6461 7461 2c20 4e6f 6e65 2c20  ate_data, None, 
-00010770: 5f61 646a 7573 745f 6261 725f 6461 7461  _adjust_bar_data
-00010780: 7372 632c 2069 7465 6d29 0d0a 2020 2020  src, item)..    
-00010790: 6974 656d 2e75 7064 6174 655f 6766 7820  item.update_gfx 
-000107a0: 3d20 7061 7274 6961 6c28 5f75 7064 6174  = partial(_updat
-000107b0: 655f 6766 782c 2069 7465 6d29 0d0a 2020  e_gfx, item)..  
-000107c0: 2020 6178 2e76 622e 7072 655f 7072 6f63    ax.vb.pre_proc
-000107d0: 6573 735f 6461 7461 2829 0d0a 2020 2020  ess_data()..    
-000107e0: 6966 2061 782e 7662 2e79 5f6d 696e 203e  if ax.vb.y_min >
-000107f0: 3d20 303a 0d0a 2020 2020 2020 2020 6178  = 0:..        ax
-00010800: 2e76 622e 765f 7a6f 6f6d 5f62 6173 656c  .vb.v_zoom_basel
-00010810: 696e 6520 3d20 300d 0a20 2020 2072 6574  ine = 0..    ret
-00010820: 7572 6e20 6974 656d 0d0a 0d0a 0d0a 6465  urn item......de
-00010830: 6620 6869 7374 2878 2c20 6269 6e73 2c20  f hist(x, bins, 
-00010840: 6178 3d4e 6f6e 652c 202a 2a6b 7761 7267  ax=None, **kwarg
-00010850: 7329 3a0d 0a20 2020 2068 6973 745f 6461  s):..    hist_da
-00010860: 7461 203d 2070 642e 6375 7428 782c 2062  ta = pd.cut(x, b
-00010870: 696e 733d 6269 6e73 292e 7661 6c75 655f  ins=bins).value_
-00010880: 636f 756e 7473 2829 0d0a 2020 2020 6461  counts()..    da
-00010890: 7461 203d 205b 2869 2e6d 6964 2c30 2c68  ta = [(i.mid,0,h
-000108a0: 6973 745f 6461 7461 2e6c 6f63 5b69 5d2c  ist_data.loc[i],
-000108b0: 6869 7374 5f64 6174 612e 6c6f 635b 695d  hist_data.loc[i]
-000108c0: 2920 666f 7220 6920 696e 2073 6f72 7465  ) for i in sorte
-000108d0: 6428 6869 7374 5f64 6174 612e 696e 6465  d(hist_data.inde
-000108e0: 7829 5d0d 0a20 2020 2064 6620 3d20 7064  x)]..    df = pd
-000108f0: 2e44 6174 6146 7261 6d65 2864 6174 612c  .DataFrame(data,
-00010900: 2063 6f6c 756d 6e73 3d5b 2778 272c 275f   columns=['x','_
-00010910: 6f70 5f27 2c27 5f63 6c5f 272c 2762 696e  op_','_cl_','bin
-00010920: 275d 290d 0a20 2020 2064 662e 7365 745f  '])..    df.set_
-00010930: 696e 6465 7828 2778 272c 2069 6e70 6c61  index('x', inpla
-00010940: 6365 3d54 7275 6529 0d0a 2020 2020 6974  ce=True)..    it
-00010950: 656d 203d 2062 6172 2864 662c 2061 783d  em = bar(df, ax=
-00010960: 6178 290d 0a20 2020 2064 656c 2069 7465  ax)..    del ite
-00010970: 6d2e 7570 6461 7465 5f64 6174 610d 0a20  m.update_data.. 
-00010980: 2020 2072 6574 7572 6e20 6974 656d 0d0a     return item..
-00010990: 0d0a 0d0a 6465 6620 706c 6f74 2878 2c20  ....def plot(x, 
-000109a0: 793d 4e6f 6e65 2c20 636f 6c6f 723d 4e6f  y=None, color=No
-000109b0: 6e65 2c20 7769 6474 683d 312c 2061 783d  ne, width=1, ax=
-000109c0: 4e6f 6e65 2c20 7374 796c 653d 4e6f 6e65  None, style=None
-000109d0: 2c20 6c65 6765 6e64 3d4e 6f6e 652c 207a  , legend=None, z
-000109e0: 6f6f 6d73 6361 6c65 3d54 7275 652c 202a  oomscale=True, *
-000109f0: 2a6b 7761 7267 7329 3a0d 0a20 2020 2061  *kwargs):..    a
-00010a00: 7820 3d20 5f63 7265 6174 655f 706c 6f74  x = _create_plot
-00010a10: 2861 783d 6178 2c20 6d61 7869 6d69 7a65  (ax=ax, maximize
-00010a20: 3d46 616c 7365 290d 0a20 2020 2075 7365  =False)..    use
-00010a30: 645f 636f 6c6f 7220 3d20 5f67 6574 5f63  d_color = _get_c
-00010a40: 6f6c 6f72 2861 782c 2073 7479 6c65 2c20  olor(ax, style, 
-00010a50: 636f 6c6f 7229 0d0a 2020 2020 6461 7461  color)..    data
-00010a60: 7372 6320 3d20 5f63 7265 6174 655f 6461  src = _create_da
-00010a70: 7461 7372 6328 6178 2c20 782c 2079 2c20  tasrc(ax, x, y, 
-00010a80: 6e63 6f6c 733d 3129 0d0a 2020 2020 6966  ncols=1)..    if
-00010a90: 206e 6f74 207a 6f6f 6d73 6361 6c65 3a0d   not zoomscale:.
-00010aa0: 0a20 2020 2020 2020 2064 6174 6173 7263  .        datasrc
-00010ab0: 2e73 6361 6c65 5f63 6f6c 7320 3d20 5b5d  .scale_cols = []
-00010ac0: 0d0a 2020 2020 5f73 6574 5f64 6174 6173  ..    _set_datas
-00010ad0: 7263 2861 782c 2064 6174 6173 7263 290d  rc(ax, datasrc).
-00010ae0: 0a20 2020 2069 6620 6c65 6765 6e64 2069  .    if legend i
-00010af0: 7320 6e6f 7420 4e6f 6e65 3a0d 0a20 2020  s not None:..   
-00010b00: 2020 2020 205f 6372 6561 7465 5f6c 6567       _create_leg
-00010b10: 656e 6428 6178 290d 0a20 2020 2078 203d  end(ax)..    x =
-00010b20: 2064 6174 6173 7263 2e78 2069 6620 6e6f   datasrc.x if no
-00010b30: 7420 6178 2e76 622e 785f 696e 6465 7865  t ax.vb.x_indexe
-00010b40: 6420 656c 7365 2064 6174 6173 7263 2e69  d else datasrc.i
-00010b50: 6e64 6578 0d0a 2020 2020 7920 3d20 6461  ndex..    y = da
-00010b60: 7461 7372 632e 7920 2f20 6178 2e76 622e  tasrc.y / ax.vb.
-00010b70: 7973 6361 6c65 2e73 6361 6c65 660d 0a20  yscale.scalef.. 
-00010b80: 2020 2069 6620 6178 2e76 622e 7973 6361     if ax.vb.ysca
-00010b90: 6c65 2e73 6361 6c65 7479 7065 203d 3d20  le.scaletype == 
-00010ba0: 276c 6f67 273a 0d0a 2020 2020 2020 2020  'log':..        
-00010bb0: 7920 3d20 7920 2b20 6c6f 675f 706c 6f74  y = y + log_plot
-00010bc0: 5f6f 6666 7365 740d 0a20 2020 2069 6620  _offset..    if 
-00010bd0: 7374 796c 6520 6973 204e 6f6e 6520 6f72  style is None or
-00010be0: 2061 6e79 2863 6820 696e 2073 7479 6c65   any(ch in style
-00010bf0: 2066 6f72 2063 6820 696e 2027 2d5f 2e27   for ch in '-_.'
-00010c00: 293a 0d0a 2020 2020 2020 2020 636f 6e6e  ):..        conn
-00010c10: 6563 745f 646f 7473 203d 2027 6669 6e69  ect_dots = 'fini
-00010c20: 7465 2720 2320 7361 6d65 2061 7320 6d61  te' # same as ma
-00010c30: 7470 6c6f 746c 6962 3b20 7573 6520 6461  tplotlib; use da
-00010c40: 7461 7372 632e 7374 616e 6461 6c6f 6e65  tasrc.standalone
-00010c50: 3d54 7275 6520 6966 2079 6f75 2077 616e  =True if you wan
-00010c60: 7420 746f 206b 6565 7020 7365 7061 7261  t to keep separa
-00010c70: 7465 2069 6e74 6572 7661 6c73 206f 6e20  te intervals on 
-00010c80: 6120 706c 6f74 0d0a 2020 2020 2020 2020  a plot..        
-00010c90: 6974 656d 203d 2061 782e 706c 6f74 2878  item = ax.plot(x
-00010ca0: 2c20 792c 2070 656e 3d5f 6d61 6b65 7065  , y, pen=_makepe
-00010cb0: 6e28 636f 6c6f 723d 7573 6564 5f63 6f6c  n(color=used_col
-00010cc0: 6f72 2c20 7374 796c 653d 7374 796c 652c  or, style=style,
-00010cd0: 2077 6964 7468 3d77 6964 7468 292c 206e   width=width), n
-00010ce0: 616d 653d 6c65 6765 6e64 2c20 636f 6e6e  ame=legend, conn
-00010cf0: 6563 743d 636f 6e6e 6563 745f 646f 7473  ect=connect_dots
-00010d00: 290d 0a20 2020 2020 2020 2069 7465 6d2e  )..        item.
-00010d10: 7365 7443 6c69 7054 6f56 6965 7728 5472  setClipToView(Tr
-00010d20: 7565 290d 0a20 2020 2020 2020 2069 7465  ue)..        ite
-00010d30: 6d2e 7365 7444 6f77 6e73 616d 706c 696e  m.setDownsamplin
-00010d40: 6728 6175 746f 3d54 7275 652c 206d 6574  g(auto=True, met
-00010d50: 686f 643d 2773 7562 7361 6d70 6c65 2729  hod='subsample')
-00010d60: 0d0a 2020 2020 2020 2020 6974 656d 2e73  ..        item.s
-00010d70: 6574 5a56 616c 7565 2835 290d 0a20 2020  etZValue(5)..   
-00010d80: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
-00010d90: 7379 6d62 6f6c 203d 207b 2776 273a 2774  symbol = {'v':'t
-00010da0: 272c 2027 5e27 3a27 7431 272c 2027 3e27  ', '^':'t1', '>'
-00010db0: 3a27 7432 272c 2027 3c27 3a27 7433 277d  :'t2', '<':'t3'}
-00010dc0: 2e67 6574 2873 7479 6c65 2c20 7374 796c  .get(style, styl
-00010dd0: 6529 2023 2074 7261 6e73 6c61 7465 2073  e) # translate s
-00010de0: 6f6d 6520 7369 6d69 6c61 7220 7374 796c  ome similar styl
-00010df0: 6573 0d0a 2020 2020 2020 2020 7966 696c  es..        yfil
-00010e00: 7465 7220 3d20 792e 6e6f 746e 756c 6c28  ter = y.notnull(
-00010e10: 290d 0a20 2020 2020 2020 2073 6572 203d  )..        ser =
-00010e20: 2079 2e6c 6f63 5b79 6669 6c74 6572 5d0d   y.loc[yfilter].
-00010e30: 0a20 2020 2020 2020 2078 203d 2078 2e6c  .        x = x.l
-00010e40: 6f63 5b79 6669 6c74 6572 5d2e 7661 6c75  oc[yfilter].valu
-00010e50: 6573 2069 6620 6861 7361 7474 7228 782c  es if hasattr(x,
-00010e60: 2027 6c6f 6327 2920 656c 7365 2078 5b79   'loc') else x[y
-00010e70: 6669 6c74 6572 5d0d 0a20 2020 2020 2020  filter]..       
-00010e80: 2069 7465 6d20 3d20 6178 2e70 6c6f 7428   item = ax.plot(
-00010e90: 782c 2073 6572 2e76 616c 7565 732c 2070  x, ser.values, p
-00010ea0: 656e 3d4e 6f6e 652c 2073 796d 626f 6c3d  en=None, symbol=
-00010eb0: 7379 6d62 6f6c 2c20 7379 6d62 6f6c 5065  symbol, symbolPe
-00010ec0: 6e3d 4e6f 6e65 2c20 7379 6d62 6f6c 5369  n=None, symbolSi
-00010ed0: 7a65 3d37 2a77 6964 7468 2c20 7379 6d62  ze=7*width, symb
-00010ee0: 6f6c 4272 7573 683d 7067 2e6d 6b42 7275  olBrush=pg.mkBru
-00010ef0: 7368 2875 7365 645f 636f 6c6f 7229 2c20  sh(used_color), 
-00010f00: 6e61 6d65 3d6c 6567 656e 6429 0d0a 2020  name=legend)..  
-00010f10: 2020 2020 2020 6966 2077 6964 7468 203c        if width <
-00010f20: 2031 3a0d 0a20 2020 2020 2020 2020 2020   1:..           
-00010f30: 2069 7465 6d2e 6f70 7473 5b27 616e 7469   item.opts['anti
-00010f40: 616c 6961 7327 5d20 3d20 5472 7565 0d0a  alias'] = True..
-00010f50: 2020 2020 2020 2020 6974 656d 2e73 6361          item.sca
-00010f60: 7474 6572 2e5f 646f 7061 696e 7420 3d20  tter._dopaint = 
-00010f70: 6974 656d 2e73 6361 7474 6572 2e70 6169  item.scatter.pai
-00010f80: 6e74 0d0a 2020 2020 2020 2020 6974 656d  nt..        item
-00010f90: 2e73 6361 7474 6572 2e70 6169 6e74 203d  .scatter.paint =
-00010fa0: 2070 6172 7469 616c 285f 7061 696e 745f   partial(_paint_
-00010fb0: 7363 6174 7465 722c 2069 7465 6d2e 7363  scatter, item.sc
-00010fc0: 6174 7465 7229 0d0a 2020 2020 2020 2020  atter)..        
-00010fd0: 2320 6f70 7469 6d69 7a65 2028 7768 656e  # optimize (when
-00010fe0: 2068 6176 696e 6720 6c61 7267 6520 6e75   having large nu
-00010ff0: 6d62 6572 206f 6620 706f 696e 7473 2920  mber of points) 
-00011000: 6279 2069 676e 6f72 696e 6720 7363 6174  by ignoring scat
-00011010: 7465 7220 636c 6963 6b20 6465 7465 6374  ter click detect
-00011020: 696f 6e0d 0a20 2020 2020 2020 205f 6475  ion..        _du
-00011030: 6d6d 795f 6d6f 7573 655f 636c 6963 6b20  mmy_mouse_click 
-00011040: 3d20 6c61 6d62 6461 2065 763a 2030 0d0a  = lambda ev: 0..
-00011050: 2020 2020 2020 2020 6974 656d 2e73 6361          item.sca
-00011060: 7474 6572 2e6d 6f75 7365 436c 6963 6b45  tter.mouseClickE
-00011070: 7665 6e74 203d 205f 6475 6d6d 795f 6d6f  vent = _dummy_mo
-00011080: 7573 655f 636c 6963 6b0d 0a20 2020 2020  use_click..     
-00011090: 2020 2069 7465 6d2e 7365 745a 5661 6c75     item.setZValu
-000110a0: 6528 3130 290d 0a20 2020 2069 7465 6d2e  e(10)..    item.
-000110b0: 6f70 7473 5b27 6861 6e64 6564 5f63 6f6c  opts['handed_col
-000110c0: 6f72 275d 203d 2063 6f6c 6f72 0d0a 2020  or'] = color..  
-000110d0: 2020 6974 656d 2e61 7820 3d20 6178 0d0a    item.ax = ax..
-000110e0: 2020 2020 6974 656d 2e64 6174 6173 7263      item.datasrc
-000110f0: 203d 2064 6174 6173 7263 0d0a 2020 2020   = datasrc..    
-00011100: 5f75 7064 6174 655f 7369 676e 6966 6963  _update_signific
-00011110: 616e 7473 2861 782c 2064 6174 6173 7263  ants(ax, datasrc
-00011120: 2c20 666f 7263 653d 4661 6c73 6529 0d0a  , force=False)..
-00011130: 2020 2020 6974 656d 2e75 7064 6174 655f      item.update_
-00011140: 6461 7461 203d 2070 6172 7469 616c 285f  data = partial(_
-00011150: 7570 6461 7465 5f64 6174 612c 204e 6f6e  update_data, Non
-00011160: 652c 204e 6f6e 652c 2069 7465 6d29 0d0a  e, None, item)..
-00011170: 2020 2020 6974 656d 2e75 7064 6174 655f      item.update_
-00011180: 6766 7820 3d20 7061 7274 6961 6c28 5f75  gfx = partial(_u
-00011190: 7064 6174 655f 6766 782c 2069 7465 6d29  pdate_gfx, item)
-000111a0: 0d0a 2020 2020 2320 6164 6420 6c65 6765  ..    # add lege
-000111b0: 6e64 2074 6f20 6d61 696e 2061 782c 206e  nd to main ax, n
-000111c0: 6f74 2074 6f20 6f76 6572 6c61 790d 0a20  ot to overlay.. 
-000111d0: 2020 2061 786d 203d 2061 782e 7662 2e6d     axm = ax.vb.m
-000111e0: 6173 7465 725f 7669 6577 626f 782e 7061  aster_viewbox.pa
-000111f0: 7265 6e74 2829 2069 6620 6178 2e76 622e  rent() if ax.vb.
-00011200: 6d61 7374 6572 5f76 6965 7762 6f78 2065  master_viewbox e
-00011210: 6c73 6520 6178 0d0a 2020 2020 6966 2061  lse ax..    if a
-00011220: 786d 2e6c 6567 656e 6420 6973 206e 6f74  xm.legend is not
-00011230: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
-00011240: 6966 206c 6567 656e 6420 616e 6420 6178  if legend and ax
-00011250: 6d20 213d 2061 783a 0d0a 2020 2020 2020  m != ax:..      
-00011260: 2020 2020 2020 6178 6d2e 6c65 6765 6e64        axm.legend
-00011270: 2e61 6464 4974 656d 2869 7465 6d2c 206e  .addItem(item, n
-00011280: 616d 653d 6c65 6765 6e64 290d 0a20 2020  ame=legend)..   
-00011290: 2020 2020 2066 6f72 205f 2c6c 6162 656c       for _,label
-000112a0: 2069 6e20 6178 6d2e 6c65 6765 6e64 2e69   in axm.legend.i
-000112b0: 7465 6d73 3a0d 0a20 2020 2020 2020 2020  tems:..         
-000112c0: 2020 2069 6620 6c61 6265 6c2e 7465 7874     if label.text
-000112d0: 203d 3d20 6c65 6765 6e64 3a0d 0a20 2020   == legend:..   
-000112e0: 2020 2020 2020 2020 2020 2020 206c 6162               lab
-000112f0: 656c 2e73 6574 4174 7472 2827 6a75 7374  el.setAttr('just
-00011300: 6966 7927 2c20 276c 6566 7427 290d 0a20  ify', 'left').. 
-00011310: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-00011320: 6162 656c 2e73 6574 5465 7874 286c 6162  abel.setText(lab
-00011330: 656c 2e74 6578 742c 2063 6f6c 6f72 3d6c  el.text, color=l
-00011340: 6567 656e 645f 7465 7874 5f63 6f6c 6f72  egend_text_color
-00011350: 290d 0a20 2020 2072 6574 7572 6e20 6974  )..    return it
-00011360: 656d 0d0a 0d0a 0d0a 6465 6620 6c61 6265  em......def labe
-00011370: 6c73 2878 2c20 793d 4e6f 6e65 2c20 6c61  ls(x, y=None, la
-00011380: 6265 6c73 3d4e 6f6e 652c 2063 6f6c 6f72  bels=None, color
-00011390: 3d4e 6f6e 652c 2061 783d 4e6f 6e65 2c20  =None, ax=None, 
-000113a0: 616e 6368 6f72 3d28 302e 352c 3129 293a  anchor=(0.5,1)):
-000113b0: 0d0a 2020 2020 6178 203d 205f 6372 6561  ..    ax = _crea
-000113c0: 7465 5f70 6c6f 7428 6178 3d61 782c 206d  te_plot(ax=ax, m
-000113d0: 6178 696d 697a 653d 4661 6c73 6529 0d0a  aximize=False)..
-000113e0: 2020 2020 7573 6564 5f63 6f6c 6f72 203d      used_color =
-000113f0: 205f 6765 745f 636f 6c6f 7228 6178 2c20   _get_color(ax, 
-00011400: 273f 272c 2063 6f6c 6f72 290d 0a20 2020  '?', color)..   
-00011410: 2064 6174 6173 7263 203d 205f 6372 6561   datasrc = _crea
-00011420: 7465 5f64 6174 6173 7263 2861 782c 2078  te_datasrc(ax, x
-00011430: 2c20 792c 206c 6162 656c 732c 206e 636f  , y, labels, nco
-00011440: 6c73 3d33 290d 0a20 2020 2064 6174 6173  ls=3)..    datas
-00011450: 7263 2e73 6361 6c65 5f63 6f6c 7320 3d20  rc.scale_cols = 
-00011460: 5b5d 2023 2064 6f6e 2774 2075 7365 2074  [] # don't use t
-00011470: 6869 7320 666f 7220 7363 616c 696e 670d  his for scaling.
-00011480: 0a20 2020 205f 7365 745f 6461 7461 7372  .    _set_datasr
-00011490: 6328 6178 2c20 6461 7461 7372 6329 0d0a  c(ax, datasrc)..
-000114a0: 2020 2020 6974 656d 203d 2053 6361 7474      item = Scatt
-000114b0: 6572 4c61 6265 6c49 7465 6d28 6178 3d61  erLabelItem(ax=a
-000114c0: 782c 2064 6174 6173 7263 3d64 6174 6173  x, datasrc=datas
-000114d0: 7263 2c20 636f 6c6f 723d 7573 6564 5f63  rc, color=used_c
-000114e0: 6f6c 6f72 2c20 616e 6368 6f72 3d61 6e63  olor, anchor=anc
-000114f0: 686f 7229 0d0a 2020 2020 5f75 7064 6174  hor)..    _updat
-00011500: 655f 7369 676e 6966 6963 616e 7473 2861  e_significants(a
-00011510: 782c 2064 6174 6173 7263 2c20 666f 7263  x, datasrc, forc
-00011520: 653d 4661 6c73 6529 0d0a 2020 2020 6974  e=False)..    it
-00011530: 656d 2e75 7064 6174 655f 6461 7461 203d  em.update_data =
-00011540: 2070 6172 7469 616c 285f 7570 6461 7465   partial(_update
-00011550: 5f64 6174 612c 204e 6f6e 652c 204e 6f6e  _data, None, Non
-00011560: 652c 2069 7465 6d29 0d0a 2020 2020 6974  e, item)..    it
-00011570: 656d 2e75 7064 6174 655f 6766 7820 3d20  em.update_gfx = 
-00011580: 7061 7274 6961 6c28 5f75 7064 6174 655f  partial(_update_
-00011590: 6766 782c 2069 7465 6d29 0d0a 2020 2020  gfx, item)..    
-000115a0: 6178 2e61 6464 4974 656d 2869 7465 6d29  ax.addItem(item)
-000115b0: 0d0a 2020 2020 6966 2061 782e 7662 2e76  ..    if ax.vb.v
-000115c0: 5f7a 6f6f 6d5f 7363 616c 6520 3e20 302e  _zoom_scale > 0.
-000115d0: 393a 2023 2061 646a 7573 7420 746f 206d  9: # adjust to m
-000115e0: 616b 6520 6869 2f6c 6f20 7465 7874 2066  ake hi/lo text f
-000115f0: 6974 0d0a 2020 2020 2020 2020 6178 2e76  it..        ax.v
-00011600: 622e 765f 7a6f 6f6d 5f73 6361 6c65 203d  b.v_zoom_scale =
-00011610: 2030 2e39 0d0a 2020 2020 7265 7475 726e   0.9..    return
-00011620: 2069 7465 6d0d 0a0d 0a0d 0a64 6566 206c   item......def l
-00011630: 6976 6528 706c 6f74 733d 3129 3a0d 0a20  ive(plots=1):.. 
-00011640: 2020 2069 6620 706c 6f74 7320 3d3d 2031     if plots == 1
-00011650: 3a0d 0a20 2020 2020 2020 2072 6574 7572  :..        retur
-00011660: 6e20 4c69 7665 2829 0d0a 2020 2020 7265  n Live()..    re
-00011670: 7475 726e 205b 4c69 7665 2829 2066 6f72  turn [Live() for
-00011680: 205f 2069 6e20 7261 6e67 6528 706c 6f74   _ in range(plot
-00011690: 7329 5d0d 0a0d 0a0d 0a64 6566 2061 6464  s)]......def add
-000116a0: 5f6c 6567 656e 6428 7465 7874 2c20 6178  _legend(text, ax
-000116b0: 3d4e 6f6e 6529 3a0d 0a20 2020 2061 7820  =None):..    ax 
-000116c0: 3d20 5f63 7265 6174 655f 706c 6f74 2861  = _create_plot(a
-000116d0: 783d 6178 2c20 6d61 7869 6d69 7a65 3d46  x=ax, maximize=F
-000116e0: 616c 7365 290d 0a20 2020 205f 6372 6561  alse)..    _crea
-000116f0: 7465 5f6c 6567 656e 6428 6178 290d 0a20  te_legend(ax).. 
-00011700: 2020 2072 6f77 203d 2061 782e 6c65 6765     row = ax.lege
-00011710: 6e64 2e6c 6179 6f75 742e 726f 7743 6f75  nd.layout.rowCou
-00011720: 6e74 2829 0d0a 2020 2020 6c61 6265 6c20  nt()..    label 
-00011730: 3d20 7067 2e4c 6162 656c 4974 656d 2874  = pg.LabelItem(t
-00011740: 6578 742c 2063 6f6c 6f72 3d6c 6567 656e  ext, color=legen
-00011750: 645f 7465 7874 5f63 6f6c 6f72 2c20 6a75  d_text_color, ju
-00011760: 7374 6966 793d 276c 6566 7427 290d 0a20  stify='left').. 
-00011770: 2020 2061 782e 6c65 6765 6e64 2e6c 6179     ax.legend.lay
-00011780: 6f75 742e 6164 6449 7465 6d28 6c61 6265  out.addItem(labe
-00011790: 6c2c 2072 6f77 2c20 302c 2031 2c20 3229  l, row, 0, 1, 2)
-000117a0: 0d0a 2020 2020 7265 7475 726e 206c 6162  ..    return lab
-000117b0: 656c 0d0a 0d0a 0d0a 6465 6620 6669 6c6c  el......def fill
-000117c0: 5f62 6574 7765 656e 2870 6c6f 7430 2c20  _between(plot0, 
-000117d0: 706c 6f74 312c 2063 6f6c 6f72 3d4e 6f6e  plot1, color=Non
-000117e0: 6529 3a0d 0a20 2020 2075 7365 645f 636f  e):..    used_co
-000117f0: 6c6f 7220 3d20 6272 6967 6874 656e 285f  lor = brighten(_
-00011800: 6765 745f 636f 6c6f 7228 706c 6f74 302e  get_color(plot0.
-00011810: 6178 2c20 4e6f 6e65 2c20 636f 6c6f 7229  ax, None, color)
-00011820: 2c20 312e 3329 0d0a 2020 2020 6974 656d  , 1.3)..    item
-00011830: 203d 2070 672e 4669 6c6c 4265 7477 6565   = pg.FillBetwee
-00011840: 6e49 7465 6d28 706c 6f74 302c 2070 6c6f  nItem(plot0, plo
-00011850: 7431 2c20 6272 7573 683d 7067 2e6d 6b42  t1, brush=pg.mkB
-00011860: 7275 7368 2875 7365 645f 636f 6c6f 7229  rush(used_color)
-00011870: 290d 0a20 2020 2069 7465 6d2e 6178 203d  )..    item.ax =
-00011880: 2070 6c6f 7430 2e61 780d 0a20 2020 2069   plot0.ax..    i
-00011890: 7465 6d2e 7365 745a 5661 6c75 6528 2d34  tem.setZValue(-4
-000118a0: 3029 0d0a 2020 2020 6974 656d 2e61 782e  0)..    item.ax.
-000118b0: 6164 6449 7465 6d28 6974 656d 290d 0a20  addItem(item).. 
-000118c0: 2020 2072 6574 7572 6e20 6974 656d 0d0a     return item..
-000118d0: 0d0a 0d0a 6465 6620 7365 745f 785f 706f  ....def set_x_po
-000118e0: 7328 786d 696e 2c20 786d 6178 2c20 6178  s(xmin, xmax, ax
-000118f0: 3d4e 6f6e 6529 3a0d 0a20 2020 2061 7820  =None):..    ax 
-00011900: 3d20 5f63 7265 6174 655f 706c 6f74 2861  = _create_plot(a
-00011910: 783d 6178 2c20 6d61 7869 6d69 7a65 3d46  x=ax, maximize=F
-00011920: 616c 7365 290d 0a20 2020 2078 6964 7830  alse)..    xidx0
-00011930: 2c78 6964 7831 203d 205f 7064 7469 6d65  ,xidx1 = _pdtime
-00011940: 3269 6e64 6578 2861 782c 2070 642e 5365  2index(ax, pd.Se
-00011950: 7269 6573 285b 786d 696e 2c20 786d 6178  ries([xmin, xmax
-00011960: 5d29 290d 0a20 2020 2061 782e 7662 2e75  ]))..    ax.vb.u
-00011970: 7064 6174 655f 795f 7a6f 6f6d 2878 6964  pdate_y_zoom(xid
-00011980: 7830 2c20 7869 6478 3129 0d0a 2020 2020  x0, xidx1)..    
-00011990: 5f72 6570 6169 6e74 5f63 616e 646c 6573  _repaint_candles
-000119a0: 2829 0d0a 0d0a 0d0a 6465 6620 7365 745f  ()......def set_
-000119b0: 795f 7261 6e67 6528 796d 696e 2c20 796d  y_range(ymin, ym
-000119c0: 6178 2c20 6178 3d4e 6f6e 6529 3a0d 0a20  ax, ax=None):.. 
-000119d0: 2020 2061 7820 3d20 5f63 7265 6174 655f     ax = _create_
-000119e0: 706c 6f74 2861 783d 6178 2c20 6d61 7869  plot(ax=ax, maxi
-000119f0: 6d69 7a65 3d46 616c 7365 290d 0a20 2020  mize=False)..   
-00011a00: 2061 782e 7365 744c 696d 6974 7328 794d   ax.setLimits(yM
-00011a10: 696e 3d79 6d69 6e2c 2079 4d61 783d 796d  in=ymin, yMax=ym
-00011a20: 6178 290d 0a20 2020 2061 782e 7662 2e76  ax)..    ax.vb.v
-00011a30: 5f61 7574 6f7a 6f6f 6d20 3d20 4661 6c73  _autozoom = Fals
-00011a40: 650d 0a20 2020 2061 782e 7662 2e73 6574  e..    ax.vb.set
-00011a50: 5f72 616e 6765 284e 6f6e 652c 2079 6d69  _range(None, ymi
-00011a60: 6e2c 204e 6f6e 652c 2079 6d61 7829 0d0a  n, None, ymax)..
-00011a70: 0d0a 0d0a 6465 6620 7365 745f 795f 7363  ....def set_y_sc
-00011a80: 616c 6528 7973 6361 6c65 3d27 6c69 6e65  ale(yscale='line
-00011a90: 6172 272c 2061 783d 4e6f 6e65 293a 0d0a  ar', ax=None):..
-00011aa0: 2020 2020 6178 203d 205f 6372 6561 7465      ax = _create
-00011ab0: 5f70 6c6f 7428 6178 3d61 782c 206d 6178  _plot(ax=ax, max
-00011ac0: 696d 697a 653d 4661 6c73 6529 0d0a 2020  imize=False)..  
-00011ad0: 2020 6178 2e73 6574 4c6f 674d 6f64 6528    ax.setLogMode(
-00011ae0: 793d 2879 7363 616c 653d 3d27 6c6f 6727  y=(yscale=='log'
-00011af0: 2929 0d0a 2020 2020 6178 2e76 622e 7973  ))..    ax.vb.ys
-00011b00: 6361 6c65 203d 2059 5363 616c 6528 7973  cale = YScale(ys
-00011b10: 6361 6c65 2c20 6178 2e76 622e 7973 6361  cale, ax.vb.ysca
-00011b20: 6c65 2e73 6361 6c65 6629 0d0a 0d0a 0d0a  le.scalef)......
-00011b30: 6465 6620 6164 645f 6261 6e64 2879 302c  def add_band(y0,
-00011b40: 2079 312c 2063 6f6c 6f72 3d62 616e 645f   y1, color=band_
-00011b50: 636f 6c6f 722c 2061 783d 4e6f 6e65 293a  color, ax=None):
-00011b60: 0d0a 2020 2020 6178 203d 205f 6372 6561  ..    ax = _crea
-00011b70: 7465 5f70 6c6f 7428 6178 3d61 782c 206d  te_plot(ax=ax, m
-00011b80: 6178 696d 697a 653d 4661 6c73 6529 0d0a  aximize=False)..
-00011b90: 2020 2020 636f 6c6f 7220 3d20 5f67 6574      color = _get
-00011ba0: 5f63 6f6c 6f72 2861 782c 204e 6f6e 652c  _color(ax, None,
-00011bb0: 2063 6f6c 6f72 290d 0a20 2020 2069 7820   color)..    ix 
-00011bc0: 3d20 6178 2e76 622e 7973 6361 6c65 2e69  = ax.vb.yscale.i
-00011bd0: 6e76 7866 6f72 6d0d 0a20 2020 206c 7220  nvxform..    lr 
-00011be0: 3d20 7067 2e4c 696e 6561 7252 6567 696f  = pg.LinearRegio
-00011bf0: 6e49 7465 6d28 5b69 7828 7930 292c 6978  nItem([ix(y0),ix
-00011c00: 2879 3129 5d2c 206f 7269 656e 7461 7469  (y1)], orientati
-00011c10: 6f6e 3d70 672e 4c69 6e65 6172 5265 6769  on=pg.LinearRegi
-00011c20: 6f6e 4974 656d 2e48 6f72 697a 6f6e 7461  onItem.Horizonta
-00011c30: 6c2c 2062 7275 7368 3d70 672e 6d6b 4272  l, brush=pg.mkBr
-00011c40: 7573 6828 636f 6c6f 7229 2c20 6d6f 7661  ush(color), mova
-00011c50: 626c 653d 4661 6c73 6529 0d0a 2020 2020  ble=False)..    
-00011c60: 6c72 2e6c 696e 6573 5b30 5d2e 7365 7450  lr.lines[0].setP
-00011c70: 656e 2870 672e 6d6b 5065 6e28 4e6f 6e65  en(pg.mkPen(None
-00011c80: 2929 0d0a 2020 2020 6c72 2e6c 696e 6573  ))..    lr.lines
-00011c90: 5b31 5d2e 7365 7450 656e 2870 672e 6d6b  [1].setPen(pg.mk
-00011ca0: 5065 6e28 4e6f 6e65 2929 0d0a 2020 2020  Pen(None))..    
-00011cb0: 6c72 2e73 6574 5a56 616c 7565 282d 3530  lr.setZValue(-50
-00011cc0: 290d 0a20 2020 206c 722e 6178 203d 2061  )..    lr.ax = a
-00011cd0: 780d 0a20 2020 2061 782e 6164 6449 7465  x..    ax.addIte
-00011ce0: 6d28 6c72 290d 0a20 2020 2072 6574 7572  m(lr)..    retur
-00011cf0: 6e20 6c72 0d0a 0d0a 0d0a 6465 6620 6164  n lr......def ad
-00011d00: 645f 7265 6374 2870 302c 2070 312c 2063  d_rect(p0, p1, c
-00011d10: 6f6c 6f72 3d62 616e 645f 636f 6c6f 722c  olor=band_color,
-00011d20: 2069 6e74 6572 6163 7469 7665 3d46 616c   interactive=Fal
-00011d30: 7365 2c20 6178 3d4e 6f6e 6529 3a0d 0a20  se, ax=None):.. 
-00011d40: 2020 2061 7820 3d20 5f63 7265 6174 655f     ax = _create_
-00011d50: 706c 6f74 2861 783d 6178 2c20 6d61 7869  plot(ax=ax, maxi
-00011d60: 6d69 7a65 3d46 616c 7365 290d 0a20 2020  mize=False)..   
-00011d70: 2078 5f70 7473 203d 205f 7064 7469 6d65   x_pts = _pdtime
-00011d80: 3269 6e64 6578 2861 782c 2070 642e 5365  2index(ax, pd.Se
-00011d90: 7269 6573 285b 7030 5b30 5d2c 2070 315b  ries([p0[0], p1[
-00011da0: 305d 5d29 290d 0a20 2020 2069 7820 3d20  0]]))..    ix = 
-00011db0: 6178 2e76 622e 7973 6361 6c65 2e69 6e76  ax.vb.yscale.inv
-00011dc0: 7866 6f72 6d0d 0a20 2020 2079 302c 7931  xform..    y0,y1
-00011dd0: 203d 2073 6f72 7465 6428 5b70 305b 315d   = sorted([p0[1]
-00011de0: 2c20 7031 5b31 5d5d 290d 0a20 2020 2070  , p1[1]])..    p
-00011df0: 6f73 2020 3d20 2878 5f70 7473 5b30 5d2c  os  = (x_pts[0],
-00011e00: 2069 7828 7930 2929 0d0a 2020 2020 7369   ix(y0))..    si
-00011e10: 7a65 203d 2028 785f 7074 735b 315d 2d70  ze = (x_pts[1]-p
-00011e20: 6f73 5b30 5d2c 2069 7828 7931 292d 6978  os[0], ix(y1)-ix
-00011e30: 2879 3029 290d 0a20 2020 2072 6563 7420  (y0))..    rect 
-00011e40: 3d20 4669 6e52 6563 7428 6178 3d61 782c  = FinRect(ax=ax,
-00011e50: 2062 7275 7368 3d70 672e 6d6b 4272 7573   brush=pg.mkBrus
-00011e60: 6828 636f 6c6f 7229 2c20 706f 733d 706f  h(color), pos=po
-00011e70: 732c 2073 697a 653d 7369 7a65 2c20 6d6f  s, size=size, mo
-00011e80: 7661 626c 653d 696e 7465 7261 6374 6976  vable=interactiv
-00011e90: 652c 2072 6573 697a 6162 6c65 3d69 6e74  e, resizable=int
-00011ea0: 6572 6163 7469 7665 2c20 726f 7461 7461  eractive, rotata
-00011eb0: 626c 653d 4661 6c73 6529 0d0a 2020 2020  ble=False)..    
-00011ec0: 7265 6374 2e73 6574 5a56 616c 7565 282d  rect.setZValue(-
-00011ed0: 3430 290d 0a20 2020 2069 6620 696e 7465  40)..    if inte
-00011ee0: 7261 6374 6976 653a 0d0a 2020 2020 2020  ractive:..      
-00011ef0: 2020 6178 2e76 622e 726f 6973 2e61 7070    ax.vb.rois.app
-00011f00: 656e 6428 7265 6374 290d 0a20 2020 2072  end(rect)..    r
-00011f10: 6563 742e 6178 203d 2061 780d 0a20 2020  ect.ax = ax..   
-00011f20: 2061 782e 6164 6449 7465 6d28 7265 6374   ax.addItem(rect
-00011f30: 290d 0a20 2020 2072 6574 7572 6e20 7265  )..    return re
-00011f40: 6374 0d0a 0d0a 0d0a 6465 6620 6164 645f  ct......def add_
-00011f50: 6c69 6e65 2870 302c 2070 312c 2063 6f6c  line(p0, p1, col
-00011f60: 6f72 3d64 7261 775f 6c69 6e65 5f63 6f6c  or=draw_line_col
-00011f70: 6f72 2c20 7769 6474 683d 312c 2073 7479  or, width=1, sty
-00011f80: 6c65 3d4e 6f6e 652c 2069 6e74 6572 6163  le=None, interac
-00011f90: 7469 7665 3d46 616c 7365 2c20 6178 3d4e  tive=False, ax=N
-00011fa0: 6f6e 6529 3a0d 0a20 2020 2061 7820 3d20  one):..    ax = 
-00011fb0: 5f63 7265 6174 655f 706c 6f74 2861 783d  _create_plot(ax=
-00011fc0: 6178 2c20 6d61 7869 6d69 7a65 3d46 616c  ax, maximize=Fal
-00011fd0: 7365 290d 0a20 2020 2075 7365 645f 636f  se)..    used_co
-00011fe0: 6c6f 7220 3d20 5f67 6574 5f63 6f6c 6f72  lor = _get_color
-00011ff0: 2861 782c 2073 7479 6c65 2c20 636f 6c6f  (ax, style, colo
-00012000: 7229 0d0a 2020 2020 7065 6e20 3d20 5f6d  r)..    pen = _m
-00012010: 616b 6570 656e 2863 6f6c 6f72 3d75 7365  akepen(color=use
-00012020: 645f 636f 6c6f 722c 2073 7479 6c65 3d73  d_color, style=s
-00012030: 7479 6c65 2c20 7769 6474 683d 7769 6474  tyle, width=widt
-00012040: 6829 0d0a 2020 2020 785f 7074 7320 3d20  h)..    x_pts = 
-00012050: 5f70 6474 696d 6532 696e 6465 7828 6178  _pdtime2index(ax
-00012060: 2c20 7064 2e53 6572 6965 7328 5b70 305b  , pd.Series([p0[
-00012070: 305d 2c20 7031 5b30 5d5d 2929 0d0a 2020  0], p1[0]]))..  
-00012080: 2020 6978 203d 2061 782e 7662 2e79 7363    ix = ax.vb.ysc
-00012090: 616c 652e 696e 7678 666f 726d 0d0a 2020  ale.invxform..  
-000120a0: 2020 7074 7320 3d20 5b28 785f 7074 735b    pts = [(x_pts[
-000120b0: 305d 2c20 6978 2870 305b 315d 2929 2c20  0], ix(p0[1])), 
-000120c0: 2878 5f70 7473 5b31 5d2c 2069 7828 7031  (x_pts[1], ix(p1
-000120d0: 5b31 5d29 295d 0d0a 2020 2020 6966 2069  [1]))]..    if i
-000120e0: 6e74 6572 6163 7469 7665 3a0d 0a20 2020  nteractive:..   
-000120f0: 2020 2020 206c 696e 6520 3d20 4669 6e50       line = FinP
-00012100: 6f6c 794c 696e 6528 6178 2e76 622c 2070  olyLine(ax.vb, p
-00012110: 7473 2c20 636c 6f73 6564 3d46 616c 7365  ts, closed=False
-00012120: 2c20 7065 6e3d 7065 6e2c 206d 6f76 6162  , pen=pen, movab
-00012130: 6c65 3d46 616c 7365 290d 0a20 2020 2020  le=False)..     
-00012140: 2020 2061 782e 7662 2e72 6f69 732e 6170     ax.vb.rois.ap
-00012150: 7065 6e64 286c 696e 6529 0d0a 2020 2020  pend(line)..    
-00012160: 656c 7365 3a0d 0a20 2020 2020 2020 206c  else:..        l
-00012170: 696e 6520 3d20 4669 6e4c 696e 6528 7074  ine = FinLine(pt
-00012180: 732c 2070 656e 3d70 656e 290d 0a20 2020  s, pen=pen)..   
-00012190: 206c 696e 652e 6178 203d 2061 780d 0a20   line.ax = ax.. 
-000121a0: 2020 2061 782e 7662 2e61 6464 4974 656d     ax.vb.addItem
-000121b0: 286c 696e 6529 0d0a 2020 2020 7265 7475  (line)..    retu
-000121c0: 726e 206c 696e 650d 0a0d 0a0d 0a64 6566  rn line......def
-000121d0: 2061 6464 5f74 6578 7428 706f 732c 2073   add_text(pos, s
-000121e0: 2c20 636f 6c6f 723d 6472 6177 5f6c 696e  , color=draw_lin
-000121f0: 655f 636f 6c6f 722c 2061 6e63 686f 723d  e_color, anchor=
-00012200: 2830 2c30 292c 2061 783d 4e6f 6e65 293a  (0,0), ax=None):
-00012210: 0d0a 2020 2020 6178 203d 205f 6372 6561  ..    ax = _crea
-00012220: 7465 5f70 6c6f 7428 6178 3d61 782c 206d  te_plot(ax=ax, m
-00012230: 6178 696d 697a 653d 4661 6c73 6529 0d0a  aximize=False)..
-00012240: 2020 2020 636f 6c6f 7220 3d20 5f67 6574      color = _get
-00012250: 5f63 6f6c 6f72 2861 782c 204e 6f6e 652c  _color(ax, None,
-00012260: 2063 6f6c 6f72 290d 0a20 2020 2074 6578   color)..    tex
-00012270: 7420 3d20 7067 2e54 6578 7449 7465 6d28  t = pg.TextItem(
-00012280: 732c 2063 6f6c 6f72 3d63 6f6c 6f72 2c20  s, color=color, 
-00012290: 616e 6368 6f72 3d61 6e63 686f 7229 0d0a  anchor=anchor)..
-000122a0: 2020 2020 7820 3d20 706f 735b 305d 0d0a      x = pos[0]..
-000122b0: 2020 2020 6966 2061 782e 7662 2e64 6174      if ax.vb.dat
-000122c0: 6173 7263 2069 7320 6e6f 7420 4e6f 6e65  asrc is not None
-000122d0: 3a0d 0a20 2020 2020 2020 2078 203d 205f  :..        x = _
-000122e0: 7064 7469 6d65 3269 6e64 6578 2861 782c  pdtime2index(ax,
-000122f0: 2070 642e 5365 7269 6573 285b 706f 735b   pd.Series([pos[
-00012300: 305d 5d29 295b 305d 0d0a 2020 2020 7920  0]]))[0]..    y 
-00012310: 3d20 6178 2e76 622e 7973 6361 6c65 2e69  = ax.vb.yscale.i
-00012320: 6e76 7866 6f72 6d28 706f 735b 315d 290d  nvxform(pos[1]).
-00012330: 0a20 2020 2074 6578 742e 7365 7450 6f73  .    text.setPos
-00012340: 2878 2c20 7929 0d0a 2020 2020 7465 7874  (x, y)..    text
-00012350: 2e73 6574 5a56 616c 7565 2835 3029 0d0a  .setZValue(50)..
-00012360: 2020 2020 7465 7874 2e61 7820 3d20 6178      text.ax = ax
-00012370: 0d0a 2020 2020 6178 2e61 6464 4974 656d  ..    ax.addItem
-00012380: 2874 6578 742c 2069 676e 6f72 6542 6f75  (text, ignoreBou
-00012390: 6e64 733d 5472 7565 290d 0a20 2020 2072  nds=True)..    r
-000123a0: 6574 7572 6e20 7465 7874 0d0a 0d0a 0d0a  eturn text......
-000123b0: 6465 6620 7265 6d6f 7665 5f6c 696e 6528  def remove_line(
-000123c0: 6c69 6e65 293a 0d0a 2020 2020 7072 696e  line):..    prin
-000123d0: 7428 2772 656d 6f76 655f 6c69 6e65 2829  t('remove_line()
-000123e0: 2069 7320 6465 7072 6563 6174 6564 2c20   is deprecated, 
-000123f0: 7573 6520 7265 6d6f 7665 5f70 7269 6d69  use remove_primi
-00012400: 7469 7665 2829 2069 6e73 7465 6164 2729  tive() instead')
-00012410: 0d0a 2020 2020 7265 6d6f 7665 5f70 7269  ..    remove_pri
-00012420: 6d69 7469 7665 286c 696e 6529 0d0a 0d0a  mitive(line)....
-00012430: 0d0a 6465 6620 7265 6d6f 7665 5f74 6578  ..def remove_tex
-00012440: 7428 7465 7874 293a 0d0a 2020 2020 7072  t(text):..    pr
-00012450: 696e 7428 2772 656d 6f76 655f 7465 7874  int('remove_text
-00012460: 2829 2069 7320 6465 7072 6563 6174 6564  () is deprecated
-00012470: 2c20 7573 6520 7265 6d6f 7665 5f70 7269  , use remove_pri
-00012480: 6d69 7469 7665 2829 2069 6e73 7465 6164  mitive() instead
-00012490: 2729 0d0a 2020 2020 7265 6d6f 7665 5f70  ')..    remove_p
-000124a0: 7269 6d69 7469 7665 2874 6578 7429 0d0a  rimitive(text)..
-000124b0: 0d0a 0d0a 6465 6620 7265 6d6f 7665 5f70  ....def remove_p
-000124c0: 7269 6d69 7469 7665 2870 7269 6d69 7469  rimitive(primiti
-000124d0: 7665 293a 0d0a 2020 2020 6178 203d 2070  ve):..    ax = p
-000124e0: 7269 6d69 7469 7665 2e61 780d 0a20 2020  rimitive.ax..   
-000124f0: 2061 782e 7662 2e72 656d 6f76 6549 7465   ax.vb.removeIte
-00012500: 6d28 7072 696d 6974 6976 6529 0d0a 2020  m(primitive)..  
-00012510: 2020 6966 2070 7269 6d69 7469 7665 2069    if primitive i
-00012520: 6e20 6178 2e76 622e 726f 6973 3a0d 0a20  n ax.vb.rois:.. 
-00012530: 2020 2020 2020 2061 782e 7662 2e72 6f69         ax.vb.roi
-00012540: 732e 7265 6d6f 7665 2870 7269 6d69 7469  s.remove(primiti
-00012550: 7665 290d 0a20 2020 2069 6620 6861 7361  ve)..    if hasa
-00012560: 7474 7228 7072 696d 6974 6976 652c 2027  ttr(primitive, '
-00012570: 7465 7874 7327 293a 0d0a 2020 2020 2020  texts'):..      
-00012580: 2020 666f 7220 7478 7420 696e 2070 7269    for txt in pri
-00012590: 6d69 7469 7665 2e74 6578 7473 3a0d 0a20  mitive.texts:.. 
-000125a0: 2020 2020 2020 2020 2020 2061 782e 7662             ax.vb
-000125b0: 2e72 656d 6f76 6549 7465 6d28 7478 7429  .removeItem(txt)
-000125c0: 0d0a 0d0a 0d0a 6465 6620 7365 745f 7469  ......def set_ti
-000125d0: 6d65 5f69 6e73 7065 6374 6f72 2869 6e73  me_inspector(ins
-000125e0: 7065 6374 6f72 2c20 6178 3d4e 6f6e 652c  pector, ax=None,
-000125f0: 2077 6865 6e3d 2763 6c69 636b 2729 3a0d   when='click'):.
-00012600: 0a20 2020 2027 2727 4361 6c6c 6261 636b  .    '''Callback
-00012610: 2077 6865 6e20 636c 6963 6b65 6420 6c69   when clicked li
-00012620: 6b65 2073 6f3a 2069 6e73 7065 6374 6f72  ke so: inspector
-00012630: 2878 2c20 7929 2e27 2727 0d0a 2020 2020  (x, y).'''..    
-00012640: 6178 203d 2061 7820 6966 2061 7820 656c  ax = ax if ax el
-00012650: 7365 206c 6173 745f 6178 0d0a 2020 2020  se last_ax..    
-00012660: 6d61 7374 6572 203d 2061 782e 6178 5f77  master = ax.ax_w
-00012670: 6964 6765 7420 6966 2068 6173 6174 7472  idget if hasattr
-00012680: 2861 782c 2027 6178 5f77 6964 6765 7427  (ax, 'ax_widget'
-00012690: 2920 656c 7365 2061 782e 7662 2e77 696e  ) else ax.vb.win
-000126a0: 0d0a 2020 2020 6966 2077 6865 6e20 3d3d  ..    if when ==
-000126b0: 2027 686f 7665 7227 3a0d 0a20 2020 2020   'hover':..     
-000126c0: 2020 206d 6173 7465 722e 7072 6f78 795f     master.proxy_
-000126d0: 686f 7665 7220 3d20 7067 2e53 6967 6e61  hover = pg.Signa
-000126e0: 6c50 726f 7879 286d 6173 7465 722e 7363  lProxy(master.sc
-000126f0: 656e 6528 292e 7369 674d 6f75 7365 4d6f  ene().sigMouseMo
-00012700: 7665 642c 2072 6174 654c 696d 6974 3d31  ved, rateLimit=1
-00012710: 352c 2073 6c6f 743d 7061 7274 6961 6c28  5, slot=partial(
-00012720: 5f69 6e73 7065 6374 5f70 6f73 2c20 6178  _inspect_pos, ax
-00012730: 2c20 696e 7370 6563 746f 7229 290d 0a20  , inspector)).. 
-00012740: 2020 2065 6c69 6620 7768 656e 2069 6e20     elif when in 
-00012750: 2827 6463 6c69 636b 272c 2027 646f 7562  ('dclick', 'doub
-00012760: 6c65 2d63 6c69 636b 2729 3a0d 0a20 2020  le-click'):..   
-00012770: 2020 2020 206d 6173 7465 722e 7072 6f78       master.prox
-00012780: 795f 6463 6c69 636b 203d 2070 672e 5369  y_dclick = pg.Si
-00012790: 676e 616c 5072 6f78 7928 6d61 7374 6572  gnalProxy(master
-000127a0: 2e73 6365 6e65 2829 2e73 6967 4d6f 7573  .scene().sigMous
-000127b0: 6543 6c69 636b 6564 2c20 736c 6f74 3d70  eClicked, slot=p
-000127c0: 6172 7469 616c 285f 696e 7370 6563 745f  artial(_inspect_
-000127d0: 636c 6963 6b65 642c 2061 782c 2069 6e73  clicked, ax, ins
-000127e0: 7065 6374 6f72 2c20 5472 7565 2929 0d0a  pector, True))..
-000127f0: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
-00012800: 2020 206d 6173 7465 722e 7072 6f78 795f     master.proxy_
-00012810: 636c 6963 6b20 3d20 7067 2e53 6967 6e61  click = pg.Signa
-00012820: 6c50 726f 7879 286d 6173 7465 722e 7363  lProxy(master.sc
-00012830: 656e 6528 292e 7369 674d 6f75 7365 436c  ene().sigMouseCl
-00012840: 6963 6b65 642c 2073 6c6f 743d 7061 7274  icked, slot=part
-00012850: 6961 6c28 5f69 6e73 7065 6374 5f63 6c69  ial(_inspect_cli
-00012860: 636b 6564 2c20 6178 2c20 696e 7370 6563  cked, ax, inspec
-00012870: 746f 722c 2046 616c 7365 2929 0d0a 0d0a  tor, False))....
-00012880: 0d0a 6465 6620 6164 645f 6372 6f73 7368  ..def add_crossh
-00012890: 6169 725f 696e 666f 2869 6e66 6f66 756e  air_info(infofun
-000128a0: 632c 2061 783d 4e6f 6e65 293a 0d0a 2020  c, ax=None):..  
-000128b0: 2020 2727 2743 616c 6c62 6163 6b20 7768    '''Callback wh
-000128c0: 656e 2063 726f 7373 6861 6972 2075 7064  en crosshair upd
-000128d0: 6174 6564 206c 696b 6520 736f 3a20 696e  ated like so: in
-000128e0: 666f 2861 782c 782c 792c 7874 6578 742c  fo(ax,x,y,xtext,
-000128f0: 7974 6578 7429 3b20 7468 6520 696e 666f  ytext); the info
-00012900: 2829 0d0a 2020 2020 2020 2063 616c 6c62  ()..       callb
-00012910: 6163 6b20 6d75 7374 2072 6574 7572 6e20  ack must return 
-00012920: 7477 6f20 7661 6c75 6573 3a20 7874 6578  two values: xtex
-00012930: 7420 616e 6420 7974 6578 742e 2727 270d  t and ytext.'''.
-00012940: 0a20 2020 2061 7820 3d20 5f63 7265 6174  .    ax = _creat
-00012950: 655f 706c 6f74 2861 783d 6178 2c20 6d61  e_plot(ax=ax, ma
-00012960: 7869 6d69 7a65 3d46 616c 7365 290d 0a20  ximize=False).. 
-00012970: 2020 2061 782e 6372 6f73 7368 6169 722e     ax.crosshair.
-00012980: 696e 666f 732e 6170 7065 6e64 2869 6e66  infos.append(inf
-00012990: 6f66 756e 6329 0d0a 0d0a 0d0a 6465 6620  ofunc)......def 
-000129a0: 7469 6d65 725f 6361 6c6c 6261 636b 2875  timer_callback(u
-000129b0: 7064 6174 655f 6675 6e63 2c20 7365 636f  pdate_func, seco
-000129c0: 6e64 732c 2073 696e 676c 655f 7368 6f74  nds, single_shot
-000129d0: 3d46 616c 7365 293a 0d0a 2020 2020 676c  =False):..    gl
-000129e0: 6f62 616c 2074 696d 6572 730d 0a20 2020  obal timers..   
-000129f0: 2074 696d 6572 203d 2051 7443 6f72 652e   timer = QtCore.
-00012a00: 5154 696d 6572 2829 0d0a 2020 2020 7469  QTimer()..    ti
-00012a10: 6d65 722e 7469 6d65 6f75 742e 636f 6e6e  mer.timeout.conn
-00012a20: 6563 7428 7570 6461 7465 5f66 756e 6329  ect(update_func)
-00012a30: 0d0a 2020 2020 6966 2073 696e 676c 655f  ..    if single_
-00012a40: 7368 6f74 3a0d 0a20 2020 2020 2020 2074  shot:..        t
-00012a50: 696d 6572 2e73 6574 5369 6e67 6c65 5368  imer.setSingleSh
-00012a60: 6f74 2854 7275 6529 0d0a 2020 2020 7469  ot(True)..    ti
-00012a70: 6d65 722e 7374 6172 7428 696e 7428 7365  mer.start(int(se
-00012a80: 636f 6e64 732a 3130 3030 2929 0d0a 2020  conds*1000))..  
-00012a90: 2020 7469 6d65 7273 2e61 7070 656e 6428    timers.append(
-00012aa0: 7469 6d65 7229 0d0a 2020 2020 7265 7475  timer)..    retu
-00012ab0: 726e 2074 696d 6572 0d0a 0d0a 0d0a 6465  rn timer......de
-00012ac0: 6620 6175 746f 7669 6577 7265 7374 6f72  f autoviewrestor
-00012ad0: 6528 656e 6162 6c65 3d54 7275 6529 3a0d  e(enable=True):.
-00012ae0: 0a20 2020 2027 2727 5265 7374 6f72 2066  .    '''Restor f
-00012af0: 756e 6374 696f 6e61 6c69 7479 2073 6176  unctionality sav
-00012b00: 6573 2076 6965 7720 7a6f 6f6d 2063 6f6f  es view zoom coo
-00012b10: 7264 696e 6174 6573 2077 6865 6e20 636c  rdinates when cl
-00012b20: 6f73 696e 6720 6120 7769 6e64 6f77 2c20  osing a window, 
-00012b30: 616e 640d 0a20 2020 2020 2020 6c6f 6164  and..       load
-00012b40: 2074 6865 6d20 7768 656e 2063 7265 6174   them when creat
-00012b50: 696e 6720 7468 6520 706c 6f74 2028 7769  ing the plot (wi
-00012b60: 7468 2074 6865 2073 616d 6520 6e61 6d65  th the same name
-00012b70: 2920 6167 6169 6e2e 2727 270d 0a20 2020  ) again.'''..   
-00012b80: 2067 6c6f 6261 6c20 7669 6577 7265 7374   global viewrest
-00012b90: 6f72 650d 0a20 2020 2076 6965 7772 6573  ore..    viewres
-00012ba0: 746f 7265 203d 2065 6e61 626c 650d 0a0d  tore = enable...
-00012bb0: 0a0d 0a64 6566 2072 6566 7265 7368 2829  ...def refresh()
-00012bc0: 3a0d 0a20 2020 2066 6f72 2077 696e 2069  :..    for win i
-00012bd0: 6e20 7769 6e64 6f77 733a 0d0a 2020 2020  n windows:..    
-00012be0: 2020 2020 6178 7320 3d20 7769 6e2e 6178      axs = win.ax
-00012bf0: 7320 2b20 5b61 7820 666f 7220 6178 2069  s + [ax for ax i
-00012c00: 6e20 6f76 6572 6c61 795f 6178 7320 6966  n overlay_axs if
-00012c10: 2061 782e 7662 2e77 696e 3d3d 7769 6e5d   ax.vb.win==win]
-00012c20: 0d0a 2020 2020 2020 2020 666f 7220 6178  ..        for ax
-00012c30: 2069 6e20 6178 733a 0d0a 2020 2020 2020   in axs:..      
-00012c40: 2020 2020 2020 5f69 6d70 726f 7665 5f73        _improve_s
-00012c50: 6967 6e69 6669 6361 6e74 7328 6178 290d  ignificants(ax).
-00012c60: 0a20 2020 2020 2020 2076 6273 203d 205b  .        vbs = [
-00012c70: 6178 2e76 6220 666f 7220 6178 2069 6e20  ax.vb for ax in 
-00012c80: 6178 735d 0d0a 2020 2020 2020 2020 666f  axs]..        fo
-00012c90: 7220 7662 2069 6e20 7662 733a 0d0a 2020  r vb in vbs:..  
-00012ca0: 2020 2020 2020 2020 2020 7662 2e70 7265            vb.pre
-00012cb0: 5f70 726f 6365 7373 5f64 6174 6128 290d  _process_data().
-00012cc0: 0a20 2020 2020 2020 2069 6620 7669 6577  .        if view
-00012cd0: 7265 7374 6f72 653a 0d0a 2020 2020 2020  restore:..      
-00012ce0: 2020 2020 2020 6966 205f 6c6f 6164 7769        if _loadwi
-00012cf0: 6e64 6174 6128 7769 6e29 3a0d 0a20 2020  ndata(win):..   
-00012d00: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
-00012d10: 7469 6e75 650d 0a20 2020 2020 2020 205f  tinue..        _
-00012d20: 7365 745f 6d61 785f 7a6f 6f6d 2876 6273  set_max_zoom(vbs
-00012d30: 290d 0a20 2020 2020 2020 2066 6f72 2076  )..        for v
-00012d40: 6220 696e 2076 6273 3a0d 0a20 2020 2020  b in vbs:..     
-00012d50: 2020 2020 2020 2064 6174 6173 7263 203d         datasrc =
-00012d60: 2076 622e 6461 7461 7372 635f 6f72 5f73   vb.datasrc_or_s
-00012d70: 7461 6e64 616c 6f6e 650d 0a20 2020 2020  tandalone..     
-00012d80: 2020 2020 2020 2069 6620 6461 7461 7372         if datasr
-00012d90: 6320 616e 6420 2876 622e 6c69 6e6b 6564  c and (vb.linked
-00012da0: 5669 6577 2830 2920 6973 204e 6f6e 6520  View(0) is None 
-00012db0: 6f72 2076 622e 6c69 6e6b 6564 5669 6577  or vb.linkedView
-00012dc0: 2830 292e 6461 7461 7372 6320 6973 204e  (0).datasrc is N
-00012dd0: 6f6e 6520 6f72 2076 622e 6d61 7374 6572  one or vb.master
-00012de0: 5f76 6965 7762 6f78 293a 0d0a 2020 2020  _viewbox):..    
-00012df0: 2020 2020 2020 2020 2020 2020 7662 2e75              vb.u
-00012e00: 7064 6174 655f 795f 7a6f 6f6d 2864 6174  pdate_y_zoom(dat
-00012e10: 6173 7263 2e69 6e69 745f 7830 2c20 6461  asrc.init_x0, da
-00012e20: 7461 7372 632e 696e 6974 5f78 3129 0d0a  tasrc.init_x1)..
-00012e30: 2020 2020 5f72 6570 6169 6e74 5f63 616e      _repaint_can
-00012e40: 646c 6573 2829 0d0a 2020 2020 666f 7220  dles()..    for 
-00012e50: 6d64 2069 6e20 6d61 7374 6572 5f64 6174  md in master_dat
-00012e60: 612e 7661 6c75 6573 2829 3a0d 0a20 2020  a.values():..   
-00012e70: 2020 2020 2066 6f72 2076 6220 696e 206d       for vb in m
-00012e80: 643a 0d0a 2020 2020 2020 2020 2020 2020  d:..            
-00012e90: 6966 2074 7970 6528 7662 2920 213d 2073  if type(vb) != s
-00012ea0: 7472 3a20 2320 6967 6e6f 7265 2027 6465  tr: # ignore 'de
-00012eb0: 6661 756c 7427 0d0a 2020 2020 2020 2020  fault'..        
-00012ec0: 2020 2020 2020 2020 5f6d 6f75 7365 5f6d          _mouse_m
-00012ed0: 6f76 6564 2877 696e 2c20 7662 2c20 4e6f  oved(win, vb, No
-00012ee0: 6e65 290d 0a0d 0a0d 0a64 6566 2073 686f  ne)......def sho
-00012ef0: 7728 7174 5f65 7865 633d 5472 7565 293a  w(qt_exec=True):
-00012f00: 0d0a 2020 2020 7265 6672 6573 6828 290d  ..    refresh().
-00012f10: 0a20 2020 2066 6f72 2077 696e 2069 6e20  .    for win in 
-00012f20: 7769 6e64 6f77 733a 0d0a 2020 2020 2020  windows:..      
-00012f30: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
-00012f40: 7769 6e2c 2046 696e 5769 6e64 6f77 2920  win, FinWindow) 
-00012f50: 6f72 2071 745f 6578 6563 3a0d 0a20 2020  or qt_exec:..   
-00012f60: 2020 2020 2020 2020 2069 6620 7769 6e2e           if win.
-00012f70: 7368 6f77 5f6d 6178 696d 697a 6564 3a0d  show_maximized:.
-00012f80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00012f90: 2077 696e 2e73 686f 774d 6178 696d 697a   win.showMaximiz
-00012fa0: 6564 2829 0d0a 2020 2020 2020 2020 2020  ed()..          
-00012fb0: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
-00012fc0: 2020 2020 2020 2020 2077 696e 2e73 686f           win.sho
-00012fd0: 7728 290d 0a20 2020 2069 6620 7769 6e64  w()..    if wind
-00012fe0: 6f77 7320 616e 6420 7174 5f65 7865 633a  ows and qt_exec:
-00012ff0: 0d0a 2020 2020 2020 2020 676c 6f62 616c  ..        global
-00013000: 206c 6173 745f 6178 2c20 6170 700d 0a20   last_ax, app.. 
-00013010: 2020 2020 2020 2061 7070 203d 2051 7447         app = QtG
-00013020: 7569 2e51 4775 6941 7070 6c69 6361 7469  ui.QGuiApplicati
-00013030: 6f6e 2e69 6e73 7461 6e63 6528 290d 0a20  on.instance().. 
-00013040: 2020 2020 2020 2061 7070 2e65 7865 6328         app.exec(
-00013050: 290d 0a20 2020 2020 2020 2077 696e 646f  )..        windo
-00013060: 7773 2e63 6c65 6172 2829 0d0a 2020 2020  ws.clear()..    
-00013070: 2020 2020 6f76 6572 6c61 795f 6178 732e      overlay_axs.
-00013080: 636c 6561 7228 290d 0a20 2020 2020 2020  clear()..       
-00013090: 205f 636c 6561 725f 7469 6d65 7273 2829   _clear_timers()
-000130a0: 0d0a 2020 2020 2020 2020 736f 756e 6473  ..        sounds
-000130b0: 2e63 6c65 6172 2829 0d0a 2020 2020 2020  .clear()..      
-000130c0: 2020 6d61 7374 6572 5f64 6174 612e 636c    master_data.cl
-000130d0: 6561 7228 290d 0a20 2020 2020 2020 206c  ear()..        l
-000130e0: 6173 745f 6178 203d 204e 6f6e 650d 0a0d  ast_ax = None...
-000130f0: 0a0d 0a64 6566 2070 6c61 795f 736f 756e  ...def play_soun
-00013100: 6428 6669 6c65 6e61 6d65 293a 0d0a 2020  d(filename):..  
-00013110: 2020 6966 2066 696c 656e 616d 6520 6e6f    if filename no
-00013120: 7420 696e 2073 6f75 6e64 733a 0d0a 2020  t in sounds:..  
-00013130: 2020 2020 2020 6672 6f6d 2050 7951 7436        from PyQt6
-00013140: 2e51 744d 756c 7469 6d65 6469 6120 696d  .QtMultimedia im
-00013150: 706f 7274 2051 536f 756e 6445 6666 6563  port QSoundEffec
-00013160: 740d 0a20 2020 2020 2020 2073 203d 2073  t..        s = s
-00013170: 6f75 6e64 735b 6669 6c65 6e61 6d65 5d20  ounds[filename] 
-00013180: 3d20 5153 6f75 6e64 4566 6665 6374 2829  = QSoundEffect()
-00013190: 2023 2064 6973 616c 6c6f 7720 6763 0d0a   # disallow gc..
-000131a0: 2020 2020 2020 2020 732e 7365 7453 6f75          s.setSou
-000131b0: 7263 6528 5174 436f 7265 2e51 5572 6c2e  rce(QtCore.QUrl.
-000131c0: 6672 6f6d 4c6f 6361 6c46 696c 6528 6669  fromLocalFile(fi
-000131d0: 6c65 6e61 6d65 2929 0d0a 2020 2020 7320  lename))..    s 
-000131e0: 3d20 736f 756e 6473 5b66 696c 656e 616d  = sounds[filenam
-000131f0: 655d 0d0a 2020 2020 732e 706c 6179 2829  e]..    s.play()
-00013200: 0d0a 0d0a 0d0a 6465 6620 7363 7265 656e  ......def screen
-00013210: 7368 6f74 2866 696c 652c 2066 6d74 3d27  shot(file, fmt='
-00013220: 706e 6727 293a 0d0a 2020 2020 6966 205f  png'):..    if _
-00013230: 696e 7465 726e 616c 5f77 696e 646f 7773  internal_windows
-00013240: 5f6f 6e6c 7928 2920 616e 6420 6e6f 7420  _only() and not 
-00013250: 6170 703a 0d0a 2020 2020 2020 2020 7072  app:..        pr
-00013260: 696e 7428 2745 5252 4f52 3a20 7363 7265  int('ERROR: scre
-00013270: 656e 7368 6f74 206d 7573 7420 6265 2063  enshot must be c
-00013280: 616c 6c62 6163 6b65 6420 6672 6f6d 2065  allbacked from e
-00013290: 2e67 2e20 7469 6d65 725f 6361 6c6c 6261  .g. timer_callba
-000132a0: 636b 2829 2729 0d0a 2020 2020 2020 2020  ck()')..        
-000132b0: 7265 7475 726e 2046 616c 7365 0d0a 2020  return False..  
-000132c0: 2020 7472 793a 0d0a 2020 2020 2020 2020    try:..        
-000132d0: 6275 6666 6572 203d 2051 7443 6f72 652e  buffer = QtCore.
-000132e0: 5142 7566 6665 7228 290d 0a20 2020 2020  QBuffer()..     
-000132f0: 2020 2061 7070 2e70 7269 6d61 7279 5363     app.primarySc
-00013300: 7265 656e 2829 2e67 7261 6257 696e 646f  reen().grabWindo
-00013310: 7728 7769 6e64 6f77 735b 305d 2e77 696e  w(windows[0].win
-00013320: 4964 2829 292e 7361 7665 2862 7566 6665  Id()).save(buffe
-00013330: 722c 2066 6d74 290d 0a20 2020 2020 2020  r, fmt)..       
-00013340: 2066 696c 652e 7772 6974 6528 6275 6666   file.write(buff
-00013350: 6572 2e64 6174 6128 2929 0d0a 2020 2020  er.data())..    
-00013360: 2020 2020 7265 7475 726e 2054 7275 650d      return True.
-00013370: 0a20 2020 2065 7863 6570 7420 4578 6365  .    except Exce
-00013380: 7074 696f 6e20 6173 2065 3a0d 0a20 2020  ption as e:..   
-00013390: 2020 2020 2070 7269 6e74 2827 5363 7265       print('Scre
-000133a0: 656e 7368 6f74 2065 7272 6f72 3a27 2c20  enshot error:', 
-000133b0: 7479 7065 2865 292c 2065 290d 0a20 2020  type(e), e)..   
-000133c0: 2072 6574 7572 6e20 4661 6c73 650d 0a0d   return False...
-000133d0: 0a0d 0a64 6566 2065 7870 6572 696d 656e  ...def experimen
-000133e0: 7428 2a61 7267 732c 202a 2a6b 7761 7267  t(*args, **kwarg
-000133f0: 7329 3a0d 0a20 2020 2069 6620 276f 7065  s):..    if 'ope
-00013400: 6e67 6c27 2069 6e20 6172 6773 206f 7220  ngl' in args or 
-00013410: 6b77 6172 6773 2e67 6574 2827 6f70 656e  kwargs.get('open
-00013420: 676c 2729 3a0d 0a20 2020 2020 2020 2074  gl'):..        t
-00013430: 7279 3a0d 0a20 2020 2020 2020 2020 2020  ry:..           
-00013440: 2023 2070 6970 2069 6e73 7461 6c6c 2050   # pip install P
-00013450: 794f 7065 6e47 4c20 5079 4f70 656e 474c  yOpenGL PyOpenGL
-00013460: 2d61 6363 656c 6572 6174 6520 746f 2067  -accelerate to g
-00013470: 6574 2074 6869 7320 676f 696e 670d 0a20  et this going.. 
-00013480: 2020 2020 2020 2020 2020 2069 6d70 6f72             impor
-00013490: 7420 4f70 656e 474c 0d0a 2020 2020 2020  t OpenGL..      
-000134a0: 2020 2020 2020 7067 2e73 6574 436f 6e66        pg.setConf
-000134b0: 6967 4f70 7469 6f6e 7328 7573 654f 7065  igOptions(useOpe
-000134c0: 6e47 4c3d 5472 7565 2c20 656e 6162 6c65  nGL=True, enable
-000134d0: 4578 7065 7269 6d65 6e74 616c 3d54 7275  Experimental=Tru
-000134e0: 6529 0d0a 2020 2020 2020 2020 6578 6365  e)..        exce
-000134f0: 7074 2045 7863 6570 7469 6f6e 2061 7320  pt Exception as 
-00013500: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-00013510: 7072 696e 7428 2757 4152 4e49 4e47 3a20  print('WARNING: 
-00013520: 4f70 656e 474c 2069 6e69 7420 6572 726f  OpenGL init erro
-00013530: 722e 272c 2074 7970 6528 6529 2c20 6529  r.', type(e), e)
-00013540: 0d0a 0d0a 0d0a 2323 2323 2323 2323 2323  ......##########
-00013550: 2323 2323 2323 2323 2323 2049 4e54 4552  ########## INTER
-00013560: 4e41 4c53 2023 2323 2323 2323 2323 2323  NALS ###########
-00013570: 2323 2323 2323 2323 230d 0a0d 0a0d 0a64  #########......d
-00013580: 6566 205f 6f70 656e 6669 6c65 282a 6172  ef _openfile(*ar
-00013590: 6773 293a 0d0a 2020 2020 7265 7475 726e  gs):..    return
-000135a0: 206f 7065 6e28 2a61 7267 7329 0d0a 0d0a   open(*args)....
-000135b0: 0d0a 6465 6620 5f6c 6f61 6477 696e 6461  ..def _loadwinda
-000135c0: 7461 2877 696e 293a 0d0a 2020 2020 7472  ta(win):..    tr
-000135d0: 793a 206f 732e 6d6b 6469 7228 6f73 2e70  y: os.mkdir(os.p
-000135e0: 6174 682e 6578 7061 6e64 7573 6572 2827  ath.expanduser('
-000135f0: 7e2f 2e66 696e 706c 6f74 2729 290d 0a20  ~/.finplot')).. 
-00013600: 2020 2065 7863 6570 743a 2070 6173 730d     except: pass.
-00013610: 0a20 2020 2074 7279 3a0d 0a20 2020 2020  .    try:..     
-00013620: 2020 2066 203d 206f 732e 7061 7468 2e65     f = os.path.e
-00013630: 7870 616e 6475 7365 7228 277e 2f2e 6669  xpanduser('~/.fi
-00013640: 6e70 6c6f 742f 272b 7769 6e2e 7469 746c  nplot/'+win.titl
-00013650: 652e 7265 706c 6163 6528 272f 272c 272d  e.replace('/','-
-00013660: 2729 2b27 2e69 6e69 2729 0d0a 2020 2020  ')+'.ini')..    
-00013670: 2020 2020 7365 7474 696e 6773 203d 205b      settings = [
-00013680: 286b 2e73 7472 6970 2829 2c6c 6974 6572  (k.strip(),liter
-00013690: 616c 5f65 7661 6c28 762e 7374 7269 7028  al_eval(v.strip(
-000136a0: 2929 2920 666f 7220 6c69 6e65 2069 6e20  ))) for line in 
-000136b0: 5f6f 7065 6e66 696c 6528 6629 2066 6f72  _openfile(f) for
-000136c0: 206b 2c64 2c76 2069 6e20 5b6c 696e 652e   k,d,v in [line.
-000136d0: 7061 7274 6974 696f 6e28 273d 2729 5d20  partition('=')] 
-000136e0: 6966 2076 5d0d 0a20 2020 2020 2020 2069  if v]..        i
-000136f0: 6620 6e6f 7420 7365 7474 696e 6773 3a0d  f not settings:.
-00013700: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00013710: 7572 6e0d 0a20 2020 2065 7863 6570 743a  urn..    except:
-00013720: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-00013730: 0d0a 2020 2020 6b76 7320 3d20 7b6b 3a76  ..    kvs = {k:v
-00013740: 2066 6f72 206b 2c76 2069 6e20 7365 7474   for k,v in sett
-00013750: 696e 6773 7d0d 0a20 2020 2076 6273 203d  ings}..    vbs =
-00013760: 2073 6574 2861 782e 7662 2066 6f72 2061   set(ax.vb for a
-00013770: 7820 696e 2077 696e 2e61 7873 290d 0a20  x in win.axs).. 
-00013780: 2020 207a 6f6f 6d5f 7365 7420 3d20 4661     zoom_set = Fa
-00013790: 6c73 650d 0a20 2020 2066 6f72 2076 6220  lse..    for vb 
-000137a0: 696e 2076 6273 3a0d 0a20 2020 2020 2020  in vbs:..       
-000137b0: 2064 7320 3d20 7662 2e64 6174 6173 7263   ds = vb.datasrc
-000137c0: 0d0a 2020 2020 2020 2020 6966 2064 7320  ..        if ds 
-000137d0: 616e 6420 2876 622e 6c69 6e6b 6564 5669  and (vb.linkedVi
-000137e0: 6577 2830 2920 6973 204e 6f6e 6520 6f72  ew(0) is None or
-000137f0: 2076 622e 6c69 6e6b 6564 5669 6577 2830   vb.linkedView(0
-00013800: 292e 6461 7461 7372 6320 6973 204e 6f6e  ).datasrc is Non
-00013810: 6520 6f72 2076 622e 6d61 7374 6572 5f76  e or vb.master_v
-00013820: 6965 7762 6f78 293a 0d0a 2020 2020 2020  iewbox):..      
-00013830: 2020 2020 2020 7065 7269 6f64 5f6e 7320        period_ns 
-00013840: 3d20 6473 2e70 6572 696f 645f 6e73 0d0a  = ds.period_ns..
-00013850: 2020 2020 2020 2020 2020 2020 6966 206b              if k
-00013860: 7673 5b27 6d69 6e5f 7827 5d20 3e3d 2064  vs['min_x'] >= d
-00013870: 732e 782e 696c 6f63 5b30 5d2d 7065 7269  s.x.iloc[0]-peri
-00013880: 6f64 5f6e 7320 616e 6420 6b76 735b 276d  od_ns and kvs['m
-00013890: 6178 5f78 275d 203c 3d20 6473 2e78 2e69  ax_x'] <= ds.x.i
-000138a0: 6c6f 635b 2d31 5d2b 7065 7269 6f64 5f6e  loc[-1]+period_n
-000138b0: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
-000138c0: 2020 2020 7830 2c78 3120 3d20 6473 2e78      x0,x1 = ds.x
-000138d0: 2e6c 6f63 5b64 732e 783e 3d6b 7673 5b27  .loc[ds.x>=kvs['
-000138e0: 6d69 6e5f 7827 5d5d 2e69 6e64 6578 5b30  min_x']].index[0
-000138f0: 5d2c 2064 732e 782e 6c6f 635b 6473 2e78  ], ds.x.loc[ds.x
-00013900: 3c3d 6b76 735b 276d 6178 5f78 275d 5d2e  <=kvs['max_x']].
-00013910: 696e 6465 785b 2d31 5d0d 0a20 2020 2020  index[-1]..     
-00013920: 2020 2020 2020 2020 2020 2069 6620 7831             if x1
-00013930: 203d 3d20 6c65 6e28 6473 2e78 292d 313a   == len(ds.x)-1:
-00013940: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00013950: 2020 2020 2020 7831 202b 3d20 7269 6768        x1 += righ
-00013960: 745f 6d61 7267 696e 5f63 616e 646c 6573  t_margin_candles
-00013970: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00013980: 2020 7831 202b 3d20 302e 350d 0a20 2020    x1 += 0.5..   
-00013990: 2020 2020 2020 2020 2020 2020 207a 6f6f               zoo
-000139a0: 6d5f 7365 7420 3d20 7662 2e75 7064 6174  m_set = vb.updat
-000139b0: 655f 795f 7a6f 6f6d 2878 302c 2078 3129  e_y_zoom(x0, x1)
-000139c0: 0d0a 2020 2020 7265 7475 726e 207a 6f6f  ..    return zoo
-000139d0: 6d5f 7365 740d 0a0d 0a0d 0a64 6566 205f  m_set......def _
-000139e0: 7361 7665 7769 6e64 6174 6128 7769 6e29  savewindata(win)
-000139f0: 3a0d 0a20 2020 2069 6620 6e6f 7420 7669  :..    if not vi
-00013a00: 6577 7265 7374 6f72 653a 0d0a 2020 2020  ewrestore:..    
-00013a10: 2020 2020 7265 7475 726e 0d0a 2020 2020      return..    
-00013a20: 7472 793a 0d0a 2020 2020 2020 2020 6d69  try:..        mi
-00013a30: 6e5f 7820 3d20 696e 7428 3165 3130 3029  n_x = int(1e100)
-00013a40: 0d0a 2020 2020 2020 2020 6d61 785f 7820  ..        max_x 
-00013a50: 3d20 696e 7428 2d31 6531 3030 290d 0a20  = int(-1e100).. 
-00013a60: 2020 2020 2020 2066 6f72 2061 7820 696e         for ax in
-00013a70: 2077 696e 2e61 7873 3a0d 0a20 2020 2020   win.axs:..     
-00013a80: 2020 2020 2020 2069 6620 6178 2e76 622e         if ax.vb.
-00013a90: 7461 7267 6574 5265 6374 2829 2e72 6967  targetRect().rig
-00013aa0: 6874 2829 203c 2034 3a20 2320 6967 6e6f  ht() < 4: # igno
-00013ab0: 7265 2065 6d70 7479 2070 6c6f 7473 0d0a  re empty plots..
-00013ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013ad0: 636f 6e74 696e 7565 0d0a 2020 2020 2020  continue..      
-00013ae0: 2020 2020 2020 6966 2061 782e 7662 2e64        if ax.vb.d
-00013af0: 6174 6173 7263 2069 7320 4e6f 6e65 3a0d  atasrc is None:.
-00013b00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013b10: 2063 6f6e 7469 6e75 650d 0a20 2020 2020   continue..     
-00013b20: 2020 2020 2020 2074 302c 7431 2c5f 2c5f         t0,t1,_,_
-00013b30: 2c5f 203d 2061 782e 7662 2e64 6174 6173  ,_ = ax.vb.datas
-00013b40: 7263 2e68 696c 6f28 6178 2e76 622e 7461  rc.hilo(ax.vb.ta
-00013b50: 7267 6574 5265 6374 2829 2e6c 6566 7428  rgetRect().left(
-00013b60: 292c 2061 782e 7662 2e74 6172 6765 7452  ), ax.vb.targetR
-00013b70: 6563 7428 292e 7269 6768 7428 2929 0d0a  ect().right())..
-00013b80: 2020 2020 2020 2020 2020 2020 6d69 6e5f              min_
-00013b90: 7820 3d20 6e70 2e6e 616e 6d69 6e28 5b6d  x = np.nanmin([m
-00013ba0: 696e 5f78 2c20 7430 5d29 0d0a 2020 2020  in_x, t0])..    
-00013bb0: 2020 2020 2020 2020 6d61 785f 7820 3d20          max_x = 
-00013bc0: 6e70 2e6e 616e 6d61 7828 5b6d 6178 5f78  np.nanmax([max_x
-00013bd0: 2c20 7431 5d29 0d0a 2020 2020 2020 2020  , t1])..        
-00013be0: 6966 206e 702e 6d61 7828 6e70 2e61 6273  if np.max(np.abs
-00013bf0: 285b 6d69 6e5f 782c 206d 6178 5f78 5d29  ([min_x, max_x])
-00013c00: 2920 3c20 3165 3939 3a0d 0a20 2020 2020  ) < 1e99:..     
-00013c10: 2020 2020 2020 2073 203d 2027 6d69 6e5f         s = 'min_
-00013c20: 7820 3d20 2573 5c6e 6d61 785f 7820 3d20  x = %s\nmax_x = 
-00013c30: 2573 5c6e 2720 2520 286d 696e 5f78 2c20  %s\n' % (min_x, 
-00013c40: 6d61 785f 7829 0d0a 2020 2020 2020 2020  max_x)..        
-00013c50: 2020 2020 6620 3d20 6f73 2e70 6174 682e      f = os.path.
-00013c60: 6578 7061 6e64 7573 6572 2827 7e2f 2e66  expanduser('~/.f
-00013c70: 696e 706c 6f74 2f27 2b77 696e 2e74 6974  inplot/'+win.tit
-00013c80: 6c65 2e72 6570 6c61 6365 2827 2f27 2c27  le.replace('/','
-00013c90: 2d27 292b 272e 696e 6927 290d 0a20 2020  -')+'.ini')..   
-00013ca0: 2020 2020 2020 2020 2074 7279 3a20 6368           try: ch
-00013cb0: 616e 6765 6420 3d20 5f6f 7065 6e66 696c  anged = _openfil
-00013cc0: 6528 6629 2e72 6561 6428 2920 213d 2073  e(f).read() != s
-00013cd0: 0d0a 2020 2020 2020 2020 2020 2020 6578  ..            ex
-00013ce0: 6365 7074 3a20 6368 616e 6765 6420 3d20  cept: changed = 
-00013cf0: 5472 7565 0d0a 2020 2020 2020 2020 2020  True..          
-00013d00: 2020 6966 2063 6861 6e67 6564 3a0d 0a20    if changed:.. 
-00013d10: 2020 2020 2020 2020 2020 2020 2020 205f                 _
-00013d20: 6f70 656e 6669 6c65 2866 2c20 2777 7427  openfile(f, 'wt'
-00013d30: 292e 7772 6974 6528 7329 0d0a 2020 2020  ).write(s)..    
-00013d40: 2020 2020 2020 2020 2020 2020 2323 2070              ## p
-00013d50: 7269 6e74 2827 2573 2073 6176 6564 2720  rint('%s saved' 
-00013d60: 2520 7769 6e2e 7469 746c 6529 0d0a 2020  % win.title)..  
-00013d70: 2020 6578 6365 7074 2045 7863 6570 7469    except Excepti
-00013d80: 6f6e 2061 7320 653a 0d0a 2020 2020 2020  on as e:..      
-00013d90: 2020 7072 696e 7428 2745 7272 6f72 2073    print('Error s
-00013da0: 6176 696e 6720 706c 6f74 3a27 2c20 6529  aving plot:', e)
-00013db0: 0d0a 0d0a 0d0a 6465 6620 5f69 6e74 6572  ......def _inter
-00013dc0: 6e61 6c5f 7769 6e64 6f77 735f 6f6e 6c79  nal_windows_only
-00013dd0: 2829 3a0d 0a20 2020 2020 7265 7475 726e  ():..     return
-00013de0: 2061 6c6c 2869 7369 6e73 7461 6e63 6528   all(isinstance(
-00013df0: 7769 6e2c 4669 6e57 696e 646f 7729 2066  win,FinWindow) f
-00013e00: 6f72 2077 696e 2069 6e20 7769 6e64 6f77  or win in window
-00013e10: 7329 0d0a 0d0a 0d0a 6465 6620 5f63 7265  s)......def _cre
-00013e20: 6174 655f 706c 6f74 2861 783d 4e6f 6e65  ate_plot(ax=None
-00013e30: 2c20 2a2a 6b77 6172 6773 293a 0d0a 2020  , **kwargs):..  
-00013e40: 2020 6966 2061 783a 0d0a 2020 2020 2020    if ax:..      
-00013e50: 2020 7265 7475 726e 2061 780d 0a20 2020    return ax..   
-00013e60: 2069 6620 6c61 7374 5f61 783a 0d0a 2020   if last_ax:..  
-00013e70: 2020 2020 2020 7265 7475 726e 206c 6173        return las
-00013e80: 745f 6178 0d0a 2020 2020 7265 7475 726e  t_ax..    return
-00013e90: 2063 7265 6174 655f 706c 6f74 282a 2a6b   create_plot(**k
-00013ea0: 7761 7267 7329 0d0a 0d0a 0d0a 6465 6620  wargs)......def 
-00013eb0: 5f63 7265 6174 655f 6178 6973 2870 6f73  _create_axis(pos
-00013ec0: 2c20 2a2a 6b77 6172 6773 293a 0d0a 2020  , **kwargs):..  
-00013ed0: 2020 6966 2070 6f73 203d 3d20 2778 273a    if pos == 'x':
-00013ee0: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-00013ef0: 2045 706f 6368 4178 6973 4974 656d 282a   EpochAxisItem(*
-00013f00: 2a6b 7761 7267 7329 0d0a 2020 2020 656c  *kwargs)..    el
-00013f10: 6966 2070 6f73 203d 3d20 2779 273a 0d0a  if pos == 'y':..
-00013f20: 2020 2020 2020 2020 7265 7475 726e 2059          return Y
-00013f30: 4178 6973 4974 656d 282a 2a6b 7761 7267  AxisItem(**kwarg
-00013f40: 7329 0d0a 0d0a 0d0a 6465 6620 5f63 6c65  s)......def _cle
-00013f50: 6172 5f74 696d 6572 7328 293a 0d0a 2020  ar_timers():..  
-00013f60: 2020 666f 7220 7469 6d65 7220 696e 2074    for timer in t
-00013f70: 696d 6572 733a 0d0a 2020 2020 2020 2020  imers:..        
-00013f80: 7469 6d65 722e 7469 6d65 6f75 742e 6469  timer.timeout.di
-00013f90: 7363 6f6e 6e65 6374 2829 0d0a 2020 2020  sconnect()..    
-00013fa0: 7469 6d65 7273 2e63 6c65 6172 2829 0d0a  timers.clear()..
-00013fb0: 0d0a 0d0a 6465 6620 5f61 6464 5f74 696d  ....def _add_tim
-00013fc0: 6573 7461 6d70 5f70 6c6f 7428 6d61 7374  estamp_plot(mast
-00013fd0: 6572 2c20 7072 6576 5f61 782c 2076 6965  er, prev_ax, vie
-00013fe0: 7762 6f78 2c20 696e 6465 782c 2079 7363  wbox, index, ysc
-00013ff0: 616c 6529 3a0d 0a20 2020 206e 6174 6976  ale):..    nativ
-00014000: 655f 7769 6e20 3d20 6973 696e 7374 616e  e_win = isinstan
-00014010: 6365 286d 6173 7465 722c 2070 672e 4772  ce(master, pg.Gr
-00014020: 6170 6869 6373 4c61 796f 7574 5769 6467  aphicsLayoutWidg
-00014030: 6574 290d 0a20 2020 2069 6620 6e61 7469  et)..    if nati
-00014040: 7665 5f77 696e 2061 6e64 2070 7265 765f  ve_win and prev_
-00014050: 6178 2069 7320 6e6f 7420 4e6f 6e65 3a0d  ax is not None:.
-00014060: 0a20 2020 2020 2020 2070 7265 765f 6178  .        prev_ax
-00014070: 2e73 6574 5f76 6973 6962 6c65 2878 6178  .set_visible(xax
-00014080: 6973 3d46 616c 7365 2920 2320 6869 6465  is=False) # hide
-00014090: 2074 6865 2077 686f 6c65 2070 7265 7669   the whole previ
-000140a0: 6f75 7320 6178 6973 0d0a 2020 2020 6178  ous axis..    ax
-000140b0: 6573 203d 207b 2762 6f74 746f 6d27 3a20  es = {'bottom': 
-000140c0: 5f63 7265 6174 655f 6178 6973 2870 6f73  _create_axis(pos
-000140d0: 3d27 7827 2c20 7662 3d76 6965 7762 6f78  ='x', vb=viewbox
-000140e0: 2c20 6f72 6965 6e74 6174 696f 6e3d 2762  , orientation='b
-000140f0: 6f74 746f 6d27 292c 0d0a 2020 2020 2020  ottom'),..      
-00014100: 2020 2020 2020 2772 6967 6874 273a 2020        'right':  
-00014110: 5f63 7265 6174 655f 6178 6973 2870 6f73  _create_axis(pos
-00014120: 3d27 7927 2c20 7662 3d76 6965 7762 6f78  ='y', vb=viewbox
-00014130: 2c20 6f72 6965 6e74 6174 696f 6e3d 2772  , orientation='r
-00014140: 6967 6874 2729 7d0d 0a20 2020 2069 6620  ight')}..    if 
-00014150: 6e61 7469 7665 5f77 696e 3a0d 0a20 2020  native_win:..   
-00014160: 2020 2020 2061 7820 3d20 7067 2e50 6c6f       ax = pg.Plo
-00014170: 7449 7465 6d28 7669 6577 426f 783d 7669  tItem(viewBox=vi
-00014180: 6577 626f 782c 2061 7869 7349 7465 6d73  ewbox, axisItems
-00014190: 3d61 7865 732c 206e 616d 653d 2770 6c6f  =axes, name='plo
-000141a0: 742d 2569 2725 696e 6465 782c 2065 6e61  t-%i'%index, ena
-000141b0: 626c 654d 656e 753d 4661 6c73 6529 0d0a  bleMenu=False)..
-000141c0: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
-000141d0: 2020 2061 7877 203d 2070 672e 506c 6f74     axw = pg.Plot
-000141e0: 5769 6467 6574 2876 6965 7742 6f78 3d76  Widget(viewBox=v
-000141f0: 6965 7762 6f78 2c20 6178 6973 4974 656d  iewbox, axisItem
-00014200: 733d 6178 6573 2c20 6e61 6d65 3d27 706c  s=axes, name='pl
-00014210: 6f74 2d25 6927 2569 6e64 6578 2c20 656e  ot-%i'%index, en
-00014220: 6162 6c65 4d65 6e75 3d46 616c 7365 290d  ableMenu=False).
-00014230: 0a20 2020 2020 2020 2061 7820 3d20 6178  .        ax = ax
-00014240: 772e 706c 6f74 4974 656d 0d0a 2020 2020  w.plotItem..    
-00014250: 2020 2020 6178 2e61 785f 7769 6467 6574      ax.ax_widget
-00014260: 203d 2061 7877 0d0a 2020 2020 6178 2e68   = axw..    ax.h
-00014270: 6964 6541 7869 7328 276c 6566 7427 290d  ideAxis('left').
-00014280: 0a20 2020 2069 6620 795f 6c61 6265 6c5f  .    if y_label_
-00014290: 7769 6474 683a 0d0a 2020 2020 2020 2020  width:..        
-000142a0: 6178 2e61 7865 735b 2772 6967 6874 275d  ax.axes['right']
-000142b0: 5b27 6974 656d 275d 2e73 6574 5769 6474  ['item'].setWidt
-000142c0: 6828 795f 6c61 6265 6c5f 7769 6474 6829  h(y_label_width)
-000142d0: 2023 2074 6869 7320 6973 2074 6f20 7075   # this is to pu
-000142e0: 7420 616c 6c20 6772 6170 6873 206f 6e20  t all graphs on 
-000142f0: 6571 7561 6c20 666f 6f74 696e 6720 7768  equal footing wh
-00014300: 656e 2074 6578 7473 2076 6172 7920 6672  en texts vary fr
-00014310: 6f6d 2030 2e34 2074 6f20 3230 3030 3030  om 0.4 to 200000
-00014320: 300d 0a20 2020 2061 782e 6178 6573 5b27  0..    ax.axes['
-00014330: 7269 6768 7427 5d5b 2769 7465 6d27 5d2e  right']['item'].
-00014340: 7365 7453 7479 6c65 2874 6963 6b4c 656e  setStyle(tickLen
-00014350: 6774 683d 2d35 2920 2320 736f 6d65 2062  gth=-5) # some b
-00014360: 7567 2c20 746f 7461 6c6c 7920 756e 6578  ug, totally unex
-00014370: 706c 6963 6162 6c65 2028 7768 7920 7365  plicable (why se
-00014380: 7474 696e 6720 7468 6520 6465 6661 756c  tting the defaul
-00014390: 7420 7661 6c75 6520 6167 6169 6e20 776f  t value again wo
-000143a0: 756c 6420 6669 7820 7265 7061 696e 7420  uld fix repaint 
-000143b0: 7769 6474 6820 6173 2061 7869 7320 7363  width as axis sc
-000143c0: 616c 6520 646f 776e 290d 0a20 2020 2061  ale down)..    a
-000143d0: 782e 6178 6573 5b27 7269 6768 7427 5d5b  x.axes['right'][
-000143e0: 2769 7465 6d27 5d2e 7365 745a 5661 6c75  'item'].setZValu
-000143f0: 6528 3330 2920 2320 7075 7420 6178 6973  e(30) # put axis
-00014400: 2069 6e20 6672 6f6e 7420 696e 7374 6561   in front instea
-00014410: 6420 6f66 2062 6568 696e 6420 6461 7461  d of behind data
-00014420: 0d0a 2020 2020 6178 2e61 7865 735b 2762  ..    ax.axes['b
-00014430: 6f74 746f 6d27 5d5b 2769 7465 6d27 5d2e  ottom']['item'].
-00014440: 7365 745a 5661 6c75 6528 3330 290d 0a20  setZValue(30).. 
-00014450: 2020 2061 782e 7365 744c 6f67 4d6f 6465     ax.setLogMode
-00014460: 2879 3d28 7973 6361 6c65 2e73 6361 6c65  (y=(yscale.scale
-00014470: 7479 7065 3d3d 276c 6f67 2729 290d 0a20  type=='log')).. 
-00014480: 2020 2061 782e 7369 676e 6966 6963 616e     ax.significan
-00014490: 745f 666f 7263 6564 203d 2046 616c 7365  t_forced = False
-000144a0: 0d0a 2020 2020 6178 2e73 6967 6e69 6669  ..    ax.signifi
-000144b0: 6361 6e74 5f64 6563 696d 616c 7320 3d20  cant_decimals = 
-000144c0: 7369 676e 6966 6963 616e 745f 6465 6369  significant_deci
-000144d0: 6d61 6c73 0d0a 2020 2020 6178 2e73 6967  mals..    ax.sig
-000144e0: 6e69 6669 6361 6e74 5f65 7073 203d 2073  nificant_eps = s
-000144f0: 6967 6e69 6669 6361 6e74 5f65 7073 0d0a  ignificant_eps..
-00014500: 2020 2020 6178 2e63 726f 7373 6861 6972      ax.crosshair
-00014510: 203d 2046 696e 4372 6f73 7348 6169 7228   = FinCrossHair(
-00014520: 6178 2c20 636f 6c6f 723d 6372 6f73 735f  ax, color=cross_
-00014530: 6861 6972 5f63 6f6c 6f72 290d 0a20 2020  hair_color)..   
-00014540: 2061 782e 6869 6465 4275 7474 6f6e 7328   ax.hideButtons(
-00014550: 290d 0a20 2020 2061 782e 6f76 6572 6c61  )..    ax.overla
-00014560: 7920 3d20 7061 7274 6961 6c28 5f61 785f  y = partial(_ax_
-00014570: 6f76 6572 6c61 792c 2061 7829 0d0a 2020  overlay, ax)..  
-00014580: 2020 6178 2e73 6574 5f76 6973 6962 6c65    ax.set_visible
-00014590: 203d 2070 6172 7469 616c 285f 6178 5f73   = partial(_ax_s
-000145a0: 6574 5f76 6973 6962 6c65 2c20 6178 290d  et_visible, ax).
-000145b0: 0a20 2020 2061 782e 6465 636f 7570 6c65  .    ax.decouple
-000145c0: 203d 2070 6172 7469 616c 285f 6178 5f64   = partial(_ax_d
-000145d0: 6563 6f75 706c 652c 2061 7829 0d0a 2020  ecouple, ax)..  
-000145e0: 2020 6178 2e64 6973 6162 6c65 5f78 5f69    ax.disable_x_i
-000145f0: 6e64 6578 203d 2070 6172 7469 616c 285f  ndex = partial(_
-00014600: 6178 5f64 6973 6162 6c65 5f78 5f69 6e64  ax_disable_x_ind
-00014610: 6578 2c20 6178 290d 0a20 2020 2061 782e  ex, ax)..    ax.
-00014620: 7265 7365 7420 3d20 7061 7274 6961 6c28  reset = partial(
-00014630: 5f61 785f 7265 7365 742c 2061 7829 0d0a  _ax_reset, ax)..
-00014640: 2020 2020 6178 2e70 7265 765f 6178 203d      ax.prev_ax =
-00014650: 2070 7265 765f 6178 0d0a 2020 2020 6178   prev_ax..    ax
-00014660: 2e77 696e 5f69 6e64 6578 203d 2069 6e64  .win_index = ind
-00014670: 6578 0d0a 2020 2020 6966 2069 6e64 6578  ex..    if index
-00014680: 2532 3a0d 0a20 2020 2020 2020 2076 6965  %2:..        vie
-00014690: 7762 6f78 2e73 6574 4261 636b 6772 6f75  wbox.setBackgrou
-000146a0: 6e64 436f 6c6f 7228 6f64 645f 706c 6f74  ndColor(odd_plot
-000146b0: 5f62 6163 6b67 726f 756e 6429 0d0a 2020  _background)..  
-000146c0: 2020 7669 6577 626f 782e 7365 7450 6172    viewbox.setPar
-000146d0: 656e 7428 6178 290d 0a20 2020 2072 6574  ent(ax)..    ret
-000146e0: 7572 6e20 6178 0d0a 0d0a 0d0a 6465 6620  urn ax......def 
-000146f0: 5f61 785f 6f76 6572 6c61 7928 6178 2c20  _ax_overlay(ax, 
-00014700: 7363 616c 653d 302e 3235 2c20 7961 7869  scale=0.25, yaxi
-00014710: 733d 4661 6c73 6529 3a0d 0a20 2020 2027  s=False):..    '
-00014720: 2727 5468 6520 7363 616c 6520 7061 7261  ''The scale para
-00014730: 6d65 7465 7220 6465 6669 6e65 7320 686f  meter defines ho
-00014740: 7720 2268 6967 6820 7570 2220 6f6e 2074  w "high up" on t
-00014750: 6865 2069 6e69 7469 616c 2070 6c6f 7420  he initial plot 
-00014760: 7468 6973 206f 7665 726c 6179 2077 696c  this overlay wil
-00014770: 6c20 7368 6f77 2e0d 0a20 2020 2020 2020  l show...       
-00014780: 5468 6520 7961 7869 7320 7061 7261 6d65  The yaxis parame
-00014790: 7465 7220 6361 6e20 6265 206f 6e65 206f  ter can be one o
-000147a0: 6620 5b46 616c 7365 2c20 276c 696e 6561  f [False, 'linea
-000147b0: 7227 2c20 276c 6f67 275d 2e27 2727 0d0a  r', 'log'].'''..
-000147c0: 2020 2020 7973 6361 6c65 203d 2079 6178      yscale = yax
-000147d0: 6973 2069 6620 7961 7869 7320 656c 7365  is if yaxis else
-000147e0: 2027 6c69 6e65 6172 270d 0a20 2020 2076   'linear'..    v
-000147f0: 6965 7762 6f78 203d 2046 696e 5669 6577  iewbox = FinView
-00014800: 426f 7828 6178 2e76 622e 7769 6e2c 2069  Box(ax.vb.win, i
-00014810: 6e69 745f 7374 6570 733d 6178 2e76 622e  nit_steps=ax.vb.
-00014820: 696e 6974 5f73 7465 7073 2c20 7973 6361  init_steps, ysca
-00014830: 6c65 3d59 5363 616c 6528 7973 6361 6c65  le=YScale(yscale
-00014840: 2c20 3129 2c20 656e 6162 6c65 4d65 6e75  , 1), enableMenu
-00014850: 3d46 616c 7365 290d 0a20 2020 2076 6965  =False)..    vie
-00014860: 7762 6f78 2e6d 6173 7465 725f 7669 6577  wbox.master_view
-00014870: 626f 7820 3d20 6178 2e76 620d 0a20 2020  box = ax.vb..   
-00014880: 2076 6965 7762 6f78 2e73 6574 5a56 616c   viewbox.setZVal
-00014890: 7565 282d 3529 0d0a 2020 2020 7669 6577  ue(-5)..    view
-000148a0: 626f 782e 7365 7442 6163 6b67 726f 756e  box.setBackgroun
-000148b0: 6443 6f6c 6f72 2861 782e 7662 2e73 7461  dColor(ax.vb.sta
-000148c0: 7465 5b27 6261 636b 6772 6f75 6e64 275d  te['background']
-000148d0: 290d 0a20 2020 2061 782e 7662 2e73 6574  )..    ax.vb.set
-000148e0: 4261 636b 6772 6f75 6e64 436f 6c6f 7228  BackgroundColor(
-000148f0: 4e6f 6e65 290d 0a20 2020 2076 6965 7762  None)..    viewb
-00014900: 6f78 2e76 5f7a 6f6f 6d5f 7363 616c 6520  ox.v_zoom_scale 
-00014910: 3d20 7363 616c 650d 0a20 2020 2069 6620  = scale..    if 
-00014920: 6861 7361 7474 7228 6178 2c20 2761 785f  hasattr(ax, 'ax_
-00014930: 7769 6467 6574 2729 3a0d 0a20 2020 2020  widget'):..     
-00014940: 2020 2061 782e 6178 5f77 6964 6765 742e     ax.ax_widget.
-00014950: 7363 656e 6528 292e 6164 6449 7465 6d28  scene().addItem(
-00014960: 7669 6577 626f 7829 0d0a 2020 2020 656c  viewbox)..    el
-00014970: 7365 3a0d 0a20 2020 2020 2020 2061 782e  se:..        ax.
-00014980: 7662 2e77 696e 2e63 656e 7472 616c 5769  vb.win.centralWi
-00014990: 6467 6574 2e73 6365 6e65 2829 2e61 6464  dget.scene().add
-000149a0: 4974 656d 2876 6965 7762 6f78 290d 0a20  Item(viewbox).. 
-000149b0: 2020 2076 6965 7762 6f78 2e73 6574 584c     viewbox.setXL
-000149c0: 696e 6b28 6178 2e76 6229 0d0a 2020 2020  ink(ax.vb)..    
-000149d0: 6465 6620 7570 6461 7465 5669 6577 2829  def updateView()
-000149e0: 3a0d 0a20 2020 2020 2020 2076 6965 7762  :..        viewb
-000149f0: 6f78 2e73 6574 4765 6f6d 6574 7279 2861  ox.setGeometry(a
-00014a00: 782e 7662 2e73 6365 6e65 426f 756e 6469  x.vb.sceneBoundi
-00014a10: 6e67 5265 6374 2829 290d 0a20 2020 2061  ngRect())..    a
-00014a20: 786f 203d 2070 672e 506c 6f74 4974 656d  xo = pg.PlotItem
-00014a30: 2865 6e61 626c 654d 656e 753d 4661 6c73  (enableMenu=Fals
-00014a40: 6529 0d0a 2020 2020 6178 6f2e 7369 676e  e)..    axo.sign
-00014a50: 6966 6963 616e 745f 666f 7263 6564 203d  ificant_forced =
-00014a60: 2046 616c 7365 0d0a 2020 2020 6178 6f2e   False..    axo.
-00014a70: 7369 676e 6966 6963 616e 745f 6465 6369  significant_deci
-00014a80: 6d61 6c73 203d 2073 6967 6e69 6669 6361  mals = significa
-00014a90: 6e74 5f64 6563 696d 616c 730d 0a20 2020  nt_decimals..   
-00014aa0: 2061 786f 2e73 6967 6e69 6669 6361 6e74   axo.significant
-00014ab0: 5f65 7073 203d 2073 6967 6e69 6669 6361  _eps = significa
-00014ac0: 6e74 5f65 7073 0d0a 2020 2020 6178 6f2e  nt_eps..    axo.
-00014ad0: 7662 203d 2076 6965 7762 6f78 0d0a 2020  vb = viewbox..  
-00014ae0: 2020 6178 6f2e 7072 6576 5f61 7820 3d20    axo.prev_ax = 
-00014af0: 4e6f 6e65 0d0a 2020 2020 6178 6f2e 6372  None..    axo.cr
-00014b00: 6f73 7368 6169 7220 3d20 4e6f 6e65 0d0a  osshair = None..
-00014b10: 2020 2020 6178 6f2e 6465 636f 7570 6c65      axo.decouple
-00014b20: 203d 2070 6172 7469 616c 285f 6178 5f64   = partial(_ax_d
-00014b30: 6563 6f75 706c 652c 2061 786f 290d 0a20  ecouple, axo).. 
-00014b40: 2020 2061 786f 2e64 6973 6162 6c65 5f78     axo.disable_x
-00014b50: 5f69 6e64 6578 203d 2070 6172 7469 616c  _index = partial
-00014b60: 285f 6178 5f64 6973 6162 6c65 5f78 5f69  (_ax_disable_x_i
-00014b70: 6e64 6578 2c20 6178 6f29 0d0a 2020 2020  ndex, axo)..    
-00014b80: 6178 6f2e 7265 7365 7420 3d20 7061 7274  axo.reset = part
-00014b90: 6961 6c28 5f61 785f 7265 7365 742c 2061  ial(_ax_reset, a
-00014ba0: 786f 290d 0a20 2020 2061 786f 2e68 6964  xo)..    axo.hid
-00014bb0: 6541 7869 7328 276c 6566 7427 290d 0a20  eAxis('left').. 
-00014bc0: 2020 2061 786f 2e68 6964 6541 7869 7328     axo.hideAxis(
-00014bd0: 2772 6967 6874 2729 0d0a 2020 2020 6178  'right')..    ax
-00014be0: 6f2e 6869 6465 4178 6973 2827 626f 7474  o.hideAxis('bott
-00014bf0: 6f6d 2729 0d0a 2020 2020 6178 6f2e 6869  om')..    axo.hi
-00014c00: 6465 4275 7474 6f6e 7328 290d 0a20 2020  deButtons()..   
-00014c10: 2076 6965 7762 6f78 2e61 6464 4974 656d   viewbox.addItem
-00014c20: 2861 786f 290d 0a20 2020 2069 6620 7961  (axo)..    if ya
-00014c30: 7869 7320 616e 6420 6973 696e 7374 616e  xis and isinstan
-00014c40: 6365 2861 786f 2e76 622e 7769 6e2c 2070  ce(axo.vb.win, p
-00014c50: 672e 4772 6170 6869 6373 4c61 796f 7574  g.GraphicsLayout
-00014c60: 5769 6467 6574 293a 0d0a 2020 2020 2020  Widget):..      
-00014c70: 2020 6178 6920 3d20 5f63 7265 6174 655f    axi = _create_
-00014c80: 6178 6973 2870 6f73 3d27 7927 2c20 7662  axis(pos='y', vb
-00014c90: 3d61 786f 2e76 622c 206f 7269 656e 7461  =axo.vb, orienta
-00014ca0: 7469 6f6e 3d27 6c65 6674 2729 0d0a 2020  tion='left')..  
-00014cb0: 2020 2020 2020 6178 6f2e 7365 7441 7869        axo.setAxi
-00014cc0: 7349 7465 6d73 287b 276c 6566 7427 3a20  sItems({'left': 
-00014cd0: 6178 697d 290d 0a20 2020 2020 2020 2061  axi})..        a
-00014ce0: 786f 2e76 622e 7769 6e2e 6164 6449 7465  xo.vb.win.addIte
-00014cf0: 6d28 6178 692c 2072 6f77 3d30 2c20 636f  m(axi, row=0, co
-00014d00: 6c3d 3029 0d0a 2020 2020 6178 2e76 622e  l=0)..    ax.vb.
-00014d10: 7369 6752 6573 697a 6564 2e63 6f6e 6e65  sigResized.conne
-00014d20: 6374 2875 7064 6174 6556 6965 7729 0d0a  ct(updateView)..
-00014d30: 2020 2020 6f76 6572 6c61 795f 6178 732e      overlay_axs.
-00014d40: 6170 7065 6e64 2861 786f 290d 0a20 2020  append(axo)..   
-00014d50: 2075 7064 6174 6556 6965 7728 290d 0a20   updateView().. 
-00014d60: 2020 2072 6574 7572 6e20 6178 6f0d 0a0d     return axo...
-00014d70: 0a0d 0a64 6566 205f 6178 5f73 6574 5f76  ...def _ax_set_v
-00014d80: 6973 6962 6c65 2861 782c 2063 726f 7373  isible(ax, cross
-00014d90: 6861 6972 3d4e 6f6e 652c 2078 6178 6973  hair=None, xaxis
-00014da0: 3d4e 6f6e 652c 2079 6178 6973 3d4e 6f6e  =None, yaxis=Non
-00014db0: 652c 2078 6772 6964 3d4e 6f6e 652c 2079  e, xgrid=None, y
-00014dc0: 6772 6964 3d4e 6f6e 6529 3a0d 0a20 2020  grid=None):..   
-00014dd0: 2069 6620 6372 6f73 7368 6169 7220 3d3d   if crosshair ==
-00014de0: 2046 616c 7365 3a0d 0a20 2020 2020 2020   False:..       
-00014df0: 2061 782e 6372 6f73 7368 6169 722e 6869   ax.crosshair.hi
-00014e00: 6465 2829 0d0a 2020 2020 6966 2078 6178  de()..    if xax
-00014e10: 6973 2069 7320 6e6f 7420 4e6f 6e65 3a0d  is is not None:.
-00014e20: 0a20 2020 2020 2020 2061 782e 6765 7441  .        ax.getA
-00014e30: 7869 7328 2762 6f74 746f 6d27 292e 7365  xis('bottom').se
-00014e40: 7453 7479 6c65 2873 686f 7756 616c 7565  tStyle(showValue
-00014e50: 733d 7861 7869 7329 0d0a 2020 2020 6966  s=xaxis)..    if
-00014e60: 2079 6178 6973 2069 7320 6e6f 7420 4e6f   yaxis is not No
-00014e70: 6e65 3a0d 0a20 2020 2020 2020 2061 782e  ne:..        ax.
-00014e80: 6765 7441 7869 7328 2772 6967 6874 2729  getAxis('right')
-00014e90: 2e73 6574 5374 796c 6528 7368 6f77 5661  .setStyle(showVa
-00014ea0: 6c75 6573 3d79 6178 6973 290d 0a20 2020  lues=yaxis)..   
-00014eb0: 2069 6620 7867 7269 6420 6973 206e 6f74   if xgrid is not
-00014ec0: 204e 6f6e 6520 6f72 2079 6772 6964 2069   None or ygrid i
-00014ed0: 7320 6e6f 7420 4e6f 6e65 3a0d 0a20 2020  s not None:..   
-00014ee0: 2020 2020 2061 782e 7368 6f77 4772 6964       ax.showGrid
-00014ef0: 2878 3d78 6772 6964 2c20 793d 7967 7269  (x=xgrid, y=ygri
-00014f00: 6429 0d0a 2020 2020 2020 2020 6966 2061  d)..        if a
-00014f10: 782e 6765 7441 7869 7328 2772 6967 6874  x.getAxis('right
-00014f20: 2729 3a0d 0a20 2020 2020 2020 2020 2020  '):..           
-00014f30: 2061 782e 6765 7441 7869 7328 2772 6967   ax.getAxis('rig
-00014f40: 6874 2729 2e73 6574 456e 6162 6c65 6428  ht').setEnabled(
-00014f50: 4661 6c73 6529 0d0a 2020 2020 2020 2020  False)..        
-00014f60: 6966 2061 782e 6765 7441 7869 7328 2762  if ax.getAxis('b
-00014f70: 6f74 746f 6d27 293a 0d0a 2020 2020 2020  ottom'):..      
-00014f80: 2020 2020 2020 6178 2e67 6574 4178 6973        ax.getAxis
-00014f90: 2827 626f 7474 6f6d 2729 2e73 6574 456e  ('bottom').setEn
-00014fa0: 6162 6c65 6428 4661 6c73 6529 0d0a 0d0a  abled(False)....
-00014fb0: 0d0a 6465 6620 5f61 785f 6465 636f 7570  ..def _ax_decoup
-00014fc0: 6c65 2861 7829 3a0d 0a20 2020 2061 782e  le(ax):..    ax.
-00014fd0: 7365 7458 4c69 6e6b 284e 6f6e 6529 0d0a  setXLink(None)..
-00014fe0: 2020 2020 6966 2061 782e 7072 6576 5f61      if ax.prev_a
-00014ff0: 783a 0d0a 2020 2020 2020 2020 6178 2e70  x:..        ax.p
-00015000: 7265 765f 6178 2e73 6574 5f76 6973 6962  rev_ax.set_visib
-00015010: 6c65 2878 6178 6973 3d54 7275 6529 0d0a  le(xaxis=True)..
-00015020: 0d0a 0d0a 6465 6620 5f61 785f 6469 7361  ....def _ax_disa
-00015030: 626c 655f 785f 696e 6465 7828 6178 2c20  ble_x_index(ax, 
-00015040: 6465 636f 7570 6c65 3d54 7275 6529 3a0d  decouple=True):.
-00015050: 0a20 2020 2061 782e 7662 2e78 5f69 6e64  .    ax.vb.x_ind
-00015060: 6578 6564 203d 2046 616c 7365 0d0a 2020  exed = False..  
-00015070: 2020 6966 2064 6563 6f75 706c 653a 0d0a    if decouple:..
-00015080: 2020 2020 2020 2020 5f61 785f 6465 636f          _ax_deco
-00015090: 7570 6c65 2861 7829 0d0a 0d0a 0d0a 6465  uple(ax)......de
-000150a0: 6620 5f61 785f 7265 7365 7428 6178 293a  f _ax_reset(ax):
-000150b0: 0d0a 2020 2020 6966 2061 782e 6372 6f73  ..    if ax.cros
-000150c0: 7368 6169 7220 6973 206e 6f74 204e 6f6e  shair is not Non
-000150d0: 653a 0d0a 2020 2020 2020 2020 6178 2e63  e:..        ax.c
-000150e0: 726f 7373 6861 6972 2e68 6964 6528 290d  rosshair.hide().
-000150f0: 0a20 2020 2066 6f72 2069 7465 6d20 696e  .    for item in
-00015100: 206c 6973 7428 6178 2e69 7465 6d73 293a   list(ax.items):
-00015110: 0d0a 2020 2020 2020 2020 6178 2e72 656d  ..        ax.rem
-00015120: 6f76 6549 7465 6d28 6974 656d 290d 0a20  oveItem(item).. 
-00015130: 2020 2020 2020 2069 6620 6178 2e76 622e         if ax.vb.
-00015140: 6d61 7374 6572 5f76 6965 7762 6f78 2061  master_viewbox a
-00015150: 6e64 2068 6173 6174 7472 2869 7465 6d2c  nd hasattr(item,
-00015160: 2027 6e61 6d65 2729 2061 6e64 2069 7465   'name') and ite
-00015170: 6d2e 6e61 6d65 2829 3a0d 0a20 2020 2020  m.name():..     
-00015180: 2020 2020 2020 206c 6567 656e 6420 3d20         legend = 
-00015190: 6178 2e76 622e 6d61 7374 6572 5f76 6965  ax.vb.master_vie
-000151a0: 7762 6f78 2e70 6172 656e 7428 292e 6c65  wbox.parent().le
-000151b0: 6765 6e64 0d0a 2020 2020 2020 2020 2020  gend..          
-000151c0: 2020 6966 206c 6567 656e 643a 0d0a 2020    if legend:..  
-000151d0: 2020 2020 2020 2020 2020 2020 2020 6c65                le
-000151e0: 6765 6e64 2e72 656d 6f76 6549 7465 6d28  gend.removeItem(
-000151f0: 6974 656d 290d 0a20 2020 2069 6620 6178  item)..    if ax
-00015200: 2e6c 6567 656e 643a 0d0a 2020 2020 2020  .legend:..      
-00015210: 2020 6178 2e6c 6567 656e 642e 6f70 7473    ax.legend.opts
-00015220: 5b27 6f66 6673 6574 275d 203d 204e 6f6e  ['offset'] = Non
-00015230: 650d 0a20 2020 2020 2020 2061 782e 6c65  e..        ax.le
-00015240: 6765 6e64 2e73 6574 5061 7265 6e74 4974  gend.setParentIt
-00015250: 656d 284e 6f6e 6529 0d0a 2020 2020 2020  em(None)..      
-00015260: 2020 6178 2e6c 6567 656e 6420 3d20 4e6f    ax.legend = No
-00015270: 6e65 0d0a 2020 2020 6178 2e76 622e 7265  ne..    ax.vb.re
-00015280: 7365 7428 290d 0a20 2020 2061 782e 7662  set()..    ax.vb
-00015290: 2e73 6574 5f64 6174 6173 7263 284e 6f6e  .set_datasrc(Non
-000152a0: 6529 0d0a 2020 2020 6966 2061 782e 6372  e)..    if ax.cr
-000152b0: 6f73 7368 6169 7220 6973 206e 6f74 204e  osshair is not N
-000152c0: 6f6e 653a 0d0a 2020 2020 2020 2020 6178  one:..        ax
-000152d0: 2e63 726f 7373 6861 6972 2e73 686f 7728  .crosshair.show(
-000152e0: 290d 0a20 2020 2061 782e 7369 676e 6966  )..    ax.signif
-000152f0: 6963 616e 745f 666f 7263 6564 203d 2046  icant_forced = F
-00015300: 616c 7365 0d0a 0d0a 0d0a 6465 6620 5f63  alse......def _c
-00015310: 7265 6174 655f 6c65 6765 6e64 2861 7829  reate_legend(ax)
-00015320: 3a0d 0a20 2020 2069 6620 6178 2e76 622e  :..    if ax.vb.
-00015330: 6d61 7374 6572 5f76 6965 7762 6f78 3a0d  master_viewbox:.
-00015340: 0a20 2020 2020 2020 2061 7820 3d20 6178  .        ax = ax
-00015350: 2e76 622e 6d61 7374 6572 5f76 6965 7762  .vb.master_viewb
-00015360: 6f78 2e70 6172 656e 7428 290d 0a20 2020  ox.parent()..   
-00015370: 2069 6620 6178 2e6c 6567 656e 6420 6973   if ax.legend is
-00015380: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
-00015390: 6178 2e6c 6567 656e 6420 3d20 4669 6e4c  ax.legend = FinL
-000153a0: 6567 656e 6449 7465 6d28 626f 7264 6572  egendItem(border
-000153b0: 5f63 6f6c 6f72 3d6c 6567 656e 645f 626f  _color=legend_bo
-000153c0: 7264 6572 5f63 6f6c 6f72 2c20 6669 6c6c  rder_color, fill
-000153d0: 5f63 6f6c 6f72 3d6c 6567 656e 645f 6669  _color=legend_fi
-000153e0: 6c6c 5f63 6f6c 6f72 2c20 7369 7a65 3d4e  ll_color, size=N
-000153f0: 6f6e 652c 206f 6666 7365 743d 2833 2c32  one, offset=(3,2
-00015400: 2929 0d0a 2020 2020 2020 2020 6178 2e6c  ))..        ax.l
-00015410: 6567 656e 642e 7365 7450 6172 656e 7449  egend.setParentI
-00015420: 7465 6d28 6178 2e76 6229 0d0a 0d0a 0d0a  tem(ax.vb)......
-00015430: 6465 6620 5f75 7064 6174 655f 7369 676e  def _update_sign
-00015440: 6966 6963 616e 7473 2861 782c 2064 6174  ificants(ax, dat
-00015450: 6173 7263 2c20 666f 7263 6529 3a0d 0a20  asrc, force):.. 
-00015460: 2020 2023 2063 6865 636b 2069 6620 6e6f     # check if no
-00015470: 2065 7073 696c 6f6e 2073 6574 2079 6574   epsilon set yet
-00015480: 0d0a 2020 2020 6465 6661 756c 745f 6465  ..    default_de
-00015490: 6320 3d20 302e 3939 203c 2061 782e 7369  c = 0.99 < ax.si
-000154a0: 676e 6966 6963 616e 745f 6465 6369 6d61  gnificant_decima
-000154b0: 6c73 2f73 6967 6e69 6669 6361 6e74 5f64  ls/significant_d
-000154c0: 6563 696d 616c 7320 3c20 312e 3031 0d0a  ecimals < 1.01..
-000154d0: 2020 2020 6465 6661 756c 745f 6570 7320      default_eps 
-000154e0: 3d20 302e 3939 203c 2061 782e 7369 676e  = 0.99 < ax.sign
-000154f0: 6966 6963 616e 745f 6570 732f 7369 676e  ificant_eps/sign
-00015500: 6966 6963 616e 745f 6570 7320 3c20 312e  ificant_eps < 1.
-00015510: 3031 0d0a 2020 2020 6966 2066 6f72 6365  01..    if force
-00015520: 206f 7220 2864 6566 6175 6c74 5f64 6563   or (default_dec
-00015530: 2061 6e64 2064 6566 6175 6c74 5f65 7073   and default_eps
-00015540: 293a 0d0a 2020 2020 2020 2020 7472 793a  ):..        try:
-00015550: 0d0a 2020 2020 2020 2020 2020 2020 7364  ..            sd
-00015560: 2c73 6520 3d20 6461 7461 7372 632e 6361  ,se = datasrc.ca
-00015570: 6c63 5f73 6967 6e69 6669 6361 6e74 5f64  lc_significant_d
-00015580: 6563 696d 616c 7328 6675 6c6c 3d66 6f72  ecimals(full=for
-00015590: 6365 290d 0a20 2020 2020 2020 2020 2020  ce)..           
-000155a0: 2069 6620 7364 206f 7220 7365 2021 3d20   if sd or se != 
-000155b0: 7369 676e 6966 6963 616e 745f 6570 733a  significant_eps:
-000155c0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000155d0: 2020 6966 2028 666f 7263 6520 616e 6420    if (force and 
-000155e0: 6e6f 7420 6178 2e73 6967 6e69 6669 6361  not ax.significa
-000155f0: 6e74 5f66 6f72 6365 6429 206f 7220 6465  nt_forced) or de
-00015600: 6661 756c 745f 6465 6320 6f72 2073 6420  fault_dec or sd 
-00015610: 3e20 6178 2e73 6967 6e69 6669 6361 6e74  > ax.significant
-00015620: 5f64 6563 696d 616c 733a 0d0a 2020 2020  _decimals:..    
-00015630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015640: 6178 2e73 6967 6e69 6669 6361 6e74 5f64  ax.significant_d
-00015650: 6563 696d 616c 7320 3d20 7364 0d0a 2020  ecimals = sd..  
-00015660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015670: 2020 6178 2e73 6967 6e69 6669 6361 6e74    ax.significant
-00015680: 5f66 6f72 6365 6420 7c3d 2066 6f72 6365  _forced |= force
-00015690: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000156a0: 2020 6966 2028 666f 7263 6520 616e 6420    if (force and 
-000156b0: 6e6f 7420 6178 2e73 6967 6e69 6669 6361  not ax.significa
-000156c0: 6e74 5f66 6f72 6365 6429 206f 7220 6465  nt_forced) or de
-000156d0: 6661 756c 745f 6570 7320 6f72 2073 6520  fault_eps or se 
-000156e0: 3c20 6178 2e73 6967 6e69 6669 6361 6e74  < ax.significant
-000156f0: 5f65 7073 3a0d 0a20 2020 2020 2020 2020  _eps:..         
-00015700: 2020 2020 2020 2020 2020 2061 782e 7369             ax.si
-00015710: 676e 6966 6963 616e 745f 6570 7320 3d20  gnificant_eps = 
-00015720: 7365 0d0a 2020 2020 2020 2020 2020 2020  se..            
-00015730: 2020 2020 2020 2020 6178 2e73 6967 6e69          ax.signi
-00015740: 6669 6361 6e74 5f66 6f72 6365 6420 7c3d  ficant_forced |=
-00015750: 2066 6f72 6365 0d0a 2020 2020 2020 2020   force..        
-00015760: 6578 6365 7074 3a0d 0a20 2020 2020 2020  except:..       
-00015770: 2020 2020 2070 6173 7320 2320 6461 7461       pass # data
-00015780: 7372 6320 7072 6f62 6162 6c79 2066 756c  src probably ful
-00015790: 6c20 6176 204e 614e 730d 0a0d 0a0d 0a64  l av NaNs......d
-000157a0: 6566 205f 696d 7072 6f76 655f 7369 676e  ef _improve_sign
-000157b0: 6966 6963 616e 7473 2861 7829 3a0d 0a20  ificants(ax):.. 
-000157c0: 2020 2027 2727 466f 7263 6520 7570 6461     '''Force upda
-000157d0: 7465 206f 6620 7468 6520 4550 5320 6966  te of the EPS if
-000157e0: 2077 6520 626f 7468 2068 6176 6520 6e6f   we both have no
-000157f0: 2062 6172 732f 6361 6e64 6c65 7320 414e   bars/candles AN
-00015800: 4420 6120 6c6f 6720 7363 616c 652e 0d0a  D a log scale...
-00015810: 2020 2020 2020 2054 6869 7320 6973 2069         This is i
-00015820: 6e74 656e 6465 6420 746f 2066 6978 2074  ntended to fix t
-00015830: 6865 206c 6f77 6572 2070 6172 7420 6f66  he lower part of
-00015840: 2074 6865 2067 7269 6420 6f6e 206c 696e   the grid on lin
-00015850: 6520 706c 6f74 7320 6f6e 2061 206c 6f67  e plots on a log
-00015860: 2073 6361 6c65 2e27 2727 0d0a 2020 2020   scale.'''..    
-00015870: 6966 2061 782e 7662 2e79 7363 616c 652e  if ax.vb.yscale.
-00015880: 7363 616c 6574 7970 6520 3d3d 2027 6c6f  scaletype == 'lo
-00015890: 6727 3a0d 0a20 2020 2020 2020 2069 6620  g':..        if 
-000158a0: 6e6f 7420 616e 7928 6973 696e 7374 616e  not any(isinstan
-000158b0: 6365 2869 7465 6d2c 2043 616e 646c 6573  ce(item, Candles
-000158c0: 7469 636b 4974 656d 2920 666f 7220 6974  tickItem) for it
-000158d0: 656d 2069 6e20 6178 2e69 7465 6d73 293a  em in ax.items):
-000158e0: 0d0a 2020 2020 2020 2020 2020 2020 5f75  ..            _u
-000158f0: 7064 6174 655f 7369 676e 6966 6963 616e  pdate_significan
-00015900: 7473 2861 782c 2061 782e 7662 2e64 6174  ts(ax, ax.vb.dat
-00015910: 6173 7263 2c20 666f 7263 653d 5472 7565  asrc, force=True
-00015920: 290d 0a0d 0a0d 0a64 6566 205f 6973 5f73  )......def _is_s
-00015930: 7461 6e64 616c 6f6e 6528 7469 6d65 7365  tandalone(timese
-00015940: 7229 3a0d 0a20 2020 2023 206d 6f72 6520  r):..    # more 
-00015950: 7468 616e 204e 2070 6572 6365 6e74 2067  than N percent g
-00015960: 6170 7320 6f72 2074 696d 6520 7265 7665  aps or time reve
-00015970: 7273 616c 7320 7072 6f62 6162 6c79 206d  rsals probably m
-00015980: 6561 6e73 2074 6869 7320 6973 2061 2073  eans this is a s
-00015990: 7461 6e64 616c 6f6e 6520 706c 6f74 0d0a  tandalone plot..
-000159a0: 2020 2020 7265 7475 726e 2074 696d 6573      return times
-000159b0: 6572 2e69 736e 756c 6c28 292e 7375 6d28  er.isnull().sum(
-000159c0: 2920 2b20 2874 696d 6573 6572 2e64 6966  ) + (timeser.dif
-000159d0: 6628 293c 3d30 292e 7375 6d28 2920 3e20  f()<=0).sum() > 
-000159e0: 6c65 6e28 7469 6d65 7365 7229 2a30 2e31  len(timeser)*0.1
-000159f0: 0d0a 0d0a 0d0a 6465 6620 5f63 7265 6174  ......def _creat
-00015a00: 655f 7365 7269 6573 2861 293a 0d0a 2020  e_series(a):..  
-00015a10: 2020 7265 7475 726e 2061 2069 6620 6973    return a if is
-00015a20: 696e 7374 616e 6365 2861 2c20 7064 2e53  instance(a, pd.S
-00015a30: 6572 6965 7329 2065 6c73 6520 7064 2e53  eries) else pd.S
-00015a40: 6572 6965 7328 6129 0d0a 0d0a 0d0a 6465  eries(a)......de
-00015a50: 6620 5f63 7265 6174 655f 6461 7461 7372  f _create_datasr
-00015a60: 6328 6178 2c20 2a61 7267 732c 206e 636f  c(ax, *args, nco
-00015a70: 6c73 3d2d 3129 3a0d 0a20 2020 2064 6566  ls=-1):..    def
-00015a80: 2064 6f5f 6372 6561 7465 2861 7267 7329   do_create(args)
-00015a90: 3a0d 0a20 2020 2020 2020 2069 6620 6c65  :..        if le
-00015aa0: 6e28 6172 6773 2920 3d3d 2031 2061 6e64  n(args) == 1 and
-00015ab0: 2074 7970 6528 6172 6773 5b30 5d29 203d   type(args[0]) =
-00015ac0: 3d20 5061 6e64 6173 4461 7461 536f 7572  = PandasDataSour
-00015ad0: 6365 3a0d 0a20 2020 2020 2020 2020 2020  ce:..           
-00015ae0: 2072 6574 7572 6e20 6172 6773 5b30 5d0d   return args[0].
-00015af0: 0a20 2020 2020 2020 2069 6620 6c65 6e28  .        if len(
-00015b00: 6172 6773 2920 3d3d 2031 2061 6e64 2074  args) == 1 and t
-00015b10: 7970 6528 6172 6773 5b30 5d29 2069 6e20  ype(args[0]) in 
-00015b20: 286c 6973 742c 2074 7570 6c65 293a 0d0a  (list, tuple):..
-00015b30: 2020 2020 2020 2020 2020 2020 6172 6773              args
-00015b40: 203d 205b 6e70 2e61 7272 6179 2861 7267   = [np.array(arg
-00015b50: 735b 305d 295d 0d0a 2020 2020 2020 2020  s[0])]..        
-00015b60: 6966 206c 656e 2861 7267 7329 203d 3d20  if len(args) == 
-00015b70: 3120 616e 6420 7479 7065 2861 7267 735b  1 and type(args[
-00015b80: 305d 2920 3d3d 206e 702e 6e64 6172 7261  0]) == np.ndarra
-00015b90: 793a 0d0a 2020 2020 2020 2020 2020 2020  y:..            
-00015ba0: 6172 6773 203d 205b 7064 2e44 6174 6146  args = [pd.DataF
-00015bb0: 7261 6d65 2861 7267 735b 305d 2e54 295d  rame(args[0].T)]
-00015bc0: 0d0a 2020 2020 2020 2020 6966 206c 656e  ..        if len
-00015bd0: 2861 7267 7329 203d 3d20 3120 616e 6420  (args) == 1 and 
-00015be0: 7479 7065 2861 7267 735b 305d 2920 3d3d  type(args[0]) ==
-00015bf0: 2070 642e 4461 7461 4672 616d 653a 0d0a   pd.DataFrame:..
-00015c00: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00015c10: 726e 2050 616e 6461 7344 6174 6153 6f75  rn PandasDataSou
-00015c20: 7263 6528 6172 6773 5b30 5d29 0d0a 2020  rce(args[0])..  
-00015c30: 2020 2020 2020 6172 6773 203d 205b 5f63        args = [_c
-00015c40: 7265 6174 655f 7365 7269 6573 2861 2920  reate_series(a) 
-00015c50: 666f 7220 6120 696e 2061 7267 735d 0d0a  for a in args]..
-00015c60: 2020 2020 2020 2020 7265 7475 726e 2050          return P
-00015c70: 616e 6461 7344 6174 6153 6f75 7263 6528  andasDataSource(
-00015c80: 7064 2e63 6f6e 6361 7428 6172 6773 2c20  pd.concat(args, 
-00015c90: 6178 6973 3d31 2929 0d0a 2020 2020 6961  axis=1))..    ia
-00015ca0: 7267 7320 3d20 5b61 2066 6f72 2061 2069  rgs = [a for a i
-00015cb0: 6e20 6172 6773 2069 6620 6120 6973 206e  n args if a is n
-00015cc0: 6f74 204e 6f6e 655d 0d0a 2020 2020 6461  ot None]..    da
-00015cd0: 7461 7372 6320 3d20 646f 5f63 7265 6174  tasrc = do_creat
-00015ce0: 6528 6961 7267 7329 0d0a 2020 2020 2320  e(iargs)..    # 
-00015cf0: 6368 6563 6b20 6966 2074 696d 6520 636f  check if time co
-00015d00: 6c75 6d6e 206d 6973 7369 6e67 0d0a 2020  lumn missing..  
-00015d10: 2020 6966 206c 656e 2864 6174 6173 7263    if len(datasrc
-00015d20: 2e64 662e 636f 6c75 6d6e 7329 2069 6e20  .df.columns) in 
-00015d30: 2831 2c20 6e63 6f6c 732d 3129 3a0d 0a20  (1, ncols-1):.. 
-00015d40: 2020 2020 2020 2023 2061 7373 756d 6520         # assume 
-00015d50: 7469 6d65 2064 6174 6120 6861 7320 616c  time data has al
-00015d60: 7265 6164 7920 6265 656e 2061 6464 6564  ready been added
-00015d70: 2062 6566 6f72 650d 0a20 2020 2020 2020   before..       
-00015d80: 2066 6f72 2061 2069 6e20 6178 2e76 622e   for a in ax.vb.
-00015d90: 7769 6e2e 6178 733a 0d0a 2020 2020 2020  win.axs:..      
-00015da0: 2020 2020 2020 6966 2061 2e76 622e 6461        if a.vb.da
-00015db0: 7461 7372 6320 616e 6420 6c65 6e28 612e  tasrc and len(a.
-00015dc0: 7662 2e64 6174 6173 7263 2e64 662e 636f  vb.datasrc.df.co
-00015dd0: 6c75 6d6e 7329 203e 3d20 323a 0d0a 2020  lumns) >= 2:..  
-00015de0: 2020 2020 2020 2020 2020 2020 2020 6461                da
-00015df0: 7461 7372 632e 6466 2e63 6f6c 756d 6e73  tasrc.df.columns
-00015e00: 203d 2061 2e76 622e 6461 7461 7372 632e   = a.vb.datasrc.
-00015e10: 6466 2e63 6f6c 756d 6e73 5b31 3a6c 656e  df.columns[1:len
-00015e20: 2864 6174 6173 7263 2e64 662e 636f 6c75  (datasrc.df.colu
-00015e30: 6d6e 7329 2b31 5d0d 0a20 2020 2020 2020  mns)+1]..       
-00015e40: 2020 2020 2020 2020 2063 6f6c 203d 2061           col = a
-00015e50: 2e76 622e 6461 7461 7372 632e 6466 2e63  .vb.datasrc.df.c
-00015e60: 6f6c 756d 6e73 5b30 5d0d 0a20 2020 2020  olumns[0]..     
-00015e70: 2020 2020 2020 2020 2020 2064 6174 6173             datas
-00015e80: 7263 2e64 662e 696e 7365 7274 2830 2c20  rc.df.insert(0, 
-00015e90: 636f 6c2c 2061 2e76 622e 6461 7461 7372  col, a.vb.datasr
-00015ea0: 632e 6466 5b63 6f6c 5d29 0d0a 2020 2020  c.df[col])..    
-00015eb0: 2020 2020 2020 2020 2020 2020 6461 7461              data
-00015ec0: 7372 6320 3d20 5061 6e64 6173 4461 7461  src = PandasData
-00015ed0: 536f 7572 6365 2864 6174 6173 7263 2e64  Source(datasrc.d
-00015ee0: 6629 0d0a 2020 2020 2020 2020 2020 2020  f)..            
-00015ef0: 2020 2020 6272 6561 6b0d 0a20 2020 2020      break..     
-00015f00: 2020 2069 6620 6c65 6e28 6461 7461 7372     if len(datasr
-00015f10: 632e 6466 2e63 6f6c 756d 6e73 2920 696e  c.df.columns) in
-00015f20: 2028 312c 206e 636f 6c73 2d31 293a 0d0a   (1, ncols-1):..
-00015f30: 2020 2020 2020 2020 2020 2020 6966 206e              if n
-00015f40: 636f 6c73 203e 2031 3a0d 0a20 2020 2020  cols > 1:..     
-00015f50: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-00015f60: 2866 2257 4152 4e49 4e47 3a20 7468 6973  (f"WARNING: this
-00015f70: 2074 7970 6520 6f66 2070 6c6f 7420 7761   type of plot wa
-00015f80: 6e74 7320 2569 2063 6f6c 756d 6e73 2f61  nts %i columns/a
-00015f90: 7267 732c 2062 7574 2079 6f75 2776 6520  rgs, but you've 
-00015fa0: 6f6e 6c79 2073 7570 706c 6965 6420 2569  only supplied %i
-00015fb0: 2220 2520 286e 636f 6c73 2c20 6c65 6e28  " % (ncols, len(
-00015fc0: 6461 7461 7372 632e 6466 2e63 6f6c 756d  datasrc.df.colum
-00015fd0: 6e73 2929 290d 0a20 2020 2020 2020 2020  ns)))..         
-00015fe0: 2020 2020 2020 2070 7269 6e74 2827 202d         print(' -
-00015ff0: 2041 7373 756d 696e 6720 7469 6d65 2063   Assuming time c
-00016000: 6f6c 756d 6e20 6973 206d 6973 7369 6e67  olumn is missing
-00016010: 2061 6e64 2075 7369 6e67 2069 6e64 6578   and using index
-00016020: 2069 6e73 7465 6164 2e27 290d 0a20 2020   instead.')..   
-00016030: 2020 2020 2020 2020 2064 6174 6173 7263           datasrc
-00016040: 203d 2050 616e 6461 7344 6174 6153 6f75   = PandasDataSou
-00016050: 7263 6528 6461 7461 7372 632e 6466 2e72  rce(datasrc.df.r
-00016060: 6573 6574 5f69 6e64 6578 2829 290d 0a20  eset_index()).. 
-00016070: 2020 2065 6c69 6620 6c65 6e28 6961 7267     elif len(iarg
-00016080: 7329 203e 3d20 3220 616e 6420 6c65 6e28  s) >= 2 and len(
-00016090: 6461 7461 7372 632e 6466 2e63 6f6c 756d  datasrc.df.colum
-000160a0: 6e73 2920 3d3d 206c 656e 2869 6172 6773  ns) == len(iargs
-000160b0: 292b 3120 616e 6420 6c65 6e28 6961 7267  )+1 and len(iarg
-000160c0: 7329 203d 3d20 6c65 6e28 6172 6773 293a  s) == len(args):
-000160d0: 0d0a 2020 2020 2020 2020 7472 793a 0d0a  ..        try:..
-000160e0: 2020 2020 2020 2020 2020 2020 6966 2027              if '
-000160f0: 2e49 6e74 2720 696e 2073 7472 2874 7970  .Int' in str(typ
-00016100: 6528 6961 7267 735b 305d 2e69 6e64 6578  e(iargs[0].index
-00016110: 2929 3a0d 0a20 2020 2020 2020 2020 2020  )):..           
-00016120: 2020 2020 2070 7269 6e74 2827 5741 524e       print('WARN
-00016130: 494e 473a 2070 6572 666f 726d 616e 6365  ING: performance
-00016140: 2070 656e 616c 7479 2061 6e64 2063 7261   penalty and cra
-00016150: 7368 206d 6179 206f 6363 7572 2077 6865  sh may occur whe
-00016160: 6e20 7573 696e 6720 696e 7436 3420 696e  n using int64 in
-00016170: 7374 6561 6420 6f66 2072 616e 6765 2069  stead of range i
-00016180: 6e64 6963 6573 2e27 290d 0a20 2020 2020  ndices.')..     
-00016190: 2020 2020 2020 2020 2020 2069 6620 2869             if (i
-000161a0: 6172 6773 5b30 5d2e 696e 6465 7820 3d3d  args[0].index ==
-000161b0: 2072 616e 6765 286c 656e 2869 6172 6773   range(len(iargs
-000161c0: 5b30 5d29 2929 2e61 6c6c 2829 3a0d 0a20  [0]))).all():.. 
-000161d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000161e0: 2020 2070 7269 6e74 2827 202d 2046 6978     print(' - Fix
-000161f0: 2062 7920 2e72 6573 6574 5f69 6e64 6578   by .reset_index
-00016200: 2864 726f 703d 5472 7565 2927 290d 0a20  (drop=True)').. 
-00016210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016220: 2020 2072 6574 7572 6e20 5f63 7265 6174     return _creat
-00016230: 655f 6461 7461 7372 6328 6178 2c20 6461  e_datasrc(ax, da
-00016240: 7461 7372 632e 6466 5b64 6174 6173 7263  tasrc.df[datasrc
-00016250: 2e64 662e 636f 6c75 6d6e 735b 313a 5d5d  .df.columns[1:]]
-00016260: 2c20 6e63 6f6c 733d 6e63 6f6c 7329 0d0a  , ncols=ncols)..
-00016270: 2020 2020 2020 2020 6578 6365 7074 3a0d          except:.
-00016280: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
-00016290: 6e74 2827 5741 524e 494e 473a 2069 6e70  nt('WARNING: inp
-000162a0: 7574 2064 6174 6120 736f 7572 6365 206d  ut data source m
-000162b0: 6179 2063 6175 7365 2070 6572 666f 726d  ay cause perform
-000162c0: 616e 6365 2070 656e 616c 7479 2061 6e64  ance penalty and
-000162d0: 2063 7261 7368 2e27 290d 0a0d 0a20 2020   crash.')....   
-000162e0: 2061 7373 6572 7420 6c65 6e28 6461 7461   assert len(data
-000162f0: 7372 632e 6466 2e63 6f6c 756d 6e73 2920  src.df.columns) 
-00016300: 3e3d 206e 636f 6c73 2c20 2745 5252 4f52  >= ncols, 'ERROR
-00016310: 3a20 746f 6f20 6665 7720 636f 6c75 6d6e  : too few column
-00016320: 732f 6172 6773 2073 7570 706c 6965 6420  s/args supplied 
-00016330: 666f 7220 7468 6973 2070 6c6f 7427 0d0a  for this plot'..
-00016340: 0d0a 2020 2020 6966 2064 6174 6173 7263  ..    if datasrc
-00016350: 2e70 6572 696f 645f 6e73 203c 2030 3a0d  .period_ns < 0:.
-00016360: 0a20 2020 2020 2020 2070 7269 6e74 2827  .        print('
-00016370: 5741 524e 494e 473a 2069 6e70 7574 2064  WARNING: input d
-00016380: 6174 6120 736f 7572 6365 2068 6173 2074  ata source has t
-00016390: 696d 6520 696e 2064 6573 6365 6e64 696e  ime in descendin
-000163a0: 6720 6f72 6465 722e 2054 7279 2073 6f72  g order. Try sor
-000163b0: 745f 7661 6c75 6573 2829 2062 6566 6f72  t_values() befor
-000163c0: 6520 6361 6c6c 696e 672e 2729 0d0a 0d0a  e calling.')....
-000163d0: 2020 2020 2320 4649 583a 2073 7475 7069      # FIX: stupi
-000163e0: 6420 5154 2062 7567 2063 6175 7365 7320  d QT bug causes 
-000163f0: 7265 6374 616e 676c 6573 206c 6172 6765  rectangles large
-00016400: 7220 7468 616e 2032 4720 746f 2066 6c69  r than 2G to fli
-00016410: 636b 6572 2c20 736f 2073 6361 6c65 2072  cker, so scale r
-00016420: 656e 6465 7269 6e67 2064 6f77 6e20 736f  endering down so
-00016430: 6d65 0d0a 2020 2020 2320 4649 583a 2050  me..    # FIX: P
-00016440: 7951 7420 352e 3135 2e32 206c 696e 6573  yQt 5.15.2 lines
-00016450: 203e 3165 3620 6172 6520 6265 696e 6720   >1e6 are being 
-00016460: 636c 6970 7065 6420 746f 2031 6536 2064  clipped to 1e6 d
-00016470: 7572 696e 6720 7468 6520 6669 7273 7420  uring the first 
-00016480: 7265 6e64 6572 2070 6173 732c 2073 6f20  render pass, so 
-00016490: 7363 616c 6520 646f 776e 2069 6620 3e31  scale down if >1
-000164a0: 6536 0d0a 2020 2020 6966 2064 6174 6173  e6..    if datas
-000164b0: 7263 2e64 662e 696c 6f63 5b3a 2c20 313a  rc.df.iloc[:, 1:
-000164c0: 5d2e 6d61 7828 6e75 6d65 7269 635f 6f6e  ].max(numeric_on
-000164d0: 6c79 3d54 7275 6529 2e6d 6178 2829 203e  ly=True).max() >
-000164e0: 2031 6536 3a0d 0a20 2020 2020 2020 2061   1e6:..        a
-000164f0: 782e 7662 2e79 7363 616c 652e 7365 745f  x.vb.yscale.set_
-00016500: 7363 616c 6528 696e 7428 3165 3629 290d  scale(int(1e6)).
-00016510: 0a20 2020 2072 6574 7572 6e20 6461 7461  .    return data
-00016520: 7372 630d 0a0d 0a0d 0a64 6566 205f 7365  src......def _se
-00016530: 745f 6461 7461 7372 6328 6178 2c20 6461  t_datasrc(ax, da
-00016540: 7461 7372 632c 2061 6464 636f 6c73 3d54  tasrc, addcols=T
-00016550: 7275 6529 3a0d 0a20 2020 2076 6965 7762  rue):..    viewb
-00016560: 6f78 203d 2061 782e 7662 0d0a 2020 2020  ox = ax.vb..    
-00016570: 6966 206e 6f74 2064 6174 6173 7263 2e73  if not datasrc.s
-00016580: 7461 6e64 616c 6f6e 653a 0d0a 2020 2020  tandalone:..    
-00016590: 2020 2020 6966 2076 6965 7762 6f78 2e64      if viewbox.d
-000165a0: 6174 6173 7263 2069 7320 4e6f 6e65 3a0d  atasrc is None:.
-000165b0: 0a20 2020 2020 2020 2020 2020 2076 6965  .            vie
-000165c0: 7762 6f78 2e73 6574 5f64 6174 6173 7263  wbox.set_datasrc
-000165d0: 2864 6174 6173 7263 2920 2320 666f 7220  (datasrc) # for 
-000165e0: 6d77 6865 656c 207a 6f6f 6d2d 7363 616c  mwheel zoom-scal
-000165f0: 696e 670d 0a20 2020 2020 2020 2020 2020  ing..           
-00016600: 205f 7365 745f 785f 6c69 6d69 7473 2861   _set_x_limits(a
-00016610: 782c 2064 6174 6173 7263 290d 0a20 2020  x, datasrc)..   
-00016620: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
-00016630: 2020 2020 2020 2020 7430 203d 2076 6965          t0 = vie
-00016640: 7762 6f78 2e64 6174 6173 7263 2e78 2e6c  wbox.datasrc.x.l
-00016650: 6f63 5b30 5d0d 0a20 2020 2020 2020 2020  oc[0]..         
-00016660: 2020 2069 6620 6164 6463 6f6c 733a 0d0a     if addcols:..
-00016670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016680: 7669 6577 626f 782e 6461 7461 7372 632e  viewbox.datasrc.
-00016690: 6164 6463 6f6c 7328 6461 7461 7372 6329  addcols(datasrc)
-000166a0: 0d0a 2020 2020 2020 2020 2020 2020 656c  ..            el
-000166b0: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
-000166c0: 2020 2020 2076 6965 7762 6f78 2e64 6174       viewbox.dat
-000166d0: 6173 7263 2e64 6620 3d20 6461 7461 7372  asrc.df = datasr
-000166e0: 632e 6466 0d0a 2020 2020 2020 2020 2020  c.df..          
-000166f0: 2020 2320 6368 6563 6b20 6966 2077 6520    # check if we 
-00016700: 6e65 6564 2074 6f20 7265 2d72 656e 6465  need to re-rende
-00016710: 7220 7072 6576 696f 7573 2070 6c6f 7473  r previous plots
-00016720: 2064 7565 2074 6f20 6368 616e 6765 6420   due to changed 
-00016730: 696e 6469 6365 730d 0a20 2020 2020 2020  indices..       
-00016740: 2020 2020 2069 6e64 6963 6573 5f75 7064       indices_upd
-00016750: 6174 6564 203d 2076 6965 7762 6f78 2e64  ated = viewbox.d
-00016760: 6174 6173 7263 2e74 696d 6562 6173 6564  atasrc.timebased
-00016770: 2829 2061 6e64 2074 3020 213d 2076 6965  () and t0 != vie
-00016780: 7762 6f78 2e64 6174 6173 7263 2e78 2e6c  wbox.datasrc.x.l
-00016790: 6f63 5b30 5d0d 0a20 2020 2020 2020 2020  oc[0]..         
-000167a0: 2020 2066 6f72 2069 7465 6d20 696e 2061     for item in a
-000167b0: 782e 6974 656d 733a 0d0a 2020 2020 2020  x.items:..      
-000167c0: 2020 2020 2020 2020 2020 6966 2068 6173            if has
-000167d0: 6174 7472 2869 7465 6d2c 2027 6461 7461  attr(item, 'data
-000167e0: 7372 6327 2920 616e 6420 6e6f 7420 6974  src') and not it
-000167f0: 656d 2e64 6174 6173 7263 2e73 7461 6e64  em.datasrc.stand
-00016800: 616c 6f6e 653a 0d0a 2020 2020 2020 2020  alone:..        
-00016810: 2020 2020 2020 2020 2020 2020 6974 656d              item
-00016820: 2e64 6174 6173 7263 2e73 6574 5f64 6628  .datasrc.set_df(
-00016830: 7669 6577 626f 782e 6461 7461 7372 632e  viewbox.datasrc.
-00016840: 6466 2920 2320 6576 6572 7920 706c 6f74  df) # every plot
-00016850: 2068 6572 6520 6e6f 7720 6861 7320 7468   here now has th
-00016860: 6520 7361 6d65 2074 696d 652d 6672 616d  e same time-fram
-00016870: 650d 0a20 2020 2020 2020 2020 2020 2020  e..             
-00016880: 2020 2020 2020 2069 6620 696e 6469 6365         if indice
-00016890: 735f 7570 6461 7465 643a 0d0a 2020 2020  s_updated:..    
-000168a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000168b0: 2020 2020 5f73 7461 7274 5f76 6973 7561      _start_visua
-000168c0: 6c5f 7570 6461 7465 2869 7465 6d29 0d0a  l_update(item)..
-000168d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000168e0: 2020 2020 2020 2020 5f65 6e64 5f76 6973          _end_vis
-000168f0: 7561 6c5f 7570 6461 7465 2869 7465 6d29  ual_update(item)
-00016900: 0d0a 2020 2020 2020 2020 2020 2020 5f73  ..            _s
-00016910: 6574 5f78 5f6c 696d 6974 7328 6178 2c20  et_x_limits(ax, 
-00016920: 6461 7461 7372 6329 0d0a 2020 2020 2020  datasrc)..      
-00016930: 2020 2020 2020 7669 6577 626f 782e 7365        viewbox.se
-00016940: 745f 6461 7461 7372 6328 7669 6577 626f  t_datasrc(viewbo
-00016950: 782e 6461 7461 7372 6329 2023 2075 7064  x.datasrc) # upd
-00016960: 6174 6520 7a6f 6f6d 0d0a 2020 2020 656c  ate zoom..    el
-00016970: 7365 3a0d 0a20 2020 2020 2020 2076 6965  se:..        vie
-00016980: 7762 6f78 2e73 7461 6e64 616c 6f6e 6573  wbox.standalones
-00016990: 2e61 6464 2864 6174 6173 7263 290d 0a20  .add(datasrc).. 
-000169a0: 2020 2020 2020 2064 6174 6173 7263 2e75         datasrc.u
-000169b0: 7064 6174 655f 696e 6974 5f78 2876 6965  pdate_init_x(vie
-000169c0: 7762 6f78 2e69 6e69 745f 7374 6570 7329  wbox.init_steps)
-000169d0: 0d0a 2020 2020 2020 2020 6966 2064 6174  ..        if dat
-000169e0: 6173 7263 2e74 696d 6562 6173 6564 2829  asrc.timebased()
-000169f0: 2061 6e64 2076 6965 7762 6f78 2e64 6174   and viewbox.dat
-00016a00: 6173 7263 2069 7320 6e6f 7420 4e6f 6e65  asrc is not None
-00016a10: 3a0d 0a20 2020 2020 2020 2020 2020 2023  :..            #
-00016a20: 2320 7072 696e 7428 2757 4152 4e49 4e47  # print('WARNING
-00016a30: 3a20 7265 2d69 6e64 6578 696e 6720 7374  : re-indexing st
-00016a40: 616e 6461 6c6f 6e65 2c20 7469 6d65 2d62  andalone, time-b
-00016a50: 6173 6564 2070 6c6f 7427 290d 0a20 2020  ased plot')..   
-00016a60: 2020 2020 2020 2020 2076 6466 203d 2076           vdf = v
-00016a70: 6965 7762 6f78 2e64 6174 6173 7263 2e64  iewbox.datasrc.d
-00016a80: 660d 0a20 2020 2020 2020 2020 2020 2064  f..            d
-00016a90: 203d 207b 763a 6b20 666f 7220 6b2c 7620   = {v:k for k,v 
-00016aa0: 696e 2065 6e75 6d65 7261 7465 2876 6466  in enumerate(vdf
-00016ab0: 5b76 6466 2e63 6f6c 756d 6e73 5b30 5d5d  [vdf.columns[0]]
-00016ac0: 297d 0d0a 2020 2020 2020 2020 2020 2020  )}..            
-00016ad0: 6461 7461 7372 632e 6466 2e69 6e64 6578  datasrc.df.index
-00016ae0: 203d 205b 645b 695d 2066 6f72 2069 2069   = [d[i] for i i
-00016af0: 6e20 6461 7461 7372 632e 6466 5b64 6174  n datasrc.df[dat
-00016b00: 6173 7263 2e64 662e 636f 6c75 6d6e 735b  asrc.df.columns[
-00016b10: 305d 5d5d 0d0a 2020 2020 2020 2020 2323  0]]]..        ##
-00016b20: 2069 6620 6e6f 7420 7669 6577 626f 782e   if not viewbox.
-00016b30: 785f 696e 6465 7865 643a 0d0a 2020 2020  x_indexed:..    
-00016b40: 2020 2020 2020 2020 2323 205f 7365 745f          ## _set_
-00016b50: 785f 6c69 6d69 7473 2861 782c 2064 6174  x_limits(ax, dat
-00016b60: 6173 7263 290d 0a20 2020 2023 2075 7064  asrc)..    # upd
-00016b70: 6174 6520 7065 7269 6f64 2069 6620 7468  ate period if th
-00016b80: 6973 2064 6174 6173 7263 2068 6173 2068  is datasrc has h
-00016b90: 6967 6865 7220 7469 6d65 2072 6573 6f6c  igher time resol
-00016ba0: 7574 696f 6e0d 0a20 2020 2067 6c6f 6261  ution..    globa
-00016bb0: 6c20 6570 6f63 685f 7065 7269 6f64 0d0a  l epoch_period..
-00016bc0: 2020 2020 6966 2064 6174 6173 7263 2e74      if datasrc.t
-00016bd0: 696d 6562 6173 6564 2829 2061 6e64 2028  imebased() and (
-00016be0: 6570 6f63 685f 7065 7269 6f64 203e 2031  epoch_period > 1
-00016bf0: 6537 206f 7220 6e6f 7420 6461 7461 7372  e7 or not datasr
-00016c00: 632e 7374 616e 6461 6c6f 6e65 293a 0d0a  c.standalone):..
-00016c10: 2020 2020 2020 2020 6570 5f73 6563 7320          ep_secs 
-00016c20: 3d20 6461 7461 7372 632e 7065 7269 6f64  = datasrc.period
-00016c30: 5f6e 7320 2f20 3165 390d 0a20 2020 2020  _ns / 1e9..     
-00016c40: 2020 2065 706f 6368 5f70 6572 696f 6420     epoch_period 
-00016c50: 3d20 6570 5f73 6563 7320 6966 2065 705f  = ep_secs if ep_
-00016c60: 7365 6373 203c 2065 706f 6368 5f70 6572  secs < epoch_per
-00016c70: 696f 6420 656c 7365 2065 706f 6368 5f70  iod else epoch_p
-00016c80: 6572 696f 640d 0a0d 0a0d 0a64 6566 205f  eriod......def _
-00016c90: 6861 735f 7469 6d65 636f 6c28 6466 293a  has_timecol(df):
-00016ca0: 0d0a 2020 2020 7265 7475 726e 206c 656e  ..    return len
-00016cb0: 2864 662e 636f 6c75 6d6e 7329 203e 3d20  (df.columns) >= 
-00016cc0: 320d 0a0d 0a0d 0a64 6566 205f 7365 745f  2......def _set_
-00016cd0: 6d61 785f 7a6f 6f6d 2876 6273 293a 0d0a  max_zoom(vbs):..
-00016ce0: 2020 2020 2727 2753 6574 2074 6865 2072      '''Set the r
-00016cf0: 656c 6174 6976 6520 616c 6c6f 7765 6420  elative allowed 
-00016d00: 7a6f 6f6d 206c 6576 656c 2062 6574 7765  zoom level betwe
-00016d10: 656e 2061 7865 7320 6772 6f75 7073 2c20  en axes groups, 
-00016d20: 7768 6572 6520 7468 6520 6c6f 7765 7374  where the lowest
-00016d30: 2d72 6573 6f6c 7574 696f 6e0d 0a20 2020  -resolution..   
-00016d40: 2020 2020 706c 6f74 2069 6e20 6561 6368      plot in each
-00016d50: 2067 726f 7570 2075 7365 7320 6d61 785f   group uses max_
-00016d60: 7a6f 6f6d 5f70 6f69 6e74 732c 2077 6869  zoom_points, whi
-00016d70: 6c65 2074 6865 206f 7468 6572 7320 6765  le the others ge
-00016d80: 7420 6120 7363 616c 6520 3e3d 3120 6f66  t a scale >=1 of
-00016d90: 2074 6865 6972 0d0a 2020 2020 2020 2072   their..       r
-00016da0: 6573 7065 6374 6976 6520 6869 6768 6573  espective highes
-00016db0: 7420 7a6f 6f6d 206c 6576 656c 2e27 2727  t zoom level.'''
-00016dc0: 0d0a 2020 2020 6772 6f75 7073 203d 2064  ..    groups = d
-00016dd0: 6566 6175 6c74 6469 6374 2873 6574 290d  efaultdict(set).
-00016de0: 0a20 2020 2066 6f72 2076 6220 696e 2076  .    for vb in v
-00016df0: 6273 3a0d 0a20 2020 2020 2020 206d 6173  bs:..        mas
-00016e00: 7465 725f 7662 203d 2076 622e 6c69 6e6b  ter_vb = vb.link
-00016e10: 6564 5669 6577 2830 290d 0a20 2020 2020  edView(0)..     
-00016e20: 2020 2069 6620 7662 2e64 6174 6173 7263     if vb.datasrc
-00016e30: 2061 6e64 206d 6173 7465 725f 7662 2061   and master_vb a
-00016e40: 6e64 206d 6173 7465 725f 7662 2e64 6174  nd master_vb.dat
-00016e50: 6173 7263 3a0d 0a20 2020 2020 2020 2020  asrc:..         
-00016e60: 2020 2067 726f 7570 735b 6d61 7374 6572     groups[master
-00016e70: 5f76 625d 2e61 6464 2876 6229 0d0a 2020  _vb].add(vb)..  
-00016e80: 2020 2020 2020 2020 2020 6772 6f75 7073            groups
-00016e90: 5b6d 6173 7465 725f 7662 5d2e 6164 6428  [master_vb].add(
-00016ea0: 6d61 7374 6572 5f76 6229 0d0a 2020 2020  master_vb)..    
-00016eb0: 666f 7220 6772 6f75 7020 696e 2067 726f  for group in gro
-00016ec0: 7570 732e 7661 6c75 6573 2829 3a0d 0a20  ups.values():.. 
-00016ed0: 2020 2020 2020 206d 696e 6c65 6e20 3d20         minlen = 
-00016ee0: 6d69 6e28 6c65 6e28 7662 2e64 6174 6173  min(len(vb.datas
-00016ef0: 7263 2e64 6629 2066 6f72 2076 6220 696e  rc.df) for vb in
-00016f00: 2067 726f 7570 290d 0a20 2020 2020 2020   group)..       
-00016f10: 2066 6f72 2076 6220 696e 2067 726f 7570   for vb in group
-00016f20: 3a0d 0a20 2020 2020 2020 2020 2020 2076  :..            v
-00016f30: 622e 6d61 785f 7a6f 6f6d 5f70 6f69 6e74  b.max_zoom_point
-00016f40: 735f 6620 3d20 6c65 6e28 7662 2e64 6174  s_f = len(vb.dat
-00016f50: 6173 7263 2e64 6629 202f 206d 696e 6c65  asrc.df) / minle
-00016f60: 6e0d 0a0d 0a0d 0a64 6566 205f 6164 6a75  n......def _adju
-00016f70: 7374 5f72 656e 6b6f 5f64 6174 6173 7263  st_renko_datasrc
-00016f80: 2862 696e 732c 2073 7465 702c 2064 6174  (bins, step, dat
-00016f90: 6173 7263 293a 0d0a 2020 2020 6966 206e  asrc):..    if n
-00016fa0: 6f74 2062 696e 7320 616e 6420 6e6f 7420  ot bins and not 
-00016fb0: 7374 6570 3a0d 0a20 2020 2020 2020 2062  step:..        b
-00016fc0: 696e 7320 3d20 3530 0d0a 2020 2020 6966  ins = 50..    if
-00016fd0: 206e 6f74 2073 7465 703a 0d0a 2020 2020   not step:..    
-00016fe0: 2020 2020 7374 6570 203d 2028 6461 7461      step = (data
-00016ff0: 7372 632e 792e 6d61 7828 292d 6461 7461  src.y.max()-data
-00017000: 7372 632e 792e 6d69 6e28 2929 202f 2062  src.y.min()) / b
-00017010: 696e 730d 0a20 2020 2062 7269 636b 7320  ins..    bricks 
-00017020: 3d20 6461 7461 7372 632e 792e 6469 6666  = datasrc.y.diff
-00017030: 2829 202f 2073 7465 700d 0a20 2020 2062  () / step..    b
-00017040: 7269 636b 7320 3d20 2864 6174 6173 7263  ricks = (datasrc
-00017050: 2e79 5b62 7269 636b 732e 6973 6e75 6c6c  .y[bricks.isnull
-00017060: 2829 207c 2028 6272 6963 6b73 2e61 6273  () | (bricks.abs
-00017070: 2829 3e3d 302e 3529 5d20 2f20 7374 6570  ()>=0.5)] / step
-00017080: 292e 726f 756e 6428 292e 6173 7479 7065  ).round().astype
-00017090: 2869 6e74 290d 0a20 2020 2065 7874 7261  (int)..    extra
-000170a0: 7320 3d20 6461 7461 7372 632e 6466 2e69  s = datasrc.df.i
-000170b0: 6c6f 635b 3a2c 2064 6174 6173 7263 2e63  loc[:, datasrc.c
-000170c0: 6f6c 5f64 6174 615f 6f66 6673 6574 2b31  ol_data_offset+1
-000170d0: 3a5d 0d0a 2020 2020 7473 203d 2064 6174  :]..    ts = dat
-000170e0: 6173 7263 2e78 5b62 7269 636b 732e 696e  asrc.x[bricks.in
-000170f0: 6465 785d 0d0a 2020 2020 7570 203d 2062  dex]..    up = b
-00017100: 7269 636b 732e 696c 6f63 5b30 5d20 2b20  ricks.iloc[0] + 
-00017110: 310d 0a20 2020 2064 6e20 3d20 7570 202d  1..    dn = up -
-00017120: 2032 0d0a 2020 2020 6461 7461 203d 205b   2..    data = [
-00017130: 5d0d 0a20 2020 2066 6f72 2074 2c69 2c62  ]..    for t,i,b
-00017140: 7269 636b 2069 6e20 7a69 7028 7473 2c20  rick in zip(ts, 
-00017150: 6272 6963 6b73 2e69 6e64 6578 2c20 6272  bricks.index, br
-00017160: 6963 6b73 293a 0d0a 2020 2020 2020 2020  icks):..        
-00017170: 7320 3d20 300d 0a20 2020 2020 2020 2069  s = 0..        i
-00017180: 6620 6272 6963 6b20 3e3d 2075 703a 0d0a  f brick >= up:..
-00017190: 2020 2020 2020 2020 2020 2020 7830 2c78              x0,x
-000171a0: 312c 7320 3d20 7570 2d31 2c62 7269 636b  1,s = up-1,brick
-000171b0: 2c2b 310d 0a20 2020 2020 2020 2020 2020  ,+1..           
-000171c0: 2075 7020 3d20 6272 6963 6b2b 310d 0a20   up = brick+1.. 
-000171d0: 2020 2020 2020 2020 2020 2064 6e20 3d20             dn = 
-000171e0: 6272 6963 6b2d 320d 0a20 2020 2020 2020  brick-2..       
-000171f0: 2065 6c69 6620 6272 6963 6b20 3c3d 2064   elif brick <= d
-00017200: 6e3a 0d0a 2020 2020 2020 2020 2020 2020  n:..            
-00017210: 7830 2c78 312c 7320 3d20 646e 2c62 7269  x0,x1,s = dn,bri
-00017220: 636b 2d31 2c2d 310d 0a20 2020 2020 2020  ck-1,-1..       
-00017230: 2020 2020 2075 7020 3d20 6272 6963 6b2b       up = brick+
-00017240: 320d 0a20 2020 2020 2020 2020 2020 2064  2..            d
-00017250: 6e20 3d20 6272 6963 6b2d 310d 0a20 2020  n = brick-1..   
-00017260: 2020 2020 2069 6620 733a 0d0a 2020 2020       if s:..    
-00017270: 2020 2020 2020 2020 666f 7220 7820 696e          for x in
-00017280: 2072 616e 6765 2878 302c 2078 312c 2073   range(x0, x1, s
-00017290: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-000172a0: 2020 2020 7464 203d 2061 6273 2878 312d      td = abs(x1-
-000172b0: 7829 2d31 0d0a 2020 2020 2020 2020 2020  x)-1..          
-000172c0: 2020 2020 2020 6473 203d 2030 2069 6620        ds = 0 if 
-000172d0: 733e 3020 656c 7365 2073 7465 700d 0a20  s>0 else step.. 
-000172e0: 2020 2020 2020 2020 2020 2020 2020 2079                 y
-000172f0: 203d 2078 2a73 7465 700d 0a20 2020 2020   = x*step..     
-00017300: 2020 2020 2020 2020 2020 207a 203d 206c             z = l
-00017310: 6973 7428 6578 7472 6173 2e6c 6f63 5b69  ist(extras.loc[i
-00017320: 5d29 0d0a 2020 2020 2020 2020 2020 2020  ])..            
-00017330: 2020 2020 6461 7461 2e61 7070 656e 6428      data.append(
-00017340: 5b74 2d74 642c 2079 2b64 732c 2079 2b73  [t-td, y+ds, y+s
-00017350: 7465 702d 6473 2c20 792b 7374 6570 2c20  tep-ds, y+step, 
-00017360: 795d 202b 207a 290d 0a20 2020 2064 6174  y] + z)..    dat
-00017370: 6173 7263 2e73 6574 5f64 6628 7064 2e44  asrc.set_df(pd.D
-00017380: 6174 6146 7261 6d65 2864 6174 612c 2063  ataFrame(data, c
-00017390: 6f6c 756d 6e73 3d27 7469 6d65 206f 7065  olumns='time ope
-000173a0: 6e20 636c 6f73 6520 6869 6768 206c 6f77  n close high low
-000173b0: 272e 7370 6c69 7428 292b 6c69 7374 2865  '.split()+list(e
-000173c0: 7874 7261 732e 636f 6c75 6d6e 7329 2929  xtras.columns)))
-000173d0: 0d0a 0d0a 0d0a 6465 6620 5f61 646a 7573  ......def _adjus
-000173e0: 745f 7265 6e6b 6f5f 6c6f 675f 6461 7461  t_renko_log_data
-000173f0: 7372 6328 6269 6e73 2c20 7374 6570 2c20  src(bins, step, 
-00017400: 6461 7461 7372 6329 3a0d 0a20 2020 2064  datasrc):..    d
-00017410: 6174 6173 7263 2e64 662e 6c6f 635b 3a2c  atasrc.df.loc[:,
-00017420: 6461 7461 7372 632e 6466 2e63 6f6c 756d  datasrc.df.colum
-00017430: 735b 315d 5d20 3d20 6e70 2e6c 6f67 3130  s[1]] = np.log10
-00017440: 2864 6174 6173 7263 2e64 662e 696c 6f63  (datasrc.df.iloc
-00017450: 5b3a 2c31 5d29 0d0a 2020 2020 5f61 646a  [:,1])..    _adj
-00017460: 7573 745f 7265 6e6b 6f5f 6461 7461 7372  ust_renko_datasr
-00017470: 6328 6269 6e73 2c20 7374 6570 2c20 6461  c(bins, step, da
-00017480: 7461 7372 6329 0d0a 2020 2020 6461 7461  tasrc)..    data
-00017490: 7372 632e 6466 2e6c 6f63 5b3a 2c64 6174  src.df.loc[:,dat
-000174a0: 6173 7263 2e64 662e 636f 6c75 6d73 5b31  asrc.df.colums[1
-000174b0: 3a35 5d5d 203d 2031 302a 2a64 6174 6173  :5]] = 10**datas
-000174c0: 7263 2e64 662e 696c 6f63 5b3a 2c31 3a35  rc.df.iloc[:,1:5
-000174d0: 5d0d 0a0d 0a0d 0a64 6566 205f 6164 6a75  ]......def _adju
-000174e0: 7374 5f76 6f6c 756d 655f 6461 7461 7372  st_volume_datasr
-000174f0: 6328 6461 7461 7372 6329 3a0d 0a20 2020  c(datasrc):..   
-00017500: 2069 6620 6c65 6e28 6461 7461 7372 632e   if len(datasrc.
-00017510: 6466 2e63 6f6c 756d 6e73 2920 3c3d 2034  df.columns) <= 4
-00017520: 3a0d 0a20 2020 2020 2020 2064 6174 6173  :..        datas
-00017530: 7263 2e64 662e 696e 7365 7274 2833 2c20  rc.df.insert(3, 
-00017540: 275f 7a65 726f 5f27 2c20 5b30 5d2a 6c65  '_zero_', [0]*le
-00017550: 6e28 6461 7461 7372 632e 6466 2929 2023  n(datasrc.df)) #
-00017560: 2062 6173 6520 6f66 2063 616e 646c 6573   base of candles
-00017570: 2069 7320 616c 7761 7973 207a 6572 6f0d   is always zero.
-00017580: 0a20 2020 2064 6174 6173 7263 2e73 6574  .    datasrc.set
-00017590: 5f64 6628 6461 7461 7372 632e 6466 2e69  _df(datasrc.df.i
-000175a0: 6c6f 635b 3a2c 5b30 2c33 2c34 2c31 2c32  loc[:,[0,3,4,1,2
-000175b0: 5d5d 2920 2320 7265 2d61 7272 616e 6765  ]]) # re-arrange
-000175c0: 2063 6f6c 756d 6e73 2066 6f72 2072 656e   columns for ren
-000175d0: 6465 7269 6e67 0d0a 2020 2020 6461 7461  dering..    data
-000175e0: 7372 632e 7363 616c 655f 636f 6c73 203d  src.scale_cols =
-000175f0: 205b 312c 2032 5d20 2320 7363 616c 6520   [1, 2] # scale 
-00017600: 6279 2062 6f74 6820 6261 7365 6c69 6e65  by both baseline
-00017610: 2061 6e64 2076 6f6c 756d 650d 0a0d 0a0d   and volume.....
-00017620: 0a64 6566 205f 7072 6561 646a 7573 745f  .def _preadjust_
-00017630: 686f 7269 7a5f 6461 7461 7372 6328 6461  horiz_datasrc(da
-00017640: 7461 7372 6329 3a0d 0a20 2020 2061 7272  tasrc):..    arr
-00017650: 6179 6966 7920 3d20 6c61 6d62 6461 2064  ayify = lambda d
-00017660: 3a20 642e 7661 6c75 6573 2069 6620 7479  : d.values if ty
-00017670: 7065 2864 2920 3d3d 2070 642e 4461 7461  pe(d) == pd.Data
-00017680: 4672 616d 6520 656c 7365 2064 0d0a 2020  Frame else d..  
-00017690: 2020 2320 6372 6561 7465 2061 2064 6174    # create a dat
-000176a0: 6166 7261 6d65 2066 726f 6d20 7468 6520  aframe from the 
-000176b0: 696e 7075 7420 6172 7261 790d 0a20 2020  input array..   
-000176c0: 2074 696d 6573 203d 205b 7420 666f 7220   times = [t for 
-000176d0: 742c 726f 7720 696e 2064 6174 6173 7263  t,row in datasrc
-000176e0: 5d0d 0a20 2020 2069 6620 6c65 6e28 7469  ]..    if len(ti
-000176f0: 6d65 7329 203d 3d20 313a 2023 2061 6464  mes) == 1: # add
-00017700: 2061 6e20 656d 7074 7920 7469 6d65 2073   an empty time s
-00017710: 6c6f 740d 0a20 2020 2020 2020 2074 696d  lot..        tim
-00017720: 6573 203d 205b 7469 6d65 735b 305d 2c20  es = [times[0], 
-00017730: 7469 6d65 735b 305d 2b31 5d0d 0a20 2020  times[0]+1]..   
-00017740: 2020 2020 2064 6174 6173 7263 203d 2064       datasrc = d
-00017750: 6174 6173 7263 202b 205b 5b74 696d 6573  atasrc + [[times
-00017760: 5b31 5d2c 205b 2870 2c30 2920 666f 7220  [1], [(p,0) for 
-00017770: 702c 7620 696e 2061 7272 6179 6966 7928  p,v in arrayify(
-00017780: 6461 7461 7372 635b 305d 5b31 5d29 5d5d  datasrc[0][1])]]
-00017790: 5d0d 0a20 2020 2064 6174 6120 3d20 5b5b  ]..    data = [[
-000177a0: 6520 666f 7220 7620 696e 2061 7272 6179  e for v in array
-000177b0: 6966 7928 726f 7729 2066 6f72 2065 2069  ify(row) for e i
-000177c0: 6e20 765d 2066 6f72 2074 2c72 6f77 2069  n v] for t,row i
-000177d0: 6e20 6461 7461 7372 635d 0d0a 2020 2020  n datasrc]..    
-000177e0: 6d61 7863 6f6c 7320 3d20 6d61 7828 6c65  maxcols = max(le
-000177f0: 6e28 726f 7729 2066 6f72 2072 6f77 2069  n(row) for row i
-00017800: 6e20 6461 7461 290d 0a20 2020 2072 6574  n data)..    ret
-00017810: 7572 6e20 7064 2e44 6174 6146 7261 6d65  urn pd.DataFrame
-00017820: 2863 6f6c 756d 6e73 3d72 616e 6765 286d  (columns=range(m
-00017830: 6178 636f 6c73 292c 2064 6174 613d 6461  axcols), data=da
-00017840: 7461 2c20 696e 6465 783d 7469 6d65 7329  ta, index=times)
-00017850: 0d0a 0d0a 0d0a 6465 6620 5f61 646a 7573  ......def _adjus
-00017860: 745f 686f 7269 7a5f 6461 7461 7372 6328  t_horiz_datasrc(
-00017870: 6461 7461 7372 6329 3a0d 0a20 2020 2023  datasrc):..    #
-00017880: 2074 6f20 6265 2061 626c 6520 746f 2073   to be able to s
-00017890: 6361 6c65 2070 726f 7065 726c 792c 206d  cale properly, m
-000178a0: 6f76 6520 7468 6520 6c61 7374 2074 776f  ove the last two
-000178b0: 2076 616c 7565 7320 746f 2074 6865 206c   values to the l
-000178c0: 6173 7420 7477 6f20 636f 6c75 6d6e 730d  ast two columns.
-000178d0: 0a20 2020 2076 616c 7565 7320 3d20 6461  .    values = da
-000178e0: 7461 7372 632e 6466 2e69 6c6f 635b 3a2c  tasrc.df.iloc[:,
-000178f0: 2031 3a5d 2e76 616c 7565 730d 0a20 2020   1:].values..   
-00017900: 2066 6f72 2069 2c6e 726f 7720 696e 2065   for i,nrow in e
-00017910: 6e75 6d65 7261 7465 2876 616c 7565 7329  numerate(values)
-00017920: 3a0d 0a20 2020 2020 2020 206f 726f 7720  :..        orow 
-00017930: 3d20 6e72 6f77 5b7e 6e70 2e69 736e 616e  = nrow[~np.isnan
-00017940: 286e 726f 7729 5d0d 0a20 2020 2020 2020  (nrow)]..       
-00017950: 2069 6620 6c65 6e28 6e72 6f77 2920 3d3d   if len(nrow) ==
-00017960: 206c 656e 286f 726f 7729 206f 7220 6c65   len(orow) or le
-00017970: 6e28 6f72 6f77 2920 3c3d 2032 3a0d 0a20  n(orow) <= 2:.. 
-00017980: 2020 2020 2020 2020 2020 2063 6f6e 7469             conti
-00017990: 6e75 650d 0a20 2020 2020 2020 206e 726f  nue..        nro
-000179a0: 775b 2d32 3a5d 203d 206f 726f 775b 2d32  w[-2:] = orow[-2
-000179b0: 3a5d 0d0a 2020 2020 2020 2020 6e72 6f77  :]..        nrow
-000179c0: 5b6c 656e 286f 726f 7729 2d32 3a6c 656e  [len(orow)-2:len
-000179d0: 286f 726f 7729 5d20 3d20 6e70 2e6e 616e  (orow)] = np.nan
-000179e0: 0d0a 2020 2020 6461 7461 7372 632e 6466  ..    datasrc.df
-000179f0: 5b64 6174 6173 7263 2e64 662e 636f 6c75  [datasrc.df.colu
-00017a00: 6d6e 735b 313a 5d5d 203d 2076 616c 7565  mns[1:]] = value
-00017a10: 730d 0a0d 0a0d 0a64 6566 205f 6164 6a75  s......def _adju
-00017a20: 7374 5f62 6172 5f64 6174 6173 7263 2864  st_bar_datasrc(d
-00017a30: 6174 6173 7263 2c20 6f72 6465 725f 636f  atasrc, order_co
-00017a40: 6c73 3d54 7275 6529 3a0d 0a20 2020 2069  ls=True):..    i
-00017a50: 6620 6c65 6e28 6461 7461 7372 632e 6466  f len(datasrc.df
-00017a60: 2e63 6f6c 756d 6e73 2920 3c3d 2032 3a0d  .columns) <= 2:.
-00017a70: 0a20 2020 2020 2020 2064 6174 6173 7263  .        datasrc
-00017a80: 2e64 662e 696e 7365 7274 2831 2c20 275f  .df.insert(1, '_
-00017a90: 6261 7365 5f27 2c20 5b30 5d2a 6c65 6e28  base_', [0]*len(
-00017aa0: 6461 7461 7372 632e 6466 2929 2023 2062  datasrc.df)) # b
-00017ab0: 6173 650d 0a20 2020 2069 6620 6c65 6e28  ase..    if len(
-00017ac0: 6461 7461 7372 632e 6466 2e63 6f6c 756d  datasrc.df.colum
-00017ad0: 6e73 2920 3c3d 2034 3a0d 0a20 2020 2020  ns) <= 4:..     
-00017ae0: 2020 2064 6174 6173 7263 2e64 662e 696e     datasrc.df.in
-00017af0: 7365 7274 2831 2c20 275f 6f70 656e 5f27  sert(1, '_open_'
-00017b00: 2c20 205b 305d 2a6c 656e 2864 6174 6173  ,  [0]*len(datas
-00017b10: 7263 2e64 6629 2920 2320 226f 7065 6e22  rc.df)) # "open"
-00017b20: 2066 6f72 2063 6f6c 6f72 0d0a 2020 2020   for color..    
-00017b30: 2020 2020 6461 7461 7372 632e 6466 2e69      datasrc.df.i
-00017b40: 6e73 6572 7428 322c 2027 5f63 6c6f 7365  nsert(2, '_close
-00017b50: 5f27 2c20 6461 7461 7372 632e 6466 2e69  _', datasrc.df.i
-00017b60: 6c6f 635b 3a2c 2033 5d29 2023 2022 636c  loc[:, 3]) # "cl
-00017b70: 6f73 6522 2028 6163 7475 616c 2062 6172  ose" (actual bar
-00017b80: 2076 616c 7565 2920 666f 7220 636f 6c6f   value) for colo
-00017b90: 720d 0a20 2020 2069 6620 6f72 6465 725f  r..    if order_
-00017ba0: 636f 6c73 3a0d 0a20 2020 2020 2020 2064  cols:..        d
-00017bb0: 6174 6173 7263 2e73 6574 5f64 6628 6461  atasrc.set_df(da
-00017bc0: 7461 7372 632e 6466 2e69 6c6f 635b 3a2c  tasrc.df.iloc[:,
-00017bd0: 5b30 2c33 2c34 2c31 2c32 5d5d 2920 2320  [0,3,4,1,2]]) # 
-00017be0: 7265 2d61 7272 616e 6765 2063 6f6c 756d  re-arrange colum
-00017bf0: 6e73 2066 6f72 2072 656e 6465 7269 6e67  ns for rendering
-00017c00: 0d0a 2020 2020 6461 7461 7372 632e 7363  ..    datasrc.sc
-00017c10: 616c 655f 636f 6c73 203d 205b 312c 2032  ale_cols = [1, 2
-00017c20: 5d20 2320 7363 616c 6520 6279 2062 6f74  ] # scale by bot
-00017c30: 6820 6261 7365 6c69 6e65 2061 6e64 2076  h baseline and v
-00017c40: 6f6c 756d 650d 0a0d 0a0d 0a64 6566 205f  olume......def _
-00017c50: 7570 6461 7465 5f64 6174 6128 7072 6561  update_data(prea
-00017c60: 646a 7573 7466 756e 632c 2061 646a 7573  djustfunc, adjus
-00017c70: 7466 756e 632c 2069 7465 6d2c 2064 732c  tfunc, item, ds,
-00017c80: 2067 6678 3d54 7275 6529 3a0d 0a20 2020   gfx=True):..   
-00017c90: 2069 6620 7072 6561 646a 7573 7466 756e   if preadjustfun
-00017ca0: 633a 0d0a 2020 2020 2020 2020 6473 203d  c:..        ds =
-00017cb0: 2070 7265 6164 6a75 7374 6675 6e63 2864   preadjustfunc(d
-00017cc0: 7329 0d0a 2020 2020 6473 203d 205f 6372  s)..    ds = _cr
-00017cd0: 6561 7465 5f64 6174 6173 7263 2869 7465  eate_datasrc(ite
-00017ce0: 6d2e 6178 2c20 6473 290d 0a20 2020 2069  m.ax, ds)..    i
-00017cf0: 6620 6164 6a75 7374 6675 6e63 3a0d 0a20  f adjustfunc:.. 
-00017d00: 2020 2020 2020 2061 646a 7573 7466 756e         adjustfun
-00017d10: 6328 6473 290d 0a20 2020 2063 7320 3d20  c(ds)..    cs = 
-00017d20: 6c69 7374 2869 7465 6d2e 6461 7461 7372  list(item.datasr
-00017d30: 632e 6466 2e63 6f6c 756d 6e73 5b3a 315d  c.df.columns[:1]
-00017d40: 2920 2b20 6c69 7374 2869 7465 6d2e 6461  ) + list(item.da
-00017d50: 7461 7372 632e 6466 2e63 6f6c 756d 6e73  tasrc.df.columns
-00017d60: 5b69 7465 6d2e 6461 7461 7372 632e 636f  [item.datasrc.co
-00017d70: 6c5f 6461 7461 5f6f 6666 7365 743a 5d29  l_data_offset:])
-00017d80: 0d0a 2020 2020 6966 206c 656e 2863 7329  ..    if len(cs)
-00017d90: 203e 3d20 6c65 6e28 6473 2e64 662e 636f   >= len(ds.df.co
-00017da0: 6c75 6d6e 7329 3a0d 0a20 2020 2020 2020  lumns):..       
-00017db0: 2064 732e 6466 2e63 6f6c 756d 6e73 203d   ds.df.columns =
-00017dc0: 2063 735b 3a6c 656e 2864 732e 6466 2e63   cs[:len(ds.df.c
-00017dd0: 6f6c 756d 6e73 295d 0d0a 2020 2020 6974  olumns)]..    it
-00017de0: 656d 2e64 6174 6173 7263 2e75 7064 6174  em.datasrc.updat
-00017df0: 6528 6473 290d 0a20 2020 205f 7365 745f  e(ds)..    _set_
-00017e00: 6461 7461 7372 6328 6974 656d 2e61 782c  datasrc(item.ax,
-00017e10: 2069 7465 6d2e 6461 7461 7372 632c 2061   item.datasrc, a
-00017e20: 6464 636f 6c73 3d46 616c 7365 290d 0a20  ddcols=False).. 
-00017e30: 2020 2069 6620 6766 783a 0d0a 2020 2020     if gfx:..    
-00017e40: 2020 2020 6974 656d 2e75 7064 6174 655f      item.update_
-00017e50: 6766 7828 290d 0a0d 0a0d 0a64 6566 205f  gfx()......def _
-00017e60: 7570 6461 7465 5f67 6678 2869 7465 6d29  update_gfx(item)
-00017e70: 3a0d 0a20 2020 205f 7374 6172 745f 7669  :..    _start_vi
-00017e80: 7375 616c 5f75 7064 6174 6528 6974 656d  sual_update(item
-00017e90: 290d 0a20 2020 2066 6f72 2069 2069 6e20  )..    for i in 
-00017ea0: 6974 656d 2e61 782e 6974 656d 733a 0d0a  item.ax.items:..
-00017eb0: 2020 2020 2020 2020 6966 2069 203d 3d20          if i == 
-00017ec0: 6974 656d 206f 7220 6e6f 7420 6861 7361  item or not hasa
-00017ed0: 7474 7228 692c 2027 6461 7461 7372 6327  ttr(i, 'datasrc'
-00017ee0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-00017ef0: 636f 6e74 696e 7565 0d0a 2020 2020 2020  continue..      
-00017f00: 2020 6c63 203d 206c 656e 2869 7465 6d2e    lc = len(item.
-00017f10: 6461 7461 7372 632e 6466 290d 0a20 2020  datasrc.df)..   
-00017f20: 2020 2020 206c 6920 3d20 6c65 6e28 692e       li = len(i.
-00017f30: 6461 7461 7372 632e 6466 290d 0a20 2020  datasrc.df)..   
-00017f40: 2020 2020 2069 6620 6c63 2061 6e64 206c       if lc and l
-00017f50: 6920 616e 6420 6d61 7828 6c63 2c6c 6929  i and max(lc,li)
-00017f60: 2f6d 696e 286c 632c 6c69 2920 3e20 3130  /min(lc,li) > 10
-00017f70: 303a 2023 2054 4f44 4f3a 2073 686f 756c  0: # TODO: shoul
-00017f80: 6420 6265 2074 7970 6564 2069 6e73 7465  d be typed inste
-00017f90: 6164 0d0a 2020 2020 2020 2020 2020 2020  ad..            
-00017fa0: 636f 6e74 696e 7565 0d0a 2020 2020 2020  continue..      
-00017fb0: 2020 6363 203d 2069 7465 6d2e 6461 7461    cc = item.data
-00017fc0: 7372 632e 6466 2e63 6f6c 756d 6e73 0d0a  src.df.columns..
-00017fd0: 2020 2020 2020 2020 6369 203d 2069 2e64          ci = i.d
-00017fe0: 6174 6173 7263 2e64 662e 636f 6c75 6d6e  atasrc.df.column
-00017ff0: 730d 0a20 2020 2020 2020 2063 3020 3d20  s..        c0 = 
-00018000: 5b63 2066 6f72 2063 2069 6e20 6369 2069  [c for c in ci i
-00018010: 6620 6320 696e 2063 635d 0d0a 2020 2020  f c in cc]..    
-00018020: 2020 2020 6331 203d 205b 6320 666f 7220      c1 = [c for 
-00018030: 6320 696e 2063 6920 6966 206e 6f74 2063  c in ci if not c
-00018040: 2069 6e20 6363 5d0d 0a20 2020 2020 2020   in cc]..       
-00018050: 2064 665f 636c 6970 7065 6420 3d20 6974   df_clipped = it
-00018060: 656d 2e64 6174 6173 7263 2e64 665b 6330  em.datasrc.df[c0
-00018070: 5d0d 0a20 2020 2020 2020 2069 6620 6331  ]..        if c1
-00018080: 3a0d 0a20 2020 2020 2020 2020 2020 2064  :..            d
-00018090: 665f 636c 6970 7065 6420 3d20 6466 5f63  f_clipped = df_c
-000180a0: 6c69 7070 6564 2e63 6f70 7928 290d 0a20  lipped.copy().. 
-000180b0: 2020 2020 2020 2020 2020 2066 6f72 2063             for c
-000180c0: 2069 6e20 6331 3a0d 0a20 2020 2020 2020   in c1:..       
-000180d0: 2020 2020 2020 2020 2064 665f 636c 6970           df_clip
-000180e0: 7065 645b 635d 203d 2069 2e64 6174 6173  ped[c] = i.datas
-000180f0: 7263 2e64 665b 635d 0d0a 2020 2020 2020  rc.df[c]..      
-00018100: 2020 692e 6461 7461 7372 632e 7365 745f    i.datasrc.set_
-00018110: 6466 2864 665f 636c 6970 7065 6429 0d0a  df(df_clipped)..
-00018120: 2020 2020 2020 2020 6272 6561 6b0d 0a20          break.. 
-00018130: 2020 2075 7064 6174 655f 7369 6764 6967     update_sigdig
-00018140: 203d 2046 616c 7365 0d0a 2020 2020 6966   = False..    if
-00018150: 206e 6f74 2069 7465 6d2e 6461 7461 7372   not item.datasr
-00018160: 632e 7374 616e 6461 6c6f 6e65 2061 6e64  c.standalone and
-00018170: 206e 6f74 2069 7465 6d2e 6178 2e76 622e   not item.ax.vb.
-00018180: 7769 6e2e 5f69 734d 6f75 7365 4c65 6674  win._isMouseLeft
-00018190: 4472 6167 3a0d 0a20 2020 2020 2020 2023  Drag:..        #
-000181a0: 206e 6577 206c 696d 6974 7320 7768 656e   new limits when
-000181b0: 2065 7874 656e 6469 6e67 2f72 6564 7563   extending/reduc
-000181c0: 696e 6720 616d 6f75 6e74 206f 6620 6461  ing amount of da
-000181d0: 7461 0d0a 2020 2020 2020 2020 785f 6d69  ta..        x_mi
-000181e0: 6e2c 7831 203d 205f 7365 745f 785f 6c69  n,x1 = _set_x_li
-000181f0: 6d69 7473 2869 7465 6d2e 6178 2c20 6974  mits(item.ax, it
-00018200: 656d 2e64 6174 6173 7263 290d 0a20 2020  em.datasrc)..   
-00018210: 2020 2020 2023 2073 6372 6f6c 6c20 616c       # scroll al
-00018220: 6c20 706c 6f74 7320 6966 2077 6527 7265  l plots if we're
-00018230: 2061 7420 7468 6520 6661 7220 7269 6768   at the far righ
-00018240: 740d 0a20 2020 2020 2020 2074 7220 3d20  t..        tr = 
-00018250: 6974 656d 2e61 782e 7662 2e74 6172 6765  item.ax.vb.targe
-00018260: 7452 6563 7428 290d 0a20 2020 2020 2020  tRect()..       
-00018270: 2078 3020 3d20 7831 202d 2074 722e 7769   x0 = x1 - tr.wi
-00018280: 6474 6828 290d 0a20 2020 2020 2020 2069  dth()..        i
-00018290: 6620 7830 203c 2072 6967 6874 5f6d 6172  f x0 < right_mar
-000182a0: 6769 6e5f 6361 6e64 6c65 7320 2b20 7369  gin_candles + si
-000182b0: 6465 5f6d 6172 6769 6e3a 0d0a 2020 2020  de_margin:..    
-000182c0: 2020 2020 2020 2020 7830 203d 202d 7369          x0 = -si
-000182d0: 6465 5f6d 6172 6769 6e0d 0a20 2020 2020  de_margin..     
-000182e0: 2020 2069 6620 7472 2e72 6967 6874 2829     if tr.right()
-000182f0: 203c 2078 3120 2d20 3520 2d20 322a 7269   < x1 - 5 - 2*ri
-00018300: 6768 745f 6d61 7267 696e 5f63 616e 646c  ght_margin_candl
-00018310: 6573 3a0d 0a20 2020 2020 2020 2020 2020  es:..           
-00018320: 2078 3020 3d20 7831 203d 204e 6f6e 650d   x0 = x1 = None.
-00018330: 0a20 2020 2020 2020 2070 7265 765f 746f  .        prev_to
-00018340: 7020 3d20 6974 656d 2e61 782e 7662 2e74  p = item.ax.vb.t
-00018350: 6172 6765 7452 6563 7428 292e 746f 7028  argetRect().top(
-00018360: 290d 0a20 2020 2020 2020 2069 7465 6d2e  )..        item.
-00018370: 6178 2e76 622e 7570 6461 7465 5f79 5f7a  ax.vb.update_y_z
-00018380: 6f6f 6d28 7830 2c20 7831 290d 0a20 2020  oom(x0, x1)..   
-00018390: 2020 2020 2074 6869 735f 746f 7020 3d20       this_top = 
-000183a0: 6974 656d 2e61 782e 7662 2e74 6172 6765  item.ax.vb.targe
-000183b0: 7452 6563 7428 292e 746f 7028 290d 0a20  tRect().top().. 
-000183c0: 2020 2020 2020 2069 6620 7468 6973 5f74         if this_t
-000183d0: 6f70 2061 6e64 206e 6f74 2028 302e 3939  op and not (0.99
-000183e0: 203c 2061 6273 2870 7265 765f 746f 702f   < abs(prev_top/
-000183f0: 7468 6973 5f74 6f70 2920 3c20 312e 3031  this_top) < 1.01
-00018400: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-00018410: 7570 6461 7465 5f73 6967 6469 6720 3d20  update_sigdig = 
-00018420: 5472 7565 0d0a 2020 2020 2020 2020 6966  True..        if
-00018430: 2069 7465 6d2e 6178 2e61 7865 735b 2762   item.ax.axes['b
-00018440: 6f74 746f 6d27 5d5b 2769 7465 6d27 5d2e  ottom']['item'].
-00018450: 6973 5669 7369 626c 6528 293a 2023 2075  isVisible(): # u
-00018460: 7064 6174 6520 6178 6573 2069 6620 7669  pdate axes if vi
-00018470: 7369 626c 650d 0a20 2020 2020 2020 2020  sible..         
-00018480: 2020 2069 7465 6d2e 6178 2e61 7865 735b     item.ax.axes[
-00018490: 2762 6f74 746f 6d27 5d5b 2769 7465 6d27  'bottom']['item'
-000184a0: 5d2e 6869 6465 2829 0d0a 2020 2020 2020  ].hide()..      
-000184b0: 2020 2020 2020 6974 656d 2e61 782e 6178        item.ax.ax
-000184c0: 6573 5b27 626f 7474 6f6d 275d 5b27 6974  es['bottom']['it
-000184d0: 656d 275d 2e73 686f 7728 290d 0a20 2020  em'].show()..   
-000184e0: 205f 656e 645f 7669 7375 616c 5f75 7064   _end_visual_upd
-000184f0: 6174 6528 6974 656d 290d 0a20 2020 2069  ate(item)..    i
-00018500: 6620 7570 6461 7465 5f73 6967 6469 673a  f update_sigdig:
-00018510: 0d0a 2020 2020 2020 2020 5f75 7064 6174  ..        _updat
-00018520: 655f 7369 676e 6966 6963 616e 7473 2869  e_significants(i
-00018530: 7465 6d2e 6178 2c20 6974 656d 2e61 782e  tem.ax, item.ax.
-00018540: 7662 2e64 6174 6173 7263 2c20 666f 7263  vb.datasrc, forc
-00018550: 653d 5472 7565 290d 0a0d 0a0d 0a64 6566  e=True)......def
-00018560: 205f 7374 6172 745f 7669 7375 616c 5f75   _start_visual_u
-00018570: 7064 6174 6528 6974 656d 293a 0d0a 2020  pdate(item):..  
-00018580: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
-00018590: 6974 656d 2c20 4669 6e50 6c6f 7449 7465  item, FinPlotIte
-000185a0: 6d29 3a0d 0a20 2020 2020 2020 2069 7465  m):..        ite
-000185b0: 6d2e 6178 2e72 656d 6f76 6549 7465 6d28  m.ax.removeItem(
-000185c0: 6974 656d 290d 0a20 2020 2020 2020 2069  item)..        i
-000185d0: 7465 6d2e 6469 7274 7920 3d20 5472 7565  tem.dirty = True
-000185e0: 0d0a 2020 2020 656c 7365 3a0d 0a20 2020  ..    else:..   
-000185f0: 2020 2020 2079 203d 2069 7465 6d2e 6461       y = item.da
-00018600: 7461 7372 632e 7920 2f20 6974 656d 2e61  tasrc.y / item.a
-00018610: 782e 7662 2e79 7363 616c 652e 7363 616c  x.vb.yscale.scal
-00018620: 6566 0d0a 2020 2020 2020 2020 6966 2069  ef..        if i
-00018630: 7465 6d2e 6178 2e76 622e 7973 6361 6c65  tem.ax.vb.yscale
-00018640: 2e73 6361 6c65 7479 7065 203d 3d20 276c  .scaletype == 'l
-00018650: 6f67 273a 0d0a 2020 2020 2020 2020 2020  og':..          
-00018660: 2020 7920 3d20 7920 2b20 6c6f 675f 706c    y = y + log_pl
-00018670: 6f74 5f6f 6666 7365 740d 0a20 2020 2020  ot_offset..     
-00018680: 2020 2069 7465 6d2e 7365 7444 6174 6128     item.setData(
-00018690: 6974 656d 2e64 6174 6173 7263 2e69 6e64  item.datasrc.ind
-000186a0: 6578 2c20 7929 0d0a 0d0a 0d0a 6465 6620  ex, y)......def 
-000186b0: 5f65 6e64 5f76 6973 7561 6c5f 7570 6461  _end_visual_upda
-000186c0: 7465 2869 7465 6d29 3a0d 0a20 2020 2069  te(item):..    i
-000186d0: 6620 6973 696e 7374 616e 6365 2869 7465  f isinstance(ite
-000186e0: 6d2c 2046 696e 506c 6f74 4974 656d 293a  m, FinPlotItem):
-000186f0: 0d0a 2020 2020 2020 2020 6974 656d 2e61  ..        item.a
-00018700: 782e 6164 6449 7465 6d28 6974 656d 290d  x.addItem(item).
-00018710: 0a20 2020 2020 2020 2069 7465 6d2e 7265  .        item.re
-00018720: 7061 696e 7428 290d 0a0d 0a0d 0a64 6566  paint()......def
-00018730: 205f 7365 745f 785f 6c69 6d69 7473 2861   _set_x_limits(a
-00018740: 782c 2064 6174 6173 7263 293a 0d0a 2020  x, datasrc):..  
-00018750: 2020 7830 2c78 3120 3d20 5f78 6d69 6e6d    x0,x1 = _xminm
-00018760: 6178 2864 6174 6173 7263 2c20 785f 696e  ax(datasrc, x_in
-00018770: 6465 7865 643d 6178 2e76 622e 785f 696e  dexed=ax.vb.x_in
-00018780: 6465 7865 6429 0d0a 2020 2020 6178 2e73  dexed)..    ax.s
-00018790: 6574 4c69 6d69 7473 2878 4d69 6e3d 7830  etLimits(xMin=x0
-000187a0: 2c20 784d 6178 3d78 3129 0d0a 2020 2020  , xMax=x1)..    
-000187b0: 7265 7475 726e 2078 302c 7831 0d0a 0d0a  return x0,x1....
-000187c0: 0d0a 6465 6620 5f78 6d69 6e6d 6178 2864  ..def _xminmax(d
-000187d0: 6174 6173 7263 2c20 785f 696e 6465 7865  atasrc, x_indexe
-000187e0: 642c 2069 6e69 745f 7374 6570 733d 4e6f  d, init_steps=No
-000187f0: 6e65 2c20 6578 7472 615f 6d61 7267 696e  ne, extra_margin
-00018800: 3d30 293a 0d0a 2020 2020 6966 2078 5f69  =0):..    if x_i
-00018810: 6e64 6578 6564 2061 6e64 2069 6e69 745f  ndexed and init_
-00018820: 7374 6570 733a 0d0a 2020 2020 2020 2020  steps:..        
-00018830: 2320 696e 6974 6961 6c20 7a6f 6f6d 0d0a  # initial zoom..
-00018840: 2020 2020 2020 2020 7830 203d 206d 6178          x0 = max
-00018850: 2864 6174 6173 7263 2e78 6c65 6e2d 696e  (datasrc.xlen-in
-00018860: 6974 5f73 7465 7073 2c20 3029 202d 2073  it_steps, 0) - s
-00018870: 6964 655f 6d61 7267 696e 202d 2065 7874  ide_margin - ext
-00018880: 7261 5f6d 6172 6769 6e0d 0a20 2020 2020  ra_margin..     
-00018890: 2020 2078 3120 3d20 6461 7461 7372 632e     x1 = datasrc.
-000188a0: 786c 656e 202b 2072 6967 6874 5f6d 6172  xlen + right_mar
-000188b0: 6769 6e5f 6361 6e64 6c65 7320 2b20 7369  gin_candles + si
-000188c0: 6465 5f6d 6172 6769 6e20 2b20 6578 7472  de_margin + extr
-000188d0: 615f 6d61 7267 696e 0d0a 2020 2020 656c  a_margin..    el
-000188e0: 6966 2078 5f69 6e64 6578 6564 3a0d 0a20  if x_indexed:.. 
-000188f0: 2020 2020 2020 2023 2074 6f74 616c 2078         # total x
-00018900: 2073 697a 6520 666f 7220 696e 6465 7865   size for indexe
-00018910: 6420 6461 7461 0d0a 2020 2020 2020 2020  d data..        
-00018920: 7830 203d 202d 7369 6465 5f6d 6172 6769  x0 = -side_margi
-00018930: 6e20 2d20 6578 7472 615f 6d61 7267 696e  n - extra_margin
-00018940: 0d0a 2020 2020 2020 2020 7831 203d 2064  ..        x1 = d
-00018950: 6174 6173 7263 2e78 6c65 6e20 2b20 7269  atasrc.xlen + ri
-00018960: 6768 745f 6d61 7267 696e 5f63 616e 646c  ght_margin_candl
-00018970: 6573 202d 2031 202b 2073 6964 655f 6d61  es - 1 + side_ma
-00018980: 7267 696e 202b 2065 7874 7261 5f6d 6172  rgin + extra_mar
-00018990: 6769 6e20 2320 6164 6420 616e 6f74 6865  gin # add anothe
-000189a0: 7220 6d61 7267 696e 2074 6f20 6765 7420  r margin to get 
-000189b0: 7468 6520 2273 6e61 7020 6261 636b 2220  the "snap back" 
-000189c0: 7365 6e73 6174 696f 6e0d 0a20 2020 2065  sensation..    e
-000189d0: 6c73 653a 0d0a 2020 2020 2020 2020 2320  lse:..        # 
-000189e0: 7820 7369 7a65 2066 6f72 2070 6c61 696e  x size for plain
-000189f0: 2059 2d6f 7665 722d 5820 6461 7461 2028   Y-over-X data (
-00018a00: 692e 652e 206e 6f74 2069 6e64 6578 6564  i.e. not indexed
-00018a10: 290d 0a20 2020 2020 2020 2078 3020 3d20  )..        x0 = 
-00018a20: 6461 7461 7372 632e 782e 6d69 6e28 290d  datasrc.x.min().
-00018a30: 0a20 2020 2020 2020 2078 3120 3d20 6461  .        x1 = da
-00018a40: 7461 7372 632e 782e 6d61 7828 290d 0a20  tasrc.x.max().. 
-00018a50: 2020 2020 2020 2023 2065 7874 656e 6420         # extend 
-00018a60: 6d61 7267 696e 206f 6e20 6465 636f 7570  margin on decoup
-00018a70: 6c65 6420 706c 6f74 730d 0a20 2020 2020  led plots..     
-00018a80: 2020 2064 203d 2028 7831 2d78 3029 202a     d = (x1-x0) *
-00018a90: 2028 302e 322b 6578 7472 615f 6d61 7267   (0.2+extra_marg
-00018aa0: 696e 290d 0a20 2020 2020 2020 2078 3020  in)..        x0 
-00018ab0: 2d3d 2064 0d0a 2020 2020 2020 2020 7831  -= d..        x1
-00018ac0: 202b 3d20 640d 0a20 2020 2072 6574 7572   += d..    retur
-00018ad0: 6e20 7830 2c78 310d 0a0d 0a0d 0a64 6566  n x0,x1......def
-00018ae0: 205f 7265 7061 696e 745f 6361 6e64 6c65   _repaint_candle
-00018af0: 7328 293a 0d0a 2020 2020 2727 2743 616e  s():..    '''Can
-00018b00: 646c 6573 2061 7265 206f 6e6c 7920 7061  dles are only pa
-00018b10: 7274 6961 6c6c 7920 6472 6177 6e2c 2061  rtially drawn, a
-00018b20: 6e64 2074 6865 7265 666f 7265 206e 6565  nd therefore nee
-00018b30: 6473 206d 616e 7561 6c20 6469 7274 7920  ds manual dirty 
-00018b40: 7265 6d69 6e64 6572 2077 6865 6e65 7665  reminder wheneve
-00018b50: 7220 6974 2067 6f65 7320 6f66 662d 7363  r it goes off-sc
-00018b60: 7265 656e 2e27 2727 0d0a 2020 2020 6178  reen.'''..    ax
-00018b70: 7320 3d20 5b61 7820 666f 7220 7769 6e20  s = [ax for win 
-00018b80: 696e 2077 696e 646f 7773 2066 6f72 2061  in windows for a
-00018b90: 7820 696e 2077 696e 2e61 7873 5d20 2b20  x in win.axs] + 
-00018ba0: 6f76 6572 6c61 795f 6178 730d 0a20 2020  overlay_axs..   
-00018bb0: 2066 6f72 2061 7820 696e 2061 7873 3a0d   for ax in axs:.
-00018bc0: 0a20 2020 2020 2020 2066 6f72 2069 7465  .        for ite
-00018bd0: 6d20 696e 206c 6973 7428 6178 2e69 7465  m in list(ax.ite
-00018be0: 6d73 293a 0d0a 2020 2020 2020 2020 2020  ms):..          
-00018bf0: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
-00018c00: 6974 656d 2c20 4669 6e50 6c6f 7449 7465  item, FinPlotIte
-00018c10: 6d29 3a0d 0a20 2020 2020 2020 2020 2020  m):..           
-00018c20: 2020 2020 205f 7374 6172 745f 7669 7375       _start_visu
-00018c30: 616c 5f75 7064 6174 6528 6974 656d 290d  al_update(item).
-00018c40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00018c50: 205f 656e 645f 7669 7375 616c 5f75 7064   _end_visual_upd
-00018c60: 6174 6528 6974 656d 290d 0a0d 0a0d 0a64  ate(item)......d
-00018c70: 6566 205f 7061 696e 745f 7363 6174 7465  ef _paint_scatte
-00018c80: 7228 6974 656d 2c20 702c 202a 6172 6773  r(item, p, *args
-00018c90: 293a 0d0a 2020 2020 7769 7468 206e 702e  ):..    with np.
-00018ca0: 6572 7273 7461 7465 2869 6e76 616c 6964  errstate(invalid
-00018cb0: 3d27 6967 6e6f 7265 2729 3a20 2320 6d61  ='ignore'): # ma
-00018cc0: 6b65 2070 6727 7320 6d61 736b 2063 7265  ke pg's mask cre
-00018cd0: 6174 696f 6e20 6361 6c6c 7320 746f 206e  ation calls to n
-00018ce0: 756d 7079 2073 6875 7420 7570 0d0a 2020  umpy shut up..  
-00018cf0: 2020 2020 2020 6974 656d 2e5f 646f 7061        item._dopa
-00018d00: 696e 7428 702c 202a 6172 6773 290d 0a0d  int(p, *args)...
-00018d10: 0a0d 0a64 6566 205f 6b65 795f 7072 6573  ...def _key_pres
-00018d20: 7365 6428 7662 2c20 6576 293a 0d0a 2020  sed(vb, ev):..  
-00018d30: 2020 6966 2065 762e 7465 7874 2829 203d    if ev.text() =
-00018d40: 3d20 2767 273a 2023 2067 7269 640d 0a20  = 'g': # grid.. 
-00018d50: 2020 2020 2020 2067 6c6f 6261 6c20 636c         global cl
-00018d60: 616d 705f 6772 6964 0d0a 2020 2020 2020  amp_grid..      
-00018d70: 2020 636c 616d 705f 6772 6964 203d 206e    clamp_grid = n
-00018d80: 6f74 2063 6c61 6d70 5f67 7269 640d 0a20  ot clamp_grid.. 
-00018d90: 2020 2020 2020 2066 6f72 2077 696e 2069         for win i
-00018da0: 6e20 7769 6e64 6f77 733a 0d0a 2020 2020  n windows:..    
-00018db0: 2020 2020 2020 2020 666f 7220 6178 2069          for ax i
-00018dc0: 6e20 7769 6e2e 6178 733a 0d0a 2020 2020  n win.axs:..    
-00018dd0: 2020 2020 2020 2020 2020 2020 6178 2e63              ax.c
-00018de0: 726f 7373 6861 6972 2e75 7064 6174 6528  rosshair.update(
-00018df0: 290d 0a20 2020 2065 6c69 6620 6576 2e74  )..    elif ev.t
-00018e00: 6578 7428 2920 3d3d 2027 6927 3a20 2320  ext() == 'i': # 
-00018e10: 696e 7665 7274 0d0a 2020 2020 2020 2020  invert..        
-00018e20: 666f 7220 7769 6e20 696e 2077 696e 646f  for win in windo
-00018e30: 7773 3a0d 0a20 2020 2020 2020 2020 2020  ws:..           
-00018e40: 2066 6f72 2061 7820 696e 2077 696e 2e61   for ax in win.a
-00018e50: 7873 3a0d 0a20 2020 2020 2020 2020 2020  xs:..           
-00018e60: 2020 2020 2061 782e 7365 7454 7261 6e73       ax.setTrans
-00018e70: 666f 726d 2861 782e 7472 616e 7366 6f72  form(ax.transfor
-00018e80: 6d28 292e 7363 616c 6528 312c 2d31 292e  m().scale(1,-1).
-00018e90: 7472 616e 736c 6174 6528 302c 2d61 782e  translate(0,-ax.
-00018ea0: 6865 6967 6874 2829 2929 0d0a 2020 2020  height()))..    
-00018eb0: 656c 6966 2065 762e 7465 7874 2829 2069  elif ev.text() i
-00018ec0: 6e20 2827 5c72 272c 2027 2027 293a 2023  n ('\r', ' '): #
-00018ed0: 2065 6e74 6572 2c20 7370 6163 650d 0a20   enter, space.. 
-00018ee0: 2020 2020 2020 2076 622e 7365 745f 6472         vb.set_dr
-00018ef0: 6177 5f6c 696e 655f 636f 6c6f 7228 6472  aw_line_color(dr
-00018f00: 6177 5f64 6f6e 655f 636f 6c6f 7229 0d0a  aw_done_color)..
-00018f10: 2020 2020 2020 2020 7662 2e64 7261 775f          vb.draw_
-00018f20: 6c69 6e65 203d 204e 6f6e 650d 0a20 2020  line = None..   
-00018f30: 2065 6c69 6620 6576 2e74 6578 7428 2920   elif ev.text() 
-00018f40: 696e 2028 275c 7837 6627 2c20 275c 6227  in ('\x7f', '\b'
-00018f50: 293a 2023 2064 656c 2c20 6261 636b 7370  ): # del, backsp
-00018f60: 6163 650d 0a20 2020 2020 2020 2069 6620  ace..        if 
-00018f70: 6e6f 7420 7662 2e72 656d 6f76 655f 6c61  not vb.remove_la
-00018f80: 7374 5f72 6f69 2829 3a0d 0a20 2020 2020  st_roi():..     
-00018f90: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
-00018fa0: 6c73 650d 0a20 2020 2065 6c69 6620 6576  lse..    elif ev
-00018fb0: 2e6b 6579 2829 203d 3d20 5174 436f 7265  .key() == QtCore
-00018fc0: 2e51 742e 4b65 792e 4b65 795f 4c65 6674  .Qt.Key.Key_Left
-00018fd0: 3a0d 0a20 2020 2020 2020 2076 622e 7061  :..        vb.pa
-00018fe0: 6e5f 7828 7065 7263 656e 743d 2d31 3529  n_x(percent=-15)
-00018ff0: 0d0a 2020 2020 656c 6966 2065 762e 6b65  ..    elif ev.ke
-00019000: 7928 2920 3d3d 2051 7443 6f72 652e 5174  y() == QtCore.Qt
-00019010: 2e4b 6579 2e4b 6579 5f52 6967 6874 3a0d  .Key.Key_Right:.
-00019020: 0a20 2020 2020 2020 2076 622e 7061 6e5f  .        vb.pan_
-00019030: 7828 7065 7263 656e 743d 2b31 3529 0d0a  x(percent=+15)..
-00019040: 2020 2020 656c 6966 2065 762e 6b65 7928      elif ev.key(
-00019050: 2920 3d3d 2051 7443 6f72 652e 5174 2e4b  ) == QtCore.Qt.K
-00019060: 6579 2e4b 6579 5f48 6f6d 653a 0d0a 2020  ey.Key_Home:..  
-00019070: 2020 2020 2020 7662 2e70 616e 5f78 2873        vb.pan_x(s
-00019080: 7465 7073 3d2d 3165 3130 290d 0a20 2020  teps=-1e10)..   
-00019090: 2020 2020 205f 7265 7061 696e 745f 6361       _repaint_ca
-000190a0: 6e64 6c65 7328 290d 0a20 2020 2065 6c69  ndles()..    eli
-000190b0: 6620 6576 2e6b 6579 2829 203d 3d20 5174  f ev.key() == Qt
-000190c0: 436f 7265 2e51 742e 4b65 792e 4b65 795f  Core.Qt.Key.Key_
-000190d0: 456e 643a 0d0a 2020 2020 2020 2020 7662  End:..        vb
-000190e0: 2e70 616e 5f78 2873 7465 7073 3d2b 3165  .pan_x(steps=+1e
-000190f0: 3130 290d 0a20 2020 2020 2020 205f 7265  10)..        _re
-00019100: 7061 696e 745f 6361 6e64 6c65 7328 290d  paint_candles().
-00019110: 0a20 2020 2065 6c69 6620 6576 2e6b 6579  .    elif ev.key
-00019120: 2829 203d 3d20 5174 436f 7265 2e51 742e  () == QtCore.Qt.
-00019130: 4b65 792e 4b65 795f 4573 6361 7065 2061  Key.Key_Escape a
-00019140: 6e64 206b 6579 5f65 7363 5f63 6c6f 7365  nd key_esc_close
-00019150: 3a0d 0a20 2020 2020 2020 2076 622e 7769  :..        vb.wi
-00019160: 6e2e 636c 6f73 6528 290d 0a20 2020 2065  n.close()..    e
-00019170: 6c73 653a 0d0a 2020 2020 2020 2020 7265  lse:..        re
-00019180: 7475 726e 2046 616c 7365 0d0a 2020 2020  turn False..    
-00019190: 7265 7475 726e 2054 7275 650d 0a0d 0a0d  return True.....
-000191a0: 0a64 6566 205f 6d6f 7573 655f 636c 6963  .def _mouse_clic
-000191b0: 6b65 6428 7662 2c20 6576 293a 0d0a 2020  ked(vb, ev):..  
-000191c0: 2020 6966 2065 762e 6275 7474 6f6e 2829    if ev.button()
-000191d0: 203d 3d20 383a 2023 2062 6163 6b0d 0a20   == 8: # back.. 
-000191e0: 2020 2020 2020 2076 622e 7061 6e5f 7828         vb.pan_x(
-000191f0: 7065 7263 656e 743d 2d33 3029 0d0a 2020  percent=-30)..  
-00019200: 2020 656c 6966 2065 762e 6275 7474 6f6e    elif ev.button
-00019210: 2829 203d 3d20 3136 3a20 2320 6677 640d  () == 16: # fwd.
-00019220: 0a20 2020 2020 2020 2076 622e 7061 6e5f  .        vb.pan_
-00019230: 7828 7065 7263 656e 743d 2b33 3029 0d0a  x(percent=+30)..
-00019240: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
-00019250: 2020 2072 6574 7572 6e20 4661 6c73 650d     return False.
-00019260: 0a20 2020 2072 6574 7572 6e20 5472 7565  .    return True
-00019270: 0d0a 0d0a 0d0a 6465 6620 5f6d 6f75 7365  ......def _mouse
-00019280: 5f6d 6f76 6564 286d 6173 7465 722c 2076  _moved(master, v
-00019290: 622c 2065 7673 293a 0d0a 2020 2020 6966  b, evs):..    if
-000192a0: 2068 6173 6174 7472 286d 6173 7465 722c   hasattr(master,
-000192b0: 2027 636c 6f73 696e 6727 2920 616e 6420   'closing') and 
-000192c0: 6d61 7374 6572 2e63 6c6f 7369 6e67 3a0d  master.closing:.
-000192d0: 0a20 2020 2020 2020 2072 6574 7572 6e0d  .        return.
-000192e0: 0a20 2020 206d 6420 3d20 6d61 7374 6572  .    md = master
-000192f0: 5f64 6174 615b 6d61 7374 6572 5d2e 6765  _data[master].ge
-00019300: 7428 7662 2920 6f72 206d 6173 7465 725f  t(vb) or master_
-00019310: 6461 7461 5b6d 6173 7465 725d 5b27 6465  data[master]['de
-00019320: 6661 756c 7427 5d0d 0a20 2020 2069 6620  fault']..    if 
-00019330: 6e6f 7420 6576 733a 0d0a 2020 2020 2020  not evs:..      
-00019340: 2020 6576 7320 3d20 6d64 5b27 6c61 7374    evs = md['last
-00019350: 5f6d 6f75 7365 5f65 7673 275d 0d0a 2020  _mouse_evs']..  
-00019360: 2020 2020 2020 6966 206e 6f74 2065 7673        if not evs
-00019370: 3a0d 0a20 2020 2020 2020 2020 2020 2072  :..            r
-00019380: 6574 7572 6e0d 0a20 2020 206d 645b 276c  eturn..    md['l
-00019390: 6173 745f 6d6f 7573 655f 6576 7327 5d20  ast_mouse_evs'] 
-000193a0: 3d20 6576 730d 0a20 2020 2070 6f73 203d  = evs..    pos =
-000193b0: 2065 7673 5b2d 315d 0d0a 2020 2020 2320   evs[-1]..    # 
-000193c0: 616c 6c6f 7720 696e 7465 722d 7069 7865  allow inter-pixe
-000193d0: 6c20 6d6f 7665 7320 6966 206d 6f76 696e  l moves if movin
-000193e0: 6720 6d6f 7573 6520 736c 6f77 6c79 0d0a  g mouse slowly..
-000193f0: 2020 2020 7920 3d20 706f 732e 7928 290d      y = pos.y().
-00019400: 0a20 2020 2064 7920 3d20 7920 2d20 6d64  .    dy = y - md
-00019410: 5b27 6c61 7374 5f6d 6f75 7365 5f79 275d  ['last_mouse_y']
-00019420: 0d0a 2020 2020 6966 2030 203c 2061 6273  ..    if 0 < abs
-00019430: 2864 7929 203c 3d20 313a 0d0a 2020 2020  (dy) <= 1:..    
-00019440: 2020 2020 706f 732e 7365 7459 2870 6f73      pos.setY(pos
-00019450: 2e79 2829 202d 2064 792f 3229 0d0a 2020  .y() - dy/2)..  
-00019460: 2020 6d64 5b27 6c61 7374 5f6d 6f75 7365    md['last_mouse
-00019470: 5f79 275d 203d 2079 0d0a 2020 2020 2320  _y'] = y..    # 
-00019480: 6170 706c 7920 746f 2061 6c6c 2063 726f  apply to all cro
-00019490: 7373 6861 6972 730d 0a20 2020 2066 6f72  sshairs..    for
-000194a0: 2061 7820 696e 206d 6173 7465 722e 6178   ax in master.ax
-000194b0: 733a 0d0a 2020 2020 2020 2020 6966 2061  s:..        if a
-000194c0: 782e 6973 5669 7369 626c 6528 2920 616e  x.isVisible() an
-000194d0: 6420 6178 2e63 726f 7373 6861 6972 3a0d  d ax.crosshair:.
-000194e0: 0a20 2020 2020 2020 2020 2020 2070 6f69  .            poi
-000194f0: 6e74 203d 2061 782e 7662 2e6d 6170 5363  nt = ax.vb.mapSc
-00019500: 656e 6554 6f56 6965 7728 706f 7329 0d0a  eneToView(pos)..
-00019510: 2020 2020 2020 2020 2020 2020 6178 2e63              ax.c
-00019520: 726f 7373 6861 6972 2e75 7064 6174 6528  rosshair.update(
-00019530: 706f 696e 7429 0d0a 0d0a 0d0a 6465 6620  point)......def 
-00019540: 5f77 6865 656c 5f65 7665 6e74 5f77 7261  _wheel_event_wra
-00019550: 7070 6572 2873 656c 662c 206f 7269 675f  pper(self, orig_
-00019560: 6675 6e63 2c20 6576 293a 0d0a 2020 2020  func, ev):..    
-00019570: 2320 7363 726f 6c6c 696e 6720 6f6e 2074  # scrolling on t
-00019580: 6865 2062 6f72 6465 7220 6973 2073 696d  he border is sim
-00019590: 706c 7920 616e 6e6f 7969 6e67 2c20 706f  ply annoying, po
-000195a0: 7020 696e 2061 2063 6f75 706c 6520 6f66  p in a couple of
-000195b0: 2070 6978 656c 7320 746f 206d 616b 6520   pixels to make 
-000195c0: 7375 7265 0d0a 2020 2020 6420 3d20 5174  sure..    d = Qt
-000195d0: 436f 7265 2e51 506f 696e 7446 282d 322c  Core.QPointF(-2,
-000195e0: 3029 0d0a 2020 2020 6576 203d 2051 7447  0)..    ev = QtG
-000195f0: 7569 2e51 5768 6565 6c45 7665 6e74 2865  ui.QWheelEvent(e
-00019600: 762e 706f 7369 7469 6f6e 2829 2b64 2c20  v.position()+d, 
-00019610: 6576 2e67 6c6f 6261 6c50 6f73 6974 696f  ev.globalPositio
-00019620: 6e28 292b 642c 2065 762e 7069 7865 6c44  n()+d, ev.pixelD
-00019630: 656c 7461 2829 2c20 6576 2e61 6e67 6c65  elta(), ev.angle
-00019640: 4465 6c74 6128 292c 2065 762e 6275 7474  Delta(), ev.butt
-00019650: 6f6e 7328 292c 2065 762e 6d6f 6469 6669  ons(), ev.modifi
-00019660: 6572 7328 292c 2065 762e 7068 6173 6528  ers(), ev.phase(
-00019670: 292c 2046 616c 7365 290d 0a20 2020 206f  ), False)..    o
-00019680: 7269 675f 6675 6e63 2873 656c 662c 2065  rig_func(self, e
-00019690: 7629 0d0a 0d0a 0d0a 6465 6620 5f69 6e73  v)......def _ins
-000196a0: 7065 6374 5f63 6c69 636b 6564 2861 782c  pect_clicked(ax,
-000196b0: 2069 6e73 7065 6374 6f72 2c20 7768 656e   inspector, when
-000196c0: 5f64 6f75 626c 655f 636c 6963 6b2c 2065  _double_click, e
-000196d0: 7673 293a 0d0a 2020 2020 6966 2065 7673  vs):..    if evs
-000196e0: 5b2d 315d 2e61 6363 6570 7465 6420 6f72  [-1].accepted or
-000196f0: 2077 6865 6e5f 646f 7562 6c65 5f63 6c69   when_double_cli
-00019700: 636b 2021 3d20 6576 735b 2d31 5d2e 646f  ck != evs[-1].do
-00019710: 7562 6c65 2829 3a0d 0a20 2020 2020 2020  uble():..       
-00019720: 2072 6574 7572 6e0d 0a20 2020 2070 6f73   return..    pos
-00019730: 203d 2065 7673 5b2d 315d 2e73 6365 6e65   = evs[-1].scene
-00019740: 506f 7328 290d 0a20 2020 2072 6574 7572  Pos()..    retur
-00019750: 6e20 5f69 6e73 7065 6374 5f70 6f73 2861  n _inspect_pos(a
-00019760: 782c 2069 6e73 7065 6374 6f72 2c20 2870  x, inspector, (p
-00019770: 6f73 2c29 290d 0a0d 0a0d 0a64 6566 205f  os,))......def _
-00019780: 696e 7370 6563 745f 706f 7328 6178 2c20  inspect_pos(ax, 
-00019790: 696e 7370 6563 746f 722c 2070 6f73 7329  inspector, poss)
-000197a0: 3a0d 0a20 2020 2069 6620 6e6f 7420 6178  :..    if not ax
-000197b0: 2e76 622e 6461 7461 7372 633a 0d0a 2020  .vb.datasrc:..  
-000197c0: 2020 2020 2020 7265 7475 726e 0d0a 2020        return..  
-000197d0: 2020 706f 696e 7420 3d20 6178 2e76 622e    point = ax.vb.
-000197e0: 6d61 7053 6365 6e65 546f 5669 6577 2870  mapSceneToView(p
-000197f0: 6f73 735b 2d31 5d29 0d0a 2020 2020 7420  oss[-1])..    t 
-00019800: 3d20 706f 696e 742e 7828 2920 2b20 302e  = point.x() + 0.
-00019810: 350d 0a20 2020 2074 7279 3a0d 0a20 2020  5..    try:..   
-00019820: 2020 2020 2074 203d 2061 782e 7662 2e64       t = ax.vb.d
-00019830: 6174 6173 7263 2e63 6c6f 7365 7374 5f74  atasrc.closest_t
-00019840: 696d 6528 7429 0d0a 2020 2020 6578 6365  ime(t)..    exce
-00019850: 7074 204b 6579 4572 726f 723a 2023 2077  pt KeyError: # w
-00019860: 6865 6e20 636c 6963 6b69 6e67 2062 6579  hen clicking bey
-00019870: 6f6e 6420 7269 6768 745f 6d61 7267 696e  ond right_margin
-00019880: 5f63 616e 646c 6573 0d0a 2020 2020 2020  _candles..      
-00019890: 2020 6966 2063 6c61 6d70 5f67 7269 643a    if clamp_grid:
-000198a0: 0d0a 2020 2020 2020 2020 2020 2020 7420  ..            t 
-000198b0: 3d20 6178 2e76 622e 6461 7461 7372 632e  = ax.vb.datasrc.
-000198c0: 782e 696c 6f63 5b2d 3120 6966 2074 203e  x.iloc[-1 if t >
-000198d0: 2030 2065 6c73 6520 305d 0d0a 2020 2020   0 else 0]..    
-000198e0: 7472 793a 0d0a 2020 2020 2020 2020 696e  try:..        in
-000198f0: 7370 6563 746f 7228 742c 2070 6f69 6e74  spector(t, point
-00019900: 2e79 2829 290d 0a20 2020 2065 7863 6570  .y())..    excep
-00019910: 7420 4f53 4572 726f 7220 6173 2065 3a0d  t OSError as e:.
-00019920: 0a20 2020 2020 2020 2070 6173 730d 0a20  .        pass.. 
-00019930: 2020 2065 7863 6570 7420 4578 6365 7074     except Except
-00019940: 696f 6e20 6173 2065 3a0d 0a20 2020 2020  ion as e:..     
-00019950: 2020 2070 7269 6e74 2827 496e 7370 6563     print('Inspec
-00019960: 7469 6f6e 2065 7272 6f72 3a27 2c20 7479  tion error:', ty
-00019970: 7065 2865 292c 2065 290d 0a0d 0a0d 0a64  pe(e), e)......d
-00019980: 6566 2062 7269 6768 7465 6e28 636f 6c6f  ef brighten(colo
-00019990: 722c 2066 293a 0d0a 2020 2020 6966 206e  r, f):..    if n
-000199a0: 6f74 2063 6f6c 6f72 3a0d 0a20 2020 2020  ot color:..     
-000199b0: 2020 2072 6574 7572 6e20 636f 6c6f 720d     return color.
-000199c0: 0a20 2020 2072 6574 7572 6e20 7067 2e6d  .    return pg.m
-000199d0: 6b43 6f6c 6f72 2863 6f6c 6f72 292e 6c69  kColor(color).li
-000199e0: 6768 7465 7228 696e 7428 662a 3130 3029  ghter(int(f*100)
-000199f0: 290d 0a0d 0a0d 0a64 6566 205f 6765 745f  )......def _get_
-00019a00: 636f 6c6f 7228 6178 2c20 7374 796c 652c  color(ax, style,
-00019a10: 2077 616e 7465 645f 636f 6c6f 7229 3a0d   wanted_color):.
-00019a20: 0a20 2020 2069 6620 7479 7065 2877 616e  .    if type(wan
-00019a30: 7465 645f 636f 6c6f 7229 2069 6e20 2873  ted_color) in (s
-00019a40: 7472 2c20 5174 4775 692e 5143 6f6c 6f72  tr, QtGui.QColor
-00019a50: 293a 0d0a 2020 2020 2020 2020 7265 7475  ):..        retu
-00019a60: 726e 2077 616e 7465 645f 636f 6c6f 720d  rn wanted_color.
-00019a70: 0a20 2020 2069 6e64 6578 203d 2077 616e  .    index = wan
-00019a80: 7465 645f 636f 6c6f 7220 6966 2074 7970  ted_color if typ
-00019a90: 6528 7761 6e74 6564 5f63 6f6c 6f72 2920  e(wanted_color) 
-00019aa0: 3d3d 2069 6e74 2065 6c73 6520 4e6f 6e65  == int else None
-00019ab0: 0d0a 2020 2020 6973 5f6c 696e 6520 3d20  ..    is_line = 
-00019ac0: 6c61 6d62 6461 2073 7479 6c65 3a20 7374  lambda style: st
-00019ad0: 796c 6520 6973 204e 6f6e 6520 6f72 2061  yle is None or a
-00019ae0: 6e79 2863 6820 696e 2073 7479 6c65 2066  ny(ch in style f
-00019af0: 6f72 2063 6820 696e 2027 2d5f 2e27 290d  or ch in '-_.').
-00019b00: 0a20 2020 2074 6869 735f 6c69 6e65 203d  .    this_line =
-00019b10: 2069 735f 6c69 6e65 2873 7479 6c65 290d   is_line(style).
-00019b20: 0a20 2020 2069 6620 7468 6973 5f6c 696e  .    if this_lin
-00019b30: 653a 0d0a 2020 2020 2020 2020 636f 6c6f  e:..        colo
-00019b40: 7273 203d 2073 6f66 745f 636f 6c6f 7273  rs = soft_colors
-00019b50: 0d0a 2020 2020 656c 7365 3a0d 0a20 2020  ..    else:..   
-00019b60: 2020 2020 2063 6f6c 6f72 7320 3d20 6861       colors = ha
-00019b70: 7264 5f63 6f6c 6f72 730d 0a20 2020 2069  rd_colors..    i
-00019b80: 6620 696e 6465 7820 6973 204e 6f6e 653a  f index is None:
-00019b90: 0d0a 2020 2020 2020 2020 6176 6f69 6420  ..        avoid 
-00019ba0: 3d20 7365 7428 692e 6f70 7473 5b27 6861  = set(i.opts['ha
-00019bb0: 6e64 6564 5f63 6f6c 6f72 275d 2066 6f72  nded_color'] for
-00019bc0: 2069 2069 6e20 6178 2e69 7465 6d73 2069   i in ax.items i
-00019bd0: 6620 6973 696e 7374 616e 6365 2869 2c70  f isinstance(i,p
-00019be0: 672e 506c 6f74 4461 7461 4974 656d 2920  g.PlotDataItem) 
-00019bf0: 616e 6420 692e 6f70 7473 5b27 6861 6e64  and i.opts['hand
-00019c00: 6564 5f63 6f6c 6f72 275d 2069 7320 6e6f  ed_color'] is no
-00019c10: 7420 4e6f 6e65 2061 6e64 2074 6869 735f  t None and this_
-00019c20: 6c69 6e65 3d3d 6973 5f6c 696e 6528 692e  line==is_line(i.
-00019c30: 6f70 7473 5b27 7379 6d62 6f6c 275d 2929  opts['symbol']))
-00019c40: 0d0a 2020 2020 2020 2020 696e 6465 7820  ..        index 
-00019c50: 3d20 6c65 6e28 5b69 2066 6f72 2069 2069  = len([i for i i
-00019c60: 6e20 6178 2e69 7465 6d73 2069 6620 6973  n ax.items if is
-00019c70: 696e 7374 616e 6365 2869 2c70 672e 506c  instance(i,pg.Pl
-00019c80: 6f74 4461 7461 4974 656d 2920 616e 6420  otDataItem) and 
-00019c90: 692e 6f70 7473 5b27 6861 6e64 6564 5f63  i.opts['handed_c
-00019ca0: 6f6c 6f72 275d 2069 7320 4e6f 6e65 2061  olor'] is None a
-00019cb0: 6e64 2074 6869 735f 6c69 6e65 3d3d 6973  nd this_line==is
-00019cc0: 5f6c 696e 6528 692e 6f70 7473 5b27 7379  _line(i.opts['sy
-00019cd0: 6d62 6f6c 275d 295d 290d 0a20 2020 2020  mbol'])])..     
-00019ce0: 2020 2077 6869 6c65 2069 6e64 6578 2069     while index i
-00019cf0: 6e20 6176 6f69 643a 0d0a 2020 2020 2020  n avoid:..      
-00019d00: 2020 2020 2020 696e 6465 7820 2b3d 2031        index += 1
-00019d10: 0d0a 2020 2020 7265 7475 726e 2063 6f6c  ..    return col
-00019d20: 6f72 735b 696e 6465 7825 6c65 6e28 636f  ors[index%len(co
-00019d30: 6c6f 7273 295d 0d0a 0d0a 0d0a 6465 6620  lors)]......def 
-00019d40: 5f70 6474 696d 6532 6570 6f63 6828 7429  _pdtime2epoch(t)
-00019d50: 3a0d 0a20 2020 2069 6620 6973 696e 7374  :..    if isinst
-00019d60: 616e 6365 2874 2c20 7064 2e53 6572 6965  ance(t, pd.Serie
-00019d70: 7329 3a0d 0a20 2020 2020 2020 2069 6620  s):..        if 
-00019d80: 6973 696e 7374 616e 6365 2874 2e69 6c6f  isinstance(t.ilo
-00019d90: 635b 305d 2c20 7064 2e54 696d 6573 7461  c[0], pd.Timesta
-00019da0: 6d70 293a 0d0a 2020 2020 2020 2020 2020  mp):..          
-00019db0: 2020 7265 7475 726e 2074 2e76 6965 7728    return t.view(
-00019dc0: 2769 6e74 3634 2729 0d0a 2020 2020 2020  'int64')..      
-00019dd0: 2020 6820 3d20 6e70 2e6e 616e 6d61 7828    h = np.nanmax(
-00019de0: 742e 7661 6c75 6573 290d 0a20 2020 2020  t.values)..     
-00019df0: 2020 2069 6620 6820 3c20 3165 3130 3a20     if h < 1e10: 
-00019e00: 2320 6861 6e64 6c65 2073 2065 706f 6368  # handle s epoch
-00019e10: 730d 0a20 2020 2020 2020 2020 2020 2072  s..            r
-00019e20: 6574 7572 6e20 2874 2a31 6539 292e 6173  eturn (t*1e9).as
-00019e30: 7479 7065 2827 696e 7436 3427 290d 0a20  type('int64').. 
-00019e40: 2020 2020 2020 2069 6620 6820 3c20 3165         if h < 1e
-00019e50: 3133 3a20 2320 6861 6e64 6c65 206e 7320  13: # handle ns 
-00019e60: 6570 6f63 6873 0d0a 2020 2020 2020 2020  epochs..        
-00019e70: 2020 2020 7265 7475 726e 2028 742a 3165      return (t*1e
-00019e80: 3629 2e61 7374 7970 6528 2769 6e74 3634  6).astype('int64
-00019e90: 2729 0d0a 2020 2020 2020 2020 6966 2068  ')..        if h
-00019ea0: 203c 2031 6531 363a 2023 2068 616e 646c   < 1e16: # handl
-00019eb0: 6520 7573 2065 706f 6368 730d 0a20 2020  e us epochs..   
-00019ec0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00019ed0: 2874 2a31 6533 292e 6173 7479 7065 2827  (t*1e3).astype('
-00019ee0: 696e 7436 3427 290d 0a20 2020 2020 2020  int64')..       
-00019ef0: 2072 6574 7572 6e20 742e 6173 7479 7065   return t.astype
-00019f00: 2827 696e 7436 3427 290d 0a20 2020 2072  ('int64')..    r
-00019f10: 6574 7572 6e20 740d 0a0d 0a0d 0a64 6566  eturn t......def
-00019f20: 205f 7064 7469 6d65 3269 6e64 6578 2861   _pdtime2index(a
-00019f30: 782c 2074 732c 2061 6e79 5f65 6e64 3d46  x, ts, any_end=F
-00019f40: 616c 7365 2c20 7265 7175 6972 655f 7469  alse, require_ti
-00019f50: 6d65 3d46 616c 7365 293a 0d0a 2020 2020  me=False):..    
-00019f60: 6966 2069 7369 6e73 7461 6e63 6528 7473  if isinstance(ts
-00019f70: 2e69 6c6f 635b 305d 2c20 7064 2e54 696d  .iloc[0], pd.Tim
-00019f80: 6573 7461 6d70 293a 0d0a 2020 2020 2020  estamp):..      
-00019f90: 2020 7473 203d 2074 732e 7669 6577 2827    ts = ts.view('
-00019fa0: 696e 7436 3427 290d 0a20 2020 2065 6c73  int64')..    els
-00019fb0: 653a 0d0a 2020 2020 2020 2020 6820 3d20  e:..        h = 
-00019fc0: 6e70 2e6e 616e 6d61 7828 7473 2e76 616c  np.nanmax(ts.val
-00019fd0: 7565 7329 0d0a 2020 2020 2020 2020 6966  ues)..        if
-00019fe0: 2068 203c 2031 6537 3a0d 0a20 2020 2020   h < 1e7:..     
-00019ff0: 2020 2020 2020 2069 6620 7265 7175 6972         if requir
-0001a000: 655f 7469 6d65 3a0d 0a20 2020 2020 2020  e_time:..       
-0001a010: 2020 2020 2020 2020 2061 7373 6572 7420           assert 
-0001a020: 4661 6c73 652c 2027 6e6f 7420 6120 7469  False, 'not a ti
-0001a030: 6d65 2073 6572 6965 7327 0d0a 2020 2020  me series'..    
-0001a040: 2020 2020 2020 2020 7265 7475 726e 2074          return t
-0001a050: 730d 0a20 2020 2020 2020 2069 6620 6820  s..        if h 
-0001a060: 3c20 3165 3130 3a20 2320 6861 6e64 6c65  < 1e10: # handle
-0001a070: 2073 2065 706f 6368 730d 0a20 2020 2020   s epochs..     
-0001a080: 2020 2020 2020 2074 7320 3d20 7473 2e61         ts = ts.a
-0001a090: 7374 7970 6528 2766 6c6f 6174 3634 2729  stype('float64')
-0001a0a0: 202a 2031 6539 0d0a 2020 2020 2020 2020   * 1e9..        
-0001a0b0: 656c 6966 2068 203c 2031 6531 333a 2023  elif h < 1e13: #
-0001a0c0: 2068 616e 646c 6520 6d73 2065 706f 6368   handle ms epoch
-0001a0d0: 730d 0a20 2020 2020 2020 2020 2020 2074  s..            t
-0001a0e0: 7320 3d20 7473 2e61 7374 7970 6528 2766  s = ts.astype('f
-0001a0f0: 6c6f 6174 3634 2729 202a 2031 6536 0d0a  loat64') * 1e6..
-0001a100: 2020 2020 2020 2020 656c 6966 2068 203c          elif h <
-0001a110: 2031 6531 363a 2023 2068 616e 646c 6520   1e16: # handle 
-0001a120: 7573 2065 706f 6368 730d 0a20 2020 2020  us epochs..     
-0001a130: 2020 2020 2020 2074 7320 3d20 7473 2e61         ts = ts.a
-0001a140: 7374 7970 6528 2766 6c6f 6174 3634 2729  stype('float64')
-0001a150: 202a 2031 6533 0d0a 2020 2020 0d0a 2020   * 1e3..    ..  
-0001a160: 2020 6461 7461 7372 6320 3d20 5f67 6574    datasrc = _get
-0001a170: 5f64 6174 6173 7263 2861 7829 0d0a 2020  _datasrc(ax)..  
-0001a180: 2020 7873 203d 2064 6174 6173 7263 2e78    xs = datasrc.x
-0001a190: 0d0a 0d0a 2020 2020 2320 7472 7920 6578  ....    # try ex
-0001a1a0: 6163 7420 6d61 7463 6820 6265 666f 7265  act match before
-0001a1b0: 2061 7070 726f 7869 6d61 7465 206d 6174   approximate mat
-0001a1c0: 6368 0d0a 2020 2020 6578 6163 7420 3d20  ch..    exact = 
-0001a1d0: 6461 7461 7372 632e 696e 6465 785b 7873  datasrc.index[xs
-0001a1e0: 2e69 7369 6e28 7473 295d 2e74 6f5f 6c69  .isin(ts)].to_li
-0001a1f0: 7374 2829 0d0a 2020 2020 6966 206c 656e  st()..    if len
-0001a200: 2865 7861 6374 2920 3d3d 206c 656e 2874  (exact) == len(t
-0001a210: 7329 3a0d 0a20 2020 2020 2020 2072 6574  s):..        ret
-0001a220: 7572 6e20 6578 6163 740d 0a20 2020 200d  urn exact..    .
-0001a230: 0a20 2020 2072 203d 205b 5d0d 0a20 2020  .    r = []..   
-0001a240: 2066 6f72 2069 2c74 2069 6e20 656e 756d   for i,t in enum
-0001a250: 6572 6174 6528 7473 293a 0d0a 2020 2020  erate(ts):..    
-0001a260: 2020 2020 7873 7320 3d20 7873 2e6c 6f63      xss = xs.loc
-0001a270: 5b78 733e 745d 0d0a 2020 2020 2020 2020  [xs>t]..        
-0001a280: 6966 206c 656e 2878 7373 2920 3d3d 2030  if len(xss) == 0
-0001a290: 3a0d 0a20 2020 2020 2020 2020 2020 2074  :..            t
-0001a2a0: 3020 3d20 7873 2e69 6c6f 635b 2d31 5d0d  0 = xs.iloc[-1].
-0001a2b0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0001a2c0: 616e 795f 656e 6420 6f72 2074 3020 3d3d  any_end or t0 ==
-0001a2d0: 2074 3a0d 0a20 2020 2020 2020 2020 2020   t:..           
-0001a2e0: 2020 2020 2072 2e61 7070 656e 6428 6c65       r.append(le
-0001a2f0: 6e28 7873 292d 3129 0d0a 2020 2020 2020  n(xs)-1)..      
-0001a300: 2020 2020 2020 2020 2020 636f 6e74 696e            contin
-0001a310: 7565 0d0a 2020 2020 2020 2020 2020 2020  ue..            
-0001a320: 6966 2069 203e 2030 3a0d 0a20 2020 2020  if i > 0:..     
-0001a330: 2020 2020 2020 2020 2020 2063 6f6e 7469             conti
-0001a340: 6e75 650d 0a20 2020 2020 2020 2020 2020  nue..           
-0001a350: 2061 7373 6572 7420 7420 3c3d 2074 302c   assert t <= t0,
-0001a360: 2027 6d75 7374 2070 6c6f 7420 7468 6973   'must plot this
-0001a370: 2070 7269 6d69 7469 7665 2069 6e20 7072   primitive in pr
-0001a380: 696f 7220 7469 6d65 2d72 616e 6765 270d  ior time-range'.
-0001a390: 0a20 2020 2020 2020 2069 3120 3d20 7873  .        i1 = xs
-0001a3a0: 732e 696e 6465 785b 305d 0d0a 2020 2020  s.index[0]..    
-0001a3b0: 2020 2020 6930 203d 2069 312d 310d 0a20      i0 = i1-1.. 
-0001a3c0: 2020 2020 2020 2069 6620 6930 203c 2030         if i0 < 0
-0001a3d0: 3a0d 0a20 2020 2020 2020 2020 2020 2069  :..            i
-0001a3e0: 302c 6931 203d 2030 2c31 0d0a 2020 2020  0,i1 = 0,1..    
-0001a3f0: 2020 2020 7430 2c74 3120 3d20 7873 2e6c      t0,t1 = xs.l
-0001a400: 6f63 5b69 305d 2c20 7873 2e6c 6f63 5b69  oc[i0], xs.loc[i
-0001a410: 315d 0d0a 2020 2020 2020 2020 6474 203d  1]..        dt =
-0001a420: 2028 742d 7430 2920 2f20 2874 312d 7430   (t-t0) / (t1-t0
-0001a430: 290d 0a20 2020 2020 2020 2072 2e61 7070  )..        r.app
-0001a440: 656e 6428 6c65 7270 2864 742c 2069 302c  end(lerp(dt, i0,
-0001a450: 2069 3129 290d 0a20 2020 2072 6574 7572   i1))..    retur
-0001a460: 6e20 720d 0a0d 0a0d 0a64 6566 205f 6765  n r......def _ge
-0001a470: 745f 6461 7461 7372 6328 6178 2c20 7265  t_datasrc(ax, re
-0001a480: 7175 6972 653d 5472 7565 293a 0d0a 2020  quire=True):..  
-0001a490: 2020 6966 2061 782e 7662 2e64 6174 6173    if ax.vb.datas
-0001a4a0: 7263 2069 7320 6e6f 7420 4e6f 6e65 206f  rc is not None o
-0001a4b0: 7220 6e6f 7420 6178 2e76 622e 785f 696e  r not ax.vb.x_in
-0001a4c0: 6465 7865 643a 0d0a 2020 2020 2020 2020  dexed:..        
-0001a4d0: 7265 7475 726e 2061 782e 7662 2e64 6174  return ax.vb.dat
-0001a4e0: 6173 7263 0d0a 2020 2020 7662 7320 3d20  asrc..    vbs = 
-0001a4f0: 5b61 782e 7662 2066 6f72 2077 696e 2069  [ax.vb for win i
-0001a500: 6e20 7769 6e64 6f77 7320 666f 7220 6178  n windows for ax
-0001a510: 2069 6e20 7769 6e2e 6178 735d 0d0a 2020   in win.axs]..  
-0001a520: 2020 666f 7220 7662 2069 6e20 7662 733a    for vb in vbs:
-0001a530: 0d0a 2020 2020 2020 2020 6966 2076 622e  ..        if vb.
-0001a540: 6461 7461 7372 633a 0d0a 2020 2020 2020  datasrc:..      
-0001a550: 2020 2020 2020 7265 7475 726e 2076 622e        return vb.
-0001a560: 6461 7461 7372 630d 0a20 2020 2069 6620  datasrc..    if 
-0001a570: 7265 7175 6972 653a 0d0a 2020 2020 2020  require:..      
-0001a580: 2020 6173 7365 7274 2061 782e 7662 2e64    assert ax.vb.d
-0001a590: 6174 6173 7263 2c20 276e 6f74 2070 6f73  atasrc, 'not pos
-0001a5a0: 7369 626c 6520 746f 2070 6c6f 7420 7468  sible to plot th
-0001a5b0: 6973 2070 7269 6d69 7469 7665 2077 6974  is primitive wit
-0001a5c0: 686f 7574 2061 2070 7269 6f72 2074 696d  hout a prior tim
-0001a5d0: 652d 7261 6e67 6520 746f 2063 6f6d 7061  e-range to compa
-0001a5e0: 7265 2074 6f27 0d0a 0d0a 0d0a 6465 6620  re to'......def 
-0001a5f0: 5f6d 696c 6c69 7365 636f 6e64 5f74 7a5f  _millisecond_tz_
-0001a600: 7772 6170 2873 293a 0d0a 2020 2020 6966  wrap(s):..    if
-0001a610: 206c 656e 2873 2920 3e20 3620 616e 6420   len(s) > 6 and 
-0001a620: 735b 2d36 5d20 696e 2027 2b2d 2720 616e  s[-6] in '+-' an
-0001a630: 6420 735b 2d33 5d20 3d3d 2027 3a27 3a20  d s[-3] == ':': 
-0001a640: 2320 2b30 313a 3030 2066 6d74 2074 696d  # +01:00 fmt tim
-0001a650: 657a 6f6e 6520 7072 6573 656e 743f 0d0a  ezone present?..
-0001a660: 2020 2020 2020 2020 7320 3d20 735b 3a2d          s = s[:-
-0001a670: 365d 0d0a 2020 2020 7265 7475 726e 2028  6]..    return (
-0001a680: 732b 272e 3030 3030 3030 2729 2069 6620  s+'.000000') if 
-0001a690: 272e 2720 6e6f 7420 696e 2073 2065 6c73  '.' not in s els
-0001a6a0: 6520 730d 0a0d 0a0d 0a64 6566 205f 7832  e s......def _x2
-0001a6b0: 6c6f 6361 6c5f 7428 6461 7461 7372 632c  local_t(datasrc,
-0001a6c0: 2078 293a 0d0a 2020 2020 6966 2064 6973   x):..    if dis
-0001a6d0: 706c 6179 5f74 696d 657a 6f6e 6520 3d3d  play_timezone ==
-0001a6e0: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
-0001a6f0: 7265 7475 726e 205f 7832 7574 6328 6461  return _x2utc(da
-0001a700: 7461 7372 632c 2078 290d 0a20 2020 2072  tasrc, x)..    r
-0001a710: 6574 7572 6e20 5f78 3274 2864 6174 6173  eturn _x2t(datas
-0001a720: 7263 2c20 782c 206c 616d 6264 6120 743a  rc, x, lambda t:
-0001a730: 205f 6d69 6c6c 6973 6563 6f6e 645f 747a   _millisecond_tz
-0001a740: 5f77 7261 7028 6461 7465 7469 6d65 2e66  _wrap(datetime.f
-0001a750: 726f 6d74 696d 6573 7461 6d70 2874 2f31  romtimestamp(t/1
-0001a760: 6539 2c20 747a 3d64 6973 706c 6179 5f74  e9, tz=display_t
-0001a770: 696d 657a 6f6e 6529 2e69 736f 666f 726d  imezone).isoform
-0001a780: 6174 2873 6570 3d27 2027 2929 290d 0a0d  at(sep=' ')))...
-0001a790: 0a0d 0a64 6566 205f 7832 7574 6328 6461  ...def _x2utc(da
-0001a7a0: 7461 7372 632c 2078 293a 0d0a 2020 2020  tasrc, x):..    
-0001a7b0: 2320 7573 696e 6720 7064 2e74 6f5f 6461  # using pd.to_da
-0001a7c0: 7465 7469 6d65 2061 6c6c 6f77 2066 6f72  tetime allow for
-0001a7d0: 2070 7265 2d31 3937 3020 6461 7465 730d   pre-1970 dates.
-0001a7e0: 0a20 2020 2072 6574 7572 6e20 5f78 3274  .    return _x2t
-0001a7f0: 2864 6174 6173 7263 2c20 782c 206c 616d  (datasrc, x, lam
-0001a800: 6264 6120 743a 2070 642e 746f 5f64 6174  bda t: pd.to_dat
-0001a810: 6574 696d 6528 742c 2075 6e69 743d 276e  etime(t, unit='n
-0001a820: 7327 292e 7374 7266 7469 6d65 2827 2559  s').strftime('%Y
-0001a830: 2d25 6d2d 2564 2025 483a 254d 3a25 532e  -%m-%d %H:%M:%S.
-0001a840: 2566 2729 290d 0a0d 0a0d 0a64 6566 205f  %f'))......def _
-0001a850: 7832 7428 6461 7461 7372 632c 2078 2c20  x2t(datasrc, x, 
-0001a860: 7473 3273 7472 293a 0d0a 2020 2020 6966  ts2str):..    if
-0001a870: 206e 6f74 2064 6174 6173 7263 3a0d 0a20   not datasrc:.. 
-0001a880: 2020 2020 2020 2072 6574 7572 6e20 2727         return ''
-0001a890: 2c46 616c 7365 0d0a 2020 2020 7472 793a  ,False..    try:
-0001a8a0: 0d0a 2020 2020 2020 2020 7820 2b3d 2030  ..        x += 0
-0001a8b0: 2e35 0d0a 2020 2020 2020 2020 742c 5f2c  .5..        t,_,
-0001a8c0: 5f2c 5f2c 636e 7420 3d20 6461 7461 7372  _,_,cnt = datasr
-0001a8d0: 632e 6869 6c6f 2878 2c20 7829 0d0a 2020  c.hilo(x, x)..  
-0001a8e0: 2020 2020 2020 6966 2063 6e74 3a0d 0a20        if cnt:.. 
-0001a8f0: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
-0001a900: 7420 6461 7461 7372 632e 7469 6d65 6261  t datasrc.timeba
-0001a910: 7365 6428 293a 0d0a 2020 2020 2020 2020  sed():..        
-0001a920: 2020 2020 2020 2020 7265 7475 726e 2027          return '
-0001a930: 2567 2720 2520 742c 2046 616c 7365 0d0a  %g' % t, False..
-0001a940: 2020 2020 2020 2020 2020 2020 7320 3d20              s = 
-0001a950: 7473 3273 7472 2874 290d 0a20 2020 2020  ts2str(t)..     
-0001a960: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
-0001a970: 2020 2020 2069 6620 6570 6f63 685f 7065       if epoch_pe
-0001a980: 7269 6f64 203e 3d20 3233 2a36 302a 3630  riod >= 23*60*60
-0001a990: 3a20 2320 6461 796c 6967 6874 2073 6176  : # daylight sav
-0001a9a0: 696e 6773 2c20 6c65 6170 2073 6563 6f6e  ings, leap secon
-0001a9b0: 6473 2c20 6574 630d 0a20 2020 2020 2020  ds, etc..       
-0001a9c0: 2020 2020 2020 2020 2069 203d 2073 2e69           i = s.i
-0001a9d0: 6e64 6578 2827 2027 290d 0a20 2020 2020  ndex(' ')..     
-0001a9e0: 2020 2020 2020 2065 6c69 6620 6570 6f63         elif epoc
-0001a9f0: 685f 7065 7269 6f64 203e 3d20 3539 3a20  h_period >= 59: 
-0001aa00: 2320 636f 6e73 6964 6572 206c 6561 7020  # consider leap 
-0001aa10: 7365 636f 6e64 730d 0a20 2020 2020 2020  seconds..       
-0001aa20: 2020 2020 2020 2020 2069 203d 2073 2e72           i = s.r
-0001aa30: 696e 6465 7828 273a 2729 0d0a 2020 2020  index(':')..    
-0001aa40: 2020 2020 2020 2020 656c 6966 2065 706f          elif epo
-0001aa50: 6368 5f70 6572 696f 6420 3e3d 2031 3a0d  ch_period >= 1:.
-0001aa60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001aa70: 2069 203d 2073 2e69 6e64 6578 2827 2e27   i = s.index('.'
-0001aa80: 2920 6966 2027 2e27 2069 6e20 7320 656c  ) if '.' in s el
-0001aa90: 7365 206c 656e 2873 290d 0a20 2020 2020  se len(s)..     
-0001aaa0: 2020 2020 2020 2065 6c69 6620 6570 6f63         elif epoc
-0001aab0: 685f 7065 7269 6f64 203e 3d20 302e 3030  h_period >= 0.00
-0001aac0: 313a 0d0a 2020 2020 2020 2020 2020 2020  1:..            
-0001aad0: 2020 2020 6920 3d20 2d33 0d0a 2020 2020      i = -3..    
-0001aae0: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
-0001aaf0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0001ab00: 203d 206c 656e 2873 290d 0a20 2020 2020   = len(s)..     
-0001ab10: 2020 2020 2020 2072 6574 7572 6e20 735b         return s[
-0001ab20: 3a69 5d2c 5472 7565 0d0a 2020 2020 6578  :i],True..    ex
-0001ab30: 6365 7074 2045 7863 6570 7469 6f6e 2061  cept Exception a
-0001ab40: 7320 653a 0d0a 2020 2020 2020 2020 696d  s e:..        im
-0001ab50: 706f 7274 2074 7261 6365 6261 636b 0d0a  port traceback..
-0001ab60: 2020 2020 2020 2020 7472 6163 6562 6163          tracebac
-0001ab70: 6b2e 7072 696e 745f 6578 6328 290d 0a20  k.print_exc().. 
-0001ab80: 2020 2072 6574 7572 6e20 2727 2c64 6174     return '',dat
-0001ab90: 6173 7263 2e74 696d 6562 6173 6564 2829  asrc.timebased()
-0001aba0: 0d0a 0d0a 0d0a 6465 6620 5f78 3279 6561  ......def _x2yea
-0001abb0: 7228 6461 7461 7372 632c 2078 293a 0d0a  r(datasrc, x):..
-0001abc0: 2020 2020 742c 6861 7364 7320 3d20 5f78      t,hasds = _x
-0001abd0: 326c 6f63 616c 5f74 2864 6174 6173 7263  2local_t(datasrc
-0001abe0: 2c20 7829 0d0a 2020 2020 7265 7475 726e  , x)..    return
-0001abf0: 2074 5b3a 345d 2c68 6173 6473 0d0a 0d0a   t[:4],hasds....
-0001ac00: 0d0a 6465 6620 5f72 6f75 6e64 5f74 6f5f  ..def _round_to_
-0001ac10: 7369 676e 6966 6963 616e 7428 726e 672c  significant(rng,
-0001ac20: 2072 6e67 6d61 782c 2078 2c20 7369 676e   rngmax, x, sign
-0001ac30: 6966 6963 616e 745f 6465 6369 6d61 6c73  ificant_decimals
-0001ac40: 2c20 7369 676e 6966 6963 616e 745f 6570  , significant_ep
-0001ac50: 7329 3a0d 0a20 2020 2069 735f 6869 6768  s):..    is_high
-0001ac60: 7265 7320 3d20 2872 6e67 2f73 6967 6e69  res = (rng/signi
-0001ac70: 6669 6361 6e74 5f65 7073 203e 2031 6532  ficant_eps > 1e2
-0001ac80: 2061 6e64 2072 6e67 6d61 783c 3165 2d32   and rngmax<1e-2
-0001ac90: 2920 6f72 2061 6273 2872 6e67 6d61 7829  ) or abs(rngmax)
-0001aca0: 203e 2031 6537 206f 7220 726e 6720 3c20   > 1e7 or rng < 
-0001acb0: 3165 2d35 0d0a 2020 2020 7364 203d 2073  1e-5..    sd = s
-0001acc0: 6967 6e69 6669 6361 6e74 5f64 6563 696d  ignificant_decim
-0001acd0: 616c 730d 0a20 2020 2069 6620 6973 5f68  als..    if is_h
-0001ace0: 6967 6872 6573 2061 6e64 2061 6273 2878  ighres and abs(x
-0001acf0: 293e 303a 0d0a 2020 2020 2020 2020 6578  )>0:..        ex
-0001ad00: 7031 3020 3d20 666c 6f6f 7228 6e70 2e6c  p10 = floor(np.l
-0001ad10: 6f67 3130 2861 6273 2878 2929 290d 0a20  og10(abs(x))).. 
-0001ad20: 2020 2020 2020 2078 203d 2078 202f 2028         x = x / (
-0001ad30: 3130 2a2a 6578 7031 3029 0d0a 2020 2020  10**exp10)..    
-0001ad40: 2020 2020 726d 203d 2069 6e74 2861 6273      rm = int(abs
-0001ad50: 286e 702e 6c6f 6731 3028 726e 676d 6178  (np.log10(rngmax
-0001ad60: 2929 2920 6966 2072 6e67 6d61 783e 3020  ))) if rngmax>0 
-0001ad70: 656c 7365 2030 0d0a 2020 2020 2020 2020  else 0..        
-0001ad80: 7364 203d 206d 696e 2833 2c20 7364 2b72  sd = min(3, sd+r
-0001ad90: 6d29 0d0a 2020 2020 2020 2020 666d 7420  m)..        fmt 
-0001ada0: 3d20 2725 2525 692e 2569 6665 2525 6927  = '%%%i.%ife%%i'
-0001adb0: 2025 2028 7364 2c20 7364 290d 0a20 2020   % (sd, sd)..   
-0001adc0: 2020 2020 2072 203d 2066 6d74 2025 2028       r = fmt % (
-0001add0: 782c 2065 7870 3130 290d 0a20 2020 2065  x, exp10)..    e
-0001ade0: 6c73 653a 0d0a 2020 2020 2020 2020 6570  lse:..        ep
-0001adf0: 7320 3d20 666d 6f64 2878 2c20 7369 676e  s = fmod(x, sign
-0001ae00: 6966 6963 616e 745f 6570 7329 0d0a 2020  ificant_eps)..  
-0001ae10: 2020 2020 2020 6966 2061 6273 2865 7073        if abs(eps
-0001ae20: 2920 3e3d 2073 6967 6e69 6669 6361 6e74  ) >= significant
-0001ae30: 5f65 7073 2f32 3a0d 0a20 2020 2020 2020  _eps/2:..       
-0001ae40: 2020 2020 2023 2072 6f75 6e64 2075 700d       # round up.
-0001ae50: 0a20 2020 2020 2020 2020 2020 2065 7073  .            eps
-0001ae60: 202d 3d20 6e70 2e73 6967 6e28 6570 7329   -= np.sign(eps)
-0001ae70: 2a73 6967 6e69 6669 6361 6e74 5f65 7073  *significant_eps
-0001ae80: 0d0a 2020 2020 2020 2020 7820 2d3d 2065  ..        x -= e
-0001ae90: 7073 0d0a 2020 2020 2020 2020 666d 7420  ps..        fmt 
-0001aea0: 3d20 2725 2525 692e 2569 6627 2025 2028  = '%%%i.%if' % (
-0001aeb0: 7364 2c20 7364 290d 0a20 2020 2020 2020  sd, sd)..       
-0001aec0: 2072 203d 2066 6d74 2025 2078 0d0a 2020   r = fmt % x..  
-0001aed0: 2020 7265 7475 726e 2072 0d0a 0d0a 0d0a    return r......
-0001aee0: 6465 6620 5f72 6f69 6861 6e64 6c65 5f6d  def _roihandle_m
-0001aef0: 6f76 655f 736e 6170 2876 622c 206f 7269  ove_snap(vb, ori
-0001af00: 675f 6675 6e63 2c20 706f 732c 206d 6f64  g_func, pos, mod
-0001af10: 6966 6965 7273 3d51 7443 6f72 652e 5174  ifiers=QtCore.Qt
-0001af20: 2e4b 6579 626f 6172 644d 6f64 6966 6965  .KeyboardModifie
-0001af30: 722c 2066 696e 6973 683d 5472 7565 293a  r, finish=True):
-0001af40: 0d0a 2020 2020 706f 7320 3d20 7662 2e6d  ..    pos = vb.m
-0001af50: 6170 4465 7669 6365 546f 5669 6577 2870  apDeviceToView(p
-0001af60: 6f73 290d 0a20 2020 2070 6f73 203d 205f  os)..    pos = _
-0001af70: 636c 616d 705f 706f 696e 7428 7662 2e70  clamp_point(vb.p
-0001af80: 6172 656e 7428 292c 2070 6f73 290d 0a20  arent(), pos).. 
-0001af90: 2020 2070 6f73 203d 2076 622e 6d61 7056     pos = vb.mapV
-0001afa0: 6965 7754 6f44 6576 6963 6528 706f 7329  iewToDevice(pos)
-0001afb0: 0d0a 2020 2020 6f72 6967 5f66 756e 6328  ..    orig_func(
-0001afc0: 706f 732c 206d 6f64 6966 6965 7273 3d6d  pos, modifiers=m
-0001afd0: 6f64 6966 6965 7273 2c20 6669 6e69 7368  odifiers, finish
-0001afe0: 3d66 696e 6973 6829 0d0a 0d0a 0d0a 6465  =finish)......de
-0001aff0: 6620 5f63 6c61 6d70 5f78 7928 6178 2c20  f _clamp_xy(ax, 
-0001b000: 782c 2079 293a 0d0a 2020 2020 7920 3d20  x, y):..    y = 
-0001b010: 6178 2e76 622e 7973 6361 6c65 2e78 666f  ax.vb.yscale.xfo
-0001b020: 726d 2879 290d 0a20 2020 2069 6620 636c  rm(y)..    if cl
-0001b030: 616d 705f 6772 6964 2061 6e64 2061 782e  amp_grid and ax.
-0001b040: 7662 2e78 5f69 6e64 6578 6564 3a0d 0a20  vb.x_indexed:.. 
-0001b050: 2020 2020 2020 2064 7320 3d20 6178 2e76         ds = ax.v
-0001b060: 622e 6461 7461 7372 630d 0a20 2020 2020  b.datasrc..     
-0001b070: 2020 2069 6620 7820 3c20 3020 6f72 2028     if x < 0 or (
-0001b080: 6473 2061 6e64 2078 203e 206c 656e 2864  ds and x > len(d
-0001b090: 732e 6466 292d 3129 3a0d 0a20 2020 2020  s.df)-1):..     
-0001b0a0: 2020 2020 2020 2078 203d 2030 2069 6620         x = 0 if 
-0001b0b0: 7820 3c20 3020 656c 7365 206c 656e 2864  x < 0 else len(d
-0001b0c0: 732e 6466 292d 310d 0a20 2020 2020 2020  s.df)-1..       
-0001b0d0: 2078 203d 205f 726f 756e 6428 7829 0d0a   x = _round(x)..
-0001b0e0: 2020 2020 2020 2020 6570 7320 3d20 6178          eps = ax
-0001b0f0: 2e73 6967 6e69 6669 6361 6e74 5f65 7073  .significant_eps
-0001b100: 0d0a 2020 2020 2020 2020 6966 2065 7073  ..        if eps
-0001b110: 203e 2031 652d 383a 0d0a 2020 2020 2020   > 1e-8:..      
-0001b120: 2020 2020 2020 6570 7332 203d 206e 702e        eps2 = np.
-0001b130: 7369 676e 2879 2920 2a20 302e 3520 2a20  sign(y) * 0.5 * 
-0001b140: 6570 730d 0a20 2020 2020 2020 2020 2020  eps..           
-0001b150: 2079 202d 3d20 666d 6f64 2879 2b65 7073   y -= fmod(y+eps
-0001b160: 322c 2065 7073 2920 2d20 6570 7332 0d0a  2, eps) - eps2..
-0001b170: 2020 2020 7920 3d20 6178 2e76 622e 7973      y = ax.vb.ys
-0001b180: 6361 6c65 2e69 6e76 7866 6f72 6d28 792c  cale.invxform(y,
-0001b190: 2076 6572 6966 793d 5472 7565 290d 0a20   verify=True).. 
-0001b1a0: 2020 2072 6574 7572 6e20 782c 2079 0d0a     return x, y..
-0001b1b0: 0d0a 0d0a 6465 6620 5f63 6c61 6d70 5f70  ....def _clamp_p
-0001b1c0: 6f69 6e74 2861 782c 2070 293a 0d0a 2020  oint(ax, p):..  
-0001b1d0: 2020 6966 2063 6c61 6d70 5f67 7269 643a    if clamp_grid:
-0001b1e0: 0d0a 2020 2020 2020 2020 782c 7920 3d20  ..        x,y = 
-0001b1f0: 5f63 6c61 6d70 5f78 7928 6178 2c20 702e  _clamp_xy(ax, p.
-0001b200: 7828 292c 2070 2e79 2829 290d 0a20 2020  x(), p.y())..   
-0001b210: 2020 2020 2072 6574 7572 6e20 7067 2e50       return pg.P
-0001b220: 6f69 6e74 2878 2c20 7929 0d0a 2020 2020  oint(x, y)..    
-0001b230: 7265 7475 726e 2070 0d0a 0d0a 0d0a 6465  return p......de
-0001b240: 6620 5f64 7261 775f 6c69 6e65 5f73 6567  f _draw_line_seg
-0001b250: 6d65 6e74 5f74 6578 7428 706f 6c79 6c69  ment_text(polyli
-0001b260: 6e65 2c20 7365 676d 656e 742c 2070 6f73  ne, segment, pos
-0001b270: 302c 2070 6f73 3129 3a0d 0a20 2020 2066  0, pos1):..    f
-0001b280: 7365 6373 203d 204e 6f6e 650d 0a20 2020  secs = None..   
-0001b290: 2064 6174 6173 7263 203d 2070 6f6c 796c   datasrc = polyl
-0001b2a0: 696e 652e 7662 2e64 6174 6173 7263 0d0a  ine.vb.datasrc..
-0001b2b0: 2020 2020 6966 2064 6174 6173 7263 2061      if datasrc a
-0001b2c0: 6e64 2063 6c61 6d70 5f67 7269 643a 0d0a  nd clamp_grid:..
-0001b2d0: 2020 2020 2020 2020 7472 793a 0d0a 2020          try:..  
-0001b2e0: 2020 2020 2020 2020 2020 7830 2c78 3120            x0,x1 
-0001b2f0: 3d20 706f 7330 2e78 2829 2b30 2e35 2c20  = pos0.x()+0.5, 
-0001b300: 706f 7331 2e78 2829 2b30 2e35 0d0a 2020  pos1.x()+0.5..  
-0001b310: 2020 2020 2020 2020 2020 7430 2c5f 2c5f            t0,_,_
-0001b320: 2c5f 2c63 6e74 3020 3d20 6461 7461 7372  ,_,cnt0 = datasr
-0001b330: 632e 6869 6c6f 2878 302c 2078 3029 0d0a  c.hilo(x0, x0)..
-0001b340: 2020 2020 2020 2020 2020 2020 7431 2c5f              t1,_
-0001b350: 2c5f 2c5f 2c63 6e74 3120 3d20 6461 7461  ,_,_,cnt1 = data
-0001b360: 7372 632e 6869 6c6f 2878 312c 2078 3129  src.hilo(x1, x1)
-0001b370: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-0001b380: 2063 6e74 3020 616e 6420 636e 7431 3a0d   cnt0 and cnt1:.
-0001b390: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001b3a0: 2066 7365 6373 203d 2061 6273 2874 3120   fsecs = abs(t1 
-0001b3b0: 2d20 7430 2920 2f20 3165 390d 0a20 2020  - t0) / 1e9..   
-0001b3c0: 2020 2020 2065 7863 6570 743a 0d0a 2020       except:..  
-0001b3d0: 2020 2020 2020 2020 2020 7061 7373 0d0a            pass..
-0001b3e0: 2020 2020 6469 6666 203d 2070 6f73 3120      diff = pos1 
-0001b3f0: 2d20 706f 7330 0d0a 2020 2020 6966 2066  - pos0..    if f
-0001b400: 7365 6373 2069 7320 4e6f 6e65 3a0d 0a20  secs is None:.. 
-0001b410: 2020 2020 2020 2066 7365 6373 203d 2061         fsecs = a
-0001b420: 6273 2864 6966 662e 7828 292a 6570 6f63  bs(diff.x()*epoc
-0001b430: 685f 7065 7269 6f64 290d 0a20 2020 2073  h_period)..    s
-0001b440: 6563 7320 3d20 696e 7428 6673 6563 7329  ecs = int(fsecs)
-0001b450: 0d0a 2020 2020 6d69 6e73 203d 2073 6563  ..    mins = sec
-0001b460: 732f 2f36 300d 0a20 2020 2068 6f75 7273  s//60..    hours
-0001b470: 203d 206d 696e 732f 2f36 300d 0a20 2020   = mins//60..   
-0001b480: 206d 696e 7320 3d20 6d69 6e73 2536 300d   mins = mins%60.
-0001b490: 0a20 2020 2073 6563 7320 3d20 7365 6373  .    secs = secs
-0001b4a0: 2536 300d 0a20 2020 2069 6620 686f 7572  %60..    if hour
-0001b4b0: 733d 3d30 2061 6e64 206d 696e 733d 3d30  s==0 and mins==0
-0001b4c0: 2061 6e64 2073 6563 7320 3c20 3630 2061   and secs < 60 a
-0001b4d0: 6e64 2065 706f 6368 5f70 6572 696f 6420  nd epoch_period 
-0001b4e0: 3c20 313a 0d0a 2020 2020 2020 2020 6d73  < 1:..        ms
-0001b4f0: 6563 7320 3d20 696e 7428 2866 7365 6373  ecs = int((fsecs
-0001b500: 2d69 6e74 2866 7365 6373 2929 2a31 3030  -int(fsecs))*100
-0001b510: 3029 0d0a 2020 2020 2020 2020 7473 203d  0)..        ts =
-0001b520: 2027 2530 2e32 693a 2530 2e32 692e 2530   '%0.2i:%0.2i.%0
-0001b530: 2e33 6927 2025 2028 6d69 6e73 2c20 7365  .3i' % (mins, se
-0001b540: 6373 2c20 6d73 6563 7329 0d0a 2020 2020  cs, msecs)..    
-0001b550: 656c 6966 2068 6f75 7273 3d3d 3020 616e  elif hours==0 an
-0001b560: 6420 6d69 6e73 203c 2036 3020 616e 6420  d mins < 60 and 
-0001b570: 6570 6f63 685f 7065 7269 6f64 203c 2036  epoch_period < 6
-0001b580: 303a 0d0a 2020 2020 2020 2020 7473 203d  0:..        ts =
-0001b590: 2027 2530 2e32 693a 2530 2e32 693a 2530   '%0.2i:%0.2i:%0
-0001b5a0: 2e32 6927 2025 2028 686f 7572 732c 206d  .2i' % (hours, m
-0001b5b0: 696e 732c 2073 6563 7329 0d0a 2020 2020  ins, secs)..    
-0001b5c0: 656c 6966 2068 6f75 7273 203c 2032 343a  elif hours < 24:
-0001b5d0: 0d0a 2020 2020 2020 2020 7473 203d 2027  ..        ts = '
-0001b5e0: 2530 2e32 693a 2530 2e32 6927 2025 2028  %0.2i:%0.2i' % (
-0001b5f0: 686f 7572 732c 206d 696e 7329 0d0a 2020  hours, mins)..  
-0001b600: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
-0001b610: 2064 6179 7320 3d20 686f 7572 7320 2f2f   days = hours //
-0001b620: 2032 340d 0a20 2020 2020 2020 2068 6f75   24..        hou
-0001b630: 7273 2025 3d20 3234 0d0a 2020 2020 2020  rs %= 24..      
-0001b640: 2020 7473 203d 2027 2569 6420 2530 2e32    ts = '%id %0.2
-0001b650: 693a 2530 2e32 6927 2025 2028 6461 7973  i:%0.2i' % (days
-0001b660: 2c20 686f 7572 732c 206d 696e 7329 0d0a  , hours, mins)..
-0001b670: 2020 2020 2020 2020 6966 2074 732e 656e          if ts.en
-0001b680: 6473 7769 7468 2827 2030 303a 3030 2729  dswith(' 00:00')
-0001b690: 3a0d 0a20 2020 2020 2020 2020 2020 2074  :..            t
-0001b6a0: 7320 3d20 7473 2e70 6172 7469 7469 6f6e  s = ts.partition
-0001b6b0: 2827 2027 295b 305d 0d0a 2020 2020 7973  (' ')[0]..    ys
-0001b6c0: 6320 3d20 706f 6c79 6c69 6e65 2e76 622e  c = polyline.vb.
-0001b6d0: 7973 6361 6c65 0d0a 2020 2020 6966 2070  yscale..    if p
-0001b6e0: 6f6c 796c 696e 652e 7662 2e79 5f70 6f73  olyline.vb.y_pos
-0001b6f0: 6974 6976 653a 0d0a 2020 2020 2020 2020  itive:..        
-0001b700: 7930 2c79 3120 3d20 7973 632e 7866 6f72  y0,y1 = ysc.xfor
-0001b710: 6d28 706f 7330 2e79 2829 292c 2079 7363  m(pos0.y()), ysc
-0001b720: 2e78 666f 726d 2870 6f73 312e 7928 2929  .xform(pos1.y())
-0001b730: 0d0a 2020 2020 2020 2020 6966 2079 303a  ..        if y0:
-0001b740: 0d0a 2020 2020 2020 2020 2020 2020 6761  ..            ga
-0001b750: 696e 203d 2079 3120 2f20 7930 202d 2031  in = y1 / y0 - 1
-0001b760: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-0001b770: 2067 6169 6e20 3e20 3130 3a0d 0a20 2020   gain > 10:..   
-0001b780: 2020 2020 2020 2020 2020 2020 2076 616c               val
-0001b790: 7565 203d 2027 7825 6927 2025 2067 6169  ue = 'x%i' % gai
-0001b7a0: 6e0d 0a20 2020 2020 2020 2020 2020 2065  n..            e
-0001b7b0: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
-0001b7c0: 2020 2020 2020 7661 6c75 6520 3d20 2725        value = '%
-0001b7d0: 2b2e 3266 2025 2527 2025 2028 3130 3020  +.2f %%' % (100 
-0001b7e0: 2a20 6761 696e 290d 0a20 2020 2020 2020  * gain)..       
-0001b7f0: 2065 6c69 6620 6e6f 7420 7931 3a0d 0a20   elif not y1:.. 
-0001b800: 2020 2020 2020 2020 2020 2076 616c 7565             value
-0001b810: 203d 2027 3027 0d0a 2020 2020 2020 2020   = '0'..        
-0001b820: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
-0001b830: 2020 2076 616c 7565 203d 2027 2be2 889e     value = '+...
-0001b840: 2720 6966 2079 313e 3020 656c 7365 2027  ' if y1>0 else '
-0001b850: 2de2 889e 270d 0a20 2020 2065 6c73 653a  -...'..    else:
-0001b860: 0d0a 2020 2020 2020 2020 6479 203d 2079  ..        dy = y
-0001b870: 7363 2e78 666f 726d 2864 6966 662e 7928  sc.xform(diff.y(
-0001b880: 2929 0d0a 2020 2020 2020 2020 6966 2064  ))..        if d
-0001b890: 7920 616e 6420 2861 6273 2864 7929 203e  y and (abs(dy) >
-0001b8a0: 3d20 3165 3420 6f72 2061 6273 2864 7929  = 1e4 or abs(dy)
-0001b8b0: 203c 3d20 3165 2d32 293a 0d0a 2020 2020   <= 1e-2):..    
-0001b8c0: 2020 2020 2020 2020 7661 6c75 6520 3d20          value = 
-0001b8d0: 2725 2b33 2e33 6727 2025 2064 790d 0a20  '%+3.3g' % dy.. 
-0001b8e0: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
-0001b8f0: 2020 2020 2020 2020 2020 7661 6c75 6520            value 
-0001b900: 3d20 2725 2b32 2e32 6627 2025 2064 790d  = '%+2.2f' % dy.
-0001b910: 0a20 2020 2065 7874 7261 203d 205f 6472  .    extra = _dr
-0001b920: 6177 5f6c 696e 655f 6578 7472 615f 7465  aw_line_extra_te
-0001b930: 7874 2870 6f6c 796c 696e 652c 2073 6567  xt(polyline, seg
-0001b940: 6d65 6e74 2c20 706f 7330 2c20 706f 7331  ment, pos0, pos1
-0001b950: 290d 0a20 2020 2072 6574 7572 6e20 2725  )..    return '%
-0001b960: 7320 2573 2028 2573 2927 2025 2028 7661  s %s (%s)' % (va
-0001b970: 6c75 652c 2065 7874 7261 2c20 7473 290d  lue, extra, ts).
-0001b980: 0a0d 0a0d 0a64 6566 205f 6472 6177 5f6c  .....def _draw_l
-0001b990: 696e 655f 6578 7472 615f 7465 7874 2870  ine_extra_text(p
-0001b9a0: 6f6c 796c 696e 652c 2073 6567 6d65 6e74  olyline, segment
-0001b9b0: 2c20 706f 7330 2c20 706f 7331 293a 0d0a  , pos0, pos1):..
-0001b9c0: 2020 2020 2727 2753 686f 7773 2074 6865      '''Shows the
-0001b9d0: 2070 726f 706f 7274 696f 6e73 206f 6620   proportions of 
-0001b9e0: 7468 6973 206c 696e 6520 6865 6967 6874  this line height
-0001b9f0: 2063 6f6d 7061 7265 6420 746f 2074 6865   compared to the
-0001ba00: 2070 7265 7669 6f75 7320 7365 676d 656e   previous segmen
-0001ba10: 742e 2727 270d 0a20 2020 2070 7265 765f  t.'''..    prev_
-0001ba20: 7465 7874 203d 204e 6f6e 650d 0a20 2020  text = None..   
-0001ba30: 2066 6f72 2074 6578 7420 696e 2070 6f6c   for text in pol
-0001ba40: 796c 696e 652e 7465 7874 733a 0d0a 2020  yline.texts:..  
-0001ba50: 2020 2020 2020 6966 2070 7265 765f 7465        if prev_te
-0001ba60: 7874 2069 7320 6e6f 7420 4e6f 6e65 2061  xt is not None a
-0001ba70: 6e64 2074 6578 742e 7365 676d 656e 7420  nd text.segment 
-0001ba80: 3d3d 2073 6567 6d65 6e74 3a0d 0a20 2020  == segment:..   
-0001ba90: 2020 2020 2020 2020 2068 3020 3d20 7072           h0 = pr
-0001baa0: 6576 5f74 6578 742e 7365 676d 656e 742e  ev_text.segment.
-0001bab0: 6861 6e64 6c65 735b 305d 5b27 6974 656d  handles[0]['item
-0001bac0: 275d 0d0a 2020 2020 2020 2020 2020 2020  ']..            
-0001bad0: 6831 203d 2070 7265 765f 7465 7874 2e73  h1 = prev_text.s
-0001bae0: 6567 6d65 6e74 2e68 616e 646c 6573 5b31  egment.handles[1
-0001baf0: 5d5b 2769 7465 6d27 5d0d 0a20 2020 2020  ]['item']..     
-0001bb00: 2020 2020 2020 2070 7265 765f 6368 616e         prev_chan
-0001bb10: 6765 203d 2068 312e 706f 7328 292e 7928  ge = h1.pos().y(
-0001bb20: 2920 2d20 6830 2e70 6f73 2829 2e79 2829  ) - h0.pos().y()
-0001bb30: 0d0a 2020 2020 2020 2020 2020 2020 7468  ..            th
-0001bb40: 6973 5f63 6861 6e67 6520 3d20 706f 7331  is_change = pos1
-0001bb50: 2e79 2829 202d 2070 6f73 302e 7928 290d  .y() - pos0.y().
-0001bb60: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0001bb70: 6e6f 7420 6162 7328 7072 6576 5f63 6861  not abs(prev_cha
-0001bb80: 6e67 6529 203e 2031 652d 3134 3a0d 0a20  nge) > 1e-14:.. 
-0001bb90: 2020 2020 2020 2020 2020 2020 2020 2062                 b
-0001bba0: 7265 616b 0d0a 2020 2020 2020 2020 2020  reak..          
-0001bbb0: 2020 6368 616e 6765 5f70 6172 7420 3d20    change_part = 
-0001bbc0: 6162 7328 7468 6973 5f63 6861 6e67 6520  abs(this_change 
-0001bbd0: 2f20 7072 6576 5f63 6861 6e67 6529 0d0a  / prev_change)..
-0001bbe0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0001bbf0: 726e 2027 203d 2031 3a25 2e32 6620 2720  rn ' = 1:%.2f ' 
-0001bc00: 2520 6368 616e 6765 5f70 6172 740d 0a20  % change_part.. 
-0001bc10: 2020 2020 2020 2070 7265 765f 7465 7874         prev_text
-0001bc20: 203d 2074 6578 740d 0a20 2020 2072 6574   = text..    ret
-0001bc30: 7572 6e20 2727 0d0a 0d0a 0d0a 6465 6620  urn ''......def 
-0001bc40: 5f6d 616b 6570 656e 2863 6f6c 6f72 2c20  _makepen(color, 
-0001bc50: 7374 796c 653d 4e6f 6e65 2c20 7769 6474  style=None, widt
-0001bc60: 683d 3129 3a0d 0a20 2020 2069 6620 7374  h=1):..    if st
-0001bc70: 796c 6520 6973 204e 6f6e 6520 6f72 2073  yle is None or s
-0001bc80: 7479 6c65 203d 3d20 272d 273a 0d0a 2020  tyle == '-':..  
-0001bc90: 2020 2020 2020 7265 7475 726e 2070 672e        return pg.
-0001bca0: 6d6b 5065 6e28 636f 6c6f 723d 636f 6c6f  mkPen(color=colo
-0001bcb0: 722c 2077 6964 7468 3d77 6964 7468 290d  r, width=width).
-0001bcc0: 0a20 2020 2064 6173 6820 3d20 5b5d 0d0a  .    dash = []..
-0001bcd0: 2020 2020 666f 7220 6368 2069 6e20 7374      for ch in st
-0001bce0: 796c 653a 0d0a 2020 2020 2020 2020 6966  yle:..        if
-0001bcf0: 2063 6820 3d3d 2027 2d27 3a0d 0a20 2020   ch == '-':..   
-0001bd00: 2020 2020 2020 2020 2064 6173 6820 2b3d           dash +=
-0001bd10: 205b 342c 325d 0d0a 2020 2020 2020 2020   [4,2]..        
-0001bd20: 656c 6966 2063 6820 3d3d 2027 5f27 3a0d  elif ch == '_':.
-0001bd30: 0a20 2020 2020 2020 2020 2020 2064 6173  .            das
-0001bd40: 6820 2b3d 205b 3130 2c32 5d0d 0a20 2020  h += [10,2]..   
-0001bd50: 2020 2020 2065 6c69 6620 6368 203d 3d20       elif ch == 
-0001bd60: 272e 273a 0d0a 2020 2020 2020 2020 2020  '.':..          
-0001bd70: 2020 6461 7368 202b 3d20 5b31 2c32 5d0d    dash += [1,2].
-0001bd80: 0a20 2020 2020 2020 2065 6c69 6620 6368  .        elif ch
-0001bd90: 203d 3d20 2720 273a 0d0a 2020 2020 2020   == ' ':..      
-0001bda0: 2020 2020 2020 6966 2064 6173 683a 0d0a        if dash:..
-0001bdb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bdc0: 6461 7368 5b2d 315d 202b 3d20 320d 0a20  dash[-1] += 2.. 
-0001bdd0: 2020 2072 6574 7572 6e20 7067 2e6d 6b50     return pg.mkP
-0001bde0: 656e 2863 6f6c 6f72 3d63 6f6c 6f72 2c20  en(color=color, 
-0001bdf0: 7374 796c 653d 5174 436f 7265 2e51 742e  style=QtCore.Qt.
-0001be00: 5065 6e53 7479 6c65 2e43 7573 746f 6d44  PenStyle.CustomD
-0001be10: 6173 684c 696e 652c 2064 6173 683d 6461  ashLine, dash=da
-0001be20: 7368 2c20 7769 6474 683d 7769 6474 6829  sh, width=width)
-0001be30: 0d0a 0d0a 0d0a 6465 6620 5f72 6f75 6e64  ......def _round
-0001be40: 2876 293a 0d0a 2020 2020 7265 7475 726e  (v):..    return
-0001be50: 2066 6c6f 6f72 2876 2b30 2e35 290d 0a0d   floor(v+0.5)...
-0001be60: 0a0d 0a74 7279 3a0d 0a20 2020 2071 7476  ...try:..    qtv
-0001be70: 6572 203d 2027 2564 2e25 6427 2025 2028  er = '%d.%d' % (
-0001be80: 5174 436f 7265 2e51 545f 5645 5253 494f  QtCore.QT_VERSIO
-0001be90: 4e2f 2f32 3536 2f2f 3235 362c 2051 7443  N//256//256, QtC
-0001bea0: 6f72 652e 5154 5f56 4552 5349 4f4e 2f2f  ore.QT_VERSION//
-0001beb0: 3235 3625 3235 3629 0d0a 2020 2020 6966  256%256)..    if
-0001bec0: 2071 7476 6572 206e 6f74 2069 6e20 2827   qtver not in ('
-0001bed0: 352e 3927 2c20 2735 2e31 3327 2920 616e  5.9', '5.13') an
-0001bee0: 6420 5b69 6e74 2869 2920 666f 7220 6920  d [int(i) for i 
-0001bef0: 696e 2070 672e 5f5f 7665 7273 696f 6e5f  in pg.__version_
-0001bf00: 5f2e 7370 6c69 7428 272e 2729 5d20 3c3d  _.split('.')] <=
-0001bf10: 205b 302c 3131 2c30 5d3a 0d0a 2020 2020   [0,11,0]:..    
-0001bf20: 2020 2020 7072 696e 7428 2757 4152 4e49      print('WARNI
-0001bf30: 4e47 3a20 796f 7572 2076 6572 7369 6f6e  NG: your version
-0001bf40: 206f 6620 5174 206d 6179 206e 6f74 2070   of Qt may not p
-0001bf50: 6c6f 7420 6375 7276 6573 2063 6f6e 7461  lot curves conta
-0001bf60: 696e 696e 6720 4e61 4e73 2061 6e64 2069  ining NaNs and i
-0001bf70: 7320 6e6f 7420 7265 636f 6d6d 656e 6465  s not recommende
-0001bf80: 642e 2729 0d0a 2020 2020 2020 2020 7072  d.')..        pr
-0001bf90: 696e 7428 2753 6565 2068 7474 7073 3a2f  int('See https:/
-0001bfa0: 2f67 6974 6875 622e 636f 6d2f 7079 7174  /github.com/pyqt
-0001bfb0: 6772 6170 682f 7079 7174 6772 6170 682f  graph/pyqtgraph/
-0001bfc0: 6973 7375 6573 2f31 3035 3727 290d 0a65  issues/1057')..e
-0001bfd0: 7863 6570 743a 0d0a 2020 2020 7061 7373  xcept:..    pass
-0001bfe0: 0d0a 0d0a 696d 706f 7274 206c 6f63 616c  ....import local
-0001bff0: 650d 0a63 6f64 652c 5f20 3d20 6c6f 6361  e..code,_ = loca
-0001c000: 6c65 2e67 6574 6465 6661 756c 746c 6f63  le.getdefaultloc
-0001c010: 616c 6528 290d 0a69 6620 636f 6465 2069  ale()..if code i
-0001c020: 7320 6e6f 7420 4e6f 6e65 2061 6e64 205c  s not None and \
-0001c030: 0d0a 2020 2020 2861 6e79 2873 616e 6374  ..    (any(sanct
-0001c040: 696f 6e65 6420 696e 2063 6f64 652e 6c6f  ioned in code.lo
-0001c050: 7765 7228 2920 666f 7220 7361 6e63 7469  wer() for sancti
-0001c060: 6f6e 6564 2069 6e20 275f 7275 205f 6279  oned in '_ru _by
-0001c070: 2072 755f 2062 655f 272e 7370 6c69 7428   ru_ be_'.split(
-0001c080: 2929 206f 7220 5c0d 0a20 2020 2020 616e  )) or \..     an
-0001c090: 7928 7361 6e63 7469 6f6e 6564 2069 6e20  y(sanctioned in 
-0001c0a0: 636f 6465 2e6c 6f77 6572 2829 2066 6f72  code.lower() for
-0001c0b0: 2073 616e 6374 696f 6e65 6420 696e 2027   sanctioned in '
-0001c0c0: 7275 2062 6527 2e73 706c 6974 2829 2929  ru be'.split()))
-0001c0d0: 3a0d 0a20 2020 2069 6d70 6f72 7420 6f73  :..    import os
-0001c0e0: 0d0a 2020 2020 6f73 2e5f 6578 6974 2831  ..    os._exit(1
-0001c0f0: 290d 0a20 2020 2061 7373 6572 7420 4661  )..    assert Fa
-0001c100: 6c73 650d 0a0d 0a23 2064 6566 6175 6c74  lse....# default
-0001c110: 2074 6f20 626c 6163 6b2d 6f6e 2d77 6869   to black-on-whi
-0001c120: 7465 0d0a 7067 2e77 6964 6765 7473 2e47  te..pg.widgets.G
-0001c130: 7261 7068 6963 7356 6965 772e 4772 6170  raphicsView.Grap
-0001c140: 6869 6373 5669 6577 2e77 6865 656c 4576  hicsView.wheelEv
-0001c150: 656e 7420 3d20 7061 7274 6961 6c6d 6574  ent = partialmet
-0001c160: 686f 6428 5f77 6865 656c 5f65 7665 6e74  hod(_wheel_event
-0001c170: 5f77 7261 7070 6572 2c20 7067 2e77 6964  _wrapper, pg.wid
-0001c180: 6765 7473 2e47 7261 7068 6963 7356 6965  gets.GraphicsVie
-0001c190: 772e 4772 6170 6869 6373 5669 6577 2e77  w.GraphicsView.w
-0001c1a0: 6865 656c 4576 656e 7429 0d0a 2320 7573  heelEvent)..# us
-0001c1b0: 6520 6669 6e70 6c6f 7420 696e 7374 6561  e finplot instea
-0001c1c0: 6420 6f66 206d 6174 706c 6f74 6c69 620d  d of matplotlib.
-0001c1d0: 0a70 642e 7365 745f 6f70 7469 6f6e 2827  .pd.set_option('
-0001c1e0: 706c 6f74 7469 6e67 2e62 6163 6b65 6e64  plotting.backend
-0001c1f0: 272c 2027 6669 6e70 6c6f 742e 7064 706c  ', 'finplot.pdpl
-0001c200: 6f74 2729 0d0a 2320 7069 636b 2075 7020  ot')..# pick up 
-0001c210: 7769 6e20 7265 736f 6c75 7469 6f6e 0d0a  win resolution..
-0001c220: 7472 793a 0d0a 2020 2020 696d 706f 7274  try:..    import
-0001c230: 2063 7479 7065 730d 0a20 2020 2075 7365   ctypes..    use
-0001c240: 7233 3220 3d20 6374 7970 6573 2e77 696e  r32 = ctypes.win
-0001c250: 646c 6c2e 7573 6572 3332 0d0a 2020 2020  dll.user32..    
-0001c260: 7573 6572 3332 2e53 6574 5072 6f63 6573  user32.SetProces
-0001c270: 7344 5049 4177 6172 6528 290d 0a20 2020  sDPIAware()..   
-0001c280: 206c 6f64 5f63 616e 646c 6573 203d 2069   lod_candles = i
-0001c290: 6e74 2875 7365 7233 322e 4765 7453 7973  nt(user32.GetSys
-0001c2a0: 7465 6d4d 6574 7269 6373 2830 2920 2a20  temMetrics(0) * 
-0001c2b0: 312e 3629 0d0a 2020 2020 6361 6e64 6c65  1.6)..    candle
-0001c2c0: 5f73 6861 646f 775f 7769 6474 6820 3d20  _shadow_width = 
-0001c2d0: 696e 7428 7573 6572 3332 2e47 6574 5379  int(user32.GetSy
-0001c2e0: 7374 656d 4d65 7472 6963 7328 3029 202f  stemMetrics(0) /
-0001c2f0: 2f20 3231 3030 202b 2031 2920 2320 3235  / 2100 + 1) # 25
-0001c300: 3630 2061 6e64 2072 6573 6f6c 7574 696f  60 and resolutio
-0001c310: 6e73 2061 626f 7665 202d 3e20 7769 6465  ns above -> wide
-0001c320: 7220 7368 6164 6f77 730d 0a65 7863 6570  r shadows..excep
-0001c330: 743a 0d0a 2020 2020 7061 7373 0d0a       t:..    pass..
+0000ab70: 2020 2020 2020 7365 6c66 2e72 6f69 7320        self.rois 
+0000ab80: 3d20 7365 6c66 2e72 6f69 735b 3a2d 315d  = self.rois[:-1]
+0000ab90: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000aba0: 2020 2020 2020 7365 6c66 2e64 7261 775f        self.draw_
+0000abb0: 6c69 6e65 203d 204e 6f6e 650d 0a20 2020  line = None..   
+0000abc0: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
+0000abd0: 2e72 6f69 733a 0d0a 2020 2020 2020 2020  .rois:..        
+0000abe0: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
+0000abf0: 7461 6e63 6528 7365 6c66 2e72 6f69 735b  tance(self.rois[
+0000ac00: 2d31 5d2c 2070 672e 506f 6c79 4c69 6e65  -1], pg.PolyLine
+0000ac10: 524f 4929 3a0d 0a20 2020 2020 2020 2020  ROI):..         
+0000ac20: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0000ac30: 6472 6177 5f6c 696e 6520 3d20 7365 6c66  draw_line = self
+0000ac40: 2e72 6f69 735b 2d31 5d0d 0a20 2020 2020  .rois[-1]..     
+0000ac50: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0000ac60: 656c 662e 7365 745f 6472 6177 5f6c 696e  elf.set_draw_lin
+0000ac70: 655f 636f 6c6f 7228 6472 6177 5f6c 696e  e_color(draw_lin
+0000ac80: 655f 636f 6c6f 7229 0d0a 2020 2020 2020  e_color)..      
+0000ac90: 2020 2020 2020 7265 7475 726e 2054 7275        return Tru
+0000aca0: 650d 0a0d 0a20 2020 2064 6566 2061 7070  e....    def app
+0000acb0: 656e 645f 6472 6177 5f73 6567 6d65 6e74  end_draw_segment
+0000acc0: 2873 656c 662c 2070 293a 0d0a 2020 2020  (self, p):..    
+0000acd0: 2020 2020 6830 203d 2073 656c 662e 6472      h0 = self.dr
+0000ace0: 6177 5f6c 696e 652e 6861 6e64 6c65 735b  aw_line.handles[
+0000acf0: 2d31 5d5b 2769 7465 6d27 5d0d 0a20 2020  -1]['item']..   
+0000ad00: 2020 2020 2068 3120 3d20 7365 6c66 2e64       h1 = self.d
+0000ad10: 7261 775f 6c69 6e65 2e61 6464 4672 6565  raw_line.addFree
+0000ad20: 4861 6e64 6c65 2870 290d 0a20 2020 2020  Handle(p)..     
+0000ad30: 2020 2073 656c 662e 6472 6177 5f6c 696e     self.draw_lin
+0000ad40: 652e 6164 6453 6567 6d65 6e74 2868 302c  e.addSegment(h0,
+0000ad50: 2068 3129 0d0a 2020 2020 2020 2020 7365   h1)..        se
+0000ad60: 6c66 2e64 7261 7769 6e67 203d 2054 7275  lf.drawing = Tru
+0000ad70: 650d 0a0d 0a20 2020 2064 6566 2073 6574  e....    def set
+0000ad80: 5f64 7261 775f 6c69 6e65 5f63 6f6c 6f72  _draw_line_color
+0000ad90: 2873 656c 662c 2063 6f6c 6f72 293a 0d0a  (self, color):..
+0000ada0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+0000adb0: 6472 6177 5f6c 696e 653a 0d0a 2020 2020  draw_line:..    
+0000adc0: 2020 2020 2020 2020 7065 6e20 3d20 7067          pen = pg
+0000add0: 2e6d 6b50 656e 2863 6f6c 6f72 290d 0a20  .mkPen(color).. 
+0000ade0: 2020 2020 2020 2020 2020 2066 6f72 2073             for s
+0000adf0: 6567 6d65 6e74 2069 6e20 7365 6c66 2e64  egment in self.d
+0000ae00: 7261 775f 6c69 6e65 2e73 6567 6d65 6e74  raw_line.segment
+0000ae10: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
+0000ae20: 2020 2020 7365 676d 656e 742e 6375 7272      segment.curr
+0000ae30: 656e 7450 656e 203d 2073 6567 6d65 6e74  entPen = segment
+0000ae40: 2e70 656e 203d 2070 656e 0d0a 2020 2020  .pen = pen..    
+0000ae50: 2020 2020 2020 2020 2020 2020 7365 676d              segm
+0000ae60: 656e 742e 7570 6461 7465 2829 0d0a 0d0a  ent.update()....
+0000ae70: 2020 2020 6465 6620 7375 6767 6573 7450      def suggestP
+0000ae80: 6164 6469 6e67 2873 656c 662c 2061 7869  adding(self, axi
+0000ae90: 7329 3a0d 0a20 2020 2020 2020 2072 6574  s):..        ret
+0000aea0: 7572 6e20 300d 0a0d 0a0d 0a0d 0a63 6c61  urn 0........cla
+0000aeb0: 7373 2046 696e 506c 6f74 4974 656d 2870  ss FinPlotItem(p
+0000aec0: 672e 4772 6170 6869 6373 4f62 6a65 6374  g.GraphicsObject
+0000aed0: 293a 0d0a 2020 2020 6465 6620 5f5f 696e  ):..    def __in
+0000aee0: 6974 5f5f 2873 656c 662c 2061 782c 2064  it__(self, ax, d
+0000aef0: 6174 6173 7263 2c20 6c6f 6429 3a0d 0a20  atasrc, lod):.. 
+0000af00: 2020 2020 2020 2073 7570 6572 2829 2e5f         super()._
+0000af10: 5f69 6e69 745f 5f28 290d 0a20 2020 2020  _init__()..     
+0000af20: 2020 2073 656c 662e 6178 203d 2061 780d     self.ax = ax.
+0000af30: 0a20 2020 2020 2020 2073 656c 662e 6461  .        self.da
+0000af40: 7461 7372 6320 3d20 6461 7461 7372 630d  tasrc = datasrc.
+0000af50: 0a20 2020 2020 2020 2073 656c 662e 7069  .        self.pi
+0000af60: 6374 7572 6520 3d20 5174 4775 692e 5150  cture = QtGui.QP
+0000af70: 6963 7475 7265 2829 0d0a 2020 2020 2020  icture()..      
+0000af80: 2020 7365 6c66 2e70 6169 6e74 6572 203d    self.painter =
+0000af90: 2051 7447 7569 2e51 5061 696e 7465 7228   QtGui.QPainter(
+0000afa0: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+0000afb0: 6469 7274 7920 3d20 5472 7565 0d0a 2020  dirty = True..  
+0000afc0: 2020 2020 2020 7365 6c66 2e6c 6f64 203d        self.lod =
+0000afd0: 206c 6f64 0d0a 2020 2020 2020 2020 7365   lod..        se
+0000afe0: 6c66 2e63 6163 6865 6452 6563 7420 3d20  lf.cachedRect = 
+0000aff0: 4e6f 6e65 0d0a 0d0a 2020 2020 6465 6620  None....    def 
+0000b000: 7265 7061 696e 7428 7365 6c66 293a 0d0a  repaint(self):..
+0000b010: 2020 2020 2020 2020 7365 6c66 2e64 6972          self.dir
+0000b020: 7479 203d 2054 7275 650d 0a20 2020 2020  ty = True..     
+0000b030: 2020 2073 656c 662e 7061 696e 7428 7365     self.paint(se
+0000b040: 6c66 2e70 6169 6e74 6572 290d 0a0d 0a20  lf.painter).... 
+0000b050: 2020 2064 6566 2070 6169 6e74 2873 656c     def paint(sel
+0000b060: 662c 2070 2c20 2a61 7267 7329 3a0d 0a20  f, p, *args):.. 
+0000b070: 2020 2020 2020 2069 6620 7365 6c66 2e64         if self.d
+0000b080: 6174 6173 7263 2e69 735f 7370 6172 7365  atasrc.is_sparse
+0000b090: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
+0000b0a0: 656c 662e 6469 7274 7920 3d20 5472 7565  elf.dirty = True
+0000b0b0: 0d0a 2020 2020 2020 2020 7365 6c66 2e75  ..        self.u
+0000b0c0: 7064 6174 655f 6469 7274 795f 7069 6374  pdate_dirty_pict
+0000b0d0: 7572 6528 7365 6c66 2e76 6965 7752 6563  ure(self.viewRec
+0000b0e0: 7428 2929 0d0a 2020 2020 2020 2020 702e  t())..        p.
+0000b0f0: 6472 6177 5069 6374 7572 6528 302c 2030  drawPicture(0, 0
+0000b100: 2c20 7365 6c66 2e70 6963 7475 7265 290d  , self.picture).
+0000b110: 0a0d 0a20 2020 2064 6566 2075 7064 6174  ...    def updat
+0000b120: 655f 6469 7274 795f 7069 6374 7572 6528  e_dirty_picture(
+0000b130: 7365 6c66 2c20 7669 7369 626c 6552 6563  self, visibleRec
+0000b140: 7429 3a0d 0a20 2020 2020 2020 2069 6620  t):..        if 
+0000b150: 7365 6c66 2e64 6972 7479 206f 7220 5c0d  self.dirty or \.
+0000b160: 0a20 2020 2020 2020 2020 2020 2028 7365  .            (se
+0000b170: 6c66 2e6c 6f64 2061 6e64 2023 2072 6567  lf.lod and # reg
+0000b180: 656e 6572 6174 6520 7768 656e 207a 6f6f  enerate when zoo
+0000b190: 6d20 6368 616e 6765 733f 0d0a 2020 2020  m changes?..    
+0000b1a0: 2020 2020 2020 2020 2020 2020 2876 6973              (vis
+0000b1b0: 6962 6c65 5265 6374 2e6c 6566 7428 2920  ibleRect.left() 
+0000b1c0: 3c20 7365 6c66 2e63 6163 6865 6452 6563  < self.cachedRec
+0000b1d0: 742e 6c65 6674 2829 206f 7220 5c0d 0a20  t.left() or \.. 
+0000b1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b1f0: 7669 7369 626c 6552 6563 742e 7269 6768  visibleRect.righ
+0000b200: 7428 2920 3e20 7365 6c66 2e63 6163 6865  t() > self.cache
+0000b210: 6452 6563 742e 7269 6768 7428 2920 6f72  dRect.right() or
+0000b220: 205c 0d0a 2020 2020 2020 2020 2020 2020   \..            
+0000b230: 2020 2020 2076 6973 6962 6c65 5265 6374       visibleRect
+0000b240: 2e77 6964 7468 2829 203c 2073 656c 662e  .width() < self.
+0000b250: 6361 6368 6564 5265 6374 2e77 6964 7468  cachedRect.width
+0000b260: 2829 202f 2063 6163 6865 5f63 616e 646c  () / cache_candl
+0000b270: 655f 6661 6374 6f72 2929 3a20 2320 6f70  e_factor)): # op
+0000b280: 7469 6d69 7a65 2077 6865 6e20 7a6f 6f6d  timize when zoom
+0000b290: 696e 6720 696e 0d0a 2020 2020 2020 2020  ing in..        
+0000b2a0: 2020 2020 7365 6c66 2e5f 6765 6e65 7261      self._genera
+0000b2b0: 7465 5f70 6963 7475 7265 2876 6973 6962  te_picture(visib
+0000b2c0: 6c65 5265 6374 290d 0a0d 0a20 2020 2064  leRect)....    d
+0000b2d0: 6566 205f 6765 6e65 7261 7465 5f70 6963  ef _generate_pic
+0000b2e0: 7475 7265 2873 656c 662c 2062 6f75 6e64  ture(self, bound
+0000b2f0: 696e 6752 6563 7429 3a0d 0a20 2020 2020  ingRect):..     
+0000b300: 2020 2077 203d 2062 6f75 6e64 696e 6752     w = boundingR
+0000b310: 6563 742e 7769 6474 6828 290d 0a20 2020  ect.width()..   
+0000b320: 2020 2020 2073 656c 662e 6361 6368 6564       self.cached
+0000b330: 5265 6374 203d 2051 7443 6f72 652e 5152  Rect = QtCore.QR
+0000b340: 6563 7446 2862 6f75 6e64 696e 6752 6563  ectF(boundingRec
+0000b350: 742e 6c65 6674 2829 2d28 6361 6368 655f  t.left()-(cache_
+0000b360: 6361 6e64 6c65 5f66 6163 746f 722d 3129  candle_factor-1)
+0000b370: 2a30 2e35 2a77 2c20 302c 2063 6163 6865  *0.5*w, 0, cache
+0000b380: 5f63 616e 646c 655f 6661 6374 6f72 2a77  _candle_factor*w
+0000b390: 2c20 3029 0d0a 2020 2020 2020 2020 7365  , 0)..        se
+0000b3a0: 6c66 2e70 6169 6e74 6572 2e62 6567 696e  lf.painter.begin
+0000b3b0: 2873 656c 662e 7069 6374 7572 6529 0d0a  (self.picture)..
+0000b3c0: 2020 2020 2020 2020 7365 6c66 2e5f 6765          self._ge
+0000b3d0: 6e65 7261 7465 5f64 756d 6d79 5f70 6963  nerate_dummy_pic
+0000b3e0: 7475 7265 2873 656c 662e 7669 6577 5265  ture(self.viewRe
+0000b3f0: 6374 2829 290d 0a20 2020 2020 2020 2073  ct())..        s
+0000b400: 656c 662e 6765 6e65 7261 7465 5f70 6963  elf.generate_pic
+0000b410: 7475 7265 2873 656c 662e 6361 6368 6564  ture(self.cached
+0000b420: 5265 6374 290d 0a20 2020 2020 2020 2073  Rect)..        s
+0000b430: 656c 662e 7061 696e 7465 722e 656e 6428  elf.painter.end(
+0000b440: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+0000b450: 6469 7274 7920 3d20 4661 6c73 650d 0a0d  dirty = False...
+0000b460: 0a20 2020 2064 6566 205f 6765 6e65 7261  .    def _genera
+0000b470: 7465 5f64 756d 6d79 5f70 6963 7475 7265  te_dummy_picture
+0000b480: 2873 656c 662c 2062 6f75 6e64 696e 6752  (self, boundingR
+0000b490: 6563 7429 3a0d 0a20 2020 2020 2020 2069  ect):..        i
+0000b4a0: 6620 7365 6c66 2e64 6174 6173 7263 2e69  f self.datasrc.i
+0000b4b0: 735f 7370 6172 7365 3a0d 0a20 2020 2020  s_sparse:..     
+0000b4c0: 2020 2020 2020 2023 206a 7573 7420 6472         # just dr
+0000b4d0: 6177 2073 6f6d 6574 6869 6e67 2074 6f20  aw something to 
+0000b4e0: 656e 7375 7265 2050 7951 7420 7769 6c6c  ensure PyQt will
+0000b4f0: 2070 6169 6e74 2075 7320 6167 6169 6e0d   paint us again.
+0000b500: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0000b510: 662e 7061 696e 7465 722e 7365 7450 656e  f.painter.setPen
+0000b520: 2870 672e 6d6b 5065 6e28 6261 636b 6772  (pg.mkPen(backgr
+0000b530: 6f75 6e64 2929 0d0a 2020 2020 2020 2020  ound))..        
+0000b540: 2020 2020 7365 6c66 2e70 6169 6e74 6572      self.painter
+0000b550: 2e73 6574 4272 7573 6828 7067 2e6d 6b42  .setBrush(pg.mkB
+0000b560: 7275 7368 2862 6163 6b67 726f 756e 6429  rush(background)
+0000b570: 290d 0a20 2020 2020 2020 2020 2020 206c  )..            l
+0000b580: 2c72 203d 2062 6f75 6e64 696e 6752 6563  ,r = boundingRec
+0000b590: 742e 6c65 6674 2829 2c20 626f 756e 6469  t.left(), boundi
+0000b5a0: 6e67 5265 6374 2e72 6967 6874 2829 0d0a  ngRect.right()..
+0000b5b0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0000b5c0: 2e70 6169 6e74 6572 2e64 7261 7752 6563  .painter.drawRec
+0000b5d0: 7428 5174 436f 7265 2e51 5265 6374 4628  t(QtCore.QRectF(
+0000b5e0: 6c2c 2062 6f75 6e64 696e 6752 6563 742e  l, boundingRect.
+0000b5f0: 746f 7028 292c 2031 652d 332c 2062 6f75  top(), 1e-3, bou
+0000b600: 6e64 696e 6752 6563 742e 6865 6967 6874  ndingRect.height
+0000b610: 2829 2a31 652d 3529 290d 0a20 2020 2020  ()*1e-5))..     
+0000b620: 2020 2020 2020 2073 656c 662e 7061 696e         self.pain
+0000b630: 7465 722e 6472 6177 5265 6374 2851 7443  ter.drawRect(QtC
+0000b640: 6f72 652e 5152 6563 7446 2872 2c20 626f  ore.QRectF(r, bo
+0000b650: 756e 6469 6e67 5265 6374 2e62 6f74 746f  undingRect.botto
+0000b660: 6d28 292c 202d 3165 2d33 2c20 2d62 6f75  m(), -1e-3, -bou
+0000b670: 6e64 696e 6752 6563 742e 6865 6967 6874  ndingRect.height
+0000b680: 2829 2a31 652d 3529 290d 0a0d 0a20 2020  ()*1e-5))....   
+0000b690: 2064 6566 2062 6f75 6e64 696e 6752 6563   def boundingRec
+0000b6a0: 7428 7365 6c66 293a 0d0a 2020 2020 2020  t(self):..      
+0000b6b0: 2020 7265 7475 726e 2051 7443 6f72 652e    return QtCore.
+0000b6c0: 5152 6563 7446 2873 656c 662e 7069 6374  QRectF(self.pict
+0000b6d0: 7572 652e 626f 756e 6469 6e67 5265 6374  ure.boundingRect
+0000b6e0: 2829 290d 0a0d 0a0d 0a0d 0a63 6c61 7373  ())........class
+0000b6f0: 2043 616e 646c 6573 7469 636b 4974 656d   CandlestickItem
+0000b700: 2846 696e 506c 6f74 4974 656d 293a 0d0a  (FinPlotItem):..
+0000b710: 2020 2020 6465 6620 5f5f 696e 6974 5f5f      def __init__
+0000b720: 2873 656c 662c 2061 782c 2064 6174 6173  (self, ax, datas
+0000b730: 7263 2c20 6472 6177 5f62 6f64 792c 2064  rc, draw_body, d
+0000b740: 7261 775f 7368 6164 6f77 2c20 6361 6e64  raw_shadow, cand
+0000b750: 6c65 5f77 6964 7468 2c20 636f 6c6f 7266  le_width, colorf
+0000b760: 756e 632c 2072 6573 616d 703d 4e6f 6e65  unc, resamp=None
+0000b770: 293a 0d0a 2020 2020 2020 2020 7365 6c66  ):..        self
+0000b780: 2e63 6f6c 6f72 7320 3d20 6469 6374 2862  .colors = dict(b
+0000b790: 756c 6c5f 7368 6164 6f77 2020 2020 2020  ull_shadow      
+0000b7a0: 3d20 6361 6e64 6c65 5f62 756c 6c5f 636f  = candle_bull_co
+0000b7b0: 6c6f 722c 0d0a 2020 2020 2020 2020 2020  lor,..          
+0000b7c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b7d0: 2062 756c 6c5f 6672 616d 6520 2020 2020   bull_frame     
+0000b7e0: 2020 3d20 6361 6e64 6c65 5f62 756c 6c5f    = candle_bull_
+0000b7f0: 636f 6c6f 722c 0d0a 2020 2020 2020 2020  color,..        
+0000b800: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b810: 2020 2062 756c 6c5f 626f 6479 2020 2020     bull_body    
+0000b820: 2020 2020 3d20 6361 6e64 6c65 5f62 756c      = candle_bul
+0000b830: 6c5f 626f 6479 5f63 6f6c 6f72 2c0d 0a20  l_body_color,.. 
+0000b840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b850: 2020 2020 2020 2020 2020 6265 6172 5f73            bear_s
+0000b860: 6861 646f 7720 2020 2020 203d 2063 616e  hadow      = can
+0000b870: 646c 655f 6265 6172 5f63 6f6c 6f72 2c0d  dle_bear_color,.
+0000b880: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000b890: 2020 2020 2020 2020 2020 2020 6265 6172              bear
+0000b8a0: 5f66 7261 6d65 2020 2020 2020 203d 2063  _frame       = c
+0000b8b0: 616e 646c 655f 6265 6172 5f63 6f6c 6f72  andle_bear_color
+0000b8c0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0000b8d0: 2020 2020 2020 2020 2020 2020 2020 6265                be
+0000b8e0: 6172 5f62 6f64 7920 2020 2020 2020 203d  ar_body        =
+0000b8f0: 2063 616e 646c 655f 6265 6172 5f62 6f64   candle_bear_bod
+0000b900: 795f 636f 6c6f 722c 0d0a 2020 2020 2020  y_color,..      
+0000b910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b920: 2020 2020 2077 6561 6b5f 6275 6c6c 5f73       weak_bull_s
+0000b930: 6861 646f 7720 3d20 6272 6967 6874 656e  hadow = brighten
+0000b940: 2863 616e 646c 655f 6275 6c6c 5f63 6f6c  (candle_bull_col
+0000b950: 6f72 2c20 312e 3229 2c0d 0a20 2020 2020  or, 1.2),..     
+0000b960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b970: 2020 2020 2020 7765 616b 5f62 756c 6c5f        weak_bull_
+0000b980: 6672 616d 6520 203d 2062 7269 6768 7465  frame  = brighte
+0000b990: 6e28 6361 6e64 6c65 5f62 756c 6c5f 636f  n(candle_bull_co
+0000b9a0: 6c6f 722c 2031 2e32 292c 0d0a 2020 2020  lor, 1.2),..    
+0000b9b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b9c0: 2020 2020 2020 2077 6561 6b5f 6275 6c6c         weak_bull
+0000b9d0: 5f62 6f64 7920 2020 3d20 6272 6967 6874  _body   = bright
+0000b9e0: 656e 2863 616e 646c 655f 6275 6c6c 5f63  en(candle_bull_c
+0000b9f0: 6f6c 6f72 2c20 312e 3229 2c0d 0a20 2020  olor, 1.2),..   
+0000ba00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ba10: 2020 2020 2020 2020 7765 616b 5f62 6561          weak_bea
+0000ba20: 725f 7368 6164 6f77 203d 2062 7269 6768  r_shadow = brigh
+0000ba30: 7465 6e28 6361 6e64 6c65 5f62 6561 725f  ten(candle_bear_
+0000ba40: 636f 6c6f 722c 2031 2e35 292c 0d0a 2020  color, 1.5),..  
+0000ba50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ba60: 2020 2020 2020 2020 2077 6561 6b5f 6265           weak_be
+0000ba70: 6172 5f66 7261 6d65 2020 3d20 6272 6967  ar_frame  = brig
+0000ba80: 6874 656e 2863 616e 646c 655f 6265 6172  hten(candle_bear
+0000ba90: 5f63 6f6c 6f72 2c20 312e 3529 2c0d 0a20  _color, 1.5),.. 
+0000baa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bab0: 2020 2020 2020 2020 2020 7765 616b 5f62            weak_b
+0000bac0: 6561 725f 626f 6479 2020 203d 2062 7269  ear_body   = bri
+0000bad0: 6768 7465 6e28 6361 6e64 6c65 5f62 6561  ghten(candle_bea
+0000bae0: 725f 636f 6c6f 722c 2031 2e35 2929 0d0a  r_color, 1.5))..
+0000baf0: 2020 2020 2020 2020 7365 6c66 2e64 7261          self.dra
+0000bb00: 775f 626f 6479 203d 2064 7261 775f 626f  w_body = draw_bo
+0000bb10: 6479 0d0a 2020 2020 2020 2020 7365 6c66  dy..        self
+0000bb20: 2e64 7261 775f 7368 6164 6f77 203d 2064  .draw_shadow = d
+0000bb30: 7261 775f 7368 6164 6f77 0d0a 2020 2020  raw_shadow..    
+0000bb40: 2020 2020 7365 6c66 2e63 616e 646c 655f      self.candle_
+0000bb50: 7769 6474 6820 3d20 6361 6e64 6c65 5f77  width = candle_w
+0000bb60: 6964 7468 0d0a 2020 2020 2020 2020 7365  idth..        se
+0000bb70: 6c66 2e73 6861 646f 775f 7769 6474 6820  lf.shadow_width 
+0000bb80: 3d20 6361 6e64 6c65 5f73 6861 646f 775f  = candle_shadow_
+0000bb90: 7769 6474 680d 0a20 2020 2020 2020 2073  width..        s
+0000bba0: 656c 662e 636f 6c6f 7266 756e 6320 3d20  elf.colorfunc = 
+0000bbb0: 636f 6c6f 7266 756e 630d 0a20 2020 2020  colorfunc..     
+0000bbc0: 2020 2073 656c 662e 7265 7361 6d70 203d     self.resamp =
+0000bbd0: 2072 6573 616d 700d 0a20 2020 2020 2020   resamp..       
+0000bbe0: 2073 656c 662e 785f 6f66 6673 6574 203d   self.x_offset =
+0000bbf0: 2030 0d0a 2020 2020 2020 2020 7375 7065   0..        supe
+0000bc00: 7228 292e 5f5f 696e 6974 5f5f 2861 782c  r().__init__(ax,
+0000bc10: 2064 6174 6173 7263 2c20 6c6f 643d 5472   datasrc, lod=Tr
+0000bc20: 7565 290d 0a0d 0a20 2020 2064 6566 2067  ue)....    def g
+0000bc30: 656e 6572 6174 655f 7069 6374 7572 6528  enerate_picture(
+0000bc40: 7365 6c66 2c20 626f 756e 6469 6e67 5265  self, boundingRe
+0000bc50: 6374 293a 0d0a 2020 2020 2020 2020 6c65  ct):..        le
+0000bc60: 6674 2c72 6967 6874 203d 2062 6f75 6e64  ft,right = bound
+0000bc70: 696e 6752 6563 742e 6c65 6674 2829 2c20  ingRect.left(), 
+0000bc80: 626f 756e 6469 6e67 5265 6374 2e72 6967  boundingRect.rig
+0000bc90: 6874 2829 0d0a 2020 2020 2020 2020 7020  ht()..        p 
+0000bca0: 3d20 7365 6c66 2e70 6169 6e74 6572 0d0a  = self.painter..
+0000bcb0: 2020 2020 2020 2020 6466 2c6f 7269 676c          df,origl
+0000bcc0: 656e 203d 2073 656c 662e 6461 7461 7372  en = self.datasr
+0000bcd0: 632e 726f 7773 2835 2c20 6c65 6674 2c20  c.rows(5, left, 
+0000bce0: 7269 6768 742c 2079 7363 616c 653d 7365  right, yscale=se
+0000bcf0: 6c66 2e61 782e 7662 2e79 7363 616c 652c  lf.ax.vb.yscale,
+0000bd00: 2072 6573 616d 703d 7365 6c66 2e72 6573   resamp=self.res
+0000bd10: 616d 7029 0d0a 2020 2020 2020 2020 6620  amp)..        f 
+0000bd20: 3d20 6f72 6967 6c65 6e20 2f20 6c65 6e28  = origlen / len(
+0000bd30: 6466 2920 6966 206c 656e 2864 6629 2065  df) if len(df) e
+0000bd40: 6c73 6520 310d 0a20 2020 2020 2020 2077  lse 1..        w
+0000bd50: 203d 2073 656c 662e 6361 6e64 6c65 5f77   = self.candle_w
+0000bd60: 6964 7468 202a 2066 0d0a 2020 2020 2020  idth * f..      
+0000bd70: 2020 7732 203d 2077 202a 2030 2e35 0d0a    w2 = w * 0.5..
+0000bd80: 2020 2020 2020 2020 666f 7220 7368 6164          for shad
+0000bd90: 6f77 2c66 7261 6d65 2c62 6f64 792c 6466  ow,frame,body,df
+0000bda0: 5f72 6f77 7320 696e 2073 656c 662e 636f  _rows in self.co
+0000bdb0: 6c6f 7266 756e 6328 7365 6c66 2c20 7365  lorfunc(self, se
+0000bdc0: 6c66 2e64 6174 6173 7263 2c20 6466 293a  lf.datasrc, df):
+0000bdd0: 0d0a 2020 2020 2020 2020 2020 2020 6964  ..            id
+0000bde0: 7873 203d 2064 665f 726f 7773 2e69 6e64  xs = df_rows.ind
+0000bdf0: 6578 0d0a 2020 2020 2020 2020 2020 2020  ex..            
+0000be00: 726f 7773 203d 2064 665f 726f 7773 2e76  rows = df_rows.v
+0000be10: 616c 7565 730d 0a20 2020 2020 2020 2020  alues..         
+0000be20: 2020 2069 6620 7365 6c66 2e78 5f6f 6666     if self.x_off
+0000be30: 7365 743a 0d0a 2020 2020 2020 2020 2020  set:..          
+0000be40: 2020 2020 2020 6964 7873 202b 3d20 7365        idxs += se
+0000be50: 6c66 2e78 5f6f 6666 7365 740d 0a20 2020  lf.x_offset..   
+0000be60: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
+0000be70: 2e64 7261 775f 7368 6164 6f77 3a0d 0a20  .draw_shadow:.. 
+0000be80: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0000be90: 2e73 6574 5065 6e28 7067 2e6d 6b50 656e  .setPen(pg.mkPen
+0000bea0: 2873 6861 646f 772c 2077 6964 7468 3d73  (shadow, width=s
+0000beb0: 656c 662e 7368 6164 6f77 5f77 6964 7468  elf.shadow_width
+0000bec0: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
+0000bed0: 2020 2020 666f 7220 782c 2874 2c6f 7065      for x,(t,ope
+0000bee0: 6e2c 636c 6f73 652c 6869 6768 2c6c 6f77  n,close,high,low
+0000bef0: 2920 696e 207a 6970 2869 6478 732c 2072  ) in zip(idxs, r
+0000bf00: 6f77 7329 3a0d 0a20 2020 2020 2020 2020  ows):..         
+0000bf10: 2020 2020 2020 2020 2020 2069 6620 6869             if hi
+0000bf20: 6768 203e 206c 6f77 3a0d 0a20 2020 2020  gh > low:..     
+0000bf30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bf40: 2020 2070 2e64 7261 774c 696e 6528 5174     p.drawLine(Qt
+0000bf50: 436f 7265 2e51 506f 696e 7446 2878 2c20  Core.QPointF(x, 
+0000bf60: 6c6f 7729 2c20 5174 436f 7265 2e51 506f  low), QtCore.QPo
+0000bf70: 696e 7446 2878 2c20 6869 6768 2929 0d0a  intF(x, high))..
+0000bf80: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+0000bf90: 656c 662e 6472 6177 5f62 6f64 793a 0d0a  elf.draw_body:..
+0000bfa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bfb0: 702e 7365 7450 656e 2870 672e 6d6b 5065  p.setPen(pg.mkPe
+0000bfc0: 6e28 6672 616d 6529 290d 0a20 2020 2020  n(frame))..     
+0000bfd0: 2020 2020 2020 2020 2020 2070 2e73 6574             p.set
+0000bfe0: 4272 7573 6828 7067 2e6d 6b42 7275 7368  Brush(pg.mkBrush
+0000bff0: 2862 6f64 7929 290d 0a20 2020 2020 2020  (body))..       
+0000c000: 2020 2020 2020 2020 2066 6f72 2078 2c28           for x,(
+0000c010: 742c 6f70 656e 2c63 6c6f 7365 2c68 6967  t,open,close,hig
+0000c020: 682c 6c6f 7729 2069 6e20 7a69 7028 6964  h,low) in zip(id
+0000c030: 7873 2c20 726f 7773 293a 0d0a 2020 2020  xs, rows):..    
+0000c040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c050: 702e 6472 6177 5265 6374 2851 7443 6f72  p.drawRect(QtCor
+0000c060: 652e 5152 6563 7446 2878 2d77 322c 206f  e.QRectF(x-w2, o
+0000c070: 7065 6e2c 2077 2c20 636c 6f73 652d 6f70  pen, w, close-op
+0000c080: 656e 2929 0d0a 0d0a 2020 2020 6465 6620  en))....    def 
+0000c090: 726f 7763 6f6c 6f72 7328 7365 6c66 2c20  rowcolors(self, 
+0000c0a0: 7072 6566 6978 293a 0d0a 2020 2020 2020  prefix):..      
+0000c0b0: 2020 7265 7475 726e 205b 7365 6c66 2e63    return [self.c
+0000c0c0: 6f6c 6f72 735b 7072 6566 6978 2b27 5f73  olors[prefix+'_s
+0000c0d0: 6861 646f 7727 5d2c 2073 656c 662e 636f  hadow'], self.co
+0000c0e0: 6c6f 7273 5b70 7265 6669 782b 275f 6672  lors[prefix+'_fr
+0000c0f0: 616d 6527 5d2c 2073 656c 662e 636f 6c6f  ame'], self.colo
+0000c100: 7273 5b70 7265 6669 782b 275f 626f 6479  rs[prefix+'_body
+0000c110: 275d 5d0d 0a0d 0a0d 0a0d 0a63 6c61 7373  ']]........class
+0000c120: 2048 6561 746d 6170 4974 656d 2846 696e   HeatmapItem(Fin
+0000c130: 506c 6f74 4974 656d 293a 0d0a 2020 2020  PlotItem):..    
+0000c140: 6465 6620 5f5f 696e 6974 5f5f 2873 656c  def __init__(sel
+0000c150: 662c 2061 782c 2064 6174 6173 7263 2c20  f, ax, datasrc, 
+0000c160: 7265 6374 5f73 697a 653d 302e 392c 2066  rect_size=0.9, f
+0000c170: 696c 7465 725f 6c69 6d69 743d 302c 2063  ilter_limit=0, c
+0000c180: 6f6c 6d61 703d 636f 6c6d 6170 5f63 6c61  olmap=colmap_cla
+0000c190: 7368 2c20 7768 6974 656f 7574 3d30 2e30  sh, whiteout=0.0
+0000c1a0: 2c20 636f 6c63 7572 7665 3d6c 616d 6264  , colcurve=lambd
+0000c1b0: 6120 783a 706f 7728 782c 3429 293a 0d0a  a x:pow(x,4)):..
+0000c1c0: 2020 2020 2020 2020 7365 6c66 2e72 6563          self.rec
+0000c1d0: 745f 7369 7a65 203d 2072 6563 745f 7369  t_size = rect_si
+0000c1e0: 7a65 0d0a 2020 2020 2020 2020 7365 6c66  ze..        self
+0000c1f0: 2e66 696c 7465 725f 6c69 6d69 7420 3d20  .filter_limit = 
+0000c200: 6669 6c74 6572 5f6c 696d 6974 0d0a 2020  filter_limit..  
+0000c210: 2020 2020 2020 7365 6c66 2e63 6f6c 6d61        self.colma
+0000c220: 7020 3d20 636f 6c6d 6170 0d0a 2020 2020  p = colmap..    
+0000c230: 2020 2020 7365 6c66 2e77 6869 7465 6f75      self.whiteou
+0000c240: 7420 3d20 7768 6974 656f 7574 0d0a 2020  t = whiteout..  
+0000c250: 2020 2020 2020 7365 6c66 2e63 6f6c 6375        self.colcu
+0000c260: 7276 6520 3d20 636f 6c63 7572 7665 0d0a  rve = colcurve..
+0000c270: 2020 2020 2020 2020 7365 6c66 2e63 6f6c          self.col
+0000c280: 5f64 6174 615f 656e 6420 3d20 6c65 6e28  _data_end = len(
+0000c290: 6461 7461 7372 632e 6466 2e63 6f6c 756d  datasrc.df.colum
+0000c2a0: 6e73 290d 0a20 2020 2020 2020 2073 7570  ns)..        sup
+0000c2b0: 6572 2829 2e5f 5f69 6e69 745f 5f28 6178  er().__init__(ax
+0000c2c0: 2c20 6461 7461 7372 632c 206c 6f64 3d46  , datasrc, lod=F
+0000c2d0: 616c 7365 290d 0a0d 0a20 2020 2064 6566  alse)....    def
+0000c2e0: 2067 656e 6572 6174 655f 7069 6374 7572   generate_pictur
+0000c2f0: 6528 7365 6c66 2c20 626f 756e 6469 6e67  e(self, bounding
+0000c300: 5265 6374 293a 0d0a 2020 2020 2020 2020  Rect):..        
+0000c310: 7072 6963 6573 203d 2073 656c 662e 6461  prices = self.da
+0000c320: 7461 7372 632e 6466 2e63 6f6c 756d 6e73  tasrc.df.columns
+0000c330: 5b73 656c 662e 6461 7461 7372 632e 636f  [self.datasrc.co
+0000c340: 6c5f 6461 7461 5f6f 6666 7365 743a 7365  l_data_offset:se
+0000c350: 6c66 2e63 6f6c 5f64 6174 615f 656e 645d  lf.col_data_end]
+0000c360: 0d0a 2020 2020 2020 2020 6830 203d 2028  ..        h0 = (
+0000c370: 7072 6963 6573 5b30 5d20 2d20 7072 6963  prices[0] - pric
+0000c380: 6573 5b31 5d29 202a 2028 312d 7365 6c66  es[1]) * (1-self
+0000c390: 2e72 6563 745f 7369 7a65 290d 0a20 2020  .rect_size)..   
+0000c3a0: 2020 2020 2068 3120 3d20 2870 7269 6365       h1 = (price
+0000c3b0: 735b 305d 202d 2070 7269 6365 735b 315d  s[0] - prices[1]
+0000c3c0: 2920 2a20 2831 2d28 312d 7365 6c66 2e72  ) * (1-(1-self.r
+0000c3d0: 6563 745f 7369 7a65 292a 3229 0d0a 2020  ect_size)*2)..  
+0000c3e0: 2020 2020 2020 7265 6374 5f73 697a 6532        rect_size2
+0000c3f0: 203d 2030 2e35 202a 2073 656c 662e 7265   = 0.5 * self.re
+0000c400: 6374 5f73 697a 650d 0a20 2020 2020 2020  ct_size..       
+0000c410: 2064 6620 3d20 7365 6c66 2e64 6174 6173   df = self.datas
+0000c420: 7263 2e64 662e 696c 6f63 5b3a 2c20 7365  rc.df.iloc[:, se
+0000c430: 6c66 2e64 6174 6173 7263 2e63 6f6c 5f64  lf.datasrc.col_d
+0000c440: 6174 615f 6f66 6673 6574 3a73 656c 662e  ata_offset:self.
+0000c450: 636f 6c5f 6461 7461 5f65 6e64 5d0d 0a20  col_data_end].. 
+0000c460: 2020 2020 2020 2076 616c 7565 7320 3d20         values = 
+0000c470: 6466 2e76 616c 7565 730d 0a20 2020 2020  df.values..     
+0000c480: 2020 2023 206e 6f72 6d61 6c69 7a65 0d0a     # normalize..
+0000c490: 2020 2020 2020 2020 7661 6c75 6573 202d          values -
+0000c4a0: 3d20 6e70 2e6e 616e 6d69 6e28 7661 6c75  = np.nanmin(valu
+0000c4b0: 6573 290d 0a20 2020 2020 2020 2076 616c  es)..        val
+0000c4c0: 7565 7320 3d20 7661 6c75 6573 202f 2028  ues = values / (
+0000c4d0: 6e70 2e6e 616e 6d61 7828 7661 6c75 6573  np.nanmax(values
+0000c4e0: 2920 2f20 2831 2b73 656c 662e 7768 6974  ) / (1+self.whit
+0000c4f0: 656f 7574 2929 2023 206f 7665 7273 686f  eout)) # oversho
+0000c500: 6f74 2066 6f72 2063 6f6c 6f72 696e 670d  ot for coloring.
+0000c510: 0a20 2020 2020 2020 206c 696d 203d 2073  .        lim = s
+0000c520: 656c 662e 6669 6c74 6572 5f6c 696d 6974  elf.filter_limit
+0000c530: 202a 2028 312b 7365 6c66 2e77 6869 7465   * (1+self.white
+0000c540: 6f75 7429 0d0a 2020 2020 2020 2020 7020  out)..        p 
+0000c550: 3d20 7365 6c66 2e70 6169 6e74 6572 0d0a  = self.painter..
+0000c560: 2020 2020 2020 2020 666f 7220 742c 726f          for t,ro
+0000c570: 7720 696e 2065 6e75 6d65 7261 7465 2876  w in enumerate(v
+0000c580: 616c 7565 7329 3a0d 0a20 2020 2020 2020  alues):..       
+0000c590: 2020 2020 2066 6f72 2063 692c 7072 6963       for ci,pric
+0000c5a0: 6520 696e 2065 6e75 6d65 7261 7465 2870  e in enumerate(p
+0000c5b0: 7269 6365 7329 3a0d 0a20 2020 2020 2020  rices):..       
+0000c5c0: 2020 2020 2020 2020 2076 203d 2072 6f77           v = row
+0000c5d0: 5b63 695d 0d0a 2020 2020 2020 2020 2020  [ci]..          
+0000c5e0: 2020 2020 2020 6966 2076 203e 3d20 6c69        if v >= li
+0000c5f0: 6d3a 0d0a 2020 2020 2020 2020 2020 2020  m:..            
+0000c600: 2020 2020 2020 2020 7620 3d20 3120 2d20          v = 1 - 
+0000c610: 7365 6c66 2e63 6f6c 6375 7276 6528 3120  self.colcurve(1 
+0000c620: 2d20 2876 2d6c 696d 292f 2831 2d6c 696d  - (v-lim)/(1-lim
+0000c630: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
+0000c640: 2020 2020 2020 2020 636f 6c6f 7220 3d20          color = 
+0000c650: 7365 6c66 2e63 6f6c 6d61 702e 6d61 7028  self.colmap.map(
+0000c660: 762c 206d 6f64 653d 2771 636f 6c6f 7227  v, mode='qcolor'
+0000c670: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+0000c680: 2020 2020 2020 2070 2e66 696c 6c52 6563         p.fillRec
+0000c690: 7428 5174 436f 7265 2e51 5265 6374 4628  t(QtCore.QRectF(
+0000c6a0: 742d 7265 6374 5f73 697a 6532 2c20 7365  t-rect_size2, se
+0000c6b0: 6c66 2e61 782e 7662 2e79 7363 616c 652e  lf.ax.vb.yscale.
+0000c6c0: 696e 7678 666f 726d 2870 7269 6365 2b68  invxform(price+h
+0000c6d0: 3029 2c20 7365 6c66 2e72 6563 745f 7369  0), self.rect_si
+0000c6e0: 7a65 2c20 7365 6c66 2e61 782e 7662 2e79  ze, self.ax.vb.y
+0000c6f0: 7363 616c 652e 696e 7678 666f 726d 2868  scale.invxform(h
+0000c700: 3129 292c 2063 6f6c 6f72 290d 0a0d 0a0d  1)), color).....
+0000c710: 0a0d 0a63 6c61 7373 2048 6f72 697a 6f6e  ...class Horizon
+0000c720: 7461 6c54 696d 6556 6f6c 756d 6549 7465  talTimeVolumeIte
+0000c730: 6d28 4361 6e64 6c65 7374 6963 6b49 7465  m(CandlestickIte
+0000c740: 6d29 3a0d 0a20 2020 2064 6566 205f 5f69  m):..    def __i
+0000c750: 6e69 745f 5f28 7365 6c66 2c20 6178 2c20  nit__(self, ax, 
+0000c760: 6461 7461 7372 632c 2063 616e 646c 655f  datasrc, candle_
+0000c770: 7769 6474 683d 302e 382c 2064 7261 775f  width=0.8, draw_
+0000c780: 7661 3d30 2e30 2c20 6472 6177 5f62 6f64  va=0.0, draw_bod
+0000c790: 793d 302e 342c 2064 7261 775f 706f 633d  y=0.4, draw_poc=
+0000c7a0: 302e 302c 2063 6f6c 6f72 6675 6e63 3d4e  0.0, colorfunc=N
+0000c7b0: 6f6e 6529 3a0d 0a20 2020 2020 2020 2027  one):..        '
+0000c7c0: 2727 4120 6e65 6761 7469 7665 2064 7261  ''A negative dra
+0000c7d0: 775f 626f 6479 2064 6f65 7320 6e6f 7420  w_body does not 
+0000c7e0: 6d65 616e 2074 6861 7420 7468 6520 6361  mean that the ca
+0000c7f0: 6e64 6c65 2069 7320 6472 6177 6e20 696e  ndle is drawn in
+0000c800: 2074 6865 206f 7070 6f73 6974 6520 6469   the opposite di
+0000c810: 7265 6374 696f 6e20 2875 7365 206e 6567  rection (use neg
+0000c820: 6174 6976 6520 766f 6c75 6d65 2066 6f72  ative volume for
+0000c830: 2074 6861 7429 2c0d 0a20 2020 2020 2020   that),..       
+0000c840: 2020 2020 6275 7420 696e 7374 6561 6420      but instead 
+0000c850: 7468 6174 2073 6372 6565 6e20 7363 616c  that screen scal
+0000c860: 6520 7769 6c6c 2062 6520 7573 6564 2069  e will be used i
+0000c870: 6e73 7465 6164 206f 6620 696e 7465 7276  nstead of interv
+0000c880: 616c 2d72 656c 6174 6976 6520 7363 616c  al-relative scal
+0000c890: 652e 2727 270d 0a20 2020 2020 2020 2073  e.'''..        s
+0000c8a0: 656c 662e 6472 6177 5f76 6120 3d20 6472  elf.draw_va = dr
+0000c8b0: 6177 5f76 610d 0a20 2020 2020 2020 2073  aw_va..        s
+0000c8c0: 656c 662e 6472 6177 5f70 6f63 203d 2064  elf.draw_poc = d
+0000c8d0: 7261 775f 706f 630d 0a20 2020 2020 2020  raw_poc..       
+0000c8e0: 2023 2320 7365 6c66 2e63 6f6c 5f64 6174   ## self.col_dat
+0000c8f0: 615f 656e 6420 3d20 6c65 6e28 6461 7461  a_end = len(data
+0000c900: 7372 632e 6466 2e63 6f6c 756d 6e73 290d  src.df.columns).
+0000c910: 0a20 2020 2020 2020 2063 6f6c 6f72 6675  .        colorfu
+0000c920: 6e63 203d 2063 6f6c 6f72 6675 6e63 206f  nc = colorfunc o
+0000c930: 7220 686f 7269 7a76 6f6c 5f63 6f6c 6f72  r horizvol_color
+0000c940: 6669 6c74 6572 2829 2023 2072 6573 6f6c  filter() # resol
+0000c950: 7665 2066 756e 6374 696f 6e20 6c6f 7765  ve function lowe
+0000c960: 7220 646f 776e 2069 6e20 736f 7572 6365  r down in source
+0000c970: 2063 6f64 650d 0a20 2020 2020 2020 2073   code..        s
+0000c980: 7570 6572 2829 2e5f 5f69 6e69 745f 5f28  uper().__init__(
+0000c990: 6178 2c20 6461 7461 7372 632c 2064 7261  ax, datasrc, dra
+0000c9a0: 775f 7368 6164 6f77 3d46 616c 7365 2c20  w_shadow=False, 
+0000c9b0: 6361 6e64 6c65 5f77 6964 7468 3d63 616e  candle_width=can
+0000c9c0: 646c 655f 7769 6474 682c 2064 7261 775f  dle_width, draw_
+0000c9d0: 626f 6479 3d64 7261 775f 626f 6479 2c20  body=draw_body, 
+0000c9e0: 636f 6c6f 7266 756e 633d 636f 6c6f 7266  colorfunc=colorf
+0000c9f0: 756e 6329 0d0a 2020 2020 2020 2020 7365  unc)..        se
+0000ca00: 6c66 2e6c 6f64 203d 2046 616c 7365 0d0a  lf.lod = False..
+0000ca10: 2020 2020 2020 2020 7365 6c66 2e63 6f6c          self.col
+0000ca20: 6f72 732e 7570 6461 7465 2864 6963 7428  ors.update(dict(
+0000ca30: 6e65 7574 7261 6c5f 7368 6164 6f77 2020  neutral_shadow  
+0000ca40: 3d20 766f 6c75 6d65 5f6e 6575 7472 616c  = volume_neutral
+0000ca50: 5f63 6f6c 6f72 2c0d 0a20 2020 2020 2020  _color,..       
+0000ca60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ca70: 2020 2020 2020 2020 206e 6575 7472 616c           neutral
+0000ca80: 5f66 7261 6d65 2020 203d 2076 6f6c 756d  _frame   = volum
+0000ca90: 655f 6e65 7574 7261 6c5f 636f 6c6f 722c  e_neutral_color,
+0000caa0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000cab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cac0: 2020 6e65 7574 7261 6c5f 626f 6479 2020    neutral_body  
+0000cad0: 2020 3d20 766f 6c75 6d65 5f6e 6575 7472    = volume_neutr
+0000cae0: 616c 5f63 6f6c 6f72 2c0d 0a20 2020 2020  al_color,..     
+0000caf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cb00: 2020 2020 2020 2020 2020 2062 756c 6c5f             bull_
+0000cb10: 626f 6479 2020 2020 2020 203d 2063 616e  body       = can
+0000cb20: 646c 655f 6275 6c6c 5f63 6f6c 6f72 2929  dle_bull_color))
+0000cb30: 0d0a 0d0a 2020 2020 6465 6620 6765 6e65  ....    def gene
+0000cb40: 7261 7465 5f70 6963 7475 7265 2873 656c  rate_picture(sel
+0000cb50: 662c 2062 6f75 6e64 696e 6752 6563 7429  f, boundingRect)
+0000cb60: 3a0d 0a20 2020 2020 2020 2074 696d 6573  :..        times
+0000cb70: 203d 2073 656c 662e 6461 7461 7372 632e   = self.datasrc.
+0000cb80: 6466 2e69 6c6f 635b 3a2c 2030 5d0d 0a20  df.iloc[:, 0].. 
+0000cb90: 2020 2020 2020 2076 616c 7320 3d20 7365         vals = se
+0000cba0: 6c66 2e64 6174 6173 7263 2e64 662e 7661  lf.datasrc.df.va
+0000cbb0: 6c75 6573 0d0a 2020 2020 2020 2020 7072  lues..        pr
+0000cbc0: 6963 6573 203d 2076 616c 735b 3a2c 2073  ices = vals[:, s
+0000cbd0: 656c 662e 6461 7461 7372 632e 636f 6c5f  elf.datasrc.col_
+0000cbe0: 6461 7461 5f6f 6666 7365 743a 3a32 5d0d  data_offset::2].
+0000cbf0: 0a20 2020 2020 2020 2076 6f6c 756d 6573  .        volumes
+0000cc00: 203d 2076 616c 735b 3a2c 2073 656c 662e   = vals[:, self.
+0000cc10: 6461 7461 7372 632e 636f 6c5f 6461 7461  datasrc.col_data
+0000cc20: 5f6f 6666 7365 742b 313a 3a32 5d2e 540d  _offset+1::2].T.
+0000cc30: 0a20 2020 2020 2020 2023 206e 6f72 6d61  .        # norma
+0000cc40: 6c69 7a65 0d0a 2020 2020 2020 2020 7472  lize..        tr
+0000cc50: 793a 0d0a 2020 2020 2020 2020 2020 2020  y:..            
+0000cc60: 6620 3d20 7365 6c66 2e64 6174 6173 7263  f = self.datasrc
+0000cc70: 2e70 6572 696f 645f 6e73 202f 205f 6765  .period_ns / _ge
+0000cc80: 745f 6461 7461 7372 6328 7365 6c66 2e61  t_datasrc(self.a
+0000cc90: 7829 2e70 6572 696f 645f 6e73 0d0a 2020  x).period_ns..  
+0000cca0: 2020 2020 2020 2020 2020 7469 6d65 7320            times 
+0000ccb0: 3d20 5f70 6474 696d 6532 696e 6465 7828  = _pdtime2index(
+0000ccc0: 7365 6c66 2e61 782c 2074 696d 6573 2c20  self.ax, times, 
+0000ccd0: 7265 7175 6972 655f 7469 6d65 3d54 7275  require_time=Tru
+0000cce0: 6529 0d0a 2020 2020 2020 2020 6578 6365  e)..        exce
+0000ccf0: 7074 2041 7373 6572 7469 6f6e 4572 726f  pt AssertionErro
+0000cd00: 723a 0d0a 2020 2020 2020 2020 2020 2020  r:..            
+0000cd10: 6620 3d20 310d 0a20 2020 2020 2020 2064  f = 1..        d
+0000cd20: 7261 775f 626f 6479 203d 2073 656c 662e  raw_body = self.
+0000cd30: 6472 6177 5f62 6f64 790d 0a20 2020 2020  draw_body..     
+0000cd40: 2020 2069 6620 6472 6177 5f62 6f64 7920     if draw_body 
+0000cd50: 3c20 303a 0d0a 2020 2020 2020 2020 2020  < 0:..          
+0000cd60: 2020 6620 2a3d 202d 6472 6177 5f62 6f64    f *= -draw_bod
+0000cd70: 7920 2a20 7365 6c66 2e61 782e 7662 2e74  y * self.ax.vb.t
+0000cd80: 6172 6765 7452 6563 7428 292e 7769 6474  argetRect().widt
+0000cd90: 6828 290d 0a20 2020 2020 2020 2020 2020  h()..           
+0000cda0: 2064 7261 775f 626f 6479 203d 2031 0d0a   draw_body = 1..
+0000cdb0: 2020 2020 2020 2020 6269 6e63 203d 206c          binc = l
+0000cdc0: 656e 2876 6f6c 756d 6573 290d 0a20 2020  en(volumes)..   
+0000cdd0: 2020 2020 2069 6620 6e6f 7420 6269 6e63       if not binc
+0000cde0: 3a0d 0a20 2020 2020 2020 2020 2020 2072  :..            r
+0000cdf0: 6574 7572 6e0d 0a20 2020 2020 2020 2064  eturn..        d
+0000ce00: 6976 766f 6c20 3d20 6e70 2e6e 616e 6d61  ivvol = np.nanma
+0000ce10: 7828 6e70 2e61 6273 2876 6f6c 756d 6573  x(np.abs(volumes
+0000ce20: 292c 2061 7869 733d 3029 0d0a 2020 2020  ), axis=0)..    
+0000ce30: 2020 2020 6469 7676 6f6c 5b64 6976 766f      divvol[divvo
+0000ce40: 6c3d 3d30 5d20 3d20 310d 0a20 2020 2020  l==0] = 1..     
+0000ce50: 2020 2076 6f6c 756d 6573 203d 2028 766f     volumes = (vo
+0000ce60: 6c75 6d65 7320 2a20 6620 2f20 6469 7676  lumes * f / divv
+0000ce70: 6f6c 292e 540d 0a20 2020 2020 2020 2070  ol).T..        p
+0000ce80: 203d 2073 656c 662e 7061 696e 7465 720d   = self.painter.
+0000ce90: 0a20 2020 2020 2020 2068 203d 2031 652d  .        h = 1e-
+0000cea0: 3130 0d0a 2020 2020 2020 2020 666f 7220  10..        for 
+0000ceb0: 6920 696e 2072 616e 6765 286c 656e 2870  i in range(len(p
+0000cec0: 7269 6365 7329 293a 0d0a 2020 2020 2020  rices)):..      
+0000ced0: 2020 2020 2020 7072 6372 203d 2070 7269        prcr = pri
+0000cee0: 6365 735b 695d 0d0a 2020 2020 2020 2020  ces[i]..        
+0000cef0: 2020 2020 7072 7620 3d20 7072 6372 5b7e      prv = prcr[~
+0000cf00: 6e70 2e69 736e 616e 2870 7263 7229 5d0d  np.isnan(prcr)].
+0000cf10: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0000cf20: 6c65 6e28 7072 7629 203e 2031 3a0d 0a20  len(prv) > 1:.. 
+0000cf30: 2020 2020 2020 2020 2020 2020 2020 2068                 h
+0000cf40: 203d 206e 702e 6469 6666 2870 7276 292e   = np.diff(prv).
+0000cf50: 6d69 6e28 290d 0a20 2020 2020 2020 2020  min()..         
+0000cf60: 2020 2074 203d 2074 696d 6573 5b69 5d0d     t = times[i].
+0000cf70: 0a20 2020 2020 2020 2020 2020 2076 6f6c  .            vol
+0000cf80: 7220 3d20 6e70 2e6e 616e 5f74 6f5f 6e75  r = np.nan_to_nu
+0000cf90: 6d28 766f 6c75 6d65 735b 695d 290d 0a0d  m(volumes[i])...
+0000cfa0: 0a20 2020 2020 2020 2020 2020 2023 2063  .            # c
+0000cfb0: 616c 6320 706f 630d 0a20 2020 2020 2020  alc poc..       
+0000cfc0: 2020 2020 2070 6f63 6964 7820 3d20 6e70       pocidx = np
+0000cfd0: 2e6e 616e 6172 676d 6178 2876 6f6c 7229  .nanargmax(volr)
+0000cfe0: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
+0000cff0: 2320 6472 6177 2076 616c 7565 2061 7265  # draw value are
+0000d000: 610d 0a20 2020 2020 2020 2020 2020 2069  a..            i
+0000d010: 6620 7365 6c66 2e64 7261 775f 7661 3a0d  f self.draw_va:.
+0000d020: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000d030: 2076 6f6c 7273 203d 2076 6f6c 7220 2f20   volrs = volr / 
+0000d040: 6e70 2e6e 616e 7375 6d28 766f 6c72 290d  np.nansum(volr).
+0000d050: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000d060: 2076 203d 2076 6f6c 7273 5b70 6f63 6964   v = volrs[pocid
+0000d070: 785d 0d0a 2020 2020 2020 2020 2020 2020  x]..            
+0000d080: 2020 2020 6120 3d20 6220 3d20 706f 6369      a = b = poci
+0000d090: 6478 0d0a 2020 2020 2020 2020 2020 2020  dx..            
+0000d0a0: 2020 2020 7768 696c 6520 613e 3d30 206f      while a>=0 o
+0000d0b0: 7220 623c 6269 6e63 3a0d 0a20 2020 2020  r b<binc:..     
+0000d0c0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0000d0d0: 6620 7620 3e3d 2073 656c 662e 6472 6177  f v >= self.draw
+0000d0e0: 5f76 613a 0d0a 2020 2020 2020 2020 2020  _va:..          
+0000d0f0: 2020 2020 2020 2020 2020 2020 2020 6272                br
+0000d100: 6561 6b0d 0a20 2020 2020 2020 2020 2020  eak..           
+0000d110: 2020 2020 2020 2020 2061 6120 3d20 6120           aa = a 
+0000d120: 2d20 310d 0a20 2020 2020 2020 2020 2020  - 1..           
+0000d130: 2020 2020 2020 2020 2062 6220 3d20 6220           bb = b 
+0000d140: 2b20 310d 0a20 2020 2020 2020 2020 2020  + 1..           
+0000d150: 2020 2020 2020 2020 2076 6120 3d20 766f           va = vo
+0000d160: 6c72 735b 6161 5d20 6966 2061 613e 3d30  lrs[aa] if aa>=0
+0000d170: 2065 6c73 6520 300d 0a20 2020 2020 2020   else 0..       
+0000d180: 2020 2020 2020 2020 2020 2020 2076 6220               vb 
+0000d190: 3d20 766f 6c72 735b 6262 5d20 6966 2062  = volrs[bb] if b
+0000d1a0: 623c 6269 6e63 2065 6c73 6520 300d 0a20  b<binc else 0.. 
+0000d1b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d1c0: 2020 2069 6620 7661 203e 3d20 7662 3a20     if va >= vb: 
+0000d1d0: 2320 4e4f 5445 2062 6f74 6820 3d3d 2069  # NOTE both == i
+0000d1e0: 7320 616c 736f 206f 6b0d 0a20 2020 2020  s also ok..     
+0000d1f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d200: 2020 2061 203d 206d 6178 2830 2c20 6161     a = max(0, aa
+0000d210: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+0000d220: 2020 2020 2020 2020 2020 2076 202b 3d20             v += 
+0000d230: 7661 0d0a 2020 2020 2020 2020 2020 2020  va..            
+0000d240: 2020 2020 2020 2020 6966 2076 6120 3c3d          if va <=
+0000d250: 2076 623a 2023 204e 4f54 4520 626f 7468   vb: # NOTE both
+0000d260: 203d 3d20 6973 2061 6c73 6f20 6f6b 0d0a   == is also ok..
+0000d270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d280: 2020 2020 2020 2020 6220 3d20 6d69 6e28          b = min(
+0000d290: 6269 6e63 2d31 2c20 6262 290d 0a20 2020  binc-1, bb)..   
+0000d2a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d2b0: 2020 2020 2076 202b 3d20 7662 0d0a 2020       v += vb..  
+0000d2c0: 2020 2020 2020 2020 2020 2020 2020 636f                co
+0000d2d0: 6c6f 7220 3d20 7067 2e6d 6b43 6f6c 6f72  lor = pg.mkColor
+0000d2e0: 2862 616e 645f 636f 6c6f 7229 0d0a 2020  (band_color)..  
+0000d2f0: 2020 2020 2020 2020 2020 2020 2020 702e                p.
+0000d300: 6669 6c6c 5265 6374 2851 7443 6f72 652e  fillRect(QtCore.
+0000d310: 5152 6563 7446 2874 2c20 7072 6372 5b61  QRectF(t, prcr[a
+0000d320: 5d2c 2066 2c20 7072 6372 5b62 5d2d 7072  ], f, prcr[b]-pr
+0000d330: 6372 5b61 5d2b 6829 2c20 636f 6c6f 7229  cr[a]+h), color)
+0000d340: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
+0000d350: 2320 6472 6177 2068 6f72 697a 6f6e 7461  # draw horizonta
+0000d360: 6c20 6261 7273 0d0a 2020 2020 2020 2020  l bars..        
+0000d370: 2020 2020 6966 2064 7261 775f 626f 6479      if draw_body
+0000d380: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+0000d390: 2020 2068 3020 3d20 6820 2a20 2831 2d73     h0 = h * (1-s
+0000d3a0: 656c 662e 6361 6e64 6c65 5f77 6964 7468  elf.candle_width
+0000d3b0: 292f 320d 0a20 2020 2020 2020 2020 2020  )/2..           
+0000d3c0: 2020 2020 2068 3120 3d20 6820 2a20 7365       h1 = h * se
+0000d3d0: 6c66 2e63 616e 646c 655f 7769 6474 680d  lf.candle_width.
+0000d3e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000d3f0: 2066 6f72 2073 6861 646f 772c 6672 616d   for shadow,fram
+0000d400: 652c 626f 6479 2c64 6174 6120 696e 2073  e,body,data in s
+0000d410: 656c 662e 636f 6c6f 7266 756e 6328 7365  elf.colorfunc(se
+0000d420: 6c66 2c20 7365 6c66 2e64 6174 6173 7263  lf, self.datasrc
+0000d430: 2c20 6e70 2e61 7272 6179 285b 7072 6372  , np.array([prcr
+0000d440: 2c20 766f 6c72 5d29 293a 0d0a 2020 2020  , volr])):..    
+0000d450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d460: 702e 7365 7450 656e 2870 672e 6d6b 5065  p.setPen(pg.mkPe
+0000d470: 6e28 6672 616d 6529 290d 0a20 2020 2020  n(frame))..     
+0000d480: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0000d490: 2e73 6574 4272 7573 6828 7067 2e6d 6b42  .setBrush(pg.mkB
+0000d4a0: 7275 7368 2862 6f64 7929 290d 0a20 2020  rush(body))..   
+0000d4b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d4c0: 2070 7263 725f 2c76 6f6c 725f 203d 2064   prcr_,volr_ = d
+0000d4d0: 6174 610d 0a20 2020 2020 2020 2020 2020  ata..           
+0000d4e0: 2020 2020 2020 2020 2066 6f72 2077 2c79           for w,y
+0000d4f0: 2069 6e20 7a69 7028 766f 6c72 5f2c 2070   in zip(volr_, p
+0000d500: 7263 725f 293a 0d0a 2020 2020 2020 2020  rcr_):..        
+0000d510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d520: 6966 2061 6273 2877 2920 3e20 3165 2d31  if abs(w) > 1e-1
+0000d530: 353a 0d0a 2020 2020 2020 2020 2020 2020  5:..            
+0000d540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d550: 702e 6472 6177 5265 6374 2851 7443 6f72  p.drawRect(QtCor
+0000d560: 652e 5152 6563 7446 2874 2c20 792b 6830  e.QRectF(t, y+h0
+0000d570: 2c20 772a 6472 6177 5f62 6f64 792c 2068  , w*draw_body, h
+0000d580: 3129 290d 0a0d 0a20 2020 2020 2020 2020  1))....         
+0000d590: 2020 2023 2064 7261 7720 706f 6320 6c69     # draw poc li
+0000d5a0: 6e65 0d0a 2020 2020 2020 2020 2020 2020  ne..            
+0000d5b0: 6966 2073 656c 662e 6472 6177 5f70 6f63  if self.draw_poc
+0000d5c0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+0000d5d0: 2020 2079 203d 2070 7263 725b 706f 6369     y = prcr[poci
+0000d5e0: 6478 5d20 2b20 6820 2f20 320d 0a20 2020  dx] + h / 2..   
+0000d5f0: 2020 2020 2020 2020 2020 2020 2070 2e73               p.s
+0000d600: 6574 5065 6e28 7067 2e6d 6b50 656e 2870  etPen(pg.mkPen(p
+0000d610: 6f63 5f63 6f6c 6f72 2929 0d0a 2020 2020  oc_color))..    
+0000d620: 2020 2020 2020 2020 2020 2020 702e 6472              p.dr
+0000d630: 6177 4c69 6e65 2851 7443 6f72 652e 5150  awLine(QtCore.QP
+0000d640: 6f69 6e74 4628 742c 2079 292c 2051 7443  ointF(t, y), QtC
+0000d650: 6f72 652e 5150 6f69 6e74 4628 742b 662a  ore.QPointF(t+f*
+0000d660: 7365 6c66 2e64 7261 775f 706f 632c 2079  self.draw_poc, y
+0000d670: 2929 0d0a 0d0a 0d0a 0d0a 636c 6173 7320  ))........class 
+0000d680: 5363 6174 7465 724c 6162 656c 4974 656d  ScatterLabelItem
+0000d690: 2846 696e 506c 6f74 4974 656d 293a 0d0a  (FinPlotItem):..
+0000d6a0: 2020 2020 6465 6620 5f5f 696e 6974 5f5f      def __init__
+0000d6b0: 2873 656c 662c 2061 782c 2064 6174 6173  (self, ax, datas
+0000d6c0: 7263 2c20 636f 6c6f 722c 2061 6e63 686f  rc, color, ancho
+0000d6d0: 7229 3a0d 0a20 2020 2020 2020 2073 656c  r):..        sel
+0000d6e0: 662e 636f 6c6f 7220 3d20 636f 6c6f 720d  f.color = color.
+0000d6f0: 0a20 2020 2020 2020 2073 656c 662e 7465  .        self.te
+0000d700: 7874 5f69 7465 6d73 203d 207b 7d0d 0a20  xt_items = {}.. 
+0000d710: 2020 2020 2020 2073 656c 662e 616e 6368         self.anch
+0000d720: 6f72 203d 2061 6e63 686f 720d 0a20 2020  or = anchor..   
+0000d730: 2020 2020 2073 656c 662e 7368 6f77 203d       self.show =
+0000d740: 2046 616c 7365 0d0a 2020 2020 2020 2020   False..        
+0000d750: 7375 7065 7228 292e 5f5f 696e 6974 5f5f  super().__init__
+0000d760: 2861 782c 2064 6174 6173 7263 2c20 6c6f  (ax, datasrc, lo
+0000d770: 643d 5472 7565 290d 0a0d 0a20 2020 2064  d=True)....    d
+0000d780: 6566 2067 656e 6572 6174 655f 7069 6374  ef generate_pict
+0000d790: 7572 6528 7365 6c66 2c20 626f 756e 6469  ure(self, boundi
+0000d7a0: 6e67 5f72 6563 7429 3a0d 0a20 2020 2020  ng_rect):..     
+0000d7b0: 2020 2072 6f77 7320 3d20 7365 6c66 2e67     rows = self.g
+0000d7c0: 6574 726f 7773 2862 6f75 6e64 696e 675f  etrows(bounding_
+0000d7d0: 7265 6374 290d 0a20 2020 2020 2020 2069  rect)..        i
+0000d7e0: 6620 6c65 6e28 726f 7773 2920 3e20 6c6f  f len(rows) > lo
+0000d7f0: 645f 6c61 6265 6c73 3a20 2320 646f 6e27  d_labels: # don'
+0000d800: 7420 6576 656e 2067 656e 6572 6174 6520  t even generate 
+0000d810: 7768 656e 2074 6865 7265 2773 2074 6f6f  when there's too
+0000d820: 206d 616e 7920 6f66 2074 6865 6d0d 0a20   many of them.. 
+0000d830: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0000d840: 636c 6561 725f 6974 656d 7328 6c69 7374  clear_items(list
+0000d850: 2873 656c 662e 7465 7874 5f69 7465 6d73  (self.text_items
+0000d860: 2e6b 6579 7328 2929 290d 0a20 2020 2020  .keys()))..     
+0000d870: 2020 2020 2020 2072 6574 7572 6e0d 0a20         return.. 
+0000d880: 2020 2020 2020 2064 726f 7073 203d 2073         drops = s
+0000d890: 6574 2873 656c 662e 7465 7874 5f69 7465  et(self.text_ite
+0000d8a0: 6d73 2e6b 6579 7328 2929 0d0a 2020 2020  ms.keys())..    
+0000d8b0: 2020 2020 6372 6561 7465 6420 3d20 300d      created = 0.
+0000d8c0: 0a20 2020 2020 2020 2066 6f72 2078 2c74  .        for x,t
+0000d8d0: 2c79 2c74 7874 2069 6e20 726f 7773 3a0d  ,y,txt in rows:.
+0000d8e0: 0a20 2020 2020 2020 2020 2020 2074 7874  .            txt
+0000d8f0: 203d 2073 7472 2874 7874 290d 0a20 2020   = str(txt)..   
+0000d900: 2020 2020 2020 2020 2069 7368 746d 6c20           ishtml 
+0000d910: 3d20 273c 2720 696e 2074 7874 2061 6e64  = '<' in txt and
+0000d920: 2027 3e27 2069 6e20 7478 740d 0a20 2020   '>' in txt..   
+0000d930: 2020 2020 2020 2020 206b 6579 203d 2027           key = '
+0000d940: 2573 3a25 2e38 6627 2025 2028 742c 2079  %s:%.8f' % (t, y
+0000d950: 290d 0a20 2020 2020 2020 2020 2020 2069  )..            i
+0000d960: 6620 6b65 7920 696e 2073 656c 662e 7465  f key in self.te
+0000d970: 7874 5f69 7465 6d73 3a0d 0a20 2020 2020  xt_items:..     
+0000d980: 2020 2020 2020 2020 2020 2069 7465 6d20             item 
+0000d990: 3d20 7365 6c66 2e74 6578 745f 6974 656d  = self.text_item
+0000d9a0: 735b 6b65 795d 0d0a 2020 2020 2020 2020  s[key]..        
+0000d9b0: 2020 2020 2020 2020 2869 7465 6d2e 7365          (item.se
+0000d9c0: 7448 746d 6c20 6966 2069 7368 746d 6c20  tHtml if ishtml 
+0000d9d0: 656c 7365 2069 7465 6d2e 7365 7454 6578  else item.setTex
+0000d9e0: 7429 2874 7874 290d 0a20 2020 2020 2020  t)(txt)..       
+0000d9f0: 2020 2020 2020 2020 2069 7465 6d2e 7365           item.se
+0000da00: 7450 6f73 2878 2c20 7929 0d0a 2020 2020  tPos(x, y)..    
+0000da10: 2020 2020 2020 2020 2020 2020 6472 6f70              drop
+0000da20: 732e 7265 6d6f 7665 286b 6579 290d 0a20  s.remove(key).. 
+0000da30: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+0000da40: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000da50: 2020 6b77 7320 3d20 7b27 6874 6d6c 273a    kws = {'html':
+0000da60: 7478 747d 2069 6620 6973 6874 6d6c 2065  txt} if ishtml e
+0000da70: 6c73 6520 7b27 7465 7874 273a 7478 747d  lse {'text':txt}
+0000da80: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000da90: 2020 7365 6c66 2e74 6578 745f 6974 656d    self.text_item
+0000daa0: 735b 6b65 795d 203d 2069 7465 6d20 3d20  s[key] = item = 
+0000dab0: 7067 2e54 6578 7449 7465 6d28 636f 6c6f  pg.TextItem(colo
+0000dac0: 723d 7365 6c66 2e63 6f6c 6f72 2c20 616e  r=self.color, an
+0000dad0: 6368 6f72 3d73 656c 662e 616e 6368 6f72  chor=self.anchor
+0000dae0: 2c20 2a2a 6b77 7329 0d0a 2020 2020 2020  , **kws)..      
+0000daf0: 2020 2020 2020 2020 2020 6974 656d 2e73            item.s
+0000db00: 6574 506f 7328 782c 2079 290d 0a20 2020  etPos(x, y)..   
+0000db10: 2020 2020 2020 2020 2020 2020 2069 7465               ite
+0000db20: 6d2e 7365 7450 6172 656e 7449 7465 6d28  m.setParentItem(
+0000db30: 7365 6c66 290d 0a20 2020 2020 2020 2020  self)..         
+0000db40: 2020 2020 2020 2063 7265 6174 6564 202b         created +
+0000db50: 3d20 310d 0a20 2020 2020 2020 2069 6620  = 1..        if 
+0000db60: 6372 6561 7465 6420 3e20 3020 6f72 2073  created > 0 or s
+0000db70: 656c 662e 6469 7274 793a 2023 206f 6e6c  elf.dirty: # onl
+0000db80: 7920 7265 6475 6365 2063 6163 6865 2069  y reduce cache i
+0000db90: 6620 7765 2776 6520 6164 6465 6420 736f  f we've added so
+0000dba0: 6d65 206e 6577 206f 7220 7570 6461 7465  me new or update
+0000dbb0: 640d 0a20 2020 2020 2020 2020 2020 2073  d..            s
+0000dbc0: 656c 662e 636c 6561 725f 6974 656d 7328  elf.clear_items(
+0000dbd0: 6472 6f70 7329 0d0a 0d0a 2020 2020 6465  drops)....    de
+0000dbe0: 6620 636c 6561 725f 6974 656d 7328 7365  f clear_items(se
+0000dbf0: 6c66 2c20 6472 6f70 5f6b 6579 7329 3a0d  lf, drop_keys):.
+0000dc00: 0a20 2020 2020 2020 2066 6f72 206b 6579  .        for key
+0000dc10: 2069 6e20 6472 6f70 5f6b 6579 733a 0d0a   in drop_keys:..
+0000dc20: 2020 2020 2020 2020 2020 2020 6974 656d              item
+0000dc30: 203d 2073 656c 662e 7465 7874 5f69 7465   = self.text_ite
+0000dc40: 6d73 5b6b 6579 5d0d 0a20 2020 2020 2020  ms[key]..       
+0000dc50: 2020 2020 2069 7465 6d2e 7363 656e 6528       item.scene(
+0000dc60: 292e 7265 6d6f 7665 4974 656d 2869 7465  ).removeItem(ite
+0000dc70: 6d29 0d0a 2020 2020 2020 2020 2020 2020  m)..            
+0000dc80: 6465 6c20 7365 6c66 2e74 6578 745f 6974  del self.text_it
+0000dc90: 656d 735b 6b65 795d 0d0a 0d0a 2020 2020  ems[key]....    
+0000dca0: 6465 6620 6765 7472 6f77 7328 7365 6c66  def getrows(self
+0000dcb0: 2c20 626f 756e 6469 6e67 5f72 6563 7429  , bounding_rect)
+0000dcc0: 3a0d 0a20 2020 2020 2020 206c 6566 742c  :..        left,
+0000dcd0: 7269 6768 7420 3d20 626f 756e 6469 6e67  right = bounding
+0000dce0: 5f72 6563 742e 6c65 6674 2829 2c20 626f  _rect.left(), bo
+0000dcf0: 756e 6469 6e67 5f72 6563 742e 7269 6768  unding_rect.righ
+0000dd00: 7428 290d 0a20 2020 2020 2020 2064 662c  t()..        df,
+0000dd10: 5f20 3d20 7365 6c66 2e64 6174 6173 7263  _ = self.datasrc
+0000dd20: 2e72 6f77 7328 332c 206c 6566 742c 2072  .rows(3, left, r
+0000dd30: 6967 6874 2c20 7973 6361 6c65 3d73 656c  ight, yscale=sel
+0000dd40: 662e 6178 2e76 622e 7973 6361 6c65 2c20  f.ax.vb.yscale, 
+0000dd50: 6c6f 643d 4661 6c73 6529 0d0a 2020 2020  lod=False)..    
+0000dd60: 2020 2020 726f 7773 203d 2064 662e 6472      rows = df.dr
+0000dd70: 6f70 6e61 2829 0d0a 2020 2020 2020 2020  opna()..        
+0000dd80: 6964 7873 203d 2072 6f77 732e 696e 6465  idxs = rows.inde
+0000dd90: 780d 0a20 2020 2020 2020 2072 6f77 7320  x..        rows 
+0000dda0: 3d20 726f 7773 2e76 616c 7565 730d 0a20  = rows.values.. 
+0000ddb0: 2020 2020 2020 2072 6f77 7320 3d20 5b28         rows = [(
+0000ddc0: 692c 742c 792c 7478 7429 2066 6f72 2069  i,t,y,txt) for i
+0000ddd0: 2c28 742c 792c 7478 7429 2069 6e20 7a69  ,(t,y,txt) in zi
+0000dde0: 7028 6964 7873 2c20 726f 7773 2920 6966  p(idxs, rows) if
+0000ddf0: 2074 7874 5d0d 0a20 2020 2020 2020 2072   txt]..        r
+0000de00: 6574 7572 6e20 726f 7773 0d0a 0d0a 2020  eturn rows....  
+0000de10: 2020 6465 6620 626f 756e 6469 6e67 5265    def boundingRe
+0000de20: 6374 2873 656c 6629 3a0d 0a20 2020 2020  ct(self):..     
+0000de30: 2020 2072 6574 7572 6e20 7365 6c66 2e76     return self.v
+0000de40: 6965 7752 6563 7428 290d 0a0d 0a0d 0a64  iewRect()......d
+0000de50: 6566 2063 7265 6174 655f 706c 6f74 2874  ef create_plot(t
+0000de60: 6974 6c65 3d27 4669 6e61 6e63 6520 506c  itle='Finance Pl
+0000de70: 6f74 272c 2072 6f77 733d 312c 2069 6e69  ot', rows=1, ini
+0000de80: 745f 7a6f 6f6d 5f70 6572 696f 6473 3d31  t_zoom_periods=1
+0000de90: 6531 302c 206d 6178 696d 697a 653d 5472  e10, maximize=Tr
+0000dea0: 7565 2c20 7973 6361 6c65 3d27 6c69 6e65  ue, yscale='line
+0000deb0: 6172 2729 3a0d 0a20 2020 2070 672e 7365  ar'):..    pg.se
+0000dec0: 7443 6f6e 6669 674f 7074 696f 6e73 2866  tConfigOptions(f
+0000ded0: 6f72 6567 726f 756e 643d 666f 7265 6772  oreground=foregr
+0000dee0: 6f75 6e64 2c20 6261 636b 6772 6f75 6e64  ound, background
+0000def0: 3d62 6163 6b67 726f 756e 6429 0d0a 2020  =background)..  
+0000df00: 2020 7769 6e20 3d20 4669 6e57 696e 646f    win = FinWindo
+0000df10: 7728 7469 746c 6529 0d0a 2020 2020 2320  w(title)..    # 
+0000df20: 6e6f 726d 616c 6c79 2066 6972 7374 2067  normally first g
+0000df30: 7261 7068 2069 7320 6f66 2068 6967 6865  raph is of highe
+0000df40: 7220 7369 676e 6966 6963 616e 6365 2c20  r significance, 
+0000df50: 736f 2065 6e6c 6172 6765 0d0a 2020 2020  so enlarge..    
+0000df60: 7769 6e2e 6369 2e6c 6179 6f75 742e 7365  win.ci.layout.se
+0000df70: 7452 6f77 5374 7265 7463 6846 6163 746f  tRowStretchFacto
+0000df80: 7228 302c 2074 6f70 5f67 7261 7068 5f73  r(0, top_graph_s
+0000df90: 6361 6c65 290d 0a20 2020 2077 696e 2e73  cale)..    win.s
+0000dfa0: 686f 775f 6d61 7869 6d69 7a65 6420 3d20  how_maximized = 
+0000dfb0: 6d61 7869 6d69 7a65 0d0a 2020 2020 6178  maximize..    ax
+0000dfc0: 3020 3d20 6178 7320 3d20 6372 6561 7465  0 = axs = create
+0000dfd0: 5f70 6c6f 745f 7769 6467 6574 286d 6173  _plot_widget(mas
+0000dfe0: 7465 723d 7769 6e2c 2072 6f77 733d 726f  ter=win, rows=ro
+0000dff0: 7773 2c20 696e 6974 5f7a 6f6f 6d5f 7065  ws, init_zoom_pe
+0000e000: 7269 6f64 733d 696e 6974 5f7a 6f6f 6d5f  riods=init_zoom_
+0000e010: 7065 7269 6f64 732c 2079 7363 616c 653d  periods, yscale=
+0000e020: 7973 6361 6c65 290d 0a20 2020 2061 7873  yscale)..    axs
+0000e030: 203d 2061 7873 2069 6620 7479 7065 2861   = axs if type(a
+0000e040: 7873 2920 696e 2028 7475 706c 652c 6c69  xs) in (tuple,li
+0000e050: 7374 2920 656c 7365 205b 6178 735d 0d0a  st) else [axs]..
+0000e060: 2020 2020 666f 7220 6178 2069 6e20 6178      for ax in ax
+0000e070: 733a 0d0a 2020 2020 2020 2020 7769 6e2e  s:..        win.
+0000e080: 6164 6449 7465 6d28 6178 2c20 636f 6c3d  addItem(ax, col=
+0000e090: 3129 0d0a 2020 2020 2020 2020 7769 6e2e  1)..        win.
+0000e0a0: 6e65 7874 526f 7728 290d 0a20 2020 2072  nextRow()..    r
+0000e0b0: 6574 7572 6e20 6178 300d 0a0d 0a0d 0a64  eturn ax0......d
+0000e0c0: 6566 2063 7265 6174 655f 706c 6f74 5f77  ef create_plot_w
+0000e0d0: 6964 6765 7428 6d61 7374 6572 2c20 726f  idget(master, ro
+0000e0e0: 7773 3d31 2c20 696e 6974 5f7a 6f6f 6d5f  ws=1, init_zoom_
+0000e0f0: 7065 7269 6f64 733d 3165 3130 2c20 7973  periods=1e10, ys
+0000e100: 6361 6c65 3d27 6c69 6e65 6172 2729 3a0d  cale='linear'):.
+0000e110: 0a20 2020 2070 672e 7365 7443 6f6e 6669  .    pg.setConfi
+0000e120: 674f 7074 696f 6e73 2866 6f72 6567 726f  gOptions(foregro
+0000e130: 756e 643d 666f 7265 6772 6f75 6e64 2c20  und=foreground, 
+0000e140: 6261 636b 6772 6f75 6e64 3d62 6163 6b67  background=backg
+0000e150: 726f 756e 6429 0d0a 2020 2020 676c 6f62  round)..    glob
+0000e160: 616c 206c 6173 745f 6178 0d0a 2020 2020  al last_ax..    
+0000e170: 6966 206d 6173 7465 7220 6e6f 7420 696e  if master not in
+0000e180: 2077 696e 646f 7773 3a0d 0a20 2020 2020   windows:..     
+0000e190: 2020 2077 696e 646f 7773 2e61 7070 656e     windows.appen
+0000e1a0: 6428 6d61 7374 6572 290d 0a20 2020 2061  d(master)..    a
+0000e1b0: 7873 203d 205b 5d0d 0a20 2020 2070 7265  xs = []..    pre
+0000e1c0: 765f 6178 203d 204e 6f6e 650d 0a20 2020  v_ax = None..   
+0000e1d0: 2066 6f72 206e 2069 6e20 7261 6e67 6528   for n in range(
+0000e1e0: 726f 7773 293a 0d0a 2020 2020 2020 2020  rows):..        
+0000e1f0: 7973 6320 3d20 7973 6361 6c65 5b6e 5d20  ysc = yscale[n] 
+0000e200: 6966 2074 7970 6528 7973 6361 6c65 2920  if type(yscale) 
+0000e210: 696e 2028 6c69 7374 2c74 7570 6c65 2920  in (list,tuple) 
+0000e220: 656c 7365 2079 7363 616c 650d 0a20 2020  else yscale..   
+0000e230: 2020 2020 2079 7363 203d 2059 5363 616c       ysc = YScal
+0000e240: 6528 7973 632c 2031 290d 0a20 2020 2020  e(ysc, 1)..     
+0000e250: 2020 2076 6965 7762 6f78 203d 2046 696e     viewbox = Fin
+0000e260: 5669 6577 426f 7828 6d61 7374 6572 2c20  ViewBox(master, 
+0000e270: 696e 6974 5f73 7465 7073 3d69 6e69 745f  init_steps=init_
+0000e280: 7a6f 6f6d 5f70 6572 696f 6473 2c20 7973  zoom_periods, ys
+0000e290: 6361 6c65 3d79 7363 2c20 765f 7a6f 6f6d  cale=ysc, v_zoom
+0000e2a0: 5f73 6361 6c65 3d31 2d79 5f70 6164 2c20  _scale=1-y_pad, 
+0000e2b0: 656e 6162 6c65 4d65 6e75 3d46 616c 7365  enableMenu=False
+0000e2c0: 290d 0a20 2020 2020 2020 2061 7820 3d20  )..        ax = 
+0000e2d0: 7072 6576 5f61 7820 3d20 5f61 6464 5f74  prev_ax = _add_t
+0000e2e0: 696d 6573 7461 6d70 5f70 6c6f 7428 6d61  imestamp_plot(ma
+0000e2f0: 7374 6572 3d6d 6173 7465 722c 2070 7265  ster=master, pre
+0000e300: 765f 6178 3d70 7265 765f 6178 2c20 7669  v_ax=prev_ax, vi
+0000e310: 6577 626f 783d 7669 6577 626f 782c 2069  ewbox=viewbox, i
+0000e320: 6e64 6578 3d6e 2c20 7973 6361 6c65 3d79  ndex=n, yscale=y
+0000e330: 7363 290d 0a20 2020 2020 2020 2069 6620  sc)..        if 
+0000e340: 6178 733a 0d0a 2020 2020 2020 2020 2020  axs:..          
+0000e350: 2020 6178 2e73 6574 584c 696e 6b28 6178    ax.setXLink(ax
+0000e360: 735b 305d 2e76 6229 0d0a 2020 2020 2020  s[0].vb)..      
+0000e370: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
+0000e380: 2020 2020 2076 6965 7762 6f78 2e73 6574       viewbox.set
+0000e390: 466f 6375 7328 290d 0a20 2020 2020 2020  Focus()..       
+0000e3a0: 2061 7873 202b 3d20 5b61 785d 0d0a 2020   axs += [ax]..  
+0000e3b0: 2020 6966 206d 6173 7465 7220 6e6f 7420    if master not 
+0000e3c0: 696e 206d 6173 7465 725f 6461 7461 3a0d  in master_data:.
+0000e3d0: 0a20 2020 2020 2020 206d 6173 7465 725f  .        master_
+0000e3e0: 6461 7461 5b6d 6173 7465 725d 203d 207b  data[master] = {
+0000e3f0: 7d0d 0a20 2020 2069 6620 6973 696e 7374  }..    if isinst
+0000e400: 616e 6365 286d 6173 7465 722c 2070 672e  ance(master, pg.
+0000e410: 4772 6170 6869 6373 4c61 796f 7574 5769  GraphicsLayoutWi
+0000e420: 6467 6574 293a 0d0a 2020 2020 2020 2020  dget):..        
+0000e430: 7072 6f78 7920 3d20 7067 2e53 6967 6e61  proxy = pg.Signa
+0000e440: 6c50 726f 7879 286d 6173 7465 722e 7363  lProxy(master.sc
+0000e450: 656e 6528 292e 7369 674d 6f75 7365 4d6f  ene().sigMouseMo
+0000e460: 7665 642c 2072 6174 654c 696d 6974 3d31  ved, rateLimit=1
+0000e470: 3434 2c20 736c 6f74 3d70 6172 7469 616c  44, slot=partial
+0000e480: 285f 6d6f 7573 655f 6d6f 7665 642c 206d  (_mouse_moved, m
+0000e490: 6173 7465 722c 2061 7873 5b30 5d2e 7662  aster, axs[0].vb
+0000e4a0: 2929 0d0a 2020 2020 2020 2020 6d61 7374  ))..        mast
+0000e4b0: 6572 5f64 6174 615b 6d61 7374 6572 5d5b  er_data[master][
+0000e4c0: 6178 735b 305d 2e76 625d 203d 2064 6963  axs[0].vb] = dic
+0000e4d0: 7428 7072 6f78 796d 6d3d 7072 6f78 792c  t(proxymm=proxy,
+0000e4e0: 206c 6173 745f 6d6f 7573 655f 6576 733d   last_mouse_evs=
+0000e4f0: 4e6f 6e65 2c20 6c61 7374 5f6d 6f75 7365  None, last_mouse
+0000e500: 5f79 3d30 290d 0a20 2020 2020 2020 2069  _y=0)..        i
+0000e510: 6620 2764 6566 6175 6c74 2720 6e6f 7420  f 'default' not 
+0000e520: 696e 206d 6173 7465 725f 6461 7461 5b6d  in master_data[m
+0000e530: 6173 7465 725d 3a0d 0a20 2020 2020 2020  aster]:..       
+0000e540: 2020 2020 206d 6173 7465 725f 6461 7461       master_data
+0000e550: 5b6d 6173 7465 725d 5b27 6465 6661 756c  [master]['defaul
+0000e560: 7427 5d20 3d20 6d61 7374 6572 5f64 6174  t'] = master_dat
+0000e570: 615b 6d61 7374 6572 5d5b 6178 735b 305d  a[master][axs[0]
+0000e580: 2e76 625d 0d0a 2020 2020 656c 7365 3a0d  .vb]..    else:.
+0000e590: 0a20 2020 2020 2020 2066 6f72 2061 7820  .        for ax 
+0000e5a0: 696e 2061 7873 3a0d 0a20 2020 2020 2020  in axs:..       
+0000e5b0: 2020 2020 2070 726f 7879 203d 2070 672e       proxy = pg.
+0000e5c0: 5369 676e 616c 5072 6f78 7928 6178 2e61  SignalProxy(ax.a
+0000e5d0: 785f 7769 6467 6574 2e73 6365 6e65 2829  x_widget.scene()
+0000e5e0: 2e73 6967 4d6f 7573 654d 6f76 6564 2c20  .sigMouseMoved, 
+0000e5f0: 7261 7465 4c69 6d69 743d 3134 342c 2073  rateLimit=144, s
+0000e600: 6c6f 743d 7061 7274 6961 6c28 5f6d 6f75  lot=partial(_mou
+0000e610: 7365 5f6d 6f76 6564 2c20 6d61 7374 6572  se_moved, master
+0000e620: 2c20 6178 2e76 6229 290d 0a20 2020 2020  , ax.vb))..     
+0000e630: 2020 2020 2020 206d 6173 7465 725f 6461         master_da
+0000e640: 7461 5b6d 6173 7465 725d 5b61 782e 7662  ta[master][ax.vb
+0000e650: 5d20 3d20 6469 6374 2870 726f 7879 6d6d  ] = dict(proxymm
+0000e660: 3d70 726f 7879 2c20 6c61 7374 5f6d 6f75  =proxy, last_mou
+0000e670: 7365 5f65 7673 3d4e 6f6e 652c 206c 6173  se_evs=None, las
+0000e680: 745f 6d6f 7573 655f 793d 3029 0d0a 2020  t_mouse_y=0)..  
+0000e690: 2020 6c61 7374 5f61 7820 3d20 6178 735b    last_ax = axs[
+0000e6a0: 305d 0d0a 2020 2020 7265 7475 726e 2061  0]..    return a
+0000e6b0: 7873 5b30 5d20 6966 206c 656e 2861 7873  xs[0] if len(axs
+0000e6c0: 2920 3d3d 2031 2065 6c73 6520 6178 730d  ) == 1 else axs.
+0000e6d0: 0a0d 0a0d 0a64 6566 2063 6c6f 7365 2829  .....def close()
+0000e6e0: 3a0d 0a20 2020 2066 6f72 2077 696e 2069  :..    for win i
+0000e6f0: 6e20 7769 6e64 6f77 733a 0d0a 2020 2020  n windows:..    
+0000e700: 2020 2020 7472 793a 0d0a 2020 2020 2020      try:..      
+0000e710: 2020 2020 2020 7769 6e2e 636c 6f73 6528        win.close(
+0000e720: 290d 0a20 2020 2020 2020 2065 7863 6570  )..        excep
+0000e730: 7420 4578 6365 7074 696f 6e20 6173 2065  t Exception as e
+0000e740: 3a0d 0a20 2020 2020 2020 2020 2020 2070  :..            p
+0000e750: 7269 6e74 2827 5769 6e64 6f77 2063 6c6f  rint('Window clo
+0000e760: 7369 6e67 2065 7272 6f72 3a27 2c20 7479  sing error:', ty
+0000e770: 7065 2865 292c 2065 290d 0a20 2020 2067  pe(e), e)..    g
+0000e780: 6c6f 6261 6c20 6c61 7374 5f61 780d 0a20  lobal last_ax.. 
+0000e790: 2020 2077 696e 646f 7773 2e63 6c65 6172     windows.clear
+0000e7a0: 2829 0d0a 2020 2020 6f76 6572 6c61 795f  ()..    overlay_
+0000e7b0: 6178 732e 636c 6561 7228 290d 0a20 2020  axs.clear()..   
+0000e7c0: 205f 636c 6561 725f 7469 6d65 7273 2829   _clear_timers()
+0000e7d0: 0d0a 2020 2020 736f 756e 6473 2e63 6c65  ..    sounds.cle
+0000e7e0: 6172 2829 0d0a 2020 2020 6d61 7374 6572  ar()..    master
+0000e7f0: 5f64 6174 612e 636c 6561 7228 290d 0a20  _data.clear().. 
+0000e800: 2020 206c 6173 745f 6178 203d 204e 6f6e     last_ax = Non
+0000e810: 650d 0a0d 0a0d 0a64 6566 2070 7269 6365  e......def price
+0000e820: 5f63 6f6c 6f72 6669 6c74 6572 2869 7465  _colorfilter(ite
+0000e830: 6d2c 2064 6174 6173 7263 2c20 6466 293a  m, datasrc, df):
+0000e840: 0d0a 2020 2020 6f70 656e 636f 6c20 3d20  ..    opencol = 
+0000e850: 6466 2e63 6f6c 756d 6e73 5b31 5d0d 0a20  df.columns[1].. 
+0000e860: 2020 2063 6c6f 7365 636f 6c20 3d20 6466     closecol = df
+0000e870: 2e63 6f6c 756d 6e73 5b32 5d0d 0a20 2020  .columns[2]..   
+0000e880: 2069 735f 7570 203d 2064 665b 6f70 656e   is_up = df[open
+0000e890: 636f 6c5d 203c 3d20 6466 5b63 6c6f 7365  col] <= df[close
+0000e8a0: 636f 6c5d 2023 206f 7065 6e20 6c6f 7765  col] # open lowe
+0000e8b0: 7220 7468 616e 2063 6c6f 7365 203d 2067  r than close = g
+0000e8c0: 6f65 7320 7570 0d0a 2020 2020 7969 656c  oes up..    yiel
+0000e8d0: 6420 6974 656d 2e72 6f77 636f 6c6f 7273  d item.rowcolors
+0000e8e0: 2827 6275 6c6c 2729 202b 205b 6466 2e6c  ('bull') + [df.l
+0000e8f0: 6f63 5b69 735f 7570 2c20 3a5d 5d0d 0a20  oc[is_up, :]].. 
+0000e900: 2020 2079 6965 6c64 2069 7465 6d2e 726f     yield item.ro
+0000e910: 7763 6f6c 6f72 7328 2762 6561 7227 2920  wcolors('bear') 
+0000e920: 2b20 5b64 662e 6c6f 635b 7e69 735f 7570  + [df.loc[~is_up
+0000e930: 2c20 3a5d 5d0d 0a0d 0a0d 0a64 6566 2076  , :]]......def v
+0000e940: 6f6c 756d 655f 636f 6c6f 7266 696c 7465  olume_colorfilte
+0000e950: 7228 6974 656d 2c20 6461 7461 7372 632c  r(item, datasrc,
+0000e960: 2064 6629 3a0d 0a20 2020 206f 7065 6e63   df):..    openc
+0000e970: 6f6c 203d 2064 662e 636f 6c75 6d6e 735b  ol = df.columns[
+0000e980: 335d 0d0a 2020 2020 636c 6f73 6563 6f6c  3]..    closecol
+0000e990: 203d 2064 662e 636f 6c75 6d6e 735b 345d   = df.columns[4]
+0000e9a0: 0d0a 2020 2020 6973 5f75 7020 3d20 6466  ..    is_up = df
+0000e9b0: 5b6f 7065 6e63 6f6c 5d20 3c3d 2064 665b  [opencol] <= df[
+0000e9c0: 636c 6f73 6563 6f6c 5d20 2320 6f70 656e  closecol] # open
+0000e9d0: 206c 6f77 6572 2074 6861 6e20 636c 6f73   lower than clos
+0000e9e0: 6520 3d20 676f 6573 2075 700d 0a20 2020  e = goes up..   
+0000e9f0: 2079 6965 6c64 2069 7465 6d2e 726f 7763   yield item.rowc
+0000ea00: 6f6c 6f72 7328 2762 756c 6c27 2920 2b20  olors('bull') + 
+0000ea10: 5b64 662e 6c6f 635b 6973 5f75 702c 203a  [df.loc[is_up, :
+0000ea20: 5d5d 0d0a 2020 2020 7969 656c 6420 6974  ]]..    yield it
+0000ea30: 656d 2e72 6f77 636f 6c6f 7273 2827 6265  em.rowcolors('be
+0000ea40: 6172 2729 202b 205b 6466 2e6c 6f63 5b7e  ar') + [df.loc[~
+0000ea50: 6973 5f75 702c 203a 5d5d 0d0a 0d0a 0d0a  is_up, :]]......
+0000ea60: 6465 6620 7374 7265 6e67 7468 5f63 6f6c  def strength_col
+0000ea70: 6f72 6669 6c74 6572 2869 7465 6d2c 2064  orfilter(item, d
+0000ea80: 6174 6173 7263 2c20 6466 293a 0d0a 2020  atasrc, df):..  
+0000ea90: 2020 6f70 656e 636f 6c20 3d20 6466 2e63    opencol = df.c
+0000eaa0: 6f6c 756d 6e73 5b31 5d0d 0a20 2020 2063  olumns[1]..    c
+0000eab0: 6c6f 7365 636f 6c20 3d20 6466 2e63 6f6c  losecol = df.col
+0000eac0: 756d 6e73 5b32 5d0d 0a20 2020 2073 7461  umns[2]..    sta
+0000ead0: 7274 636f 6c20 3d20 6466 2e63 6f6c 756d  rtcol = df.colum
+0000eae0: 6e73 5b33 5d0d 0a20 2020 2065 6e64 636f  ns[3]..    endco
+0000eaf0: 6c20 3d20 6466 2e63 6f6c 756d 6e73 5b34  l = df.columns[4
+0000eb00: 5d0d 0a20 2020 2069 735f 7570 203d 2064  ]..    is_up = d
+0000eb10: 665b 6f70 656e 636f 6c5d 203c 3d20 6466  f[opencol] <= df
+0000eb20: 5b63 6c6f 7365 636f 6c5d 2023 206f 7065  [closecol] # ope
+0000eb30: 6e20 6c6f 7765 7220 7468 616e 2063 6c6f  n lower than clo
+0000eb40: 7365 203d 2067 6f65 7320 7570 0d0a 2020  se = goes up..  
+0000eb50: 2020 6973 5f73 7472 6f6e 6720 3d20 6466    is_strong = df
+0000eb60: 5b73 7461 7274 636f 6c5d 203c 3d20 6466  [startcol] <= df
+0000eb70: 5b65 6e64 636f 6c5d 0d0a 2020 2020 7969  [endcol]..    yi
+0000eb80: 656c 6420 6974 656d 2e72 6f77 636f 6c6f  eld item.rowcolo
+0000eb90: 7273 2827 6275 6c6c 2729 202b 205b 6466  rs('bull') + [df
+0000eba0: 2e6c 6f63 5b69 735f 7570 2669 735f 7374  .loc[is_up&is_st
+0000ebb0: 726f 6e67 2c20 3a5d 5d0d 0a20 2020 2079  rong, :]]..    y
+0000ebc0: 6965 6c64 2069 7465 6d2e 726f 7763 6f6c  ield item.rowcol
+0000ebd0: 6f72 7328 2777 6561 6b5f 6275 6c6c 2729  ors('weak_bull')
+0000ebe0: 202b 205b 6466 2e6c 6f63 5b69 735f 7570   + [df.loc[is_up
+0000ebf0: 2628 7e69 735f 7374 726f 6e67 292c 203a  &(~is_strong), :
+0000ec00: 5d5d 0d0a 2020 2020 7969 656c 6420 6974  ]]..    yield it
+0000ec10: 656d 2e72 6f77 636f 6c6f 7273 2827 7765  em.rowcolors('we
+0000ec20: 616b 5f62 6561 7227 2920 2b20 5b64 662e  ak_bear') + [df.
+0000ec30: 6c6f 635b 287e 6973 5f75 7029 2669 735f  loc[(~is_up)&is_
+0000ec40: 7374 726f 6e67 2c20 3a5d 5d0d 0a20 2020  strong, :]]..   
+0000ec50: 2079 6965 6c64 2069 7465 6d2e 726f 7763   yield item.rowc
+0000ec60: 6f6c 6f72 7328 2762 6561 7227 2920 2b20  olors('bear') + 
+0000ec70: 5b64 662e 6c6f 635b 287e 6973 5f75 7029  [df.loc[(~is_up)
+0000ec80: 2628 7e69 735f 7374 726f 6e67 292c 203a  &(~is_strong), :
+0000ec90: 5d5d 0d0a 0d0a 0d0a 6465 6620 766f 6c75  ]]......def volu
+0000eca0: 6d65 5f63 6f6c 6f72 6669 6c74 6572 5f73  me_colorfilter_s
+0000ecb0: 6563 7469 6f6e 2873 6563 7469 6f6e 733d  ection(sections=
+0000ecc0: 5b5d 293a 0d0a 2020 2020 2727 2754 6865  []):..    '''The
+0000ecd0: 2073 6563 7469 6f6e 7320 6172 6775 6d65   sections argume
+0000ece0: 6e74 2069 7320 6120 2873 7461 7274 696e  nt is a (startin
+0000ecf0: 675f 696e 6465 782c 2063 6f6c 6f72 5f6e  g_index, color_n
+0000ed00: 616d 6529 2061 7272 6179 2e27 2727 0d0a  ame) array.'''..
+0000ed10: 2020 2020 6465 6620 5f63 6f6c 6f72 6669      def _colorfi
+0000ed20: 6c74 6572 2873 6563 7469 6f6e 732c 2069  lter(sections, i
+0000ed30: 7465 6d2c 2064 6174 6173 7263 2c20 6466  tem, datasrc, df
+0000ed40: 293a 0d0a 2020 2020 2020 2020 6966 206e  ):..        if n
+0000ed50: 6f74 2073 6563 7469 6f6e 733a 0d0a 2020  ot sections:..  
+0000ed60: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0000ed70: 2076 6f6c 756d 655f 636f 6c6f 7266 696c   volume_colorfil
+0000ed80: 7465 7228 6974 656d 2c20 6461 7461 7372  ter(item, datasr
+0000ed90: 632c 2064 6629 0d0a 2020 2020 2020 2020  c, df)..        
+0000eda0: 666f 7220 2869 302c 636f 6c6e 616d 6529  for (i0,colname)
+0000edb0: 2c28 6931 2c5f 2920 696e 207a 6970 2873  ,(i1,_) in zip(s
+0000edc0: 6563 7469 6f6e 732c 2073 6563 7469 6f6e  ections, section
+0000edd0: 735b 313a 5d2b 5b28 4e6f 6e65 2c27 6e65  s[1:]+[(None,'ne
+0000ede0: 7574 7261 6c27 295d 293a 0d0a 2020 2020  utral')]):..    
+0000edf0: 2020 2020 2020 2020 726f 7773 203d 2064          rows = d
+0000ee00: 662e 696c 6f63 5b69 303a 6931 2c20 3a5d  f.iloc[i0:i1, :]
+0000ee10: 0d0a 2020 2020 2020 2020 2020 2020 7969  ..            yi
+0000ee20: 656c 6420 6974 656d 2e72 6f77 636f 6c6f  eld item.rowcolo
+0000ee30: 7273 2863 6f6c 6e61 6d65 2920 2b20 5b72  rs(colname) + [r
+0000ee40: 6f77 735d 0d0a 2020 2020 7265 7475 726e  ows]..    return
+0000ee50: 2070 6172 7469 616c 285f 636f 6c6f 7266   partial(_colorf
+0000ee60: 696c 7465 722c 2073 6563 7469 6f6e 7329  ilter, sections)
+0000ee70: 0d0a 0d0a 0d0a 6465 6620 686f 7269 7a76  ......def horizv
+0000ee80: 6f6c 5f63 6f6c 6f72 6669 6c74 6572 2873  ol_colorfilter(s
+0000ee90: 6563 7469 6f6e 733d 5b5d 293a 0d0a 2020  ections=[]):..  
+0000eea0: 2020 2727 2754 6865 2073 6563 7469 6f6e    '''The section
+0000eeb0: 7320 6172 6775 6d65 6e74 2069 7320 6120  s argument is a 
+0000eec0: 2873 7461 7274 696e 675f 696e 6465 782c  (starting_index,
+0000eed0: 2063 6f6c 6f72 5f6e 616d 6529 2061 7272   color_name) arr
+0000eee0: 6179 2e27 2727 0d0a 2020 2020 6465 6620  ay.'''..    def 
+0000eef0: 5f63 6f6c 6f72 6669 6c74 6572 2873 6563  _colorfilter(sec
+0000ef00: 7469 6f6e 732c 2069 7465 6d2c 2064 6174  tions, item, dat
+0000ef10: 6173 7263 2c20 6461 7461 293a 0d0a 2020  asrc, data):..  
+0000ef20: 2020 2020 2020 6966 206e 6f74 2073 6563        if not sec
+0000ef30: 7469 6f6e 733a 0d0a 2020 2020 2020 2020  tions:..        
+0000ef40: 2020 2020 7969 656c 6420 6974 656d 2e72      yield item.r
+0000ef50: 6f77 636f 6c6f 7273 2827 6e65 7574 7261  owcolors('neutra
+0000ef60: 6c27 2920 2b20 5b64 6174 615d 0d0a 2020  l') + [data]..  
+0000ef70: 2020 2020 2020 666f 7220 2869 302c 636f        for (i0,co
+0000ef80: 6c6e 616d 6529 2c28 6931 2c5f 2920 696e  lname),(i1,_) in
+0000ef90: 207a 6970 2873 6563 7469 6f6e 732c 2073   zip(sections, s
+0000efa0: 6563 7469 6f6e 735b 313a 5d2b 5b28 4e6f  ections[1:]+[(No
+0000efb0: 6e65 2c27 6e65 7574 7261 6c27 295d 293a  ne,'neutral')]):
+0000efc0: 0d0a 2020 2020 2020 2020 2020 2020 726f  ..            ro
+0000efd0: 7773 203d 2064 6174 615b 3a2c 2069 303a  ws = data[:, i0:
+0000efe0: 6931 5d0d 0a20 2020 2020 2020 2020 2020  i1]..           
+0000eff0: 2079 6965 6c64 2069 7465 6d2e 726f 7763   yield item.rowc
+0000f000: 6f6c 6f72 7328 636f 6c6e 616d 6529 202b  olors(colname) +
+0000f010: 205b 726f 7773 5d0d 0a20 2020 2072 6574   [rows]..    ret
+0000f020: 7572 6e20 7061 7274 6961 6c28 5f63 6f6c  urn partial(_col
+0000f030: 6f72 6669 6c74 6572 2c20 7365 6374 696f  orfilter, sectio
+0000f040: 6e73 290d 0a0d 0a0d 0a64 6566 2063 616e  ns)......def can
+0000f050: 646c 6573 7469 636b 5f6f 6368 6c28 6461  dlestick_ochl(da
+0000f060: 7461 7372 632c 2064 7261 775f 626f 6479  tasrc, draw_body
+0000f070: 3d54 7275 652c 2064 7261 775f 7368 6164  =True, draw_shad
+0000f080: 6f77 3d54 7275 652c 2063 616e 646c 655f  ow=True, candle_
+0000f090: 7769 6474 683d 302e 362c 2061 783d 4e6f  width=0.6, ax=No
+0000f0a0: 6e65 2c20 636f 6c6f 7266 756e 633d 7072  ne, colorfunc=pr
+0000f0b0: 6963 655f 636f 6c6f 7266 696c 7465 7229  ice_colorfilter)
+0000f0c0: 3a0d 0a20 2020 2061 7820 3d20 5f63 7265  :..    ax = _cre
+0000f0d0: 6174 655f 706c 6f74 2861 783d 6178 2c20  ate_plot(ax=ax, 
+0000f0e0: 6d61 7869 6d69 7a65 3d46 616c 7365 290d  maximize=False).
+0000f0f0: 0a20 2020 2064 6174 6173 7263 203d 205f  .    datasrc = _
+0000f100: 6372 6561 7465 5f64 6174 6173 7263 2861  create_datasrc(a
+0000f110: 782c 2064 6174 6173 7263 2c20 6e63 6f6c  x, datasrc, ncol
+0000f120: 733d 3529 0d0a 2020 2020 6461 7461 7372  s=5)..    datasr
+0000f130: 632e 7363 616c 655f 636f 6c73 203d 205b  c.scale_cols = [
+0000f140: 332c 345d 2023 206f 6e6c 7920 6869 2b6c  3,4] # only hi+l
+0000f150: 6f20 7363 616c 6573 0d0a 2020 2020 5f73  o scales..    _s
+0000f160: 6574 5f64 6174 6173 7263 2861 782c 2064  et_datasrc(ax, d
+0000f170: 6174 6173 7263 290d 0a20 2020 2069 7465  atasrc)..    ite
+0000f180: 6d20 3d20 4361 6e64 6c65 7374 6963 6b49  m = CandlestickI
+0000f190: 7465 6d28 6178 3d61 782c 2064 6174 6173  tem(ax=ax, datas
+0000f1a0: 7263 3d64 6174 6173 7263 2c20 6472 6177  rc=datasrc, draw
+0000f1b0: 5f62 6f64 793d 6472 6177 5f62 6f64 792c  _body=draw_body,
+0000f1c0: 2064 7261 775f 7368 6164 6f77 3d64 7261   draw_shadow=dra
+0000f1d0: 775f 7368 6164 6f77 2c20 6361 6e64 6c65  w_shadow, candle
+0000f1e0: 5f77 6964 7468 3d63 616e 646c 655f 7769  _width=candle_wi
+0000f1f0: 6474 682c 2063 6f6c 6f72 6675 6e63 3d63  dth, colorfunc=c
+0000f200: 6f6c 6f72 6675 6e63 2c20 7265 7361 6d70  olorfunc, resamp
+0000f210: 3d27 6869 6c6f 2729 0d0a 2020 2020 5f75  ='hilo')..    _u
+0000f220: 7064 6174 655f 7369 676e 6966 6963 616e  pdate_significan
+0000f230: 7473 2861 782c 2064 6174 6173 7263 2c20  ts(ax, datasrc, 
+0000f240: 666f 7263 653d 5472 7565 290d 0a20 2020  force=True)..   
+0000f250: 2069 7465 6d2e 7570 6461 7465 5f64 6174   item.update_dat
+0000f260: 6120 3d20 7061 7274 6961 6c28 5f75 7064  a = partial(_upd
+0000f270: 6174 655f 6461 7461 2c20 4e6f 6e65 2c20  ate_data, None, 
+0000f280: 4e6f 6e65 2c20 6974 656d 290d 0a20 2020  None, item)..   
+0000f290: 2069 7465 6d2e 7570 6461 7465 5f67 6678   item.update_gfx
+0000f2a0: 203d 2070 6172 7469 616c 285f 7570 6461   = partial(_upda
+0000f2b0: 7465 5f67 6678 2c20 6974 656d 290d 0a20  te_gfx, item).. 
+0000f2c0: 2020 2061 782e 6164 6449 7465 6d28 6974     ax.addItem(it
+0000f2d0: 656d 290d 0a20 2020 2072 6574 7572 6e20  em)..    return 
+0000f2e0: 6974 656d 0d0a 0d0a 0d0a 6465 6620 7265  item......def re
+0000f2f0: 6e6b 6f28 782c 2079 3d4e 6f6e 652c 2062  nko(x, y=None, b
+0000f300: 696e 733d 4e6f 6e65 2c20 7374 6570 3d4e  ins=None, step=N
+0000f310: 6f6e 652c 2061 783d 4e6f 6e65 2c20 636f  one, ax=None, co
+0000f320: 6c6f 7266 756e 633d 7072 6963 655f 636f  lorfunc=price_co
+0000f330: 6c6f 7266 696c 7465 7229 3a0d 0a20 2020  lorfilter):..   
+0000f340: 2061 7820 3d20 5f63 7265 6174 655f 706c   ax = _create_pl
+0000f350: 6f74 2861 783d 6178 2c20 6d61 7869 6d69  ot(ax=ax, maximi
+0000f360: 7a65 3d46 616c 7365 290d 0a20 2020 2064  ze=False)..    d
+0000f370: 6174 6173 7263 203d 205f 6372 6561 7465  atasrc = _create
+0000f380: 5f64 6174 6173 7263 2861 782c 2078 2c20  _datasrc(ax, x, 
+0000f390: 792c 206e 636f 6c73 3d33 290d 0a20 2020  y, ncols=3)..   
+0000f3a0: 206f 7269 6764 6620 3d20 6461 7461 7372   origdf = datasr
+0000f3b0: 632e 6466 0d0a 2020 2020 6164 6a20 3d20  c.df..    adj = 
+0000f3c0: 5f61 646a 7573 745f 7265 6e6b 6f5f 6c6f  _adjust_renko_lo
+0000f3d0: 675f 6461 7461 7372 6320 6966 2061 782e  g_datasrc if ax.
+0000f3e0: 7662 2e79 7363 616c 652e 7363 616c 6574  vb.yscale.scalet
+0000f3f0: 7970 6520 3d3d 2027 6c6f 6727 2065 6c73  ype == 'log' els
+0000f400: 6520 5f61 646a 7573 745f 7265 6e6b 6f5f  e _adjust_renko_
+0000f410: 6461 7461 7372 630d 0a20 2020 2073 7465  datasrc..    ste
+0000f420: 705f 6164 6a75 7374 5f72 656e 6b6f 5f64  p_adjust_renko_d
+0000f430: 6174 6173 7263 203d 2070 6172 7469 616c  atasrc = partial
+0000f440: 2861 646a 2c20 6269 6e73 2c20 7374 6570  (adj, bins, step
+0000f450: 290d 0a20 2020 2073 7465 705f 6164 6a75  )..    step_adju
+0000f460: 7374 5f72 656e 6b6f 5f64 6174 6173 7263  st_renko_datasrc
+0000f470: 2864 6174 6173 7263 290d 0a20 2020 2061  (datasrc)..    a
+0000f480: 782e 6465 636f 7570 6c65 2829 0d0a 2020  x.decouple()..  
+0000f490: 2020 6974 656d 203d 2063 616e 646c 6573    item = candles
+0000f4a0: 7469 636b 5f6f 6368 6c28 6461 7461 7372  tick_ochl(datasr
+0000f4b0: 632c 2064 7261 775f 7368 6164 6f77 3d46  c, draw_shadow=F
+0000f4c0: 616c 7365 2c20 6361 6e64 6c65 5f77 6964  alse, candle_wid
+0000f4d0: 7468 3d31 2c20 6178 3d61 782c 2063 6f6c  th=1, ax=ax, col
+0000f4e0: 6f72 6675 6e63 3d63 6f6c 6f72 6675 6e63  orfunc=colorfunc
+0000f4f0: 290d 0a20 2020 2069 7465 6d2e 636f 6c6f  )..    item.colo
+0000f500: 7273 5b27 6275 6c6c 5f62 6f64 7927 5d20  rs['bull_body'] 
+0000f510: 3d20 6974 656d 2e63 6f6c 6f72 735b 2762  = item.colors['b
+0000f520: 756c 6c5f 6672 616d 6527 5d0d 0a20 2020  ull_frame']..   
+0000f530: 2069 7465 6d2e 7570 6461 7465 5f64 6174   item.update_dat
+0000f540: 6120 3d20 7061 7274 6961 6c28 5f75 7064  a = partial(_upd
+0000f550: 6174 655f 6461 7461 2c20 4e6f 6e65 2c20  ate_data, None, 
+0000f560: 7374 6570 5f61 646a 7573 745f 7265 6e6b  step_adjust_renk
+0000f570: 6f5f 6461 7461 7372 632c 2069 7465 6d29  o_datasrc, item)
+0000f580: 0d0a 2020 2020 6974 656d 2e75 7064 6174  ..    item.updat
+0000f590: 655f 6766 7820 3d20 7061 7274 6961 6c28  e_gfx = partial(
+0000f5a0: 5f75 7064 6174 655f 6766 782c 2069 7465  _update_gfx, ite
+0000f5b0: 6d29 0d0a 2020 2020 676c 6f62 616c 2065  m)..    global e
+0000f5c0: 706f 6368 5f70 6572 696f 640d 0a20 2020  poch_period..   
+0000f5d0: 2065 706f 6368 5f70 6572 696f 6420 3d20   epoch_period = 
+0000f5e0: 286f 7269 6764 662e 696c 6f63 5b31 2c30  (origdf.iloc[1,0
+0000f5f0: 5d20 2d20 6f72 6967 6466 2e69 6c6f 635b  ] - origdf.iloc[
+0000f600: 302c 305d 2920 2f2f 2069 6e74 2831 6539  0,0]) // int(1e9
+0000f610: 290d 0a20 2020 2072 6574 7572 6e20 6974  )..    return it
+0000f620: 656d 0d0a 0d0a 0d0a 6465 6620 766f 6c75  em......def volu
+0000f630: 6d65 5f6f 6376 2864 6174 6173 7263 2c20  me_ocv(datasrc, 
+0000f640: 6361 6e64 6c65 5f77 6964 7468 3d30 2e38  candle_width=0.8
+0000f650: 2c20 6178 3d4e 6f6e 652c 2063 6f6c 6f72  , ax=None, color
+0000f660: 6675 6e63 3d76 6f6c 756d 655f 636f 6c6f  func=volume_colo
+0000f670: 7266 696c 7465 7229 3a0d 0a20 2020 2061  rfilter):..    a
+0000f680: 7820 3d20 5f63 7265 6174 655f 706c 6f74  x = _create_plot
+0000f690: 2861 783d 6178 2c20 6d61 7869 6d69 7a65  (ax=ax, maximize
+0000f6a0: 3d46 616c 7365 290d 0a20 2020 2064 6174  =False)..    dat
+0000f6b0: 6173 7263 203d 205f 6372 6561 7465 5f64  asrc = _create_d
+0000f6c0: 6174 6173 7263 2861 782c 2064 6174 6173  atasrc(ax, datas
+0000f6d0: 7263 2c20 6e63 6f6c 733d 3429 0d0a 2020  rc, ncols=4)..  
+0000f6e0: 2020 5f61 646a 7573 745f 766f 6c75 6d65    _adjust_volume
+0000f6f0: 5f64 6174 6173 7263 2864 6174 6173 7263  _datasrc(datasrc
+0000f700: 290d 0a20 2020 205f 7365 745f 6461 7461  )..    _set_data
+0000f710: 7372 6328 6178 2c20 6461 7461 7372 6329  src(ax, datasrc)
+0000f720: 0d0a 2020 2020 6974 656d 203d 2043 616e  ..    item = Can
+0000f730: 646c 6573 7469 636b 4974 656d 2861 783d  dlestickItem(ax=
+0000f740: 6178 2c20 6461 7461 7372 633d 6461 7461  ax, datasrc=data
+0000f750: 7372 632c 2064 7261 775f 626f 6479 3d54  src, draw_body=T
+0000f760: 7275 652c 2064 7261 775f 7368 6164 6f77  rue, draw_shadow
+0000f770: 3d46 616c 7365 2c20 6361 6e64 6c65 5f77  =False, candle_w
+0000f780: 6964 7468 3d63 616e 646c 655f 7769 6474  idth=candle_widt
+0000f790: 682c 2063 6f6c 6f72 6675 6e63 3d63 6f6c  h, colorfunc=col
+0000f7a0: 6f72 6675 6e63 2c20 7265 7361 6d70 3d27  orfunc, resamp='
+0000f7b0: 7375 6d27 290d 0a20 2020 205f 7570 6461  sum')..    _upda
+0000f7c0: 7465 5f73 6967 6e69 6669 6361 6e74 7328  te_significants(
+0000f7d0: 6178 2c20 6461 7461 7372 632c 2066 6f72  ax, datasrc, for
+0000f7e0: 6365 3d54 7275 6529 0d0a 2020 2020 6974  ce=True)..    it
+0000f7f0: 656d 2e63 6f6c 6f72 735b 2762 756c 6c5f  em.colors['bull_
+0000f800: 626f 6479 275d 203d 2069 7465 6d2e 636f  body'] = item.co
+0000f810: 6c6f 7273 5b27 6275 6c6c 5f66 7261 6d65  lors['bull_frame
+0000f820: 275d 0d0a 2020 2020 6966 2063 6f6c 6f72  ']..    if color
+0000f830: 6675 6e63 203d 3d20 766f 6c75 6d65 5f63  func == volume_c
+0000f840: 6f6c 6f72 6669 6c74 6572 3a20 2320 6173  olorfilter: # as
+0000f850: 7375 6d65 206e 6f72 6d61 6c20 766f 6c75  sume normal volu
+0000f860: 6d65 2070 6c6f 740d 0a20 2020 2020 2020  me plot..       
+0000f870: 2069 7465 6d2e 636f 6c6f 7273 5b27 6275   item.colors['bu
+0000f880: 6c6c 5f66 7261 6d65 275d 203d 2076 6f6c  ll_frame'] = vol
+0000f890: 756d 655f 6275 6c6c 5f63 6f6c 6f72 0d0a  ume_bull_color..
+0000f8a0: 2020 2020 2020 2020 6974 656d 2e63 6f6c          item.col
+0000f8b0: 6f72 735b 2762 756c 6c5f 626f 6479 275d  ors['bull_body']
+0000f8c0: 2020 3d20 766f 6c75 6d65 5f62 756c 6c5f    = volume_bull_
+0000f8d0: 626f 6479 5f63 6f6c 6f72 0d0a 2020 2020  body_color..    
+0000f8e0: 2020 2020 6974 656d 2e63 6f6c 6f72 735b      item.colors[
+0000f8f0: 2762 6561 725f 6672 616d 6527 5d20 3d20  'bear_frame'] = 
+0000f900: 766f 6c75 6d65 5f62 6561 725f 636f 6c6f  volume_bear_colo
+0000f910: 720d 0a20 2020 2020 2020 2069 7465 6d2e  r..        item.
+0000f920: 636f 6c6f 7273 5b27 6265 6172 5f62 6f64  colors['bear_bod
+0000f930: 7927 5d20 203d 2076 6f6c 756d 655f 6265  y']  = volume_be
+0000f940: 6172 5f63 6f6c 6f72 0d0a 2020 2020 2020  ar_color..      
+0000f950: 2020 6178 2e76 622e 765f 7a6f 6f6d 5f62    ax.vb.v_zoom_b
+0000f960: 6173 656c 696e 6520 3d20 300d 0a20 2020  aseline = 0..   
+0000f970: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
+0000f980: 6974 656d 2e63 6f6c 6f72 735b 2777 6561  item.colors['wea
+0000f990: 6b5f 6275 6c6c 5f66 7261 6d65 275d 203d  k_bull_frame'] =
+0000f9a0: 2062 7269 6768 7465 6e28 766f 6c75 6d65   brighten(volume
+0000f9b0: 5f62 756c 6c5f 636f 6c6f 722c 2031 2e32  _bull_color, 1.2
+0000f9c0: 290d 0a20 2020 2020 2020 2069 7465 6d2e  )..        item.
+0000f9d0: 636f 6c6f 7273 5b27 7765 616b 5f62 756c  colors['weak_bul
+0000f9e0: 6c5f 626f 6479 275d 2020 3d20 6272 6967  l_body']  = brig
+0000f9f0: 6874 656e 2876 6f6c 756d 655f 6275 6c6c  hten(volume_bull
+0000fa00: 5f63 6f6c 6f72 2c20 312e 3229 0d0a 2020  _color, 1.2)..  
+0000fa10: 2020 6974 656d 2e75 7064 6174 655f 6461    item.update_da
+0000fa20: 7461 203d 2070 6172 7469 616c 285f 7570  ta = partial(_up
+0000fa30: 6461 7465 5f64 6174 612c 204e 6f6e 652c  date_data, None,
+0000fa40: 205f 6164 6a75 7374 5f76 6f6c 756d 655f   _adjust_volume_
+0000fa50: 6461 7461 7372 632c 2069 7465 6d29 0d0a  datasrc, item)..
+0000fa60: 2020 2020 6974 656d 2e75 7064 6174 655f      item.update_
+0000fa70: 6766 7820 3d20 7061 7274 6961 6c28 5f75  gfx = partial(_u
+0000fa80: 7064 6174 655f 6766 782c 2069 7465 6d29  pdate_gfx, item)
+0000fa90: 0d0a 2020 2020 6178 2e61 6464 4974 656d  ..    ax.addItem
+0000faa0: 2869 7465 6d29 0d0a 2020 2020 6974 656d  (item)..    item
+0000fab0: 2e73 6574 5a56 616c 7565 282d 3230 290d  .setZValue(-20).
+0000fac0: 0a20 2020 2072 6574 7572 6e20 6974 656d  .    return item
+0000fad0: 0d0a 0d0a 0d0a 6465 6620 686f 7269 7a5f  ......def horiz_
+0000fae0: 7469 6d65 5f76 6f6c 756d 6528 6461 7461  time_volume(data
+0000faf0: 7372 632c 2061 783d 4e6f 6e65 2c20 2a2a  src, ax=None, **
+0000fb00: 6b77 6172 6773 293a 0d0a 2020 2020 2727  kwargs):..    ''
+0000fb10: 2744 7261 7773 206d 756c 7469 706c 6520  'Draws multiple 
+0000fb20: 6669 7865 6420 686f 7269 7a6f 6e74 616c  fixed horizontal
+0000fb30: 2076 6f6c 756d 6573 2e20 5468 6520 696e   volumes. The in
+0000fb40: 7075 7420 666f 726d 6174 2069 733a 0d0a  put format is:..
+0000fb50: 2020 2020 2020 205b 5b74 696d 6530 2c20         [[time0, 
+0000fb60: 5b28 7072 6963 6530 2c76 6f6c 756d 6530  [(price0,volume0
+0000fb70: 292c 2870 7269 6365 312c 766f 6c75 6d65  ),(price1,volume
+0000fb80: 3129 2c2e 2e2e 5d5d 2c20 2e2e 2e5d 0d0a  1),...]], ...]..
+0000fb90: 0d0a 2020 2020 2020 2054 6869 7320 6368  ..       This ch
+0000fba0: 6172 7420 6e65 6564 7320 746f 2062 6520  art needs to be 
+0000fbb0: 706c 6f74 206c 6173 742c 2073 6f20 6974  plot last, so it
+0000fbc0: 206b 6e6f 7773 2069 6620 6974 2063 6f6e   knows if it con
+0000fbd0: 7472 6f6c 730d 0a20 2020 2020 2020 7768  trols..       wh
+0000fbe0: 6174 2074 696d 6520 7065 7269 6f64 7320  at time periods 
+0000fbf0: 6172 6520 7368 6f77 6e2c 206f 7220 6966  are shown, or if
+0000fc00: 2069 7473 2075 7369 6e67 2074 696d 6520   its using time 
+0000fc10: 616c 7265 6164 7920 696e 0d0a 2020 2020  already in..    
+0000fc20: 2020 2070 6c61 6365 2062 7920 616e 6f74     place by anot
+0000fc30: 6865 7220 706c 6f74 2e27 2727 0d0a 2020  her plot.'''..  
+0000fc40: 2020 2320 7570 6461 7465 2068 616e 646c    # update handl
+0000fc50: 696e 6720 6465 6661 756c 7420 6966 206e  ing default if n
+0000fc60: 6563 6573 7361 7279 0d0a 2020 2020 676c  ecessary..    gl
+0000fc70: 6f62 616c 206d 6178 5f7a 6f6f 6d5f 706f  obal max_zoom_po
+0000fc80: 696e 7473 2c20 7269 6768 745f 6d61 7267  ints, right_marg
+0000fc90: 696e 5f63 616e 646c 6573 0d0a 2020 2020  in_candles..    
+0000fca0: 6966 206d 6178 5f7a 6f6f 6d5f 706f 696e  if max_zoom_poin
+0000fcb0: 7473 203e 2031 353a 0d0a 2020 2020 2020  ts > 15:..      
+0000fcc0: 2020 6d61 785f 7a6f 6f6d 5f70 6f69 6e74    max_zoom_point
+0000fcd0: 7320 3d20 340d 0a20 2020 2069 6620 7269  s = 4..    if ri
+0000fce0: 6768 745f 6d61 7267 696e 5f63 616e 646c  ght_margin_candl
+0000fcf0: 6573 203e 2033 3a0d 0a20 2020 2020 2020  es > 3:..       
+0000fd00: 2072 6967 6874 5f6d 6172 6769 6e5f 6361   right_margin_ca
+0000fd10: 6e64 6c65 7320 3d20 310d 0a0d 0a20 2020  ndles = 1....   
+0000fd20: 2061 7820 3d20 5f63 7265 6174 655f 706c   ax = _create_pl
+0000fd30: 6f74 2861 783d 6178 2c20 6d61 7869 6d69  ot(ax=ax, maximi
+0000fd40: 7a65 3d46 616c 7365 290d 0a20 2020 2064  ze=False)..    d
+0000fd50: 6174 6173 7263 203d 205f 7072 6561 646a  atasrc = _preadj
+0000fd60: 7573 745f 686f 7269 7a5f 6461 7461 7372  ust_horiz_datasr
+0000fd70: 6328 6461 7461 7372 6329 0d0a 2020 2020  c(datasrc)..    
+0000fd80: 6461 7461 7372 6320 3d20 5f63 7265 6174  datasrc = _creat
+0000fd90: 655f 6461 7461 7372 6328 6178 2c20 6461  e_datasrc(ax, da
+0000fda0: 7461 7372 6329 0d0a 2020 2020 5f61 646a  tasrc)..    _adj
+0000fdb0: 7573 745f 686f 7269 7a5f 6461 7461 7372  ust_horiz_datasr
+0000fdc0: 6328 6461 7461 7372 6329 0d0a 2020 2020  c(datasrc)..    
+0000fdd0: 6966 2061 782e 7662 2e64 6174 6173 7263  if ax.vb.datasrc
+0000fde0: 2069 7320 6e6f 7420 4e6f 6e65 3a0d 0a20   is not None:.. 
+0000fdf0: 2020 2020 2020 2064 6174 6173 7263 2e73         datasrc.s
+0000fe00: 7461 6e64 616c 6f6e 6520 3d20 5472 7565  tandalone = True
+0000fe10: 2023 206f 6e6c 7920 666f 7263 6520 7374   # only force st
+0000fe20: 616e 6461 6c6f 6e65 2069 6620 7468 6572  andalone if ther
+0000fe30: 6520 6973 2073 6f6d 6574 6869 6e67 206f  e is something o
+0000fe40: 6e20 6f75 7220 6368 6172 7473 2061 6c72  n our charts alr
+0000fe50: 6561 6479 0d0a 2020 2020 6461 7461 7372  eady..    datasr
+0000fe60: 632e 7363 616c 655f 636f 6c73 203d 205b  c.scale_cols = [
+0000fe70: 6461 7461 7372 632e 636f 6c5f 6461 7461  datasrc.col_data
+0000fe80: 5f6f 6666 7365 742c 206c 656e 2864 6174  _offset, len(dat
+0000fe90: 6173 7263 2e64 662e 636f 6c75 6d6e 7329  asrc.df.columns)
+0000fea0: 2d32 5d20 2320 6669 7273 7420 616e 6420  -2] # first and 
+0000feb0: 6c61 7374 2070 7269 6365 2063 6f6c 756d  last price colum
+0000fec0: 6e73 0d0a 2020 2020 6461 7461 7372 632e  ns..    datasrc.
+0000fed0: 7072 655f 7570 6461 7465 203d 206c 616d  pre_update = lam
+0000fee0: 6264 6120 6466 3a20 6466 2e6c 6f63 5b3a  bda df: df.loc[:
+0000fef0: 2c20 3a64 662e 636f 6c75 6d6e 735b 305d  , :df.columns[0]
+0000ff00: 5d20 2320 7468 726f 7720 6177 6179 2070  ] # throw away p
+0000ff10: 7265 7669 6f75 7320 6461 7461 0d0a 2020  revious data..  
+0000ff20: 2020 6461 7461 7372 632e 706f 7374 5f75    datasrc.post_u
+0000ff30: 7064 6174 6520 3d20 6c61 6d62 6461 2064  pdate = lambda d
+0000ff40: 663a 2064 662e 6472 6f70 6e61 2868 6f77  f: df.dropna(how
+0000ff50: 3d27 616c 6c27 2920 2320 6b69 6c6c 2061  ='all') # kill a
+0000ff60: 6c6c 2d4e 614e 730d 0a20 2020 205f 7365  ll-NaNs..    _se
+0000ff70: 745f 6461 7461 7372 6328 6178 2c20 6461  t_datasrc(ax, da
+0000ff80: 7461 7372 6329 0d0a 2020 2020 6974 656d  tasrc)..    item
+0000ff90: 203d 2048 6f72 697a 6f6e 7461 6c54 696d   = HorizontalTim
+0000ffa0: 6556 6f6c 756d 6549 7465 6d28 6178 3d61  eVolumeItem(ax=a
+0000ffb0: 782c 2064 6174 6173 7263 3d64 6174 6173  x, datasrc=datas
+0000ffc0: 7263 2c20 2a2a 6b77 6172 6773 290d 0a20  rc, **kwargs).. 
+0000ffd0: 2020 2069 7465 6d2e 7570 6461 7465 5f64     item.update_d
+0000ffe0: 6174 6120 3d20 7061 7274 6961 6c28 5f75  ata = partial(_u
+0000fff0: 7064 6174 655f 6461 7461 2c20 5f70 7265  pdate_data, _pre
+00010000: 6164 6a75 7374 5f68 6f72 697a 5f64 6174  adjust_horiz_dat
+00010010: 6173 7263 2c20 5f61 646a 7573 745f 686f  asrc, _adjust_ho
+00010020: 7269 7a5f 6461 7461 7372 632c 2069 7465  riz_datasrc, ite
+00010030: 6d29 0d0a 2020 2020 6974 656d 2e75 7064  m)..    item.upd
+00010040: 6174 655f 6766 7820 3d20 7061 7274 6961  ate_gfx = partia
+00010050: 6c28 5f75 7064 6174 655f 6766 782c 2069  l(_update_gfx, i
+00010060: 7465 6d29 0d0a 2020 2020 6974 656d 2e73  tem)..    item.s
+00010070: 6574 5a56 616c 7565 282d 3130 290d 0a20  etZValue(-10).. 
+00010080: 2020 2061 782e 6164 6449 7465 6d28 6974     ax.addItem(it
+00010090: 656d 290d 0a20 2020 2072 6574 7572 6e20  em)..    return 
+000100a0: 6974 656d 0d0a 0d0a 0d0a 6465 6620 6865  item......def he
+000100b0: 6174 6d61 7028 6461 7461 7372 632c 2061  atmap(datasrc, a
+000100c0: 783d 4e6f 6e65 2c20 2a2a 6b77 6172 6773  x=None, **kwargs
+000100d0: 293a 0d0a 2020 2020 2727 2745 7870 656e  ):..    '''Expen
+000100e0: 7369 7665 2066 756e 6374 696f 6e2e 204f  sive function. O
+000100f0: 6e6c 7920 7573 6520 6f6e 2073 6d61 6c6c  nly use on small
+00010100: 2064 6174 6120 7365 7473 2e20 5365 6520   data sets. See 
+00010110: 4865 6174 6d61 7049 7465 6d20 666f 7220  HeatmapItem for 
+00010120: 6b77 6172 6773 2e20 496e 7075 7420 6461  kwargs. Input da
+00010130: 7461 7372 630d 0a20 2020 2020 2020 6861  tasrc..       ha
+00010140: 7320 7820 2874 696d 6529 2069 6e20 696e  s x (time) in in
+00010150: 6465 7820 6f72 2066 6972 7374 2063 6f6c  dex or first col
+00010160: 756d 6e2c 2079 2028 7072 6963 6529 2061  umn, y (price) a
+00010170: 7320 636f 6c75 6d6e 206e 616d 6573 2c20  s column names, 
+00010180: 616e 6420 696e 7465 6e73 6974 7920 2863  and intensity (c
+00010190: 6f6c 6f72 2920 6173 0d0a 2020 2020 2020  olor) as..      
+000101a0: 2063 656c 6c20 7661 6c75 6573 2e27 2727   cell values.'''
+000101b0: 0d0a 2020 2020 6178 203d 205f 6372 6561  ..    ax = _crea
+000101c0: 7465 5f70 6c6f 7428 6178 3d61 782c 206d  te_plot(ax=ax, m
+000101d0: 6178 696d 697a 653d 4661 6c73 6529 0d0a  aximize=False)..
+000101e0: 2020 2020 6966 2061 782e 7662 2e76 5f7a      if ax.vb.v_z
+000101f0: 6f6f 6d5f 7363 616c 6520 3e3d 2030 2e39  oom_scale >= 0.9
+00010200: 3a0d 0a20 2020 2020 2020 2061 782e 7662  :..        ax.vb
+00010210: 2e76 5f7a 6f6f 6d5f 7363 616c 6520 3d20  .v_zoom_scale = 
+00010220: 302e 360d 0a20 2020 2064 6174 6173 7263  0.6..    datasrc
+00010230: 203d 205f 6372 6561 7465 5f64 6174 6173   = _create_datas
+00010240: 7263 2861 782c 2064 6174 6173 7263 290d  rc(ax, datasrc).
+00010250: 0a20 2020 2064 6174 6173 7263 2e73 6361  .    datasrc.sca
+00010260: 6c65 5f63 6f6c 7320 3d20 5b5d 2023 2064  le_cols = [] # d
+00010270: 6f65 736e 2774 2073 6361 6c65 0d0a 2020  oesn't scale..  
+00010280: 2020 5f73 6574 5f64 6174 6173 7263 2861    _set_datasrc(a
+00010290: 782c 2064 6174 6173 7263 290d 0a20 2020  x, datasrc)..   
+000102a0: 2069 7465 6d20 3d20 4865 6174 6d61 7049   item = HeatmapI
+000102b0: 7465 6d28 6178 3d61 782c 2064 6174 6173  tem(ax=ax, datas
+000102c0: 7263 3d64 6174 6173 7263 2c20 2a2a 6b77  rc=datasrc, **kw
+000102d0: 6172 6773 290d 0a20 2020 2069 7465 6d2e  args)..    item.
+000102e0: 7570 6461 7465 5f64 6174 6120 3d20 7061  update_data = pa
+000102f0: 7274 6961 6c28 5f75 7064 6174 655f 6461  rtial(_update_da
+00010300: 7461 2c20 4e6f 6e65 2c20 4e6f 6e65 2c20  ta, None, None, 
+00010310: 6974 656d 290d 0a20 2020 2069 7465 6d2e  item)..    item.
+00010320: 7570 6461 7465 5f67 6678 203d 2070 6172  update_gfx = par
+00010330: 7469 616c 285f 7570 6461 7465 5f67 6678  tial(_update_gfx
+00010340: 2c20 6974 656d 290d 0a20 2020 2069 7465  , item)..    ite
+00010350: 6d2e 7365 745a 5661 6c75 6528 2d33 3029  m.setZValue(-30)
+00010360: 0d0a 2020 2020 6178 2e61 6464 4974 656d  ..    ax.addItem
+00010370: 2869 7465 6d29 0d0a 2020 2020 6966 2061  (item)..    if a
+00010380: 782e 7662 2e64 6174 6173 7263 2069 7320  x.vb.datasrc is 
+00010390: 6e6f 7420 4e6f 6e65 2061 6e64 206e 6f74  not None and not
+000103a0: 2061 782e 7662 2e64 6174 6173 7263 2e74   ax.vb.datasrc.t
+000103b0: 696d 6562 6173 6564 2829 3a20 2320 6d61  imebased(): # ma
+000103c0: 6e75 616c 207a 6f6f 6d20 7570 6461 7465  nual zoom update
+000103d0: 0d0a 2020 2020 2020 2020 6178 2e73 6574  ..        ax.set
+000103e0: 584c 696e 6b28 4e6f 6e65 290d 0a20 2020  XLink(None)..   
+000103f0: 2020 2020 2069 6620 6178 2e70 7265 765f       if ax.prev_
+00010400: 6178 3a0d 0a20 2020 2020 2020 2020 2020  ax:..           
+00010410: 2061 782e 7072 6576 5f61 782e 7365 745f   ax.prev_ax.set_
+00010420: 7669 7369 626c 6528 7861 7869 733d 5472  visible(xaxis=Tr
+00010430: 7565 290d 0a20 2020 2020 2020 2064 6620  ue)..        df 
+00010440: 3d20 6178 2e76 622e 6461 7461 7372 632e  = ax.vb.datasrc.
+00010450: 6466 0d0a 2020 2020 2020 2020 7072 6963  df..        pric
+00010460: 6573 203d 2064 662e 636f 6c75 6d6e 735b  es = df.columns[
+00010470: 6178 2e76 622e 6461 7461 7372 632e 636f  ax.vb.datasrc.co
+00010480: 6c5f 6461 7461 5f6f 6666 7365 743a 6974  l_data_offset:it
+00010490: 656d 2e63 6f6c 5f64 6174 615f 656e 645d  em.col_data_end]
+000104a0: 0d0a 2020 2020 2020 2020 6465 6c74 615f  ..        delta_
+000104b0: 7072 6963 6520 3d20 6162 7328 7072 6963  price = abs(pric
+000104c0: 6573 5b30 5d20 2d20 7072 6963 6573 5b31  es[0] - prices[1
+000104d0: 5d29 0d0a 2020 2020 2020 2020 6178 2e76  ])..        ax.v
+000104e0: 622e 7365 745f 7261 6e67 6528 302c 206d  b.set_range(0, m
+000104f0: 696e 2864 662e 636f 6c75 6d6e 735b 313a  in(df.columns[1:
+00010500: 5d29 2c20 6c65 6e28 6466 292c 206d 6178  ]), len(df), max
+00010510: 2864 662e 636f 6c75 6d6e 735b 313a 5d29  (df.columns[1:])
+00010520: 2b64 656c 7461 5f70 7269 6365 290d 0a20  +delta_price).. 
+00010530: 2020 2072 6574 7572 6e20 6974 656d 0d0a     return item..
+00010540: 0d0a 0d0a 6465 6620 6261 7228 782c 2079  ....def bar(x, y
+00010550: 3d4e 6f6e 652c 2077 6964 7468 3d30 2e38  =None, width=0.8
+00010560: 2c20 6178 3d4e 6f6e 652c 2063 6f6c 6f72  , ax=None, color
+00010570: 6675 6e63 3d73 7472 656e 6774 685f 636f  func=strength_co
+00010580: 6c6f 7266 696c 7465 722c 202a 2a6b 7761  lorfilter, **kwa
+00010590: 7267 7329 3a0d 0a20 2020 2027 2727 4261  rgs):..    '''Ba
+000105a0: 7220 706c 6f74 7320 6172 6520 6465 636f  r plots are deco
+000105b0: 7570 6c65 642e 2055 7365 2076 6f6c 756d  upled. Use volum
+000105c0: 655f 6f63 7628 2920 6966 2079 6f75 2077  e_ocv() if you w
+000105d0: 616e 7420 6120 6261 7220 706c 6f74 2077  ant a bar plot w
+000105e0: 6869 6368 2072 656c 6174 6573 2074 6f20  hich relates to 
+000105f0: 6f74 6865 7220 7469 6d65 2070 6c6f 7473  other time plots
+00010600: 2e27 2727 0d0a 2020 2020 676c 6f62 616c  .'''..    global
+00010610: 2072 6967 6874 5f6d 6172 6769 6e5f 6361   right_margin_ca
+00010620: 6e64 6c65 732c 206d 6178 5f7a 6f6f 6d5f  ndles, max_zoom_
+00010630: 706f 696e 7473 0d0a 2020 2020 7269 6768  points..    righ
+00010640: 745f 6d61 7267 696e 5f63 616e 646c 6573  t_margin_candles
+00010650: 203d 2030 0d0a 2020 2020 6d61 785f 7a6f   = 0..    max_zo
+00010660: 6f6d 5f70 6f69 6e74 7320 3d20 6d69 6e28  om_points = min(
+00010670: 6d61 785f 7a6f 6f6d 5f70 6f69 6e74 732c  max_zoom_points,
+00010680: 2038 290d 0a20 2020 2061 7820 3d20 5f63   8)..    ax = _c
+00010690: 7265 6174 655f 706c 6f74 2861 783d 6178  reate_plot(ax=ax
+000106a0: 2c20 6d61 7869 6d69 7a65 3d46 616c 7365  , maximize=False
+000106b0: 290d 0a20 2020 2061 782e 6465 636f 7570  )..    ax.decoup
+000106c0: 6c65 2829 0d0a 2020 2020 6461 7461 7372  le()..    datasr
+000106d0: 6320 3d20 5f63 7265 6174 655f 6461 7461  c = _create_data
+000106e0: 7372 6328 6178 2c20 782c 2079 2c20 6e63  src(ax, x, y, nc
+000106f0: 6f6c 733d 3129 0d0a 2020 2020 5f61 646a  ols=1)..    _adj
+00010700: 7573 745f 6261 725f 6461 7461 7372 6328  ust_bar_datasrc(
+00010710: 6461 7461 7372 632c 206f 7264 6572 5f63  datasrc, order_c
+00010720: 6f6c 733d 4661 6c73 6529 2023 2064 6f6e  ols=False) # don
+00010730: 2774 2072 6561 7272 616e 6765 2063 6f6c  't rearrange col
+00010740: 756d 6e73 2c20 646f 6e65 2066 6f72 2075  umns, done for u
+00010750: 7320 696e 2076 6f6c 756d 655f 6f63 7628  s in volume_ocv(
+00010760: 290d 0a20 2020 2069 7465 6d20 3d20 766f  )..    item = vo
+00010770: 6c75 6d65 5f6f 6376 2864 6174 6173 7263  lume_ocv(datasrc
+00010780: 2c20 6361 6e64 6c65 5f77 6964 7468 3d77  , candle_width=w
+00010790: 6964 7468 2c20 6178 3d61 782c 2063 6f6c  idth, ax=ax, col
+000107a0: 6f72 6675 6e63 3d63 6f6c 6f72 6675 6e63  orfunc=colorfunc
+000107b0: 290d 0a20 2020 2069 7465 6d2e 7570 6461  )..    item.upda
+000107c0: 7465 5f64 6174 6120 3d20 7061 7274 6961  te_data = partia
+000107d0: 6c28 5f75 7064 6174 655f 6461 7461 2c20  l(_update_data, 
+000107e0: 4e6f 6e65 2c20 5f61 646a 7573 745f 6261  None, _adjust_ba
+000107f0: 725f 6461 7461 7372 632c 2069 7465 6d29  r_datasrc, item)
+00010800: 0d0a 2020 2020 6974 656d 2e75 7064 6174  ..    item.updat
+00010810: 655f 6766 7820 3d20 7061 7274 6961 6c28  e_gfx = partial(
+00010820: 5f75 7064 6174 655f 6766 782c 2069 7465  _update_gfx, ite
+00010830: 6d29 0d0a 2020 2020 6178 2e76 622e 7072  m)..    ax.vb.pr
+00010840: 655f 7072 6f63 6573 735f 6461 7461 2829  e_process_data()
+00010850: 0d0a 2020 2020 6966 2061 782e 7662 2e79  ..    if ax.vb.y
+00010860: 5f6d 696e 203e 3d20 303a 0d0a 2020 2020  _min >= 0:..    
+00010870: 2020 2020 6178 2e76 622e 765f 7a6f 6f6d      ax.vb.v_zoom
+00010880: 5f62 6173 656c 696e 6520 3d20 300d 0a20  _baseline = 0.. 
+00010890: 2020 2072 6574 7572 6e20 6974 656d 0d0a     return item..
+000108a0: 0d0a 0d0a 6465 6620 6869 7374 2878 2c20  ....def hist(x, 
+000108b0: 6269 6e73 2c20 6178 3d4e 6f6e 652c 202a  bins, ax=None, *
+000108c0: 2a6b 7761 7267 7329 3a0d 0a20 2020 2068  *kwargs):..    h
+000108d0: 6973 745f 6461 7461 203d 2070 642e 6375  ist_data = pd.cu
+000108e0: 7428 782c 2062 696e 733d 6269 6e73 292e  t(x, bins=bins).
+000108f0: 7661 6c75 655f 636f 756e 7473 2829 0d0a  value_counts()..
+00010900: 2020 2020 6461 7461 203d 205b 2869 2e6d      data = [(i.m
+00010910: 6964 2c30 2c68 6973 745f 6461 7461 2e6c  id,0,hist_data.l
+00010920: 6f63 5b69 5d2c 6869 7374 5f64 6174 612e  oc[i],hist_data.
+00010930: 6c6f 635b 695d 2920 666f 7220 6920 696e  loc[i]) for i in
+00010940: 2073 6f72 7465 6428 6869 7374 5f64 6174   sorted(hist_dat
+00010950: 612e 696e 6465 7829 5d0d 0a20 2020 2064  a.index)]..    d
+00010960: 6620 3d20 7064 2e44 6174 6146 7261 6d65  f = pd.DataFrame
+00010970: 2864 6174 612c 2063 6f6c 756d 6e73 3d5b  (data, columns=[
+00010980: 2778 272c 275f 6f70 5f27 2c27 5f63 6c5f  'x','_op_','_cl_
+00010990: 272c 2762 696e 275d 290d 0a20 2020 2064  ','bin'])..    d
+000109a0: 662e 7365 745f 696e 6465 7828 2778 272c  f.set_index('x',
+000109b0: 2069 6e70 6c61 6365 3d54 7275 6529 0d0a   inplace=True)..
+000109c0: 2020 2020 6974 656d 203d 2062 6172 2864      item = bar(d
+000109d0: 662c 2061 783d 6178 290d 0a20 2020 2064  f, ax=ax)..    d
+000109e0: 656c 2069 7465 6d2e 7570 6461 7465 5f64  el item.update_d
+000109f0: 6174 610d 0a20 2020 2072 6574 7572 6e20  ata..    return 
+00010a00: 6974 656d 0d0a 0d0a 0d0a 6465 6620 706c  item......def pl
+00010a10: 6f74 2878 2c20 793d 4e6f 6e65 2c20 636f  ot(x, y=None, co
+00010a20: 6c6f 723d 4e6f 6e65 2c20 7769 6474 683d  lor=None, width=
+00010a30: 312c 2061 783d 4e6f 6e65 2c20 7374 796c  1, ax=None, styl
+00010a40: 653d 4e6f 6e65 2c20 6c65 6765 6e64 3d4e  e=None, legend=N
+00010a50: 6f6e 652c 207a 6f6f 6d73 6361 6c65 3d54  one, zoomscale=T
+00010a60: 7275 652c 202a 2a6b 7761 7267 7329 3a0d  rue, **kwargs):.
+00010a70: 0a20 2020 2061 7820 3d20 5f63 7265 6174  .    ax = _creat
+00010a80: 655f 706c 6f74 2861 783d 6178 2c20 6d61  e_plot(ax=ax, ma
+00010a90: 7869 6d69 7a65 3d46 616c 7365 290d 0a20  ximize=False).. 
+00010aa0: 2020 2075 7365 645f 636f 6c6f 7220 3d20     used_color = 
+00010ab0: 5f67 6574 5f63 6f6c 6f72 2861 782c 2073  _get_color(ax, s
+00010ac0: 7479 6c65 2c20 636f 6c6f 7229 0d0a 2020  tyle, color)..  
+00010ad0: 2020 6461 7461 7372 6320 3d20 5f63 7265    datasrc = _cre
+00010ae0: 6174 655f 6461 7461 7372 6328 6178 2c20  ate_datasrc(ax, 
+00010af0: 782c 2079 2c20 6e63 6f6c 733d 3129 0d0a  x, y, ncols=1)..
+00010b00: 2020 2020 6966 206e 6f74 207a 6f6f 6d73      if not zooms
+00010b10: 6361 6c65 3a0d 0a20 2020 2020 2020 2064  cale:..        d
+00010b20: 6174 6173 7263 2e73 6361 6c65 5f63 6f6c  atasrc.scale_col
+00010b30: 7320 3d20 5b5d 0d0a 2020 2020 5f73 6574  s = []..    _set
+00010b40: 5f64 6174 6173 7263 2861 782c 2064 6174  _datasrc(ax, dat
+00010b50: 6173 7263 290d 0a20 2020 2069 6620 6c65  asrc)..    if le
+00010b60: 6765 6e64 2069 7320 6e6f 7420 4e6f 6e65  gend is not None
+00010b70: 3a0d 0a20 2020 2020 2020 205f 6372 6561  :..        _crea
+00010b80: 7465 5f6c 6567 656e 6428 6178 290d 0a20  te_legend(ax).. 
+00010b90: 2020 2078 203d 2064 6174 6173 7263 2e78     x = datasrc.x
+00010ba0: 2069 6620 6e6f 7420 6178 2e76 622e 785f   if not ax.vb.x_
+00010bb0: 696e 6465 7865 6420 656c 7365 2064 6174  indexed else dat
+00010bc0: 6173 7263 2e69 6e64 6578 0d0a 2020 2020  asrc.index..    
+00010bd0: 7920 3d20 6461 7461 7372 632e 7920 2f20  y = datasrc.y / 
+00010be0: 6178 2e76 622e 7973 6361 6c65 2e73 6361  ax.vb.yscale.sca
+00010bf0: 6c65 660d 0a20 2020 2069 6620 6178 2e76  lef..    if ax.v
+00010c00: 622e 7973 6361 6c65 2e73 6361 6c65 7479  b.yscale.scalety
+00010c10: 7065 203d 3d20 276c 6f67 273a 0d0a 2020  pe == 'log':..  
+00010c20: 2020 2020 2020 7920 3d20 7920 2b20 6c6f        y = y + lo
+00010c30: 675f 706c 6f74 5f6f 6666 7365 740d 0a20  g_plot_offset.. 
+00010c40: 2020 2069 6620 7374 796c 6520 6973 204e     if style is N
+00010c50: 6f6e 6520 6f72 2061 6e79 2863 6820 696e  one or any(ch in
+00010c60: 2073 7479 6c65 2066 6f72 2063 6820 696e   style for ch in
+00010c70: 2027 2d5f 2e27 293a 0d0a 2020 2020 2020   '-_.'):..      
+00010c80: 2020 636f 6e6e 6563 745f 646f 7473 203d    connect_dots =
+00010c90: 2027 6669 6e69 7465 2720 2320 7361 6d65   'finite' # same
+00010ca0: 2061 7320 6d61 7470 6c6f 746c 6962 3b20   as matplotlib; 
+00010cb0: 7573 6520 6461 7461 7372 632e 7374 616e  use datasrc.stan
+00010cc0: 6461 6c6f 6e65 3d54 7275 6520 6966 2079  dalone=True if y
+00010cd0: 6f75 2077 616e 7420 746f 206b 6565 7020  ou want to keep 
+00010ce0: 7365 7061 7261 7465 2069 6e74 6572 7661  separate interva
+00010cf0: 6c73 206f 6e20 6120 706c 6f74 0d0a 2020  ls on a plot..  
+00010d00: 2020 2020 2020 6974 656d 203d 2061 782e        item = ax.
+00010d10: 706c 6f74 2878 2c20 792c 2070 656e 3d5f  plot(x, y, pen=_
+00010d20: 6d61 6b65 7065 6e28 636f 6c6f 723d 7573  makepen(color=us
+00010d30: 6564 5f63 6f6c 6f72 2c20 7374 796c 653d  ed_color, style=
+00010d40: 7374 796c 652c 2077 6964 7468 3d77 6964  style, width=wid
+00010d50: 7468 292c 206e 616d 653d 6c65 6765 6e64  th), name=legend
+00010d60: 2c20 636f 6e6e 6563 743d 636f 6e6e 6563  , connect=connec
+00010d70: 745f 646f 7473 290d 0a20 2020 2020 2020  t_dots)..       
+00010d80: 2069 7465 6d2e 7365 7443 6c69 7054 6f56   item.setClipToV
+00010d90: 6965 7728 5472 7565 290d 0a20 2020 2020  iew(True)..     
+00010da0: 2020 2069 7465 6d2e 7365 7444 6f77 6e73     item.setDowns
+00010db0: 616d 706c 696e 6728 6175 746f 3d54 7275  ampling(auto=Tru
+00010dc0: 652c 206d 6574 686f 643d 2773 7562 7361  e, method='subsa
+00010dd0: 6d70 6c65 2729 0d0a 2020 2020 2020 2020  mple')..        
+00010de0: 6974 656d 2e73 6574 5a56 616c 7565 2835  item.setZValue(5
+00010df0: 290d 0a20 2020 2065 6c73 653a 0d0a 2020  )..    else:..  
+00010e00: 2020 2020 2020 7379 6d62 6f6c 203d 207b        symbol = {
+00010e10: 2776 273a 2774 272c 2027 5e27 3a27 7431  'v':'t', '^':'t1
+00010e20: 272c 2027 3e27 3a27 7432 272c 2027 3c27  ', '>':'t2', '<'
+00010e30: 3a27 7433 277d 2e67 6574 2873 7479 6c65  :'t3'}.get(style
+00010e40: 2c20 7374 796c 6529 2023 2074 7261 6e73  , style) # trans
+00010e50: 6c61 7465 2073 6f6d 6520 7369 6d69 6c61  late some simila
+00010e60: 7220 7374 796c 6573 0d0a 2020 2020 2020  r styles..      
+00010e70: 2020 7966 696c 7465 7220 3d20 792e 6e6f    yfilter = y.no
+00010e80: 746e 756c 6c28 290d 0a20 2020 2020 2020  tnull()..       
+00010e90: 2073 6572 203d 2079 2e6c 6f63 5b79 6669   ser = y.loc[yfi
+00010ea0: 6c74 6572 5d0d 0a20 2020 2020 2020 2078  lter]..        x
+00010eb0: 203d 2078 2e6c 6f63 5b79 6669 6c74 6572   = x.loc[yfilter
+00010ec0: 5d2e 7661 6c75 6573 2069 6620 6861 7361  ].values if hasa
+00010ed0: 7474 7228 782c 2027 6c6f 6327 2920 656c  ttr(x, 'loc') el
+00010ee0: 7365 2078 5b79 6669 6c74 6572 5d0d 0a20  se x[yfilter].. 
+00010ef0: 2020 2020 2020 2069 7465 6d20 3d20 6178         item = ax
+00010f00: 2e70 6c6f 7428 782c 2073 6572 2e76 616c  .plot(x, ser.val
+00010f10: 7565 732c 2070 656e 3d4e 6f6e 652c 2073  ues, pen=None, s
+00010f20: 796d 626f 6c3d 7379 6d62 6f6c 2c20 7379  ymbol=symbol, sy
+00010f30: 6d62 6f6c 5065 6e3d 4e6f 6e65 2c20 7379  mbolPen=None, sy
+00010f40: 6d62 6f6c 5369 7a65 3d37 2a77 6964 7468  mbolSize=7*width
+00010f50: 2c20 7379 6d62 6f6c 4272 7573 683d 7067  , symbolBrush=pg
+00010f60: 2e6d 6b42 7275 7368 2875 7365 645f 636f  .mkBrush(used_co
+00010f70: 6c6f 7229 2c20 6e61 6d65 3d6c 6567 656e  lor), name=legen
+00010f80: 6429 0d0a 2020 2020 2020 2020 6966 2077  d)..        if w
+00010f90: 6964 7468 203c 2031 3a0d 0a20 2020 2020  idth < 1:..     
+00010fa0: 2020 2020 2020 2069 7465 6d2e 6f70 7473         item.opts
+00010fb0: 5b27 616e 7469 616c 6961 7327 5d20 3d20  ['antialias'] = 
+00010fc0: 5472 7565 0d0a 2020 2020 2020 2020 6974  True..        it
+00010fd0: 656d 2e73 6361 7474 6572 2e5f 646f 7061  em.scatter._dopa
+00010fe0: 696e 7420 3d20 6974 656d 2e73 6361 7474  int = item.scatt
+00010ff0: 6572 2e70 6169 6e74 0d0a 2020 2020 2020  er.paint..      
+00011000: 2020 6974 656d 2e73 6361 7474 6572 2e70    item.scatter.p
+00011010: 6169 6e74 203d 2070 6172 7469 616c 285f  aint = partial(_
+00011020: 7061 696e 745f 7363 6174 7465 722c 2069  paint_scatter, i
+00011030: 7465 6d2e 7363 6174 7465 7229 0d0a 2020  tem.scatter)..  
+00011040: 2020 2020 2020 2320 6f70 7469 6d69 7a65        # optimize
+00011050: 2028 7768 656e 2068 6176 696e 6720 6c61   (when having la
+00011060: 7267 6520 6e75 6d62 6572 206f 6620 706f  rge number of po
+00011070: 696e 7473 2920 6279 2069 676e 6f72 696e  ints) by ignorin
+00011080: 6720 7363 6174 7465 7220 636c 6963 6b20  g scatter click 
+00011090: 6465 7465 6374 696f 6e0d 0a20 2020 2020  detection..     
+000110a0: 2020 205f 6475 6d6d 795f 6d6f 7573 655f     _dummy_mouse_
+000110b0: 636c 6963 6b20 3d20 6c61 6d62 6461 2065  click = lambda e
+000110c0: 763a 2030 0d0a 2020 2020 2020 2020 6974  v: 0..        it
+000110d0: 656d 2e73 6361 7474 6572 2e6d 6f75 7365  em.scatter.mouse
+000110e0: 436c 6963 6b45 7665 6e74 203d 205f 6475  ClickEvent = _du
+000110f0: 6d6d 795f 6d6f 7573 655f 636c 6963 6b0d  mmy_mouse_click.
+00011100: 0a20 2020 2020 2020 2069 7465 6d2e 7365  .        item.se
+00011110: 745a 5661 6c75 6528 3130 290d 0a20 2020  tZValue(10)..   
+00011120: 2069 7465 6d2e 6f70 7473 5b27 6861 6e64   item.opts['hand
+00011130: 6564 5f63 6f6c 6f72 275d 203d 2063 6f6c  ed_color'] = col
+00011140: 6f72 0d0a 2020 2020 6974 656d 2e61 7820  or..    item.ax 
+00011150: 3d20 6178 0d0a 2020 2020 6974 656d 2e64  = ax..    item.d
+00011160: 6174 6173 7263 203d 2064 6174 6173 7263  atasrc = datasrc
+00011170: 0d0a 2020 2020 5f75 7064 6174 655f 7369  ..    _update_si
+00011180: 676e 6966 6963 616e 7473 2861 782c 2064  gnificants(ax, d
+00011190: 6174 6173 7263 2c20 666f 7263 653d 4661  atasrc, force=Fa
+000111a0: 6c73 6529 0d0a 2020 2020 6974 656d 2e75  lse)..    item.u
+000111b0: 7064 6174 655f 6461 7461 203d 2070 6172  pdate_data = par
+000111c0: 7469 616c 285f 7570 6461 7465 5f64 6174  tial(_update_dat
+000111d0: 612c 204e 6f6e 652c 204e 6f6e 652c 2069  a, None, None, i
+000111e0: 7465 6d29 0d0a 2020 2020 6974 656d 2e75  tem)..    item.u
+000111f0: 7064 6174 655f 6766 7820 3d20 7061 7274  pdate_gfx = part
+00011200: 6961 6c28 5f75 7064 6174 655f 6766 782c  ial(_update_gfx,
+00011210: 2069 7465 6d29 0d0a 2020 2020 2320 6164   item)..    # ad
+00011220: 6420 6c65 6765 6e64 2074 6f20 6d61 696e  d legend to main
+00011230: 2061 782c 206e 6f74 2074 6f20 6f76 6572   ax, not to over
+00011240: 6c61 790d 0a20 2020 2061 786d 203d 2061  lay..    axm = a
+00011250: 782e 7662 2e6d 6173 7465 725f 7669 6577  x.vb.master_view
+00011260: 626f 782e 7061 7265 6e74 2829 2069 6620  box.parent() if 
+00011270: 6178 2e76 622e 6d61 7374 6572 5f76 6965  ax.vb.master_vie
+00011280: 7762 6f78 2065 6c73 6520 6178 0d0a 2020  wbox else ax..  
+00011290: 2020 6966 2061 786d 2e6c 6567 656e 6420    if axm.legend 
+000112a0: 6973 206e 6f74 204e 6f6e 653a 0d0a 2020  is not None:..  
+000112b0: 2020 2020 2020 6966 206c 6567 656e 6420        if legend 
+000112c0: 616e 6420 6178 6d20 213d 2061 783a 0d0a  and axm != ax:..
+000112d0: 2020 2020 2020 2020 2020 2020 6178 6d2e              axm.
+000112e0: 6c65 6765 6e64 2e61 6464 4974 656d 2869  legend.addItem(i
+000112f0: 7465 6d2c 206e 616d 653d 6c65 6765 6e64  tem, name=legend
+00011300: 290d 0a20 2020 2020 2020 2066 6f72 205f  )..        for _
+00011310: 2c6c 6162 656c 2069 6e20 6178 6d2e 6c65  ,label in axm.le
+00011320: 6765 6e64 2e69 7465 6d73 3a0d 0a20 2020  gend.items:..   
+00011330: 2020 2020 2020 2020 2069 6620 6c61 6265           if labe
+00011340: 6c2e 7465 7874 203d 3d20 6c65 6765 6e64  l.text == legend
+00011350: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00011360: 2020 206c 6162 656c 2e73 6574 4174 7472     label.setAttr
+00011370: 2827 6a75 7374 6966 7927 2c20 276c 6566  ('justify', 'lef
+00011380: 7427 290d 0a20 2020 2020 2020 2020 2020  t')..           
+00011390: 2020 2020 206c 6162 656c 2e73 6574 5465       label.setTe
+000113a0: 7874 286c 6162 656c 2e74 6578 742c 2063  xt(label.text, c
+000113b0: 6f6c 6f72 3d6c 6567 656e 645f 7465 7874  olor=legend_text
+000113c0: 5f63 6f6c 6f72 290d 0a20 2020 2072 6574  _color)..    ret
+000113d0: 7572 6e20 6974 656d 0d0a 0d0a 0d0a 6465  urn item......de
+000113e0: 6620 6c61 6265 6c73 2878 2c20 793d 4e6f  f labels(x, y=No
+000113f0: 6e65 2c20 6c61 6265 6c73 3d4e 6f6e 652c  ne, labels=None,
+00011400: 2063 6f6c 6f72 3d4e 6f6e 652c 2061 783d   color=None, ax=
+00011410: 4e6f 6e65 2c20 616e 6368 6f72 3d28 302e  None, anchor=(0.
+00011420: 352c 3129 293a 0d0a 2020 2020 6178 203d  5,1)):..    ax =
+00011430: 205f 6372 6561 7465 5f70 6c6f 7428 6178   _create_plot(ax
+00011440: 3d61 782c 206d 6178 696d 697a 653d 4661  =ax, maximize=Fa
+00011450: 6c73 6529 0d0a 2020 2020 7573 6564 5f63  lse)..    used_c
+00011460: 6f6c 6f72 203d 205f 6765 745f 636f 6c6f  olor = _get_colo
+00011470: 7228 6178 2c20 273f 272c 2063 6f6c 6f72  r(ax, '?', color
+00011480: 290d 0a20 2020 2064 6174 6173 7263 203d  )..    datasrc =
+00011490: 205f 6372 6561 7465 5f64 6174 6173 7263   _create_datasrc
+000114a0: 2861 782c 2078 2c20 792c 206c 6162 656c  (ax, x, y, label
+000114b0: 732c 206e 636f 6c73 3d33 290d 0a20 2020  s, ncols=3)..   
+000114c0: 2064 6174 6173 7263 2e73 6361 6c65 5f63   datasrc.scale_c
+000114d0: 6f6c 7320 3d20 5b5d 2023 2064 6f6e 2774  ols = [] # don't
+000114e0: 2075 7365 2074 6869 7320 666f 7220 7363   use this for sc
+000114f0: 616c 696e 670d 0a20 2020 205f 7365 745f  aling..    _set_
+00011500: 6461 7461 7372 6328 6178 2c20 6461 7461  datasrc(ax, data
+00011510: 7372 6329 0d0a 2020 2020 6974 656d 203d  src)..    item =
+00011520: 2053 6361 7474 6572 4c61 6265 6c49 7465   ScatterLabelIte
+00011530: 6d28 6178 3d61 782c 2064 6174 6173 7263  m(ax=ax, datasrc
+00011540: 3d64 6174 6173 7263 2c20 636f 6c6f 723d  =datasrc, color=
+00011550: 7573 6564 5f63 6f6c 6f72 2c20 616e 6368  used_color, anch
+00011560: 6f72 3d61 6e63 686f 7229 0d0a 2020 2020  or=anchor)..    
+00011570: 5f75 7064 6174 655f 7369 676e 6966 6963  _update_signific
+00011580: 616e 7473 2861 782c 2064 6174 6173 7263  ants(ax, datasrc
+00011590: 2c20 666f 7263 653d 4661 6c73 6529 0d0a  , force=False)..
+000115a0: 2020 2020 6974 656d 2e75 7064 6174 655f      item.update_
+000115b0: 6461 7461 203d 2070 6172 7469 616c 285f  data = partial(_
+000115c0: 7570 6461 7465 5f64 6174 612c 204e 6f6e  update_data, Non
+000115d0: 652c 204e 6f6e 652c 2069 7465 6d29 0d0a  e, None, item)..
+000115e0: 2020 2020 6974 656d 2e75 7064 6174 655f      item.update_
+000115f0: 6766 7820 3d20 7061 7274 6961 6c28 5f75  gfx = partial(_u
+00011600: 7064 6174 655f 6766 782c 2069 7465 6d29  pdate_gfx, item)
+00011610: 0d0a 2020 2020 6178 2e61 6464 4974 656d  ..    ax.addItem
+00011620: 2869 7465 6d29 0d0a 2020 2020 6966 2061  (item)..    if a
+00011630: 782e 7662 2e76 5f7a 6f6f 6d5f 7363 616c  x.vb.v_zoom_scal
+00011640: 6520 3e20 302e 393a 2023 2061 646a 7573  e > 0.9: # adjus
+00011650: 7420 746f 206d 616b 6520 6869 2f6c 6f20  t to make hi/lo 
+00011660: 7465 7874 2066 6974 0d0a 2020 2020 2020  text fit..      
+00011670: 2020 6178 2e76 622e 765f 7a6f 6f6d 5f73    ax.vb.v_zoom_s
+00011680: 6361 6c65 203d 2030 2e39 0d0a 2020 2020  cale = 0.9..    
+00011690: 7265 7475 726e 2069 7465 6d0d 0a0d 0a0d  return item.....
+000116a0: 0a64 6566 206c 6976 6528 706c 6f74 733d  .def live(plots=
+000116b0: 3129 3a0d 0a20 2020 2069 6620 706c 6f74  1):..    if plot
+000116c0: 7320 3d3d 2031 3a0d 0a20 2020 2020 2020  s == 1:..       
+000116d0: 2072 6574 7572 6e20 4c69 7665 2829 0d0a   return Live()..
+000116e0: 2020 2020 7265 7475 726e 205b 4c69 7665      return [Live
+000116f0: 2829 2066 6f72 205f 2069 6e20 7261 6e67  () for _ in rang
+00011700: 6528 706c 6f74 7329 5d0d 0a0d 0a0d 0a64  e(plots)]......d
+00011710: 6566 2061 6464 5f6c 6567 656e 6428 7465  ef add_legend(te
+00011720: 7874 2c20 6178 3d4e 6f6e 6529 3a0d 0a20  xt, ax=None):.. 
+00011730: 2020 2061 7820 3d20 5f63 7265 6174 655f     ax = _create_
+00011740: 706c 6f74 2861 783d 6178 2c20 6d61 7869  plot(ax=ax, maxi
+00011750: 6d69 7a65 3d46 616c 7365 290d 0a20 2020  mize=False)..   
+00011760: 205f 6372 6561 7465 5f6c 6567 656e 6428   _create_legend(
+00011770: 6178 290d 0a20 2020 2072 6f77 203d 2061  ax)..    row = a
+00011780: 782e 6c65 6765 6e64 2e6c 6179 6f75 742e  x.legend.layout.
+00011790: 726f 7743 6f75 6e74 2829 0d0a 2020 2020  rowCount()..    
+000117a0: 6c61 6265 6c20 3d20 7067 2e4c 6162 656c  label = pg.Label
+000117b0: 4974 656d 2874 6578 742c 2063 6f6c 6f72  Item(text, color
+000117c0: 3d6c 6567 656e 645f 7465 7874 5f63 6f6c  =legend_text_col
+000117d0: 6f72 2c20 6a75 7374 6966 793d 276c 6566  or, justify='lef
+000117e0: 7427 290d 0a20 2020 2061 782e 6c65 6765  t')..    ax.lege
+000117f0: 6e64 2e6c 6179 6f75 742e 6164 6449 7465  nd.layout.addIte
+00011800: 6d28 6c61 6265 6c2c 2072 6f77 2c20 302c  m(label, row, 0,
+00011810: 2031 2c20 3229 0d0a 2020 2020 7265 7475   1, 2)..    retu
+00011820: 726e 206c 6162 656c 0d0a 0d0a 0d0a 6465  rn label......de
+00011830: 6620 6669 6c6c 5f62 6574 7765 656e 2870  f fill_between(p
+00011840: 6c6f 7430 2c20 706c 6f74 312c 2063 6f6c  lot0, plot1, col
+00011850: 6f72 3d4e 6f6e 6529 3a0d 0a20 2020 2075  or=None):..    u
+00011860: 7365 645f 636f 6c6f 7220 3d20 6272 6967  sed_color = brig
+00011870: 6874 656e 285f 6765 745f 636f 6c6f 7228  hten(_get_color(
+00011880: 706c 6f74 302e 6178 2c20 4e6f 6e65 2c20  plot0.ax, None, 
+00011890: 636f 6c6f 7229 2c20 312e 3329 0d0a 2020  color), 1.3)..  
+000118a0: 2020 6974 656d 203d 2070 672e 4669 6c6c    item = pg.Fill
+000118b0: 4265 7477 6565 6e49 7465 6d28 706c 6f74  BetweenItem(plot
+000118c0: 302c 2070 6c6f 7431 2c20 6272 7573 683d  0, plot1, brush=
+000118d0: 7067 2e6d 6b42 7275 7368 2875 7365 645f  pg.mkBrush(used_
+000118e0: 636f 6c6f 7229 290d 0a20 2020 2069 7465  color))..    ite
+000118f0: 6d2e 6178 203d 2070 6c6f 7430 2e61 780d  m.ax = plot0.ax.
+00011900: 0a20 2020 2069 7465 6d2e 7365 745a 5661  .    item.setZVa
+00011910: 6c75 6528 2d34 3029 0d0a 2020 2020 6974  lue(-40)..    it
+00011920: 656d 2e61 782e 6164 6449 7465 6d28 6974  em.ax.addItem(it
+00011930: 656d 290d 0a20 2020 2072 6574 7572 6e20  em)..    return 
+00011940: 6974 656d 0d0a 0d0a 0d0a 6465 6620 7365  item......def se
+00011950: 745f 785f 706f 7328 786d 696e 2c20 786d  t_x_pos(xmin, xm
+00011960: 6178 2c20 6178 3d4e 6f6e 6529 3a0d 0a20  ax, ax=None):.. 
+00011970: 2020 2061 7820 3d20 5f63 7265 6174 655f     ax = _create_
+00011980: 706c 6f74 2861 783d 6178 2c20 6d61 7869  plot(ax=ax, maxi
+00011990: 6d69 7a65 3d46 616c 7365 290d 0a20 2020  mize=False)..   
+000119a0: 2078 6964 7830 2c78 6964 7831 203d 205f   xidx0,xidx1 = _
+000119b0: 7064 7469 6d65 3269 6e64 6578 2861 782c  pdtime2index(ax,
+000119c0: 2070 642e 5365 7269 6573 285b 786d 696e   pd.Series([xmin
+000119d0: 2c20 786d 6178 5d29 290d 0a20 2020 2061  , xmax]))..    a
+000119e0: 782e 7662 2e75 7064 6174 655f 795f 7a6f  x.vb.update_y_zo
+000119f0: 6f6d 2878 6964 7830 2c20 7869 6478 3129  om(xidx0, xidx1)
+00011a00: 0d0a 2020 2020 5f72 6570 6169 6e74 5f63  ..    _repaint_c
+00011a10: 616e 646c 6573 2829 0d0a 0d0a 0d0a 6465  andles()......de
+00011a20: 6620 7365 745f 795f 7261 6e67 6528 796d  f set_y_range(ym
+00011a30: 696e 2c20 796d 6178 2c20 6178 3d4e 6f6e  in, ymax, ax=Non
+00011a40: 6529 3a0d 0a20 2020 2061 7820 3d20 5f63  e):..    ax = _c
+00011a50: 7265 6174 655f 706c 6f74 2861 783d 6178  reate_plot(ax=ax
+00011a60: 2c20 6d61 7869 6d69 7a65 3d46 616c 7365  , maximize=False
+00011a70: 290d 0a20 2020 2061 782e 7365 744c 696d  )..    ax.setLim
+00011a80: 6974 7328 794d 696e 3d79 6d69 6e2c 2079  its(yMin=ymin, y
+00011a90: 4d61 783d 796d 6178 290d 0a20 2020 2061  Max=ymax)..    a
+00011aa0: 782e 7662 2e76 5f61 7574 6f7a 6f6f 6d20  x.vb.v_autozoom 
+00011ab0: 3d20 4661 6c73 650d 0a20 2020 2061 782e  = False..    ax.
+00011ac0: 7662 2e73 6574 5f72 616e 6765 284e 6f6e  vb.set_range(Non
+00011ad0: 652c 2079 6d69 6e2c 204e 6f6e 652c 2079  e, ymin, None, y
+00011ae0: 6d61 7829 0d0a 0d0a 0d0a 6465 6620 7365  max)......def se
+00011af0: 745f 795f 7363 616c 6528 7973 6361 6c65  t_y_scale(yscale
+00011b00: 3d27 6c69 6e65 6172 272c 2061 783d 4e6f  ='linear', ax=No
+00011b10: 6e65 293a 0d0a 2020 2020 6178 203d 205f  ne):..    ax = _
+00011b20: 6372 6561 7465 5f70 6c6f 7428 6178 3d61  create_plot(ax=a
+00011b30: 782c 206d 6178 696d 697a 653d 4661 6c73  x, maximize=Fals
+00011b40: 6529 0d0a 2020 2020 6178 2e73 6574 4c6f  e)..    ax.setLo
+00011b50: 674d 6f64 6528 793d 2879 7363 616c 653d  gMode(y=(yscale=
+00011b60: 3d27 6c6f 6727 2929 0d0a 2020 2020 6178  ='log'))..    ax
+00011b70: 2e76 622e 7973 6361 6c65 203d 2059 5363  .vb.yscale = YSc
+00011b80: 616c 6528 7973 6361 6c65 2c20 6178 2e76  ale(yscale, ax.v
+00011b90: 622e 7973 6361 6c65 2e73 6361 6c65 6629  b.yscale.scalef)
+00011ba0: 0d0a 0d0a 0d0a 6465 6620 6164 645f 6261  ......def add_ba
+00011bb0: 6e64 2879 302c 2079 312c 2063 6f6c 6f72  nd(y0, y1, color
+00011bc0: 3d62 616e 645f 636f 6c6f 722c 2061 783d  =band_color, ax=
+00011bd0: 4e6f 6e65 293a 0d0a 2020 2020 6178 203d  None):..    ax =
+00011be0: 205f 6372 6561 7465 5f70 6c6f 7428 6178   _create_plot(ax
+00011bf0: 3d61 782c 206d 6178 696d 697a 653d 4661  =ax, maximize=Fa
+00011c00: 6c73 6529 0d0a 2020 2020 636f 6c6f 7220  lse)..    color 
+00011c10: 3d20 5f67 6574 5f63 6f6c 6f72 2861 782c  = _get_color(ax,
+00011c20: 204e 6f6e 652c 2063 6f6c 6f72 290d 0a20   None, color).. 
+00011c30: 2020 2069 7820 3d20 6178 2e76 622e 7973     ix = ax.vb.ys
+00011c40: 6361 6c65 2e69 6e76 7866 6f72 6d0d 0a20  cale.invxform.. 
+00011c50: 2020 206c 7220 3d20 7067 2e4c 696e 6561     lr = pg.Linea
+00011c60: 7252 6567 696f 6e49 7465 6d28 5b69 7828  rRegionItem([ix(
+00011c70: 7930 292c 6978 2879 3129 5d2c 206f 7269  y0),ix(y1)], ori
+00011c80: 656e 7461 7469 6f6e 3d70 672e 4c69 6e65  entation=pg.Line
+00011c90: 6172 5265 6769 6f6e 4974 656d 2e48 6f72  arRegionItem.Hor
+00011ca0: 697a 6f6e 7461 6c2c 2062 7275 7368 3d70  izontal, brush=p
+00011cb0: 672e 6d6b 4272 7573 6828 636f 6c6f 7229  g.mkBrush(color)
+00011cc0: 2c20 6d6f 7661 626c 653d 4661 6c73 6529  , movable=False)
+00011cd0: 0d0a 2020 2020 6c72 2e6c 696e 6573 5b30  ..    lr.lines[0
+00011ce0: 5d2e 7365 7450 656e 2870 672e 6d6b 5065  ].setPen(pg.mkPe
+00011cf0: 6e28 4e6f 6e65 2929 0d0a 2020 2020 6c72  n(None))..    lr
+00011d00: 2e6c 696e 6573 5b31 5d2e 7365 7450 656e  .lines[1].setPen
+00011d10: 2870 672e 6d6b 5065 6e28 4e6f 6e65 2929  (pg.mkPen(None))
+00011d20: 0d0a 2020 2020 6c72 2e73 6574 5a56 616c  ..    lr.setZVal
+00011d30: 7565 282d 3530 290d 0a20 2020 206c 722e  ue(-50)..    lr.
+00011d40: 6178 203d 2061 780d 0a20 2020 2061 782e  ax = ax..    ax.
+00011d50: 6164 6449 7465 6d28 6c72 290d 0a20 2020  addItem(lr)..   
+00011d60: 2072 6574 7572 6e20 6c72 0d0a 0d0a 0d0a   return lr......
+00011d70: 6465 6620 6164 645f 7265 6374 2870 302c  def add_rect(p0,
+00011d80: 2070 312c 2063 6f6c 6f72 3d62 616e 645f   p1, color=band_
+00011d90: 636f 6c6f 722c 2069 6e74 6572 6163 7469  color, interacti
+00011da0: 7665 3d46 616c 7365 2c20 6178 3d4e 6f6e  ve=False, ax=Non
+00011db0: 6529 3a0d 0a20 2020 2061 7820 3d20 5f63  e):..    ax = _c
+00011dc0: 7265 6174 655f 706c 6f74 2861 783d 6178  reate_plot(ax=ax
+00011dd0: 2c20 6d61 7869 6d69 7a65 3d46 616c 7365  , maximize=False
+00011de0: 290d 0a20 2020 2078 5f70 7473 203d 205f  )..    x_pts = _
+00011df0: 7064 7469 6d65 3269 6e64 6578 2861 782c  pdtime2index(ax,
+00011e00: 2070 642e 5365 7269 6573 285b 7030 5b30   pd.Series([p0[0
+00011e10: 5d2c 2070 315b 305d 5d29 290d 0a20 2020  ], p1[0]]))..   
+00011e20: 2069 7820 3d20 6178 2e76 622e 7973 6361   ix = ax.vb.ysca
+00011e30: 6c65 2e69 6e76 7866 6f72 6d0d 0a20 2020  le.invxform..   
+00011e40: 2079 302c 7931 203d 2073 6f72 7465 6428   y0,y1 = sorted(
+00011e50: 5b70 305b 315d 2c20 7031 5b31 5d5d 290d  [p0[1], p1[1]]).
+00011e60: 0a20 2020 2070 6f73 2020 3d20 2878 5f70  .    pos  = (x_p
+00011e70: 7473 5b30 5d2c 2069 7828 7930 2929 0d0a  ts[0], ix(y0))..
+00011e80: 2020 2020 7369 7a65 203d 2028 785f 7074      size = (x_pt
+00011e90: 735b 315d 2d70 6f73 5b30 5d2c 2069 7828  s[1]-pos[0], ix(
+00011ea0: 7931 292d 6978 2879 3029 290d 0a20 2020  y1)-ix(y0))..   
+00011eb0: 2072 6563 7420 3d20 4669 6e52 6563 7428   rect = FinRect(
+00011ec0: 6178 3d61 782c 2062 7275 7368 3d70 672e  ax=ax, brush=pg.
+00011ed0: 6d6b 4272 7573 6828 636f 6c6f 7229 2c20  mkBrush(color), 
+00011ee0: 706f 733d 706f 732c 2073 697a 653d 7369  pos=pos, size=si
+00011ef0: 7a65 2c20 6d6f 7661 626c 653d 696e 7465  ze, movable=inte
+00011f00: 7261 6374 6976 652c 2072 6573 697a 6162  ractive, resizab
+00011f10: 6c65 3d69 6e74 6572 6163 7469 7665 2c20  le=interactive, 
+00011f20: 726f 7461 7461 626c 653d 4661 6c73 6529  rotatable=False)
+00011f30: 0d0a 2020 2020 7265 6374 2e73 6574 5a56  ..    rect.setZV
+00011f40: 616c 7565 282d 3430 290d 0a20 2020 2069  alue(-40)..    i
+00011f50: 6620 696e 7465 7261 6374 6976 653a 0d0a  f interactive:..
+00011f60: 2020 2020 2020 2020 6178 2e76 622e 726f          ax.vb.ro
+00011f70: 6973 2e61 7070 656e 6428 7265 6374 290d  is.append(rect).
+00011f80: 0a20 2020 2072 6563 742e 6178 203d 2061  .    rect.ax = a
+00011f90: 780d 0a20 2020 2061 782e 6164 6449 7465  x..    ax.addIte
+00011fa0: 6d28 7265 6374 290d 0a20 2020 2072 6574  m(rect)..    ret
+00011fb0: 7572 6e20 7265 6374 0d0a 0d0a 0d0a 6465  urn rect......de
+00011fc0: 6620 6164 645f 6c69 6e65 2870 302c 2070  f add_line(p0, p
+00011fd0: 312c 2063 6f6c 6f72 3d64 7261 775f 6c69  1, color=draw_li
+00011fe0: 6e65 5f63 6f6c 6f72 2c20 7769 6474 683d  ne_color, width=
+00011ff0: 312c 2073 7479 6c65 3d4e 6f6e 652c 2069  1, style=None, i
+00012000: 6e74 6572 6163 7469 7665 3d46 616c 7365  nteractive=False
+00012010: 2c20 6178 3d4e 6f6e 6529 3a0d 0a20 2020  , ax=None):..   
+00012020: 2061 7820 3d20 5f63 7265 6174 655f 706c   ax = _create_pl
+00012030: 6f74 2861 783d 6178 2c20 6d61 7869 6d69  ot(ax=ax, maximi
+00012040: 7a65 3d46 616c 7365 290d 0a20 2020 2075  ze=False)..    u
+00012050: 7365 645f 636f 6c6f 7220 3d20 5f67 6574  sed_color = _get
+00012060: 5f63 6f6c 6f72 2861 782c 2073 7479 6c65  _color(ax, style
+00012070: 2c20 636f 6c6f 7229 0d0a 2020 2020 7065  , color)..    pe
+00012080: 6e20 3d20 5f6d 616b 6570 656e 2863 6f6c  n = _makepen(col
+00012090: 6f72 3d75 7365 645f 636f 6c6f 722c 2073  or=used_color, s
+000120a0: 7479 6c65 3d73 7479 6c65 2c20 7769 6474  tyle=style, widt
+000120b0: 683d 7769 6474 6829 0d0a 2020 2020 785f  h=width)..    x_
+000120c0: 7074 7320 3d20 5f70 6474 696d 6532 696e  pts = _pdtime2in
+000120d0: 6465 7828 6178 2c20 7064 2e53 6572 6965  dex(ax, pd.Serie
+000120e0: 7328 5b70 305b 305d 2c20 7031 5b30 5d5d  s([p0[0], p1[0]]
+000120f0: 2929 0d0a 2020 2020 6978 203d 2061 782e  ))..    ix = ax.
+00012100: 7662 2e79 7363 616c 652e 696e 7678 666f  vb.yscale.invxfo
+00012110: 726d 0d0a 2020 2020 7074 7320 3d20 5b28  rm..    pts = [(
+00012120: 785f 7074 735b 305d 2c20 6978 2870 305b  x_pts[0], ix(p0[
+00012130: 315d 2929 2c20 2878 5f70 7473 5b31 5d2c  1])), (x_pts[1],
+00012140: 2069 7828 7031 5b31 5d29 295d 0d0a 2020   ix(p1[1]))]..  
+00012150: 2020 6966 2069 6e74 6572 6163 7469 7665    if interactive
+00012160: 3a0d 0a20 2020 2020 2020 206c 696e 6520  :..        line 
+00012170: 3d20 4669 6e50 6f6c 794c 696e 6528 6178  = FinPolyLine(ax
+00012180: 2e76 622c 2070 7473 2c20 636c 6f73 6564  .vb, pts, closed
+00012190: 3d46 616c 7365 2c20 7065 6e3d 7065 6e2c  =False, pen=pen,
+000121a0: 206d 6f76 6162 6c65 3d46 616c 7365 290d   movable=False).
+000121b0: 0a20 2020 2020 2020 2061 782e 7662 2e72  .        ax.vb.r
+000121c0: 6f69 732e 6170 7065 6e64 286c 696e 6529  ois.append(line)
+000121d0: 0d0a 2020 2020 656c 7365 3a0d 0a20 2020  ..    else:..   
+000121e0: 2020 2020 206c 696e 6520 3d20 4669 6e4c       line = FinL
+000121f0: 696e 6528 7074 732c 2070 656e 3d70 656e  ine(pts, pen=pen
+00012200: 290d 0a20 2020 206c 696e 652e 6178 203d  )..    line.ax =
+00012210: 2061 780d 0a20 2020 2061 782e 7662 2e61   ax..    ax.vb.a
+00012220: 6464 4974 656d 286c 696e 6529 0d0a 2020  ddItem(line)..  
+00012230: 2020 7265 7475 726e 206c 696e 650d 0a0d    return line...
+00012240: 0a0d 0a64 6566 2061 6464 5f74 6578 7428  ...def add_text(
+00012250: 706f 732c 2073 2c20 636f 6c6f 723d 6472  pos, s, color=dr
+00012260: 6177 5f6c 696e 655f 636f 6c6f 722c 2061  aw_line_color, a
+00012270: 6e63 686f 723d 2830 2c30 292c 2061 783d  nchor=(0,0), ax=
+00012280: 4e6f 6e65 293a 0d0a 2020 2020 6178 203d  None):..    ax =
+00012290: 205f 6372 6561 7465 5f70 6c6f 7428 6178   _create_plot(ax
+000122a0: 3d61 782c 206d 6178 696d 697a 653d 4661  =ax, maximize=Fa
+000122b0: 6c73 6529 0d0a 2020 2020 636f 6c6f 7220  lse)..    color 
+000122c0: 3d20 5f67 6574 5f63 6f6c 6f72 2861 782c  = _get_color(ax,
+000122d0: 204e 6f6e 652c 2063 6f6c 6f72 290d 0a20   None, color).. 
+000122e0: 2020 2074 6578 7420 3d20 7067 2e54 6578     text = pg.Tex
+000122f0: 7449 7465 6d28 732c 2063 6f6c 6f72 3d63  tItem(s, color=c
+00012300: 6f6c 6f72 2c20 616e 6368 6f72 3d61 6e63  olor, anchor=anc
+00012310: 686f 7229 0d0a 2020 2020 7820 3d20 706f  hor)..    x = po
+00012320: 735b 305d 0d0a 2020 2020 6966 2061 782e  s[0]..    if ax.
+00012330: 7662 2e64 6174 6173 7263 2069 7320 6e6f  vb.datasrc is no
+00012340: 7420 4e6f 6e65 3a0d 0a20 2020 2020 2020  t None:..       
+00012350: 2078 203d 205f 7064 7469 6d65 3269 6e64   x = _pdtime2ind
+00012360: 6578 2861 782c 2070 642e 5365 7269 6573  ex(ax, pd.Series
+00012370: 285b 706f 735b 305d 5d29 295b 305d 0d0a  ([pos[0]]))[0]..
+00012380: 2020 2020 7920 3d20 6178 2e76 622e 7973      y = ax.vb.ys
+00012390: 6361 6c65 2e69 6e76 7866 6f72 6d28 706f  cale.invxform(po
+000123a0: 735b 315d 290d 0a20 2020 2074 6578 742e  s[1])..    text.
+000123b0: 7365 7450 6f73 2878 2c20 7929 0d0a 2020  setPos(x, y)..  
+000123c0: 2020 7465 7874 2e73 6574 5a56 616c 7565    text.setZValue
+000123d0: 2835 3029 0d0a 2020 2020 7465 7874 2e61  (50)..    text.a
+000123e0: 7820 3d20 6178 0d0a 2020 2020 6178 2e61  x = ax..    ax.a
+000123f0: 6464 4974 656d 2874 6578 742c 2069 676e  ddItem(text, ign
+00012400: 6f72 6542 6f75 6e64 733d 5472 7565 290d  oreBounds=True).
+00012410: 0a20 2020 2072 6574 7572 6e20 7465 7874  .    return text
+00012420: 0d0a 0d0a 0d0a 6465 6620 7265 6d6f 7665  ......def remove
+00012430: 5f6c 696e 6528 6c69 6e65 293a 0d0a 2020  _line(line):..  
+00012440: 2020 7072 696e 7428 2772 656d 6f76 655f    print('remove_
+00012450: 6c69 6e65 2829 2069 7320 6465 7072 6563  line() is deprec
+00012460: 6174 6564 2c20 7573 6520 7265 6d6f 7665  ated, use remove
+00012470: 5f70 7269 6d69 7469 7665 2829 2069 6e73  _primitive() ins
+00012480: 7465 6164 2729 0d0a 2020 2020 7265 6d6f  tead')..    remo
+00012490: 7665 5f70 7269 6d69 7469 7665 286c 696e  ve_primitive(lin
+000124a0: 6529 0d0a 0d0a 0d0a 6465 6620 7265 6d6f  e)......def remo
+000124b0: 7665 5f74 6578 7428 7465 7874 293a 0d0a  ve_text(text):..
+000124c0: 2020 2020 7072 696e 7428 2772 656d 6f76      print('remov
+000124d0: 655f 7465 7874 2829 2069 7320 6465 7072  e_text() is depr
+000124e0: 6563 6174 6564 2c20 7573 6520 7265 6d6f  ecated, use remo
+000124f0: 7665 5f70 7269 6d69 7469 7665 2829 2069  ve_primitive() i
+00012500: 6e73 7465 6164 2729 0d0a 2020 2020 7265  nstead')..    re
+00012510: 6d6f 7665 5f70 7269 6d69 7469 7665 2874  move_primitive(t
+00012520: 6578 7429 0d0a 0d0a 0d0a 6465 6620 7265  ext)......def re
+00012530: 6d6f 7665 5f70 7269 6d69 7469 7665 2870  move_primitive(p
+00012540: 7269 6d69 7469 7665 293a 0d0a 2020 2020  rimitive):..    
+00012550: 6178 203d 2070 7269 6d69 7469 7665 2e61  ax = primitive.a
+00012560: 780d 0a20 2020 2061 782e 7662 2e72 656d  x..    ax.vb.rem
+00012570: 6f76 6549 7465 6d28 7072 696d 6974 6976  oveItem(primitiv
+00012580: 6529 0d0a 2020 2020 6966 2070 7269 6d69  e)..    if primi
+00012590: 7469 7665 2069 6e20 6178 2e76 622e 726f  tive in ax.vb.ro
+000125a0: 6973 3a0d 0a20 2020 2020 2020 2061 782e  is:..        ax.
+000125b0: 7662 2e72 6f69 732e 7265 6d6f 7665 2870  vb.rois.remove(p
+000125c0: 7269 6d69 7469 7665 290d 0a20 2020 2069  rimitive)..    i
+000125d0: 6620 6861 7361 7474 7228 7072 696d 6974  f hasattr(primit
+000125e0: 6976 652c 2027 7465 7874 7327 293a 0d0a  ive, 'texts'):..
+000125f0: 2020 2020 2020 2020 666f 7220 7478 7420          for txt 
+00012600: 696e 2070 7269 6d69 7469 7665 2e74 6578  in primitive.tex
+00012610: 7473 3a0d 0a20 2020 2020 2020 2020 2020  ts:..           
+00012620: 2061 782e 7662 2e72 656d 6f76 6549 7465   ax.vb.removeIte
+00012630: 6d28 7478 7429 0d0a 0d0a 0d0a 6465 6620  m(txt)......def 
+00012640: 7365 745f 7469 6d65 5f69 6e73 7065 6374  set_time_inspect
+00012650: 6f72 2869 6e73 7065 6374 6f72 2c20 6178  or(inspector, ax
+00012660: 3d4e 6f6e 652c 2077 6865 6e3d 2763 6c69  =None, when='cli
+00012670: 636b 2729 3a0d 0a20 2020 2027 2727 4361  ck'):..    '''Ca
+00012680: 6c6c 6261 636b 2077 6865 6e20 636c 6963  llback when clic
+00012690: 6b65 6420 6c69 6b65 2073 6f3a 2069 6e73  ked like so: ins
+000126a0: 7065 6374 6f72 2878 2c20 7929 2e27 2727  pector(x, y).'''
+000126b0: 0d0a 2020 2020 6178 203d 2061 7820 6966  ..    ax = ax if
+000126c0: 2061 7820 656c 7365 206c 6173 745f 6178   ax else last_ax
+000126d0: 0d0a 2020 2020 6d61 7374 6572 203d 2061  ..    master = a
+000126e0: 782e 6178 5f77 6964 6765 7420 6966 2068  x.ax_widget if h
+000126f0: 6173 6174 7472 2861 782c 2027 6178 5f77  asattr(ax, 'ax_w
+00012700: 6964 6765 7427 2920 656c 7365 2061 782e  idget') else ax.
+00012710: 7662 2e77 696e 0d0a 2020 2020 6966 2077  vb.win..    if w
+00012720: 6865 6e20 3d3d 2027 686f 7665 7227 3a0d  hen == 'hover':.
+00012730: 0a20 2020 2020 2020 206d 6173 7465 722e  .        master.
+00012740: 7072 6f78 795f 686f 7665 7220 3d20 7067  proxy_hover = pg
+00012750: 2e53 6967 6e61 6c50 726f 7879 286d 6173  .SignalProxy(mas
+00012760: 7465 722e 7363 656e 6528 292e 7369 674d  ter.scene().sigM
+00012770: 6f75 7365 4d6f 7665 642c 2072 6174 654c  ouseMoved, rateL
+00012780: 696d 6974 3d31 352c 2073 6c6f 743d 7061  imit=15, slot=pa
+00012790: 7274 6961 6c28 5f69 6e73 7065 6374 5f70  rtial(_inspect_p
+000127a0: 6f73 2c20 6178 2c20 696e 7370 6563 746f  os, ax, inspecto
+000127b0: 7229 290d 0a20 2020 2065 6c69 6620 7768  r))..    elif wh
+000127c0: 656e 2069 6e20 2827 6463 6c69 636b 272c  en in ('dclick',
+000127d0: 2027 646f 7562 6c65 2d63 6c69 636b 2729   'double-click')
+000127e0: 3a0d 0a20 2020 2020 2020 206d 6173 7465  :..        maste
+000127f0: 722e 7072 6f78 795f 6463 6c69 636b 203d  r.proxy_dclick =
+00012800: 2070 672e 5369 676e 616c 5072 6f78 7928   pg.SignalProxy(
+00012810: 6d61 7374 6572 2e73 6365 6e65 2829 2e73  master.scene().s
+00012820: 6967 4d6f 7573 6543 6c69 636b 6564 2c20  igMouseClicked, 
+00012830: 736c 6f74 3d70 6172 7469 616c 285f 696e  slot=partial(_in
+00012840: 7370 6563 745f 636c 6963 6b65 642c 2061  spect_clicked, a
+00012850: 782c 2069 6e73 7065 6374 6f72 2c20 5472  x, inspector, Tr
+00012860: 7565 2929 0d0a 2020 2020 656c 7365 3a0d  ue))..    else:.
+00012870: 0a20 2020 2020 2020 206d 6173 7465 722e  .        master.
+00012880: 7072 6f78 795f 636c 6963 6b20 3d20 7067  proxy_click = pg
+00012890: 2e53 6967 6e61 6c50 726f 7879 286d 6173  .SignalProxy(mas
+000128a0: 7465 722e 7363 656e 6528 292e 7369 674d  ter.scene().sigM
+000128b0: 6f75 7365 436c 6963 6b65 642c 2073 6c6f  ouseClicked, slo
+000128c0: 743d 7061 7274 6961 6c28 5f69 6e73 7065  t=partial(_inspe
+000128d0: 6374 5f63 6c69 636b 6564 2c20 6178 2c20  ct_clicked, ax, 
+000128e0: 696e 7370 6563 746f 722c 2046 616c 7365  inspector, False
+000128f0: 2929 0d0a 0d0a 0d0a 6465 6620 6164 645f  ))......def add_
+00012900: 6372 6f73 7368 6169 725f 696e 666f 2869  crosshair_info(i
+00012910: 6e66 6f66 756e 632c 2061 783d 4e6f 6e65  nfofunc, ax=None
+00012920: 293a 0d0a 2020 2020 2727 2743 616c 6c62  ):..    '''Callb
+00012930: 6163 6b20 7768 656e 2063 726f 7373 6861  ack when crossha
+00012940: 6972 2075 7064 6174 6564 206c 696b 6520  ir updated like 
+00012950: 736f 3a20 696e 666f 2861 782c 782c 792c  so: info(ax,x,y,
+00012960: 7874 6578 742c 7974 6578 7429 3b20 7468  xtext,ytext); th
+00012970: 6520 696e 666f 2829 0d0a 2020 2020 2020  e info()..      
+00012980: 2063 616c 6c62 6163 6b20 6d75 7374 2072   callback must r
+00012990: 6574 7572 6e20 7477 6f20 7661 6c75 6573  eturn two values
+000129a0: 3a20 7874 6578 7420 616e 6420 7974 6578  : xtext and ytex
+000129b0: 742e 2727 270d 0a20 2020 2061 7820 3d20  t.'''..    ax = 
+000129c0: 5f63 7265 6174 655f 706c 6f74 2861 783d  _create_plot(ax=
+000129d0: 6178 2c20 6d61 7869 6d69 7a65 3d46 616c  ax, maximize=Fal
+000129e0: 7365 290d 0a20 2020 2061 782e 6372 6f73  se)..    ax.cros
+000129f0: 7368 6169 722e 696e 666f 732e 6170 7065  shair.infos.appe
+00012a00: 6e64 2869 6e66 6f66 756e 6329 0d0a 0d0a  nd(infofunc)....
+00012a10: 0d0a 6465 6620 7469 6d65 725f 6361 6c6c  ..def timer_call
+00012a20: 6261 636b 2875 7064 6174 655f 6675 6e63  back(update_func
+00012a30: 2c20 7365 636f 6e64 732c 2073 696e 676c  , seconds, singl
+00012a40: 655f 7368 6f74 3d46 616c 7365 293a 0d0a  e_shot=False):..
+00012a50: 2020 2020 676c 6f62 616c 2074 696d 6572      global timer
+00012a60: 730d 0a20 2020 2074 696d 6572 203d 2051  s..    timer = Q
+00012a70: 7443 6f72 652e 5154 696d 6572 2829 0d0a  tCore.QTimer()..
+00012a80: 2020 2020 7469 6d65 722e 7469 6d65 6f75      timer.timeou
+00012a90: 742e 636f 6e6e 6563 7428 7570 6461 7465  t.connect(update
+00012aa0: 5f66 756e 6329 0d0a 2020 2020 6966 2073  _func)..    if s
+00012ab0: 696e 676c 655f 7368 6f74 3a0d 0a20 2020  ingle_shot:..   
+00012ac0: 2020 2020 2074 696d 6572 2e73 6574 5369       timer.setSi
+00012ad0: 6e67 6c65 5368 6f74 2854 7275 6529 0d0a  ngleShot(True)..
+00012ae0: 2020 2020 7469 6d65 722e 7374 6172 7428      timer.start(
+00012af0: 696e 7428 7365 636f 6e64 732a 3130 3030  int(seconds*1000
+00012b00: 2929 0d0a 2020 2020 7469 6d65 7273 2e61  ))..    timers.a
+00012b10: 7070 656e 6428 7469 6d65 7229 0d0a 2020  ppend(timer)..  
+00012b20: 2020 7265 7475 726e 2074 696d 6572 0d0a    return timer..
+00012b30: 0d0a 0d0a 6465 6620 6175 746f 7669 6577  ....def autoview
+00012b40: 7265 7374 6f72 6528 656e 6162 6c65 3d54  restore(enable=T
+00012b50: 7275 6529 3a0d 0a20 2020 2027 2727 5265  rue):..    '''Re
+00012b60: 7374 6f72 2066 756e 6374 696f 6e61 6c69  stor functionali
+00012b70: 7479 2073 6176 6573 2076 6965 7720 7a6f  ty saves view zo
+00012b80: 6f6d 2063 6f6f 7264 696e 6174 6573 2077  om coordinates w
+00012b90: 6865 6e20 636c 6f73 696e 6720 6120 7769  hen closing a wi
+00012ba0: 6e64 6f77 2c20 616e 640d 0a20 2020 2020  ndow, and..     
+00012bb0: 2020 6c6f 6164 2074 6865 6d20 7768 656e    load them when
+00012bc0: 2063 7265 6174 696e 6720 7468 6520 706c   creating the pl
+00012bd0: 6f74 2028 7769 7468 2074 6865 2073 616d  ot (with the sam
+00012be0: 6520 6e61 6d65 2920 6167 6169 6e2e 2727  e name) again.''
+00012bf0: 270d 0a20 2020 2067 6c6f 6261 6c20 7669  '..    global vi
+00012c00: 6577 7265 7374 6f72 650d 0a20 2020 2076  ewrestore..    v
+00012c10: 6965 7772 6573 746f 7265 203d 2065 6e61  iewrestore = ena
+00012c20: 626c 650d 0a0d 0a0d 0a64 6566 2072 6566  ble......def ref
+00012c30: 7265 7368 2829 3a0d 0a20 2020 2066 6f72  resh():..    for
+00012c40: 2077 696e 2069 6e20 7769 6e64 6f77 733a   win in windows:
+00012c50: 0d0a 2020 2020 2020 2020 6178 7320 3d20  ..        axs = 
+00012c60: 7769 6e2e 6178 7320 2b20 5b61 7820 666f  win.axs + [ax fo
+00012c70: 7220 6178 2069 6e20 6f76 6572 6c61 795f  r ax in overlay_
+00012c80: 6178 7320 6966 2061 782e 7662 2e77 696e  axs if ax.vb.win
+00012c90: 3d3d 7769 6e5d 0d0a 2020 2020 2020 2020  ==win]..        
+00012ca0: 666f 7220 6178 2069 6e20 6178 733a 0d0a  for ax in axs:..
+00012cb0: 2020 2020 2020 2020 2020 2020 5f69 6d70              _imp
+00012cc0: 726f 7665 5f73 6967 6e69 6669 6361 6e74  rove_significant
+00012cd0: 7328 6178 290d 0a20 2020 2020 2020 2076  s(ax)..        v
+00012ce0: 6273 203d 205b 6178 2e76 6220 666f 7220  bs = [ax.vb for 
+00012cf0: 6178 2069 6e20 6178 735d 0d0a 2020 2020  ax in axs]..    
+00012d00: 2020 2020 666f 7220 7662 2069 6e20 7662      for vb in vb
+00012d10: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
+00012d20: 7662 2e70 7265 5f70 726f 6365 7373 5f64  vb.pre_process_d
+00012d30: 6174 6128 290d 0a20 2020 2020 2020 2069  ata()..        i
+00012d40: 6620 7669 6577 7265 7374 6f72 653a 0d0a  f viewrestore:..
+00012d50: 2020 2020 2020 2020 2020 2020 6966 205f              if _
+00012d60: 6c6f 6164 7769 6e64 6174 6128 7769 6e29  loadwindata(win)
+00012d70: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00012d80: 2020 2063 6f6e 7469 6e75 650d 0a20 2020     continue..   
+00012d90: 2020 2020 205f 7365 745f 6d61 785f 7a6f       _set_max_zo
+00012da0: 6f6d 2876 6273 290d 0a20 2020 2020 2020  om(vbs)..       
+00012db0: 2066 6f72 2076 6220 696e 2076 6273 3a0d   for vb in vbs:.
+00012dc0: 0a20 2020 2020 2020 2020 2020 2064 6174  .            dat
+00012dd0: 6173 7263 203d 2076 622e 6461 7461 7372  asrc = vb.datasr
+00012de0: 635f 6f72 5f73 7461 6e64 616c 6f6e 650d  c_or_standalone.
+00012df0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00012e00: 6461 7461 7372 6320 616e 6420 2876 622e  datasrc and (vb.
+00012e10: 6c69 6e6b 6564 5669 6577 2830 2920 6973  linkedView(0) is
+00012e20: 204e 6f6e 6520 6f72 2076 622e 6c69 6e6b   None or vb.link
+00012e30: 6564 5669 6577 2830 292e 6461 7461 7372  edView(0).datasr
+00012e40: 6320 6973 204e 6f6e 6520 6f72 2076 622e  c is None or vb.
+00012e50: 6d61 7374 6572 5f76 6965 7762 6f78 293a  master_viewbox):
+00012e60: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00012e70: 2020 7662 2e75 7064 6174 655f 795f 7a6f    vb.update_y_zo
+00012e80: 6f6d 2864 6174 6173 7263 2e69 6e69 745f  om(datasrc.init_
+00012e90: 7830 2c20 6461 7461 7372 632e 696e 6974  x0, datasrc.init
+00012ea0: 5f78 3129 0d0a 2020 2020 5f72 6570 6169  _x1)..    _repai
+00012eb0: 6e74 5f63 616e 646c 6573 2829 0d0a 2020  nt_candles()..  
+00012ec0: 2020 666f 7220 6d64 2069 6e20 6d61 7374    for md in mast
+00012ed0: 6572 5f64 6174 612e 7661 6c75 6573 2829  er_data.values()
+00012ee0: 3a0d 0a20 2020 2020 2020 2066 6f72 2076  :..        for v
+00012ef0: 6220 696e 206d 643a 0d0a 2020 2020 2020  b in md:..      
+00012f00: 2020 2020 2020 6966 2074 7970 6528 7662        if type(vb
+00012f10: 2920 213d 2073 7472 3a20 2320 6967 6e6f  ) != str: # igno
+00012f20: 7265 2027 6465 6661 756c 7427 0d0a 2020  re 'default'..  
+00012f30: 2020 2020 2020 2020 2020 2020 2020 5f6d                _m
+00012f40: 6f75 7365 5f6d 6f76 6564 2877 696e 2c20  ouse_moved(win, 
+00012f50: 7662 2c20 4e6f 6e65 290d 0a0d 0a0d 0a64  vb, None)......d
+00012f60: 6566 2073 686f 7728 7174 5f65 7865 633d  ef show(qt_exec=
+00012f70: 5472 7565 293a 0d0a 2020 2020 7265 6672  True):..    refr
+00012f80: 6573 6828 290d 0a20 2020 2066 6f72 2077  esh()..    for w
+00012f90: 696e 2069 6e20 7769 6e64 6f77 733a 0d0a  in in windows:..
+00012fa0: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
+00012fb0: 7461 6e63 6528 7769 6e2c 2046 696e 5769  tance(win, FinWi
+00012fc0: 6e64 6f77 2920 6f72 2071 745f 6578 6563  ndow) or qt_exec
+00012fd0: 3a0d 0a20 2020 2020 2020 2020 2020 2069  :..            i
+00012fe0: 6620 7769 6e2e 7368 6f77 5f6d 6178 696d  f win.show_maxim
+00012ff0: 697a 6564 3a0d 0a20 2020 2020 2020 2020  ized:..         
+00013000: 2020 2020 2020 2077 696e 2e73 686f 774d         win.showM
+00013010: 6178 696d 697a 6564 2829 0d0a 2020 2020  aximized()..    
+00013020: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
+00013030: 2020 2020 2020 2020 2020 2020 2020 2077                 w
+00013040: 696e 2e73 686f 7728 290d 0a20 2020 2069  in.show()..    i
+00013050: 6620 7769 6e64 6f77 7320 616e 6420 7174  f windows and qt
+00013060: 5f65 7865 633a 0d0a 2020 2020 2020 2020  _exec:..        
+00013070: 676c 6f62 616c 206c 6173 745f 6178 2c20  global last_ax, 
+00013080: 6170 700d 0a20 2020 2020 2020 2061 7070  app..        app
+00013090: 203d 2051 7447 7569 2e51 4775 6941 7070   = QtGui.QGuiApp
+000130a0: 6c69 6361 7469 6f6e 2e69 6e73 7461 6e63  lication.instanc
+000130b0: 6528 290d 0a20 2020 2020 2020 2061 7070  e()..        app
+000130c0: 2e65 7865 6328 290d 0a20 2020 2020 2020  .exec()..       
+000130d0: 2077 696e 646f 7773 2e63 6c65 6172 2829   windows.clear()
+000130e0: 0d0a 2020 2020 2020 2020 6f76 6572 6c61  ..        overla
+000130f0: 795f 6178 732e 636c 6561 7228 290d 0a20  y_axs.clear().. 
+00013100: 2020 2020 2020 205f 636c 6561 725f 7469         _clear_ti
+00013110: 6d65 7273 2829 0d0a 2020 2020 2020 2020  mers()..        
+00013120: 736f 756e 6473 2e63 6c65 6172 2829 0d0a  sounds.clear()..
+00013130: 2020 2020 2020 2020 6d61 7374 6572 5f64          master_d
+00013140: 6174 612e 636c 6561 7228 290d 0a20 2020  ata.clear()..   
+00013150: 2020 2020 206c 6173 745f 6178 203d 204e       last_ax = N
+00013160: 6f6e 650d 0a0d 0a0d 0a64 6566 2070 6c61  one......def pla
+00013170: 795f 736f 756e 6428 6669 6c65 6e61 6d65  y_sound(filename
+00013180: 293a 0d0a 2020 2020 6966 2066 696c 656e  ):..    if filen
+00013190: 616d 6520 6e6f 7420 696e 2073 6f75 6e64  ame not in sound
+000131a0: 733a 0d0a 2020 2020 2020 2020 6672 6f6d  s:..        from
+000131b0: 2050 7951 7436 2e51 744d 756c 7469 6d65   PyQt6.QtMultime
+000131c0: 6469 6120 696d 706f 7274 2051 536f 756e  dia import QSoun
+000131d0: 6445 6666 6563 740d 0a20 2020 2020 2020  dEffect..       
+000131e0: 2073 203d 2073 6f75 6e64 735b 6669 6c65   s = sounds[file
+000131f0: 6e61 6d65 5d20 3d20 5153 6f75 6e64 4566  name] = QSoundEf
+00013200: 6665 6374 2829 2023 2064 6973 616c 6c6f  fect() # disallo
+00013210: 7720 6763 0d0a 2020 2020 2020 2020 732e  w gc..        s.
+00013220: 7365 7453 6f75 7263 6528 5174 436f 7265  setSource(QtCore
+00013230: 2e51 5572 6c2e 6672 6f6d 4c6f 6361 6c46  .QUrl.fromLocalF
+00013240: 696c 6528 6669 6c65 6e61 6d65 2929 0d0a  ile(filename))..
+00013250: 2020 2020 7320 3d20 736f 756e 6473 5b66      s = sounds[f
+00013260: 696c 656e 616d 655d 0d0a 2020 2020 732e  ilename]..    s.
+00013270: 706c 6179 2829 0d0a 0d0a 0d0a 6465 6620  play()......def 
+00013280: 7363 7265 656e 7368 6f74 2866 696c 652c  screenshot(file,
+00013290: 2066 6d74 3d27 706e 6727 293a 0d0a 2020   fmt='png'):..  
+000132a0: 2020 6966 205f 696e 7465 726e 616c 5f77    if _internal_w
+000132b0: 696e 646f 7773 5f6f 6e6c 7928 2920 616e  indows_only() an
+000132c0: 6420 6e6f 7420 6170 703a 0d0a 2020 2020  d not app:..    
+000132d0: 2020 2020 7072 696e 7428 2745 5252 4f52      print('ERROR
+000132e0: 3a20 7363 7265 656e 7368 6f74 206d 7573  : screenshot mus
+000132f0: 7420 6265 2063 616c 6c62 6163 6b65 6420  t be callbacked 
+00013300: 6672 6f6d 2065 2e67 2e20 7469 6d65 725f  from e.g. timer_
+00013310: 6361 6c6c 6261 636b 2829 2729 0d0a 2020  callback()')..  
+00013320: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
+00013330: 7365 0d0a 2020 2020 7472 793a 0d0a 2020  se..    try:..  
+00013340: 2020 2020 2020 6275 6666 6572 203d 2051        buffer = Q
+00013350: 7443 6f72 652e 5142 7566 6665 7228 290d  tCore.QBuffer().
+00013360: 0a20 2020 2020 2020 2061 7070 2e70 7269  .        app.pri
+00013370: 6d61 7279 5363 7265 656e 2829 2e67 7261  maryScreen().gra
+00013380: 6257 696e 646f 7728 7769 6e64 6f77 735b  bWindow(windows[
+00013390: 305d 2e77 696e 4964 2829 292e 7361 7665  0].winId()).save
+000133a0: 2862 7566 6665 722c 2066 6d74 290d 0a20  (buffer, fmt).. 
+000133b0: 2020 2020 2020 2066 696c 652e 7772 6974         file.writ
+000133c0: 6528 6275 6666 6572 2e64 6174 6128 2929  e(buffer.data())
+000133d0: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+000133e0: 2054 7275 650d 0a20 2020 2065 7863 6570   True..    excep
+000133f0: 7420 4578 6365 7074 696f 6e20 6173 2065  t Exception as e
+00013400: 3a0d 0a20 2020 2020 2020 2070 7269 6e74  :..        print
+00013410: 2827 5363 7265 656e 7368 6f74 2065 7272  ('Screenshot err
+00013420: 6f72 3a27 2c20 7479 7065 2865 292c 2065  or:', type(e), e
+00013430: 290d 0a20 2020 2072 6574 7572 6e20 4661  )..    return Fa
+00013440: 6c73 650d 0a0d 0a0d 0a64 6566 2065 7870  lse......def exp
+00013450: 6572 696d 656e 7428 2a61 7267 732c 202a  eriment(*args, *
+00013460: 2a6b 7761 7267 7329 3a0d 0a20 2020 2069  *kwargs):..    i
+00013470: 6620 276f 7065 6e67 6c27 2069 6e20 6172  f 'opengl' in ar
+00013480: 6773 206f 7220 6b77 6172 6773 2e67 6574  gs or kwargs.get
+00013490: 2827 6f70 656e 676c 2729 3a0d 0a20 2020  ('opengl'):..   
+000134a0: 2020 2020 2074 7279 3a0d 0a20 2020 2020       try:..     
+000134b0: 2020 2020 2020 2023 2070 6970 2069 6e73         # pip ins
+000134c0: 7461 6c6c 2050 794f 7065 6e47 4c20 5079  tall PyOpenGL Py
+000134d0: 4f70 656e 474c 2d61 6363 656c 6572 6174  OpenGL-accelerat
+000134e0: 6520 746f 2067 6574 2074 6869 7320 676f  e to get this go
+000134f0: 696e 670d 0a20 2020 2020 2020 2020 2020  ing..           
+00013500: 2069 6d70 6f72 7420 4f70 656e 474c 0d0a   import OpenGL..
+00013510: 2020 2020 2020 2020 2020 2020 7067 2e73              pg.s
+00013520: 6574 436f 6e66 6967 4f70 7469 6f6e 7328  etConfigOptions(
+00013530: 7573 654f 7065 6e47 4c3d 5472 7565 2c20  useOpenGL=True, 
+00013540: 656e 6162 6c65 4578 7065 7269 6d65 6e74  enableExperiment
+00013550: 616c 3d54 7275 6529 0d0a 2020 2020 2020  al=True)..      
+00013560: 2020 6578 6365 7074 2045 7863 6570 7469    except Excepti
+00013570: 6f6e 2061 7320 653a 0d0a 2020 2020 2020  on as e:..      
+00013580: 2020 2020 2020 7072 696e 7428 2757 4152        print('WAR
+00013590: 4e49 4e47 3a20 4f70 656e 474c 2069 6e69  NING: OpenGL ini
+000135a0: 7420 6572 726f 722e 272c 2074 7970 6528  t error.', type(
+000135b0: 6529 2c20 6529 0d0a 0d0a 0d0a 2323 2323  e), e)......####
+000135c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000135d0: 2049 4e54 4552 4e41 4c53 2023 2323 2323   INTERNALS #####
+000135e0: 2323 2323 2323 2323 2323 2323 2323 230d  ###############.
+000135f0: 0a0d 0a0d 0a64 6566 205f 6f70 656e 6669  .....def _openfi
+00013600: 6c65 282a 6172 6773 293a 0d0a 2020 2020  le(*args):..    
+00013610: 7265 7475 726e 206f 7065 6e28 2a61 7267  return open(*arg
+00013620: 7329 0d0a 0d0a 0d0a 6465 6620 5f6c 6f61  s)......def _loa
+00013630: 6477 696e 6461 7461 2877 696e 293a 0d0a  dwindata(win):..
+00013640: 2020 2020 7472 793a 206f 732e 6d6b 6469      try: os.mkdi
+00013650: 7228 6f73 2e70 6174 682e 6578 7061 6e64  r(os.path.expand
+00013660: 7573 6572 2827 7e2f 2e66 696e 706c 6f74  user('~/.finplot
+00013670: 2729 290d 0a20 2020 2065 7863 6570 743a  '))..    except:
+00013680: 2070 6173 730d 0a20 2020 2074 7279 3a0d   pass..    try:.
+00013690: 0a20 2020 2020 2020 2066 203d 206f 732e  .        f = os.
+000136a0: 7061 7468 2e65 7870 616e 6475 7365 7228  path.expanduser(
+000136b0: 277e 2f2e 6669 6e70 6c6f 742f 272b 7769  '~/.finplot/'+wi
+000136c0: 6e2e 7469 746c 652e 7265 706c 6163 6528  n.title.replace(
+000136d0: 272f 272c 272d 2729 2b27 2e69 6e69 2729  '/','-')+'.ini')
+000136e0: 0d0a 2020 2020 2020 2020 7365 7474 696e  ..        settin
+000136f0: 6773 203d 205b 286b 2e73 7472 6970 2829  gs = [(k.strip()
+00013700: 2c6c 6974 6572 616c 5f65 7661 6c28 762e  ,literal_eval(v.
+00013710: 7374 7269 7028 2929 2920 666f 7220 6c69  strip())) for li
+00013720: 6e65 2069 6e20 5f6f 7065 6e66 696c 6528  ne in _openfile(
+00013730: 6629 2066 6f72 206b 2c64 2c76 2069 6e20  f) for k,d,v in 
+00013740: 5b6c 696e 652e 7061 7274 6974 696f 6e28  [line.partition(
+00013750: 273d 2729 5d20 6966 2076 5d0d 0a20 2020  '=')] if v]..   
+00013760: 2020 2020 2069 6620 6e6f 7420 7365 7474       if not sett
+00013770: 696e 6773 3a0d 0a20 2020 2020 2020 2020  ings:..         
+00013780: 2020 2072 6574 7572 6e0d 0a20 2020 2065     return..    e
+00013790: 7863 6570 743a 0d0a 2020 2020 2020 2020  xcept:..        
+000137a0: 7265 7475 726e 0d0a 2020 2020 6b76 7320  return..    kvs 
+000137b0: 3d20 7b6b 3a76 2066 6f72 206b 2c76 2069  = {k:v for k,v i
+000137c0: 6e20 7365 7474 696e 6773 7d0d 0a20 2020  n settings}..   
+000137d0: 2076 6273 203d 2073 6574 2861 782e 7662   vbs = set(ax.vb
+000137e0: 2066 6f72 2061 7820 696e 2077 696e 2e61   for ax in win.a
+000137f0: 7873 290d 0a20 2020 207a 6f6f 6d5f 7365  xs)..    zoom_se
+00013800: 7420 3d20 4661 6c73 650d 0a20 2020 2066  t = False..    f
+00013810: 6f72 2076 6220 696e 2076 6273 3a0d 0a20  or vb in vbs:.. 
+00013820: 2020 2020 2020 2064 7320 3d20 7662 2e64         ds = vb.d
+00013830: 6174 6173 7263 0d0a 2020 2020 2020 2020  atasrc..        
+00013840: 6966 2064 7320 616e 6420 2876 622e 6c69  if ds and (vb.li
+00013850: 6e6b 6564 5669 6577 2830 2920 6973 204e  nkedView(0) is N
+00013860: 6f6e 6520 6f72 2076 622e 6c69 6e6b 6564  one or vb.linked
+00013870: 5669 6577 2830 292e 6461 7461 7372 6320  View(0).datasrc 
+00013880: 6973 204e 6f6e 6520 6f72 2076 622e 6d61  is None or vb.ma
+00013890: 7374 6572 5f76 6965 7762 6f78 293a 0d0a  ster_viewbox):..
+000138a0: 2020 2020 2020 2020 2020 2020 7065 7269              peri
+000138b0: 6f64 5f6e 7320 3d20 6473 2e70 6572 696f  od_ns = ds.perio
+000138c0: 645f 6e73 0d0a 2020 2020 2020 2020 2020  d_ns..          
+000138d0: 2020 6966 206b 7673 5b27 6d69 6e5f 7827    if kvs['min_x'
+000138e0: 5d20 3e3d 2064 732e 782e 696c 6f63 5b30  ] >= ds.x.iloc[0
+000138f0: 5d2d 7065 7269 6f64 5f6e 7320 616e 6420  ]-period_ns and 
+00013900: 6b76 735b 276d 6178 5f78 275d 203c 3d20  kvs['max_x'] <= 
+00013910: 6473 2e78 2e69 6c6f 635b 2d31 5d2b 7065  ds.x.iloc[-1]+pe
+00013920: 7269 6f64 5f6e 733a 0d0a 2020 2020 2020  riod_ns:..      
+00013930: 2020 2020 2020 2020 2020 7830 2c78 3120            x0,x1 
+00013940: 3d20 6473 2e78 2e6c 6f63 5b64 732e 783e  = ds.x.loc[ds.x>
+00013950: 3d6b 7673 5b27 6d69 6e5f 7827 5d5d 2e69  =kvs['min_x']].i
+00013960: 6e64 6578 5b30 5d2c 2064 732e 782e 6c6f  ndex[0], ds.x.lo
+00013970: 635b 6473 2e78 3c3d 6b76 735b 276d 6178  c[ds.x<=kvs['max
+00013980: 5f78 275d 5d2e 696e 6465 785b 2d31 5d0d  _x']].index[-1].
+00013990: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000139a0: 2069 6620 7831 203d 3d20 6c65 6e28 6473   if x1 == len(ds
+000139b0: 2e78 292d 313a 0d0a 2020 2020 2020 2020  .x)-1:..        
+000139c0: 2020 2020 2020 2020 2020 2020 7831 202b              x1 +
+000139d0: 3d20 7269 6768 745f 6d61 7267 696e 5f63  = right_margin_c
+000139e0: 616e 646c 6573 0d0a 2020 2020 2020 2020  andles..        
+000139f0: 2020 2020 2020 2020 7831 202b 3d20 302e          x1 += 0.
+00013a00: 350d 0a20 2020 2020 2020 2020 2020 2020  5..             
+00013a10: 2020 207a 6f6f 6d5f 7365 7420 3d20 7662     zoom_set = vb
+00013a20: 2e75 7064 6174 655f 795f 7a6f 6f6d 2878  .update_y_zoom(x
+00013a30: 302c 2078 3129 0d0a 2020 2020 7265 7475  0, x1)..    retu
+00013a40: 726e 207a 6f6f 6d5f 7365 740d 0a0d 0a0d  rn zoom_set.....
+00013a50: 0a64 6566 205f 7361 7665 7769 6e64 6174  .def _savewindat
+00013a60: 6128 7769 6e29 3a0d 0a20 2020 2069 6620  a(win):..    if 
+00013a70: 6e6f 7420 7669 6577 7265 7374 6f72 653a  not viewrestore:
+00013a80: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+00013a90: 0d0a 2020 2020 7472 793a 0d0a 2020 2020  ..    try:..    
+00013aa0: 2020 2020 6d69 6e5f 7820 3d20 696e 7428      min_x = int(
+00013ab0: 3165 3130 3029 0d0a 2020 2020 2020 2020  1e100)..        
+00013ac0: 6d61 785f 7820 3d20 696e 7428 2d31 6531  max_x = int(-1e1
+00013ad0: 3030 290d 0a20 2020 2020 2020 2066 6f72  00)..        for
+00013ae0: 2061 7820 696e 2077 696e 2e61 7873 3a0d   ax in win.axs:.
+00013af0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00013b00: 6178 2e76 622e 7461 7267 6574 5265 6374  ax.vb.targetRect
+00013b10: 2829 2e72 6967 6874 2829 203c 2034 3a20  ().right() < 4: 
+00013b20: 2320 6967 6e6f 7265 2065 6d70 7479 2070  # ignore empty p
+00013b30: 6c6f 7473 0d0a 2020 2020 2020 2020 2020  lots..          
+00013b40: 2020 2020 2020 636f 6e74 696e 7565 0d0a        continue..
+00013b50: 2020 2020 2020 2020 2020 2020 6966 2061              if a
+00013b60: 782e 7662 2e64 6174 6173 7263 2069 7320  x.vb.datasrc is 
+00013b70: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
+00013b80: 2020 2020 2020 2063 6f6e 7469 6e75 650d         continue.
+00013b90: 0a20 2020 2020 2020 2020 2020 2074 302c  .            t0,
+00013ba0: 7431 2c5f 2c5f 2c5f 203d 2061 782e 7662  t1,_,_,_ = ax.vb
+00013bb0: 2e64 6174 6173 7263 2e68 696c 6f28 6178  .datasrc.hilo(ax
+00013bc0: 2e76 622e 7461 7267 6574 5265 6374 2829  .vb.targetRect()
+00013bd0: 2e6c 6566 7428 292c 2061 782e 7662 2e74  .left(), ax.vb.t
+00013be0: 6172 6765 7452 6563 7428 292e 7269 6768  argetRect().righ
+00013bf0: 7428 2929 0d0a 2020 2020 2020 2020 2020  t())..          
+00013c00: 2020 6d69 6e5f 7820 3d20 6e70 2e6e 616e    min_x = np.nan
+00013c10: 6d69 6e28 5b6d 696e 5f78 2c20 7430 5d29  min([min_x, t0])
+00013c20: 0d0a 2020 2020 2020 2020 2020 2020 6d61  ..            ma
+00013c30: 785f 7820 3d20 6e70 2e6e 616e 6d61 7828  x_x = np.nanmax(
+00013c40: 5b6d 6178 5f78 2c20 7431 5d29 0d0a 2020  [max_x, t1])..  
+00013c50: 2020 2020 2020 6966 206e 702e 6d61 7828        if np.max(
+00013c60: 6e70 2e61 6273 285b 6d69 6e5f 782c 206d  np.abs([min_x, m
+00013c70: 6178 5f78 5d29 2920 3c20 3165 3939 3a0d  ax_x])) < 1e99:.
+00013c80: 0a20 2020 2020 2020 2020 2020 2073 203d  .            s =
+00013c90: 2027 6d69 6e5f 7820 3d20 2573 5c6e 6d61   'min_x = %s\nma
+00013ca0: 785f 7820 3d20 2573 5c6e 2720 2520 286d  x_x = %s\n' % (m
+00013cb0: 696e 5f78 2c20 6d61 785f 7829 0d0a 2020  in_x, max_x)..  
+00013cc0: 2020 2020 2020 2020 2020 6620 3d20 6f73            f = os
+00013cd0: 2e70 6174 682e 6578 7061 6e64 7573 6572  .path.expanduser
+00013ce0: 2827 7e2f 2e66 696e 706c 6f74 2f27 2b77  ('~/.finplot/'+w
+00013cf0: 696e 2e74 6974 6c65 2e72 6570 6c61 6365  in.title.replace
+00013d00: 2827 2f27 2c27 2d27 292b 272e 696e 6927  ('/','-')+'.ini'
+00013d10: 290d 0a20 2020 2020 2020 2020 2020 2074  )..            t
+00013d20: 7279 3a20 6368 616e 6765 6420 3d20 5f6f  ry: changed = _o
+00013d30: 7065 6e66 696c 6528 6629 2e72 6561 6428  penfile(f).read(
+00013d40: 2920 213d 2073 0d0a 2020 2020 2020 2020  ) != s..        
+00013d50: 2020 2020 6578 6365 7074 3a20 6368 616e      except: chan
+00013d60: 6765 6420 3d20 5472 7565 0d0a 2020 2020  ged = True..    
+00013d70: 2020 2020 2020 2020 6966 2063 6861 6e67          if chang
+00013d80: 6564 3a0d 0a20 2020 2020 2020 2020 2020  ed:..           
+00013d90: 2020 2020 205f 6f70 656e 6669 6c65 2866       _openfile(f
+00013da0: 2c20 2777 7427 292e 7772 6974 6528 7329  , 'wt').write(s)
+00013db0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00013dc0: 2020 2323 2070 7269 6e74 2827 2573 2073    ## print('%s s
+00013dd0: 6176 6564 2720 2520 7769 6e2e 7469 746c  aved' % win.titl
+00013de0: 6529 0d0a 2020 2020 6578 6365 7074 2045  e)..    except E
+00013df0: 7863 6570 7469 6f6e 2061 7320 653a 0d0a  xception as e:..
+00013e00: 2020 2020 2020 2020 7072 696e 7428 2745          print('E
+00013e10: 7272 6f72 2073 6176 696e 6720 706c 6f74  rror saving plot
+00013e20: 3a27 2c20 6529 0d0a 0d0a 0d0a 6465 6620  :', e)......def 
+00013e30: 5f69 6e74 6572 6e61 6c5f 7769 6e64 6f77  _internal_window
+00013e40: 735f 6f6e 6c79 2829 3a0d 0a20 2020 2020  s_only():..     
+00013e50: 7265 7475 726e 2061 6c6c 2869 7369 6e73  return all(isins
+00013e60: 7461 6e63 6528 7769 6e2c 4669 6e57 696e  tance(win,FinWin
+00013e70: 646f 7729 2066 6f72 2077 696e 2069 6e20  dow) for win in 
+00013e80: 7769 6e64 6f77 7329 0d0a 0d0a 0d0a 6465  windows)......de
+00013e90: 6620 5f63 7265 6174 655f 706c 6f74 2861  f _create_plot(a
+00013ea0: 783d 4e6f 6e65 2c20 2a2a 6b77 6172 6773  x=None, **kwargs
+00013eb0: 293a 0d0a 2020 2020 6966 2061 783a 0d0a  ):..    if ax:..
+00013ec0: 2020 2020 2020 2020 7265 7475 726e 2061          return a
+00013ed0: 780d 0a20 2020 2069 6620 6c61 7374 5f61  x..    if last_a
+00013ee0: 783a 0d0a 2020 2020 2020 2020 7265 7475  x:..        retu
+00013ef0: 726e 206c 6173 745f 6178 0d0a 2020 2020  rn last_ax..    
+00013f00: 7265 7475 726e 2063 7265 6174 655f 706c  return create_pl
+00013f10: 6f74 282a 2a6b 7761 7267 7329 0d0a 0d0a  ot(**kwargs)....
+00013f20: 0d0a 6465 6620 5f63 7265 6174 655f 6178  ..def _create_ax
+00013f30: 6973 2870 6f73 2c20 2a2a 6b77 6172 6773  is(pos, **kwargs
+00013f40: 293a 0d0a 2020 2020 6966 2070 6f73 203d  ):..    if pos =
+00013f50: 3d20 2778 273a 0d0a 2020 2020 2020 2020  = 'x':..        
+00013f60: 7265 7475 726e 2045 706f 6368 4178 6973  return EpochAxis
+00013f70: 4974 656d 282a 2a6b 7761 7267 7329 0d0a  Item(**kwargs)..
+00013f80: 2020 2020 656c 6966 2070 6f73 203d 3d20      elif pos == 
+00013f90: 2779 273a 0d0a 2020 2020 2020 2020 7265  'y':..        re
+00013fa0: 7475 726e 2059 4178 6973 4974 656d 282a  turn YAxisItem(*
+00013fb0: 2a6b 7761 7267 7329 0d0a 0d0a 0d0a 6465  *kwargs)......de
+00013fc0: 6620 5f63 6c65 6172 5f74 696d 6572 7328  f _clear_timers(
+00013fd0: 293a 0d0a 2020 2020 666f 7220 7469 6d65  ):..    for time
+00013fe0: 7220 696e 2074 696d 6572 733a 0d0a 2020  r in timers:..  
+00013ff0: 2020 2020 2020 7469 6d65 722e 7469 6d65        timer.time
+00014000: 6f75 742e 6469 7363 6f6e 6e65 6374 2829  out.disconnect()
+00014010: 0d0a 2020 2020 7469 6d65 7273 2e63 6c65  ..    timers.cle
+00014020: 6172 2829 0d0a 0d0a 0d0a 6465 6620 5f61  ar()......def _a
+00014030: 6464 5f74 696d 6573 7461 6d70 5f70 6c6f  dd_timestamp_plo
+00014040: 7428 6d61 7374 6572 2c20 7072 6576 5f61  t(master, prev_a
+00014050: 782c 2076 6965 7762 6f78 2c20 696e 6465  x, viewbox, inde
+00014060: 782c 2079 7363 616c 6529 3a0d 0a20 2020  x, yscale):..   
+00014070: 206e 6174 6976 655f 7769 6e20 3d20 6973   native_win = is
+00014080: 696e 7374 616e 6365 286d 6173 7465 722c  instance(master,
+00014090: 2070 672e 4772 6170 6869 6373 4c61 796f   pg.GraphicsLayo
+000140a0: 7574 5769 6467 6574 290d 0a20 2020 2069  utWidget)..    i
+000140b0: 6620 6e61 7469 7665 5f77 696e 2061 6e64  f native_win and
+000140c0: 2070 7265 765f 6178 2069 7320 6e6f 7420   prev_ax is not 
+000140d0: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2070  None:..        p
+000140e0: 7265 765f 6178 2e73 6574 5f76 6973 6962  rev_ax.set_visib
+000140f0: 6c65 2878 6178 6973 3d46 616c 7365 2920  le(xaxis=False) 
+00014100: 2320 6869 6465 2074 6865 2077 686f 6c65  # hide the whole
+00014110: 2070 7265 7669 6f75 7320 6178 6973 0d0a   previous axis..
+00014120: 2020 2020 6178 6573 203d 207b 2762 6f74      axes = {'bot
+00014130: 746f 6d27 3a20 5f63 7265 6174 655f 6178  tom': _create_ax
+00014140: 6973 2870 6f73 3d27 7827 2c20 7662 3d76  is(pos='x', vb=v
+00014150: 6965 7762 6f78 2c20 6f72 6965 6e74 6174  iewbox, orientat
+00014160: 696f 6e3d 2762 6f74 746f 6d27 292c 0d0a  ion='bottom'),..
+00014170: 2020 2020 2020 2020 2020 2020 2772 6967              'rig
+00014180: 6874 273a 2020 5f63 7265 6174 655f 6178  ht':  _create_ax
+00014190: 6973 2870 6f73 3d27 7927 2c20 7662 3d76  is(pos='y', vb=v
+000141a0: 6965 7762 6f78 2c20 6f72 6965 6e74 6174  iewbox, orientat
+000141b0: 696f 6e3d 2772 6967 6874 2729 7d0d 0a20  ion='right')}.. 
+000141c0: 2020 2069 6620 6e61 7469 7665 5f77 696e     if native_win
+000141d0: 3a0d 0a20 2020 2020 2020 2061 7820 3d20  :..        ax = 
+000141e0: 7067 2e50 6c6f 7449 7465 6d28 7669 6577  pg.PlotItem(view
+000141f0: 426f 783d 7669 6577 626f 782c 2061 7869  Box=viewbox, axi
+00014200: 7349 7465 6d73 3d61 7865 732c 206e 616d  sItems=axes, nam
+00014210: 653d 2770 6c6f 742d 2569 2725 696e 6465  e='plot-%i'%inde
+00014220: 782c 2065 6e61 626c 654d 656e 753d 4661  x, enableMenu=Fa
+00014230: 6c73 6529 0d0a 2020 2020 656c 7365 3a0d  lse)..    else:.
+00014240: 0a20 2020 2020 2020 2061 7877 203d 2070  .        axw = p
+00014250: 672e 506c 6f74 5769 6467 6574 2876 6965  g.PlotWidget(vie
+00014260: 7742 6f78 3d76 6965 7762 6f78 2c20 6178  wBox=viewbox, ax
+00014270: 6973 4974 656d 733d 6178 6573 2c20 6e61  isItems=axes, na
+00014280: 6d65 3d27 706c 6f74 2d25 6927 2569 6e64  me='plot-%i'%ind
+00014290: 6578 2c20 656e 6162 6c65 4d65 6e75 3d46  ex, enableMenu=F
+000142a0: 616c 7365 290d 0a20 2020 2020 2020 2061  alse)..        a
+000142b0: 7820 3d20 6178 772e 706c 6f74 4974 656d  x = axw.plotItem
+000142c0: 0d0a 2020 2020 2020 2020 6178 2e61 785f  ..        ax.ax_
+000142d0: 7769 6467 6574 203d 2061 7877 0d0a 2020  widget = axw..  
+000142e0: 2020 6178 2e68 6964 6541 7869 7328 276c    ax.hideAxis('l
+000142f0: 6566 7427 290d 0a20 2020 2069 6620 795f  eft')..    if y_
+00014300: 6c61 6265 6c5f 7769 6474 683a 0d0a 2020  label_width:..  
+00014310: 2020 2020 2020 6178 2e61 7865 735b 2772        ax.axes['r
+00014320: 6967 6874 275d 5b27 6974 656d 275d 2e73  ight']['item'].s
+00014330: 6574 5769 6474 6828 795f 6c61 6265 6c5f  etWidth(y_label_
+00014340: 7769 6474 6829 2023 2074 6869 7320 6973  width) # this is
+00014350: 2074 6f20 7075 7420 616c 6c20 6772 6170   to put all grap
+00014360: 6873 206f 6e20 6571 7561 6c20 666f 6f74  hs on equal foot
+00014370: 696e 6720 7768 656e 2074 6578 7473 2076  ing when texts v
+00014380: 6172 7920 6672 6f6d 2030 2e34 2074 6f20  ary from 0.4 to 
+00014390: 3230 3030 3030 300d 0a20 2020 2061 782e  2000000..    ax.
+000143a0: 6178 6573 5b27 7269 6768 7427 5d5b 2769  axes['right']['i
+000143b0: 7465 6d27 5d2e 7365 7453 7479 6c65 2874  tem'].setStyle(t
+000143c0: 6963 6b4c 656e 6774 683d 2d35 2920 2320  ickLength=-5) # 
+000143d0: 736f 6d65 2062 7567 2c20 746f 7461 6c6c  some bug, totall
+000143e0: 7920 756e 6578 706c 6963 6162 6c65 2028  y unexplicable (
+000143f0: 7768 7920 7365 7474 696e 6720 7468 6520  why setting the 
+00014400: 6465 6661 756c 7420 7661 6c75 6520 6167  default value ag
+00014410: 6169 6e20 776f 756c 6420 6669 7820 7265  ain would fix re
+00014420: 7061 696e 7420 7769 6474 6820 6173 2061  paint width as a
+00014430: 7869 7320 7363 616c 6520 646f 776e 290d  xis scale down).
+00014440: 0a20 2020 2061 782e 6178 6573 5b27 7269  .    ax.axes['ri
+00014450: 6768 7427 5d5b 2769 7465 6d27 5d2e 7365  ght']['item'].se
+00014460: 745a 5661 6c75 6528 3330 2920 2320 7075  tZValue(30) # pu
+00014470: 7420 6178 6973 2069 6e20 6672 6f6e 7420  t axis in front 
+00014480: 696e 7374 6561 6420 6f66 2062 6568 696e  instead of behin
+00014490: 6420 6461 7461 0d0a 2020 2020 6178 2e61  d data..    ax.a
+000144a0: 7865 735b 2762 6f74 746f 6d27 5d5b 2769  xes['bottom']['i
+000144b0: 7465 6d27 5d2e 7365 745a 5661 6c75 6528  tem'].setZValue(
+000144c0: 3330 290d 0a20 2020 2061 782e 7365 744c  30)..    ax.setL
+000144d0: 6f67 4d6f 6465 2879 3d28 7973 6361 6c65  ogMode(y=(yscale
+000144e0: 2e73 6361 6c65 7479 7065 3d3d 276c 6f67  .scaletype=='log
+000144f0: 2729 290d 0a20 2020 2061 782e 7369 676e  '))..    ax.sign
+00014500: 6966 6963 616e 745f 666f 7263 6564 203d  ificant_forced =
+00014510: 2046 616c 7365 0d0a 2020 2020 6178 2e73   False..    ax.s
+00014520: 6967 6e69 6669 6361 6e74 5f64 6563 696d  ignificant_decim
+00014530: 616c 7320 3d20 7369 676e 6966 6963 616e  als = significan
+00014540: 745f 6465 6369 6d61 6c73 0d0a 2020 2020  t_decimals..    
+00014550: 6178 2e73 6967 6e69 6669 6361 6e74 5f65  ax.significant_e
+00014560: 7073 203d 2073 6967 6e69 6669 6361 6e74  ps = significant
+00014570: 5f65 7073 0d0a 2020 2020 6178 2e63 726f  _eps..    ax.cro
+00014580: 7373 6861 6972 203d 2046 696e 4372 6f73  sshair = FinCros
+00014590: 7348 6169 7228 6178 2c20 636f 6c6f 723d  sHair(ax, color=
+000145a0: 6372 6f73 735f 6861 6972 5f63 6f6c 6f72  cross_hair_color
+000145b0: 290d 0a20 2020 2061 782e 6869 6465 4275  )..    ax.hideBu
+000145c0: 7474 6f6e 7328 290d 0a20 2020 2061 782e  ttons()..    ax.
+000145d0: 6f76 6572 6c61 7920 3d20 7061 7274 6961  overlay = partia
+000145e0: 6c28 5f61 785f 6f76 6572 6c61 792c 2061  l(_ax_overlay, a
+000145f0: 7829 0d0a 2020 2020 6178 2e73 6574 5f76  x)..    ax.set_v
+00014600: 6973 6962 6c65 203d 2070 6172 7469 616c  isible = partial
+00014610: 285f 6178 5f73 6574 5f76 6973 6962 6c65  (_ax_set_visible
+00014620: 2c20 6178 290d 0a20 2020 2061 782e 6465  , ax)..    ax.de
+00014630: 636f 7570 6c65 203d 2070 6172 7469 616c  couple = partial
+00014640: 285f 6178 5f64 6563 6f75 706c 652c 2061  (_ax_decouple, a
+00014650: 7829 0d0a 2020 2020 6178 2e64 6973 6162  x)..    ax.disab
+00014660: 6c65 5f78 5f69 6e64 6578 203d 2070 6172  le_x_index = par
+00014670: 7469 616c 285f 6178 5f64 6973 6162 6c65  tial(_ax_disable
+00014680: 5f78 5f69 6e64 6578 2c20 6178 290d 0a20  _x_index, ax).. 
+00014690: 2020 2061 782e 7265 7365 7420 3d20 7061     ax.reset = pa
+000146a0: 7274 6961 6c28 5f61 785f 7265 7365 742c  rtial(_ax_reset,
+000146b0: 2061 7829 0d0a 2020 2020 6178 2e70 7265   ax)..    ax.pre
+000146c0: 765f 6178 203d 2070 7265 765f 6178 0d0a  v_ax = prev_ax..
+000146d0: 2020 2020 6178 2e77 696e 5f69 6e64 6578      ax.win_index
+000146e0: 203d 2069 6e64 6578 0d0a 2020 2020 6966   = index..    if
+000146f0: 2069 6e64 6578 2532 3a0d 0a20 2020 2020   index%2:..     
+00014700: 2020 2076 6965 7762 6f78 2e73 6574 4261     viewbox.setBa
+00014710: 636b 6772 6f75 6e64 436f 6c6f 7228 6f64  ckgroundColor(od
+00014720: 645f 706c 6f74 5f62 6163 6b67 726f 756e  d_plot_backgroun
+00014730: 6429 0d0a 2020 2020 7669 6577 626f 782e  d)..    viewbox.
+00014740: 7365 7450 6172 656e 7428 6178 290d 0a20  setParent(ax).. 
+00014750: 2020 2072 6574 7572 6e20 6178 0d0a 0d0a     return ax....
+00014760: 0d0a 6465 6620 5f61 785f 6f76 6572 6c61  ..def _ax_overla
+00014770: 7928 6178 2c20 7363 616c 653d 302e 3235  y(ax, scale=0.25
+00014780: 2c20 7961 7869 733d 4661 6c73 6529 3a0d  , yaxis=False):.
+00014790: 0a20 2020 2027 2727 5468 6520 7363 616c  .    '''The scal
+000147a0: 6520 7061 7261 6d65 7465 7220 6465 6669  e parameter defi
+000147b0: 6e65 7320 686f 7720 2268 6967 6820 7570  nes how "high up
+000147c0: 2220 6f6e 2074 6865 2069 6e69 7469 616c  " on the initial
+000147d0: 2070 6c6f 7420 7468 6973 206f 7665 726c   plot this overl
+000147e0: 6179 2077 696c 6c20 7368 6f77 2e0d 0a20  ay will show... 
+000147f0: 2020 2020 2020 5468 6520 7961 7869 7320        The yaxis 
+00014800: 7061 7261 6d65 7465 7220 6361 6e20 6265  parameter can be
+00014810: 206f 6e65 206f 6620 5b46 616c 7365 2c20   one of [False, 
+00014820: 276c 696e 6561 7227 2c20 276c 6f67 275d  'linear', 'log']
+00014830: 2e27 2727 0d0a 2020 2020 7973 6361 6c65  .'''..    yscale
+00014840: 203d 2079 6178 6973 2069 6620 7961 7869   = yaxis if yaxi
+00014850: 7320 656c 7365 2027 6c69 6e65 6172 270d  s else 'linear'.
+00014860: 0a20 2020 2076 6965 7762 6f78 203d 2046  .    viewbox = F
+00014870: 696e 5669 6577 426f 7828 6178 2e76 622e  inViewBox(ax.vb.
+00014880: 7769 6e2c 2069 6e69 745f 7374 6570 733d  win, init_steps=
+00014890: 6178 2e76 622e 696e 6974 5f73 7465 7073  ax.vb.init_steps
+000148a0: 2c20 7973 6361 6c65 3d59 5363 616c 6528  , yscale=YScale(
+000148b0: 7973 6361 6c65 2c20 3129 2c20 656e 6162  yscale, 1), enab
+000148c0: 6c65 4d65 6e75 3d46 616c 7365 290d 0a20  leMenu=False).. 
+000148d0: 2020 2076 6965 7762 6f78 2e6d 6173 7465     viewbox.maste
+000148e0: 725f 7669 6577 626f 7820 3d20 6178 2e76  r_viewbox = ax.v
+000148f0: 620d 0a20 2020 2076 6965 7762 6f78 2e73  b..    viewbox.s
+00014900: 6574 5a56 616c 7565 282d 3529 0d0a 2020  etZValue(-5)..  
+00014910: 2020 7669 6577 626f 782e 7365 7442 6163    viewbox.setBac
+00014920: 6b67 726f 756e 6443 6f6c 6f72 2861 782e  kgroundColor(ax.
+00014930: 7662 2e73 7461 7465 5b27 6261 636b 6772  vb.state['backgr
+00014940: 6f75 6e64 275d 290d 0a20 2020 2061 782e  ound'])..    ax.
+00014950: 7662 2e73 6574 4261 636b 6772 6f75 6e64  vb.setBackground
+00014960: 436f 6c6f 7228 4e6f 6e65 290d 0a20 2020  Color(None)..   
+00014970: 2076 6965 7762 6f78 2e76 5f7a 6f6f 6d5f   viewbox.v_zoom_
+00014980: 7363 616c 6520 3d20 7363 616c 650d 0a20  scale = scale.. 
+00014990: 2020 2069 6620 6861 7361 7474 7228 6178     if hasattr(ax
+000149a0: 2c20 2761 785f 7769 6467 6574 2729 3a0d  , 'ax_widget'):.
+000149b0: 0a20 2020 2020 2020 2061 782e 6178 5f77  .        ax.ax_w
+000149c0: 6964 6765 742e 7363 656e 6528 292e 6164  idget.scene().ad
+000149d0: 6449 7465 6d28 7669 6577 626f 7829 0d0a  dItem(viewbox)..
+000149e0: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
+000149f0: 2020 2061 782e 7662 2e77 696e 2e63 656e     ax.vb.win.cen
+00014a00: 7472 616c 5769 6467 6574 2e73 6365 6e65  tralWidget.scene
+00014a10: 2829 2e61 6464 4974 656d 2876 6965 7762  ().addItem(viewb
+00014a20: 6f78 290d 0a20 2020 2076 6965 7762 6f78  ox)..    viewbox
+00014a30: 2e73 6574 584c 696e 6b28 6178 2e76 6229  .setXLink(ax.vb)
+00014a40: 0d0a 2020 2020 6465 6620 7570 6461 7465  ..    def update
+00014a50: 5669 6577 2829 3a0d 0a20 2020 2020 2020  View():..       
+00014a60: 2076 6965 7762 6f78 2e73 6574 4765 6f6d   viewbox.setGeom
+00014a70: 6574 7279 2861 782e 7662 2e73 6365 6e65  etry(ax.vb.scene
+00014a80: 426f 756e 6469 6e67 5265 6374 2829 290d  BoundingRect()).
+00014a90: 0a20 2020 2061 786f 203d 2070 672e 506c  .    axo = pg.Pl
+00014aa0: 6f74 4974 656d 2865 6e61 626c 654d 656e  otItem(enableMen
+00014ab0: 753d 4661 6c73 6529 0d0a 2020 2020 6178  u=False)..    ax
+00014ac0: 6f2e 7369 676e 6966 6963 616e 745f 666f  o.significant_fo
+00014ad0: 7263 6564 203d 2046 616c 7365 0d0a 2020  rced = False..  
+00014ae0: 2020 6178 6f2e 7369 676e 6966 6963 616e    axo.significan
+00014af0: 745f 6465 6369 6d61 6c73 203d 2073 6967  t_decimals = sig
+00014b00: 6e69 6669 6361 6e74 5f64 6563 696d 616c  nificant_decimal
+00014b10: 730d 0a20 2020 2061 786f 2e73 6967 6e69  s..    axo.signi
+00014b20: 6669 6361 6e74 5f65 7073 203d 2073 6967  ficant_eps = sig
+00014b30: 6e69 6669 6361 6e74 5f65 7073 0d0a 2020  nificant_eps..  
+00014b40: 2020 6178 6f2e 7662 203d 2076 6965 7762    axo.vb = viewb
+00014b50: 6f78 0d0a 2020 2020 6178 6f2e 7072 6576  ox..    axo.prev
+00014b60: 5f61 7820 3d20 4e6f 6e65 0d0a 2020 2020  _ax = None..    
+00014b70: 6178 6f2e 6372 6f73 7368 6169 7220 3d20  axo.crosshair = 
+00014b80: 4e6f 6e65 0d0a 2020 2020 6178 6f2e 6465  None..    axo.de
+00014b90: 636f 7570 6c65 203d 2070 6172 7469 616c  couple = partial
+00014ba0: 285f 6178 5f64 6563 6f75 706c 652c 2061  (_ax_decouple, a
+00014bb0: 786f 290d 0a20 2020 2061 786f 2e64 6973  xo)..    axo.dis
+00014bc0: 6162 6c65 5f78 5f69 6e64 6578 203d 2070  able_x_index = p
+00014bd0: 6172 7469 616c 285f 6178 5f64 6973 6162  artial(_ax_disab
+00014be0: 6c65 5f78 5f69 6e64 6578 2c20 6178 6f29  le_x_index, axo)
+00014bf0: 0d0a 2020 2020 6178 6f2e 7265 7365 7420  ..    axo.reset 
+00014c00: 3d20 7061 7274 6961 6c28 5f61 785f 7265  = partial(_ax_re
+00014c10: 7365 742c 2061 786f 290d 0a20 2020 2061  set, axo)..    a
+00014c20: 786f 2e68 6964 6541 7869 7328 276c 6566  xo.hideAxis('lef
+00014c30: 7427 290d 0a20 2020 2061 786f 2e68 6964  t')..    axo.hid
+00014c40: 6541 7869 7328 2772 6967 6874 2729 0d0a  eAxis('right')..
+00014c50: 2020 2020 6178 6f2e 6869 6465 4178 6973      axo.hideAxis
+00014c60: 2827 626f 7474 6f6d 2729 0d0a 2020 2020  ('bottom')..    
+00014c70: 6178 6f2e 6869 6465 4275 7474 6f6e 7328  axo.hideButtons(
+00014c80: 290d 0a20 2020 2076 6965 7762 6f78 2e61  )..    viewbox.a
+00014c90: 6464 4974 656d 2861 786f 290d 0a20 2020  ddItem(axo)..   
+00014ca0: 2069 6620 7961 7869 7320 616e 6420 6973   if yaxis and is
+00014cb0: 696e 7374 616e 6365 2861 786f 2e76 622e  instance(axo.vb.
+00014cc0: 7769 6e2c 2070 672e 4772 6170 6869 6373  win, pg.Graphics
+00014cd0: 4c61 796f 7574 5769 6467 6574 293a 0d0a  LayoutWidget):..
+00014ce0: 2020 2020 2020 2020 6178 6920 3d20 5f63          axi = _c
+00014cf0: 7265 6174 655f 6178 6973 2870 6f73 3d27  reate_axis(pos='
+00014d00: 7927 2c20 7662 3d61 786f 2e76 622c 206f  y', vb=axo.vb, o
+00014d10: 7269 656e 7461 7469 6f6e 3d27 6c65 6674  rientation='left
+00014d20: 2729 0d0a 2020 2020 2020 2020 6178 6f2e  ')..        axo.
+00014d30: 7365 7441 7869 7349 7465 6d73 287b 276c  setAxisItems({'l
+00014d40: 6566 7427 3a20 6178 697d 290d 0a20 2020  eft': axi})..   
+00014d50: 2020 2020 2061 786f 2e76 622e 7769 6e2e       axo.vb.win.
+00014d60: 6164 6449 7465 6d28 6178 692c 2072 6f77  addItem(axi, row
+00014d70: 3d30 2c20 636f 6c3d 3029 0d0a 2020 2020  =0, col=0)..    
+00014d80: 6178 2e76 622e 7369 6752 6573 697a 6564  ax.vb.sigResized
+00014d90: 2e63 6f6e 6e65 6374 2875 7064 6174 6556  .connect(updateV
+00014da0: 6965 7729 0d0a 2020 2020 6f76 6572 6c61  iew)..    overla
+00014db0: 795f 6178 732e 6170 7065 6e64 2861 786f  y_axs.append(axo
+00014dc0: 290d 0a20 2020 2075 7064 6174 6556 6965  )..    updateVie
+00014dd0: 7728 290d 0a20 2020 2072 6574 7572 6e20  w()..    return 
+00014de0: 6178 6f0d 0a0d 0a0d 0a64 6566 205f 6178  axo......def _ax
+00014df0: 5f73 6574 5f76 6973 6962 6c65 2861 782c  _set_visible(ax,
+00014e00: 2063 726f 7373 6861 6972 3d4e 6f6e 652c   crosshair=None,
+00014e10: 2078 6178 6973 3d4e 6f6e 652c 2079 6178   xaxis=None, yax
+00014e20: 6973 3d4e 6f6e 652c 2078 6772 6964 3d4e  is=None, xgrid=N
+00014e30: 6f6e 652c 2079 6772 6964 3d4e 6f6e 6529  one, ygrid=None)
+00014e40: 3a0d 0a20 2020 2069 6620 6372 6f73 7368  :..    if crossh
+00014e50: 6169 7220 3d3d 2046 616c 7365 3a0d 0a20  air == False:.. 
+00014e60: 2020 2020 2020 2061 782e 6372 6f73 7368         ax.crossh
+00014e70: 6169 722e 6869 6465 2829 0d0a 2020 2020  air.hide()..    
+00014e80: 6966 2078 6178 6973 2069 7320 6e6f 7420  if xaxis is not 
+00014e90: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2061  None:..        a
+00014ea0: 782e 6765 7441 7869 7328 2762 6f74 746f  x.getAxis('botto
+00014eb0: 6d27 292e 7365 7453 7479 6c65 2873 686f  m').setStyle(sho
+00014ec0: 7756 616c 7565 733d 7861 7869 7329 0d0a  wValues=xaxis)..
+00014ed0: 2020 2020 6966 2079 6178 6973 2069 7320      if yaxis is 
+00014ee0: 6e6f 7420 4e6f 6e65 3a0d 0a20 2020 2020  not None:..     
+00014ef0: 2020 2061 782e 6765 7441 7869 7328 2772     ax.getAxis('r
+00014f00: 6967 6874 2729 2e73 6574 5374 796c 6528  ight').setStyle(
+00014f10: 7368 6f77 5661 6c75 6573 3d79 6178 6973  showValues=yaxis
+00014f20: 290d 0a20 2020 2069 6620 7867 7269 6420  )..    if xgrid 
+00014f30: 6973 206e 6f74 204e 6f6e 6520 6f72 2079  is not None or y
+00014f40: 6772 6964 2069 7320 6e6f 7420 4e6f 6e65  grid is not None
+00014f50: 3a0d 0a20 2020 2020 2020 2061 782e 7368  :..        ax.sh
+00014f60: 6f77 4772 6964 2878 3d78 6772 6964 2c20  owGrid(x=xgrid, 
+00014f70: 793d 7967 7269 6429 0d0a 2020 2020 2020  y=ygrid)..      
+00014f80: 2020 6966 2061 782e 6765 7441 7869 7328    if ax.getAxis(
+00014f90: 2772 6967 6874 2729 3a0d 0a20 2020 2020  'right'):..     
+00014fa0: 2020 2020 2020 2061 782e 6765 7441 7869         ax.getAxi
+00014fb0: 7328 2772 6967 6874 2729 2e73 6574 456e  s('right').setEn
+00014fc0: 6162 6c65 6428 4661 6c73 6529 0d0a 2020  abled(False)..  
+00014fd0: 2020 2020 2020 6966 2061 782e 6765 7441        if ax.getA
+00014fe0: 7869 7328 2762 6f74 746f 6d27 293a 0d0a  xis('bottom'):..
+00014ff0: 2020 2020 2020 2020 2020 2020 6178 2e67              ax.g
+00015000: 6574 4178 6973 2827 626f 7474 6f6d 2729  etAxis('bottom')
+00015010: 2e73 6574 456e 6162 6c65 6428 4661 6c73  .setEnabled(Fals
+00015020: 6529 0d0a 0d0a 0d0a 6465 6620 5f61 785f  e)......def _ax_
+00015030: 6465 636f 7570 6c65 2861 7829 3a0d 0a20  decouple(ax):.. 
+00015040: 2020 2061 782e 7365 7458 4c69 6e6b 284e     ax.setXLink(N
+00015050: 6f6e 6529 0d0a 2020 2020 6966 2061 782e  one)..    if ax.
+00015060: 7072 6576 5f61 783a 0d0a 2020 2020 2020  prev_ax:..      
+00015070: 2020 6178 2e70 7265 765f 6178 2e73 6574    ax.prev_ax.set
+00015080: 5f76 6973 6962 6c65 2878 6178 6973 3d54  _visible(xaxis=T
+00015090: 7275 6529 0d0a 0d0a 0d0a 6465 6620 5f61  rue)......def _a
+000150a0: 785f 6469 7361 626c 655f 785f 696e 6465  x_disable_x_inde
+000150b0: 7828 6178 2c20 6465 636f 7570 6c65 3d54  x(ax, decouple=T
+000150c0: 7275 6529 3a0d 0a20 2020 2061 782e 7662  rue):..    ax.vb
+000150d0: 2e78 5f69 6e64 6578 6564 203d 2046 616c  .x_indexed = Fal
+000150e0: 7365 0d0a 2020 2020 6966 2064 6563 6f75  se..    if decou
+000150f0: 706c 653a 0d0a 2020 2020 2020 2020 5f61  ple:..        _a
+00015100: 785f 6465 636f 7570 6c65 2861 7829 0d0a  x_decouple(ax)..
+00015110: 0d0a 0d0a 6465 6620 5f61 785f 7265 7365  ....def _ax_rese
+00015120: 7428 6178 293a 0d0a 2020 2020 6966 2061  t(ax):..    if a
+00015130: 782e 6372 6f73 7368 6169 7220 6973 206e  x.crosshair is n
+00015140: 6f74 204e 6f6e 653a 0d0a 2020 2020 2020  ot None:..      
+00015150: 2020 6178 2e63 726f 7373 6861 6972 2e68    ax.crosshair.h
+00015160: 6964 6528 290d 0a20 2020 2066 6f72 2069  ide()..    for i
+00015170: 7465 6d20 696e 206c 6973 7428 6178 2e69  tem in list(ax.i
+00015180: 7465 6d73 293a 0d0a 2020 2020 2020 2020  tems):..        
+00015190: 6178 2e72 656d 6f76 6549 7465 6d28 6974  ax.removeItem(it
+000151a0: 656d 290d 0a20 2020 2020 2020 2069 6620  em)..        if 
+000151b0: 6178 2e76 622e 6d61 7374 6572 5f76 6965  ax.vb.master_vie
+000151c0: 7762 6f78 2061 6e64 2068 6173 6174 7472  wbox and hasattr
+000151d0: 2869 7465 6d2c 2027 6e61 6d65 2729 2061  (item, 'name') a
+000151e0: 6e64 2069 7465 6d2e 6e61 6d65 2829 3a0d  nd item.name():.
+000151f0: 0a20 2020 2020 2020 2020 2020 206c 6567  .            leg
+00015200: 656e 6420 3d20 6178 2e76 622e 6d61 7374  end = ax.vb.mast
+00015210: 6572 5f76 6965 7762 6f78 2e70 6172 656e  er_viewbox.paren
+00015220: 7428 292e 6c65 6765 6e64 0d0a 2020 2020  t().legend..    
+00015230: 2020 2020 2020 2020 6966 206c 6567 656e          if legen
+00015240: 643a 0d0a 2020 2020 2020 2020 2020 2020  d:..            
+00015250: 2020 2020 6c65 6765 6e64 2e72 656d 6f76      legend.remov
+00015260: 6549 7465 6d28 6974 656d 290d 0a20 2020  eItem(item)..   
+00015270: 2069 6620 6178 2e6c 6567 656e 643a 0d0a   if ax.legend:..
+00015280: 2020 2020 2020 2020 6178 2e6c 6567 656e          ax.legen
+00015290: 642e 6f70 7473 5b27 6f66 6673 6574 275d  d.opts['offset']
+000152a0: 203d 204e 6f6e 650d 0a20 2020 2020 2020   = None..       
+000152b0: 2061 782e 6c65 6765 6e64 2e73 6574 5061   ax.legend.setPa
+000152c0: 7265 6e74 4974 656d 284e 6f6e 6529 0d0a  rentItem(None)..
+000152d0: 2020 2020 2020 2020 6178 2e6c 6567 656e          ax.legen
+000152e0: 6420 3d20 4e6f 6e65 0d0a 2020 2020 6178  d = None..    ax
+000152f0: 2e76 622e 7265 7365 7428 290d 0a20 2020  .vb.reset()..   
+00015300: 2061 782e 7662 2e73 6574 5f64 6174 6173   ax.vb.set_datas
+00015310: 7263 284e 6f6e 6529 0d0a 2020 2020 6966  rc(None)..    if
+00015320: 2061 782e 6372 6f73 7368 6169 7220 6973   ax.crosshair is
+00015330: 206e 6f74 204e 6f6e 653a 0d0a 2020 2020   not None:..    
+00015340: 2020 2020 6178 2e63 726f 7373 6861 6972      ax.crosshair
+00015350: 2e73 686f 7728 290d 0a20 2020 2061 782e  .show()..    ax.
+00015360: 7369 676e 6966 6963 616e 745f 666f 7263  significant_forc
+00015370: 6564 203d 2046 616c 7365 0d0a 0d0a 0d0a  ed = False......
+00015380: 6465 6620 5f63 7265 6174 655f 6c65 6765  def _create_lege
+00015390: 6e64 2861 7829 3a0d 0a20 2020 2069 6620  nd(ax):..    if 
+000153a0: 6178 2e76 622e 6d61 7374 6572 5f76 6965  ax.vb.master_vie
+000153b0: 7762 6f78 3a0d 0a20 2020 2020 2020 2061  wbox:..        a
+000153c0: 7820 3d20 6178 2e76 622e 6d61 7374 6572  x = ax.vb.master
+000153d0: 5f76 6965 7762 6f78 2e70 6172 656e 7428  _viewbox.parent(
+000153e0: 290d 0a20 2020 2069 6620 6178 2e6c 6567  )..    if ax.leg
+000153f0: 656e 6420 6973 204e 6f6e 653a 0d0a 2020  end is None:..  
+00015400: 2020 2020 2020 6178 2e6c 6567 656e 6420        ax.legend 
+00015410: 3d20 4669 6e4c 6567 656e 6449 7465 6d28  = FinLegendItem(
+00015420: 626f 7264 6572 5f63 6f6c 6f72 3d6c 6567  border_color=leg
+00015430: 656e 645f 626f 7264 6572 5f63 6f6c 6f72  end_border_color
+00015440: 2c20 6669 6c6c 5f63 6f6c 6f72 3d6c 6567  , fill_color=leg
+00015450: 656e 645f 6669 6c6c 5f63 6f6c 6f72 2c20  end_fill_color, 
+00015460: 7369 7a65 3d4e 6f6e 652c 206f 6666 7365  size=None, offse
+00015470: 743d 2833 2c32 2929 0d0a 2020 2020 2020  t=(3,2))..      
+00015480: 2020 6178 2e6c 6567 656e 642e 7365 7450    ax.legend.setP
+00015490: 6172 656e 7449 7465 6d28 6178 2e76 6229  arentItem(ax.vb)
+000154a0: 0d0a 0d0a 0d0a 6465 6620 5f75 7064 6174  ......def _updat
+000154b0: 655f 7369 676e 6966 6963 616e 7473 2861  e_significants(a
+000154c0: 782c 2064 6174 6173 7263 2c20 666f 7263  x, datasrc, forc
+000154d0: 6529 3a0d 0a20 2020 2023 2063 6865 636b  e):..    # check
+000154e0: 2069 6620 6e6f 2065 7073 696c 6f6e 2073   if no epsilon s
+000154f0: 6574 2079 6574 0d0a 2020 2020 6465 6661  et yet..    defa
+00015500: 756c 745f 6465 6320 3d20 302e 3939 203c  ult_dec = 0.99 <
+00015510: 2061 782e 7369 676e 6966 6963 616e 745f   ax.significant_
+00015520: 6465 6369 6d61 6c73 2f73 6967 6e69 6669  decimals/signifi
+00015530: 6361 6e74 5f64 6563 696d 616c 7320 3c20  cant_decimals < 
+00015540: 312e 3031 0d0a 2020 2020 6465 6661 756c  1.01..    defaul
+00015550: 745f 6570 7320 3d20 302e 3939 203c 2061  t_eps = 0.99 < a
+00015560: 782e 7369 676e 6966 6963 616e 745f 6570  x.significant_ep
+00015570: 732f 7369 676e 6966 6963 616e 745f 6570  s/significant_ep
+00015580: 7320 3c20 312e 3031 0d0a 2020 2020 6966  s < 1.01..    if
+00015590: 2066 6f72 6365 206f 7220 2864 6566 6175   force or (defau
+000155a0: 6c74 5f64 6563 2061 6e64 2064 6566 6175  lt_dec and defau
+000155b0: 6c74 5f65 7073 293a 0d0a 2020 2020 2020  lt_eps):..      
+000155c0: 2020 7472 793a 0d0a 2020 2020 2020 2020    try:..        
+000155d0: 2020 2020 7364 2c73 6520 3d20 6461 7461      sd,se = data
+000155e0: 7372 632e 6361 6c63 5f73 6967 6e69 6669  src.calc_signifi
+000155f0: 6361 6e74 5f64 6563 696d 616c 7328 6675  cant_decimals(fu
+00015600: 6c6c 3d66 6f72 6365 290d 0a20 2020 2020  ll=force)..     
+00015610: 2020 2020 2020 2069 6620 7364 206f 7220         if sd or 
+00015620: 7365 2021 3d20 7369 676e 6966 6963 616e  se != significan
+00015630: 745f 6570 733a 0d0a 2020 2020 2020 2020  t_eps:..        
+00015640: 2020 2020 2020 2020 6966 2028 666f 7263          if (forc
+00015650: 6520 616e 6420 6e6f 7420 6178 2e73 6967  e and not ax.sig
+00015660: 6e69 6669 6361 6e74 5f66 6f72 6365 6429  nificant_forced)
+00015670: 206f 7220 6465 6661 756c 745f 6465 6320   or default_dec 
+00015680: 6f72 2073 6420 3e20 6178 2e73 6967 6e69  or sd > ax.signi
+00015690: 6669 6361 6e74 5f64 6563 696d 616c 733a  ficant_decimals:
+000156a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000156b0: 2020 2020 2020 6178 2e73 6967 6e69 6669        ax.signifi
+000156c0: 6361 6e74 5f64 6563 696d 616c 7320 3d20  cant_decimals = 
+000156d0: 7364 0d0a 2020 2020 2020 2020 2020 2020  sd..            
+000156e0: 2020 2020 2020 2020 6178 2e73 6967 6e69          ax.signi
+000156f0: 6669 6361 6e74 5f66 6f72 6365 6420 7c3d  ficant_forced |=
+00015700: 2066 6f72 6365 0d0a 2020 2020 2020 2020   force..        
+00015710: 2020 2020 2020 2020 6966 2028 666f 7263          if (forc
+00015720: 6520 616e 6420 6e6f 7420 6178 2e73 6967  e and not ax.sig
+00015730: 6e69 6669 6361 6e74 5f66 6f72 6365 6429  nificant_forced)
+00015740: 206f 7220 6465 6661 756c 745f 6570 7320   or default_eps 
+00015750: 6f72 2073 6520 3c20 6178 2e73 6967 6e69  or se < ax.signi
+00015760: 6669 6361 6e74 5f65 7073 3a0d 0a20 2020  ficant_eps:..   
+00015770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015780: 2061 782e 7369 676e 6966 6963 616e 745f   ax.significant_
+00015790: 6570 7320 3d20 7365 0d0a 2020 2020 2020  eps = se..      
+000157a0: 2020 2020 2020 2020 2020 2020 2020 6178                ax
+000157b0: 2e73 6967 6e69 6669 6361 6e74 5f66 6f72  .significant_for
+000157c0: 6365 6420 7c3d 2066 6f72 6365 0d0a 2020  ced |= force..  
+000157d0: 2020 2020 2020 6578 6365 7074 3a0d 0a20        except:.. 
+000157e0: 2020 2020 2020 2020 2020 2070 6173 7320             pass 
+000157f0: 2320 6461 7461 7372 6320 7072 6f62 6162  # datasrc probab
+00015800: 6c79 2066 756c 6c20 6176 204e 614e 730d  ly full av NaNs.
+00015810: 0a0d 0a0d 0a64 6566 205f 696d 7072 6f76  .....def _improv
+00015820: 655f 7369 676e 6966 6963 616e 7473 2861  e_significants(a
+00015830: 7829 3a0d 0a20 2020 2027 2727 466f 7263  x):..    '''Forc
+00015840: 6520 7570 6461 7465 206f 6620 7468 6520  e update of the 
+00015850: 4550 5320 6966 2077 6520 626f 7468 2068  EPS if we both h
+00015860: 6176 6520 6e6f 2062 6172 732f 6361 6e64  ave no bars/cand
+00015870: 6c65 7320 414e 4420 6120 6c6f 6720 7363  les AND a log sc
+00015880: 616c 652e 0d0a 2020 2020 2020 2054 6869  ale...       Thi
+00015890: 7320 6973 2069 6e74 656e 6465 6420 746f  s is intended to
+000158a0: 2066 6978 2074 6865 206c 6f77 6572 2070   fix the lower p
+000158b0: 6172 7420 6f66 2074 6865 2067 7269 6420  art of the grid 
+000158c0: 6f6e 206c 696e 6520 706c 6f74 7320 6f6e  on line plots on
+000158d0: 2061 206c 6f67 2073 6361 6c65 2e27 2727   a log scale.'''
+000158e0: 0d0a 2020 2020 6966 2061 782e 7662 2e79  ..    if ax.vb.y
+000158f0: 7363 616c 652e 7363 616c 6574 7970 6520  scale.scaletype 
+00015900: 3d3d 2027 6c6f 6727 3a0d 0a20 2020 2020  == 'log':..     
+00015910: 2020 2069 6620 6e6f 7420 616e 7928 6973     if not any(is
+00015920: 696e 7374 616e 6365 2869 7465 6d2c 2043  instance(item, C
+00015930: 616e 646c 6573 7469 636b 4974 656d 2920  andlestickItem) 
+00015940: 666f 7220 6974 656d 2069 6e20 6178 2e69  for item in ax.i
+00015950: 7465 6d73 293a 0d0a 2020 2020 2020 2020  tems):..        
+00015960: 2020 2020 5f75 7064 6174 655f 7369 676e      _update_sign
+00015970: 6966 6963 616e 7473 2861 782c 2061 782e  ificants(ax, ax.
+00015980: 7662 2e64 6174 6173 7263 2c20 666f 7263  vb.datasrc, forc
+00015990: 653d 5472 7565 290d 0a0d 0a0d 0a64 6566  e=True)......def
+000159a0: 205f 6973 5f73 7461 6e64 616c 6f6e 6528   _is_standalone(
+000159b0: 7469 6d65 7365 7229 3a0d 0a20 2020 2023  timeser):..    #
+000159c0: 206d 6f72 6520 7468 616e 204e 2070 6572   more than N per
+000159d0: 6365 6e74 2067 6170 7320 6f72 2074 696d  cent gaps or tim
+000159e0: 6520 7265 7665 7273 616c 7320 7072 6f62  e reversals prob
+000159f0: 6162 6c79 206d 6561 6e73 2074 6869 7320  ably means this 
+00015a00: 6973 2061 2073 7461 6e64 616c 6f6e 6520  is a standalone 
+00015a10: 706c 6f74 0d0a 2020 2020 7265 7475 726e  plot..    return
+00015a20: 2074 696d 6573 6572 2e69 736e 756c 6c28   timeser.isnull(
+00015a30: 292e 7375 6d28 2920 2b20 2874 696d 6573  ).sum() + (times
+00015a40: 6572 2e64 6966 6628 293c 3d30 292e 7375  er.diff()<=0).su
+00015a50: 6d28 2920 3e20 6c65 6e28 7469 6d65 7365  m() > len(timese
+00015a60: 7229 2a30 2e31 0d0a 0d0a 0d0a 6465 6620  r)*0.1......def 
+00015a70: 5f63 7265 6174 655f 7365 7269 6573 2861  _create_series(a
+00015a80: 293a 0d0a 2020 2020 7265 7475 726e 2061  ):..    return a
+00015a90: 2069 6620 6973 696e 7374 616e 6365 2861   if isinstance(a
+00015aa0: 2c20 7064 2e53 6572 6965 7329 2065 6c73  , pd.Series) els
+00015ab0: 6520 7064 2e53 6572 6965 7328 6129 0d0a  e pd.Series(a)..
+00015ac0: 0d0a 0d0a 6465 6620 5f63 7265 6174 655f  ....def _create_
+00015ad0: 6461 7461 7372 6328 6178 2c20 2a61 7267  datasrc(ax, *arg
+00015ae0: 732c 206e 636f 6c73 3d2d 3129 3a0d 0a20  s, ncols=-1):.. 
+00015af0: 2020 2064 6566 2064 6f5f 6372 6561 7465     def do_create
+00015b00: 2861 7267 7329 3a0d 0a20 2020 2020 2020  (args):..       
+00015b10: 2069 6620 6c65 6e28 6172 6773 2920 3d3d   if len(args) ==
+00015b20: 2031 2061 6e64 2074 7970 6528 6172 6773   1 and type(args
+00015b30: 5b30 5d29 203d 3d20 5061 6e64 6173 4461  [0]) == PandasDa
+00015b40: 7461 536f 7572 6365 3a0d 0a20 2020 2020  taSource:..     
+00015b50: 2020 2020 2020 2072 6574 7572 6e20 6172         return ar
+00015b60: 6773 5b30 5d0d 0a20 2020 2020 2020 2069  gs[0]..        i
+00015b70: 6620 6c65 6e28 6172 6773 2920 3d3d 2031  f len(args) == 1
+00015b80: 2061 6e64 2074 7970 6528 6172 6773 5b30   and type(args[0
+00015b90: 5d29 2069 6e20 286c 6973 742c 2074 7570  ]) in (list, tup
+00015ba0: 6c65 293a 0d0a 2020 2020 2020 2020 2020  le):..          
+00015bb0: 2020 6172 6773 203d 205b 6e70 2e61 7272    args = [np.arr
+00015bc0: 6179 2861 7267 735b 305d 295d 0d0a 2020  ay(args[0])]..  
+00015bd0: 2020 2020 2020 6966 206c 656e 2861 7267        if len(arg
+00015be0: 7329 203d 3d20 3120 616e 6420 7479 7065  s) == 1 and type
+00015bf0: 2861 7267 735b 305d 2920 3d3d 206e 702e  (args[0]) == np.
+00015c00: 6e64 6172 7261 793a 0d0a 2020 2020 2020  ndarray:..      
+00015c10: 2020 2020 2020 6172 6773 203d 205b 7064        args = [pd
+00015c20: 2e44 6174 6146 7261 6d65 2861 7267 735b  .DataFrame(args[
+00015c30: 305d 2e54 295d 0d0a 2020 2020 2020 2020  0].T)]..        
+00015c40: 6966 206c 656e 2861 7267 7329 203d 3d20  if len(args) == 
+00015c50: 3120 616e 6420 7479 7065 2861 7267 735b  1 and type(args[
+00015c60: 305d 2920 3d3d 2070 642e 4461 7461 4672  0]) == pd.DataFr
+00015c70: 616d 653a 0d0a 2020 2020 2020 2020 2020  ame:..          
+00015c80: 2020 7265 7475 726e 2050 616e 6461 7344    return PandasD
+00015c90: 6174 6153 6f75 7263 6528 6172 6773 5b30  ataSource(args[0
+00015ca0: 5d29 0d0a 2020 2020 2020 2020 6172 6773  ])..        args
+00015cb0: 203d 205b 5f63 7265 6174 655f 7365 7269   = [_create_seri
+00015cc0: 6573 2861 2920 666f 7220 6120 696e 2061  es(a) for a in a
+00015cd0: 7267 735d 0d0a 2020 2020 2020 2020 7265  rgs]..        re
+00015ce0: 7475 726e 2050 616e 6461 7344 6174 6153  turn PandasDataS
+00015cf0: 6f75 7263 6528 7064 2e63 6f6e 6361 7428  ource(pd.concat(
+00015d00: 6172 6773 2c20 6178 6973 3d31 2929 0d0a  args, axis=1))..
+00015d10: 2020 2020 6961 7267 7320 3d20 5b61 2066      iargs = [a f
+00015d20: 6f72 2061 2069 6e20 6172 6773 2069 6620  or a in args if 
+00015d30: 6120 6973 206e 6f74 204e 6f6e 655d 0d0a  a is not None]..
+00015d40: 2020 2020 6461 7461 7372 6320 3d20 646f      datasrc = do
+00015d50: 5f63 7265 6174 6528 6961 7267 7329 0d0a  _create(iargs)..
+00015d60: 2020 2020 2320 6368 6563 6b20 6966 2074      # check if t
+00015d70: 696d 6520 636f 6c75 6d6e 206d 6973 7369  ime column missi
+00015d80: 6e67 0d0a 2020 2020 6966 206c 656e 2864  ng..    if len(d
+00015d90: 6174 6173 7263 2e64 662e 636f 6c75 6d6e  atasrc.df.column
+00015da0: 7329 2069 6e20 2831 2c20 6e63 6f6c 732d  s) in (1, ncols-
+00015db0: 3129 3a0d 0a20 2020 2020 2020 2023 2061  1):..        # a
+00015dc0: 7373 756d 6520 7469 6d65 2064 6174 6120  ssume time data 
+00015dd0: 6861 7320 616c 7265 6164 7920 6265 656e  has already been
+00015de0: 2061 6464 6564 2062 6566 6f72 650d 0a20   added before.. 
+00015df0: 2020 2020 2020 2066 6f72 2061 2069 6e20         for a in 
+00015e00: 6178 2e76 622e 7769 6e2e 6178 733a 0d0a  ax.vb.win.axs:..
+00015e10: 2020 2020 2020 2020 2020 2020 6966 2061              if a
+00015e20: 2e76 622e 6461 7461 7372 6320 616e 6420  .vb.datasrc and 
+00015e30: 6c65 6e28 612e 7662 2e64 6174 6173 7263  len(a.vb.datasrc
+00015e40: 2e64 662e 636f 6c75 6d6e 7329 203e 3d20  .df.columns) >= 
+00015e50: 323a 0d0a 2020 2020 2020 2020 2020 2020  2:..            
+00015e60: 2020 2020 6461 7461 7372 632e 6466 2e63      datasrc.df.c
+00015e70: 6f6c 756d 6e73 203d 2061 2e76 622e 6461  olumns = a.vb.da
+00015e80: 7461 7372 632e 6466 2e63 6f6c 756d 6e73  tasrc.df.columns
+00015e90: 5b31 3a6c 656e 2864 6174 6173 7263 2e64  [1:len(datasrc.d
+00015ea0: 662e 636f 6c75 6d6e 7329 2b31 5d0d 0a20  f.columns)+1].. 
+00015eb0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00015ec0: 6f6c 203d 2061 2e76 622e 6461 7461 7372  ol = a.vb.datasr
+00015ed0: 632e 6466 2e63 6f6c 756d 6e73 5b30 5d0d  c.df.columns[0].
+00015ee0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00015ef0: 2064 6174 6173 7263 2e64 662e 696e 7365   datasrc.df.inse
+00015f00: 7274 2830 2c20 636f 6c2c 2061 2e76 622e  rt(0, col, a.vb.
+00015f10: 6461 7461 7372 632e 6466 5b63 6f6c 5d29  datasrc.df[col])
+00015f20: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00015f30: 2020 6461 7461 7372 6320 3d20 5061 6e64    datasrc = Pand
+00015f40: 6173 4461 7461 536f 7572 6365 2864 6174  asDataSource(dat
+00015f50: 6173 7263 2e64 6629 0d0a 2020 2020 2020  asrc.df)..      
+00015f60: 2020 2020 2020 2020 2020 6272 6561 6b0d            break.
+00015f70: 0a20 2020 2020 2020 2069 6620 6c65 6e28  .        if len(
+00015f80: 6461 7461 7372 632e 6466 2e63 6f6c 756d  datasrc.df.colum
+00015f90: 6e73 2920 696e 2028 312c 206e 636f 6c73  ns) in (1, ncols
+00015fa0: 2d31 293a 0d0a 2020 2020 2020 2020 2020  -1):..          
+00015fb0: 2020 6966 206e 636f 6c73 203e 2031 3a0d    if ncols > 1:.
+00015fc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00015fd0: 2070 7269 6e74 2866 2257 4152 4e49 4e47   print(f"WARNING
+00015fe0: 3a20 7468 6973 2074 7970 6520 6f66 2070  : this type of p
+00015ff0: 6c6f 7420 7761 6e74 7320 2569 2063 6f6c  lot wants %i col
+00016000: 756d 6e73 2f61 7267 732c 2062 7574 2079  umns/args, but y
+00016010: 6f75 2776 6520 6f6e 6c79 2073 7570 706c  ou've only suppl
+00016020: 6965 6420 2569 2220 2520 286e 636f 6c73  ied %i" % (ncols
+00016030: 2c20 6c65 6e28 6461 7461 7372 632e 6466  , len(datasrc.df
+00016040: 2e63 6f6c 756d 6e73 2929 290d 0a20 2020  .columns)))..   
+00016050: 2020 2020 2020 2020 2020 2020 2070 7269               pri
+00016060: 6e74 2827 202d 2041 7373 756d 696e 6720  nt(' - Assuming 
+00016070: 7469 6d65 2063 6f6c 756d 6e20 6973 206d  time column is m
+00016080: 6973 7369 6e67 2061 6e64 2075 7369 6e67  issing and using
+00016090: 2069 6e64 6578 2069 6e73 7465 6164 2e27   index instead.'
+000160a0: 290d 0a20 2020 2020 2020 2020 2020 2064  )..            d
+000160b0: 6174 6173 7263 203d 2050 616e 6461 7344  atasrc = PandasD
+000160c0: 6174 6153 6f75 7263 6528 6461 7461 7372  ataSource(datasr
+000160d0: 632e 6466 2e72 6573 6574 5f69 6e64 6578  c.df.reset_index
+000160e0: 2829 290d 0a20 2020 2065 6c69 6620 6c65  ())..    elif le
+000160f0: 6e28 6961 7267 7329 203e 3d20 3220 616e  n(iargs) >= 2 an
+00016100: 6420 6c65 6e28 6461 7461 7372 632e 6466  d len(datasrc.df
+00016110: 2e63 6f6c 756d 6e73 2920 3d3d 206c 656e  .columns) == len
+00016120: 2869 6172 6773 292b 3120 616e 6420 6c65  (iargs)+1 and le
+00016130: 6e28 6961 7267 7329 203d 3d20 6c65 6e28  n(iargs) == len(
+00016140: 6172 6773 293a 0d0a 2020 2020 2020 2020  args):..        
+00016150: 7472 793a 0d0a 2020 2020 2020 2020 2020  try:..          
+00016160: 2020 6966 2027 2e49 6e74 2720 696e 2073    if '.Int' in s
+00016170: 7472 2874 7970 6528 6961 7267 735b 305d  tr(type(iargs[0]
+00016180: 2e69 6e64 6578 2929 3a0d 0a20 2020 2020  .index)):..     
+00016190: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+000161a0: 2827 5741 524e 494e 473a 2070 6572 666f  ('WARNING: perfo
+000161b0: 726d 616e 6365 2070 656e 616c 7479 2061  rmance penalty a
+000161c0: 6e64 2063 7261 7368 206d 6179 206f 6363  nd crash may occ
+000161d0: 7572 2077 6865 6e20 7573 696e 6720 696e  ur when using in
+000161e0: 7436 3420 696e 7374 6561 6420 6f66 2072  t64 instead of r
+000161f0: 616e 6765 2069 6e64 6963 6573 2e27 290d  ange indices.').
+00016200: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00016210: 2069 6620 2869 6172 6773 5b30 5d2e 696e   if (iargs[0].in
+00016220: 6465 7820 3d3d 2072 616e 6765 286c 656e  dex == range(len
+00016230: 2869 6172 6773 5b30 5d29 2929 2e61 6c6c  (iargs[0]))).all
+00016240: 2829 3a0d 0a20 2020 2020 2020 2020 2020  ():..           
+00016250: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
+00016260: 202d 2046 6978 2062 7920 2e72 6573 6574   - Fix by .reset
+00016270: 5f69 6e64 6578 2864 726f 703d 5472 7565  _index(drop=True
+00016280: 2927 290d 0a20 2020 2020 2020 2020 2020  )')..           
+00016290: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+000162a0: 5f63 7265 6174 655f 6461 7461 7372 6328  _create_datasrc(
+000162b0: 6178 2c20 6461 7461 7372 632e 6466 5b64  ax, datasrc.df[d
+000162c0: 6174 6173 7263 2e64 662e 636f 6c75 6d6e  atasrc.df.column
+000162d0: 735b 313a 5d5d 2c20 6e63 6f6c 733d 6e63  s[1:]], ncols=nc
+000162e0: 6f6c 7329 0d0a 2020 2020 2020 2020 6578  ols)..        ex
+000162f0: 6365 7074 3a0d 0a20 2020 2020 2020 2020  cept:..         
+00016300: 2020 2070 7269 6e74 2827 5741 524e 494e     print('WARNIN
+00016310: 473a 2069 6e70 7574 2064 6174 6120 736f  G: input data so
+00016320: 7572 6365 206d 6179 2063 6175 7365 2070  urce may cause p
+00016330: 6572 666f 726d 616e 6365 2070 656e 616c  erformance penal
+00016340: 7479 2061 6e64 2063 7261 7368 2e27 290d  ty and crash.').
+00016350: 0a0d 0a20 2020 2061 7373 6572 7420 6c65  ...    assert le
+00016360: 6e28 6461 7461 7372 632e 6466 2e63 6f6c  n(datasrc.df.col
+00016370: 756d 6e73 2920 3e3d 206e 636f 6c73 2c20  umns) >= ncols, 
+00016380: 2745 5252 4f52 3a20 746f 6f20 6665 7720  'ERROR: too few 
+00016390: 636f 6c75 6d6e 732f 6172 6773 2073 7570  columns/args sup
+000163a0: 706c 6965 6420 666f 7220 7468 6973 2070  plied for this p
+000163b0: 6c6f 7427 0d0a 0d0a 2020 2020 6966 2064  lot'....    if d
+000163c0: 6174 6173 7263 2e70 6572 696f 645f 6e73  atasrc.period_ns
+000163d0: 203c 2030 3a0d 0a20 2020 2020 2020 2070   < 0:..        p
+000163e0: 7269 6e74 2827 5741 524e 494e 473a 2069  rint('WARNING: i
+000163f0: 6e70 7574 2064 6174 6120 736f 7572 6365  nput data source
+00016400: 2068 6173 2074 696d 6520 696e 2064 6573   has time in des
+00016410: 6365 6e64 696e 6720 6f72 6465 722e 2054  cending order. T
+00016420: 7279 2073 6f72 745f 7661 6c75 6573 2829  ry sort_values()
+00016430: 2062 6566 6f72 6520 6361 6c6c 696e 672e   before calling.
+00016440: 2729 0d0a 0d0a 2020 2020 2320 4649 583a  ')....    # FIX:
+00016450: 2073 7475 7069 6420 5154 2062 7567 2063   stupid QT bug c
+00016460: 6175 7365 7320 7265 6374 616e 676c 6573  auses rectangles
+00016470: 206c 6172 6765 7220 7468 616e 2032 4720   larger than 2G 
+00016480: 746f 2066 6c69 636b 6572 2c20 736f 2073  to flicker, so s
+00016490: 6361 6c65 2072 656e 6465 7269 6e67 2064  cale rendering d
+000164a0: 6f77 6e20 736f 6d65 0d0a 2020 2020 2320  own some..    # 
+000164b0: 4649 583a 2050 7951 7420 352e 3135 2e32  FIX: PyQt 5.15.2
+000164c0: 206c 696e 6573 203e 3165 3620 6172 6520   lines >1e6 are 
+000164d0: 6265 696e 6720 636c 6970 7065 6420 746f  being clipped to
+000164e0: 2031 6536 2064 7572 696e 6720 7468 6520   1e6 during the 
+000164f0: 6669 7273 7420 7265 6e64 6572 2070 6173  first render pas
+00016500: 732c 2073 6f20 7363 616c 6520 646f 776e  s, so scale down
+00016510: 2069 6620 3e31 6536 0d0a 2020 2020 6966   if >1e6..    if
+00016520: 2064 6174 6173 7263 2e64 662e 696c 6f63   datasrc.df.iloc
+00016530: 5b3a 2c20 313a 5d2e 6d61 7828 6e75 6d65  [:, 1:].max(nume
+00016540: 7269 635f 6f6e 6c79 3d54 7275 6529 2e6d  ric_only=True).m
+00016550: 6178 2829 203e 2031 6536 3a0d 0a20 2020  ax() > 1e6:..   
+00016560: 2020 2020 2061 782e 7662 2e79 7363 616c       ax.vb.yscal
+00016570: 652e 7365 745f 7363 616c 6528 696e 7428  e.set_scale(int(
+00016580: 3165 3629 290d 0a20 2020 2072 6574 7572  1e6))..    retur
+00016590: 6e20 6461 7461 7372 630d 0a0d 0a0d 0a64  n datasrc......d
+000165a0: 6566 205f 7365 745f 6461 7461 7372 6328  ef _set_datasrc(
+000165b0: 6178 2c20 6461 7461 7372 632c 2061 6464  ax, datasrc, add
+000165c0: 636f 6c73 3d54 7275 6529 3a0d 0a20 2020  cols=True):..   
+000165d0: 2076 6965 7762 6f78 203d 2061 782e 7662   viewbox = ax.vb
+000165e0: 0d0a 2020 2020 6966 206e 6f74 2064 6174  ..    if not dat
+000165f0: 6173 7263 2e73 7461 6e64 616c 6f6e 653a  asrc.standalone:
+00016600: 0d0a 2020 2020 2020 2020 6966 2076 6965  ..        if vie
+00016610: 7762 6f78 2e64 6174 6173 7263 2069 7320  wbox.datasrc is 
+00016620: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
+00016630: 2020 2076 6965 7762 6f78 2e73 6574 5f64     viewbox.set_d
+00016640: 6174 6173 7263 2864 6174 6173 7263 2920  atasrc(datasrc) 
+00016650: 2320 666f 7220 6d77 6865 656c 207a 6f6f  # for mwheel zoo
+00016660: 6d2d 7363 616c 696e 670d 0a20 2020 2020  m-scaling..     
+00016670: 2020 2020 2020 205f 7365 745f 785f 6c69         _set_x_li
+00016680: 6d69 7473 2861 782c 2064 6174 6173 7263  mits(ax, datasrc
+00016690: 290d 0a20 2020 2020 2020 2065 6c73 653a  )..        else:
+000166a0: 0d0a 2020 2020 2020 2020 2020 2020 7430  ..            t0
+000166b0: 203d 2076 6965 7762 6f78 2e64 6174 6173   = viewbox.datas
+000166c0: 7263 2e78 2e6c 6f63 5b30 5d0d 0a20 2020  rc.x.loc[0]..   
+000166d0: 2020 2020 2020 2020 2069 6620 6164 6463           if addc
+000166e0: 6f6c 733a 0d0a 2020 2020 2020 2020 2020  ols:..          
+000166f0: 2020 2020 2020 7669 6577 626f 782e 6461        viewbox.da
+00016700: 7461 7372 632e 6164 6463 6f6c 7328 6461  tasrc.addcols(da
+00016710: 7461 7372 6329 0d0a 2020 2020 2020 2020  tasrc)..        
+00016720: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
+00016730: 2020 2020 2020 2020 2020 2076 6965 7762             viewb
+00016740: 6f78 2e64 6174 6173 7263 2e64 6620 3d20  ox.datasrc.df = 
+00016750: 6461 7461 7372 632e 6466 0d0a 2020 2020  datasrc.df..    
+00016760: 2020 2020 2020 2020 2320 6368 6563 6b20          # check 
+00016770: 6966 2077 6520 6e65 6564 2074 6f20 7265  if we need to re
+00016780: 2d72 656e 6465 7220 7072 6576 696f 7573  -render previous
+00016790: 2070 6c6f 7473 2064 7565 2074 6f20 6368   plots due to ch
+000167a0: 616e 6765 6420 696e 6469 6365 730d 0a20  anged indices.. 
+000167b0: 2020 2020 2020 2020 2020 2069 6e64 6963             indic
+000167c0: 6573 5f75 7064 6174 6564 203d 2076 6965  es_updated = vie
+000167d0: 7762 6f78 2e64 6174 6173 7263 2e74 696d  wbox.datasrc.tim
+000167e0: 6562 6173 6564 2829 2061 6e64 2074 3020  ebased() and t0 
+000167f0: 213d 2076 6965 7762 6f78 2e64 6174 6173  != viewbox.datas
+00016800: 7263 2e78 2e6c 6f63 5b30 5d0d 0a20 2020  rc.x.loc[0]..   
+00016810: 2020 2020 2020 2020 2066 6f72 2069 7465           for ite
+00016820: 6d20 696e 2061 782e 6974 656d 733a 0d0a  m in ax.items:..
+00016830: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016840: 6966 2068 6173 6174 7472 2869 7465 6d2c  if hasattr(item,
+00016850: 2027 6461 7461 7372 6327 2920 616e 6420   'datasrc') and 
+00016860: 6e6f 7420 6974 656d 2e64 6174 6173 7263  not item.datasrc
+00016870: 2e73 7461 6e64 616c 6f6e 653a 0d0a 2020  .standalone:..  
+00016880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016890: 2020 6974 656d 2e64 6174 6173 7263 2e73    item.datasrc.s
+000168a0: 6574 5f64 6628 7669 6577 626f 782e 6461  et_df(viewbox.da
+000168b0: 7461 7372 632e 6466 2920 2320 6576 6572  tasrc.df) # ever
+000168c0: 7920 706c 6f74 2068 6572 6520 6e6f 7720  y plot here now 
+000168d0: 6861 7320 7468 6520 7361 6d65 2074 696d  has the same tim
+000168e0: 652d 6672 616d 650d 0a20 2020 2020 2020  e-frame..       
+000168f0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00016900: 696e 6469 6365 735f 7570 6461 7465 643a  indices_updated:
+00016910: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00016920: 2020 2020 2020 2020 2020 5f73 7461 7274            _start
+00016930: 5f76 6973 7561 6c5f 7570 6461 7465 2869  _visual_update(i
+00016940: 7465 6d29 0d0a 2020 2020 2020 2020 2020  tem)..          
+00016950: 2020 2020 2020 2020 2020 2020 2020 5f65                _e
+00016960: 6e64 5f76 6973 7561 6c5f 7570 6461 7465  nd_visual_update
+00016970: 2869 7465 6d29 0d0a 2020 2020 2020 2020  (item)..        
+00016980: 2020 2020 5f73 6574 5f78 5f6c 696d 6974      _set_x_limit
+00016990: 7328 6178 2c20 6461 7461 7372 6329 0d0a  s(ax, datasrc)..
+000169a0: 2020 2020 2020 2020 2020 2020 7669 6577              view
+000169b0: 626f 782e 7365 745f 6461 7461 7372 6328  box.set_datasrc(
+000169c0: 7669 6577 626f 782e 6461 7461 7372 6329  viewbox.datasrc)
+000169d0: 2023 2075 7064 6174 6520 7a6f 6f6d 0d0a   # update zoom..
+000169e0: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
+000169f0: 2020 2076 6965 7762 6f78 2e73 7461 6e64     viewbox.stand
+00016a00: 616c 6f6e 6573 2e61 6464 2864 6174 6173  alones.add(datas
+00016a10: 7263 290d 0a20 2020 2020 2020 2064 6174  rc)..        dat
+00016a20: 6173 7263 2e75 7064 6174 655f 696e 6974  asrc.update_init
+00016a30: 5f78 2876 6965 7762 6f78 2e69 6e69 745f  _x(viewbox.init_
+00016a40: 7374 6570 7329 0d0a 2020 2020 2020 2020  steps)..        
+00016a50: 6966 2064 6174 6173 7263 2e74 696d 6562  if datasrc.timeb
+00016a60: 6173 6564 2829 2061 6e64 2076 6965 7762  ased() and viewb
+00016a70: 6f78 2e64 6174 6173 7263 2069 7320 6e6f  ox.datasrc is no
+00016a80: 7420 4e6f 6e65 3a0d 0a20 2020 2020 2020  t None:..       
+00016a90: 2020 2020 2023 2320 7072 696e 7428 2757       ## print('W
+00016aa0: 4152 4e49 4e47 3a20 7265 2d69 6e64 6578  ARNING: re-index
+00016ab0: 696e 6720 7374 616e 6461 6c6f 6e65 2c20  ing standalone, 
+00016ac0: 7469 6d65 2d62 6173 6564 2070 6c6f 7427  time-based plot'
+00016ad0: 290d 0a20 2020 2020 2020 2020 2020 2076  )..            v
+00016ae0: 6466 203d 2076 6965 7762 6f78 2e64 6174  df = viewbox.dat
+00016af0: 6173 7263 2e64 660d 0a20 2020 2020 2020  asrc.df..       
+00016b00: 2020 2020 2064 203d 207b 763a 6b20 666f       d = {v:k fo
+00016b10: 7220 6b2c 7620 696e 2065 6e75 6d65 7261  r k,v in enumera
+00016b20: 7465 2876 6466 5b76 6466 2e63 6f6c 756d  te(vdf[vdf.colum
+00016b30: 6e73 5b30 5d5d 297d 0d0a 2020 2020 2020  ns[0]])}..      
+00016b40: 2020 2020 2020 6461 7461 7372 632e 6466        datasrc.df
+00016b50: 2e69 6e64 6578 203d 205b 645b 695d 2066  .index = [d[i] f
+00016b60: 6f72 2069 2069 6e20 6461 7461 7372 632e  or i in datasrc.
+00016b70: 6466 5b64 6174 6173 7263 2e64 662e 636f  df[datasrc.df.co
+00016b80: 6c75 6d6e 735b 305d 5d5d 0d0a 2020 2020  lumns[0]]]..    
+00016b90: 2020 2020 2323 2069 6620 6e6f 7420 7669      ## if not vi
+00016ba0: 6577 626f 782e 785f 696e 6465 7865 643a  ewbox.x_indexed:
+00016bb0: 0d0a 2020 2020 2020 2020 2020 2020 2323  ..            ##
+00016bc0: 205f 7365 745f 785f 6c69 6d69 7473 2861   _set_x_limits(a
+00016bd0: 782c 2064 6174 6173 7263 290d 0a20 2020  x, datasrc)..   
+00016be0: 2023 2075 7064 6174 6520 7065 7269 6f64   # update period
+00016bf0: 2069 6620 7468 6973 2064 6174 6173 7263   if this datasrc
+00016c00: 2068 6173 2068 6967 6865 7220 7469 6d65   has higher time
+00016c10: 2072 6573 6f6c 7574 696f 6e0d 0a20 2020   resolution..   
+00016c20: 2067 6c6f 6261 6c20 6570 6f63 685f 7065   global epoch_pe
+00016c30: 7269 6f64 0d0a 2020 2020 6966 2064 6174  riod..    if dat
+00016c40: 6173 7263 2e74 696d 6562 6173 6564 2829  asrc.timebased()
+00016c50: 2061 6e64 2028 6570 6f63 685f 7065 7269   and (epoch_peri
+00016c60: 6f64 203e 2031 6537 206f 7220 6e6f 7420  od > 1e7 or not 
+00016c70: 6461 7461 7372 632e 7374 616e 6461 6c6f  datasrc.standalo
+00016c80: 6e65 293a 0d0a 2020 2020 2020 2020 6570  ne):..        ep
+00016c90: 5f73 6563 7320 3d20 6461 7461 7372 632e  _secs = datasrc.
+00016ca0: 7065 7269 6f64 5f6e 7320 2f20 3165 390d  period_ns / 1e9.
+00016cb0: 0a20 2020 2020 2020 2065 706f 6368 5f70  .        epoch_p
+00016cc0: 6572 696f 6420 3d20 6570 5f73 6563 7320  eriod = ep_secs 
+00016cd0: 6966 2065 705f 7365 6373 203c 2065 706f  if ep_secs < epo
+00016ce0: 6368 5f70 6572 696f 6420 656c 7365 2065  ch_period else e
+00016cf0: 706f 6368 5f70 6572 696f 640d 0a0d 0a0d  poch_period.....
+00016d00: 0a64 6566 205f 6861 735f 7469 6d65 636f  .def _has_timeco
+00016d10: 6c28 6466 293a 0d0a 2020 2020 7265 7475  l(df):..    retu
+00016d20: 726e 206c 656e 2864 662e 636f 6c75 6d6e  rn len(df.column
+00016d30: 7329 203e 3d20 320d 0a0d 0a0d 0a64 6566  s) >= 2......def
+00016d40: 205f 7365 745f 6d61 785f 7a6f 6f6d 2876   _set_max_zoom(v
+00016d50: 6273 293a 0d0a 2020 2020 2727 2753 6574  bs):..    '''Set
+00016d60: 2074 6865 2072 656c 6174 6976 6520 616c   the relative al
+00016d70: 6c6f 7765 6420 7a6f 6f6d 206c 6576 656c  lowed zoom level
+00016d80: 2062 6574 7765 656e 2061 7865 7320 6772   between axes gr
+00016d90: 6f75 7073 2c20 7768 6572 6520 7468 6520  oups, where the 
+00016da0: 6c6f 7765 7374 2d72 6573 6f6c 7574 696f  lowest-resolutio
+00016db0: 6e0d 0a20 2020 2020 2020 706c 6f74 2069  n..       plot i
+00016dc0: 6e20 6561 6368 2067 726f 7570 2075 7365  n each group use
+00016dd0: 7320 6d61 785f 7a6f 6f6d 5f70 6f69 6e74  s max_zoom_point
+00016de0: 732c 2077 6869 6c65 2074 6865 206f 7468  s, while the oth
+00016df0: 6572 7320 6765 7420 6120 7363 616c 6520  ers get a scale 
+00016e00: 3e3d 3120 6f66 2074 6865 6972 0d0a 2020  >=1 of their..  
+00016e10: 2020 2020 2072 6573 7065 6374 6976 6520       respective 
+00016e20: 6869 6768 6573 7420 7a6f 6f6d 206c 6576  highest zoom lev
+00016e30: 656c 2e27 2727 0d0a 2020 2020 6772 6f75  el.'''..    grou
+00016e40: 7073 203d 2064 6566 6175 6c74 6469 6374  ps = defaultdict
+00016e50: 2873 6574 290d 0a20 2020 2066 6f72 2076  (set)..    for v
+00016e60: 6220 696e 2076 6273 3a0d 0a20 2020 2020  b in vbs:..     
+00016e70: 2020 206d 6173 7465 725f 7662 203d 2076     master_vb = v
+00016e80: 622e 6c69 6e6b 6564 5669 6577 2830 290d  b.linkedView(0).
+00016e90: 0a20 2020 2020 2020 2069 6620 7662 2e64  .        if vb.d
+00016ea0: 6174 6173 7263 2061 6e64 206d 6173 7465  atasrc and maste
+00016eb0: 725f 7662 2061 6e64 206d 6173 7465 725f  r_vb and master_
+00016ec0: 7662 2e64 6174 6173 7263 3a0d 0a20 2020  vb.datasrc:..   
+00016ed0: 2020 2020 2020 2020 2067 726f 7570 735b           groups[
+00016ee0: 6d61 7374 6572 5f76 625d 2e61 6464 2876  master_vb].add(v
+00016ef0: 6229 0d0a 2020 2020 2020 2020 2020 2020  b)..            
+00016f00: 6772 6f75 7073 5b6d 6173 7465 725f 7662  groups[master_vb
+00016f10: 5d2e 6164 6428 6d61 7374 6572 5f76 6229  ].add(master_vb)
+00016f20: 0d0a 2020 2020 666f 7220 6772 6f75 7020  ..    for group 
+00016f30: 696e 2067 726f 7570 732e 7661 6c75 6573  in groups.values
+00016f40: 2829 3a0d 0a20 2020 2020 2020 206d 696e  ():..        min
+00016f50: 6c65 6e20 3d20 6d69 6e28 6c65 6e28 7662  len = min(len(vb
+00016f60: 2e64 6174 6173 7263 2e64 6629 2066 6f72  .datasrc.df) for
+00016f70: 2076 6220 696e 2067 726f 7570 290d 0a20   vb in group).. 
+00016f80: 2020 2020 2020 2066 6f72 2076 6220 696e         for vb in
+00016f90: 2067 726f 7570 3a0d 0a20 2020 2020 2020   group:..       
+00016fa0: 2020 2020 2076 622e 6d61 785f 7a6f 6f6d       vb.max_zoom
+00016fb0: 5f70 6f69 6e74 735f 6620 3d20 6c65 6e28  _points_f = len(
+00016fc0: 7662 2e64 6174 6173 7263 2e64 6629 202f  vb.datasrc.df) /
+00016fd0: 206d 696e 6c65 6e0d 0a0d 0a0d 0a64 6566   minlen......def
+00016fe0: 205f 6164 6a75 7374 5f72 656e 6b6f 5f64   _adjust_renko_d
+00016ff0: 6174 6173 7263 2862 696e 732c 2073 7465  atasrc(bins, ste
+00017000: 702c 2064 6174 6173 7263 293a 0d0a 2020  p, datasrc):..  
+00017010: 2020 6966 206e 6f74 2062 696e 7320 616e    if not bins an
+00017020: 6420 6e6f 7420 7374 6570 3a0d 0a20 2020  d not step:..   
+00017030: 2020 2020 2062 696e 7320 3d20 3530 0d0a       bins = 50..
+00017040: 2020 2020 6966 206e 6f74 2073 7465 703a      if not step:
+00017050: 0d0a 2020 2020 2020 2020 7374 6570 203d  ..        step =
+00017060: 2028 6461 7461 7372 632e 792e 6d61 7828   (datasrc.y.max(
+00017070: 292d 6461 7461 7372 632e 792e 6d69 6e28  )-datasrc.y.min(
+00017080: 2929 202f 2062 696e 730d 0a20 2020 2062  )) / bins..    b
+00017090: 7269 636b 7320 3d20 6461 7461 7372 632e  ricks = datasrc.
+000170a0: 792e 6469 6666 2829 202f 2073 7465 700d  y.diff() / step.
+000170b0: 0a20 2020 2062 7269 636b 7320 3d20 2864  .    bricks = (d
+000170c0: 6174 6173 7263 2e79 5b62 7269 636b 732e  atasrc.y[bricks.
+000170d0: 6973 6e75 6c6c 2829 207c 2028 6272 6963  isnull() | (bric
+000170e0: 6b73 2e61 6273 2829 3e3d 302e 3529 5d20  ks.abs()>=0.5)] 
+000170f0: 2f20 7374 6570 292e 726f 756e 6428 292e  / step).round().
+00017100: 6173 7479 7065 2869 6e74 290d 0a20 2020  astype(int)..   
+00017110: 2065 7874 7261 7320 3d20 6461 7461 7372   extras = datasr
+00017120: 632e 6466 2e69 6c6f 635b 3a2c 2064 6174  c.df.iloc[:, dat
+00017130: 6173 7263 2e63 6f6c 5f64 6174 615f 6f66  asrc.col_data_of
+00017140: 6673 6574 2b31 3a5d 0d0a 2020 2020 7473  fset+1:]..    ts
+00017150: 203d 2064 6174 6173 7263 2e78 5b62 7269   = datasrc.x[bri
+00017160: 636b 732e 696e 6465 785d 0d0a 2020 2020  cks.index]..    
+00017170: 7570 203d 2062 7269 636b 732e 696c 6f63  up = bricks.iloc
+00017180: 5b30 5d20 2b20 310d 0a20 2020 2064 6e20  [0] + 1..    dn 
+00017190: 3d20 7570 202d 2032 0d0a 2020 2020 6461  = up - 2..    da
+000171a0: 7461 203d 205b 5d0d 0a20 2020 2066 6f72  ta = []..    for
+000171b0: 2074 2c69 2c62 7269 636b 2069 6e20 7a69   t,i,brick in zi
+000171c0: 7028 7473 2c20 6272 6963 6b73 2e69 6e64  p(ts, bricks.ind
+000171d0: 6578 2c20 6272 6963 6b73 293a 0d0a 2020  ex, bricks):..  
+000171e0: 2020 2020 2020 7320 3d20 300d 0a20 2020        s = 0..   
+000171f0: 2020 2020 2069 6620 6272 6963 6b20 3e3d       if brick >=
+00017200: 2075 703a 0d0a 2020 2020 2020 2020 2020   up:..          
+00017210: 2020 7830 2c78 312c 7320 3d20 7570 2d31    x0,x1,s = up-1
+00017220: 2c62 7269 636b 2c2b 310d 0a20 2020 2020  ,brick,+1..     
+00017230: 2020 2020 2020 2075 7020 3d20 6272 6963         up = bric
+00017240: 6b2b 310d 0a20 2020 2020 2020 2020 2020  k+1..           
+00017250: 2064 6e20 3d20 6272 6963 6b2d 320d 0a20   dn = brick-2.. 
+00017260: 2020 2020 2020 2065 6c69 6620 6272 6963         elif bric
+00017270: 6b20 3c3d 2064 6e3a 0d0a 2020 2020 2020  k <= dn:..      
+00017280: 2020 2020 2020 7830 2c78 312c 7320 3d20        x0,x1,s = 
+00017290: 646e 2c62 7269 636b 2d31 2c2d 310d 0a20  dn,brick-1,-1.. 
+000172a0: 2020 2020 2020 2020 2020 2075 7020 3d20             up = 
+000172b0: 6272 6963 6b2b 320d 0a20 2020 2020 2020  brick+2..       
+000172c0: 2020 2020 2064 6e20 3d20 6272 6963 6b2d       dn = brick-
+000172d0: 310d 0a20 2020 2020 2020 2069 6620 733a  1..        if s:
+000172e0: 0d0a 2020 2020 2020 2020 2020 2020 666f  ..            fo
+000172f0: 7220 7820 696e 2072 616e 6765 2878 302c  r x in range(x0,
+00017300: 2078 312c 2073 293a 0d0a 2020 2020 2020   x1, s):..      
+00017310: 2020 2020 2020 2020 2020 7464 203d 2061            td = a
+00017320: 6273 2878 312d 7829 2d31 0d0a 2020 2020  bs(x1-x)-1..    
+00017330: 2020 2020 2020 2020 2020 2020 6473 203d              ds =
+00017340: 2030 2069 6620 733e 3020 656c 7365 2073   0 if s>0 else s
+00017350: 7465 700d 0a20 2020 2020 2020 2020 2020  tep..           
+00017360: 2020 2020 2079 203d 2078 2a73 7465 700d       y = x*step.
+00017370: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017380: 207a 203d 206c 6973 7428 6578 7472 6173   z = list(extras
+00017390: 2e6c 6f63 5b69 5d29 0d0a 2020 2020 2020  .loc[i])..      
+000173a0: 2020 2020 2020 2020 2020 6461 7461 2e61            data.a
+000173b0: 7070 656e 6428 5b74 2d74 642c 2079 2b64  ppend([t-td, y+d
+000173c0: 732c 2079 2b73 7465 702d 6473 2c20 792b  s, y+step-ds, y+
+000173d0: 7374 6570 2c20 795d 202b 207a 290d 0a20  step, y] + z).. 
+000173e0: 2020 2064 6174 6173 7263 2e73 6574 5f64     datasrc.set_d
+000173f0: 6628 7064 2e44 6174 6146 7261 6d65 2864  f(pd.DataFrame(d
+00017400: 6174 612c 2063 6f6c 756d 6e73 3d27 7469  ata, columns='ti
+00017410: 6d65 206f 7065 6e20 636c 6f73 6520 6869  me open close hi
+00017420: 6768 206c 6f77 272e 7370 6c69 7428 292b  gh low'.split()+
+00017430: 6c69 7374 2865 7874 7261 732e 636f 6c75  list(extras.colu
+00017440: 6d6e 7329 2929 0d0a 0d0a 0d0a 6465 6620  mns)))......def 
+00017450: 5f61 646a 7573 745f 7265 6e6b 6f5f 6c6f  _adjust_renko_lo
+00017460: 675f 6461 7461 7372 6328 6269 6e73 2c20  g_datasrc(bins, 
+00017470: 7374 6570 2c20 6461 7461 7372 6329 3a0d  step, datasrc):.
+00017480: 0a20 2020 2064 6174 6173 7263 2e64 662e  .    datasrc.df.
+00017490: 6c6f 635b 3a2c 6461 7461 7372 632e 6466  loc[:,datasrc.df
+000174a0: 2e63 6f6c 756d 735b 315d 5d20 3d20 6e70  .colums[1]] = np
+000174b0: 2e6c 6f67 3130 2864 6174 6173 7263 2e64  .log10(datasrc.d
+000174c0: 662e 696c 6f63 5b3a 2c31 5d29 0d0a 2020  f.iloc[:,1])..  
+000174d0: 2020 5f61 646a 7573 745f 7265 6e6b 6f5f    _adjust_renko_
+000174e0: 6461 7461 7372 6328 6269 6e73 2c20 7374  datasrc(bins, st
+000174f0: 6570 2c20 6461 7461 7372 6329 0d0a 2020  ep, datasrc)..  
+00017500: 2020 6461 7461 7372 632e 6466 2e6c 6f63    datasrc.df.loc
+00017510: 5b3a 2c64 6174 6173 7263 2e64 662e 636f  [:,datasrc.df.co
+00017520: 6c75 6d73 5b31 3a35 5d5d 203d 2031 302a  lums[1:5]] = 10*
+00017530: 2a64 6174 6173 7263 2e64 662e 696c 6f63  *datasrc.df.iloc
+00017540: 5b3a 2c31 3a35 5d0d 0a0d 0a0d 0a64 6566  [:,1:5]......def
+00017550: 205f 6164 6a75 7374 5f76 6f6c 756d 655f   _adjust_volume_
+00017560: 6461 7461 7372 6328 6461 7461 7372 6329  datasrc(datasrc)
+00017570: 3a0d 0a20 2020 2069 6620 6c65 6e28 6461  :..    if len(da
+00017580: 7461 7372 632e 6466 2e63 6f6c 756d 6e73  tasrc.df.columns
+00017590: 2920 3c3d 2034 3a0d 0a20 2020 2020 2020  ) <= 4:..       
+000175a0: 2064 6174 6173 7263 2e64 662e 696e 7365   datasrc.df.inse
+000175b0: 7274 2833 2c20 275f 7a65 726f 5f27 2c20  rt(3, '_zero_', 
+000175c0: 5b30 5d2a 6c65 6e28 6461 7461 7372 632e  [0]*len(datasrc.
+000175d0: 6466 2929 2023 2062 6173 6520 6f66 2063  df)) # base of c
+000175e0: 616e 646c 6573 2069 7320 616c 7761 7973  andles is always
+000175f0: 207a 6572 6f0d 0a20 2020 2064 6174 6173   zero..    datas
+00017600: 7263 2e73 6574 5f64 6628 6461 7461 7372  rc.set_df(datasr
+00017610: 632e 6466 2e69 6c6f 635b 3a2c 5b30 2c33  c.df.iloc[:,[0,3
+00017620: 2c34 2c31 2c32 5d5d 2920 2320 7265 2d61  ,4,1,2]]) # re-a
+00017630: 7272 616e 6765 2063 6f6c 756d 6e73 2066  rrange columns f
+00017640: 6f72 2072 656e 6465 7269 6e67 0d0a 2020  or rendering..  
+00017650: 2020 6461 7461 7372 632e 7363 616c 655f    datasrc.scale_
+00017660: 636f 6c73 203d 205b 312c 2032 5d20 2320  cols = [1, 2] # 
+00017670: 7363 616c 6520 6279 2062 6f74 6820 6261  scale by both ba
+00017680: 7365 6c69 6e65 2061 6e64 2076 6f6c 756d  seline and volum
+00017690: 650d 0a0d 0a0d 0a64 6566 205f 7072 6561  e......def _prea
+000176a0: 646a 7573 745f 686f 7269 7a5f 6461 7461  djust_horiz_data
+000176b0: 7372 6328 6461 7461 7372 6329 3a0d 0a20  src(datasrc):.. 
+000176c0: 2020 2061 7272 6179 6966 7920 3d20 6c61     arrayify = la
+000176d0: 6d62 6461 2064 3a20 642e 7661 6c75 6573  mbda d: d.values
+000176e0: 2069 6620 7479 7065 2864 2920 3d3d 2070   if type(d) == p
+000176f0: 642e 4461 7461 4672 616d 6520 656c 7365  d.DataFrame else
+00017700: 2064 0d0a 2020 2020 2320 6372 6561 7465   d..    # create
+00017710: 2061 2064 6174 6166 7261 6d65 2066 726f   a dataframe fro
+00017720: 6d20 7468 6520 696e 7075 7420 6172 7261  m the input arra
+00017730: 790d 0a20 2020 2074 696d 6573 203d 205b  y..    times = [
+00017740: 7420 666f 7220 742c 726f 7720 696e 2064  t for t,row in d
+00017750: 6174 6173 7263 5d0d 0a20 2020 2069 6620  atasrc]..    if 
+00017760: 6c65 6e28 7469 6d65 7329 203d 3d20 313a  len(times) == 1:
+00017770: 2023 2061 6464 2061 6e20 656d 7074 7920   # add an empty 
+00017780: 7469 6d65 2073 6c6f 740d 0a20 2020 2020  time slot..     
+00017790: 2020 2074 696d 6573 203d 205b 7469 6d65     times = [time
+000177a0: 735b 305d 2c20 7469 6d65 735b 305d 2b31  s[0], times[0]+1
+000177b0: 5d0d 0a20 2020 2020 2020 2064 6174 6173  ]..        datas
+000177c0: 7263 203d 2064 6174 6173 7263 202b 205b  rc = datasrc + [
+000177d0: 5b74 696d 6573 5b31 5d2c 205b 2870 2c30  [times[1], [(p,0
+000177e0: 2920 666f 7220 702c 7620 696e 2061 7272  ) for p,v in arr
+000177f0: 6179 6966 7928 6461 7461 7372 635b 305d  ayify(datasrc[0]
+00017800: 5b31 5d29 5d5d 5d0d 0a20 2020 2064 6174  [1])]]]..    dat
+00017810: 6120 3d20 5b5b 6520 666f 7220 7620 696e  a = [[e for v in
+00017820: 2061 7272 6179 6966 7928 726f 7729 2066   arrayify(row) f
+00017830: 6f72 2065 2069 6e20 765d 2066 6f72 2074  or e in v] for t
+00017840: 2c72 6f77 2069 6e20 6461 7461 7372 635d  ,row in datasrc]
+00017850: 0d0a 2020 2020 6d61 7863 6f6c 7320 3d20  ..    maxcols = 
+00017860: 6d61 7828 6c65 6e28 726f 7729 2066 6f72  max(len(row) for
+00017870: 2072 6f77 2069 6e20 6461 7461 290d 0a20   row in data).. 
+00017880: 2020 2072 6574 7572 6e20 7064 2e44 6174     return pd.Dat
+00017890: 6146 7261 6d65 2863 6f6c 756d 6e73 3d72  aFrame(columns=r
+000178a0: 616e 6765 286d 6178 636f 6c73 292c 2064  ange(maxcols), d
+000178b0: 6174 613d 6461 7461 2c20 696e 6465 783d  ata=data, index=
+000178c0: 7469 6d65 7329 0d0a 0d0a 0d0a 6465 6620  times)......def 
+000178d0: 5f61 646a 7573 745f 686f 7269 7a5f 6461  _adjust_horiz_da
+000178e0: 7461 7372 6328 6461 7461 7372 6329 3a0d  tasrc(datasrc):.
+000178f0: 0a20 2020 2023 2074 6f20 6265 2061 626c  .    # to be abl
+00017900: 6520 746f 2073 6361 6c65 2070 726f 7065  e to scale prope
+00017910: 726c 792c 206d 6f76 6520 7468 6520 6c61  rly, move the la
+00017920: 7374 2074 776f 2076 616c 7565 7320 746f  st two values to
+00017930: 2074 6865 206c 6173 7420 7477 6f20 636f   the last two co
+00017940: 6c75 6d6e 730d 0a20 2020 2076 616c 7565  lumns..    value
+00017950: 7320 3d20 6461 7461 7372 632e 6466 2e69  s = datasrc.df.i
+00017960: 6c6f 635b 3a2c 2031 3a5d 2e76 616c 7565  loc[:, 1:].value
+00017970: 730d 0a20 2020 2066 6f72 2069 2c6e 726f  s..    for i,nro
+00017980: 7720 696e 2065 6e75 6d65 7261 7465 2876  w in enumerate(v
+00017990: 616c 7565 7329 3a0d 0a20 2020 2020 2020  alues):..       
+000179a0: 206f 726f 7720 3d20 6e72 6f77 5b7e 6e70   orow = nrow[~np
+000179b0: 2e69 736e 616e 286e 726f 7729 5d0d 0a20  .isnan(nrow)].. 
+000179c0: 2020 2020 2020 2069 6620 6c65 6e28 6e72         if len(nr
+000179d0: 6f77 2920 3d3d 206c 656e 286f 726f 7729  ow) == len(orow)
+000179e0: 206f 7220 6c65 6e28 6f72 6f77 2920 3c3d   or len(orow) <=
+000179f0: 2032 3a0d 0a20 2020 2020 2020 2020 2020   2:..           
+00017a00: 2063 6f6e 7469 6e75 650d 0a20 2020 2020   continue..     
+00017a10: 2020 206e 726f 775b 2d32 3a5d 203d 206f     nrow[-2:] = o
+00017a20: 726f 775b 2d32 3a5d 0d0a 2020 2020 2020  row[-2:]..      
+00017a30: 2020 6e72 6f77 5b6c 656e 286f 726f 7729    nrow[len(orow)
+00017a40: 2d32 3a6c 656e 286f 726f 7729 5d20 3d20  -2:len(orow)] = 
+00017a50: 6e70 2e6e 616e 0d0a 2020 2020 6461 7461  np.nan..    data
+00017a60: 7372 632e 6466 5b64 6174 6173 7263 2e64  src.df[datasrc.d
+00017a70: 662e 636f 6c75 6d6e 735b 313a 5d5d 203d  f.columns[1:]] =
+00017a80: 2076 616c 7565 730d 0a0d 0a0d 0a64 6566   values......def
+00017a90: 205f 6164 6a75 7374 5f62 6172 5f64 6174   _adjust_bar_dat
+00017aa0: 6173 7263 2864 6174 6173 7263 2c20 6f72  asrc(datasrc, or
+00017ab0: 6465 725f 636f 6c73 3d54 7275 6529 3a0d  der_cols=True):.
+00017ac0: 0a20 2020 2069 6620 6c65 6e28 6461 7461  .    if len(data
+00017ad0: 7372 632e 6466 2e63 6f6c 756d 6e73 2920  src.df.columns) 
+00017ae0: 3c3d 2032 3a0d 0a20 2020 2020 2020 2064  <= 2:..        d
+00017af0: 6174 6173 7263 2e64 662e 696e 7365 7274  atasrc.df.insert
+00017b00: 2831 2c20 275f 6261 7365 5f27 2c20 5b30  (1, '_base_', [0
+00017b10: 5d2a 6c65 6e28 6461 7461 7372 632e 6466  ]*len(datasrc.df
+00017b20: 2929 2023 2062 6173 650d 0a20 2020 2069  )) # base..    i
+00017b30: 6620 6c65 6e28 6461 7461 7372 632e 6466  f len(datasrc.df
+00017b40: 2e63 6f6c 756d 6e73 2920 3c3d 2034 3a0d  .columns) <= 4:.
+00017b50: 0a20 2020 2020 2020 2064 6174 6173 7263  .        datasrc
+00017b60: 2e64 662e 696e 7365 7274 2831 2c20 275f  .df.insert(1, '_
+00017b70: 6f70 656e 5f27 2c20 205b 305d 2a6c 656e  open_',  [0]*len
+00017b80: 2864 6174 6173 7263 2e64 6629 2920 2320  (datasrc.df)) # 
+00017b90: 226f 7065 6e22 2066 6f72 2063 6f6c 6f72  "open" for color
+00017ba0: 0d0a 2020 2020 2020 2020 6461 7461 7372  ..        datasr
+00017bb0: 632e 6466 2e69 6e73 6572 7428 322c 2027  c.df.insert(2, '
+00017bc0: 5f63 6c6f 7365 5f27 2c20 6461 7461 7372  _close_', datasr
+00017bd0: 632e 6466 2e69 6c6f 635b 3a2c 2033 5d29  c.df.iloc[:, 3])
+00017be0: 2023 2022 636c 6f73 6522 2028 6163 7475   # "close" (actu
+00017bf0: 616c 2062 6172 2076 616c 7565 2920 666f  al bar value) fo
+00017c00: 7220 636f 6c6f 720d 0a20 2020 2069 6620  r color..    if 
+00017c10: 6f72 6465 725f 636f 6c73 3a0d 0a20 2020  order_cols:..   
+00017c20: 2020 2020 2064 6174 6173 7263 2e73 6574       datasrc.set
+00017c30: 5f64 6628 6461 7461 7372 632e 6466 2e69  _df(datasrc.df.i
+00017c40: 6c6f 635b 3a2c 5b30 2c33 2c34 2c31 2c32  loc[:,[0,3,4,1,2
+00017c50: 5d5d 2920 2320 7265 2d61 7272 616e 6765  ]]) # re-arrange
+00017c60: 2063 6f6c 756d 6e73 2066 6f72 2072 656e   columns for ren
+00017c70: 6465 7269 6e67 0d0a 2020 2020 6461 7461  dering..    data
+00017c80: 7372 632e 7363 616c 655f 636f 6c73 203d  src.scale_cols =
+00017c90: 205b 312c 2032 5d20 2320 7363 616c 6520   [1, 2] # scale 
+00017ca0: 6279 2062 6f74 6820 6261 7365 6c69 6e65  by both baseline
+00017cb0: 2061 6e64 2076 6f6c 756d 650d 0a0d 0a0d   and volume.....
+00017cc0: 0a64 6566 205f 7570 6461 7465 5f64 6174  .def _update_dat
+00017cd0: 6128 7072 6561 646a 7573 7466 756e 632c  a(preadjustfunc,
+00017ce0: 2061 646a 7573 7466 756e 632c 2069 7465   adjustfunc, ite
+00017cf0: 6d2c 2064 732c 2067 6678 3d54 7275 6529  m, ds, gfx=True)
+00017d00: 3a0d 0a20 2020 2069 6620 7072 6561 646a  :..    if preadj
+00017d10: 7573 7466 756e 633a 0d0a 2020 2020 2020  ustfunc:..      
+00017d20: 2020 6473 203d 2070 7265 6164 6a75 7374    ds = preadjust
+00017d30: 6675 6e63 2864 7329 0d0a 2020 2020 6473  func(ds)..    ds
+00017d40: 203d 205f 6372 6561 7465 5f64 6174 6173   = _create_datas
+00017d50: 7263 2869 7465 6d2e 6178 2c20 6473 290d  rc(item.ax, ds).
+00017d60: 0a20 2020 2069 6620 6164 6a75 7374 6675  .    if adjustfu
+00017d70: 6e63 3a0d 0a20 2020 2020 2020 2061 646a  nc:..        adj
+00017d80: 7573 7466 756e 6328 6473 290d 0a20 2020  ustfunc(ds)..   
+00017d90: 2063 7320 3d20 6c69 7374 2869 7465 6d2e   cs = list(item.
+00017da0: 6461 7461 7372 632e 6466 2e63 6f6c 756d  datasrc.df.colum
+00017db0: 6e73 5b3a 315d 2920 2b20 6c69 7374 2869  ns[:1]) + list(i
+00017dc0: 7465 6d2e 6461 7461 7372 632e 6466 2e63  tem.datasrc.df.c
+00017dd0: 6f6c 756d 6e73 5b69 7465 6d2e 6461 7461  olumns[item.data
+00017de0: 7372 632e 636f 6c5f 6461 7461 5f6f 6666  src.col_data_off
+00017df0: 7365 743a 5d29 0d0a 2020 2020 6966 206c  set:])..    if l
+00017e00: 656e 2863 7329 203e 3d20 6c65 6e28 6473  en(cs) >= len(ds
+00017e10: 2e64 662e 636f 6c75 6d6e 7329 3a0d 0a20  .df.columns):.. 
+00017e20: 2020 2020 2020 2064 732e 6466 2e63 6f6c         ds.df.col
+00017e30: 756d 6e73 203d 2063 735b 3a6c 656e 2864  umns = cs[:len(d
+00017e40: 732e 6466 2e63 6f6c 756d 6e73 295d 0d0a  s.df.columns)]..
+00017e50: 2020 2020 6974 656d 2e64 6174 6173 7263      item.datasrc
+00017e60: 2e75 7064 6174 6528 6473 290d 0a20 2020  .update(ds)..   
+00017e70: 205f 7365 745f 6461 7461 7372 6328 6974   _set_datasrc(it
+00017e80: 656d 2e61 782c 2069 7465 6d2e 6461 7461  em.ax, item.data
+00017e90: 7372 632c 2061 6464 636f 6c73 3d46 616c  src, addcols=Fal
+00017ea0: 7365 290d 0a20 2020 2069 6620 6766 783a  se)..    if gfx:
+00017eb0: 0d0a 2020 2020 2020 2020 6974 656d 2e75  ..        item.u
+00017ec0: 7064 6174 655f 6766 7828 290d 0a0d 0a0d  pdate_gfx().....
+00017ed0: 0a64 6566 205f 7570 6461 7465 5f67 6678  .def _update_gfx
+00017ee0: 2869 7465 6d29 3a0d 0a20 2020 205f 7374  (item):..    _st
+00017ef0: 6172 745f 7669 7375 616c 5f75 7064 6174  art_visual_updat
+00017f00: 6528 6974 656d 290d 0a20 2020 2066 6f72  e(item)..    for
+00017f10: 2069 2069 6e20 6974 656d 2e61 782e 6974   i in item.ax.it
+00017f20: 656d 733a 0d0a 2020 2020 2020 2020 6966  ems:..        if
+00017f30: 2069 203d 3d20 6974 656d 206f 7220 6e6f   i == item or no
+00017f40: 7420 6861 7361 7474 7228 692c 2027 6461  t hasattr(i, 'da
+00017f50: 7461 7372 6327 293a 0d0a 2020 2020 2020  tasrc'):..      
+00017f60: 2020 2020 2020 636f 6e74 696e 7565 0d0a        continue..
+00017f70: 2020 2020 2020 2020 6c63 203d 206c 656e          lc = len
+00017f80: 2869 7465 6d2e 6461 7461 7372 632e 6466  (item.datasrc.df
+00017f90: 290d 0a20 2020 2020 2020 206c 6920 3d20  )..        li = 
+00017fa0: 6c65 6e28 692e 6461 7461 7372 632e 6466  len(i.datasrc.df
+00017fb0: 290d 0a20 2020 2020 2020 2069 6620 6c63  )..        if lc
+00017fc0: 2061 6e64 206c 6920 616e 6420 6d61 7828   and li and max(
+00017fd0: 6c63 2c6c 6929 2f6d 696e 286c 632c 6c69  lc,li)/min(lc,li
+00017fe0: 2920 3e20 3130 303a 2023 2054 4f44 4f3a  ) > 100: # TODO:
+00017ff0: 2073 686f 756c 6420 6265 2074 7970 6564   should be typed
+00018000: 2069 6e73 7465 6164 0d0a 2020 2020 2020   instead..      
+00018010: 2020 2020 2020 636f 6e74 696e 7565 0d0a        continue..
+00018020: 2020 2020 2020 2020 6363 203d 2069 7465          cc = ite
+00018030: 6d2e 6461 7461 7372 632e 6466 2e63 6f6c  m.datasrc.df.col
+00018040: 756d 6e73 0d0a 2020 2020 2020 2020 6369  umns..        ci
+00018050: 203d 2069 2e64 6174 6173 7263 2e64 662e   = i.datasrc.df.
+00018060: 636f 6c75 6d6e 730d 0a20 2020 2020 2020  columns..       
+00018070: 2063 3020 3d20 5b63 2066 6f72 2063 2069   c0 = [c for c i
+00018080: 6e20 6369 2069 6620 6320 696e 2063 635d  n ci if c in cc]
+00018090: 0d0a 2020 2020 2020 2020 6331 203d 205b  ..        c1 = [
+000180a0: 6320 666f 7220 6320 696e 2063 6920 6966  c for c in ci if
+000180b0: 206e 6f74 2063 2069 6e20 6363 5d0d 0a20   not c in cc].. 
+000180c0: 2020 2020 2020 2064 665f 636c 6970 7065         df_clippe
+000180d0: 6420 3d20 6974 656d 2e64 6174 6173 7263  d = item.datasrc
+000180e0: 2e64 665b 6330 5d0d 0a20 2020 2020 2020  .df[c0]..       
+000180f0: 2069 6620 6331 3a0d 0a20 2020 2020 2020   if c1:..       
+00018100: 2020 2020 2064 665f 636c 6970 7065 6420       df_clipped 
+00018110: 3d20 6466 5f63 6c69 7070 6564 2e63 6f70  = df_clipped.cop
+00018120: 7928 290d 0a20 2020 2020 2020 2020 2020  y()..           
+00018130: 2066 6f72 2063 2069 6e20 6331 3a0d 0a20   for c in c1:.. 
+00018140: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+00018150: 665f 636c 6970 7065 645b 635d 203d 2069  f_clipped[c] = i
+00018160: 2e64 6174 6173 7263 2e64 665b 635d 0d0a  .datasrc.df[c]..
+00018170: 2020 2020 2020 2020 692e 6461 7461 7372          i.datasr
+00018180: 632e 7365 745f 6466 2864 665f 636c 6970  c.set_df(df_clip
+00018190: 7065 6429 0d0a 2020 2020 2020 2020 6272  ped)..        br
+000181a0: 6561 6b0d 0a20 2020 2075 7064 6174 655f  eak..    update_
+000181b0: 7369 6764 6967 203d 2046 616c 7365 0d0a  sigdig = False..
+000181c0: 2020 2020 6966 206e 6f74 2069 7465 6d2e      if not item.
+000181d0: 6461 7461 7372 632e 7374 616e 6461 6c6f  datasrc.standalo
+000181e0: 6e65 2061 6e64 206e 6f74 2069 7465 6d2e  ne and not item.
+000181f0: 6178 2e76 622e 7769 6e2e 5f69 734d 6f75  ax.vb.win._isMou
+00018200: 7365 4c65 6674 4472 6167 3a0d 0a20 2020  seLeftDrag:..   
+00018210: 2020 2020 2023 206e 6577 206c 696d 6974       # new limit
+00018220: 7320 7768 656e 2065 7874 656e 6469 6e67  s when extending
+00018230: 2f72 6564 7563 696e 6720 616d 6f75 6e74  /reducing amount
+00018240: 206f 6620 6461 7461 0d0a 2020 2020 2020   of data..      
+00018250: 2020 785f 6d69 6e2c 7831 203d 205f 7365    x_min,x1 = _se
+00018260: 745f 785f 6c69 6d69 7473 2869 7465 6d2e  t_x_limits(item.
+00018270: 6178 2c20 6974 656d 2e64 6174 6173 7263  ax, item.datasrc
+00018280: 290d 0a20 2020 2020 2020 2023 2073 6372  )..        # scr
+00018290: 6f6c 6c20 616c 6c20 706c 6f74 7320 6966  oll all plots if
+000182a0: 2077 6527 7265 2061 7420 7468 6520 6661   we're at the fa
+000182b0: 7220 7269 6768 740d 0a20 2020 2020 2020  r right..       
+000182c0: 2074 7220 3d20 6974 656d 2e61 782e 7662   tr = item.ax.vb
+000182d0: 2e74 6172 6765 7452 6563 7428 290d 0a20  .targetRect().. 
+000182e0: 2020 2020 2020 2078 3020 3d20 7831 202d         x0 = x1 -
+000182f0: 2074 722e 7769 6474 6828 290d 0a20 2020   tr.width()..   
+00018300: 2020 2020 2069 6620 7830 203c 2072 6967       if x0 < rig
+00018310: 6874 5f6d 6172 6769 6e5f 6361 6e64 6c65  ht_margin_candle
+00018320: 7320 2b20 7369 6465 5f6d 6172 6769 6e3a  s + side_margin:
+00018330: 0d0a 2020 2020 2020 2020 2020 2020 7830  ..            x0
+00018340: 203d 202d 7369 6465 5f6d 6172 6769 6e0d   = -side_margin.
+00018350: 0a20 2020 2020 2020 2069 6620 7472 2e72  .        if tr.r
+00018360: 6967 6874 2829 203c 2078 3120 2d20 3520  ight() < x1 - 5 
+00018370: 2d20 322a 7269 6768 745f 6d61 7267 696e  - 2*right_margin
+00018380: 5f63 616e 646c 6573 3a0d 0a20 2020 2020  _candles:..     
+00018390: 2020 2020 2020 2078 3020 3d20 7831 203d         x0 = x1 =
+000183a0: 204e 6f6e 650d 0a20 2020 2020 2020 2070   None..        p
+000183b0: 7265 765f 746f 7020 3d20 6974 656d 2e61  rev_top = item.a
+000183c0: 782e 7662 2e74 6172 6765 7452 6563 7428  x.vb.targetRect(
+000183d0: 292e 746f 7028 290d 0a20 2020 2020 2020  ).top()..       
+000183e0: 2069 7465 6d2e 6178 2e76 622e 7570 6461   item.ax.vb.upda
+000183f0: 7465 5f79 5f7a 6f6f 6d28 7830 2c20 7831  te_y_zoom(x0, x1
+00018400: 290d 0a20 2020 2020 2020 2074 6869 735f  )..        this_
+00018410: 746f 7020 3d20 6974 656d 2e61 782e 7662  top = item.ax.vb
+00018420: 2e74 6172 6765 7452 6563 7428 292e 746f  .targetRect().to
+00018430: 7028 290d 0a20 2020 2020 2020 2069 6620  p()..        if 
+00018440: 7468 6973 5f74 6f70 2061 6e64 206e 6f74  this_top and not
+00018450: 2028 302e 3939 203c 2061 6273 2870 7265   (0.99 < abs(pre
+00018460: 765f 746f 702f 7468 6973 5f74 6f70 2920  v_top/this_top) 
+00018470: 3c20 312e 3031 293a 0d0a 2020 2020 2020  < 1.01):..      
+00018480: 2020 2020 2020 7570 6461 7465 5f73 6967        update_sig
+00018490: 6469 6720 3d20 5472 7565 0d0a 2020 2020  dig = True..    
+000184a0: 2020 2020 6966 2069 7465 6d2e 6178 2e61      if item.ax.a
+000184b0: 7865 735b 2762 6f74 746f 6d27 5d5b 2769  xes['bottom']['i
+000184c0: 7465 6d27 5d2e 6973 5669 7369 626c 6528  tem'].isVisible(
+000184d0: 293a 2023 2075 7064 6174 6520 6178 6573  ): # update axes
+000184e0: 2069 6620 7669 7369 626c 650d 0a20 2020   if visible..   
+000184f0: 2020 2020 2020 2020 2069 7465 6d2e 6178           item.ax
+00018500: 2e61 7865 735b 2762 6f74 746f 6d27 5d5b  .axes['bottom'][
+00018510: 2769 7465 6d27 5d2e 6869 6465 2829 0d0a  'item'].hide()..
+00018520: 2020 2020 2020 2020 2020 2020 6974 656d              item
+00018530: 2e61 782e 6178 6573 5b27 626f 7474 6f6d  .ax.axes['bottom
+00018540: 275d 5b27 6974 656d 275d 2e73 686f 7728  ']['item'].show(
+00018550: 290d 0a20 2020 205f 656e 645f 7669 7375  )..    _end_visu
+00018560: 616c 5f75 7064 6174 6528 6974 656d 290d  al_update(item).
+00018570: 0a20 2020 2069 6620 7570 6461 7465 5f73  .    if update_s
+00018580: 6967 6469 673a 0d0a 2020 2020 2020 2020  igdig:..        
+00018590: 5f75 7064 6174 655f 7369 676e 6966 6963  _update_signific
+000185a0: 616e 7473 2869 7465 6d2e 6178 2c20 6974  ants(item.ax, it
+000185b0: 656d 2e61 782e 7662 2e64 6174 6173 7263  em.ax.vb.datasrc
+000185c0: 2c20 666f 7263 653d 5472 7565 290d 0a0d  , force=True)...
+000185d0: 0a0d 0a64 6566 205f 7374 6172 745f 7669  ...def _start_vi
+000185e0: 7375 616c 5f75 7064 6174 6528 6974 656d  sual_update(item
+000185f0: 293a 0d0a 2020 2020 6966 2069 7369 6e73  ):..    if isins
+00018600: 7461 6e63 6528 6974 656d 2c20 4669 6e50  tance(item, FinP
+00018610: 6c6f 7449 7465 6d29 3a0d 0a20 2020 2020  lotItem):..     
+00018620: 2020 2069 7465 6d2e 6178 2e72 656d 6f76     item.ax.remov
+00018630: 6549 7465 6d28 6974 656d 290d 0a20 2020  eItem(item)..   
+00018640: 2020 2020 2069 7465 6d2e 6469 7274 7920       item.dirty 
+00018650: 3d20 5472 7565 0d0a 2020 2020 656c 7365  = True..    else
+00018660: 3a0d 0a20 2020 2020 2020 2079 203d 2069  :..        y = i
+00018670: 7465 6d2e 6461 7461 7372 632e 7920 2f20  tem.datasrc.y / 
+00018680: 6974 656d 2e61 782e 7662 2e79 7363 616c  item.ax.vb.yscal
+00018690: 652e 7363 616c 6566 0d0a 2020 2020 2020  e.scalef..      
+000186a0: 2020 6966 2069 7465 6d2e 6178 2e76 622e    if item.ax.vb.
+000186b0: 7973 6361 6c65 2e73 6361 6c65 7479 7065  yscale.scaletype
+000186c0: 203d 3d20 276c 6f67 273a 0d0a 2020 2020   == 'log':..    
+000186d0: 2020 2020 2020 2020 7920 3d20 7920 2b20          y = y + 
+000186e0: 6c6f 675f 706c 6f74 5f6f 6666 7365 740d  log_plot_offset.
+000186f0: 0a20 2020 2020 2020 2069 7465 6d2e 7365  .        item.se
+00018700: 7444 6174 6128 6974 656d 2e64 6174 6173  tData(item.datas
+00018710: 7263 2e69 6e64 6578 2c20 7929 0d0a 0d0a  rc.index, y)....
+00018720: 0d0a 6465 6620 5f65 6e64 5f76 6973 7561  ..def _end_visua
+00018730: 6c5f 7570 6461 7465 2869 7465 6d29 3a0d  l_update(item):.
+00018740: 0a20 2020 2069 6620 6973 696e 7374 616e  .    if isinstan
+00018750: 6365 2869 7465 6d2c 2046 696e 506c 6f74  ce(item, FinPlot
+00018760: 4974 656d 293a 0d0a 2020 2020 2020 2020  Item):..        
+00018770: 6974 656d 2e61 782e 6164 6449 7465 6d28  item.ax.addItem(
+00018780: 6974 656d 290d 0a20 2020 2020 2020 2069  item)..        i
+00018790: 7465 6d2e 7265 7061 696e 7428 290d 0a0d  tem.repaint()...
+000187a0: 0a0d 0a64 6566 205f 7365 745f 785f 6c69  ...def _set_x_li
+000187b0: 6d69 7473 2861 782c 2064 6174 6173 7263  mits(ax, datasrc
+000187c0: 293a 0d0a 2020 2020 7830 2c78 3120 3d20  ):..    x0,x1 = 
+000187d0: 5f78 6d69 6e6d 6178 2864 6174 6173 7263  _xminmax(datasrc
+000187e0: 2c20 785f 696e 6465 7865 643d 6178 2e76  , x_indexed=ax.v
+000187f0: 622e 785f 696e 6465 7865 6429 0d0a 2020  b.x_indexed)..  
+00018800: 2020 6178 2e73 6574 4c69 6d69 7473 2878    ax.setLimits(x
+00018810: 4d69 6e3d 7830 2c20 784d 6178 3d78 3129  Min=x0, xMax=x1)
+00018820: 0d0a 2020 2020 7265 7475 726e 2078 302c  ..    return x0,
+00018830: 7831 0d0a 0d0a 0d0a 6465 6620 5f78 6d69  x1......def _xmi
+00018840: 6e6d 6178 2864 6174 6173 7263 2c20 785f  nmax(datasrc, x_
+00018850: 696e 6465 7865 642c 2069 6e69 745f 7374  indexed, init_st
+00018860: 6570 733d 4e6f 6e65 2c20 6578 7472 615f  eps=None, extra_
+00018870: 6d61 7267 696e 3d30 293a 0d0a 2020 2020  margin=0):..    
+00018880: 6966 2078 5f69 6e64 6578 6564 2061 6e64  if x_indexed and
+00018890: 2069 6e69 745f 7374 6570 733a 0d0a 2020   init_steps:..  
+000188a0: 2020 2020 2020 2320 696e 6974 6961 6c20        # initial 
+000188b0: 7a6f 6f6d 0d0a 2020 2020 2020 2020 7830  zoom..        x0
+000188c0: 203d 206d 6178 2864 6174 6173 7263 2e78   = max(datasrc.x
+000188d0: 6c65 6e2d 696e 6974 5f73 7465 7073 2c20  len-init_steps, 
+000188e0: 3029 202d 2073 6964 655f 6d61 7267 696e  0) - side_margin
+000188f0: 202d 2065 7874 7261 5f6d 6172 6769 6e0d   - extra_margin.
+00018900: 0a20 2020 2020 2020 2078 3120 3d20 6461  .        x1 = da
+00018910: 7461 7372 632e 786c 656e 202b 2072 6967  tasrc.xlen + rig
+00018920: 6874 5f6d 6172 6769 6e5f 6361 6e64 6c65  ht_margin_candle
+00018930: 7320 2b20 7369 6465 5f6d 6172 6769 6e20  s + side_margin 
+00018940: 2b20 6578 7472 615f 6d61 7267 696e 0d0a  + extra_margin..
+00018950: 2020 2020 656c 6966 2078 5f69 6e64 6578      elif x_index
+00018960: 6564 3a0d 0a20 2020 2020 2020 2023 2074  ed:..        # t
+00018970: 6f74 616c 2078 2073 697a 6520 666f 7220  otal x size for 
+00018980: 696e 6465 7865 6420 6461 7461 0d0a 2020  indexed data..  
+00018990: 2020 2020 2020 7830 203d 202d 7369 6465        x0 = -side
+000189a0: 5f6d 6172 6769 6e20 2d20 6578 7472 615f  _margin - extra_
+000189b0: 6d61 7267 696e 0d0a 2020 2020 2020 2020  margin..        
+000189c0: 7831 203d 2064 6174 6173 7263 2e78 6c65  x1 = datasrc.xle
+000189d0: 6e20 2b20 7269 6768 745f 6d61 7267 696e  n + right_margin
+000189e0: 5f63 616e 646c 6573 202d 2031 202b 2073  _candles - 1 + s
+000189f0: 6964 655f 6d61 7267 696e 202b 2065 7874  ide_margin + ext
+00018a00: 7261 5f6d 6172 6769 6e20 2320 6164 6420  ra_margin # add 
+00018a10: 616e 6f74 6865 7220 6d61 7267 696e 2074  another margin t
+00018a20: 6f20 6765 7420 7468 6520 2273 6e61 7020  o get the "snap 
+00018a30: 6261 636b 2220 7365 6e73 6174 696f 6e0d  back" sensation.
+00018a40: 0a20 2020 2065 6c73 653a 0d0a 2020 2020  .    else:..    
+00018a50: 2020 2020 2320 7820 7369 7a65 2066 6f72      # x size for
+00018a60: 2070 6c61 696e 2059 2d6f 7665 722d 5820   plain Y-over-X 
+00018a70: 6461 7461 2028 692e 652e 206e 6f74 2069  data (i.e. not i
+00018a80: 6e64 6578 6564 290d 0a20 2020 2020 2020  ndexed)..       
+00018a90: 2078 3020 3d20 6461 7461 7372 632e 782e   x0 = datasrc.x.
+00018aa0: 6d69 6e28 290d 0a20 2020 2020 2020 2078  min()..        x
+00018ab0: 3120 3d20 6461 7461 7372 632e 782e 6d61  1 = datasrc.x.ma
+00018ac0: 7828 290d 0a20 2020 2020 2020 2023 2065  x()..        # e
+00018ad0: 7874 656e 6420 6d61 7267 696e 206f 6e20  xtend margin on 
+00018ae0: 6465 636f 7570 6c65 6420 706c 6f74 730d  decoupled plots.
+00018af0: 0a20 2020 2020 2020 2064 203d 2028 7831  .        d = (x1
+00018b00: 2d78 3029 202a 2028 302e 322b 6578 7472  -x0) * (0.2+extr
+00018b10: 615f 6d61 7267 696e 290d 0a20 2020 2020  a_margin)..     
+00018b20: 2020 2078 3020 2d3d 2064 0d0a 2020 2020     x0 -= d..    
+00018b30: 2020 2020 7831 202b 3d20 640d 0a20 2020      x1 += d..   
+00018b40: 2072 6574 7572 6e20 7830 2c78 310d 0a0d   return x0,x1...
+00018b50: 0a0d 0a64 6566 205f 7265 7061 696e 745f  ...def _repaint_
+00018b60: 6361 6e64 6c65 7328 293a 0d0a 2020 2020  candles():..    
+00018b70: 2727 2743 616e 646c 6573 2061 7265 206f  '''Candles are o
+00018b80: 6e6c 7920 7061 7274 6961 6c6c 7920 6472  nly partially dr
+00018b90: 6177 6e2c 2061 6e64 2074 6865 7265 666f  awn, and therefo
+00018ba0: 7265 206e 6565 6473 206d 616e 7561 6c20  re needs manual 
+00018bb0: 6469 7274 7920 7265 6d69 6e64 6572 2077  dirty reminder w
+00018bc0: 6865 6e65 7665 7220 6974 2067 6f65 7320  henever it goes 
+00018bd0: 6f66 662d 7363 7265 656e 2e27 2727 0d0a  off-screen.'''..
+00018be0: 2020 2020 6178 7320 3d20 5b61 7820 666f      axs = [ax fo
+00018bf0: 7220 7769 6e20 696e 2077 696e 646f 7773  r win in windows
+00018c00: 2066 6f72 2061 7820 696e 2077 696e 2e61   for ax in win.a
+00018c10: 7873 5d20 2b20 6f76 6572 6c61 795f 6178  xs] + overlay_ax
+00018c20: 730d 0a20 2020 2066 6f72 2061 7820 696e  s..    for ax in
+00018c30: 2061 7873 3a0d 0a20 2020 2020 2020 2066   axs:..        f
+00018c40: 6f72 2069 7465 6d20 696e 206c 6973 7428  or item in list(
+00018c50: 6178 2e69 7465 6d73 293a 0d0a 2020 2020  ax.items):..    
+00018c60: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
+00018c70: 7461 6e63 6528 6974 656d 2c20 4669 6e50  tance(item, FinP
+00018c80: 6c6f 7449 7465 6d29 3a0d 0a20 2020 2020  lotItem):..     
+00018c90: 2020 2020 2020 2020 2020 205f 7374 6172             _star
+00018ca0: 745f 7669 7375 616c 5f75 7064 6174 6528  t_visual_update(
+00018cb0: 6974 656d 290d 0a20 2020 2020 2020 2020  item)..         
+00018cc0: 2020 2020 2020 205f 656e 645f 7669 7375         _end_visu
+00018cd0: 616c 5f75 7064 6174 6528 6974 656d 290d  al_update(item).
+00018ce0: 0a0d 0a0d 0a64 6566 205f 7061 696e 745f  .....def _paint_
+00018cf0: 7363 6174 7465 7228 6974 656d 2c20 702c  scatter(item, p,
+00018d00: 202a 6172 6773 293a 0d0a 2020 2020 7769   *args):..    wi
+00018d10: 7468 206e 702e 6572 7273 7461 7465 2869  th np.errstate(i
+00018d20: 6e76 616c 6964 3d27 6967 6e6f 7265 2729  nvalid='ignore')
+00018d30: 3a20 2320 6d61 6b65 2070 6727 7320 6d61  : # make pg's ma
+00018d40: 736b 2063 7265 6174 696f 6e20 6361 6c6c  sk creation call
+00018d50: 7320 746f 206e 756d 7079 2073 6875 7420  s to numpy shut 
+00018d60: 7570 0d0a 2020 2020 2020 2020 6974 656d  up..        item
+00018d70: 2e5f 646f 7061 696e 7428 702c 202a 6172  ._dopaint(p, *ar
+00018d80: 6773 290d 0a0d 0a0d 0a64 6566 205f 6b65  gs)......def _ke
+00018d90: 795f 7072 6573 7365 6428 7662 2c20 6576  y_pressed(vb, ev
+00018da0: 293a 0d0a 2020 2020 6966 2065 762e 7465  ):..    if ev.te
+00018db0: 7874 2829 203d 3d20 2767 273a 2023 2067  xt() == 'g': # g
+00018dc0: 7269 640d 0a20 2020 2020 2020 2067 6c6f  rid..        glo
+00018dd0: 6261 6c20 636c 616d 705f 6772 6964 0d0a  bal clamp_grid..
+00018de0: 2020 2020 2020 2020 636c 616d 705f 6772          clamp_gr
+00018df0: 6964 203d 206e 6f74 2063 6c61 6d70 5f67  id = not clamp_g
+00018e00: 7269 640d 0a20 2020 2020 2020 2066 6f72  rid..        for
+00018e10: 2077 696e 2069 6e20 7769 6e64 6f77 733a   win in windows:
+00018e20: 0d0a 2020 2020 2020 2020 2020 2020 666f  ..            fo
+00018e30: 7220 6178 2069 6e20 7769 6e2e 6178 733a  r ax in win.axs:
+00018e40: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00018e50: 2020 6178 2e63 726f 7373 6861 6972 2e75    ax.crosshair.u
+00018e60: 7064 6174 6528 290d 0a20 2020 2065 6c69  pdate()..    eli
+00018e70: 6620 6576 2e74 6578 7428 2920 3d3d 2027  f ev.text() == '
+00018e80: 6927 3a20 2320 696e 7665 7274 0d0a 2020  i': # invert..  
+00018e90: 2020 2020 2020 666f 7220 7769 6e20 696e        for win in
+00018ea0: 2077 696e 646f 7773 3a0d 0a20 2020 2020   windows:..     
+00018eb0: 2020 2020 2020 2066 6f72 2061 7820 696e         for ax in
+00018ec0: 2077 696e 2e61 7873 3a0d 0a20 2020 2020   win.axs:..     
+00018ed0: 2020 2020 2020 2020 2020 2061 782e 7365             ax.se
+00018ee0: 7454 7261 6e73 666f 726d 2861 782e 7472  tTransform(ax.tr
+00018ef0: 616e 7366 6f72 6d28 292e 7363 616c 6528  ansform().scale(
+00018f00: 312c 2d31 292e 7472 616e 736c 6174 6528  1,-1).translate(
+00018f10: 302c 2d61 782e 6865 6967 6874 2829 2929  0,-ax.height()))
+00018f20: 0d0a 2020 2020 656c 6966 2065 762e 7465  ..    elif ev.te
+00018f30: 7874 2829 2069 6e20 2827 5c72 272c 2027  xt() in ('\r', '
+00018f40: 2027 293a 2023 2065 6e74 6572 2c20 7370   '): # enter, sp
+00018f50: 6163 650d 0a20 2020 2020 2020 2076 622e  ace..        vb.
+00018f60: 7365 745f 6472 6177 5f6c 696e 655f 636f  set_draw_line_co
+00018f70: 6c6f 7228 6472 6177 5f64 6f6e 655f 636f  lor(draw_done_co
+00018f80: 6c6f 7229 0d0a 2020 2020 2020 2020 7662  lor)..        vb
+00018f90: 2e64 7261 775f 6c69 6e65 203d 204e 6f6e  .draw_line = Non
+00018fa0: 650d 0a20 2020 2065 6c69 6620 6576 2e74  e..    elif ev.t
+00018fb0: 6578 7428 2920 696e 2028 275c 7837 6627  ext() in ('\x7f'
+00018fc0: 2c20 275c 6227 293a 2023 2064 656c 2c20  , '\b'): # del, 
+00018fd0: 6261 636b 7370 6163 650d 0a20 2020 2020  backspace..     
+00018fe0: 2020 2069 6620 6e6f 7420 7662 2e72 656d     if not vb.rem
+00018ff0: 6f76 655f 6c61 7374 5f72 6f69 2829 3a0d  ove_last_roi():.
+00019000: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00019010: 7572 6e20 4661 6c73 650d 0a20 2020 2065  urn False..    e
+00019020: 6c69 6620 6576 2e6b 6579 2829 203d 3d20  lif ev.key() == 
+00019030: 5174 436f 7265 2e51 742e 4b65 792e 4b65  QtCore.Qt.Key.Ke
+00019040: 795f 4c65 6674 3a0d 0a20 2020 2020 2020  y_Left:..       
+00019050: 2076 622e 7061 6e5f 7828 7065 7263 656e   vb.pan_x(percen
+00019060: 743d 2d31 3529 0d0a 2020 2020 656c 6966  t=-15)..    elif
+00019070: 2065 762e 6b65 7928 2920 3d3d 2051 7443   ev.key() == QtC
+00019080: 6f72 652e 5174 2e4b 6579 2e4b 6579 5f52  ore.Qt.Key.Key_R
+00019090: 6967 6874 3a0d 0a20 2020 2020 2020 2076  ight:..        v
+000190a0: 622e 7061 6e5f 7828 7065 7263 656e 743d  b.pan_x(percent=
+000190b0: 2b31 3529 0d0a 2020 2020 656c 6966 2065  +15)..    elif e
+000190c0: 762e 6b65 7928 2920 3d3d 2051 7443 6f72  v.key() == QtCor
+000190d0: 652e 5174 2e4b 6579 2e4b 6579 5f48 6f6d  e.Qt.Key.Key_Hom
+000190e0: 653a 0d0a 2020 2020 2020 2020 7662 2e70  e:..        vb.p
+000190f0: 616e 5f78 2873 7465 7073 3d2d 3165 3130  an_x(steps=-1e10
+00019100: 290d 0a20 2020 2020 2020 205f 7265 7061  )..        _repa
+00019110: 696e 745f 6361 6e64 6c65 7328 290d 0a20  int_candles().. 
+00019120: 2020 2065 6c69 6620 6576 2e6b 6579 2829     elif ev.key()
+00019130: 203d 3d20 5174 436f 7265 2e51 742e 4b65   == QtCore.Qt.Ke
+00019140: 792e 4b65 795f 456e 643a 0d0a 2020 2020  y.Key_End:..    
+00019150: 2020 2020 7662 2e70 616e 5f78 2873 7465      vb.pan_x(ste
+00019160: 7073 3d2b 3165 3130 290d 0a20 2020 2020  ps=+1e10)..     
+00019170: 2020 205f 7265 7061 696e 745f 6361 6e64     _repaint_cand
+00019180: 6c65 7328 290d 0a20 2020 2065 6c69 6620  les()..    elif 
+00019190: 6576 2e6b 6579 2829 203d 3d20 5174 436f  ev.key() == QtCo
+000191a0: 7265 2e51 742e 4b65 792e 4b65 795f 4573  re.Qt.Key.Key_Es
+000191b0: 6361 7065 2061 6e64 206b 6579 5f65 7363  cape and key_esc
+000191c0: 5f63 6c6f 7365 3a0d 0a20 2020 2020 2020  _close:..       
+000191d0: 2076 622e 7769 6e2e 636c 6f73 6528 290d   vb.win.close().
+000191e0: 0a20 2020 2065 6c73 653a 0d0a 2020 2020  .    else:..    
+000191f0: 2020 2020 7265 7475 726e 2046 616c 7365      return False
+00019200: 0d0a 2020 2020 7265 7475 726e 2054 7275  ..    return Tru
+00019210: 650d 0a0d 0a0d 0a64 6566 205f 6d6f 7573  e......def _mous
+00019220: 655f 636c 6963 6b65 6428 7662 2c20 6576  e_clicked(vb, ev
+00019230: 293a 0d0a 2020 2020 6966 2065 762e 6275  ):..    if ev.bu
+00019240: 7474 6f6e 2829 203d 3d20 383a 2023 2062  tton() == 8: # b
+00019250: 6163 6b0d 0a20 2020 2020 2020 2076 622e  ack..        vb.
+00019260: 7061 6e5f 7828 7065 7263 656e 743d 2d33  pan_x(percent=-3
+00019270: 3029 0d0a 2020 2020 656c 6966 2065 762e  0)..    elif ev.
+00019280: 6275 7474 6f6e 2829 203d 3d20 3136 3a20  button() == 16: 
+00019290: 2320 6677 640d 0a20 2020 2020 2020 2076  # fwd..        v
+000192a0: 622e 7061 6e5f 7828 7065 7263 656e 743d  b.pan_x(percent=
+000192b0: 2b33 3029 0d0a 2020 2020 656c 7365 3a0d  +30)..    else:.
+000192c0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+000192d0: 4661 6c73 650d 0a20 2020 2072 6574 7572  False..    retur
+000192e0: 6e20 5472 7565 0d0a 0d0a 0d0a 6465 6620  n True......def 
+000192f0: 5f6d 6f75 7365 5f6d 6f76 6564 286d 6173  _mouse_moved(mas
+00019300: 7465 722c 2076 622c 2065 7673 293a 0d0a  ter, vb, evs):..
+00019310: 2020 2020 6966 2068 6173 6174 7472 286d      if hasattr(m
+00019320: 6173 7465 722c 2027 636c 6f73 696e 6727  aster, 'closing'
+00019330: 2920 616e 6420 6d61 7374 6572 2e63 6c6f  ) and master.clo
+00019340: 7369 6e67 3a0d 0a20 2020 2020 2020 2072  sing:..        r
+00019350: 6574 7572 6e0d 0a20 2020 206d 6420 3d20  eturn..    md = 
+00019360: 6d61 7374 6572 5f64 6174 615b 6d61 7374  master_data[mast
+00019370: 6572 5d2e 6765 7428 7662 2920 6f72 206d  er].get(vb) or m
+00019380: 6173 7465 725f 6461 7461 5b6d 6173 7465  aster_data[maste
+00019390: 725d 2e67 6574 2827 6465 6661 756c 7427  r].get('default'
+000193a0: 290d 0a20 2020 2069 6620 6d64 2069 7320  )..    if md is 
+000193b0: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2072  None:..        r
+000193c0: 6574 7572 6e0d 0a20 2020 2069 6620 6e6f  eturn..    if no
+000193d0: 7420 6576 733a 0d0a 2020 2020 2020 2020  t evs:..        
+000193e0: 6576 7320 3d20 6d64 5b27 6c61 7374 5f6d  evs = md['last_m
+000193f0: 6f75 7365 5f65 7673 275d 0d0a 2020 2020  ouse_evs']..    
+00019400: 2020 2020 6966 206e 6f74 2065 7673 3a0d      if not evs:.
+00019410: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00019420: 7572 6e0d 0a20 2020 206d 645b 276c 6173  urn..    md['las
+00019430: 745f 6d6f 7573 655f 6576 7327 5d20 3d20  t_mouse_evs'] = 
+00019440: 6576 730d 0a20 2020 2070 6f73 203d 2065  evs..    pos = e
+00019450: 7673 5b2d 315d 0d0a 2020 2020 2320 616c  vs[-1]..    # al
+00019460: 6c6f 7720 696e 7465 722d 7069 7865 6c20  low inter-pixel 
+00019470: 6d6f 7665 7320 6966 206d 6f76 696e 6720  moves if moving 
+00019480: 6d6f 7573 6520 736c 6f77 6c79 0d0a 2020  mouse slowly..  
+00019490: 2020 7920 3d20 706f 732e 7928 290d 0a20    y = pos.y().. 
+000194a0: 2020 2064 7920 3d20 7920 2d20 6d64 5b27     dy = y - md['
+000194b0: 6c61 7374 5f6d 6f75 7365 5f79 275d 0d0a  last_mouse_y']..
+000194c0: 2020 2020 6966 2030 203c 2061 6273 2864      if 0 < abs(d
+000194d0: 7929 203c 3d20 313a 0d0a 2020 2020 2020  y) <= 1:..      
+000194e0: 2020 706f 732e 7365 7459 2870 6f73 2e79    pos.setY(pos.y
+000194f0: 2829 202d 2064 792f 3229 0d0a 2020 2020  () - dy/2)..    
+00019500: 6d64 5b27 6c61 7374 5f6d 6f75 7365 5f79  md['last_mouse_y
+00019510: 275d 203d 2079 0d0a 2020 2020 2320 6170  '] = y..    # ap
+00019520: 706c 7920 746f 2061 6c6c 2063 726f 7373  ply to all cross
+00019530: 6861 6972 730d 0a20 2020 2066 6f72 2061  hairs..    for a
+00019540: 7820 696e 206d 6173 7465 722e 6178 733a  x in master.axs:
+00019550: 0d0a 2020 2020 2020 2020 6966 2061 782e  ..        if ax.
+00019560: 6973 5669 7369 626c 6528 2920 616e 6420  isVisible() and 
+00019570: 6178 2e63 726f 7373 6861 6972 3a0d 0a20  ax.crosshair:.. 
+00019580: 2020 2020 2020 2020 2020 2070 6f69 6e74             point
+00019590: 203d 2061 782e 7662 2e6d 6170 5363 656e   = ax.vb.mapScen
+000195a0: 6554 6f56 6965 7728 706f 7329 0d0a 2020  eToView(pos)..  
+000195b0: 2020 2020 2020 2020 2020 6178 2e63 726f            ax.cro
+000195c0: 7373 6861 6972 2e75 7064 6174 6528 706f  sshair.update(po
+000195d0: 696e 7429 0d0a 0d0a 0d0a 6465 6620 5f77  int)......def _w
+000195e0: 6865 656c 5f65 7665 6e74 5f77 7261 7070  heel_event_wrapp
+000195f0: 6572 2873 656c 662c 206f 7269 675f 6675  er(self, orig_fu
+00019600: 6e63 2c20 6576 293a 0d0a 2020 2020 2320  nc, ev):..    # 
+00019610: 7363 726f 6c6c 696e 6720 6f6e 2074 6865  scrolling on the
+00019620: 2062 6f72 6465 7220 6973 2073 696d 706c   border is simpl
+00019630: 7920 616e 6e6f 7969 6e67 2c20 706f 7020  y annoying, pop 
+00019640: 696e 2061 2063 6f75 706c 6520 6f66 2070  in a couple of p
+00019650: 6978 656c 7320 746f 206d 616b 6520 7375  ixels to make su
+00019660: 7265 0d0a 2020 2020 6420 3d20 5174 436f  re..    d = QtCo
+00019670: 7265 2e51 506f 696e 7446 282d 322c 3029  re.QPointF(-2,0)
+00019680: 0d0a 2020 2020 6576 203d 2051 7447 7569  ..    ev = QtGui
+00019690: 2e51 5768 6565 6c45 7665 6e74 2865 762e  .QWheelEvent(ev.
+000196a0: 706f 7369 7469 6f6e 2829 2b64 2c20 6576  position()+d, ev
+000196b0: 2e67 6c6f 6261 6c50 6f73 6974 696f 6e28  .globalPosition(
+000196c0: 292b 642c 2065 762e 7069 7865 6c44 656c  )+d, ev.pixelDel
+000196d0: 7461 2829 2c20 6576 2e61 6e67 6c65 4465  ta(), ev.angleDe
+000196e0: 6c74 6128 292c 2065 762e 6275 7474 6f6e  lta(), ev.button
+000196f0: 7328 292c 2065 762e 6d6f 6469 6669 6572  s(), ev.modifier
+00019700: 7328 292c 2065 762e 7068 6173 6528 292c  s(), ev.phase(),
+00019710: 2046 616c 7365 290d 0a20 2020 206f 7269   False)..    ori
+00019720: 675f 6675 6e63 2873 656c 662c 2065 7629  g_func(self, ev)
+00019730: 0d0a 0d0a 0d0a 6465 6620 5f69 6e73 7065  ......def _inspe
+00019740: 6374 5f63 6c69 636b 6564 2861 782c 2069  ct_clicked(ax, i
+00019750: 6e73 7065 6374 6f72 2c20 7768 656e 5f64  nspector, when_d
+00019760: 6f75 626c 655f 636c 6963 6b2c 2065 7673  ouble_click, evs
+00019770: 293a 0d0a 2020 2020 6966 2065 7673 5b2d  ):..    if evs[-
+00019780: 315d 2e61 6363 6570 7465 6420 6f72 2077  1].accepted or w
+00019790: 6865 6e5f 646f 7562 6c65 5f63 6c69 636b  hen_double_click
+000197a0: 2021 3d20 6576 735b 2d31 5d2e 646f 7562   != evs[-1].doub
+000197b0: 6c65 2829 3a0d 0a20 2020 2020 2020 2072  le():..        r
+000197c0: 6574 7572 6e0d 0a20 2020 2070 6f73 203d  eturn..    pos =
+000197d0: 2065 7673 5b2d 315d 2e73 6365 6e65 506f   evs[-1].scenePo
+000197e0: 7328 290d 0a20 2020 2072 6574 7572 6e20  s()..    return 
+000197f0: 5f69 6e73 7065 6374 5f70 6f73 2861 782c  _inspect_pos(ax,
+00019800: 2069 6e73 7065 6374 6f72 2c20 2870 6f73   inspector, (pos
+00019810: 2c29 290d 0a0d 0a0d 0a64 6566 205f 696e  ,))......def _in
+00019820: 7370 6563 745f 706f 7328 6178 2c20 696e  spect_pos(ax, in
+00019830: 7370 6563 746f 722c 2070 6f73 7329 3a0d  spector, poss):.
+00019840: 0a20 2020 2069 6620 6e6f 7420 6178 2e76  .    if not ax.v
+00019850: 622e 6461 7461 7372 633a 0d0a 2020 2020  b.datasrc:..    
+00019860: 2020 2020 7265 7475 726e 0d0a 2020 2020      return..    
+00019870: 706f 696e 7420 3d20 6178 2e76 622e 6d61  point = ax.vb.ma
+00019880: 7053 6365 6e65 546f 5669 6577 2870 6f73  pSceneToView(pos
+00019890: 735b 2d31 5d29 0d0a 2020 2020 7420 3d20  s[-1])..    t = 
+000198a0: 706f 696e 742e 7828 2920 2b20 302e 350d  point.x() + 0.5.
+000198b0: 0a20 2020 2074 7279 3a0d 0a20 2020 2020  .    try:..     
+000198c0: 2020 2074 203d 2061 782e 7662 2e64 6174     t = ax.vb.dat
+000198d0: 6173 7263 2e63 6c6f 7365 7374 5f74 696d  asrc.closest_tim
+000198e0: 6528 7429 0d0a 2020 2020 6578 6365 7074  e(t)..    except
+000198f0: 204b 6579 4572 726f 723a 2023 2077 6865   KeyError: # whe
+00019900: 6e20 636c 6963 6b69 6e67 2062 6579 6f6e  n clicking beyon
+00019910: 6420 7269 6768 745f 6d61 7267 696e 5f63  d right_margin_c
+00019920: 616e 646c 6573 0d0a 2020 2020 2020 2020  andles..        
+00019930: 6966 2063 6c61 6d70 5f67 7269 643a 0d0a  if clamp_grid:..
+00019940: 2020 2020 2020 2020 2020 2020 7420 3d20              t = 
+00019950: 6178 2e76 622e 6461 7461 7372 632e 782e  ax.vb.datasrc.x.
+00019960: 696c 6f63 5b2d 3120 6966 2074 203e 2030  iloc[-1 if t > 0
+00019970: 2065 6c73 6520 305d 0d0a 2020 2020 7472   else 0]..    tr
+00019980: 793a 0d0a 2020 2020 2020 2020 696e 7370  y:..        insp
+00019990: 6563 746f 7228 742c 2070 6f69 6e74 2e79  ector(t, point.y
+000199a0: 2829 290d 0a20 2020 2065 7863 6570 7420  ())..    except 
+000199b0: 4f53 4572 726f 7220 6173 2065 3a0d 0a20  OSError as e:.. 
+000199c0: 2020 2020 2020 2070 6173 730d 0a20 2020         pass..   
+000199d0: 2065 7863 6570 7420 4578 6365 7074 696f   except Exceptio
+000199e0: 6e20 6173 2065 3a0d 0a20 2020 2020 2020  n as e:..       
+000199f0: 2070 7269 6e74 2827 496e 7370 6563 7469   print('Inspecti
+00019a00: 6f6e 2065 7272 6f72 3a27 2c20 7479 7065  on error:', type
+00019a10: 2865 292c 2065 290d 0a0d 0a0d 0a64 6566  (e), e)......def
+00019a20: 2062 7269 6768 7465 6e28 636f 6c6f 722c   brighten(color,
+00019a30: 2066 293a 0d0a 2020 2020 6966 206e 6f74   f):..    if not
+00019a40: 2063 6f6c 6f72 3a0d 0a20 2020 2020 2020   color:..       
+00019a50: 2072 6574 7572 6e20 636f 6c6f 720d 0a20   return color.. 
+00019a60: 2020 2072 6574 7572 6e20 7067 2e6d 6b43     return pg.mkC
+00019a70: 6f6c 6f72 2863 6f6c 6f72 292e 6c69 6768  olor(color).ligh
+00019a80: 7465 7228 696e 7428 662a 3130 3029 290d  ter(int(f*100)).
+00019a90: 0a0d 0a0d 0a64 6566 205f 6765 745f 636f  .....def _get_co
+00019aa0: 6c6f 7228 6178 2c20 7374 796c 652c 2077  lor(ax, style, w
+00019ab0: 616e 7465 645f 636f 6c6f 7229 3a0d 0a20  anted_color):.. 
+00019ac0: 2020 2069 6620 7479 7065 2877 616e 7465     if type(wante
+00019ad0: 645f 636f 6c6f 7229 2069 6e20 2873 7472  d_color) in (str
+00019ae0: 2c20 5174 4775 692e 5143 6f6c 6f72 293a  , QtGui.QColor):
+00019af0: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+00019b00: 2077 616e 7465 645f 636f 6c6f 720d 0a20   wanted_color.. 
+00019b10: 2020 2069 6e64 6578 203d 2077 616e 7465     index = wante
+00019b20: 645f 636f 6c6f 7220 6966 2074 7970 6528  d_color if type(
+00019b30: 7761 6e74 6564 5f63 6f6c 6f72 2920 3d3d  wanted_color) ==
+00019b40: 2069 6e74 2065 6c73 6520 4e6f 6e65 0d0a   int else None..
+00019b50: 2020 2020 6973 5f6c 696e 6520 3d20 6c61      is_line = la
+00019b60: 6d62 6461 2073 7479 6c65 3a20 7374 796c  mbda style: styl
+00019b70: 6520 6973 204e 6f6e 6520 6f72 2061 6e79  e is None or any
+00019b80: 2863 6820 696e 2073 7479 6c65 2066 6f72  (ch in style for
+00019b90: 2063 6820 696e 2027 2d5f 2e27 290d 0a20   ch in '-_.').. 
+00019ba0: 2020 2074 6869 735f 6c69 6e65 203d 2069     this_line = i
+00019bb0: 735f 6c69 6e65 2873 7479 6c65 290d 0a20  s_line(style).. 
+00019bc0: 2020 2069 6620 7468 6973 5f6c 696e 653a     if this_line:
+00019bd0: 0d0a 2020 2020 2020 2020 636f 6c6f 7273  ..        colors
+00019be0: 203d 2073 6f66 745f 636f 6c6f 7273 0d0a   = soft_colors..
+00019bf0: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
+00019c00: 2020 2063 6f6c 6f72 7320 3d20 6861 7264     colors = hard
+00019c10: 5f63 6f6c 6f72 730d 0a20 2020 2069 6620  _colors..    if 
+00019c20: 696e 6465 7820 6973 204e 6f6e 653a 0d0a  index is None:..
+00019c30: 2020 2020 2020 2020 6176 6f69 6420 3d20          avoid = 
+00019c40: 7365 7428 692e 6f70 7473 5b27 6861 6e64  set(i.opts['hand
+00019c50: 6564 5f63 6f6c 6f72 275d 2066 6f72 2069  ed_color'] for i
+00019c60: 2069 6e20 6178 2e69 7465 6d73 2069 6620   in ax.items if 
+00019c70: 6973 696e 7374 616e 6365 2869 2c70 672e  isinstance(i,pg.
+00019c80: 506c 6f74 4461 7461 4974 656d 2920 616e  PlotDataItem) an
+00019c90: 6420 692e 6f70 7473 5b27 6861 6e64 6564  d i.opts['handed
+00019ca0: 5f63 6f6c 6f72 275d 2069 7320 6e6f 7420  _color'] is not 
+00019cb0: 4e6f 6e65 2061 6e64 2074 6869 735f 6c69  None and this_li
+00019cc0: 6e65 3d3d 6973 5f6c 696e 6528 692e 6f70  ne==is_line(i.op
+00019cd0: 7473 5b27 7379 6d62 6f6c 275d 2929 0d0a  ts['symbol']))..
+00019ce0: 2020 2020 2020 2020 696e 6465 7820 3d20          index = 
+00019cf0: 6c65 6e28 5b69 2066 6f72 2069 2069 6e20  len([i for i in 
+00019d00: 6178 2e69 7465 6d73 2069 6620 6973 696e  ax.items if isin
+00019d10: 7374 616e 6365 2869 2c70 672e 506c 6f74  stance(i,pg.Plot
+00019d20: 4461 7461 4974 656d 2920 616e 6420 692e  DataItem) and i.
+00019d30: 6f70 7473 5b27 6861 6e64 6564 5f63 6f6c  opts['handed_col
+00019d40: 6f72 275d 2069 7320 4e6f 6e65 2061 6e64  or'] is None and
+00019d50: 2074 6869 735f 6c69 6e65 3d3d 6973 5f6c   this_line==is_l
+00019d60: 696e 6528 692e 6f70 7473 5b27 7379 6d62  ine(i.opts['symb
+00019d70: 6f6c 275d 295d 290d 0a20 2020 2020 2020  ol'])])..       
+00019d80: 2077 6869 6c65 2069 6e64 6578 2069 6e20   while index in 
+00019d90: 6176 6f69 643a 0d0a 2020 2020 2020 2020  avoid:..        
+00019da0: 2020 2020 696e 6465 7820 2b3d 2031 0d0a      index += 1..
+00019db0: 2020 2020 7265 7475 726e 2063 6f6c 6f72      return color
+00019dc0: 735b 696e 6465 7825 6c65 6e28 636f 6c6f  s[index%len(colo
+00019dd0: 7273 295d 0d0a 0d0a 0d0a 6465 6620 5f70  rs)]......def _p
+00019de0: 6474 696d 6532 6570 6f63 6828 7429 3a0d  dtime2epoch(t):.
+00019df0: 0a20 2020 2069 6620 6973 696e 7374 616e  .    if isinstan
+00019e00: 6365 2874 2c20 7064 2e53 6572 6965 7329  ce(t, pd.Series)
+00019e10: 3a0d 0a20 2020 2020 2020 2069 6620 6973  :..        if is
+00019e20: 696e 7374 616e 6365 2874 2e69 6c6f 635b  instance(t.iloc[
+00019e30: 305d 2c20 7064 2e54 696d 6573 7461 6d70  0], pd.Timestamp
+00019e40: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+00019e50: 6474 7970 6520 3d20 7374 7228 742e 6474  dtype = str(t.dt
+00019e60: 7970 6529 0d0a 2020 2020 2020 2020 2020  ype)..          
+00019e70: 2020 6966 2064 7479 7065 2e65 6e64 7377    if dtype.endsw
+00019e80: 6974 6828 275b 735d 2729 3a0d 0a20 2020  ith('[s]'):..   
+00019e90: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+00019ea0: 7572 6e20 742e 7669 6577 2827 696e 7436  urn t.view('int6
+00019eb0: 3427 2920 2a20 696e 7428 3165 3929 0d0a  4') * int(1e9)..
+00019ec0: 2020 2020 2020 2020 2020 2020 656c 6966              elif
+00019ed0: 2064 7479 7065 2e65 6e64 7377 6974 6828   dtype.endswith(
+00019ee0: 275b 6d73 5d27 293a 0d0a 2020 2020 2020  '[ms]'):..      
+00019ef0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00019f00: 2074 2e76 6965 7728 2769 6e74 3634 2729   t.view('int64')
+00019f10: 202a 2069 6e74 2831 6536 290d 0a20 2020   * int(1e6)..   
+00019f20: 2020 2020 2020 2020 2065 6c69 6620 6474           elif dt
+00019f30: 7970 652e 656e 6473 7769 7468 2827 7573  ype.endswith('us
+00019f40: 2729 3a0d 0a20 2020 2020 2020 2020 2020  '):..           
+00019f50: 2020 2020 2072 6574 7572 6e20 742e 7669       return t.vi
+00019f60: 6577 2827 696e 7436 3427 2920 2a20 696e  ew('int64') * in
+00019f70: 7428 3165 3329 0d0a 2020 2020 2020 2020  t(1e3)..        
+00019f80: 2020 2020 7265 7475 726e 2074 2e76 6965      return t.vie
+00019f90: 7728 2769 6e74 3634 2729 0d0a 2020 2020  w('int64')..    
+00019fa0: 2020 2020 6820 3d20 6e70 2e6e 616e 6d61      h = np.nanma
+00019fb0: 7828 742e 7661 6c75 6573 290d 0a20 2020  x(t.values)..   
+00019fc0: 2020 2020 2069 6620 6820 3c20 3165 3130       if h < 1e10
+00019fd0: 3a20 2320 6861 6e64 6c65 2073 2065 706f  : # handle s epo
+00019fe0: 6368 730d 0a20 2020 2020 2020 2020 2020  chs..           
+00019ff0: 2072 6574 7572 6e20 2874 2a31 6539 292e   return (t*1e9).
+0001a000: 6173 7479 7065 2827 696e 7436 3427 290d  astype('int64').
+0001a010: 0a20 2020 2020 2020 2069 6620 6820 3c20  .        if h < 
+0001a020: 3165 3133 3a20 2320 6861 6e64 6c65 206d  1e13: # handle m
+0001a030: 7320 6570 6f63 6873 0d0a 2020 2020 2020  s epochs..      
+0001a040: 2020 2020 2020 7265 7475 726e 2028 742a        return (t*
+0001a050: 3165 3629 2e61 7374 7970 6528 2769 6e74  1e6).astype('int
+0001a060: 3634 2729 0d0a 2020 2020 2020 2020 6966  64')..        if
+0001a070: 2068 203c 2031 6531 363a 2023 2068 616e   h < 1e16: # han
+0001a080: 646c 6520 7573 2065 706f 6368 730d 0a20  dle us epochs.. 
+0001a090: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0001a0a0: 6e20 2874 2a31 6533 292e 6173 7479 7065  n (t*1e3).astype
+0001a0b0: 2827 696e 7436 3427 290d 0a20 2020 2020  ('int64')..     
+0001a0c0: 2020 2072 6574 7572 6e20 742e 6173 7479     return t.asty
+0001a0d0: 7065 2827 696e 7436 3427 290d 0a20 2020  pe('int64')..   
+0001a0e0: 2072 6574 7572 6e20 740d 0a0d 0a0d 0a64   return t......d
+0001a0f0: 6566 205f 7064 7469 6d65 3269 6e64 6578  ef _pdtime2index
+0001a100: 2861 782c 2074 732c 2061 6e79 5f65 6e64  (ax, ts, any_end
+0001a110: 3d46 616c 7365 2c20 7265 7175 6972 655f  =False, require_
+0001a120: 7469 6d65 3d46 616c 7365 293a 0d0a 2020  time=False):..  
+0001a130: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
+0001a140: 7473 2e69 6c6f 635b 305d 2c20 7064 2e54  ts.iloc[0], pd.T
+0001a150: 696d 6573 7461 6d70 293a 0d0a 2020 2020  imestamp):..    
+0001a160: 2020 2020 7473 203d 2074 732e 7669 6577      ts = ts.view
+0001a170: 2827 696e 7436 3427 290d 0a20 2020 2065  ('int64')..    e
+0001a180: 6c73 653a 0d0a 2020 2020 2020 2020 6820  lse:..        h 
+0001a190: 3d20 6e70 2e6e 616e 6d61 7828 7473 2e76  = np.nanmax(ts.v
+0001a1a0: 616c 7565 7329 0d0a 2020 2020 2020 2020  alues)..        
+0001a1b0: 6966 2068 203c 2031 6537 3a0d 0a20 2020  if h < 1e7:..   
+0001a1c0: 2020 2020 2020 2020 2069 6620 7265 7175           if requ
+0001a1d0: 6972 655f 7469 6d65 3a0d 0a20 2020 2020  ire_time:..     
+0001a1e0: 2020 2020 2020 2020 2020 2061 7373 6572             asser
+0001a1f0: 7420 4661 6c73 652c 2027 6e6f 7420 6120  t False, 'not a 
+0001a200: 7469 6d65 2073 6572 6965 7327 0d0a 2020  time series'..  
+0001a210: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0001a220: 2074 730d 0a20 2020 2020 2020 2069 6620   ts..        if 
+0001a230: 6820 3c20 3165 3130 3a20 2320 6861 6e64  h < 1e10: # hand
+0001a240: 6c65 2073 2065 706f 6368 730d 0a20 2020  le s epochs..   
+0001a250: 2020 2020 2020 2020 2074 7320 3d20 7473           ts = ts
+0001a260: 2e61 7374 7970 6528 2766 6c6f 6174 3634  .astype('float64
+0001a270: 2729 202a 2031 6539 0d0a 2020 2020 2020  ') * 1e9..      
+0001a280: 2020 656c 6966 2068 203c 2031 6531 333a    elif h < 1e13:
+0001a290: 2023 2068 616e 646c 6520 6d73 2065 706f   # handle ms epo
+0001a2a0: 6368 730d 0a20 2020 2020 2020 2020 2020  chs..           
+0001a2b0: 2074 7320 3d20 7473 2e61 7374 7970 6528   ts = ts.astype(
+0001a2c0: 2766 6c6f 6174 3634 2729 202a 2031 6536  'float64') * 1e6
+0001a2d0: 0d0a 2020 2020 2020 2020 656c 6966 2068  ..        elif h
+0001a2e0: 203c 2031 6531 363a 2023 2068 616e 646c   < 1e16: # handl
+0001a2f0: 6520 7573 2065 706f 6368 730d 0a20 2020  e us epochs..   
+0001a300: 2020 2020 2020 2020 2074 7320 3d20 7473           ts = ts
+0001a310: 2e61 7374 7970 6528 2766 6c6f 6174 3634  .astype('float64
+0001a320: 2729 202a 2031 6533 0d0a 2020 2020 0d0a  ') * 1e3..    ..
+0001a330: 2020 2020 6461 7461 7372 6320 3d20 5f67      datasrc = _g
+0001a340: 6574 5f64 6174 6173 7263 2861 7829 0d0a  et_datasrc(ax)..
+0001a350: 2020 2020 7873 203d 2064 6174 6173 7263      xs = datasrc
+0001a360: 2e78 0d0a 0d0a 2020 2020 2320 7472 7920  .x....    # try 
+0001a370: 6578 6163 7420 6d61 7463 6820 6265 666f  exact match befo
+0001a380: 7265 2061 7070 726f 7869 6d61 7465 206d  re approximate m
+0001a390: 6174 6368 0d0a 2020 2020 6578 6163 7420  atch..    exact 
+0001a3a0: 3d20 6461 7461 7372 632e 696e 6465 785b  = datasrc.index[
+0001a3b0: 7873 2e69 7369 6e28 7473 295d 2e74 6f5f  xs.isin(ts)].to_
+0001a3c0: 6c69 7374 2829 0d0a 2020 2020 6966 206c  list()..    if l
+0001a3d0: 656e 2865 7861 6374 2920 3d3d 206c 656e  en(exact) == len
+0001a3e0: 2874 7329 3a0d 0a20 2020 2020 2020 2072  (ts):..        r
+0001a3f0: 6574 7572 6e20 6578 6163 740d 0a20 2020  eturn exact..   
+0001a400: 200d 0a20 2020 2072 203d 205b 5d0d 0a20   ..    r = [].. 
+0001a410: 2020 2066 6f72 2069 2c74 2069 6e20 656e     for i,t in en
+0001a420: 756d 6572 6174 6528 7473 293a 0d0a 2020  umerate(ts):..  
+0001a430: 2020 2020 2020 7873 7320 3d20 7873 2e6c        xss = xs.l
+0001a440: 6f63 5b78 733e 745d 0d0a 2020 2020 2020  oc[xs>t]..      
+0001a450: 2020 6966 206c 656e 2878 7373 2920 3d3d    if len(xss) ==
+0001a460: 2030 3a0d 0a20 2020 2020 2020 2020 2020   0:..           
+0001a470: 2074 3020 3d20 7873 2e69 6c6f 635b 2d31   t0 = xs.iloc[-1
+0001a480: 5d0d 0a20 2020 2020 2020 2020 2020 2069  ]..            i
+0001a490: 6620 616e 795f 656e 6420 6f72 2074 3020  f any_end or t0 
+0001a4a0: 3d3d 2074 3a0d 0a20 2020 2020 2020 2020  == t:..         
+0001a4b0: 2020 2020 2020 2072 2e61 7070 656e 6428         r.append(
+0001a4c0: 6c65 6e28 7873 292d 3129 0d0a 2020 2020  len(xs)-1)..    
+0001a4d0: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
+0001a4e0: 696e 7565 0d0a 2020 2020 2020 2020 2020  inue..          
+0001a4f0: 2020 6966 2069 203e 2030 3a0d 0a20 2020    if i > 0:..   
+0001a500: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
+0001a510: 7469 6e75 650d 0a20 2020 2020 2020 2020  tinue..         
+0001a520: 2020 2061 7373 6572 7420 7420 3c3d 2074     assert t <= t
+0001a530: 302c 2027 6d75 7374 2070 6c6f 7420 7468  0, 'must plot th
+0001a540: 6973 2070 7269 6d69 7469 7665 2069 6e20  is primitive in 
+0001a550: 7072 696f 7220 7469 6d65 2d72 616e 6765  prior time-range
+0001a560: 270d 0a20 2020 2020 2020 2069 3120 3d20  '..        i1 = 
+0001a570: 7873 732e 696e 6465 785b 305d 0d0a 2020  xss.index[0]..  
+0001a580: 2020 2020 2020 6930 203d 2069 312d 310d        i0 = i1-1.
+0001a590: 0a20 2020 2020 2020 2069 6620 6930 203c  .        if i0 <
+0001a5a0: 2030 3a0d 0a20 2020 2020 2020 2020 2020   0:..           
+0001a5b0: 2069 302c 6931 203d 2030 2c31 0d0a 2020   i0,i1 = 0,1..  
+0001a5c0: 2020 2020 2020 7430 2c74 3120 3d20 7873        t0,t1 = xs
+0001a5d0: 2e6c 6f63 5b69 305d 2c20 7873 2e6c 6f63  .loc[i0], xs.loc
+0001a5e0: 5b69 315d 0d0a 2020 2020 2020 2020 6474  [i1]..        dt
+0001a5f0: 203d 2028 742d 7430 2920 2f20 2874 312d   = (t-t0) / (t1-
+0001a600: 7430 290d 0a20 2020 2020 2020 2072 2e61  t0)..        r.a
+0001a610: 7070 656e 6428 6c65 7270 2864 742c 2069  ppend(lerp(dt, i
+0001a620: 302c 2069 3129 290d 0a20 2020 2072 6574  0, i1))..    ret
+0001a630: 7572 6e20 720d 0a0d 0a0d 0a64 6566 205f  urn r......def _
+0001a640: 6765 745f 6461 7461 7372 6328 6178 2c20  get_datasrc(ax, 
+0001a650: 7265 7175 6972 653d 5472 7565 293a 0d0a  require=True):..
+0001a660: 2020 2020 6966 2061 782e 7662 2e64 6174      if ax.vb.dat
+0001a670: 6173 7263 2069 7320 6e6f 7420 4e6f 6e65  asrc is not None
+0001a680: 206f 7220 6e6f 7420 6178 2e76 622e 785f   or not ax.vb.x_
+0001a690: 696e 6465 7865 643a 0d0a 2020 2020 2020  indexed:..      
+0001a6a0: 2020 7265 7475 726e 2061 782e 7662 2e64    return ax.vb.d
+0001a6b0: 6174 6173 7263 0d0a 2020 2020 7662 7320  atasrc..    vbs 
+0001a6c0: 3d20 5b61 782e 7662 2066 6f72 2077 696e  = [ax.vb for win
+0001a6d0: 2069 6e20 7769 6e64 6f77 7320 666f 7220   in windows for 
+0001a6e0: 6178 2069 6e20 7769 6e2e 6178 735d 0d0a  ax in win.axs]..
+0001a6f0: 2020 2020 666f 7220 7662 2069 6e20 7662      for vb in vb
+0001a700: 733a 0d0a 2020 2020 2020 2020 6966 2076  s:..        if v
+0001a710: 622e 6461 7461 7372 633a 0d0a 2020 2020  b.datasrc:..    
+0001a720: 2020 2020 2020 2020 7265 7475 726e 2076          return v
+0001a730: 622e 6461 7461 7372 630d 0a20 2020 2069  b.datasrc..    i
+0001a740: 6620 7265 7175 6972 653a 0d0a 2020 2020  f require:..    
+0001a750: 2020 2020 6173 7365 7274 2061 782e 7662      assert ax.vb
+0001a760: 2e64 6174 6173 7263 2c20 276e 6f74 2070  .datasrc, 'not p
+0001a770: 6f73 7369 626c 6520 746f 2070 6c6f 7420  ossible to plot 
+0001a780: 7468 6973 2070 7269 6d69 7469 7665 2077  this primitive w
+0001a790: 6974 686f 7574 2061 2070 7269 6f72 2074  ithout a prior t
+0001a7a0: 696d 652d 7261 6e67 6520 746f 2063 6f6d  ime-range to com
+0001a7b0: 7061 7265 2074 6f27 0d0a 0d0a 0d0a 6465  pare to'......de
+0001a7c0: 6620 5f6d 696c 6c69 7365 636f 6e64 5f74  f _millisecond_t
+0001a7d0: 7a5f 7772 6170 2873 293a 0d0a 2020 2020  z_wrap(s):..    
+0001a7e0: 6966 206c 656e 2873 2920 3e20 3620 616e  if len(s) > 6 an
+0001a7f0: 6420 735b 2d36 5d20 696e 2027 2b2d 2720  d s[-6] in '+-' 
+0001a800: 616e 6420 735b 2d33 5d20 3d3d 2027 3a27  and s[-3] == ':'
+0001a810: 3a20 2320 2b30 313a 3030 2066 6d74 2074  : # +01:00 fmt t
+0001a820: 696d 657a 6f6e 6520 7072 6573 656e 743f  imezone present?
+0001a830: 0d0a 2020 2020 2020 2020 7320 3d20 735b  ..        s = s[
+0001a840: 3a2d 365d 0d0a 2020 2020 7265 7475 726e  :-6]..    return
+0001a850: 2028 732b 272e 3030 3030 3030 2729 2069   (s+'.000000') i
+0001a860: 6620 272e 2720 6e6f 7420 696e 2073 2065  f '.' not in s e
+0001a870: 6c73 6520 730d 0a0d 0a0d 0a64 6566 205f  lse s......def _
+0001a880: 7832 6c6f 6361 6c5f 7428 6461 7461 7372  x2local_t(datasr
+0001a890: 632c 2078 293a 0d0a 2020 2020 6966 2064  c, x):..    if d
+0001a8a0: 6973 706c 6179 5f74 696d 657a 6f6e 6520  isplay_timezone 
+0001a8b0: 3d3d 204e 6f6e 653a 0d0a 2020 2020 2020  == None:..      
+0001a8c0: 2020 7265 7475 726e 205f 7832 7574 6328    return _x2utc(
+0001a8d0: 6461 7461 7372 632c 2078 290d 0a20 2020  datasrc, x)..   
+0001a8e0: 2072 6574 7572 6e20 5f78 3274 2864 6174   return _x2t(dat
+0001a8f0: 6173 7263 2c20 782c 206c 616d 6264 6120  asrc, x, lambda 
+0001a900: 743a 205f 6d69 6c6c 6973 6563 6f6e 645f  t: _millisecond_
+0001a910: 747a 5f77 7261 7028 6461 7465 7469 6d65  tz_wrap(datetime
+0001a920: 2e66 726f 6d74 696d 6573 7461 6d70 2874  .fromtimestamp(t
+0001a930: 2f31 6539 2c20 747a 3d64 6973 706c 6179  /1e9, tz=display
+0001a940: 5f74 696d 657a 6f6e 6529 2e69 736f 666f  _timezone).isofo
+0001a950: 726d 6174 2873 6570 3d27 2027 2929 290d  rmat(sep=' '))).
+0001a960: 0a0d 0a0d 0a64 6566 205f 7832 7574 6328  .....def _x2utc(
+0001a970: 6461 7461 7372 632c 2078 293a 0d0a 2020  datasrc, x):..  
+0001a980: 2020 2320 7573 696e 6720 7064 2e74 6f5f    # using pd.to_
+0001a990: 6461 7465 7469 6d65 2061 6c6c 6f77 2066  datetime allow f
+0001a9a0: 6f72 2070 7265 2d31 3937 3020 6461 7465  or pre-1970 date
+0001a9b0: 730d 0a20 2020 2072 6574 7572 6e20 5f78  s..    return _x
+0001a9c0: 3274 2864 6174 6173 7263 2c20 782c 206c  2t(datasrc, x, l
+0001a9d0: 616d 6264 6120 743a 2070 642e 746f 5f64  ambda t: pd.to_d
+0001a9e0: 6174 6574 696d 6528 742c 2075 6e69 743d  atetime(t, unit=
+0001a9f0: 276e 7327 292e 7374 7266 7469 6d65 2827  'ns').strftime('
+0001aa00: 2559 2d25 6d2d 2564 2025 483a 254d 3a25  %Y-%m-%d %H:%M:%
+0001aa10: 532e 2566 2729 290d 0a0d 0a0d 0a64 6566  S.%f'))......def
+0001aa20: 205f 7832 7428 6461 7461 7372 632c 2078   _x2t(datasrc, x
+0001aa30: 2c20 7473 3273 7472 293a 0d0a 2020 2020  , ts2str):..    
+0001aa40: 6966 206e 6f74 2064 6174 6173 7263 3a0d  if not datasrc:.
+0001aa50: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0001aa60: 2727 2c46 616c 7365 0d0a 2020 2020 7472  '',False..    tr
+0001aa70: 793a 0d0a 2020 2020 2020 2020 7820 2b3d  y:..        x +=
+0001aa80: 2030 2e35 0d0a 2020 2020 2020 2020 742c   0.5..        t,
+0001aa90: 5f2c 5f2c 5f2c 636e 7420 3d20 6461 7461  _,_,_,cnt = data
+0001aaa0: 7372 632e 6869 6c6f 2878 2c20 7829 0d0a  src.hilo(x, x)..
+0001aab0: 2020 2020 2020 2020 6966 2063 6e74 3a0d          if cnt:.
+0001aac0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0001aad0: 6e6f 7420 6461 7461 7372 632e 7469 6d65  not datasrc.time
+0001aae0: 6261 7365 6428 293a 0d0a 2020 2020 2020  based():..      
+0001aaf0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0001ab00: 2027 2567 2720 2520 742c 2046 616c 7365   '%g' % t, False
+0001ab10: 0d0a 2020 2020 2020 2020 2020 2020 7320  ..            s 
+0001ab20: 3d20 7473 3273 7472 2874 290d 0a20 2020  = ts2str(t)..   
+0001ab30: 2020 2020 2020 2020 2069 6620 6570 6f63           if epoc
+0001ab40: 685f 7065 7269 6f64 203e 3d20 3233 2a36  h_period >= 23*6
+0001ab50: 302a 3630 3a20 2320 6461 796c 6967 6874  0*60: # daylight
+0001ab60: 2073 6176 696e 6773 2c20 6c65 6170 2073   savings, leap s
+0001ab70: 6563 6f6e 6473 2c20 6574 630d 0a20 2020  econds, etc..   
+0001ab80: 2020 2020 2020 2020 2020 2020 2069 203d               i =
+0001ab90: 2073 2e69 6e64 6578 2827 2027 290d 0a20   s.index(' ').. 
+0001aba0: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
+0001abb0: 6570 6f63 685f 7065 7269 6f64 203e 3d20  epoch_period >= 
+0001abc0: 3539 3a20 2320 636f 6e73 6964 6572 206c  59: # consider l
+0001abd0: 6561 7020 7365 636f 6e64 730d 0a20 2020  eap seconds..   
+0001abe0: 2020 2020 2020 2020 2020 2020 2069 203d               i =
+0001abf0: 2073 2e72 696e 6465 7828 273a 2729 0d0a   s.rindex(':')..
+0001ac00: 2020 2020 2020 2020 2020 2020 656c 6966              elif
+0001ac10: 2065 706f 6368 5f70 6572 696f 6420 3e3d   epoch_period >=
+0001ac20: 2031 3a0d 0a20 2020 2020 2020 2020 2020   1:..           
+0001ac30: 2020 2020 2069 203d 2073 2e69 6e64 6578       i = s.index
+0001ac40: 2827 2e27 2920 6966 2027 2e27 2069 6e20  ('.') if '.' in 
+0001ac50: 7320 656c 7365 206c 656e 2873 290d 0a20  s else len(s).. 
+0001ac60: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
+0001ac70: 6570 6f63 685f 7065 7269 6f64 203e 3d20  epoch_period >= 
+0001ac80: 302e 3030 313a 0d0a 2020 2020 2020 2020  0.001:..        
+0001ac90: 2020 2020 2020 2020 6920 3d20 2d33 0d0a          i = -3..
+0001aca0: 2020 2020 2020 2020 2020 2020 656c 7365              else
+0001acb0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+0001acc0: 2020 2069 203d 206c 656e 2873 290d 0a20     i = len(s).. 
+0001acd0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0001ace0: 6e20 735b 3a69 5d2c 5472 7565 0d0a 2020  n s[:i],True..  
+0001acf0: 2020 6578 6365 7074 2045 7863 6570 7469    except Excepti
+0001ad00: 6f6e 2061 7320 653a 0d0a 2020 2020 2020  on as e:..      
+0001ad10: 2020 696d 706f 7274 2074 7261 6365 6261    import traceba
+0001ad20: 636b 0d0a 2020 2020 2020 2020 7472 6163  ck..        trac
+0001ad30: 6562 6163 6b2e 7072 696e 745f 6578 6328  eback.print_exc(
+0001ad40: 290d 0a20 2020 2072 6574 7572 6e20 2727  )..    return ''
+0001ad50: 2c64 6174 6173 7263 2e74 696d 6562 6173  ,datasrc.timebas
+0001ad60: 6564 2829 0d0a 0d0a 0d0a 6465 6620 5f78  ed()......def _x
+0001ad70: 3279 6561 7228 6461 7461 7372 632c 2078  2year(datasrc, x
+0001ad80: 293a 0d0a 2020 2020 742c 6861 7364 7320  ):..    t,hasds 
+0001ad90: 3d20 5f78 326c 6f63 616c 5f74 2864 6174  = _x2local_t(dat
+0001ada0: 6173 7263 2c20 7829 0d0a 2020 2020 7265  asrc, x)..    re
+0001adb0: 7475 726e 2074 5b3a 345d 2c68 6173 6473  turn t[:4],hasds
+0001adc0: 0d0a 0d0a 0d0a 6465 6620 5f72 6f75 6e64  ......def _round
+0001add0: 5f74 6f5f 7369 676e 6966 6963 616e 7428  _to_significant(
+0001ade0: 726e 672c 2072 6e67 6d61 782c 2078 2c20  rng, rngmax, x, 
+0001adf0: 7369 676e 6966 6963 616e 745f 6465 6369  significant_deci
+0001ae00: 6d61 6c73 2c20 7369 676e 6966 6963 616e  mals, significan
+0001ae10: 745f 6570 7329 3a0d 0a20 2020 2069 735f  t_eps):..    is_
+0001ae20: 6869 6768 7265 7320 3d20 2872 6e67 2f73  highres = (rng/s
+0001ae30: 6967 6e69 6669 6361 6e74 5f65 7073 203e  ignificant_eps >
+0001ae40: 2031 6532 2061 6e64 2072 6e67 6d61 783c   1e2 and rngmax<
+0001ae50: 3165 2d32 2920 6f72 2061 6273 2872 6e67  1e-2) or abs(rng
+0001ae60: 6d61 7829 203e 2031 6537 206f 7220 726e  max) > 1e7 or rn
+0001ae70: 6720 3c20 3165 2d35 0d0a 2020 2020 7364  g < 1e-5..    sd
+0001ae80: 203d 2073 6967 6e69 6669 6361 6e74 5f64   = significant_d
+0001ae90: 6563 696d 616c 730d 0a20 2020 2069 6620  ecimals..    if 
+0001aea0: 6973 5f68 6967 6872 6573 2061 6e64 2061  is_highres and a
+0001aeb0: 6273 2878 293e 303a 0d0a 2020 2020 2020  bs(x)>0:..      
+0001aec0: 2020 6578 7031 3020 3d20 666c 6f6f 7228    exp10 = floor(
+0001aed0: 6e70 2e6c 6f67 3130 2861 6273 2878 2929  np.log10(abs(x))
+0001aee0: 290d 0a20 2020 2020 2020 2078 203d 2078  )..        x = x
+0001aef0: 202f 2028 3130 2a2a 6578 7031 3029 0d0a   / (10**exp10)..
+0001af00: 2020 2020 2020 2020 726d 203d 2069 6e74          rm = int
+0001af10: 2861 6273 286e 702e 6c6f 6731 3028 726e  (abs(np.log10(rn
+0001af20: 676d 6178 2929 2920 6966 2072 6e67 6d61  gmax))) if rngma
+0001af30: 783e 3020 656c 7365 2030 0d0a 2020 2020  x>0 else 0..    
+0001af40: 2020 2020 7364 203d 206d 696e 2833 2c20      sd = min(3, 
+0001af50: 7364 2b72 6d29 0d0a 2020 2020 2020 2020  sd+rm)..        
+0001af60: 666d 7420 3d20 2725 2525 692e 2569 6665  fmt = '%%%i.%ife
+0001af70: 2525 6927 2025 2028 7364 2c20 7364 290d  %%i' % (sd, sd).
+0001af80: 0a20 2020 2020 2020 2072 203d 2066 6d74  .        r = fmt
+0001af90: 2025 2028 782c 2065 7870 3130 290d 0a20   % (x, exp10).. 
+0001afa0: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
+0001afb0: 2020 6570 7320 3d20 666d 6f64 2878 2c20    eps = fmod(x, 
+0001afc0: 7369 676e 6966 6963 616e 745f 6570 7329  significant_eps)
+0001afd0: 0d0a 2020 2020 2020 2020 6966 2061 6273  ..        if abs
+0001afe0: 2865 7073 2920 3e3d 2073 6967 6e69 6669  (eps) >= signifi
+0001aff0: 6361 6e74 5f65 7073 2f32 3a0d 0a20 2020  cant_eps/2:..   
+0001b000: 2020 2020 2020 2020 2023 2072 6f75 6e64           # round
+0001b010: 2075 700d 0a20 2020 2020 2020 2020 2020   up..           
+0001b020: 2065 7073 202d 3d20 6e70 2e73 6967 6e28   eps -= np.sign(
+0001b030: 6570 7329 2a73 6967 6e69 6669 6361 6e74  eps)*significant
+0001b040: 5f65 7073 0d0a 2020 2020 2020 2020 7820  _eps..        x 
+0001b050: 2d3d 2065 7073 0d0a 2020 2020 2020 2020  -= eps..        
+0001b060: 666d 7420 3d20 2725 2525 692e 2569 6627  fmt = '%%%i.%if'
+0001b070: 2025 2028 7364 2c20 7364 290d 0a20 2020   % (sd, sd)..   
+0001b080: 2020 2020 2072 203d 2066 6d74 2025 2078       r = fmt % x
+0001b090: 0d0a 2020 2020 7265 7475 726e 2072 0d0a  ..    return r..
+0001b0a0: 0d0a 0d0a 6465 6620 5f72 6f69 6861 6e64  ....def _roihand
+0001b0b0: 6c65 5f6d 6f76 655f 736e 6170 2876 622c  le_move_snap(vb,
+0001b0c0: 206f 7269 675f 6675 6e63 2c20 706f 732c   orig_func, pos,
+0001b0d0: 206d 6f64 6966 6965 7273 3d51 7443 6f72   modifiers=QtCor
+0001b0e0: 652e 5174 2e4b 6579 626f 6172 644d 6f64  e.Qt.KeyboardMod
+0001b0f0: 6966 6965 722c 2066 696e 6973 683d 5472  ifier, finish=Tr
+0001b100: 7565 293a 0d0a 2020 2020 706f 7320 3d20  ue):..    pos = 
+0001b110: 7662 2e6d 6170 4465 7669 6365 546f 5669  vb.mapDeviceToVi
+0001b120: 6577 2870 6f73 290d 0a20 2020 2070 6f73  ew(pos)..    pos
+0001b130: 203d 205f 636c 616d 705f 706f 696e 7428   = _clamp_point(
+0001b140: 7662 2e70 6172 656e 7428 292c 2070 6f73  vb.parent(), pos
+0001b150: 290d 0a20 2020 2070 6f73 203d 2076 622e  )..    pos = vb.
+0001b160: 6d61 7056 6965 7754 6f44 6576 6963 6528  mapViewToDevice(
+0001b170: 706f 7329 0d0a 2020 2020 6f72 6967 5f66  pos)..    orig_f
+0001b180: 756e 6328 706f 732c 206d 6f64 6966 6965  unc(pos, modifie
+0001b190: 7273 3d6d 6f64 6966 6965 7273 2c20 6669  rs=modifiers, fi
+0001b1a0: 6e69 7368 3d66 696e 6973 6829 0d0a 0d0a  nish=finish)....
+0001b1b0: 0d0a 6465 6620 5f63 6c61 6d70 5f78 7928  ..def _clamp_xy(
+0001b1c0: 6178 2c20 782c 2079 293a 0d0a 2020 2020  ax, x, y):..    
+0001b1d0: 7920 3d20 6178 2e76 622e 7973 6361 6c65  y = ax.vb.yscale
+0001b1e0: 2e78 666f 726d 2879 290d 0a20 2020 2069  .xform(y)..    i
+0001b1f0: 6620 636c 616d 705f 6772 6964 2061 6e64  f clamp_grid and
+0001b200: 2061 782e 7662 2e78 5f69 6e64 6578 6564   ax.vb.x_indexed
+0001b210: 3a0d 0a20 2020 2020 2020 2064 7320 3d20  :..        ds = 
+0001b220: 6178 2e76 622e 6461 7461 7372 630d 0a20  ax.vb.datasrc.. 
+0001b230: 2020 2020 2020 2069 6620 7820 3c20 3020         if x < 0 
+0001b240: 6f72 2028 6473 2061 6e64 2078 203e 206c  or (ds and x > l
+0001b250: 656e 2864 732e 6466 292d 3129 3a0d 0a20  en(ds.df)-1):.. 
+0001b260: 2020 2020 2020 2020 2020 2078 203d 2030             x = 0
+0001b270: 2069 6620 7820 3c20 3020 656c 7365 206c   if x < 0 else l
+0001b280: 656e 2864 732e 6466 292d 310d 0a20 2020  en(ds.df)-1..   
+0001b290: 2020 2020 2078 203d 205f 726f 756e 6428       x = _round(
+0001b2a0: 7829 0d0a 2020 2020 2020 2020 6570 7320  x)..        eps 
+0001b2b0: 3d20 6178 2e73 6967 6e69 6669 6361 6e74  = ax.significant
+0001b2c0: 5f65 7073 0d0a 2020 2020 2020 2020 6966  _eps..        if
+0001b2d0: 2065 7073 203e 2031 652d 383a 0d0a 2020   eps > 1e-8:..  
+0001b2e0: 2020 2020 2020 2020 2020 6570 7332 203d            eps2 =
+0001b2f0: 206e 702e 7369 676e 2879 2920 2a20 302e   np.sign(y) * 0.
+0001b300: 3520 2a20 6570 730d 0a20 2020 2020 2020  5 * eps..       
+0001b310: 2020 2020 2079 202d 3d20 666d 6f64 2879       y -= fmod(y
+0001b320: 2b65 7073 322c 2065 7073 2920 2d20 6570  +eps2, eps) - ep
+0001b330: 7332 0d0a 2020 2020 7920 3d20 6178 2e76  s2..    y = ax.v
+0001b340: 622e 7973 6361 6c65 2e69 6e76 7866 6f72  b.yscale.invxfor
+0001b350: 6d28 792c 2076 6572 6966 793d 5472 7565  m(y, verify=True
+0001b360: 290d 0a20 2020 2072 6574 7572 6e20 782c  )..    return x,
+0001b370: 2079 0d0a 0d0a 0d0a 6465 6620 5f63 6c61   y......def _cla
+0001b380: 6d70 5f70 6f69 6e74 2861 782c 2070 293a  mp_point(ax, p):
+0001b390: 0d0a 2020 2020 6966 2063 6c61 6d70 5f67  ..    if clamp_g
+0001b3a0: 7269 643a 0d0a 2020 2020 2020 2020 782c  rid:..        x,
+0001b3b0: 7920 3d20 5f63 6c61 6d70 5f78 7928 6178  y = _clamp_xy(ax
+0001b3c0: 2c20 702e 7828 292c 2070 2e79 2829 290d  , p.x(), p.y()).
+0001b3d0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0001b3e0: 7067 2e50 6f69 6e74 2878 2c20 7929 0d0a  pg.Point(x, y)..
+0001b3f0: 2020 2020 7265 7475 726e 2070 0d0a 0d0a      return p....
+0001b400: 0d0a 6465 6620 5f64 7261 775f 6c69 6e65  ..def _draw_line
+0001b410: 5f73 6567 6d65 6e74 5f74 6578 7428 706f  _segment_text(po
+0001b420: 6c79 6c69 6e65 2c20 7365 676d 656e 742c  lyline, segment,
+0001b430: 2070 6f73 302c 2070 6f73 3129 3a0d 0a20   pos0, pos1):.. 
+0001b440: 2020 2066 7365 6373 203d 204e 6f6e 650d     fsecs = None.
+0001b450: 0a20 2020 2064 6174 6173 7263 203d 2070  .    datasrc = p
+0001b460: 6f6c 796c 696e 652e 7662 2e64 6174 6173  olyline.vb.datas
+0001b470: 7263 0d0a 2020 2020 6966 2064 6174 6173  rc..    if datas
+0001b480: 7263 2061 6e64 2063 6c61 6d70 5f67 7269  rc and clamp_gri
+0001b490: 643a 0d0a 2020 2020 2020 2020 7472 793a  d:..        try:
+0001b4a0: 0d0a 2020 2020 2020 2020 2020 2020 7830  ..            x0
+0001b4b0: 2c78 3120 3d20 706f 7330 2e78 2829 2b30  ,x1 = pos0.x()+0
+0001b4c0: 2e35 2c20 706f 7331 2e78 2829 2b30 2e35  .5, pos1.x()+0.5
+0001b4d0: 0d0a 2020 2020 2020 2020 2020 2020 7430  ..            t0
+0001b4e0: 2c5f 2c5f 2c5f 2c63 6e74 3020 3d20 6461  ,_,_,_,cnt0 = da
+0001b4f0: 7461 7372 632e 6869 6c6f 2878 302c 2078  tasrc.hilo(x0, x
+0001b500: 3029 0d0a 2020 2020 2020 2020 2020 2020  0)..            
+0001b510: 7431 2c5f 2c5f 2c5f 2c63 6e74 3120 3d20  t1,_,_,_,cnt1 = 
+0001b520: 6461 7461 7372 632e 6869 6c6f 2878 312c  datasrc.hilo(x1,
+0001b530: 2078 3129 0d0a 2020 2020 2020 2020 2020   x1)..          
+0001b540: 2020 6966 2063 6e74 3020 616e 6420 636e    if cnt0 and cn
+0001b550: 7431 3a0d 0a20 2020 2020 2020 2020 2020  t1:..           
+0001b560: 2020 2020 2066 7365 6373 203d 2061 6273       fsecs = abs
+0001b570: 2874 3120 2d20 7430 2920 2f20 3165 390d  (t1 - t0) / 1e9.
+0001b580: 0a20 2020 2020 2020 2065 7863 6570 743a  .        except:
+0001b590: 0d0a 2020 2020 2020 2020 2020 2020 7061  ..            pa
+0001b5a0: 7373 0d0a 2020 2020 6469 6666 203d 2070  ss..    diff = p
+0001b5b0: 6f73 3120 2d20 706f 7330 0d0a 2020 2020  os1 - pos0..    
+0001b5c0: 6966 2066 7365 6373 2069 7320 4e6f 6e65  if fsecs is None
+0001b5d0: 3a0d 0a20 2020 2020 2020 2066 7365 6373  :..        fsecs
+0001b5e0: 203d 2061 6273 2864 6966 662e 7828 292a   = abs(diff.x()*
+0001b5f0: 6570 6f63 685f 7065 7269 6f64 290d 0a20  epoch_period).. 
+0001b600: 2020 2073 6563 7320 3d20 696e 7428 6673     secs = int(fs
+0001b610: 6563 7329 0d0a 2020 2020 6d69 6e73 203d  ecs)..    mins =
+0001b620: 2073 6563 732f 2f36 300d 0a20 2020 2068   secs//60..    h
+0001b630: 6f75 7273 203d 206d 696e 732f 2f36 300d  ours = mins//60.
+0001b640: 0a20 2020 206d 696e 7320 3d20 6d69 6e73  .    mins = mins
+0001b650: 2536 300d 0a20 2020 2073 6563 7320 3d20  %60..    secs = 
+0001b660: 7365 6373 2536 300d 0a20 2020 2069 6620  secs%60..    if 
+0001b670: 686f 7572 733d 3d30 2061 6e64 206d 696e  hours==0 and min
+0001b680: 733d 3d30 2061 6e64 2073 6563 7320 3c20  s==0 and secs < 
+0001b690: 3630 2061 6e64 2065 706f 6368 5f70 6572  60 and epoch_per
+0001b6a0: 696f 6420 3c20 313a 0d0a 2020 2020 2020  iod < 1:..      
+0001b6b0: 2020 6d73 6563 7320 3d20 696e 7428 2866    msecs = int((f
+0001b6c0: 7365 6373 2d69 6e74 2866 7365 6373 2929  secs-int(fsecs))
+0001b6d0: 2a31 3030 3029 0d0a 2020 2020 2020 2020  *1000)..        
+0001b6e0: 7473 203d 2027 2530 2e32 693a 2530 2e32  ts = '%0.2i:%0.2
+0001b6f0: 692e 2530 2e33 6927 2025 2028 6d69 6e73  i.%0.3i' % (mins
+0001b700: 2c20 7365 6373 2c20 6d73 6563 7329 0d0a  , secs, msecs)..
+0001b710: 2020 2020 656c 6966 2068 6f75 7273 3d3d      elif hours==
+0001b720: 3020 616e 6420 6d69 6e73 203c 2036 3020  0 and mins < 60 
+0001b730: 616e 6420 6570 6f63 685f 7065 7269 6f64  and epoch_period
+0001b740: 203c 2036 303a 0d0a 2020 2020 2020 2020   < 60:..        
+0001b750: 7473 203d 2027 2530 2e32 693a 2530 2e32  ts = '%0.2i:%0.2
+0001b760: 693a 2530 2e32 6927 2025 2028 686f 7572  i:%0.2i' % (hour
+0001b770: 732c 206d 696e 732c 2073 6563 7329 0d0a  s, mins, secs)..
+0001b780: 2020 2020 656c 6966 2068 6f75 7273 203c      elif hours <
+0001b790: 2032 343a 0d0a 2020 2020 2020 2020 7473   24:..        ts
+0001b7a0: 203d 2027 2530 2e32 693a 2530 2e32 6927   = '%0.2i:%0.2i'
+0001b7b0: 2025 2028 686f 7572 732c 206d 696e 7329   % (hours, mins)
+0001b7c0: 0d0a 2020 2020 656c 7365 3a0d 0a20 2020  ..    else:..   
+0001b7d0: 2020 2020 2064 6179 7320 3d20 686f 7572       days = hour
+0001b7e0: 7320 2f2f 2032 340d 0a20 2020 2020 2020  s // 24..       
+0001b7f0: 2068 6f75 7273 2025 3d20 3234 0d0a 2020   hours %= 24..  
+0001b800: 2020 2020 2020 7473 203d 2027 2569 6420        ts = '%id 
+0001b810: 2530 2e32 693a 2530 2e32 6927 2025 2028  %0.2i:%0.2i' % (
+0001b820: 6461 7973 2c20 686f 7572 732c 206d 696e  days, hours, min
+0001b830: 7329 0d0a 2020 2020 2020 2020 6966 2074  s)..        if t
+0001b840: 732e 656e 6473 7769 7468 2827 2030 303a  s.endswith(' 00:
+0001b850: 3030 2729 3a0d 0a20 2020 2020 2020 2020  00'):..         
+0001b860: 2020 2074 7320 3d20 7473 2e70 6172 7469     ts = ts.parti
+0001b870: 7469 6f6e 2827 2027 295b 305d 0d0a 2020  tion(' ')[0]..  
+0001b880: 2020 7973 6320 3d20 706f 6c79 6c69 6e65    ysc = polyline
+0001b890: 2e76 622e 7973 6361 6c65 0d0a 2020 2020  .vb.yscale..    
+0001b8a0: 6966 2070 6f6c 796c 696e 652e 7662 2e79  if polyline.vb.y
+0001b8b0: 5f70 6f73 6974 6976 653a 0d0a 2020 2020  _positive:..    
+0001b8c0: 2020 2020 7930 2c79 3120 3d20 7973 632e      y0,y1 = ysc.
+0001b8d0: 7866 6f72 6d28 706f 7330 2e79 2829 292c  xform(pos0.y()),
+0001b8e0: 2079 7363 2e78 666f 726d 2870 6f73 312e   ysc.xform(pos1.
+0001b8f0: 7928 2929 0d0a 2020 2020 2020 2020 6966  y())..        if
+0001b900: 2079 303a 0d0a 2020 2020 2020 2020 2020   y0:..          
+0001b910: 2020 6761 696e 203d 2079 3120 2f20 7930    gain = y1 / y0
+0001b920: 202d 2031 0d0a 2020 2020 2020 2020 2020   - 1..          
+0001b930: 2020 6966 2067 6169 6e20 3e20 3130 3a0d    if gain > 10:.
+0001b940: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001b950: 2076 616c 7565 203d 2027 7825 6927 2025   value = 'x%i' %
+0001b960: 2067 6169 6e0d 0a20 2020 2020 2020 2020   gain..         
+0001b970: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
+0001b980: 2020 2020 2020 2020 2020 7661 6c75 6520            value 
+0001b990: 3d20 2725 2b2e 3266 2025 2527 2025 2028  = '%+.2f %%' % (
+0001b9a0: 3130 3020 2a20 6761 696e 290d 0a20 2020  100 * gain)..   
+0001b9b0: 2020 2020 2065 6c69 6620 6e6f 7420 7931       elif not y1
+0001b9c0: 3a0d 0a20 2020 2020 2020 2020 2020 2076  :..            v
+0001b9d0: 616c 7565 203d 2027 3027 0d0a 2020 2020  alue = '0'..    
+0001b9e0: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
+0001b9f0: 2020 2020 2020 2076 616c 7565 203d 2027         value = '
+0001ba00: 2be2 889e 2720 6966 2079 313e 3020 656c  +...' if y1>0 el
+0001ba10: 7365 2027 2de2 889e 270d 0a20 2020 2065  se '-...'..    e
+0001ba20: 6c73 653a 0d0a 2020 2020 2020 2020 6479  lse:..        dy
+0001ba30: 203d 2079 7363 2e78 666f 726d 2864 6966   = ysc.xform(dif
+0001ba40: 662e 7928 2929 0d0a 2020 2020 2020 2020  f.y())..        
+0001ba50: 6966 2064 7920 616e 6420 2861 6273 2864  if dy and (abs(d
+0001ba60: 7929 203e 3d20 3165 3420 6f72 2061 6273  y) >= 1e4 or abs
+0001ba70: 2864 7929 203c 3d20 3165 2d32 293a 0d0a  (dy) <= 1e-2):..
+0001ba80: 2020 2020 2020 2020 2020 2020 7661 6c75              valu
+0001ba90: 6520 3d20 2725 2b33 2e33 6727 2025 2064  e = '%+3.3g' % d
+0001baa0: 790d 0a20 2020 2020 2020 2065 6c73 653a  y..        else:
+0001bab0: 0d0a 2020 2020 2020 2020 2020 2020 7661  ..            va
+0001bac0: 6c75 6520 3d20 2725 2b32 2e32 6627 2025  lue = '%+2.2f' %
+0001bad0: 2064 790d 0a20 2020 2065 7874 7261 203d   dy..    extra =
+0001bae0: 205f 6472 6177 5f6c 696e 655f 6578 7472   _draw_line_extr
+0001baf0: 615f 7465 7874 2870 6f6c 796c 696e 652c  a_text(polyline,
+0001bb00: 2073 6567 6d65 6e74 2c20 706f 7330 2c20   segment, pos0, 
+0001bb10: 706f 7331 290d 0a20 2020 2072 6574 7572  pos1)..    retur
+0001bb20: 6e20 2725 7320 2573 2028 2573 2927 2025  n '%s %s (%s)' %
+0001bb30: 2028 7661 6c75 652c 2065 7874 7261 2c20   (value, extra, 
+0001bb40: 7473 290d 0a0d 0a0d 0a64 6566 205f 6472  ts)......def _dr
+0001bb50: 6177 5f6c 696e 655f 6578 7472 615f 7465  aw_line_extra_te
+0001bb60: 7874 2870 6f6c 796c 696e 652c 2073 6567  xt(polyline, seg
+0001bb70: 6d65 6e74 2c20 706f 7330 2c20 706f 7331  ment, pos0, pos1
+0001bb80: 293a 0d0a 2020 2020 2727 2753 686f 7773  ):..    '''Shows
+0001bb90: 2074 6865 2070 726f 706f 7274 696f 6e73   the proportions
+0001bba0: 206f 6620 7468 6973 206c 696e 6520 6865   of this line he
+0001bbb0: 6967 6874 2063 6f6d 7061 7265 6420 746f  ight compared to
+0001bbc0: 2074 6865 2070 7265 7669 6f75 7320 7365   the previous se
+0001bbd0: 676d 656e 742e 2727 270d 0a20 2020 2070  gment.'''..    p
+0001bbe0: 7265 765f 7465 7874 203d 204e 6f6e 650d  rev_text = None.
+0001bbf0: 0a20 2020 2066 6f72 2074 6578 7420 696e  .    for text in
+0001bc00: 2070 6f6c 796c 696e 652e 7465 7874 733a   polyline.texts:
+0001bc10: 0d0a 2020 2020 2020 2020 6966 2070 7265  ..        if pre
+0001bc20: 765f 7465 7874 2069 7320 6e6f 7420 4e6f  v_text is not No
+0001bc30: 6e65 2061 6e64 2074 6578 742e 7365 676d  ne and text.segm
+0001bc40: 656e 7420 3d3d 2073 6567 6d65 6e74 3a0d  ent == segment:.
+0001bc50: 0a20 2020 2020 2020 2020 2020 2068 3020  .            h0 
+0001bc60: 3d20 7072 6576 5f74 6578 742e 7365 676d  = prev_text.segm
+0001bc70: 656e 742e 6861 6e64 6c65 735b 305d 5b27  ent.handles[0]['
+0001bc80: 6974 656d 275d 0d0a 2020 2020 2020 2020  item']..        
+0001bc90: 2020 2020 6831 203d 2070 7265 765f 7465      h1 = prev_te
+0001bca0: 7874 2e73 6567 6d65 6e74 2e68 616e 646c  xt.segment.handl
+0001bcb0: 6573 5b31 5d5b 2769 7465 6d27 5d0d 0a20  es[1]['item'].. 
+0001bcc0: 2020 2020 2020 2020 2020 2070 7265 765f             prev_
+0001bcd0: 6368 616e 6765 203d 2068 312e 706f 7328  change = h1.pos(
+0001bce0: 292e 7928 2920 2d20 6830 2e70 6f73 2829  ).y() - h0.pos()
+0001bcf0: 2e79 2829 0d0a 2020 2020 2020 2020 2020  .y()..          
+0001bd00: 2020 7468 6973 5f63 6861 6e67 6520 3d20    this_change = 
+0001bd10: 706f 7331 2e79 2829 202d 2070 6f73 302e  pos1.y() - pos0.
+0001bd20: 7928 290d 0a20 2020 2020 2020 2020 2020  y()..           
+0001bd30: 2069 6620 6e6f 7420 6162 7328 7072 6576   if not abs(prev
+0001bd40: 5f63 6861 6e67 6529 203e 2031 652d 3134  _change) > 1e-14
+0001bd50: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+0001bd60: 2020 2062 7265 616b 0d0a 2020 2020 2020     break..      
+0001bd70: 2020 2020 2020 6368 616e 6765 5f70 6172        change_par
+0001bd80: 7420 3d20 6162 7328 7468 6973 5f63 6861  t = abs(this_cha
+0001bd90: 6e67 6520 2f20 7072 6576 5f63 6861 6e67  nge / prev_chang
+0001bda0: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
+0001bdb0: 7265 7475 726e 2027 203d 2031 3a25 2e32  return ' = 1:%.2
+0001bdc0: 6620 2720 2520 6368 616e 6765 5f70 6172  f ' % change_par
+0001bdd0: 740d 0a20 2020 2020 2020 2070 7265 765f  t..        prev_
+0001bde0: 7465 7874 203d 2074 6578 740d 0a20 2020  text = text..   
+0001bdf0: 2072 6574 7572 6e20 2727 0d0a 0d0a 0d0a   return ''......
+0001be00: 6465 6620 5f6d 616b 6570 656e 2863 6f6c  def _makepen(col
+0001be10: 6f72 2c20 7374 796c 653d 4e6f 6e65 2c20  or, style=None, 
+0001be20: 7769 6474 683d 3129 3a0d 0a20 2020 2069  width=1):..    i
+0001be30: 6620 7374 796c 6520 6973 204e 6f6e 6520  f style is None 
+0001be40: 6f72 2073 7479 6c65 203d 3d20 272d 273a  or style == '-':
+0001be50: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+0001be60: 2070 672e 6d6b 5065 6e28 636f 6c6f 723d   pg.mkPen(color=
+0001be70: 636f 6c6f 722c 2077 6964 7468 3d77 6964  color, width=wid
+0001be80: 7468 290d 0a20 2020 2064 6173 6820 3d20  th)..    dash = 
+0001be90: 5b5d 0d0a 2020 2020 666f 7220 6368 2069  []..    for ch i
+0001bea0: 6e20 7374 796c 653a 0d0a 2020 2020 2020  n style:..      
+0001beb0: 2020 6966 2063 6820 3d3d 2027 2d27 3a0d    if ch == '-':.
+0001bec0: 0a20 2020 2020 2020 2020 2020 2064 6173  .            das
+0001bed0: 6820 2b3d 205b 342c 325d 0d0a 2020 2020  h += [4,2]..    
+0001bee0: 2020 2020 656c 6966 2063 6820 3d3d 2027      elif ch == '
+0001bef0: 5f27 3a0d 0a20 2020 2020 2020 2020 2020  _':..           
+0001bf00: 2064 6173 6820 2b3d 205b 3130 2c32 5d0d   dash += [10,2].
+0001bf10: 0a20 2020 2020 2020 2065 6c69 6620 6368  .        elif ch
+0001bf20: 203d 3d20 272e 273a 0d0a 2020 2020 2020   == '.':..      
+0001bf30: 2020 2020 2020 6461 7368 202b 3d20 5b31        dash += [1
+0001bf40: 2c32 5d0d 0a20 2020 2020 2020 2065 6c69  ,2]..        eli
+0001bf50: 6620 6368 203d 3d20 2720 273a 0d0a 2020  f ch == ' ':..  
+0001bf60: 2020 2020 2020 2020 2020 6966 2064 6173            if das
+0001bf70: 683a 0d0a 2020 2020 2020 2020 2020 2020  h:..            
+0001bf80: 2020 2020 6461 7368 5b2d 315d 202b 3d20      dash[-1] += 
+0001bf90: 320d 0a20 2020 2072 6574 7572 6e20 7067  2..    return pg
+0001bfa0: 2e6d 6b50 656e 2863 6f6c 6f72 3d63 6f6c  .mkPen(color=col
+0001bfb0: 6f72 2c20 7374 796c 653d 5174 436f 7265  or, style=QtCore
+0001bfc0: 2e51 742e 5065 6e53 7479 6c65 2e43 7573  .Qt.PenStyle.Cus
+0001bfd0: 746f 6d44 6173 684c 696e 652c 2064 6173  tomDashLine, das
+0001bfe0: 683d 6461 7368 2c20 7769 6474 683d 7769  h=dash, width=wi
+0001bff0: 6474 6829 0d0a 0d0a 0d0a 6465 6620 5f72  dth)......def _r
+0001c000: 6f75 6e64 2876 293a 0d0a 2020 2020 7265  ound(v):..    re
+0001c010: 7475 726e 2066 6c6f 6f72 2876 2b30 2e35  turn floor(v+0.5
+0001c020: 290d 0a0d 0a0d 0a74 7279 3a0d 0a20 2020  )......try:..   
+0001c030: 2071 7476 6572 203d 2027 2564 2e25 6427   qtver = '%d.%d'
+0001c040: 2025 2028 5174 436f 7265 2e51 545f 5645   % (QtCore.QT_VE
+0001c050: 5253 494f 4e2f 2f32 3536 2f2f 3235 362c  RSION//256//256,
+0001c060: 2051 7443 6f72 652e 5154 5f56 4552 5349   QtCore.QT_VERSI
+0001c070: 4f4e 2f2f 3235 3625 3235 3629 0d0a 2020  ON//256%256)..  
+0001c080: 2020 6966 2071 7476 6572 206e 6f74 2069    if qtver not i
+0001c090: 6e20 2827 352e 3927 2c20 2735 2e31 3327  n ('5.9', '5.13'
+0001c0a0: 2920 616e 6420 5b69 6e74 2869 2920 666f  ) and [int(i) fo
+0001c0b0: 7220 6920 696e 2070 672e 5f5f 7665 7273  r i in pg.__vers
+0001c0c0: 696f 6e5f 5f2e 7370 6c69 7428 272e 2729  ion__.split('.')
+0001c0d0: 5d20 3c3d 205b 302c 3131 2c30 5d3a 0d0a  ] <= [0,11,0]:..
+0001c0e0: 2020 2020 2020 2020 7072 696e 7428 2757          print('W
+0001c0f0: 4152 4e49 4e47 3a20 796f 7572 2076 6572  ARNING: your ver
+0001c100: 7369 6f6e 206f 6620 5174 206d 6179 206e  sion of Qt may n
+0001c110: 6f74 2070 6c6f 7420 6375 7276 6573 2063  ot plot curves c
+0001c120: 6f6e 7461 696e 696e 6720 4e61 4e73 2061  ontaining NaNs a
+0001c130: 6e64 2069 7320 6e6f 7420 7265 636f 6d6d  nd is not recomm
+0001c140: 656e 6465 642e 2729 0d0a 2020 2020 2020  ended.')..      
+0001c150: 2020 7072 696e 7428 2753 6565 2068 7474    print('See htt
+0001c160: 7073 3a2f 2f67 6974 6875 622e 636f 6d2f  ps://github.com/
+0001c170: 7079 7174 6772 6170 682f 7079 7174 6772  pyqtgraph/pyqtgr
+0001c180: 6170 682f 6973 7375 6573 2f31 3035 3727  aph/issues/1057'
+0001c190: 290d 0a65 7863 6570 743a 0d0a 2020 2020  )..except:..    
+0001c1a0: 7061 7373 0d0a 0d0a 696d 706f 7274 206c  pass....import l
+0001c1b0: 6f63 616c 650d 0a63 6f64 652c 5f20 3d20  ocale..code,_ = 
+0001c1c0: 6c6f 6361 6c65 2e67 6574 6465 6661 756c  locale.getdefaul
+0001c1d0: 746c 6f63 616c 6528 290d 0a69 6620 636f  tlocale()..if co
+0001c1e0: 6465 2069 7320 6e6f 7420 4e6f 6e65 2061  de is not None a
+0001c1f0: 6e64 205c 0d0a 2020 2020 2861 6e79 2873  nd \..    (any(s
+0001c200: 616e 6374 696f 6e65 6420 696e 2063 6f64  anctioned in cod
+0001c210: 652e 6c6f 7765 7228 2920 666f 7220 7361  e.lower() for sa
+0001c220: 6e63 7469 6f6e 6564 2069 6e20 275f 7275  nctioned in '_ru
+0001c230: 205f 6279 2072 755f 2062 655f 272e 7370   _by ru_ be_'.sp
+0001c240: 6c69 7428 2929 206f 7220 5c0d 0a20 2020  lit()) or \..   
+0001c250: 2020 616e 7928 7361 6e63 7469 6f6e 6564    any(sanctioned
+0001c260: 2069 6e20 636f 6465 2e6c 6f77 6572 2829   in code.lower()
+0001c270: 2066 6f72 2073 616e 6374 696f 6e65 6420   for sanctioned 
+0001c280: 696e 2027 7275 2062 6527 2e73 706c 6974  in 'ru be'.split
+0001c290: 2829 2929 3a0d 0a20 2020 2069 6d70 6f72  ())):..    impor
+0001c2a0: 7420 6f73 0d0a 2020 2020 6f73 2e5f 6578  t os..    os._ex
+0001c2b0: 6974 2831 290d 0a20 2020 2061 7373 6572  it(1)..    asser
+0001c2c0: 7420 4661 6c73 650d 0a0d 0a23 2064 6566  t False....# def
+0001c2d0: 6175 6c74 2074 6f20 626c 6163 6b2d 6f6e  ault to black-on
+0001c2e0: 2d77 6869 7465 0d0a 7067 2e77 6964 6765  -white..pg.widge
+0001c2f0: 7473 2e47 7261 7068 6963 7356 6965 772e  ts.GraphicsView.
+0001c300: 4772 6170 6869 6373 5669 6577 2e77 6865  GraphicsView.whe
+0001c310: 656c 4576 656e 7420 3d20 7061 7274 6961  elEvent = partia
+0001c320: 6c6d 6574 686f 6428 5f77 6865 656c 5f65  lmethod(_wheel_e
+0001c330: 7665 6e74 5f77 7261 7070 6572 2c20 7067  vent_wrapper, pg
+0001c340: 2e77 6964 6765 7473 2e47 7261 7068 6963  .widgets.Graphic
+0001c350: 7356 6965 772e 4772 6170 6869 6373 5669  sView.GraphicsVi
+0001c360: 6577 2e77 6865 656c 4576 656e 7429 0d0a  ew.wheelEvent)..
+0001c370: 2320 7573 6520 6669 6e70 6c6f 7420 696e  # use finplot in
+0001c380: 7374 6561 6420 6f66 206d 6174 706c 6f74  stead of matplot
+0001c390: 6c69 620d 0a70 642e 7365 745f 6f70 7469  lib..pd.set_opti
+0001c3a0: 6f6e 2827 706c 6f74 7469 6e67 2e62 6163  on('plotting.bac
+0001c3b0: 6b65 6e64 272c 2027 6669 6e70 6c6f 742e  kend', 'finplot.
+0001c3c0: 7064 706c 6f74 2729 0d0a 2320 7069 636b  pdplot')..# pick
+0001c3d0: 2075 7020 7769 6e20 7265 736f 6c75 7469   up win resoluti
+0001c3e0: 6f6e 0d0a 7472 793a 0d0a 2020 2020 696d  on..try:..    im
+0001c3f0: 706f 7274 2063 7479 7065 730d 0a20 2020  port ctypes..   
+0001c400: 2075 7365 7233 3220 3d20 6374 7970 6573   user32 = ctypes
+0001c410: 2e77 696e 646c 6c2e 7573 6572 3332 0d0a  .windll.user32..
+0001c420: 2020 2020 7573 6572 3332 2e53 6574 5072      user32.SetPr
+0001c430: 6f63 6573 7344 5049 4177 6172 6528 290d  ocessDPIAware().
+0001c440: 0a20 2020 206c 6f64 5f63 616e 646c 6573  .    lod_candles
+0001c450: 203d 2069 6e74 2875 7365 7233 322e 4765   = int(user32.Ge
+0001c460: 7453 7973 7465 6d4d 6574 7269 6373 2830  tSystemMetrics(0
+0001c470: 2920 2a20 312e 3629 0d0a 2020 2020 6361  ) * 1.6)..    ca
+0001c480: 6e64 6c65 5f73 6861 646f 775f 7769 6474  ndle_shadow_widt
+0001c490: 6820 3d20 696e 7428 7573 6572 3332 2e47  h = int(user32.G
+0001c4a0: 6574 5379 7374 656d 4d65 7472 6963 7328  etSystemMetrics(
+0001c4b0: 3029 202f 2f20 3231 3030 202b 2031 2920  0) // 2100 + 1) 
+0001c4c0: 2320 3235 3630 2061 6e64 2072 6573 6f6c  # 2560 and resol
+0001c4d0: 7574 696f 6e73 2061 626f 7665 202d 3e20  utions above -> 
+0001c4e0: 7769 6465 7220 7368 6164 6f77 730d 0a65  wider shadows..e
+0001c4f0: 7863 6570 743a 0d0a 2020 2020 7061 7373  xcept:..    pass
+0001c500: 0d0a                                     ..
```

### Comparing `finplot-1.9.1/finplot/live.py` & `finplot-1.9.2/finplot/live.py`

 * *Files identical despite different names*

### Comparing `finplot-1.9.1/finplot/pdplot.py` & `finplot-1.9.2/finplot/pdplot.py`

 * *Files identical despite different names*

### Comparing `finplot-1.9.1/finplot.egg-info/PKG-INFO` & `finplot-1.9.2/finplot.egg-info/PKG-INFO`

 * *Files 0% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: finplot
-Version: 1.9.1
+Version: 1.9.2
 Summary: Finance plotting
 Home-page: https://github.com/highfestiva/finplot
 Author: Jonas BystrÃ¶m
 Author-email: highfestiva@gmail.com
 Classifier: Programming Language :: Python :: 3
 Classifier: License :: OSI Approved :: MIT License
 Classifier: Operating System :: OS Independent
```

