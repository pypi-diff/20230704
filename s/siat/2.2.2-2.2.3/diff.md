# Comparing `tmp/siat-2.2.2-py3-none-any.whl.zip` & `tmp/siat-2.2.3-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,8 +1,8 @@
-Zip file size: 1696218 bytes, number of entries: 120
+Zip file size: 1696563 bytes, number of entries: 120
 -rw-rw-rw-  2.0 fat      840 b- defN 23-Apr-10 11:29 siat/__init__.py
 -rw-rw-rw-  2.0 fat     2130 b- defN 23-Apr-10 11:29 siat/allin.py
 -rw-rw-rw-  2.0 fat      747 b- defN 23-Apr-10 11:29 siat/alpha_vantage_test.py
 -rw-rw-rw-  2.0 fat    28555 b- defN 23-Apr-10 11:29 siat/assets_liquidity.py
 -rw-rw-rw-  2.0 fat     1285 b- defN 23-Apr-10 11:29 siat/assets_liquidity_test.py
 -rw-rw-rw-  2.0 fat    10110 b- defN 23-Apr-10 11:29 siat/barrons_scraping_test.py
 -rw-rw-rw-  2.0 fat    36597 b- defN 23-Apr-10 11:29 siat/beta_adjustment.py
@@ -81,19 +81,19 @@
 -rw-rw-rw-  2.0 fat    75061 b- defN 23-Apr-10 11:29 siat/risk_evaluation.py
 -rw-rw-rw-  2.0 fat     3731 b- defN 23-Apr-10 11:29 siat/risk_evaluation_test.py
 -rw-rw-rw-  2.0 fat    12304 b- defN 23-Apr-10 11:29 siat/risk_free_rate.py
 -rw-rw-rw-  2.0 fat     4285 b- defN 23-Apr-10 11:29 siat/risk_free_rate_test.py
 -rw-rw-rw-  2.0 fat   101523 b- defN 23-May-27 06:22 siat/sector_china.py
 -rw-rw-rw-  2.0 fat     5843 b- defN 23-Apr-11 14:17 siat/sector_china_test.py
 -rw-rw-rw-  2.0 fat    29185 b- defN 23-May-25 02:36 siat/security_price.py
--rw-rw-rw-  2.0 fat    72866 b- defN 23-Jun-19 07:51 siat/security_prices.py
+-rw-rw-rw-  2.0 fat    73993 b- defN 23-Jul-04 08:59 siat/security_prices.py
 -rw-rw-rw-  2.0 fat    10779 b- defN 23-Apr-10 11:29 siat/security_prices_test.py
 -rw-rw-rw-  2.0 fat     1335 b- defN 23-Apr-10 11:29 siat/setup.py
 -rw-rw-rw-  2.0 fat     1418 b- defN 23-Apr-10 11:29 siat/shenwan index history test.py
--rw-rw-rw-  2.0 fat   129095 b- defN 23-Jun-30 14:58 siat/stock.py
+-rw-rw-rw-  2.0 fat   129369 b- defN 23-Jul-04 09:02 siat/stock.py
 -rw-rw-rw-  2.0 fat    31655 b- defN 23-Apr-10 11:29 siat/stock_advice_linear.py
 -rw-rw-rw-  2.0 fat     1312 b- defN 23-Apr-10 11:29 siat/stock_base.py
 -rw-rw-rw-  2.0 fat    82785 b- defN 23-Jun-17 02:52 siat/stock_china.py
 -rw-rw-rw-  2.0 fat     1294 b- defN 23-Jun-14 07:32 siat/stock_china_test.py
 -rw-rw-rw-  2.0 fat  1266744 b- defN 23-Jun-05 00:13 siat/stock_info.pickle
 -rw-rw-rw-  2.0 fat     6122 b- defN 23-Apr-10 11:29 siat/stock_info_test.py
 -rw-rw-rw-  2.0 fat     1014 b- defN 23-Apr-10 11:29 siat/stock_list_china_test.py
@@ -106,17 +106,17 @@
 -rw-rw-rw-  2.0 fat    16648 b- defN 23-Apr-18 09:06 siat/test2_graphviz.py
 -rw-rw-rw-  2.0 fat    16999 b- defN 23-Apr-14 14:38 siat/test_graphviz.py
 -rw-rw-rw-  2.0 fat    14492 b- defN 23-Apr-10 11:29 siat/transaction.py
 -rw-rw-rw-  2.0 fat    18580 b- defN 23-Apr-10 11:29 siat/transaction_test.py
 -rw-rw-rw-  2.0 fat   117953 b- defN 23-Apr-10 11:29 siat/translate-20230125.py
 -rw-rw-rw-  2.0 fat   118133 b- defN 23-Apr-10 11:29 siat/translate-20230206.py
 -rw-rw-rw-  2.0 fat   121657 b- defN 23-Apr-10 11:29 siat/translate-20230215.py
--rw-rw-rw-  2.0 fat   133928 b- defN 23-Jun-18 17:34 siat/translate.py
+-rw-rw-rw-  2.0 fat   134050 b- defN 23-Jul-04 11:47 siat/translate.py
 -rw-rw-rw-  2.0 fat     3936 b- defN 23-Apr-10 11:29 siat/universal_test.py
 -rw-rw-rw-  2.0 fat    51342 b- defN 23-May-11 00:30 siat/valuation_china.py
 -rw-rw-rw-  2.0 fat     1571 b- defN 23-Apr-10 11:29 siat/valuation_market_china_test.py
 -rw-rw-rw-  2.0 fat    14859 b- defN 23-Apr-10 11:29 siat/var_model_validation.py
--rw-rw-rw-  2.0 fat     1410 b- defN 23-Jun-30 15:09 siat-2.2.2.dist-info/METADATA
--rw-rw-rw-  2.0 fat       92 b- defN 23-Jun-30 15:09 siat-2.2.2.dist-info/WHEEL
--rw-rw-rw-  2.0 fat        5 b- defN 23-Jun-30 15:09 siat-2.2.2.dist-info/top_level.txt
-?rw-rw-r--  2.0 fat     9602 b- defN 23-Jun-30 15:09 siat-2.2.2.dist-info/RECORD
-120 files, 7749942 bytes uncompressed, 1681578 bytes compressed:  78.3%
+-rw-rw-rw-  2.0 fat     1410 b- defN 23-Jul-04 14:04 siat-2.2.3.dist-info/METADATA
+-rw-rw-rw-  2.0 fat       92 b- defN 23-Jul-04 14:04 siat-2.2.3.dist-info/WHEEL
+-rw-rw-rw-  2.0 fat        5 b- defN 23-Jul-04 14:04 siat-2.2.3.dist-info/top_level.txt
+?rw-rw-r--  2.0 fat     9602 b- defN 23-Jul-04 14:04 siat-2.2.3.dist-info/RECORD
+120 files, 7751465 bytes uncompressed, 1681923 bytes compressed:  78.3%
```

## zipnote {}

```diff
@@ -342,20 +342,20 @@
 
 Filename: siat/valuation_market_china_test.py
 Comment: 
 
 Filename: siat/var_model_validation.py
 Comment: 
 
-Filename: siat-2.2.2.dist-info/METADATA
+Filename: siat-2.2.3.dist-info/METADATA
 Comment: 
 
-Filename: siat-2.2.2.dist-info/WHEEL
+Filename: siat-2.2.3.dist-info/WHEEL
 Comment: 
 
-Filename: siat-2.2.2.dist-info/top_level.txt
+Filename: siat-2.2.3.dist-info/top_level.txt
 Comment: 
 
-Filename: siat-2.2.2.dist-info/RECORD
+Filename: siat-2.2.3.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## siat/security_prices.py

```diff
@@ -19,15 +19,17 @@
 #==============================================================================
 #==============================================================================
 def get_price(ticker,fromdate,todate,adj=False):
     """
     套壳函数get_prices，为保持兼容
     """
     df=get_prices(ticker,fromdate,todate,adj=adj)
-    return df
+    
+    df2=remove_timezone(df)
+    return df2
 #==============================================================================
 if __name__=='__main__':
     ticker='AAPL'
     fromdate='2011-1-1'
     todate='2020-12-31'
     retry_count=3
     pause=1
@@ -120,15 +122,16 @@
             print("  #Warning(get_prices): info not found from sina/EM for",ticker)
         else:
             num=len(prices)
             if num==0:
                 print("  #Warning(get_prices): zero record found in sina/EM for",ticker)
             else:
                 #print("  Successfully retrieved",num,"records for",ticker)
-                return prices        
+                prices2=remove_timezone(prices)
+                return prices2        
 
     #尝试pandas_datareader+stooq（对美股、港股、欧股、国外市场指数有效，但对深交所股票无效）
     #注意stooq代码与新浪/stooq的不同
     print("  Trying to capture info from stooq for",ticker)
     try:
         prices=get_price_stooq(ticker,fromdate,todate)
     except:
@@ -139,15 +142,16 @@
             print("  #Warning(get_prices): info not found from stooq for",ticker)
         else:
             num=len(prices)
             if num==0:
                 print("  #Warning(get_prices): zero record found for",ticker)
             else:
                 #print("  Successfully retrieved",num,"records for",ticker)
-                return prices        
+                prices2=remove_timezone(prices)
+                return prices2        
     
     #使用yahoo+yfinance抓取数据                
     #由于雅虎无法访问，建议暂时关闭，2021-10-24
     #抓取证券（列表）价格，需要调整收盘价：yfinance优先，线程极易出错，先尝试关闭线程
     try:
         print("  Trying to capture info from Yahoo Finance using non-threads for",ticker)
         prices=get_prices_yf(ticker,start,end,threads=False)
@@ -158,15 +162,16 @@
             print("  #Warning(get_prices): info not found using non-threads failed from yahoo for",ticker)
         else:
             num=len(prices)
             if num==0:
                 print("  #Warning(get_prices): zero record found for",ticker)
             else:
                 #print("  Successfully retrieved",num,"records for",ticker)
-                return prices        
+                prices2=remove_timezone(prices)
+                return prices2        
 
     #抓取证券（列表）价格，需要调整收盘价：yfinance优先，尝试打开线程
     try:
         print("  Trying to capture info from Yahoo Finance using threads for",ticker)
         prices=get_prices_yf(ticker,start,end,threads=True)
     except:
         print("  #Warning(get_prices): retrieving using threads failed from yahoo for",ticker)
@@ -175,15 +180,16 @@
             print("  #Warning(get_prices): info not found using non-threads failed from yahoo for",ticker)
         else:
             num=len(prices)
             if num==0:
                 print("  #Warning(get_prices): zero record found for",ticker)
             else:
                 #print("  Successfully retrieved",num,"records for",ticker)
-                return prices        
+                prices2=remove_timezone(prices)
+                return prices2        
     
     #抓取证券（列表）价格，不考虑是否需要调整收盘价：pandas_datareader
     #由于雅虎财经当前无法访问，建议本段停用
     #由于雅虎无法访问，暂时关闭，2021-10-24
     try:    
         print("  Trying to capture info from Yahoo Finance in traditional process for",ticker)
         prices=get_prices_yahoo(ticker,start,end,retry_count=retry_count,pause=pause)
@@ -195,15 +201,16 @@
             print("  #Warning(get_prices): info not found  from Yahoo Finance in traditional process for",ticker)
         else:
             num=len(prices)
             if num==0:
                 print("  #Warning(get_prices): zero record found for",ticker)
             else:
                 #print("  Successfully retrieved",num,"records for",ticker)
-                return prices        
+                prices2=remove_timezone(prices)
+                return prices2        
     
     #若能够抓取到数据均已提前返回，到达此处时表面未能抓取到任何数据
     print("  #Warning(get_prices): tried everyting but nothing found for",ticker)
     return None
     
     
 
@@ -212,14 +219,40 @@
     get_prices('BMW.DE','2021-11-1','2021-11-5')
     get_prices(['INTC'],'2021-11-1','2021-11-5')
     get_prices(['XYZ'],'2021-11-1','2021-11-5')
     df4=get_prices(['INTC','MSFT'],'2021-11-1','2021-11-5')
     df5=get_prices(['INTC','UVW'],'2021-11-1','2021-11-5')
     df6=get_prices(['00988.HK','000858.SZ'],'2021-11-1','2021-11-5')
     df7=get_prices(['INTL','MSFT','00988.HK','000858.SZ'],'2021-11-1','2021-11-5')
+
+#==============================================================================
+if __name__ =="__main__":
+    ticker="BMW.DE"
+    fromdate="2023-1-1"
+    todate="2023-5-20"
+    pricedf=get_prices(ticker,fromdate,todate)
+    
+    pricedf2=remove_timezone(pricedf)
+
+def remove_timezone(pricedf):
+    """
+    功能：去掉df索引中可能存在的时区信息，避免时区错误
+    """
+    pricedf['date_tz']=pricedf.index
+    pricedf['date_y4m2d2']=pricedf['date_tz'].astype(str)
+    
+    import pandas as pd
+    pricedf['Date']=pricedf['date_y4m2d2'].apply(lambda x: pd.to_datetime(x))
+    pricedf['Date']=pricedf['Date'].apply(lambda x: x.replace(tzinfo=None))   #去掉时区
+
+    pricedf2=pricedf.set_index('Date')
+    pricedf2.drop(['date_tz','date_y4m2d2'],axis=1,inplace=True)
+    
+    return pricedf2
+
     
 #==============================================================================
 if __name__=='__main__':
     ticker='430047.BJ'
     ticker='600519.SS'
     ticker='000001.SZ'
     fromdate='2022-11-1'
```

## siat/stock.py

```diff
@@ -457,18 +457,18 @@
     if not (df is None):
         tickername=codetranslate(ticker)
 
         import datetime; today = datetime.date.today()
         lang=check_language()
         if lang == 'English':
             titletxt=texttranslate("Security Price Trend：")+tickername
-            footnote=texttranslate("Source: sina/stooq，")+str(today)
+            footnote=texttranslate("Source: sina/stooq/yahoo，")+str(today)
         else:
             titletxt=texttranslate("证券价格走势图：")+tickername
-            footnote=texttranslate("数据来源：新浪/东方财富/stooq，")+str(today)
+            footnote=texttranslate("数据来源：新浪/东方财富/stooq/yahoo，")+str(today)
         
         pricetype='Close'
         import pandas as pd
         df1=pd.DataFrame(df[pricetype])
         df1.dropna(inplace=True)
         
         collabel=ectranslate(pricetype)
@@ -663,15 +663,16 @@
     retinfo=stock_ret("000002.SZ","2020-1-1","2020-3-16","Quarterly Ret%",power=4)
     retinfo=stock_ret("000002.SZ","2019-1-1","2020-3-16","Annual Ret%",power=4)
     retinfo=stock_ret("000002.SZ","2019-1-1","2020-3-16","Cum Ret%",power=4)
 
 #==============================================================
 if __name__ =="__main__":
     ticker='600519.SS'
-    measures=['Daily Ret%','Weekly Ret%','Monthly Ret%','Quarterly Ret%','Annual Ret%','XYZ']
+    ticker='OR.PA'
+    measures=['Monthly Ret%','Quarterly Ret%','Annual Ret%','XYZ']
     fromdate='2023-1-1'
     todate='2023-6-25'
     graph=True
     smooth=False
     loc='best'
     annotate=False
 
@@ -690,15 +691,21 @@
         measures=[measures]
     
     try:
         pricedf=get_price(ticker,fromdate1,todate)
     except:
         print("  #Error(security_mindicators): price info not found for",ticker)
         return None
-    
+    if pricedf is None:
+        print("  #Error(security_mindicators): none of price info found for",ticker)
+        return None
+    if len(pricedf) ==0:
+        print("  #Warning(security_mindicators): price info unavailable for",ticker)
+        return None
+        
     df=all_calculate(pricedf,ticker,fromdate,todate)
 
     # 检查指标是否存在
     colList=list(df)
     for c in measures:
         if not (c in colList):
             print("  #Warning(security_mindicators): unsupported security measure",c)
```

## siat/translate.py

```diff
@@ -892,19 +892,19 @@
         ['00992.HK','港股联想'],['LENOVO GROUP','联想集团'],
         ['01810.HK','港股小米'],
         ['01166.HK','港股星凯控股'],['00273.HK','港股茂宸集团'],
 
         ['2330.TW','台积电'],['2317.TW','鸿海精密'],['2474.TW','可成科技'],
         ['3008.TW','大立光'],['2454.TW','联发科'],  
         
-        ['6758.T','日股索尼'],
+        ['6758.T','日本索尼'],['6758.JP','日本索尼'],['7203.JP','日本丰田汽车'],
         
         ['005930.KS','三星电子'],
         
-        ['TCS.NS','印度塔塔咨询'],
+        ['TCS.NS','印度塔塔咨询'],['ULVR.UK','英国联合利华'],['LOR.DE','法国欧莱雅'],
         
         #股票：指数==============================================================
         ['000300.SS','沪深300指数'],['399300.SS','沪深300指数'],
         ['000001.SS','上证综合指数'],['399001.SZ','深证成份指数'],
         ['000016.SS','上证50指数'],['000132.SS','上证100指数'],
         ['000133.SS','上证150指数'],['000010.SS','上证180指数'],
         ['000688.SS','科创板50指数'],['000043.SS','上证超大盘指数'],
```

## Comparing `siat-2.2.2.dist-info/METADATA` & `siat-2.2.3.dist-info/METADATA`

 * *Files 8% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: siat
-Version: 2.2.2
+Version: 2.2.3
 Summary: Securities Investment Analysis Tools (siat)
 Home-page: https://pypi.org/project/siat/
 Author: Prof. WANG Dehong, Business School, BFSU (北京外国语大学 国际商学院 王德宏 教授)
 Author-email: wdehong2000@163.com
 License: Copyright (C) WANG Dehong, 2023. For educational purpose only!
 Platform: UNKNOWN
 Requires-Dist: pandas-datareader
```

## Comparing `siat-2.2.2.dist-info/RECORD` & `siat-2.2.3.dist-info/RECORD`

 * *Files 4% similar despite different names*

```diff
@@ -80,19 +80,19 @@
 siat/risk_evaluation.py,sha256=lCDqCaSEppH0MFPFg-P14IYcF3IJqILbPfDmzf_AfcY,75061
 siat/risk_evaluation_test.py,sha256=YEXM96gKzTfwN4U61AS4Rr1tV7KgUvn4rRC6f3iMw9s,3731
 siat/risk_free_rate.py,sha256=r62zCl1qbI4lJU17GsgM-OmVx9oo3dltXeZVCNd6Uxg,12304
 siat/risk_free_rate_test.py,sha256=CpmhUf8aEAEZeNu4gvWP2Mz2dLoIgBX5bI41vfUBEr8,4285
 siat/sector_china.py,sha256=sHd7nlYWCK0SWAZbu-BLn-3vNPe2E8OFaDFYF67Hoho,101523
 siat/sector_china_test.py,sha256=1wq7ef8Bb_L8F0h0W6FvyBrIcBTEbrTV7hljtpj49U4,5843
 siat/security_price.py,sha256=2oHskgiw41KMGfqtnA0i2YjNNV6cYgtlUK0j3YeuXWs,29185
-siat/security_prices.py,sha256=aqAG7vuGMX6sXkNDyJN0uCU2G6b4lmM9Hq-wQbi-5dA,72866
+siat/security_prices.py,sha256=deAFBV4EtTfTrrm4rFNyPqGgkEbBQnmzqhruqwfmuGM,73993
 siat/security_prices_test.py,sha256=OEphoJ87NPKoNow1QA8EU_5MUYrJF-qKoWKNapVfZNI,10779
 siat/setup.py,sha256=up65rQGLmTBkhtaMLowjoQXYmIsnycnm4g1SYmeQS6o,1335
 siat/shenwan index history test.py,sha256=JCVAzOSEldHalhSFa3pqD8JI_8_djPMQOxpkuYU-Esg,1418
-siat/stock.py,sha256=NMLW7Fpnnq5BAG2eAZWFYJXWyv9gsGIpuWQvGA0akUI,129095
+siat/stock.py,sha256=WaRjLIXpjPl3VoUQ0AWvdtCCHKVP8RNm0ZPtUqOWaYo,129369
 siat/stock_advice_linear.py,sha256=-twT7IGP-NEplkL1WPSACcNJjggRB2j4mlAQCkzOAuo,31655
 siat/stock_base.py,sha256=uISvbRyOGy8p9QREA96CVydgflBkn5L3OXOGKl8oanc,1312
 siat/stock_china.py,sha256=jVSuCWr6TaTx0Y0sgqN-dU9ZL72uKiI_MzvugvH9NaI,82785
 siat/stock_china_test.py,sha256=eO4HWsSvc6qezl0LndjtL24lViEyrBjH_sx2c2Y2Q2M,1294
 siat/stock_info.pickle,sha256=o4M-pcN8Sh8QiwZQAZWY1aelI4xgIGIxors7n2uHSJI,1266744
 siat/stock_info_test.py,sha256=gfG3DbhDACbtD8wnv_R6zhj0t11XaC8NX8uLD9Qv3Fo,6122
 siat/stock_list_china_test.py,sha256=gv14UwMMvkZqtb6G7DCTSuehIwVHuVwu7w60p6gyHoo,1014
@@ -105,16 +105,16 @@
 siat/test2_graphviz.py,sha256=05w2YJuIBH0LsJjdA60EFn7rL0vCo-CA6EVJEQOXNE4,16648
 siat/test_graphviz.py,sha256=CETKpDL8PnysS-PD3fHkeAgagUxjaUl0CsXPiadQySg,16999
 siat/transaction.py,sha256=foTWS1qYXQFuzNTG2m7ec6aDgsJjzpKmyAbyxKcE8KU,14492
 siat/transaction_test.py,sha256=Z8g1LJCN4-mnUByXMUMoFmN0t105cbmsz2QmvSuIkbU,18580
 siat/translate-20230125.py,sha256=NPPSXhT38s5t9fzMvl_fvi4ckSB73ThLmZetVI-xGdU,117953
 siat/translate-20230206.py,sha256=-vtI125WyaJhmPotOpDAmclt_XnYVaWU9ByLWZ6FyYE,118133
 siat/translate-20230215.py,sha256=TJgtPE3n8IjljmZ4Pefy8dmHoNdFF-1zpML6BhA9FKE,121657
-siat/translate.py,sha256=nS9gqygAkb-2M2utEjucdw-5kWe7hCrDW1OqX3sed7E,133928
+siat/translate.py,sha256=pFi_U1_LLzcq6rE9ns0Hr0fLYjzB_n2sGLapdbLlVxw,134050
 siat/universal_test.py,sha256=CDAOffW1Rvs-TcNN5giWVvHMlch1w4dp-w5SIV9jXL0,3936
 siat/valuation_china.py,sha256=gYYXeT9bBPyQ251TCsYlibWcu6JA8x-YOKqLUEeLE7U,51342
 siat/valuation_market_china_test.py,sha256=gbJ0ioauuo4koTPH6WKUkqcXiQPafnbhU5eKJ6lpdLA,1571
 siat/var_model_validation.py,sha256=zB_Skk_tmzIR15l6oAW3am4HBGVIG-eZ8gJhCdXZ8Qw,14859
-siat-2.2.2.dist-info/METADATA,sha256=wF7efYmM0jIGjmAZJxgvbXgv9eeVxIYxvCWvZ9dTbAM,1410
-siat-2.2.2.dist-info/WHEEL,sha256=ewwEueio1C2XeHTvT17n8dZUJgOvyCWCt0WVNLClP9o,92
-siat-2.2.2.dist-info/top_level.txt,sha256=r1cVyL7AIKqeAmEJjNR8FMT20OmEzufDstC2gv3NvEY,5
-siat-2.2.2.dist-info/RECORD,,
+siat-2.2.3.dist-info/METADATA,sha256=MYB5sYcRsgbN_zRIcF9jWLSvjgYBOnpv6Lp3QLboLrI,1410
+siat-2.2.3.dist-info/WHEEL,sha256=ewwEueio1C2XeHTvT17n8dZUJgOvyCWCt0WVNLClP9o,92
+siat-2.2.3.dist-info/top_level.txt,sha256=r1cVyL7AIKqeAmEJjNR8FMT20OmEzufDstC2gv3NvEY,5
+siat-2.2.3.dist-info/RECORD,,
```

