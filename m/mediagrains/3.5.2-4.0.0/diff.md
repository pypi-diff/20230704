# Comparing `tmp/mediagrains-3.5.2.tar.gz` & `tmp/mediagrains-4.0.0.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "mediagrains-3.5.2.tar", last modified: Wed Jun 21 07:45:54 2023, max compression
+gzip compressed data, was "mediagrains-4.0.0.tar", last modified: Tue Jul  4 13:47:17 2023, max compression
```

## Comparing `mediagrains-3.5.2.tar` & `mediagrains-4.0.0.tar`

### file list

```diff
@@ -1,126 +1,111 @@
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-06-21 07:45:54.918506 mediagrains-3.5.2/
--rw-r--r--   0 root         (0) root         (0)      573 2023-03-04 06:59:09.000000 mediagrains-3.5.2/COPYING
--rw-r--r--   0 root         (0) root         (0)     6607 2023-03-04 06:59:09.000000 mediagrains-3.5.2/ICLA.md
--rw-r--r--   0 root         (0) root         (0)    11362 2023-03-04 06:59:09.000000 mediagrains-3.5.2/LICENSE.md
--rw-r--r--   0 root         (0) root         (0)      147 2023-03-04 06:59:09.000000 mediagrains-3.5.2/MANIFEST.in
--rw-r--r--   0 root         (0) root         (0)      358 2023-06-21 07:45:54.918506 mediagrains-3.5.2/PKG-INFO
--rw-r--r--   0 root         (0) root         (0)    10377 2023-03-29 08:10:32.000000 mediagrains-3.5.2/README.md
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-06-21 07:45:54.906506 mediagrains-3.5.2/examples/
--rw-r--r--   0 root         (0) root         (0)    62845 2023-03-04 06:59:09.000000 mediagrains-3.5.2/examples/audio.gsf
--rw-r--r--   0 root         (0) root         (0)     8295 2023-03-04 06:59:09.000000 mediagrains-3.5.2/examples/coded_audio.gsf
--rw-r--r--   0 root         (0) root         (0)    68457 2023-03-04 06:59:09.000000 mediagrains-3.5.2/examples/coded_video.gsf
--rw-r--r--   0 root         (0) root         (0)    37610 2023-03-04 06:59:09.000000 mediagrains-3.5.2/examples/event.gsf
--rw-r--r--   0 root         (0) root         (0) 25011059 2023-03-04 06:59:09.000000 mediagrains-3.5.2/examples/interleaved.gsf
--rw-r--r--   0 root         (0) root         (0)  1946205 2023-03-04 06:59:09.000000 mediagrains-3.5.2/examples/video.gsf
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-06-21 07:45:54.910507 mediagrains-3.5.2/mediagrains/
--rw-r--r--   0 root         (0) root         (0)     1904 2023-03-04 06:59:09.000000 mediagrains-3.5.2/mediagrains/__init__.py
--rw-r--r--   0 root         (0) root         (0)      100 2023-06-21 07:41:41.000000 mediagrains-3.5.2/mediagrains/_version.py
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-06-21 07:45:54.910507 mediagrains-3.5.2/mediagrains/asyncio/
--rw-r--r--   0 root         (0) root         (0)    29394 2023-03-04 06:59:09.000000 mediagrains-3.5.2/mediagrains/asyncio/__init__.py
--rw-r--r--   0 root         (0) root         (0)     4464 2023-03-04 06:59:09.000000 mediagrains-3.5.2/mediagrains/asyncio/aiobytes.py
--rw-r--r--   0 root         (0) root         (0)     2168 2023-03-04 06:59:09.000000 mediagrains-3.5.2/mediagrains/asyncio/bytesaio.py
--rw-r--r--   0 root         (0) root         (0)        0 2023-03-04 06:59:09.000000 mediagrains-3.5.2/mediagrains/asyncio/py.typed
--rw-r--r--   0 root         (0) root         (0)     5644 2023-03-04 06:59:09.000000 mediagrains-3.5.2/mediagrains/cogenums.py
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-06-21 07:45:54.910507 mediagrains-3.5.2/mediagrains/comparison/
--rw-r--r--   0 root         (0) root         (0)     2321 2023-03-04 06:59:09.000000 mediagrains-3.5.2/mediagrains/comparison/__init__.py
--rw-r--r--   0 root         (0) root         (0)     1435 2023-03-04 06:59:09.000000 mediagrains-3.5.2/mediagrains/comparison/__main__.py
--rw-r--r--   0 root         (0) root         (0)    41713 2023-03-04 06:59:09.000000 mediagrains-3.5.2/mediagrains/comparison/_internal.py
--rw-r--r--   0 root         (0) root         (0)     8221 2023-03-04 06:59:09.000000 mediagrains-3.5.2/mediagrains/comparison/options.py
--rw-r--r--   0 root         (0) root         (0)     5679 2023-03-04 06:59:09.000000 mediagrains-3.5.2/mediagrains/comparison/psnr.py
--rw-r--r--   0 root         (0) root         (0)        0 2023-03-04 06:59:09.000000 mediagrains-3.5.2/mediagrains/comparison/py.typed
--rw-r--r--   0 root         (0) root         (0)     1432 2023-03-04 06:59:09.000000 mediagrains-3.5.2/mediagrains/grain.py
--rw-r--r--   0 root         (0) root         (0)    31876 2023-03-04 06:59:09.000000 mediagrains-3.5.2/mediagrains/grain_constructors.py
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-06-21 07:45:54.910507 mediagrains-3.5.2/mediagrains/grains/
--rw-r--r--   0 root         (0) root         (0)     8158 2023-03-04 06:59:09.000000 mediagrains-3.5.2/mediagrains/grains/AudioGrain.py
--rw-r--r--   0 root         (0) root         (0)     8807 2023-03-04 06:59:09.000000 mediagrains-3.5.2/mediagrains/grains/CodedAudioGrain.py
--rw-r--r--   0 root         (0) root         (0)    16187 2023-03-04 06:59:09.000000 mediagrains-3.5.2/mediagrains/grains/CodedVideoGrain.py
--rw-r--r--   0 root         (0) root         (0)    11074 2023-03-04 06:59:09.000000 mediagrains-3.5.2/mediagrains/grains/EventGrain.py
--rw-r--r--   0 root         (0) root         (0)    27612 2023-03-04 06:59:09.000000 mediagrains-3.5.2/mediagrains/grains/Grain.py
--rw-r--r--   0 root         (0) root         (0)    19821 2023-03-04 06:59:09.000000 mediagrains-3.5.2/mediagrains/grains/VideoGrain.py
--rw-r--r--   0 root         (0) root         (0)      986 2023-03-04 06:59:09.000000 mediagrains-3.5.2/mediagrains/grains/__init__.py
--rw-r--r--   0 root         (0) root         (0)   100481 2023-03-04 06:59:09.000000 mediagrains-3.5.2/mediagrains/gsf.py
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-06-21 07:45:54.910507 mediagrains-3.5.2/mediagrains/hypothesis/
--rw-r--r--   0 root         (0) root         (0)        0 2023-03-04 06:59:09.000000 mediagrains-3.5.2/mediagrains/hypothesis/__init__.py
--rw-r--r--   0 root         (0) root         (0)        0 2023-03-04 06:59:09.000000 mediagrains-3.5.2/mediagrains/hypothesis/py.typed
--rw-r--r--   0 root         (0) root         (0)    35973 2023-03-04 06:59:09.000000 mediagrains-3.5.2/mediagrains/hypothesis/strategies.py
--rw-r--r--   0 root         (0) root         (0)    35626 2023-03-04 06:59:09.000000 mediagrains-3.5.2/mediagrains/hypothesis/strategies_new.py
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-06-21 07:45:54.914507 mediagrains-3.5.2/mediagrains/numpy/
--rw-r--r--   0 root         (0) root         (0)      856 2023-03-04 06:59:09.000000 mediagrains-3.5.2/mediagrains/numpy/__init__.py
--rw-r--r--   0 root         (0) root         (0)     3518 2023-03-04 06:59:09.000000 mediagrains-3.5.2/mediagrains/numpy/audiograin.py
--rw-r--r--   0 root         (0) root         (0)    21764 2023-06-21 07:39:31.000000 mediagrains-3.5.2/mediagrains/numpy/convert.py
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-06-21 07:45:54.914507 mediagrains-3.5.2/mediagrains/numpy/numpy_grains/
--rw-r--r--   0 root         (0) root         (0)     8748 2023-03-04 06:59:09.000000 mediagrains-3.5.2/mediagrains/numpy/numpy_grains/AudioGrain.py
--rw-r--r--   0 root         (0) root         (0)    18775 2023-03-04 06:59:09.000000 mediagrains-3.5.2/mediagrains/numpy/numpy_grains/VideoGrain.py
--rw-r--r--   0 root         (0) root         (0)      110 2023-03-04 06:59:09.000000 mediagrains-3.5.2/mediagrains/numpy/numpy_grains/__init__.py
--rw-r--r--   0 root         (0) root         (0)        0 2023-03-04 06:59:09.000000 mediagrains-3.5.2/mediagrains/numpy/py.typed
--rw-r--r--   0 root         (0) root         (0)     3518 2023-03-04 06:59:09.000000 mediagrains-3.5.2/mediagrains/numpy/videograin.py
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-06-21 07:45:54.914507 mediagrains-3.5.2/mediagrains/patterngenerators/
--rw-r--r--   0 root         (0) root         (0)      968 2023-03-04 06:59:09.000000 mediagrains-3.5.2/mediagrains/patterngenerators/__init__.py
--rw-r--r--   0 root         (0) root         (0)     4538 2023-03-04 06:59:09.000000 mediagrains-3.5.2/mediagrains/patterngenerators/abc.py
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-06-21 07:45:54.914507 mediagrains-3.5.2/mediagrains/patterngenerators/audio/
--rw-r--r--   0 root         (0) root         (0)      747 2023-03-04 06:59:09.000000 mediagrains-3.5.2/mediagrains/patterngenerators/audio/__init__.py
--rw-r--r--   0 root         (0) root         (0)     1905 2023-03-04 06:59:09.000000 mediagrains-3.5.2/mediagrains/patterngenerators/audio/abc.py
--rw-r--r--   0 root         (0) root         (0)        0 2023-03-04 06:59:09.000000 mediagrains-3.5.2/mediagrains/patterngenerators/audio/py.typed
--rw-r--r--   0 root         (0) root         (0)     8613 2023-03-04 06:59:09.000000 mediagrains-3.5.2/mediagrains/patterngenerators/audio/tone.py
--rw-r--r--   0 root         (0) root         (0)        0 2023-03-04 06:59:09.000000 mediagrains-3.5.2/mediagrains/patterngenerators/py.typed
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-06-21 07:45:54.914507 mediagrains-3.5.2/mediagrains/patterngenerators/video/
--rw-r--r--   0 root         (0) root         (0)      905 2023-03-04 06:59:09.000000 mediagrains-3.5.2/mediagrains/patterngenerators/video/__init__.py
--rw-r--r--   0 root         (0) root         (0)     1626 2023-03-04 06:59:09.000000 mediagrains-3.5.2/mediagrains/patterngenerators/video/abc.py
--rw-r--r--   0 root         (0) root         (0)     3126 2023-03-04 06:59:09.000000 mediagrains-3.5.2/mediagrains/patterngenerators/video/colourbars.py
--rw-r--r--   0 root         (0) root         (0)     1839 2023-03-04 06:59:09.000000 mediagrains-3.5.2/mediagrains/patterngenerators/video/constants.py
--rw-r--r--   0 root         (0) root         (0)     3275 2023-03-04 06:59:09.000000 mediagrains-3.5.2/mediagrains/patterngenerators/video/lumasteps.py
--rw-r--r--   0 root         (0) root         (0)     4772 2023-03-04 06:59:09.000000 mediagrains-3.5.2/mediagrains/patterngenerators/video/movingbaroverlay.py
--rw-r--r--   0 root         (0) root         (0)        0 2023-03-04 06:59:09.000000 mediagrains-3.5.2/mediagrains/patterngenerators/video/py.typed
--rw-r--r--   0 root         (0) root         (0)     1639 2023-03-04 06:59:09.000000 mediagrains-3.5.2/mediagrains/patterngenerators/video/still.py
--rw-r--r--   0 root         (0) root         (0)        0 2023-03-04 06:59:09.000000 mediagrains-3.5.2/mediagrains/py.typed
--rw-r--r--   0 root         (0) root         (0)    15613 2023-03-04 06:59:09.000000 mediagrains-3.5.2/mediagrains/testsignalgenerator.py
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-06-21 07:45:54.914507 mediagrains-3.5.2/mediagrains/tools/
--rw-r--r--   0 root         (0) root         (0)      866 2023-03-04 06:59:09.000000 mediagrains-3.5.2/mediagrains/tools/__init__.py
--rw-r--r--   0 root         (0) root         (0)     2463 2023-03-04 06:59:09.000000 mediagrains-3.5.2/mediagrains/tools/_file_or_pipe.py
--rw-r--r--   0 root         (0) root         (0)     3706 2023-03-04 06:59:09.000000 mediagrains-3.5.2/mediagrains/tools/extract_from_gsf.py
--rw-r--r--   0 root         (0) root         (0)        0 2023-03-04 06:59:09.000000 mediagrains-3.5.2/mediagrains/tools/py.typed
--rw-r--r--   0 root         (0) root         (0)     7917 2023-03-04 06:59:09.000000 mediagrains-3.5.2/mediagrains/tools/wrap_in_gsf.py
--rw-r--r--   0 root         (0) root         (0)     8857 2023-03-04 06:59:09.000000 mediagrains-3.5.2/mediagrains/typing.py
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-06-21 07:45:54.918506 mediagrains-3.5.2/mediagrains/utils/
--rw-r--r--   0 root         (0) root         (0)      855 2023-03-04 06:59:09.000000 mediagrains-3.5.2/mediagrains/utils/__init__.py
--rw-r--r--   0 root         (0) root         (0)     4375 2023-03-04 06:59:09.000000 mediagrains-3.5.2/mediagrains/utils/adts_aac_grain_wrapper.py
--rw-r--r--   0 root         (0) root         (0)     2685 2023-03-04 06:59:09.000000 mediagrains-3.5.2/mediagrains/utils/adts_aac_parser.py
--rw-r--r--   0 root         (0) root         (0)    12975 2023-03-04 06:59:09.000000 mediagrains-3.5.2/mediagrains/utils/asyncbinaryio.py
--rw-r--r--   0 root         (0) root         (0)     2416 2023-03-04 06:59:09.000000 mediagrains-3.5.2/mediagrains/utils/grain_wrapper.py
--rw-r--r--   0 root         (0) root         (0)     7023 2023-03-04 06:59:09.000000 mediagrains-3.5.2/mediagrains/utils/h264_grain_wrapper.py
--rw-r--r--   0 root         (0) root         (0)    31542 2023-05-09 10:01:31.000000 mediagrains-3.5.2/mediagrains/utils/h264_parser.py
--rw-r--r--   0 root         (0) root         (0)     6642 2023-03-04 06:59:09.000000 mediagrains-3.5.2/mediagrains/utils/iobytes.py
--rw-r--r--   0 root         (0) root         (0)        0 2023-03-04 06:59:09.000000 mediagrains-3.5.2/mediagrains/utils/py.typed
--rw-r--r--   0 root         (0) root         (0)     6270 2023-03-04 06:59:09.000000 mediagrains-3.5.2/mediagrains/utils/synchronise.py
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-06-21 07:45:54.910507 mediagrains-3.5.2/mediagrains.egg-info/
--rw-r--r--   0 root         (0) root         (0)      358 2023-06-21 07:45:54.000000 mediagrains-3.5.2/mediagrains.egg-info/PKG-INFO
--rw-r--r--   0 root         (0) root         (0)     3437 2023-06-21 07:45:54.000000 mediagrains-3.5.2/mediagrains.egg-info/SOURCES.txt
--rw-r--r--   0 root         (0) root         (0)        1 2023-06-21 07:45:54.000000 mediagrains-3.5.2/mediagrains.egg-info/dependency_links.txt
--rw-r--r--   0 root         (0) root         (0)      230 2023-06-21 07:45:54.000000 mediagrains-3.5.2/mediagrains.egg-info/entry_points.txt
--rw-r--r--   0 root         (0) root         (0)      104 2023-06-21 07:45:54.000000 mediagrains-3.5.2/mediagrains.egg-info/requires.txt
--rw-r--r--   0 root         (0) root         (0)       12 2023-06-21 07:45:54.000000 mediagrains-3.5.2/mediagrains.egg-info/top_level.txt
--rw-r--r--   0 root         (0) root         (0)       38 2023-06-21 07:45:54.922507 mediagrains-3.5.2/setup.cfg
--rw-r--r--   0 root         (0) root         (0)     2575 2023-05-09 10:01:31.000000 mediagrains-3.5.2/setup.py
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-06-21 07:45:54.918506 mediagrains-3.5.2/tests/
--rw-r--r--   0 root         (0) root         (0)     4625 2023-03-04 06:59:09.000000 mediagrains-3.5.2/tests/audio_utils.py
--rw-r--r--   0 root         (0) root         (0)     4575 2023-03-04 06:59:09.000000 mediagrains-3.5.2/tests/fixtures.py
--rw-r--r--   0 root         (0) root         (0)     1812 2023-03-04 06:59:09.000000 mediagrains-3.5.2/tests/test_adts_aac_parser.py
--rw-r--r--   0 root         (0) root         (0)    30682 2023-03-04 06:59:09.000000 mediagrains-3.5.2/tests/test_asyncio_gsf.py
--rw-r--r--   0 root         (0) root         (0)    30683 2023-03-04 06:59:09.000000 mediagrains-3.5.2/tests/test_asyncio_gsf_newcode.py
--rw-r--r--   0 root         (0) root         (0)     7054 2023-03-04 06:59:09.000000 mediagrains-3.5.2/tests/test_audio_psnr.py
--rw-r--r--   0 root         (0) root         (0)     7042 2023-03-04 06:59:09.000000 mediagrains-3.5.2/tests/test_audio_psnr_newcode.py
--rw-r--r--   0 root         (0) root         (0)     8498 2023-03-04 06:59:09.000000 mediagrains-3.5.2/tests/test_comparison.py
--rw-r--r--   0 root         (0) root         (0)     8753 2023-03-04 06:59:09.000000 mediagrains-3.5.2/tests/test_comparison_newcode.py
--rw-r--r--   0 root         (0) root         (0)    83405 2023-03-04 06:59:09.000000 mediagrains-3.5.2/tests/test_grain.py
--rw-r--r--   0 root         (0) root         (0)    84060 2023-03-04 06:59:09.000000 mediagrains-3.5.2/tests/test_grain_newcode.py
--rw-r--r--   0 root         (0) root         (0)   121022 2023-03-04 06:59:09.000000 mediagrains-3.5.2/tests/test_gsf.py
--rw-r--r--   0 root         (0) root         (0)   122049 2023-03-04 06:59:09.000000 mediagrains-3.5.2/tests/test_gsf_newcode.py
--rw-r--r--   0 root         (0) root         (0)     1872 2023-03-04 06:59:09.000000 mediagrains-3.5.2/tests/test_iobytes.py
--rw-r--r--   0 root         (0) root         (0)     8681 2023-03-04 06:59:09.000000 mediagrains-3.5.2/tests/test_numpy_audiograin.py
--rw-r--r--   0 root         (0) root         (0)     8693 2023-03-04 06:59:09.000000 mediagrains-3.5.2/tests/test_numpy_audiograin_newcode.py
--rw-r--r--   0 root         (0) root         (0)    41394 2023-03-04 06:59:09.000000 mediagrains-3.5.2/tests/test_numpy_videograin.py
--rw-r--r--   0 root         (0) root         (0)    41533 2023-03-04 06:59:09.000000 mediagrains-3.5.2/tests/test_numpy_videograin_newcode.py
--rw-r--r--   0 root         (0) root         (0)    29844 2023-03-04 06:59:09.000000 mediagrains-3.5.2/tests/test_patterngenerators.py
--rw-r--r--   0 root         (0) root         (0)    33788 2023-03-04 06:59:09.000000 mediagrains-3.5.2/tests/test_testsignalgenerator.py
--rw-r--r--   0 root         (0) root         (0)     8251 2023-03-04 06:59:09.000000 mediagrains-3.5.2/tests/test_video_psnr.py
--rw-r--r--   0 root         (0) root         (0)     8273 2023-03-04 06:59:09.000000 mediagrains-3.5.2/tests/test_video_psnr_newcode.py
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-04 13:47:17.326591 mediagrains-4.0.0/
+-rw-r--r--   0 root         (0) root         (0)      573 2023-07-04 13:41:30.000000 mediagrains-4.0.0/COPYING
+-rw-r--r--   0 root         (0) root         (0)     6607 2023-07-04 13:41:30.000000 mediagrains-4.0.0/ICLA.md
+-rw-r--r--   0 root         (0) root         (0)    11362 2023-07-04 13:41:30.000000 mediagrains-4.0.0/LICENSE.md
+-rw-r--r--   0 root         (0) root         (0)      147 2023-07-04 13:41:30.000000 mediagrains-4.0.0/MANIFEST.in
+-rw-r--r--   0 root         (0) root         (0)      358 2023-07-04 13:47:17.326591 mediagrains-4.0.0/PKG-INFO
+-rw-r--r--   0 root         (0) root         (0)    10472 2023-07-04 13:41:30.000000 mediagrains-4.0.0/README.md
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-04 13:47:17.314591 mediagrains-4.0.0/examples/
+-rw-r--r--   0 root         (0) root         (0)    62845 2023-07-04 13:41:30.000000 mediagrains-4.0.0/examples/audio_7.gsf
+-rw-r--r--   0 root         (0) root         (0)    62705 2023-07-04 13:41:30.000000 mediagrains-4.0.0/examples/audio_8.gsf
+-rw-r--r--   0 root         (0) root         (0)     8295 2023-07-04 13:41:30.000000 mediagrains-4.0.0/examples/coded_audio_7.gsf
+-rw-r--r--   0 root         (0) root         (0)     8155 2023-07-04 13:41:30.000000 mediagrains-4.0.0/examples/coded_audio_8.gsf
+-rw-r--r--   0 root         (0) root         (0)    68457 2023-07-04 13:41:30.000000 mediagrains-4.0.0/examples/coded_video_7.gsf
+-rw-r--r--   0 root         (0) root         (0)    68317 2023-07-04 13:41:30.000000 mediagrains-4.0.0/examples/coded_video_8.gsf
+-rw-r--r--   0 root         (0) root         (0)    37610 2023-07-04 13:41:30.000000 mediagrains-4.0.0/examples/event_7.gsf
+-rw-r--r--   0 root         (0) root         (0)    37570 2023-07-04 13:41:30.000000 mediagrains-4.0.0/examples/event_8.gsf
+-rw-r--r--   0 root         (0) root         (0) 25011059 2023-07-04 13:41:30.000000 mediagrains-4.0.0/examples/interleaved_7.gsf
+-rw-r--r--   0 root         (0) root         (0) 25010569 2023-07-04 13:41:30.000000 mediagrains-4.0.0/examples/interleaved_8.gsf
+-rw-r--r--   0 root         (0) root         (0)  1946205 2023-07-04 13:41:30.000000 mediagrains-4.0.0/examples/video_7.gsf
+-rw-r--r--   0 root         (0) root         (0)  1946635 2023-07-04 13:41:30.000000 mediagrains-4.0.0/examples/video_8.gsf
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-04 13:47:17.314591 mediagrains-4.0.0/mediagrains/
+-rw-r--r--   0 root         (0) root         (0)     1820 2023-07-04 13:41:30.000000 mediagrains-4.0.0/mediagrains/__init__.py
+-rw-r--r--   0 root         (0) root         (0)      100 2023-07-04 13:44:02.000000 mediagrains-4.0.0/mediagrains/_version.py
+-rw-r--r--   0 root         (0) root         (0)     5644 2023-07-04 13:41:30.000000 mediagrains-4.0.0/mediagrains/cogenums.py
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-04 13:47:17.318591 mediagrains-4.0.0/mediagrains/comparison/
+-rw-r--r--   0 root         (0) root         (0)     2321 2023-07-04 13:41:30.000000 mediagrains-4.0.0/mediagrains/comparison/__init__.py
+-rw-r--r--   0 root         (0) root         (0)     1435 2023-07-04 13:41:30.000000 mediagrains-4.0.0/mediagrains/comparison/__main__.py
+-rw-r--r--   0 root         (0) root         (0)    42496 2023-07-04 13:41:30.000000 mediagrains-4.0.0/mediagrains/comparison/_internal.py
+-rw-r--r--   0 root         (0) root         (0)     8221 2023-07-04 13:41:30.000000 mediagrains-4.0.0/mediagrains/comparison/options.py
+-rw-r--r--   0 root         (0) root         (0)     5699 2023-07-04 13:41:30.000000 mediagrains-4.0.0/mediagrains/comparison/psnr.py
+-rw-r--r--   0 root         (0) root         (0)        0 2023-07-04 13:41:30.000000 mediagrains-4.0.0/mediagrains/comparison/py.typed
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-04 13:47:17.318591 mediagrains-4.0.0/mediagrains/grains/
+-rw-r--r--   0 root         (0) root         (0)     8158 2023-07-04 13:41:30.000000 mediagrains-4.0.0/mediagrains/grains/AudioGrain.py
+-rw-r--r--   0 root         (0) root         (0)     8807 2023-07-04 13:41:30.000000 mediagrains-4.0.0/mediagrains/grains/CodedAudioGrain.py
+-rw-r--r--   0 root         (0) root         (0)    16187 2023-07-04 13:41:30.000000 mediagrains-4.0.0/mediagrains/grains/CodedVideoGrain.py
+-rw-r--r--   0 root         (0) root         (0)    11074 2023-07-04 13:41:30.000000 mediagrains-4.0.0/mediagrains/grains/EventGrain.py
+-rw-r--r--   0 root         (0) root         (0)    27612 2023-07-04 13:41:30.000000 mediagrains-4.0.0/mediagrains/grains/Grain.py
+-rw-r--r--   0 root         (0) root         (0)    20331 2023-07-04 13:41:30.000000 mediagrains-4.0.0/mediagrains/grains/VideoGrain.py
+-rw-r--r--   0 root         (0) root         (0)      530 2023-07-04 13:41:30.000000 mediagrains-4.0.0/mediagrains/grains/__init__.py
+-rw-r--r--   0 root         (0) root         (0)    95692 2023-07-04 13:41:30.000000 mediagrains-4.0.0/mediagrains/gsf.py
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-04 13:47:17.318591 mediagrains-4.0.0/mediagrains/hypothesis/
+-rw-r--r--   0 root         (0) root         (0)        0 2023-07-04 13:41:30.000000 mediagrains-4.0.0/mediagrains/hypothesis/__init__.py
+-rw-r--r--   0 root         (0) root         (0)        0 2023-07-04 13:41:30.000000 mediagrains-4.0.0/mediagrains/hypothesis/py.typed
+-rw-r--r--   0 root         (0) root         (0)    36636 2023-07-04 13:41:30.000000 mediagrains-4.0.0/mediagrains/hypothesis/strategies.py
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-04 13:47:17.318591 mediagrains-4.0.0/mediagrains/numpy/
+-rw-r--r--   0 root         (0) root         (0)      830 2023-07-04 13:41:30.000000 mediagrains-4.0.0/mediagrains/numpy/__init__.py
+-rw-r--r--   0 root         (0) root         (0)    21960 2023-07-04 13:41:30.000000 mediagrains-4.0.0/mediagrains/numpy/convert.py
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-04 13:47:17.318591 mediagrains-4.0.0/mediagrains/numpy/numpy_grains/
+-rw-r--r--   0 root         (0) root         (0)     8748 2023-07-04 13:41:30.000000 mediagrains-4.0.0/mediagrains/numpy/numpy_grains/AudioGrain.py
+-rw-r--r--   0 root         (0) root         (0)    18875 2023-07-04 13:41:30.000000 mediagrains-4.0.0/mediagrains/numpy/numpy_grains/VideoGrain.py
+-rw-r--r--   0 root         (0) root         (0)      110 2023-07-04 13:41:30.000000 mediagrains-4.0.0/mediagrains/numpy/numpy_grains/__init__.py
+-rw-r--r--   0 root         (0) root         (0)        0 2023-07-04 13:41:30.000000 mediagrains-4.0.0/mediagrains/numpy/py.typed
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-04 13:47:17.318591 mediagrains-4.0.0/mediagrains/patterngenerators/
+-rw-r--r--   0 root         (0) root         (0)      881 2023-07-04 13:41:30.000000 mediagrains-4.0.0/mediagrains/patterngenerators/__init__.py
+-rw-r--r--   0 root         (0) root         (0)     4538 2023-07-04 13:41:30.000000 mediagrains-4.0.0/mediagrains/patterngenerators/abc.py
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-04 13:47:17.318591 mediagrains-4.0.0/mediagrains/patterngenerators/audio/
+-rw-r--r--   0 root         (0) root         (0)      747 2023-07-04 13:41:30.000000 mediagrains-4.0.0/mediagrains/patterngenerators/audio/__init__.py
+-rw-r--r--   0 root         (0) root         (0)     1906 2023-07-04 13:41:30.000000 mediagrains-4.0.0/mediagrains/patterngenerators/audio/abc.py
+-rw-r--r--   0 root         (0) root         (0)        0 2023-07-04 13:41:30.000000 mediagrains-4.0.0/mediagrains/patterngenerators/audio/py.typed
+-rw-r--r--   0 root         (0) root         (0)     8580 2023-07-04 13:41:30.000000 mediagrains-4.0.0/mediagrains/patterngenerators/audio/tone.py
+-rw-r--r--   0 root         (0) root         (0)        0 2023-07-04 13:41:30.000000 mediagrains-4.0.0/mediagrains/patterngenerators/py.typed
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-04 13:47:17.322591 mediagrains-4.0.0/mediagrains/patterngenerators/video/
+-rw-r--r--   0 root         (0) root         (0)      905 2023-07-04 13:41:30.000000 mediagrains-4.0.0/mediagrains/patterngenerators/video/__init__.py
+-rw-r--r--   0 root         (0) root         (0)     1626 2023-07-04 13:41:30.000000 mediagrains-4.0.0/mediagrains/patterngenerators/video/abc.py
+-rw-r--r--   0 root         (0) root         (0)     3153 2023-07-04 13:41:30.000000 mediagrains-4.0.0/mediagrains/patterngenerators/video/colourbars.py
+-rw-r--r--   0 root         (0) root         (0)     1839 2023-07-04 13:41:30.000000 mediagrains-4.0.0/mediagrains/patterngenerators/video/constants.py
+-rw-r--r--   0 root         (0) root         (0)     3302 2023-07-04 13:41:30.000000 mediagrains-4.0.0/mediagrains/patterngenerators/video/lumasteps.py
+-rw-r--r--   0 root         (0) root         (0)     4773 2023-07-04 13:41:30.000000 mediagrains-4.0.0/mediagrains/patterngenerators/video/movingbaroverlay.py
+-rw-r--r--   0 root         (0) root         (0)        0 2023-07-04 13:41:30.000000 mediagrains-4.0.0/mediagrains/patterngenerators/video/py.typed
+-rw-r--r--   0 root         (0) root         (0)     1650 2023-07-04 13:41:30.000000 mediagrains-4.0.0/mediagrains/patterngenerators/video/still.py
+-rw-r--r--   0 root         (0) root         (0)        0 2023-07-04 13:41:30.000000 mediagrains-4.0.0/mediagrains/py.typed
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-04 13:47:17.322591 mediagrains-4.0.0/mediagrains/tools/
+-rw-r--r--   0 root         (0) root         (0)      866 2023-07-04 13:41:30.000000 mediagrains-4.0.0/mediagrains/tools/__init__.py
+-rw-r--r--   0 root         (0) root         (0)     2463 2023-07-04 13:41:30.000000 mediagrains-4.0.0/mediagrains/tools/_file_or_pipe.py
+-rw-r--r--   0 root         (0) root         (0)     3706 2023-07-04 13:41:30.000000 mediagrains-4.0.0/mediagrains/tools/extract_from_gsf.py
+-rw-r--r--   0 root         (0) root         (0)        0 2023-07-04 13:41:30.000000 mediagrains-4.0.0/mediagrains/tools/py.typed
+-rw-r--r--   0 root         (0) root         (0)     7917 2023-07-04 13:41:30.000000 mediagrains-4.0.0/mediagrains/tools/wrap_in_gsf.py
+-rw-r--r--   0 root         (0) root         (0)     8851 2023-07-04 13:41:30.000000 mediagrains-4.0.0/mediagrains/typing.py
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-04 13:47:17.322591 mediagrains-4.0.0/mediagrains/utils/
+-rw-r--r--   0 root         (0) root         (0)      855 2023-07-04 13:41:30.000000 mediagrains-4.0.0/mediagrains/utils/__init__.py
+-rw-r--r--   0 root         (0) root         (0)     4376 2023-07-04 13:41:30.000000 mediagrains-4.0.0/mediagrains/utils/adts_aac_grain_wrapper.py
+-rw-r--r--   0 root         (0) root         (0)     2685 2023-07-04 13:41:30.000000 mediagrains-4.0.0/mediagrains/utils/adts_aac_parser.py
+-rw-r--r--   0 root         (0) root         (0)    12766 2023-07-04 13:41:30.000000 mediagrains-4.0.0/mediagrains/utils/asyncbinaryio.py
+-rw-r--r--   0 root         (0) root         (0)     2416 2023-07-04 13:41:30.000000 mediagrains-4.0.0/mediagrains/utils/grain_wrapper.py
+-rw-r--r--   0 root         (0) root         (0)     7023 2023-07-04 13:41:30.000000 mediagrains-4.0.0/mediagrains/utils/h264_grain_wrapper.py
+-rw-r--r--   0 root         (0) root         (0)    31542 2023-07-04 13:41:30.000000 mediagrains-4.0.0/mediagrains/utils/h264_parser.py
+-rw-r--r--   0 root         (0) root         (0)     6642 2023-07-04 13:41:30.000000 mediagrains-4.0.0/mediagrains/utils/iobytes.py
+-rw-r--r--   0 root         (0) root         (0)        0 2023-07-04 13:41:30.000000 mediagrains-4.0.0/mediagrains/utils/py.typed
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-04 13:47:17.314591 mediagrains-4.0.0/mediagrains.egg-info/
+-rw-r--r--   0 root         (0) root         (0)      358 2023-07-04 13:47:17.000000 mediagrains-4.0.0/mediagrains.egg-info/PKG-INFO
+-rw-r--r--   0 root         (0) root         (0)     2933 2023-07-04 13:47:17.000000 mediagrains-4.0.0/mediagrains.egg-info/SOURCES.txt
+-rw-r--r--   0 root         (0) root         (0)        1 2023-07-04 13:47:17.000000 mediagrains-4.0.0/mediagrains.egg-info/dependency_links.txt
+-rw-r--r--   0 root         (0) root         (0)      230 2023-07-04 13:47:17.000000 mediagrains-4.0.0/mediagrains.egg-info/entry_points.txt
+-rw-r--r--   0 root         (0) root         (0)      104 2023-07-04 13:47:17.000000 mediagrains-4.0.0/mediagrains.egg-info/requires.txt
+-rw-r--r--   0 root         (0) root         (0)       12 2023-07-04 13:47:17.000000 mediagrains-4.0.0/mediagrains.egg-info/top_level.txt
+-rw-r--r--   0 root         (0) root         (0)       38 2023-07-04 13:47:17.326591 mediagrains-4.0.0/setup.cfg
+-rw-r--r--   0 root         (0) root         (0)     2548 2023-07-04 13:41:30.000000 mediagrains-4.0.0/setup.py
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-04 13:47:17.326591 mediagrains-4.0.0/tests/
+-rw-r--r--   0 root         (0) root         (0)        0 2023-07-04 13:41:30.000000 mediagrains-4.0.0/tests/__init__.py
+-rw-r--r--   0 root         (0) root         (0)     4625 2023-07-04 13:41:30.000000 mediagrains-4.0.0/tests/audio_utils.py
+-rw-r--r--   0 root         (0) root         (0)     4586 2023-07-04 13:41:30.000000 mediagrains-4.0.0/tests/fixtures.py
+-rw-r--r--   0 root         (0) root         (0)     1812 2023-07-04 13:41:30.000000 mediagrains-4.0.0/tests/test_adts_aac_parser.py
+-rw-r--r--   0 root         (0) root         (0)     7043 2023-07-04 13:41:30.000000 mediagrains-4.0.0/tests/test_audio_psnr.py
+-rw-r--r--   0 root         (0) root         (0)    10798 2023-07-04 13:41:30.000000 mediagrains-4.0.0/tests/test_comparison.py
+-rw-r--r--   0 root         (0) root         (0)    84610 2023-07-04 13:41:30.000000 mediagrains-4.0.0/tests/test_grain.py
+-rw-r--r--   0 root         (0) root         (0)   123779 2023-07-04 13:41:30.000000 mediagrains-4.0.0/tests/test_gsf.py
+-rw-r--r--   0 root         (0) root         (0)     1872 2023-07-04 13:41:30.000000 mediagrains-4.0.0/tests/test_iobytes.py
+-rw-r--r--   0 root         (0) root         (0)     8694 2023-07-04 13:41:30.000000 mediagrains-4.0.0/tests/test_numpy_audiograin.py
+-rw-r--r--   0 root         (0) root         (0)    41583 2023-07-04 13:41:30.000000 mediagrains-4.0.0/tests/test_numpy_videograin.py
+-rw-r--r--   0 root         (0) root         (0)    29864 2023-07-04 13:41:30.000000 mediagrains-4.0.0/tests/test_patterngenerators.py
+-rw-r--r--   0 root         (0) root         (0)     8283 2023-07-04 13:41:30.000000 mediagrains-4.0.0/tests/test_video_psnr.py
```

### Comparing `mediagrains-3.5.2/COPYING` & `mediagrains-4.0.0/COPYING`

 * *Files identical despite different names*

### Comparing `mediagrains-3.5.2/ICLA.md` & `mediagrains-4.0.0/ICLA.md`

 * *Files identical despite different names*

### Comparing `mediagrains-3.5.2/LICENSE.md` & `mediagrains-4.0.0/LICENSE.md`

 * *Files identical despite different names*

### Comparing `mediagrains-3.5.2/README.md` & `mediagrains-4.0.0/README.md`

 * *Files 3% similar despite different names*

```diff
@@ -63,15 +63,15 @@
 
 ```Python console
 >>> from mediagrains import VideoGrain
 >>> from uuid import uuid1
 >>> from mediagrains.cogenum import CogFrameFormat, CogFrameLayout
 >>> src_id = uuid1()
 >>> flow_id = uuid1()
->>> grain = VideoGrain(src_id, flow_id, cog_frame_format=CogFrameFormat.S16_422_10BIT, width=1920, height=1080)
+>>> grain = VideoGrain(src_id=src_id, flow_id=flow_id, cog_frame_format=CogFrameFormat.S16_422_10BIT, width=1920, height=1080)
 >>> colours = [
 ...      (0x3FF, 0x000, 0x3FF),
 ...      (0x3FF, 0x3FF, 0x000),
 ...      (0x3FF, 0x000, 0x000),
 ...      (0x3FF, 0x3FF, 0x3FF),
 ...      (0x3FF, 0x200, 0x3FF),
 ...      (0x3FF, 0x3FF, 0x200) ]
@@ -108,17 +108,17 @@
 >>> from mediagrains.gsf import GSFEncoder
 >>> src_id = uuid1()
 >>> flow_id = uuid1()
 >>> f = open('dummyfile.gsf', 'wb')
 >>> enc = GSFEncoder(f)
 >>> seg = enc.add_segment()  # This must be done before the call to start_dump
 >>> enc.start_dump()  # This writes the file header and starts the export
->>> seg.add_grain(Grain(src_id, flow_id))  # Adds a grain and writes it to the file
->>> seg.add_grain(Grain(src_id, flow_id))  # Adds a grain and writes it to the file
->>> seg.add_grain(Grain(src_id, flow_id))  # Adds a grain and writes it to the file
+>>> seg.add_grain(Grain(src_id=src_id, flow_id=flow_id))  # Adds a grain and writes it to the file
+>>> seg.add_grain(Grain(src_id=src_id, flow_id=flow_id))  # Adds a grain and writes it to the file
+>>> seg.add_grain(Grain(src_id=src_id, flow_id=flow_id))  # Adds a grain and writes it to the file
 >>> enc.end_dump()  # This ends the export and finishes off the file
 >>> f.close()
 ```
 
 If the underlying file is seekable then the end_dump call will upade all segment
 metadata to list the correct grain count, otherwise the counts will be
 left at -1.
@@ -145,18 +145,18 @@
   ✅   <a/b>.duration == Fraction(1, 25)
   ✅   <a/b>.length == 6220800
   ❌   a.origin_timestamp - b.origin_timestamp == mediatimestamp.immutable.TimeOffset.from_sec_nsec('-0:160000000'), not the expected mediatimestamp.immutable.TimeOffset.from_sec_nsec('0:0')
   ❌   a.sync_timestamp - b.sync_timestamp == mediatimestamp.immutable.TimeOffset.from_sec_nsec('-0:160000000'), not the expected mediatimestamp.immutable.TimeOffset.from_sec_nsec('0:0')
   ◯   a.creation_timestamp - b.creation_timestamp == mediatimestamp.immutable.TimeOffset.from_sec_nsec('0:0') as expected
   ✅   Lists match
     ✅   len(<a/b>.timelabels) == 0
-  ✅   <a/b>.format == CogFrameFormat.U8_444
+  ✅   <a/b>.cog_frame_format == CogFrameFormat.U8_444
   ✅   <a/b>.width == 1920
   ✅   <a/b>.height == 1080
-  ✅   <a/b>.layout == CogFrameLayout.FULL_FRAME
+  ✅   <a/b>.cog_frame_layout == CogFrameLayout.FULL_FRAME
   ✅   Binary data <a/b>.data are equal
 ```
 
 This output gives a relatively detailed breakdown of the differences
 between two grains, both as a printed string (as seen above) and also
 in a data-centric fashion as a tree structure which can be
 interrogated in code.
@@ -167,15 +167,15 @@
 
 ```Python console
 >>> from mediagrains.numpy import VideoGrain
 >>> from uuid import uuid1
 >>> from mediagrains.cogenums import CogFrameFormat, CogFrameLayout
 >>> src_id = uuid1()
 >>> flow_id = uuid1()
->>> grain = VideoGrain(src_id, flow_id, cog_frame_format=CogFrameFormat.S16_422_10BIT, width=1920, height=1080)
+>>> grain = VideoGrain(src_id=src_id, flow_id=flow_id, cog_frame_format=CogFrameFormat.S16_422_10BIT, width=1920, height=1080)
 >>> colours = [
 ...      (0x3FF, 0x000, 0x3FF),
 ...      (0x3FF, 0x3FF, 0x000),
 ...      (0x3FF, 0x000, 0x000),
 ...      (0x3FF, 0x3FF, 0x3FF),
 ...      (0x3FF, 0x200, 0x3FF),
 ...      (0x3FF, 0x3FF, 0x200) ]
```

### Comparing `mediagrains-3.5.2/examples/audio.gsf` & `mediagrains-4.0.0/examples/audio_7.gsf`

 * *Files identical despite different names*

### Comparing `mediagrains-3.5.2/examples/coded_audio.gsf` & `mediagrains-4.0.0/examples/coded_audio_7.gsf`

 * *Files identical despite different names*

### Comparing `mediagrains-3.5.2/examples/coded_video.gsf` & `mediagrains-4.0.0/examples/coded_video_7.gsf`

 * *Files identical despite different names*

### Comparing `mediagrains-3.5.2/examples/event.gsf` & `mediagrains-4.0.0/examples/event_7.gsf`

 * *Files identical despite different names*

### Comparing `mediagrains-3.5.2/examples/interleaved.gsf` & `mediagrains-4.0.0/examples/interleaved_7.gsf`

 * *Files identical despite different names*

### Comparing `mediagrains-3.5.2/examples/video.gsf` & `mediagrains-4.0.0/examples/video_7.gsf`

 * *Files identical despite different names*

### Comparing `mediagrains-3.5.2/mediagrains/__init__.py` & `mediagrains-4.0.0/mediagrains/__init__.py`

 * *Files 11% similar despite different names*

```diff
@@ -32,16 +32,22 @@
 are used in a way that constructs a new data element they will construct a
 bytearray object of the apropriate size. Remember that in Python 2 bytes-like
 objects are stringlike, but in Python 3 they resemble sequences of integers.
 
 Notably this means that the data element of these grains is fully compatible
 with numpy and similar libraries.
 
-The gsf and grain submodules have their own documentation.
+The gsf and grains submodules have their own documentation.
 """
-# TO_CHANGE: Export the grain classes directly on version change. (e.g. from .grains import ...)
-from .grain_constructors import Grain, VideoGrain, CodedVideoGrain, AudioGrain, CodedAudioGrain, EventGrain
+from .grains import Grain, VideoGrain, CodedVideoGrain, AudioGrain, CodedAudioGrain, EventGrain, GrainFactory
 from .typing import ParseGrainType
-from . import grain
 
-__all__ = ["Grain", "VideoGrain", "CodedVideoGrain", "AudioGrain", "CodedAudioGrain", "EventGrain", "ParseGrainType",
-           "grain"]
+__all__ = [
+    "Grain",
+    "VideoGrain",
+    "CodedVideoGrain",
+    "AudioGrain",
+    "CodedAudioGrain",
+    "EventGrain",
+    "ParseGrainType",
+    "GrainFactory"
+]
```

### Comparing `mediagrains-3.5.2/mediagrains/cogenums.py` & `mediagrains-4.0.0/mediagrains/cogenums.py`

 * *Files identical despite different names*

### Comparing `mediagrains-3.5.2/mediagrains/comparison/__init__.py` & `mediagrains-4.0.0/mediagrains/comparison/__init__.py`

 * *Files identical despite different names*

### Comparing `mediagrains-3.5.2/mediagrains/comparison/__main__.py` & `mediagrains-4.0.0/mediagrains/comparison/__main__.py`

 * *Files identical despite different names*

### Comparing `mediagrains-3.5.2/mediagrains/comparison/_internal.py` & `mediagrains-4.0.0/mediagrains/comparison/_internal.py`

 * *Files 6% similar despite different names*

```diff
@@ -124,17 +124,27 @@
         if len(msgs) == 0:
             return self._msg
         else:
             return self._msg + ': ' + '; '.join(msgs)
 
     def excluded(self) -> bool:
         """Return a boolean value to show whether the identifier is Included or Excluded from the result."""
+        # Some Grain parameters have equivalent alternative parameters: deduplicate accordingly
+        alternative_attrs = {
+            "{}.src_id": "{}.source_id",
+            "{}.cog_frame_format": "{}.format",
+            "{}.cog_audio_format": "{}.format",
+            "{}.cog_frame_layout": "{}.layout"
+        }
+
         return bool(len([
-            option for option in self._options if isinstance(
-                option, ComparisonExclude) and self._identifier == option.path]) != 0)
+            option for option in self._options if (
+                isinstance(option, ComparisonExclude) and
+                (self._identifier == option.path or option.path == alternative_attrs.get(self._identifier, []))
+            )]) != 0)
 
     def ownoptions(self) -> list[ComparisonOption]:
         """Return any ComparisonOptions to do with what is being compared in the ComparisonResult (identifier)."""
         return [option for option in self._options if self._identifier == option.path]
 
     def compare(self, a, b) -> tuple[bool, str, list[CR]]:
         """Override in subclasses to return a triple:
@@ -620,58 +630,58 @@
                 comparison_class=MappingContainerComparisonResult,
                 attr=key)
         if children['event_type'].excluded() or children['topic'].excluded() or children['event_data'].excluded():
             children['length']._options.append(Exclude.length)
 
     def compare_audio_grains(self, a: AudioGrain, b: AudioGrain, children) -> None:
         # We are comparing audio grains, so compare their audio grain specific features
-        for key in ['format',
+        for key in ['cog_audio_format',
                     'samples',
                     'channels',
                     'sample_rate']:
             path = self._identifier + '.' + key
             children[key] = EqualityComparisonResult(
                 path, getattr(a, key), getattr(b, key), options=self._options, attr=key)
 
-        if a.format == b.format:
+        if a.cog_audio_format == b.cog_audio_format:
             path = self._identifier + '.data'
             compare_psnr = len(
                 [option for option in self._options if isinstance(option, ComparisonPSNR) and path == option.path]
                 ) != 0
             if compare_psnr:
                 children['data'] = PSNRComparisonResult(path,
                                                         a,
                                                         b,
                                                         options=self._options)
             else:
                 words_per_sample = 1
                 force_signed = False
-                if a.format in [CogAudioFormat.S16_PLANES,
-                                CogAudioFormat.S16_PAIRS,
-                                CogAudioFormat.S16_INTERLEAVED]:
+                if a.cog_audio_format in [CogAudioFormat.S16_PLANES,
+                                          CogAudioFormat.S16_PAIRS,
+                                          CogAudioFormat.S16_INTERLEAVED]:
                     word_code = 'h'
-                elif a.format in [CogAudioFormat.S24_PLANES,
-                                  CogAudioFormat.S24_PAIRS,
-                                  CogAudioFormat.S24_INTERLEAVED]:
+                elif a.cog_audio_format in [CogAudioFormat.S24_PLANES,
+                                            CogAudioFormat.S24_PAIRS,
+                                            CogAudioFormat.S24_INTERLEAVED]:
                     word_code = 'B'
                     words_per_sample = 3
                     force_signed = True
-                elif a.format in [CogAudioFormat.S32_PLANES,
-                                  CogAudioFormat.S32_PAIRS,
-                                  CogAudioFormat.S32_INTERLEAVED]:
+                elif a.cog_audio_format in [CogAudioFormat.S32_PLANES,
+                                            CogAudioFormat.S32_PAIRS,
+                                            CogAudioFormat.S32_INTERLEAVED]:
                     word_code = 'i'
-                elif a.format in [CogAudioFormat.S64_INVALID]:
+                elif a.cog_audio_format in [CogAudioFormat.S64_INVALID]:
                     word_code = 'l'
-                elif a.format in [CogAudioFormat.FLOAT_PLANES,
-                                  CogAudioFormat.FLOAT_PAIRS,
-                                  CogAudioFormat.FLOAT_INTERLEAVED]:
+                elif a.cog_audio_format in [CogAudioFormat.FLOAT_PLANES,
+                                            CogAudioFormat.FLOAT_PAIRS,
+                                            CogAudioFormat.FLOAT_INTERLEAVED]:
                     word_code = 'f'
-                elif a.format in [CogAudioFormat.DOUBLE_PLANES,
-                                  CogAudioFormat.DOUBLE_PAIRS,
-                                  CogAudioFormat.DOUBLE_INTERLEAVED]:
+                elif a.cog_audio_format in [CogAudioFormat.DOUBLE_PLANES,
+                                            CogAudioFormat.DOUBLE_PAIRS,
+                                            CogAudioFormat.DOUBLE_INTERLEAVED]:
                     word_code = 'd'
                 else:
                     word_code = 'B'
 
                 children['data'] = DataEqualityComparisonResult(path,
                                                                 a.data,
                                                                 b.data,
@@ -686,72 +696,72 @@
             children['data'] = FailingComparisonResult(self._identifier + ".data",
                                                        "payload formats do not match",
                                                        attr="data",
                                                        options=self._options)
 
     def compare_coded_audio_grains(self, a: CodedAudioGrain, b: CodedAudioGrain, children) -> None:
         # We are comparing coded_audio grains, so compare their coded_audio grain specific features
-        for key in ['format',
+        for key in ['cog_audio_format',
                     'samples',
                     'channels',
                     'sample_rate',
                     'priming',
                     'remainder']:
             path = self._identifier + '.' + key
             children[key] = EqualityComparisonResult(
                 path, getattr(a, key), getattr(b, key), options=self._options, attr=key)
 
-        if a.format == b.format:
+        if a.cog_audio_format == b.cog_audio_format:
             children['data'] = DataEqualityComparisonResult(self._identifier + ".data",
                                                             a.data,
                                                             b.data,
                                                             options=self._options,
                                                             attr="data")
         else:
             self._options.append(Exclude.data)
             children['data'] = FailingComparisonResult(self._identifier + ".data",
                                                        "payload formats do not match",
                                                        attr="data",
                                                        options=self._options)
 
     def compare_video_grains(self, a: VideoGrain, b: VideoGrain, children) -> None:
         # We are comparing video grains, so compare their video grain specific features
-        for key in ['format',
+        for key in ['cog_frame_format',
                     'width',
                     'height',
-                    'layout']:
+                    'cog_frame_layout']:
             path = self._identifier + '.' + key
             children[key] = EqualityComparisonResult(
                 path, getattr(a, key), getattr(b, key), options=self._options, attr=key)
 
-        if a.format == b.format:
+        if a.cog_frame_format == b.cog_frame_format:
             path = self._identifier + '.data'
             compare_psnr = len(
                 [option for option in self._options if isinstance(option, ComparisonPSNR) and path == option.path]
                 ) != 0
             if compare_psnr:
                 children['data'] = PSNRComparisonResult(path,
                                                         a,
                                                         b,
                                                         options=self._options)
             else:
-                if COG_FRAME_IS_COMPRESSED(a.format):
+                if COG_FRAME_IS_COMPRESSED(a.cog_frame_format):
                     word_code = 'B'
-                elif a.format == CogFrameFormat.v210:
+                elif a.cog_frame_format == CogFrameFormat.v210:
                     word_code = 'I'
-                elif a.format == CogFrameFormat.v216:
+                elif a.cog_frame_format == CogFrameFormat.v216:
                     word_code = 'H'
-                elif COG_FRAME_IS_PACKED(a.format):
+                elif COG_FRAME_IS_PACKED(a.cog_frame_format):
                     word_code = 'B'
                 else:
-                    if COG_FRAME_FORMAT_BYTES_PER_VALUE(a.format) == 1:
+                    if COG_FRAME_FORMAT_BYTES_PER_VALUE(a.cog_frame_format) == 1:
                         word_code = 'B'
-                    elif COG_FRAME_FORMAT_BYTES_PER_VALUE(a.format) == 2:
+                    elif COG_FRAME_FORMAT_BYTES_PER_VALUE(a.cog_frame_format) == 2:
                         word_code = 'H'
-                    elif COG_FRAME_FORMAT_BYTES_PER_VALUE(a.format) == 4:
+                    elif COG_FRAME_FORMAT_BYTES_PER_VALUE(a.cog_frame_format) == 4:
                         word_code = 'I'
 
                 children['data'] = DataEqualityComparisonResult(self._identifier + ".data",
                                                                 a.data,
                                                                 b.data,
                                                                 options=self._options,
                                                                 attr="data",
@@ -762,35 +772,35 @@
             children['data'] = FailingComparisonResult(self._identifier + ".data",
                                                        "payload formats do not match",
                                                        attr="data",
                                                        options=self._options)
 
     def compare_coded_video_grains(self, a: CodedVideoGrain, b: CodedVideoGrain, children) -> None:
         # We are comparing coded_video grains, so compare their coded_video grain specific features
-        for key in ['format',
+        for key in ['cog_frame_format',
                     'coded_width',
                     'coded_height',
                     'origin_width',
                     'origin_height',
                     'is_key_frame',
                     'temporal_offset',
-                    'layout']:
+                    'cog_frame_layout']:
             path = self._identifier + '.' + key
             children[key] = EqualityComparisonResult(
                 path, getattr(a, key), getattr(b, key), options=self._options, attr=key)
 
         for key in ['unit_offsets']:
             path = self._identifier + '.' + key
             children[key] = OrderedContainerComparisonResult(path,
                                                              getattr(a, key),
                                                              getattr(b, key),
                                                              comparison_class=DifferenceComparisonResult,
                                                              options=self._options, attr=key)
 
-        if a.format == b.format:
+        if a.cog_frame_format == b.cog_frame_format:
             children['data'] = DataEqualityComparisonResult(self._identifier + ".data",
                                                             a.data,
                                                             b.data,
                                                             options=self._options,
                                                             attr="data")
         else:
             self._options.append(Exclude.data)
@@ -802,15 +812,15 @@
     def compare(self, a: Grain, b: Grain) -> tuple[bool, str, list[ComparisonResult]]:
         children: dict[str, ComparisonResult] = {}
 
         if Include.creation_timestamp not in self._options:
             self._options.append(Exclude.creation_timestamp)
 
         for key in ['grain_type',
-                    'source_id',
+                    'src_id',
                     'flow_id',
                     'rate',
                     'duration',
                     'length']:
             path = self._identifier + '.' + key
             children[key] = EqualityComparisonResult(
                 path, getattr(a, key), getattr(b, key), options=self._options, attr=key)
```

### Comparing `mediagrains-3.5.2/mediagrains/comparison/options.py` & `mediagrains-4.0.0/mediagrains/comparison/options.py`

 * *Files identical despite different names*

### Comparing `mediagrains-3.5.2/mediagrains/comparison/psnr.py` & `mediagrains-4.0.0/mediagrains/comparison/psnr.py`

 * *Files 4% similar despite different names*

```diff
@@ -113,24 +113,24 @@
     :param grain_a: A VideoGrain
     :param grain_b: A VideoGrain
     :returns: A list of PSNR values for each video component
     """
     if grain_a.width != grain_b.width or grain_a.height != grain_b.height:
         raise AttributeError("Frame dimensions differ")
 
-    if COG_FRAME_IS_COMPRESSED(grain_a.format):
+    if COG_FRAME_IS_COMPRESSED(grain_a.cog_frame_format):
         raise NotImplementedError("Compressed video is not supported")
 
     if not isinstance(grain_a, numpy_VideoGrain):
         grain_a = numpy_VideoGrain(grain=grain_a)
     if not isinstance(grain_b, numpy_VideoGrain):
         grain_b = numpy_VideoGrain(grain=grain_b)
 
     if max_val is None:
-        max_val = (1 << COG_FRAME_FORMAT_ACTIVE_BITS(grain_a.format)) - 1
+        max_val = (1 << COG_FRAME_FORMAT_ACTIVE_BITS(grain_a.cog_frame_format)) - 1
 
     psnr = []
     for comp_data_a, comp_data_b in zip(grain_a.component_data, grain_b.component_data):
         psnr.append(_compute_element_psnr(comp_data_a, comp_data_b, max_val))
 
     return psnr
```

### Comparing `mediagrains-3.5.2/mediagrains/grains/AudioGrain.py` & `mediagrains-4.0.0/mediagrains/grains/AudioGrain.py`

 * *Files identical despite different names*

### Comparing `mediagrains-3.5.2/mediagrains/grains/CodedAudioGrain.py` & `mediagrains-4.0.0/mediagrains/grains/CodedAudioGrain.py`

 * *Files identical despite different names*

### Comparing `mediagrains-3.5.2/mediagrains/grains/CodedVideoGrain.py` & `mediagrains-4.0.0/mediagrains/grains/CodedVideoGrain.py`

 * *Files identical despite different names*

### Comparing `mediagrains-3.5.2/mediagrains/grains/EventGrain.py` & `mediagrains-4.0.0/mediagrains/grains/EventGrain.py`

 * *Files identical despite different names*

### Comparing `mediagrains-3.5.2/mediagrains/grains/Grain.py` & `mediagrains-4.0.0/mediagrains/grains/Grain.py`

 * *Files identical despite different names*

### Comparing `mediagrains-3.5.2/mediagrains/grains/VideoGrain.py` & `mediagrains-4.0.0/mediagrains/grains/VideoGrain.py`

 * *Files 3% similar despite different names*

```diff
@@ -7,14 +7,15 @@
     Optional,
     overload,
     cast,
     Iterator,
     Iterable)
 from typing_extensions import Literal
 from uuid import UUID
+from deprecated import deprecated
 
 from mediatimestamp.immutable import Timestamp, SupportsMediaTimestamp, mediatimestamp
 from ..typing import (
     RationalTypes,
     VideoGrainComponentDict,
     FractionDict,
     VideoGrainMetadataDict,
@@ -442,18 +443,20 @@
                 'components': []
             }
         self.meta['grain']['cog_frame']['format'] = int(self.meta['grain']['cog_frame']['format'])
         self.meta['grain']['cog_frame']['layout'] = int(self.meta['grain']['cog_frame']['layout'])
         self.components = VideoGrain.COMPONENT_LIST(self)
 
     @property
+    @deprecated(version="4.0.0", reason="Referencing `format` directly is deprecated in favour of `cog_frame_format`")
     def format(self) -> CogFrameFormat:
         return CogFrameFormat(self.meta['grain']['cog_frame']['format'])
 
     @format.setter
+    @deprecated(version="4.0.0", reason="Referencing `format` directly is deprecated in favour of `cog_frame_format`")
     def format(self, value: CogFrameFormat) -> None:
         self.meta['grain']['cog_frame']['format'] = int(value)
 
     @property
     def cog_frame_format(self) -> CogFrameFormat:
         return CogFrameFormat(self.meta['grain']['cog_frame']['format'])
 
@@ -474,18 +477,20 @@
         return self.meta['grain']['cog_frame']['height']
 
     @height.setter
     def height(self, value: int) -> None:
         self.meta['grain']['cog_frame']['height'] = value
 
     @property
+    @deprecated(version="4.0.0", reason="Referencing `layout` directly is deprecated in favour of `cog_frame_layout`")
     def layout(self) -> CogFrameLayout:
         return CogFrameLayout(self.meta['grain']['cog_frame']['layout'])
 
     @layout.setter
+    @deprecated(version="4.0.0", reason="Referencing `layout` directly is deprecated in favour of `cog_frame_layout`")
     def layout(self, value: CogFrameLayout) -> None:
         self.meta['grain']['cog_frame']['layout'] = int(value)
 
     @property
     def cog_frame_layout(self) -> CogFrameLayout:
         return CogFrameLayout(self.meta['grain']['cog_frame']['layout'])
```

### Comparing `mediagrains-3.5.2/mediagrains/gsf.py` & `mediagrains-4.0.0/mediagrains/gsf.py`

 * *Files 4% similar despite different names*

```diff
@@ -44,15 +44,16 @@
     cast,
     Union,
     Type,
     IO,
     Sequence,
     AsyncIterable,
     Awaitable,
-    overload)
+    overload,
+    NamedTuple)
 from typing_extensions import TypedDict
 from .typing import GrainMetadataDict, RationalTypes, ParseGrainType
 
 from .grains import VideoGrain, EventGrain, AudioGrain, CodedAudioGrain, CodedVideoGrain
 
 from .utils.asyncbinaryio import AsyncBinaryIO, OpenAsyncBinaryIO, AsyncFileWrapper, OpenAsyncFileWrapper
 
@@ -215,15 +216,15 @@
         The file type string"""
     def __init__(self, msg, i, filetype):
         super(GSFDecodeBadFileTypeError, self).__init__(msg, i, 8)
         self.filetype = filetype
 
 
 class GSFDecodeBadVersionError(GSFDecodeError):
-    """The version was not 7.0
+    """The version was unsupported
 
     properties:
 
     major
         The major version detected
 
     minor
@@ -237,22 +238,32 @@
 class AsyncGSFBlock():
     """A single block in a GSF file
 
     Has methods to read various types from the block.
     Can also be used as an async context manager, in which case it will automatically decode the block tag and size,
     exposed by the `tag` and `size` attributes.
     """
-    def __init__(self, file_data: OpenAsyncBinaryIO, want_tag: Optional[str] = None, raise_on_wrong_tag: bool = False):
+    def __init__(
+        self,
+        file_data: Union[OpenAsyncBinaryIO, "AsyncGSFBlock"],
+        want_tag: Optional[str] = None,
+        raise_on_wrong_tag: bool = False
+    ):
         """Constructor. Records the start byte of the block in `block_start`
 
-        :param file_data: An instance of io.BufferedReader positioned at the start of the block
+        :param file_data: An instance of io.BufferedReader or AsyncGSFBlock positioned at the start of the block
         :param want_tag: If set to a tag string, and in a context manager, skip any block without that tag
         :param raise_on_wrong_tag: Set to True to raise a GSFDecodeError if the next block isn't `want_tag`
         """
-        self.file_data = file_data
+        self.file_data: OpenAsyncBinaryIO
+        if isinstance(file_data, AsyncGSFBlock):
+            block = file_data
+            self.file_data = block.file_data
+        else:
+            self.file_data = file_data
         self.want_tag = want_tag
         self.raise_on_wrong_tag = raise_on_wrong_tag
 
         self.size: Optional[int] = None
         self.block_start = self.file_data.tell()  # In binary mode, this should always be in bytes
 
     async def __aenter__(self) -> "AsyncGSFBlock":
@@ -262,14 +273,16 @@
         - If tag doesn't decode, a GSFDecodeError should be raised
         - If want_tag was supplied to the constructor, skip blocks that don't have that tag
         - Unless raise_on_wrong_tag was also supplied, in which case raise
 
         :returns: Instance of GSFBlock
         :raises GSFDecodeError: If the block tag failed to decode as UTF-8, or an unwanted tag was found
         """
+        assert self.file_data.tell() == self.block_start, "Can't enter context manager after the block start"
+
         while True:
             tag_bytes = await self.file_data.read(4)
 
             try:
                 self.tag = tag_bytes.decode(encoding="utf-8")
             except UnicodeDecodeError:
                 raise GSFDecodeError(
@@ -338,14 +351,36 @@
         Only works in a context manager, will raise an AssertionError if not
 
         :returns: Number of bytes left in the block
         """
         assert self.size is not None, "get_remaining() only works in a context manager"
         return (self.block_start + self.size) - self.file_data.tell()
 
+    async def read_remaining_block(self) -> "SyncGSFBlock":
+        """Reads the remaining data into a SyncGSFBlock
+        """
+        assert self.size is not None, "read_remaining_block() only works in a context manager"
+
+        start = self.file_data.tell()
+
+        bytes_remaining = self.get_remaining()
+        if bytes_remaining > 0:
+            buffer = await self.file_data.read(bytes_remaining)
+        else:
+            buffer = bytes()
+
+        block = SyncGSFBlock(BytesIO(buffer), file_data_start=start)
+
+        # Copy the state that would be set when entering the context manager
+        block.size = self.size
+        block.tag = self.tag
+        block.block_start = self.block_start
+
+        return block
+
     async def read_uint(self, length) -> int:
         """Read an unsigned integer of length `length`
 
         :param length: Number of bytes used to store the integer
         :returns: Unsigned integer
         :raises EOFError: If there are fewer than `length` bytes left in the source
         """
@@ -355,145 +390,83 @@
         if len(uint_bytes) != length:
             raise EOFError("Unable to read enough bytes from source")
 
         for n in range(0, length):
             r += (uint_bytes[n] << (n*8))
         return r
 
-    async def read_bool(self):
-        """Read a boolean value
-
-        :returns: Boolean value
-        :raises EOFError: If there are no more bytes left in the source"""
-        n = await self.read_uint(1)
-        return (n != 0)
-
-    async def read_sint(self, length: int) -> int:
-        """Read a 2's complement signed integer
-
-        :param length: Number of bytes used to store the integer
-        :returns: Signed integer
-        :raises EOFError: If there are fewer than `length` bytes left in the source
-        """
-        r = await self.read_uint(length)
-        if (r >> ((8*length) - 1)) == 1:
-            r -= (1 << (8*length))
-        return r
-
     async def read_string(self, length: int) -> str:
         """Read a fixed-length string, treating it as UTF-8
 
         :param length: Number of bytes in the string
         :returns: String
         :raises EOFError: If there are fewer than `length` bytes left in the source
         """
         string_data = await self.file_data.read(length)
         if (len(string_data) != length):
             raise EOFError("Unable to read enough bytes from source")
 
         return string_data.decode(encoding='utf-8')
 
-    async def read_varstring(self) -> str:
-        """Read a variable length string
-
-        Reads a 2 byte uint to get the string length, then reads a string of that length
-
-        :returns: String
-        :raises EOFError: If there are too few bytes left in the source
-        """
-        length = await self.read_uint(2)
-        return await self.read_string(length)
-
-    async def read_uuid(self) -> UUID:
-        """Read a UUID
-
-        :returns: UUID
-        :raises EOFError: If there are fewer than l bytes left in the source
-        """
-        uuid_data = await self.file_data.read(16)
-
-        if (len(uuid_data) != 16):
-            raise EOFError("Unable to read enough bytes from source")
-
-        return UUID(bytes=uuid_data)
-
-    async def read_timestamp(self) -> datetime:
-        """Read a date-time (with seconds resolution) stored in 7 bytes
-
-        :returns: Datetime
-        :raises EOFError: If there are fewer than 7 bytes left in the source
-        """
-        year = await self.read_sint(2)
-        month = await self.read_uint(1)
-        day = await self.read_uint(1)
-        hour = await self.read_uint(1)
-        minute = await self.read_uint(1)
-        second = await self.read_uint(1)
-        return datetime(year, month, day, hour, minute, second)
-
-    async def read_ippts(self) -> Timestamp:
-        """Read a mediatimestamp.Timestamp
-
-        :returns: Timestamp
-        :raises EOFError: If there are fewer than 10 bytes left in the source
-        """
-        secs = await self.read_uint(6)
-        nano = await self.read_uint(4)
-        return Timestamp(secs, nano)
-
-    async def read_rational(self) -> Fraction:
-        """Read a rational (fraction)
-
-        If numerator or denominator is 0, returns Fraction(0)
-
-        :returns: fraction.Fraction
-        :raises EOFError: If there are fewer than 8 bytes left in the source
-        """
-        numerator = await self.read_uint(4)
-        denominator = await self.read_uint(4)
-        if numerator == 0 or denominator == 0:
-            return Fraction(0)
-        else:
-            return Fraction(numerator, denominator)
-
-
-# This is a near duplicate of the async code above, and should be refactored out
 
 class SyncGSFBlock():
     """A single block in a GSF file
 
     Has methods to read various types from the block.
     Can also be used as a context manager, in which case it will automatically decode the block tag and size, exposed
     by the `tag` and `size` attributes.
     """
-    def __init__(self, file_data: IO[bytes], want_tag: Optional[str] = None, raise_on_wrong_tag: bool = False):
+    def __init__(
+        self,
+        file_data: Union[IO[bytes], "SyncGSFBlock"],
+        file_data_start: int = 0,
+        want_tag: Optional[str] = None,
+        raise_on_wrong_tag: bool = False
+    ):
         """Constructor. Records the start byte of the block in `block_start`
 
-        :param file_data: An instance of io.BufferedReader positioned at the start of the block
+        :param file_data: An instance of io.BufferedReader or SyncGSFBlock positioned at the start of this block
+        :param file_data_start: Base file position of first byte in file_data. Ignored if file_data is a SyncGSFBlock
         :param want_tag: If set to a tag string, and in a context manager, skip any block without that tag
         :param raise_on_wrong_tag: Set to True to raise a GSFDecodeError if the next block isn't `want_tag`
         """
-        self.file_data = file_data
+        self.file_data: IO[bytes]
+        self.file_data_start: int
+        if isinstance(file_data, SyncGSFBlock):
+            block = file_data
+            self.file_data = block.file_data
+            self.file_data_start = block.file_data_start
+        else:
+            self.file_data = cast(IO[bytes], file_data)
+            self.file_data_start = file_data_start
         self.want_tag = want_tag
         self.raise_on_wrong_tag = raise_on_wrong_tag
 
         self.size: Optional[int] = None
-        self.block_start = self.file_data.tell()  # In binary mode, this should always be in bytes
+        self.block_start = self._base_file_tell()  # In binary mode, this should always be in bytes
+
+    def _base_file_tell(self) -> int:
+        """Return the position in the base file using the base file offset self.file_data_start"""
+        return self.file_data_start + self.file_data.tell()
 
     def __enter__(self) -> "SyncGSFBlock":
         """When used as a context manager, read block size and tag on entry
 
         - When entering a block, tag and size should be read
         - If tag doesn't decode, a GSFDecodeError should be raised
         - If want_tag was supplied to the constructor, skip blocks that don't have that tag
         - Unless raise_on_wrong_tag was also supplied, in which case raise
 
         :returns: Instance of GSFBlock
         :raises GSFDecodeError: If the block tag failed to decode as UTF-8, or an unwanted tag was found
         """
+        assert self._base_file_tell() == self.block_start, "Can't enter context manager after the block start"
+
+        # NOTE: Ensure that changes to the state set here is also changed in read_remaining_block
+        # in SyncGSFBlock and AsyncGSFBlock
         while True:
             tag_bytes = self.file_data.read(4)
 
             try:
                 self.tag = tag_bytes.decode(encoding="utf-8")
             except UnicodeDecodeError:
                 raise GSFDecodeError(
@@ -505,21 +478,21 @@
 
             if self.want_tag is None or self.tag == self.want_tag:
                 return self
             elif self.tag != self.want_tag and self.raise_on_wrong_tag:
                 raise GSFDecodeError("Wanted tag {} but got {} at {}".format(self.want_tag, self.tag, self.block_start),
                                      self.block_start)
             else:
-                self.file_data.seek(self.block_start + self.size, SEEK_SET)
-                self.block_start = self.file_data.tell()
+                self.file_data.seek(self.block_start + self.size - self.file_data_start, SEEK_SET)
+                self.block_start = self._base_file_tell()
 
     def __exit__(self, *args):
         """When used as a context manager, exiting context should seek to the block end"""
         try:
-            self.file_data.seek(self.block_start + self.size, SEEK_SET)
+            self.file_data.seek(self.block_start + self.size - self.file_data_start, SEEK_SET)
         except Exception:
             pass
 
     def has_child_block(self, strict_blocks=True):
         """Checks if there is space for another child block in this block
 
         Returns true if there is space for another child block (i.e. >= 8 bytes) in this block.
@@ -533,15 +506,15 @@
         """
         assert self.size is not None, "has_child_block() only works in a context manager"
 
         bytes_remaining = self.get_remaining()
         if bytes_remaining >= 8:
             return True
         elif bytes_remaining != 0 and strict_blocks:
-            position = self.file_data.tell()
+            position = self._base_file_tell()
             raise GSFDecodeError("Found a partial block (or parent too small) in '{}' at {}".format(self.tag, position),
                                  position)
         else:
             return False
 
     def child_blocks(self, strict_blocks=True):
         """Generator for each child block - each yielded block sits within the context manager
@@ -549,26 +522,48 @@
         Must be used in a context manager.
 
         :param strict_blocks: Set to True to raise if a partial block is found
         :yields: GSFBlock for child (already acting as a context manager)
         :raises GSFDecodeError: If there is a partial block and strict=True
         """
         while self.has_child_block(strict_blocks=strict_blocks):
-            with SyncGSFBlock(self.file_data) as child_block:
+            with SyncGSFBlock(self) as child_block:
                 yield child_block
 
     def get_remaining(self):
         """Get the number of bytes left in this block
 
         Only works in a context manager, will raise an AssertionError if not
 
         :returns: Number of bytes left in the block
         """
         assert self.size is not None, "get_remaining() only works in a context manager"
-        return (self.block_start + self.size) - self.file_data.tell()
+        return (self.block_start + self.size) - (self.file_data_start + self.file_data.tell())
+
+    def read_remaining_block(self) -> "SyncGSFBlock":
+        """Reads the remaining data into a SyncGSFBlock
+        """
+        assert self.size is not None, "read_remaining_block() only works in a context manager"
+
+        start = self._base_file_tell()
+
+        bytes_remaining = self.get_remaining()
+        if bytes_remaining > 0:
+            buffer = self.file_data.read(bytes_remaining)
+        else:
+            buffer = bytes()
+
+        block = SyncGSFBlock(BytesIO(buffer), file_data_start=start)
+
+        # Copy the state that would be set when entering the context manager
+        block.size = self.size
+        block.tag = self.tag
+        block.block_start = self.block_start
+
+        return block
 
     def read_uint(self, length) -> int:
         """Read an unsigned integer of length `length`
 
         :param length: Number of bytes used to store the integer
         :returns: Unsigned integer
         :raises EOFError: If there are fewer than `length` bytes left in the source
@@ -610,15 +605,18 @@
         :returns: String
         :raises EOFError: If there are fewer than `length` bytes left in the source
         """
         string_data = self.file_data.read(length)
         if (len(string_data) != length):
             raise EOFError("Unable to read enough bytes from source")
 
-        return string_data.decode(encoding='utf-8')
+        string = string_data.decode(encoding='utf-8').rstrip('\x00')
+        if not string or string[0] == '\x00':
+            return ""
+        return string
 
     def read_varstring(self) -> str:
         """Read a variable length string
 
         Reads a 2 byte uint to get the string length, then reads a string of that length
 
         :returns: String
@@ -636,38 +634,52 @@
         uuid_data = self.file_data.read(16)
 
         if (len(uuid_data) != 16):
             raise EOFError("Unable to read enough bytes from source")
 
         return UUID(bytes=uuid_data)
 
-    def read_timestamp(self) -> datetime:
+    def read_datetime(self) -> datetime:
         """Read a date-time (with seconds resolution) stored in 7 bytes
 
         :returns: Datetime
         :raises EOFError: If there are fewer than 7 bytes left in the source
         """
         year = self.read_sint(2)
         month = self.read_uint(1)
         day = self.read_uint(1)
         hour = self.read_uint(1)
         minute = self.read_uint(1)
         second = self.read_uint(1)
         return datetime(year, month, day, hour, minute, second)
 
-    def read_ippts(self) -> Timestamp:
-        """Read a mediatimestamp.Timestamp
+    def read_timestamp_v7(self) -> Timestamp:
+        """Read a version 7 mediatimestamp.Timestamp with no sign
 
         :returns: Timestamp
         :raises EOFError: If there are fewer than 10 bytes left in the source
         """
         secs = self.read_uint(6)
         nano = self.read_uint(4)
         return Timestamp(secs, nano)
 
+    def read_timestamp(self) -> Timestamp:
+        """Read a mediatimestamp.Timestamp
+
+        :returns: Timestamp
+        :raises EOFError: If there are fewer than 11 bytes left in the source
+        """
+        if self.read_bool():
+            sign = 1
+        else:
+            sign = -1
+        secs = self.read_uint(6)
+        nano = self.read_uint(4)
+        return Timestamp(secs, nano, sign)
+
     def read_rational(self) -> Fraction:
         """Read a rational (fraction)
 
         If numerator or denominator is 0, returns Fraction(0)
 
         :returns: fraction.Fraction
         :raises EOFError: If there are fewer than 8 bytes left in the source
@@ -675,14 +687,32 @@
         numerator = self.read_uint(4)
         denominator = self.read_uint(4)
         if numerator == 0 or denominator == 0:
             return Fraction(0)
         else:
             return Fraction(numerator, denominator)
 
+    def read_varbytes(self) -> bytes:
+        """Read a variable length byte array
+
+        Reads a 4 byte uint to get the byte array length, then reads bytes of that length
+
+        :returns: bytes
+        :raises EOFError: If there are too few bytes left in the source
+        """
+        length = self.read_uint(4)
+        return self.file_data.read(length)
+
+    def skip(self, length: int) -> None:
+        """Skip length bytes
+
+        :param length: Number of bytes to skip
+        """
+        self.file_data.seek(length, SEEK_CUR)
+
 
 class GrainDataLoadingMode (Enum):
     """This enumeration describes the mode for loading grains from the input.
 
     For a Non-seekable input:
         LOAD_IMMEDIATELY -- Grain data will be read as the stream is processed
         ALWAYS_LOAD_DEFER_IF_POSSIBLE -- Grain data will be read as the stream is processed
@@ -701,243 +731,264 @@
     """
     LOAD_IMMEDIATELY = 0
     ALWAYS_LOAD_DEFER_IF_POSSIBLE = 1
     ALWAYS_DEFER_LOAD_IF_POSSIBLE = 2
     LOAD_NEVER = 3
 
 
-class GSFAsyncDecoderSession(object):
-    def __init__(self,
-                 parse_grain: ParseGrainType,
-                 file_data: OpenAsyncBinaryIO,
-                 sync_compatibility_mode: bool):
-        self.file_data = file_data
-
-        if not self.file_data.seekable_forwards():
-            raise RuntimeError("Cannot decode a stream that is not at least forward seekable")
-
-        self.Grain = parse_grain
-        self.file_headers: Optional[GSFFileHeaderDict] = None
+class BaseGSFDecoderSession(object):
+    """Base class that provides methods for parsing header metadata from a buffered SyncGSFBlock"""
+    def __init__(self):
+        self.major = 0
+        self.minor = 0
 
-        self._exiting = False
-        self._unloaded_lazy_grains: Dict[int, Grain] = {}
-        self._next_lazy_grain_number = 0
-
-        self._sync_compatibility_mode = sync_compatibility_mode
-
-    async def _decode_ssb_header(self):
-        """Find and read the SSB header in the GSF file
-
-        :returns: (major, minor) version tuple
-        :raises GSFDecodeBadFileTypeError: If the SSB tag shows this isn't a GSF file
-        """
-        ssb_block = AsyncGSFBlock(self.file_data)
-
-        tag = await ssb_block.read_string(8)
-
-        if tag != "SSBBgrsg":
-            raise GSFDecodeBadFileTypeError("File lacks correct header", ssb_block.block_start, tag)
-
-        major = await ssb_block.read_uint(2)
-        minor = await ssb_block.read_uint(2)
-
-        return (major, minor)
-
-    async def _decode_head(self,
-                           head_block: AsyncGSFBlock) -> GSFFileHeaderDict:
+    def _sync_decode_head(self,
+                          head_block: SyncGSFBlock) -> GSFFileHeaderDict:
         """Decode the "head" block and extract ID, created date, segments and tags
 
-        :param head_block: GSFBlock representing the "head" block
+        :param head_block: SyncGSFBlock representing the "head" block
         :returns: Head block as a dict
         """
         head: GSFFileHeaderDict = {}
-        head['id'] = await head_block.read_uuid()
-        head['created'] = await head_block.read_timestamp()
+        head['id'] = head_block.read_uuid()
+        head['created'] = head_block.read_datetime()
 
         head['segments'] = []
         head['tags'] = []
 
         # Read head block children
-        async for head_child in head_block.child_blocks():
+        for head_child in head_block.child_blocks():
             # Parse a segment block
             if head_child.tag == "segm":
                 segm = {}
-                segm['local_id'] = await head_child.read_uint(2)
-                segm['id'] = await head_child.read_uuid()
-                segm['count'] = await head_child.read_sint(8)
+                segm['local_id'] = head_child.read_uint(2)
+                segm['id'] = head_child.read_uuid()
+                segm['count'] = head_child.read_sint(8)
                 segm['tags'] = []
 
                 # Segment blocks can have child tags as well
                 while head_child.has_child_block():
-                    async with AsyncGSFBlock(self.file_data) as segm_tag:
-                        if segm_tag.tag == "tag ":
-                            key = await segm_tag.read_varstring()
-                            value = await segm_tag.read_varstring()
+                    with SyncGSFBlock(head_block) as segm_child:
+                        if segm_child.tag == "flow":
+                            src_id = segm_child.read_uuid()
+                            flow_id = segm_child.read_uuid()
+                            format = segm_child.read_string(64)
+                            data = segm_child.read_varbytes()
+                            segm['flow'] = {
+                                'source_id': src_id,
+                                'flow_id': flow_id,
+                                'format': format,
+                                'data': data.decode('utf-8')
+                            }
+                        elif segm_child.tag == "tag ":
+                            key = segm_child.read_varstring()
+                            value = segm_child.read_varstring()
                             segm['tags'].append((key, value))
 
                 head['segments'].append(segm)
 
             # Parse a tag block
             elif head_child.tag == "tag ":
-                key = await head_child.read_varstring()
-                value = await head_child.read_varstring()
+                key = head_child.read_varstring()
+                value = head_child.read_varstring()
                 head['tags'].append((key, value))
 
         return cast(GSFFileHeaderDict, head)
 
-    async def _decode_tils(self, tils_block: AsyncGSFBlock) -> List[dict]:
+    def _sync_decode_tils(self, tils_block: SyncGSFBlock) -> List[dict]:
         """Decode timelabels (tils) block
 
-        :param tils_block: Instance of GSFBlock() representing a "gbhd" block
+        :param tils_block: Instance of SyncGSFBlock() representing a "gbhd" block
         :returns: tils block as a dict
         """
         tils = []
-        timelabel_count = await tils_block.read_uint(2)
+        timelabel_count = tils_block.read_uint(2)
         for i in range(0, timelabel_count):
-            tag = await tils_block.read_string(16)
+            tag = tils_block.read_string(16)
             tag = tag.strip("\x00")
-            count = await tils_block.read_uint(4)
-            rate = await tils_block.read_rational()
-            drop = await tils_block.read_bool()
+            count = tils_block.read_uint(4)
+            rate = tils_block.read_rational()
+            drop = tils_block.read_bool()
 
             tils.append({'tag': tag,
                          'timelabel': {'frames_since_midnight': count,
                                        'frame_rate_numerator': rate.numerator,
                                        'frame_rate_denominator': rate.denominator,
                                        'drop_frame': drop}})
 
         return tils
 
-    async def _decode_gbhd(self, gbhd_block: AsyncGSFBlock) -> GrainMetadataDict:
+    def _sync_decode_gbhd(self, gbhd_block: SyncGSFBlock) -> GrainMetadataDict:
         """Decode grain block header ("gbhd") to get grain metadata
 
         :param gbhd_block: Instance of GSFBlock() representing a "gbhd" block
         :returns: Grain data dict
         :raises GSFDecodeError: If "gbhd" block contains an unkown child block
         """
         meta: dict = {
             "grain": {
             }
         }
 
-        meta['grain']['source_id'] = await gbhd_block.read_uuid()
-        meta['grain']['flow_id'] = await gbhd_block.read_uuid()
-        self.file_data.seek(16, 1)  # Skip over deprecated byte array
-        meta['grain']['origin_timestamp'] = await gbhd_block.read_ippts()
-        meta['grain']['sync_timestamp'] = await gbhd_block.read_ippts()
-        meta['grain']['rate'] = await gbhd_block.read_rational()
-        meta['grain']['duration'] = await gbhd_block.read_rational()
+        meta['grain']['source_id'] = gbhd_block.read_uuid()
+        meta['grain']['flow_id'] = gbhd_block.read_uuid()
+        if self.major == 7:
+            gbhd_block.skip(16)  # Skip over deprecated byte array
+            meta['grain']['origin_timestamp'] = gbhd_block.read_timestamp_v7()
+            meta['grain']['sync_timestamp'] = gbhd_block.read_timestamp_v7()
+        else:
+            meta['grain']['origin_timestamp'] = gbhd_block.read_timestamp()
+            meta['grain']['sync_timestamp'] = gbhd_block.read_timestamp()
+        meta['grain']['rate'] = gbhd_block.read_rational()
+        meta['grain']['duration'] = gbhd_block.read_rational()
 
-        async for gbhd_child in gbhd_block.child_blocks():
+        for gbhd_child in gbhd_block.child_blocks():
             if gbhd_child.tag == "tils":
-                meta['grain']['timelabels'] = await self._decode_tils(gbhd_child)
+                meta['grain']['timelabels'] = self._sync_decode_tils(gbhd_child)
             elif gbhd_child.tag == "vghd":
                 meta['grain']['grain_type'] = 'video'
                 meta['grain']['cog_frame'] = {}
-                meta['grain']['cog_frame']['format'] = await gbhd_child.read_uint(4)
-                meta['grain']['cog_frame']['layout'] = await gbhd_child.read_uint(4)
-                meta['grain']['cog_frame']['width'] = await gbhd_child.read_uint(4)
-                meta['grain']['cog_frame']['height'] = await gbhd_child.read_uint(4)
-                meta['grain']['cog_frame']['extension'] = await gbhd_child.read_uint(4)
+                meta['grain']['cog_frame']['format'] = gbhd_child.read_uint(4)
+                meta['grain']['cog_frame']['layout'] = gbhd_child.read_uint(4)
+                meta['grain']['cog_frame']['width'] = gbhd_child.read_uint(4)
+                meta['grain']['cog_frame']['height'] = gbhd_child.read_uint(4)
+                meta['grain']['cog_frame']['extension'] = gbhd_child.read_uint(4)
 
-                src_aspect_ratio = await gbhd_child.read_rational()
+                src_aspect_ratio = gbhd_child.read_rational()
                 if src_aspect_ratio != 0:
                     meta['grain']['cog_frame']['source_aspect_ratio'] = {
                         'numerator': src_aspect_ratio.numerator,
                         'denominator': src_aspect_ratio.denominator
                     }
 
-                pixel_aspect_ratio = await gbhd_child.read_rational()
+                pixel_aspect_ratio = gbhd_child.read_rational()
                 if pixel_aspect_ratio != 0:
                     meta['grain']['cog_frame']['pixel_aspect_ratio'] = {
                         'numerator': pixel_aspect_ratio.numerator,
                         'denominator': pixel_aspect_ratio.denominator
                     }
 
                 meta['grain']['cog_frame']['components'] = []
-                if gbhd_child.has_child_block():
-                    async with AsyncGSFBlock(self.file_data) as comp_block:
-                        if comp_block.tag != "comp":
-                            continue  # Skip unknown/unexpected block
-
-                        comp_count = await comp_block.read_uint(2)
-                        offset = 0
-                        for i in range(0, comp_count):
-                            comp = {}
-                            comp['width'] = await comp_block.read_uint(4)
-                            comp['height'] = await comp_block.read_uint(4)
-                            comp['stride'] = await comp_block.read_uint(4)
-                            comp['length'] = await comp_block.read_uint(4)
-                            comp['offset'] = offset
-                            offset += comp['length']
-                            meta['grain']['cog_frame']['components'].append(comp)
+                for comp_block in gbhd_child.child_blocks():
+                    if comp_block.tag != 'comp':
+                        continue
+
+                    # Guard against bad files with multiple 'comp'
+                    meta['grain']['cog_frame']['components'] = []
+
+                    comp_count = comp_block.read_uint(2)
+                    offset = 0
+                    for i in range(0, comp_count):
+                        comp = {}
+                        comp['width'] = comp_block.read_uint(4)
+                        comp['height'] = comp_block.read_uint(4)
+                        comp['stride'] = comp_block.read_uint(4)
+                        comp['length'] = comp_block.read_uint(4)
+                        comp['offset'] = offset
+                        offset += comp['length']
+                        meta['grain']['cog_frame']['components'].append(comp)
 
             elif gbhd_child.tag == 'cghd':
                 meta['grain']['grain_type'] = "coded_video"
                 meta['grain']['cog_coded_frame'] = {}
-                meta['grain']['cog_coded_frame']['format'] = await gbhd_child.read_uint(4)
-                meta['grain']['cog_coded_frame']['layout'] = await gbhd_child.read_uint(4)
-                meta['grain']['cog_coded_frame']['origin_width'] = await gbhd_child.read_uint(4)
-                meta['grain']['cog_coded_frame']['origin_height'] = await gbhd_child.read_uint(4)
-                meta['grain']['cog_coded_frame']['coded_width'] = await gbhd_child.read_uint(4)
-                meta['grain']['cog_coded_frame']['coded_height'] = await gbhd_child.read_uint(4)
-                meta['grain']['cog_coded_frame']['is_key_frame'] = await gbhd_child.read_bool()
-                meta['grain']['cog_coded_frame']['temporal_offset'] = await gbhd_child.read_sint(4)
-
-                if gbhd_child.has_child_block():
-                    async with AsyncGSFBlock(self.file_data) as unof_block:
-                        meta['grain']['cog_coded_frame']['unit_offsets'] = []
-
-                        unit_offsets = await unof_block.read_uint(2)
-                        for i in range(0, unit_offsets):
-                            meta['grain']['cog_coded_frame']['unit_offsets'].append(await unof_block.read_uint(4))
+                meta['grain']['cog_coded_frame']['format'] = gbhd_child.read_uint(4)
+                meta['grain']['cog_coded_frame']['layout'] = gbhd_child.read_uint(4)
+                meta['grain']['cog_coded_frame']['origin_width'] = gbhd_child.read_uint(4)
+                meta['grain']['cog_coded_frame']['origin_height'] = gbhd_child.read_uint(4)
+                meta['grain']['cog_coded_frame']['coded_width'] = gbhd_child.read_uint(4)
+                meta['grain']['cog_coded_frame']['coded_height'] = gbhd_child.read_uint(4)
+                meta['grain']['cog_coded_frame']['is_key_frame'] = gbhd_child.read_bool()
+                meta['grain']['cog_coded_frame']['temporal_offset'] = gbhd_child.read_sint(4)
+
+                for unof_block in gbhd_child.child_blocks():
+                    if unof_block.tag != 'unof':
+                        continue
+
+                    meta['grain']['cog_coded_frame']['unit_offsets'] = []
+
+                    unit_offsets = unof_block.read_uint(2)
+                    for i in range(0, unit_offsets):
+                        meta['grain']['cog_coded_frame']['unit_offsets'].append(unof_block.read_uint(4))
 
             elif gbhd_child.tag == "aghd":
                 meta['grain']['grain_type'] = "audio"
                 meta['grain']['cog_audio'] = {}
-                meta['grain']['cog_audio']['format'] = await gbhd_child.read_uint(4)
-                meta['grain']['cog_audio']['channels'] = await gbhd_child.read_uint(2)
-                meta['grain']['cog_audio']['samples'] = await gbhd_child.read_uint(4)
-                meta['grain']['cog_audio']['sample_rate'] = await gbhd_child.read_uint(4)
+                meta['grain']['cog_audio']['format'] = gbhd_child.read_uint(4)
+                meta['grain']['cog_audio']['channels'] = gbhd_child.read_uint(2)
+                meta['grain']['cog_audio']['samples'] = gbhd_child.read_uint(4)
+                meta['grain']['cog_audio']['sample_rate'] = gbhd_child.read_uint(4)
 
             elif gbhd_child.tag == "cahd":
                 meta['grain']['grain_type'] = "coded_audio"
                 meta['grain']['cog_coded_audio'] = {}
-                meta['grain']['cog_coded_audio']['format'] = await gbhd_child.read_uint(4)
-                meta['grain']['cog_coded_audio']['channels'] = await gbhd_child.read_uint(2)
-                meta['grain']['cog_coded_audio']['samples'] = await gbhd_child.read_uint(4)
-                meta['grain']['cog_coded_audio']['priming'] = await gbhd_child.read_uint(4)
-                meta['grain']['cog_coded_audio']['remainder'] = await gbhd_child.read_uint(4)
-                meta['grain']['cog_coded_audio']['sample_rate'] = await gbhd_child.read_uint(4)
+                meta['grain']['cog_coded_audio']['format'] = gbhd_child.read_uint(4)
+                meta['grain']['cog_coded_audio']['channels'] = gbhd_child.read_uint(2)
+                meta['grain']['cog_coded_audio']['samples'] = gbhd_child.read_uint(4)
+                meta['grain']['cog_coded_audio']['priming'] = gbhd_child.read_uint(4)
+                meta['grain']['cog_coded_audio']['remainder'] = gbhd_child.read_uint(4)
+                meta['grain']['cog_coded_audio']['sample_rate'] = gbhd_child.read_uint(4)
 
             elif gbhd_child.tag == "eghd":
                 meta['grain']['grain_type'] = "event"
-            else:
-                raise GSFDecodeError(
-                    "Unknown type {} at offset {}".format(gbhd_child.tag, gbhd_child.block_start),
-                    gbhd_child.block_start,
-                    length=gbhd_child.size
-                )
 
         return cast(GrainMetadataDict, meta)
 
+
+class GSFAsyncDecoderSession(BaseGSFDecoderSession):
+    def __init__(self,
+                 parse_grain: ParseGrainType,
+                 file_data: OpenAsyncBinaryIO,
+                 sync_compatibility_mode: bool):
+        super().__init__()
+        self.file_data = file_data
+
+        if not self.file_data.seekable_forwards():
+            raise RuntimeError("Cannot decode a stream that is not at least forward seekable")
+
+        self.Grain = parse_grain
+        self.file_headers: Optional[GSFFileHeaderDict] = None
+
+        self._exiting = False
+        self._unloaded_lazy_grains: Dict[int, Grain] = {}
+        self._next_lazy_grain_number = 0
+
+        self._sync_compatibility_mode = sync_compatibility_mode
+
+    async def _decode_ssb_header(self):
+        """Find and read the SSB header in the GSF file
+
+        :returns: (major, minor) version tuple
+        :raises GSFDecodeBadFileTypeError: If the SSB tag shows this isn't a GSF file
+        """
+        ssb_block = AsyncGSFBlock(self.file_data)
+
+        tag = await ssb_block.read_string(8)
+
+        if tag != "SSBBgrsg":
+            raise GSFDecodeBadFileTypeError("File lacks correct header", ssb_block.block_start, tag)
+
+        major = await ssb_block.read_uint(2)
+        minor = await ssb_block.read_uint(2)
+
+        return (major, minor)
+
     async def _decode_file_headers(self) -> None:
         """Verify the file is a supported version, get the file header and store it in the file_headers property
 
         :raises GSFDecodeBadVersionError: If the file version is not supported
         :raises GSFDecodeBadFileTypeError: If this isn't a GSF file
         :raises GSFDecodeError: If the file doesn't have a "head" block
         """
-        (major, minor) = await self._decode_ssb_header()
-        if (major, minor) != (7, 0):
-            raise GSFDecodeBadVersionError("Unknown Version {}.{}".format(major, minor), 0, major, minor)
+        (self.major, self.minor) = await self._decode_ssb_header()
+        if self.major not in [7, 8]:
+            raise GSFDecodeBadVersionError(f"Unknown Version {self.major}.{self.minor}", 0, self.major, self.minor)
 
         try:
             async with AsyncGSFBlock(self.file_data, want_tag="head") as head_block:
-                self.file_headers = await self._decode_head(head_block)
+                self.file_headers = self._sync_decode_head(await head_block.read_remaining_block())
         except EOFError:
             raise GSFDecodeError("No head block found in file", self.file_data.tell())
 
     def _add_lazy_grain(self, key: int, grain: Grain):
         self._unloaded_lazy_grains[key] = grain
 
     def _remove_lazy_grain(self, key: int):
@@ -994,22 +1045,22 @@
                         return  # Terminator block reached
 
                     local_id = await grai_block.read_uint(2)
 
                     if local_ids is not None and local_id not in local_ids:
                         continue
 
-                    async with AsyncGSFBlock(self.file_data, want_tag="gbhd", raise_on_wrong_tag=True) as gbhd_block:
-                        meta = await self._decode_gbhd(gbhd_block)
+                    async with AsyncGSFBlock(grai_block, want_tag="gbhd", raise_on_wrong_tag=True) as gbhd_block:
+                        meta = self._sync_decode_gbhd(await gbhd_block.read_remaining_block())
 
                     data: Optional[Union[bytes, Awaitable[Optional[bytes]]]] = None
 
                     data_length = 0
                     if grai_block.has_child_block():
-                        async with AsyncGSFBlock(self.file_data, want_tag="grdt") as grdt_block:
+                        async with AsyncGSFBlock(grai_block, want_tag="grdt") as grdt_block:
                             if grdt_block.get_remaining() > 0:
                                 if self.file_data.seekable_backwards() and loading_mode in [
                                  GrainDataLoadingMode.ALWAYS_DEFER_LOAD_IF_POSSIBLE,
                                  GrainDataLoadingMode.ALWAYS_LOAD_DEFER_IF_POSSIBLE]:
                                     if not self._sync_compatibility_mode:
                                         # It is correct that this is not awaited here
                                         # It will be awaited when the data is actually needed.
@@ -1043,19 +1094,19 @@
                     self._next_lazy_grain_number += 1
 
                 yield (grain, local_id)
             except EOFError:
                 return  # We ran out of grains to read and hit EOF
 
 
-# This is almost a direct copy of the async code above, this could definitely be refactored to fix this
-class GSFSyncDecoderSession(object):
+class GSFSyncDecoderSession(BaseGSFDecoderSession):
     def __init__(self,
                  parse_grain: ParseGrainType,
                  file_data: IO[bytes]):
+        super().__init__()
         self.file_data = file_data
 
         self.Grain = parse_grain
         self.file_headers: Optional[GSFFileHeaderDict] = None
 
         self._exiting = False
 
@@ -1073,206 +1124,28 @@
             raise GSFDecodeBadFileTypeError("File lacks correct header", ssb_block.block_start, tag)
 
         major = ssb_block.read_uint(2)
         minor = ssb_block.read_uint(2)
 
         return (major, minor)
 
-    def _decode_head(self,
-                     head_block: SyncGSFBlock) -> GSFFileHeaderDict:
-        """Decode the "head" block and extract ID, created date, segments and tags
-
-        :param head_block: GSFBlock representing the "head" block
-        :returns: Head block as a dict
-        """
-        head: GSFFileHeaderDict = {}
-        head['id'] = head_block.read_uuid()
-        head['created'] = head_block.read_timestamp()
-
-        head['segments'] = []
-        head['tags'] = []
-
-        # Read head block children
-        for head_child in head_block.child_blocks():
-            # Parse a segment block
-            if head_child.tag == "segm":
-                segm = {}
-                segm['local_id'] = head_child.read_uint(2)
-                segm['id'] = head_child.read_uuid()
-                segm['count'] = head_child.read_sint(8)
-                segm['tags'] = []
-
-                # Segment blocks can have child tags as well
-                while head_child.has_child_block():
-                    with SyncGSFBlock(self.file_data) as segm_tag:
-                        if segm_tag.tag == "tag ":
-                            key = segm_tag.read_varstring()
-                            value = segm_tag.read_varstring()
-                            segm['tags'].append((key, value))
-
-                head['segments'].append(segm)
-
-            # Parse a tag block
-            elif head_child.tag == "tag ":
-                key = head_child.read_varstring()
-                value = head_child.read_varstring()
-                head['tags'].append((key, value))
-
-        return cast(GSFFileHeaderDict, head)
-
-    def _decode_tils(self, tils_block: SyncGSFBlock) -> List[dict]:
-        """Decode timelabels (tils) block
-
-        :param tils_block: Instance of GSFBlock() representing a "gbhd" block
-        :returns: tils block as a dict
-        """
-        tils = []
-        timelabel_count = tils_block.read_uint(2)
-        for i in range(0, timelabel_count):
-            tag = tils_block.read_string(16)
-            tag = tag.strip("\x00")
-            count = tils_block.read_uint(4)
-            rate = tils_block.read_rational()
-            drop = tils_block.read_bool()
-
-            tils.append({'tag': tag,
-                         'timelabel': {'frames_since_midnight': count,
-                                       'frame_rate_numerator': rate.numerator,
-                                       'frame_rate_denominator': rate.denominator,
-                                       'drop_frame': drop}})
-
-        return tils
-
-    def _decode_gbhd(self, gbhd_block: SyncGSFBlock) -> GrainMetadataDict:
-        """Decode grain block header ("gbhd") to get grain metadata
-
-        :param gbhd_block: Instance of GSFBlock() representing a "gbhd" block
-        :returns: Grain data dict
-        :raises GSFDecodeError: If "gbhd" block contains an unkown child block
-        """
-        meta: dict = {
-            "grain": {
-            }
-        }
-
-        meta['grain']['source_id'] = gbhd_block.read_uuid()
-        meta['grain']['flow_id'] = gbhd_block.read_uuid()
-        self.file_data.seek(16, 1)  # Skip over deprecated byte array
-        meta['grain']['origin_timestamp'] = gbhd_block.read_ippts()
-        meta['grain']['sync_timestamp'] = gbhd_block.read_ippts()
-        meta['grain']['rate'] = gbhd_block.read_rational()
-        meta['grain']['duration'] = gbhd_block.read_rational()
-
-        for gbhd_child in gbhd_block.child_blocks():
-            if gbhd_child.tag == "tils":
-                meta['grain']['timelabels'] = self._decode_tils(gbhd_child)
-            elif gbhd_child.tag == "vghd":
-                meta['grain']['grain_type'] = 'video'
-                meta['grain']['cog_frame'] = {}
-                meta['grain']['cog_frame']['format'] = gbhd_child.read_uint(4)
-                meta['grain']['cog_frame']['layout'] = gbhd_child.read_uint(4)
-                meta['grain']['cog_frame']['width'] = gbhd_child.read_uint(4)
-                meta['grain']['cog_frame']['height'] = gbhd_child.read_uint(4)
-                meta['grain']['cog_frame']['extension'] = gbhd_child.read_uint(4)
-
-                src_aspect_ratio = gbhd_child.read_rational()
-                if src_aspect_ratio != 0:
-                    meta['grain']['cog_frame']['source_aspect_ratio'] = {
-                        'numerator': src_aspect_ratio.numerator,
-                        'denominator': src_aspect_ratio.denominator
-                    }
-
-                pixel_aspect_ratio = gbhd_child.read_rational()
-                if pixel_aspect_ratio != 0:
-                    meta['grain']['cog_frame']['pixel_aspect_ratio'] = {
-                        'numerator': pixel_aspect_ratio.numerator,
-                        'denominator': pixel_aspect_ratio.denominator
-                    }
-
-                meta['grain']['cog_frame']['components'] = []
-                if gbhd_child.has_child_block():
-                    with SyncGSFBlock(self.file_data) as comp_block:
-                        if comp_block.tag != "comp":
-                            continue  # Skip unknown/unexpected block
-
-                        comp_count = comp_block.read_uint(2)
-                        offset = 0
-                        for i in range(0, comp_count):
-                            comp = {}
-                            comp['width'] = comp_block.read_uint(4)
-                            comp['height'] = comp_block.read_uint(4)
-                            comp['stride'] = comp_block.read_uint(4)
-                            comp['length'] = comp_block.read_uint(4)
-                            comp['offset'] = offset
-                            offset += comp['length']
-                            meta['grain']['cog_frame']['components'].append(comp)
-
-            elif gbhd_child.tag == 'cghd':
-                meta['grain']['grain_type'] = "coded_video"
-                meta['grain']['cog_coded_frame'] = {}
-                meta['grain']['cog_coded_frame']['format'] = gbhd_child.read_uint(4)
-                meta['grain']['cog_coded_frame']['layout'] = gbhd_child.read_uint(4)
-                meta['grain']['cog_coded_frame']['origin_width'] = gbhd_child.read_uint(4)
-                meta['grain']['cog_coded_frame']['origin_height'] = gbhd_child.read_uint(4)
-                meta['grain']['cog_coded_frame']['coded_width'] = gbhd_child.read_uint(4)
-                meta['grain']['cog_coded_frame']['coded_height'] = gbhd_child.read_uint(4)
-                meta['grain']['cog_coded_frame']['is_key_frame'] = gbhd_child.read_bool()
-                meta['grain']['cog_coded_frame']['temporal_offset'] = gbhd_child.read_sint(4)
-
-                if gbhd_child.has_child_block():
-                    with SyncGSFBlock(self.file_data) as unof_block:
-                        meta['grain']['cog_coded_frame']['unit_offsets'] = []
-
-                        unit_offsets = unof_block.read_uint(2)
-                        for i in range(0, unit_offsets):
-                            meta['grain']['cog_coded_frame']['unit_offsets'].append(unof_block.read_uint(4))
-
-            elif gbhd_child.tag == "aghd":
-                meta['grain']['grain_type'] = "audio"
-                meta['grain']['cog_audio'] = {}
-                meta['grain']['cog_audio']['format'] = gbhd_child.read_uint(4)
-                meta['grain']['cog_audio']['channels'] = gbhd_child.read_uint(2)
-                meta['grain']['cog_audio']['samples'] = gbhd_child.read_uint(4)
-                meta['grain']['cog_audio']['sample_rate'] = gbhd_child.read_uint(4)
-
-            elif gbhd_child.tag == "cahd":
-                meta['grain']['grain_type'] = "coded_audio"
-                meta['grain']['cog_coded_audio'] = {}
-                meta['grain']['cog_coded_audio']['format'] = gbhd_child.read_uint(4)
-                meta['grain']['cog_coded_audio']['channels'] = gbhd_child.read_uint(2)
-                meta['grain']['cog_coded_audio']['samples'] = gbhd_child.read_uint(4)
-                meta['grain']['cog_coded_audio']['priming'] = gbhd_child.read_uint(4)
-                meta['grain']['cog_coded_audio']['remainder'] = gbhd_child.read_uint(4)
-                meta['grain']['cog_coded_audio']['sample_rate'] = gbhd_child.read_uint(4)
-
-            elif gbhd_child.tag == "eghd":
-                meta['grain']['grain_type'] = "event"
-            else:
-                raise GSFDecodeError(
-                    "Unknown type {} at offset {}".format(gbhd_child.tag, gbhd_child.block_start),
-                    gbhd_child.block_start,
-                    length=gbhd_child.size
-                )
-
-        return cast(GrainMetadataDict, meta)
-
     def _decode_file_headers(self) -> None:
         """Verify the file is a supported version, get the file header and store it in the file_headers property
 
         :raises GSFDecodeBadVersionError: If the file version is not supported
         :raises GSFDecodeBadFileTypeError: If this isn't a GSF file
         :raises GSFDecodeError: If the file doesn't have a "head" block
         """
-        (major, minor) = self._decode_ssb_header()
-        if (major, minor) != (7, 0):
-            raise GSFDecodeBadVersionError("Unknown Version {}.{}".format(major, minor), 0, major, minor)
+        (self.major, self.minor) = self._decode_ssb_header()
+        if self.major not in [7, 8]:
+            raise GSFDecodeBadVersionError(f"Unknown Version {self.major}.{self.minor}", 0, self.major, self.minor)
 
         try:
             with SyncGSFBlock(self.file_data, want_tag="head") as head_block:
-                self.file_headers = self._decode_head(head_block)
+                self.file_headers = self._sync_decode_head(head_block.read_remaining_block())
         except EOFError:
             raise GSFDecodeError("No head block found in file", self.file_data.tell())
 
     def grains(self,
                local_ids: Optional[Sequence[int]] = None,
                loading_mode: GrainDataLoadingMode = GrainDataLoadingMode.ALWAYS_DEFER_LOAD_IF_POSSIBLE
                ) -> Iterable[Tuple[Grain, int]]:
@@ -1297,21 +1170,21 @@
                         return  # Terminator block reached
 
                     local_id = grai_block.read_uint(2)
 
                     if local_ids is not None and local_id not in local_ids:
                         continue
 
-                    with SyncGSFBlock(self.file_data, want_tag="gbhd", raise_on_wrong_tag=True) as gbhd_block:
-                        meta = self._decode_gbhd(gbhd_block)
+                    with SyncGSFBlock(grai_block, want_tag="gbhd", raise_on_wrong_tag=True) as gbhd_block:
+                        meta = self._sync_decode_gbhd(gbhd_block.read_remaining_block())
 
                     data: Optional[Union[bytes, Awaitable[Optional[bytes]]]] = None
 
                     if grai_block.has_child_block():
-                        with SyncGSFBlock(self.file_data, want_tag="grdt") as grdt_block:
+                        with SyncGSFBlock(grai_block, want_tag="grdt") as grdt_block:
                             if grdt_block.get_remaining() > 0:
                                 if self.file_data.seekable() and loading_mode in [
                                  GrainDataLoadingMode.ALWAYS_DEFER_LOAD_IF_POSSIBLE,
                                  GrainDataLoadingMode.ALWAYS_LOAD_DEFER_IF_POSSIBLE]:
                                     data = IOBytes(self.file_data,
                                                    self.file_data.tell(),
                                                    grdt_block.get_remaining())
@@ -1518,23 +1391,33 @@
 
 def _encode_sint(val: int, size: int) -> bytes:
     if val < 0:
         val = val + (1 << (8*size))
     return _encode_uint(val, size)
 
 
+def _encode_bool(val: bool) -> bytes:
+    return _encode_uint(1 if val else 0, 1)
+
+
 def _encode_uuid(val: UUID) -> bytes:
     return val.bytes
 
 
-def _encode_ts(ts: Timestamp) -> bytes:
+def _encode_ts_v7(ts: Timestamp) -> bytes:
     return (_encode_uint(ts.sec, 6) +
             _encode_uint(ts.ns, 4))
 
 
+def _encode_ts(ts: Timestamp) -> bytes:
+    return (_encode_bool(ts.sign >= 0) +
+            _encode_uint(ts.sec, 6) +
+            _encode_uint(ts.ns, 4))
+
+
 def _encode_rational(value: RationalTypes) -> bytes:
     value = Fraction(value)
     return (_encode_uint(value.numerator, 4) +
             _encode_uint(value.denominator, 4))
 
 
 class OpenGSFEncoderBase(object):
@@ -1854,27 +1737,27 @@
 
     If a streaming format is required then you can instead use the "start_dump" method, followed by adding
     grains as needed, and then the "end_dump" method. Each new grain will be written as it is added. In this mode
     any segments in use MUST be added first before start_dump is called.
 
     In addition the following properties provide access to file-level metadata:
 
-    major    -- an integer (default 7)
+    major    -- an integer (default 8)
     minor    -- an integer (default 0)
     id       -- a uuid.UUID
     created  -- a datetime.datetime
     tags     -- a tuple of tags
     segments -- a frozendict of GSFEncoderSegments
 
-    The current version of the library is designed for compatibility with v.7.0 of the GSF format. Setting a
+    The current version of the library is designed for compatibility with v.8.0 of the GSF format. Setting a
     different version number will simply change the reported version number in the file, but will not alter the
     syntax at all. If future versions of this code add support for other versions of GSF then this will change."""
     def __init__(self,
                  file: Union[IO[bytes], AsyncBinaryIO, OpenAsyncBinaryIO],
-                 major: int = 7,
+                 major: int = 8,
                  minor: int = 0,
                  id: Optional[UUID] = None,
                  created: Optional[datetime] = None,
                  tags: Optional[Iterable[Tuple[str, str]]] = None,
                  segments: Iterable[SegmentDict] = [],
                  streaming: bool = False):
         self.file = file
@@ -2069,14 +1952,21 @@
         all segment counts, in a non-seakable stream it will not."""
         if self._open_encoder is not None:
             self._open_encoder._end_dump()
             self._next_local = self._open_encoder._next_local
             self._open_encoder = None
 
 
+class GSFEncoderFlow(NamedTuple):
+    src_id: UUID
+    flow_id: UUID
+    format: str
+    data: bytes
+
+
 class GSFEncoderTag(object):
     """A class to represent a tag,
 
     has two properties:
 
     key
     value
@@ -2122,14 +2012,15 @@
                  parent: Optional[Union[GSFEncoder, OpenGSFEncoderBase]] = None):
         self.id = id
         self.local_id = local_id
         self._write_count = 0
         self._count_pos = -1
         self._active_dump: bool = False
         self._tags: List[GSFEncoderTag] = []
+        self._gsf_flow: Optional[GSFEncoderFlow] = None
         self._grains: List[Grain] = []
         self._parent = parent
 
         if tags is not None:
             for tag in tags:
                 try:
                     self.add_tag(tag[0], tag[1])
@@ -2145,16 +2036,22 @@
             return None
 
     @property
     def count(self) -> int:
         return len(self._grains) + self._write_count
 
     @property
+    def flow_block_size(self) -> int:
+        if self._gsf_flow is None:
+            return 0
+        return 108 + len(self._gsf_flow.data)
+
+    @property
     def segm_block_size(self) -> int:
-        return 34 + sum(tag.tag_block_size for tag in self._tags)
+        return 34 + self.flow_block_size + sum(tag.tag_block_size for tag in self._tags)
 
     @property
     def tags(self) -> Tuple[GSFEncoderTag, ...]:
         return tuple(self._tags)
 
     def get_write_count(self) -> int:
         return self._write_count
@@ -2169,14 +2066,26 @@
             _encode_uuid(self.id))
         count_pos = len(data)
         if all_at_once:
             data += _encode_sint(self.count, 8)
         else:
             data += _encode_sint(-1, 8)
 
+        if self._gsf_flow is not None:
+            data += (
+                b"flow" +
+                _encode_uint(self.flow_block_size, 4) +
+
+                _encode_uuid(self._gsf_flow.src_id) +
+                _encode_uuid(self._gsf_flow.flow_id) +
+                (self._gsf_flow.format.encode("utf-8") + (b"\x00" * 64))[:64] +
+                _encode_uint(len(self._gsf_flow.data), 4) +
+                self._gsf_flow.data
+            )
+
         for tag in self._tags:
             data += bytes(tag)
 
         return (data, count_pos)
 
     def set_size_position(self, pos: int):
         self._count_pos = pos
@@ -2188,27 +2097,33 @@
 
         self._grains = []
         return data
 
     def encode_grain(self, grain: Grain) -> bytes:
         gbhd_size = self._gbhd_size_for_grain(grain)
 
+        encode_ts_f = _encode_ts
+        version_7_deprecated_bytes = b""
+        if self._parent is not None and self._parent.major == 7:
+            encode_ts_f = _encode_ts_v7
+            version_7_deprecated_bytes = b"\x00"*16
+
         data = (
             b"grai" +
             _encode_uint(10 + gbhd_size + 8 + grain.length, 4) +
             _encode_uint(self.local_id, 2) +
 
             b"gbhd" +
             _encode_uint(gbhd_size, 4) +
 
             _encode_uuid(grain.source_id) +
             _encode_uuid(grain.flow_id) +
-            b"\x00"*16 +
-            _encode_ts(grain.origin_timestamp) +
-            _encode_ts(grain.sync_timestamp) +
+            version_7_deprecated_bytes +
+            encode_ts_f(grain.origin_timestamp) +
+            encode_ts_f(grain.sync_timestamp) +
             _encode_rational(grain.rate) +
             _encode_rational(grain.duration))
 
         if len(grain.timelabels) > 0:
             data += (
                 b"tils" +
                 _encode_uint(10 + 29*len(grain.timelabels), 4) +
@@ -2245,15 +2160,18 @@
             data += bytes(grain.data)
 
         self._write_count += 1
 
         return data
 
     def _gbhd_size_for_grain(self, grain: Grain) -> int:
-        size = 92
+        size = 78
+        if self._parent is not None and self._parent.major == 7:
+            size += 16  # deprecated bytes
+            size -= 2  # No sign byte in 2 x Timestamp
         if len(grain.timelabels) > 0:
             size += 10 + 29*len(grain.timelabels)
         if grain.grain_type == "video":
             size += self._vghd_size_for_grain(cast(VideoGrain, grain))
         elif grain.grain_type == "coded_video":
             size += self._cghd_size_for_grain(cast(CodedVideoGrain, grain))
         elif grain.grain_type == "audio":
@@ -2272,16 +2190,16 @@
             size += 10 + 16*len(grain.components)
         return size
 
     def _encode_vghd_for_grain(self, grain: VideoGrain) -> bytes:
         data = (b"vghd" +
                 _encode_uint(self._vghd_size_for_grain(grain), 4) +
 
-                _encode_uint(int(grain.format), 4) +
-                _encode_uint(int(grain.layout), 4) +
+                _encode_uint(int(grain.cog_frame_format), 4) +
+                _encode_uint(int(grain.cog_frame_layout), 4) +
                 _encode_uint(int(grain.width), 4) +
                 _encode_uint(int(grain.height), 4) +
                 _encode_uint(int(grain.extension), 4))
 
         if grain.source_aspect_ratio is None:
             data += _encode_rational(Fraction(0, 1))
         else:
@@ -2316,31 +2234,31 @@
     def _aghd_size_for_grain(self, grain: AudioGrain) -> int:
         return 22
 
     def _encode_aghd_for_grain(self, grain: AudioGrain) -> bytes:
         return (b"aghd" +
                 _encode_uint(self._aghd_size_for_grain(grain), 4) +
 
-                _encode_uint(int(grain.format), 4) +
+                _encode_uint(int(grain.cog_audio_format), 4) +
                 _encode_uint(int(grain.channels), 2) +
                 _encode_uint(int(grain.samples), 4) +
                 _encode_uint(int(grain.sample_rate), 4))
 
     def _cghd_size_for_grain(self, grain: CodedVideoGrain) -> int:
         size = 37
         if len(grain.unit_offsets) > 0:
             size += 10 + 4*len(grain.unit_offsets)
         return size
 
     def _encode_cghd_for_grain(self, grain: CodedVideoGrain) -> bytes:
         data = (b"cghd" +
                 _encode_uint(self._cghd_size_for_grain(grain), 4) +
 
-                _encode_uint(int(grain.format), 4) +
-                _encode_uint(int(grain.layout), 4) +
+                _encode_uint(int(grain.cog_frame_format), 4) +
+                _encode_uint(int(grain.cog_frame_layout), 4) +
                 _encode_uint(int(grain.origin_width), 4) +
                 _encode_uint(int(grain.origin_height), 4) +
                 _encode_uint(int(grain.coded_width), 4) +
                 _encode_uint(int(grain.coded_height), 4) +
                 _encode_uint(1 if grain.is_key_frame else 0, 1) +
                 _encode_uint(int(grain.temporal_offset), 4))
 
@@ -2357,27 +2275,41 @@
     def _cahd_size_for_grain(self, grain: CodedAudioGrain) -> int:
         return 30
 
     def _encode_cahd_for_grain(self, grain: CodedAudioGrain) -> bytes:
         return (b"cahd" +
                 _encode_uint(self._cahd_size_for_grain(grain), 4) +
 
-                _encode_uint(int(grain.format), 4) +
+                _encode_uint(int(grain.cog_audio_format), 4) +
                 _encode_uint(int(grain.channels), 2) +
                 _encode_uint(int(grain.samples), 4) +
                 _encode_uint(int(grain.priming), 4) +
                 _encode_uint(int(grain.remainder), 4) +
                 _encode_uint(int(grain.sample_rate), 4))
 
     def add_tag(self, key: str, value: str):
         """Add a tag to the segment"""
         if self._active_dump:
             raise GSFEncodeAddToActiveDump("Cannot add a tag to a segment which is part of an active export")
         self._tags.append(GSFEncoderTag(key, value))
 
+    def add_flow(self, src_id: UUID, flow_id: UUID, format: str, data: str | bytes) -> None:
+        """Add flow metadata to the segment
+
+        :param src_id: The source ID for the flow
+        :param flow_id: The flow ID
+        :param format: The flow format URN
+        :param data: The flow metadata JSON string or bytes
+        """
+        if self._active_dump:
+            raise GSFEncodeAddToActiveDump("Cannot add a 'flow' to a segment which is part of an active export")
+        if isinstance(data, str):
+            data = data.encode('utf-8')
+        self._gsf_flow = GSFEncoderFlow(src_id=src_id, flow_id=flow_id, format=format, data=data)
+
     def add_grain(self, grain: Grain):
         """Add a grain to the segment, which should be a Grain object"""
         parent = self._get_parent_open_encoder()
         if parent is not None and parent._active_dump:
             parent.add_grain(grain, segment_id=self.id, segment_local_id=self.local_id)
         else:
             self._grains.append(grain)
```

### Comparing `mediagrains-3.5.2/mediagrains/hypothesis/strategies.py` & `mediagrains-4.0.0/mediagrains/hypothesis/strategies.py`

 * *Files 2% similar despite different names*

```diff
@@ -11,15 +11,17 @@
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 #
 
 """\
 Contains a number of useful hypothesis strategies which can be used to
-generate mediagrains for hypothesis based testing
+generate mediagrains for hypothesis based testing.
+
+This is for the 'new style' of instantiating grains.
 """
 
 from mediatimestamp.hypothesis.strategies import immutabletimestamps as timestamps
 from hypothesis.strategies import (
     integers,
     from_regex,
     booleans,
@@ -33,21 +35,22 @@
     builds,
     sampled_from,
     floats
 )
 
 import struct
 
-from uuid import UUID
 from fractions import Fraction
 from copy import copy
+from uuid import UUID
 
-from ..grain import attributes_for_grain_type
+from ..grains import new_attributes_for_grain_type as attributes_for_grain_type
 from ..cogenums import CogAudioFormat, CogFrameFormat, CogFrameLayout
-from .. import Grain, EventGrain, AudioGrain, CodedAudioGrain, CodedVideoGrain, VideoGrain
+from ..grains import EventGrain, AudioGrain, CodedAudioGrain, CodedVideoGrain, VideoGrain
+from ..grains import GrainFactory as Grain
 
 
 __all__ = ["DONOTSET",
            "empty_grains",
            "event_grains",
            "audio_grains",
            "video_grains",
@@ -94,34 +97,35 @@
         elif grain_type == "video":
             return sampled_from(CogFrameFormat).filter(lambda x: ((x >> 9) & 0x1) == 0)
         elif grain_type == "coded_video":
             return sampled_from(CogFrameFormat).filter(lambda x: (x & 0x200) != 0 and x != CogFrameFormat.INVALID)
         else:
             return ValueError("Cannot generate formats for grain type: {!r}".format(grain_type))
 
-    strats = {'source_id': shrinking_uuids(),
+    strats = {'src_id': shrinking_uuids(),
               'flow_id': shrinking_uuids(),
               'origin_timestamp': timestamps(),
               'sync_timestamp': timestamps(),
               'creation_timestamp': timestamps(),
-              'rate': fractions(min_value=0),
-              'duration': fractions(min_value=0),
+              'rate': fractions(min_value=0, max_value=200),
+              'duration': fractions(min_value=0, max_value=200),
               'event_type': from_regex(r"^urn:[a-z0-9][a-z0-9-]{0,31}:[a-z0-9()+,\-.:=@;$_!*'%/?#]+$"),
               'topic': from_regex(r'^[a-zA-Z0-9_\-]+[a-zA-Z0-9_\-/]*$'),
               'event_data': lists(fixed_dictionaries({
                 'path': from_regex(r'^[a-zA-Z0-9_\-]+[a-zA-Z0-9_\-/]*$'),
                 'pre': one_of(integers(), booleans(), fraction_dicts(), timestamps().map(str)),
                 'post': one_of(integers(), booleans(), fraction_dicts(), timestamps().map(str))})),
-              'format': _format_strategy(grain_type),
+              'cog_audio_format': _format_strategy(grain_type),
+              'cog_frame_format': _format_strategy(grain_type),
               'samples': integers(min_value=1, max_value=16),
               'channels': integers(min_value=1, max_value=16),
               'sample_rate': sampled_from((48000, 44100)),
               'width': just(240),
               'height': just(135),
-              'layout': sampled_from(CogFrameLayout).filter(lambda x: x != CogFrameLayout.UNKNOWN),
+              'cog_frame_layout': sampled_from(CogFrameLayout).filter(lambda x: x != CogFrameLayout.UNKNOWN),
               'priming': integers(min_value=0, max_value=65535),
               'remainder': integers(min_value=0, max_value=256),
               'coded_width': just(240),
               'coded_height': just(135),
               'origin_width': just(240),
               'origin_height': just(135),
               'is_key_frame': booleans(),
@@ -155,15 +159,15 @@
                  creation_timestamp=None,
                  origin_timestamp=None,
                  sync_timestamp=None,
                  rate=DONOTSET,
                  duration=DONOTSET):
     """Draw from this strategy to get empty grains.
 
-    :param source_id: A uuid.UUID *or* a strategy from which uuid.UUIDs can be drawn, if None is provided then an
+    :param src_id: A uuid.UUID *or* a strategy from which uuid.UUIDs can be drawn, if None is provided then an
                       strategy based on hypothesis.strategies.integers which shrinks towards smaller numerical
                       values will be used.
     :param flow_id: A uuid.UUID *or* a strategy from which uuid.UUIDs can be drawn, if None is provided then based on
                     hypothesis.strategies.integers which shrinks towards smaller numerical values will be used.
     :param creation_timestamp: a mediagrains.Timestamp *or* a strategy from which mediagrain.Timestamps can be drawn,
                                if None is provided then mediagrains.hypothesis.strategies.timestamps will be used
                                (the default), if DONOTSET is passed then the creation_timestamp will be the time when
@@ -181,15 +185,15 @@
                  the value None in which case hypothesis.strategies.fractions will be used with min_value set to 0.
     :param duration: something that can be passed to the constructor of fractions.Fraction or a strategy that generates
                      them, or the value DONOTSET (the default) which causes the default rate to be used for all grains,
                      or the value None in which case hypothesis.strategies.fractions will be used with min_value set to
                      0.
     """
     return _grain_strategy(Grain, "empty",
-                           source_id=src_id,
+                           src_id=src_id,
                            flow_id=flow_id,
                            creation_timestamp=creation_timestamp,
                            origin_timestamp=origin_timestamp,
                            sync_timestamp=sync_timestamp,
                            rate=rate,
                            duration=duration)
 
@@ -203,15 +207,15 @@
                  duration=DONOTSET,
                  format=None,
                  samples=None,
                  channels=None,
                  sample_rate=None):
     """Draw from this strategy to get audio grains. The data element of these grains will always be all 0s.
 
-    :param source_id: A uuid.UUID *or* a strategy from which uuid.UUIDs can be drawn, if None is provided then an
+    :param src_id: A uuid.UUID *or* a strategy from which uuid.UUIDs can be drawn, if None is provided then an
                       strategy based on hypothesis.strategies.integers which shrinks towards smaller numerical values
                       will be used.
     :param flow_id: A uuid.UUID *or* a strategy from which uuid.UUIDs can be drawn, if None is provided then based on
                     hypothesis.strategies.integers which shrinks towards smaller numerical values will be used.
     :param creation_timestamp: a mediagrains.Timestamp *or* a strategy from which mediagrain.Timestamps can be drawn,
                                if None is provided then mediagrains.hypothesis.strategies.timestamps will be used (the
                                default), if DONOTSET is passed then the creation_timestamp will be the time when
@@ -237,15 +241,15 @@
                     integers(min_value=1).
     :param channels: either a positive integer or a strategy that generates them, the default strategy is
                      integers(min_value=1).
     :param sample_rate: either a positive integer or a strategy that generates them, the default strategy will always
                         generate either 48000 or 44100.
     """
     return _grain_strategy(AudioGrain, "audio",
-                           source_id=src_id,
+                           src_id=src_id,
                            flow_id=flow_id,
                            creation_timestamp=creation_timestamp,
                            origin_timestamp=origin_timestamp,
                            sync_timestamp=sync_timestamp,
                            rate=rate,
                            duration=duration,
                            format=format,
@@ -265,15 +269,15 @@
                        samples=None,
                        channels=None,
                        priming=DONOTSET,
                        remainder=DONOTSET,
                        sample_rate=None):
     """Draw from this strategy to get coded audio grains. The data element of these grains will always be all 0s.
 
-    :param source_id: A uuid.UUID *or* a strategy from which uuid.UUIDs can be drawn, if None is provided then an
+    :param src_id: A uuid.UUID *or* a strategy from which uuid.UUIDs can be drawn, if None is provided then an
                       strategy based on hypothesis.strategies.integers which shrinks towards smaller numerical values
                       will be used.
     :param flow_id: A uuid.UUID *or* a strategy from which uuid.UUIDs can be drawn, if None is provided then based on
                     hypothesis.strategies.integers which shrinks towards smaller numerical values will be used.
     :param creation_timestamp: a mediagrains.Timestamp *or* a strategy from which mediagrain.Timestamps can be drawn,
                                if None is provided then mediagrains.hypothesis.strategies.timestamps will be used (the
                                default), if DONOTSET is passed then the creation_timestamp will be the time when
@@ -303,15 +307,15 @@
                     and so defaults to 0 on all generated grains
     :param remainder: either a positive integer or a strategy that generates them, by default this value is left unset,
                       and so defaults to 0 on all generated grains
     :param sample_rate: either a positive integer or a strategy that generates them, the default strategy will always
                         generate either 48000 or 44100.
     """
     return _grain_strategy(CodedAudioGrain, "coded_audio",
-                           source_id=src_id,
+                           src_id=src_id,
                            flow_id=flow_id,
                            origin_timestamp=origin_timestamp,
                            sync_timestamp=sync_timestamp,
                            rate=rate,
                            duration=duration,
                            format=format,
                            samples=samples,
@@ -327,18 +331,18 @@
                  origin_timestamp=None,
                  sync_timestamp=None,
                  rate=DONOTSET,
                  duration=DONOTSET,
                  format=None,
                  width=None,
                  height=None,
-                 layout=None):
+                 cog_frame_layout=None):
     """Draw from this strategy to get video grains. The data element of these grains will always be all 0s.
 
-    :param source_id: A uuid.UUID *or* a strategy from which uuid.UUIDs can be drawn, if None is provided then an
+    :param src_id: A uuid.UUID *or* a strategy from which uuid.UUIDs can be drawn, if None is provided then an
                       strategy based on hypothesis.strategies.integers which shrinks towards smaller numerical values
                       will be used.
     :param flow_id: A uuid.UUID *or* a strategy from which uuid.UUIDs can be drawn, if None is provided then based on
                     hypothesis.strategies.integers which shrinks towards smaller numerical values will be used.
     :param creation_timestamp: a mediagrains.Timestamp *or* a strategy from which mediagrain.Timestamps can be drawn,
                                if None is provided then mediagrains.hypothesis.strategies.timestamps will be used (the
                                default), if DONOTSET is passed then the creation_timestamp will be the time when
@@ -362,46 +366,46 @@
                    will not produce encoded or unknown formats.
     :param width: either a positive integer or a strategy that generates them, the default strategy is just(240).
     :param height: either a positive integer or a strategy that generates them, the default strategy is just(135).
     :param layout: either a member of cogenums.CogFrameLayout or a strategy that generates them, the default strategy
                    will not generate UNKNOWN layout.
     """
     return _grain_strategy(VideoGrain, "video",
-                           source_id=src_id,
+                           src_id=src_id,
                            flow_id=flow_id,
                            creation_timestamp=creation_timestamp,
                            origin_timestamp=origin_timestamp,
                            sync_timestamp=sync_timestamp,
                            rate=rate,
                            duration=duration,
                            format=format,
                            width=width,
                            height=height,
-                           layout=layout)
+                           cog_frame_layout=cog_frame_layout)
 
 
 def coded_video_grains(src_id=None,
                        flow_id=None,
                        creation_timestamp=None,
                        origin_timestamp=None,
                        sync_timestamp=None,
                        rate=DONOTSET,
                        duration=DONOTSET,
                        format=None,
                        coded_width=None,
                        coded_height=None,
-                       layout=None,
+                       cog_frame_layout=None,
                        origin_width=None,
                        origin_height=None,
                        is_key_frame=None,
                        temporal_offset=None,
                        unit_offsets=None):
     """Draw from this strategy to get coded video grains. The data element of these grains will always be all 0s.
 
-    :param source_id: A uuid.UUID *or* a strategy from which uuid.UUIDs can be drawn, if None is provided then an
+    :param src_id: A uuid.UUID *or* a strategy from which uuid.UUIDs can be drawn, if None is provided then an
                       strategy based on hypothesis.strategies.integers which shrinks towards smaller numerical values
                       will be used.
     :param flow_id: A uuid.UUID *or* a strategy from which uuid.UUIDs can be drawn, if None is provided then based on
                     hypothesis.strategies.integers which shrinks towards smaller numerical values will be used.
     :param creation_timestamp: a mediagrains.Timestamp *or* a strategy from which mediagrain.Timestamps can be drawn,
                                if None is provided then mediagrains.hypothesis.strategies.timestamps will be used (the
                                default), if DONOTSET is passed then the creation_timestamp will be the time when
@@ -434,30 +438,30 @@
     :param is_key_frame: either a boolean or a strategy that generates them.
     :param temporal_offset: either an integer or a strategy that generates them.
     :param unit_offsets: either a list of uniformly increasing non-negative integers or a strategy that generates them.
     :param layout: either a member of cogenums.CogFrameLayout or a strategy that generates them, the default strategy
                    will not generate UNKNOWN layout.
     """
     return _grain_strategy(CodedVideoGrain, "coded_video",
-                           source_id=src_id,
+                           src_id=src_id,
                            flow_id=flow_id,
                            creation_timestamp=creation_timestamp,
                            origin_timestamp=origin_timestamp,
                            sync_timestamp=sync_timestamp,
                            rate=rate,
                            duration=duration,
                            format=format,
                            origin_width=origin_width,
                            origin_height=origin_height,
                            coded_width=coded_width,
                            coded_height=coded_height,
                            is_key_frame=is_key_frame,
                            temporal_offset=temporal_offset,
                            unit_offsets=unit_offsets,
-                           layout=layout)
+                           cog_frame_layout=cog_frame_layout)
 
 
 def grains(grain_type, **kwargs):
     """A strategy that generates grains of the specified type."""
 
     if grain_type == "empty":
         return empty_grains(**kwargs)
@@ -497,24 +501,28 @@
         if grain.grain_type == "audio":
             if grain.format in [CogAudioFormat.FLOAT_PLANES,
                                 CogAudioFormat.FLOAT_PAIRS,
                                 CogAudioFormat.FLOAT_INTERLEAVED]:
                 ln = grain.expected_length//4
                 data = lists(floats(width=32,
                                     allow_nan=False,
-                                    allow_infinity=False),
+                                    allow_infinity=False,
+                                    min_value=0.0),  # Avoids ending up comparing unequal Grains that have +0.0 and -0.0
+                                                     # (which compare as equal)
                              min_size=ln,
                              max_size=ln).map(lambda x: struct.pack('@' + ('f'*ln), *x))
             elif grain.format in [CogAudioFormat.DOUBLE_PLANES,
                                   CogAudioFormat.DOUBLE_PAIRS,
                                   CogAudioFormat.DOUBLE_INTERLEAVED]:
                 ln = grain.expected_length//8
                 data = lists(floats(width=64,
                                     allow_nan=False,
-                                    allow_infinity=False),
+                                    allow_infinity=False,
+                                    min_value=0.0),  # Avoids ending up comparing unequal Grains that have +0.0 and -0.0
+                                                     # (which compare as equal)
                              min_size=ln,
                              max_size=ln).map(lambda x: struct.pack('@' + ('d'*ln), *x))
             else:
                 data = binary(min_size=grain.expected_length, max_size=grain.expected_length)
         else:
             data = binary(min_size=grain.length, max_size=grain.length)
 
@@ -571,40 +579,40 @@
     """  # noqa W605 Ignore invalid escape sequence in docstring
     if rate is DONOTSET:
         rate = Fraction(25, 1)
     if duration is DONOTSET:
         duration = Fraction(1, 25)
 
     def event_grain(
-     source_id,
+     src_id,
      flow_id,
      origin_timestamp,
      sync_timestamp,
      rate,
      duration,
      creation_timestamp,
      event_type,
      topic,
      event_data):
         grain = EventGrain(
-            src_id=source_id,
+            src_id=src_id,
             flow_id=flow_id,
             creation_timestamp=creation_timestamp,
             origin_timestamp=origin_timestamp,
             sync_timestamp=sync_timestamp,
             rate=rate,
             duration=duration,
             event_type=event_type,
             topic=topic)
         for datum in event_data:
             grain.append(datum['path'], datum['pre'], datum['post'])
         return grain
 
     return _grain_strategy(event_grain, "event",
-                           source_id=src_id,
+                           src_id=src_id,
                            flow_id=flow_id,
                            origin_timestamp=origin_timestamp,
                            sync_timestamp=sync_timestamp,
                            rate=rate,
                            duration=duration,
                            creation_timestamp=creation_timestamp,
                            event_type=event_type,
```

### Comparing `mediagrains-3.5.2/mediagrains/numpy/__init__.py` & `mediagrains-4.0.0/mediagrains/patterngenerators/video/__init__.py`

 * *Files 19% similar despite different names*

```diff
@@ -1,24 +1,23 @@
-# Copyright 2019 British Broadcasting Corporation
+#
+# Copyright 2020 British Broadcasting Corporation
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #     http://www.apache.org/licenses/LICENSE-2.0
 #
 # Unless required by applicable law or agreed to in writing, software
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 #
 
-"""\
-Library for handling mediagrains in numpy arrays
-"""
-
-from .videograin import VIDEOGRAIN, VideoGrain
-from .audiograin import AUDIOGRAIN, AudioGrain
-from . import convert  # noqa: F401
+from .abc import VideoPatternGenerator
+from .lumasteps import LumaSteps
+from .colourbars import ColourBars
+from .still import StillPatternGenerator
+from .movingbaroverlay import MovingBarOverlay
 
-__all__ = ['VideoGrain', 'VIDEOGRAIN', 'AudioGrain', 'AUDIOGRAIN']
+__all__ = ["VideoPatternGenerator", "LumaSteps", "ColourBars", "StillPatternGenerator", "MovingBarOverlay"]
```

### Comparing `mediagrains-3.5.2/mediagrains/numpy/convert.py` & `mediagrains-4.0.0/mediagrains/numpy/convert.py`

 * *Files 3% similar despite different names*

```diff
@@ -101,72 +101,84 @@
 
 # Bit depth conversions
 def _unbiased_right_shift(a: np.ndarray, n: int) -> np.ndarray:
     return (a >> n) + ((a >> (n - 1)) & 0x1)
 
 
 def _bitdepth_down_convert_yuv(grain_in: VideoGrain, grain_out: VideoGrain) -> None:
-    bitshift = COG_FRAME_FORMAT_ACTIVE_BITS(grain_in.format) - COG_FRAME_FORMAT_ACTIVE_BITS(grain_out.format)
+    bitshift = (
+        COG_FRAME_FORMAT_ACTIVE_BITS(grain_in.cog_frame_format) -
+        COG_FRAME_FORMAT_ACTIVE_BITS(grain_out.cog_frame_format)
+    )
 
     grain_out.component_data[0][:] = _unbiased_right_shift(grain_in.component_data[0][:], bitshift)
     grain_out.component_data[1][:] = _unbiased_right_shift(grain_in.component_data[1][:], bitshift)
     grain_out.component_data[2][:] = _unbiased_right_shift(grain_in.component_data[2][:], bitshift)
 
 
 def _bitdepth_down_convert_rgb(grain_in: VideoGrain, grain_out: VideoGrain) -> None:
-    bitshift = COG_FRAME_FORMAT_ACTIVE_BITS(grain_in.format) - COG_FRAME_FORMAT_ACTIVE_BITS(grain_out.format)
+    bitshift = (
+        COG_FRAME_FORMAT_ACTIVE_BITS(grain_in.cog_frame_format) -
+        COG_FRAME_FORMAT_ACTIVE_BITS(grain_out.cog_frame_format)
+    )
 
     grain_out.component_data.R[:] = _unbiased_right_shift(grain_in.component_data.R[:], bitshift)
     grain_out.component_data.G[:] = _unbiased_right_shift(grain_in.component_data.G[:], bitshift)
     grain_out.component_data.B[:] = _unbiased_right_shift(grain_in.component_data.B[:], bitshift)
 
 
 def _noisy_left_shift(a: np.ndarray, n: int) -> np.ndarray:
     rando = ((npr.random_sample(a.shape) * (1 << n)).astype(a.dtype)) & ((1 << n) - 1)
     return (a << n) + rando
 
 
 def _bitdepth_up_convert_yuv(grain_in: VideoGrain, grain_out: VideoGrain) -> None:
-    bitshift = COG_FRAME_FORMAT_ACTIVE_BITS(grain_out.format) - COG_FRAME_FORMAT_ACTIVE_BITS(grain_in.format)
+    bitshift = (
+        COG_FRAME_FORMAT_ACTIVE_BITS(grain_out.cog_frame_format) -
+        COG_FRAME_FORMAT_ACTIVE_BITS(grain_in.cog_frame_format)
+    )
 
     dt = grain_out.component_data[0].dtype
 
     grain_out.component_data[0][:] = _noisy_left_shift(grain_in.component_data[0][:].astype(dt), bitshift)
     grain_out.component_data[1][:] = _noisy_left_shift(grain_in.component_data[1][:].astype(dt), bitshift)
     grain_out.component_data[2][:] = _noisy_left_shift(grain_in.component_data[2][:].astype(dt), bitshift)
 
 
 def _bitdepth_up_convert_rgb(grain_in: VideoGrain, grain_out: VideoGrain) -> None:
-    bitshift = COG_FRAME_FORMAT_ACTIVE_BITS(grain_out.format) - COG_FRAME_FORMAT_ACTIVE_BITS(grain_in.format)
+    bitshift = (
+        COG_FRAME_FORMAT_ACTIVE_BITS(grain_out.cog_frame_format) -
+        COG_FRAME_FORMAT_ACTIVE_BITS(grain_in.cog_frame_format)
+    )
 
     dt = grain_out.component_data[0].dtype
 
     grain_out.component_data.R[:] = _noisy_left_shift(grain_in.component_data.R[:].astype(dt), bitshift)
     grain_out.component_data.G[:] = _noisy_left_shift(grain_in.component_data.G[:].astype(dt), bitshift)
     grain_out.component_data.B[:] = _noisy_left_shift(grain_in.component_data.B[:].astype(dt), bitshift)
 
 
 # Colourspace conversions (based on rec.709)
 def _convert_rgb_to_yuv444(grain_in: VideoGrain, grain_out: VideoGrain) -> None:
-    bd = COG_FRAME_FORMAT_ACTIVE_BITS(grain_out.format)
+    bd = COG_FRAME_FORMAT_ACTIVE_BITS(grain_out.cog_frame_format)
     (R, G, B) = (grain_in.component_data.R,
                  grain_in.component_data.G,
                  grain_in.component_data.B)
 
     # Note that NumPy requires the `unsafe` cast here due to the slight loss of precision in RGB<->YUV conversion
     np.clip((R*0.2126 + G*0.7152 + B*0.0722),
             0, 1 << bd, out=grain_out.component_data.Y, casting="unsafe")  # type: ignore
     np.clip((R*-0.114572 - G*0.385428 + B*0.5 + (1 << (bd - 1))),  # type: ignore
             0, 1 << bd, out=grain_out.component_data.U, casting="unsafe")
     np.clip((R*0.5 - G*0.454153 - B*0.045847 + (1 << (bd - 1))),  # type: ignore
             0, 1 << bd, out=grain_out.component_data.V, casting="unsafe")
 
 
 def _convert_yuv444_to_rgb(grain_in: VideoGrain, grain_out: VideoGrain) -> None:
-    bd = COG_FRAME_FORMAT_ACTIVE_BITS(grain_in.format)
+    bd = COG_FRAME_FORMAT_ACTIVE_BITS(grain_in.cog_frame_format)
     (Y, U, V) = (grain_in.component_data.Y.astype(np.dtype(np.double)),
                  grain_in.component_data.U.astype(np.dtype(np.double)) - (1 << (bd - 1)),
                  grain_in.component_data.V.astype(np.dtype(np.double)) - (1 << (bd - 1)))
 
     # Note that NumPy requires the `unsafe` cast here due to the slight loss of precision in RGB<->YUV conversion
     np.clip((Y + V*1.5748),
             0, 1 << bd, out=grain_out.component_data.R, casting="unsafe")  # type: ignore
```

### Comparing `mediagrains-3.5.2/mediagrains/numpy/numpy_grains/AudioGrain.py` & `mediagrains-4.0.0/mediagrains/numpy/numpy_grains/AudioGrain.py`

 * *Files identical despite different names*

### Comparing `mediagrains-3.5.2/mediagrains/numpy/numpy_grains/VideoGrain.py` & `mediagrains-4.0.0/mediagrains/numpy/numpy_grains/VideoGrain.py`

 * *Files 2% similar despite different names*

```diff
@@ -251,18 +251,18 @@
                              width=width, height=height, src_id=src_id, flow_id=flow_id)
 
         self._data: Optional[np.ndarray]
         self._data_fetcher_coroutine: Optional[Awaitable[GrainDataType]]
         self.component_data: ComponentDataList
 
         if self._data is not None:
-            self._data = np.frombuffer(self._data, dtype=_dtype_from_cogframeformat(self.format))
+            self._data = np.frombuffer(self._data, dtype=_dtype_from_cogframeformat(self.cog_frame_format))
             self.component_data = ComponentDataList(
-                _component_arrays_for_data_and_type(self._data, self.format, self.components),
-                arrangement=_component_arrangement_from_format(self.format))
+                _component_arrays_for_data_and_type(self._data, self.cog_frame_format, self.components),
+                arrangement=_component_arrangement_from_format(self.cog_frame_format))
         else:
             self.component_data = ComponentDataList([])
 
     @property
     def length(self) -> int:
         if self._data is None:
             return 0
@@ -284,18 +284,18 @@
     def data(self, value: GrainDataParameterType):
         if isawaitable(value):
             self._data_fetcher_coroutine = cast(Awaitable[GrainDataType], value)
             self._data = None
             self.component_data = ComponentDataList([])
         else:
             self._data_fetcher_coroutine = None
-            self._data = np.frombuffer(cast(bytes, value), dtype=_dtype_from_cogframeformat(self.format))
+            self._data = np.frombuffer(cast(bytes, value), dtype=_dtype_from_cogframeformat(self.cog_frame_format))
             self.component_data = ComponentDataList(
-                _component_arrays_for_data_and_type(self._data, self.format, self.components),
-                arrangement=_component_arrangement_from_format(self.format))
+                _component_arrays_for_data_and_type(self._data, self.cog_frame_format, self.components),
+                arrangement=_component_arrangement_from_format(self.cog_frame_format))
 
     def __array__(self) -> np.ndarray:
         return np.array(self.data)
 
     def __bytes__(self) -> bytes:
         if self._data is None:
             return bytes()
@@ -366,34 +366,34 @@
                           origin_timestamp=self.origin_timestamp,
                           sync_timestamp=self.sync_timestamp,
                           cog_frame_format=fmt,
                           width=self.width,
                           height=self.height,
                           rate=self.rate,
                           duration=self.duration,
-                          cog_frame_layout=self.layout)
+                          cog_frame_layout=self.cog_frame_layout)
 
     def convert(self, fmt: CogFrameFormat) -> "VideoGrain":
         """Used to convert this grain to a different cog format. Always produces a new grain.
 
         :param fmt: The format to convert to
         :returns: A new grain of the specified format. Notably converting to the same format is the same as a deepcopy
         :raises: NotImplementedError if the requested conversion is not possible
         """
-        if self.format == fmt:
+        if self.cog_frame_format == fmt:
             return deepcopy(self)
         else:
             grain_out = self._similar_grain(fmt)
-            self.__class__._get_grain_conversion_function(self.format, fmt)(self, grain_out)
+            self.__class__._get_grain_conversion_function(self.cog_frame_format, fmt)(self, grain_out)
             return grain_out
 
     def asformat(self, fmt: CogFrameFormat) -> "VideoGrain":
         """Used to ensure that this grain is in a particular format. Converts it if not.
 
         :param fmt: The format to ensure
         :returns: self or a new grain.
         :raises NotImplementedError if the requested conversion is not possible.
         """
-        if self.format == fmt:
+        if self.cog_frame_format == fmt:
             return self
         else:
             return self.convert(fmt)
```

### Comparing `mediagrains-3.5.2/mediagrains/patterngenerators/__init__.py` & `mediagrains-4.0.0/mediagrains/patterngenerators/__init__.py`

 * *Files 10% similar despite different names*

```diff
@@ -12,16 +12,14 @@
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 #
 """\
 This submodule contains classes which can be used to generate various test
 grains in a wide variety of formats in a random access fashion.
-
-This is intended to replace mediagrains.testsignalgenerator, which is now deprecated.
 """
 
 from .abc import PatternGenerator, FixedRatePatternGenerator
 
 __all__ = [
     "PatternGenerator",
     "FixedRatePatternGenerator"
```

### Comparing `mediagrains-3.5.2/mediagrains/patterngenerators/abc.py` & `mediagrains-4.0.0/mediagrains/patterngenerators/abc.py`

 * *Files identical despite different names*

### Comparing `mediagrains-3.5.2/mediagrains/patterngenerators/audio/__init__.py` & `mediagrains-4.0.0/mediagrains/patterngenerators/audio/__init__.py`

 * *Files identical despite different names*

### Comparing `mediagrains-3.5.2/mediagrains/patterngenerators/audio/abc.py` & `mediagrains-4.0.0/mediagrains/patterngenerators/audio/abc.py`

 * *Files 4% similar despite different names*

```diff
@@ -14,22 +14,22 @@
 # limitations under the License.
 #
 
 from fractions import Fraction
 from uuid import UUID
 
 from ...cogenums import CogAudioFormat
-from ...grain import AUDIOGRAIN
+from ...grains import AudioGrain
 from ..abc import FixedRatePatternGenerator
 
 
 __all__ = ["AudioPatternGenerator"]
 
 
-class AudioPatternGenerator (FixedRatePatternGenerator[AUDIOGRAIN]):
+class AudioPatternGenerator (FixedRatePatternGenerator[AudioGrain]):
     def __init__(
         self,
         src_id: UUID,
         flow_id: UUID,
         samples: int = 1920,
         channels: int = 1,
         cog_audio_format: CogAudioFormat = CogAudioFormat.S16_INTERLEAVED,
```

### Comparing `mediagrains-3.5.2/mediagrains/patterngenerators/audio/tone.py` & `mediagrains-4.0.0/mediagrains/patterngenerators/audio/tone.py`

 * *Files 1% similar despite different names*

```diff
@@ -18,15 +18,14 @@
 from typing import Optional, Dict, List, Union
 import struct
 from fractions import Fraction
 
 from mediatimestamp import TimeValue
 
 from .abc import AudioPatternGenerator
-from ...grains import AUDIOGRAIN
 from ...grains import AudioGrain
 from ...cogenums import CogAudioFormat
 
 
 __all__ = ["Tone", "Tone1K", "Silence"]
 
 
@@ -154,15 +153,15 @@
             elif depth == 'f':
                 self.data_samples[offs] = struct.pack('@' + ('f'*self.samples*self.channels), *line)
             elif depth == 'd':
                 self.data_samples[offs] = struct.pack('@' + ('d'*self.samples*self.channels), *line)
 
         return self.data_samples[offs]
 
-    def get(self, key: TimeValue, default: Optional[AUDIOGRAIN] = None) -> Optional[AUDIOGRAIN]:
+    def get(self, key: TimeValue, default: Optional[AudioGrain] = None) -> Optional[AudioGrain]:
         tv = TimeValue(key, rate=Fraction(self.sample_rate))
         sample_count = tv.as_count()
 
         if sample_count % self.samples != 0:
             return None
 
         offs = sample_count % self.looplen
```

### Comparing `mediagrains-3.5.2/mediagrains/patterngenerators/video/abc.py` & `mediagrains-4.0.0/mediagrains/patterngenerators/video/abc.py`

 * *Files identical despite different names*

### Comparing `mediagrains-3.5.2/mediagrains/patterngenerators/video/colourbars.py` & `mediagrains-4.0.0/mediagrains/patterngenerators/video/colourbars.py`

 * *Files 3% similar despite different names*

```diff
@@ -11,15 +11,15 @@
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 #
 from fractions import Fraction
 
-from ...grain_constructors import VideoGrain
+from ...grains import VideoGrain
 from .constants import pixel_ranges
 from .still import StillPatternGenerator
 from ...cogenums import CogFrameFormat, CogFrameLayout
 
 __all__ = ["ColourBars"]
 
 
@@ -41,15 +41,16 @@
             (int((0xB200 >> bs) * intensity), 0xABFF >> bs, 0x0000 >> bs),
             (int((0x95FF >> bs) * intensity), 0x2BFF >> bs, 0x15FF >> bs),
             (int((0x69FF >> bs) * intensity), 0xD400 >> bs, 0xEA00 >> bs),
             (int((0x4C00 >> bs) * intensity), 0x5400 >> bs, 0xFFFF >> bs),
             (int((0x1DFF >> bs) * intensity), 0xFFFF >> bs, 0x6BFF >> bs),
             (int((0x0000 >> bs) * intensity), 0x8000 >> bs, 0x8000 >> bs)]
 
-        vg = VideoGrain(src_id, flow_id,
+        vg = VideoGrain(src_id=src_id,
+                        flow_id=flow_id,
                         rate=rate,
                         cog_frame_format=cog_frame_format,
                         cog_frame_layout=CogFrameLayout.FULL_FRAME,
                         width=width,
                         height=height)
 
         lines = [
```

### Comparing `mediagrains-3.5.2/mediagrains/patterngenerators/video/constants.py` & `mediagrains-4.0.0/mediagrains/patterngenerators/video/constants.py`

 * *Files identical despite different names*

### Comparing `mediagrains-3.5.2/mediagrains/patterngenerators/video/lumasteps.py` & `mediagrains-4.0.0/mediagrains/patterngenerators/video/lumasteps.py`

 * *Files 11% similar despite different names*

```diff
@@ -13,15 +13,15 @@
 # See the License for the specific language governing permissions and
 # limitations under the License.
 #
 from fractions import Fraction
 
 from .still import StillPatternGenerator
 from .constants import pixel_ranges
-from ...grain_constructors import VideoGrain
+from ...grains import VideoGrain
 from ...cogenums import CogFrameFormat, CogFrameLayout
 
 __all__ = ["LumaSteps"]
 
 
 class LumaSteps(StillPatternGenerator):
     def __init__(self, src_id, flow_id, width, height,
@@ -33,15 +33,16 @@
         _bpp = pixel_ranges[cog_frame_format][0]
         _offset = pixel_ranges[cog_frame_format][1][0]
         _range = pixel_ranges[cog_frame_format][1][1]
         _steps = 8
 
         _chromaval = pixel_ranges[cog_frame_format][2][0]
 
-        vg = VideoGrain(src_id, flow_id,
+        vg = VideoGrain(src_id=src_id,
+                        flow_id=flow_id,
                         rate=rate,
                         cog_frame_format=cog_frame_format,
                         cog_frame_layout=CogFrameLayout.FULL_FRAME,
                         width=width,
                         height=height)
 
         line = bytearray(width*_bpp)
```

### Comparing `mediagrains-3.5.2/mediagrains/patterngenerators/video/movingbaroverlay.py` & `mediagrains-4.0.0/mediagrains/patterngenerators/video/movingbaroverlay.py`

 * *Files 4% similar despite different names*

```diff
@@ -13,15 +13,15 @@
 # See the License for the specific language governing permissions and
 # limitations under the License.
 #
 
 from typing import Optional, cast
 from mediatimestamp import TimeValue
 
-from ...grain import VIDEOGRAIN
+from ...grains import VideoGrain
 from .abc import VideoPatternGenerator
 from .constants import pixel_ranges
 from ...cogenums import COG_FRAME_FORMAT_H_SHIFT, COG_FRAME_FORMAT_V_SHIFT
 
 
 __all__ = ["MovingBarOverlay"]
 
@@ -62,15 +62,15 @@
                     bar[1][y*(self.width >> h_shift)*_bpp + _bpp*x + 1] = pixel_ranges[self.cog_frame_format][2][0] >> 8
                 bar[2][y*(self.width >> h_shift)*_bpp + _bpp*x + 0] = pixel_ranges[self.cog_frame_format][3][0] & 0xFF
                 if _bpp > 1:
                     bar[2][y*(self.width >> h_shift)*_bpp + _bpp*x + 1] = pixel_ranges[self.cog_frame_format][3][0] >> 8
 
         self._bar = bar
 
-    def get(self, key: TimeValue, default: Optional[VIDEOGRAIN] = None) -> Optional[VIDEOGRAIN]:
+    def get(self, key: TimeValue, default: Optional[VideoGrain] = None) -> Optional[VideoGrain]:
         tv = TimeValue(key, rate=self.rate)
 
         grain = self._source[tv]
 
         if grain is not None:
             fnum = int(self._bar_speed*grain.origin_timestamp.to_count(grain.rate.numerator, grain.rate.denominator))
             _bpp = pixel_ranges[self.cog_frame_format][0]
```

### Comparing `mediagrains-3.5.2/mediagrains/patterngenerators/video/still.py` & `mediagrains-4.0.0/mediagrains/patterngenerators/video/still.py`

 * *Files 9% similar despite different names*

```diff
@@ -15,33 +15,33 @@
 #
 
 from typing import Optional
 from copy import deepcopy
 
 from mediatimestamp import TimeValue
 
-from ...grain import VIDEOGRAIN
+from ...grains import VideoGrain
 from .abc import VideoPatternGenerator
 
 
 __all__ = ["StillPatternGenerator"]
 
 
 class StillPatternGenerator (VideoPatternGenerator):
-    def __init__(self, template_grain: VIDEOGRAIN):
+    def __init__(self, template_grain: VideoGrain):
         super().__init__(
             src_id=template_grain.source_id,
             flow_id=template_grain.flow_id,
             width=template_grain.width,
             height=template_grain.height,
             rate=template_grain.rate,
-            cog_frame_format=template_grain.format)
+            cog_frame_format=template_grain.cog_frame_format)
         self._template_grain = template_grain
 
-    def get(self, key: TimeValue, default: Optional[VIDEOGRAIN] = None) -> Optional[VIDEOGRAIN]:
+    def get(self, key: TimeValue, default: Optional[VideoGrain] = None) -> Optional[VideoGrain]:
         tv = TimeValue(key, rate=self.rate)
 
         if tv == key:
             grain = deepcopy(self._template_grain)
             grain.origin_timestamp = key.as_timestamp()
             grain.sync_timestamp = grain.origin_timestamp
             return grain
```

### Comparing `mediagrains-3.5.2/mediagrains/tools/__init__.py` & `mediagrains-4.0.0/mediagrains/tools/__init__.py`

 * *Files identical despite different names*

### Comparing `mediagrains-3.5.2/mediagrains/tools/_file_or_pipe.py` & `mediagrains-4.0.0/mediagrains/tools/_file_or_pipe.py`

 * *Files identical despite different names*

### Comparing `mediagrains-3.5.2/mediagrains/tools/extract_from_gsf.py` & `mediagrains-4.0.0/mediagrains/tools/extract_from_gsf.py`

 * *Files identical despite different names*

### Comparing `mediagrains-3.5.2/mediagrains/tools/wrap_in_gsf.py` & `mediagrains-4.0.0/mediagrains/tools/wrap_in_gsf.py`

 * *Files identical despite different names*

### Comparing `mediagrains-3.5.2/mediagrains/typing.py` & `mediagrains-4.0.0/mediagrains/typing.py`

 * *Files 1% similar despite different names*

```diff
@@ -28,15 +28,15 @@
 from numbers import Rational
 from fractions import Fraction
 from uuid import UUID
 from mediatimestamp.immutable import TimeOffset, TimeRange, Timestamp
 
 
 if TYPE_CHECKING:
-    from .grains import GRAIN  # noqa: F401
+    from . import Grain  # noqa: F401
 
 
 __all__ = ["RationalTypes",
            "MediaJSONSerialisable",
            "EventGrainDatumDict",
            "GrainMetadataDict",
            "EmptyGrainMetadataDict",
@@ -264,8 +264,8 @@
 GrainDataType = Union[SupportsBytes, bytes, ndarray]
 
 GrainDataParameterType = Optional[Union[GrainDataType, Awaitable[Optional[GrainDataType]]]]
 
 
 # This is the type of a function that can be called to construct a GRAIN object from a metadata dict and a data
 # parameter
-ParseGrainType = Callable[[GrainMetadataDict, GrainDataParameterType], "GRAIN"]
+ParseGrainType = Callable[[GrainMetadataDict, GrainDataParameterType], "Grain"]
```

### Comparing `mediagrains-3.5.2/mediagrains/utils/__init__.py` & `mediagrains-4.0.0/mediagrains/utils/__init__.py`

 * *Files identical despite different names*

### Comparing `mediagrains-3.5.2/mediagrains/utils/adts_aac_grain_wrapper.py` & `mediagrains-4.0.0/mediagrains/utils/adts_aac_grain_wrapper.py`

 * *Files 7% similar despite different names*

```diff
@@ -18,32 +18,32 @@
 """
 import typing
 import copy
 from fractions import Fraction
 
 from mediatimestamp.immutable import TimeRange
 
-from ..grain import GRAIN, CODEDAUDIOGRAIN
+from ..grains import Grain, CodedAudioGrain
 from .adts_aac_parser import ADTSAACParser, FrameInfo, MIN_ADTS_HEADER_SIZE
 
 
 class ADTSAACGrainWrapper(object):
     """Raw input and wrap it in Grains"""
     def __init__(
         self,
-        template_grain: GRAIN,
+        template_grain: Grain,
         input_data: typing.IO[bytes]
     ):
         """Set up the wrapper and the Grains that will be generated
 
         :param template_grain: A coded audio Grain to use as the template for wrapping the Grains read from the input
                                source. origin_timestamp should be set.
         :param input_data: An object to read video data from
         """
-        assert (isinstance(template_grain, CODEDAUDIOGRAIN))
+        assert (isinstance(template_grain, CodedAudioGrain))
         self.template_grain = copy.deepcopy(template_grain)  # make a copy as the template defaults will be updated
         self.input_data = input_data
 
     def _frames(self) -> typing.Iterator[typing.Tuple[bytes, FrameInfo]]:
         """Generator that yields ADTS AAC frame bytes read from the input given
 
         :yields: ADTS AAC frame bytes objects read from the raw input supplied and the frame info
@@ -56,15 +56,15 @@
                 break
 
             frame_info = adts_aac_parser.parse_header(frame_data)
             frame_data += self.input_data.read(frame_info.frame_size - len(frame_data))
 
             yield (frame_data, frame_info)
 
-    def grains(self) -> typing.Iterator[CODEDAUDIOGRAIN]:
+    def grains(self) -> typing.Iterator[CodedAudioGrain]:
         """Generator that yields Grains read from the input given
 
         :yields: Grain objects read from the raw input supplied
         """
         frames = self._frames()
 
         # Parse metadata from the first frame which will override the defaults in self.template_grain
```

### Comparing `mediagrains-3.5.2/mediagrains/utils/adts_aac_parser.py` & `mediagrains-4.0.0/mediagrains/utils/adts_aac_parser.py`

 * *Files identical despite different names*

### Comparing `mediagrains-3.5.2/mediagrains/utils/asyncbinaryio.py` & `mediagrains-4.0.0/mediagrains/utils/asyncbinaryio.py`

 * *Files 2% similar despite different names*

```diff
@@ -26,16 +26,14 @@
 from typing import Type, Union, Optional, IO, cast, TypeVar, Callable, Coroutine
 from io import RawIOBase, UnsupportedOperation
 
 from asyncio import StreamReader, StreamWriter
 import asyncio
 from functools import wraps
 
-from deprecated import deprecated
-
 
 class OpenAsyncBinaryIO(metaclass=ABCMeta):
     async def read(self, size: int = -1) -> bytes:
         if size == -1:
             return await self.readall()
         else:
             while True:
@@ -181,18 +179,14 @@
 
     def writable(self) -> bool:
         return True
 
     def getbuffer(self) -> bytearray:
         return self._buffer[:self._len]
 
-    @deprecated(version="2.8.0", reason="Use getvalue instead to be more consistent with the standard library")
-    def value(self) -> bytes:
-        return self.getvalue()
-
     def getvalue(self) -> bytes:
         return bytes(self._buffer[:self._len])
 
 
 class AsyncBytesIO(AsyncBinaryIO):
     def __init__(self, b: bytes = b""):
         super().__init__(cls=OpenAsyncBytesIO, b=b)
```

### Comparing `mediagrains-3.5.2/mediagrains/utils/grain_wrapper.py` & `mediagrains-4.0.0/mediagrains/utils/grain_wrapper.py`

 * *Files identical despite different names*

### Comparing `mediagrains-3.5.2/mediagrains/utils/h264_grain_wrapper.py` & `mediagrains-4.0.0/mediagrains/utils/h264_grain_wrapper.py`

 * *Files identical despite different names*

### Comparing `mediagrains-3.5.2/mediagrains/utils/h264_parser.py` & `mediagrains-4.0.0/mediagrains/utils/h264_parser.py`

 * *Files identical despite different names*

### Comparing `mediagrains-3.5.2/mediagrains/utils/iobytes.py` & `mediagrains-4.0.0/mediagrains/utils/iobytes.py`

 * *Files identical despite different names*

### Comparing `mediagrains-3.5.2/mediagrains.egg-info/SOURCES.txt` & `mediagrains-4.0.0/mediagrains.egg-info/SOURCES.txt`

 * *Files 27% similar despite different names*

```diff
@@ -1,39 +1,38 @@
 COPYING
 ICLA.md
 LICENSE.md
 MANIFEST.in
 README.md
 setup.cfg
 setup.py
-examples/audio.gsf
-examples/coded_audio.gsf
-examples/coded_video.gsf
-examples/event.gsf
-examples/interleaved.gsf
-examples/video.gsf
+examples/audio_7.gsf
+examples/audio_8.gsf
+examples/coded_audio_7.gsf
+examples/coded_audio_8.gsf
+examples/coded_video_7.gsf
+examples/coded_video_8.gsf
+examples/event_7.gsf
+examples/event_8.gsf
+examples/interleaved_7.gsf
+examples/interleaved_8.gsf
+examples/video_7.gsf
+examples/video_8.gsf
 mediagrains/__init__.py
 mediagrains/_version.py
 mediagrains/cogenums.py
-mediagrains/grain.py
-mediagrains/grain_constructors.py
 mediagrains/gsf.py
 mediagrains/py.typed
-mediagrains/testsignalgenerator.py
 mediagrains/typing.py
 mediagrains.egg-info/PKG-INFO
 mediagrains.egg-info/SOURCES.txt
 mediagrains.egg-info/dependency_links.txt
 mediagrains.egg-info/entry_points.txt
 mediagrains.egg-info/requires.txt
 mediagrains.egg-info/top_level.txt
-mediagrains/asyncio/__init__.py
-mediagrains/asyncio/aiobytes.py
-mediagrains/asyncio/bytesaio.py
-mediagrains/asyncio/py.typed
 mediagrains/comparison/__init__.py
 mediagrains/comparison/__main__.py
 mediagrains/comparison/_internal.py
 mediagrains/comparison/options.py
 mediagrains/comparison/psnr.py
 mediagrains/comparison/py.typed
 mediagrains/grains/AudioGrain.py
@@ -42,20 +41,17 @@
 mediagrains/grains/EventGrain.py
 mediagrains/grains/Grain.py
 mediagrains/grains/VideoGrain.py
 mediagrains/grains/__init__.py
 mediagrains/hypothesis/__init__.py
 mediagrains/hypothesis/py.typed
 mediagrains/hypothesis/strategies.py
-mediagrains/hypothesis/strategies_new.py
 mediagrains/numpy/__init__.py
-mediagrains/numpy/audiograin.py
 mediagrains/numpy/convert.py
 mediagrains/numpy/py.typed
-mediagrains/numpy/videograin.py
 mediagrains/numpy/numpy_grains/AudioGrain.py
 mediagrains/numpy/numpy_grains/VideoGrain.py
 mediagrains/numpy/numpy_grains/__init__.py
 mediagrains/patterngenerators/__init__.py
 mediagrains/patterngenerators/abc.py
 mediagrains/patterngenerators/py.typed
 mediagrains/patterngenerators/audio/__init__.py
@@ -80,30 +76,20 @@
 mediagrains/utils/adts_aac_parser.py
 mediagrains/utils/asyncbinaryio.py
 mediagrains/utils/grain_wrapper.py
 mediagrains/utils/h264_grain_wrapper.py
 mediagrains/utils/h264_parser.py
 mediagrains/utils/iobytes.py
 mediagrains/utils/py.typed
-mediagrains/utils/synchronise.py
+tests/__init__.py
 tests/audio_utils.py
 tests/fixtures.py
 tests/test_adts_aac_parser.py
-tests/test_asyncio_gsf.py
-tests/test_asyncio_gsf_newcode.py
 tests/test_audio_psnr.py
-tests/test_audio_psnr_newcode.py
 tests/test_comparison.py
-tests/test_comparison_newcode.py
 tests/test_grain.py
-tests/test_grain_newcode.py
 tests/test_gsf.py
-tests/test_gsf_newcode.py
 tests/test_iobytes.py
 tests/test_numpy_audiograin.py
-tests/test_numpy_audiograin_newcode.py
 tests/test_numpy_videograin.py
-tests/test_numpy_videograin_newcode.py
 tests/test_patterngenerators.py
-tests/test_testsignalgenerator.py
-tests/test_video_psnr.py
-tests/test_video_psnr_newcode.py
+tests/test_video_psnr.py
```

### Comparing `mediagrains-3.5.2/setup.py` & `mediagrains-4.0.0/setup.py`

 * *Files 8% similar despite different names*

```diff
@@ -36,15 +36,14 @@
     __version__ = "0.0.0"
 
 package_names = [
     'mediagrains',
     'mediagrains.hypothesis',
     'mediagrains.comparison',
     'mediagrains.utils',
-    'mediagrains.asyncio',
     'mediagrains.numpy',
     'mediagrains.tools',
     'mediagrains.patterngenerators',
     'mediagrains.patterngenerators.video',
     'mediagrains.patterngenerators.audio',
     'mediagrains.grains',
     'mediagrains.numpy.numpy_grains'
```

### Comparing `mediagrains-3.5.2/tests/audio_utils.py` & `mediagrains-4.0.0/tests/audio_utils.py`

 * *Files identical despite different names*

### Comparing `mediagrains-3.5.2/tests/fixtures.py` & `mediagrains-4.0.0/tests/fixtures.py`

 * *Files 2% similar despite different names*

```diff
@@ -16,15 +16,15 @@
 
 from __future__ import print_function
 from __future__ import absolute_import
 
 from hypothesis.strategies import lists, sampled_from, just, tuples, fixed_dictionaries
 from mediagrains.hypothesis.strategies import grains, strategy_for_grain_attribute, grains_from_template_with_data
 
-from mediagrains.grain import attributes_for_grain_type
+from mediagrains.grains import attributes_for_grain_type
 
 from copy import deepcopy
 
 import asyncio
 import warnings
 
 from functools import wraps
@@ -61,15 +61,15 @@
 def attribute_and_pairs_of_grains_of_type_differing_only_in_one_attribute(grain_type):
     """Strategy giving a tuple of an attribute name and a pair of grains of the specified type that differ only in the
     drawn attribute.
 
     For some types of grain the attribute drawn can include "data" which is generated a little differently from other
     types of attribute as befits its unusual nature"""
 
-    attr_strat = attributes_for_grain_type(grain_type)
+    attr_strat = attributes_for_grain_type(grain_type, new=True)
     grain_strat = sampled_from(attr_strat).flatmap(
         lambda attr: tuples(
             just(attr),
             pairs_of_grains_of_type_differing_only_at_specified_attribute(
                 grain_type, attr)))
 
     if grain_type in ("audio", "video", "coded_audio", "coded_video"):
```

### Comparing `mediagrains-3.5.2/tests/test_adts_aac_parser.py` & `mediagrains-4.0.0/tests/test_adts_aac_parser.py`

 * *Files identical despite different names*

### Comparing `mediagrains-3.5.2/tests/test_audio_psnr.py` & `mediagrains-4.0.0/tests/test_audio_psnr.py`

 * *Files 1% similar despite different names*

```diff
@@ -15,28 +15,28 @@
 
 from unittest import IsolatedAsyncioTestCase
 
 import uuid
 from fractions import Fraction
 import math
 
-from mediagrains.grain_constructors import AudioGrain as bytes_AudioGrain
+from mediagrains.grains import AudioGrain as bytes_AudioGrain
 from mediagrains.cogenums import (
     CogAudioFormat,
     COG_AUDIO_FORMAT_DEPTH,
     COG_AUDIO_FORMAT_DEPTH_S16,
     COG_AUDIO_FORMAT_DEPTH_S24,
     COG_AUDIO_FORMAT_DEPTH_S32,
     COG_AUDIO_IS_FLOAT,
     COG_AUDIO_IS_DOUBLE
 )
 from mediagrains.comparison import compare_grain, compute_psnr
 from mediagrains.comparison.options import PSNR as PSNR_option
 
-from audio_utils import construct_audio_grain_data
+from .audio_utils import construct_audio_grain_data
 
 PCM_FORMATS = [
     CogAudioFormat.S16_PLANES,
     CogAudioFormat.S16_PAIRS,
     CogAudioFormat.S16_INTERLEAVED,
     CogAudioFormat.S24_PLANES,
     CogAudioFormat.S24_PAIRS,
```

### Comparing `mediagrains-3.5.2/tests/test_comparison.py` & `mediagrains-4.0.0/tests/test_comparison.py`

 * *Files 19% similar despite different names*

```diff
@@ -12,27 +12,29 @@
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 #
 
 import unittest
 from unittest import TestCase
+from uuid import UUID
 
 from hypothesis import given, assume, settings
 from hypothesis.strategies import sampled_from, just, tuples, integers
+from mediagrains.cogenums import CogAudioFormat, CogFrameFormat, CogFrameLayout
 from mediagrains.hypothesis.strategies import grains_with_data, grains
 
 from mediagrains.comparison import compare_grain, compare_grains_pairwise
 from mediagrains.comparison.options import Exclude, Include
 
-from mediagrains.grain import attributes_for_grain_type
+from mediagrains.grains import AudioGrain, VideoGrain, new_attributes_for_grain_type as attributes_for_grain_type
 
 from copy import deepcopy
 
-from fixtures import pairs_of, attribute_and_pairs_of_grains_of_type_differing_only_in_one_attribute
+from .fixtures import pairs_of, attribute_and_pairs_of_grains_of_type_differing_only_in_one_attribute
 
 
 GRAIN_TYPES_TO_TEST = ["empty", "event", "audio", "video", "coded_audio", "coded_video"]
 
 
 class TestCompareGrain(TestCase):
     @given(sampled_from(GRAIN_TYPES_TO_TEST).flatmap(grains_with_data))
@@ -91,14 +93,55 @@
         c = compare_grain(a, b, Include.creation_timestamp, getattr(Exclude, excl))
         self.assertTrue(
             c,
             msg="Comparison of {!r} and {!r} excluding {} was unequal when equality was expected:\n\n{}".format(
                 a, b, excl, str(c)))
         self.assertEqual(c.failing_attributes(), [])
 
+    def test_excluding_equivalent_attributes__videograin(self):
+        base_grain = VideoGrain(
+            src_id=UUID("34a02375-0235-4e08-9423-b41de5eea9e1"),
+            flow_id=UUID("0b2bf00f-d669-410f-a52f-50715d3bb2ba"),
+            cog_frame_format=CogFrameFormat.RGB,
+            cog_frame_layout=CogFrameLayout.FULL_FRAME
+        )
+
+        alternative_attributes = {
+            "source_id": UUID("82247c5c-df69-4e8c-abce-d8548bf02b2a"),
+            "format": CogFrameFormat.ALPHA_U8,
+            "layout": CogFrameLayout.MIXED_FIELDS
+        }
+
+        for attribute in alternative_attributes.keys():
+            with self.subTest(attribute=attribute):
+                comparison_grain = deepcopy(base_grain)
+                setattr(comparison_grain, attribute, alternative_attributes[attribute])
+
+                c = compare_grain(base_grain, comparison_grain, Include.creation_timestamp, getattr(Exclude, attribute))
+                self.assertTrue(
+                    c,
+                    msg="Comparison of {!r} and {!r} excluding {} was unequal when equality was expected:\n\n{}".format(
+                        base_grain, compare_grain, attribute, str(c)))
+
+    def test_excluding_equivalent_attributes__audiograin(self):
+        base_grain = AudioGrain(
+            src_id=UUID("77bce283-6387-48fd-b7e9-ace8df438fdc"),
+            flow_id=UUID("a367a089-22a5-4511-9682-f2f687cd0c1b"),
+            cog_audio_format=CogAudioFormat.AAC
+        )
+
+        comparison_grain = deepcopy(base_grain)
+        comparison_grain.cog_audio_format = CogAudioFormat.DOUBLE_INTERLEAVED
+
+        c = compare_grain(base_grain, comparison_grain, Include.creation_timestamp, getattr(Exclude, "format"))
+        self.assertTrue(
+            c,
+            msg="Comparison of {!r} and {!r} excluding {} was unequal when equality was expected:\n\n{}".format(
+                base_grain, compare_grain, "format", str(c)))
+
     @given(sampled_from(GRAIN_TYPES_TO_TEST).flatmap(lambda grain_type: tuples(
         sampled_from(
             attributes_for_grain_type(grain_type)),
         just(attributes_for_grain_type(grain_type)),
         pairs_of(grains_with_data(grain_type)))))
     def test_unequal_grains_compare_as_unequal_with_exclusions_when_difference_is_not_excluded(self, data_in):
         (excl, attrs, (a, b)) = data_in
@@ -113,30 +156,34 @@
 
 
 class TestCompareGrainIterators(TestCase):
     """Test comparing interators of Grains pairwise.
 
     Note that a maximum of 20 Grains is applied here; there's no significant change to the code path as the number
     of grains increases beyond that point.
+
+    Due to Hypothesis weirdness timeouts are also surpressed on this test, and it runs very slowly.
     """
     @given(sampled_from(GRAIN_TYPES_TO_TEST).flatmap(grains), integers(min_value=1, max_value=20))
+    @settings(deadline=None)
     def test_pairwise_comparison__equal(self, sample_grain, grain_count):
         a_grains = [sample_grain] * grain_count
         b_grains = deepcopy(a_grains)
         c = compare_grains_pairwise(a_grains, b_grains)
         self.assertTrue(
             c,
             msg="Comparison of {!r} and {!r} was unequal when equality was expected:\n\n{}".format(
                 a_grains, b_grains, str(c)
             )
         )
 
         self.assertEqual(len(a_grains), len(c.children))
 
     @given(pairs_of(sampled_from(GRAIN_TYPES_TO_TEST).flatmap(grains)), integers(min_value=0, max_value=19))
+    @settings(deadline=None)
     def test_pairwise_comparison__unequal(self, pair, difference_index):
         (a, b) = pair
         assume(a != b)
 
         a_grains = [a] * 20
         b_grains = deepcopy(a_grains)
         b_grains[difference_index] = b
@@ -149,14 +196,15 @@
             )
         )
 
         self.assertEqual(difference_index + 1, len(c.children))
 
     @given(sampled_from(GRAIN_TYPES_TO_TEST).flatmap(grains),
            integers(min_value=1, max_value=20), integers(min_value=1, max_value=20))
+    @settings(deadline=None)
     def test_pairwise_comparison__different_length_unequal(self, sample_grain, grain_count_a, grain_count_b):
         """Test that pairwise comparison doesn't match if the grain iterators have different lengths"""
         assume(grain_count_a != grain_count_b)
 
         a_grains = [sample_grain] * grain_count_a
         b_grains = [sample_grain] * grain_count_b
 
@@ -165,14 +213,15 @@
             c,
             msg="Comparison of {!r} and {!r} was unequal when equality was expected:\n\n{}".format(
                 a_grains, b_grains, str(c)
             )
         )
 
     @given(sampled_from(GRAIN_TYPES_TO_TEST).flatmap(grains), integers(min_value=1, max_value=20))
+    @settings(deadline=None)
     def test_pairwise_comparison__return_last_only(self, sample_grain, grain_count):
         a_grains = [sample_grain] * grain_count
         b_grains = deepcopy(a_grains)
         c = compare_grains_pairwise(a_grains, b_grains, return_last_only=True)
         self.assertTrue(
             c,
             msg="Comparison of {!r} and {!r} was unequal when equality was expected:\n\n{}".format(
```

### Comparing `mediagrains-3.5.2/tests/test_grain.py` & `mediagrains-4.0.0/tests/test_grain.py`

 * *Files 5% similar despite different names*

```diff
@@ -12,15 +12,16 @@
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 #
 
 from unittest import IsolatedAsyncioTestCase, mock
 import uuid
-from mediagrains import Grain, VideoGrain, AudioGrain, CodedVideoGrain, CodedAudioGrain, EventGrain
+from mediagrains.grains import VideoGrain, AudioGrain, CodedVideoGrain, CodedAudioGrain, EventGrain
+from mediagrains.grains.Grain import GrainFactory as Grain
 from mediagrains.cogenums import CogFrameFormat, CogFrameLayout, CogAudioFormat
 from mediatimestamp.immutable import Timestamp, TimeOffset, TimeRange
 from fractions import Fraction
 import json
 from copy import copy, deepcopy
 
 
@@ -88,15 +89,15 @@
     def __mediatimestamp__(self) -> Timestamp:
         return self.ts
 
 
 class TestGrain (IsolatedAsyncioTestCase):
     def test_empty_grain_creation(self):
         with mock.patch.object(Timestamp, "get_time", return_value=cts):
-            grain = Grain(src_id, flow_id)
+            grain = Grain(src_id=src_id, flow_id=flow_id)
 
         self.assertEqual(grain.grain_type, "empty")
         self.assertEqual(grain.source_id, src_id)
         self.assertEqual(grain.flow_id, flow_id)
         self.assertEqual(grain.origin_timestamp, cts)
         self.assertEqual(grain.final_origin_timestamp(), cts)
         self.assertEqual(grain.origin_timerange(), TimeRange.from_single_timestamp(cts))
@@ -149,15 +150,15 @@
         self.assertEqual(grain.rate, Fraction(25, 1))
         self.assertEqual(grain.duration, Fraction(1, 25))
         self.assertEqual(grain.length, 0)
         self.assertEqual(grain.expected_length, 23)
 
     def test_empty_grain_creation_with_ots(self):
         with mock.patch.object(Timestamp, "get_time", return_value=cts):
-            grain = Grain(src_id, flow_id, origin_timestamp=ots)
+            grain = Grain(src_id=src_id, flow_id=flow_id, origin_timestamp=ots)
 
         self.assertEqual(grain.grain_type, "empty")
         self.assertEqual(grain.source_id, src_id)
         self.assertEqual(grain.flow_id, flow_id)
         self.assertEqual(grain.origin_timestamp, ots)
         self.assertEqual(grain.final_origin_timestamp(), ots)
         self.assertEqual(grain.origin_timerange(), TimeRange.from_single_timestamp(ots))
@@ -167,15 +168,15 @@
         self.assertEqual(grain.duration, Fraction(0, 1))
         self.assertEqual(grain.timelabels, [])
 
     def test_empty_grain_creation_with_convertable_ots(self):
         converts_to_ots = ConvertsToTimestamp(ots)
 
         with mock.patch.object(Timestamp, "get_time", return_value=cts):
-            grain = Grain(src_id, flow_id, origin_timestamp=converts_to_ots)
+            grain = Grain(src_id=src_id, flow_id=flow_id, origin_timestamp=converts_to_ots)
 
         self.assertEqual(grain.grain_type, "empty")
         self.assertEqual(grain.source_id, src_id)
         self.assertEqual(grain.flow_id, flow_id)
         self.assertEqual(grain.origin_timestamp, ots)
         self.assertEqual(grain.final_origin_timestamp(), ots)
         self.assertEqual(grain.origin_timerange(), TimeRange.from_single_timestamp(ots))
@@ -183,15 +184,15 @@
         self.assertEqual(grain.creation_timestamp, cts)
         self.assertEqual(grain.rate, Fraction(0, 1))
         self.assertEqual(grain.duration, Fraction(0, 1))
         self.assertEqual(grain.timelabels, [])
 
     def test_empty_grain_creation_with_ots_and_sts(self):
         with mock.patch.object(Timestamp, "get_time", return_value=cts):
-            grain = Grain(src_id, flow_id, origin_timestamp=ots, sync_timestamp=sts)
+            grain = Grain(src_id=src_id, flow_id=flow_id, origin_timestamp=ots, sync_timestamp=sts)
 
         self.assertEqual(grain.grain_type, "empty")
         self.assertEqual(grain.source_id, src_id)
         self.assertEqual(grain.flow_id, flow_id)
         self.assertEqual(grain.origin_timestamp, ots)
         self.assertEqual(grain.final_origin_timestamp(), ots)
         self.assertEqual(grain.origin_timerange(), TimeRange.from_single_timestamp(ots))
@@ -199,15 +200,15 @@
         self.assertEqual(grain.creation_timestamp, cts)
         self.assertEqual(grain.rate, Fraction(0, 1))
         self.assertEqual(grain.duration, Fraction(0, 1))
         self.assertEqual(grain.timelabels, [])
 
     def test_empty_grain_castable_to_tuple(self):
         with mock.patch.object(Timestamp, "get_time", return_value=cts):
-            grain = Grain(src_id, flow_id, origin_timestamp=ots, sync_timestamp=sts)
+            grain = Grain(src_id=src_id, flow_id=flow_id, origin_timestamp=ots, sync_timestamp=sts)
 
         self.assertEqual(len(grain), 2)
         self.assertIsInstance(grain[0], dict)
         self.assertIsNone(grain[1])
 
         with self.assertRaises(IndexError):
             grain[2]
@@ -241,15 +242,15 @@
                         "drop_frame": False
                     }
                 }]
             }
         }
 
         with mock.patch.object(Timestamp, "get_time", return_value=cts):
-            grain = Grain(meta)
+            grain = Grain(meta=meta)
 
         self.assertEqual(grain.grain_type, "empty")
         self.assertEqual(grain.source_id, src_id)
         self.assertEqual(grain.flow_id, flow_id)
         self.assertEqual(grain.origin_timestamp, ots)
         self.assertEqual(grain.final_origin_timestamp(), ots)
         self.assertEqual(grain.origin_timerange(), TimeRange.from_single_timestamp(ots))
@@ -268,15 +269,15 @@
                 }
             }
         ])
         self.assertEqual(repr(grain), "Grain({!r})".format(meta))
 
     def test_empty_grain_setters(self):
         with mock.patch.object(Timestamp, "get_time", return_value=cts):
-            grain = Grain(src_id, flow_id, origin_timestamp=ots, sync_timestamp=sts)
+            grain = Grain(src_id=src_id, flow_id=flow_id, origin_timestamp=ots, sync_timestamp=sts)
 
         new_src_id = uuid.UUID("18d1a52e-0a67-11e8-ba57-776dc8ceabcb")
         new_flow_id = uuid.UUID("1ed4cfb4-0a67-11e8-b803-733e0764879a")
         new_cts = Timestamp.from_tai_sec_nsec("417798915:15")
         new_ots = Timestamp.from_tai_sec_nsec("417798915:20")
         new_sts = Timestamp.from_tai_sec_nsec("417798915:25")
         new_grain_type = "potato"
@@ -364,15 +365,15 @@
                     'frame_rate_denominator': 1001,
                     'drop_frame': True
                 }
             }
 
     def test_video_grain_create_YUV422_10bit(self):
         with mock.patch.object(Timestamp, "get_time", return_value=cts):
-            grain = VideoGrain(src_id, flow_id, origin_timestamp=ots, sync_timestamp=sts,
+            grain = VideoGrain(src_id=src_id, flow_id=flow_id, origin_timestamp=ots, sync_timestamp=sts,
                                cog_frame_format=CogFrameFormat.S16_422_10BIT,
                                width=1920, height=1080, cog_frame_layout=CogFrameLayout.FULL_FRAME)
 
         self.assertEqual(grain.grain_type, "video")
         self.assertEqual(grain.source_id, src_id)
         self.assertEqual(grain.flow_id, flow_id)
         self.assertEqual(grain.origin_timestamp, ots)
@@ -380,18 +381,18 @@
         self.assertEqual(grain.origin_timerange(), TimeRange.from_single_timestamp(ots))
         self.assertEqual(grain.sync_timestamp, sts)
         self.assertEqual(grain.creation_timestamp, cts)
         self.assertEqual(grain.rate, Fraction(25, 1))
         self.assertEqual(grain.media_rate, Fraction(25, 1))
         self.assertEqual(grain.duration, Fraction(1, 25))
         self.assertEqual(grain.timelabels, [])
-        self.assertEqual(grain.format, CogFrameFormat.S16_422_10BIT)
+        self.assertEqual(grain.cog_frame_format, CogFrameFormat.S16_422_10BIT)
         self.assertEqual(grain.width, 1920)
         self.assertEqual(grain.height, 1080)
-        self.assertEqual(grain.layout, CogFrameLayout.FULL_FRAME)
+        self.assertEqual(grain.cog_frame_layout, CogFrameLayout.FULL_FRAME)
         self.assertEqual(grain.extension, 0)
         self.assertIsNone(grain.source_aspect_ratio)
         self.assertIsNone(grain.pixel_aspect_ratio)
 
         self.assertEqual(len(grain.components), 3)
         self.assertEqual(grain.components[0].stride, 1920*2)
         self.assertEqual(grain.components[0].width, 1920)
@@ -453,30 +454,30 @@
                 (CogFrameFormat.RGB, (1920*1080*3,)),
                 (CogFrameFormat.RGBA, (1920*1080*4,)),
                 (CogFrameFormat.v210, (40*128*1080,)),
                 (CogFrameFormat.v216, (1920*1080*4,)),
                 (CogFrameFormat.UNKNOWN, ()),
                 ]:
             with mock.patch.object(Timestamp, "get_time", return_value=cts):
-                grain = VideoGrain(src_id, flow_id, origin_timestamp=ots, sync_timestamp=sts,
+                grain = VideoGrain(src_id=src_id, flow_id=flow_id, origin_timestamp=ots, sync_timestamp=sts,
                                    cog_frame_format=fmt,
                                    width=1920, height=1080, cog_frame_layout=CogFrameLayout.FULL_FRAME)
 
             self.assertEqual(len(grain.components), len(complens))
             offset = 0
             for (complen, comp) in zip(complens, grain.components):
                 self.assertEqual(complen, comp.length)
                 self.assertEqual(offset, comp.offset)
                 offset += complen
 
             self.assertEqual(len(grain.data), offset)
 
     def test_video_component_setters(self):
         with mock.patch.object(Timestamp, "get_time", return_value=cts):
-            grain = VideoGrain(src_id, flow_id, origin_timestamp=ots, sync_timestamp=sts,
+            grain = VideoGrain(src_id=src_id, flow_id=flow_id, origin_timestamp=ots, sync_timestamp=sts,
                                cog_frame_format=CogFrameFormat.S16_422_10BIT,
                                width=1920, height=1080, cog_frame_layout=CogFrameLayout.FULL_FRAME)
 
         grain.components[0].stride = 23
         self.assertEqual(grain.components[0].stride, 23)
         grain.components[0].width = 23
         self.assertEqual(grain.components[0].width, 23)
@@ -538,24 +539,24 @@
                     }
             },
         }
 
         with mock.patch.object(Timestamp, "get_time", return_value=cts):
             grain = VideoGrain(meta)
 
-        self.assertEqual(grain.format, CogFrameFormat.UNKNOWN)
+        self.assertEqual(grain.cog_frame_format, CogFrameFormat.UNKNOWN)
         self.assertEqual(grain.width, 0)
         self.assertEqual(grain.height, 0)
-        self.assertEqual(grain.layout, CogFrameLayout.UNKNOWN)
+        self.assertEqual(grain.cog_frame_layout, CogFrameLayout.UNKNOWN)
         self.assertEqual(grain.extension, 0)
         self.assertEqual(len(grain.components), 0)
 
     def test_video_grain_with_numeric_identifiers(self):
         with mock.patch.object(Timestamp, "get_time", return_value=cts):
-            grain = VideoGrain(src_id, flow_id, origin_timestamp=ots, sync_timestamp=sts,
+            grain = VideoGrain(src_id=src_id, flow_id=flow_id, origin_timestamp=ots, sync_timestamp=sts,
                                cog_frame_format=0x2805,
                                width=1920, height=1080,
                                cog_frame_layout=0)
 
         self.assertEqual(grain.grain_type, "video")
         self.assertEqual(grain.source_id, src_id)
         self.assertEqual(grain.flow_id, flow_id)
@@ -563,18 +564,18 @@
         self.assertEqual(grain.final_origin_timestamp(), ots)
         self.assertEqual(grain.origin_timerange(), TimeRange.from_single_timestamp(ots))
         self.assertEqual(grain.sync_timestamp, sts)
         self.assertEqual(grain.creation_timestamp, cts)
         self.assertEqual(grain.rate, Fraction(25, 1))
         self.assertEqual(grain.duration, Fraction(1, 25))
         self.assertEqual(grain.timelabels, [])
-        self.assertEqual(grain.format, CogFrameFormat.S16_422_10BIT)
+        self.assertEqual(grain.cog_frame_format, CogFrameFormat.S16_422_10BIT)
         self.assertEqual(grain.width, 1920)
         self.assertEqual(grain.height, 1080)
-        self.assertEqual(grain.layout, CogFrameLayout.FULL_FRAME)
+        self.assertEqual(grain.cog_frame_layout, CogFrameLayout.FULL_FRAME)
         self.assertEqual(grain.extension, 0)
         self.assertIsNone(grain.source_aspect_ratio)
         self.assertIsNone(grain.pixel_aspect_ratio)
 
         self.assertEqual(len(grain.components), 3)
         self.assertEqual(grain.components[0].stride, 1920*2)
         self.assertEqual(grain.components[0].width, 1920)
@@ -605,33 +606,33 @@
                                                      'width': 1920,
                                                      'height': 1080,
                                                      'offset': 0,
                                                      'length': 1920*1080*2})
 
     def test_video_grain_setters(self):
         with mock.patch.object(Timestamp, "get_time", return_value=cts):
-            grain = VideoGrain(src_id, flow_id, origin_timestamp=ots, sync_timestamp=sts,
+            grain = VideoGrain(src_id=src_id, flow_id=flow_id, origin_timestamp=ots, sync_timestamp=sts,
                                cog_frame_format=CogFrameFormat.S16_422_10BIT,
                                width=1920, height=1080, cog_frame_layout=CogFrameLayout.FULL_FRAME)
 
-        grain.format = CogFrameFormat.S16_444
-        self.assertEqual(grain.format, CogFrameFormat.S16_444)
-        grain.format = 0x0207
-        self.assertEqual(grain.format, CogFrameFormat.VC2)
+        grain.cog_frame_format = CogFrameFormat.S16_444
+        self.assertEqual(grain.cog_frame_format, CogFrameFormat.S16_444)
+        grain.cog_frame_format = 0x0207
+        self.assertEqual(grain.cog_frame_format, CogFrameFormat.VC2)
 
         grain.width = 2
         self.assertEqual(grain.width, 2)
 
         grain.height = 13
         self.assertEqual(grain.height, 13)
 
-        grain.layout = CogFrameLayout.SEPARATE_FIELDS
-        self.assertEqual(grain.layout, CogFrameLayout.SEPARATE_FIELDS)
-        grain.layout = 0x02
-        self.assertEqual(grain.layout, CogFrameLayout.SINGLE_FIELD)
+        grain.cog_frame_layout = CogFrameLayout.SEPARATE_FIELDS
+        self.assertEqual(grain.cog_frame_layout, CogFrameLayout.SEPARATE_FIELDS)
+        grain.cog_frame_layout = 0x02
+        self.assertEqual(grain.cog_frame_layout, CogFrameLayout.SINGLE_FIELD)
 
         grain.extension = 1
         self.assertEqual(grain.extension, 1)
 
         grain.source_aspect_ratio = 50
         self.assertEqual(grain.source_aspect_ratio, Fraction(50, 1))
 
@@ -640,87 +641,87 @@
 
     def test_grain_fails_with_no_metadata(self):
         with self.assertRaises(AttributeError):
             Grain(None)
 
     def test_grain_fails_with_bad_src_id(self):
         with self.assertRaises(AttributeError):
-            Grain([], 0x44)
+            Grain(src_id=[], flow_id=0x44)
 
-    def test_video_grain_with_no_metadata(self):
+    def test_video_grain_create_with_no_metadata(self):
         with mock.patch.object(Timestamp, "get_time", return_value=cts):
             grain = VideoGrain()
 
         self.assertEqual(grain.origin_timestamp, cts)
         self.assertEqual(grain.sync_timestamp, cts)
         self.assertEqual(grain.creation_timestamp, cts)
         self.assertEqual(grain.grain_type, "video")
         self.assertEqual(grain.rate, Fraction(25, 1))
         self.assertEqual(grain.duration, Fraction(1, 25))
         self.assertEqual(grain.timelabels, [])
-        self.assertEqual(grain.format, CogFrameFormat.UNKNOWN)
+        self.assertEqual(grain.cog_frame_format, CogFrameFormat.UNKNOWN)
         self.assertEqual(grain.width, 1920)
         self.assertEqual(grain.height, 1080)
-        self.assertEqual(grain.layout, CogFrameLayout.UNKNOWN)
+        self.assertEqual(grain.cog_frame_layout, CogFrameLayout.UNKNOWN)
         self.assertEqual(grain.extension, 0)
         self.assertIsNone(grain.source_aspect_ratio)
         self.assertIsNone(grain.pixel_aspect_ratio)
 
     def test_video_grain_create_with_ots_and_no_sts(self):
         with mock.patch.object(Timestamp, "get_time", return_value=cts):
-            grain = VideoGrain(src_id, flow_id, origin_timestamp=ots,
+            grain = VideoGrain(src_id=src_id, flow_id=flow_id, origin_timestamp=ots,
                                cog_frame_format=CogFrameFormat.S16_422_10BIT,
                                width=1920, height=1080, cog_frame_layout=CogFrameLayout.FULL_FRAME)
 
         self.assertEqual(grain.origin_timestamp, ots)
         self.assertEqual(grain.final_origin_timestamp(), ots)
         self.assertEqual(grain.origin_timerange(), TimeRange.from_single_timestamp(ots))
         self.assertEqual(grain.sync_timestamp, ots)
         self.assertEqual(grain.creation_timestamp, cts)
 
     def test_video_grain_create_with_no_ots_and_no_sts(self):
         with mock.patch.object(Timestamp, "get_time", return_value=cts):
-            grain = VideoGrain(src_id, flow_id,
+            grain = VideoGrain(src_id=src_id, flow_id=flow_id,
                                cog_frame_format=CogFrameFormat.S16_422_10BIT,
                                width=1920, height=1080, cog_frame_layout=CogFrameLayout.FULL_FRAME)
 
         self.assertEqual(grain.origin_timestamp, cts)
         self.assertEqual(grain.final_origin_timestamp(), cts)
         self.assertEqual(grain.origin_timerange(), TimeRange.from_single_timestamp(cts))
         self.assertEqual(grain.sync_timestamp, cts)
         self.assertEqual(grain.creation_timestamp, cts)
 
     def test_videograin_meta_is_json_serialisable(self):
         with mock.patch.object(Timestamp, "get_time", return_value=cts):
-            grain = VideoGrain(src_id, flow_id, origin_timestamp=ots,
+            grain = VideoGrain(src_id=src_id, flow_id=flow_id, origin_timestamp=ots,
                                cog_frame_format=CogFrameFormat.S16_422_10BIT,
                                width=1920, height=1080, cog_frame_layout=CogFrameLayout.FULL_FRAME)
 
         self.assertEqual(json.loads(json.dumps(grain.meta)), grain.meta)
 
     def test_grain_makes_videograin(self):
         meta = VIDEOGRAIN_TEST_METADATA
         data = bytearray(8192*1080)
 
         with mock.patch.object(Timestamp, "get_time", return_value=cts):
             grain = Grain(meta, data=data)
 
         self.assertEqual(grain.grain_type, "video")
-        self.assertEqual(grain.format, CogFrameFormat.S16_422_10BIT)
+        self.assertEqual(grain.cog_frame_format, CogFrameFormat.S16_422_10BIT)
         self.assertEqual(grain.meta, meta)
         self.assertEqual(grain.data, data)
 
     def test_grain_makes_videograin_without_data(self):
         meta = VIDEOGRAIN_TEST_METADATA
 
         with mock.patch.object(Timestamp, "get_time", return_value=cts):
             grain = Grain(meta)
 
         self.assertEqual(grain.grain_type, "video")
-        self.assertEqual(grain.format, CogFrameFormat.S16_422_10BIT)
+        self.assertEqual(grain.cog_frame_format, CogFrameFormat.S16_422_10BIT)
         self.assertEqual(grain.meta, meta)
         self.assertEqual(grain.length, 0)
         self.assertEqual(grain.expected_length, 8192*1080)
 
     async def test_videograin_with_async_data(self):
         meta = VIDEOGRAIN_TEST_METADATA
 
@@ -730,18 +731,18 @@
                 _data[n] = n & 0xFF
             return _data
 
         data_awaitable = _get_data()
         expected_data = await _get_data()
 
         with mock.patch.object(Timestamp, "get_time", return_value=cts):
-            grain = Grain(meta, data=data_awaitable)
+            grain = Grain(meta=meta, data=data_awaitable)
 
         self.assertEqual(grain.grain_type, "video")
-        self.assertEqual(grain.format, CogFrameFormat.S16_422_10BIT)
+        self.assertEqual(grain.cog_frame_format, CogFrameFormat.S16_422_10BIT)
         self.assertEqual(grain.meta, meta)
         self.assertIsNone(grain.data)
 
         self.assertEqual((await grain)[:16], expected_data[:16])
         self.assertEqual(grain.data[:16], expected_data[:16])
 
     async def test_videograin_with_async_data_as_acm(self):
@@ -753,27 +754,27 @@
                 _data[n] = n & 0xFF
             return _data
 
         data_awaitable = _get_data()
         expected_data = await _get_data()
 
         with mock.patch.object(Timestamp, "get_time", return_value=cts):
-            grain = Grain(meta, data=data_awaitable)
+            grain = Grain(meta=meta, data=data_awaitable)
 
         self.assertEqual(grain.grain_type, "video")
-        self.assertEqual(grain.format, CogFrameFormat.S16_422_10BIT)
+        self.assertEqual(grain.cog_frame_format, CogFrameFormat.S16_422_10BIT)
         self.assertEqual(grain.meta, meta)
         self.assertIsNone(grain.data)
 
         async with grain as _grain:
             self.assertEqual(_grain.data[:16], expected_data[:16])
 
     def test_video_grain_normalise(self):
         with mock.patch.object(Timestamp, "get_time", return_value=ots):
-            grain = VideoGrain(src_id, flow_id, origin_timestamp=ots,
+            grain = VideoGrain(src_id=src_id, flow_id=flow_id, origin_timestamp=ots,
                                rate=Fraction(25, 1),
                                cog_frame_format=CogFrameFormat.S16_422_10BIT,
                                width=1920, height=1080, cog_frame_layout=CogFrameLayout.FULL_FRAME)
 
         self.assertEqual(grain.origin_timestamp, ots)
         self.assertNotEqual(grain.normalise_time(grain.origin_timestamp),
                             ots)
@@ -783,15 +784,15 @@
         self.assertNotEqual(grain.normalise_time(grain.origin_timerange()),
                             TimeRange.from_single_timestamp(ots))
         self.assertEqual(grain.normalise_time(grain.origin_timerange()),
                          TimeRange.from_single_timestamp(ots).normalise(25, 1))
 
     def test_audio_grain_create_S16_PLANES(self):
         with mock.patch.object(Timestamp, "get_time", return_value=cts):
-            grain = AudioGrain(src_id, flow_id, origin_timestamp=ots, sync_timestamp=sts,
+            grain = AudioGrain(src_id=src_id, flow_id=flow_id, origin_timestamp=ots, sync_timestamp=sts,
                                cog_audio_format=CogAudioFormat.S16_PLANES,
                                channels=2, samples=1920, sample_rate=48000)
 
         self.assertEqual(grain.grain_type, "audio")
         self.assertEqual(grain.source_id, src_id)
         self.assertEqual(grain.flow_id, flow_id)
         self.assertEqual(grain.origin_timestamp, ots)
@@ -799,93 +800,93 @@
         self.assertEqual(grain.origin_timerange(), TimeRange(ots, ots + TimeOffset.from_count(1919, 48000, 1)))
         self.assertEqual(grain.sync_timestamp, sts)
         self.assertEqual(grain.creation_timestamp, cts)
         self.assertEqual(grain.rate, Fraction(25, 1))
         self.assertEqual(grain.media_rate, Fraction(48000, 1))
         self.assertEqual(grain.duration, Fraction(1, 25))
         self.assertEqual(grain.timelabels, [])
-        self.assertEqual(grain.format, CogAudioFormat.S16_PLANES)
+        self.assertEqual(grain.cog_audio_format, CogAudioFormat.S16_PLANES)
         self.assertEqual(grain.channels, 2)
         self.assertEqual(grain.samples, 1920)
         self.assertEqual(grain.sample_rate, 48000)
 
         self.assertIsInstance(grain.data, bytearray)
         self.assertEqual(len(grain.data), 1920*2*2)
         self.assertEqual(grain.expected_length, 1920*2*2)
 
         self.assertEqual(
             repr(grain),
             "AudioGrain({!r},< binary data of length {} >)".format(grain.meta, len(grain.data)))
 
     def test_audio_grain_create_fills_in_missing_sts(self):
         with mock.patch.object(Timestamp, "get_time", return_value=cts):
-            grain = AudioGrain(src_id, flow_id, origin_timestamp=ots,
+            grain = AudioGrain(src_id=src_id, flow_id=flow_id, origin_timestamp=ots,
                                cog_audio_format=CogAudioFormat.S16_PLANES,
                                channels=2, samples=1920, sample_rate=48000)
 
         self.assertEqual(grain.grain_type, "audio")
         self.assertEqual(grain.source_id, src_id)
         self.assertEqual(grain.flow_id, flow_id)
         self.assertEqual(grain.origin_timestamp, ots)
         self.assertEqual(grain.final_origin_timestamp(), ots + TimeOffset.from_count(1919, 48000, 1))
         self.assertEqual(grain.origin_timerange(), TimeRange(ots, ots + TimeOffset.from_count(1919, 48000, 1)))
         self.assertEqual(grain.sync_timestamp, ots)
         self.assertEqual(grain.creation_timestamp, cts)
         self.assertEqual(grain.rate, Fraction(25, 1))
         self.assertEqual(grain.duration, Fraction(1, 25))
         self.assertEqual(grain.timelabels, [])
-        self.assertEqual(grain.format, CogAudioFormat.S16_PLANES)
+        self.assertEqual(grain.cog_audio_format, CogAudioFormat.S16_PLANES)
         self.assertEqual(grain.channels, 2)
         self.assertEqual(grain.samples, 1920)
         self.assertEqual(grain.sample_rate, 48000)
 
         self.assertIsInstance(grain.data, bytearray)
         self.assertEqual(len(grain.data), 1920*2*2)
 
         self.assertEqual(
             repr(grain),
             "AudioGrain({!r},< binary data of length {} >)".format(grain.meta, len(grain.data)))
 
     def test_audio_grain_create_fills_in_missing_ots(self):
         with mock.patch.object(Timestamp, "get_time", return_value=cts):
-            grain = AudioGrain(src_id, flow_id,
+            grain = AudioGrain(src_id=src_id, flow_id=flow_id,
                                cog_audio_format=CogAudioFormat.S16_PLANES,
                                channels=2, samples=1920, sample_rate=48000)
 
         self.assertEqual(grain.grain_type, "audio")
         self.assertEqual(grain.source_id, src_id)
         self.assertEqual(grain.flow_id, flow_id)
         self.assertEqual(grain.origin_timestamp, cts)
         self.assertEqual(grain.final_origin_timestamp(), cts + TimeOffset.from_count(1919, 48000, 1))
         self.assertEqual(grain.origin_timerange(), TimeRange(cts, cts + TimeOffset.from_count(1919, 48000, 1)))
         self.assertEqual(grain.sync_timestamp, cts)
         self.assertEqual(grain.creation_timestamp, cts)
         self.assertEqual(grain.rate, Fraction(25, 1))
         self.assertEqual(grain.duration, Fraction(1, 25))
         self.assertEqual(grain.timelabels, [])
-        self.assertEqual(grain.format, CogAudioFormat.S16_PLANES)
+        self.assertEqual(grain.cog_audio_format, CogAudioFormat.S16_PLANES)
         self.assertEqual(grain.channels, 2)
         self.assertEqual(grain.samples, 1920)
         self.assertEqual(grain.sample_rate, 48000)
 
         self.assertIsInstance(grain.data, bytearray)
         self.assertEqual(len(grain.data), 1920*2*2)
 
         self.assertEqual(
             repr(grain),
             "AudioGrain({!r},< binary data of length {} >)".format(grain.meta, len(grain.data)))
 
-    def test_audio_grain_create_no_params(self):
+    def test_audio_grain_create_with_no_params(self):
         with mock.patch.object(Timestamp, "get_time", return_value=cts):
             grain = AudioGrain()
 
         self.assertEqual(grain.creation_timestamp, cts)
         self.assertEqual(grain.origin_timestamp, cts)
         self.assertEqual(grain.sync_timestamp, cts)
-        self.assertEqual(grain.format, CogAudioFormat.INVALID)
+        self.assertEqual(grain.cog_audio_format, CogAudioFormat.INVALID)
         self.assertEqual(grain.channels, 0)
         self.assertEqual(grain.samples, 0)
         self.assertEqual(grain.sample_rate, 48000)
         self.assertEqual(grain.media_rate, Fraction(48000, 1))
 
     def test_audio_grain_create_all_formats(self):
         for (fmt, length) in [(CogAudioFormat.S16_PLANES,         1920*2*2),
@@ -901,59 +902,59 @@
                               (CogAudioFormat.FLOAT_PLANES,       1920*2*4),
                               (CogAudioFormat.FLOAT_PAIRS,        1920*2*4),
                               (CogAudioFormat.FLOAT_INTERLEAVED,  1920*2*4),
                               (CogAudioFormat.DOUBLE_PLANES,      1920*2*8),
                               (CogAudioFormat.DOUBLE_PAIRS,       1920*2*8),
                               (CogAudioFormat.DOUBLE_INTERLEAVED, 1920*2*8)]:
             with mock.patch.object(Timestamp, "get_time", return_value=cts):
-                grain = AudioGrain(src_id, flow_id, origin_timestamp=ots, sync_timestamp=sts,
+                grain = AudioGrain(src_id=src_id, flow_id=flow_id, origin_timestamp=ots, sync_timestamp=sts,
                                    cog_audio_format=fmt,
                                    channels=2, samples=1920, sample_rate=48000)
 
                 self.assertEqual(grain.grain_type, "audio")
-                self.assertEqual(grain.format, fmt)
+                self.assertEqual(grain.cog_audio_format, fmt)
                 self.assertIsInstance(grain.data, bytearray)
                 self.assertEqual(len(grain.data), length)
 
     def test_audio_grain_create_fills_in_missing_meta(self):
         meta = {}
         with mock.patch.object(Timestamp, "get_time", return_value=cts):
             grain = AudioGrain(meta)
 
         self.assertEqual(grain.creation_timestamp, cts)
         self.assertEqual(grain.origin_timestamp, cts)
         self.assertEqual(grain.sync_timestamp, cts)
-        self.assertEqual(grain.format, CogAudioFormat.INVALID)
+        self.assertEqual(grain.cog_audio_format, CogAudioFormat.INVALID)
         self.assertEqual(grain.channels, 0)
         self.assertEqual(grain.samples, 0)
         self.assertEqual(grain.sample_rate, 0)
         self.assertIsNone(grain.media_rate)
 
     def test_audio_grain_setters(self):
         meta = {}
         with mock.patch.object(Timestamp, "get_time", return_value=cts):
             grain = AudioGrain(meta)
 
-        grain.format = CogAudioFormat.S16_PLANES
-        self.assertEqual(grain.format, CogAudioFormat.S16_PLANES)
-        grain.format = 0xA
-        self.assertEqual(grain.format, CogAudioFormat.S32_INTERLEAVED)
+        grain.cog_audio_format = CogAudioFormat.S16_PLANES
+        self.assertEqual(grain.cog_audio_format, CogAudioFormat.S16_PLANES)
+        grain.cog_audio_format = 0xA
+        self.assertEqual(grain.cog_audio_format, CogAudioFormat.S32_INTERLEAVED)
 
         grain.channels = 2
         self.assertEqual(grain.channels, 2)
 
         grain.samples = 1920
         self.assertEqual(grain.samples, 1920)
 
         grain.sample_rate = 48000
         self.assertEqual(grain.sample_rate, 48000)
 
     def test_audiograin_meta_is_json_serialisable(self):
         with mock.patch.object(Timestamp, "get_time", return_value=cts):
-            grain = AudioGrain(src_id, flow_id,
+            grain = AudioGrain(src_id=src_id, flow_id=flow_id,
                                cog_audio_format=CogAudioFormat.S16_PLANES,
                                channels=2, samples=1920, sample_rate=48000)
 
         try:
             self.assertEqual(json.loads(json.dumps(grain.meta)), grain.meta)
         except ValueError:
             self.fail(
@@ -988,21 +989,21 @@
 
         data = bytearray(1920*6*2)
 
         with mock.patch.object(Timestamp, "get_time", return_value=cts):
             grain = Grain(meta, data=data)
 
         self.assertEqual(grain.grain_type, "audio")
-        self.assertEqual(grain.format, CogAudioFormat.S16_PLANES)
+        self.assertEqual(grain.cog_audio_format, CogAudioFormat.S16_PLANES)
         self.assertEqual(grain.meta, meta)
         self.assertEqual(grain.data, data)
 
     def test_audio_grain_normalise(self):
         with mock.patch.object(Timestamp, "get_time", return_value=ots):
-            grain = AudioGrain(src_id, flow_id,
+            grain = AudioGrain(src_id=src_id, flow_id=flow_id,
                                cog_audio_format=CogAudioFormat.S16_PLANES,
                                channels=2, samples=1920, sample_rate=48000)
 
         final_ts = ots + TimeOffset.from_count(1920 - 1, 48000, 1)
 
         self.assertEqual(grain.origin_timestamp, ots)
         self.assertNotEqual(grain.normalise_time(grain.origin_timestamp),
@@ -1013,15 +1014,15 @@
         self.assertNotEqual(grain.normalise_time(grain.origin_timerange()),
                             TimeRange(ots, final_ts))
         self.assertEqual(grain.normalise_time(grain.origin_timerange()),
                          TimeRange(ots, final_ts).normalise(48000, 1))
 
     def test_coded_video_grain_create_VC2(self):
         with mock.patch.object(Timestamp, "get_time", return_value=cts):
-            grain = CodedVideoGrain(src_id, flow_id, origin_timestamp=ots, sync_timestamp=sts,
+            grain = CodedVideoGrain(src_id=src_id, flow_id=flow_id, origin_timestamp=ots, sync_timestamp=sts,
                                     cog_frame_format=CogFrameFormat.VC2,
                                     origin_width=1920, origin_height=1080,
                                     length=1296000, cog_frame_layout=CogFrameLayout.FULL_FRAME,
                                     unit_offsets=[3, 2])
 
         self.assertEqual(grain.grain_type, "coded_video")
         self.assertEqual(grain.source_id, src_id)
@@ -1029,21 +1030,21 @@
         self.assertEqual(grain.origin_timestamp, ots)
         self.assertEqual(grain.sync_timestamp, sts)
         self.assertEqual(grain.creation_timestamp, cts)
         self.assertEqual(grain.rate, Fraction(25, 1))
         self.assertEqual(grain.media_rate, Fraction(25, 1))
         self.assertEqual(grain.duration, Fraction(1, 25))
         self.assertEqual(grain.timelabels, [])
-        self.assertEqual(grain.format, CogFrameFormat.VC2)
+        self.assertEqual(grain.cog_frame_format, CogFrameFormat.VC2)
         self.assertEqual(grain.origin_width, 1920)
         self.assertEqual(grain.origin_height, 1080)
         self.assertEqual(grain.coded_width, 1920)
         self.assertEqual(grain.coded_height, 1080)
         self.assertEqual(grain.length, 1296000)
-        self.assertEqual(grain.layout, CogFrameLayout.FULL_FRAME)
+        self.assertEqual(grain.cog_frame_layout, CogFrameLayout.FULL_FRAME)
         self.assertEqual(grain.unit_offsets, [3, 2])
         self.assertEqual(repr(grain.unit_offsets), repr([3, 2]))
 
         self.assertIsInstance(grain.data, bytearray)
         self.assertEqual(len(grain.data), grain.length)
 
         self.assertEqual(
@@ -1058,21 +1059,21 @@
         self.assertEqual(grain.grain_type, "coded_video")
         self.assertEqual(grain.origin_timestamp, cts)
         self.assertEqual(grain.sync_timestamp, cts)
         self.assertEqual(grain.creation_timestamp, cts)
         self.assertEqual(grain.rate, Fraction(0, 1))
         self.assertEqual(grain.duration, Fraction(0, 25))
         self.assertEqual(grain.timelabels, [])
-        self.assertEqual(grain.format, CogFrameFormat.UNKNOWN)
+        self.assertEqual(grain.cog_frame_format, CogFrameFormat.UNKNOWN)
         self.assertEqual(grain.origin_width, 0)
         self.assertEqual(grain.origin_height, 0)
         self.assertEqual(grain.coded_width, 0)
         self.assertEqual(grain.coded_height, 0)
         self.assertEqual(grain.length, 0)
-        self.assertEqual(grain.layout, CogFrameLayout.UNKNOWN)
+        self.assertEqual(grain.cog_frame_layout, CogFrameLayout.UNKNOWN)
         self.assertEqual(grain.unit_offsets, [])
 
     def test_coded_video_grain_create_corrects_numeric_data(self):
         meta = {
             'grain': {
                 'cog_coded_frame': {
                     'format': 0x0200,
@@ -1087,43 +1088,43 @@
         self.assertEqual(grain.grain_type, "coded_video")
         self.assertEqual(grain.origin_timestamp, cts)
         self.assertEqual(grain.sync_timestamp, cts)
         self.assertEqual(grain.creation_timestamp, cts)
         self.assertEqual(grain.rate, Fraction(0, 1))
         self.assertEqual(grain.duration, Fraction(0, 25))
         self.assertEqual(grain.timelabels, [])
-        self.assertEqual(grain.format, CogFrameFormat.MJPEG)
+        self.assertEqual(grain.cog_frame_format, CogFrameFormat.MJPEG)
         self.assertEqual(grain.origin_width, 0)
         self.assertEqual(grain.origin_height, 0)
         self.assertEqual(grain.coded_width, 0)
         self.assertEqual(grain.coded_height, 0)
         self.assertEqual(grain.length, 0)
-        self.assertEqual(grain.layout, CogFrameLayout.SEGMENTED_FRAME)
+        self.assertEqual(grain.cog_frame_layout, CogFrameLayout.SEGMENTED_FRAME)
         self.assertEqual(grain.unit_offsets, [])
 
     def test_coded_video_grain_setters(self):
         with mock.patch.object(Timestamp, "get_time", return_value=cts):
-            grain = CodedVideoGrain(src_id, flow_id, origin_timestamp=ots, sync_timestamp=sts,
+            grain = CodedVideoGrain(src_id=src_id, flow_id=flow_id, origin_timestamp=ots, sync_timestamp=sts,
                                     cog_frame_format=CogFrameFormat.VC2,
                                     origin_width=1920, origin_height=1080,
                                     length=1296000, cog_frame_layout=CogFrameLayout.FULL_FRAME)
 
-        grain.format = CogFrameFormat.MJPEG
-        self.assertEqual(grain.format, CogFrameFormat.MJPEG)
+        grain.cog_frame_format = CogFrameFormat.MJPEG
+        self.assertEqual(grain.cog_frame_format, CogFrameFormat.MJPEG)
 
         grain.origin_width = 1
         self.assertEqual(grain.origin_width, 1)
         grain.origin_height = 2
         self.assertEqual(grain.origin_height, 2)
         grain.coded_width = 3
         self.assertEqual(grain.coded_width, 3)
         grain.coded_height = 4
         self.assertEqual(grain.coded_height, 4)
-        grain.layout = CogFrameLayout.UNKNOWN
-        self.assertEqual(grain.layout, CogFrameLayout.UNKNOWN)
+        grain.cog_frame_layout = CogFrameLayout.UNKNOWN
+        self.assertEqual(grain.cog_frame_layout, CogFrameLayout.UNKNOWN)
         grain.temporal_offset = 75
         self.assertEqual(grain.temporal_offset, 75)
         grain.is_key_frame = True
         self.assertTrue(grain.is_key_frame, 75)
 
         self.assertNotIn('unit_offsets', grain.meta['grain']['cog_coded_frame'])
         self.assertEqual(grain.unit_offsets, [])
@@ -1155,68 +1156,68 @@
         self.assertNotIn('unit_offsets', grain.meta['grain']['cog_coded_frame'])
         self.assertEqual(grain.unit_offsets, [])
 
     def test_coded_video_grain_create_with_data(self):
         data = bytearray(500)
 
         with mock.patch.object(Timestamp, "get_time", return_value=cts):
-            grain = CodedVideoGrain(src_id, flow_id, origin_timestamp=ots, sync_timestamp=sts,
+            grain = CodedVideoGrain(src_id=src_id, flow_id=flow_id, origin_timestamp=ots, sync_timestamp=sts,
                                     cog_frame_format=CogFrameFormat.VC2,
                                     origin_width=1920, origin_height=1080,
                                     cog_frame_layout=CogFrameLayout.FULL_FRAME,
                                     data=data)
 
         self.assertEqual(grain.data, data)
         self.assertEqual(len(grain.data), grain.length)
 
     def test_coded_video_grain_create_with_cts_and_ots(self):
         with mock.patch.object(Timestamp, "get_time", return_value=cts):
-            grain = CodedVideoGrain(src_id, flow_id, origin_timestamp=ots,
+            grain = CodedVideoGrain(src_id=src_id, flow_id=flow_id, origin_timestamp=ots,
                                     cog_frame_format=CogFrameFormat.VC2,
                                     origin_width=1920, origin_height=1080,
                                     cog_frame_layout=CogFrameLayout.FULL_FRAME)
 
         self.assertEqual(grain.creation_timestamp, cts)
         self.assertEqual(grain.origin_timestamp, ots)
         self.assertEqual(grain.sync_timestamp, ots)
 
     def test_coded_video_grain_create_with_cts(self):
         with mock.patch.object(Timestamp, "get_time", return_value=cts):
-            grain = CodedVideoGrain(src_id, flow_id,
+            grain = CodedVideoGrain(src_id=src_id, flow_id=flow_id,
                                     cog_frame_format=CogFrameFormat.VC2,
                                     origin_width=1920, origin_height=1080,
                                     cog_frame_layout=CogFrameLayout.FULL_FRAME)
 
         self.assertEqual(grain.creation_timestamp, cts)
         self.assertEqual(grain.origin_timestamp, cts)
         self.assertEqual(grain.sync_timestamp, cts)
 
-    def test_coded_video_grain_create_with_empty(self):
+    def test_coded_video_grain_create_empty(self):
         with mock.patch.object(Timestamp, "get_time", return_value=cts):
             grain = CodedVideoGrain()
 
         self.assertEqual(grain.grain_type, "coded_video")
         self.assertEqual(grain.origin_timestamp, cts)
         self.assertEqual(grain.sync_timestamp, cts)
         self.assertEqual(grain.creation_timestamp, cts)
         self.assertEqual(grain.rate, Fraction(25, 1))
         self.assertEqual(grain.duration, Fraction(1, 25))
         self.assertEqual(grain.timelabels, [])
-        self.assertEqual(grain.format, CogFrameFormat.UNKNOWN)
+        self.assertEqual(grain.cog_frame_format, CogFrameFormat.UNKNOWN)
         self.assertEqual(grain.origin_width, 1920)
         self.assertEqual(grain.origin_height, 1080)
         self.assertEqual(grain.coded_width, 1920)
         self.assertEqual(grain.coded_height, 1080)
         self.assertEqual(grain.length, 0)
-        self.assertEqual(grain.layout, CogFrameLayout.UNKNOWN)
+        self.assertEqual(grain.cog_frame_layout, CogFrameLayout.UNKNOWN)
         self.assertEqual(grain.unit_offsets, [])
 
     def test_coded_video_grain_meta_is_json_serialisable(self):
         with mock.patch.object(Timestamp, "get_time", return_value=cts):
-            grain = CodedVideoGrain(src_id, flow_id,
+            grain = CodedVideoGrain(src_id=src_id, flow_id=flow_id,
                                     cog_frame_format=CogFrameFormat.VC2,
                                     origin_width=1920, origin_height=1080,
                                     cog_frame_layout=CogFrameLayout.FULL_FRAME)
 
         self.assertEqual(json.loads(json.dumps(grain.meta)), grain.meta)
 
     def test_grain_makes_codedvideograin(self):
@@ -1251,21 +1252,21 @@
 
         data = bytearray(1296000)
 
         with mock.patch.object(Timestamp, "get_time", return_value=cts):
             grain = Grain(meta, data=data)
 
         self.assertEqual(grain.grain_type, "coded_video")
-        self.assertEqual(grain.format, CogFrameFormat.VC2)
+        self.assertEqual(grain.cog_frame_format, CogFrameFormat.VC2)
         self.assertEqual(grain.meta, meta)
         self.assertEqual(grain.data, data)
 
     def test_coded_video_grain_normalise(self):
         with mock.patch.object(Timestamp, "get_time", return_value=ots):
-            grain = CodedVideoGrain(src_id, flow_id, origin_timestamp=ots,
+            grain = CodedVideoGrain(src_id=src_id, flow_id=flow_id, origin_timestamp=ots,
                                     rate=Fraction(25, 1),
                                     cog_frame_format=CogFrameFormat.VC2,
                                     origin_width=1920, origin_height=1080,
                                     cog_frame_layout=CogFrameLayout.FULL_FRAME)
 
         self.assertEqual(grain.origin_timestamp, ots)
         self.assertNotEqual(grain.normalise_time(grain.origin_timestamp),
@@ -1276,15 +1277,15 @@
         self.assertNotEqual(grain.normalise_time(grain.origin_timerange()),
                             TimeRange.from_single_timestamp(ots))
         self.assertEqual(grain.normalise_time(grain.origin_timerange()),
                          TimeRange.from_single_timestamp(ots).normalise(25, 1))
 
     def test_coded_audio_grain_create_MP1(self):
         with mock.patch.object(Timestamp, "get_time", return_value=cts):
-            grain = CodedAudioGrain(src_id, flow_id, origin_timestamp=ots, sync_timestamp=sts,
+            grain = CodedAudioGrain(src_id=src_id, flow_id=flow_id, origin_timestamp=ots, sync_timestamp=sts,
                                     cog_audio_format=CogAudioFormat.MP1,
                                     samples=1920,
                                     channels=6,
                                     priming=0,
                                     remainder=0,
                                     sample_rate=48000,
                                     length=15360)
@@ -1296,15 +1297,15 @@
         self.assertEqual(grain.final_origin_timestamp(), ots + TimeOffset.from_count(1919, 48000, 1))
         self.assertEqual(grain.origin_timerange(), TimeRange(ots, ots + TimeOffset.from_count(1919, 48000, 1)))
         self.assertEqual(grain.sync_timestamp, sts)
         self.assertEqual(grain.creation_timestamp, cts)
         self.assertEqual(grain.rate, Fraction(25, 1))
         self.assertEqual(grain.duration, Fraction(1, 25))
         self.assertEqual(grain.timelabels, [])
-        self.assertEqual(grain.format, CogAudioFormat.MP1)
+        self.assertEqual(grain.cog_audio_format, CogAudioFormat.MP1)
         self.assertEqual(grain.samples, 1920)
         self.assertEqual(grain.channels, 6)
         self.assertEqual(grain.priming, 0)
         self.assertEqual(grain.remainder, 0)
         self.assertEqual(grain.sample_rate, 48000)
         self.assertEqual(grain.media_rate, Fraction(48000, 1))
         self.assertEqual(grain.length, 15360)
@@ -1314,15 +1315,15 @@
 
         self.assertEqual(
             repr(grain),
             "CodedAudioGrain({!r},< binary data of length {} >)".format(grain.meta, len(grain.data)))
 
     def test_coded_audio_grain_create_without_sts(self):
         with mock.patch.object(Timestamp, "get_time", return_value=cts):
-            grain = CodedAudioGrain(src_id, flow_id, origin_timestamp=ots,
+            grain = CodedAudioGrain(src_id=src_id, flow_id=flow_id, origin_timestamp=ots,
                                     cog_audio_format=CogAudioFormat.MP1,
                                     samples=1920,
                                     channels=6,
                                     priming=0,
                                     remainder=0,
                                     sample_rate=48000,
                                     length=15360)
@@ -1334,15 +1335,15 @@
         self.assertEqual(grain.final_origin_timestamp(), ots + TimeOffset.from_count(1919, 48000, 1))
         self.assertEqual(grain.origin_timerange(), TimeRange(ots, ots + TimeOffset.from_count(1919, 48000, 1)))
         self.assertEqual(grain.sync_timestamp, ots)
         self.assertEqual(grain.creation_timestamp, cts)
         self.assertEqual(grain.rate, Fraction(25, 1))
         self.assertEqual(grain.duration, Fraction(1, 25))
         self.assertEqual(grain.timelabels, [])
-        self.assertEqual(grain.format, CogAudioFormat.MP1)
+        self.assertEqual(grain.cog_audio_format, CogAudioFormat.MP1)
         self.assertEqual(grain.samples, 1920)
         self.assertEqual(grain.channels, 6)
         self.assertEqual(grain.priming, 0)
         self.assertEqual(grain.remainder, 0)
         self.assertEqual(grain.sample_rate, 48000)
         self.assertEqual(grain.length, 15360)
 
@@ -1351,15 +1352,15 @@
 
         self.assertEqual(
             repr(grain),
             "CodedAudioGrain({!r},< binary data of length {} >)".format(grain.meta, len(grain.data)))
 
     def test_coded_audio_grain_create_without_sts_or_ots(self):
         with mock.patch.object(Timestamp, "get_time", return_value=cts):
-            grain = CodedAudioGrain(src_id, flow_id,
+            grain = CodedAudioGrain(src_id=src_id, flow_id=flow_id,
                                     cog_audio_format=CogAudioFormat.MP1,
                                     samples=1920,
                                     channels=6,
                                     priming=0,
                                     remainder=0,
                                     sample_rate=48000,
                                     length=15360)
@@ -1371,15 +1372,15 @@
         self.assertEqual(grain.final_origin_timestamp(), cts + TimeOffset.from_count(1919, 48000, 1))
         self.assertEqual(grain.origin_timerange(), TimeRange(cts, cts + TimeOffset.from_count(1919, 48000, 1)))
         self.assertEqual(grain.sync_timestamp, cts)
         self.assertEqual(grain.creation_timestamp, cts)
         self.assertEqual(grain.rate, Fraction(25, 1))
         self.assertEqual(grain.duration, Fraction(1, 25))
         self.assertEqual(grain.timelabels, [])
-        self.assertEqual(grain.format, CogAudioFormat.MP1)
+        self.assertEqual(grain.cog_audio_format, CogAudioFormat.MP1)
         self.assertEqual(grain.samples, 1920)
         self.assertEqual(grain.channels, 6)
         self.assertEqual(grain.priming, 0)
         self.assertEqual(grain.remainder, 0)
         self.assertEqual(grain.sample_rate, 48000)
         self.assertEqual(grain.length, 15360)
 
@@ -1399,15 +1400,15 @@
         self.assertEqual(grain.grain_type, "coded_audio")
         self.assertEqual(grain.origin_timestamp, cts)
         self.assertEqual(grain.sync_timestamp, cts)
         self.assertEqual(grain.creation_timestamp, cts)
         self.assertEqual(grain.rate, Fraction(0, 1))
         self.assertEqual(grain.duration, Fraction(0, 25))
         self.assertEqual(grain.timelabels, [])
-        self.assertEqual(grain.format, CogAudioFormat.INVALID)
+        self.assertEqual(grain.cog_audio_format, CogAudioFormat.INVALID)
         self.assertEqual(grain.samples, 0)
         self.assertEqual(grain.channels, 0)
         self.assertEqual(grain.priming, 0)
         self.assertEqual(grain.remainder, 0)
         self.assertEqual(grain.sample_rate, 48000)
         self.assertEqual(grain.length, 0)
 
@@ -1426,32 +1427,32 @@
         self.assertEqual(grain.grain_type, "coded_audio")
         self.assertEqual(grain.origin_timestamp, cts)
         self.assertEqual(grain.sync_timestamp, cts)
         self.assertEqual(grain.creation_timestamp, cts)
         self.assertEqual(grain.rate, Fraction(0, 1))
         self.assertEqual(grain.duration, Fraction(0, 25))
         self.assertEqual(grain.timelabels, [])
-        self.assertEqual(grain.format, CogAudioFormat.MP1)
+        self.assertEqual(grain.cog_audio_format, CogAudioFormat.MP1)
         self.assertEqual(grain.samples, 0)
         self.assertEqual(grain.channels, 0)
         self.assertEqual(grain.priming, 0)
         self.assertEqual(grain.remainder, 0)
         self.assertEqual(grain.sample_rate, 48000)
         self.assertEqual(grain.length, 0)
 
     def test_coded_audio_grain_setters(self):
         meta = {}
 
         with mock.patch.object(Timestamp, "get_time", return_value=cts):
             grain = CodedAudioGrain(meta)
 
-        grain.format = CogAudioFormat.MP1
-        self.assertEqual(grain.format, CogAudioFormat.MP1)
-        grain.format = 0x202
-        self.assertEqual(grain.format, CogAudioFormat.OPUS)
+        grain.cog_audio_format = CogAudioFormat.MP1
+        self.assertEqual(grain.cog_audio_format, CogAudioFormat.MP1)
+        grain.cog_audio_format = 0x202
+        self.assertEqual(grain.cog_audio_format, CogAudioFormat.OPUS)
 
         grain.channels = 2
         self.assertEqual(grain.channels, 2)
 
         grain.samples = 1920
         self.assertEqual(grain.samples, 1920)
 
@@ -1470,35 +1471,36 @@
 
         with mock.patch.object(Timestamp, "get_time", return_value=cts):
             grain = CodedAudioGrain(meta, data)
 
         self.assertEqual(grain.length, len(data))
         self.assertEqual(grain.data, data)
 
-    def test_coded_audio_grain_creates_with_none(self):
+    def test_coded_audio_grain_empty(self):
         with mock.patch.object(Timestamp, "get_time", return_value=cts):
             grain = CodedAudioGrain()
+
         self.assertEqual(grain.grain_type, "coded_audio")
         self.assertEqual(grain.origin_timestamp, cts)
         self.assertEqual(grain.sync_timestamp, cts)
         self.assertEqual(grain.creation_timestamp, cts)
         self.assertEqual(grain.rate, Fraction(25, 1))
         self.assertEqual(grain.duration, Fraction(1, 25))
         self.assertEqual(grain.timelabels, [])
-        self.assertEqual(grain.format, CogAudioFormat.INVALID)
+        self.assertEqual(grain.cog_audio_format, CogAudioFormat.INVALID)
         self.assertEqual(grain.samples, 0)
         self.assertEqual(grain.channels, 0)
         self.assertEqual(grain.priming, 0)
         self.assertEqual(grain.remainder, 0)
         self.assertEqual(grain.sample_rate, 48000)
         self.assertEqual(grain.length, 0)
 
     def test_codedaudiograin_meta_is_json_serialisable(self):
         with mock.patch.object(Timestamp, "get_time", return_value=cts):
-            grain = CodedAudioGrain(src_id, flow_id,
+            grain = CodedAudioGrain(src_id=src_id, flow_id=flow_id,
                                     cog_audio_format=CogAudioFormat.MP1,
                                     samples=1920,
                                     channels=6,
                                     priming=0,
                                     remainder=0,
                                     sample_rate=48000,
                                     length=15360)
@@ -1540,21 +1542,21 @@
 
         data = bytearray(15360)
 
         with mock.patch.object(Timestamp, "get_time", return_value=cts):
             grain = Grain(meta, data=data)
 
         self.assertEqual(grain.grain_type, "coded_audio")
-        self.assertEqual(grain.format, CogAudioFormat.MP1)
+        self.assertEqual(grain.cog_audio_format, CogAudioFormat.MP1)
         self.assertEqual(grain.meta, meta)
         self.assertEqual(grain.data, data)
 
     def test_coded_audio_grain_normalise(self):
         with mock.patch.object(Timestamp, "get_time", return_value=ots):
-            grain = CodedAudioGrain(src_id, flow_id, origin_timestamp=ots,
+            grain = CodedAudioGrain(src_id=src_id, flow_id=flow_id, origin_timestamp=ots,
                                     cog_audio_format=CogAudioFormat.MP1,
                                     samples=1920,
                                     channels=6,
                                     priming=0,
                                     remainder=0,
                                     sample_rate=48000,
                                     length=15360)
@@ -1570,15 +1572,15 @@
         self.assertNotEqual(grain.normalise_time(grain.origin_timerange()),
                             TimeRange(ots, final_ts))
         self.assertEqual(grain.normalise_time(grain.origin_timerange()),
                          TimeRange(ots, final_ts).normalise(48000, 1))
 
     def test_event_grain_create(self):
         with mock.patch.object(Timestamp, "get_time", return_value=cts):
-            grain = EventGrain(src_id, flow_id, origin_timestamp=ots, sync_timestamp=sts,
+            grain = EventGrain(src_id=src_id, flow_id=flow_id, origin_timestamp=ots, sync_timestamp=sts,
                                event_type='urn:x-ipstudio:format:event.query', topic='/dummy')
 
         self.assertEqual(grain.grain_type, "event")
         self.assertEqual(grain.source_id, src_id)
         self.assertEqual(grain.flow_id, flow_id)
         self.assertEqual(grain.origin_timestamp, ots)
         self.assertEqual(grain.final_origin_timestamp(), ots)
@@ -1596,15 +1598,15 @@
                                                                   'topic': "/dummy",
                                                                   'data': []})
 
         self.assertEqual(repr(grain), "EventGrain({!r})".format(grain.meta))
 
     def test_event_grain_create_without_sts(self):
         with mock.patch.object(Timestamp, "get_time", return_value=cts):
-            grain = EventGrain(src_id, flow_id, origin_timestamp=ots,
+            grain = EventGrain(src_id=src_id, flow_id=flow_id, origin_timestamp=ots,
                                event_type='urn:x-ipstudio:format:event.query', topic='/dummy')
 
         self.assertEqual(grain.grain_type, "event")
         self.assertEqual(grain.source_id, src_id)
         self.assertEqual(grain.flow_id, flow_id)
         self.assertEqual(grain.origin_timestamp, ots)
         self.assertEqual(grain.final_origin_timestamp(), ots)
@@ -1618,15 +1620,15 @@
         self.assertEqual(grain.topic, "/dummy")
         self.assertEqual(grain.event_data, [])
 
         self.assertEqual(repr(grain), "EventGrain({!r})".format(grain.meta))
 
     def test_event_grain_create_without_sts_or_ots(self):
         with mock.patch.object(Timestamp, "get_time", return_value=cts):
-            grain = EventGrain(src_id, flow_id,
+            grain = EventGrain(src_id=src_id, flow_id=flow_id,
                                event_type='urn:x-ipstudio:format:event.query', topic='/dummy')
 
         self.assertEqual(grain.grain_type, "event")
         self.assertEqual(grain.source_id, src_id)
         self.assertEqual(grain.flow_id, flow_id)
         self.assertEqual(grain.origin_timestamp, cts)
         self.assertEqual(grain.final_origin_timestamp(), cts)
@@ -1798,15 +1800,15 @@
                                                                             'post': 'next'}]})
 
         with self.assertRaises(ValueError):
             grain.data = bytearray(json.dumps({'potato': "masher"}).encode('utf-8'))
 
     def test_copy(self):
         with mock.patch.object(Timestamp, "get_time", return_value=cts):
-            grain = VideoGrain(src_id, flow_id, origin_timestamp=ots, sync_timestamp=sts,
+            grain = VideoGrain(src_id=src_id, flow_id=flow_id, origin_timestamp=ots, sync_timestamp=sts,
                                cog_frame_format=CogFrameFormat.S16_422_10BIT,
                                width=1920, height=1080, cog_frame_layout=CogFrameLayout.FULL_FRAME)
 
         grain.data[0] = 0x1B
         grain.data[1] = 0xBC
 
         clone = copy(grain)
@@ -1818,15 +1820,15 @@
         grain.data[1] = 0xFE
 
         self.assertEqual(grain.data[0], clone.data[0])
         self.assertEqual(grain.data[1], clone.data[1])
 
     def test_deepcopy(self):
         with mock.patch.object(Timestamp, "get_time", return_value=cts):
-            grain = VideoGrain(src_id, flow_id, origin_timestamp=ots, sync_timestamp=sts,
+            grain = VideoGrain(src_id=src_id, flow_id=flow_id, origin_timestamp=ots, sync_timestamp=sts,
                                cog_frame_format=CogFrameFormat.S16_422_10BIT,
                                width=1920, height=1080, cog_frame_layout=CogFrameLayout.FULL_FRAME)
 
         grain.data[0] = 0x1B
         grain.data[1] = 0xBC
 
         clone = deepcopy(grain)
```

### Comparing `mediagrains-3.5.2/tests/test_gsf.py` & `mediagrains-4.0.0/tests/test_gsf.py`

 * *Files 6% similar despite different names*

```diff
@@ -38,7527 +38,7700 @@
 00000250: 696d 6974 6174 696f 6e73 2075 6e64 6572  imitations under
 00000260: 2074 6865 204c 6963 656e 7365 2e0a 230a   the License..#.
 00000270: 0a66 726f 6d20 756e 6974 7465 7374 2069  .from unittest i
 00000280: 6d70 6f72 7420 4973 6f6c 6174 6564 4173  mport IsolatedAs
 00000290: 796e 6369 6f54 6573 7443 6173 652c 206d  yncioTestCase, m
 000002a0: 6f63 6b0a 6672 6f6d 2075 7569 6420 696d  ock.from uuid im
 000002b0: 706f 7274 2055 5549 440a 6672 6f6d 206d  port UUID.from m
-000002c0: 6564 6961 6772 6169 6e73 2069 6d70 6f72  ediagrains impor
-000002d0: 7420 4772 6169 6e2c 2056 6964 656f 4772  t Grain, VideoGr
+000002c0: 6564 6961 6772 6169 6e73 2e67 7261 696e  ediagrains.grain
+000002d0: 7320 696d 706f 7274 2056 6964 656f 4772  s import VideoGr
 000002e0: 6169 6e2c 2041 7564 696f 4772 6169 6e2c  ain, AudioGrain,
 000002f0: 2043 6f64 6564 5669 6465 6f47 7261 696e   CodedVideoGrain
 00000300: 2c20 436f 6465 6441 7564 696f 4772 6169  , CodedAudioGrai
 00000310: 6e2c 2045 7665 6e74 4772 6169 6e0a 6672  n, EventGrain.fr
 00000320: 6f6d 206d 6564 6961 6772 6169 6e73 2e67  om mediagrains.g
-00000330: 7261 696e 2069 6d70 6f72 7420 5649 4445  rain import VIDE
-00000340: 4f47 5241 494e 2c20 4155 4449 4f47 5241  OGRAIN, AUDIOGRA
-00000350: 494e 2c20 434f 4445 4456 4944 454f 4752  IN, CODEDVIDEOGR
-00000360: 4149 4e2c 2043 4f44 4544 4155 4449 4f47  AIN, CODEDAUDIOG
-00000370: 5241 494e 2c20 4556 454e 5447 5241 494e  RAIN, EVENTGRAIN
-00000380: 0a66 726f 6d20 6d65 6469 6167 7261 696e  .from mediagrain
-00000390: 732e 6773 6620 696d 706f 7274 206c 6f61  s.gsf import loa
-000003a0: 6473 2c20 6c6f 6164 2c20 6475 6d70 732c  ds, load, dumps,
-000003b0: 2047 5346 456e 636f 6465 722c 2047 5346   GSFEncoder, GSF
-000003c0: 4465 636f 6465 722c 2041 7379 6e63 4753  Decoder, AsyncGS
-000003d0: 4642 6c6f 636b 2c20 4772 6169 6e44 6174  FBlock, GrainDat
-000003e0: 614c 6f61 6469 6e67 4d6f 6465 0a66 726f  aLoadingMode.fro
-000003f0: 6d20 6d65 6469 6167 7261 696e 732e 6773  m mediagrains.gs
-00000400: 6620 696d 706f 7274 2047 5346 4465 636f  f import GSFDeco
-00000410: 6465 4572 726f 720a 6672 6f6d 206d 6564  deError.from med
-00000420: 6961 6772 6169 6e73 2e67 7366 2069 6d70  iagrains.gsf imp
-00000430: 6f72 7420 4753 4645 6e63 6f64 6545 7272  ort GSFEncodeErr
-00000440: 6f72 0a66 726f 6d20 6d65 6469 6167 7261  or.from mediagra
-00000450: 696e 732e 6773 6620 696d 706f 7274 2047  ins.gsf import G
-00000460: 5346 4465 636f 6465 4261 6456 6572 7369  SFDecodeBadVersi
-00000470: 6f6e 4572 726f 720a 6672 6f6d 206d 6564  onError.from med
-00000480: 6961 6772 6169 6e73 2e67 7366 2069 6d70  iagrains.gsf imp
-00000490: 6f72 7420 4753 4644 6563 6f64 6542 6164  ort GSFDecodeBad
-000004a0: 4669 6c65 5479 7065 4572 726f 720a 6672  FileTypeError.fr
-000004b0: 6f6d 206d 6564 6961 6772 6169 6e73 2e67  om mediagrains.g
-000004c0: 7366 2069 6d70 6f72 7420 4753 4645 6e63  sf import GSFEnc
-000004d0: 6f64 6541 6464 546f 4163 7469 7665 4475  odeAddToActiveDu
-000004e0: 6d70 0a66 726f 6d20 6d65 6469 6167 7261  mp.from mediagra
-000004f0: 696e 732e 636f 6d70 6172 6973 6f6e 2069  ins.comparison i
-00000500: 6d70 6f72 7420 636f 6d70 6172 655f 6772  mport compare_gr
-00000510: 6169 6e0a 6672 6f6d 206d 6564 6961 6772  ain.from mediagr
-00000520: 6169 6e73 2e63 6f67 656e 756d 7320 696d  ains.cogenums im
-00000530: 706f 7274 2043 6f67 4672 616d 6546 6f72  port CogFrameFor
-00000540: 6d61 742c 2043 6f67 4672 616d 654c 6179  mat, CogFrameLay
-00000550: 6f75 742c 2043 6f67 4175 6469 6f46 6f72  out, CogAudioFor
-00000560: 6d61 740a 6672 6f6d 206d 6564 6961 7469  mat.from mediati
-00000570: 6d65 7374 616d 702e 696d 6d75 7461 626c  mestamp.immutabl
-00000580: 6520 696d 706f 7274 2054 696d 6573 7461  e import Timesta
-00000590: 6d70 2c20 5469 6d65 4f66 6673 6574 0a66  mp, TimeOffset.f
-000005a0: 726f 6d20 6461 7465 7469 6d65 2069 6d70  rom datetime imp
-000005b0: 6f72 7420 6461 7465 7469 6d65 0a66 726f  ort datetime.fro
-000005c0: 6d20 6672 6163 7469 6f6e 7320 696d 706f  m fractions impo
-000005d0: 7274 2046 7261 6374 696f 6e0a 6672 6f6d  rt Fraction.from
-000005e0: 2069 6f20 696d 706f 7274 2042 7974 6573   io import Bytes
-000005f0: 494f 0a66 726f 6d20 6d65 6469 6167 7261  IO.from mediagra
-00000600: 696e 732e 7574 696c 732e 6173 796e 6362  ins.utils.asyncb
-00000610: 696e 6172 7969 6f20 696d 706f 7274 2041  inaryio import A
-00000620: 7379 6e63 4279 7465 7349 4f0a 6672 6f6d  syncBytesIO.from
-00000630: 2066 726f 7a65 6e64 6963 7420 696d 706f   frozendict impo
-00000640: 7274 2066 726f 7a65 6e64 6963 740a 6672  rt frozendict.fr
-00000650: 6f6d 206f 7320 696d 706f 7274 2053 4545  om os import SEE
-00000660: 4b5f 5345 540a 0a66 726f 6d20 6669 7874  K_SET..from fixt
-00000670: 7572 6573 2069 6d70 6f72 7420 7375 7070  ures import supp
-00000680: 7265 7373 5f64 6570 7265 6361 7469 6f6e  ress_deprecation
-00000690: 5f77 6172 6e69 6e67 730a 0a0a 7769 7468  _warnings...with
-000006a0: 206f 7065 6e28 2765 7861 6d70 6c65 732f   open('examples/
-000006b0: 7669 6465 6f2e 6773 6627 2c20 2772 6227  video.gsf', 'rb'
-000006c0: 2920 6173 2066 3a0a 2020 2020 5649 4445  ) as f:.    VIDE
-000006d0: 4f5f 4441 5441 203d 2066 2e72 6561 6428  O_DATA = f.read(
-000006e0: 290a 0a77 6974 6820 6f70 656e 2827 6578  )..with open('ex
-000006f0: 616d 706c 6573 2f63 6f64 6564 5f76 6964  amples/coded_vid
-00000700: 656f 2e67 7366 272c 2027 7262 2729 2061  eo.gsf', 'rb') a
-00000710: 7320 663a 0a20 2020 2043 4f44 4544 5f56  s f:.    CODED_V
-00000720: 4944 454f 5f44 4154 4120 3d20 662e 7265  IDEO_DATA = f.re
-00000730: 6164 2829 0a0a 7769 7468 206f 7065 6e28  ad()..with open(
-00000740: 2765 7861 6d70 6c65 732f 6175 6469 6f2e  'examples/audio.
-00000750: 6773 6627 2c20 2772 6227 2920 6173 2066  gsf', 'rb') as f
-00000760: 3a0a 2020 2020 4155 4449 4f5f 4441 5441  :.    AUDIO_DATA
-00000770: 203d 2066 2e72 6561 6428 290a 0a77 6974   = f.read()..wit
-00000780: 6820 6f70 656e 2827 6578 616d 706c 6573  h open('examples
-00000790: 2f63 6f64 6564 5f61 7564 696f 2e67 7366  /coded_audio.gsf
-000007a0: 272c 2027 7262 2729 2061 7320 663a 0a20  ', 'rb') as f:. 
-000007b0: 2020 2043 4f44 4544 5f41 5544 494f 5f44     CODED_AUDIO_D
-000007c0: 4154 4120 3d20 662e 7265 6164 2829 0a0a  ATA = f.read()..
-000007d0: 7769 7468 206f 7065 6e28 2765 7861 6d70  with open('examp
-000007e0: 6c65 732f 6576 656e 742e 6773 6627 2c20  les/event.gsf', 
-000007f0: 2772 6227 2920 6173 2066 3a0a 2020 2020  'rb') as f:.    
-00000800: 4556 454e 545f 4441 5441 203d 2066 2e72  EVENT_DATA = f.r
-00000810: 6561 6428 290a 0a77 6974 6820 6f70 656e  ead()..with open
-00000820: 2827 6578 616d 706c 6573 2f69 6e74 6572  ('examples/inter
-00000830: 6c65 6176 6564 2e67 7366 272c 2027 7262  leaved.gsf', 'rb
-00000840: 2729 2061 7320 663a 0a20 2020 2049 4e54  ') as f:.    INT
-00000850: 4552 4c45 4156 4544 5f44 4154 4120 3d20  ERLEAVED_DATA = 
-00000860: 662e 7265 6164 2829 0a0a 0a63 6c61 7373  f.read()...class
-00000870: 2054 6573 7447 5346 4475 6d70 7328 4973   TestGSFDumps(Is
-00000880: 6f6c 6174 6564 4173 796e 6369 6f54 6573  olatedAsyncioTes
-00000890: 7443 6173 6529 3a0a 2020 2020 6465 6620  tCase):.    def 
-000008a0: 7465 7374 5f64 756d 7073 5f6e 6f5f 6772  test_dumps_no_gr
-000008b0: 6169 6e73 2873 656c 6629 3a0a 2020 2020  ains(self):.    
-000008c0: 2020 2020 7575 6964 7320 3d20 5b55 5549      uuids = [UUI
-000008d0: 4428 2737 3932 3062 3339 342d 3135 3635  D('7920b394-1565
-000008e0: 2d31 3165 382d 3836 6530 2d38 6234 3264  -11e8-86e0-8b42d
-000008f0: 3436 3437 6261 3827 292c 2055 5549 4428  4647ba8'), UUID(
-00000900: 2738 3061 6638 3735 632d 3135 3635 2d31  '80af875c-1565-1
-00000910: 3165 382d 3866 3434 2d38 3765 6630 3831  1e8-8f44-87ef081
-00000920: 6234 3863 6427 295d 0a20 2020 2020 2020  b48cd')].       
-00000930: 2063 7265 6174 6564 203d 2064 6174 6574   created = datet
-00000940: 696d 6528 3139 3833 2c20 332c 2032 392c  ime(1983, 3, 29,
-00000950: 2031 352c 2031 3529 0a20 2020 2020 2020   15, 15).       
-00000960: 2077 6974 6820 6d6f 636b 2e70 6174 6368   with mock.patch
-00000970: 2827 6d65 6469 6167 7261 696e 732e 6773  ('mediagrains.gs
-00000980: 662e 6461 7465 7469 6d65 272c 2073 6964  f.datetime', sid
-00000990: 655f 6566 6665 6374 3d64 6174 6574 696d  e_effect=datetim
-000009a0: 652c 206e 6f77 3d6d 6f63 6b2e 4d61 6769  e, now=mock.Magi
-000009b0: 634d 6f63 6b28 7265 7475 726e 5f76 616c  cMock(return_val
-000009c0: 7565 3d63 7265 6174 6564 2929 3a0a 2020  ue=created)):.  
-000009d0: 2020 2020 2020 2020 2020 7769 7468 206d            with m
-000009e0: 6f63 6b2e 7061 7463 6828 276d 6564 6961  ock.patch('media
-000009f0: 6772 6169 6e73 2e67 7366 2e75 7569 6431  grains.gsf.uuid1
-00000a00: 272c 2073 6964 655f 6566 6665 6374 3d75  ', side_effect=u
-00000a10: 7569 6473 293a 0a20 2020 2020 2020 2020  uids):.         
-00000a20: 2020 2020 2020 2028 6865 6164 2c20 7365         (head, se
-00000a30: 676d 656e 7473 2920 3d20 6c6f 6164 7328  gments) = loads(
-00000a40: 6475 6d70 7328 5b5d 2c20 7461 6773 3d5b  dumps([], tags=[
-00000a50: 2827 706f 7461 746f 272c 2027 6861 7276  ('potato', 'harv
-00000a60: 6573 7427 295d 2c20 7365 676d 656e 745f  est')], segment_
-00000a70: 7461 6773 3d5b 2827 7570 7369 6465 272c  tags=[('upside',
-00000a80: 2027 646f 776e 2729 5d29 290a 0a20 2020   'down')]))..   
-00000a90: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00000aa0: 496e 2827 6964 272c 2068 6561 6429 0a20  In('id', head). 
-00000ab0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00000ac0: 7274 496e 2868 6561 645b 2769 6427 5d2c  rtIn(head['id'],
-00000ad0: 2075 7569 6473 290a 2020 2020 2020 2020   uuids).        
-00000ae0: 7365 6c66 2e61 7373 6572 7449 6e28 2774  self.assertIn('t
-00000af0: 6167 7327 2c20 6865 6164 290a 2020 2020  ags', head).    
-00000b00: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-00000b10: 7175 616c 2868 6561 645b 2774 6167 7327  qual(head['tags'
-00000b20: 5d2c 205b 2827 706f 7461 746f 272c 2027  ], [('potato', '
-00000b30: 6861 7276 6573 7427 295d 290a 2020 2020  harvest')]).    
-00000b40: 2020 2020 7365 6c66 2e61 7373 6572 7449      self.assertI
-00000b50: 6e28 2763 7265 6174 6564 272c 2068 6561  n('created', hea
-00000b60: 6429 0a20 2020 2020 2020 2073 656c 662e  d).        self.
-00000b70: 6173 7365 7274 4571 7561 6c28 6865 6164  assertEqual(head
-00000b80: 5b27 6372 6561 7465 6427 5d2c 2063 7265  ['created'], cre
-00000b90: 6174 6564 290a 2020 2020 2020 2020 7365  ated).        se
-00000ba0: 6c66 2e61 7373 6572 7449 6e28 2773 6567  lf.assertIn('seg
-00000bb0: 6d65 6e74 7327 2c20 6865 6164 290a 2020  ments', head).  
-00000bc0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-00000bd0: 7445 7175 616c 286c 656e 2868 6561 645b  tEqual(len(head[
-00000be0: 2773 6567 6d65 6e74 7327 5d29 2c20 3129  'segments']), 1)
-00000bf0: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-00000c00: 7365 7274 496e 2827 636f 756e 7427 2c20  sertIn('count', 
-00000c10: 6865 6164 5b27 7365 676d 656e 7473 275d  head['segments']
-00000c20: 5b30 5d29 0a20 2020 2020 2020 2073 656c  [0]).        sel
-00000c30: 662e 6173 7365 7274 4571 7561 6c28 6865  f.assertEqual(he
-00000c40: 6164 5b27 7365 676d 656e 7473 275d 5b30  ad['segments'][0
-00000c50: 5d5b 2763 6f75 6e74 275d 2c20 3029 0a20  ]['count'], 0). 
-00000c60: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00000c70: 7274 496e 2827 6c6f 6361 6c5f 6964 272c  rtIn('local_id',
-00000c80: 2068 6561 645b 2773 6567 6d65 6e74 7327   head['segments'
-00000c90: 5d5b 305d 290a 2020 2020 2020 2020 7365  ][0]).        se
-00000ca0: 6c66 2e61 7373 6572 7445 7175 616c 2868  lf.assertEqual(h
-00000cb0: 6561 645b 2773 6567 6d65 6e74 7327 5d5b  ead['segments'][
-00000cc0: 305d 5b27 6c6f 6361 6c5f 6964 275d 2c20  0]['local_id'], 
-00000cd0: 3129 0a20 2020 2020 2020 2073 656c 662e  1).        self.
-00000ce0: 6173 7365 7274 496e 2827 6964 272c 2068  assertIn('id', h
-00000cf0: 6561 645b 2773 6567 6d65 6e74 7327 5d5b  ead['segments'][
-00000d00: 305d 290a 2020 2020 2020 2020 7365 6c66  0]).        self
-00000d10: 2e61 7373 6572 7449 6e28 6865 6164 5b27  .assertIn(head['
-00000d20: 7365 676d 656e 7473 275d 5b30 5d5b 2769  segments'][0]['i
-00000d30: 6427 5d2c 2075 7569 6473 290a 2020 2020  d'], uuids).    
-00000d40: 2020 2020 7365 6c66 2e61 7373 6572 744e      self.assertN
-00000d50: 6f74 496e 2868 6561 645b 2773 6567 6d65  otIn(head['segme
-00000d60: 6e74 7327 5d5b 305d 5b27 6964 275d 2c20  nts'][0]['id'], 
-00000d70: 5b68 6561 645b 2769 6427 5d5d 290a 2020  [head['id']]).  
-00000d80: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-00000d90: 7449 6e28 2774 6167 7327 2c20 6865 6164  tIn('tags', head
-00000da0: 5b27 7365 676d 656e 7473 275d 5b30 5d29  ['segments'][0])
-00000db0: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-00000dc0: 7365 7274 4571 7561 6c28 6865 6164 5b27  sertEqual(head['
-00000dd0: 7365 676d 656e 7473 275d 5b30 5d5b 2774  segments'][0]['t
-00000de0: 6167 7327 5d2c 205b 2827 7570 7369 6465  ags'], [('upside
-00000df0: 272c 2027 646f 776e 2729 5d29 0a0a 2020  ', 'down')])..  
-00000e00: 2020 2020 2020 6966 206c 656e 2873 6567        if len(seg
-00000e10: 6d65 6e74 7329 203e 2030 3a0a 2020 2020  ments) > 0:.    
-00000e20: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-00000e30: 6572 7445 7175 616c 286c 656e 2873 6567  ertEqual(len(seg
-00000e40: 6d65 6e74 7329 2c20 3129 0a20 2020 2020  ments), 1).     
-00000e50: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00000e60: 7274 496e 2831 2c20 7365 676d 656e 7473  rtIn(1, segments
-00000e70: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
-00000e80: 6c66 2e61 7373 6572 7445 7175 616c 286c  lf.assertEqual(l
-00000e90: 656e 2873 6567 6d65 6e74 735b 315d 292c  en(segments[1]),
-00000ea0: 2030 290a 0a20 2020 2061 7379 6e63 2064   0)..    async d
-00000eb0: 6566 2074 6573 745f 6173 796e 635f 656e  ef test_async_en
-00000ec0: 636f 6465 5f6e 6f5f 6772 6169 6e73 2873  code_no_grains(s
-00000ed0: 656c 6629 3a0a 2020 2020 2020 2020 7575  elf):.        uu
-00000ee0: 6964 7320 3d20 5b55 5549 4428 2737 3932  ids = [UUID('792
-00000ef0: 3062 3339 342d 3135 3635 2d31 3165 382d  0b394-1565-11e8-
-00000f00: 3836 6530 2d38 6234 3264 3436 3437 6261  86e0-8b42d4647ba
-00000f10: 3827 292c 2055 5549 4428 2738 3061 6638  8'), UUID('80af8
-00000f20: 3735 632d 3135 3635 2d31 3165 382d 3866  75c-1565-11e8-8f
-00000f30: 3434 2d38 3765 6630 3831 6234 3863 6427  44-87ef081b48cd'
-00000f40: 295d 0a20 2020 2020 2020 2063 7265 6174  )].        creat
-00000f50: 6564 203d 2064 6174 6574 696d 6528 3139  ed = datetime(19
-00000f60: 3833 2c20 332c 2032 392c 2031 352c 2031  83, 3, 29, 15, 1
-00000f70: 3529 0a20 2020 2020 2020 2077 6974 6820  5).        with 
-00000f80: 6d6f 636b 2e70 6174 6368 2827 6d65 6469  mock.patch('medi
-00000f90: 6167 7261 696e 732e 6773 662e 6461 7465  agrains.gsf.date
-00000fa0: 7469 6d65 272c 2073 6964 655f 6566 6665  time', side_effe
-00000fb0: 6374 3d64 6174 6574 696d 652c 206e 6f77  ct=datetime, now
-00000fc0: 3d6d 6f63 6b2e 4d61 6769 634d 6f63 6b28  =mock.MagicMock(
-00000fd0: 7265 7475 726e 5f76 616c 7565 3d63 7265  return_value=cre
-00000fe0: 6174 6564 2929 3a0a 2020 2020 2020 2020  ated)):.        
-00000ff0: 2020 2020 7769 7468 206d 6f63 6b2e 7061      with mock.pa
-00001000: 7463 6828 276d 6564 6961 6772 6169 6e73  tch('mediagrains
-00001010: 2e67 7366 2e75 7569 6431 272c 2073 6964  .gsf.uuid1', sid
-00001020: 655f 6566 6665 6374 3d75 7569 6473 293a  e_effect=uuids):
-00001030: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00001040: 2066 203d 2042 7974 6573 494f 2829 0a20   f = BytesIO(). 
-00001050: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-00001060: 7379 6e63 2077 6974 6820 4753 4645 6e63  sync with GSFEnc
-00001070: 6f64 6572 2866 2c0a 2020 2020 2020 2020  oder(f,.        
-00001080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001090: 2020 2020 2020 2020 2020 2020 2020 7461                ta
-000010a0: 6773 3d5b 2827 706f 7461 746f 272c 2027  gs=[('potato', '
-000010b0: 6861 7276 6573 7427 295d 2c0a 2020 2020  harvest')],.    
-000010c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000010d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000010e0: 2020 7365 676d 656e 7473 3d5b 7b27 7461    segments=[{'ta
-000010f0: 6773 273a 205b 2827 7570 7369 6465 272c  gs': [('upside',
-00001100: 2027 646f 776e 2729 5d7d 5d29 3a0a 2020   'down')]}]):.  
-00001110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001120: 2020 7061 7373 0a20 2020 2020 2020 2020    pass.         
-00001130: 2020 2020 2020 2028 6865 6164 2c20 7365         (head, se
-00001140: 676d 656e 7473 2920 3d20 6c6f 6164 7328  gments) = loads(
-00001150: 662e 6765 7476 616c 7565 2829 290a 0a20  f.getvalue()).. 
-00001160: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00001170: 7274 496e 2827 6964 272c 2068 6561 6429  rtIn('id', head)
-00001180: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-00001190: 7365 7274 496e 2868 6561 645b 2769 6427  sertIn(head['id'
-000011a0: 5d2c 2075 7569 6473 290a 2020 2020 2020  ], uuids).      
-000011b0: 2020 7365 6c66 2e61 7373 6572 7449 6e28    self.assertIn(
-000011c0: 2774 6167 7327 2c20 6865 6164 290a 2020  'tags', head).  
-000011d0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-000011e0: 7445 7175 616c 2868 6561 645b 2774 6167  tEqual(head['tag
-000011f0: 7327 5d2c 205b 2827 706f 7461 746f 272c  s'], [('potato',
-00001200: 2027 6861 7276 6573 7427 295d 290a 2020   'harvest')]).  
-00001210: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-00001220: 7449 6e28 2763 7265 6174 6564 272c 2068  tIn('created', h
-00001230: 6561 6429 0a20 2020 2020 2020 2073 656c  ead).        sel
-00001240: 662e 6173 7365 7274 4571 7561 6c28 6865  f.assertEqual(he
-00001250: 6164 5b27 6372 6561 7465 6427 5d2c 2063  ad['created'], c
-00001260: 7265 6174 6564 290a 2020 2020 2020 2020  reated).        
-00001270: 7365 6c66 2e61 7373 6572 7449 6e28 2773  self.assertIn('s
-00001280: 6567 6d65 6e74 7327 2c20 6865 6164 290a  egments', head).
-00001290: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-000012a0: 6572 7445 7175 616c 286c 656e 2868 6561  ertEqual(len(hea
-000012b0: 645b 2773 6567 6d65 6e74 7327 5d29 2c20  d['segments']), 
-000012c0: 3129 0a20 2020 2020 2020 2073 656c 662e  1).        self.
-000012d0: 6173 7365 7274 496e 2827 636f 756e 7427  assertIn('count'
-000012e0: 2c20 6865 6164 5b27 7365 676d 656e 7473  , head['segments
-000012f0: 275d 5b30 5d29 0a20 2020 2020 2020 2073  '][0]).        s
-00001300: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-00001310: 6865 6164 5b27 7365 676d 656e 7473 275d  head['segments']
-00001320: 5b30 5d5b 2763 6f75 6e74 275d 2c20 3029  [0]['count'], 0)
-00001330: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-00001340: 7365 7274 496e 2827 6c6f 6361 6c5f 6964  sertIn('local_id
-00001350: 272c 2068 6561 645b 2773 6567 6d65 6e74  ', head['segment
-00001360: 7327 5d5b 305d 290a 2020 2020 2020 2020  s'][0]).        
-00001370: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-00001380: 2868 6561 645b 2773 6567 6d65 6e74 7327  (head['segments'
-00001390: 5d5b 305d 5b27 6c6f 6361 6c5f 6964 275d  ][0]['local_id']
-000013a0: 2c20 3129 0a20 2020 2020 2020 2073 656c  , 1).        sel
-000013b0: 662e 6173 7365 7274 496e 2827 6964 272c  f.assertIn('id',
-000013c0: 2068 6561 645b 2773 6567 6d65 6e74 7327   head['segments'
-000013d0: 5d5b 305d 290a 2020 2020 2020 2020 7365  ][0]).        se
-000013e0: 6c66 2e61 7373 6572 7449 6e28 6865 6164  lf.assertIn(head
-000013f0: 5b27 7365 676d 656e 7473 275d 5b30 5d5b  ['segments'][0][
-00001400: 2769 6427 5d2c 2075 7569 6473 290a 2020  'id'], uuids).  
-00001410: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-00001420: 744e 6f74 496e 2868 6561 645b 2773 6567  tNotIn(head['seg
-00001430: 6d65 6e74 7327 5d5b 305d 5b27 6964 275d  ments'][0]['id']
-00001440: 2c20 5b68 6561 645b 2769 6427 5d5d 290a  , [head['id']]).
-00001450: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-00001460: 6572 7449 6e28 2774 6167 7327 2c20 6865  ertIn('tags', he
-00001470: 6164 5b27 7365 676d 656e 7473 275d 5b30  ad['segments'][0
-00001480: 5d29 0a20 2020 2020 2020 2073 656c 662e  ]).        self.
-00001490: 6173 7365 7274 4571 7561 6c28 6865 6164  assertEqual(head
-000014a0: 5b27 7365 676d 656e 7473 275d 5b30 5d5b  ['segments'][0][
-000014b0: 2774 6167 7327 5d2c 205b 2827 7570 7369  'tags'], [('upsi
-000014c0: 6465 272c 2027 646f 776e 2729 5d29 0a0a  de', 'down')])..
-000014d0: 2020 2020 2020 2020 6966 206c 656e 2873          if len(s
-000014e0: 6567 6d65 6e74 7329 203e 2030 3a0a 2020  egments) > 0:.  
-000014f0: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-00001500: 7373 6572 7445 7175 616c 286c 656e 2873  ssertEqual(len(s
-00001510: 6567 6d65 6e74 7329 2c20 3129 0a20 2020  egments), 1).   
-00001520: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
-00001530: 7365 7274 496e 2831 2c20 7365 676d 656e  sertIn(1, segmen
-00001540: 7473 290a 2020 2020 2020 2020 2020 2020  ts).            
-00001550: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-00001560: 286c 656e 2873 6567 6d65 6e74 735b 315d  (len(segments[1]
-00001570: 292c 2030 290a 0a20 2020 2064 6566 2074  ), 0)..    def t
-00001580: 6573 745f 6475 6d70 735f 7669 6465 6f67  est_dumps_videog
-00001590: 7261 696e 2873 656c 6629 3a0a 2020 2020  rain(self):.    
-000015a0: 2020 2020 7372 635f 6964 203d 2055 5549      src_id = UUI
-000015b0: 4428 2765 3134 6539 6435 382d 3135 3637  D('e14e9d58-1567
-000015c0: 2d31 3165 382d 3864 6433 2d38 3331 6130  -11e8-8dd3-831a0
-000015d0: 3638 6562 3033 3427 290a 2020 2020 2020  68eb034').      
-000015e0: 2020 666c 6f77 5f69 6420 3d20 5555 4944    flow_id = UUID
-000015f0: 2827 6565 3165 6564 3538 2d31 3536 372d  ('ee1eed58-1567-
-00001600: 3131 6538 2d61 3937 312d 3362 3930 3161  11e8-a971-3b901a
-00001610: 3264 6438 6162 2729 0a20 2020 2020 2020  2dd8ab').       
-00001620: 2067 7261 696e 203d 2056 6964 656f 4772   grain = VideoGr
-00001630: 6169 6e28 7372 635f 6964 2c20 666c 6f77  ain(src_id, flow
-00001640: 5f69 642c 2063 6f67 5f66 7261 6d65 5f66  _id, cog_frame_f
-00001650: 6f72 6d61 743d 436f 6746 7261 6d65 466f  ormat=CogFrameFo
-00001660: 726d 6174 2e53 3136 5f34 3232 5f31 3042  rmat.S16_422_10B
-00001670: 4954 2c20 7769 6474 683d 3139 3230 2c20  IT, width=1920, 
-00001680: 6865 6967 6874 3d31 3038 3029 0a20 2020  height=1080).   
-00001690: 2020 2020 2066 6f72 2069 2069 6e20 7261       for i in ra
-000016a0: 6e67 6528 302c 206c 656e 2867 7261 696e  nge(0, len(grain
-000016b0: 2e64 6174 6129 293a 0a20 2020 2020 2020  .data)):.       
-000016c0: 2020 2020 2067 7261 696e 2e64 6174 615b       grain.data[
-000016d0: 695d 203d 2069 2026 2030 7846 460a 2020  i] = i & 0xFF.  
-000016e0: 2020 2020 2020 6772 6169 6e2e 736f 7572        grain.sour
-000016f0: 6365 5f61 7370 6563 745f 7261 7469 6f20  ce_aspect_ratio 
-00001700: 3d20 4672 6163 7469 6f6e 2831 362c 2039  = Fraction(16, 9
-00001710: 290a 2020 2020 2020 2020 6772 6169 6e2e  ).        grain.
-00001720: 7069 7865 6c5f 6173 7065 6374 5f72 6174  pixel_aspect_rat
-00001730: 696f 203d 2031 0a20 2020 2020 2020 2075  io = 1.        u
-00001740: 7569 6473 203d 205b 5555 4944 2827 3739  uids = [UUID('79
-00001750: 3230 6233 3934 2d31 3536 352d 3131 6538  20b394-1565-11e8
-00001760: 2d38 3665 302d 3862 3432 6434 3634 3762  -86e0-8b42d4647b
-00001770: 6138 2729 2c0a 2020 2020 2020 2020 2020  a8'),.          
-00001780: 2020 2020 2020 2055 5549 4428 2738 3061         UUID('80a
-00001790: 6638 3735 632d 3135 3635 2d31 3165 382d  f875c-1565-11e8-
-000017a0: 3866 3434 2d38 3765 6630 3831 6234 3863  8f44-87ef081b48c
-000017b0: 6427 295d 0a20 2020 2020 2020 2063 7265  d')].        cre
-000017c0: 6174 6564 203d 2064 6174 6574 696d 6528  ated = datetime(
-000017d0: 3139 3833 2c20 332c 2032 392c 2031 352c  1983, 3, 29, 15,
-000017e0: 2031 3529 0a20 2020 2020 2020 2077 6974   15).        wit
-000017f0: 6820 6d6f 636b 2e70 6174 6368 2827 6d65  h mock.patch('me
-00001800: 6469 6167 7261 696e 732e 6773 662e 6461  diagrains.gsf.da
-00001810: 7465 7469 6d65 272c 2073 6964 655f 6566  tetime', side_ef
-00001820: 6665 6374 3d64 6174 6574 696d 652c 206e  fect=datetime, n
-00001830: 6f77 3d6d 6f63 6b2e 4d61 6769 634d 6f63  ow=mock.MagicMoc
-00001840: 6b28 7265 7475 726e 5f76 616c 7565 3d63  k(return_value=c
-00001850: 7265 6174 6564 2929 3a0a 2020 2020 2020  reated)):.      
-00001860: 2020 2020 2020 7769 7468 206d 6f63 6b2e        with mock.
-00001870: 7061 7463 6828 276d 6564 6961 6772 6169  patch('mediagrai
-00001880: 6e73 2e67 7366 2e75 7569 6431 272c 2073  ns.gsf.uuid1', s
-00001890: 6964 655f 6566 6665 6374 3d75 7569 6473  ide_effect=uuids
-000018a0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-000018b0: 2020 2028 6865 6164 2c20 7365 676d 656e     (head, segmen
-000018c0: 7473 2920 3d20 6c6f 6164 7328 6475 6d70  ts) = loads(dump
-000018d0: 7328 5b67 7261 696e 5d29 290a 0a20 2020  s([grain]))..   
-000018e0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-000018f0: 496e 2827 6964 272c 2068 6561 6429 0a20  In('id', head). 
-00001900: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00001910: 7274 496e 2868 6561 645b 2769 6427 5d2c  rtIn(head['id'],
-00001920: 2075 7569 6473 290a 2020 2020 2020 2020   uuids).        
-00001930: 7365 6c66 2e61 7373 6572 7449 6e28 2774  self.assertIn('t
-00001940: 6167 7327 2c20 6865 6164 290a 2020 2020  ags', head).    
-00001950: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-00001960: 7175 616c 286c 656e 2868 6561 645b 2774  qual(len(head['t
-00001970: 6167 7327 5d29 2c20 3029 0a20 2020 2020  ags']), 0).     
-00001980: 2020 2073 656c 662e 6173 7365 7274 496e     self.assertIn
-00001990: 2827 6372 6561 7465 6427 2c20 6865 6164  ('created', head
-000019a0: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-000019b0: 7373 6572 7445 7175 616c 2868 6561 645b  ssertEqual(head[
-000019c0: 2763 7265 6174 6564 275d 2c20 6372 6561  'created'], crea
-000019d0: 7465 6429 0a20 2020 2020 2020 2073 656c  ted).        sel
-000019e0: 662e 6173 7365 7274 496e 2827 7365 676d  f.assertIn('segm
-000019f0: 656e 7473 272c 2068 6561 6429 0a20 2020  ents', head).   
-00001a00: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00001a10: 4571 7561 6c28 6c65 6e28 6865 6164 5b27  Equal(len(head['
-00001a20: 7365 676d 656e 7473 275d 292c 2031 290a  segments']), 1).
-00001a30: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-00001a40: 6572 7449 6e28 2763 6f75 6e74 272c 2068  ertIn('count', h
-00001a50: 6561 645b 2773 6567 6d65 6e74 7327 5d5b  ead['segments'][
-00001a60: 305d 290a 2020 2020 2020 2020 7365 6c66  0]).        self
-00001a70: 2e61 7373 6572 7445 7175 616c 2868 6561  .assertEqual(hea
-00001a80: 645b 2773 6567 6d65 6e74 7327 5d5b 305d  d['segments'][0]
-00001a90: 5b27 636f 756e 7427 5d2c 2031 290a 2020  ['count'], 1).  
-00001aa0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-00001ab0: 7449 6e28 276c 6f63 616c 5f69 6427 2c20  tIn('local_id', 
-00001ac0: 6865 6164 5b27 7365 676d 656e 7473 275d  head['segments']
-00001ad0: 5b30 5d29 0a20 2020 2020 2020 2073 656c  [0]).        sel
-00001ae0: 662e 6173 7365 7274 4571 7561 6c28 6865  f.assertEqual(he
-00001af0: 6164 5b27 7365 676d 656e 7473 275d 5b30  ad['segments'][0
-00001b00: 5d5b 276c 6f63 616c 5f69 6427 5d2c 2031  ]['local_id'], 1
-00001b10: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-00001b20: 7373 6572 7449 6e28 2769 6427 2c20 6865  ssertIn('id', he
-00001b30: 6164 5b27 7365 676d 656e 7473 275d 5b30  ad['segments'][0
-00001b40: 5d29 0a20 2020 2020 2020 2073 656c 662e  ]).        self.
-00001b50: 6173 7365 7274 496e 2868 6561 645b 2773  assertIn(head['s
-00001b60: 6567 6d65 6e74 7327 5d5b 305d 5b27 6964  egments'][0]['id
-00001b70: 275d 2c20 7575 6964 7329 0a20 2020 2020  '], uuids).     
-00001b80: 2020 2073 656c 662e 6173 7365 7274 496e     self.assertIn
-00001b90: 2827 7461 6773 272c 2068 6561 645b 2773  ('tags', head['s
-00001ba0: 6567 6d65 6e74 7327 5d5b 305d 290a 2020  egments'][0]).  
-00001bb0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-00001bc0: 7445 7175 616c 286c 656e 2868 6561 645b  tEqual(len(head[
-00001bd0: 2773 6567 6d65 6e74 7327 5d5b 305d 5b27  'segments'][0]['
-00001be0: 7461 6773 275d 292c 2030 290a 0a20 2020  tags']), 0)..   
-00001bf0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00001c00: 4571 7561 6c28 6c65 6e28 7365 676d 656e  Equal(len(segmen
-00001c10: 7473 292c 2031 290a 2020 2020 2020 2020  ts), 1).        
-00001c20: 7365 6c66 2e61 7373 6572 7449 6e28 312c  self.assertIn(1,
-00001c30: 2073 6567 6d65 6e74 7329 0a20 2020 2020   segments).     
-00001c40: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-00001c50: 7561 6c28 6c65 6e28 7365 676d 656e 7473  ual(len(segments
-00001c60: 5b31 5d29 2c20 6865 6164 5b27 7365 676d  [1]), head['segm
-00001c70: 656e 7473 275d 5b30 5d5b 2763 6f75 6e74  ents'][0]['count
-00001c80: 275d 290a 0a20 2020 2020 2020 2073 656c  '])..        sel
-00001c90: 662e 6173 7365 7274 4571 7561 6c28 7365  f.assertEqual(se
-00001ca0: 676d 656e 7473 5b31 5d5b 305d 2e73 6f75  gments[1][0].sou
-00001cb0: 7263 655f 6964 2c20 7372 635f 6964 290a  rce_id, src_id).
-00001cc0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-00001cd0: 6572 7445 7175 616c 2873 6567 6d65 6e74  ertEqual(segment
-00001ce0: 735b 315d 5b30 5d2e 666c 6f77 5f69 642c  s[1][0].flow_id,
-00001cf0: 2066 6c6f 775f 6964 290a 2020 2020 2020   flow_id).      
-00001d00: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-00001d10: 616c 2873 6567 6d65 6e74 735b 315d 5b30  al(segments[1][0
-00001d20: 5d2e 6772 6169 6e5f 7479 7065 2c20 2776  ].grain_type, 'v
-00001d30: 6964 656f 2729 0a20 2020 2020 2020 2073  ideo').        s
-00001d40: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-00001d50: 7365 676d 656e 7473 5b31 5d5b 305d 2e66  segments[1][0].f
-00001d60: 6f72 6d61 742c 2043 6f67 4672 616d 6546  ormat, CogFrameF
-00001d70: 6f72 6d61 742e 5331 365f 3432 325f 3130  ormat.S16_422_10
-00001d80: 4249 5429 0a20 2020 2020 2020 2073 656c  BIT).        sel
-00001d90: 662e 6173 7365 7274 4571 7561 6c28 7365  f.assertEqual(se
-00001da0: 676d 656e 7473 5b31 5d5b 305d 2e77 6964  gments[1][0].wid
-00001db0: 7468 2c20 3139 3230 290a 2020 2020 2020  th, 1920).      
-00001dc0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-00001dd0: 616c 2873 6567 6d65 6e74 735b 315d 5b30  al(segments[1][0
-00001de0: 5d2e 6865 6967 6874 2c20 3130 3830 290a  ].height, 1080).
-00001df0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-00001e00: 6572 7445 7175 616c 2873 6567 6d65 6e74  ertEqual(segment
-00001e10: 735b 315d 5b30 5d2e 736f 7572 6365 5f61  s[1][0].source_a
-00001e20: 7370 6563 745f 7261 7469 6f2c 2046 7261  spect_ratio, Fra
-00001e30: 6374 696f 6e28 3136 2c20 3929 290a 2020  ction(16, 9)).  
-00001e40: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-00001e50: 7445 7175 616c 2873 6567 6d65 6e74 735b  tEqual(segments[
-00001e60: 315d 5b30 5d2e 7069 7865 6c5f 6173 7065  1][0].pixel_aspe
-00001e70: 6374 5f72 6174 696f 2c20 4672 6163 7469  ct_ratio, Fracti
-00001e80: 6f6e 2831 2c20 3129 290a 0a20 2020 2020  on(1, 1))..     
-00001e90: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-00001ea0: 7561 6c28 7365 676d 656e 7473 5b31 5d5b  ual(segments[1][
-00001eb0: 305d 2e64 6174 612c 2067 7261 696e 2e64  0].data, grain.d
-00001ec0: 6174 6129 0a0a 2020 2020 6173 796e 6320  ata)..    async 
-00001ed0: 6465 6620 7465 7374 5f61 7379 6e63 5f65  def test_async_e
-00001ee0: 6e63 6f64 655f 7669 6465 6f67 7261 696e  ncode_videograin
-00001ef0: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-00001f00: 7372 635f 6964 203d 2055 5549 4428 2765  src_id = UUID('e
-00001f10: 3134 6539 6435 382d 3135 3637 2d31 3165  14e9d58-1567-11e
-00001f20: 382d 3864 6433 2d38 3331 6130 3638 6562  8-8dd3-831a068eb
-00001f30: 3033 3427 290a 2020 2020 2020 2020 666c  034').        fl
-00001f40: 6f77 5f69 6420 3d20 5555 4944 2827 6565  ow_id = UUID('ee
-00001f50: 3165 6564 3538 2d31 3536 372d 3131 6538  1eed58-1567-11e8
-00001f60: 2d61 3937 312d 3362 3930 3161 3264 6438  -a971-3b901a2dd8
-00001f70: 6162 2729 0a20 2020 2020 2020 2067 7261  ab').        gra
-00001f80: 696e 203d 2056 6964 656f 4772 6169 6e28  in = VideoGrain(
-00001f90: 7372 635f 6964 2c20 666c 6f77 5f69 642c  src_id, flow_id,
-00001fa0: 2063 6f67 5f66 7261 6d65 5f66 6f72 6d61   cog_frame_forma
-00001fb0: 743d 436f 6746 7261 6d65 466f 726d 6174  t=CogFrameFormat
-00001fc0: 2e53 3136 5f34 3232 5f31 3042 4954 2c20  .S16_422_10BIT, 
-00001fd0: 7769 6474 683d 3139 3230 2c20 6865 6967  width=1920, heig
-00001fe0: 6874 3d31 3038 3029 0a20 2020 2020 2020  ht=1080).       
-00001ff0: 2066 6f72 2069 2069 6e20 7261 6e67 6528   for i in range(
-00002000: 302c 206c 656e 2867 7261 696e 2e64 6174  0, len(grain.dat
-00002010: 6129 293a 0a20 2020 2020 2020 2020 2020  a)):.           
-00002020: 2067 7261 696e 2e64 6174 615b 695d 203d   grain.data[i] =
-00002030: 2069 2026 2030 7846 460a 2020 2020 2020   i & 0xFF.      
-00002040: 2020 6772 6169 6e2e 736f 7572 6365 5f61    grain.source_a
-00002050: 7370 6563 745f 7261 7469 6f20 3d20 4672  spect_ratio = Fr
-00002060: 6163 7469 6f6e 2831 362c 2039 290a 2020  action(16, 9).  
-00002070: 2020 2020 2020 6772 6169 6e2e 7069 7865        grain.pixe
-00002080: 6c5f 6173 7065 6374 5f72 6174 696f 203d  l_aspect_ratio =
-00002090: 2031 0a20 2020 2020 2020 2075 7569 6473   1.        uuids
-000020a0: 203d 205b 5555 4944 2827 3739 3230 6233   = [UUID('7920b3
-000020b0: 3934 2d31 3536 352d 3131 6538 2d38 3665  94-1565-11e8-86e
-000020c0: 302d 3862 3432 6434 3634 3762 6138 2729  0-8b42d4647ba8')
-000020d0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000020e0: 2020 2055 5549 4428 2738 3061 6638 3735     UUID('80af875
-000020f0: 632d 3135 3635 2d31 3165 382d 3866 3434  c-1565-11e8-8f44
-00002100: 2d38 3765 6630 3831 6234 3863 6427 295d  -87ef081b48cd')]
-00002110: 0a20 2020 2020 2020 2063 7265 6174 6564  .        created
-00002120: 203d 2064 6174 6574 696d 6528 3139 3833   = datetime(1983
-00002130: 2c20 332c 2032 392c 2031 352c 2031 3529  , 3, 29, 15, 15)
-00002140: 0a20 2020 2020 2020 2077 6974 6820 6d6f  .        with mo
-00002150: 636b 2e70 6174 6368 2827 6d65 6469 6167  ck.patch('mediag
-00002160: 7261 696e 732e 6773 662e 6461 7465 7469  rains.gsf.dateti
-00002170: 6d65 272c 2073 6964 655f 6566 6665 6374  me', side_effect
-00002180: 3d64 6174 6574 696d 652c 206e 6f77 3d6d  =datetime, now=m
-00002190: 6f63 6b2e 4d61 6769 634d 6f63 6b28 7265  ock.MagicMock(re
-000021a0: 7475 726e 5f76 616c 7565 3d63 7265 6174  turn_value=creat
-000021b0: 6564 2929 3a0a 2020 2020 2020 2020 2020  ed)):.          
-000021c0: 2020 7769 7468 206d 6f63 6b2e 7061 7463    with mock.patc
-000021d0: 6828 276d 6564 6961 6772 6169 6e73 2e67  h('mediagrains.g
-000021e0: 7366 2e75 7569 6431 272c 2073 6964 655f  sf.uuid1', side_
-000021f0: 6566 6665 6374 3d75 7569 6473 293a 0a20  effect=uuids):. 
-00002200: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00002210: 203d 2042 7974 6573 494f 2829 0a20 2020   = BytesIO().   
-00002220: 2020 2020 2020 2020 2020 2020 2061 7379               asy
-00002230: 6e63 2077 6974 6820 4753 4645 6e63 6f64  nc with GSFEncod
-00002240: 6572 2866 2920 6173 2065 6e63 3a0a 2020  er(f) as enc:.  
-00002250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002260: 2020 6177 6169 7420 656e 632e 6164 645f    await enc.add_
-00002270: 6772 6169 6e28 6772 6169 6e29 0a20 2020  grain(grain).   
-00002280: 2020 2020 2020 2020 2020 2020 2028 6865               (he
-00002290: 6164 2c20 7365 676d 656e 7473 2920 3d20  ad, segments) = 
-000022a0: 6c6f 6164 7328 662e 6765 7476 616c 7565  loads(f.getvalue
-000022b0: 2829 290a 0a20 2020 2020 2020 2073 656c  ())..        sel
-000022c0: 662e 6173 7365 7274 496e 2827 6964 272c  f.assertIn('id',
-000022d0: 2068 6561 6429 0a20 2020 2020 2020 2073   head).        s
-000022e0: 656c 662e 6173 7365 7274 496e 2868 6561  elf.assertIn(hea
-000022f0: 645b 2769 6427 5d2c 2075 7569 6473 290a  d['id'], uuids).
-00002300: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-00002310: 6572 7449 6e28 2774 6167 7327 2c20 6865  ertIn('tags', he
-00002320: 6164 290a 2020 2020 2020 2020 7365 6c66  ad).        self
-00002330: 2e61 7373 6572 7445 7175 616c 286c 656e  .assertEqual(len
-00002340: 2868 6561 645b 2774 6167 7327 5d29 2c20  (head['tags']), 
-00002350: 3029 0a20 2020 2020 2020 2073 656c 662e  0).        self.
-00002360: 6173 7365 7274 496e 2827 6372 6561 7465  assertIn('create
-00002370: 6427 2c20 6865 6164 290a 2020 2020 2020  d', head).      
-00002380: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-00002390: 616c 2868 6561 645b 2763 7265 6174 6564  al(head['created
-000023a0: 275d 2c20 6372 6561 7465 6429 0a20 2020  '], created).   
-000023b0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-000023c0: 496e 2827 7365 676d 656e 7473 272c 2068  In('segments', h
-000023d0: 6561 6429 0a20 2020 2020 2020 2073 656c  ead).        sel
-000023e0: 662e 6173 7365 7274 4571 7561 6c28 6c65  f.assertEqual(le
-000023f0: 6e28 6865 6164 5b27 7365 676d 656e 7473  n(head['segments
-00002400: 275d 292c 2031 290a 2020 2020 2020 2020  ']), 1).        
-00002410: 7365 6c66 2e61 7373 6572 7449 6e28 2763  self.assertIn('c
-00002420: 6f75 6e74 272c 2068 6561 645b 2773 6567  ount', head['seg
-00002430: 6d65 6e74 7327 5d5b 305d 290a 2020 2020  ments'][0]).    
-00002440: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-00002450: 7175 616c 2868 6561 645b 2773 6567 6d65  qual(head['segme
-00002460: 6e74 7327 5d5b 305d 5b27 636f 756e 7427  nts'][0]['count'
-00002470: 5d2c 2031 290a 2020 2020 2020 2020 7365  ], 1).        se
-00002480: 6c66 2e61 7373 6572 7449 6e28 276c 6f63  lf.assertIn('loc
-00002490: 616c 5f69 6427 2c20 6865 6164 5b27 7365  al_id', head['se
-000024a0: 676d 656e 7473 275d 5b30 5d29 0a20 2020  gments'][0]).   
-000024b0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-000024c0: 4571 7561 6c28 6865 6164 5b27 7365 676d  Equal(head['segm
-000024d0: 656e 7473 275d 5b30 5d5b 276c 6f63 616c  ents'][0]['local
-000024e0: 5f69 6427 5d2c 2031 290a 2020 2020 2020  _id'], 1).      
-000024f0: 2020 7365 6c66 2e61 7373 6572 7449 6e28    self.assertIn(
-00002500: 2769 6427 2c20 6865 6164 5b27 7365 676d  'id', head['segm
-00002510: 656e 7473 275d 5b30 5d29 0a20 2020 2020  ents'][0]).     
-00002520: 2020 2073 656c 662e 6173 7365 7274 496e     self.assertIn
-00002530: 2868 6561 645b 2773 6567 6d65 6e74 7327  (head['segments'
-00002540: 5d5b 305d 5b27 6964 275d 2c20 7575 6964  ][0]['id'], uuid
-00002550: 7329 0a20 2020 2020 2020 2073 656c 662e  s).        self.
-00002560: 6173 7365 7274 496e 2827 7461 6773 272c  assertIn('tags',
-00002570: 2068 6561 645b 2773 6567 6d65 6e74 7327   head['segments'
-00002580: 5d5b 305d 290a 2020 2020 2020 2020 7365  ][0]).        se
-00002590: 6c66 2e61 7373 6572 7445 7175 616c 286c  lf.assertEqual(l
-000025a0: 656e 2868 6561 645b 2773 6567 6d65 6e74  en(head['segment
-000025b0: 7327 5d5b 305d 5b27 7461 6773 275d 292c  s'][0]['tags']),
-000025c0: 2030 290a 0a20 2020 2020 2020 2073 656c   0)..        sel
-000025d0: 662e 6173 7365 7274 4571 7561 6c28 6c65  f.assertEqual(le
-000025e0: 6e28 7365 676d 656e 7473 292c 2031 290a  n(segments), 1).
-000025f0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-00002600: 6572 7449 6e28 312c 2073 6567 6d65 6e74  ertIn(1, segment
-00002610: 7329 0a20 2020 2020 2020 2073 656c 662e  s).        self.
-00002620: 6173 7365 7274 4571 7561 6c28 6c65 6e28  assertEqual(len(
-00002630: 7365 676d 656e 7473 5b31 5d29 2c20 6865  segments[1]), he
-00002640: 6164 5b27 7365 676d 656e 7473 275d 5b30  ad['segments'][0
-00002650: 5d5b 2763 6f75 6e74 275d 290a 0a20 2020  ]['count'])..   
-00002660: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00002670: 4571 7561 6c28 7365 676d 656e 7473 5b31  Equal(segments[1
-00002680: 5d5b 305d 2e73 6f75 7263 655f 6964 2c20  ][0].source_id, 
-00002690: 7372 635f 6964 290a 2020 2020 2020 2020  src_id).        
-000026a0: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-000026b0: 2873 6567 6d65 6e74 735b 315d 5b30 5d2e  (segments[1][0].
-000026c0: 666c 6f77 5f69 642c 2066 6c6f 775f 6964  flow_id, flow_id
-000026d0: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-000026e0: 7373 6572 7445 7175 616c 2873 6567 6d65  ssertEqual(segme
-000026f0: 6e74 735b 315d 5b30 5d2e 6772 6169 6e5f  nts[1][0].grain_
-00002700: 7479 7065 2c20 2776 6964 656f 2729 0a20  type, 'video'). 
-00002710: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00002720: 7274 4571 7561 6c28 7365 676d 656e 7473  rtEqual(segments
-00002730: 5b31 5d5b 305d 2e66 6f72 6d61 742c 2043  [1][0].format, C
-00002740: 6f67 4672 616d 6546 6f72 6d61 742e 5331  ogFrameFormat.S1
-00002750: 365f 3432 325f 3130 4249 5429 0a20 2020  6_422_10BIT).   
-00002760: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00002770: 4571 7561 6c28 7365 676d 656e 7473 5b31  Equal(segments[1
-00002780: 5d5b 305d 2e77 6964 7468 2c20 3139 3230  ][0].width, 1920
-00002790: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-000027a0: 7373 6572 7445 7175 616c 2873 6567 6d65  ssertEqual(segme
-000027b0: 6e74 735b 315d 5b30 5d2e 6865 6967 6874  nts[1][0].height
-000027c0: 2c20 3130 3830 290a 2020 2020 2020 2020  , 1080).        
-000027d0: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-000027e0: 2873 6567 6d65 6e74 735b 315d 5b30 5d2e  (segments[1][0].
-000027f0: 736f 7572 6365 5f61 7370 6563 745f 7261  source_aspect_ra
-00002800: 7469 6f2c 2046 7261 6374 696f 6e28 3136  tio, Fraction(16
-00002810: 2c20 3929 290a 2020 2020 2020 2020 7365  , 9)).        se
-00002820: 6c66 2e61 7373 6572 7445 7175 616c 2873  lf.assertEqual(s
-00002830: 6567 6d65 6e74 735b 315d 5b30 5d2e 7069  egments[1][0].pi
-00002840: 7865 6c5f 6173 7065 6374 5f72 6174 696f  xel_aspect_ratio
-00002850: 2c20 4672 6163 7469 6f6e 2831 2c20 3129  , Fraction(1, 1)
-00002860: 290a 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-00002870: 6173 7365 7274 4571 7561 6c28 7365 676d  assertEqual(segm
-00002880: 656e 7473 5b31 5d5b 305d 2e64 6174 612c  ents[1][0].data,
-00002890: 2067 7261 696e 2e64 6174 6129 0a0a 2020   grain.data)..  
-000028a0: 2020 6465 6620 7465 7374 5f64 756d 7073    def test_dumps
-000028b0: 5f76 6964 656f 6772 6169 6e73 2873 656c  _videograins(sel
-000028c0: 6629 3a0a 2020 2020 2020 2020 7372 635f  f):.        src_
-000028d0: 6964 203d 2055 5549 4428 2765 3134 6539  id = UUID('e14e9
-000028e0: 6435 382d 3135 3637 2d31 3165 382d 3864  d58-1567-11e8-8d
-000028f0: 6433 2d38 3331 6130 3638 6562 3033 3427  d3-831a068eb034'
-00002900: 290a 2020 2020 2020 2020 666c 6f77 5f69  ).        flow_i
-00002910: 6420 3d20 5555 4944 2827 6565 3165 6564  d = UUID('ee1eed
-00002920: 3538 2d31 3536 372d 3131 6538 2d61 3937  58-1567-11e8-a97
-00002930: 312d 3362 3930 3161 3264 6438 6162 2729  1-3b901a2dd8ab')
-00002940: 0a20 2020 2020 2020 2067 7261 696e 3020  .        grain0 
-00002950: 3d20 5669 6465 6f47 7261 696e 2873 7263  = VideoGrain(src
-00002960: 5f69 642c 2066 6c6f 775f 6964 2c20 636f  _id, flow_id, co
-00002970: 675f 6672 616d 655f 666f 726d 6174 3d43  g_frame_format=C
-00002980: 6f67 4672 616d 6546 6f72 6d61 742e 5331  ogFrameFormat.S1
-00002990: 365f 3432 325f 3130 4249 542c 2077 6964  6_422_10BIT, wid
-000029a0: 7468 3d31 3932 302c 2068 6569 6768 743d  th=1920, height=
-000029b0: 3130 3830 290a 2020 2020 2020 2020 6772  1080).        gr
-000029c0: 6169 6e31 203d 2056 6964 656f 4772 6169  ain1 = VideoGrai
-000029d0: 6e28 7372 635f 6964 2c20 666c 6f77 5f69  n(src_id, flow_i
-000029e0: 642c 2063 6f67 5f66 7261 6d65 5f66 6f72  d, cog_frame_for
-000029f0: 6d61 743d 436f 6746 7261 6d65 466f 726d  mat=CogFrameForm
-00002a00: 6174 2e53 3136 5f34 3232 5f31 3042 4954  at.S16_422_10BIT
-00002a10: 2c20 7769 6474 683d 3139 3230 2c20 6865  , width=1920, he
-00002a20: 6967 6874 3d31 3038 3029 0a20 2020 2020  ight=1080).     
-00002a30: 2020 2066 6f72 2069 2069 6e20 7261 6e67     for i in rang
-00002a40: 6528 302c 206c 656e 2867 7261 696e 302e  e(0, len(grain0.
-00002a50: 6461 7461 2929 3a0a 2020 2020 2020 2020  data)):.        
-00002a60: 2020 2020 6772 6169 6e30 2e64 6174 615b      grain0.data[
-00002a70: 695d 203d 2069 2026 2030 7846 460a 2020  i] = i & 0xFF.  
-00002a80: 2020 2020 2020 666f 7220 6920 696e 2072        for i in r
-00002a90: 616e 6765 2830 2c20 6c65 6e28 6772 6169  ange(0, len(grai
-00002aa0: 6e31 2e64 6174 6129 293a 0a20 2020 2020  n1.data)):.     
-00002ab0: 2020 2020 2020 2067 7261 696e 312e 6461         grain1.da
-00002ac0: 7461 5b69 5d20 3d20 3078 4646 202d 2028  ta[i] = 0xFF - (
-00002ad0: 6920 2620 3078 4646 290a 2020 2020 2020  i & 0xFF).      
-00002ae0: 2020 6772 6169 6e30 2e73 6f75 7263 655f    grain0.source_
-00002af0: 6173 7065 6374 5f72 6174 696f 203d 2046  aspect_ratio = F
-00002b00: 7261 6374 696f 6e28 3136 2c20 3929 0a20  raction(16, 9). 
-00002b10: 2020 2020 2020 2067 7261 696e 302e 7069         grain0.pi
-00002b20: 7865 6c5f 6173 7065 6374 5f72 6174 696f  xel_aspect_ratio
-00002b30: 203d 2031 0a20 2020 2020 2020 2075 7569   = 1.        uui
-00002b40: 6473 203d 205b 5555 4944 2827 3739 3230  ds = [UUID('7920
-00002b50: 6233 3934 2d31 3536 352d 3131 6538 2d38  b394-1565-11e8-8
-00002b60: 3665 302d 3862 3432 6434 3634 3762 6138  6e0-8b42d4647ba8
-00002b70: 2729 2c0a 2020 2020 2020 2020 2020 2020  '),.            
-00002b80: 2020 2020 2055 5549 4428 2738 3061 6638       UUID('80af8
-00002b90: 3735 632d 3135 3635 2d31 3165 382d 3866  75c-1565-11e8-8f
-00002ba0: 3434 2d38 3765 6630 3831 6234 3863 6427  44-87ef081b48cd'
-00002bb0: 295d 0a20 2020 2020 2020 2063 7265 6174  )].        creat
-00002bc0: 6564 203d 2064 6174 6574 696d 6528 3139  ed = datetime(19
-00002bd0: 3833 2c20 332c 2032 392c 2031 352c 2031  83, 3, 29, 15, 1
-00002be0: 3529 0a20 2020 2020 2020 2077 6974 6820  5).        with 
-00002bf0: 6d6f 636b 2e70 6174 6368 2827 6d65 6469  mock.patch('medi
-00002c00: 6167 7261 696e 732e 6773 662e 6461 7465  agrains.gsf.date
-00002c10: 7469 6d65 272c 2073 6964 655f 6566 6665  time', side_effe
-00002c20: 6374 3d64 6174 6574 696d 652c 206e 6f77  ct=datetime, now
-00002c30: 3d6d 6f63 6b2e 4d61 6769 634d 6f63 6b28  =mock.MagicMock(
-00002c40: 7265 7475 726e 5f76 616c 7565 3d63 7265  return_value=cre
-00002c50: 6174 6564 2929 3a0a 2020 2020 2020 2020  ated)):.        
-00002c60: 2020 2020 7769 7468 206d 6f63 6b2e 7061      with mock.pa
-00002c70: 7463 6828 276d 6564 6961 6772 6169 6e73  tch('mediagrains
-00002c80: 2e67 7366 2e75 7569 6431 272c 2073 6964  .gsf.uuid1', sid
-00002c90: 655f 6566 6665 6374 3d75 7569 6473 293a  e_effect=uuids):
-00002ca0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00002cb0: 2028 6865 6164 2c20 7365 676d 656e 7473   (head, segments
-00002cc0: 2920 3d20 6c6f 6164 7328 6475 6d70 7328  ) = loads(dumps(
-00002cd0: 5b67 7261 696e 302c 2067 7261 696e 315d  [grain0, grain1]
-00002ce0: 2929 0a0a 2020 2020 2020 2020 7365 6c66  ))..        self
-00002cf0: 2e61 7373 6572 7449 6e28 2769 6427 2c20  .assertIn('id', 
-00002d00: 6865 6164 290a 2020 2020 2020 2020 7365  head).        se
-00002d10: 6c66 2e61 7373 6572 7449 6e28 6865 6164  lf.assertIn(head
-00002d20: 5b27 6964 275d 2c20 7575 6964 7329 0a20  ['id'], uuids). 
-00002d30: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00002d40: 7274 496e 2827 7461 6773 272c 2068 6561  rtIn('tags', hea
-00002d50: 6429 0a20 2020 2020 2020 2073 656c 662e  d).        self.
-00002d60: 6173 7365 7274 4571 7561 6c28 6c65 6e28  assertEqual(len(
-00002d70: 6865 6164 5b27 7461 6773 275d 292c 2030  head['tags']), 0
-00002d80: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-00002d90: 7373 6572 7449 6e28 2763 7265 6174 6564  ssertIn('created
-00002da0: 272c 2068 6561 6429 0a20 2020 2020 2020  ', head).       
-00002db0: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-00002dc0: 6c28 6865 6164 5b27 6372 6561 7465 6427  l(head['created'
-00002dd0: 5d2c 2063 7265 6174 6564 290a 2020 2020  ], created).    
-00002de0: 2020 2020 7365 6c66 2e61 7373 6572 7449      self.assertI
-00002df0: 6e28 2773 6567 6d65 6e74 7327 2c20 6865  n('segments', he
-00002e00: 6164 290a 2020 2020 2020 2020 7365 6c66  ad).        self
-00002e10: 2e61 7373 6572 7445 7175 616c 286c 656e  .assertEqual(len
-00002e20: 2868 6561 645b 2773 6567 6d65 6e74 7327  (head['segments'
-00002e30: 5d29 2c20 3129 0a20 2020 2020 2020 2073  ]), 1).        s
-00002e40: 656c 662e 6173 7365 7274 496e 2827 636f  elf.assertIn('co
-00002e50: 756e 7427 2c20 6865 6164 5b27 7365 676d  unt', head['segm
-00002e60: 656e 7473 275d 5b30 5d29 0a20 2020 2020  ents'][0]).     
-00002e70: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-00002e80: 7561 6c28 6865 6164 5b27 7365 676d 656e  ual(head['segmen
-00002e90: 7473 275d 5b30 5d5b 2763 6f75 6e74 275d  ts'][0]['count']
-00002ea0: 2c20 3229 0a20 2020 2020 2020 2073 656c  , 2).        sel
-00002eb0: 662e 6173 7365 7274 496e 2827 6c6f 6361  f.assertIn('loca
-00002ec0: 6c5f 6964 272c 2068 6561 645b 2773 6567  l_id', head['seg
-00002ed0: 6d65 6e74 7327 5d5b 305d 290a 2020 2020  ments'][0]).    
-00002ee0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-00002ef0: 7175 616c 2868 6561 645b 2773 6567 6d65  qual(head['segme
-00002f00: 6e74 7327 5d5b 305d 5b27 6c6f 6361 6c5f  nts'][0]['local_
-00002f10: 6964 275d 2c20 3129 0a20 2020 2020 2020  id'], 1).       
-00002f20: 2073 656c 662e 6173 7365 7274 496e 2827   self.assertIn('
-00002f30: 6964 272c 2068 6561 645b 2773 6567 6d65  id', head['segme
-00002f40: 6e74 7327 5d5b 305d 290a 2020 2020 2020  nts'][0]).      
-00002f50: 2020 7365 6c66 2e61 7373 6572 7449 6e28    self.assertIn(
-00002f60: 6865 6164 5b27 7365 676d 656e 7473 275d  head['segments']
-00002f70: 5b30 5d5b 2769 6427 5d2c 2075 7569 6473  [0]['id'], uuids
-00002f80: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-00002f90: 7373 6572 7449 6e28 2774 6167 7327 2c20  ssertIn('tags', 
-00002fa0: 6865 6164 5b27 7365 676d 656e 7473 275d  head['segments']
-00002fb0: 5b30 5d29 0a20 2020 2020 2020 2073 656c  [0]).        sel
-00002fc0: 662e 6173 7365 7274 4571 7561 6c28 6c65  f.assertEqual(le
-00002fd0: 6e28 6865 6164 5b27 7365 676d 656e 7473  n(head['segments
-00002fe0: 275d 5b30 5d5b 2774 6167 7327 5d29 2c20  '][0]['tags']), 
-00002ff0: 3029 0a0a 2020 2020 2020 2020 7365 6c66  0)..        self
-00003000: 2e61 7373 6572 7445 7175 616c 286c 656e  .assertEqual(len
-00003010: 2873 6567 6d65 6e74 7329 2c20 3129 0a20  (segments), 1). 
-00003020: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00003030: 7274 496e 2831 2c20 7365 676d 656e 7473  rtIn(1, segments
-00003040: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-00003050: 7373 6572 7445 7175 616c 286c 656e 2873  ssertEqual(len(s
-00003060: 6567 6d65 6e74 735b 315d 292c 2068 6561  egments[1]), hea
-00003070: 645b 2773 6567 6d65 6e74 7327 5d5b 305d  d['segments'][0]
-00003080: 5b27 636f 756e 7427 5d29 0a0a 2020 2020  ['count'])..    
-00003090: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-000030a0: 7175 616c 2873 6567 6d65 6e74 735b 315d  qual(segments[1]
-000030b0: 5b30 5d2e 736f 7572 6365 5f69 642c 2073  [0].source_id, s
-000030c0: 7263 5f69 6429 0a20 2020 2020 2020 2073  rc_id).        s
-000030d0: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-000030e0: 7365 676d 656e 7473 5b31 5d5b 305d 2e66  segments[1][0].f
-000030f0: 6c6f 775f 6964 2c20 666c 6f77 5f69 6429  low_id, flow_id)
-00003100: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-00003110: 7365 7274 4571 7561 6c28 7365 676d 656e  sertEqual(segmen
-00003120: 7473 5b31 5d5b 305d 2e67 7261 696e 5f74  ts[1][0].grain_t
-00003130: 7970 652c 2027 7669 6465 6f27 290a 2020  ype, 'video').  
-00003140: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-00003150: 7445 7175 616c 2873 6567 6d65 6e74 735b  tEqual(segments[
-00003160: 315d 5b30 5d2e 666f 726d 6174 2c20 436f  1][0].format, Co
-00003170: 6746 7261 6d65 466f 726d 6174 2e53 3136  gFrameFormat.S16
-00003180: 5f34 3232 5f31 3042 4954 290a 2020 2020  _422_10BIT).    
-00003190: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-000031a0: 7175 616c 2873 6567 6d65 6e74 735b 315d  qual(segments[1]
-000031b0: 5b30 5d2e 7769 6474 682c 2031 3932 3029  [0].width, 1920)
-000031c0: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-000031d0: 7365 7274 4571 7561 6c28 7365 676d 656e  sertEqual(segmen
-000031e0: 7473 5b31 5d5b 305d 2e68 6569 6768 742c  ts[1][0].height,
-000031f0: 2031 3038 3029 0a20 2020 2020 2020 2073   1080).        s
-00003200: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-00003210: 7365 676d 656e 7473 5b31 5d5b 305d 2e73  segments[1][0].s
-00003220: 6f75 7263 655f 6173 7065 6374 5f72 6174  ource_aspect_rat
-00003230: 696f 2c20 4672 6163 7469 6f6e 2831 362c  io, Fraction(16,
-00003240: 2039 2929 0a20 2020 2020 2020 2073 656c   9)).        sel
-00003250: 662e 6173 7365 7274 4571 7561 6c28 7365  f.assertEqual(se
-00003260: 676d 656e 7473 5b31 5d5b 305d 2e70 6978  gments[1][0].pix
-00003270: 656c 5f61 7370 6563 745f 7261 7469 6f2c  el_aspect_ratio,
-00003280: 2046 7261 6374 696f 6e28 312c 2031 2929   Fraction(1, 1))
-00003290: 0a0a 2020 2020 2020 2020 7365 6c66 2e61  ..        self.a
-000032a0: 7373 6572 7445 7175 616c 2873 6567 6d65  ssertEqual(segme
-000032b0: 6e74 735b 315d 5b30 5d2e 6461 7461 2c20  nts[1][0].data, 
-000032c0: 6772 6169 6e30 2e64 6174 6129 0a0a 2020  grain0.data)..  
-000032d0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-000032e0: 7445 7175 616c 2873 6567 6d65 6e74 735b  tEqual(segments[
-000032f0: 315d 5b31 5d2e 736f 7572 6365 5f69 642c  1][1].source_id,
-00003300: 2073 7263 5f69 6429 0a20 2020 2020 2020   src_id).       
-00003310: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-00003320: 6c28 7365 676d 656e 7473 5b31 5d5b 315d  l(segments[1][1]
-00003330: 2e66 6c6f 775f 6964 2c20 666c 6f77 5f69  .flow_id, flow_i
-00003340: 6429 0a20 2020 2020 2020 2073 656c 662e  d).        self.
-00003350: 6173 7365 7274 4571 7561 6c28 7365 676d  assertEqual(segm
-00003360: 656e 7473 5b31 5d5b 315d 2e67 7261 696e  ents[1][1].grain
-00003370: 5f74 7970 652c 2027 7669 6465 6f27 290a  _type, 'video').
-00003380: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-00003390: 6572 7445 7175 616c 2873 6567 6d65 6e74  ertEqual(segment
-000033a0: 735b 315d 5b31 5d2e 666f 726d 6174 2c20  s[1][1].format, 
-000033b0: 436f 6746 7261 6d65 466f 726d 6174 2e53  CogFrameFormat.S
-000033c0: 3136 5f34 3232 5f31 3042 4954 290a 2020  16_422_10BIT).  
-000033d0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-000033e0: 7445 7175 616c 2873 6567 6d65 6e74 735b  tEqual(segments[
-000033f0: 315d 5b31 5d2e 7769 6474 682c 2031 3932  1][1].width, 192
-00003400: 3029 0a20 2020 2020 2020 2073 656c 662e  0).        self.
-00003410: 6173 7365 7274 4571 7561 6c28 7365 676d  assertEqual(segm
-00003420: 656e 7473 5b31 5d5b 315d 2e68 6569 6768  ents[1][1].heigh
-00003430: 742c 2031 3038 3029 0a20 2020 2020 2020  t, 1080).       
-00003440: 2073 656c 662e 6173 7365 7274 4973 4e6f   self.assertIsNo
-00003450: 6e65 2873 6567 6d65 6e74 735b 315d 5b31  ne(segments[1][1
-00003460: 5d2e 736f 7572 6365 5f61 7370 6563 745f  ].source_aspect_
-00003470: 7261 7469 6f29 0a20 2020 2020 2020 2073  ratio).        s
-00003480: 656c 662e 6173 7365 7274 4973 4e6f 6e65  elf.assertIsNone
-00003490: 2873 6567 6d65 6e74 735b 315d 5b31 5d2e  (segments[1][1].
-000034a0: 7069 7865 6c5f 6173 7065 6374 5f72 6174  pixel_aspect_rat
-000034b0: 696f 290a 0a20 2020 2020 2020 2073 656c  io)..        sel
-000034c0: 662e 6173 7365 7274 4571 7561 6c28 7365  f.assertEqual(se
-000034d0: 676d 656e 7473 5b31 5d5b 315d 2e64 6174  gments[1][1].dat
-000034e0: 612c 2067 7261 696e 312e 6461 7461 290a  a, grain1.data).
-000034f0: 0a20 2020 2061 7379 6e63 2064 6566 2074  .    async def t
-00003500: 6573 745f 6173 796e 635f 656e 636f 6465  est_async_encode
-00003510: 5f76 6964 656f 6772 6169 6e73 2873 656c  _videograins(sel
-00003520: 6629 3a0a 2020 2020 2020 2020 7372 635f  f):.        src_
-00003530: 6964 203d 2055 5549 4428 2765 3134 6539  id = UUID('e14e9
-00003540: 6435 382d 3135 3637 2d31 3165 382d 3864  d58-1567-11e8-8d
-00003550: 6433 2d38 3331 6130 3638 6562 3033 3427  d3-831a068eb034'
-00003560: 290a 2020 2020 2020 2020 666c 6f77 5f69  ).        flow_i
-00003570: 6420 3d20 5555 4944 2827 6565 3165 6564  d = UUID('ee1eed
-00003580: 3538 2d31 3536 372d 3131 6538 2d61 3937  58-1567-11e8-a97
-00003590: 312d 3362 3930 3161 3264 6438 6162 2729  1-3b901a2dd8ab')
-000035a0: 0a20 2020 2020 2020 2067 7261 696e 3020  .        grain0 
-000035b0: 3d20 5669 6465 6f47 7261 696e 2873 7263  = VideoGrain(src
-000035c0: 5f69 642c 2066 6c6f 775f 6964 2c20 636f  _id, flow_id, co
-000035d0: 675f 6672 616d 655f 666f 726d 6174 3d43  g_frame_format=C
-000035e0: 6f67 4672 616d 6546 6f72 6d61 742e 5331  ogFrameFormat.S1
-000035f0: 365f 3432 325f 3130 4249 542c 2077 6964  6_422_10BIT, wid
-00003600: 7468 3d31 3932 302c 2068 6569 6768 743d  th=1920, height=
-00003610: 3130 3830 290a 2020 2020 2020 2020 6772  1080).        gr
-00003620: 6169 6e31 203d 2056 6964 656f 4772 6169  ain1 = VideoGrai
-00003630: 6e28 7372 635f 6964 2c20 666c 6f77 5f69  n(src_id, flow_i
-00003640: 642c 2063 6f67 5f66 7261 6d65 5f66 6f72  d, cog_frame_for
-00003650: 6d61 743d 436f 6746 7261 6d65 466f 726d  mat=CogFrameForm
-00003660: 6174 2e53 3136 5f34 3232 5f31 3042 4954  at.S16_422_10BIT
-00003670: 2c20 7769 6474 683d 3139 3230 2c20 6865  , width=1920, he
-00003680: 6967 6874 3d31 3038 3029 0a20 2020 2020  ight=1080).     
-00003690: 2020 2066 6f72 2069 2069 6e20 7261 6e67     for i in rang
-000036a0: 6528 302c 206c 656e 2867 7261 696e 302e  e(0, len(grain0.
-000036b0: 6461 7461 2929 3a0a 2020 2020 2020 2020  data)):.        
-000036c0: 2020 2020 6772 6169 6e30 2e64 6174 615b      grain0.data[
-000036d0: 695d 203d 2069 2026 2030 7846 460a 2020  i] = i & 0xFF.  
-000036e0: 2020 2020 2020 666f 7220 6920 696e 2072        for i in r
-000036f0: 616e 6765 2830 2c20 6c65 6e28 6772 6169  ange(0, len(grai
-00003700: 6e31 2e64 6174 6129 293a 0a20 2020 2020  n1.data)):.     
-00003710: 2020 2020 2020 2067 7261 696e 312e 6461         grain1.da
-00003720: 7461 5b69 5d20 3d20 3078 4646 202d 2028  ta[i] = 0xFF - (
-00003730: 6920 2620 3078 4646 290a 2020 2020 2020  i & 0xFF).      
-00003740: 2020 6772 6169 6e30 2e73 6f75 7263 655f    grain0.source_
-00003750: 6173 7065 6374 5f72 6174 696f 203d 2046  aspect_ratio = F
-00003760: 7261 6374 696f 6e28 3136 2c20 3929 0a20  raction(16, 9). 
-00003770: 2020 2020 2020 2067 7261 696e 302e 7069         grain0.pi
-00003780: 7865 6c5f 6173 7065 6374 5f72 6174 696f  xel_aspect_ratio
-00003790: 203d 2031 0a20 2020 2020 2020 2075 7569   = 1.        uui
-000037a0: 6473 203d 205b 5555 4944 2827 3739 3230  ds = [UUID('7920
-000037b0: 6233 3934 2d31 3536 352d 3131 6538 2d38  b394-1565-11e8-8
-000037c0: 3665 302d 3862 3432 6434 3634 3762 6138  6e0-8b42d4647ba8
-000037d0: 2729 2c0a 2020 2020 2020 2020 2020 2020  '),.            
-000037e0: 2020 2020 2055 5549 4428 2738 3061 6638       UUID('80af8
-000037f0: 3735 632d 3135 3635 2d31 3165 382d 3866  75c-1565-11e8-8f
-00003800: 3434 2d38 3765 6630 3831 6234 3863 6427  44-87ef081b48cd'
-00003810: 295d 0a20 2020 2020 2020 2063 7265 6174  )].        creat
-00003820: 6564 203d 2064 6174 6574 696d 6528 3139  ed = datetime(19
-00003830: 3833 2c20 332c 2032 392c 2031 352c 2031  83, 3, 29, 15, 1
-00003840: 3529 0a20 2020 2020 2020 2077 6974 6820  5).        with 
-00003850: 6d6f 636b 2e70 6174 6368 2827 6d65 6469  mock.patch('medi
-00003860: 6167 7261 696e 732e 6773 662e 6461 7465  agrains.gsf.date
-00003870: 7469 6d65 272c 2073 6964 655f 6566 6665  time', side_effe
-00003880: 6374 3d64 6174 6574 696d 652c 206e 6f77  ct=datetime, now
-00003890: 3d6d 6f63 6b2e 4d61 6769 634d 6f63 6b28  =mock.MagicMock(
-000038a0: 7265 7475 726e 5f76 616c 7565 3d63 7265  return_value=cre
-000038b0: 6174 6564 2929 3a0a 2020 2020 2020 2020  ated)):.        
-000038c0: 2020 2020 7769 7468 206d 6f63 6b2e 7061      with mock.pa
-000038d0: 7463 6828 276d 6564 6961 6772 6169 6e73  tch('mediagrains
-000038e0: 2e67 7366 2e75 7569 6431 272c 2073 6964  .gsf.uuid1', sid
-000038f0: 655f 6566 6665 6374 3d75 7569 6473 293a  e_effect=uuids):
-00003900: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00003910: 2066 203d 2042 7974 6573 494f 2829 0a20   f = BytesIO(). 
-00003920: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-00003930: 7379 6e63 2077 6974 6820 4753 4645 6e63  sync with GSFEnc
-00003940: 6f64 6572 2866 2920 6173 2065 6e63 3a0a  oder(f) as enc:.
-00003950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003960: 2020 2020 6177 6169 7420 656e 632e 6164      await enc.ad
-00003970: 645f 6772 6169 6e73 285b 6772 6169 6e30  d_grains([grain0
-00003980: 2c20 6772 6169 6e31 5d29 0a20 2020 2020  , grain1]).     
-00003990: 2020 2020 2020 2020 2020 2028 6865 6164             (head
-000039a0: 2c20 7365 676d 656e 7473 2920 3d20 6c6f  , segments) = lo
-000039b0: 6164 7328 662e 6765 7476 616c 7565 2829  ads(f.getvalue()
-000039c0: 290a 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-000039d0: 6173 7365 7274 496e 2827 6964 272c 2068  assertIn('id', h
-000039e0: 6561 6429 0a20 2020 2020 2020 2073 656c  ead).        sel
-000039f0: 662e 6173 7365 7274 496e 2868 6561 645b  f.assertIn(head[
-00003a00: 2769 6427 5d2c 2075 7569 6473 290a 2020  'id'], uuids).  
-00003a10: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-00003a20: 7449 6e28 2774 6167 7327 2c20 6865 6164  tIn('tags', head
-00003a30: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-00003a40: 7373 6572 7445 7175 616c 286c 656e 2868  ssertEqual(len(h
-00003a50: 6561 645b 2774 6167 7327 5d29 2c20 3029  ead['tags']), 0)
-00003a60: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-00003a70: 7365 7274 496e 2827 6372 6561 7465 6427  sertIn('created'
-00003a80: 2c20 6865 6164 290a 2020 2020 2020 2020  , head).        
-00003a90: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-00003aa0: 2868 6561 645b 2763 7265 6174 6564 275d  (head['created']
-00003ab0: 2c20 6372 6561 7465 6429 0a20 2020 2020  , created).     
-00003ac0: 2020 2073 656c 662e 6173 7365 7274 496e     self.assertIn
-00003ad0: 2827 7365 676d 656e 7473 272c 2068 6561  ('segments', hea
-00003ae0: 6429 0a20 2020 2020 2020 2073 656c 662e  d).        self.
-00003af0: 6173 7365 7274 4571 7561 6c28 6c65 6e28  assertEqual(len(
-00003b00: 6865 6164 5b27 7365 676d 656e 7473 275d  head['segments']
-00003b10: 292c 2031 290a 2020 2020 2020 2020 7365  ), 1).        se
-00003b20: 6c66 2e61 7373 6572 7449 6e28 2763 6f75  lf.assertIn('cou
-00003b30: 6e74 272c 2068 6561 645b 2773 6567 6d65  nt', head['segme
-00003b40: 6e74 7327 5d5b 305d 290a 2020 2020 2020  nts'][0]).      
-00003b50: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-00003b60: 616c 2868 6561 645b 2773 6567 6d65 6e74  al(head['segment
-00003b70: 7327 5d5b 305d 5b27 636f 756e 7427 5d2c  s'][0]['count'],
-00003b80: 2032 290a 2020 2020 2020 2020 7365 6c66   2).        self
-00003b90: 2e61 7373 6572 7449 6e28 276c 6f63 616c  .assertIn('local
-00003ba0: 5f69 6427 2c20 6865 6164 5b27 7365 676d  _id', head['segm
-00003bb0: 656e 7473 275d 5b30 5d29 0a20 2020 2020  ents'][0]).     
-00003bc0: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-00003bd0: 7561 6c28 6865 6164 5b27 7365 676d 656e  ual(head['segmen
-00003be0: 7473 275d 5b30 5d5b 276c 6f63 616c 5f69  ts'][0]['local_i
-00003bf0: 6427 5d2c 2031 290a 2020 2020 2020 2020  d'], 1).        
-00003c00: 7365 6c66 2e61 7373 6572 7449 6e28 2769  self.assertIn('i
-00003c10: 6427 2c20 6865 6164 5b27 7365 676d 656e  d', head['segmen
-00003c20: 7473 275d 5b30 5d29 0a20 2020 2020 2020  ts'][0]).       
-00003c30: 2073 656c 662e 6173 7365 7274 496e 2868   self.assertIn(h
-00003c40: 6561 645b 2773 6567 6d65 6e74 7327 5d5b  ead['segments'][
-00003c50: 305d 5b27 6964 275d 2c20 7575 6964 7329  0]['id'], uuids)
-00003c60: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-00003c70: 7365 7274 496e 2827 7461 6773 272c 2068  sertIn('tags', h
-00003c80: 6561 645b 2773 6567 6d65 6e74 7327 5d5b  ead['segments'][
-00003c90: 305d 290a 2020 2020 2020 2020 7365 6c66  0]).        self
-00003ca0: 2e61 7373 6572 7445 7175 616c 286c 656e  .assertEqual(len
-00003cb0: 2868 6561 645b 2773 6567 6d65 6e74 7327  (head['segments'
-00003cc0: 5d5b 305d 5b27 7461 6773 275d 292c 2030  ][0]['tags']), 0
-00003cd0: 290a 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-00003ce0: 6173 7365 7274 4571 7561 6c28 6c65 6e28  assertEqual(len(
-00003cf0: 7365 676d 656e 7473 292c 2031 290a 2020  segments), 1).  
-00003d00: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-00003d10: 7449 6e28 312c 2073 6567 6d65 6e74 7329  tIn(1, segments)
-00003d20: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-00003d30: 7365 7274 4571 7561 6c28 6c65 6e28 7365  sertEqual(len(se
-00003d40: 676d 656e 7473 5b31 5d29 2c20 6865 6164  gments[1]), head
-00003d50: 5b27 7365 676d 656e 7473 275d 5b30 5d5b  ['segments'][0][
-00003d60: 2763 6f75 6e74 275d 290a 0a20 2020 2020  'count'])..     
-00003d70: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-00003d80: 7561 6c28 7365 676d 656e 7473 5b31 5d5b  ual(segments[1][
-00003d90: 305d 2e73 6f75 7263 655f 6964 2c20 7372  0].source_id, sr
-00003da0: 635f 6964 290a 2020 2020 2020 2020 7365  c_id).        se
-00003db0: 6c66 2e61 7373 6572 7445 7175 616c 2873  lf.assertEqual(s
-00003dc0: 6567 6d65 6e74 735b 315d 5b30 5d2e 666c  egments[1][0].fl
-00003dd0: 6f77 5f69 642c 2066 6c6f 775f 6964 290a  ow_id, flow_id).
-00003de0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-00003df0: 6572 7445 7175 616c 2873 6567 6d65 6e74  ertEqual(segment
-00003e00: 735b 315d 5b30 5d2e 6772 6169 6e5f 7479  s[1][0].grain_ty
-00003e10: 7065 2c20 2776 6964 656f 2729 0a20 2020  pe, 'video').   
-00003e20: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00003e30: 4571 7561 6c28 7365 676d 656e 7473 5b31  Equal(segments[1
-00003e40: 5d5b 305d 2e66 6f72 6d61 742c 2043 6f67  ][0].format, Cog
-00003e50: 4672 616d 6546 6f72 6d61 742e 5331 365f  FrameFormat.S16_
-00003e60: 3432 325f 3130 4249 5429 0a20 2020 2020  422_10BIT).     
-00003e70: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-00003e80: 7561 6c28 7365 676d 656e 7473 5b31 5d5b  ual(segments[1][
-00003e90: 305d 2e77 6964 7468 2c20 3139 3230 290a  0].width, 1920).
-00003ea0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-00003eb0: 6572 7445 7175 616c 2873 6567 6d65 6e74  ertEqual(segment
-00003ec0: 735b 315d 5b30 5d2e 6865 6967 6874 2c20  s[1][0].height, 
-00003ed0: 3130 3830 290a 2020 2020 2020 2020 7365  1080).        se
-00003ee0: 6c66 2e61 7373 6572 7445 7175 616c 2873  lf.assertEqual(s
-00003ef0: 6567 6d65 6e74 735b 315d 5b30 5d2e 736f  egments[1][0].so
-00003f00: 7572 6365 5f61 7370 6563 745f 7261 7469  urce_aspect_rati
-00003f10: 6f2c 2046 7261 6374 696f 6e28 3136 2c20  o, Fraction(16, 
-00003f20: 3929 290a 2020 2020 2020 2020 7365 6c66  9)).        self
-00003f30: 2e61 7373 6572 7445 7175 616c 2873 6567  .assertEqual(seg
-00003f40: 6d65 6e74 735b 315d 5b30 5d2e 7069 7865  ments[1][0].pixe
-00003f50: 6c5f 6173 7065 6374 5f72 6174 696f 2c20  l_aspect_ratio, 
-00003f60: 4672 6163 7469 6f6e 2831 2c20 3129 290a  Fraction(1, 1)).
-00003f70: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-00003f80: 7365 7274 4571 7561 6c28 7365 676d 656e  sertEqual(segmen
-00003f90: 7473 5b31 5d5b 305d 2e64 6174 612c 2067  ts[1][0].data, g
-00003fa0: 7261 696e 302e 6461 7461 290a 0a20 2020  rain0.data)..   
-00003fb0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00003fc0: 4571 7561 6c28 7365 676d 656e 7473 5b31  Equal(segments[1
-00003fd0: 5d5b 315d 2e73 6f75 7263 655f 6964 2c20  ][1].source_id, 
-00003fe0: 7372 635f 6964 290a 2020 2020 2020 2020  src_id).        
-00003ff0: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-00004000: 2873 6567 6d65 6e74 735b 315d 5b31 5d2e  (segments[1][1].
-00004010: 666c 6f77 5f69 642c 2066 6c6f 775f 6964  flow_id, flow_id
-00004020: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-00004030: 7373 6572 7445 7175 616c 2873 6567 6d65  ssertEqual(segme
-00004040: 6e74 735b 315d 5b31 5d2e 6772 6169 6e5f  nts[1][1].grain_
-00004050: 7479 7065 2c20 2776 6964 656f 2729 0a20  type, 'video'). 
-00004060: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00004070: 7274 4571 7561 6c28 7365 676d 656e 7473  rtEqual(segments
-00004080: 5b31 5d5b 315d 2e66 6f72 6d61 742c 2043  [1][1].format, C
-00004090: 6f67 4672 616d 6546 6f72 6d61 742e 5331  ogFrameFormat.S1
-000040a0: 365f 3432 325f 3130 4249 5429 0a20 2020  6_422_10BIT).   
-000040b0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-000040c0: 4571 7561 6c28 7365 676d 656e 7473 5b31  Equal(segments[1
-000040d0: 5d5b 315d 2e77 6964 7468 2c20 3139 3230  ][1].width, 1920
-000040e0: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-000040f0: 7373 6572 7445 7175 616c 2873 6567 6d65  ssertEqual(segme
-00004100: 6e74 735b 315d 5b31 5d2e 6865 6967 6874  nts[1][1].height
-00004110: 2c20 3130 3830 290a 2020 2020 2020 2020  , 1080).        
-00004120: 7365 6c66 2e61 7373 6572 7449 734e 6f6e  self.assertIsNon
-00004130: 6528 7365 676d 656e 7473 5b31 5d5b 315d  e(segments[1][1]
-00004140: 2e73 6f75 7263 655f 6173 7065 6374 5f72  .source_aspect_r
-00004150: 6174 696f 290a 2020 2020 2020 2020 7365  atio).        se
-00004160: 6c66 2e61 7373 6572 7449 734e 6f6e 6528  lf.assertIsNone(
-00004170: 7365 676d 656e 7473 5b31 5d5b 315d 2e70  segments[1][1].p
-00004180: 6978 656c 5f61 7370 6563 745f 7261 7469  ixel_aspect_rati
-00004190: 6f29 0a0a 2020 2020 2020 2020 7365 6c66  o)..        self
-000041a0: 2e61 7373 6572 7445 7175 616c 2873 6567  .assertEqual(seg
-000041b0: 6d65 6e74 735b 315d 5b31 5d2e 6461 7461  ments[1][1].data
-000041c0: 2c20 6772 6169 6e31 2e64 6174 6129 0a0a  , grain1.data)..
-000041d0: 2020 2020 6465 6620 7465 7374 5f64 756d      def test_dum
-000041e0: 7073 5f61 7564 696f 6772 6169 6e73 2873  ps_audiograins(s
-000041f0: 656c 6629 3a0a 2020 2020 2020 2020 7372  elf):.        sr
-00004200: 635f 6964 203d 2055 5549 4428 2765 3134  c_id = UUID('e14
-00004210: 6539 6435 382d 3135 3637 2d31 3165 382d  e9d58-1567-11e8-
-00004220: 3864 6433 2d38 3331 6130 3638 6562 3033  8dd3-831a068eb03
-00004230: 3427 290a 2020 2020 2020 2020 666c 6f77  4').        flow
-00004240: 5f69 6420 3d20 5555 4944 2827 6565 3165  _id = UUID('ee1e
-00004250: 6564 3538 2d31 3536 372d 3131 6538 2d61  ed58-1567-11e8-a
-00004260: 3937 312d 3362 3930 3161 3264 6438 6162  971-3b901a2dd8ab
-00004270: 2729 0a20 2020 2020 2020 2067 7261 696e  ').        grain
-00004280: 3020 3d20 4175 6469 6f47 7261 696e 280a  0 = AudioGrain(.
-00004290: 2020 2020 2020 2020 2020 2020 7372 635f              src_
-000042a0: 6964 2c20 666c 6f77 5f69 642c 2063 6f67  id, flow_id, cog
-000042b0: 5f61 7564 696f 5f66 6f72 6d61 743d 436f  _audio_format=Co
-000042c0: 6741 7564 696f 466f 726d 6174 2e53 3136  gAudioFormat.S16
-000042d0: 5f50 4c41 4e45 532c 2073 616d 706c 6573  _PLANES, samples
-000042e0: 3d31 3932 302c 2073 616d 706c 655f 7261  =1920, sample_ra
-000042f0: 7465 3d34 3830 3030 290a 2020 2020 2020  te=48000).      
-00004300: 2020 6772 6169 6e31 203d 2041 7564 696f    grain1 = Audio
-00004310: 4772 6169 6e28 0a20 2020 2020 2020 2020  Grain(.         
-00004320: 2020 2073 7263 5f69 642c 2066 6c6f 775f     src_id, flow_
-00004330: 6964 2c20 636f 675f 6175 6469 6f5f 666f  id, cog_audio_fo
-00004340: 726d 6174 3d43 6f67 4175 6469 6f46 6f72  rmat=CogAudioFor
-00004350: 6d61 742e 5331 365f 504c 414e 4553 2c20  mat.S16_PLANES, 
-00004360: 7361 6d70 6c65 733d 3139 3230 2c20 7361  samples=1920, sa
-00004370: 6d70 6c65 5f72 6174 653d 3438 3030 3029  mple_rate=48000)
-00004380: 0a20 2020 2020 2020 2066 6f72 2069 2069  .        for i i
-00004390: 6e20 7261 6e67 6528 302c 206c 656e 2867  n range(0, len(g
-000043a0: 7261 696e 302e 6461 7461 2929 3a0a 2020  rain0.data)):.  
-000043b0: 2020 2020 2020 2020 2020 6772 6169 6e30            grain0
-000043c0: 2e64 6174 615b 695d 203d 2069 2026 2030  .data[i] = i & 0
-000043d0: 7846 460a 2020 2020 2020 2020 666f 7220  xFF.        for 
-000043e0: 6920 696e 2072 616e 6765 2830 2c20 6c65  i in range(0, le
-000043f0: 6e28 6772 6169 6e31 2e64 6174 6129 293a  n(grain1.data)):
-00004400: 0a20 2020 2020 2020 2020 2020 2067 7261  .            gra
-00004410: 696e 312e 6461 7461 5b69 5d20 3d20 3078  in1.data[i] = 0x
-00004420: 4646 202d 2028 6920 2620 3078 4646 290a  FF - (i & 0xFF).
-00004430: 2020 2020 2020 2020 7575 6964 7320 3d20          uuids = 
-00004440: 5b55 5549 4428 2737 3932 3062 3339 342d  [UUID('7920b394-
-00004450: 3135 3635 2d31 3165 382d 3836 6530 2d38  1565-11e8-86e0-8
-00004460: 6234 3264 3436 3437 6261 3827 292c 0a20  b42d4647ba8'),. 
-00004470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004480: 5555 4944 2827 3830 6166 3837 3563 2d31  UUID('80af875c-1
-00004490: 3536 352d 3131 6538 2d38 6634 342d 3837  565-11e8-8f44-87
-000044a0: 6566 3038 3162 3438 6364 2729 5d0a 2020  ef081b48cd')].  
-000044b0: 2020 2020 2020 6372 6561 7465 6420 3d20        created = 
-000044c0: 6461 7465 7469 6d65 2831 3938 332c 2033  datetime(1983, 3
-000044d0: 2c20 3239 2c20 3135 2c20 3135 290a 2020  , 29, 15, 15).  
-000044e0: 2020 2020 2020 7769 7468 206d 6f63 6b2e        with mock.
-000044f0: 7061 7463 6828 276d 6564 6961 6772 6169  patch('mediagrai
-00004500: 6e73 2e67 7366 2e64 6174 6574 696d 6527  ns.gsf.datetime'
-00004510: 2c20 7369 6465 5f65 6666 6563 743d 6461  , side_effect=da
-00004520: 7465 7469 6d65 2c20 6e6f 773d 6d6f 636b  tetime, now=mock
-00004530: 2e4d 6167 6963 4d6f 636b 2872 6574 7572  .MagicMock(retur
-00004540: 6e5f 7661 6c75 653d 6372 6561 7465 6429  n_value=created)
-00004550: 293a 0a20 2020 2020 2020 2020 2020 2077  ):.            w
-00004560: 6974 6820 6d6f 636b 2e70 6174 6368 2827  ith mock.patch('
-00004570: 6d65 6469 6167 7261 696e 732e 6773 662e  mediagrains.gsf.
-00004580: 7575 6964 3127 2c20 7369 6465 5f65 6666  uuid1', side_eff
-00004590: 6563 743d 7575 6964 7329 3a0a 2020 2020  ect=uuids):.    
-000045a0: 2020 2020 2020 2020 2020 2020 2868 6561              (hea
-000045b0: 642c 2073 6567 6d65 6e74 7329 203d 206c  d, segments) = l
-000045c0: 6f61 6473 2864 756d 7073 285b 6772 6169  oads(dumps([grai
-000045d0: 6e30 2c20 6772 6169 6e31 5d29 290a 0a20  n0, grain1])).. 
-000045e0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-000045f0: 7274 496e 2827 6964 272c 2068 6561 6429  rtIn('id', head)
-00004600: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-00004610: 7365 7274 496e 2868 6561 645b 2769 6427  sertIn(head['id'
-00004620: 5d2c 2075 7569 6473 290a 2020 2020 2020  ], uuids).      
-00004630: 2020 7365 6c66 2e61 7373 6572 7449 6e28    self.assertIn(
-00004640: 2774 6167 7327 2c20 6865 6164 290a 2020  'tags', head).  
-00004650: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-00004660: 7445 7175 616c 286c 656e 2868 6561 645b  tEqual(len(head[
-00004670: 2774 6167 7327 5d29 2c20 3029 0a20 2020  'tags']), 0).   
-00004680: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00004690: 496e 2827 6372 6561 7465 6427 2c20 6865  In('created', he
-000046a0: 6164 290a 2020 2020 2020 2020 7365 6c66  ad).        self
-000046b0: 2e61 7373 6572 7445 7175 616c 2868 6561  .assertEqual(hea
-000046c0: 645b 2763 7265 6174 6564 275d 2c20 6372  d['created'], cr
-000046d0: 6561 7465 6429 0a20 2020 2020 2020 2073  eated).        s
-000046e0: 656c 662e 6173 7365 7274 496e 2827 7365  elf.assertIn('se
-000046f0: 676d 656e 7473 272c 2068 6561 6429 0a20  gments', head). 
-00004700: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00004710: 7274 4571 7561 6c28 6c65 6e28 6865 6164  rtEqual(len(head
-00004720: 5b27 7365 676d 656e 7473 275d 292c 2031  ['segments']), 1
-00004730: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-00004740: 7373 6572 7449 6e28 2763 6f75 6e74 272c  ssertIn('count',
-00004750: 2068 6561 645b 2773 6567 6d65 6e74 7327   head['segments'
-00004760: 5d5b 305d 290a 2020 2020 2020 2020 7365  ][0]).        se
-00004770: 6c66 2e61 7373 6572 7445 7175 616c 2868  lf.assertEqual(h
-00004780: 6561 645b 2773 6567 6d65 6e74 7327 5d5b  ead['segments'][
-00004790: 305d 5b27 636f 756e 7427 5d2c 2032 290a  0]['count'], 2).
-000047a0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-000047b0: 6572 7449 6e28 276c 6f63 616c 5f69 6427  ertIn('local_id'
-000047c0: 2c20 6865 6164 5b27 7365 676d 656e 7473  , head['segments
-000047d0: 275d 5b30 5d29 0a20 2020 2020 2020 2073  '][0]).        s
-000047e0: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-000047f0: 6865 6164 5b27 7365 676d 656e 7473 275d  head['segments']
-00004800: 5b30 5d5b 276c 6f63 616c 5f69 6427 5d2c  [0]['local_id'],
-00004810: 2031 290a 2020 2020 2020 2020 7365 6c66   1).        self
-00004820: 2e61 7373 6572 7449 6e28 2769 6427 2c20  .assertIn('id', 
-00004830: 6865 6164 5b27 7365 676d 656e 7473 275d  head['segments']
-00004840: 5b30 5d29 0a20 2020 2020 2020 2073 656c  [0]).        sel
-00004850: 662e 6173 7365 7274 496e 2868 6561 645b  f.assertIn(head[
-00004860: 2773 6567 6d65 6e74 7327 5d5b 305d 5b27  'segments'][0]['
-00004870: 6964 275d 2c20 7575 6964 7329 0a20 2020  id'], uuids).   
-00004880: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00004890: 496e 2827 7461 6773 272c 2068 6561 645b  In('tags', head[
-000048a0: 2773 6567 6d65 6e74 7327 5d5b 305d 290a  'segments'][0]).
-000048b0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-000048c0: 6572 7445 7175 616c 286c 656e 2868 6561  ertEqual(len(hea
-000048d0: 645b 2773 6567 6d65 6e74 7327 5d5b 305d  d['segments'][0]
-000048e0: 5b27 7461 6773 275d 292c 2030 290a 0a20  ['tags']), 0).. 
-000048f0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00004900: 7274 4571 7561 6c28 6c65 6e28 7365 676d  rtEqual(len(segm
-00004910: 656e 7473 292c 2031 290a 2020 2020 2020  ents), 1).      
-00004920: 2020 7365 6c66 2e61 7373 6572 7449 6e28    self.assertIn(
-00004930: 312c 2073 6567 6d65 6e74 7329 0a20 2020  1, segments).   
-00004940: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00004950: 4571 7561 6c28 6c65 6e28 7365 676d 656e  Equal(len(segmen
-00004960: 7473 5b31 5d29 2c20 6865 6164 5b27 7365  ts[1]), head['se
-00004970: 676d 656e 7473 275d 5b30 5d5b 2763 6f75  gments'][0]['cou
-00004980: 6e74 275d 290a 0a20 2020 2020 2020 2073  nt'])..        s
-00004990: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-000049a0: 7365 676d 656e 7473 5b31 5d5b 305d 2e73  segments[1][0].s
-000049b0: 6f75 7263 655f 6964 2c20 7372 635f 6964  ource_id, src_id
-000049c0: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-000049d0: 7373 6572 7445 7175 616c 2873 6567 6d65  ssertEqual(segme
-000049e0: 6e74 735b 315d 5b30 5d2e 666c 6f77 5f69  nts[1][0].flow_i
-000049f0: 642c 2066 6c6f 775f 6964 290a 2020 2020  d, flow_id).    
-00004a00: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-00004a10: 7175 616c 2873 6567 6d65 6e74 735b 315d  qual(segments[1]
-00004a20: 5b30 5d2e 6772 6169 6e5f 7479 7065 2c20  [0].grain_type, 
-00004a30: 2761 7564 696f 2729 0a20 2020 2020 2020  'audio').       
-00004a40: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-00004a50: 6c28 7365 676d 656e 7473 5b31 5d5b 305d  l(segments[1][0]
-00004a60: 2e66 6f72 6d61 742c 2043 6f67 4175 6469  .format, CogAudi
-00004a70: 6f46 6f72 6d61 742e 5331 365f 504c 414e  oFormat.S16_PLAN
-00004a80: 4553 290a 2020 2020 2020 2020 7365 6c66  ES).        self
-00004a90: 2e61 7373 6572 7445 7175 616c 2873 6567  .assertEqual(seg
-00004aa0: 6d65 6e74 735b 315d 5b30 5d2e 7361 6d70  ments[1][0].samp
-00004ab0: 6c65 732c 2031 3932 3029 0a20 2020 2020  les, 1920).     
-00004ac0: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-00004ad0: 7561 6c28 7365 676d 656e 7473 5b31 5d5b  ual(segments[1][
-00004ae0: 305d 2e73 616d 706c 655f 7261 7465 2c20  0].sample_rate, 
-00004af0: 3438 3030 3029 0a0a 2020 2020 2020 2020  48000)..        
-00004b00: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-00004b10: 2873 6567 6d65 6e74 735b 315d 5b30 5d2e  (segments[1][0].
-00004b20: 6461 7461 2c20 6772 6169 6e30 2e64 6174  data, grain0.dat
-00004b30: 6129 0a0a 2020 2020 2020 2020 7365 6c66  a)..        self
-00004b40: 2e61 7373 6572 7445 7175 616c 2873 6567  .assertEqual(seg
-00004b50: 6d65 6e74 735b 315d 5b31 5d2e 736f 7572  ments[1][1].sour
-00004b60: 6365 5f69 642c 2073 7263 5f69 6429 0a20  ce_id, src_id). 
-00004b70: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00004b80: 7274 4571 7561 6c28 7365 676d 656e 7473  rtEqual(segments
-00004b90: 5b31 5d5b 315d 2e66 6c6f 775f 6964 2c20  [1][1].flow_id, 
-00004ba0: 666c 6f77 5f69 6429 0a20 2020 2020 2020  flow_id).       
-00004bb0: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-00004bc0: 6c28 7365 676d 656e 7473 5b31 5d5b 315d  l(segments[1][1]
-00004bd0: 2e67 7261 696e 5f74 7970 652c 2027 6175  .grain_type, 'au
-00004be0: 6469 6f27 290a 2020 2020 2020 2020 7365  dio').        se
-00004bf0: 6c66 2e61 7373 6572 7445 7175 616c 2873  lf.assertEqual(s
-00004c00: 6567 6d65 6e74 735b 315d 5b31 5d2e 666f  egments[1][1].fo
-00004c10: 726d 6174 2c20 436f 6741 7564 696f 466f  rmat, CogAudioFo
-00004c20: 726d 6174 2e53 3136 5f50 4c41 4e45 5329  rmat.S16_PLANES)
-00004c30: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-00004c40: 7365 7274 4571 7561 6c28 7365 676d 656e  sertEqual(segmen
-00004c50: 7473 5b31 5d5b 315d 2e73 616d 706c 6573  ts[1][1].samples
-00004c60: 2c20 3139 3230 290a 2020 2020 2020 2020  , 1920).        
+00000330: 7261 696e 7320 696d 706f 7274 2047 7261  rains import Gra
+00000340: 696e 4661 6374 6f72 7920 6173 2047 7261  inFactory as Gra
+00000350: 696e 0a66 726f 6d20 6d65 6469 6167 7261  in.from mediagra
+00000360: 696e 732e 6773 6620 696d 706f 7274 206c  ins.gsf import l
+00000370: 6f61 6473 2c20 6c6f 6164 2c20 6475 6d70  oads, load, dump
+00000380: 730a 6672 6f6d 206d 6564 6961 6772 6169  s.from mediagrai
+00000390: 6e73 2e67 7366 2069 6d70 6f72 7420 4753  ns.gsf import GS
+000003a0: 4645 6e63 6f64 6572 2c20 4753 4644 6563  FEncoder, GSFDec
+000003b0: 6f64 6572 2c20 5379 6e63 4753 4642 6c6f  oder, SyncGSFBlo
+000003c0: 636b 2c20 4173 796e 6347 5346 426c 6f63  ck, AsyncGSFBloc
+000003d0: 6b2c 2047 7261 696e 4461 7461 4c6f 6164  k, GrainDataLoad
+000003e0: 696e 674d 6f64 650a 6672 6f6d 206d 6564  ingMode.from med
+000003f0: 6961 6772 6169 6e73 2e67 7366 2069 6d70  iagrains.gsf imp
+00000400: 6f72 7420 4753 4644 6563 6f64 6545 7272  ort GSFDecodeErr
+00000410: 6f72 0a66 726f 6d20 6d65 6469 6167 7261  or.from mediagra
+00000420: 696e 732e 6773 6620 696d 706f 7274 2047  ins.gsf import G
+00000430: 5346 456e 636f 6465 4572 726f 720a 6672  SFEncodeError.fr
+00000440: 6f6d 206d 6564 6961 6772 6169 6e73 2e67  om mediagrains.g
+00000450: 7366 2069 6d70 6f72 7420 4753 4644 6563  sf import GSFDec
+00000460: 6f64 6542 6164 5665 7273 696f 6e45 7272  odeBadVersionErr
+00000470: 6f72 0a66 726f 6d20 6d65 6469 6167 7261  or.from mediagra
+00000480: 696e 732e 6773 6620 696d 706f 7274 2047  ins.gsf import G
+00000490: 5346 4465 636f 6465 4261 6446 696c 6554  SFDecodeBadFileT
+000004a0: 7970 6545 7272 6f72 0a66 726f 6d20 6d65  ypeError.from me
+000004b0: 6469 6167 7261 696e 732e 6773 6620 696d  diagrains.gsf im
+000004c0: 706f 7274 2047 5346 456e 636f 6465 4164  port GSFEncodeAd
+000004d0: 6454 6f41 6374 6976 6544 756d 700a 6672  dToActiveDump.fr
+000004e0: 6f6d 206d 6564 6961 6772 6169 6e73 2e63  om mediagrains.c
+000004f0: 6f6d 7061 7269 736f 6e20 696d 706f 7274  omparison import
+00000500: 2063 6f6d 7061 7265 5f67 7261 696e 2c20   compare_grain, 
+00000510: 636f 6d70 6172 655f 6772 6169 6e73 5f70  compare_grains_p
+00000520: 6169 7277 6973 650a 6672 6f6d 206d 6564  airwise.from med
+00000530: 6961 6772 6169 6e73 2e63 6f67 656e 756d  iagrains.cogenum
+00000540: 7320 696d 706f 7274 2043 6f67 4672 616d  s import CogFram
+00000550: 6546 6f72 6d61 742c 2043 6f67 4672 616d  eFormat, CogFram
+00000560: 654c 6179 6f75 742c 2043 6f67 4175 6469  eLayout, CogAudi
+00000570: 6f46 6f72 6d61 740a 6672 6f6d 206d 6564  oFormat.from med
+00000580: 6961 7469 6d65 7374 616d 702e 696d 6d75  iatimestamp.immu
+00000590: 7461 626c 6520 696d 706f 7274 2054 696d  table import Tim
+000005a0: 6573 7461 6d70 2c20 5469 6d65 4f66 6673  estamp, TimeOffs
+000005b0: 6574 0a66 726f 6d20 6461 7465 7469 6d65  et.from datetime
+000005c0: 2069 6d70 6f72 7420 6461 7465 7469 6d65   import datetime
+000005d0: 0a66 726f 6d20 6672 6163 7469 6f6e 7320  .from fractions 
+000005e0: 696d 706f 7274 2046 7261 6374 696f 6e0a  import Fraction.
+000005f0: 6672 6f6d 2069 6f20 696d 706f 7274 2042  from io import B
+00000600: 7974 6573 494f 0a66 726f 6d20 6d65 6469  ytesIO.from medi
+00000610: 6167 7261 696e 732e 7574 696c 732e 6173  agrains.utils.as
+00000620: 796e 6362 696e 6172 7969 6f20 696d 706f  yncbinaryio impo
+00000630: 7274 2041 7379 6e63 4279 7465 7349 4f0a  rt AsyncBytesIO.
+00000640: 6672 6f6d 2066 726f 7a65 6e64 6963 7420  from frozendict 
+00000650: 696d 706f 7274 2066 726f 7a65 6e64 6963  import frozendic
+00000660: 740a 6672 6f6d 206f 7320 696d 706f 7274  t.from os import
+00000670: 2053 4545 4b5f 5345 540a 696d 706f 7274   SEEK_SET.import
+00000680: 206a 736f 6e0a 0a66 726f 6d20 2e66 6978   json..from .fix
+00000690: 7475 7265 7320 696d 706f 7274 2073 7570  tures import sup
+000006a0: 7072 6573 735f 6465 7072 6563 6174 696f  press_deprecatio
+000006b0: 6e5f 7761 726e 696e 6773 0a0a 0a77 6974  n_warnings...wit
+000006c0: 6820 6f70 656e 2827 6578 616d 706c 6573  h open('examples
+000006d0: 2f76 6964 656f 5f38 2e67 7366 272c 2027  /video_8.gsf', '
+000006e0: 7262 2729 2061 7320 663a 0a20 2020 2056  rb') as f:.    V
+000006f0: 4944 454f 5f44 4154 415f 3820 3d20 662e  IDEO_DATA_8 = f.
+00000700: 7265 6164 2829 0a0a 7769 7468 206f 7065  read()..with ope
+00000710: 6e28 2765 7861 6d70 6c65 732f 636f 6465  n('examples/code
+00000720: 645f 7669 6465 6f5f 382e 6773 6627 2c20  d_video_8.gsf', 
+00000730: 2772 6227 2920 6173 2066 3a0a 2020 2020  'rb') as f:.    
+00000740: 434f 4445 445f 5649 4445 4f5f 4441 5441  CODED_VIDEO_DATA
+00000750: 5f38 203d 2066 2e72 6561 6428 290a 0a77  _8 = f.read()..w
+00000760: 6974 6820 6f70 656e 2827 6578 616d 706c  ith open('exampl
+00000770: 6573 2f61 7564 696f 5f38 2e67 7366 272c  es/audio_8.gsf',
+00000780: 2027 7262 2729 2061 7320 663a 0a20 2020   'rb') as f:.   
+00000790: 2041 5544 494f 5f44 4154 415f 3820 3d20   AUDIO_DATA_8 = 
+000007a0: 662e 7265 6164 2829 0a0a 7769 7468 206f  f.read()..with o
+000007b0: 7065 6e28 2765 7861 6d70 6c65 732f 636f  pen('examples/co
+000007c0: 6465 645f 6175 6469 6f5f 382e 6773 6627  ded_audio_8.gsf'
+000007d0: 2c20 2772 6227 2920 6173 2066 3a0a 2020  , 'rb') as f:.  
+000007e0: 2020 434f 4445 445f 4155 4449 4f5f 4441    CODED_AUDIO_DA
+000007f0: 5441 5f38 203d 2066 2e72 6561 6428 290a  TA_8 = f.read().
+00000800: 0a77 6974 6820 6f70 656e 2827 6578 616d  .with open('exam
+00000810: 706c 6573 2f65 7665 6e74 5f38 2e67 7366  ples/event_8.gsf
+00000820: 272c 2027 7262 2729 2061 7320 663a 0a20  ', 'rb') as f:. 
+00000830: 2020 2045 5645 4e54 5f44 4154 415f 3820     EVENT_DATA_8 
+00000840: 3d20 662e 7265 6164 2829 0a0a 7769 7468  = f.read()..with
+00000850: 206f 7065 6e28 2765 7861 6d70 6c65 732f   open('examples/
+00000860: 696e 7465 726c 6561 7665 645f 382e 6773  interleaved_8.gs
+00000870: 6627 2c20 2772 6227 2920 6173 2066 3a0a  f', 'rb') as f:.
+00000880: 2020 2020 494e 5445 524c 4541 5645 445f      INTERLEAVED_
+00000890: 4441 5441 5f38 203d 2066 2e72 6561 6428  DATA_8 = f.read(
+000008a0: 290a 0a77 6974 6820 6f70 656e 2827 6578  )..with open('ex
+000008b0: 616d 706c 6573 2f76 6964 656f 5f37 2e67  amples/video_7.g
+000008c0: 7366 272c 2027 7262 2729 2061 7320 663a  sf', 'rb') as f:
+000008d0: 0a20 2020 2056 4944 454f 5f44 4154 415f  .    VIDEO_DATA_
+000008e0: 3720 3d20 662e 7265 6164 2829 0a0a 7769  7 = f.read()..wi
+000008f0: 7468 206f 7065 6e28 2765 7861 6d70 6c65  th open('example
+00000900: 732f 636f 6465 645f 7669 6465 6f5f 372e  s/coded_video_7.
+00000910: 6773 6627 2c20 2772 6227 2920 6173 2066  gsf', 'rb') as f
+00000920: 3a0a 2020 2020 434f 4445 445f 5649 4445  :.    CODED_VIDE
+00000930: 4f5f 4441 5441 5f37 203d 2066 2e72 6561  O_DATA_7 = f.rea
+00000940: 6428 290a 0a77 6974 6820 6f70 656e 2827  d()..with open('
+00000950: 6578 616d 706c 6573 2f61 7564 696f 5f37  examples/audio_7
+00000960: 2e67 7366 272c 2027 7262 2729 2061 7320  .gsf', 'rb') as 
+00000970: 663a 0a20 2020 2041 5544 494f 5f44 4154  f:.    AUDIO_DAT
+00000980: 415f 3720 3d20 662e 7265 6164 2829 0a0a  A_7 = f.read()..
+00000990: 7769 7468 206f 7065 6e28 2765 7861 6d70  with open('examp
+000009a0: 6c65 732f 636f 6465 645f 6175 6469 6f5f  les/coded_audio_
+000009b0: 372e 6773 6627 2c20 2772 6227 2920 6173  7.gsf', 'rb') as
+000009c0: 2066 3a0a 2020 2020 434f 4445 445f 4155   f:.    CODED_AU
+000009d0: 4449 4f5f 4441 5441 5f37 203d 2066 2e72  DIO_DATA_7 = f.r
+000009e0: 6561 6428 290a 0a77 6974 6820 6f70 656e  ead()..with open
+000009f0: 2827 6578 616d 706c 6573 2f65 7665 6e74  ('examples/event
+00000a00: 5f37 2e67 7366 272c 2027 7262 2729 2061  _7.gsf', 'rb') a
+00000a10: 7320 663a 0a20 2020 2045 5645 4e54 5f44  s f:.    EVENT_D
+00000a20: 4154 415f 3720 3d20 662e 7265 6164 2829  ATA_7 = f.read()
+00000a30: 0a0a 7769 7468 206f 7065 6e28 2765 7861  ..with open('exa
+00000a40: 6d70 6c65 732f 696e 7465 726c 6561 7665  mples/interleave
+00000a50: 645f 372e 6773 6627 2c20 2772 6227 2920  d_7.gsf', 'rb') 
+00000a60: 6173 2066 3a0a 2020 2020 494e 5445 524c  as f:.    INTERL
+00000a70: 4541 5645 445f 4441 5441 5f37 203d 2066  EAVED_DATA_7 = f
+00000a80: 2e72 6561 6428 290a 0a0a 636c 6173 7320  .read()...class 
+00000a90: 5465 7374 4753 4644 756d 7073 2849 736f  TestGSFDumps(Iso
+00000aa0: 6c61 7465 6441 7379 6e63 696f 5465 7374  latedAsyncioTest
+00000ab0: 4361 7365 293a 0a20 2020 2064 6566 2074  Case):.    def t
+00000ac0: 6573 745f 6475 6d70 735f 6e6f 5f67 7261  est_dumps_no_gra
+00000ad0: 696e 7328 7365 6c66 293a 0a20 2020 2020  ins(self):.     
+00000ae0: 2020 2075 7569 6473 203d 205b 5555 4944     uuids = [UUID
+00000af0: 2827 3739 3230 6233 3934 2d31 3536 352d  ('7920b394-1565-
+00000b00: 3131 6538 2d38 3665 302d 3862 3432 6434  11e8-86e0-8b42d4
+00000b10: 3634 3762 6138 2729 2c20 5555 4944 2827  647ba8'), UUID('
+00000b20: 3830 6166 3837 3563 2d31 3536 352d 3131  80af875c-1565-11
+00000b30: 6538 2d38 6634 342d 3837 6566 3038 3162  e8-8f44-87ef081b
+00000b40: 3438 6364 2729 5d0a 2020 2020 2020 2020  48cd')].        
+00000b50: 6372 6561 7465 6420 3d20 6461 7465 7469  created = dateti
+00000b60: 6d65 2831 3938 332c 2033 2c20 3239 2c20  me(1983, 3, 29, 
+00000b70: 3135 2c20 3135 290a 2020 2020 2020 2020  15, 15).        
+00000b80: 7769 7468 206d 6f63 6b2e 7061 7463 6828  with mock.patch(
+00000b90: 276d 6564 6961 6772 6169 6e73 2e67 7366  'mediagrains.gsf
+00000ba0: 2e64 6174 6574 696d 6527 2c20 7369 6465  .datetime', side
+00000bb0: 5f65 6666 6563 743d 6461 7465 7469 6d65  _effect=datetime
+00000bc0: 2c20 6e6f 773d 6d6f 636b 2e4d 6167 6963  , now=mock.Magic
+00000bd0: 4d6f 636b 2872 6574 7572 6e5f 7661 6c75  Mock(return_valu
+00000be0: 653d 6372 6561 7465 6429 293a 0a20 2020  e=created)):.   
+00000bf0: 2020 2020 2020 2020 2077 6974 6820 6d6f           with mo
+00000c00: 636b 2e70 6174 6368 2827 6d65 6469 6167  ck.patch('mediag
+00000c10: 7261 696e 732e 6773 662e 7575 6964 3127  rains.gsf.uuid1'
+00000c20: 2c20 7369 6465 5f65 6666 6563 743d 7575  , side_effect=uu
+00000c30: 6964 7329 3a0a 2020 2020 2020 2020 2020  ids):.          
+00000c40: 2020 2020 2020 2868 6561 642c 2073 6567        (head, seg
+00000c50: 6d65 6e74 7329 203d 206c 6f61 6473 2864  ments) = loads(d
+00000c60: 756d 7073 285b 5d2c 2074 6167 733d 5b28  umps([], tags=[(
+00000c70: 2770 6f74 6174 6f27 2c20 2768 6172 7665  'potato', 'harve
+00000c80: 7374 2729 5d2c 2073 6567 6d65 6e74 5f74  st')], segment_t
+00000c90: 6167 733d 5b28 2775 7073 6964 6527 2c20  ags=[('upside', 
+00000ca0: 2764 6f77 6e27 295d 2929 0a0a 2020 2020  'down')]))..    
+00000cb0: 2020 2020 7365 6c66 2e61 7373 6572 7449      self.assertI
+00000cc0: 6e28 2769 6427 2c20 6865 6164 290a 2020  n('id', head).  
+00000cd0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00000ce0: 7449 6e28 6865 6164 5b27 6964 275d 2c20  tIn(head['id'], 
+00000cf0: 7575 6964 7329 0a20 2020 2020 2020 2073  uuids).        s
+00000d00: 656c 662e 6173 7365 7274 496e 2827 7461  elf.assertIn('ta
+00000d10: 6773 272c 2068 6561 6429 0a20 2020 2020  gs', head).     
+00000d20: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+00000d30: 7561 6c28 6865 6164 5b27 7461 6773 275d  ual(head['tags']
+00000d40: 2c20 5b28 2770 6f74 6174 6f27 2c20 2768  , [('potato', 'h
+00000d50: 6172 7665 7374 2729 5d29 0a20 2020 2020  arvest')]).     
+00000d60: 2020 2073 656c 662e 6173 7365 7274 496e     self.assertIn
+00000d70: 2827 6372 6561 7465 6427 2c20 6865 6164  ('created', head
+00000d80: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+00000d90: 7373 6572 7445 7175 616c 2868 6561 645b  ssertEqual(head[
+00000da0: 2763 7265 6174 6564 275d 2c20 6372 6561  'created'], crea
+00000db0: 7465 6429 0a20 2020 2020 2020 2073 656c  ted).        sel
+00000dc0: 662e 6173 7365 7274 496e 2827 7365 676d  f.assertIn('segm
+00000dd0: 656e 7473 272c 2068 6561 6429 0a20 2020  ents', head).   
+00000de0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00000df0: 4571 7561 6c28 6c65 6e28 6865 6164 5b27  Equal(len(head['
+00000e00: 7365 676d 656e 7473 275d 292c 2031 290a  segments']), 1).
+00000e10: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+00000e20: 6572 7449 6e28 2763 6f75 6e74 272c 2068  ertIn('count', h
+00000e30: 6561 645b 2773 6567 6d65 6e74 7327 5d5b  ead['segments'][
+00000e40: 305d 290a 2020 2020 2020 2020 7365 6c66  0]).        self
+00000e50: 2e61 7373 6572 7445 7175 616c 2868 6561  .assertEqual(hea
+00000e60: 645b 2773 6567 6d65 6e74 7327 5d5b 305d  d['segments'][0]
+00000e70: 5b27 636f 756e 7427 5d2c 2030 290a 2020  ['count'], 0).  
+00000e80: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00000e90: 7449 6e28 276c 6f63 616c 5f69 6427 2c20  tIn('local_id', 
+00000ea0: 6865 6164 5b27 7365 676d 656e 7473 275d  head['segments']
+00000eb0: 5b30 5d29 0a20 2020 2020 2020 2073 656c  [0]).        sel
+00000ec0: 662e 6173 7365 7274 4571 7561 6c28 6865  f.assertEqual(he
+00000ed0: 6164 5b27 7365 676d 656e 7473 275d 5b30  ad['segments'][0
+00000ee0: 5d5b 276c 6f63 616c 5f69 6427 5d2c 2031  ]['local_id'], 1
+00000ef0: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+00000f00: 7373 6572 7449 6e28 2769 6427 2c20 6865  ssertIn('id', he
+00000f10: 6164 5b27 7365 676d 656e 7473 275d 5b30  ad['segments'][0
+00000f20: 5d29 0a20 2020 2020 2020 2073 656c 662e  ]).        self.
+00000f30: 6173 7365 7274 496e 2868 6561 645b 2773  assertIn(head['s
+00000f40: 6567 6d65 6e74 7327 5d5b 305d 5b27 6964  egments'][0]['id
+00000f50: 275d 2c20 7575 6964 7329 0a20 2020 2020  '], uuids).     
+00000f60: 2020 2073 656c 662e 6173 7365 7274 4e6f     self.assertNo
+00000f70: 7449 6e28 6865 6164 5b27 7365 676d 656e  tIn(head['segmen
+00000f80: 7473 275d 5b30 5d5b 2769 6427 5d2c 205b  ts'][0]['id'], [
+00000f90: 6865 6164 5b27 6964 275d 5d29 0a20 2020  head['id']]).   
+00000fa0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00000fb0: 496e 2827 7461 6773 272c 2068 6561 645b  In('tags', head[
+00000fc0: 2773 6567 6d65 6e74 7327 5d5b 305d 290a  'segments'][0]).
+00000fd0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+00000fe0: 6572 7445 7175 616c 2868 6561 645b 2773  ertEqual(head['s
+00000ff0: 6567 6d65 6e74 7327 5d5b 305d 5b27 7461  egments'][0]['ta
+00001000: 6773 275d 2c20 5b28 2775 7073 6964 6527  gs'], [('upside'
+00001010: 2c20 2764 6f77 6e27 295d 290a 0a20 2020  , 'down')])..   
+00001020: 2020 2020 2069 6620 6c65 6e28 7365 676d       if len(segm
+00001030: 656e 7473 2920 3e20 303a 0a20 2020 2020  ents) > 0:.     
+00001040: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+00001050: 7274 4571 7561 6c28 6c65 6e28 7365 676d  rtEqual(len(segm
+00001060: 656e 7473 292c 2031 290a 2020 2020 2020  ents), 1).      
+00001070: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00001080: 7449 6e28 312c 2073 6567 6d65 6e74 7329  tIn(1, segments)
+00001090: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+000010a0: 662e 6173 7365 7274 4571 7561 6c28 6c65  f.assertEqual(le
+000010b0: 6e28 7365 676d 656e 7473 5b31 5d29 2c20  n(segments[1]), 
+000010c0: 3029 0a0a 2020 2020 6173 796e 6320 6465  0)..    async de
+000010d0: 6620 7465 7374 5f61 7379 6e63 5f65 6e63  f test_async_enc
+000010e0: 6f64 655f 6e6f 5f67 7261 696e 7328 7365  ode_no_grains(se
+000010f0: 6c66 293a 0a20 2020 2020 2020 2075 7569  lf):.        uui
+00001100: 6473 203d 205b 5555 4944 2827 3739 3230  ds = [UUID('7920
+00001110: 6233 3934 2d31 3536 352d 3131 6538 2d38  b394-1565-11e8-8
+00001120: 3665 302d 3862 3432 6434 3634 3762 6138  6e0-8b42d4647ba8
+00001130: 2729 2c20 5555 4944 2827 3830 6166 3837  '), UUID('80af87
+00001140: 3563 2d31 3536 352d 3131 6538 2d38 6634  5c-1565-11e8-8f4
+00001150: 342d 3837 6566 3038 3162 3438 6364 2729  4-87ef081b48cd')
+00001160: 5d0a 2020 2020 2020 2020 6372 6561 7465  ].        create
+00001170: 6420 3d20 6461 7465 7469 6d65 2831 3938  d = datetime(198
+00001180: 332c 2033 2c20 3239 2c20 3135 2c20 3135  3, 3, 29, 15, 15
+00001190: 290a 2020 2020 2020 2020 7769 7468 206d  ).        with m
+000011a0: 6f63 6b2e 7061 7463 6828 276d 6564 6961  ock.patch('media
+000011b0: 6772 6169 6e73 2e67 7366 2e64 6174 6574  grains.gsf.datet
+000011c0: 696d 6527 2c20 7369 6465 5f65 6666 6563  ime', side_effec
+000011d0: 743d 6461 7465 7469 6d65 2c20 6e6f 773d  t=datetime, now=
+000011e0: 6d6f 636b 2e4d 6167 6963 4d6f 636b 2872  mock.MagicMock(r
+000011f0: 6574 7572 6e5f 7661 6c75 653d 6372 6561  eturn_value=crea
+00001200: 7465 6429 293a 0a20 2020 2020 2020 2020  ted)):.         
+00001210: 2020 2077 6974 6820 6d6f 636b 2e70 6174     with mock.pat
+00001220: 6368 2827 6d65 6469 6167 7261 696e 732e  ch('mediagrains.
+00001230: 6773 662e 7575 6964 3127 2c20 7369 6465  gsf.uuid1', side
+00001240: 5f65 6666 6563 743d 7575 6964 7329 3a0a  _effect=uuids):.
+00001250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001260: 6620 3d20 4279 7465 7349 4f28 290a 2020  f = BytesIO().  
+00001270: 2020 2020 2020 2020 2020 2020 2020 6173                as
+00001280: 796e 6320 7769 7468 2047 5346 456e 636f  ync with GSFEnco
+00001290: 6465 7228 662c 0a20 2020 2020 2020 2020  der(f,.         
+000012a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000012b0: 2020 2020 2020 2020 2020 2020 2074 6167               tag
+000012c0: 733d 5b28 2770 6f74 6174 6f27 2c20 2768  s=[('potato', 'h
+000012d0: 6172 7665 7374 2729 5d2c 0a20 2020 2020  arvest')],.     
+000012e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000012f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001300: 2073 6567 6d65 6e74 733d 5b7b 2774 6167   segments=[{'tag
+00001310: 7327 3a20 5b28 2775 7073 6964 6527 2c20  s': [('upside', 
+00001320: 2764 6f77 6e27 295d 7d5d 293a 0a20 2020  'down')]}]):.   
+00001330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001340: 2070 6173 730a 2020 2020 2020 2020 2020   pass.          
+00001350: 2020 2020 2020 2868 6561 642c 2073 6567        (head, seg
+00001360: 6d65 6e74 7329 203d 206c 6f61 6473 2866  ments) = loads(f
+00001370: 2e67 6574 7661 6c75 6528 2929 0a0a 2020  .getvalue())..  
+00001380: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00001390: 7449 6e28 2769 6427 2c20 6865 6164 290a  tIn('id', head).
+000013a0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+000013b0: 6572 7449 6e28 6865 6164 5b27 6964 275d  ertIn(head['id']
+000013c0: 2c20 7575 6964 7329 0a20 2020 2020 2020  , uuids).       
+000013d0: 2073 656c 662e 6173 7365 7274 496e 2827   self.assertIn('
+000013e0: 7461 6773 272c 2068 6561 6429 0a20 2020  tags', head).   
+000013f0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00001400: 4571 7561 6c28 6865 6164 5b27 7461 6773  Equal(head['tags
+00001410: 275d 2c20 5b28 2770 6f74 6174 6f27 2c20  '], [('potato', 
+00001420: 2768 6172 7665 7374 2729 5d29 0a20 2020  'harvest')]).   
+00001430: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00001440: 496e 2827 6372 6561 7465 6427 2c20 6865  In('created', he
+00001450: 6164 290a 2020 2020 2020 2020 7365 6c66  ad).        self
+00001460: 2e61 7373 6572 7445 7175 616c 2868 6561  .assertEqual(hea
+00001470: 645b 2763 7265 6174 6564 275d 2c20 6372  d['created'], cr
+00001480: 6561 7465 6429 0a20 2020 2020 2020 2073  eated).        s
+00001490: 656c 662e 6173 7365 7274 496e 2827 7365  elf.assertIn('se
+000014a0: 676d 656e 7473 272c 2068 6561 6429 0a20  gments', head). 
+000014b0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+000014c0: 7274 4571 7561 6c28 6c65 6e28 6865 6164  rtEqual(len(head
+000014d0: 5b27 7365 676d 656e 7473 275d 292c 2031  ['segments']), 1
+000014e0: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+000014f0: 7373 6572 7449 6e28 2763 6f75 6e74 272c  ssertIn('count',
+00001500: 2068 6561 645b 2773 6567 6d65 6e74 7327   head['segments'
+00001510: 5d5b 305d 290a 2020 2020 2020 2020 7365  ][0]).        se
+00001520: 6c66 2e61 7373 6572 7445 7175 616c 2868  lf.assertEqual(h
+00001530: 6561 645b 2773 6567 6d65 6e74 7327 5d5b  ead['segments'][
+00001540: 305d 5b27 636f 756e 7427 5d2c 2030 290a  0]['count'], 0).
+00001550: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+00001560: 6572 7449 6e28 276c 6f63 616c 5f69 6427  ertIn('local_id'
+00001570: 2c20 6865 6164 5b27 7365 676d 656e 7473  , head['segments
+00001580: 275d 5b30 5d29 0a20 2020 2020 2020 2073  '][0]).        s
+00001590: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+000015a0: 6865 6164 5b27 7365 676d 656e 7473 275d  head['segments']
+000015b0: 5b30 5d5b 276c 6f63 616c 5f69 6427 5d2c  [0]['local_id'],
+000015c0: 2031 290a 2020 2020 2020 2020 7365 6c66   1).        self
+000015d0: 2e61 7373 6572 7449 6e28 2769 6427 2c20  .assertIn('id', 
+000015e0: 6865 6164 5b27 7365 676d 656e 7473 275d  head['segments']
+000015f0: 5b30 5d29 0a20 2020 2020 2020 2073 656c  [0]).        sel
+00001600: 662e 6173 7365 7274 496e 2868 6561 645b  f.assertIn(head[
+00001610: 2773 6567 6d65 6e74 7327 5d5b 305d 5b27  'segments'][0]['
+00001620: 6964 275d 2c20 7575 6964 7329 0a20 2020  id'], uuids).   
+00001630: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00001640: 4e6f 7449 6e28 6865 6164 5b27 7365 676d  NotIn(head['segm
+00001650: 656e 7473 275d 5b30 5d5b 2769 6427 5d2c  ents'][0]['id'],
+00001660: 205b 6865 6164 5b27 6964 275d 5d29 0a20   [head['id']]). 
+00001670: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+00001680: 7274 496e 2827 7461 6773 272c 2068 6561  rtIn('tags', hea
+00001690: 645b 2773 6567 6d65 6e74 7327 5d5b 305d  d['segments'][0]
+000016a0: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+000016b0: 7373 6572 7445 7175 616c 2868 6561 645b  ssertEqual(head[
+000016c0: 2773 6567 6d65 6e74 7327 5d5b 305d 5b27  'segments'][0]['
+000016d0: 7461 6773 275d 2c20 5b28 2775 7073 6964  tags'], [('upsid
+000016e0: 6527 2c20 2764 6f77 6e27 295d 290a 0a20  e', 'down')]).. 
+000016f0: 2020 2020 2020 2069 6620 6c65 6e28 7365         if len(se
+00001700: 676d 656e 7473 2920 3e20 303a 0a20 2020  gments) > 0:.   
+00001710: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
+00001720: 7365 7274 4571 7561 6c28 6c65 6e28 7365  sertEqual(len(se
+00001730: 676d 656e 7473 292c 2031 290a 2020 2020  gments), 1).    
+00001740: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+00001750: 6572 7449 6e28 312c 2073 6567 6d65 6e74  ertIn(1, segment
+00001760: 7329 0a20 2020 2020 2020 2020 2020 2073  s).            s
+00001770: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+00001780: 6c65 6e28 7365 676d 656e 7473 5b31 5d29  len(segments[1])
+00001790: 2c20 3029 0a0a 2020 2020 6465 6620 7465  , 0)..    def te
+000017a0: 7374 5f64 756d 7073 5f76 6964 656f 6772  st_dumps_videogr
+000017b0: 6169 6e28 7365 6c66 293a 0a20 2020 2020  ain(self):.     
+000017c0: 2020 2073 7263 5f69 6420 3d20 5555 4944     src_id = UUID
+000017d0: 2827 6531 3465 3964 3538 2d31 3536 372d  ('e14e9d58-1567-
+000017e0: 3131 6538 2d38 6464 332d 3833 3161 3036  11e8-8dd3-831a06
+000017f0: 3865 6230 3334 2729 0a20 2020 2020 2020  8eb034').       
+00001800: 2066 6c6f 775f 6964 203d 2055 5549 4428   flow_id = UUID(
+00001810: 2765 6531 6565 6435 382d 3135 3637 2d31  'ee1eed58-1567-1
+00001820: 3165 382d 6139 3731 2d33 6239 3031 6132  1e8-a971-3b901a2
+00001830: 6464 3861 6227 290a 2020 2020 2020 2020  dd8ab').        
+00001840: 6772 6169 6e20 3d20 5669 6465 6f47 7261  grain = VideoGra
+00001850: 696e 2873 7263 5f69 643d 7372 635f 6964  in(src_id=src_id
+00001860: 2c20 666c 6f77 5f69 643d 666c 6f77 5f69  , flow_id=flow_i
+00001870: 642c 2063 6f67 5f66 7261 6d65 5f66 6f72  d, cog_frame_for
+00001880: 6d61 743d 436f 6746 7261 6d65 466f 726d  mat=CogFrameForm
+00001890: 6174 2e53 3136 5f34 3232 5f31 3042 4954  at.S16_422_10BIT
+000018a0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+000018b0: 2020 2020 2020 2020 2020 2020 2077 6964               wid
+000018c0: 7468 3d31 3932 302c 2068 6569 6768 743d  th=1920, height=
+000018d0: 3130 3830 290a 2020 2020 2020 2020 666f  1080).        fo
+000018e0: 7220 6920 696e 2072 616e 6765 2830 2c20  r i in range(0, 
+000018f0: 6c65 6e28 6772 6169 6e2e 6461 7461 2929  len(grain.data))
+00001900: 3a0a 2020 2020 2020 2020 2020 2020 6772  :.            gr
+00001910: 6169 6e2e 6461 7461 5b69 5d20 3d20 6920  ain.data[i] = i 
+00001920: 2620 3078 4646 0a20 2020 2020 2020 2067  & 0xFF.        g
+00001930: 7261 696e 2e73 6f75 7263 655f 6173 7065  rain.source_aspe
+00001940: 6374 5f72 6174 696f 203d 2046 7261 6374  ct_ratio = Fract
+00001950: 696f 6e28 3136 2c20 3929 0a20 2020 2020  ion(16, 9).     
+00001960: 2020 2067 7261 696e 2e70 6978 656c 5f61     grain.pixel_a
+00001970: 7370 6563 745f 7261 7469 6f20 3d20 310a  spect_ratio = 1.
+00001980: 2020 2020 2020 2020 7575 6964 7320 3d20          uuids = 
+00001990: 5b55 5549 4428 2737 3932 3062 3339 342d  [UUID('7920b394-
+000019a0: 3135 3635 2d31 3165 382d 3836 6530 2d38  1565-11e8-86e0-8
+000019b0: 6234 3264 3436 3437 6261 3827 292c 0a20  b42d4647ba8'),. 
+000019c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000019d0: 5555 4944 2827 3830 6166 3837 3563 2d31  UUID('80af875c-1
+000019e0: 3536 352d 3131 6538 2d38 6634 342d 3837  565-11e8-8f44-87
+000019f0: 6566 3038 3162 3438 6364 2729 5d0a 2020  ef081b48cd')].  
+00001a00: 2020 2020 2020 6372 6561 7465 6420 3d20        created = 
+00001a10: 6461 7465 7469 6d65 2831 3938 332c 2033  datetime(1983, 3
+00001a20: 2c20 3239 2c20 3135 2c20 3135 290a 2020  , 29, 15, 15).  
+00001a30: 2020 2020 2020 7769 7468 206d 6f63 6b2e        with mock.
+00001a40: 7061 7463 6828 276d 6564 6961 6772 6169  patch('mediagrai
+00001a50: 6e73 2e67 7366 2e64 6174 6574 696d 6527  ns.gsf.datetime'
+00001a60: 2c20 7369 6465 5f65 6666 6563 743d 6461  , side_effect=da
+00001a70: 7465 7469 6d65 2c20 6e6f 773d 6d6f 636b  tetime, now=mock
+00001a80: 2e4d 6167 6963 4d6f 636b 2872 6574 7572  .MagicMock(retur
+00001a90: 6e5f 7661 6c75 653d 6372 6561 7465 6429  n_value=created)
+00001aa0: 293a 0a20 2020 2020 2020 2020 2020 2077  ):.            w
+00001ab0: 6974 6820 6d6f 636b 2e70 6174 6368 2827  ith mock.patch('
+00001ac0: 6d65 6469 6167 7261 696e 732e 6773 662e  mediagrains.gsf.
+00001ad0: 7575 6964 3127 2c20 7369 6465 5f65 6666  uuid1', side_eff
+00001ae0: 6563 743d 7575 6964 7329 3a0a 2020 2020  ect=uuids):.    
+00001af0: 2020 2020 2020 2020 2020 2020 2868 6561              (hea
+00001b00: 642c 2073 6567 6d65 6e74 7329 203d 206c  d, segments) = l
+00001b10: 6f61 6473 2864 756d 7073 285b 6772 6169  oads(dumps([grai
+00001b20: 6e5d 2929 0a0a 2020 2020 2020 2020 7365  n]))..        se
+00001b30: 6c66 2e61 7373 6572 7449 6e28 2769 6427  lf.assertIn('id'
+00001b40: 2c20 6865 6164 290a 2020 2020 2020 2020  , head).        
+00001b50: 7365 6c66 2e61 7373 6572 7449 6e28 6865  self.assertIn(he
+00001b60: 6164 5b27 6964 275d 2c20 7575 6964 7329  ad['id'], uuids)
+00001b70: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+00001b80: 7365 7274 496e 2827 7461 6773 272c 2068  sertIn('tags', h
+00001b90: 6561 6429 0a20 2020 2020 2020 2073 656c  ead).        sel
+00001ba0: 662e 6173 7365 7274 4571 7561 6c28 6c65  f.assertEqual(le
+00001bb0: 6e28 6865 6164 5b27 7461 6773 275d 292c  n(head['tags']),
+00001bc0: 2030 290a 2020 2020 2020 2020 7365 6c66   0).        self
+00001bd0: 2e61 7373 6572 7449 6e28 2763 7265 6174  .assertIn('creat
+00001be0: 6564 272c 2068 6561 6429 0a20 2020 2020  ed', head).     
+00001bf0: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+00001c00: 7561 6c28 6865 6164 5b27 6372 6561 7465  ual(head['create
+00001c10: 6427 5d2c 2063 7265 6174 6564 290a 2020  d'], created).  
+00001c20: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00001c30: 7449 6e28 2773 6567 6d65 6e74 7327 2c20  tIn('segments', 
+00001c40: 6865 6164 290a 2020 2020 2020 2020 7365  head).        se
+00001c50: 6c66 2e61 7373 6572 7445 7175 616c 286c  lf.assertEqual(l
+00001c60: 656e 2868 6561 645b 2773 6567 6d65 6e74  en(head['segment
+00001c70: 7327 5d29 2c20 3129 0a20 2020 2020 2020  s']), 1).       
+00001c80: 2073 656c 662e 6173 7365 7274 496e 2827   self.assertIn('
+00001c90: 636f 756e 7427 2c20 6865 6164 5b27 7365  count', head['se
+00001ca0: 676d 656e 7473 275d 5b30 5d29 0a20 2020  gments'][0]).   
+00001cb0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00001cc0: 4571 7561 6c28 6865 6164 5b27 7365 676d  Equal(head['segm
+00001cd0: 656e 7473 275d 5b30 5d5b 2763 6f75 6e74  ents'][0]['count
+00001ce0: 275d 2c20 3129 0a20 2020 2020 2020 2073  '], 1).        s
+00001cf0: 656c 662e 6173 7365 7274 496e 2827 6c6f  elf.assertIn('lo
+00001d00: 6361 6c5f 6964 272c 2068 6561 645b 2773  cal_id', head['s
+00001d10: 6567 6d65 6e74 7327 5d5b 305d 290a 2020  egments'][0]).  
+00001d20: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00001d30: 7445 7175 616c 2868 6561 645b 2773 6567  tEqual(head['seg
+00001d40: 6d65 6e74 7327 5d5b 305d 5b27 6c6f 6361  ments'][0]['loca
+00001d50: 6c5f 6964 275d 2c20 3129 0a20 2020 2020  l_id'], 1).     
+00001d60: 2020 2073 656c 662e 6173 7365 7274 496e     self.assertIn
+00001d70: 2827 6964 272c 2068 6561 645b 2773 6567  ('id', head['seg
+00001d80: 6d65 6e74 7327 5d5b 305d 290a 2020 2020  ments'][0]).    
+00001d90: 2020 2020 7365 6c66 2e61 7373 6572 7449      self.assertI
+00001da0: 6e28 6865 6164 5b27 7365 676d 656e 7473  n(head['segments
+00001db0: 275d 5b30 5d5b 2769 6427 5d2c 2075 7569  '][0]['id'], uui
+00001dc0: 6473 290a 2020 2020 2020 2020 7365 6c66  ds).        self
+00001dd0: 2e61 7373 6572 7449 6e28 2774 6167 7327  .assertIn('tags'
+00001de0: 2c20 6865 6164 5b27 7365 676d 656e 7473  , head['segments
+00001df0: 275d 5b30 5d29 0a20 2020 2020 2020 2073  '][0]).        s
+00001e00: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+00001e10: 6c65 6e28 6865 6164 5b27 7365 676d 656e  len(head['segmen
+00001e20: 7473 275d 5b30 5d5b 2774 6167 7327 5d29  ts'][0]['tags'])
+00001e30: 2c20 3029 0a0a 2020 2020 2020 2020 7365  , 0)..        se
+00001e40: 6c66 2e61 7373 6572 7445 7175 616c 286c  lf.assertEqual(l
+00001e50: 656e 2873 6567 6d65 6e74 7329 2c20 3129  en(segments), 1)
+00001e60: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+00001e70: 7365 7274 496e 2831 2c20 7365 676d 656e  sertIn(1, segmen
+00001e80: 7473 290a 2020 2020 2020 2020 7365 6c66  ts).        self
+00001e90: 2e61 7373 6572 7445 7175 616c 286c 656e  .assertEqual(len
+00001ea0: 2873 6567 6d65 6e74 735b 315d 292c 2068  (segments[1]), h
+00001eb0: 6561 645b 2773 6567 6d65 6e74 7327 5d5b  ead['segments'][
+00001ec0: 305d 5b27 636f 756e 7427 5d29 0a0a 2020  0]['count'])..  
+00001ed0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00001ee0: 7445 7175 616c 2873 6567 6d65 6e74 735b  tEqual(segments[
+00001ef0: 315d 5b30 5d2e 736f 7572 6365 5f69 642c  1][0].source_id,
+00001f00: 2073 7263 5f69 6429 0a20 2020 2020 2020   src_id).       
+00001f10: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+00001f20: 6c28 7365 676d 656e 7473 5b31 5d5b 305d  l(segments[1][0]
+00001f30: 2e66 6c6f 775f 6964 2c20 666c 6f77 5f69  .flow_id, flow_i
+00001f40: 6429 0a20 2020 2020 2020 2073 656c 662e  d).        self.
+00001f50: 6173 7365 7274 4571 7561 6c28 7365 676d  assertEqual(segm
+00001f60: 656e 7473 5b31 5d5b 305d 2e67 7261 696e  ents[1][0].grain
+00001f70: 5f74 7970 652c 2027 7669 6465 6f27 290a  _type, 'video').
+00001f80: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+00001f90: 6572 7445 7175 616c 2873 6567 6d65 6e74  ertEqual(segment
+00001fa0: 735b 315d 5b30 5d2e 636f 675f 6672 616d  s[1][0].cog_fram
+00001fb0: 655f 666f 726d 6174 2c20 436f 6746 7261  e_format, CogFra
+00001fc0: 6d65 466f 726d 6174 2e53 3136 5f34 3232  meFormat.S16_422
+00001fd0: 5f31 3042 4954 290a 2020 2020 2020 2020  _10BIT).        
+00001fe0: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+00001ff0: 2873 6567 6d65 6e74 735b 315d 5b30 5d2e  (segments[1][0].
+00002000: 7769 6474 682c 2031 3932 3029 0a20 2020  width, 1920).   
+00002010: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00002020: 4571 7561 6c28 7365 676d 656e 7473 5b31  Equal(segments[1
+00002030: 5d5b 305d 2e68 6569 6768 742c 2031 3038  ][0].height, 108
+00002040: 3029 0a20 2020 2020 2020 2073 656c 662e  0).        self.
+00002050: 6173 7365 7274 4571 7561 6c28 7365 676d  assertEqual(segm
+00002060: 656e 7473 5b31 5d5b 305d 2e73 6f75 7263  ents[1][0].sourc
+00002070: 655f 6173 7065 6374 5f72 6174 696f 2c20  e_aspect_ratio, 
+00002080: 4672 6163 7469 6f6e 2831 362c 2039 2929  Fraction(16, 9))
+00002090: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+000020a0: 7365 7274 4571 7561 6c28 7365 676d 656e  sertEqual(segmen
+000020b0: 7473 5b31 5d5b 305d 2e70 6978 656c 5f61  ts[1][0].pixel_a
+000020c0: 7370 6563 745f 7261 7469 6f2c 2046 7261  spect_ratio, Fra
+000020d0: 6374 696f 6e28 312c 2031 2929 0a0a 2020  ction(1, 1))..  
+000020e0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+000020f0: 7445 7175 616c 2873 6567 6d65 6e74 735b  tEqual(segments[
+00002100: 315d 5b30 5d2e 6461 7461 2c20 6772 6169  1][0].data, grai
+00002110: 6e2e 6461 7461 290a 0a20 2020 2061 7379  n.data)..    asy
+00002120: 6e63 2064 6566 2074 6573 745f 6173 796e  nc def test_asyn
+00002130: 635f 656e 636f 6465 5f76 6964 656f 6772  c_encode_videogr
+00002140: 6169 6e28 7365 6c66 293a 0a20 2020 2020  ain(self):.     
+00002150: 2020 2073 7263 5f69 6420 3d20 5555 4944     src_id = UUID
+00002160: 2827 6531 3465 3964 3538 2d31 3536 372d  ('e14e9d58-1567-
+00002170: 3131 6538 2d38 6464 332d 3833 3161 3036  11e8-8dd3-831a06
+00002180: 3865 6230 3334 2729 0a20 2020 2020 2020  8eb034').       
+00002190: 2066 6c6f 775f 6964 203d 2055 5549 4428   flow_id = UUID(
+000021a0: 2765 6531 6565 6435 382d 3135 3637 2d31  'ee1eed58-1567-1
+000021b0: 3165 382d 6139 3731 2d33 6239 3031 6132  1e8-a971-3b901a2
+000021c0: 6464 3861 6227 290a 2020 2020 2020 2020  dd8ab').        
+000021d0: 6772 6169 6e20 3d20 5669 6465 6f47 7261  grain = VideoGra
+000021e0: 696e 2873 7263 5f69 643d 7372 635f 6964  in(src_id=src_id
+000021f0: 2c20 666c 6f77 5f69 643d 666c 6f77 5f69  , flow_id=flow_i
+00002200: 642c 2063 6f67 5f66 7261 6d65 5f66 6f72  d, cog_frame_for
+00002210: 6d61 743d 436f 6746 7261 6d65 466f 726d  mat=CogFrameForm
+00002220: 6174 2e53 3136 5f34 3232 5f31 3042 4954  at.S16_422_10BIT
+00002230: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00002240: 2020 2020 2020 2020 2020 2020 2077 6964               wid
+00002250: 7468 3d31 3932 302c 2068 6569 6768 743d  th=1920, height=
+00002260: 3130 3830 290a 2020 2020 2020 2020 666f  1080).        fo
+00002270: 7220 6920 696e 2072 616e 6765 2830 2c20  r i in range(0, 
+00002280: 6c65 6e28 6772 6169 6e2e 6461 7461 2929  len(grain.data))
+00002290: 3a0a 2020 2020 2020 2020 2020 2020 6772  :.            gr
+000022a0: 6169 6e2e 6461 7461 5b69 5d20 3d20 6920  ain.data[i] = i 
+000022b0: 2620 3078 4646 0a20 2020 2020 2020 2067  & 0xFF.        g
+000022c0: 7261 696e 2e73 6f75 7263 655f 6173 7065  rain.source_aspe
+000022d0: 6374 5f72 6174 696f 203d 2046 7261 6374  ct_ratio = Fract
+000022e0: 696f 6e28 3136 2c20 3929 0a20 2020 2020  ion(16, 9).     
+000022f0: 2020 2067 7261 696e 2e70 6978 656c 5f61     grain.pixel_a
+00002300: 7370 6563 745f 7261 7469 6f20 3d20 310a  spect_ratio = 1.
+00002310: 2020 2020 2020 2020 7575 6964 7320 3d20          uuids = 
+00002320: 5b55 5549 4428 2737 3932 3062 3339 342d  [UUID('7920b394-
+00002330: 3135 3635 2d31 3165 382d 3836 6530 2d38  1565-11e8-86e0-8
+00002340: 6234 3264 3436 3437 6261 3827 292c 0a20  b42d4647ba8'),. 
+00002350: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002360: 5555 4944 2827 3830 6166 3837 3563 2d31  UUID('80af875c-1
+00002370: 3536 352d 3131 6538 2d38 6634 342d 3837  565-11e8-8f44-87
+00002380: 6566 3038 3162 3438 6364 2729 5d0a 2020  ef081b48cd')].  
+00002390: 2020 2020 2020 6372 6561 7465 6420 3d20        created = 
+000023a0: 6461 7465 7469 6d65 2831 3938 332c 2033  datetime(1983, 3
+000023b0: 2c20 3239 2c20 3135 2c20 3135 290a 2020  , 29, 15, 15).  
+000023c0: 2020 2020 2020 7769 7468 206d 6f63 6b2e        with mock.
+000023d0: 7061 7463 6828 276d 6564 6961 6772 6169  patch('mediagrai
+000023e0: 6e73 2e67 7366 2e64 6174 6574 696d 6527  ns.gsf.datetime'
+000023f0: 2c20 7369 6465 5f65 6666 6563 743d 6461  , side_effect=da
+00002400: 7465 7469 6d65 2c20 6e6f 773d 6d6f 636b  tetime, now=mock
+00002410: 2e4d 6167 6963 4d6f 636b 2872 6574 7572  .MagicMock(retur
+00002420: 6e5f 7661 6c75 653d 6372 6561 7465 6429  n_value=created)
+00002430: 293a 0a20 2020 2020 2020 2020 2020 2077  ):.            w
+00002440: 6974 6820 6d6f 636b 2e70 6174 6368 2827  ith mock.patch('
+00002450: 6d65 6469 6167 7261 696e 732e 6773 662e  mediagrains.gsf.
+00002460: 7575 6964 3127 2c20 7369 6465 5f65 6666  uuid1', side_eff
+00002470: 6563 743d 7575 6964 7329 3a0a 2020 2020  ect=uuids):.    
+00002480: 2020 2020 2020 2020 2020 2020 6620 3d20              f = 
+00002490: 4279 7465 7349 4f28 290a 2020 2020 2020  BytesIO().      
+000024a0: 2020 2020 2020 2020 2020 6173 796e 6320            async 
+000024b0: 7769 7468 2047 5346 456e 636f 6465 7228  with GSFEncoder(
+000024c0: 6629 2061 7320 656e 633a 0a20 2020 2020  f) as enc:.     
+000024d0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+000024e0: 7761 6974 2065 6e63 2e61 6464 5f67 7261  wait enc.add_gra
+000024f0: 696e 2867 7261 696e 290a 2020 2020 2020  in(grain).      
+00002500: 2020 2020 2020 2020 2020 2868 6561 642c            (head,
+00002510: 2073 6567 6d65 6e74 7329 203d 206c 6f61   segments) = loa
+00002520: 6473 2866 2e67 6574 7661 6c75 6528 2929  ds(f.getvalue())
+00002530: 0a0a 2020 2020 2020 2020 7365 6c66 2e61  ..        self.a
+00002540: 7373 6572 7449 6e28 2769 6427 2c20 6865  ssertIn('id', he
+00002550: 6164 290a 2020 2020 2020 2020 7365 6c66  ad).        self
+00002560: 2e61 7373 6572 7449 6e28 6865 6164 5b27  .assertIn(head['
+00002570: 6964 275d 2c20 7575 6964 7329 0a20 2020  id'], uuids).   
+00002580: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00002590: 496e 2827 7461 6773 272c 2068 6561 6429  In('tags', head)
+000025a0: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+000025b0: 7365 7274 4571 7561 6c28 6c65 6e28 6865  sertEqual(len(he
+000025c0: 6164 5b27 7461 6773 275d 292c 2030 290a  ad['tags']), 0).
+000025d0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+000025e0: 6572 7449 6e28 2763 7265 6174 6564 272c  ertIn('created',
+000025f0: 2068 6561 6429 0a20 2020 2020 2020 2073   head).        s
+00002600: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+00002610: 6865 6164 5b27 6372 6561 7465 6427 5d2c  head['created'],
+00002620: 2063 7265 6174 6564 290a 2020 2020 2020   created).      
+00002630: 2020 7365 6c66 2e61 7373 6572 7449 6e28    self.assertIn(
+00002640: 2773 6567 6d65 6e74 7327 2c20 6865 6164  'segments', head
+00002650: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+00002660: 7373 6572 7445 7175 616c 286c 656e 2868  ssertEqual(len(h
+00002670: 6561 645b 2773 6567 6d65 6e74 7327 5d29  ead['segments'])
+00002680: 2c20 3129 0a20 2020 2020 2020 2073 656c  , 1).        sel
+00002690: 662e 6173 7365 7274 496e 2827 636f 756e  f.assertIn('coun
+000026a0: 7427 2c20 6865 6164 5b27 7365 676d 656e  t', head['segmen
+000026b0: 7473 275d 5b30 5d29 0a20 2020 2020 2020  ts'][0]).       
+000026c0: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+000026d0: 6c28 6865 6164 5b27 7365 676d 656e 7473  l(head['segments
+000026e0: 275d 5b30 5d5b 2763 6f75 6e74 275d 2c20  '][0]['count'], 
+000026f0: 3129 0a20 2020 2020 2020 2073 656c 662e  1).        self.
+00002700: 6173 7365 7274 496e 2827 6c6f 6361 6c5f  assertIn('local_
+00002710: 6964 272c 2068 6561 645b 2773 6567 6d65  id', head['segme
+00002720: 6e74 7327 5d5b 305d 290a 2020 2020 2020  nts'][0]).      
+00002730: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+00002740: 616c 2868 6561 645b 2773 6567 6d65 6e74  al(head['segment
+00002750: 7327 5d5b 305d 5b27 6c6f 6361 6c5f 6964  s'][0]['local_id
+00002760: 275d 2c20 3129 0a20 2020 2020 2020 2073  '], 1).        s
+00002770: 656c 662e 6173 7365 7274 496e 2827 6964  elf.assertIn('id
+00002780: 272c 2068 6561 645b 2773 6567 6d65 6e74  ', head['segment
+00002790: 7327 5d5b 305d 290a 2020 2020 2020 2020  s'][0]).        
+000027a0: 7365 6c66 2e61 7373 6572 7449 6e28 6865  self.assertIn(he
+000027b0: 6164 5b27 7365 676d 656e 7473 275d 5b30  ad['segments'][0
+000027c0: 5d5b 2769 6427 5d2c 2075 7569 6473 290a  ]['id'], uuids).
+000027d0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+000027e0: 6572 7449 6e28 2774 6167 7327 2c20 6865  ertIn('tags', he
+000027f0: 6164 5b27 7365 676d 656e 7473 275d 5b30  ad['segments'][0
+00002800: 5d29 0a20 2020 2020 2020 2073 656c 662e  ]).        self.
+00002810: 6173 7365 7274 4571 7561 6c28 6c65 6e28  assertEqual(len(
+00002820: 6865 6164 5b27 7365 676d 656e 7473 275d  head['segments']
+00002830: 5b30 5d5b 2774 6167 7327 5d29 2c20 3029  [0]['tags']), 0)
+00002840: 0a0a 2020 2020 2020 2020 7365 6c66 2e61  ..        self.a
+00002850: 7373 6572 7445 7175 616c 286c 656e 2873  ssertEqual(len(s
+00002860: 6567 6d65 6e74 7329 2c20 3129 0a20 2020  egments), 1).   
+00002870: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00002880: 496e 2831 2c20 7365 676d 656e 7473 290a  In(1, segments).
+00002890: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+000028a0: 6572 7445 7175 616c 286c 656e 2873 6567  ertEqual(len(seg
+000028b0: 6d65 6e74 735b 315d 292c 2068 6561 645b  ments[1]), head[
+000028c0: 2773 6567 6d65 6e74 7327 5d5b 305d 5b27  'segments'][0]['
+000028d0: 636f 756e 7427 5d29 0a0a 2020 2020 2020  count'])..      
+000028e0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+000028f0: 616c 2873 6567 6d65 6e74 735b 315d 5b30  al(segments[1][0
+00002900: 5d2e 736f 7572 6365 5f69 642c 2073 7263  ].source_id, src
+00002910: 5f69 6429 0a20 2020 2020 2020 2073 656c  _id).        sel
+00002920: 662e 6173 7365 7274 4571 7561 6c28 7365  f.assertEqual(se
+00002930: 676d 656e 7473 5b31 5d5b 305d 2e66 6c6f  gments[1][0].flo
+00002940: 775f 6964 2c20 666c 6f77 5f69 6429 0a20  w_id, flow_id). 
+00002950: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+00002960: 7274 4571 7561 6c28 7365 676d 656e 7473  rtEqual(segments
+00002970: 5b31 5d5b 305d 2e67 7261 696e 5f74 7970  [1][0].grain_typ
+00002980: 652c 2027 7669 6465 6f27 290a 2020 2020  e, 'video').    
+00002990: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+000029a0: 7175 616c 2873 6567 6d65 6e74 735b 315d  qual(segments[1]
+000029b0: 5b30 5d2e 636f 675f 6672 616d 655f 666f  [0].cog_frame_fo
+000029c0: 726d 6174 2c20 436f 6746 7261 6d65 466f  rmat, CogFrameFo
+000029d0: 726d 6174 2e53 3136 5f34 3232 5f31 3042  rmat.S16_422_10B
+000029e0: 4954 290a 2020 2020 2020 2020 7365 6c66  IT).        self
+000029f0: 2e61 7373 6572 7445 7175 616c 2873 6567  .assertEqual(seg
+00002a00: 6d65 6e74 735b 315d 5b30 5d2e 7769 6474  ments[1][0].widt
+00002a10: 682c 2031 3932 3029 0a20 2020 2020 2020  h, 1920).       
+00002a20: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+00002a30: 6c28 7365 676d 656e 7473 5b31 5d5b 305d  l(segments[1][0]
+00002a40: 2e68 6569 6768 742c 2031 3038 3029 0a20  .height, 1080). 
+00002a50: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+00002a60: 7274 4571 7561 6c28 7365 676d 656e 7473  rtEqual(segments
+00002a70: 5b31 5d5b 305d 2e73 6f75 7263 655f 6173  [1][0].source_as
+00002a80: 7065 6374 5f72 6174 696f 2c20 4672 6163  pect_ratio, Frac
+00002a90: 7469 6f6e 2831 362c 2039 2929 0a20 2020  tion(16, 9)).   
+00002aa0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00002ab0: 4571 7561 6c28 7365 676d 656e 7473 5b31  Equal(segments[1
+00002ac0: 5d5b 305d 2e70 6978 656c 5f61 7370 6563  ][0].pixel_aspec
+00002ad0: 745f 7261 7469 6f2c 2046 7261 6374 696f  t_ratio, Fractio
+00002ae0: 6e28 312c 2031 2929 0a0a 2020 2020 2020  n(1, 1))..      
+00002af0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+00002b00: 616c 2873 6567 6d65 6e74 735b 315d 5b30  al(segments[1][0
+00002b10: 5d2e 6461 7461 2c20 6772 6169 6e2e 6461  ].data, grain.da
+00002b20: 7461 290a 0a20 2020 2064 6566 2074 6573  ta)..    def tes
+00002b30: 745f 6475 6d70 735f 7669 6465 6f67 7261  t_dumps_videogra
+00002b40: 696e 7328 7365 6c66 293a 0a20 2020 2020  ins(self):.     
+00002b50: 2020 2073 7263 5f69 6420 3d20 5555 4944     src_id = UUID
+00002b60: 2827 6531 3465 3964 3538 2d31 3536 372d  ('e14e9d58-1567-
+00002b70: 3131 6538 2d38 6464 332d 3833 3161 3036  11e8-8dd3-831a06
+00002b80: 3865 6230 3334 2729 0a20 2020 2020 2020  8eb034').       
+00002b90: 2066 6c6f 775f 6964 203d 2055 5549 4428   flow_id = UUID(
+00002ba0: 2765 6531 6565 6435 382d 3135 3637 2d31  'ee1eed58-1567-1
+00002bb0: 3165 382d 6139 3731 2d33 6239 3031 6132  1e8-a971-3b901a2
+00002bc0: 6464 3861 6227 290a 2020 2020 2020 2020  dd8ab').        
+00002bd0: 6772 6169 6e30 203d 2056 6964 656f 4772  grain0 = VideoGr
+00002be0: 6169 6e28 7372 635f 6964 3d73 7263 5f69  ain(src_id=src_i
+00002bf0: 642c 2066 6c6f 775f 6964 3d66 6c6f 775f  d, flow_id=flow_
+00002c00: 6964 2c20 636f 675f 6672 616d 655f 666f  id, cog_frame_fo
+00002c10: 726d 6174 3d43 6f67 4672 616d 6546 6f72  rmat=CogFrameFor
+00002c20: 6d61 742e 5331 365f 3432 325f 3130 4249  mat.S16_422_10BI
+00002c30: 542c 0a20 2020 2020 2020 2020 2020 2020  T,.             
+00002c40: 2020 2020 2020 2020 2020 2020 2020 2077                 w
+00002c50: 6964 7468 3d31 3932 302c 2068 6569 6768  idth=1920, heigh
+00002c60: 743d 3130 3830 290a 2020 2020 2020 2020  t=1080).        
+00002c70: 6772 6169 6e31 203d 2056 6964 656f 4772  grain1 = VideoGr
+00002c80: 6169 6e28 7372 635f 6964 3d73 7263 5f69  ain(src_id=src_i
+00002c90: 642c 2066 6c6f 775f 6964 3d66 6c6f 775f  d, flow_id=flow_
+00002ca0: 6964 2c20 636f 675f 6672 616d 655f 666f  id, cog_frame_fo
+00002cb0: 726d 6174 3d43 6f67 4672 616d 6546 6f72  rmat=CogFrameFor
+00002cc0: 6d61 742e 5331 365f 3432 325f 3130 4249  mat.S16_422_10BI
+00002cd0: 542c 0a20 2020 2020 2020 2020 2020 2020  T,.             
+00002ce0: 2020 2020 2020 2020 2020 2020 2020 2077                 w
+00002cf0: 6964 7468 3d31 3932 302c 2068 6569 6768  idth=1920, heigh
+00002d00: 743d 3130 3830 290a 2020 2020 2020 2020  t=1080).        
+00002d10: 666f 7220 6920 696e 2072 616e 6765 2830  for i in range(0
+00002d20: 2c20 6c65 6e28 6772 6169 6e30 2e64 6174  , len(grain0.dat
+00002d30: 6129 293a 0a20 2020 2020 2020 2020 2020  a)):.           
+00002d40: 2067 7261 696e 302e 6461 7461 5b69 5d20   grain0.data[i] 
+00002d50: 3d20 6920 2620 3078 4646 0a20 2020 2020  = i & 0xFF.     
+00002d60: 2020 2066 6f72 2069 2069 6e20 7261 6e67     for i in rang
+00002d70: 6528 302c 206c 656e 2867 7261 696e 312e  e(0, len(grain1.
+00002d80: 6461 7461 2929 3a0a 2020 2020 2020 2020  data)):.        
+00002d90: 2020 2020 6772 6169 6e31 2e64 6174 615b      grain1.data[
+00002da0: 695d 203d 2030 7846 4620 2d20 2869 2026  i] = 0xFF - (i &
+00002db0: 2030 7846 4629 0a20 2020 2020 2020 2067   0xFF).        g
+00002dc0: 7261 696e 302e 736f 7572 6365 5f61 7370  rain0.source_asp
+00002dd0: 6563 745f 7261 7469 6f20 3d20 4672 6163  ect_ratio = Frac
+00002de0: 7469 6f6e 2831 362c 2039 290a 2020 2020  tion(16, 9).    
+00002df0: 2020 2020 6772 6169 6e30 2e70 6978 656c      grain0.pixel
+00002e00: 5f61 7370 6563 745f 7261 7469 6f20 3d20  _aspect_ratio = 
+00002e10: 310a 2020 2020 2020 2020 7575 6964 7320  1.        uuids 
+00002e20: 3d20 5b55 5549 4428 2737 3932 3062 3339  = [UUID('7920b39
+00002e30: 342d 3135 3635 2d31 3165 382d 3836 6530  4-1565-11e8-86e0
+00002e40: 2d38 6234 3264 3436 3437 6261 3827 292c  -8b42d4647ba8'),
+00002e50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00002e60: 2020 5555 4944 2827 3830 6166 3837 3563    UUID('80af875c
+00002e70: 2d31 3536 352d 3131 6538 2d38 6634 342d  -1565-11e8-8f44-
+00002e80: 3837 6566 3038 3162 3438 6364 2729 5d0a  87ef081b48cd')].
+00002e90: 2020 2020 2020 2020 6372 6561 7465 6420          created 
+00002ea0: 3d20 6461 7465 7469 6d65 2831 3938 332c  = datetime(1983,
+00002eb0: 2033 2c20 3239 2c20 3135 2c20 3135 290a   3, 29, 15, 15).
+00002ec0: 2020 2020 2020 2020 7769 7468 206d 6f63          with moc
+00002ed0: 6b2e 7061 7463 6828 276d 6564 6961 6772  k.patch('mediagr
+00002ee0: 6169 6e73 2e67 7366 2e64 6174 6574 696d  ains.gsf.datetim
+00002ef0: 6527 2c20 7369 6465 5f65 6666 6563 743d  e', side_effect=
+00002f00: 6461 7465 7469 6d65 2c20 6e6f 773d 6d6f  datetime, now=mo
+00002f10: 636b 2e4d 6167 6963 4d6f 636b 2872 6574  ck.MagicMock(ret
+00002f20: 7572 6e5f 7661 6c75 653d 6372 6561 7465  urn_value=create
+00002f30: 6429 293a 0a20 2020 2020 2020 2020 2020  d)):.           
+00002f40: 2077 6974 6820 6d6f 636b 2e70 6174 6368   with mock.patch
+00002f50: 2827 6d65 6469 6167 7261 696e 732e 6773  ('mediagrains.gs
+00002f60: 662e 7575 6964 3127 2c20 7369 6465 5f65  f.uuid1', side_e
+00002f70: 6666 6563 743d 7575 6964 7329 3a0a 2020  ffect=uuids):.  
+00002f80: 2020 2020 2020 2020 2020 2020 2020 2868                (h
+00002f90: 6561 642c 2073 6567 6d65 6e74 7329 203d  ead, segments) =
+00002fa0: 206c 6f61 6473 2864 756d 7073 285b 6772   loads(dumps([gr
+00002fb0: 6169 6e30 2c20 6772 6169 6e31 5d29 290a  ain0, grain1])).
+00002fc0: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+00002fd0: 7365 7274 496e 2827 6964 272c 2068 6561  sertIn('id', hea
+00002fe0: 6429 0a20 2020 2020 2020 2073 656c 662e  d).        self.
+00002ff0: 6173 7365 7274 496e 2868 6561 645b 2769  assertIn(head['i
+00003000: 6427 5d2c 2075 7569 6473 290a 2020 2020  d'], uuids).    
+00003010: 2020 2020 7365 6c66 2e61 7373 6572 7449      self.assertI
+00003020: 6e28 2774 6167 7327 2c20 6865 6164 290a  n('tags', head).
+00003030: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+00003040: 6572 7445 7175 616c 286c 656e 2868 6561  ertEqual(len(hea
+00003050: 645b 2774 6167 7327 5d29 2c20 3029 0a20  d['tags']), 0). 
+00003060: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+00003070: 7274 496e 2827 6372 6561 7465 6427 2c20  rtIn('created', 
+00003080: 6865 6164 290a 2020 2020 2020 2020 7365  head).        se
+00003090: 6c66 2e61 7373 6572 7445 7175 616c 2868  lf.assertEqual(h
+000030a0: 6561 645b 2763 7265 6174 6564 275d 2c20  ead['created'], 
+000030b0: 6372 6561 7465 6429 0a20 2020 2020 2020  created).       
+000030c0: 2073 656c 662e 6173 7365 7274 496e 2827   self.assertIn('
+000030d0: 7365 676d 656e 7473 272c 2068 6561 6429  segments', head)
+000030e0: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+000030f0: 7365 7274 4571 7561 6c28 6c65 6e28 6865  sertEqual(len(he
+00003100: 6164 5b27 7365 676d 656e 7473 275d 292c  ad['segments']),
+00003110: 2031 290a 2020 2020 2020 2020 7365 6c66   1).        self
+00003120: 2e61 7373 6572 7449 6e28 2763 6f75 6e74  .assertIn('count
+00003130: 272c 2068 6561 645b 2773 6567 6d65 6e74  ', head['segment
+00003140: 7327 5d5b 305d 290a 2020 2020 2020 2020  s'][0]).        
+00003150: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+00003160: 2868 6561 645b 2773 6567 6d65 6e74 7327  (head['segments'
+00003170: 5d5b 305d 5b27 636f 756e 7427 5d2c 2032  ][0]['count'], 2
+00003180: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+00003190: 7373 6572 7449 6e28 276c 6f63 616c 5f69  ssertIn('local_i
+000031a0: 6427 2c20 6865 6164 5b27 7365 676d 656e  d', head['segmen
+000031b0: 7473 275d 5b30 5d29 0a20 2020 2020 2020  ts'][0]).       
+000031c0: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+000031d0: 6c28 6865 6164 5b27 7365 676d 656e 7473  l(head['segments
+000031e0: 275d 5b30 5d5b 276c 6f63 616c 5f69 6427  '][0]['local_id'
+000031f0: 5d2c 2031 290a 2020 2020 2020 2020 7365  ], 1).        se
+00003200: 6c66 2e61 7373 6572 7449 6e28 2769 6427  lf.assertIn('id'
+00003210: 2c20 6865 6164 5b27 7365 676d 656e 7473  , head['segments
+00003220: 275d 5b30 5d29 0a20 2020 2020 2020 2073  '][0]).        s
+00003230: 656c 662e 6173 7365 7274 496e 2868 6561  elf.assertIn(hea
+00003240: 645b 2773 6567 6d65 6e74 7327 5d5b 305d  d['segments'][0]
+00003250: 5b27 6964 275d 2c20 7575 6964 7329 0a20  ['id'], uuids). 
+00003260: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+00003270: 7274 496e 2827 7461 6773 272c 2068 6561  rtIn('tags', hea
+00003280: 645b 2773 6567 6d65 6e74 7327 5d5b 305d  d['segments'][0]
+00003290: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+000032a0: 7373 6572 7445 7175 616c 286c 656e 2868  ssertEqual(len(h
+000032b0: 6561 645b 2773 6567 6d65 6e74 7327 5d5b  ead['segments'][
+000032c0: 305d 5b27 7461 6773 275d 292c 2030 290a  0]['tags']), 0).
+000032d0: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+000032e0: 7365 7274 4571 7561 6c28 6c65 6e28 7365  sertEqual(len(se
+000032f0: 676d 656e 7473 292c 2031 290a 2020 2020  gments), 1).    
+00003300: 2020 2020 7365 6c66 2e61 7373 6572 7449      self.assertI
+00003310: 6e28 312c 2073 6567 6d65 6e74 7329 0a20  n(1, segments). 
+00003320: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+00003330: 7274 4571 7561 6c28 6c65 6e28 7365 676d  rtEqual(len(segm
+00003340: 656e 7473 5b31 5d29 2c20 6865 6164 5b27  ents[1]), head['
+00003350: 7365 676d 656e 7473 275d 5b30 5d5b 2763  segments'][0]['c
+00003360: 6f75 6e74 275d 290a 0a20 2020 2020 2020  ount'])..       
+00003370: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+00003380: 6c28 7365 676d 656e 7473 5b31 5d5b 305d  l(segments[1][0]
+00003390: 2e73 6f75 7263 655f 6964 2c20 7372 635f  .source_id, src_
+000033a0: 6964 290a 2020 2020 2020 2020 7365 6c66  id).        self
+000033b0: 2e61 7373 6572 7445 7175 616c 2873 6567  .assertEqual(seg
+000033c0: 6d65 6e74 735b 315d 5b30 5d2e 666c 6f77  ments[1][0].flow
+000033d0: 5f69 642c 2066 6c6f 775f 6964 290a 2020  _id, flow_id).  
+000033e0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+000033f0: 7445 7175 616c 2873 6567 6d65 6e74 735b  tEqual(segments[
+00003400: 315d 5b30 5d2e 6772 6169 6e5f 7479 7065  1][0].grain_type
+00003410: 2c20 2776 6964 656f 2729 0a20 2020 2020  , 'video').     
+00003420: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+00003430: 7561 6c28 7365 676d 656e 7473 5b31 5d5b  ual(segments[1][
+00003440: 305d 2e63 6f67 5f66 7261 6d65 5f66 6f72  0].cog_frame_for
+00003450: 6d61 742c 2043 6f67 4672 616d 6546 6f72  mat, CogFrameFor
+00003460: 6d61 742e 5331 365f 3432 325f 3130 4249  mat.S16_422_10BI
+00003470: 5429 0a20 2020 2020 2020 2073 656c 662e  T).        self.
+00003480: 6173 7365 7274 4571 7561 6c28 7365 676d  assertEqual(segm
+00003490: 656e 7473 5b31 5d5b 305d 2e77 6964 7468  ents[1][0].width
+000034a0: 2c20 3139 3230 290a 2020 2020 2020 2020  , 1920).        
+000034b0: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+000034c0: 2873 6567 6d65 6e74 735b 315d 5b30 5d2e  (segments[1][0].
+000034d0: 6865 6967 6874 2c20 3130 3830 290a 2020  height, 1080).  
+000034e0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+000034f0: 7445 7175 616c 2873 6567 6d65 6e74 735b  tEqual(segments[
+00003500: 315d 5b30 5d2e 736f 7572 6365 5f61 7370  1][0].source_asp
+00003510: 6563 745f 7261 7469 6f2c 2046 7261 6374  ect_ratio, Fract
+00003520: 696f 6e28 3136 2c20 3929 290a 2020 2020  ion(16, 9)).    
+00003530: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+00003540: 7175 616c 2873 6567 6d65 6e74 735b 315d  qual(segments[1]
+00003550: 5b30 5d2e 7069 7865 6c5f 6173 7065 6374  [0].pixel_aspect
+00003560: 5f72 6174 696f 2c20 4672 6163 7469 6f6e  _ratio, Fraction
+00003570: 2831 2c20 3129 290a 0a20 2020 2020 2020  (1, 1))..       
+00003580: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+00003590: 6c28 7365 676d 656e 7473 5b31 5d5b 305d  l(segments[1][0]
+000035a0: 2e64 6174 612c 2067 7261 696e 302e 6461  .data, grain0.da
+000035b0: 7461 290a 0a20 2020 2020 2020 2073 656c  ta)..        sel
+000035c0: 662e 6173 7365 7274 4571 7561 6c28 7365  f.assertEqual(se
+000035d0: 676d 656e 7473 5b31 5d5b 315d 2e73 6f75  gments[1][1].sou
+000035e0: 7263 655f 6964 2c20 7372 635f 6964 290a  rce_id, src_id).
+000035f0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+00003600: 6572 7445 7175 616c 2873 6567 6d65 6e74  ertEqual(segment
+00003610: 735b 315d 5b31 5d2e 666c 6f77 5f69 642c  s[1][1].flow_id,
+00003620: 2066 6c6f 775f 6964 290a 2020 2020 2020   flow_id).      
+00003630: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+00003640: 616c 2873 6567 6d65 6e74 735b 315d 5b31  al(segments[1][1
+00003650: 5d2e 6772 6169 6e5f 7479 7065 2c20 2776  ].grain_type, 'v
+00003660: 6964 656f 2729 0a20 2020 2020 2020 2073  ideo').        s
+00003670: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+00003680: 7365 676d 656e 7473 5b31 5d5b 315d 2e63  segments[1][1].c
+00003690: 6f67 5f66 7261 6d65 5f66 6f72 6d61 742c  og_frame_format,
+000036a0: 2043 6f67 4672 616d 6546 6f72 6d61 742e   CogFrameFormat.
+000036b0: 5331 365f 3432 325f 3130 4249 5429 0a20  S16_422_10BIT). 
+000036c0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+000036d0: 7274 4571 7561 6c28 7365 676d 656e 7473  rtEqual(segments
+000036e0: 5b31 5d5b 315d 2e77 6964 7468 2c20 3139  [1][1].width, 19
+000036f0: 3230 290a 2020 2020 2020 2020 7365 6c66  20).        self
+00003700: 2e61 7373 6572 7445 7175 616c 2873 6567  .assertEqual(seg
+00003710: 6d65 6e74 735b 315d 5b31 5d2e 6865 6967  ments[1][1].heig
+00003720: 6874 2c20 3130 3830 290a 2020 2020 2020  ht, 1080).      
+00003730: 2020 7365 6c66 2e61 7373 6572 7449 734e    self.assertIsN
+00003740: 6f6e 6528 7365 676d 656e 7473 5b31 5d5b  one(segments[1][
+00003750: 315d 2e73 6f75 7263 655f 6173 7065 6374  1].source_aspect
+00003760: 5f72 6174 696f 290a 2020 2020 2020 2020  _ratio).        
+00003770: 7365 6c66 2e61 7373 6572 7449 734e 6f6e  self.assertIsNon
+00003780: 6528 7365 676d 656e 7473 5b31 5d5b 315d  e(segments[1][1]
+00003790: 2e70 6978 656c 5f61 7370 6563 745f 7261  .pixel_aspect_ra
+000037a0: 7469 6f29 0a0a 2020 2020 2020 2020 7365  tio)..        se
+000037b0: 6c66 2e61 7373 6572 7445 7175 616c 2873  lf.assertEqual(s
+000037c0: 6567 6d65 6e74 735b 315d 5b31 5d2e 6461  egments[1][1].da
+000037d0: 7461 2c20 6772 6169 6e31 2e64 6174 6129  ta, grain1.data)
+000037e0: 0a0a 2020 2020 6173 796e 6320 6465 6620  ..    async def 
+000037f0: 7465 7374 5f61 7379 6e63 5f65 6e63 6f64  test_async_encod
+00003800: 655f 7669 6465 6f67 7261 696e 7328 7365  e_videograins(se
+00003810: 6c66 293a 0a20 2020 2020 2020 2073 7263  lf):.        src
+00003820: 5f69 6420 3d20 5555 4944 2827 6531 3465  _id = UUID('e14e
+00003830: 3964 3538 2d31 3536 372d 3131 6538 2d38  9d58-1567-11e8-8
+00003840: 6464 332d 3833 3161 3036 3865 6230 3334  dd3-831a068eb034
+00003850: 2729 0a20 2020 2020 2020 2066 6c6f 775f  ').        flow_
+00003860: 6964 203d 2055 5549 4428 2765 6531 6565  id = UUID('ee1ee
+00003870: 6435 382d 3135 3637 2d31 3165 382d 6139  d58-1567-11e8-a9
+00003880: 3731 2d33 6239 3031 6132 6464 3861 6227  71-3b901a2dd8ab'
+00003890: 290a 2020 2020 2020 2020 6772 6169 6e30  ).        grain0
+000038a0: 203d 2056 6964 656f 4772 6169 6e28 7372   = VideoGrain(sr
+000038b0: 635f 6964 3d73 7263 5f69 642c 2066 6c6f  c_id=src_id, flo
+000038c0: 775f 6964 3d66 6c6f 775f 6964 2c20 636f  w_id=flow_id, co
+000038d0: 675f 6672 616d 655f 666f 726d 6174 3d43  g_frame_format=C
+000038e0: 6f67 4672 616d 6546 6f72 6d61 742e 5331  ogFrameFormat.S1
+000038f0: 365f 3432 325f 3130 4249 542c 2077 6964  6_422_10BIT, wid
+00003900: 7468 3d31 3932 302c 0a20 2020 2020 2020  th=1920,.       
+00003910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003920: 2020 2020 2068 6569 6768 743d 3130 3830       height=1080
+00003930: 290a 2020 2020 2020 2020 6772 6169 6e31  ).        grain1
+00003940: 203d 2056 6964 656f 4772 6169 6e28 7372   = VideoGrain(sr
+00003950: 635f 6964 3d73 7263 5f69 642c 2066 6c6f  c_id=src_id, flo
+00003960: 775f 6964 3d66 6c6f 775f 6964 2c20 636f  w_id=flow_id, co
+00003970: 675f 6672 616d 655f 666f 726d 6174 3d43  g_frame_format=C
+00003980: 6f67 4672 616d 6546 6f72 6d61 742e 5331  ogFrameFormat.S1
+00003990: 365f 3432 325f 3130 4249 542c 2077 6964  6_422_10BIT, wid
+000039a0: 7468 3d31 3932 302c 0a20 2020 2020 2020  th=1920,.       
+000039b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000039c0: 2020 2020 2068 6569 6768 743d 3130 3830       height=1080
+000039d0: 290a 2020 2020 2020 2020 666f 7220 6920  ).        for i 
+000039e0: 696e 2072 616e 6765 2830 2c20 6c65 6e28  in range(0, len(
+000039f0: 6772 6169 6e30 2e64 6174 6129 293a 0a20  grain0.data)):. 
+00003a00: 2020 2020 2020 2020 2020 2067 7261 696e             grain
+00003a10: 302e 6461 7461 5b69 5d20 3d20 6920 2620  0.data[i] = i & 
+00003a20: 3078 4646 0a20 2020 2020 2020 2066 6f72  0xFF.        for
+00003a30: 2069 2069 6e20 7261 6e67 6528 302c 206c   i in range(0, l
+00003a40: 656e 2867 7261 696e 312e 6461 7461 2929  en(grain1.data))
+00003a50: 3a0a 2020 2020 2020 2020 2020 2020 6772  :.            gr
+00003a60: 6169 6e31 2e64 6174 615b 695d 203d 2030  ain1.data[i] = 0
+00003a70: 7846 4620 2d20 2869 2026 2030 7846 4629  xFF - (i & 0xFF)
+00003a80: 0a20 2020 2020 2020 2067 7261 696e 302e  .        grain0.
+00003a90: 736f 7572 6365 5f61 7370 6563 745f 7261  source_aspect_ra
+00003aa0: 7469 6f20 3d20 4672 6163 7469 6f6e 2831  tio = Fraction(1
+00003ab0: 362c 2039 290a 2020 2020 2020 2020 6772  6, 9).        gr
+00003ac0: 6169 6e30 2e70 6978 656c 5f61 7370 6563  ain0.pixel_aspec
+00003ad0: 745f 7261 7469 6f20 3d20 310a 2020 2020  t_ratio = 1.    
+00003ae0: 2020 2020 7575 6964 7320 3d20 5b55 5549      uuids = [UUI
+00003af0: 4428 2737 3932 3062 3339 342d 3135 3635  D('7920b394-1565
+00003b00: 2d31 3165 382d 3836 6530 2d38 6234 3264  -11e8-86e0-8b42d
+00003b10: 3436 3437 6261 3827 292c 0a20 2020 2020  4647ba8'),.     
+00003b20: 2020 2020 2020 2020 2020 2020 5555 4944              UUID
+00003b30: 2827 3830 6166 3837 3563 2d31 3536 352d  ('80af875c-1565-
+00003b40: 3131 6538 2d38 6634 342d 3837 6566 3038  11e8-8f44-87ef08
+00003b50: 3162 3438 6364 2729 5d0a 2020 2020 2020  1b48cd')].      
+00003b60: 2020 6372 6561 7465 6420 3d20 6461 7465    created = date
+00003b70: 7469 6d65 2831 3938 332c 2033 2c20 3239  time(1983, 3, 29
+00003b80: 2c20 3135 2c20 3135 290a 2020 2020 2020  , 15, 15).      
+00003b90: 2020 7769 7468 206d 6f63 6b2e 7061 7463    with mock.patc
+00003ba0: 6828 276d 6564 6961 6772 6169 6e73 2e67  h('mediagrains.g
+00003bb0: 7366 2e64 6174 6574 696d 6527 2c20 7369  sf.datetime', si
+00003bc0: 6465 5f65 6666 6563 743d 6461 7465 7469  de_effect=dateti
+00003bd0: 6d65 2c20 6e6f 773d 6d6f 636b 2e4d 6167  me, now=mock.Mag
+00003be0: 6963 4d6f 636b 2872 6574 7572 6e5f 7661  icMock(return_va
+00003bf0: 6c75 653d 6372 6561 7465 6429 293a 0a20  lue=created)):. 
+00003c00: 2020 2020 2020 2020 2020 2077 6974 6820             with 
+00003c10: 6d6f 636b 2e70 6174 6368 2827 6d65 6469  mock.patch('medi
+00003c20: 6167 7261 696e 732e 6773 662e 7575 6964  agrains.gsf.uuid
+00003c30: 3127 2c20 7369 6465 5f65 6666 6563 743d  1', side_effect=
+00003c40: 7575 6964 7329 3a0a 2020 2020 2020 2020  uuids):.        
+00003c50: 2020 2020 2020 2020 6620 3d20 4279 7465          f = Byte
+00003c60: 7349 4f28 290a 2020 2020 2020 2020 2020  sIO().          
+00003c70: 2020 2020 2020 6173 796e 6320 7769 7468        async with
+00003c80: 2047 5346 456e 636f 6465 7228 6629 2061   GSFEncoder(f) a
+00003c90: 7320 656e 633a 0a20 2020 2020 2020 2020  s enc:.         
+00003ca0: 2020 2020 2020 2020 2020 2061 7761 6974             await
+00003cb0: 2065 6e63 2e61 6464 5f67 7261 696e 7328   enc.add_grains(
+00003cc0: 5b67 7261 696e 302c 2067 7261 696e 315d  [grain0, grain1]
+00003cd0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00003ce0: 2020 2868 6561 642c 2073 6567 6d65 6e74    (head, segment
+00003cf0: 7329 203d 206c 6f61 6473 2866 2e67 6574  s) = loads(f.get
+00003d00: 7661 6c75 6528 2929 0a0a 2020 2020 2020  value())..      
+00003d10: 2020 7365 6c66 2e61 7373 6572 7449 6e28    self.assertIn(
+00003d20: 2769 6427 2c20 6865 6164 290a 2020 2020  'id', head).    
+00003d30: 2020 2020 7365 6c66 2e61 7373 6572 7449      self.assertI
+00003d40: 6e28 6865 6164 5b27 6964 275d 2c20 7575  n(head['id'], uu
+00003d50: 6964 7329 0a20 2020 2020 2020 2073 656c  ids).        sel
+00003d60: 662e 6173 7365 7274 496e 2827 7461 6773  f.assertIn('tags
+00003d70: 272c 2068 6561 6429 0a20 2020 2020 2020  ', head).       
+00003d80: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+00003d90: 6c28 6c65 6e28 6865 6164 5b27 7461 6773  l(len(head['tags
+00003da0: 275d 292c 2030 290a 2020 2020 2020 2020  ']), 0).        
+00003db0: 7365 6c66 2e61 7373 6572 7449 6e28 2763  self.assertIn('c
+00003dc0: 7265 6174 6564 272c 2068 6561 6429 0a20  reated', head). 
+00003dd0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+00003de0: 7274 4571 7561 6c28 6865 6164 5b27 6372  rtEqual(head['cr
+00003df0: 6561 7465 6427 5d2c 2063 7265 6174 6564  eated'], created
+00003e00: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+00003e10: 7373 6572 7449 6e28 2773 6567 6d65 6e74  ssertIn('segment
+00003e20: 7327 2c20 6865 6164 290a 2020 2020 2020  s', head).      
+00003e30: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+00003e40: 616c 286c 656e 2868 6561 645b 2773 6567  al(len(head['seg
+00003e50: 6d65 6e74 7327 5d29 2c20 3129 0a20 2020  ments']), 1).   
+00003e60: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00003e70: 496e 2827 636f 756e 7427 2c20 6865 6164  In('count', head
+00003e80: 5b27 7365 676d 656e 7473 275d 5b30 5d29  ['segments'][0])
+00003e90: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+00003ea0: 7365 7274 4571 7561 6c28 6865 6164 5b27  sertEqual(head['
+00003eb0: 7365 676d 656e 7473 275d 5b30 5d5b 2763  segments'][0]['c
+00003ec0: 6f75 6e74 275d 2c20 3229 0a20 2020 2020  ount'], 2).     
+00003ed0: 2020 2073 656c 662e 6173 7365 7274 496e     self.assertIn
+00003ee0: 2827 6c6f 6361 6c5f 6964 272c 2068 6561  ('local_id', hea
+00003ef0: 645b 2773 6567 6d65 6e74 7327 5d5b 305d  d['segments'][0]
+00003f00: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+00003f10: 7373 6572 7445 7175 616c 2868 6561 645b  ssertEqual(head[
+00003f20: 2773 6567 6d65 6e74 7327 5d5b 305d 5b27  'segments'][0]['
+00003f30: 6c6f 6361 6c5f 6964 275d 2c20 3129 0a20  local_id'], 1). 
+00003f40: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+00003f50: 7274 496e 2827 6964 272c 2068 6561 645b  rtIn('id', head[
+00003f60: 2773 6567 6d65 6e74 7327 5d5b 305d 290a  'segments'][0]).
+00003f70: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+00003f80: 6572 7449 6e28 6865 6164 5b27 7365 676d  ertIn(head['segm
+00003f90: 656e 7473 275d 5b30 5d5b 2769 6427 5d2c  ents'][0]['id'],
+00003fa0: 2075 7569 6473 290a 2020 2020 2020 2020   uuids).        
+00003fb0: 7365 6c66 2e61 7373 6572 7449 6e28 2774  self.assertIn('t
+00003fc0: 6167 7327 2c20 6865 6164 5b27 7365 676d  ags', head['segm
+00003fd0: 656e 7473 275d 5b30 5d29 0a20 2020 2020  ents'][0]).     
+00003fe0: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+00003ff0: 7561 6c28 6c65 6e28 6865 6164 5b27 7365  ual(len(head['se
+00004000: 676d 656e 7473 275d 5b30 5d5b 2774 6167  gments'][0]['tag
+00004010: 7327 5d29 2c20 3029 0a0a 2020 2020 2020  s']), 0)..      
+00004020: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+00004030: 616c 286c 656e 2873 6567 6d65 6e74 7329  al(len(segments)
+00004040: 2c20 3129 0a20 2020 2020 2020 2073 656c  , 1).        sel
+00004050: 662e 6173 7365 7274 496e 2831 2c20 7365  f.assertIn(1, se
+00004060: 676d 656e 7473 290a 2020 2020 2020 2020  gments).        
+00004070: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+00004080: 286c 656e 2873 6567 6d65 6e74 735b 315d  (len(segments[1]
+00004090: 292c 2068 6561 645b 2773 6567 6d65 6e74  ), head['segment
+000040a0: 7327 5d5b 305d 5b27 636f 756e 7427 5d29  s'][0]['count'])
+000040b0: 0a0a 2020 2020 2020 2020 7365 6c66 2e61  ..        self.a
+000040c0: 7373 6572 7445 7175 616c 2873 6567 6d65  ssertEqual(segme
+000040d0: 6e74 735b 315d 5b30 5d2e 736f 7572 6365  nts[1][0].source
+000040e0: 5f69 642c 2073 7263 5f69 6429 0a20 2020  _id, src_id).   
+000040f0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00004100: 4571 7561 6c28 7365 676d 656e 7473 5b31  Equal(segments[1
+00004110: 5d5b 305d 2e66 6c6f 775f 6964 2c20 666c  ][0].flow_id, fl
+00004120: 6f77 5f69 6429 0a20 2020 2020 2020 2073  ow_id).        s
+00004130: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+00004140: 7365 676d 656e 7473 5b31 5d5b 305d 2e67  segments[1][0].g
+00004150: 7261 696e 5f74 7970 652c 2027 7669 6465  rain_type, 'vide
+00004160: 6f27 290a 2020 2020 2020 2020 7365 6c66  o').        self
+00004170: 2e61 7373 6572 7445 7175 616c 2873 6567  .assertEqual(seg
+00004180: 6d65 6e74 735b 315d 5b30 5d2e 636f 675f  ments[1][0].cog_
+00004190: 6672 616d 655f 666f 726d 6174 2c20 436f  frame_format, Co
+000041a0: 6746 7261 6d65 466f 726d 6174 2e53 3136  gFrameFormat.S16
+000041b0: 5f34 3232 5f31 3042 4954 290a 2020 2020  _422_10BIT).    
+000041c0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+000041d0: 7175 616c 2873 6567 6d65 6e74 735b 315d  qual(segments[1]
+000041e0: 5b30 5d2e 7769 6474 682c 2031 3932 3029  [0].width, 1920)
+000041f0: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+00004200: 7365 7274 4571 7561 6c28 7365 676d 656e  sertEqual(segmen
+00004210: 7473 5b31 5d5b 305d 2e68 6569 6768 742c  ts[1][0].height,
+00004220: 2031 3038 3029 0a20 2020 2020 2020 2073   1080).        s
+00004230: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+00004240: 7365 676d 656e 7473 5b31 5d5b 305d 2e73  segments[1][0].s
+00004250: 6f75 7263 655f 6173 7065 6374 5f72 6174  ource_aspect_rat
+00004260: 696f 2c20 4672 6163 7469 6f6e 2831 362c  io, Fraction(16,
+00004270: 2039 2929 0a20 2020 2020 2020 2073 656c   9)).        sel
+00004280: 662e 6173 7365 7274 4571 7561 6c28 7365  f.assertEqual(se
+00004290: 676d 656e 7473 5b31 5d5b 305d 2e70 6978  gments[1][0].pix
+000042a0: 656c 5f61 7370 6563 745f 7261 7469 6f2c  el_aspect_ratio,
+000042b0: 2046 7261 6374 696f 6e28 312c 2031 2929   Fraction(1, 1))
+000042c0: 0a0a 2020 2020 2020 2020 7365 6c66 2e61  ..        self.a
+000042d0: 7373 6572 7445 7175 616c 2873 6567 6d65  ssertEqual(segme
+000042e0: 6e74 735b 315d 5b30 5d2e 6461 7461 2c20  nts[1][0].data, 
+000042f0: 6772 6169 6e30 2e64 6174 6129 0a0a 2020  grain0.data)..  
+00004300: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00004310: 7445 7175 616c 2873 6567 6d65 6e74 735b  tEqual(segments[
+00004320: 315d 5b31 5d2e 736f 7572 6365 5f69 642c  1][1].source_id,
+00004330: 2073 7263 5f69 6429 0a20 2020 2020 2020   src_id).       
+00004340: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+00004350: 6c28 7365 676d 656e 7473 5b31 5d5b 315d  l(segments[1][1]
+00004360: 2e66 6c6f 775f 6964 2c20 666c 6f77 5f69  .flow_id, flow_i
+00004370: 6429 0a20 2020 2020 2020 2073 656c 662e  d).        self.
+00004380: 6173 7365 7274 4571 7561 6c28 7365 676d  assertEqual(segm
+00004390: 656e 7473 5b31 5d5b 315d 2e67 7261 696e  ents[1][1].grain
+000043a0: 5f74 7970 652c 2027 7669 6465 6f27 290a  _type, 'video').
+000043b0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+000043c0: 6572 7445 7175 616c 2873 6567 6d65 6e74  ertEqual(segment
+000043d0: 735b 315d 5b31 5d2e 636f 675f 6672 616d  s[1][1].cog_fram
+000043e0: 655f 666f 726d 6174 2c20 436f 6746 7261  e_format, CogFra
+000043f0: 6d65 466f 726d 6174 2e53 3136 5f34 3232  meFormat.S16_422
+00004400: 5f31 3042 4954 290a 2020 2020 2020 2020  _10BIT).        
+00004410: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+00004420: 2873 6567 6d65 6e74 735b 315d 5b31 5d2e  (segments[1][1].
+00004430: 7769 6474 682c 2031 3932 3029 0a20 2020  width, 1920).   
+00004440: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00004450: 4571 7561 6c28 7365 676d 656e 7473 5b31  Equal(segments[1
+00004460: 5d5b 315d 2e68 6569 6768 742c 2031 3038  ][1].height, 108
+00004470: 3029 0a20 2020 2020 2020 2073 656c 662e  0).        self.
+00004480: 6173 7365 7274 4973 4e6f 6e65 2873 6567  assertIsNone(seg
+00004490: 6d65 6e74 735b 315d 5b31 5d2e 736f 7572  ments[1][1].sour
+000044a0: 6365 5f61 7370 6563 745f 7261 7469 6f29  ce_aspect_ratio)
+000044b0: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+000044c0: 7365 7274 4973 4e6f 6e65 2873 6567 6d65  sertIsNone(segme
+000044d0: 6e74 735b 315d 5b31 5d2e 7069 7865 6c5f  nts[1][1].pixel_
+000044e0: 6173 7065 6374 5f72 6174 696f 290a 0a20  aspect_ratio).. 
+000044f0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+00004500: 7274 4571 7561 6c28 7365 676d 656e 7473  rtEqual(segments
+00004510: 5b31 5d5b 315d 2e64 6174 612c 2067 7261  [1][1].data, gra
+00004520: 696e 312e 6461 7461 290a 0a20 2020 2064  in1.data)..    d
+00004530: 6566 2074 6573 745f 6475 6d70 735f 6175  ef test_dumps_au
+00004540: 6469 6f67 7261 696e 7328 7365 6c66 293a  diograins(self):
+00004550: 0a20 2020 2020 2020 2073 7263 5f69 6420  .        src_id 
+00004560: 3d20 5555 4944 2827 6531 3465 3964 3538  = UUID('e14e9d58
+00004570: 2d31 3536 372d 3131 6538 2d38 6464 332d  -1567-11e8-8dd3-
+00004580: 3833 3161 3036 3865 6230 3334 2729 0a20  831a068eb034'). 
+00004590: 2020 2020 2020 2066 6c6f 775f 6964 203d         flow_id =
+000045a0: 2055 5549 4428 2765 6531 6565 6435 382d   UUID('ee1eed58-
+000045b0: 3135 3637 2d31 3165 382d 6139 3731 2d33  1567-11e8-a971-3
+000045c0: 6239 3031 6132 6464 3861 6227 290a 2020  b901a2dd8ab').  
+000045d0: 2020 2020 2020 6772 6169 6e30 203d 2041        grain0 = A
+000045e0: 7564 696f 4772 6169 6e28 0a20 2020 2020  udioGrain(.     
+000045f0: 2020 2020 2020 2073 7263 5f69 643d 7372         src_id=sr
+00004600: 635f 6964 2c20 666c 6f77 5f69 643d 666c  c_id, flow_id=fl
+00004610: 6f77 5f69 642c 2063 6f67 5f61 7564 696f  ow_id, cog_audio
+00004620: 5f66 6f72 6d61 743d 436f 6741 7564 696f  _format=CogAudio
+00004630: 466f 726d 6174 2e53 3136 5f50 4c41 4e45  Format.S16_PLANE
+00004640: 532c 2073 616d 706c 6573 3d31 3932 302c  S, samples=1920,
+00004650: 2073 616d 706c 655f 7261 7465 3d34 3830   sample_rate=480
+00004660: 3030 290a 2020 2020 2020 2020 6772 6169  00).        grai
+00004670: 6e31 203d 2041 7564 696f 4772 6169 6e28  n1 = AudioGrain(
+00004680: 0a20 2020 2020 2020 2020 2020 2073 7263  .            src
+00004690: 5f69 643d 7372 635f 6964 2c20 666c 6f77  _id=src_id, flow
+000046a0: 5f69 643d 666c 6f77 5f69 642c 2063 6f67  _id=flow_id, cog
+000046b0: 5f61 7564 696f 5f66 6f72 6d61 743d 436f  _audio_format=Co
+000046c0: 6741 7564 696f 466f 726d 6174 2e53 3136  gAudioFormat.S16
+000046d0: 5f50 4c41 4e45 532c 2073 616d 706c 6573  _PLANES, samples
+000046e0: 3d31 3932 302c 2073 616d 706c 655f 7261  =1920, sample_ra
+000046f0: 7465 3d34 3830 3030 290a 2020 2020 2020  te=48000).      
+00004700: 2020 666f 7220 6920 696e 2072 616e 6765    for i in range
+00004710: 2830 2c20 6c65 6e28 6772 6169 6e30 2e64  (0, len(grain0.d
+00004720: 6174 6129 293a 0a20 2020 2020 2020 2020  ata)):.         
+00004730: 2020 2067 7261 696e 302e 6461 7461 5b69     grain0.data[i
+00004740: 5d20 3d20 6920 2620 3078 4646 0a20 2020  ] = i & 0xFF.   
+00004750: 2020 2020 2066 6f72 2069 2069 6e20 7261       for i in ra
+00004760: 6e67 6528 302c 206c 656e 2867 7261 696e  nge(0, len(grain
+00004770: 312e 6461 7461 2929 3a0a 2020 2020 2020  1.data)):.      
+00004780: 2020 2020 2020 6772 6169 6e31 2e64 6174        grain1.dat
+00004790: 615b 695d 203d 2030 7846 4620 2d20 2869  a[i] = 0xFF - (i
+000047a0: 2026 2030 7846 4629 0a20 2020 2020 2020   & 0xFF).       
+000047b0: 2075 7569 6473 203d 205b 5555 4944 2827   uuids = [UUID('
+000047c0: 3739 3230 6233 3934 2d31 3536 352d 3131  7920b394-1565-11
+000047d0: 6538 2d38 3665 302d 3862 3432 6434 3634  e8-86e0-8b42d464
+000047e0: 3762 6138 2729 2c0a 2020 2020 2020 2020  7ba8'),.        
+000047f0: 2020 2020 2020 2020 2055 5549 4428 2738           UUID('8
+00004800: 3061 6638 3735 632d 3135 3635 2d31 3165  0af875c-1565-11e
+00004810: 382d 3866 3434 2d38 3765 6630 3831 6234  8-8f44-87ef081b4
+00004820: 3863 6427 295d 0a20 2020 2020 2020 2063  8cd')].        c
+00004830: 7265 6174 6564 203d 2064 6174 6574 696d  reated = datetim
+00004840: 6528 3139 3833 2c20 332c 2032 392c 2031  e(1983, 3, 29, 1
+00004850: 352c 2031 3529 0a20 2020 2020 2020 2077  5, 15).        w
+00004860: 6974 6820 6d6f 636b 2e70 6174 6368 2827  ith mock.patch('
+00004870: 6d65 6469 6167 7261 696e 732e 6773 662e  mediagrains.gsf.
+00004880: 6461 7465 7469 6d65 272c 2073 6964 655f  datetime', side_
+00004890: 6566 6665 6374 3d64 6174 6574 696d 652c  effect=datetime,
+000048a0: 206e 6f77 3d6d 6f63 6b2e 4d61 6769 634d   now=mock.MagicM
+000048b0: 6f63 6b28 7265 7475 726e 5f76 616c 7565  ock(return_value
+000048c0: 3d63 7265 6174 6564 2929 3a0a 2020 2020  =created)):.    
+000048d0: 2020 2020 2020 2020 7769 7468 206d 6f63          with moc
+000048e0: 6b2e 7061 7463 6828 276d 6564 6961 6772  k.patch('mediagr
+000048f0: 6169 6e73 2e67 7366 2e75 7569 6431 272c  ains.gsf.uuid1',
+00004900: 2073 6964 655f 6566 6665 6374 3d75 7569   side_effect=uui
+00004910: 6473 293a 0a20 2020 2020 2020 2020 2020  ds):.           
+00004920: 2020 2020 2028 6865 6164 2c20 7365 676d       (head, segm
+00004930: 656e 7473 2920 3d20 6c6f 6164 7328 6475  ents) = loads(du
+00004940: 6d70 7328 5b67 7261 696e 302c 2067 7261  mps([grain0, gra
+00004950: 696e 315d 2929 0a0a 2020 2020 2020 2020  in1]))..        
+00004960: 7365 6c66 2e61 7373 6572 7449 6e28 2769  self.assertIn('i
+00004970: 6427 2c20 6865 6164 290a 2020 2020 2020  d', head).      
+00004980: 2020 7365 6c66 2e61 7373 6572 7449 6e28    self.assertIn(
+00004990: 6865 6164 5b27 6964 275d 2c20 7575 6964  head['id'], uuid
+000049a0: 7329 0a20 2020 2020 2020 2073 656c 662e  s).        self.
+000049b0: 6173 7365 7274 496e 2827 7461 6773 272c  assertIn('tags',
+000049c0: 2068 6561 6429 0a20 2020 2020 2020 2073   head).        s
+000049d0: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+000049e0: 6c65 6e28 6865 6164 5b27 7461 6773 275d  len(head['tags']
+000049f0: 292c 2030 290a 2020 2020 2020 2020 7365  ), 0).        se
+00004a00: 6c66 2e61 7373 6572 7449 6e28 2763 7265  lf.assertIn('cre
+00004a10: 6174 6564 272c 2068 6561 6429 0a20 2020  ated', head).   
+00004a20: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00004a30: 4571 7561 6c28 6865 6164 5b27 6372 6561  Equal(head['crea
+00004a40: 7465 6427 5d2c 2063 7265 6174 6564 290a  ted'], created).
+00004a50: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+00004a60: 6572 7449 6e28 2773 6567 6d65 6e74 7327  ertIn('segments'
+00004a70: 2c20 6865 6164 290a 2020 2020 2020 2020  , head).        
+00004a80: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+00004a90: 286c 656e 2868 6561 645b 2773 6567 6d65  (len(head['segme
+00004aa0: 6e74 7327 5d29 2c20 3129 0a20 2020 2020  nts']), 1).     
+00004ab0: 2020 2073 656c 662e 6173 7365 7274 496e     self.assertIn
+00004ac0: 2827 636f 756e 7427 2c20 6865 6164 5b27  ('count', head['
+00004ad0: 7365 676d 656e 7473 275d 5b30 5d29 0a20  segments'][0]). 
+00004ae0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+00004af0: 7274 4571 7561 6c28 6865 6164 5b27 7365  rtEqual(head['se
+00004b00: 676d 656e 7473 275d 5b30 5d5b 2763 6f75  gments'][0]['cou
+00004b10: 6e74 275d 2c20 3229 0a20 2020 2020 2020  nt'], 2).       
+00004b20: 2073 656c 662e 6173 7365 7274 496e 2827   self.assertIn('
+00004b30: 6c6f 6361 6c5f 6964 272c 2068 6561 645b  local_id', head[
+00004b40: 2773 6567 6d65 6e74 7327 5d5b 305d 290a  'segments'][0]).
+00004b50: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+00004b60: 6572 7445 7175 616c 2868 6561 645b 2773  ertEqual(head['s
+00004b70: 6567 6d65 6e74 7327 5d5b 305d 5b27 6c6f  egments'][0]['lo
+00004b80: 6361 6c5f 6964 275d 2c20 3129 0a20 2020  cal_id'], 1).   
+00004b90: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00004ba0: 496e 2827 6964 272c 2068 6561 645b 2773  In('id', head['s
+00004bb0: 6567 6d65 6e74 7327 5d5b 305d 290a 2020  egments'][0]).  
+00004bc0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00004bd0: 7449 6e28 6865 6164 5b27 7365 676d 656e  tIn(head['segmen
+00004be0: 7473 275d 5b30 5d5b 2769 6427 5d2c 2075  ts'][0]['id'], u
+00004bf0: 7569 6473 290a 2020 2020 2020 2020 7365  uids).        se
+00004c00: 6c66 2e61 7373 6572 7449 6e28 2774 6167  lf.assertIn('tag
+00004c10: 7327 2c20 6865 6164 5b27 7365 676d 656e  s', head['segmen
+00004c20: 7473 275d 5b30 5d29 0a20 2020 2020 2020  ts'][0]).       
+00004c30: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+00004c40: 6c28 6c65 6e28 6865 6164 5b27 7365 676d  l(len(head['segm
+00004c50: 656e 7473 275d 5b30 5d5b 2774 6167 7327  ents'][0]['tags'
+00004c60: 5d29 2c20 3029 0a0a 2020 2020 2020 2020  ]), 0)..        
 00004c70: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-00004c80: 2873 6567 6d65 6e74 735b 315d 5b31 5d2e  (segments[1][1].
-00004c90: 7361 6d70 6c65 5f72 6174 652c 2034 3830  sample_rate, 480
-00004ca0: 3030 290a 0a20 2020 2020 2020 2073 656c  00)..        sel
-00004cb0: 662e 6173 7365 7274 4571 7561 6c28 7365  f.assertEqual(se
-00004cc0: 676d 656e 7473 5b31 5d5b 315d 2e64 6174  gments[1][1].dat
-00004cd0: 612c 2067 7261 696e 312e 6461 7461 290a  a, grain1.data).
-00004ce0: 0a20 2020 2061 7379 6e63 2064 6566 2074  .    async def t
-00004cf0: 6573 745f 6173 796e 635f 656e 636f 6465  est_async_encode
-00004d00: 5f61 7564 696f 6772 6169 6e73 2873 656c  _audiograins(sel
-00004d10: 6629 3a0a 2020 2020 2020 2020 7372 635f  f):.        src_
-00004d20: 6964 203d 2055 5549 4428 2765 3134 6539  id = UUID('e14e9
-00004d30: 6435 382d 3135 3637 2d31 3165 382d 3864  d58-1567-11e8-8d
-00004d40: 6433 2d38 3331 6130 3638 6562 3033 3427  d3-831a068eb034'
-00004d50: 290a 2020 2020 2020 2020 666c 6f77 5f69  ).        flow_i
-00004d60: 6420 3d20 5555 4944 2827 6565 3165 6564  d = UUID('ee1eed
-00004d70: 3538 2d31 3536 372d 3131 6538 2d61 3937  58-1567-11e8-a97
-00004d80: 312d 3362 3930 3161 3264 6438 6162 2729  1-3b901a2dd8ab')
-00004d90: 0a20 2020 2020 2020 2067 7261 696e 3020  .        grain0 
-00004da0: 3d20 4175 6469 6f47 7261 696e 280a 2020  = AudioGrain(.  
-00004db0: 2020 2020 2020 2020 2020 7372 635f 6964            src_id
-00004dc0: 2c20 666c 6f77 5f69 642c 2063 6f67 5f61  , flow_id, cog_a
-00004dd0: 7564 696f 5f66 6f72 6d61 743d 436f 6741  udio_format=CogA
-00004de0: 7564 696f 466f 726d 6174 2e53 3136 5f50  udioFormat.S16_P
-00004df0: 4c41 4e45 532c 2073 616d 706c 6573 3d31  LANES, samples=1
-00004e00: 3932 302c 2073 616d 706c 655f 7261 7465  920, sample_rate
-00004e10: 3d34 3830 3030 290a 2020 2020 2020 2020  =48000).        
-00004e20: 6772 6169 6e31 203d 2041 7564 696f 4772  grain1 = AudioGr
-00004e30: 6169 6e28 0a20 2020 2020 2020 2020 2020  ain(.           
-00004e40: 2073 7263 5f69 642c 2066 6c6f 775f 6964   src_id, flow_id
-00004e50: 2c20 636f 675f 6175 6469 6f5f 666f 726d  , cog_audio_form
-00004e60: 6174 3d43 6f67 4175 6469 6f46 6f72 6d61  at=CogAudioForma
-00004e70: 742e 5331 365f 504c 414e 4553 2c20 7361  t.S16_PLANES, sa
-00004e80: 6d70 6c65 733d 3139 3230 2c20 7361 6d70  mples=1920, samp
-00004e90: 6c65 5f72 6174 653d 3438 3030 3029 0a20  le_rate=48000). 
-00004ea0: 2020 2020 2020 2066 6f72 2069 2069 6e20         for i in 
-00004eb0: 7261 6e67 6528 302c 206c 656e 2867 7261  range(0, len(gra
-00004ec0: 696e 302e 6461 7461 2929 3a0a 2020 2020  in0.data)):.    
-00004ed0: 2020 2020 2020 2020 6772 6169 6e30 2e64          grain0.d
-00004ee0: 6174 615b 695d 203d 2069 2026 2030 7846  ata[i] = i & 0xF
-00004ef0: 460a 2020 2020 2020 2020 666f 7220 6920  F.        for i 
-00004f00: 696e 2072 616e 6765 2830 2c20 6c65 6e28  in range(0, len(
-00004f10: 6772 6169 6e31 2e64 6174 6129 293a 0a20  grain1.data)):. 
-00004f20: 2020 2020 2020 2020 2020 2067 7261 696e             grain
-00004f30: 312e 6461 7461 5b69 5d20 3d20 3078 4646  1.data[i] = 0xFF
-00004f40: 202d 2028 6920 2620 3078 4646 290a 2020   - (i & 0xFF).  
-00004f50: 2020 2020 2020 7575 6964 7320 3d20 5b55        uuids = [U
-00004f60: 5549 4428 2737 3932 3062 3339 342d 3135  UID('7920b394-15
-00004f70: 3635 2d31 3165 382d 3836 6530 2d38 6234  65-11e8-86e0-8b4
-00004f80: 3264 3436 3437 6261 3827 292c 0a20 2020  2d4647ba8'),.   
-00004f90: 2020 2020 2020 2020 2020 2020 2020 5555                UU
-00004fa0: 4944 2827 3830 6166 3837 3563 2d31 3536  ID('80af875c-156
-00004fb0: 352d 3131 6538 2d38 6634 342d 3837 6566  5-11e8-8f44-87ef
-00004fc0: 3038 3162 3438 6364 2729 5d0a 2020 2020  081b48cd')].    
-00004fd0: 2020 2020 6372 6561 7465 6420 3d20 6461      created = da
-00004fe0: 7465 7469 6d65 2831 3938 332c 2033 2c20  tetime(1983, 3, 
-00004ff0: 3239 2c20 3135 2c20 3135 290a 2020 2020  29, 15, 15).    
-00005000: 2020 2020 7769 7468 206d 6f63 6b2e 7061      with mock.pa
-00005010: 7463 6828 276d 6564 6961 6772 6169 6e73  tch('mediagrains
-00005020: 2e67 7366 2e64 6174 6574 696d 6527 2c20  .gsf.datetime', 
-00005030: 7369 6465 5f65 6666 6563 743d 6461 7465  side_effect=date
-00005040: 7469 6d65 2c20 6e6f 773d 6d6f 636b 2e4d  time, now=mock.M
-00005050: 6167 6963 4d6f 636b 2872 6574 7572 6e5f  agicMock(return_
-00005060: 7661 6c75 653d 6372 6561 7465 6429 293a  value=created)):
-00005070: 0a20 2020 2020 2020 2020 2020 2077 6974  .            wit
-00005080: 6820 6d6f 636b 2e70 6174 6368 2827 6d65  h mock.patch('me
-00005090: 6469 6167 7261 696e 732e 6773 662e 7575  diagrains.gsf.uu
-000050a0: 6964 3127 2c20 7369 6465 5f65 6666 6563  id1', side_effec
-000050b0: 743d 7575 6964 7329 3a0a 2020 2020 2020  t=uuids):.      
-000050c0: 2020 2020 2020 2020 2020 6620 3d20 4279            f = By
-000050d0: 7465 7349 4f28 290a 2020 2020 2020 2020  tesIO().        
-000050e0: 2020 2020 2020 2020 6173 796e 6320 7769          async wi
-000050f0: 7468 2047 5346 456e 636f 6465 7228 6629  th GSFEncoder(f)
-00005100: 2061 7320 656e 633a 0a20 2020 2020 2020   as enc:.       
-00005110: 2020 2020 2020 2020 2020 2020 2061 7761               awa
-00005120: 6974 2065 6e63 2e61 6464 5f67 7261 696e  it enc.add_grain
-00005130: 7328 5b67 7261 696e 302c 2067 7261 696e  s([grain0, grain
-00005140: 315d 290a 2020 2020 2020 2020 2020 2020  1]).            
-00005150: 2020 2020 2868 6561 642c 2073 6567 6d65      (head, segme
-00005160: 6e74 7329 203d 206c 6f61 6473 2866 2e67  nts) = loads(f.g
-00005170: 6574 7661 6c75 6528 2929 0a0a 2020 2020  etvalue())..    
-00005180: 2020 2020 7365 6c66 2e61 7373 6572 7449      self.assertI
-00005190: 6e28 2769 6427 2c20 6865 6164 290a 2020  n('id', head).  
-000051a0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-000051b0: 7449 6e28 6865 6164 5b27 6964 275d 2c20  tIn(head['id'], 
-000051c0: 7575 6964 7329 0a20 2020 2020 2020 2073  uuids).        s
-000051d0: 656c 662e 6173 7365 7274 496e 2827 7461  elf.assertIn('ta
-000051e0: 6773 272c 2068 6561 6429 0a20 2020 2020  gs', head).     
-000051f0: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-00005200: 7561 6c28 6c65 6e28 6865 6164 5b27 7461  ual(len(head['ta
-00005210: 6773 275d 292c 2030 290a 2020 2020 2020  gs']), 0).      
-00005220: 2020 7365 6c66 2e61 7373 6572 7449 6e28    self.assertIn(
-00005230: 2763 7265 6174 6564 272c 2068 6561 6429  'created', head)
-00005240: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-00005250: 7365 7274 4571 7561 6c28 6865 6164 5b27  sertEqual(head['
-00005260: 6372 6561 7465 6427 5d2c 2063 7265 6174  created'], creat
-00005270: 6564 290a 2020 2020 2020 2020 7365 6c66  ed).        self
-00005280: 2e61 7373 6572 7449 6e28 2773 6567 6d65  .assertIn('segme
-00005290: 6e74 7327 2c20 6865 6164 290a 2020 2020  nts', head).    
-000052a0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-000052b0: 7175 616c 286c 656e 2868 6561 645b 2773  qual(len(head['s
-000052c0: 6567 6d65 6e74 7327 5d29 2c20 3129 0a20  egments']), 1). 
-000052d0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-000052e0: 7274 496e 2827 636f 756e 7427 2c20 6865  rtIn('count', he
-000052f0: 6164 5b27 7365 676d 656e 7473 275d 5b30  ad['segments'][0
-00005300: 5d29 0a20 2020 2020 2020 2073 656c 662e  ]).        self.
-00005310: 6173 7365 7274 4571 7561 6c28 6865 6164  assertEqual(head
-00005320: 5b27 7365 676d 656e 7473 275d 5b30 5d5b  ['segments'][0][
-00005330: 2763 6f75 6e74 275d 2c20 3229 0a20 2020  'count'], 2).   
-00005340: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00005350: 496e 2827 6c6f 6361 6c5f 6964 272c 2068  In('local_id', h
-00005360: 6561 645b 2773 6567 6d65 6e74 7327 5d5b  ead['segments'][
-00005370: 305d 290a 2020 2020 2020 2020 7365 6c66  0]).        self
-00005380: 2e61 7373 6572 7445 7175 616c 2868 6561  .assertEqual(hea
-00005390: 645b 2773 6567 6d65 6e74 7327 5d5b 305d  d['segments'][0]
-000053a0: 5b27 6c6f 6361 6c5f 6964 275d 2c20 3129  ['local_id'], 1)
-000053b0: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-000053c0: 7365 7274 496e 2827 6964 272c 2068 6561  sertIn('id', hea
-000053d0: 645b 2773 6567 6d65 6e74 7327 5d5b 305d  d['segments'][0]
-000053e0: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-000053f0: 7373 6572 7449 6e28 6865 6164 5b27 7365  ssertIn(head['se
-00005400: 676d 656e 7473 275d 5b30 5d5b 2769 6427  gments'][0]['id'
-00005410: 5d2c 2075 7569 6473 290a 2020 2020 2020  ], uuids).      
-00005420: 2020 7365 6c66 2e61 7373 6572 7449 6e28    self.assertIn(
-00005430: 2774 6167 7327 2c20 6865 6164 5b27 7365  'tags', head['se
-00005440: 676d 656e 7473 275d 5b30 5d29 0a20 2020  gments'][0]).   
-00005450: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00005460: 4571 7561 6c28 6c65 6e28 6865 6164 5b27  Equal(len(head['
-00005470: 7365 676d 656e 7473 275d 5b30 5d5b 2774  segments'][0]['t
-00005480: 6167 7327 5d29 2c20 3029 0a0a 2020 2020  ags']), 0)..    
-00005490: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-000054a0: 7175 616c 286c 656e 2873 6567 6d65 6e74  qual(len(segment
-000054b0: 7329 2c20 3129 0a20 2020 2020 2020 2073  s), 1).        s
-000054c0: 656c 662e 6173 7365 7274 496e 2831 2c20  elf.assertIn(1, 
-000054d0: 7365 676d 656e 7473 290a 2020 2020 2020  segments).      
-000054e0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-000054f0: 616c 286c 656e 2873 6567 6d65 6e74 735b  al(len(segments[
-00005500: 315d 292c 2068 6561 645b 2773 6567 6d65  1]), head['segme
-00005510: 6e74 7327 5d5b 305d 5b27 636f 756e 7427  nts'][0]['count'
-00005520: 5d29 0a0a 2020 2020 2020 2020 7365 6c66  ])..        self
-00005530: 2e61 7373 6572 7445 7175 616c 2873 6567  .assertEqual(seg
-00005540: 6d65 6e74 735b 315d 5b30 5d2e 736f 7572  ments[1][0].sour
-00005550: 6365 5f69 642c 2073 7263 5f69 6429 0a20  ce_id, src_id). 
-00005560: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00005570: 7274 4571 7561 6c28 7365 676d 656e 7473  rtEqual(segments
-00005580: 5b31 5d5b 305d 2e66 6c6f 775f 6964 2c20  [1][0].flow_id, 
-00005590: 666c 6f77 5f69 6429 0a20 2020 2020 2020  flow_id).       
-000055a0: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-000055b0: 6c28 7365 676d 656e 7473 5b31 5d5b 305d  l(segments[1][0]
-000055c0: 2e67 7261 696e 5f74 7970 652c 2027 6175  .grain_type, 'au
-000055d0: 6469 6f27 290a 2020 2020 2020 2020 7365  dio').        se
-000055e0: 6c66 2e61 7373 6572 7445 7175 616c 2873  lf.assertEqual(s
-000055f0: 6567 6d65 6e74 735b 315d 5b30 5d2e 666f  egments[1][0].fo
-00005600: 726d 6174 2c20 436f 6741 7564 696f 466f  rmat, CogAudioFo
-00005610: 726d 6174 2e53 3136 5f50 4c41 4e45 5329  rmat.S16_PLANES)
-00005620: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-00005630: 7365 7274 4571 7561 6c28 7365 676d 656e  sertEqual(segmen
-00005640: 7473 5b31 5d5b 305d 2e73 616d 706c 6573  ts[1][0].samples
-00005650: 2c20 3139 3230 290a 2020 2020 2020 2020  , 1920).        
-00005660: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-00005670: 2873 6567 6d65 6e74 735b 315d 5b30 5d2e  (segments[1][0].
-00005680: 7361 6d70 6c65 5f72 6174 652c 2034 3830  sample_rate, 480
-00005690: 3030 290a 0a20 2020 2020 2020 2073 656c  00)..        sel
-000056a0: 662e 6173 7365 7274 4571 7561 6c28 7365  f.assertEqual(se
-000056b0: 676d 656e 7473 5b31 5d5b 305d 2e64 6174  gments[1][0].dat
-000056c0: 612c 2067 7261 696e 302e 6461 7461 290a  a, grain0.data).
-000056d0: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-000056e0: 7365 7274 4571 7561 6c28 7365 676d 656e  sertEqual(segmen
-000056f0: 7473 5b31 5d5b 315d 2e73 6f75 7263 655f  ts[1][1].source_
-00005700: 6964 2c20 7372 635f 6964 290a 2020 2020  id, src_id).    
-00005710: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-00005720: 7175 616c 2873 6567 6d65 6e74 735b 315d  qual(segments[1]
-00005730: 5b31 5d2e 666c 6f77 5f69 642c 2066 6c6f  [1].flow_id, flo
-00005740: 775f 6964 290a 2020 2020 2020 2020 7365  w_id).        se
-00005750: 6c66 2e61 7373 6572 7445 7175 616c 2873  lf.assertEqual(s
-00005760: 6567 6d65 6e74 735b 315d 5b31 5d2e 6772  egments[1][1].gr
-00005770: 6169 6e5f 7479 7065 2c20 2761 7564 696f  ain_type, 'audio
-00005780: 2729 0a20 2020 2020 2020 2073 656c 662e  ').        self.
-00005790: 6173 7365 7274 4571 7561 6c28 7365 676d  assertEqual(segm
-000057a0: 656e 7473 5b31 5d5b 315d 2e66 6f72 6d61  ents[1][1].forma
-000057b0: 742c 2043 6f67 4175 6469 6f46 6f72 6d61  t, CogAudioForma
-000057c0: 742e 5331 365f 504c 414e 4553 290a 2020  t.S16_PLANES).  
-000057d0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-000057e0: 7445 7175 616c 2873 6567 6d65 6e74 735b  tEqual(segments[
-000057f0: 315d 5b31 5d2e 7361 6d70 6c65 732c 2031  1][1].samples, 1
-00005800: 3932 3029 0a20 2020 2020 2020 2073 656c  920).        sel
-00005810: 662e 6173 7365 7274 4571 7561 6c28 7365  f.assertEqual(se
-00005820: 676d 656e 7473 5b31 5d5b 315d 2e73 616d  gments[1][1].sam
-00005830: 706c 655f 7261 7465 2c20 3438 3030 3029  ple_rate, 48000)
-00005840: 0a0a 2020 2020 2020 2020 7365 6c66 2e61  ..        self.a
-00005850: 7373 6572 7445 7175 616c 2873 6567 6d65  ssertEqual(segme
-00005860: 6e74 735b 315d 5b31 5d2e 6461 7461 2c20  nts[1][1].data, 
-00005870: 6772 6169 6e31 2e64 6174 6129 0a0a 2020  grain1.data)..  
-00005880: 2020 6465 6620 7465 7374 5f64 756d 7073    def test_dumps
-00005890: 5f63 6f64 6564 7669 6465 6f67 7261 696e  _codedvideograin
-000058a0: 7328 7365 6c66 293a 0a20 2020 2020 2020  s(self):.       
-000058b0: 2073 7263 5f69 6420 3d20 5555 4944 2827   src_id = UUID('
-000058c0: 6531 3465 3964 3538 2d31 3536 372d 3131  e14e9d58-1567-11
-000058d0: 6538 2d38 6464 332d 3833 3161 3036 3865  e8-8dd3-831a068e
-000058e0: 6230 3334 2729 0a20 2020 2020 2020 2066  b034').        f
-000058f0: 6c6f 775f 6964 203d 2055 5549 4428 2765  low_id = UUID('e
-00005900: 6531 6565 6435 382d 3135 3637 2d31 3165  e1eed58-1567-11e
-00005910: 382d 6139 3731 2d33 6239 3031 6132 6464  8-a971-3b901a2dd
-00005920: 3861 6227 290a 2020 2020 2020 2020 6772  8ab').        gr
-00005930: 6169 6e30 203d 2043 6f64 6564 5669 6465  ain0 = CodedVide
-00005940: 6f47 7261 696e 280a 2020 2020 2020 2020  oGrain(.        
-00005950: 2020 2020 7372 635f 6964 2c0a 2020 2020      src_id,.    
-00005960: 2020 2020 2020 2020 666c 6f77 5f69 642c          flow_id,
-00005970: 0a20 2020 2020 2020 2020 2020 2063 6f67  .            cog
-00005980: 5f66 7261 6d65 5f66 6f72 6d61 743d 436f  _frame_format=Co
-00005990: 6746 7261 6d65 466f 726d 6174 2e56 4332  gFrameFormat.VC2
-000059a0: 2c0a 2020 2020 2020 2020 2020 2020 6f72  ,.            or
-000059b0: 6967 696e 5f77 6964 7468 3d31 3932 302c  igin_width=1920,
-000059c0: 0a20 2020 2020 2020 2020 2020 206f 7269  .            ori
-000059d0: 6769 6e5f 6865 6967 6874 3d31 3038 302c  gin_height=1080,
-000059e0: 0a20 2020 2020 2020 2020 2020 2063 6f64  .            cod
-000059f0: 6564 5f77 6964 7468 3d31 3932 302c 0a20  ed_width=1920,. 
-00005a00: 2020 2020 2020 2020 2020 2063 6f64 6564             coded
-00005a10: 5f68 6569 6768 743d 3130 3838 2c0a 2020  _height=1088,.  
-00005a20: 2020 2020 2020 2020 2020 6973 5f6b 6579            is_key
-00005a30: 5f66 7261 6d65 3d54 7275 652c 0a20 2020  _frame=True,.   
-00005a40: 2020 2020 2020 2020 2074 656d 706f 7261           tempora
-00005a50: 6c5f 6f66 6673 6574 3d2d 3233 2c0a 2020  l_offset=-23,.  
-00005a60: 2020 2020 2020 2020 2020 6c65 6e67 7468            length
-00005a70: 3d31 3032 342c 0a20 2020 2020 2020 2020  =1024,.         
-00005a80: 2020 2075 6e69 745f 6f66 6673 6574 733d     unit_offsets=
-00005a90: 5b35 2c20 3135 2c20 3130 355d 290a 2020  [5, 15, 105]).  
-00005aa0: 2020 2020 2020 6772 6169 6e31 203d 2043        grain1 = C
-00005ab0: 6f64 6564 5669 6465 6f47 7261 696e 280a  odedVideoGrain(.
-00005ac0: 2020 2020 2020 2020 2020 2020 7372 635f              src_
-00005ad0: 6964 2c0a 2020 2020 2020 2020 2020 2020  id,.            
-00005ae0: 666c 6f77 5f69 642c 0a20 2020 2020 2020  flow_id,.       
-00005af0: 2020 2020 2063 6f67 5f66 7261 6d65 5f66       cog_frame_f
-00005b00: 6f72 6d61 743d 436f 6746 7261 6d65 466f  ormat=CogFrameFo
-00005b10: 726d 6174 2e56 4332 2c0a 2020 2020 2020  rmat.VC2,.      
-00005b20: 2020 2020 2020 6f72 6967 696e 5f77 6964        origin_wid
-00005b30: 7468 3d31 3932 302c 0a20 2020 2020 2020  th=1920,.       
-00005b40: 2020 2020 206f 7269 6769 6e5f 6865 6967       origin_heig
-00005b50: 6874 3d31 3038 302c 0a20 2020 2020 2020  ht=1080,.       
-00005b60: 2020 2020 2063 6f64 6564 5f77 6964 7468       coded_width
-00005b70: 3d31 3932 302c 0a20 2020 2020 2020 2020  =1920,.         
-00005b80: 2020 2063 6f64 6564 5f68 6569 6768 743d     coded_height=
-00005b90: 3130 3838 2c0a 2020 2020 2020 2020 2020  1088,.          
-00005ba0: 2020 7465 6d70 6f72 616c 5f6f 6666 7365    temporal_offse
-00005bb0: 743d 3137 2c0a 2020 2020 2020 2020 2020  t=17,.          
-00005bc0: 2020 6c65 6e67 7468 3d32 3536 290a 2020    length=256).  
-00005bd0: 2020 2020 2020 666f 7220 6920 696e 2072        for i in r
-00005be0: 616e 6765 2830 2c20 6c65 6e28 6772 6169  ange(0, len(grai
-00005bf0: 6e30 2e64 6174 6129 293a 0a20 2020 2020  n0.data)):.     
-00005c00: 2020 2020 2020 2067 7261 696e 302e 6461         grain0.da
-00005c10: 7461 5b69 5d20 3d20 6920 2620 3078 4646  ta[i] = i & 0xFF
-00005c20: 0a20 2020 2020 2020 2066 6f72 2069 2069  .        for i i
-00005c30: 6e20 7261 6e67 6528 302c 206c 656e 2867  n range(0, len(g
-00005c40: 7261 696e 312e 6461 7461 2929 3a0a 2020  rain1.data)):.  
-00005c50: 2020 2020 2020 2020 2020 6772 6169 6e31            grain1
-00005c60: 2e64 6174 615b 695d 203d 2030 7846 4620  .data[i] = 0xFF 
-00005c70: 2d20 2869 2026 2030 7846 4629 0a20 2020  - (i & 0xFF).   
-00005c80: 2020 2020 2075 7569 6473 203d 205b 5555       uuids = [UU
-00005c90: 4944 2827 3739 3230 6233 3934 2d31 3536  ID('7920b394-156
-00005ca0: 352d 3131 6538 2d38 3665 302d 3862 3432  5-11e8-86e0-8b42
-00005cb0: 6434 3634 3762 6138 2729 2c0a 2020 2020  d4647ba8'),.    
-00005cc0: 2020 2020 2020 2020 2020 2020 2055 5549               UUI
-00005cd0: 4428 2738 3061 6638 3735 632d 3135 3635  D('80af875c-1565
-00005ce0: 2d31 3165 382d 3866 3434 2d38 3765 6630  -11e8-8f44-87ef0
-00005cf0: 3831 6234 3863 6427 295d 0a20 2020 2020  81b48cd')].     
-00005d00: 2020 2063 7265 6174 6564 203d 2064 6174     created = dat
-00005d10: 6574 696d 6528 3139 3833 2c20 332c 2032  etime(1983, 3, 2
-00005d20: 392c 2031 352c 2031 3529 0a20 2020 2020  9, 15, 15).     
-00005d30: 2020 2077 6974 6820 6d6f 636b 2e70 6174     with mock.pat
-00005d40: 6368 2827 6d65 6469 6167 7261 696e 732e  ch('mediagrains.
-00005d50: 6773 662e 6461 7465 7469 6d65 272c 2073  gsf.datetime', s
-00005d60: 6964 655f 6566 6665 6374 3d64 6174 6574  ide_effect=datet
-00005d70: 696d 652c 206e 6f77 3d6d 6f63 6b2e 4d61  ime, now=mock.Ma
-00005d80: 6769 634d 6f63 6b28 7265 7475 726e 5f76  gicMock(return_v
-00005d90: 616c 7565 3d63 7265 6174 6564 2929 3a0a  alue=created)):.
-00005da0: 2020 2020 2020 2020 2020 2020 7769 7468              with
-00005db0: 206d 6f63 6b2e 7061 7463 6828 276d 6564   mock.patch('med
-00005dc0: 6961 6772 6169 6e73 2e67 7366 2e75 7569  iagrains.gsf.uui
-00005dd0: 6431 272c 2073 6964 655f 6566 6665 6374  d1', side_effect
-00005de0: 3d75 7569 6473 293a 0a20 2020 2020 2020  =uuids):.       
-00005df0: 2020 2020 2020 2020 2028 6865 6164 2c20           (head, 
-00005e00: 7365 676d 656e 7473 2920 3d20 6c6f 6164  segments) = load
-00005e10: 7328 6475 6d70 7328 5b67 7261 696e 302c  s(dumps([grain0,
-00005e20: 2067 7261 696e 315d 2929 0a0a 2020 2020   grain1]))..    
-00005e30: 2020 2020 7365 6c66 2e61 7373 6572 7449      self.assertI
-00005e40: 6e28 2769 6427 2c20 6865 6164 290a 2020  n('id', head).  
-00005e50: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-00005e60: 7449 6e28 6865 6164 5b27 6964 275d 2c20  tIn(head['id'], 
-00005e70: 7575 6964 7329 0a20 2020 2020 2020 2073  uuids).        s
-00005e80: 656c 662e 6173 7365 7274 496e 2827 7461  elf.assertIn('ta
-00005e90: 6773 272c 2068 6561 6429 0a20 2020 2020  gs', head).     
-00005ea0: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-00005eb0: 7561 6c28 6c65 6e28 6865 6164 5b27 7461  ual(len(head['ta
-00005ec0: 6773 275d 292c 2030 290a 2020 2020 2020  gs']), 0).      
-00005ed0: 2020 7365 6c66 2e61 7373 6572 7449 6e28    self.assertIn(
-00005ee0: 2763 7265 6174 6564 272c 2068 6561 6429  'created', head)
-00005ef0: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-00005f00: 7365 7274 4571 7561 6c28 6865 6164 5b27  sertEqual(head['
-00005f10: 6372 6561 7465 6427 5d2c 2063 7265 6174  created'], creat
-00005f20: 6564 290a 2020 2020 2020 2020 7365 6c66  ed).        self
-00005f30: 2e61 7373 6572 7449 6e28 2773 6567 6d65  .assertIn('segme
-00005f40: 6e74 7327 2c20 6865 6164 290a 2020 2020  nts', head).    
-00005f50: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-00005f60: 7175 616c 286c 656e 2868 6561 645b 2773  qual(len(head['s
-00005f70: 6567 6d65 6e74 7327 5d29 2c20 3129 0a20  egments']), 1). 
-00005f80: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00005f90: 7274 496e 2827 636f 756e 7427 2c20 6865  rtIn('count', he
-00005fa0: 6164 5b27 7365 676d 656e 7473 275d 5b30  ad['segments'][0
-00005fb0: 5d29 0a20 2020 2020 2020 2073 656c 662e  ]).        self.
-00005fc0: 6173 7365 7274 4571 7561 6c28 6865 6164  assertEqual(head
-00005fd0: 5b27 7365 676d 656e 7473 275d 5b30 5d5b  ['segments'][0][
-00005fe0: 2763 6f75 6e74 275d 2c20 3229 0a20 2020  'count'], 2).   
-00005ff0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00006000: 496e 2827 6c6f 6361 6c5f 6964 272c 2068  In('local_id', h
-00006010: 6561 645b 2773 6567 6d65 6e74 7327 5d5b  ead['segments'][
-00006020: 305d 290a 2020 2020 2020 2020 7365 6c66  0]).        self
-00006030: 2e61 7373 6572 7445 7175 616c 2868 6561  .assertEqual(hea
-00006040: 645b 2773 6567 6d65 6e74 7327 5d5b 305d  d['segments'][0]
-00006050: 5b27 6c6f 6361 6c5f 6964 275d 2c20 3129  ['local_id'], 1)
-00006060: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-00006070: 7365 7274 496e 2827 6964 272c 2068 6561  sertIn('id', hea
-00006080: 645b 2773 6567 6d65 6e74 7327 5d5b 305d  d['segments'][0]
-00006090: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-000060a0: 7373 6572 7449 6e28 6865 6164 5b27 7365  ssertIn(head['se
-000060b0: 676d 656e 7473 275d 5b30 5d5b 2769 6427  gments'][0]['id'
-000060c0: 5d2c 2075 7569 6473 290a 2020 2020 2020  ], uuids).      
-000060d0: 2020 7365 6c66 2e61 7373 6572 7449 6e28    self.assertIn(
-000060e0: 2774 6167 7327 2c20 6865 6164 5b27 7365  'tags', head['se
-000060f0: 676d 656e 7473 275d 5b30 5d29 0a20 2020  gments'][0]).   
-00006100: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00006110: 4571 7561 6c28 6c65 6e28 6865 6164 5b27  Equal(len(head['
-00006120: 7365 676d 656e 7473 275d 5b30 5d5b 2774  segments'][0]['t
-00006130: 6167 7327 5d29 2c20 3029 0a0a 2020 2020  ags']), 0)..    
-00006140: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-00006150: 7175 616c 286c 656e 2873 6567 6d65 6e74  qual(len(segment
-00006160: 7329 2c20 3129 0a20 2020 2020 2020 2073  s), 1).        s
-00006170: 656c 662e 6173 7365 7274 496e 2831 2c20  elf.assertIn(1, 
-00006180: 7365 676d 656e 7473 290a 2020 2020 2020  segments).      
-00006190: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-000061a0: 616c 286c 656e 2873 6567 6d65 6e74 735b  al(len(segments[
-000061b0: 315d 292c 2068 6561 645b 2773 6567 6d65  1]), head['segme
-000061c0: 6e74 7327 5d5b 305d 5b27 636f 756e 7427  nts'][0]['count'
-000061d0: 5d29 0a0a 2020 2020 2020 2020 7365 6c66  ])..        self
-000061e0: 2e61 7373 6572 7445 7175 616c 2873 6567  .assertEqual(seg
-000061f0: 6d65 6e74 735b 315d 5b30 5d2e 736f 7572  ments[1][0].sour
-00006200: 6365 5f69 642c 2073 7263 5f69 6429 0a20  ce_id, src_id). 
-00006210: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00006220: 7274 4571 7561 6c28 7365 676d 656e 7473  rtEqual(segments
-00006230: 5b31 5d5b 305d 2e66 6c6f 775f 6964 2c20  [1][0].flow_id, 
-00006240: 666c 6f77 5f69 6429 0a20 2020 2020 2020  flow_id).       
-00006250: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-00006260: 6c28 7365 676d 656e 7473 5b31 5d5b 305d  l(segments[1][0]
-00006270: 2e67 7261 696e 5f74 7970 652c 2027 636f  .grain_type, 'co
-00006280: 6465 645f 7669 6465 6f27 290a 2020 2020  ded_video').    
-00006290: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-000062a0: 7175 616c 2873 6567 6d65 6e74 735b 315d  qual(segments[1]
-000062b0: 5b30 5d2e 666f 726d 6174 2c20 436f 6746  [0].format, CogF
-000062c0: 7261 6d65 466f 726d 6174 2e56 4332 290a  rameFormat.VC2).
-000062d0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-000062e0: 6572 7445 7175 616c 2873 6567 6d65 6e74  ertEqual(segment
-000062f0: 735b 315d 5b30 5d2e 6f72 6967 696e 5f77  s[1][0].origin_w
-00006300: 6964 7468 2c20 3139 3230 290a 2020 2020  idth, 1920).    
-00006310: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-00006320: 7175 616c 2873 6567 6d65 6e74 735b 315d  qual(segments[1]
-00006330: 5b30 5d2e 6f72 6967 696e 5f68 6569 6768  [0].origin_heigh
-00006340: 742c 2031 3038 3029 0a20 2020 2020 2020  t, 1080).       
-00006350: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-00006360: 6c28 7365 676d 656e 7473 5b31 5d5b 305d  l(segments[1][0]
-00006370: 2e63 6f64 6564 5f77 6964 7468 2c20 3139  .coded_width, 19
-00006380: 3230 290a 2020 2020 2020 2020 7365 6c66  20).        self
-00006390: 2e61 7373 6572 7445 7175 616c 2873 6567  .assertEqual(seg
-000063a0: 6d65 6e74 735b 315d 5b30 5d2e 636f 6465  ments[1][0].code
-000063b0: 645f 6865 6967 6874 2c20 3130 3838 290a  d_height, 1088).
-000063c0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-000063d0: 6572 7445 7175 616c 2873 6567 6d65 6e74  ertEqual(segment
-000063e0: 735b 315d 5b30 5d2e 7465 6d70 6f72 616c  s[1][0].temporal
-000063f0: 5f6f 6666 7365 742c 202d 3233 290a 2020  _offset, -23).  
-00006400: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-00006410: 7445 7175 616c 2873 6567 6d65 6e74 735b  tEqual(segments[
-00006420: 315d 5b30 5d2e 756e 6974 5f6f 6666 7365  1][0].unit_offse
-00006430: 7473 2c20 5b35 2c20 3135 2c20 3130 355d  ts, [5, 15, 105]
-00006440: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-00006450: 7373 6572 7454 7275 6528 7365 676d 656e  ssertTrue(segmen
-00006460: 7473 5b31 5d5b 305d 2e69 735f 6b65 795f  ts[1][0].is_key_
-00006470: 6672 616d 6529 0a0a 2020 2020 2020 2020  frame)..        
-00006480: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-00006490: 2873 6567 6d65 6e74 735b 315d 5b30 5d2e  (segments[1][0].
-000064a0: 6461 7461 2c20 6772 6169 6e30 2e64 6174  data, grain0.dat
-000064b0: 6129 0a0a 2020 2020 2020 2020 7365 6c66  a)..        self
-000064c0: 2e61 7373 6572 7445 7175 616c 2873 6567  .assertEqual(seg
-000064d0: 6d65 6e74 735b 315d 5b31 5d2e 736f 7572  ments[1][1].sour
-000064e0: 6365 5f69 642c 2073 7263 5f69 6429 0a20  ce_id, src_id). 
-000064f0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00006500: 7274 4571 7561 6c28 7365 676d 656e 7473  rtEqual(segments
-00006510: 5b31 5d5b 315d 2e66 6c6f 775f 6964 2c20  [1][1].flow_id, 
-00006520: 666c 6f77 5f69 6429 0a20 2020 2020 2020  flow_id).       
-00006530: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-00006540: 6c28 7365 676d 656e 7473 5b31 5d5b 315d  l(segments[1][1]
-00006550: 2e67 7261 696e 5f74 7970 652c 2027 636f  .grain_type, 'co
-00006560: 6465 645f 7669 6465 6f27 290a 2020 2020  ded_video').    
-00006570: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-00006580: 7175 616c 2873 6567 6d65 6e74 735b 315d  qual(segments[1]
-00006590: 5b31 5d2e 666f 726d 6174 2c20 436f 6746  [1].format, CogF
-000065a0: 7261 6d65 466f 726d 6174 2e56 4332 290a  rameFormat.VC2).
-000065b0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-000065c0: 6572 7445 7175 616c 2873 6567 6d65 6e74  ertEqual(segment
-000065d0: 735b 315d 5b31 5d2e 6f72 6967 696e 5f77  s[1][1].origin_w
-000065e0: 6964 7468 2c20 3139 3230 290a 2020 2020  idth, 1920).    
-000065f0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-00006600: 7175 616c 2873 6567 6d65 6e74 735b 315d  qual(segments[1]
-00006610: 5b31 5d2e 6f72 6967 696e 5f68 6569 6768  [1].origin_heigh
-00006620: 742c 2031 3038 3029 0a20 2020 2020 2020  t, 1080).       
-00006630: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-00006640: 6c28 7365 676d 656e 7473 5b31 5d5b 315d  l(segments[1][1]
-00006650: 2e63 6f64 6564 5f77 6964 7468 2c20 3139  .coded_width, 19
-00006660: 3230 290a 2020 2020 2020 2020 7365 6c66  20).        self
-00006670: 2e61 7373 6572 7445 7175 616c 2873 6567  .assertEqual(seg
-00006680: 6d65 6e74 735b 315d 5b31 5d2e 636f 6465  ments[1][1].code
-00006690: 645f 6865 6967 6874 2c20 3130 3838 290a  d_height, 1088).
-000066a0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-000066b0: 6572 7445 7175 616c 2873 6567 6d65 6e74  ertEqual(segment
-000066c0: 735b 315d 5b31 5d2e 7465 6d70 6f72 616c  s[1][1].temporal
-000066d0: 5f6f 6666 7365 742c 2031 3729 0a20 2020  _offset, 17).   
-000066e0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-000066f0: 4571 7561 6c28 7365 676d 656e 7473 5b31  Equal(segments[1
-00006700: 5d5b 315d 2e75 6e69 745f 6f66 6673 6574  ][1].unit_offset
-00006710: 732c 205b 5d29 0a20 2020 2020 2020 2073  s, []).        s
-00006720: 656c 662e 6173 7365 7274 4661 6c73 6528  elf.assertFalse(
-00006730: 7365 676d 656e 7473 5b31 5d5b 315d 2e69  segments[1][1].i
-00006740: 735f 6b65 795f 6672 616d 6529 0a0a 2020  s_key_frame)..  
-00006750: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-00006760: 7445 7175 616c 2873 6567 6d65 6e74 735b  tEqual(segments[
-00006770: 315d 5b31 5d2e 6461 7461 2c20 6772 6169  1][1].data, grai
-00006780: 6e31 2e64 6174 6129 0a0a 2020 2020 6173  n1.data)..    as
-00006790: 796e 6320 6465 6620 7465 7374 5f61 7379  ync def test_asy
-000067a0: 6e63 5f65 6e63 6f64 655f 636f 6465 6476  nc_encode_codedv
-000067b0: 6964 656f 6772 6169 6e73 2873 656c 6629  ideograins(self)
-000067c0: 3a0a 2020 2020 2020 2020 7372 635f 6964  :.        src_id
-000067d0: 203d 2055 5549 4428 2765 3134 6539 6435   = UUID('e14e9d5
-000067e0: 382d 3135 3637 2d31 3165 382d 3864 6433  8-1567-11e8-8dd3
-000067f0: 2d38 3331 6130 3638 6562 3033 3427 290a  -831a068eb034').
-00006800: 2020 2020 2020 2020 666c 6f77 5f69 6420          flow_id 
-00006810: 3d20 5555 4944 2827 6565 3165 6564 3538  = UUID('ee1eed58
-00006820: 2d31 3536 372d 3131 6538 2d61 3937 312d  -1567-11e8-a971-
-00006830: 3362 3930 3161 3264 6438 6162 2729 0a20  3b901a2dd8ab'). 
-00006840: 2020 2020 2020 2067 7261 696e 3020 3d20         grain0 = 
-00006850: 436f 6465 6456 6964 656f 4772 6169 6e28  CodedVideoGrain(
-00006860: 0a20 2020 2020 2020 2020 2020 2073 7263  .            src
-00006870: 5f69 642c 0a20 2020 2020 2020 2020 2020  _id,.           
-00006880: 2066 6c6f 775f 6964 2c0a 2020 2020 2020   flow_id,.      
-00006890: 2020 2020 2020 636f 675f 6672 616d 655f        cog_frame_
-000068a0: 666f 726d 6174 3d43 6f67 4672 616d 6546  format=CogFrameF
-000068b0: 6f72 6d61 742e 5643 322c 0a20 2020 2020  ormat.VC2,.     
-000068c0: 2020 2020 2020 206f 7269 6769 6e5f 7769         origin_wi
-000068d0: 6474 683d 3139 3230 2c0a 2020 2020 2020  dth=1920,.      
-000068e0: 2020 2020 2020 6f72 6967 696e 5f68 6569        origin_hei
-000068f0: 6768 743d 3130 3830 2c0a 2020 2020 2020  ght=1080,.      
-00006900: 2020 2020 2020 636f 6465 645f 7769 6474        coded_widt
-00006910: 683d 3139 3230 2c0a 2020 2020 2020 2020  h=1920,.        
-00006920: 2020 2020 636f 6465 645f 6865 6967 6874      coded_height
-00006930: 3d31 3038 382c 0a20 2020 2020 2020 2020  =1088,.         
-00006940: 2020 2069 735f 6b65 795f 6672 616d 653d     is_key_frame=
-00006950: 5472 7565 2c0a 2020 2020 2020 2020 2020  True,.          
-00006960: 2020 7465 6d70 6f72 616c 5f6f 6666 7365    temporal_offse
-00006970: 743d 2d32 332c 0a20 2020 2020 2020 2020  t=-23,.         
-00006980: 2020 206c 656e 6774 683d 3130 3234 2c0a     length=1024,.
-00006990: 2020 2020 2020 2020 2020 2020 756e 6974              unit
-000069a0: 5f6f 6666 7365 7473 3d5b 352c 2031 352c  _offsets=[5, 15,
-000069b0: 2031 3035 5d29 0a20 2020 2020 2020 2067   105]).        g
-000069c0: 7261 696e 3120 3d20 436f 6465 6456 6964  rain1 = CodedVid
-000069d0: 656f 4772 6169 6e28 0a20 2020 2020 2020  eoGrain(.       
-000069e0: 2020 2020 2073 7263 5f69 642c 0a20 2020       src_id,.   
-000069f0: 2020 2020 2020 2020 2066 6c6f 775f 6964           flow_id
-00006a00: 2c0a 2020 2020 2020 2020 2020 2020 636f  ,.            co
-00006a10: 675f 6672 616d 655f 666f 726d 6174 3d43  g_frame_format=C
-00006a20: 6f67 4672 616d 6546 6f72 6d61 742e 5643  ogFrameFormat.VC
-00006a30: 322c 0a20 2020 2020 2020 2020 2020 206f  2,.            o
-00006a40: 7269 6769 6e5f 7769 6474 683d 3139 3230  rigin_width=1920
-00006a50: 2c0a 2020 2020 2020 2020 2020 2020 6f72  ,.            or
-00006a60: 6967 696e 5f68 6569 6768 743d 3130 3830  igin_height=1080
-00006a70: 2c0a 2020 2020 2020 2020 2020 2020 636f  ,.            co
-00006a80: 6465 645f 7769 6474 683d 3139 3230 2c0a  ded_width=1920,.
-00006a90: 2020 2020 2020 2020 2020 2020 636f 6465              code
-00006aa0: 645f 6865 6967 6874 3d31 3038 382c 0a20  d_height=1088,. 
-00006ab0: 2020 2020 2020 2020 2020 2074 656d 706f             tempo
-00006ac0: 7261 6c5f 6f66 6673 6574 3d31 372c 0a20  ral_offset=17,. 
-00006ad0: 2020 2020 2020 2020 2020 206c 656e 6774             lengt
-00006ae0: 683d 3235 3629 0a20 2020 2020 2020 2066  h=256).        f
-00006af0: 6f72 2069 2069 6e20 7261 6e67 6528 302c  or i in range(0,
-00006b00: 206c 656e 2867 7261 696e 302e 6461 7461   len(grain0.data
-00006b10: 2929 3a0a 2020 2020 2020 2020 2020 2020  )):.            
-00006b20: 6772 6169 6e30 2e64 6174 615b 695d 203d  grain0.data[i] =
-00006b30: 2069 2026 2030 7846 460a 2020 2020 2020   i & 0xFF.      
-00006b40: 2020 666f 7220 6920 696e 2072 616e 6765    for i in range
-00006b50: 2830 2c20 6c65 6e28 6772 6169 6e31 2e64  (0, len(grain1.d
-00006b60: 6174 6129 293a 0a20 2020 2020 2020 2020  ata)):.         
-00006b70: 2020 2067 7261 696e 312e 6461 7461 5b69     grain1.data[i
-00006b80: 5d20 3d20 3078 4646 202d 2028 6920 2620  ] = 0xFF - (i & 
-00006b90: 3078 4646 290a 2020 2020 2020 2020 7575  0xFF).        uu
-00006ba0: 6964 7320 3d20 5b55 5549 4428 2737 3932  ids = [UUID('792
-00006bb0: 3062 3339 342d 3135 3635 2d31 3165 382d  0b394-1565-11e8-
-00006bc0: 3836 6530 2d38 6234 3264 3436 3437 6261  86e0-8b42d4647ba
-00006bd0: 3827 292c 0a20 2020 2020 2020 2020 2020  8'),.           
-00006be0: 2020 2020 2020 5555 4944 2827 3830 6166        UUID('80af
-00006bf0: 3837 3563 2d31 3536 352d 3131 6538 2d38  875c-1565-11e8-8
-00006c00: 6634 342d 3837 6566 3038 3162 3438 6364  f44-87ef081b48cd
-00006c10: 2729 5d0a 2020 2020 2020 2020 6372 6561  ')].        crea
-00006c20: 7465 6420 3d20 6461 7465 7469 6d65 2831  ted = datetime(1
-00006c30: 3938 332c 2033 2c20 3239 2c20 3135 2c20  983, 3, 29, 15, 
-00006c40: 3135 290a 2020 2020 2020 2020 7769 7468  15).        with
-00006c50: 206d 6f63 6b2e 7061 7463 6828 276d 6564   mock.patch('med
-00006c60: 6961 6772 6169 6e73 2e67 7366 2e64 6174  iagrains.gsf.dat
-00006c70: 6574 696d 6527 2c20 7369 6465 5f65 6666  etime', side_eff
-00006c80: 6563 743d 6461 7465 7469 6d65 2c20 6e6f  ect=datetime, no
-00006c90: 773d 6d6f 636b 2e4d 6167 6963 4d6f 636b  w=mock.MagicMock
-00006ca0: 2872 6574 7572 6e5f 7661 6c75 653d 6372  (return_value=cr
-00006cb0: 6561 7465 6429 293a 0a20 2020 2020 2020  eated)):.       
-00006cc0: 2020 2020 2077 6974 6820 6d6f 636b 2e70       with mock.p
-00006cd0: 6174 6368 2827 6d65 6469 6167 7261 696e  atch('mediagrain
-00006ce0: 732e 6773 662e 7575 6964 3127 2c20 7369  s.gsf.uuid1', si
-00006cf0: 6465 5f65 6666 6563 743d 7575 6964 7329  de_effect=uuids)
-00006d00: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00006d10: 2020 6620 3d20 4279 7465 7349 4f28 290a    f = BytesIO().
-00006d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006d30: 6173 796e 6320 7769 7468 2047 5346 456e  async with GSFEn
-00006d40: 636f 6465 7228 6629 2061 7320 656e 633a  coder(f) as enc:
-00006d50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00006d60: 2020 2020 2061 7761 6974 2065 6e63 2e61       await enc.a
-00006d70: 6464 5f67 7261 696e 7328 5b67 7261 696e  dd_grains([grain
-00006d80: 302c 2067 7261 696e 315d 290a 2020 2020  0, grain1]).    
-00006d90: 2020 2020 2020 2020 2020 2020 2868 6561              (hea
-00006da0: 642c 2073 6567 6d65 6e74 7329 203d 206c  d, segments) = l
-00006db0: 6f61 6473 2866 2e67 6574 7661 6c75 6528  oads(f.getvalue(
-00006dc0: 2929 0a0a 2020 2020 2020 2020 7365 6c66  ))..        self
-00006dd0: 2e61 7373 6572 7449 6e28 2769 6427 2c20  .assertIn('id', 
-00006de0: 6865 6164 290a 2020 2020 2020 2020 7365  head).        se
-00006df0: 6c66 2e61 7373 6572 7449 6e28 6865 6164  lf.assertIn(head
-00006e00: 5b27 6964 275d 2c20 7575 6964 7329 0a20  ['id'], uuids). 
-00006e10: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00006e20: 7274 496e 2827 7461 6773 272c 2068 6561  rtIn('tags', hea
-00006e30: 6429 0a20 2020 2020 2020 2073 656c 662e  d).        self.
-00006e40: 6173 7365 7274 4571 7561 6c28 6c65 6e28  assertEqual(len(
-00006e50: 6865 6164 5b27 7461 6773 275d 292c 2030  head['tags']), 0
-00006e60: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-00006e70: 7373 6572 7449 6e28 2763 7265 6174 6564  ssertIn('created
-00006e80: 272c 2068 6561 6429 0a20 2020 2020 2020  ', head).       
-00006e90: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-00006ea0: 6c28 6865 6164 5b27 6372 6561 7465 6427  l(head['created'
-00006eb0: 5d2c 2063 7265 6174 6564 290a 2020 2020  ], created).    
-00006ec0: 2020 2020 7365 6c66 2e61 7373 6572 7449      self.assertI
-00006ed0: 6e28 2773 6567 6d65 6e74 7327 2c20 6865  n('segments', he
-00006ee0: 6164 290a 2020 2020 2020 2020 7365 6c66  ad).        self
-00006ef0: 2e61 7373 6572 7445 7175 616c 286c 656e  .assertEqual(len
-00006f00: 2868 6561 645b 2773 6567 6d65 6e74 7327  (head['segments'
-00006f10: 5d29 2c20 3129 0a20 2020 2020 2020 2073  ]), 1).        s
-00006f20: 656c 662e 6173 7365 7274 496e 2827 636f  elf.assertIn('co
-00006f30: 756e 7427 2c20 6865 6164 5b27 7365 676d  unt', head['segm
-00006f40: 656e 7473 275d 5b30 5d29 0a20 2020 2020  ents'][0]).     
-00006f50: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-00006f60: 7561 6c28 6865 6164 5b27 7365 676d 656e  ual(head['segmen
-00006f70: 7473 275d 5b30 5d5b 2763 6f75 6e74 275d  ts'][0]['count']
-00006f80: 2c20 3229 0a20 2020 2020 2020 2073 656c  , 2).        sel
-00006f90: 662e 6173 7365 7274 496e 2827 6c6f 6361  f.assertIn('loca
-00006fa0: 6c5f 6964 272c 2068 6561 645b 2773 6567  l_id', head['seg
-00006fb0: 6d65 6e74 7327 5d5b 305d 290a 2020 2020  ments'][0]).    
-00006fc0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-00006fd0: 7175 616c 2868 6561 645b 2773 6567 6d65  qual(head['segme
-00006fe0: 6e74 7327 5d5b 305d 5b27 6c6f 6361 6c5f  nts'][0]['local_
-00006ff0: 6964 275d 2c20 3129 0a20 2020 2020 2020  id'], 1).       
-00007000: 2073 656c 662e 6173 7365 7274 496e 2827   self.assertIn('
-00007010: 6964 272c 2068 6561 645b 2773 6567 6d65  id', head['segme
-00007020: 6e74 7327 5d5b 305d 290a 2020 2020 2020  nts'][0]).      
-00007030: 2020 7365 6c66 2e61 7373 6572 7449 6e28    self.assertIn(
-00007040: 6865 6164 5b27 7365 676d 656e 7473 275d  head['segments']
-00007050: 5b30 5d5b 2769 6427 5d2c 2075 7569 6473  [0]['id'], uuids
-00007060: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-00007070: 7373 6572 7449 6e28 2774 6167 7327 2c20  ssertIn('tags', 
-00007080: 6865 6164 5b27 7365 676d 656e 7473 275d  head['segments']
-00007090: 5b30 5d29 0a20 2020 2020 2020 2073 656c  [0]).        sel
-000070a0: 662e 6173 7365 7274 4571 7561 6c28 6c65  f.assertEqual(le
-000070b0: 6e28 6865 6164 5b27 7365 676d 656e 7473  n(head['segments
-000070c0: 275d 5b30 5d5b 2774 6167 7327 5d29 2c20  '][0]['tags']), 
-000070d0: 3029 0a0a 2020 2020 2020 2020 7365 6c66  0)..        self
-000070e0: 2e61 7373 6572 7445 7175 616c 286c 656e  .assertEqual(len
-000070f0: 2873 6567 6d65 6e74 7329 2c20 3129 0a20  (segments), 1). 
-00007100: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00007110: 7274 496e 2831 2c20 7365 676d 656e 7473  rtIn(1, segments
-00007120: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-00007130: 7373 6572 7445 7175 616c 286c 656e 2873  ssertEqual(len(s
-00007140: 6567 6d65 6e74 735b 315d 292c 2068 6561  egments[1]), hea
-00007150: 645b 2773 6567 6d65 6e74 7327 5d5b 305d  d['segments'][0]
-00007160: 5b27 636f 756e 7427 5d29 0a0a 2020 2020  ['count'])..    
-00007170: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-00007180: 7175 616c 2873 6567 6d65 6e74 735b 315d  qual(segments[1]
-00007190: 5b30 5d2e 736f 7572 6365 5f69 642c 2073  [0].source_id, s
-000071a0: 7263 5f69 6429 0a20 2020 2020 2020 2073  rc_id).        s
-000071b0: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-000071c0: 7365 676d 656e 7473 5b31 5d5b 305d 2e66  segments[1][0].f
-000071d0: 6c6f 775f 6964 2c20 666c 6f77 5f69 6429  low_id, flow_id)
-000071e0: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-000071f0: 7365 7274 4571 7561 6c28 7365 676d 656e  sertEqual(segmen
-00007200: 7473 5b31 5d5b 305d 2e67 7261 696e 5f74  ts[1][0].grain_t
-00007210: 7970 652c 2027 636f 6465 645f 7669 6465  ype, 'coded_vide
-00007220: 6f27 290a 2020 2020 2020 2020 7365 6c66  o').        self
-00007230: 2e61 7373 6572 7445 7175 616c 2873 6567  .assertEqual(seg
-00007240: 6d65 6e74 735b 315d 5b30 5d2e 666f 726d  ments[1][0].form
-00007250: 6174 2c20 436f 6746 7261 6d65 466f 726d  at, CogFrameForm
-00007260: 6174 2e56 4332 290a 2020 2020 2020 2020  at.VC2).        
-00007270: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-00007280: 2873 6567 6d65 6e74 735b 315d 5b30 5d2e  (segments[1][0].
-00007290: 6f72 6967 696e 5f77 6964 7468 2c20 3139  origin_width, 19
-000072a0: 3230 290a 2020 2020 2020 2020 7365 6c66  20).        self
-000072b0: 2e61 7373 6572 7445 7175 616c 2873 6567  .assertEqual(seg
-000072c0: 6d65 6e74 735b 315d 5b30 5d2e 6f72 6967  ments[1][0].orig
-000072d0: 696e 5f68 6569 6768 742c 2031 3038 3029  in_height, 1080)
-000072e0: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-000072f0: 7365 7274 4571 7561 6c28 7365 676d 656e  sertEqual(segmen
-00007300: 7473 5b31 5d5b 305d 2e63 6f64 6564 5f77  ts[1][0].coded_w
-00007310: 6964 7468 2c20 3139 3230 290a 2020 2020  idth, 1920).    
-00007320: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-00007330: 7175 616c 2873 6567 6d65 6e74 735b 315d  qual(segments[1]
-00007340: 5b30 5d2e 636f 6465 645f 6865 6967 6874  [0].coded_height
-00007350: 2c20 3130 3838 290a 2020 2020 2020 2020  , 1088).        
-00007360: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-00007370: 2873 6567 6d65 6e74 735b 315d 5b30 5d2e  (segments[1][0].
-00007380: 7465 6d70 6f72 616c 5f6f 6666 7365 742c  temporal_offset,
-00007390: 202d 3233 290a 2020 2020 2020 2020 7365   -23).        se
-000073a0: 6c66 2e61 7373 6572 7445 7175 616c 2873  lf.assertEqual(s
-000073b0: 6567 6d65 6e74 735b 315d 5b30 5d2e 756e  egments[1][0].un
-000073c0: 6974 5f6f 6666 7365 7473 2c20 5b35 2c20  it_offsets, [5, 
-000073d0: 3135 2c20 3130 355d 290a 2020 2020 2020  15, 105]).      
-000073e0: 2020 7365 6c66 2e61 7373 6572 7454 7275    self.assertTru
-000073f0: 6528 7365 676d 656e 7473 5b31 5d5b 305d  e(segments[1][0]
-00007400: 2e69 735f 6b65 795f 6672 616d 6529 0a0a  .is_key_frame)..
-00007410: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-00007420: 6572 7445 7175 616c 2873 6567 6d65 6e74  ertEqual(segment
-00007430: 735b 315d 5b30 5d2e 6461 7461 2c20 6772  s[1][0].data, gr
-00007440: 6169 6e30 2e64 6174 6129 0a0a 2020 2020  ain0.data)..    
-00007450: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-00007460: 7175 616c 2873 6567 6d65 6e74 735b 315d  qual(segments[1]
-00007470: 5b31 5d2e 736f 7572 6365 5f69 642c 2073  [1].source_id, s
-00007480: 7263 5f69 6429 0a20 2020 2020 2020 2073  rc_id).        s
-00007490: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-000074a0: 7365 676d 656e 7473 5b31 5d5b 315d 2e66  segments[1][1].f
-000074b0: 6c6f 775f 6964 2c20 666c 6f77 5f69 6429  low_id, flow_id)
-000074c0: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-000074d0: 7365 7274 4571 7561 6c28 7365 676d 656e  sertEqual(segmen
-000074e0: 7473 5b31 5d5b 315d 2e67 7261 696e 5f74  ts[1][1].grain_t
-000074f0: 7970 652c 2027 636f 6465 645f 7669 6465  ype, 'coded_vide
-00007500: 6f27 290a 2020 2020 2020 2020 7365 6c66  o').        self
-00007510: 2e61 7373 6572 7445 7175 616c 2873 6567  .assertEqual(seg
-00007520: 6d65 6e74 735b 315d 5b31 5d2e 666f 726d  ments[1][1].form
-00007530: 6174 2c20 436f 6746 7261 6d65 466f 726d  at, CogFrameForm
-00007540: 6174 2e56 4332 290a 2020 2020 2020 2020  at.VC2).        
-00007550: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-00007560: 2873 6567 6d65 6e74 735b 315d 5b31 5d2e  (segments[1][1].
-00007570: 6f72 6967 696e 5f77 6964 7468 2c20 3139  origin_width, 19
-00007580: 3230 290a 2020 2020 2020 2020 7365 6c66  20).        self
-00007590: 2e61 7373 6572 7445 7175 616c 2873 6567  .assertEqual(seg
-000075a0: 6d65 6e74 735b 315d 5b31 5d2e 6f72 6967  ments[1][1].orig
-000075b0: 696e 5f68 6569 6768 742c 2031 3038 3029  in_height, 1080)
-000075c0: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-000075d0: 7365 7274 4571 7561 6c28 7365 676d 656e  sertEqual(segmen
-000075e0: 7473 5b31 5d5b 315d 2e63 6f64 6564 5f77  ts[1][1].coded_w
-000075f0: 6964 7468 2c20 3139 3230 290a 2020 2020  idth, 1920).    
-00007600: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-00007610: 7175 616c 2873 6567 6d65 6e74 735b 315d  qual(segments[1]
-00007620: 5b31 5d2e 636f 6465 645f 6865 6967 6874  [1].coded_height
-00007630: 2c20 3130 3838 290a 2020 2020 2020 2020  , 1088).        
-00007640: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-00007650: 2873 6567 6d65 6e74 735b 315d 5b31 5d2e  (segments[1][1].
-00007660: 7465 6d70 6f72 616c 5f6f 6666 7365 742c  temporal_offset,
-00007670: 2031 3729 0a20 2020 2020 2020 2073 656c   17).        sel
-00007680: 662e 6173 7365 7274 4571 7561 6c28 7365  f.assertEqual(se
-00007690: 676d 656e 7473 5b31 5d5b 315d 2e75 6e69  gments[1][1].uni
-000076a0: 745f 6f66 6673 6574 732c 205b 5d29 0a20  t_offsets, []). 
-000076b0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-000076c0: 7274 4661 6c73 6528 7365 676d 656e 7473  rtFalse(segments
-000076d0: 5b31 5d5b 315d 2e69 735f 6b65 795f 6672  [1][1].is_key_fr
-000076e0: 616d 6529 0a0a 2020 2020 2020 2020 7365  ame)..        se
-000076f0: 6c66 2e61 7373 6572 7445 7175 616c 2873  lf.assertEqual(s
-00007700: 6567 6d65 6e74 735b 315d 5b31 5d2e 6461  egments[1][1].da
-00007710: 7461 2c20 6772 6169 6e31 2e64 6174 6129  ta, grain1.data)
-00007720: 0a0a 2020 2020 6465 6620 7465 7374 5f64  ..    def test_d
-00007730: 756d 7073 5f63 6f64 6564 6175 6469 6f67  umps_codedaudiog
-00007740: 7261 696e 7328 7365 6c66 293a 0a20 2020  rains(self):.   
-00007750: 2020 2020 2073 7263 5f69 6420 3d20 5555       src_id = UU
-00007760: 4944 2827 6531 3465 3964 3538 2d31 3536  ID('e14e9d58-156
-00007770: 372d 3131 6538 2d38 6464 332d 3833 3161  7-11e8-8dd3-831a
-00007780: 3036 3865 6230 3334 2729 0a20 2020 2020  068eb034').     
-00007790: 2020 2066 6c6f 775f 6964 203d 2055 5549     flow_id = UUI
-000077a0: 4428 2765 6531 6565 6435 382d 3135 3637  D('ee1eed58-1567
-000077b0: 2d31 3165 382d 6139 3731 2d33 6239 3031  -11e8-a971-3b901
-000077c0: 6132 6464 3861 6227 290a 2020 2020 2020  a2dd8ab').      
-000077d0: 2020 6772 6169 6e30 203d 2043 6f64 6564    grain0 = Coded
-000077e0: 4175 6469 6f47 7261 696e 280a 2020 2020  AudioGrain(.    
-000077f0: 2020 2020 2020 2020 7372 635f 6964 2c0a          src_id,.
-00007800: 2020 2020 2020 2020 2020 2020 666c 6f77              flow
-00007810: 5f69 642c 0a20 2020 2020 2020 2020 2020  _id,.           
-00007820: 2063 6f67 5f61 7564 696f 5f66 6f72 6d61   cog_audio_forma
-00007830: 743d 436f 6741 7564 696f 466f 726d 6174  t=CogAudioFormat
-00007840: 2e41 4143 2c0a 2020 2020 2020 2020 2020  .AAC,.          
-00007850: 2020 7361 6d70 6c65 733d 3139 3230 2c0a    samples=1920,.
-00007860: 2020 2020 2020 2020 2020 2020 7361 6d70              samp
-00007870: 6c65 5f72 6174 653d 3438 3030 302c 0a20  le_rate=48000,. 
-00007880: 2020 2020 2020 2020 2020 2070 7269 6d69             primi
-00007890: 6e67 3d32 332c 0a20 2020 2020 2020 2020  ng=23,.         
-000078a0: 2020 2072 656d 6169 6e64 6572 3d31 372c     remainder=17,
-000078b0: 0a20 2020 2020 2020 2020 2020 206c 656e  .            len
-000078c0: 6774 683d 3130 3234 290a 2020 2020 2020  gth=1024).      
-000078d0: 2020 6772 6169 6e31 203d 2043 6f64 6564    grain1 = Coded
-000078e0: 4175 6469 6f47 7261 696e 280a 2020 2020  AudioGrain(.    
-000078f0: 2020 2020 2020 2020 7372 635f 6964 2c0a          src_id,.
-00007900: 2020 2020 2020 2020 2020 2020 666c 6f77              flow
-00007910: 5f69 642c 0a20 2020 2020 2020 2020 2020  _id,.           
-00007920: 2063 6f67 5f61 7564 696f 5f66 6f72 6d61   cog_audio_forma
-00007930: 743d 436f 6741 7564 696f 466f 726d 6174  t=CogAudioFormat
-00007940: 2e41 4143 2c0a 2020 2020 2020 2020 2020  .AAC,.          
-00007950: 2020 7361 6d70 6c65 733d 3139 3230 2c0a    samples=1920,.
-00007960: 2020 2020 2020 2020 2020 2020 7361 6d70              samp
-00007970: 6c65 5f72 6174 653d 3438 3030 302c 0a20  le_rate=48000,. 
-00007980: 2020 2020 2020 2020 2020 2070 7269 6d69             primi
-00007990: 6e67 3d35 2c0a 2020 2020 2020 2020 2020  ng=5,.          
-000079a0: 2020 7265 6d61 696e 6465 723d 3130 342c    remainder=104,
-000079b0: 0a20 2020 2020 2020 2020 2020 206c 656e  .            len
-000079c0: 6774 683d 3135 3030 290a 2020 2020 2020  gth=1500).      
-000079d0: 2020 666f 7220 6920 696e 2072 616e 6765    for i in range
-000079e0: 2830 2c20 6c65 6e28 6772 6169 6e30 2e64  (0, len(grain0.d
-000079f0: 6174 6129 293a 0a20 2020 2020 2020 2020  ata)):.         
-00007a00: 2020 2067 7261 696e 302e 6461 7461 5b69     grain0.data[i
-00007a10: 5d20 3d20 6920 2620 3078 4646 0a20 2020  ] = i & 0xFF.   
-00007a20: 2020 2020 2066 6f72 2069 2069 6e20 7261       for i in ra
-00007a30: 6e67 6528 302c 206c 656e 2867 7261 696e  nge(0, len(grain
-00007a40: 312e 6461 7461 2929 3a0a 2020 2020 2020  1.data)):.      
-00007a50: 2020 2020 2020 6772 6169 6e31 2e64 6174        grain1.dat
-00007a60: 615b 695d 203d 2030 7846 4620 2d20 2869  a[i] = 0xFF - (i
-00007a70: 2026 2030 7846 4629 0a20 2020 2020 2020   & 0xFF).       
-00007a80: 2075 7569 6473 203d 205b 5555 4944 2827   uuids = [UUID('
-00007a90: 3739 3230 6233 3934 2d31 3536 352d 3131  7920b394-1565-11
-00007aa0: 6538 2d38 3665 302d 3862 3432 6434 3634  e8-86e0-8b42d464
-00007ab0: 3762 6138 2729 2c0a 2020 2020 2020 2020  7ba8'),.        
-00007ac0: 2020 2020 2020 2020 2055 5549 4428 2738           UUID('8
-00007ad0: 3061 6638 3735 632d 3135 3635 2d31 3165  0af875c-1565-11e
-00007ae0: 382d 3866 3434 2d38 3765 6630 3831 6234  8-8f44-87ef081b4
-00007af0: 3863 6427 295d 0a20 2020 2020 2020 2063  8cd')].        c
-00007b00: 7265 6174 6564 203d 2064 6174 6574 696d  reated = datetim
-00007b10: 6528 3139 3833 2c20 332c 2032 392c 2031  e(1983, 3, 29, 1
-00007b20: 352c 2031 3529 0a20 2020 2020 2020 2077  5, 15).        w
-00007b30: 6974 6820 6d6f 636b 2e70 6174 6368 2827  ith mock.patch('
-00007b40: 6d65 6469 6167 7261 696e 732e 6773 662e  mediagrains.gsf.
-00007b50: 6461 7465 7469 6d65 272c 2073 6964 655f  datetime', side_
-00007b60: 6566 6665 6374 3d64 6174 6574 696d 652c  effect=datetime,
-00007b70: 206e 6f77 3d6d 6f63 6b2e 4d61 6769 634d   now=mock.MagicM
-00007b80: 6f63 6b28 7265 7475 726e 5f76 616c 7565  ock(return_value
-00007b90: 3d63 7265 6174 6564 2929 3a0a 2020 2020  =created)):.    
-00007ba0: 2020 2020 2020 2020 7769 7468 206d 6f63          with moc
-00007bb0: 6b2e 7061 7463 6828 276d 6564 6961 6772  k.patch('mediagr
-00007bc0: 6169 6e73 2e67 7366 2e75 7569 6431 272c  ains.gsf.uuid1',
-00007bd0: 2073 6964 655f 6566 6665 6374 3d75 7569   side_effect=uui
-00007be0: 6473 293a 0a20 2020 2020 2020 2020 2020  ds):.           
-00007bf0: 2020 2020 2028 6865 6164 2c20 7365 676d       (head, segm
-00007c00: 656e 7473 2920 3d20 6c6f 6164 7328 6475  ents) = loads(du
-00007c10: 6d70 7328 5b67 7261 696e 302c 2067 7261  mps([grain0, gra
-00007c20: 696e 315d 2929 0a0a 2020 2020 2020 2020  in1]))..        
-00007c30: 7365 6c66 2e61 7373 6572 7449 6e28 2769  self.assertIn('i
-00007c40: 6427 2c20 6865 6164 290a 2020 2020 2020  d', head).      
-00007c50: 2020 7365 6c66 2e61 7373 6572 7449 6e28    self.assertIn(
-00007c60: 6865 6164 5b27 6964 275d 2c20 7575 6964  head['id'], uuid
-00007c70: 7329 0a20 2020 2020 2020 2073 656c 662e  s).        self.
-00007c80: 6173 7365 7274 496e 2827 7461 6773 272c  assertIn('tags',
-00007c90: 2068 6561 6429 0a20 2020 2020 2020 2073   head).        s
-00007ca0: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-00007cb0: 6c65 6e28 6865 6164 5b27 7461 6773 275d  len(head['tags']
-00007cc0: 292c 2030 290a 2020 2020 2020 2020 7365  ), 0).        se
-00007cd0: 6c66 2e61 7373 6572 7449 6e28 2763 7265  lf.assertIn('cre
-00007ce0: 6174 6564 272c 2068 6561 6429 0a20 2020  ated', head).   
-00007cf0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00007d00: 4571 7561 6c28 6865 6164 5b27 6372 6561  Equal(head['crea
-00007d10: 7465 6427 5d2c 2063 7265 6174 6564 290a  ted'], created).
-00007d20: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-00007d30: 6572 7449 6e28 2773 6567 6d65 6e74 7327  ertIn('segments'
-00007d40: 2c20 6865 6164 290a 2020 2020 2020 2020  , head).        
-00007d50: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-00007d60: 286c 656e 2868 6561 645b 2773 6567 6d65  (len(head['segme
-00007d70: 6e74 7327 5d29 2c20 3129 0a20 2020 2020  nts']), 1).     
-00007d80: 2020 2073 656c 662e 6173 7365 7274 496e     self.assertIn
-00007d90: 2827 636f 756e 7427 2c20 6865 6164 5b27  ('count', head['
-00007da0: 7365 676d 656e 7473 275d 5b30 5d29 0a20  segments'][0]). 
-00007db0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00007dc0: 7274 4571 7561 6c28 6865 6164 5b27 7365  rtEqual(head['se
-00007dd0: 676d 656e 7473 275d 5b30 5d5b 2763 6f75  gments'][0]['cou
-00007de0: 6e74 275d 2c20 3229 0a20 2020 2020 2020  nt'], 2).       
-00007df0: 2073 656c 662e 6173 7365 7274 496e 2827   self.assertIn('
-00007e00: 6c6f 6361 6c5f 6964 272c 2068 6561 645b  local_id', head[
-00007e10: 2773 6567 6d65 6e74 7327 5d5b 305d 290a  'segments'][0]).
-00007e20: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-00007e30: 6572 7445 7175 616c 2868 6561 645b 2773  ertEqual(head['s
-00007e40: 6567 6d65 6e74 7327 5d5b 305d 5b27 6c6f  egments'][0]['lo
-00007e50: 6361 6c5f 6964 275d 2c20 3129 0a20 2020  cal_id'], 1).   
-00007e60: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00007e70: 496e 2827 6964 272c 2068 6561 645b 2773  In('id', head['s
-00007e80: 6567 6d65 6e74 7327 5d5b 305d 290a 2020  egments'][0]).  
-00007e90: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-00007ea0: 7449 6e28 6865 6164 5b27 7365 676d 656e  tIn(head['segmen
-00007eb0: 7473 275d 5b30 5d5b 2769 6427 5d2c 2075  ts'][0]['id'], u
-00007ec0: 7569 6473 290a 2020 2020 2020 2020 7365  uids).        se
-00007ed0: 6c66 2e61 7373 6572 7449 6e28 2774 6167  lf.assertIn('tag
-00007ee0: 7327 2c20 6865 6164 5b27 7365 676d 656e  s', head['segmen
-00007ef0: 7473 275d 5b30 5d29 0a20 2020 2020 2020  ts'][0]).       
-00007f00: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-00007f10: 6c28 6c65 6e28 6865 6164 5b27 7365 676d  l(len(head['segm
-00007f20: 656e 7473 275d 5b30 5d5b 2774 6167 7327  ents'][0]['tags'
-00007f30: 5d29 2c20 3029 0a0a 2020 2020 2020 2020  ]), 0)..        
-00007f40: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-00007f50: 286c 656e 2873 6567 6d65 6e74 7329 2c20  (len(segments), 
-00007f60: 3129 0a20 2020 2020 2020 2073 656c 662e  1).        self.
-00007f70: 6173 7365 7274 496e 2831 2c20 7365 676d  assertIn(1, segm
-00007f80: 656e 7473 290a 2020 2020 2020 2020 7365  ents).        se
-00007f90: 6c66 2e61 7373 6572 7445 7175 616c 286c  lf.assertEqual(l
-00007fa0: 656e 2873 6567 6d65 6e74 735b 315d 292c  en(segments[1]),
-00007fb0: 2068 6561 645b 2773 6567 6d65 6e74 7327   head['segments'
-00007fc0: 5d5b 305d 5b27 636f 756e 7427 5d29 0a0a  ][0]['count'])..
-00007fd0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-00007fe0: 6572 7445 7175 616c 2873 6567 6d65 6e74  ertEqual(segment
-00007ff0: 735b 315d 5b30 5d2e 736f 7572 6365 5f69  s[1][0].source_i
-00008000: 642c 2073 7263 5f69 6429 0a20 2020 2020  d, src_id).     
-00008010: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-00008020: 7561 6c28 7365 676d 656e 7473 5b31 5d5b  ual(segments[1][
-00008030: 305d 2e66 6c6f 775f 6964 2c20 666c 6f77  0].flow_id, flow
-00008040: 5f69 6429 0a20 2020 2020 2020 2073 656c  _id).        sel
-00008050: 662e 6173 7365 7274 4571 7561 6c28 7365  f.assertEqual(se
-00008060: 676d 656e 7473 5b31 5d5b 305d 2e67 7261  gments[1][0].gra
-00008070: 696e 5f74 7970 652c 2027 636f 6465 645f  in_type, 'coded_
-00008080: 6175 6469 6f27 290a 2020 2020 2020 2020  audio').        
+00004c80: 286c 656e 2873 6567 6d65 6e74 7329 2c20  (len(segments), 
+00004c90: 3129 0a20 2020 2020 2020 2073 656c 662e  1).        self.
+00004ca0: 6173 7365 7274 496e 2831 2c20 7365 676d  assertIn(1, segm
+00004cb0: 656e 7473 290a 2020 2020 2020 2020 7365  ents).        se
+00004cc0: 6c66 2e61 7373 6572 7445 7175 616c 286c  lf.assertEqual(l
+00004cd0: 656e 2873 6567 6d65 6e74 735b 315d 292c  en(segments[1]),
+00004ce0: 2068 6561 645b 2773 6567 6d65 6e74 7327   head['segments'
+00004cf0: 5d5b 305d 5b27 636f 756e 7427 5d29 0a0a  ][0]['count'])..
+00004d00: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+00004d10: 6572 7445 7175 616c 2873 6567 6d65 6e74  ertEqual(segment
+00004d20: 735b 315d 5b30 5d2e 736f 7572 6365 5f69  s[1][0].source_i
+00004d30: 642c 2073 7263 5f69 6429 0a20 2020 2020  d, src_id).     
+00004d40: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+00004d50: 7561 6c28 7365 676d 656e 7473 5b31 5d5b  ual(segments[1][
+00004d60: 305d 2e66 6c6f 775f 6964 2c20 666c 6f77  0].flow_id, flow
+00004d70: 5f69 6429 0a20 2020 2020 2020 2073 656c  _id).        sel
+00004d80: 662e 6173 7365 7274 4571 7561 6c28 7365  f.assertEqual(se
+00004d90: 676d 656e 7473 5b31 5d5b 305d 2e67 7261  gments[1][0].gra
+00004da0: 696e 5f74 7970 652c 2027 6175 6469 6f27  in_type, 'audio'
+00004db0: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+00004dc0: 7373 6572 7445 7175 616c 2873 6567 6d65  ssertEqual(segme
+00004dd0: 6e74 735b 315d 5b30 5d2e 666f 726d 6174  nts[1][0].format
+00004de0: 2c20 436f 6741 7564 696f 466f 726d 6174  , CogAudioFormat
+00004df0: 2e53 3136 5f50 4c41 4e45 5329 0a20 2020  .S16_PLANES).   
+00004e00: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00004e10: 4571 7561 6c28 7365 676d 656e 7473 5b31  Equal(segments[1
+00004e20: 5d5b 305d 2e73 616d 706c 6573 2c20 3139  ][0].samples, 19
+00004e30: 3230 290a 2020 2020 2020 2020 7365 6c66  20).        self
+00004e40: 2e61 7373 6572 7445 7175 616c 2873 6567  .assertEqual(seg
+00004e50: 6d65 6e74 735b 315d 5b30 5d2e 7361 6d70  ments[1][0].samp
+00004e60: 6c65 5f72 6174 652c 2034 3830 3030 290a  le_rate, 48000).
+00004e70: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+00004e80: 7365 7274 4571 7561 6c28 7365 676d 656e  sertEqual(segmen
+00004e90: 7473 5b31 5d5b 305d 2e64 6174 612c 2067  ts[1][0].data, g
+00004ea0: 7261 696e 302e 6461 7461 290a 0a20 2020  rain0.data)..   
+00004eb0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00004ec0: 4571 7561 6c28 7365 676d 656e 7473 5b31  Equal(segments[1
+00004ed0: 5d5b 315d 2e73 6f75 7263 655f 6964 2c20  ][1].source_id, 
+00004ee0: 7372 635f 6964 290a 2020 2020 2020 2020  src_id).        
+00004ef0: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+00004f00: 2873 6567 6d65 6e74 735b 315d 5b31 5d2e  (segments[1][1].
+00004f10: 666c 6f77 5f69 642c 2066 6c6f 775f 6964  flow_id, flow_id
+00004f20: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+00004f30: 7373 6572 7445 7175 616c 2873 6567 6d65  ssertEqual(segme
+00004f40: 6e74 735b 315d 5b31 5d2e 6772 6169 6e5f  nts[1][1].grain_
+00004f50: 7479 7065 2c20 2761 7564 696f 2729 0a20  type, 'audio'). 
+00004f60: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+00004f70: 7274 4571 7561 6c28 7365 676d 656e 7473  rtEqual(segments
+00004f80: 5b31 5d5b 315d 2e66 6f72 6d61 742c 2043  [1][1].format, C
+00004f90: 6f67 4175 6469 6f46 6f72 6d61 742e 5331  ogAudioFormat.S1
+00004fa0: 365f 504c 414e 4553 290a 2020 2020 2020  6_PLANES).      
+00004fb0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+00004fc0: 616c 2873 6567 6d65 6e74 735b 315d 5b31  al(segments[1][1
+00004fd0: 5d2e 7361 6d70 6c65 732c 2031 3932 3029  ].samples, 1920)
+00004fe0: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+00004ff0: 7365 7274 4571 7561 6c28 7365 676d 656e  sertEqual(segmen
+00005000: 7473 5b31 5d5b 315d 2e73 616d 706c 655f  ts[1][1].sample_
+00005010: 7261 7465 2c20 3438 3030 3029 0a0a 2020  rate, 48000)..  
+00005020: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00005030: 7445 7175 616c 2873 6567 6d65 6e74 735b  tEqual(segments[
+00005040: 315d 5b31 5d2e 6461 7461 2c20 6772 6169  1][1].data, grai
+00005050: 6e31 2e64 6174 6129 0a0a 2020 2020 6173  n1.data)..    as
+00005060: 796e 6320 6465 6620 7465 7374 5f61 7379  ync def test_asy
+00005070: 6e63 5f65 6e63 6f64 655f 6175 6469 6f67  nc_encode_audiog
+00005080: 7261 696e 7328 7365 6c66 293a 0a20 2020  rains(self):.   
+00005090: 2020 2020 2073 7263 5f69 6420 3d20 5555       src_id = UU
+000050a0: 4944 2827 6531 3465 3964 3538 2d31 3536  ID('e14e9d58-156
+000050b0: 372d 3131 6538 2d38 6464 332d 3833 3161  7-11e8-8dd3-831a
+000050c0: 3036 3865 6230 3334 2729 0a20 2020 2020  068eb034').     
+000050d0: 2020 2066 6c6f 775f 6964 203d 2055 5549     flow_id = UUI
+000050e0: 4428 2765 6531 6565 6435 382d 3135 3637  D('ee1eed58-1567
+000050f0: 2d31 3165 382d 6139 3731 2d33 6239 3031  -11e8-a971-3b901
+00005100: 6132 6464 3861 6227 290a 2020 2020 2020  a2dd8ab').      
+00005110: 2020 6772 6169 6e30 203d 2041 7564 696f    grain0 = Audio
+00005120: 4772 6169 6e28 0a20 2020 2020 2020 2020  Grain(.         
+00005130: 2020 2073 7263 5f69 643d 7372 635f 6964     src_id=src_id
+00005140: 2c20 666c 6f77 5f69 643d 666c 6f77 5f69  , flow_id=flow_i
+00005150: 642c 2063 6f67 5f61 7564 696f 5f66 6f72  d, cog_audio_for
+00005160: 6d61 743d 436f 6741 7564 696f 466f 726d  mat=CogAudioForm
+00005170: 6174 2e53 3136 5f50 4c41 4e45 532c 2073  at.S16_PLANES, s
+00005180: 616d 706c 6573 3d31 3932 302c 2073 616d  amples=1920, sam
+00005190: 706c 655f 7261 7465 3d34 3830 3030 290a  ple_rate=48000).
+000051a0: 2020 2020 2020 2020 6772 6169 6e31 203d          grain1 =
+000051b0: 2041 7564 696f 4772 6169 6e28 0a20 2020   AudioGrain(.   
+000051c0: 2020 2020 2020 2020 2073 7263 5f69 643d           src_id=
+000051d0: 7372 635f 6964 2c20 666c 6f77 5f69 643d  src_id, flow_id=
+000051e0: 666c 6f77 5f69 642c 2063 6f67 5f61 7564  flow_id, cog_aud
+000051f0: 696f 5f66 6f72 6d61 743d 436f 6741 7564  io_format=CogAud
+00005200: 696f 466f 726d 6174 2e53 3136 5f50 4c41  ioFormat.S16_PLA
+00005210: 4e45 532c 2073 616d 706c 6573 3d31 3932  NES, samples=192
+00005220: 302c 2073 616d 706c 655f 7261 7465 3d34  0, sample_rate=4
+00005230: 3830 3030 290a 2020 2020 2020 2020 666f  8000).        fo
+00005240: 7220 6920 696e 2072 616e 6765 2830 2c20  r i in range(0, 
+00005250: 6c65 6e28 6772 6169 6e30 2e64 6174 6129  len(grain0.data)
+00005260: 293a 0a20 2020 2020 2020 2020 2020 2067  ):.            g
+00005270: 7261 696e 302e 6461 7461 5b69 5d20 3d20  rain0.data[i] = 
+00005280: 6920 2620 3078 4646 0a20 2020 2020 2020  i & 0xFF.       
+00005290: 2066 6f72 2069 2069 6e20 7261 6e67 6528   for i in range(
+000052a0: 302c 206c 656e 2867 7261 696e 312e 6461  0, len(grain1.da
+000052b0: 7461 2929 3a0a 2020 2020 2020 2020 2020  ta)):.          
+000052c0: 2020 6772 6169 6e31 2e64 6174 615b 695d    grain1.data[i]
+000052d0: 203d 2030 7846 4620 2d20 2869 2026 2030   = 0xFF - (i & 0
+000052e0: 7846 4629 0a20 2020 2020 2020 2075 7569  xFF).        uui
+000052f0: 6473 203d 205b 5555 4944 2827 3739 3230  ds = [UUID('7920
+00005300: 6233 3934 2d31 3536 352d 3131 6538 2d38  b394-1565-11e8-8
+00005310: 3665 302d 3862 3432 6434 3634 3762 6138  6e0-8b42d4647ba8
+00005320: 2729 2c0a 2020 2020 2020 2020 2020 2020  '),.            
+00005330: 2020 2020 2055 5549 4428 2738 3061 6638       UUID('80af8
+00005340: 3735 632d 3135 3635 2d31 3165 382d 3866  75c-1565-11e8-8f
+00005350: 3434 2d38 3765 6630 3831 6234 3863 6427  44-87ef081b48cd'
+00005360: 295d 0a20 2020 2020 2020 2063 7265 6174  )].        creat
+00005370: 6564 203d 2064 6174 6574 696d 6528 3139  ed = datetime(19
+00005380: 3833 2c20 332c 2032 392c 2031 352c 2031  83, 3, 29, 15, 1
+00005390: 3529 0a20 2020 2020 2020 2077 6974 6820  5).        with 
+000053a0: 6d6f 636b 2e70 6174 6368 2827 6d65 6469  mock.patch('medi
+000053b0: 6167 7261 696e 732e 6773 662e 6461 7465  agrains.gsf.date
+000053c0: 7469 6d65 272c 2073 6964 655f 6566 6665  time', side_effe
+000053d0: 6374 3d64 6174 6574 696d 652c 206e 6f77  ct=datetime, now
+000053e0: 3d6d 6f63 6b2e 4d61 6769 634d 6f63 6b28  =mock.MagicMock(
+000053f0: 7265 7475 726e 5f76 616c 7565 3d63 7265  return_value=cre
+00005400: 6174 6564 2929 3a0a 2020 2020 2020 2020  ated)):.        
+00005410: 2020 2020 7769 7468 206d 6f63 6b2e 7061      with mock.pa
+00005420: 7463 6828 276d 6564 6961 6772 6169 6e73  tch('mediagrains
+00005430: 2e67 7366 2e75 7569 6431 272c 2073 6964  .gsf.uuid1', sid
+00005440: 655f 6566 6665 6374 3d75 7569 6473 293a  e_effect=uuids):
+00005450: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00005460: 2066 203d 2042 7974 6573 494f 2829 0a20   f = BytesIO(). 
+00005470: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+00005480: 7379 6e63 2077 6974 6820 4753 4645 6e63  sync with GSFEnc
+00005490: 6f64 6572 2866 2920 6173 2065 6e63 3a0a  oder(f) as enc:.
+000054a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000054b0: 2020 2020 6177 6169 7420 656e 632e 6164      await enc.ad
+000054c0: 645f 6772 6169 6e73 285b 6772 6169 6e30  d_grains([grain0
+000054d0: 2c20 6772 6169 6e31 5d29 0a20 2020 2020  , grain1]).     
+000054e0: 2020 2020 2020 2020 2020 2028 6865 6164             (head
+000054f0: 2c20 7365 676d 656e 7473 2920 3d20 6c6f  , segments) = lo
+00005500: 6164 7328 662e 6765 7476 616c 7565 2829  ads(f.getvalue()
+00005510: 290a 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+00005520: 6173 7365 7274 496e 2827 6964 272c 2068  assertIn('id', h
+00005530: 6561 6429 0a20 2020 2020 2020 2073 656c  ead).        sel
+00005540: 662e 6173 7365 7274 496e 2868 6561 645b  f.assertIn(head[
+00005550: 2769 6427 5d2c 2075 7569 6473 290a 2020  'id'], uuids).  
+00005560: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00005570: 7449 6e28 2774 6167 7327 2c20 6865 6164  tIn('tags', head
+00005580: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+00005590: 7373 6572 7445 7175 616c 286c 656e 2868  ssertEqual(len(h
+000055a0: 6561 645b 2774 6167 7327 5d29 2c20 3029  ead['tags']), 0)
+000055b0: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+000055c0: 7365 7274 496e 2827 6372 6561 7465 6427  sertIn('created'
+000055d0: 2c20 6865 6164 290a 2020 2020 2020 2020  , head).        
+000055e0: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+000055f0: 2868 6561 645b 2763 7265 6174 6564 275d  (head['created']
+00005600: 2c20 6372 6561 7465 6429 0a20 2020 2020  , created).     
+00005610: 2020 2073 656c 662e 6173 7365 7274 496e     self.assertIn
+00005620: 2827 7365 676d 656e 7473 272c 2068 6561  ('segments', hea
+00005630: 6429 0a20 2020 2020 2020 2073 656c 662e  d).        self.
+00005640: 6173 7365 7274 4571 7561 6c28 6c65 6e28  assertEqual(len(
+00005650: 6865 6164 5b27 7365 676d 656e 7473 275d  head['segments']
+00005660: 292c 2031 290a 2020 2020 2020 2020 7365  ), 1).        se
+00005670: 6c66 2e61 7373 6572 7449 6e28 2763 6f75  lf.assertIn('cou
+00005680: 6e74 272c 2068 6561 645b 2773 6567 6d65  nt', head['segme
+00005690: 6e74 7327 5d5b 305d 290a 2020 2020 2020  nts'][0]).      
+000056a0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+000056b0: 616c 2868 6561 645b 2773 6567 6d65 6e74  al(head['segment
+000056c0: 7327 5d5b 305d 5b27 636f 756e 7427 5d2c  s'][0]['count'],
+000056d0: 2032 290a 2020 2020 2020 2020 7365 6c66   2).        self
+000056e0: 2e61 7373 6572 7449 6e28 276c 6f63 616c  .assertIn('local
+000056f0: 5f69 6427 2c20 6865 6164 5b27 7365 676d  _id', head['segm
+00005700: 656e 7473 275d 5b30 5d29 0a20 2020 2020  ents'][0]).     
+00005710: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+00005720: 7561 6c28 6865 6164 5b27 7365 676d 656e  ual(head['segmen
+00005730: 7473 275d 5b30 5d5b 276c 6f63 616c 5f69  ts'][0]['local_i
+00005740: 6427 5d2c 2031 290a 2020 2020 2020 2020  d'], 1).        
+00005750: 7365 6c66 2e61 7373 6572 7449 6e28 2769  self.assertIn('i
+00005760: 6427 2c20 6865 6164 5b27 7365 676d 656e  d', head['segmen
+00005770: 7473 275d 5b30 5d29 0a20 2020 2020 2020  ts'][0]).       
+00005780: 2073 656c 662e 6173 7365 7274 496e 2868   self.assertIn(h
+00005790: 6561 645b 2773 6567 6d65 6e74 7327 5d5b  ead['segments'][
+000057a0: 305d 5b27 6964 275d 2c20 7575 6964 7329  0]['id'], uuids)
+000057b0: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+000057c0: 7365 7274 496e 2827 7461 6773 272c 2068  sertIn('tags', h
+000057d0: 6561 645b 2773 6567 6d65 6e74 7327 5d5b  ead['segments'][
+000057e0: 305d 290a 2020 2020 2020 2020 7365 6c66  0]).        self
+000057f0: 2e61 7373 6572 7445 7175 616c 286c 656e  .assertEqual(len
+00005800: 2868 6561 645b 2773 6567 6d65 6e74 7327  (head['segments'
+00005810: 5d5b 305d 5b27 7461 6773 275d 292c 2030  ][0]['tags']), 0
+00005820: 290a 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+00005830: 6173 7365 7274 4571 7561 6c28 6c65 6e28  assertEqual(len(
+00005840: 7365 676d 656e 7473 292c 2031 290a 2020  segments), 1).  
+00005850: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00005860: 7449 6e28 312c 2073 6567 6d65 6e74 7329  tIn(1, segments)
+00005870: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+00005880: 7365 7274 4571 7561 6c28 6c65 6e28 7365  sertEqual(len(se
+00005890: 676d 656e 7473 5b31 5d29 2c20 6865 6164  gments[1]), head
+000058a0: 5b27 7365 676d 656e 7473 275d 5b30 5d5b  ['segments'][0][
+000058b0: 2763 6f75 6e74 275d 290a 0a20 2020 2020  'count'])..     
+000058c0: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+000058d0: 7561 6c28 7365 676d 656e 7473 5b31 5d5b  ual(segments[1][
+000058e0: 305d 2e73 6f75 7263 655f 6964 2c20 7372  0].source_id, sr
+000058f0: 635f 6964 290a 2020 2020 2020 2020 7365  c_id).        se
+00005900: 6c66 2e61 7373 6572 7445 7175 616c 2873  lf.assertEqual(s
+00005910: 6567 6d65 6e74 735b 315d 5b30 5d2e 666c  egments[1][0].fl
+00005920: 6f77 5f69 642c 2066 6c6f 775f 6964 290a  ow_id, flow_id).
+00005930: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+00005940: 6572 7445 7175 616c 2873 6567 6d65 6e74  ertEqual(segment
+00005950: 735b 315d 5b30 5d2e 6772 6169 6e5f 7479  s[1][0].grain_ty
+00005960: 7065 2c20 2761 7564 696f 2729 0a20 2020  pe, 'audio').   
+00005970: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00005980: 4571 7561 6c28 7365 676d 656e 7473 5b31  Equal(segments[1
+00005990: 5d5b 305d 2e66 6f72 6d61 742c 2043 6f67  ][0].format, Cog
+000059a0: 4175 6469 6f46 6f72 6d61 742e 5331 365f  AudioFormat.S16_
+000059b0: 504c 414e 4553 290a 2020 2020 2020 2020  PLANES).        
+000059c0: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+000059d0: 2873 6567 6d65 6e74 735b 315d 5b30 5d2e  (segments[1][0].
+000059e0: 7361 6d70 6c65 732c 2031 3932 3029 0a20  samples, 1920). 
+000059f0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+00005a00: 7274 4571 7561 6c28 7365 676d 656e 7473  rtEqual(segments
+00005a10: 5b31 5d5b 305d 2e73 616d 706c 655f 7261  [1][0].sample_ra
+00005a20: 7465 2c20 3438 3030 3029 0a0a 2020 2020  te, 48000)..    
+00005a30: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+00005a40: 7175 616c 2873 6567 6d65 6e74 735b 315d  qual(segments[1]
+00005a50: 5b30 5d2e 6461 7461 2c20 6772 6169 6e30  [0].data, grain0
+00005a60: 2e64 6174 6129 0a0a 2020 2020 2020 2020  .data)..        
+00005a70: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+00005a80: 2873 6567 6d65 6e74 735b 315d 5b31 5d2e  (segments[1][1].
+00005a90: 736f 7572 6365 5f69 642c 2073 7263 5f69  source_id, src_i
+00005aa0: 6429 0a20 2020 2020 2020 2073 656c 662e  d).        self.
+00005ab0: 6173 7365 7274 4571 7561 6c28 7365 676d  assertEqual(segm
+00005ac0: 656e 7473 5b31 5d5b 315d 2e66 6c6f 775f  ents[1][1].flow_
+00005ad0: 6964 2c20 666c 6f77 5f69 6429 0a20 2020  id, flow_id).   
+00005ae0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00005af0: 4571 7561 6c28 7365 676d 656e 7473 5b31  Equal(segments[1
+00005b00: 5d5b 315d 2e67 7261 696e 5f74 7970 652c  ][1].grain_type,
+00005b10: 2027 6175 6469 6f27 290a 2020 2020 2020   'audio').      
+00005b20: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+00005b30: 616c 2873 6567 6d65 6e74 735b 315d 5b31  al(segments[1][1
+00005b40: 5d2e 666f 726d 6174 2c20 436f 6741 7564  ].format, CogAud
+00005b50: 696f 466f 726d 6174 2e53 3136 5f50 4c41  ioFormat.S16_PLA
+00005b60: 4e45 5329 0a20 2020 2020 2020 2073 656c  NES).        sel
+00005b70: 662e 6173 7365 7274 4571 7561 6c28 7365  f.assertEqual(se
+00005b80: 676d 656e 7473 5b31 5d5b 315d 2e73 616d  gments[1][1].sam
+00005b90: 706c 6573 2c20 3139 3230 290a 2020 2020  ples, 1920).    
+00005ba0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+00005bb0: 7175 616c 2873 6567 6d65 6e74 735b 315d  qual(segments[1]
+00005bc0: 5b31 5d2e 7361 6d70 6c65 5f72 6174 652c  [1].sample_rate,
+00005bd0: 2034 3830 3030 290a 0a20 2020 2020 2020   48000)..       
+00005be0: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+00005bf0: 6c28 7365 676d 656e 7473 5b31 5d5b 315d  l(segments[1][1]
+00005c00: 2e64 6174 612c 2067 7261 696e 312e 6461  .data, grain1.da
+00005c10: 7461 290a 0a20 2020 2064 6566 2074 6573  ta)..    def tes
+00005c20: 745f 6475 6d70 735f 636f 6465 6476 6964  t_dumps_codedvid
+00005c30: 656f 6772 6169 6e73 2873 656c 6629 3a0a  eograins(self):.
+00005c40: 2020 2020 2020 2020 7372 635f 6964 203d          src_id =
+00005c50: 2055 5549 4428 2765 3134 6539 6435 382d   UUID('e14e9d58-
+00005c60: 3135 3637 2d31 3165 382d 3864 6433 2d38  1567-11e8-8dd3-8
+00005c70: 3331 6130 3638 6562 3033 3427 290a 2020  31a068eb034').  
+00005c80: 2020 2020 2020 666c 6f77 5f69 6420 3d20        flow_id = 
+00005c90: 5555 4944 2827 6565 3165 6564 3538 2d31  UUID('ee1eed58-1
+00005ca0: 3536 372d 3131 6538 2d61 3937 312d 3362  567-11e8-a971-3b
+00005cb0: 3930 3161 3264 6438 6162 2729 0a20 2020  901a2dd8ab').   
+00005cc0: 2020 2020 2067 7261 696e 3020 3d20 436f       grain0 = Co
+00005cd0: 6465 6456 6964 656f 4772 6169 6e28 0a20  dedVideoGrain(. 
+00005ce0: 2020 2020 2020 2020 2020 2073 7263 5f69             src_i
+00005cf0: 643d 7372 635f 6964 2c0a 2020 2020 2020  d=src_id,.      
+00005d00: 2020 2020 2020 666c 6f77 5f69 643d 666c        flow_id=fl
+00005d10: 6f77 5f69 642c 0a20 2020 2020 2020 2020  ow_id,.         
+00005d20: 2020 2063 6f67 5f66 7261 6d65 5f66 6f72     cog_frame_for
+00005d30: 6d61 743d 436f 6746 7261 6d65 466f 726d  mat=CogFrameForm
+00005d40: 6174 2e56 4332 2c0a 2020 2020 2020 2020  at.VC2,.        
+00005d50: 2020 2020 6f72 6967 696e 5f77 6964 7468      origin_width
+00005d60: 3d31 3932 302c 0a20 2020 2020 2020 2020  =1920,.         
+00005d70: 2020 206f 7269 6769 6e5f 6865 6967 6874     origin_height
+00005d80: 3d31 3038 302c 0a20 2020 2020 2020 2020  =1080,.         
+00005d90: 2020 2063 6f64 6564 5f77 6964 7468 3d31     coded_width=1
+00005da0: 3932 302c 0a20 2020 2020 2020 2020 2020  920,.           
+00005db0: 2063 6f64 6564 5f68 6569 6768 743d 3130   coded_height=10
+00005dc0: 3838 2c0a 2020 2020 2020 2020 2020 2020  88,.            
+00005dd0: 6973 5f6b 6579 5f66 7261 6d65 3d54 7275  is_key_frame=Tru
+00005de0: 652c 0a20 2020 2020 2020 2020 2020 2074  e,.            t
+00005df0: 656d 706f 7261 6c5f 6f66 6673 6574 3d2d  emporal_offset=-
+00005e00: 3233 2c0a 2020 2020 2020 2020 2020 2020  23,.            
+00005e10: 6c65 6e67 7468 3d31 3032 342c 0a20 2020  length=1024,.   
+00005e20: 2020 2020 2020 2020 2075 6e69 745f 6f66           unit_of
+00005e30: 6673 6574 733d 5b35 2c20 3135 2c20 3130  fsets=[5, 15, 10
+00005e40: 355d 290a 2020 2020 2020 2020 6772 6169  5]).        grai
+00005e50: 6e31 203d 2043 6f64 6564 5669 6465 6f47  n1 = CodedVideoG
+00005e60: 7261 696e 280a 2020 2020 2020 2020 2020  rain(.          
+00005e70: 2020 7372 635f 6964 3d73 7263 5f69 642c    src_id=src_id,
+00005e80: 0a20 2020 2020 2020 2020 2020 2066 6c6f  .            flo
+00005e90: 775f 6964 3d66 6c6f 775f 6964 2c0a 2020  w_id=flow_id,.  
+00005ea0: 2020 2020 2020 2020 2020 636f 675f 6672            cog_fr
+00005eb0: 616d 655f 666f 726d 6174 3d43 6f67 4672  ame_format=CogFr
+00005ec0: 616d 6546 6f72 6d61 742e 5643 322c 0a20  ameFormat.VC2,. 
+00005ed0: 2020 2020 2020 2020 2020 206f 7269 6769             origi
+00005ee0: 6e5f 7769 6474 683d 3139 3230 2c0a 2020  n_width=1920,.  
+00005ef0: 2020 2020 2020 2020 2020 6f72 6967 696e            origin
+00005f00: 5f68 6569 6768 743d 3130 3830 2c0a 2020  _height=1080,.  
+00005f10: 2020 2020 2020 2020 2020 636f 6465 645f            coded_
+00005f20: 7769 6474 683d 3139 3230 2c0a 2020 2020  width=1920,.    
+00005f30: 2020 2020 2020 2020 636f 6465 645f 6865          coded_he
+00005f40: 6967 6874 3d31 3038 382c 0a20 2020 2020  ight=1088,.     
+00005f50: 2020 2020 2020 2074 656d 706f 7261 6c5f         temporal_
+00005f60: 6f66 6673 6574 3d31 372c 0a20 2020 2020  offset=17,.     
+00005f70: 2020 2020 2020 206c 656e 6774 683d 3235         length=25
+00005f80: 3629 0a20 2020 2020 2020 2066 6f72 2069  6).        for i
+00005f90: 2069 6e20 7261 6e67 6528 302c 206c 656e   in range(0, len
+00005fa0: 2867 7261 696e 302e 6461 7461 2929 3a0a  (grain0.data)):.
+00005fb0: 2020 2020 2020 2020 2020 2020 6772 6169              grai
+00005fc0: 6e30 2e64 6174 615b 695d 203d 2069 2026  n0.data[i] = i &
+00005fd0: 2030 7846 460a 2020 2020 2020 2020 666f   0xFF.        fo
+00005fe0: 7220 6920 696e 2072 616e 6765 2830 2c20  r i in range(0, 
+00005ff0: 6c65 6e28 6772 6169 6e31 2e64 6174 6129  len(grain1.data)
+00006000: 293a 0a20 2020 2020 2020 2020 2020 2067  ):.            g
+00006010: 7261 696e 312e 6461 7461 5b69 5d20 3d20  rain1.data[i] = 
+00006020: 3078 4646 202d 2028 6920 2620 3078 4646  0xFF - (i & 0xFF
+00006030: 290a 2020 2020 2020 2020 7575 6964 7320  ).        uuids 
+00006040: 3d20 5b55 5549 4428 2737 3932 3062 3339  = [UUID('7920b39
+00006050: 342d 3135 3635 2d31 3165 382d 3836 6530  4-1565-11e8-86e0
+00006060: 2d38 6234 3264 3436 3437 6261 3827 292c  -8b42d4647ba8'),
+00006070: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00006080: 2020 5555 4944 2827 3830 6166 3837 3563    UUID('80af875c
+00006090: 2d31 3536 352d 3131 6538 2d38 6634 342d  -1565-11e8-8f44-
+000060a0: 3837 6566 3038 3162 3438 6364 2729 5d0a  87ef081b48cd')].
+000060b0: 2020 2020 2020 2020 6372 6561 7465 6420          created 
+000060c0: 3d20 6461 7465 7469 6d65 2831 3938 332c  = datetime(1983,
+000060d0: 2033 2c20 3239 2c20 3135 2c20 3135 290a   3, 29, 15, 15).
+000060e0: 2020 2020 2020 2020 7769 7468 206d 6f63          with moc
+000060f0: 6b2e 7061 7463 6828 276d 6564 6961 6772  k.patch('mediagr
+00006100: 6169 6e73 2e67 7366 2e64 6174 6574 696d  ains.gsf.datetim
+00006110: 6527 2c20 7369 6465 5f65 6666 6563 743d  e', side_effect=
+00006120: 6461 7465 7469 6d65 2c20 6e6f 773d 6d6f  datetime, now=mo
+00006130: 636b 2e4d 6167 6963 4d6f 636b 2872 6574  ck.MagicMock(ret
+00006140: 7572 6e5f 7661 6c75 653d 6372 6561 7465  urn_value=create
+00006150: 6429 293a 0a20 2020 2020 2020 2020 2020  d)):.           
+00006160: 2077 6974 6820 6d6f 636b 2e70 6174 6368   with mock.patch
+00006170: 2827 6d65 6469 6167 7261 696e 732e 6773  ('mediagrains.gs
+00006180: 662e 7575 6964 3127 2c20 7369 6465 5f65  f.uuid1', side_e
+00006190: 6666 6563 743d 7575 6964 7329 3a0a 2020  ffect=uuids):.  
+000061a0: 2020 2020 2020 2020 2020 2020 2020 2868                (h
+000061b0: 6561 642c 2073 6567 6d65 6e74 7329 203d  ead, segments) =
+000061c0: 206c 6f61 6473 2864 756d 7073 285b 6772   loads(dumps([gr
+000061d0: 6169 6e30 2c20 6772 6169 6e31 5d29 290a  ain0, grain1])).
+000061e0: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+000061f0: 7365 7274 496e 2827 6964 272c 2068 6561  sertIn('id', hea
+00006200: 6429 0a20 2020 2020 2020 2073 656c 662e  d).        self.
+00006210: 6173 7365 7274 496e 2868 6561 645b 2769  assertIn(head['i
+00006220: 6427 5d2c 2075 7569 6473 290a 2020 2020  d'], uuids).    
+00006230: 2020 2020 7365 6c66 2e61 7373 6572 7449      self.assertI
+00006240: 6e28 2774 6167 7327 2c20 6865 6164 290a  n('tags', head).
+00006250: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+00006260: 6572 7445 7175 616c 286c 656e 2868 6561  ertEqual(len(hea
+00006270: 645b 2774 6167 7327 5d29 2c20 3029 0a20  d['tags']), 0). 
+00006280: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+00006290: 7274 496e 2827 6372 6561 7465 6427 2c20  rtIn('created', 
+000062a0: 6865 6164 290a 2020 2020 2020 2020 7365  head).        se
+000062b0: 6c66 2e61 7373 6572 7445 7175 616c 2868  lf.assertEqual(h
+000062c0: 6561 645b 2763 7265 6174 6564 275d 2c20  ead['created'], 
+000062d0: 6372 6561 7465 6429 0a20 2020 2020 2020  created).       
+000062e0: 2073 656c 662e 6173 7365 7274 496e 2827   self.assertIn('
+000062f0: 7365 676d 656e 7473 272c 2068 6561 6429  segments', head)
+00006300: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+00006310: 7365 7274 4571 7561 6c28 6c65 6e28 6865  sertEqual(len(he
+00006320: 6164 5b27 7365 676d 656e 7473 275d 292c  ad['segments']),
+00006330: 2031 290a 2020 2020 2020 2020 7365 6c66   1).        self
+00006340: 2e61 7373 6572 7449 6e28 2763 6f75 6e74  .assertIn('count
+00006350: 272c 2068 6561 645b 2773 6567 6d65 6e74  ', head['segment
+00006360: 7327 5d5b 305d 290a 2020 2020 2020 2020  s'][0]).        
+00006370: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+00006380: 2868 6561 645b 2773 6567 6d65 6e74 7327  (head['segments'
+00006390: 5d5b 305d 5b27 636f 756e 7427 5d2c 2032  ][0]['count'], 2
+000063a0: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+000063b0: 7373 6572 7449 6e28 276c 6f63 616c 5f69  ssertIn('local_i
+000063c0: 6427 2c20 6865 6164 5b27 7365 676d 656e  d', head['segmen
+000063d0: 7473 275d 5b30 5d29 0a20 2020 2020 2020  ts'][0]).       
+000063e0: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+000063f0: 6c28 6865 6164 5b27 7365 676d 656e 7473  l(head['segments
+00006400: 275d 5b30 5d5b 276c 6f63 616c 5f69 6427  '][0]['local_id'
+00006410: 5d2c 2031 290a 2020 2020 2020 2020 7365  ], 1).        se
+00006420: 6c66 2e61 7373 6572 7449 6e28 2769 6427  lf.assertIn('id'
+00006430: 2c20 6865 6164 5b27 7365 676d 656e 7473  , head['segments
+00006440: 275d 5b30 5d29 0a20 2020 2020 2020 2073  '][0]).        s
+00006450: 656c 662e 6173 7365 7274 496e 2868 6561  elf.assertIn(hea
+00006460: 645b 2773 6567 6d65 6e74 7327 5d5b 305d  d['segments'][0]
+00006470: 5b27 6964 275d 2c20 7575 6964 7329 0a20  ['id'], uuids). 
+00006480: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+00006490: 7274 496e 2827 7461 6773 272c 2068 6561  rtIn('tags', hea
+000064a0: 645b 2773 6567 6d65 6e74 7327 5d5b 305d  d['segments'][0]
+000064b0: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+000064c0: 7373 6572 7445 7175 616c 286c 656e 2868  ssertEqual(len(h
+000064d0: 6561 645b 2773 6567 6d65 6e74 7327 5d5b  ead['segments'][
+000064e0: 305d 5b27 7461 6773 275d 292c 2030 290a  0]['tags']), 0).
+000064f0: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+00006500: 7365 7274 4571 7561 6c28 6c65 6e28 7365  sertEqual(len(se
+00006510: 676d 656e 7473 292c 2031 290a 2020 2020  gments), 1).    
+00006520: 2020 2020 7365 6c66 2e61 7373 6572 7449      self.assertI
+00006530: 6e28 312c 2073 6567 6d65 6e74 7329 0a20  n(1, segments). 
+00006540: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+00006550: 7274 4571 7561 6c28 6c65 6e28 7365 676d  rtEqual(len(segm
+00006560: 656e 7473 5b31 5d29 2c20 6865 6164 5b27  ents[1]), head['
+00006570: 7365 676d 656e 7473 275d 5b30 5d5b 2763  segments'][0]['c
+00006580: 6f75 6e74 275d 290a 0a20 2020 2020 2020  ount'])..       
+00006590: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+000065a0: 6c28 7365 676d 656e 7473 5b31 5d5b 305d  l(segments[1][0]
+000065b0: 2e73 6f75 7263 655f 6964 2c20 7372 635f  .source_id, src_
+000065c0: 6964 290a 2020 2020 2020 2020 7365 6c66  id).        self
+000065d0: 2e61 7373 6572 7445 7175 616c 2873 6567  .assertEqual(seg
+000065e0: 6d65 6e74 735b 315d 5b30 5d2e 666c 6f77  ments[1][0].flow
+000065f0: 5f69 642c 2066 6c6f 775f 6964 290a 2020  _id, flow_id).  
+00006600: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00006610: 7445 7175 616c 2873 6567 6d65 6e74 735b  tEqual(segments[
+00006620: 315d 5b30 5d2e 6772 6169 6e5f 7479 7065  1][0].grain_type
+00006630: 2c20 2763 6f64 6564 5f76 6964 656f 2729  , 'coded_video')
+00006640: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+00006650: 7365 7274 4571 7561 6c28 7365 676d 656e  sertEqual(segmen
+00006660: 7473 5b31 5d5b 305d 2e66 6f72 6d61 742c  ts[1][0].format,
+00006670: 2043 6f67 4672 616d 6546 6f72 6d61 742e   CogFrameFormat.
+00006680: 5643 3229 0a20 2020 2020 2020 2073 656c  VC2).        sel
+00006690: 662e 6173 7365 7274 4571 7561 6c28 7365  f.assertEqual(se
+000066a0: 676d 656e 7473 5b31 5d5b 305d 2e6f 7269  gments[1][0].ori
+000066b0: 6769 6e5f 7769 6474 682c 2031 3932 3029  gin_width, 1920)
+000066c0: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+000066d0: 7365 7274 4571 7561 6c28 7365 676d 656e  sertEqual(segmen
+000066e0: 7473 5b31 5d5b 305d 2e6f 7269 6769 6e5f  ts[1][0].origin_
+000066f0: 6865 6967 6874 2c20 3130 3830 290a 2020  height, 1080).  
+00006700: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00006710: 7445 7175 616c 2873 6567 6d65 6e74 735b  tEqual(segments[
+00006720: 315d 5b30 5d2e 636f 6465 645f 7769 6474  1][0].coded_widt
+00006730: 682c 2031 3932 3029 0a20 2020 2020 2020  h, 1920).       
+00006740: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+00006750: 6c28 7365 676d 656e 7473 5b31 5d5b 305d  l(segments[1][0]
+00006760: 2e63 6f64 6564 5f68 6569 6768 742c 2031  .coded_height, 1
+00006770: 3038 3829 0a20 2020 2020 2020 2073 656c  088).        sel
+00006780: 662e 6173 7365 7274 4571 7561 6c28 7365  f.assertEqual(se
+00006790: 676d 656e 7473 5b31 5d5b 305d 2e74 656d  gments[1][0].tem
+000067a0: 706f 7261 6c5f 6f66 6673 6574 2c20 2d32  poral_offset, -2
+000067b0: 3329 0a20 2020 2020 2020 2073 656c 662e  3).        self.
+000067c0: 6173 7365 7274 4571 7561 6c28 7365 676d  assertEqual(segm
+000067d0: 656e 7473 5b31 5d5b 305d 2e75 6e69 745f  ents[1][0].unit_
+000067e0: 6f66 6673 6574 732c 205b 352c 2031 352c  offsets, [5, 15,
+000067f0: 2031 3035 5d29 0a20 2020 2020 2020 2073   105]).        s
+00006800: 656c 662e 6173 7365 7274 5472 7565 2873  elf.assertTrue(s
+00006810: 6567 6d65 6e74 735b 315d 5b30 5d2e 6973  egments[1][0].is
+00006820: 5f6b 6579 5f66 7261 6d65 290a 0a20 2020  _key_frame)..   
+00006830: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00006840: 4571 7561 6c28 7365 676d 656e 7473 5b31  Equal(segments[1
+00006850: 5d5b 305d 2e64 6174 612c 2067 7261 696e  ][0].data, grain
+00006860: 302e 6461 7461 290a 0a20 2020 2020 2020  0.data)..       
+00006870: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+00006880: 6c28 7365 676d 656e 7473 5b31 5d5b 315d  l(segments[1][1]
+00006890: 2e73 6f75 7263 655f 6964 2c20 7372 635f  .source_id, src_
+000068a0: 6964 290a 2020 2020 2020 2020 7365 6c66  id).        self
+000068b0: 2e61 7373 6572 7445 7175 616c 2873 6567  .assertEqual(seg
+000068c0: 6d65 6e74 735b 315d 5b31 5d2e 666c 6f77  ments[1][1].flow
+000068d0: 5f69 642c 2066 6c6f 775f 6964 290a 2020  _id, flow_id).  
+000068e0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+000068f0: 7445 7175 616c 2873 6567 6d65 6e74 735b  tEqual(segments[
+00006900: 315d 5b31 5d2e 6772 6169 6e5f 7479 7065  1][1].grain_type
+00006910: 2c20 2763 6f64 6564 5f76 6964 656f 2729  , 'coded_video')
+00006920: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+00006930: 7365 7274 4571 7561 6c28 7365 676d 656e  sertEqual(segmen
+00006940: 7473 5b31 5d5b 315d 2e66 6f72 6d61 742c  ts[1][1].format,
+00006950: 2043 6f67 4672 616d 6546 6f72 6d61 742e   CogFrameFormat.
+00006960: 5643 3229 0a20 2020 2020 2020 2073 656c  VC2).        sel
+00006970: 662e 6173 7365 7274 4571 7561 6c28 7365  f.assertEqual(se
+00006980: 676d 656e 7473 5b31 5d5b 315d 2e6f 7269  gments[1][1].ori
+00006990: 6769 6e5f 7769 6474 682c 2031 3932 3029  gin_width, 1920)
+000069a0: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+000069b0: 7365 7274 4571 7561 6c28 7365 676d 656e  sertEqual(segmen
+000069c0: 7473 5b31 5d5b 315d 2e6f 7269 6769 6e5f  ts[1][1].origin_
+000069d0: 6865 6967 6874 2c20 3130 3830 290a 2020  height, 1080).  
+000069e0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+000069f0: 7445 7175 616c 2873 6567 6d65 6e74 735b  tEqual(segments[
+00006a00: 315d 5b31 5d2e 636f 6465 645f 7769 6474  1][1].coded_widt
+00006a10: 682c 2031 3932 3029 0a20 2020 2020 2020  h, 1920).       
+00006a20: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+00006a30: 6c28 7365 676d 656e 7473 5b31 5d5b 315d  l(segments[1][1]
+00006a40: 2e63 6f64 6564 5f68 6569 6768 742c 2031  .coded_height, 1
+00006a50: 3038 3829 0a20 2020 2020 2020 2073 656c  088).        sel
+00006a60: 662e 6173 7365 7274 4571 7561 6c28 7365  f.assertEqual(se
+00006a70: 676d 656e 7473 5b31 5d5b 315d 2e74 656d  gments[1][1].tem
+00006a80: 706f 7261 6c5f 6f66 6673 6574 2c20 3137  poral_offset, 17
+00006a90: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+00006aa0: 7373 6572 7445 7175 616c 2873 6567 6d65  ssertEqual(segme
+00006ab0: 6e74 735b 315d 5b31 5d2e 756e 6974 5f6f  nts[1][1].unit_o
+00006ac0: 6666 7365 7473 2c20 5b5d 290a 2020 2020  ffsets, []).    
+00006ad0: 2020 2020 7365 6c66 2e61 7373 6572 7446      self.assertF
+00006ae0: 616c 7365 2873 6567 6d65 6e74 735b 315d  alse(segments[1]
+00006af0: 5b31 5d2e 6973 5f6b 6579 5f66 7261 6d65  [1].is_key_frame
+00006b00: 290a 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+00006b10: 6173 7365 7274 4571 7561 6c28 7365 676d  assertEqual(segm
+00006b20: 656e 7473 5b31 5d5b 315d 2e64 6174 612c  ents[1][1].data,
+00006b30: 2067 7261 696e 312e 6461 7461 290a 0a20   grain1.data).. 
+00006b40: 2020 2061 7379 6e63 2064 6566 2074 6573     async def tes
+00006b50: 745f 6173 796e 635f 656e 636f 6465 5f63  t_async_encode_c
+00006b60: 6f64 6564 7669 6465 6f67 7261 696e 7328  odedvideograins(
+00006b70: 7365 6c66 293a 0a20 2020 2020 2020 2073  self):.        s
+00006b80: 7263 5f69 6420 3d20 5555 4944 2827 6531  rc_id = UUID('e1
+00006b90: 3465 3964 3538 2d31 3536 372d 3131 6538  4e9d58-1567-11e8
+00006ba0: 2d38 6464 332d 3833 3161 3036 3865 6230  -8dd3-831a068eb0
+00006bb0: 3334 2729 0a20 2020 2020 2020 2066 6c6f  34').        flo
+00006bc0: 775f 6964 203d 2055 5549 4428 2765 6531  w_id = UUID('ee1
+00006bd0: 6565 6435 382d 3135 3637 2d31 3165 382d  eed58-1567-11e8-
+00006be0: 6139 3731 2d33 6239 3031 6132 6464 3861  a971-3b901a2dd8a
+00006bf0: 6227 290a 2020 2020 2020 2020 6772 6169  b').        grai
+00006c00: 6e30 203d 2043 6f64 6564 5669 6465 6f47  n0 = CodedVideoG
+00006c10: 7261 696e 280a 2020 2020 2020 2020 2020  rain(.          
+00006c20: 2020 7372 635f 6964 3d73 7263 5f69 642c    src_id=src_id,
+00006c30: 0a20 2020 2020 2020 2020 2020 2066 6c6f  .            flo
+00006c40: 775f 6964 3d66 6c6f 775f 6964 2c0a 2020  w_id=flow_id,.  
+00006c50: 2020 2020 2020 2020 2020 636f 675f 6672            cog_fr
+00006c60: 616d 655f 666f 726d 6174 3d43 6f67 4672  ame_format=CogFr
+00006c70: 616d 6546 6f72 6d61 742e 5643 322c 0a20  ameFormat.VC2,. 
+00006c80: 2020 2020 2020 2020 2020 206f 7269 6769             origi
+00006c90: 6e5f 7769 6474 683d 3139 3230 2c0a 2020  n_width=1920,.  
+00006ca0: 2020 2020 2020 2020 2020 6f72 6967 696e            origin
+00006cb0: 5f68 6569 6768 743d 3130 3830 2c0a 2020  _height=1080,.  
+00006cc0: 2020 2020 2020 2020 2020 636f 6465 645f            coded_
+00006cd0: 7769 6474 683d 3139 3230 2c0a 2020 2020  width=1920,.    
+00006ce0: 2020 2020 2020 2020 636f 6465 645f 6865          coded_he
+00006cf0: 6967 6874 3d31 3038 382c 0a20 2020 2020  ight=1088,.     
+00006d00: 2020 2020 2020 2069 735f 6b65 795f 6672         is_key_fr
+00006d10: 616d 653d 5472 7565 2c0a 2020 2020 2020  ame=True,.      
+00006d20: 2020 2020 2020 7465 6d70 6f72 616c 5f6f        temporal_o
+00006d30: 6666 7365 743d 2d32 332c 0a20 2020 2020  ffset=-23,.     
+00006d40: 2020 2020 2020 206c 656e 6774 683d 3130         length=10
+00006d50: 3234 2c0a 2020 2020 2020 2020 2020 2020  24,.            
+00006d60: 756e 6974 5f6f 6666 7365 7473 3d5b 352c  unit_offsets=[5,
+00006d70: 2031 352c 2031 3035 5d29 0a20 2020 2020   15, 105]).     
+00006d80: 2020 2067 7261 696e 3120 3d20 436f 6465     grain1 = Code
+00006d90: 6456 6964 656f 4772 6169 6e28 0a20 2020  dVideoGrain(.   
+00006da0: 2020 2020 2020 2020 2073 7263 5f69 643d           src_id=
+00006db0: 7372 635f 6964 2c0a 2020 2020 2020 2020  src_id,.        
+00006dc0: 2020 2020 666c 6f77 5f69 643d 666c 6f77      flow_id=flow
+00006dd0: 5f69 642c 0a20 2020 2020 2020 2020 2020  _id,.           
+00006de0: 2063 6f67 5f66 7261 6d65 5f66 6f72 6d61   cog_frame_forma
+00006df0: 743d 436f 6746 7261 6d65 466f 726d 6174  t=CogFrameFormat
+00006e00: 2e56 4332 2c0a 2020 2020 2020 2020 2020  .VC2,.          
+00006e10: 2020 6f72 6967 696e 5f77 6964 7468 3d31    origin_width=1
+00006e20: 3932 302c 0a20 2020 2020 2020 2020 2020  920,.           
+00006e30: 206f 7269 6769 6e5f 6865 6967 6874 3d31   origin_height=1
+00006e40: 3038 302c 0a20 2020 2020 2020 2020 2020  080,.           
+00006e50: 2063 6f64 6564 5f77 6964 7468 3d31 3932   coded_width=192
+00006e60: 302c 0a20 2020 2020 2020 2020 2020 2063  0,.            c
+00006e70: 6f64 6564 5f68 6569 6768 743d 3130 3838  oded_height=1088
+00006e80: 2c0a 2020 2020 2020 2020 2020 2020 7465  ,.            te
+00006e90: 6d70 6f72 616c 5f6f 6666 7365 743d 3137  mporal_offset=17
+00006ea0: 2c0a 2020 2020 2020 2020 2020 2020 6c65  ,.            le
+00006eb0: 6e67 7468 3d32 3536 290a 2020 2020 2020  ngth=256).      
+00006ec0: 2020 666f 7220 6920 696e 2072 616e 6765    for i in range
+00006ed0: 2830 2c20 6c65 6e28 6772 6169 6e30 2e64  (0, len(grain0.d
+00006ee0: 6174 6129 293a 0a20 2020 2020 2020 2020  ata)):.         
+00006ef0: 2020 2067 7261 696e 302e 6461 7461 5b69     grain0.data[i
+00006f00: 5d20 3d20 6920 2620 3078 4646 0a20 2020  ] = i & 0xFF.   
+00006f10: 2020 2020 2066 6f72 2069 2069 6e20 7261       for i in ra
+00006f20: 6e67 6528 302c 206c 656e 2867 7261 696e  nge(0, len(grain
+00006f30: 312e 6461 7461 2929 3a0a 2020 2020 2020  1.data)):.      
+00006f40: 2020 2020 2020 6772 6169 6e31 2e64 6174        grain1.dat
+00006f50: 615b 695d 203d 2030 7846 4620 2d20 2869  a[i] = 0xFF - (i
+00006f60: 2026 2030 7846 4629 0a20 2020 2020 2020   & 0xFF).       
+00006f70: 2075 7569 6473 203d 205b 5555 4944 2827   uuids = [UUID('
+00006f80: 3739 3230 6233 3934 2d31 3536 352d 3131  7920b394-1565-11
+00006f90: 6538 2d38 3665 302d 3862 3432 6434 3634  e8-86e0-8b42d464
+00006fa0: 3762 6138 2729 2c0a 2020 2020 2020 2020  7ba8'),.        
+00006fb0: 2020 2020 2020 2020 2055 5549 4428 2738           UUID('8
+00006fc0: 3061 6638 3735 632d 3135 3635 2d31 3165  0af875c-1565-11e
+00006fd0: 382d 3866 3434 2d38 3765 6630 3831 6234  8-8f44-87ef081b4
+00006fe0: 3863 6427 295d 0a20 2020 2020 2020 2063  8cd')].        c
+00006ff0: 7265 6174 6564 203d 2064 6174 6574 696d  reated = datetim
+00007000: 6528 3139 3833 2c20 332c 2032 392c 2031  e(1983, 3, 29, 1
+00007010: 352c 2031 3529 0a20 2020 2020 2020 2077  5, 15).        w
+00007020: 6974 6820 6d6f 636b 2e70 6174 6368 2827  ith mock.patch('
+00007030: 6d65 6469 6167 7261 696e 732e 6773 662e  mediagrains.gsf.
+00007040: 6461 7465 7469 6d65 272c 2073 6964 655f  datetime', side_
+00007050: 6566 6665 6374 3d64 6174 6574 696d 652c  effect=datetime,
+00007060: 206e 6f77 3d6d 6f63 6b2e 4d61 6769 634d   now=mock.MagicM
+00007070: 6f63 6b28 7265 7475 726e 5f76 616c 7565  ock(return_value
+00007080: 3d63 7265 6174 6564 2929 3a0a 2020 2020  =created)):.    
+00007090: 2020 2020 2020 2020 7769 7468 206d 6f63          with moc
+000070a0: 6b2e 7061 7463 6828 276d 6564 6961 6772  k.patch('mediagr
+000070b0: 6169 6e73 2e67 7366 2e75 7569 6431 272c  ains.gsf.uuid1',
+000070c0: 2073 6964 655f 6566 6665 6374 3d75 7569   side_effect=uui
+000070d0: 6473 293a 0a20 2020 2020 2020 2020 2020  ds):.           
+000070e0: 2020 2020 2066 203d 2042 7974 6573 494f       f = BytesIO
+000070f0: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
+00007100: 2020 2061 7379 6e63 2077 6974 6820 4753     async with GS
+00007110: 4645 6e63 6f64 6572 2866 2920 6173 2065  FEncoder(f) as e
+00007120: 6e63 3a0a 2020 2020 2020 2020 2020 2020  nc:.            
+00007130: 2020 2020 2020 2020 6177 6169 7420 656e          await en
+00007140: 632e 6164 645f 6772 6169 6e73 285b 6772  c.add_grains([gr
+00007150: 6169 6e30 2c20 6772 6169 6e31 5d29 0a20  ain0, grain1]). 
+00007160: 2020 2020 2020 2020 2020 2020 2020 2028                 (
+00007170: 6865 6164 2c20 7365 676d 656e 7473 2920  head, segments) 
+00007180: 3d20 6c6f 6164 7328 662e 6765 7476 616c  = loads(f.getval
+00007190: 7565 2829 290a 0a20 2020 2020 2020 2073  ue())..        s
+000071a0: 656c 662e 6173 7365 7274 496e 2827 6964  elf.assertIn('id
+000071b0: 272c 2068 6561 6429 0a20 2020 2020 2020  ', head).       
+000071c0: 2073 656c 662e 6173 7365 7274 496e 2868   self.assertIn(h
+000071d0: 6561 645b 2769 6427 5d2c 2075 7569 6473  ead['id'], uuids
+000071e0: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+000071f0: 7373 6572 7449 6e28 2774 6167 7327 2c20  ssertIn('tags', 
+00007200: 6865 6164 290a 2020 2020 2020 2020 7365  head).        se
+00007210: 6c66 2e61 7373 6572 7445 7175 616c 286c  lf.assertEqual(l
+00007220: 656e 2868 6561 645b 2774 6167 7327 5d29  en(head['tags'])
+00007230: 2c20 3029 0a20 2020 2020 2020 2073 656c  , 0).        sel
+00007240: 662e 6173 7365 7274 496e 2827 6372 6561  f.assertIn('crea
+00007250: 7465 6427 2c20 6865 6164 290a 2020 2020  ted', head).    
+00007260: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+00007270: 7175 616c 2868 6561 645b 2763 7265 6174  qual(head['creat
+00007280: 6564 275d 2c20 6372 6561 7465 6429 0a20  ed'], created). 
+00007290: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+000072a0: 7274 496e 2827 7365 676d 656e 7473 272c  rtIn('segments',
+000072b0: 2068 6561 6429 0a20 2020 2020 2020 2073   head).        s
+000072c0: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+000072d0: 6c65 6e28 6865 6164 5b27 7365 676d 656e  len(head['segmen
+000072e0: 7473 275d 292c 2031 290a 2020 2020 2020  ts']), 1).      
+000072f0: 2020 7365 6c66 2e61 7373 6572 7449 6e28    self.assertIn(
+00007300: 2763 6f75 6e74 272c 2068 6561 645b 2773  'count', head['s
+00007310: 6567 6d65 6e74 7327 5d5b 305d 290a 2020  egments'][0]).  
+00007320: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00007330: 7445 7175 616c 2868 6561 645b 2773 6567  tEqual(head['seg
+00007340: 6d65 6e74 7327 5d5b 305d 5b27 636f 756e  ments'][0]['coun
+00007350: 7427 5d2c 2032 290a 2020 2020 2020 2020  t'], 2).        
+00007360: 7365 6c66 2e61 7373 6572 7449 6e28 276c  self.assertIn('l
+00007370: 6f63 616c 5f69 6427 2c20 6865 6164 5b27  ocal_id', head['
+00007380: 7365 676d 656e 7473 275d 5b30 5d29 0a20  segments'][0]). 
+00007390: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+000073a0: 7274 4571 7561 6c28 6865 6164 5b27 7365  rtEqual(head['se
+000073b0: 676d 656e 7473 275d 5b30 5d5b 276c 6f63  gments'][0]['loc
+000073c0: 616c 5f69 6427 5d2c 2031 290a 2020 2020  al_id'], 1).    
+000073d0: 2020 2020 7365 6c66 2e61 7373 6572 7449      self.assertI
+000073e0: 6e28 2769 6427 2c20 6865 6164 5b27 7365  n('id', head['se
+000073f0: 676d 656e 7473 275d 5b30 5d29 0a20 2020  gments'][0]).   
+00007400: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00007410: 496e 2868 6561 645b 2773 6567 6d65 6e74  In(head['segment
+00007420: 7327 5d5b 305d 5b27 6964 275d 2c20 7575  s'][0]['id'], uu
+00007430: 6964 7329 0a20 2020 2020 2020 2073 656c  ids).        sel
+00007440: 662e 6173 7365 7274 496e 2827 7461 6773  f.assertIn('tags
+00007450: 272c 2068 6561 645b 2773 6567 6d65 6e74  ', head['segment
+00007460: 7327 5d5b 305d 290a 2020 2020 2020 2020  s'][0]).        
+00007470: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+00007480: 286c 656e 2868 6561 645b 2773 6567 6d65  (len(head['segme
+00007490: 6e74 7327 5d5b 305d 5b27 7461 6773 275d  nts'][0]['tags']
+000074a0: 292c 2030 290a 0a20 2020 2020 2020 2073  ), 0)..        s
+000074b0: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+000074c0: 6c65 6e28 7365 676d 656e 7473 292c 2031  len(segments), 1
+000074d0: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+000074e0: 7373 6572 7449 6e28 312c 2073 6567 6d65  ssertIn(1, segme
+000074f0: 6e74 7329 0a20 2020 2020 2020 2073 656c  nts).        sel
+00007500: 662e 6173 7365 7274 4571 7561 6c28 6c65  f.assertEqual(le
+00007510: 6e28 7365 676d 656e 7473 5b31 5d29 2c20  n(segments[1]), 
+00007520: 6865 6164 5b27 7365 676d 656e 7473 275d  head['segments']
+00007530: 5b30 5d5b 2763 6f75 6e74 275d 290a 0a20  [0]['count']).. 
+00007540: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+00007550: 7274 4571 7561 6c28 7365 676d 656e 7473  rtEqual(segments
+00007560: 5b31 5d5b 305d 2e73 6f75 7263 655f 6964  [1][0].source_id
+00007570: 2c20 7372 635f 6964 290a 2020 2020 2020  , src_id).      
+00007580: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+00007590: 616c 2873 6567 6d65 6e74 735b 315d 5b30  al(segments[1][0
+000075a0: 5d2e 666c 6f77 5f69 642c 2066 6c6f 775f  ].flow_id, flow_
+000075b0: 6964 290a 2020 2020 2020 2020 7365 6c66  id).        self
+000075c0: 2e61 7373 6572 7445 7175 616c 2873 6567  .assertEqual(seg
+000075d0: 6d65 6e74 735b 315d 5b30 5d2e 6772 6169  ments[1][0].grai
+000075e0: 6e5f 7479 7065 2c20 2763 6f64 6564 5f76  n_type, 'coded_v
+000075f0: 6964 656f 2729 0a20 2020 2020 2020 2073  ideo').        s
+00007600: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+00007610: 7365 676d 656e 7473 5b31 5d5b 305d 2e66  segments[1][0].f
+00007620: 6f72 6d61 742c 2043 6f67 4672 616d 6546  ormat, CogFrameF
+00007630: 6f72 6d61 742e 5643 3229 0a20 2020 2020  ormat.VC2).     
+00007640: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+00007650: 7561 6c28 7365 676d 656e 7473 5b31 5d5b  ual(segments[1][
+00007660: 305d 2e6f 7269 6769 6e5f 7769 6474 682c  0].origin_width,
+00007670: 2031 3932 3029 0a20 2020 2020 2020 2073   1920).        s
+00007680: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+00007690: 7365 676d 656e 7473 5b31 5d5b 305d 2e6f  segments[1][0].o
+000076a0: 7269 6769 6e5f 6865 6967 6874 2c20 3130  rigin_height, 10
+000076b0: 3830 290a 2020 2020 2020 2020 7365 6c66  80).        self
+000076c0: 2e61 7373 6572 7445 7175 616c 2873 6567  .assertEqual(seg
+000076d0: 6d65 6e74 735b 315d 5b30 5d2e 636f 6465  ments[1][0].code
+000076e0: 645f 7769 6474 682c 2031 3932 3029 0a20  d_width, 1920). 
+000076f0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+00007700: 7274 4571 7561 6c28 7365 676d 656e 7473  rtEqual(segments
+00007710: 5b31 5d5b 305d 2e63 6f64 6564 5f68 6569  [1][0].coded_hei
+00007720: 6768 742c 2031 3038 3829 0a20 2020 2020  ght, 1088).     
+00007730: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+00007740: 7561 6c28 7365 676d 656e 7473 5b31 5d5b  ual(segments[1][
+00007750: 305d 2e74 656d 706f 7261 6c5f 6f66 6673  0].temporal_offs
+00007760: 6574 2c20 2d32 3329 0a20 2020 2020 2020  et, -23).       
+00007770: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+00007780: 6c28 7365 676d 656e 7473 5b31 5d5b 305d  l(segments[1][0]
+00007790: 2e75 6e69 745f 6f66 6673 6574 732c 205b  .unit_offsets, [
+000077a0: 352c 2031 352c 2031 3035 5d29 0a20 2020  5, 15, 105]).   
+000077b0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+000077c0: 5472 7565 2873 6567 6d65 6e74 735b 315d  True(segments[1]
+000077d0: 5b30 5d2e 6973 5f6b 6579 5f66 7261 6d65  [0].is_key_frame
+000077e0: 290a 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+000077f0: 6173 7365 7274 4571 7561 6c28 7365 676d  assertEqual(segm
+00007800: 656e 7473 5b31 5d5b 305d 2e64 6174 612c  ents[1][0].data,
+00007810: 2067 7261 696e 302e 6461 7461 290a 0a20   grain0.data).. 
+00007820: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+00007830: 7274 4571 7561 6c28 7365 676d 656e 7473  rtEqual(segments
+00007840: 5b31 5d5b 315d 2e73 6f75 7263 655f 6964  [1][1].source_id
+00007850: 2c20 7372 635f 6964 290a 2020 2020 2020  , src_id).      
+00007860: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+00007870: 616c 2873 6567 6d65 6e74 735b 315d 5b31  al(segments[1][1
+00007880: 5d2e 666c 6f77 5f69 642c 2066 6c6f 775f  ].flow_id, flow_
+00007890: 6964 290a 2020 2020 2020 2020 7365 6c66  id).        self
+000078a0: 2e61 7373 6572 7445 7175 616c 2873 6567  .assertEqual(seg
+000078b0: 6d65 6e74 735b 315d 5b31 5d2e 6772 6169  ments[1][1].grai
+000078c0: 6e5f 7479 7065 2c20 2763 6f64 6564 5f76  n_type, 'coded_v
+000078d0: 6964 656f 2729 0a20 2020 2020 2020 2073  ideo').        s
+000078e0: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+000078f0: 7365 676d 656e 7473 5b31 5d5b 315d 2e66  segments[1][1].f
+00007900: 6f72 6d61 742c 2043 6f67 4672 616d 6546  ormat, CogFrameF
+00007910: 6f72 6d61 742e 5643 3229 0a20 2020 2020  ormat.VC2).     
+00007920: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+00007930: 7561 6c28 7365 676d 656e 7473 5b31 5d5b  ual(segments[1][
+00007940: 315d 2e6f 7269 6769 6e5f 7769 6474 682c  1].origin_width,
+00007950: 2031 3932 3029 0a20 2020 2020 2020 2073   1920).        s
+00007960: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+00007970: 7365 676d 656e 7473 5b31 5d5b 315d 2e6f  segments[1][1].o
+00007980: 7269 6769 6e5f 6865 6967 6874 2c20 3130  rigin_height, 10
+00007990: 3830 290a 2020 2020 2020 2020 7365 6c66  80).        self
+000079a0: 2e61 7373 6572 7445 7175 616c 2873 6567  .assertEqual(seg
+000079b0: 6d65 6e74 735b 315d 5b31 5d2e 636f 6465  ments[1][1].code
+000079c0: 645f 7769 6474 682c 2031 3932 3029 0a20  d_width, 1920). 
+000079d0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+000079e0: 7274 4571 7561 6c28 7365 676d 656e 7473  rtEqual(segments
+000079f0: 5b31 5d5b 315d 2e63 6f64 6564 5f68 6569  [1][1].coded_hei
+00007a00: 6768 742c 2031 3038 3829 0a20 2020 2020  ght, 1088).     
+00007a10: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+00007a20: 7561 6c28 7365 676d 656e 7473 5b31 5d5b  ual(segments[1][
+00007a30: 315d 2e74 656d 706f 7261 6c5f 6f66 6673  1].temporal_offs
+00007a40: 6574 2c20 3137 290a 2020 2020 2020 2020  et, 17).        
+00007a50: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+00007a60: 2873 6567 6d65 6e74 735b 315d 5b31 5d2e  (segments[1][1].
+00007a70: 756e 6974 5f6f 6666 7365 7473 2c20 5b5d  unit_offsets, []
+00007a80: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+00007a90: 7373 6572 7446 616c 7365 2873 6567 6d65  ssertFalse(segme
+00007aa0: 6e74 735b 315d 5b31 5d2e 6973 5f6b 6579  nts[1][1].is_key
+00007ab0: 5f66 7261 6d65 290a 0a20 2020 2020 2020  _frame)..       
+00007ac0: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+00007ad0: 6c28 7365 676d 656e 7473 5b31 5d5b 315d  l(segments[1][1]
+00007ae0: 2e64 6174 612c 2067 7261 696e 312e 6461  .data, grain1.da
+00007af0: 7461 290a 0a20 2020 2064 6566 2074 6573  ta)..    def tes
+00007b00: 745f 6475 6d70 735f 636f 6465 6461 7564  t_dumps_codedaud
+00007b10: 696f 6772 6169 6e73 2873 656c 6629 3a0a  iograins(self):.
+00007b20: 2020 2020 2020 2020 7372 635f 6964 203d          src_id =
+00007b30: 2055 5549 4428 2765 3134 6539 6435 382d   UUID('e14e9d58-
+00007b40: 3135 3637 2d31 3165 382d 3864 6433 2d38  1567-11e8-8dd3-8
+00007b50: 3331 6130 3638 6562 3033 3427 290a 2020  31a068eb034').  
+00007b60: 2020 2020 2020 666c 6f77 5f69 6420 3d20        flow_id = 
+00007b70: 5555 4944 2827 6565 3165 6564 3538 2d31  UUID('ee1eed58-1
+00007b80: 3536 372d 3131 6538 2d61 3937 312d 3362  567-11e8-a971-3b
+00007b90: 3930 3161 3264 6438 6162 2729 0a20 2020  901a2dd8ab').   
+00007ba0: 2020 2020 2067 7261 696e 3020 3d20 436f       grain0 = Co
+00007bb0: 6465 6441 7564 696f 4772 6169 6e28 0a20  dedAudioGrain(. 
+00007bc0: 2020 2020 2020 2020 2020 2073 7263 5f69             src_i
+00007bd0: 643d 7372 635f 6964 2c0a 2020 2020 2020  d=src_id,.      
+00007be0: 2020 2020 2020 666c 6f77 5f69 643d 666c        flow_id=fl
+00007bf0: 6f77 5f69 642c 0a20 2020 2020 2020 2020  ow_id,.         
+00007c00: 2020 2063 6f67 5f61 7564 696f 5f66 6f72     cog_audio_for
+00007c10: 6d61 743d 436f 6741 7564 696f 466f 726d  mat=CogAudioForm
+00007c20: 6174 2e41 4143 2c0a 2020 2020 2020 2020  at.AAC,.        
+00007c30: 2020 2020 7361 6d70 6c65 733d 3139 3230      samples=1920
+00007c40: 2c0a 2020 2020 2020 2020 2020 2020 7361  ,.            sa
+00007c50: 6d70 6c65 5f72 6174 653d 3438 3030 302c  mple_rate=48000,
+00007c60: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
+00007c70: 6d69 6e67 3d32 332c 0a20 2020 2020 2020  ming=23,.       
+00007c80: 2020 2020 2072 656d 6169 6e64 6572 3d31       remainder=1
+00007c90: 372c 0a20 2020 2020 2020 2020 2020 206c  7,.            l
+00007ca0: 656e 6774 683d 3130 3234 290a 2020 2020  ength=1024).    
+00007cb0: 2020 2020 6772 6169 6e31 203d 2043 6f64      grain1 = Cod
+00007cc0: 6564 4175 6469 6f47 7261 696e 280a 2020  edAudioGrain(.  
+00007cd0: 2020 2020 2020 2020 2020 7372 635f 6964            src_id
+00007ce0: 3d73 7263 5f69 642c 0a20 2020 2020 2020  =src_id,.       
+00007cf0: 2020 2020 2066 6c6f 775f 6964 3d66 6c6f       flow_id=flo
+00007d00: 775f 6964 2c0a 2020 2020 2020 2020 2020  w_id,.          
+00007d10: 2020 636f 675f 6175 6469 6f5f 666f 726d    cog_audio_form
+00007d20: 6174 3d43 6f67 4175 6469 6f46 6f72 6d61  at=CogAudioForma
+00007d30: 742e 4141 432c 0a20 2020 2020 2020 2020  t.AAC,.         
+00007d40: 2020 2073 616d 706c 6573 3d31 3932 302c     samples=1920,
+00007d50: 0a20 2020 2020 2020 2020 2020 2073 616d  .            sam
+00007d60: 706c 655f 7261 7465 3d34 3830 3030 2c0a  ple_rate=48000,.
+00007d70: 2020 2020 2020 2020 2020 2020 7072 696d              prim
+00007d80: 696e 673d 352c 0a20 2020 2020 2020 2020  ing=5,.         
+00007d90: 2020 2072 656d 6169 6e64 6572 3d31 3034     remainder=104
+00007da0: 2c0a 2020 2020 2020 2020 2020 2020 6c65  ,.            le
+00007db0: 6e67 7468 3d31 3530 3029 0a20 2020 2020  ngth=1500).     
+00007dc0: 2020 2066 6f72 2069 2069 6e20 7261 6e67     for i in rang
+00007dd0: 6528 302c 206c 656e 2867 7261 696e 302e  e(0, len(grain0.
+00007de0: 6461 7461 2929 3a0a 2020 2020 2020 2020  data)):.        
+00007df0: 2020 2020 6772 6169 6e30 2e64 6174 615b      grain0.data[
+00007e00: 695d 203d 2069 2026 2030 7846 460a 2020  i] = i & 0xFF.  
+00007e10: 2020 2020 2020 666f 7220 6920 696e 2072        for i in r
+00007e20: 616e 6765 2830 2c20 6c65 6e28 6772 6169  ange(0, len(grai
+00007e30: 6e31 2e64 6174 6129 293a 0a20 2020 2020  n1.data)):.     
+00007e40: 2020 2020 2020 2067 7261 696e 312e 6461         grain1.da
+00007e50: 7461 5b69 5d20 3d20 3078 4646 202d 2028  ta[i] = 0xFF - (
+00007e60: 6920 2620 3078 4646 290a 2020 2020 2020  i & 0xFF).      
+00007e70: 2020 7575 6964 7320 3d20 5b55 5549 4428    uuids = [UUID(
+00007e80: 2737 3932 3062 3339 342d 3135 3635 2d31  '7920b394-1565-1
+00007e90: 3165 382d 3836 6530 2d38 6234 3264 3436  1e8-86e0-8b42d46
+00007ea0: 3437 6261 3827 292c 0a20 2020 2020 2020  47ba8'),.       
+00007eb0: 2020 2020 2020 2020 2020 5555 4944 2827            UUID('
+00007ec0: 3830 6166 3837 3563 2d31 3536 352d 3131  80af875c-1565-11
+00007ed0: 6538 2d38 6634 342d 3837 6566 3038 3162  e8-8f44-87ef081b
+00007ee0: 3438 6364 2729 5d0a 2020 2020 2020 2020  48cd')].        
+00007ef0: 6372 6561 7465 6420 3d20 6461 7465 7469  created = dateti
+00007f00: 6d65 2831 3938 332c 2033 2c20 3239 2c20  me(1983, 3, 29, 
+00007f10: 3135 2c20 3135 290a 2020 2020 2020 2020  15, 15).        
+00007f20: 7769 7468 206d 6f63 6b2e 7061 7463 6828  with mock.patch(
+00007f30: 276d 6564 6961 6772 6169 6e73 2e67 7366  'mediagrains.gsf
+00007f40: 2e64 6174 6574 696d 6527 2c20 7369 6465  .datetime', side
+00007f50: 5f65 6666 6563 743d 6461 7465 7469 6d65  _effect=datetime
+00007f60: 2c20 6e6f 773d 6d6f 636b 2e4d 6167 6963  , now=mock.Magic
+00007f70: 4d6f 636b 2872 6574 7572 6e5f 7661 6c75  Mock(return_valu
+00007f80: 653d 6372 6561 7465 6429 293a 0a20 2020  e=created)):.   
+00007f90: 2020 2020 2020 2020 2077 6974 6820 6d6f           with mo
+00007fa0: 636b 2e70 6174 6368 2827 6d65 6469 6167  ck.patch('mediag
+00007fb0: 7261 696e 732e 6773 662e 7575 6964 3127  rains.gsf.uuid1'
+00007fc0: 2c20 7369 6465 5f65 6666 6563 743d 7575  , side_effect=uu
+00007fd0: 6964 7329 3a0a 2020 2020 2020 2020 2020  ids):.          
+00007fe0: 2020 2020 2020 2868 6561 642c 2073 6567        (head, seg
+00007ff0: 6d65 6e74 7329 203d 206c 6f61 6473 2864  ments) = loads(d
+00008000: 756d 7073 285b 6772 6169 6e30 2c20 6772  umps([grain0, gr
+00008010: 6169 6e31 5d29 290a 0a20 2020 2020 2020  ain1]))..       
+00008020: 2073 656c 662e 6173 7365 7274 496e 2827   self.assertIn('
+00008030: 6964 272c 2068 6561 6429 0a20 2020 2020  id', head).     
+00008040: 2020 2073 656c 662e 6173 7365 7274 496e     self.assertIn
+00008050: 2868 6561 645b 2769 6427 5d2c 2075 7569  (head['id'], uui
+00008060: 6473 290a 2020 2020 2020 2020 7365 6c66  ds).        self
+00008070: 2e61 7373 6572 7449 6e28 2774 6167 7327  .assertIn('tags'
+00008080: 2c20 6865 6164 290a 2020 2020 2020 2020  , head).        
 00008090: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-000080a0: 2873 6567 6d65 6e74 735b 315d 5b30 5d2e  (segments[1][0].
-000080b0: 666f 726d 6174 2c20 436f 6741 7564 696f  format, CogAudio
-000080c0: 466f 726d 6174 2e41 4143 290a 2020 2020  Format.AAC).    
-000080d0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-000080e0: 7175 616c 2873 6567 6d65 6e74 735b 315d  qual(segments[1]
-000080f0: 5b30 5d2e 7361 6d70 6c65 732c 2031 3932  [0].samples, 192
-00008100: 3029 0a20 2020 2020 2020 2073 656c 662e  0).        self.
-00008110: 6173 7365 7274 4571 7561 6c28 7365 676d  assertEqual(segm
-00008120: 656e 7473 5b31 5d5b 305d 2e73 616d 706c  ents[1][0].sampl
-00008130: 655f 7261 7465 2c20 3438 3030 3029 0a20  e_rate, 48000). 
-00008140: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00008150: 7274 4571 7561 6c28 7365 676d 656e 7473  rtEqual(segments
-00008160: 5b31 5d5b 305d 2e70 7269 6d69 6e67 2c20  [1][0].priming, 
-00008170: 3233 290a 2020 2020 2020 2020 7365 6c66  23).        self
-00008180: 2e61 7373 6572 7445 7175 616c 2873 6567  .assertEqual(seg
-00008190: 6d65 6e74 735b 315d 5b30 5d2e 7265 6d61  ments[1][0].rema
-000081a0: 696e 6465 722c 2031 3729 0a0a 2020 2020  inder, 17)..    
-000081b0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-000081c0: 7175 616c 2873 6567 6d65 6e74 735b 315d  qual(segments[1]
-000081d0: 5b30 5d2e 6461 7461 2c20 6772 6169 6e30  [0].data, grain0
-000081e0: 2e64 6174 6129 0a0a 2020 2020 2020 2020  .data)..        
-000081f0: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-00008200: 2873 6567 6d65 6e74 735b 315d 5b31 5d2e  (segments[1][1].
-00008210: 736f 7572 6365 5f69 642c 2073 7263 5f69  source_id, src_i
-00008220: 6429 0a20 2020 2020 2020 2073 656c 662e  d).        self.
-00008230: 6173 7365 7274 4571 7561 6c28 7365 676d  assertEqual(segm
-00008240: 656e 7473 5b31 5d5b 315d 2e66 6c6f 775f  ents[1][1].flow_
-00008250: 6964 2c20 666c 6f77 5f69 6429 0a20 2020  id, flow_id).   
-00008260: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00008270: 4571 7561 6c28 7365 676d 656e 7473 5b31  Equal(segments[1
-00008280: 5d5b 315d 2e67 7261 696e 5f74 7970 652c  ][1].grain_type,
-00008290: 2027 636f 6465 645f 6175 6469 6f27 290a   'coded_audio').
-000082a0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-000082b0: 6572 7445 7175 616c 2873 6567 6d65 6e74  ertEqual(segment
-000082c0: 735b 315d 5b31 5d2e 666f 726d 6174 2c20  s[1][1].format, 
-000082d0: 436f 6741 7564 696f 466f 726d 6174 2e41  CogAudioFormat.A
-000082e0: 4143 290a 2020 2020 2020 2020 7365 6c66  AC).        self
-000082f0: 2e61 7373 6572 7445 7175 616c 2873 6567  .assertEqual(seg
-00008300: 6d65 6e74 735b 315d 5b31 5d2e 7361 6d70  ments[1][1].samp
-00008310: 6c65 732c 2031 3932 3029 0a20 2020 2020  les, 1920).     
-00008320: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-00008330: 7561 6c28 7365 676d 656e 7473 5b31 5d5b  ual(segments[1][
-00008340: 315d 2e73 616d 706c 655f 7261 7465 2c20  1].sample_rate, 
-00008350: 3438 3030 3029 0a20 2020 2020 2020 2073  48000).        s
-00008360: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-00008370: 7365 676d 656e 7473 5b31 5d5b 315d 2e70  segments[1][1].p
-00008380: 7269 6d69 6e67 2c20 3529 0a20 2020 2020  riming, 5).     
-00008390: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-000083a0: 7561 6c28 7365 676d 656e 7473 5b31 5d5b  ual(segments[1][
-000083b0: 315d 2e72 656d 6169 6e64 6572 2c20 3130  1].remainder, 10
-000083c0: 3429 0a0a 2020 2020 2020 2020 7365 6c66  4)..        self
-000083d0: 2e61 7373 6572 7445 7175 616c 2873 6567  .assertEqual(seg
-000083e0: 6d65 6e74 735b 315d 5b31 5d2e 6461 7461  ments[1][1].data
-000083f0: 2c20 6772 6169 6e31 2e64 6174 6129 0a0a  , grain1.data)..
-00008400: 2020 2020 6173 796e 6320 6465 6620 7465      async def te
-00008410: 7374 5f61 7379 6e63 5f65 6e63 6f64 655f  st_async_encode_
-00008420: 636f 6465 6461 7564 696f 6772 6169 6e73  codedaudiograins
-00008430: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-00008440: 7372 635f 6964 203d 2055 5549 4428 2765  src_id = UUID('e
-00008450: 3134 6539 6435 382d 3135 3637 2d31 3165  14e9d58-1567-11e
-00008460: 382d 3864 6433 2d38 3331 6130 3638 6562  8-8dd3-831a068eb
-00008470: 3033 3427 290a 2020 2020 2020 2020 666c  034').        fl
-00008480: 6f77 5f69 6420 3d20 5555 4944 2827 6565  ow_id = UUID('ee
-00008490: 3165 6564 3538 2d31 3536 372d 3131 6538  1eed58-1567-11e8
-000084a0: 2d61 3937 312d 3362 3930 3161 3264 6438  -a971-3b901a2dd8
-000084b0: 6162 2729 0a20 2020 2020 2020 2067 7261  ab').        gra
-000084c0: 696e 3020 3d20 436f 6465 6441 7564 696f  in0 = CodedAudio
-000084d0: 4772 6169 6e28 0a20 2020 2020 2020 2020  Grain(.         
-000084e0: 2020 2073 7263 5f69 642c 0a20 2020 2020     src_id,.     
-000084f0: 2020 2020 2020 2066 6c6f 775f 6964 2c0a         flow_id,.
-00008500: 2020 2020 2020 2020 2020 2020 636f 675f              cog_
-00008510: 6175 6469 6f5f 666f 726d 6174 3d43 6f67  audio_format=Cog
-00008520: 4175 6469 6f46 6f72 6d61 742e 4141 432c  AudioFormat.AAC,
-00008530: 0a20 2020 2020 2020 2020 2020 2073 616d  .            sam
-00008540: 706c 6573 3d31 3932 302c 0a20 2020 2020  ples=1920,.     
-00008550: 2020 2020 2020 2073 616d 706c 655f 7261         sample_ra
-00008560: 7465 3d34 3830 3030 2c0a 2020 2020 2020  te=48000,.      
-00008570: 2020 2020 2020 7072 696d 696e 673d 3233        priming=23
-00008580: 2c0a 2020 2020 2020 2020 2020 2020 7265  ,.            re
-00008590: 6d61 696e 6465 723d 3137 2c0a 2020 2020  mainder=17,.    
-000085a0: 2020 2020 2020 2020 6c65 6e67 7468 3d31          length=1
-000085b0: 3032 3429 0a20 2020 2020 2020 2067 7261  024).        gra
-000085c0: 696e 3120 3d20 436f 6465 6441 7564 696f  in1 = CodedAudio
-000085d0: 4772 6169 6e28 0a20 2020 2020 2020 2020  Grain(.         
-000085e0: 2020 2073 7263 5f69 642c 0a20 2020 2020     src_id,.     
-000085f0: 2020 2020 2020 2066 6c6f 775f 6964 2c0a         flow_id,.
-00008600: 2020 2020 2020 2020 2020 2020 636f 675f              cog_
-00008610: 6175 6469 6f5f 666f 726d 6174 3d43 6f67  audio_format=Cog
-00008620: 4175 6469 6f46 6f72 6d61 742e 4141 432c  AudioFormat.AAC,
-00008630: 0a20 2020 2020 2020 2020 2020 2073 616d  .            sam
-00008640: 706c 6573 3d31 3932 302c 0a20 2020 2020  ples=1920,.     
-00008650: 2020 2020 2020 2073 616d 706c 655f 7261         sample_ra
-00008660: 7465 3d34 3830 3030 2c0a 2020 2020 2020  te=48000,.      
-00008670: 2020 2020 2020 7072 696d 696e 673d 352c        priming=5,
-00008680: 0a20 2020 2020 2020 2020 2020 2072 656d  .            rem
-00008690: 6169 6e64 6572 3d31 3034 2c0a 2020 2020  ainder=104,.    
-000086a0: 2020 2020 2020 2020 6c65 6e67 7468 3d31          length=1
-000086b0: 3530 3029 0a20 2020 2020 2020 2066 6f72  500).        for
-000086c0: 2069 2069 6e20 7261 6e67 6528 302c 206c   i in range(0, l
-000086d0: 656e 2867 7261 696e 302e 6461 7461 2929  en(grain0.data))
-000086e0: 3a0a 2020 2020 2020 2020 2020 2020 6772  :.            gr
-000086f0: 6169 6e30 2e64 6174 615b 695d 203d 2069  ain0.data[i] = i
-00008700: 2026 2030 7846 460a 2020 2020 2020 2020   & 0xFF.        
-00008710: 666f 7220 6920 696e 2072 616e 6765 2830  for i in range(0
-00008720: 2c20 6c65 6e28 6772 6169 6e31 2e64 6174  , len(grain1.dat
-00008730: 6129 293a 0a20 2020 2020 2020 2020 2020  a)):.           
-00008740: 2067 7261 696e 312e 6461 7461 5b69 5d20   grain1.data[i] 
-00008750: 3d20 3078 4646 202d 2028 6920 2620 3078  = 0xFF - (i & 0x
-00008760: 4646 290a 2020 2020 2020 2020 7575 6964  FF).        uuid
-00008770: 7320 3d20 5b55 5549 4428 2737 3932 3062  s = [UUID('7920b
-00008780: 3339 342d 3135 3635 2d31 3165 382d 3836  394-1565-11e8-86
-00008790: 6530 2d38 6234 3264 3436 3437 6261 3827  e0-8b42d4647ba8'
-000087a0: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
-000087b0: 2020 2020 5555 4944 2827 3830 6166 3837      UUID('80af87
-000087c0: 3563 2d31 3536 352d 3131 6538 2d38 6634  5c-1565-11e8-8f4
-000087d0: 342d 3837 6566 3038 3162 3438 6364 2729  4-87ef081b48cd')
-000087e0: 5d0a 2020 2020 2020 2020 6372 6561 7465  ].        create
-000087f0: 6420 3d20 6461 7465 7469 6d65 2831 3938  d = datetime(198
-00008800: 332c 2033 2c20 3239 2c20 3135 2c20 3135  3, 3, 29, 15, 15
-00008810: 290a 2020 2020 2020 2020 7769 7468 206d  ).        with m
-00008820: 6f63 6b2e 7061 7463 6828 276d 6564 6961  ock.patch('media
-00008830: 6772 6169 6e73 2e67 7366 2e64 6174 6574  grains.gsf.datet
-00008840: 696d 6527 2c20 7369 6465 5f65 6666 6563  ime', side_effec
-00008850: 743d 6461 7465 7469 6d65 2c20 6e6f 773d  t=datetime, now=
-00008860: 6d6f 636b 2e4d 6167 6963 4d6f 636b 2872  mock.MagicMock(r
-00008870: 6574 7572 6e5f 7661 6c75 653d 6372 6561  eturn_value=crea
-00008880: 7465 6429 293a 0a20 2020 2020 2020 2020  ted)):.         
-00008890: 2020 2077 6974 6820 6d6f 636b 2e70 6174     with mock.pat
-000088a0: 6368 2827 6d65 6469 6167 7261 696e 732e  ch('mediagrains.
-000088b0: 6773 662e 7575 6964 3127 2c20 7369 6465  gsf.uuid1', side
-000088c0: 5f65 6666 6563 743d 7575 6964 7329 3a0a  _effect=uuids):.
-000088d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000088e0: 6620 3d20 4279 7465 7349 4f28 290a 2020  f = BytesIO().  
-000088f0: 2020 2020 2020 2020 2020 2020 2020 6173                as
-00008900: 796e 6320 7769 7468 2047 5346 456e 636f  ync with GSFEnco
-00008910: 6465 7228 6629 2061 7320 656e 633a 0a20  der(f) as enc:. 
-00008920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008930: 2020 2061 7761 6974 2065 6e63 2e61 6464     await enc.add
-00008940: 5f67 7261 696e 7328 5b67 7261 696e 302c  _grains([grain0,
-00008950: 2067 7261 696e 315d 290a 2020 2020 2020   grain1]).      
-00008960: 2020 2020 2020 2020 2020 2868 6561 642c            (head,
-00008970: 2073 6567 6d65 6e74 7329 203d 206c 6f61   segments) = loa
-00008980: 6473 2866 2e67 6574 7661 6c75 6528 2929  ds(f.getvalue())
-00008990: 0a0a 2020 2020 2020 2020 7365 6c66 2e61  ..        self.a
-000089a0: 7373 6572 7449 6e28 2769 6427 2c20 6865  ssertIn('id', he
-000089b0: 6164 290a 2020 2020 2020 2020 7365 6c66  ad).        self
-000089c0: 2e61 7373 6572 7449 6e28 6865 6164 5b27  .assertIn(head['
-000089d0: 6964 275d 2c20 7575 6964 7329 0a20 2020  id'], uuids).   
-000089e0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-000089f0: 496e 2827 7461 6773 272c 2068 6561 6429  In('tags', head)
-00008a00: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-00008a10: 7365 7274 4571 7561 6c28 6c65 6e28 6865  sertEqual(len(he
-00008a20: 6164 5b27 7461 6773 275d 292c 2030 290a  ad['tags']), 0).
-00008a30: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-00008a40: 6572 7449 6e28 2763 7265 6174 6564 272c  ertIn('created',
-00008a50: 2068 6561 6429 0a20 2020 2020 2020 2073   head).        s
-00008a60: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-00008a70: 6865 6164 5b27 6372 6561 7465 6427 5d2c  head['created'],
-00008a80: 2063 7265 6174 6564 290a 2020 2020 2020   created).      
-00008a90: 2020 7365 6c66 2e61 7373 6572 7449 6e28    self.assertIn(
-00008aa0: 2773 6567 6d65 6e74 7327 2c20 6865 6164  'segments', head
-00008ab0: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-00008ac0: 7373 6572 7445 7175 616c 286c 656e 2868  ssertEqual(len(h
-00008ad0: 6561 645b 2773 6567 6d65 6e74 7327 5d29  ead['segments'])
-00008ae0: 2c20 3129 0a20 2020 2020 2020 2073 656c  , 1).        sel
-00008af0: 662e 6173 7365 7274 496e 2827 636f 756e  f.assertIn('coun
-00008b00: 7427 2c20 6865 6164 5b27 7365 676d 656e  t', head['segmen
-00008b10: 7473 275d 5b30 5d29 0a20 2020 2020 2020  ts'][0]).       
-00008b20: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-00008b30: 6c28 6865 6164 5b27 7365 676d 656e 7473  l(head['segments
-00008b40: 275d 5b30 5d5b 2763 6f75 6e74 275d 2c20  '][0]['count'], 
-00008b50: 3229 0a20 2020 2020 2020 2073 656c 662e  2).        self.
-00008b60: 6173 7365 7274 496e 2827 6c6f 6361 6c5f  assertIn('local_
-00008b70: 6964 272c 2068 6561 645b 2773 6567 6d65  id', head['segme
-00008b80: 6e74 7327 5d5b 305d 290a 2020 2020 2020  nts'][0]).      
-00008b90: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-00008ba0: 616c 2868 6561 645b 2773 6567 6d65 6e74  al(head['segment
-00008bb0: 7327 5d5b 305d 5b27 6c6f 6361 6c5f 6964  s'][0]['local_id
-00008bc0: 275d 2c20 3129 0a20 2020 2020 2020 2073  '], 1).        s
-00008bd0: 656c 662e 6173 7365 7274 496e 2827 6964  elf.assertIn('id
-00008be0: 272c 2068 6561 645b 2773 6567 6d65 6e74  ', head['segment
-00008bf0: 7327 5d5b 305d 290a 2020 2020 2020 2020  s'][0]).        
-00008c00: 7365 6c66 2e61 7373 6572 7449 6e28 6865  self.assertIn(he
-00008c10: 6164 5b27 7365 676d 656e 7473 275d 5b30  ad['segments'][0
-00008c20: 5d5b 2769 6427 5d2c 2075 7569 6473 290a  ]['id'], uuids).
-00008c30: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-00008c40: 6572 7449 6e28 2774 6167 7327 2c20 6865  ertIn('tags', he
-00008c50: 6164 5b27 7365 676d 656e 7473 275d 5b30  ad['segments'][0
-00008c60: 5d29 0a20 2020 2020 2020 2073 656c 662e  ]).        self.
-00008c70: 6173 7365 7274 4571 7561 6c28 6c65 6e28  assertEqual(len(
-00008c80: 6865 6164 5b27 7365 676d 656e 7473 275d  head['segments']
-00008c90: 5b30 5d5b 2774 6167 7327 5d29 2c20 3029  [0]['tags']), 0)
-00008ca0: 0a0a 2020 2020 2020 2020 7365 6c66 2e61  ..        self.a
-00008cb0: 7373 6572 7445 7175 616c 286c 656e 2873  ssertEqual(len(s
-00008cc0: 6567 6d65 6e74 7329 2c20 3129 0a20 2020  egments), 1).   
-00008cd0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00008ce0: 496e 2831 2c20 7365 676d 656e 7473 290a  In(1, segments).
-00008cf0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-00008d00: 6572 7445 7175 616c 286c 656e 2873 6567  ertEqual(len(seg
-00008d10: 6d65 6e74 735b 315d 292c 2068 6561 645b  ments[1]), head[
-00008d20: 2773 6567 6d65 6e74 7327 5d5b 305d 5b27  'segments'][0]['
-00008d30: 636f 756e 7427 5d29 0a0a 2020 2020 2020  count'])..      
-00008d40: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-00008d50: 616c 2873 6567 6d65 6e74 735b 315d 5b30  al(segments[1][0
-00008d60: 5d2e 736f 7572 6365 5f69 642c 2073 7263  ].source_id, src
-00008d70: 5f69 6429 0a20 2020 2020 2020 2073 656c  _id).        sel
-00008d80: 662e 6173 7365 7274 4571 7561 6c28 7365  f.assertEqual(se
-00008d90: 676d 656e 7473 5b31 5d5b 305d 2e66 6c6f  gments[1][0].flo
-00008da0: 775f 6964 2c20 666c 6f77 5f69 6429 0a20  w_id, flow_id). 
-00008db0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00008dc0: 7274 4571 7561 6c28 7365 676d 656e 7473  rtEqual(segments
-00008dd0: 5b31 5d5b 305d 2e67 7261 696e 5f74 7970  [1][0].grain_typ
-00008de0: 652c 2027 636f 6465 645f 6175 6469 6f27  e, 'coded_audio'
-00008df0: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-00008e00: 7373 6572 7445 7175 616c 2873 6567 6d65  ssertEqual(segme
-00008e10: 6e74 735b 315d 5b30 5d2e 666f 726d 6174  nts[1][0].format
-00008e20: 2c20 436f 6741 7564 696f 466f 726d 6174  , CogAudioFormat
-00008e30: 2e41 4143 290a 2020 2020 2020 2020 7365  .AAC).        se
-00008e40: 6c66 2e61 7373 6572 7445 7175 616c 2873  lf.assertEqual(s
-00008e50: 6567 6d65 6e74 735b 315d 5b30 5d2e 7361  egments[1][0].sa
-00008e60: 6d70 6c65 732c 2031 3932 3029 0a20 2020  mples, 1920).   
-00008e70: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00008e80: 4571 7561 6c28 7365 676d 656e 7473 5b31  Equal(segments[1
-00008e90: 5d5b 305d 2e73 616d 706c 655f 7261 7465  ][0].sample_rate
-00008ea0: 2c20 3438 3030 3029 0a20 2020 2020 2020  , 48000).       
-00008eb0: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-00008ec0: 6c28 7365 676d 656e 7473 5b31 5d5b 305d  l(segments[1][0]
-00008ed0: 2e70 7269 6d69 6e67 2c20 3233 290a 2020  .priming, 23).  
-00008ee0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-00008ef0: 7445 7175 616c 2873 6567 6d65 6e74 735b  tEqual(segments[
-00008f00: 315d 5b30 5d2e 7265 6d61 696e 6465 722c  1][0].remainder,
-00008f10: 2031 3729 0a0a 2020 2020 2020 2020 7365   17)..        se
-00008f20: 6c66 2e61 7373 6572 7445 7175 616c 2873  lf.assertEqual(s
-00008f30: 6567 6d65 6e74 735b 315d 5b30 5d2e 6461  egments[1][0].da
-00008f40: 7461 2c20 6772 6169 6e30 2e64 6174 6129  ta, grain0.data)
-00008f50: 0a0a 2020 2020 2020 2020 7365 6c66 2e61  ..        self.a
-00008f60: 7373 6572 7445 7175 616c 2873 6567 6d65  ssertEqual(segme
-00008f70: 6e74 735b 315d 5b31 5d2e 736f 7572 6365  nts[1][1].source
-00008f80: 5f69 642c 2073 7263 5f69 6429 0a20 2020  _id, src_id).   
-00008f90: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00008fa0: 4571 7561 6c28 7365 676d 656e 7473 5b31  Equal(segments[1
-00008fb0: 5d5b 315d 2e66 6c6f 775f 6964 2c20 666c  ][1].flow_id, fl
-00008fc0: 6f77 5f69 6429 0a20 2020 2020 2020 2073  ow_id).        s
-00008fd0: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-00008fe0: 7365 676d 656e 7473 5b31 5d5b 315d 2e67  segments[1][1].g
-00008ff0: 7261 696e 5f74 7970 652c 2027 636f 6465  rain_type, 'code
-00009000: 645f 6175 6469 6f27 290a 2020 2020 2020  d_audio').      
-00009010: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-00009020: 616c 2873 6567 6d65 6e74 735b 315d 5b31  al(segments[1][1
-00009030: 5d2e 666f 726d 6174 2c20 436f 6741 7564  ].format, CogAud
-00009040: 696f 466f 726d 6174 2e41 4143 290a 2020  ioFormat.AAC).  
-00009050: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-00009060: 7445 7175 616c 2873 6567 6d65 6e74 735b  tEqual(segments[
-00009070: 315d 5b31 5d2e 7361 6d70 6c65 732c 2031  1][1].samples, 1
-00009080: 3932 3029 0a20 2020 2020 2020 2073 656c  920).        sel
-00009090: 662e 6173 7365 7274 4571 7561 6c28 7365  f.assertEqual(se
-000090a0: 676d 656e 7473 5b31 5d5b 315d 2e73 616d  gments[1][1].sam
-000090b0: 706c 655f 7261 7465 2c20 3438 3030 3029  ple_rate, 48000)
-000090c0: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-000090d0: 7365 7274 4571 7561 6c28 7365 676d 656e  sertEqual(segmen
-000090e0: 7473 5b31 5d5b 315d 2e70 7269 6d69 6e67  ts[1][1].priming
-000090f0: 2c20 3529 0a20 2020 2020 2020 2073 656c  , 5).        sel
-00009100: 662e 6173 7365 7274 4571 7561 6c28 7365  f.assertEqual(se
-00009110: 676d 656e 7473 5b31 5d5b 315d 2e72 656d  gments[1][1].rem
-00009120: 6169 6e64 6572 2c20 3130 3429 0a0a 2020  ainder, 104)..  
-00009130: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-00009140: 7445 7175 616c 2873 6567 6d65 6e74 735b  tEqual(segments[
-00009150: 315d 5b31 5d2e 6461 7461 2c20 6772 6169  1][1].data, grai
-00009160: 6e31 2e64 6174 6129 0a0a 2020 2020 6465  n1.data)..    de
-00009170: 6620 7465 7374 5f64 756d 7073 5f65 7665  f test_dumps_eve
-00009180: 6e74 6772 6169 6e73 2873 656c 6629 3a0a  ntgrains(self):.
-00009190: 2020 2020 2020 2020 7372 635f 6964 203d          src_id =
-000091a0: 2055 5549 4428 2765 3134 6539 6435 382d   UUID('e14e9d58-
-000091b0: 3135 3637 2d31 3165 382d 3864 6433 2d38  1567-11e8-8dd3-8
-000091c0: 3331 6130 3638 6562 3033 3427 290a 2020  31a068eb034').  
-000091d0: 2020 2020 2020 666c 6f77 5f69 6420 3d20        flow_id = 
-000091e0: 5555 4944 2827 6565 3165 6564 3538 2d31  UUID('ee1eed58-1
-000091f0: 3536 372d 3131 6538 2d61 3937 312d 3362  567-11e8-a971-3b
-00009200: 3930 3161 3264 6438 6162 2729 0a20 2020  901a2dd8ab').   
-00009210: 2020 2020 2067 7261 696e 3020 3d20 4576       grain0 = Ev
-00009220: 656e 7447 7261 696e 2873 7263 5f69 642c  entGrain(src_id,
-00009230: 2066 6c6f 775f 6964 290a 2020 2020 2020   flow_id).      
-00009240: 2020 6772 6169 6e30 2e65 7665 6e74 5f74    grain0.event_t
-00009250: 7970 6520 3d20 2275 726e 3a78 2d74 6573  ype = "urn:x-tes
-00009260: 7469 6e67 3a73 7475 7069 642f 7479 7065  ting:stupid/type
-00009270: 220a 2020 2020 2020 2020 6772 6169 6e30  ".        grain0
-00009280: 2e74 6f70 6963 203d 2022 2f77 6174 6173  .topic = "/watas
-00009290: 6869 220a 2020 2020 2020 2020 6772 6169  hi".        grai
-000092a0: 6e30 2e61 7070 656e 6428 222f 696e 7522  n0.append("/inu"
-000092b0: 2c20 706f 7374 3d22 6465 7375 2229 0a20  , post="desu"). 
-000092c0: 2020 2020 2020 2067 7261 696e 3120 3d20         grain1 = 
-000092d0: 4576 656e 7447 7261 696e 2873 7263 5f69  EventGrain(src_i
-000092e0: 642c 2066 6c6f 775f 6964 290a 2020 2020  d, flow_id).    
-000092f0: 2020 2020 6772 6169 6e31 2e65 7665 6e74      grain1.event
-00009300: 5f74 7970 6520 3d20 2275 726e 3a78 2d74  _type = "urn:x-t
-00009310: 6573 7469 6e67 3a63 6c65 7665 722f 7479  esting:clever/ty
-00009320: 7065 220a 2020 2020 2020 2020 6772 6169  pe".        grai
-00009330: 6e31 2e74 6f70 6963 203d 2022 2f69 6e75  n1.topic = "/inu
-00009340: 220a 2020 2020 2020 2020 6772 6169 6e31  ".        grain1
-00009350: 2e61 7070 656e 6428 222f 7375 6b69 6d6f  .append("/sukimo
-00009360: 6e6f 222c 2070 7265 3d22 6461 2229 0a20  no", pre="da"). 
-00009370: 2020 2020 2020 2075 7569 6473 203d 205b         uuids = [
-00009380: 5555 4944 2827 3739 3230 6233 3934 2d31  UUID('7920b394-1
-00009390: 3536 352d 3131 6538 2d38 3665 302d 3862  565-11e8-86e0-8b
-000093a0: 3432 6434 3634 3762 6138 2729 2c0a 2020  42d4647ba8'),.  
-000093b0: 2020 2020 2020 2020 2020 2020 2020 2055                 U
-000093c0: 5549 4428 2738 3061 6638 3735 632d 3135  UID('80af875c-15
-000093d0: 3635 2d31 3165 382d 3866 3434 2d38 3765  65-11e8-8f44-87e
-000093e0: 6630 3831 6234 3863 6427 295d 0a20 2020  f081b48cd')].   
-000093f0: 2020 2020 2063 7265 6174 6564 203d 2064       created = d
-00009400: 6174 6574 696d 6528 3139 3833 2c20 332c  atetime(1983, 3,
-00009410: 2032 392c 2031 352c 2031 3529 0a20 2020   29, 15, 15).   
-00009420: 2020 2020 2077 6974 6820 6d6f 636b 2e70       with mock.p
-00009430: 6174 6368 2827 6d65 6469 6167 7261 696e  atch('mediagrain
-00009440: 732e 6773 662e 6461 7465 7469 6d65 272c  s.gsf.datetime',
-00009450: 2073 6964 655f 6566 6665 6374 3d64 6174   side_effect=dat
-00009460: 6574 696d 652c 206e 6f77 3d6d 6f63 6b2e  etime, now=mock.
-00009470: 4d61 6769 634d 6f63 6b28 7265 7475 726e  MagicMock(return
-00009480: 5f76 616c 7565 3d63 7265 6174 6564 2929  _value=created))
-00009490: 3a0a 2020 2020 2020 2020 2020 2020 7769  :.            wi
-000094a0: 7468 206d 6f63 6b2e 7061 7463 6828 276d  th mock.patch('m
-000094b0: 6564 6961 6772 6169 6e73 2e67 7366 2e75  ediagrains.gsf.u
-000094c0: 7569 6431 272c 2073 6964 655f 6566 6665  uid1', side_effe
-000094d0: 6374 3d75 7569 6473 293a 0a20 2020 2020  ct=uuids):.     
-000094e0: 2020 2020 2020 2020 2020 2028 6865 6164             (head
-000094f0: 2c20 7365 676d 656e 7473 2920 3d20 6c6f  , segments) = lo
-00009500: 6164 7328 6475 6d70 7328 5b67 7261 696e  ads(dumps([grain
-00009510: 302c 2067 7261 696e 315d 2929 0a0a 2020  0, grain1]))..  
-00009520: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-00009530: 7449 6e28 2769 6427 2c20 6865 6164 290a  tIn('id', head).
-00009540: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-00009550: 6572 7449 6e28 6865 6164 5b27 6964 275d  ertIn(head['id']
-00009560: 2c20 7575 6964 7329 0a20 2020 2020 2020  , uuids).       
-00009570: 2073 656c 662e 6173 7365 7274 496e 2827   self.assertIn('
-00009580: 7461 6773 272c 2068 6561 6429 0a20 2020  tags', head).   
-00009590: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-000095a0: 4571 7561 6c28 6c65 6e28 6865 6164 5b27  Equal(len(head['
-000095b0: 7461 6773 275d 292c 2030 290a 2020 2020  tags']), 0).    
-000095c0: 2020 2020 7365 6c66 2e61 7373 6572 7449      self.assertI
-000095d0: 6e28 2763 7265 6174 6564 272c 2068 6561  n('created', hea
-000095e0: 6429 0a20 2020 2020 2020 2073 656c 662e  d).        self.
-000095f0: 6173 7365 7274 4571 7561 6c28 6865 6164  assertEqual(head
-00009600: 5b27 6372 6561 7465 6427 5d2c 2063 7265  ['created'], cre
-00009610: 6174 6564 290a 2020 2020 2020 2020 7365  ated).        se
-00009620: 6c66 2e61 7373 6572 7449 6e28 2773 6567  lf.assertIn('seg
-00009630: 6d65 6e74 7327 2c20 6865 6164 290a 2020  ments', head).  
-00009640: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-00009650: 7445 7175 616c 286c 656e 2868 6561 645b  tEqual(len(head[
-00009660: 2773 6567 6d65 6e74 7327 5d29 2c20 3129  'segments']), 1)
-00009670: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-00009680: 7365 7274 496e 2827 636f 756e 7427 2c20  sertIn('count', 
-00009690: 6865 6164 5b27 7365 676d 656e 7473 275d  head['segments']
-000096a0: 5b30 5d29 0a20 2020 2020 2020 2073 656c  [0]).        sel
-000096b0: 662e 6173 7365 7274 4571 7561 6c28 6865  f.assertEqual(he
-000096c0: 6164 5b27 7365 676d 656e 7473 275d 5b30  ad['segments'][0
-000096d0: 5d5b 2763 6f75 6e74 275d 2c20 3229 0a20  ]['count'], 2). 
-000096e0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-000096f0: 7274 496e 2827 6c6f 6361 6c5f 6964 272c  rtIn('local_id',
-00009700: 2068 6561 645b 2773 6567 6d65 6e74 7327   head['segments'
-00009710: 5d5b 305d 290a 2020 2020 2020 2020 7365  ][0]).        se
-00009720: 6c66 2e61 7373 6572 7445 7175 616c 2868  lf.assertEqual(h
-00009730: 6561 645b 2773 6567 6d65 6e74 7327 5d5b  ead['segments'][
-00009740: 305d 5b27 6c6f 6361 6c5f 6964 275d 2c20  0]['local_id'], 
-00009750: 3129 0a20 2020 2020 2020 2073 656c 662e  1).        self.
-00009760: 6173 7365 7274 496e 2827 6964 272c 2068  assertIn('id', h
-00009770: 6561 645b 2773 6567 6d65 6e74 7327 5d5b  ead['segments'][
-00009780: 305d 290a 2020 2020 2020 2020 7365 6c66  0]).        self
-00009790: 2e61 7373 6572 7449 6e28 6865 6164 5b27  .assertIn(head['
-000097a0: 7365 676d 656e 7473 275d 5b30 5d5b 2769  segments'][0]['i
-000097b0: 6427 5d2c 2075 7569 6473 290a 2020 2020  d'], uuids).    
-000097c0: 2020 2020 7365 6c66 2e61 7373 6572 7449      self.assertI
-000097d0: 6e28 2774 6167 7327 2c20 6865 6164 5b27  n('tags', head['
-000097e0: 7365 676d 656e 7473 275d 5b30 5d29 0a20  segments'][0]). 
-000097f0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00009800: 7274 4571 7561 6c28 6c65 6e28 6865 6164  rtEqual(len(head
-00009810: 5b27 7365 676d 656e 7473 275d 5b30 5d5b  ['segments'][0][
-00009820: 2774 6167 7327 5d29 2c20 3029 0a0a 2020  'tags']), 0)..  
-00009830: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-00009840: 7445 7175 616c 286c 656e 2873 6567 6d65  tEqual(len(segme
-00009850: 6e74 7329 2c20 3129 0a20 2020 2020 2020  nts), 1).       
-00009860: 2073 656c 662e 6173 7365 7274 496e 2831   self.assertIn(1
-00009870: 2c20 7365 676d 656e 7473 290a 2020 2020  , segments).    
-00009880: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-00009890: 7175 616c 286c 656e 2873 6567 6d65 6e74  qual(len(segment
-000098a0: 735b 315d 292c 2068 6561 645b 2773 6567  s[1]), head['seg
-000098b0: 6d65 6e74 7327 5d5b 305d 5b27 636f 756e  ments'][0]['coun
-000098c0: 7427 5d29 0a0a 2020 2020 2020 2020 7365  t'])..        se
-000098d0: 6c66 2e61 7373 6572 7445 7175 616c 2873  lf.assertEqual(s
-000098e0: 6567 6d65 6e74 735b 315d 5b30 5d2e 736f  egments[1][0].so
-000098f0: 7572 6365 5f69 642c 2073 7263 5f69 6429  urce_id, src_id)
-00009900: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-00009910: 7365 7274 4571 7561 6c28 7365 676d 656e  sertEqual(segmen
-00009920: 7473 5b31 5d5b 305d 2e66 6c6f 775f 6964  ts[1][0].flow_id
-00009930: 2c20 666c 6f77 5f69 6429 0a20 2020 2020  , flow_id).     
-00009940: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-00009950: 7561 6c28 7365 676d 656e 7473 5b31 5d5b  ual(segments[1][
-00009960: 305d 2e67 7261 696e 5f74 7970 652c 2027  0].grain_type, '
-00009970: 6576 656e 7427 290a 2020 2020 2020 2020  event').        
-00009980: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-00009990: 2873 6567 6d65 6e74 735b 315d 5b30 5d2e  (segments[1][0].
-000099a0: 6576 656e 745f 7479 7065 2c20 2275 726e  event_type, "urn
-000099b0: 3a78 2d74 6573 7469 6e67 3a73 7475 7069  :x-testing:stupi
-000099c0: 642f 7479 7065 2229 0a20 2020 2020 2020  d/type").       
-000099d0: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-000099e0: 6c28 7365 676d 656e 7473 5b31 5d5b 305d  l(segments[1][0]
-000099f0: 2e74 6f70 6963 2c20 222f 7761 7461 7368  .topic, "/watash
-00009a00: 6922 290a 2020 2020 2020 2020 7365 6c66  i").        self
-00009a10: 2e61 7373 6572 7445 7175 616c 286c 656e  .assertEqual(len
-00009a20: 2873 6567 6d65 6e74 735b 315d 5b30 5d2e  (segments[1][0].
-00009a30: 6576 656e 745f 6461 7461 292c 2031 290a  event_data), 1).
-00009a40: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-00009a50: 6572 7445 7175 616c 2873 6567 6d65 6e74  ertEqual(segment
-00009a60: 735b 315d 5b30 5d2e 6576 656e 745f 6461  s[1][0].event_da
-00009a70: 7461 5b30 5d2e 7061 7468 2c20 222f 696e  ta[0].path, "/in
-00009a80: 7522 290a 2020 2020 2020 2020 7365 6c66  u").        self
-00009a90: 2e61 7373 6572 7449 734e 6f6e 6528 7365  .assertIsNone(se
-00009aa0: 676d 656e 7473 5b31 5d5b 305d 2e65 7665  gments[1][0].eve
-00009ab0: 6e74 5f64 6174 615b 305d 2e70 7265 290a  nt_data[0].pre).
-00009ac0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-00009ad0: 6572 7445 7175 616c 2873 6567 6d65 6e74  ertEqual(segment
-00009ae0: 735b 315d 5b30 5d2e 6576 656e 745f 6461  s[1][0].event_da
-00009af0: 7461 5b30 5d2e 706f 7374 2c20 2264 6573  ta[0].post, "des
-00009b00: 7522 290a 0a20 2020 2020 2020 2073 656c  u")..        sel
-00009b10: 662e 6173 7365 7274 4571 7561 6c28 7365  f.assertEqual(se
-00009b20: 676d 656e 7473 5b31 5d5b 315d 2e73 6f75  gments[1][1].sou
-00009b30: 7263 655f 6964 2c20 7372 635f 6964 290a  rce_id, src_id).
-00009b40: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-00009b50: 6572 7445 7175 616c 2873 6567 6d65 6e74  ertEqual(segment
-00009b60: 735b 315d 5b31 5d2e 666c 6f77 5f69 642c  s[1][1].flow_id,
-00009b70: 2066 6c6f 775f 6964 290a 2020 2020 2020   flow_id).      
-00009b80: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-00009b90: 616c 2873 6567 6d65 6e74 735b 315d 5b31  al(segments[1][1
-00009ba0: 5d2e 6772 6169 6e5f 7479 7065 2c20 2765  ].grain_type, 'e
-00009bb0: 7665 6e74 2729 0a20 2020 2020 2020 2073  vent').        s
-00009bc0: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-00009bd0: 7365 676d 656e 7473 5b31 5d5b 315d 2e65  segments[1][1].e
-00009be0: 7665 6e74 5f74 7970 652c 2022 7572 6e3a  vent_type, "urn:
-00009bf0: 782d 7465 7374 696e 673a 636c 6576 6572  x-testing:clever
-00009c00: 2f74 7970 6522 290a 2020 2020 2020 2020  /type").        
-00009c10: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-00009c20: 2873 6567 6d65 6e74 735b 315d 5b31 5d2e  (segments[1][1].
-00009c30: 746f 7069 632c 2022 2f69 6e75 2229 0a20  topic, "/inu"). 
-00009c40: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00009c50: 7274 4571 7561 6c28 6c65 6e28 7365 676d  rtEqual(len(segm
-00009c60: 656e 7473 5b31 5d5b 315d 2e65 7665 6e74  ents[1][1].event
-00009c70: 5f64 6174 6129 2c20 3129 0a20 2020 2020  _data), 1).     
-00009c80: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-00009c90: 7561 6c28 7365 676d 656e 7473 5b31 5d5b  ual(segments[1][
-00009ca0: 315d 2e65 7665 6e74 5f64 6174 615b 305d  1].event_data[0]
-00009cb0: 2e70 6174 682c 2022 2f73 756b 696d 6f6e  .path, "/sukimon
-00009cc0: 6f22 290a 2020 2020 2020 2020 7365 6c66  o").        self
-00009cd0: 2e61 7373 6572 7445 7175 616c 2873 6567  .assertEqual(seg
-00009ce0: 6d65 6e74 735b 315d 5b31 5d2e 6576 656e  ments[1][1].even
-00009cf0: 745f 6461 7461 5b30 5d2e 7072 652c 2022  t_data[0].pre, "
-00009d00: 6461 2229 0a20 2020 2020 2020 2073 656c  da").        sel
-00009d10: 662e 6173 7365 7274 4973 4e6f 6e65 2873  f.assertIsNone(s
-00009d20: 6567 6d65 6e74 735b 315d 5b31 5d2e 6576  egments[1][1].ev
-00009d30: 656e 745f 6461 7461 5b30 5d2e 706f 7374  ent_data[0].post
-00009d40: 290a 0a20 2020 2061 7379 6e63 2064 6566  )..    async def
-00009d50: 2074 6573 745f 6173 796e 635f 656e 636f   test_async_enco
-00009d60: 6465 5f65 7665 6e74 6772 6169 6e73 2873  de_eventgrains(s
-00009d70: 656c 6629 3a0a 2020 2020 2020 2020 7372  elf):.        sr
-00009d80: 635f 6964 203d 2055 5549 4428 2765 3134  c_id = UUID('e14
-00009d90: 6539 6435 382d 3135 3637 2d31 3165 382d  e9d58-1567-11e8-
-00009da0: 3864 6433 2d38 3331 6130 3638 6562 3033  8dd3-831a068eb03
-00009db0: 3427 290a 2020 2020 2020 2020 666c 6f77  4').        flow
-00009dc0: 5f69 6420 3d20 5555 4944 2827 6565 3165  _id = UUID('ee1e
-00009dd0: 6564 3538 2d31 3536 372d 3131 6538 2d61  ed58-1567-11e8-a
-00009de0: 3937 312d 3362 3930 3161 3264 6438 6162  971-3b901a2dd8ab
-00009df0: 2729 0a20 2020 2020 2020 2067 7261 696e  ').        grain
-00009e00: 3020 3d20 4576 656e 7447 7261 696e 2873  0 = EventGrain(s
-00009e10: 7263 5f69 642c 2066 6c6f 775f 6964 290a  rc_id, flow_id).
-00009e20: 2020 2020 2020 2020 6772 6169 6e30 2e65          grain0.e
-00009e30: 7665 6e74 5f74 7970 6520 3d20 2275 726e  vent_type = "urn
-00009e40: 3a78 2d74 6573 7469 6e67 3a73 7475 7069  :x-testing:stupi
-00009e50: 642f 7479 7065 220a 2020 2020 2020 2020  d/type".        
-00009e60: 6772 6169 6e30 2e74 6f70 6963 203d 2022  grain0.topic = "
-00009e70: 2f77 6174 6173 6869 220a 2020 2020 2020  /watashi".      
-00009e80: 2020 6772 6169 6e30 2e61 7070 656e 6428    grain0.append(
-00009e90: 222f 696e 7522 2c20 706f 7374 3d22 6465  "/inu", post="de
-00009ea0: 7375 2229 0a20 2020 2020 2020 2067 7261  su").        gra
-00009eb0: 696e 3120 3d20 4576 656e 7447 7261 696e  in1 = EventGrain
-00009ec0: 2873 7263 5f69 642c 2066 6c6f 775f 6964  (src_id, flow_id
-00009ed0: 290a 2020 2020 2020 2020 6772 6169 6e31  ).        grain1
-00009ee0: 2e65 7665 6e74 5f74 7970 6520 3d20 2275  .event_type = "u
-00009ef0: 726e 3a78 2d74 6573 7469 6e67 3a63 6c65  rn:x-testing:cle
-00009f00: 7665 722f 7479 7065 220a 2020 2020 2020  ver/type".      
-00009f10: 2020 6772 6169 6e31 2e74 6f70 6963 203d    grain1.topic =
-00009f20: 2022 2f69 6e75 220a 2020 2020 2020 2020   "/inu".        
-00009f30: 6772 6169 6e31 2e61 7070 656e 6428 222f  grain1.append("/
-00009f40: 7375 6b69 6d6f 6e6f 222c 2070 7265 3d22  sukimono", pre="
-00009f50: 6461 2229 0a20 2020 2020 2020 2075 7569  da").        uui
-00009f60: 6473 203d 205b 5555 4944 2827 3739 3230  ds = [UUID('7920
-00009f70: 6233 3934 2d31 3536 352d 3131 6538 2d38  b394-1565-11e8-8
-00009f80: 3665 302d 3862 3432 6434 3634 3762 6138  6e0-8b42d4647ba8
-00009f90: 2729 2c0a 2020 2020 2020 2020 2020 2020  '),.            
-00009fa0: 2020 2020 2055 5549 4428 2738 3061 6638       UUID('80af8
-00009fb0: 3735 632d 3135 3635 2d31 3165 382d 3866  75c-1565-11e8-8f
-00009fc0: 3434 2d38 3765 6630 3831 6234 3863 6427  44-87ef081b48cd'
-00009fd0: 295d 0a20 2020 2020 2020 2063 7265 6174  )].        creat
-00009fe0: 6564 203d 2064 6174 6574 696d 6528 3139  ed = datetime(19
-00009ff0: 3833 2c20 332c 2032 392c 2031 352c 2031  83, 3, 29, 15, 1
-0000a000: 3529 0a20 2020 2020 2020 2077 6974 6820  5).        with 
-0000a010: 6d6f 636b 2e70 6174 6368 2827 6d65 6469  mock.patch('medi
-0000a020: 6167 7261 696e 732e 6773 662e 6461 7465  agrains.gsf.date
-0000a030: 7469 6d65 272c 2073 6964 655f 6566 6665  time', side_effe
-0000a040: 6374 3d64 6174 6574 696d 652c 206e 6f77  ct=datetime, now
-0000a050: 3d6d 6f63 6b2e 4d61 6769 634d 6f63 6b28  =mock.MagicMock(
-0000a060: 7265 7475 726e 5f76 616c 7565 3d63 7265  return_value=cre
-0000a070: 6174 6564 2929 3a0a 2020 2020 2020 2020  ated)):.        
-0000a080: 2020 2020 7769 7468 206d 6f63 6b2e 7061      with mock.pa
-0000a090: 7463 6828 276d 6564 6961 6772 6169 6e73  tch('mediagrains
-0000a0a0: 2e67 7366 2e75 7569 6431 272c 2073 6964  .gsf.uuid1', sid
-0000a0b0: 655f 6566 6665 6374 3d75 7569 6473 293a  e_effect=uuids):
-0000a0c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000a0d0: 2066 203d 2042 7974 6573 494f 2829 0a20   f = BytesIO(). 
-0000a0e0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-0000a0f0: 7379 6e63 2077 6974 6820 4753 4645 6e63  sync with GSFEnc
-0000a100: 6f64 6572 2866 2920 6173 2065 6e63 3a0a  oder(f) as enc:.
-0000a110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a120: 2020 2020 6177 6169 7420 656e 632e 6164      await enc.ad
-0000a130: 645f 6772 6169 6e73 285b 6772 6169 6e30  d_grains([grain0
-0000a140: 2c20 6772 6169 6e31 5d29 0a20 2020 2020  , grain1]).     
-0000a150: 2020 2020 2020 2020 2020 2028 6865 6164             (head
-0000a160: 2c20 7365 676d 656e 7473 2920 3d20 6c6f  , segments) = lo
-0000a170: 6164 7328 662e 6765 7476 616c 7565 2829  ads(f.getvalue()
-0000a180: 290a 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-0000a190: 6173 7365 7274 496e 2827 6964 272c 2068  assertIn('id', h
-0000a1a0: 6561 6429 0a20 2020 2020 2020 2073 656c  ead).        sel
-0000a1b0: 662e 6173 7365 7274 496e 2868 6561 645b  f.assertIn(head[
-0000a1c0: 2769 6427 5d2c 2075 7569 6473 290a 2020  'id'], uuids).  
-0000a1d0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-0000a1e0: 7449 6e28 2774 6167 7327 2c20 6865 6164  tIn('tags', head
-0000a1f0: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-0000a200: 7373 6572 7445 7175 616c 286c 656e 2868  ssertEqual(len(h
-0000a210: 6561 645b 2774 6167 7327 5d29 2c20 3029  ead['tags']), 0)
-0000a220: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-0000a230: 7365 7274 496e 2827 6372 6561 7465 6427  sertIn('created'
-0000a240: 2c20 6865 6164 290a 2020 2020 2020 2020  , head).        
-0000a250: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-0000a260: 2868 6561 645b 2763 7265 6174 6564 275d  (head['created']
-0000a270: 2c20 6372 6561 7465 6429 0a20 2020 2020  , created).     
-0000a280: 2020 2073 656c 662e 6173 7365 7274 496e     self.assertIn
-0000a290: 2827 7365 676d 656e 7473 272c 2068 6561  ('segments', hea
-0000a2a0: 6429 0a20 2020 2020 2020 2073 656c 662e  d).        self.
-0000a2b0: 6173 7365 7274 4571 7561 6c28 6c65 6e28  assertEqual(len(
-0000a2c0: 6865 6164 5b27 7365 676d 656e 7473 275d  head['segments']
-0000a2d0: 292c 2031 290a 2020 2020 2020 2020 7365  ), 1).        se
-0000a2e0: 6c66 2e61 7373 6572 7449 6e28 2763 6f75  lf.assertIn('cou
-0000a2f0: 6e74 272c 2068 6561 645b 2773 6567 6d65  nt', head['segme
-0000a300: 6e74 7327 5d5b 305d 290a 2020 2020 2020  nts'][0]).      
-0000a310: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-0000a320: 616c 2868 6561 645b 2773 6567 6d65 6e74  al(head['segment
-0000a330: 7327 5d5b 305d 5b27 636f 756e 7427 5d2c  s'][0]['count'],
-0000a340: 2032 290a 2020 2020 2020 2020 7365 6c66   2).        self
-0000a350: 2e61 7373 6572 7449 6e28 276c 6f63 616c  .assertIn('local
-0000a360: 5f69 6427 2c20 6865 6164 5b27 7365 676d  _id', head['segm
-0000a370: 656e 7473 275d 5b30 5d29 0a20 2020 2020  ents'][0]).     
-0000a380: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-0000a390: 7561 6c28 6865 6164 5b27 7365 676d 656e  ual(head['segmen
-0000a3a0: 7473 275d 5b30 5d5b 276c 6f63 616c 5f69  ts'][0]['local_i
-0000a3b0: 6427 5d2c 2031 290a 2020 2020 2020 2020  d'], 1).        
-0000a3c0: 7365 6c66 2e61 7373 6572 7449 6e28 2769  self.assertIn('i
-0000a3d0: 6427 2c20 6865 6164 5b27 7365 676d 656e  d', head['segmen
-0000a3e0: 7473 275d 5b30 5d29 0a20 2020 2020 2020  ts'][0]).       
-0000a3f0: 2073 656c 662e 6173 7365 7274 496e 2868   self.assertIn(h
-0000a400: 6561 645b 2773 6567 6d65 6e74 7327 5d5b  ead['segments'][
-0000a410: 305d 5b27 6964 275d 2c20 7575 6964 7329  0]['id'], uuids)
-0000a420: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-0000a430: 7365 7274 496e 2827 7461 6773 272c 2068  sertIn('tags', h
-0000a440: 6561 645b 2773 6567 6d65 6e74 7327 5d5b  ead['segments'][
-0000a450: 305d 290a 2020 2020 2020 2020 7365 6c66  0]).        self
-0000a460: 2e61 7373 6572 7445 7175 616c 286c 656e  .assertEqual(len
-0000a470: 2868 6561 645b 2773 6567 6d65 6e74 7327  (head['segments'
-0000a480: 5d5b 305d 5b27 7461 6773 275d 292c 2030  ][0]['tags']), 0
-0000a490: 290a 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-0000a4a0: 6173 7365 7274 4571 7561 6c28 6c65 6e28  assertEqual(len(
-0000a4b0: 7365 676d 656e 7473 292c 2031 290a 2020  segments), 1).  
-0000a4c0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-0000a4d0: 7449 6e28 312c 2073 6567 6d65 6e74 7329  tIn(1, segments)
-0000a4e0: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-0000a4f0: 7365 7274 4571 7561 6c28 6c65 6e28 7365  sertEqual(len(se
-0000a500: 676d 656e 7473 5b31 5d29 2c20 6865 6164  gments[1]), head
-0000a510: 5b27 7365 676d 656e 7473 275d 5b30 5d5b  ['segments'][0][
-0000a520: 2763 6f75 6e74 275d 290a 0a20 2020 2020  'count'])..     
-0000a530: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-0000a540: 7561 6c28 7365 676d 656e 7473 5b31 5d5b  ual(segments[1][
-0000a550: 305d 2e73 6f75 7263 655f 6964 2c20 7372  0].source_id, sr
-0000a560: 635f 6964 290a 2020 2020 2020 2020 7365  c_id).        se
-0000a570: 6c66 2e61 7373 6572 7445 7175 616c 2873  lf.assertEqual(s
-0000a580: 6567 6d65 6e74 735b 315d 5b30 5d2e 666c  egments[1][0].fl
-0000a590: 6f77 5f69 642c 2066 6c6f 775f 6964 290a  ow_id, flow_id).
-0000a5a0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-0000a5b0: 6572 7445 7175 616c 2873 6567 6d65 6e74  ertEqual(segment
-0000a5c0: 735b 315d 5b30 5d2e 6772 6169 6e5f 7479  s[1][0].grain_ty
-0000a5d0: 7065 2c20 2765 7665 6e74 2729 0a20 2020  pe, 'event').   
-0000a5e0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-0000a5f0: 4571 7561 6c28 7365 676d 656e 7473 5b31  Equal(segments[1
-0000a600: 5d5b 305d 2e65 7665 6e74 5f74 7970 652c  ][0].event_type,
-0000a610: 2022 7572 6e3a 782d 7465 7374 696e 673a   "urn:x-testing:
-0000a620: 7374 7570 6964 2f74 7970 6522 290a 2020  stupid/type").  
-0000a630: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-0000a640: 7445 7175 616c 2873 6567 6d65 6e74 735b  tEqual(segments[
-0000a650: 315d 5b30 5d2e 746f 7069 632c 2022 2f77  1][0].topic, "/w
-0000a660: 6174 6173 6869 2229 0a20 2020 2020 2020  atashi").       
-0000a670: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-0000a680: 6c28 6c65 6e28 7365 676d 656e 7473 5b31  l(len(segments[1
-0000a690: 5d5b 305d 2e65 7665 6e74 5f64 6174 6129  ][0].event_data)
-0000a6a0: 2c20 3129 0a20 2020 2020 2020 2073 656c  , 1).        sel
-0000a6b0: 662e 6173 7365 7274 4571 7561 6c28 7365  f.assertEqual(se
-0000a6c0: 676d 656e 7473 5b31 5d5b 305d 2e65 7665  gments[1][0].eve
-0000a6d0: 6e74 5f64 6174 615b 305d 2e70 6174 682c  nt_data[0].path,
-0000a6e0: 2022 2f69 6e75 2229 0a20 2020 2020 2020   "/inu").       
-0000a6f0: 2073 656c 662e 6173 7365 7274 4973 4e6f   self.assertIsNo
-0000a700: 6e65 2873 6567 6d65 6e74 735b 315d 5b30  ne(segments[1][0
-0000a710: 5d2e 6576 656e 745f 6461 7461 5b30 5d2e  ].event_data[0].
-0000a720: 7072 6529 0a20 2020 2020 2020 2073 656c  pre).        sel
-0000a730: 662e 6173 7365 7274 4571 7561 6c28 7365  f.assertEqual(se
-0000a740: 676d 656e 7473 5b31 5d5b 305d 2e65 7665  gments[1][0].eve
-0000a750: 6e74 5f64 6174 615b 305d 2e70 6f73 742c  nt_data[0].post,
-0000a760: 2022 6465 7375 2229 0a0a 2020 2020 2020   "desu")..      
-0000a770: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-0000a780: 616c 2873 6567 6d65 6e74 735b 315d 5b31  al(segments[1][1
-0000a790: 5d2e 736f 7572 6365 5f69 642c 2073 7263  ].source_id, src
-0000a7a0: 5f69 6429 0a20 2020 2020 2020 2073 656c  _id).        sel
-0000a7b0: 662e 6173 7365 7274 4571 7561 6c28 7365  f.assertEqual(se
-0000a7c0: 676d 656e 7473 5b31 5d5b 315d 2e66 6c6f  gments[1][1].flo
-0000a7d0: 775f 6964 2c20 666c 6f77 5f69 6429 0a20  w_id, flow_id). 
-0000a7e0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-0000a7f0: 7274 4571 7561 6c28 7365 676d 656e 7473  rtEqual(segments
-0000a800: 5b31 5d5b 315d 2e67 7261 696e 5f74 7970  [1][1].grain_typ
-0000a810: 652c 2027 6576 656e 7427 290a 2020 2020  e, 'event').    
-0000a820: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-0000a830: 7175 616c 2873 6567 6d65 6e74 735b 315d  qual(segments[1]
-0000a840: 5b31 5d2e 6576 656e 745f 7479 7065 2c20  [1].event_type, 
-0000a850: 2275 726e 3a78 2d74 6573 7469 6e67 3a63  "urn:x-testing:c
-0000a860: 6c65 7665 722f 7479 7065 2229 0a20 2020  lever/type").   
-0000a870: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-0000a880: 4571 7561 6c28 7365 676d 656e 7473 5b31  Equal(segments[1
-0000a890: 5d5b 315d 2e74 6f70 6963 2c20 222f 696e  ][1].topic, "/in
-0000a8a0: 7522 290a 2020 2020 2020 2020 7365 6c66  u").        self
-0000a8b0: 2e61 7373 6572 7445 7175 616c 286c 656e  .assertEqual(len
-0000a8c0: 2873 6567 6d65 6e74 735b 315d 5b31 5d2e  (segments[1][1].
-0000a8d0: 6576 656e 745f 6461 7461 292c 2031 290a  event_data), 1).
-0000a8e0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-0000a8f0: 6572 7445 7175 616c 2873 6567 6d65 6e74  ertEqual(segment
-0000a900: 735b 315d 5b31 5d2e 6576 656e 745f 6461  s[1][1].event_da
-0000a910: 7461 5b30 5d2e 7061 7468 2c20 222f 7375  ta[0].path, "/su
-0000a920: 6b69 6d6f 6e6f 2229 0a20 2020 2020 2020  kimono").       
-0000a930: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-0000a940: 6c28 7365 676d 656e 7473 5b31 5d5b 315d  l(segments[1][1]
-0000a950: 2e65 7665 6e74 5f64 6174 615b 305d 2e70  .event_data[0].p
-0000a960: 7265 2c20 2264 6122 290a 2020 2020 2020  re, "da").      
-0000a970: 2020 7365 6c66 2e61 7373 6572 7449 734e    self.assertIsN
-0000a980: 6f6e 6528 7365 676d 656e 7473 5b31 5d5b  one(segments[1][
-0000a990: 315d 2e65 7665 6e74 5f64 6174 615b 305d  1].event_data[0]
-0000a9a0: 2e70 6f73 7429 0a0a 2020 2020 6465 6620  .post)..    def 
-0000a9b0: 7465 7374 5f64 756d 7073 5f65 6d70 7479  test_dumps_empty
-0000a9c0: 6772 6169 6e73 2873 656c 6629 3a0a 2020  grains(self):.  
-0000a9d0: 2020 2020 2020 7372 635f 6964 203d 2055        src_id = U
-0000a9e0: 5549 4428 2765 3134 6539 6435 382d 3135  UID('e14e9d58-15
-0000a9f0: 3637 2d31 3165 382d 3864 6433 2d38 3331  67-11e8-8dd3-831
-0000aa00: 6130 3638 6562 3033 3427 290a 2020 2020  a068eb034').    
-0000aa10: 2020 2020 666c 6f77 5f69 6420 3d20 5555      flow_id = UU
-0000aa20: 4944 2827 6565 3165 6564 3538 2d31 3536  ID('ee1eed58-156
-0000aa30: 372d 3131 6538 2d61 3937 312d 3362 3930  7-11e8-a971-3b90
-0000aa40: 3161 3264 6438 6162 2729 0a20 2020 2020  1a2dd8ab').     
-0000aa50: 2020 2067 7261 696e 3020 3d20 4772 6169     grain0 = Grai
-0000aa60: 6e28 7372 635f 6964 2c20 666c 6f77 5f69  n(src_id, flow_i
-0000aa70: 6429 0a20 2020 2020 2020 2067 7261 696e  d).        grain
-0000aa80: 302e 7469 6d65 6c61 6265 6c73 203d 205b  0.timelabels = [
-0000aa90: 7b0a 2020 2020 2020 2020 2020 2020 2774  {.            't
-0000aaa0: 6167 273a 2027 7469 6767 6c65 272c 0a20  ag': 'tiggle',. 
-0000aab0: 2020 2020 2020 2020 2020 2027 7469 6d65             'time
-0000aac0: 6c61 6265 6c27 3a20 7b0a 2020 2020 2020  label': {.      
-0000aad0: 2020 2020 2020 2020 2020 2766 7261 6d65            'frame
-0000aae0: 735f 7369 6e63 655f 6d69 646e 6967 6874  s_since_midnight
-0000aaf0: 273a 2037 2c0a 2020 2020 2020 2020 2020  ': 7,.          
-0000ab00: 2020 2020 2020 2766 7261 6d65 5f72 6174        'frame_rat
-0000ab10: 655f 6e75 6d65 7261 746f 7227 3a20 3330  e_numerator': 30
-0000ab20: 302c 0a20 2020 2020 2020 2020 2020 2020  0,.             
-0000ab30: 2020 2027 6672 616d 655f 7261 7465 5f64     'frame_rate_d
-0000ab40: 656e 6f6d 696e 6174 6f72 273a 2031 2c0a  enominator': 1,.
-0000ab50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ab60: 2764 726f 705f 6672 616d 6527 3a20 4661  'drop_frame': Fa
-0000ab70: 6c73 650a 2020 2020 2020 2020 2020 2020  lse.            
-0000ab80: 7d0a 2020 2020 2020 2020 7d5d 0a20 2020  }.        }].   
-0000ab90: 2020 2020 2067 7261 696e 3120 3d20 4772       grain1 = Gr
-0000aba0: 6169 6e28 7372 635f 6964 2c20 666c 6f77  ain(src_id, flow
-0000abb0: 5f69 6429 0a20 2020 2020 2020 2075 7569  _id).        uui
-0000abc0: 6473 203d 205b 5555 4944 2827 3739 3230  ds = [UUID('7920
-0000abd0: 6233 3934 2d31 3536 352d 3131 6538 2d38  b394-1565-11e8-8
-0000abe0: 3665 302d 3862 3432 6434 3634 3762 6138  6e0-8b42d4647ba8
-0000abf0: 2729 2c0a 2020 2020 2020 2020 2020 2020  '),.            
-0000ac00: 2020 2020 2055 5549 4428 2738 3061 6638       UUID('80af8
-0000ac10: 3735 632d 3135 3635 2d31 3165 382d 3866  75c-1565-11e8-8f
-0000ac20: 3434 2d38 3765 6630 3831 6234 3863 6427  44-87ef081b48cd'
-0000ac30: 295d 0a20 2020 2020 2020 2063 7265 6174  )].        creat
-0000ac40: 6564 203d 2064 6174 6574 696d 6528 3139  ed = datetime(19
-0000ac50: 3833 2c20 332c 2032 392c 2031 352c 2031  83, 3, 29, 15, 1
-0000ac60: 3529 0a20 2020 2020 2020 2077 6974 6820  5).        with 
-0000ac70: 6d6f 636b 2e70 6174 6368 2827 6d65 6469  mock.patch('medi
-0000ac80: 6167 7261 696e 732e 6773 662e 6461 7465  agrains.gsf.date
-0000ac90: 7469 6d65 272c 2073 6964 655f 6566 6665  time', side_effe
-0000aca0: 6374 3d64 6174 6574 696d 652c 206e 6f77  ct=datetime, now
-0000acb0: 3d6d 6f63 6b2e 4d61 6769 634d 6f63 6b28  =mock.MagicMock(
-0000acc0: 7265 7475 726e 5f76 616c 7565 3d63 7265  return_value=cre
-0000acd0: 6174 6564 2929 3a0a 2020 2020 2020 2020  ated)):.        
-0000ace0: 2020 2020 7769 7468 206d 6f63 6b2e 7061      with mock.pa
-0000acf0: 7463 6828 276d 6564 6961 6772 6169 6e73  tch('mediagrains
-0000ad00: 2e67 7366 2e75 7569 6431 272c 2073 6964  .gsf.uuid1', sid
-0000ad10: 655f 6566 6665 6374 3d75 7569 6473 293a  e_effect=uuids):
-0000ad20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000ad30: 2028 6865 6164 2c20 7365 676d 656e 7473   (head, segments
-0000ad40: 2920 3d20 6c6f 6164 7328 6475 6d70 7328  ) = loads(dumps(
-0000ad50: 5b67 7261 696e 302c 2067 7261 696e 315d  [grain0, grain1]
-0000ad60: 2929 0a0a 2020 2020 2020 2020 7365 6c66  ))..        self
-0000ad70: 2e61 7373 6572 7449 6e28 2769 6427 2c20  .assertIn('id', 
-0000ad80: 6865 6164 290a 2020 2020 2020 2020 7365  head).        se
-0000ad90: 6c66 2e61 7373 6572 7449 6e28 6865 6164  lf.assertIn(head
-0000ada0: 5b27 6964 275d 2c20 7575 6964 7329 0a20  ['id'], uuids). 
-0000adb0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-0000adc0: 7274 496e 2827 7461 6773 272c 2068 6561  rtIn('tags', hea
-0000add0: 6429 0a20 2020 2020 2020 2073 656c 662e  d).        self.
-0000ade0: 6173 7365 7274 4571 7561 6c28 6c65 6e28  assertEqual(len(
-0000adf0: 6865 6164 5b27 7461 6773 275d 292c 2030  head['tags']), 0
-0000ae00: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-0000ae10: 7373 6572 7449 6e28 2763 7265 6174 6564  ssertIn('created
-0000ae20: 272c 2068 6561 6429 0a20 2020 2020 2020  ', head).       
-0000ae30: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-0000ae40: 6c28 6865 6164 5b27 6372 6561 7465 6427  l(head['created'
-0000ae50: 5d2c 2063 7265 6174 6564 290a 2020 2020  ], created).    
-0000ae60: 2020 2020 7365 6c66 2e61 7373 6572 7449      self.assertI
-0000ae70: 6e28 2773 6567 6d65 6e74 7327 2c20 6865  n('segments', he
-0000ae80: 6164 290a 2020 2020 2020 2020 7365 6c66  ad).        self
-0000ae90: 2e61 7373 6572 7445 7175 616c 286c 656e  .assertEqual(len
-0000aea0: 2868 6561 645b 2773 6567 6d65 6e74 7327  (head['segments'
-0000aeb0: 5d29 2c20 3129 0a20 2020 2020 2020 2073  ]), 1).        s
-0000aec0: 656c 662e 6173 7365 7274 496e 2827 636f  elf.assertIn('co
-0000aed0: 756e 7427 2c20 6865 6164 5b27 7365 676d  unt', head['segm
-0000aee0: 656e 7473 275d 5b30 5d29 0a20 2020 2020  ents'][0]).     
-0000aef0: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-0000af00: 7561 6c28 6865 6164 5b27 7365 676d 656e  ual(head['segmen
-0000af10: 7473 275d 5b30 5d5b 2763 6f75 6e74 275d  ts'][0]['count']
-0000af20: 2c20 3229 0a20 2020 2020 2020 2073 656c  , 2).        sel
-0000af30: 662e 6173 7365 7274 496e 2827 6c6f 6361  f.assertIn('loca
-0000af40: 6c5f 6964 272c 2068 6561 645b 2773 6567  l_id', head['seg
-0000af50: 6d65 6e74 7327 5d5b 305d 290a 2020 2020  ments'][0]).    
-0000af60: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-0000af70: 7175 616c 2868 6561 645b 2773 6567 6d65  qual(head['segme
-0000af80: 6e74 7327 5d5b 305d 5b27 6c6f 6361 6c5f  nts'][0]['local_
-0000af90: 6964 275d 2c20 3129 0a20 2020 2020 2020  id'], 1).       
-0000afa0: 2073 656c 662e 6173 7365 7274 496e 2827   self.assertIn('
-0000afb0: 6964 272c 2068 6561 645b 2773 6567 6d65  id', head['segme
-0000afc0: 6e74 7327 5d5b 305d 290a 2020 2020 2020  nts'][0]).      
-0000afd0: 2020 7365 6c66 2e61 7373 6572 7449 6e28    self.assertIn(
-0000afe0: 6865 6164 5b27 7365 676d 656e 7473 275d  head['segments']
-0000aff0: 5b30 5d5b 2769 6427 5d2c 2075 7569 6473  [0]['id'], uuids
-0000b000: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-0000b010: 7373 6572 7449 6e28 2774 6167 7327 2c20  ssertIn('tags', 
-0000b020: 6865 6164 5b27 7365 676d 656e 7473 275d  head['segments']
-0000b030: 5b30 5d29 0a20 2020 2020 2020 2073 656c  [0]).        sel
-0000b040: 662e 6173 7365 7274 4571 7561 6c28 6c65  f.assertEqual(le
-0000b050: 6e28 6865 6164 5b27 7365 676d 656e 7473  n(head['segments
-0000b060: 275d 5b30 5d5b 2774 6167 7327 5d29 2c20  '][0]['tags']), 
-0000b070: 3029 0a0a 2020 2020 2020 2020 7365 6c66  0)..        self
-0000b080: 2e61 7373 6572 7445 7175 616c 286c 656e  .assertEqual(len
-0000b090: 2873 6567 6d65 6e74 7329 2c20 3129 0a20  (segments), 1). 
-0000b0a0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-0000b0b0: 7274 496e 2831 2c20 7365 676d 656e 7473  rtIn(1, segments
-0000b0c0: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-0000b0d0: 7373 6572 7445 7175 616c 286c 656e 2873  ssertEqual(len(s
-0000b0e0: 6567 6d65 6e74 735b 315d 292c 2068 6561  egments[1]), hea
-0000b0f0: 645b 2773 6567 6d65 6e74 7327 5d5b 305d  d['segments'][0]
-0000b100: 5b27 636f 756e 7427 5d29 0a0a 2020 2020  ['count'])..    
-0000b110: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-0000b120: 7175 616c 2873 6567 6d65 6e74 735b 315d  qual(segments[1]
-0000b130: 5b30 5d2e 736f 7572 6365 5f69 642c 2073  [0].source_id, s
-0000b140: 7263 5f69 6429 0a20 2020 2020 2020 2073  rc_id).        s
-0000b150: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-0000b160: 7365 676d 656e 7473 5b31 5d5b 305d 2e66  segments[1][0].f
-0000b170: 6c6f 775f 6964 2c20 666c 6f77 5f69 6429  low_id, flow_id)
-0000b180: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-0000b190: 7365 7274 4571 7561 6c28 7365 676d 656e  sertEqual(segmen
-0000b1a0: 7473 5b31 5d5b 305d 2e67 7261 696e 5f74  ts[1][0].grain_t
-0000b1b0: 7970 652c 2027 656d 7074 7927 290a 2020  ype, 'empty').  
-0000b1c0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-0000b1d0: 7445 7175 616c 2873 6567 6d65 6e74 735b  tEqual(segments[
-0000b1e0: 315d 5b30 5d2e 7469 6d65 6c61 6265 6c73  1][0].timelabels
-0000b1f0: 2c20 205b 7b0a 2020 2020 2020 2020 2020  ,  [{.          
-0000b200: 2020 2774 6167 273a 2027 7469 6767 6c65    'tag': 'tiggle
-0000b210: 272c 0a20 2020 2020 2020 2020 2020 2027  ',.            '
-0000b220: 7469 6d65 6c61 6265 6c27 3a20 7b0a 2020  timelabel': {.  
-0000b230: 2020 2020 2020 2020 2020 2020 2020 2766                'f
-0000b240: 7261 6d65 735f 7369 6e63 655f 6d69 646e  rames_since_midn
-0000b250: 6967 6874 273a 2037 2c0a 2020 2020 2020  ight': 7,.      
-0000b260: 2020 2020 2020 2020 2020 2766 7261 6d65            'frame
-0000b270: 5f72 6174 655f 6e75 6d65 7261 746f 7227  _rate_numerator'
-0000b280: 3a20 3330 302c 0a20 2020 2020 2020 2020  : 300,.         
-0000b290: 2020 2020 2020 2027 6672 616d 655f 7261         'frame_ra
-0000b2a0: 7465 5f64 656e 6f6d 696e 6174 6f72 273a  te_denominator':
-0000b2b0: 2031 2c0a 2020 2020 2020 2020 2020 2020   1,.            
-0000b2c0: 2020 2020 2764 726f 705f 6672 616d 6527      'drop_frame'
-0000b2d0: 3a20 4661 6c73 650a 2020 2020 2020 2020  : False.        
-0000b2e0: 2020 2020 7d0a 2020 2020 2020 2020 7d5d      }.        }]
-0000b2f0: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-0000b300: 7373 6572 7449 734e 6f6e 6528 7365 676d  ssertIsNone(segm
-0000b310: 656e 7473 5b31 5d5b 305d 2e64 6174 6129  ents[1][0].data)
-0000b320: 0a0a 2020 2020 2020 2020 7365 6c66 2e61  ..        self.a
-0000b330: 7373 6572 7445 7175 616c 2873 6567 6d65  ssertEqual(segme
-0000b340: 6e74 735b 315d 5b31 5d2e 736f 7572 6365  nts[1][1].source
-0000b350: 5f69 642c 2073 7263 5f69 6429 0a20 2020  _id, src_id).   
-0000b360: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-0000b370: 4571 7561 6c28 7365 676d 656e 7473 5b31  Equal(segments[1
-0000b380: 5d5b 315d 2e66 6c6f 775f 6964 2c20 666c  ][1].flow_id, fl
-0000b390: 6f77 5f69 6429 0a20 2020 2020 2020 2073  ow_id).        s
-0000b3a0: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-0000b3b0: 7365 676d 656e 7473 5b31 5d5b 315d 2e67  segments[1][1].g
-0000b3c0: 7261 696e 5f74 7970 652c 2027 656d 7074  rain_type, 'empt
-0000b3d0: 7927 290a 2020 2020 2020 2020 7365 6c66  y').        self
-0000b3e0: 2e61 7373 6572 7449 734e 6f6e 6528 7365  .assertIsNone(se
-0000b3f0: 676d 656e 7473 5b31 5d5b 315d 2e64 6174  gments[1][1].dat
-0000b400: 6129 0a0a 2020 2020 6173 796e 6320 6465  a)..    async de
-0000b410: 6620 7465 7374 5f61 7379 6e63 5f65 6e63  f test_async_enc
-0000b420: 6f64 655f 656d 7074 7967 7261 696e 7328  ode_emptygrains(
-0000b430: 7365 6c66 293a 0a20 2020 2020 2020 2073  self):.        s
-0000b440: 7263 5f69 6420 3d20 5555 4944 2827 6531  rc_id = UUID('e1
-0000b450: 3465 3964 3538 2d31 3536 372d 3131 6538  4e9d58-1567-11e8
-0000b460: 2d38 6464 332d 3833 3161 3036 3865 6230  -8dd3-831a068eb0
-0000b470: 3334 2729 0a20 2020 2020 2020 2066 6c6f  34').        flo
-0000b480: 775f 6964 203d 2055 5549 4428 2765 6531  w_id = UUID('ee1
-0000b490: 6565 6435 382d 3135 3637 2d31 3165 382d  eed58-1567-11e8-
-0000b4a0: 6139 3731 2d33 6239 3031 6132 6464 3861  a971-3b901a2dd8a
-0000b4b0: 6227 290a 2020 2020 2020 2020 6772 6169  b').        grai
-0000b4c0: 6e30 203d 2047 7261 696e 2873 7263 5f69  n0 = Grain(src_i
-0000b4d0: 642c 2066 6c6f 775f 6964 290a 2020 2020  d, flow_id).    
-0000b4e0: 2020 2020 6772 6169 6e30 2e74 696d 656c      grain0.timel
-0000b4f0: 6162 656c 7320 3d20 5b7b 0a20 2020 2020  abels = [{.     
-0000b500: 2020 2020 2020 2027 7461 6727 3a20 2774         'tag': 't
-0000b510: 6967 676c 6527 2c0a 2020 2020 2020 2020  iggle',.        
-0000b520: 2020 2020 2774 696d 656c 6162 656c 273a      'timelabel':
-0000b530: 207b 0a20 2020 2020 2020 2020 2020 2020   {.             
-0000b540: 2020 2027 6672 616d 6573 5f73 696e 6365     'frames_since
-0000b550: 5f6d 6964 6e69 6768 7427 3a20 372c 0a20  _midnight': 7,. 
-0000b560: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-0000b570: 6672 616d 655f 7261 7465 5f6e 756d 6572  frame_rate_numer
-0000b580: 6174 6f72 273a 2033 3030 2c0a 2020 2020  ator': 300,.    
-0000b590: 2020 2020 2020 2020 2020 2020 2766 7261              'fra
-0000b5a0: 6d65 5f72 6174 655f 6465 6e6f 6d69 6e61  me_rate_denomina
-0000b5b0: 746f 7227 3a20 312c 0a20 2020 2020 2020  tor': 1,.       
-0000b5c0: 2020 2020 2020 2020 2027 6472 6f70 5f66           'drop_f
-0000b5d0: 7261 6d65 273a 2046 616c 7365 0a20 2020  rame': False.   
-0000b5e0: 2020 2020 2020 2020 207d 0a20 2020 2020           }.     
-0000b5f0: 2020 207d 5d0a 2020 2020 2020 2020 6772     }].        gr
-0000b600: 6169 6e31 203d 2047 7261 696e 2873 7263  ain1 = Grain(src
-0000b610: 5f69 642c 2066 6c6f 775f 6964 290a 2020  _id, flow_id).  
-0000b620: 2020 2020 2020 7575 6964 7320 3d20 5b55        uuids = [U
-0000b630: 5549 4428 2737 3932 3062 3339 342d 3135  UID('7920b394-15
-0000b640: 3635 2d31 3165 382d 3836 6530 2d38 6234  65-11e8-86e0-8b4
-0000b650: 3264 3436 3437 6261 3827 292c 0a20 2020  2d4647ba8'),.   
-0000b660: 2020 2020 2020 2020 2020 2020 2020 5555                UU
-0000b670: 4944 2827 3830 6166 3837 3563 2d31 3536  ID('80af875c-156
-0000b680: 352d 3131 6538 2d38 6634 342d 3837 6566  5-11e8-8f44-87ef
-0000b690: 3038 3162 3438 6364 2729 5d0a 2020 2020  081b48cd')].    
-0000b6a0: 2020 2020 6372 6561 7465 6420 3d20 6461      created = da
-0000b6b0: 7465 7469 6d65 2831 3938 332c 2033 2c20  tetime(1983, 3, 
-0000b6c0: 3239 2c20 3135 2c20 3135 290a 2020 2020  29, 15, 15).    
-0000b6d0: 2020 2020 7769 7468 206d 6f63 6b2e 7061      with mock.pa
-0000b6e0: 7463 6828 276d 6564 6961 6772 6169 6e73  tch('mediagrains
-0000b6f0: 2e67 7366 2e64 6174 6574 696d 6527 2c20  .gsf.datetime', 
-0000b700: 7369 6465 5f65 6666 6563 743d 6461 7465  side_effect=date
-0000b710: 7469 6d65 2c20 6e6f 773d 6d6f 636b 2e4d  time, now=mock.M
-0000b720: 6167 6963 4d6f 636b 2872 6574 7572 6e5f  agicMock(return_
-0000b730: 7661 6c75 653d 6372 6561 7465 6429 293a  value=created)):
-0000b740: 0a20 2020 2020 2020 2020 2020 2077 6974  .            wit
-0000b750: 6820 6d6f 636b 2e70 6174 6368 2827 6d65  h mock.patch('me
-0000b760: 6469 6167 7261 696e 732e 6773 662e 7575  diagrains.gsf.uu
-0000b770: 6964 3127 2c20 7369 6465 5f65 6666 6563  id1', side_effec
-0000b780: 743d 7575 6964 7329 3a0a 2020 2020 2020  t=uuids):.      
-0000b790: 2020 2020 2020 2020 2020 6620 3d20 4279            f = By
-0000b7a0: 7465 7349 4f28 290a 2020 2020 2020 2020  tesIO().        
-0000b7b0: 2020 2020 2020 2020 6173 796e 6320 7769          async wi
-0000b7c0: 7468 2047 5346 456e 636f 6465 7228 6629  th GSFEncoder(f)
-0000b7d0: 2061 7320 656e 633a 0a20 2020 2020 2020   as enc:.       
-0000b7e0: 2020 2020 2020 2020 2020 2020 2061 7761               awa
-0000b7f0: 6974 2065 6e63 2e61 6464 5f67 7261 696e  it enc.add_grain
-0000b800: 7328 5b67 7261 696e 302c 2067 7261 696e  s([grain0, grain
-0000b810: 315d 290a 2020 2020 2020 2020 2020 2020  1]).            
-0000b820: 2020 2020 2868 6561 642c 2073 6567 6d65      (head, segme
-0000b830: 6e74 7329 203d 206c 6f61 6473 2866 2e67  nts) = loads(f.g
-0000b840: 6574 7661 6c75 6528 2929 0a0a 2020 2020  etvalue())..    
-0000b850: 2020 2020 7365 6c66 2e61 7373 6572 7449      self.assertI
-0000b860: 6e28 2769 6427 2c20 6865 6164 290a 2020  n('id', head).  
-0000b870: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-0000b880: 7449 6e28 6865 6164 5b27 6964 275d 2c20  tIn(head['id'], 
-0000b890: 7575 6964 7329 0a20 2020 2020 2020 2073  uuids).        s
-0000b8a0: 656c 662e 6173 7365 7274 496e 2827 7461  elf.assertIn('ta
-0000b8b0: 6773 272c 2068 6561 6429 0a20 2020 2020  gs', head).     
-0000b8c0: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-0000b8d0: 7561 6c28 6c65 6e28 6865 6164 5b27 7461  ual(len(head['ta
-0000b8e0: 6773 275d 292c 2030 290a 2020 2020 2020  gs']), 0).      
-0000b8f0: 2020 7365 6c66 2e61 7373 6572 7449 6e28    self.assertIn(
-0000b900: 2763 7265 6174 6564 272c 2068 6561 6429  'created', head)
-0000b910: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-0000b920: 7365 7274 4571 7561 6c28 6865 6164 5b27  sertEqual(head['
-0000b930: 6372 6561 7465 6427 5d2c 2063 7265 6174  created'], creat
-0000b940: 6564 290a 2020 2020 2020 2020 7365 6c66  ed).        self
-0000b950: 2e61 7373 6572 7449 6e28 2773 6567 6d65  .assertIn('segme
-0000b960: 6e74 7327 2c20 6865 6164 290a 2020 2020  nts', head).    
-0000b970: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-0000b980: 7175 616c 286c 656e 2868 6561 645b 2773  qual(len(head['s
-0000b990: 6567 6d65 6e74 7327 5d29 2c20 3129 0a20  egments']), 1). 
-0000b9a0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-0000b9b0: 7274 496e 2827 636f 756e 7427 2c20 6865  rtIn('count', he
-0000b9c0: 6164 5b27 7365 676d 656e 7473 275d 5b30  ad['segments'][0
-0000b9d0: 5d29 0a20 2020 2020 2020 2073 656c 662e  ]).        self.
-0000b9e0: 6173 7365 7274 4571 7561 6c28 6865 6164  assertEqual(head
-0000b9f0: 5b27 7365 676d 656e 7473 275d 5b30 5d5b  ['segments'][0][
-0000ba00: 2763 6f75 6e74 275d 2c20 3229 0a20 2020  'count'], 2).   
-0000ba10: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-0000ba20: 496e 2827 6c6f 6361 6c5f 6964 272c 2068  In('local_id', h
-0000ba30: 6561 645b 2773 6567 6d65 6e74 7327 5d5b  ead['segments'][
-0000ba40: 305d 290a 2020 2020 2020 2020 7365 6c66  0]).        self
-0000ba50: 2e61 7373 6572 7445 7175 616c 2868 6561  .assertEqual(hea
-0000ba60: 645b 2773 6567 6d65 6e74 7327 5d5b 305d  d['segments'][0]
-0000ba70: 5b27 6c6f 6361 6c5f 6964 275d 2c20 3129  ['local_id'], 1)
-0000ba80: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-0000ba90: 7365 7274 496e 2827 6964 272c 2068 6561  sertIn('id', hea
-0000baa0: 645b 2773 6567 6d65 6e74 7327 5d5b 305d  d['segments'][0]
-0000bab0: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-0000bac0: 7373 6572 7449 6e28 6865 6164 5b27 7365  ssertIn(head['se
-0000bad0: 676d 656e 7473 275d 5b30 5d5b 2769 6427  gments'][0]['id'
-0000bae0: 5d2c 2075 7569 6473 290a 2020 2020 2020  ], uuids).      
-0000baf0: 2020 7365 6c66 2e61 7373 6572 7449 6e28    self.assertIn(
-0000bb00: 2774 6167 7327 2c20 6865 6164 5b27 7365  'tags', head['se
-0000bb10: 676d 656e 7473 275d 5b30 5d29 0a20 2020  gments'][0]).   
-0000bb20: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-0000bb30: 4571 7561 6c28 6c65 6e28 6865 6164 5b27  Equal(len(head['
-0000bb40: 7365 676d 656e 7473 275d 5b30 5d5b 2774  segments'][0]['t
-0000bb50: 6167 7327 5d29 2c20 3029 0a0a 2020 2020  ags']), 0)..    
-0000bb60: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-0000bb70: 7175 616c 286c 656e 2873 6567 6d65 6e74  qual(len(segment
-0000bb80: 7329 2c20 3129 0a20 2020 2020 2020 2073  s), 1).        s
-0000bb90: 656c 662e 6173 7365 7274 496e 2831 2c20  elf.assertIn(1, 
-0000bba0: 7365 676d 656e 7473 290a 2020 2020 2020  segments).      
-0000bbb0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-0000bbc0: 616c 286c 656e 2873 6567 6d65 6e74 735b  al(len(segments[
-0000bbd0: 315d 292c 2068 6561 645b 2773 6567 6d65  1]), head['segme
-0000bbe0: 6e74 7327 5d5b 305d 5b27 636f 756e 7427  nts'][0]['count'
-0000bbf0: 5d29 0a0a 2020 2020 2020 2020 7365 6c66  ])..        self
-0000bc00: 2e61 7373 6572 7445 7175 616c 2873 6567  .assertEqual(seg
-0000bc10: 6d65 6e74 735b 315d 5b30 5d2e 736f 7572  ments[1][0].sour
-0000bc20: 6365 5f69 642c 2073 7263 5f69 6429 0a20  ce_id, src_id). 
-0000bc30: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-0000bc40: 7274 4571 7561 6c28 7365 676d 656e 7473  rtEqual(segments
-0000bc50: 5b31 5d5b 305d 2e66 6c6f 775f 6964 2c20  [1][0].flow_id, 
-0000bc60: 666c 6f77 5f69 6429 0a20 2020 2020 2020  flow_id).       
-0000bc70: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-0000bc80: 6c28 7365 676d 656e 7473 5b31 5d5b 305d  l(segments[1][0]
-0000bc90: 2e67 7261 696e 5f74 7970 652c 2027 656d  .grain_type, 'em
-0000bca0: 7074 7927 290a 2020 2020 2020 2020 7365  pty').        se
-0000bcb0: 6c66 2e61 7373 6572 7445 7175 616c 2873  lf.assertEqual(s
-0000bcc0: 6567 6d65 6e74 735b 315d 5b30 5d2e 7469  egments[1][0].ti
-0000bcd0: 6d65 6c61 6265 6c73 2c20 205b 7b0a 2020  melabels,  [{.  
-0000bce0: 2020 2020 2020 2020 2020 2774 6167 273a            'tag':
-0000bcf0: 2027 7469 6767 6c65 272c 0a20 2020 2020   'tiggle',.     
-0000bd00: 2020 2020 2020 2027 7469 6d65 6c61 6265         'timelabe
-0000bd10: 6c27 3a20 7b0a 2020 2020 2020 2020 2020  l': {.          
-0000bd20: 2020 2020 2020 2766 7261 6d65 735f 7369        'frames_si
-0000bd30: 6e63 655f 6d69 646e 6967 6874 273a 2037  nce_midnight': 7
-0000bd40: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000bd50: 2020 2766 7261 6d65 5f72 6174 655f 6e75    'frame_rate_nu
-0000bd60: 6d65 7261 746f 7227 3a20 3330 302c 0a20  merator': 300,. 
-0000bd70: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-0000bd80: 6672 616d 655f 7261 7465 5f64 656e 6f6d  frame_rate_denom
-0000bd90: 696e 6174 6f72 273a 2031 2c0a 2020 2020  inator': 1,.    
-0000bda0: 2020 2020 2020 2020 2020 2020 2764 726f              'dro
-0000bdb0: 705f 6672 616d 6527 3a20 4661 6c73 650a  p_frame': False.
-0000bdc0: 2020 2020 2020 2020 2020 2020 7d0a 2020              }.  
-0000bdd0: 2020 2020 2020 7d5d 290a 2020 2020 2020        }]).      
-0000bde0: 2020 7365 6c66 2e61 7373 6572 7449 734e    self.assertIsN
-0000bdf0: 6f6e 6528 7365 676d 656e 7473 5b31 5d5b  one(segments[1][
-0000be00: 305d 2e64 6174 6129 0a0a 2020 2020 2020  0].data)..      
-0000be10: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-0000be20: 616c 2873 6567 6d65 6e74 735b 315d 5b31  al(segments[1][1
-0000be30: 5d2e 736f 7572 6365 5f69 642c 2073 7263  ].source_id, src
-0000be40: 5f69 6429 0a20 2020 2020 2020 2073 656c  _id).        sel
-0000be50: 662e 6173 7365 7274 4571 7561 6c28 7365  f.assertEqual(se
-0000be60: 676d 656e 7473 5b31 5d5b 315d 2e66 6c6f  gments[1][1].flo
-0000be70: 775f 6964 2c20 666c 6f77 5f69 6429 0a20  w_id, flow_id). 
-0000be80: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-0000be90: 7274 4571 7561 6c28 7365 676d 656e 7473  rtEqual(segments
-0000bea0: 5b31 5d5b 315d 2e67 7261 696e 5f74 7970  [1][1].grain_typ
-0000beb0: 652c 2027 656d 7074 7927 290a 2020 2020  e, 'empty').    
-0000bec0: 2020 2020 7365 6c66 2e61 7373 6572 7449      self.assertI
-0000bed0: 734e 6f6e 6528 7365 676d 656e 7473 5b31  sNone(segments[1
-0000bee0: 5d5b 315d 2e64 6174 6129 0a0a 2020 2020  ][1].data)..    
-0000bef0: 6465 6620 7465 7374 5f64 756d 7073 5f69  def test_dumps_i
-0000bf00: 6e76 616c 6964 6772 6169 6e73 2873 656c  nvalidgrains(sel
-0000bf10: 6629 3a0a 2020 2020 2020 2020 7372 635f  f):.        src_
-0000bf20: 6964 203d 2055 5549 4428 2765 3134 6539  id = UUID('e14e9
-0000bf30: 6435 382d 3135 3637 2d31 3165 382d 3864  d58-1567-11e8-8d
-0000bf40: 6433 2d38 3331 6130 3638 6562 3033 3427  d3-831a068eb034'
-0000bf50: 290a 2020 2020 2020 2020 666c 6f77 5f69  ).        flow_i
-0000bf60: 6420 3d20 5555 4944 2827 6565 3165 6564  d = UUID('ee1eed
-0000bf70: 3538 2d31 3536 372d 3131 6538 2d61 3937  58-1567-11e8-a97
-0000bf80: 312d 3362 3930 3161 3264 6438 6162 2729  1-3b901a2dd8ab')
-0000bf90: 0a20 2020 2020 2020 2067 7261 696e 203d  .        grain =
-0000bfa0: 2047 7261 696e 2873 7263 5f69 642c 2066   Grain(src_id, f
-0000bfb0: 6c6f 775f 6964 290a 2020 2020 2020 2020  low_id).        
-0000bfc0: 6772 6169 6e2e 6772 6169 6e5f 7479 7065  grain.grain_type
-0000bfd0: 203d 2022 696e 7661 6c69 6422 0a20 2020   = "invalid".   
-0000bfe0: 2020 2020 2075 7569 6473 203d 205b 5555       uuids = [UU
-0000bff0: 4944 2827 3739 3230 6233 3934 2d31 3536  ID('7920b394-156
-0000c000: 352d 3131 6538 2d38 3665 302d 3862 3432  5-11e8-86e0-8b42
-0000c010: 6434 3634 3762 6138 2729 2c0a 2020 2020  d4647ba8'),.    
-0000c020: 2020 2020 2020 2020 2020 2020 2055 5549               UUI
-0000c030: 4428 2738 3061 6638 3735 632d 3135 3635  D('80af875c-1565
-0000c040: 2d31 3165 382d 3866 3434 2d38 3765 6630  -11e8-8f44-87ef0
-0000c050: 3831 6234 3863 6427 295d 0a20 2020 2020  81b48cd')].     
-0000c060: 2020 2063 7265 6174 6564 203d 2064 6174     created = dat
-0000c070: 6574 696d 6528 3139 3833 2c20 332c 2032  etime(1983, 3, 2
-0000c080: 392c 2031 352c 2031 3529 0a20 2020 2020  9, 15, 15).     
-0000c090: 2020 2077 6974 6820 7365 6c66 2e61 7373     with self.ass
-0000c0a0: 6572 7452 6169 7365 7328 4753 4645 6e63  ertRaises(GSFEnc
-0000c0b0: 6f64 6545 7272 6f72 293a 0a20 2020 2020  odeError):.     
-0000c0c0: 2020 2020 2020 2077 6974 6820 6d6f 636b         with mock
-0000c0d0: 2e70 6174 6368 2827 6d65 6469 6167 7261  .patch('mediagra
-0000c0e0: 696e 732e 6773 662e 6461 7465 7469 6d65  ins.gsf.datetime
-0000c0f0: 272c 2073 6964 655f 6566 6665 6374 3d64  ', side_effect=d
-0000c100: 6174 6574 696d 652c 206e 6f77 3d6d 6f63  atetime, now=moc
-0000c110: 6b2e 4d61 6769 634d 6f63 6b28 7265 7475  k.MagicMock(retu
-0000c120: 726e 5f76 616c 7565 3d63 7265 6174 6564  rn_value=created
-0000c130: 2929 3a0a 2020 2020 2020 2020 2020 2020  )):.            
-0000c140: 2020 2020 7769 7468 206d 6f63 6b2e 7061      with mock.pa
-0000c150: 7463 6828 276d 6564 6961 6772 6169 6e73  tch('mediagrains
-0000c160: 2e67 7366 2e75 7569 6431 272c 2073 6964  .gsf.uuid1', sid
-0000c170: 655f 6566 6665 6374 3d75 7569 6473 293a  e_effect=uuids):
-0000c180: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000c190: 2020 2020 2028 6865 6164 2c20 7365 676d       (head, segm
-0000c1a0: 656e 7473 2920 3d20 6c6f 6164 7328 6475  ents) = loads(du
-0000c1b0: 6d70 7328 5b67 7261 696e 5d29 290a 0a20  mps([grain])).. 
-0000c1c0: 2020 2061 7379 6e63 2064 6566 2074 6573     async def tes
-0000c1d0: 745f 6173 796e 635f 656e 636f 6465 5f69  t_async_encode_i
-0000c1e0: 6e76 616c 6964 6772 6169 6e73 2873 656c  nvalidgrains(sel
-0000c1f0: 6629 3a0a 2020 2020 2020 2020 7372 635f  f):.        src_
-0000c200: 6964 203d 2055 5549 4428 2765 3134 6539  id = UUID('e14e9
-0000c210: 6435 382d 3135 3637 2d31 3165 382d 3864  d58-1567-11e8-8d
-0000c220: 6433 2d38 3331 6130 3638 6562 3033 3427  d3-831a068eb034'
-0000c230: 290a 2020 2020 2020 2020 666c 6f77 5f69  ).        flow_i
-0000c240: 6420 3d20 5555 4944 2827 6565 3165 6564  d = UUID('ee1eed
-0000c250: 3538 2d31 3536 372d 3131 6538 2d61 3937  58-1567-11e8-a97
-0000c260: 312d 3362 3930 3161 3264 6438 6162 2729  1-3b901a2dd8ab')
-0000c270: 0a20 2020 2020 2020 2067 7261 696e 203d  .        grain =
-0000c280: 2047 7261 696e 2873 7263 5f69 642c 2066   Grain(src_id, f
-0000c290: 6c6f 775f 6964 290a 2020 2020 2020 2020  low_id).        
-0000c2a0: 6772 6169 6e2e 6772 6169 6e5f 7479 7065  grain.grain_type
-0000c2b0: 203d 2022 696e 7661 6c69 6422 0a20 2020   = "invalid".   
-0000c2c0: 2020 2020 2075 7569 6473 203d 205b 5555       uuids = [UU
-0000c2d0: 4944 2827 3739 3230 6233 3934 2d31 3536  ID('7920b394-156
-0000c2e0: 352d 3131 6538 2d38 3665 302d 3862 3432  5-11e8-86e0-8b42
-0000c2f0: 6434 3634 3762 6138 2729 2c0a 2020 2020  d4647ba8'),.    
-0000c300: 2020 2020 2020 2020 2020 2020 2055 5549               UUI
-0000c310: 4428 2738 3061 6638 3735 632d 3135 3635  D('80af875c-1565
-0000c320: 2d31 3165 382d 3866 3434 2d38 3765 6630  -11e8-8f44-87ef0
-0000c330: 3831 6234 3863 6427 295d 0a20 2020 2020  81b48cd')].     
-0000c340: 2020 2063 7265 6174 6564 203d 2064 6174     created = dat
-0000c350: 6574 696d 6528 3139 3833 2c20 332c 2032  etime(1983, 3, 2
-0000c360: 392c 2031 352c 2031 3529 0a20 2020 2020  9, 15, 15).     
-0000c370: 2020 2077 6974 6820 7365 6c66 2e61 7373     with self.ass
-0000c380: 6572 7452 6169 7365 7328 4753 4645 6e63  ertRaises(GSFEnc
-0000c390: 6f64 6545 7272 6f72 293a 0a20 2020 2020  odeError):.     
-0000c3a0: 2020 2020 2020 2077 6974 6820 6d6f 636b         with mock
-0000c3b0: 2e70 6174 6368 2827 6d65 6469 6167 7261  .patch('mediagra
-0000c3c0: 696e 732e 6773 662e 6461 7465 7469 6d65  ins.gsf.datetime
-0000c3d0: 272c 2073 6964 655f 6566 6665 6374 3d64  ', side_effect=d
-0000c3e0: 6174 6574 696d 652c 206e 6f77 3d6d 6f63  atetime, now=moc
-0000c3f0: 6b2e 4d61 6769 634d 6f63 6b28 7265 7475  k.MagicMock(retu
-0000c400: 726e 5f76 616c 7565 3d63 7265 6174 6564  rn_value=created
-0000c410: 2929 3a0a 2020 2020 2020 2020 2020 2020  )):.            
-0000c420: 2020 2020 7769 7468 206d 6f63 6b2e 7061      with mock.pa
-0000c430: 7463 6828 276d 6564 6961 6772 6169 6e73  tch('mediagrains
-0000c440: 2e67 7366 2e75 7569 6431 272c 2073 6964  .gsf.uuid1', sid
-0000c450: 655f 6566 6665 6374 3d75 7569 6473 293a  e_effect=uuids):
-0000c460: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000c470: 2020 2020 2061 7379 6e63 2077 6974 6820       async with 
-0000c480: 4753 4645 6e63 6f64 6572 2842 7974 6573  GSFEncoder(Bytes
-0000c490: 494f 2829 2920 6173 2065 6e63 3a0a 2020  IO()) as enc:.  
-0000c4a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c4b0: 2020 2020 2020 6177 6169 7420 656e 632e        await enc.
-0000c4c0: 6164 645f 6772 6169 6e73 285b 6772 6169  add_grains([grai
-0000c4d0: 6e5d 290a 0a20 2020 2040 7375 7070 7265  n])..    @suppre
-0000c4e0: 7373 5f64 6570 7265 6361 7469 6f6e 5f77  ss_deprecation_w
-0000c4f0: 6172 6e69 6e67 730a 2020 2020 6465 6620  arnings.    def 
-0000c500: 7465 7374 5f64 756d 705f 7072 6f67 7265  test_dump_progre
-0000c510: 7373 6976 656c 795f 5f64 6570 7265 6361  ssively__depreca
-0000c520: 7465 6428 7365 6c66 293a 0a20 2020 2020  ted(self):.     
-0000c530: 2020 2073 7263 5f69 6420 3d20 5555 4944     src_id = UUID
-0000c540: 2827 6531 3465 3964 3538 2d31 3536 372d  ('e14e9d58-1567-
-0000c550: 3131 6538 2d38 6464 332d 3833 3161 3036  11e8-8dd3-831a06
-0000c560: 3865 6230 3334 2729 0a20 2020 2020 2020  8eb034').       
-0000c570: 2066 6c6f 775f 6964 203d 2055 5549 4428   flow_id = UUID(
-0000c580: 2765 6531 6565 6435 382d 3135 3637 2d31  'ee1eed58-1567-1
-0000c590: 3165 382d 6139 3731 2d33 6239 3031 6132  1e8-a971-3b901a2
-0000c5a0: 6464 3861 6227 290a 2020 2020 2020 2020  dd8ab').        
-0000c5b0: 6772 6169 6e30 203d 2056 6964 656f 4772  grain0 = VideoGr
-0000c5c0: 6169 6e28 7372 635f 6964 2c20 666c 6f77  ain(src_id, flow
-0000c5d0: 5f69 642c 2063 6f67 5f66 7261 6d65 5f66  _id, cog_frame_f
-0000c5e0: 6f72 6d61 743d 436f 6746 7261 6d65 466f  ormat=CogFrameFo
-0000c5f0: 726d 6174 2e53 3136 5f34 3232 5f31 3042  rmat.S16_422_10B
-0000c600: 4954 2c20 7769 6474 683d 3139 3230 2c20  IT, width=1920, 
-0000c610: 6865 6967 6874 3d31 3038 3029 0a20 2020  height=1080).   
-0000c620: 2020 2020 2067 7261 696e 3120 3d20 5669       grain1 = Vi
-0000c630: 6465 6f47 7261 696e 2873 7263 5f69 642c  deoGrain(src_id,
-0000c640: 2066 6c6f 775f 6964 2c20 636f 675f 6672   flow_id, cog_fr
-0000c650: 616d 655f 666f 726d 6174 3d43 6f67 4672  ame_format=CogFr
-0000c660: 616d 6546 6f72 6d61 742e 5331 365f 3432  ameFormat.S16_42
-0000c670: 325f 3130 4249 542c 2077 6964 7468 3d31  2_10BIT, width=1
-0000c680: 3932 302c 2068 6569 6768 743d 3130 3830  920, height=1080
-0000c690: 290a 0a20 2020 2020 2020 2075 7569 6473  )..        uuids
-0000c6a0: 203d 205b 5555 4944 2827 3739 3230 6233   = [UUID('7920b3
-0000c6b0: 3934 2d31 3536 352d 3131 6538 2d38 3665  94-1565-11e8-86e
-0000c6c0: 302d 3862 3432 6434 3634 3762 6138 2729  0-8b42d4647ba8')
-0000c6d0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000c6e0: 2020 2055 5549 4428 2738 3061 6638 3735     UUID('80af875
-0000c6f0: 632d 3135 3635 2d31 3165 382d 3866 3434  c-1565-11e8-8f44
-0000c700: 2d38 3765 6630 3831 6234 3863 6427 295d  -87ef081b48cd')]
-0000c710: 0a20 2020 2020 2020 2063 7265 6174 6564  .        created
-0000c720: 203d 2064 6174 6574 696d 6528 3139 3833   = datetime(1983
-0000c730: 2c20 332c 2032 392c 2031 352c 2031 3529  , 3, 29, 15, 15)
-0000c740: 0a0a 2020 2020 2020 2020 6669 6c65 203d  ..        file =
-0000c750: 2042 7974 6573 494f 2829 0a20 2020 2020   BytesIO().     
-0000c760: 2020 2077 6974 6820 6d6f 636b 2e70 6174     with mock.pat
-0000c770: 6368 2827 6d65 6469 6167 7261 696e 732e  ch('mediagrains.
-0000c780: 6773 662e 6461 7465 7469 6d65 272c 2073  gsf.datetime', s
-0000c790: 6964 655f 6566 6665 6374 3d64 6174 6574  ide_effect=datet
-0000c7a0: 696d 652c 206e 6f77 3d6d 6f63 6b2e 4d61  ime, now=mock.Ma
-0000c7b0: 6769 634d 6f63 6b28 7265 7475 726e 5f76  gicMock(return_v
-0000c7c0: 616c 7565 3d63 7265 6174 6564 2929 3a0a  alue=created)):.
-0000c7d0: 2020 2020 2020 2020 2020 2020 7769 7468              with
-0000c7e0: 206d 6f63 6b2e 7061 7463 6828 276d 6564   mock.patch('med
-0000c7f0: 6961 6772 6169 6e73 2e67 7366 2e75 7569  iagrains.gsf.uui
-0000c800: 6431 272c 2073 6964 655f 6566 6665 6374  d1', side_effect
-0000c810: 3d75 7569 6473 293a 0a20 2020 2020 2020  =uuids):.       
-0000c820: 2020 2020 2020 2020 2065 6e63 203d 2047           enc = G
-0000c830: 5346 456e 636f 6465 7228 6669 6c65 290a  SFEncoder(file).
-0000c840: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c850: 656e 632e 6164 645f 7365 676d 656e 7428  enc.add_segment(
-0000c860: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000c870: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-0000c880: 616c 286c 656e 2866 696c 652e 6765 7476  al(len(file.getv
-0000c890: 616c 7565 2829 292c 2030 290a 2020 2020  alue()), 0).    
-0000c8a0: 2020 2020 2020 2020 2020 2020 656e 632e              enc.
-0000c8b0: 7374 6172 745f 6475 6d70 2829 0a20 2020  start_dump().   
-0000c8c0: 2020 2020 2020 2020 2020 2020 2064 756d               dum
-0000c8d0: 7030 203d 2066 696c 652e 6765 7476 616c  p0 = file.getval
-0000c8e0: 7565 2829 0a20 2020 2020 2020 2020 2020  ue().           
-0000c8f0: 2020 2020 2028 6865 6164 302c 2073 6567       (head0, seg
-0000c900: 6d65 6e74 7330 2920 3d20 6c6f 6164 7328  ments0) = loads(
-0000c910: 6475 6d70 3029 0a20 2020 2020 2020 2020  dump0).         
-0000c920: 2020 2020 2020 2065 6e63 2e61 6464 5f67         enc.add_g
-0000c930: 7261 696e 2867 7261 696e 3029 0a20 2020  rain(grain0).   
-0000c940: 2020 2020 2020 2020 2020 2020 2064 756d               dum
-0000c950: 7031 203d 2066 696c 652e 6765 7476 616c  p1 = file.getval
-0000c960: 7565 2829 0a20 2020 2020 2020 2020 2020  ue().           
-0000c970: 2020 2020 2028 6865 6164 312c 2073 6567       (head1, seg
-0000c980: 6d65 6e74 7331 2920 3d20 6c6f 6164 7328  ments1) = loads(
-0000c990: 6475 6d70 3129 0a20 2020 2020 2020 2020  dump1).         
-0000c9a0: 2020 2020 2020 2065 6e63 2e61 6464 5f67         enc.add_g
-0000c9b0: 7261 696e 2867 7261 696e 312c 2073 6567  rain(grain1, seg
-0000c9c0: 6d65 6e74 5f6c 6f63 616c 5f69 643d 3129  ment_local_id=1)
-0000c9d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000c9e0: 2064 756d 7032 203d 2066 696c 652e 6765   dump2 = file.ge
-0000c9f0: 7476 616c 7565 2829 0a20 2020 2020 2020  tvalue().       
-0000ca00: 2020 2020 2020 2020 2028 6865 6164 322c           (head2,
-0000ca10: 2073 6567 6d65 6e74 7332 2920 3d20 6c6f   segments2) = lo
-0000ca20: 6164 7328 6475 6d70 3229 0a20 2020 2020  ads(dump2).     
-0000ca30: 2020 2020 2020 2020 2020 2065 6e63 2e65             enc.e
-0000ca40: 6e64 5f64 756d 7028 290a 2020 2020 2020  nd_dump().      
-0000ca50: 2020 2020 2020 2020 2020 6475 6d70 3320            dump3 
-0000ca60: 3d20 6669 6c65 2e67 6574 7661 6c75 6528  = file.getvalue(
-0000ca70: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000ca80: 2020 2868 6561 6433 2c20 7365 676d 656e    (head3, segmen
-0000ca90: 7473 3329 203d 206c 6f61 6473 2864 756d  ts3) = loads(dum
-0000caa0: 7033 290a 0a20 2020 2020 2020 2073 656c  p3)..        sel
-0000cab0: 662e 6173 7365 7274 4571 7561 6c28 6865  f.assertEqual(he
-0000cac0: 6164 305b 2773 6567 6d65 6e74 7327 5d5b  ad0['segments'][
-0000cad0: 305d 5b27 636f 756e 7427 5d2c 202d 3129  0]['count'], -1)
-0000cae0: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-0000caf0: 7365 7274 4571 7561 6c28 6865 6164 315b  sertEqual(head1[
-0000cb00: 2773 6567 6d65 6e74 7327 5d5b 305d 5b27  'segments'][0]['
-0000cb10: 636f 756e 7427 5d2c 202d 3129 0a20 2020  count'], -1).   
-0000cb20: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-0000cb30: 4571 7561 6c28 6865 6164 325b 2773 6567  Equal(head2['seg
-0000cb40: 6d65 6e74 7327 5d5b 305d 5b27 636f 756e  ments'][0]['coun
-0000cb50: 7427 5d2c 202d 3129 0a20 2020 2020 2020  t'], -1).       
-0000cb60: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-0000cb70: 6c28 6865 6164 335b 2773 6567 6d65 6e74  l(head3['segment
-0000cb80: 7327 5d5b 305d 5b27 636f 756e 7427 5d2c  s'][0]['count'],
-0000cb90: 2032 290a 0a20 2020 2020 2020 2069 6620   2)..        if 
-0000cba0: 3120 696e 2073 6567 6d65 6e74 7330 3a0a  1 in segments0:.
-0000cbb0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0000cbc0: 2e61 7373 6572 7445 7175 616c 286c 656e  .assertEqual(len
-0000cbd0: 2873 6567 6d65 6e74 7330 5b31 5d29 2c20  (segments0[1]), 
-0000cbe0: 3029 0a20 2020 2020 2020 2073 656c 662e  0).        self.
-0000cbf0: 6173 7365 7274 4571 7561 6c28 6c65 6e28  assertEqual(len(
-0000cc00: 7365 676d 656e 7473 315b 315d 292c 2031  segments1[1]), 1
-0000cc10: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-0000cc20: 7373 6572 7445 7175 616c 286c 656e 2873  ssertEqual(len(s
-0000cc30: 6567 6d65 6e74 7332 5b31 5d29 2c20 3229  egments2[1]), 2)
-0000cc40: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-0000cc50: 7365 7274 4571 7561 6c28 6c65 6e28 7365  sertEqual(len(se
-0000cc60: 676d 656e 7473 335b 315d 292c 2032 290a  gments3[1]), 2).
-0000cc70: 0a20 2020 2040 7375 7070 7265 7373 5f64  .    @suppress_d
-0000cc80: 6570 7265 6361 7469 6f6e 5f77 6172 6e69  eprecation_warni
-0000cc90: 6e67 730a 2020 2020 6465 6620 7465 7374  ngs.    def test
-0000cca0: 5f64 756d 705f 7072 6f67 7265 7373 6976  _dump_progressiv
-0000ccb0: 656c 795f 7769 7468 5f73 6567 6d65 6e74  ely_with_segment
-0000ccc0: 735f 5f64 6570 7265 6361 7465 6428 7365  s__deprecated(se
-0000ccd0: 6c66 293a 0a20 2020 2020 2020 2073 7263  lf):.        src
-0000cce0: 5f69 6420 3d20 5555 4944 2827 6531 3465  _id = UUID('e14e
-0000ccf0: 3964 3538 2d31 3536 372d 3131 6538 2d38  9d58-1567-11e8-8
-0000cd00: 6464 332d 3833 3161 3036 3865 6230 3334  dd3-831a068eb034
-0000cd10: 2729 0a20 2020 2020 2020 2066 6c6f 775f  ').        flow_
-0000cd20: 6964 203d 2055 5549 4428 2765 6531 6565  id = UUID('ee1ee
-0000cd30: 6435 382d 3135 3637 2d31 3165 382d 6139  d58-1567-11e8-a9
-0000cd40: 3731 2d33 6239 3031 6132 6464 3861 6227  71-3b901a2dd8ab'
-0000cd50: 290a 2020 2020 2020 2020 6772 6169 6e30  ).        grain0
-0000cd60: 203d 2056 6964 656f 4772 6169 6e28 7372   = VideoGrain(sr
-0000cd70: 635f 6964 2c20 666c 6f77 5f69 642c 2063  c_id, flow_id, c
-0000cd80: 6f67 5f66 7261 6d65 5f66 6f72 6d61 743d  og_frame_format=
-0000cd90: 436f 6746 7261 6d65 466f 726d 6174 2e53  CogFrameFormat.S
-0000cda0: 3136 5f34 3232 5f31 3042 4954 2c20 7769  16_422_10BIT, wi
-0000cdb0: 6474 683d 3139 3230 2c20 6865 6967 6874  dth=1920, height
-0000cdc0: 3d31 3038 3029 0a20 2020 2020 2020 2067  =1080).        g
-0000cdd0: 7261 696e 3120 3d20 5669 6465 6f47 7261  rain1 = VideoGra
-0000cde0: 696e 2873 7263 5f69 642c 2066 6c6f 775f  in(src_id, flow_
-0000cdf0: 6964 2c20 636f 675f 6672 616d 655f 666f  id, cog_frame_fo
-0000ce00: 726d 6174 3d43 6f67 4672 616d 6546 6f72  rmat=CogFrameFor
-0000ce10: 6d61 742e 5331 365f 3432 325f 3130 4249  mat.S16_422_10BI
-0000ce20: 542c 2077 6964 7468 3d31 3932 302c 2068  T, width=1920, h
-0000ce30: 6569 6768 743d 3130 3830 290a 0a20 2020  eight=1080)..   
-0000ce40: 2020 2020 2075 7569 6473 203d 205b 5555       uuids = [UU
-0000ce50: 4944 2827 3739 3230 6233 3934 2d31 3536  ID('7920b394-156
-0000ce60: 352d 3131 6538 2d38 3665 302d 3862 3432  5-11e8-86e0-8b42
-0000ce70: 6434 3634 3762 6138 2729 2c0a 2020 2020  d4647ba8'),.    
-0000ce80: 2020 2020 2020 2020 2020 2020 2055 5549               UUI
-0000ce90: 4428 2738 3061 6638 3735 632d 3135 3635  D('80af875c-1565
-0000cea0: 2d31 3165 382d 3866 3434 2d38 3765 6630  -11e8-8f44-87ef0
-0000ceb0: 3831 6234 3863 6427 295d 0a20 2020 2020  81b48cd')].     
-0000cec0: 2020 2063 7265 6174 6564 203d 2064 6174     created = dat
-0000ced0: 6574 696d 6528 3139 3833 2c20 332c 2032  etime(1983, 3, 2
-0000cee0: 392c 2031 352c 2031 3529 0a0a 2020 2020  9, 15, 15)..    
-0000cef0: 2020 2020 6669 6c65 203d 2042 7974 6573      file = Bytes
-0000cf00: 494f 2829 0a20 2020 2020 2020 2077 6974  IO().        wit
-0000cf10: 6820 6d6f 636b 2e70 6174 6368 2827 6d65  h mock.patch('me
-0000cf20: 6469 6167 7261 696e 732e 6773 662e 6461  diagrains.gsf.da
-0000cf30: 7465 7469 6d65 272c 2073 6964 655f 6566  tetime', side_ef
-0000cf40: 6665 6374 3d64 6174 6574 696d 652c 206e  fect=datetime, n
-0000cf50: 6f77 3d6d 6f63 6b2e 4d61 6769 634d 6f63  ow=mock.MagicMoc
-0000cf60: 6b28 7265 7475 726e 5f76 616c 7565 3d63  k(return_value=c
-0000cf70: 7265 6174 6564 2929 3a0a 2020 2020 2020  reated)):.      
-0000cf80: 2020 2020 2020 7769 7468 206d 6f63 6b2e        with mock.
-0000cf90: 7061 7463 6828 276d 6564 6961 6772 6169  patch('mediagrai
-0000cfa0: 6e73 2e67 7366 2e75 7569 6431 272c 2073  ns.gsf.uuid1', s
-0000cfb0: 6964 655f 6566 6665 6374 3d75 7569 6473  ide_effect=uuids
-0000cfc0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-0000cfd0: 2020 2065 6e63 203d 2047 5346 456e 636f     enc = GSFEnco
-0000cfe0: 6465 7228 6669 6c65 290a 2020 2020 2020  der(file).      
-0000cff0: 2020 2020 2020 2020 2020 7365 6720 3d20            seg = 
-0000d000: 656e 632e 6164 645f 7365 676d 656e 7428  enc.add_segment(
-0000d010: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000d020: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-0000d030: 616c 286c 656e 2866 696c 652e 6765 7476  al(len(file.getv
-0000d040: 616c 7565 2829 292c 2030 290a 2020 2020  alue()), 0).    
-0000d050: 2020 2020 2020 2020 2020 2020 656e 632e              enc.
-0000d060: 7374 6172 745f 6475 6d70 2829 0a20 2020  start_dump().   
-0000d070: 2020 2020 2020 2020 2020 2020 2064 756d               dum
-0000d080: 7030 203d 2066 696c 652e 6765 7476 616c  p0 = file.getval
-0000d090: 7565 2829 0a20 2020 2020 2020 2020 2020  ue().           
-0000d0a0: 2020 2020 2028 6865 6164 302c 2073 6567       (head0, seg
-0000d0b0: 6d65 6e74 7330 2920 3d20 6c6f 6164 7328  ments0) = loads(
-0000d0c0: 6475 6d70 3029 0a20 2020 2020 2020 2020  dump0).         
-0000d0d0: 2020 2020 2020 2073 6567 2e61 6464 5f67         seg.add_g
-0000d0e0: 7261 696e 2867 7261 696e 3029 0a20 2020  rain(grain0).   
-0000d0f0: 2020 2020 2020 2020 2020 2020 2064 756d               dum
-0000d100: 7031 203d 2066 696c 652e 6765 7476 616c  p1 = file.getval
-0000d110: 7565 2829 0a20 2020 2020 2020 2020 2020  ue().           
-0000d120: 2020 2020 2028 6865 6164 312c 2073 6567       (head1, seg
-0000d130: 6d65 6e74 7331 2920 3d20 6c6f 6164 7328  ments1) = loads(
-0000d140: 6475 6d70 3129 0a20 2020 2020 2020 2020  dump1).         
-0000d150: 2020 2020 2020 2073 6567 2e61 6464 5f67         seg.add_g
-0000d160: 7261 696e 2867 7261 696e 312c 2073 6567  rain(grain1, seg
-0000d170: 6d65 6e74 5f6c 6f63 616c 5f69 643d 3129  ment_local_id=1)
-0000d180: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000d190: 2064 756d 7032 203d 2066 696c 652e 6765   dump2 = file.ge
-0000d1a0: 7476 616c 7565 2829 0a20 2020 2020 2020  tvalue().       
-0000d1b0: 2020 2020 2020 2020 2028 6865 6164 322c           (head2,
-0000d1c0: 2073 6567 6d65 6e74 7332 2920 3d20 6c6f   segments2) = lo
-0000d1d0: 6164 7328 6475 6d70 3229 0a20 2020 2020  ads(dump2).     
-0000d1e0: 2020 2020 2020 2020 2020 2065 6e63 2e65             enc.e
-0000d1f0: 6e64 5f64 756d 7028 290a 2020 2020 2020  nd_dump().      
-0000d200: 2020 2020 2020 2020 2020 6475 6d70 3320            dump3 
-0000d210: 3d20 6669 6c65 2e67 6574 7661 6c75 6528  = file.getvalue(
-0000d220: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000d230: 2020 2868 6561 6433 2c20 7365 676d 656e    (head3, segmen
-0000d240: 7473 3329 203d 206c 6f61 6473 2864 756d  ts3) = loads(dum
-0000d250: 7033 290a 0a20 2020 2020 2020 2073 656c  p3)..        sel
-0000d260: 662e 6173 7365 7274 4571 7561 6c28 6865  f.assertEqual(he
-0000d270: 6164 305b 2773 6567 6d65 6e74 7327 5d5b  ad0['segments'][
-0000d280: 305d 5b27 636f 756e 7427 5d2c 202d 3129  0]['count'], -1)
-0000d290: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-0000d2a0: 7365 7274 4571 7561 6c28 6865 6164 315b  sertEqual(head1[
-0000d2b0: 2773 6567 6d65 6e74 7327 5d5b 305d 5b27  'segments'][0]['
-0000d2c0: 636f 756e 7427 5d2c 202d 3129 0a20 2020  count'], -1).   
-0000d2d0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-0000d2e0: 4571 7561 6c28 6865 6164 325b 2773 6567  Equal(head2['seg
-0000d2f0: 6d65 6e74 7327 5d5b 305d 5b27 636f 756e  ments'][0]['coun
-0000d300: 7427 5d2c 202d 3129 0a20 2020 2020 2020  t'], -1).       
-0000d310: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-0000d320: 6c28 6865 6164 335b 2773 6567 6d65 6e74  l(head3['segment
-0000d330: 7327 5d5b 305d 5b27 636f 756e 7427 5d2c  s'][0]['count'],
-0000d340: 2032 290a 0a20 2020 2020 2020 2069 6620   2)..        if 
-0000d350: 3120 696e 2073 6567 6d65 6e74 7330 3a0a  1 in segments0:.
-0000d360: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0000d370: 2e61 7373 6572 7445 7175 616c 286c 656e  .assertEqual(len
-0000d380: 2873 6567 6d65 6e74 7330 5b31 5d29 2c20  (segments0[1]), 
-0000d390: 3029 0a20 2020 2020 2020 2073 656c 662e  0).        self.
-0000d3a0: 6173 7365 7274 4571 7561 6c28 6c65 6e28  assertEqual(len(
-0000d3b0: 7365 676d 656e 7473 315b 315d 292c 2031  segments1[1]), 1
-0000d3c0: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-0000d3d0: 7373 6572 7445 7175 616c 286c 656e 2873  ssertEqual(len(s
-0000d3e0: 6567 6d65 6e74 7332 5b31 5d29 2c20 3229  egments2[1]), 2)
-0000d3f0: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-0000d400: 7365 7274 4571 7561 6c28 6c65 6e28 7365  sertEqual(len(se
-0000d410: 676d 656e 7473 335b 315d 292c 2032 290a  gments3[1]), 2).
-0000d420: 0a20 2020 2064 6566 2074 6573 745f 6475  .    def test_du
-0000d430: 6d70 5f70 726f 6772 6573 7369 7665 6c79  mp_progressively
-0000d440: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-0000d450: 7372 635f 6964 203d 2055 5549 4428 2765  src_id = UUID('e
-0000d460: 3134 6539 6435 382d 3135 3637 2d31 3165  14e9d58-1567-11e
-0000d470: 382d 3864 6433 2d38 3331 6130 3638 6562  8-8dd3-831a068eb
-0000d480: 3033 3427 290a 2020 2020 2020 2020 666c  034').        fl
-0000d490: 6f77 5f69 6420 3d20 5555 4944 2827 6565  ow_id = UUID('ee
-0000d4a0: 3165 6564 3538 2d31 3536 372d 3131 6538  1eed58-1567-11e8
-0000d4b0: 2d61 3937 312d 3362 3930 3161 3264 6438  -a971-3b901a2dd8
-0000d4c0: 6162 2729 0a20 2020 2020 2020 2067 7261  ab').        gra
-0000d4d0: 696e 3020 3d20 5669 6465 6f47 7261 696e  in0 = VideoGrain
-0000d4e0: 2873 7263 5f69 642c 2066 6c6f 775f 6964  (src_id, flow_id
-0000d4f0: 2c20 636f 675f 6672 616d 655f 666f 726d  , cog_frame_form
-0000d500: 6174 3d43 6f67 4672 616d 6546 6f72 6d61  at=CogFrameForma
-0000d510: 742e 5331 365f 3432 325f 3130 4249 542c  t.S16_422_10BIT,
-0000d520: 2077 6964 7468 3d31 3932 302c 2068 6569   width=1920, hei
-0000d530: 6768 743d 3130 3830 290a 2020 2020 2020  ght=1080).      
-0000d540: 2020 6772 6169 6e31 203d 2056 6964 656f    grain1 = Video
-0000d550: 4772 6169 6e28 7372 635f 6964 2c20 666c  Grain(src_id, fl
-0000d560: 6f77 5f69 642c 2063 6f67 5f66 7261 6d65  ow_id, cog_frame
-0000d570: 5f66 6f72 6d61 743d 436f 6746 7261 6d65  _format=CogFrame
-0000d580: 466f 726d 6174 2e53 3136 5f34 3232 5f31  Format.S16_422_1
-0000d590: 3042 4954 2c20 7769 6474 683d 3139 3230  0BIT, width=1920
-0000d5a0: 2c20 6865 6967 6874 3d31 3038 3029 0a0a  , height=1080)..
-0000d5b0: 2020 2020 2020 2020 7575 6964 7320 3d20          uuids = 
-0000d5c0: 5b55 5549 4428 2737 3932 3062 3339 342d  [UUID('7920b394-
-0000d5d0: 3135 3635 2d31 3165 382d 3836 6530 2d38  1565-11e8-86e0-8
-0000d5e0: 6234 3264 3436 3437 6261 3827 292c 0a20  b42d4647ba8'),. 
-0000d5f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d600: 5555 4944 2827 3830 6166 3837 3563 2d31  UUID('80af875c-1
-0000d610: 3536 352d 3131 6538 2d38 6634 342d 3837  565-11e8-8f44-87
-0000d620: 6566 3038 3162 3438 6364 2729 5d0a 2020  ef081b48cd')].  
-0000d630: 2020 2020 2020 6372 6561 7465 6420 3d20        created = 
-0000d640: 6461 7465 7469 6d65 2831 3938 332c 2033  datetime(1983, 3
-0000d650: 2c20 3239 2c20 3135 2c20 3135 290a 0a20  , 29, 15, 15).. 
-0000d660: 2020 2020 2020 2066 696c 6520 3d20 4279         file = By
-0000d670: 7465 7349 4f28 290a 2020 2020 2020 2020  tesIO().        
-0000d680: 7769 7468 206d 6f63 6b2e 7061 7463 6828  with mock.patch(
-0000d690: 276d 6564 6961 6772 6169 6e73 2e67 7366  'mediagrains.gsf
-0000d6a0: 2e64 6174 6574 696d 6527 2c20 7369 6465  .datetime', side
-0000d6b0: 5f65 6666 6563 743d 6461 7465 7469 6d65  _effect=datetime
-0000d6c0: 2c20 6e6f 773d 6d6f 636b 2e4d 6167 6963  , now=mock.Magic
-0000d6d0: 4d6f 636b 2872 6574 7572 6e5f 7661 6c75  Mock(return_valu
-0000d6e0: 653d 6372 6561 7465 6429 293a 0a20 2020  e=created)):.   
-0000d6f0: 2020 2020 2020 2020 2077 6974 6820 6d6f           with mo
-0000d700: 636b 2e70 6174 6368 2827 6d65 6469 6167  ck.patch('mediag
-0000d710: 7261 696e 732e 6773 662e 7575 6964 3127  rains.gsf.uuid1'
-0000d720: 2c20 7369 6465 5f65 6666 6563 743d 7575  , side_effect=uu
-0000d730: 6964 7329 3a0a 2020 2020 2020 2020 2020  ids):.          
-0000d740: 2020 2020 2020 656e 6320 3d20 4753 4645        enc = GSFE
-0000d750: 6e63 6f64 6572 2866 696c 652c 2073 7472  ncoder(file, str
-0000d760: 6561 6d69 6e67 3d54 7275 6529 0a20 2020  eaming=True).   
-0000d770: 2020 2020 2020 2020 2020 2020 2065 6e63               enc
-0000d780: 2e61 6464 5f73 6567 6d65 6e74 2829 0a20  .add_segment(). 
-0000d790: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0000d7a0: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-0000d7b0: 6c65 6e28 6669 6c65 2e67 6574 7661 6c75  len(file.getvalu
-0000d7c0: 6528 2929 2c20 3029 0a20 2020 2020 2020  e()), 0).       
-0000d7d0: 2020 2020 2020 2020 2077 6974 6820 656e           with en
-0000d7e0: 633a 0a20 2020 2020 2020 2020 2020 2020  c:.             
-0000d7f0: 2020 2020 2020 2064 756d 7030 203d 2066         dump0 = f
-0000d800: 696c 652e 6765 7476 616c 7565 2829 0a20  ile.getvalue(). 
-0000d810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d820: 2020 2028 6865 6164 302c 2073 6567 6d65     (head0, segme
-0000d830: 6e74 7330 2920 3d20 6c6f 6164 7328 6475  nts0) = loads(du
-0000d840: 6d70 3029 0a20 2020 2020 2020 2020 2020  mp0).           
-0000d850: 2020 2020 2020 2020 2065 6e63 2e61 6464           enc.add
-0000d860: 5f67 7261 696e 2867 7261 696e 3029 0a20  _grain(grain0). 
-0000d870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d880: 2020 2064 756d 7031 203d 2066 696c 652e     dump1 = file.
-0000d890: 6765 7476 616c 7565 2829 0a20 2020 2020  getvalue().     
-0000d8a0: 2020 2020 2020 2020 2020 2020 2020 2028                 (
-0000d8b0: 6865 6164 312c 2073 6567 6d65 6e74 7331  head1, segments1
-0000d8c0: 2920 3d20 6c6f 6164 7328 6475 6d70 3129  ) = loads(dump1)
-0000d8d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000d8e0: 2020 2020 2065 6e63 2e61 6464 5f67 7261       enc.add_gra
-0000d8f0: 696e 2867 7261 696e 312c 2073 6567 6d65  in(grain1, segme
-0000d900: 6e74 5f6c 6f63 616c 5f69 643d 3129 0a20  nt_local_id=1). 
-0000d910: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d920: 2020 2064 756d 7032 203d 2066 696c 652e     dump2 = file.
-0000d930: 6765 7476 616c 7565 2829 0a20 2020 2020  getvalue().     
-0000d940: 2020 2020 2020 2020 2020 2020 2020 2028                 (
-0000d950: 6865 6164 322c 2073 6567 6d65 6e74 7332  head2, segments2
-0000d960: 2920 3d20 6c6f 6164 7328 6475 6d70 3229  ) = loads(dump2)
-0000d970: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000d980: 2064 756d 7033 203d 2066 696c 652e 6765   dump3 = file.ge
-0000d990: 7476 616c 7565 2829 0a20 2020 2020 2020  tvalue().       
-0000d9a0: 2020 2020 2020 2020 2028 6865 6164 332c           (head3,
-0000d9b0: 2073 6567 6d65 6e74 7333 2920 3d20 6c6f   segments3) = lo
-0000d9c0: 6164 7328 6475 6d70 3329 0a0a 2020 2020  ads(dump3)..    
-0000d9d0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-0000d9e0: 7175 616c 2868 6561 6430 5b27 7365 676d  qual(head0['segm
-0000d9f0: 656e 7473 275d 5b30 5d5b 2763 6f75 6e74  ents'][0]['count
-0000da00: 275d 2c20 2d31 290a 2020 2020 2020 2020  '], -1).        
-0000da10: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-0000da20: 2868 6561 6431 5b27 7365 676d 656e 7473  (head1['segments
-0000da30: 275d 5b30 5d5b 2763 6f75 6e74 275d 2c20  '][0]['count'], 
-0000da40: 2d31 290a 2020 2020 2020 2020 7365 6c66  -1).        self
-0000da50: 2e61 7373 6572 7445 7175 616c 2868 6561  .assertEqual(hea
-0000da60: 6432 5b27 7365 676d 656e 7473 275d 5b30  d2['segments'][0
-0000da70: 5d5b 2763 6f75 6e74 275d 2c20 2d31 290a  ]['count'], -1).
-0000da80: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-0000da90: 6572 7445 7175 616c 2868 6561 6433 5b27  ertEqual(head3['
-0000daa0: 7365 676d 656e 7473 275d 5b30 5d5b 2763  segments'][0]['c
-0000dab0: 6f75 6e74 275d 2c20 3229 0a0a 2020 2020  ount'], 2)..    
-0000dac0: 2020 2020 6966 2031 2069 6e20 7365 676d      if 1 in segm
-0000dad0: 656e 7473 303a 0a20 2020 2020 2020 2020  ents0:.         
-0000dae0: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-0000daf0: 7561 6c28 6c65 6e28 7365 676d 656e 7473  ual(len(segments
-0000db00: 305b 315d 292c 2030 290a 2020 2020 2020  0[1]), 0).      
-0000db10: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-0000db20: 616c 286c 656e 2873 6567 6d65 6e74 7331  al(len(segments1
-0000db30: 5b31 5d29 2c20 3129 0a20 2020 2020 2020  [1]), 1).       
-0000db40: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-0000db50: 6c28 6c65 6e28 7365 676d 656e 7473 325b  l(len(segments2[
-0000db60: 315d 292c 2032 290a 2020 2020 2020 2020  1]), 2).        
-0000db70: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-0000db80: 286c 656e 2873 6567 6d65 6e74 7333 5b31  (len(segments3[1
-0000db90: 5d29 2c20 3229 0a0a 2020 2020 6173 796e  ]), 2)..    asyn
-0000dba0: 6320 6465 6620 7465 7374 5f61 7379 6e63  c def test_async
-0000dbb0: 5f65 6e63 6f64 655f 7072 6f67 7265 7373  _encode_progress
-0000dbc0: 6976 656c 7928 7365 6c66 293a 0a20 2020  ively(self):.   
-0000dbd0: 2020 2020 2073 7263 5f69 6420 3d20 5555       src_id = UU
-0000dbe0: 4944 2827 6531 3465 3964 3538 2d31 3536  ID('e14e9d58-156
-0000dbf0: 372d 3131 6538 2d38 6464 332d 3833 3161  7-11e8-8dd3-831a
-0000dc00: 3036 3865 6230 3334 2729 0a20 2020 2020  068eb034').     
-0000dc10: 2020 2066 6c6f 775f 6964 203d 2055 5549     flow_id = UUI
-0000dc20: 4428 2765 6531 6565 6435 382d 3135 3637  D('ee1eed58-1567
-0000dc30: 2d31 3165 382d 6139 3731 2d33 6239 3031  -11e8-a971-3b901
-0000dc40: 6132 6464 3861 6227 290a 2020 2020 2020  a2dd8ab').      
-0000dc50: 2020 6772 6169 6e30 203d 2056 6964 656f    grain0 = Video
-0000dc60: 4772 6169 6e28 7372 635f 6964 2c20 666c  Grain(src_id, fl
-0000dc70: 6f77 5f69 642c 2063 6f67 5f66 7261 6d65  ow_id, cog_frame
-0000dc80: 5f66 6f72 6d61 743d 436f 6746 7261 6d65  _format=CogFrame
-0000dc90: 466f 726d 6174 2e53 3136 5f34 3232 5f31  Format.S16_422_1
-0000dca0: 3042 4954 2c20 7769 6474 683d 3139 3230  0BIT, width=1920
-0000dcb0: 2c20 6865 6967 6874 3d31 3038 3029 0a20  , height=1080). 
-0000dcc0: 2020 2020 2020 2067 7261 696e 3120 3d20         grain1 = 
-0000dcd0: 5669 6465 6f47 7261 696e 2873 7263 5f69  VideoGrain(src_i
-0000dce0: 642c 2066 6c6f 775f 6964 2c20 636f 675f  d, flow_id, cog_
-0000dcf0: 6672 616d 655f 666f 726d 6174 3d43 6f67  frame_format=Cog
-0000dd00: 4672 616d 6546 6f72 6d61 742e 5331 365f  FrameFormat.S16_
-0000dd10: 3432 325f 3130 4249 542c 2077 6964 7468  422_10BIT, width
-0000dd20: 3d31 3932 302c 2068 6569 6768 743d 3130  =1920, height=10
-0000dd30: 3830 290a 0a20 2020 2020 2020 2075 7569  80)..        uui
-0000dd40: 6473 203d 205b 5555 4944 2827 3739 3230  ds = [UUID('7920
-0000dd50: 6233 3934 2d31 3536 352d 3131 6538 2d38  b394-1565-11e8-8
-0000dd60: 3665 302d 3862 3432 6434 3634 3762 6138  6e0-8b42d4647ba8
-0000dd70: 2729 2c0a 2020 2020 2020 2020 2020 2020  '),.            
-0000dd80: 2020 2020 2055 5549 4428 2738 3061 6638       UUID('80af8
-0000dd90: 3735 632d 3135 3635 2d31 3165 382d 3866  75c-1565-11e8-8f
-0000dda0: 3434 2d38 3765 6630 3831 6234 3863 6427  44-87ef081b48cd'
-0000ddb0: 295d 0a20 2020 2020 2020 2063 7265 6174  )].        creat
-0000ddc0: 6564 203d 2064 6174 6574 696d 6528 3139  ed = datetime(19
-0000ddd0: 3833 2c20 332c 2032 392c 2031 352c 2031  83, 3, 29, 15, 1
-0000dde0: 3529 0a0a 2020 2020 2020 2020 6669 6c65  5)..        file
-0000ddf0: 203d 2042 7974 6573 494f 2829 0a20 2020   = BytesIO().   
-0000de00: 2020 2020 2077 6974 6820 6d6f 636b 2e70       with mock.p
-0000de10: 6174 6368 2827 6d65 6469 6167 7261 696e  atch('mediagrain
-0000de20: 732e 6773 662e 6461 7465 7469 6d65 272c  s.gsf.datetime',
-0000de30: 2073 6964 655f 6566 6665 6374 3d64 6174   side_effect=dat
-0000de40: 6574 696d 652c 206e 6f77 3d6d 6f63 6b2e  etime, now=mock.
-0000de50: 4d61 6769 634d 6f63 6b28 7265 7475 726e  MagicMock(return
-0000de60: 5f76 616c 7565 3d63 7265 6174 6564 2929  _value=created))
-0000de70: 3a0a 2020 2020 2020 2020 2020 2020 7769  :.            wi
-0000de80: 7468 206d 6f63 6b2e 7061 7463 6828 276d  th mock.patch('m
-0000de90: 6564 6961 6772 6169 6e73 2e67 7366 2e75  ediagrains.gsf.u
-0000dea0: 7569 6431 272c 2073 6964 655f 6566 6665  uid1', side_effe
-0000deb0: 6374 3d75 7569 6473 293a 0a20 2020 2020  ct=uuids):.     
-0000dec0: 2020 2020 2020 2020 2020 2065 6e63 203d             enc =
-0000ded0: 2047 5346 456e 636f 6465 7228 6669 6c65   GSFEncoder(file
-0000dee0: 2c20 7374 7265 616d 696e 673d 5472 7565  , streaming=True
-0000def0: 2c20 7365 676d 656e 7473 3d5b 7b7d 5d29  , segments=[{}])
-0000df00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000df10: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-0000df20: 6c28 6c65 6e28 6669 6c65 2e67 6574 7661  l(len(file.getva
-0000df30: 6c75 6528 2929 2c20 3029 0a20 2020 2020  lue()), 0).     
-0000df40: 2020 2020 2020 2020 2020 2061 7379 6e63             async
-0000df50: 2077 6974 6820 656e 6320 6173 2065 6e63   with enc as enc
-0000df60: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000df70: 2020 2020 2020 6475 6d70 3020 3d20 6669        dump0 = fi
-0000df80: 6c65 2e67 6574 7661 6c75 6528 290a 2020  le.getvalue().  
-0000df90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dfa0: 2020 2868 6561 6430 2c20 7365 676d 656e    (head0, segmen
-0000dfb0: 7473 3029 203d 206c 6f61 6473 2864 756d  ts0) = loads(dum
-0000dfc0: 7030 290a 2020 2020 2020 2020 2020 2020  p0).            
-0000dfd0: 2020 2020 2020 2020 6177 6169 7420 656e          await en
-0000dfe0: 632e 6164 645f 6772 6169 6e28 6772 6169  c.add_grain(grai
-0000dff0: 6e30 290a 2020 2020 2020 2020 2020 2020  n0).            
-0000e000: 2020 2020 2020 2020 6475 6d70 3120 3d20          dump1 = 
-0000e010: 6669 6c65 2e67 6574 7661 6c75 6528 290a  file.getvalue().
-0000e020: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e030: 2020 2020 2868 6561 6431 2c20 7365 676d      (head1, segm
-0000e040: 656e 7473 3129 203d 206c 6f61 6473 2864  ents1) = loads(d
-0000e050: 756d 7031 290a 2020 2020 2020 2020 2020  ump1).          
-0000e060: 2020 2020 2020 2020 2020 6177 6169 7420            await 
-0000e070: 656e 632e 6164 645f 6772 6169 6e28 6772  enc.add_grain(gr
-0000e080: 6169 6e31 2c20 7365 676d 656e 745f 6c6f  ain1, segment_lo
-0000e090: 6361 6c5f 6964 3d31 290a 2020 2020 2020  cal_id=1).      
-0000e0a0: 2020 2020 2020 2020 2020 2020 2020 6475                du
-0000e0b0: 6d70 3220 3d20 6669 6c65 2e67 6574 7661  mp2 = file.getva
-0000e0c0: 6c75 6528 290a 2020 2020 2020 2020 2020  lue().          
-0000e0d0: 2020 2020 2020 2020 2020 2868 6561 6432            (head2
-0000e0e0: 2c20 7365 676d 656e 7473 3229 203d 206c  , segments2) = l
-0000e0f0: 6f61 6473 2864 756d 7032 290a 2020 2020  oads(dump2).    
-0000e100: 2020 2020 2020 2020 2020 2020 6475 6d70              dump
-0000e110: 3320 3d20 6669 6c65 2e67 6574 7661 6c75  3 = file.getvalu
-0000e120: 6528 290a 2020 2020 2020 2020 2020 2020  e().            
-0000e130: 2020 2020 2868 6561 6433 2c20 7365 676d      (head3, segm
-0000e140: 656e 7473 3329 203d 206c 6f61 6473 2864  ents3) = loads(d
-0000e150: 756d 7033 290a 0a20 2020 2020 2020 2073  ump3)..        s
-0000e160: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-0000e170: 6865 6164 305b 2773 6567 6d65 6e74 7327  head0['segments'
-0000e180: 5d5b 305d 5b27 636f 756e 7427 5d2c 202d  ][0]['count'], -
-0000e190: 3129 0a20 2020 2020 2020 2073 656c 662e  1).        self.
-0000e1a0: 6173 7365 7274 4571 7561 6c28 6865 6164  assertEqual(head
-0000e1b0: 315b 2773 6567 6d65 6e74 7327 5d5b 305d  1['segments'][0]
-0000e1c0: 5b27 636f 756e 7427 5d2c 202d 3129 0a20  ['count'], -1). 
-0000e1d0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-0000e1e0: 7274 4571 7561 6c28 6865 6164 325b 2773  rtEqual(head2['s
-0000e1f0: 6567 6d65 6e74 7327 5d5b 305d 5b27 636f  egments'][0]['co
-0000e200: 756e 7427 5d2c 202d 3129 0a20 2020 2020  unt'], -1).     
-0000e210: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-0000e220: 7561 6c28 6865 6164 335b 2773 6567 6d65  ual(head3['segme
-0000e230: 6e74 7327 5d5b 305d 5b27 636f 756e 7427  nts'][0]['count'
-0000e240: 5d2c 2032 290a 0a20 2020 2020 2020 2069  ], 2)..        i
-0000e250: 6620 3120 696e 2073 6567 6d65 6e74 7330  f 1 in segments0
-0000e260: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
-0000e270: 6c66 2e61 7373 6572 7445 7175 616c 286c  lf.assertEqual(l
-0000e280: 656e 2873 6567 6d65 6e74 7330 5b31 5d29  en(segments0[1])
-0000e290: 2c20 3029 0a20 2020 2020 2020 2073 656c  , 0).        sel
-0000e2a0: 662e 6173 7365 7274 4571 7561 6c28 6c65  f.assertEqual(le
-0000e2b0: 6e28 7365 676d 656e 7473 315b 315d 292c  n(segments1[1]),
-0000e2c0: 2031 290a 2020 2020 2020 2020 7365 6c66   1).        self
-0000e2d0: 2e61 7373 6572 7445 7175 616c 286c 656e  .assertEqual(len
-0000e2e0: 2873 6567 6d65 6e74 7332 5b31 5d29 2c20  (segments2[1]), 
-0000e2f0: 3229 0a20 2020 2020 2020 2073 656c 662e  2).        self.
-0000e300: 6173 7365 7274 4571 7561 6c28 6c65 6e28  assertEqual(len(
-0000e310: 7365 676d 656e 7473 335b 315d 292c 2032  segments3[1]), 2
-0000e320: 290a 0a20 2020 2040 7375 7070 7265 7373  )..    @suppress
-0000e330: 5f64 6570 7265 6361 7469 6f6e 5f77 6172  _deprecation_war
-0000e340: 6e69 6e67 730a 2020 2020 6465 6620 7465  nings.    def te
-0000e350: 7374 5f65 6e64 5f64 756d 705f 7769 7468  st_end_dump_with
-0000e360: 6f75 745f 7374 6172 745f 646f 6573 5f6e  out_start_does_n
-0000e370: 6f74 6869 6e67 2873 656c 6629 3a0a 2020  othing(self):.  
-0000e380: 2020 2020 2020 7575 6964 7320 3d20 5b55        uuids = [U
-0000e390: 5549 4428 2737 3932 3062 3339 342d 3135  UID('7920b394-15
-0000e3a0: 3635 2d31 3165 382d 3836 6530 2d38 6234  65-11e8-86e0-8b4
-0000e3b0: 3264 3436 3437 6261 3827 292c 0a20 2020  2d4647ba8'),.   
-0000e3c0: 2020 2020 2020 2020 2020 2020 2020 5555                UU
-0000e3d0: 4944 2827 3830 6166 3837 3563 2d31 3536  ID('80af875c-156
-0000e3e0: 352d 3131 6538 2d38 6634 342d 3837 6566  5-11e8-8f44-87ef
-0000e3f0: 3038 3162 3438 6364 2729 5d0a 2020 2020  081b48cd')].    
-0000e400: 2020 2020 6372 6561 7465 6420 3d20 6461      created = da
-0000e410: 7465 7469 6d65 2831 3938 332c 2033 2c20  tetime(1983, 3, 
-0000e420: 3239 2c20 3135 2c20 3135 290a 0a20 2020  29, 15, 15)..   
-0000e430: 2020 2020 2066 696c 6520 3d20 4279 7465       file = Byte
-0000e440: 7349 4f28 290a 2020 2020 2020 2020 7769  sIO().        wi
-0000e450: 7468 206d 6f63 6b2e 7061 7463 6828 276d  th mock.patch('m
-0000e460: 6564 6961 6772 6169 6e73 2e67 7366 2e64  ediagrains.gsf.d
-0000e470: 6174 6574 696d 6527 2c20 7369 6465 5f65  atetime', side_e
-0000e480: 6666 6563 743d 6461 7465 7469 6d65 2c20  ffect=datetime, 
-0000e490: 6e6f 773d 6d6f 636b 2e4d 6167 6963 4d6f  now=mock.MagicMo
-0000e4a0: 636b 2872 6574 7572 6e5f 7661 6c75 653d  ck(return_value=
-0000e4b0: 6372 6561 7465 6429 293a 0a20 2020 2020  created)):.     
-0000e4c0: 2020 2020 2020 2077 6974 6820 6d6f 636b         with mock
-0000e4d0: 2e70 6174 6368 2827 6d65 6469 6167 7261  .patch('mediagra
-0000e4e0: 696e 732e 6773 662e 7575 6964 3127 2c20  ins.gsf.uuid1', 
-0000e4f0: 7369 6465 5f65 6666 6563 743d 7575 6964  side_effect=uuid
-0000e500: 7329 3a0a 2020 2020 2020 2020 2020 2020  s):.            
-0000e510: 2020 2020 656e 6320 3d20 4753 4645 6e63      enc = GSFEnc
-0000e520: 6f64 6572 2866 696c 6529 0a20 2020 2020  oder(file).     
-0000e530: 2020 2020 2020 2020 2020 2065 6e63 2e61             enc.a
-0000e540: 6464 5f73 6567 6d65 6e74 2829 0a20 2020  dd_segment().   
-0000e550: 2020 2020 2020 2020 2020 2020 2064 756d               dum
-0000e560: 7030 203d 2066 696c 652e 6765 7476 616c  p0 = file.getval
-0000e570: 7565 2829 0a20 2020 2020 2020 2020 2020  ue().           
-0000e580: 2020 2020 2065 6e63 2e65 6e64 5f64 756d       enc.end_dum
-0000e590: 7028 290a 2020 2020 2020 2020 2020 2020  p().            
-0000e5a0: 2020 2020 6475 6d70 3120 3d20 6669 6c65      dump1 = file
-0000e5b0: 2e67 6574 7661 6c75 6528 290a 0a20 2020  .getvalue()..   
-0000e5c0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-0000e5d0: 4571 7561 6c28 6475 6d70 302c 2064 756d  Equal(dump0, dum
-0000e5e0: 7031 290a 0a20 2020 2064 6566 2074 6573  p1)..    def tes
-0000e5f0: 745f 6475 6d70 735f 6661 696c 735f 7769  t_dumps_fails_wi
-0000e600: 7468 5f69 6e76 616c 6964 5f74 6167 7328  th_invalid_tags(
-0000e610: 7365 6c66 293a 0a20 2020 2020 2020 2075  self):.        u
-0000e620: 7569 6473 203d 205b 5555 4944 2827 3739  uids = [UUID('79
-0000e630: 3230 6233 3934 2d31 3536 352d 3131 6538  20b394-1565-11e8
-0000e640: 2d38 3665 302d 3862 3432 6434 3634 3762  -86e0-8b42d4647b
-0000e650: 6138 2729 2c0a 2020 2020 2020 2020 2020  a8'),.          
-0000e660: 2020 2020 2020 2055 5549 4428 2738 3061         UUID('80a
-0000e670: 6638 3735 632d 3135 3635 2d31 3165 382d  f875c-1565-11e8-
-0000e680: 3866 3434 2d38 3765 6630 3831 6234 3863  8f44-87ef081b48c
-0000e690: 6427 295d 0a20 2020 2020 2020 2063 7265  d')].        cre
-0000e6a0: 6174 6564 203d 2064 6174 6574 696d 6528  ated = datetime(
-0000e6b0: 3139 3833 2c20 332c 2032 392c 2031 352c  1983, 3, 29, 15,
-0000e6c0: 2031 3529 0a20 2020 2020 2020 2077 6974   15).        wit
-0000e6d0: 6820 7365 6c66 2e61 7373 6572 7452 6169  h self.assertRai
-0000e6e0: 7365 7328 4753 4645 6e63 6f64 6545 7272  ses(GSFEncodeErr
-0000e6f0: 6f72 293a 0a20 2020 2020 2020 2020 2020  or):.           
-0000e700: 2077 6974 6820 6d6f 636b 2e70 6174 6368   with mock.patch
-0000e710: 2827 6d65 6469 6167 7261 696e 732e 6773  ('mediagrains.gs
-0000e720: 662e 6461 7465 7469 6d65 272c 2073 6964  f.datetime', sid
-0000e730: 655f 6566 6665 6374 3d64 6174 6574 696d  e_effect=datetim
-0000e740: 652c 206e 6f77 3d6d 6f63 6b2e 4d61 6769  e, now=mock.Magi
-0000e750: 634d 6f63 6b28 7265 7475 726e 5f76 616c  cMock(return_val
-0000e760: 7565 3d63 7265 6174 6564 2929 3a0a 2020  ue=created)):.  
-0000e770: 2020 2020 2020 2020 2020 2020 2020 7769                wi
-0000e780: 7468 206d 6f63 6b2e 7061 7463 6828 276d  th mock.patch('m
-0000e790: 6564 6961 6772 6169 6e73 2e67 7366 2e75  ediagrains.gsf.u
-0000e7a0: 7569 6431 272c 2073 6964 655f 6566 6665  uid1', side_effe
-0000e7b0: 6374 3d75 7569 6473 293a 0a20 2020 2020  ct=uuids):.     
-0000e7c0: 2020 2020 2020 2020 2020 2020 2020 2028                 (
-0000e7d0: 6865 6164 2c20 7365 676d 656e 7473 2920  head, segments) 
-0000e7e0: 3d20 6c6f 6164 7328 6475 6d70 7328 5b5d  = loads(dumps([]
-0000e7f0: 2c20 7461 6773 3d5b 4e6f 6e65 2c20 4e6f  , tags=[None, No
-0000e800: 6e65 5d29 290a 0a20 2020 2064 6566 2074  ne]))..    def t
-0000e810: 6573 745f 6475 6d70 735f 6361 6e5f 7365  est_dumps_can_se
-0000e820: 745f 7461 6773 2873 656c 6629 3a0a 2020  t_tags(self):.  
-0000e830: 2020 2020 2020 7575 6964 7320 3d20 5b55        uuids = [U
-0000e840: 5549 4428 2737 3932 3062 3339 342d 3135  UID('7920b394-15
-0000e850: 3635 2d31 3165 382d 3836 6530 2d38 6234  65-11e8-86e0-8b4
-0000e860: 3264 3436 3437 6261 3827 292c 0a20 2020  2d4647ba8'),.   
-0000e870: 2020 2020 2020 2020 2020 2020 2020 5555                UU
-0000e880: 4944 2827 3830 6166 3837 3563 2d31 3536  ID('80af875c-156
-0000e890: 352d 3131 6538 2d38 6634 342d 3837 6566  5-11e8-8f44-87ef
-0000e8a0: 3038 3162 3438 6364 2729 5d0a 2020 2020  081b48cd')].    
-0000e8b0: 2020 2020 6372 6561 7465 6420 3d20 6461      created = da
-0000e8c0: 7465 7469 6d65 2831 3938 332c 2033 2c20  tetime(1983, 3, 
-0000e8d0: 3239 2c20 3135 2c20 3135 290a 2020 2020  29, 15, 15).    
-0000e8e0: 2020 2020 7769 7468 206d 6f63 6b2e 7061      with mock.pa
-0000e8f0: 7463 6828 276d 6564 6961 6772 6169 6e73  tch('mediagrains
-0000e900: 2e67 7366 2e64 6174 6574 696d 6527 2c20  .gsf.datetime', 
-0000e910: 7369 6465 5f65 6666 6563 743d 6461 7465  side_effect=date
-0000e920: 7469 6d65 2c20 6e6f 773d 6d6f 636b 2e4d  time, now=mock.M
-0000e930: 6167 6963 4d6f 636b 2872 6574 7572 6e5f  agicMock(return_
-0000e940: 7661 6c75 653d 6372 6561 7465 6429 293a  value=created)):
-0000e950: 0a20 2020 2020 2020 2020 2020 2077 6974  .            wit
-0000e960: 6820 6d6f 636b 2e70 6174 6368 2827 6d65  h mock.patch('me
-0000e970: 6469 6167 7261 696e 732e 6773 662e 7575  diagrains.gsf.uu
-0000e980: 6964 3127 2c20 7369 6465 5f65 6666 6563  id1', side_effec
-0000e990: 743d 7575 6964 7329 3a0a 2020 2020 2020  t=uuids):.      
-0000e9a0: 2020 2020 2020 2020 2020 2868 6561 642c            (head,
-0000e9b0: 2073 6567 6d65 6e74 7329 203d 206c 6f61   segments) = loa
-0000e9c0: 6473 2864 756d 7073 285b 5d2c 2074 6167  ds(dumps([], tag
-0000e9d0: 733d 5b28 2770 6f74 6174 6f27 2c20 2768  s=[('potato', 'h
-0000e9e0: 6172 7665 7374 2729 5d2c 2073 6567 6d65  arvest')], segme
-0000e9f0: 6e74 5f74 6167 733d 5b28 2772 6169 6e62  nt_tags=[('rainb
-0000ea00: 6f77 272c 2027 6461 7368 2729 5d29 290a  ow', 'dash')])).
-0000ea10: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-0000ea20: 7365 7274 4571 7561 6c28 6c65 6e28 6865  sertEqual(len(he
-0000ea30: 6164 5b27 7461 6773 275d 292c 2031 290a  ad['tags']), 1).
-0000ea40: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-0000ea50: 6572 7449 6e28 2827 706f 7461 746f 272c  ertIn(('potato',
-0000ea60: 2027 6861 7276 6573 7427 292c 2068 6561   'harvest'), hea
-0000ea70: 645b 2774 6167 7327 5d29 0a0a 2020 2020  d['tags'])..    
-0000ea80: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-0000ea90: 7175 616c 286c 656e 2868 6561 645b 2773  qual(len(head['s
-0000eaa0: 6567 6d65 6e74 7327 5d5b 305d 5b27 7461  egments'][0]['ta
-0000eab0: 6773 275d 292c 2031 290a 2020 2020 2020  gs']), 1).      
-0000eac0: 2020 7365 6c66 2e61 7373 6572 7449 6e28    self.assertIn(
-0000ead0: 2827 7261 696e 626f 7727 2c20 2764 6173  ('rainbow', 'das
-0000eae0: 6827 292c 2068 6561 645b 2773 6567 6d65  h'), head['segme
-0000eaf0: 6e74 7327 5d5b 305d 5b27 7461 6773 275d  nts'][0]['tags']
-0000eb00: 290a 0a20 2020 2064 6566 2074 6573 745f  )..    def test_
-0000eb10: 656e 636f 6465 725f 6163 6365 7373 5f6d  encoder_access_m
-0000eb20: 6574 686f 6473 2873 656c 6629 3a0a 2020  ethods(self):.  
-0000eb30: 2020 2020 2020 7575 6964 7320 3d20 5b55        uuids = [U
-0000eb40: 5549 4428 2737 3932 3062 3339 342d 3135  UID('7920b394-15
-0000eb50: 3635 2d31 3165 382d 3836 6530 2d38 6234  65-11e8-86e0-8b4
-0000eb60: 3264 3436 3437 6261 3827 292c 0a20 2020  2d4647ba8'),.   
-0000eb70: 2020 2020 2020 2020 2020 2020 2020 5555                UU
-0000eb80: 4944 2827 3830 6166 3837 3563 2d31 3536  ID('80af875c-156
-0000eb90: 352d 3131 6538 2d38 6634 342d 3837 6566  5-11e8-8f44-87ef
-0000eba0: 3038 3162 3438 6364 2729 5d0a 2020 2020  081b48cd')].    
-0000ebb0: 2020 2020 6372 6561 7465 6420 3d20 6461      created = da
-0000ebc0: 7465 7469 6d65 2831 3938 332c 2033 2c20  tetime(1983, 3, 
-0000ebd0: 3239 2c20 3135 2c20 3135 290a 2020 2020  29, 15, 15).    
-0000ebe0: 2020 2020 7769 7468 206d 6f63 6b2e 7061      with mock.pa
-0000ebf0: 7463 6828 276d 6564 6961 6772 6169 6e73  tch('mediagrains
-0000ec00: 2e67 7366 2e64 6174 6574 696d 6527 2c20  .gsf.datetime', 
-0000ec10: 7369 6465 5f65 6666 6563 743d 6461 7465  side_effect=date
-0000ec20: 7469 6d65 2c20 6e6f 773d 6d6f 636b 2e4d  time, now=mock.M
-0000ec30: 6167 6963 4d6f 636b 2872 6574 7572 6e5f  agicMock(return_
-0000ec40: 7661 6c75 653d 6372 6561 7465 6429 293a  value=created)):
-0000ec50: 0a20 2020 2020 2020 2020 2020 2077 6974  .            wit
-0000ec60: 6820 6d6f 636b 2e70 6174 6368 2827 6d65  h mock.patch('me
-0000ec70: 6469 6167 7261 696e 732e 6773 662e 7575  diagrains.gsf.uu
-0000ec80: 6964 3127 2c20 7369 6465 5f65 6666 6563  id1', side_effec
-0000ec90: 743d 7575 6964 7329 3a0a 2020 2020 2020  t=uuids):.      
-0000eca0: 2020 2020 2020 2020 2020 656e 6320 3d20            enc = 
-0000ecb0: 4753 4645 6e63 6f64 6572 285b 5d2c 2074  GSFEncoder([], t
-0000ecc0: 6167 733d 5b28 2770 6f74 6174 6f27 2c20  ags=[('potato', 
-0000ecd0: 2768 6172 7665 7374 2729 5d29 0a20 2020  'harvest')]).   
-0000ece0: 2020 2020 2020 2020 2020 2020 2065 6e63               enc
-0000ecf0: 2e61 6464 5f73 6567 6d65 6e74 2874 6167  .add_segment(tag
-0000ed00: 733d 5b28 2772 6169 6e62 6f77 272c 2027  s=[('rainbow', '
-0000ed10: 6461 7368 2729 5d29 0a0a 2020 2020 2020  dash')])..      
-0000ed20: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-0000ed30: 616c 2865 6e63 2e74 6167 732c 2028 2827  al(enc.tags, (('
-0000ed40: 706f 7461 746f 272c 2027 6861 7276 6573  potato', 'harves
-0000ed50: 7427 292c 2929 0a20 2020 2020 2020 2073  t'),)).        s
-0000ed60: 656c 662e 6173 7365 7274 4973 496e 7374  elf.assertIsInst
-0000ed70: 616e 6365 2865 6e63 2e73 6567 6d65 6e74  ance(enc.segment
-0000ed80: 732c 2066 726f 7a65 6e64 6963 7429 0a20  s, frozendict). 
-0000ed90: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-0000eda0: 7274 4571 7561 6c28 656e 632e 7365 676d  rtEqual(enc.segm
-0000edb0: 656e 7473 5b31 5d2e 7461 6773 2c20 2828  ents[1].tags, ((
-0000edc0: 2772 6169 6e62 6f77 272c 2027 6461 7368  'rainbow', 'dash
-0000edd0: 2729 2c29 290a 0a20 2020 2040 7375 7070  '),))..    @supp
-0000ede0: 7265 7373 5f64 6570 7265 6361 7469 6f6e  ress_deprecation
-0000edf0: 5f77 6172 6e69 6e67 730a 2020 2020 6465  _warnings.    de
-0000ee00: 6620 7465 7374 5f65 6e63 6f64 6572 5f72  f test_encoder_r
-0000ee10: 6169 7365 735f 7768 656e 5f61 6464 696e  aises_when_addin
-0000ee20: 675f 746f 5f61 6374 6976 655f 656e 636f  g_to_active_enco
-0000ee30: 6465 5f5f 6465 7072 6563 6174 6564 2873  de__deprecated(s
-0000ee40: 656c 6629 3a0a 2020 2020 2020 2020 7575  elf):.        uu
-0000ee50: 6964 7320 3d20 5b55 5549 4428 2737 3932  ids = [UUID('792
-0000ee60: 3062 3339 342d 3135 3635 2d31 3165 382d  0b394-1565-11e8-
-0000ee70: 3836 6530 2d38 6234 3264 3436 3437 6261  86e0-8b42d4647ba
-0000ee80: 3827 292c 0a20 2020 2020 2020 2020 2020  8'),.           
-0000ee90: 2020 2020 2020 5555 4944 2827 3830 6166        UUID('80af
-0000eea0: 3837 3563 2d31 3536 352d 3131 6538 2d38  875c-1565-11e8-8
-0000eeb0: 6634 342d 3837 6566 3038 3162 3438 6364  f44-87ef081b48cd
-0000eec0: 2729 5d0a 2020 2020 2020 2020 6372 6561  ')].        crea
-0000eed0: 7465 6420 3d20 6461 7465 7469 6d65 2831  ted = datetime(1
-0000eee0: 3938 332c 2033 2c20 3239 2c20 3135 2c20  983, 3, 29, 15, 
-0000eef0: 3135 290a 2020 2020 2020 2020 6669 6c65  15).        file
-0000ef00: 203d 2042 7974 6573 494f 2829 0a20 2020   = BytesIO().   
-0000ef10: 2020 2020 2077 6974 6820 6d6f 636b 2e70       with mock.p
-0000ef20: 6174 6368 2827 6d65 6469 6167 7261 696e  atch('mediagrain
-0000ef30: 732e 6773 662e 6461 7465 7469 6d65 272c  s.gsf.datetime',
-0000ef40: 2073 6964 655f 6566 6665 6374 3d64 6174   side_effect=dat
-0000ef50: 6574 696d 652c 206e 6f77 3d6d 6f63 6b2e  etime, now=mock.
-0000ef60: 4d61 6769 634d 6f63 6b28 7265 7475 726e  MagicMock(return
-0000ef70: 5f76 616c 7565 3d63 7265 6174 6564 2929  _value=created))
-0000ef80: 3a0a 2020 2020 2020 2020 2020 2020 7769  :.            wi
-0000ef90: 7468 206d 6f63 6b2e 7061 7463 6828 276d  th mock.patch('m
-0000efa0: 6564 6961 6772 6169 6e73 2e67 7366 2e75  ediagrains.gsf.u
-0000efb0: 7569 6431 272c 2073 6964 655f 6566 6665  uid1', side_effe
-0000efc0: 6374 3d75 7569 6473 293a 0a20 2020 2020  ct=uuids):.     
-0000efd0: 2020 2020 2020 2020 2020 2065 6e63 203d             enc =
-0000efe0: 2047 5346 456e 636f 6465 7228 6669 6c65   GSFEncoder(file
-0000eff0: 2c20 7461 6773 3d5b 2827 706f 7461 746f  , tags=[('potato
-0000f000: 272c 2027 6861 7276 6573 7427 295d 290a  ', 'harvest')]).
-0000f010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f020: 7365 6720 3d20 656e 632e 6164 645f 7365  seg = enc.add_se
-0000f030: 676d 656e 7428 7461 6773 3d5b 2827 7261  gment(tags=[('ra
-0000f040: 696e 626f 7727 2c20 2764 6173 6827 295d  inbow', 'dash')]
-0000f050: 290a 0a20 2020 2020 2020 2077 6974 6820  )..        with 
-0000f060: 7365 6c66 2e61 7373 6572 7452 6169 7365  self.assertRaise
-0000f070: 7328 4753 4645 6e63 6f64 6545 7272 6f72  s(GSFEncodeError
-0000f080: 293a 0a20 2020 2020 2020 2020 2020 2065  ):.            e
-0000f090: 6e63 2e61 6464 5f73 6567 6d65 6e74 286c  nc.add_segment(l
-0000f0a0: 6f63 616c 5f69 643d 3129 0a0a 2020 2020  ocal_id=1)..    
-0000f0b0: 2020 2020 7769 7468 2073 656c 662e 6173      with self.as
-0000f0c0: 7365 7274 5261 6973 6573 2847 5346 456e  sertRaises(GSFEn
-0000f0d0: 636f 6465 4572 726f 7229 3a0a 2020 2020  codeError):.    
-0000f0e0: 2020 2020 2020 2020 656e 632e 6164 645f          enc.add_
-0000f0f0: 7365 676d 656e 7428 7461 6773 3d5b 4e6f  segment(tags=[No
-0000f100: 6e65 5d29 0a0a 2020 2020 2020 2020 656e  ne])..        en
-0000f110: 632e 7374 6172 745f 6475 6d70 2829 0a0a  c.start_dump()..
-0000f120: 2020 2020 2020 2020 7769 7468 2073 656c          with sel
-0000f130: 662e 6173 7365 7274 5261 6973 6573 2847  f.assertRaises(G
-0000f140: 5346 456e 636f 6465 4164 6454 6f41 6374  SFEncodeAddToAct
-0000f150: 6976 6544 756d 7029 3a0a 2020 2020 2020  iveDump):.      
-0000f160: 2020 2020 2020 656e 632e 6164 645f 7461        enc.add_ta
-0000f170: 6728 2775 7073 6964 6527 2c20 2764 6f77  g('upside', 'dow
-0000f180: 6e27 290a 2020 2020 2020 2020 7769 7468  n').        with
-0000f190: 2073 656c 662e 6173 7365 7274 5261 6973   self.assertRais
-0000f1a0: 6573 2847 5346 456e 636f 6465 4164 6454  es(GSFEncodeAddT
-0000f1b0: 6f41 6374 6976 6544 756d 7029 3a0a 2020  oActiveDump):.  
-0000f1c0: 2020 2020 2020 2020 2020 656e 632e 6164            enc.ad
-0000f1d0: 645f 7365 676d 656e 7428 290a 2020 2020  d_segment().    
-0000f1e0: 2020 2020 7769 7468 2073 656c 662e 6173      with self.as
-0000f1f0: 7365 7274 5261 6973 6573 2847 5346 456e  sertRaises(GSFEn
-0000f200: 636f 6465 4164 6454 6f41 6374 6976 6544  codeAddToActiveD
-0000f210: 756d 7029 3a0a 2020 2020 2020 2020 2020  ump):.          
-0000f220: 2020 7365 672e 6164 645f 7461 6728 2775    seg.add_tag('u
-0000f230: 7073 6964 6527 2c20 2764 6f77 6e27 290a  pside', 'down').
-0000f240: 0a20 2020 2064 6566 2074 6573 745f 656e  .    def test_en
-0000f250: 636f 6465 725f 7261 6973 6573 5f77 6865  coder_raises_whe
-0000f260: 6e5f 6164 6469 6e67 5f74 6f5f 6163 7469  n_adding_to_acti
-0000f270: 7665 5f65 6e63 6f64 6528 7365 6c66 293a  ve_encode(self):
-0000f280: 0a20 2020 2020 2020 2075 7569 6473 203d  .        uuids =
-0000f290: 205b 5555 4944 2827 3739 3230 6233 3934   [UUID('7920b394
-0000f2a0: 2d31 3536 352d 3131 6538 2d38 3665 302d  -1565-11e8-86e0-
-0000f2b0: 3862 3432 6434 3634 3762 6138 2729 2c0a  8b42d4647ba8'),.
-0000f2c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f2d0: 2055 5549 4428 2738 3061 6638 3735 632d   UUID('80af875c-
-0000f2e0: 3135 3635 2d31 3165 382d 3866 3434 2d38  1565-11e8-8f44-8
-0000f2f0: 3765 6630 3831 6234 3863 6427 295d 0a20  7ef081b48cd')]. 
-0000f300: 2020 2020 2020 2063 7265 6174 6564 203d         created =
-0000f310: 2064 6174 6574 696d 6528 3139 3833 2c20   datetime(1983, 
-0000f320: 332c 2032 392c 2031 352c 2031 3529 0a20  3, 29, 15, 15). 
-0000f330: 2020 2020 2020 2066 696c 6520 3d20 4279         file = By
-0000f340: 7465 7349 4f28 290a 2020 2020 2020 2020  tesIO().        
-0000f350: 7769 7468 206d 6f63 6b2e 7061 7463 6828  with mock.patch(
-0000f360: 276d 6564 6961 6772 6169 6e73 2e67 7366  'mediagrains.gsf
-0000f370: 2e64 6174 6574 696d 6527 2c20 7369 6465  .datetime', side
-0000f380: 5f65 6666 6563 743d 6461 7465 7469 6d65  _effect=datetime
-0000f390: 2c20 6e6f 773d 6d6f 636b 2e4d 6167 6963  , now=mock.Magic
-0000f3a0: 4d6f 636b 2872 6574 7572 6e5f 7661 6c75  Mock(return_valu
-0000f3b0: 653d 6372 6561 7465 6429 293a 0a20 2020  e=created)):.   
-0000f3c0: 2020 2020 2020 2020 2077 6974 6820 6d6f           with mo
-0000f3d0: 636b 2e70 6174 6368 2827 6d65 6469 6167  ck.patch('mediag
-0000f3e0: 7261 696e 732e 6773 662e 7575 6964 3127  rains.gsf.uuid1'
-0000f3f0: 2c20 7369 6465 5f65 6666 6563 743d 7575  , side_effect=uu
-0000f400: 6964 7329 3a0a 2020 2020 2020 2020 2020  ids):.          
-0000f410: 2020 2020 2020 656e 6320 3d20 4753 4645        enc = GSFE
-0000f420: 6e63 6f64 6572 2866 696c 652c 2074 6167  ncoder(file, tag
-0000f430: 733d 5b28 2770 6f74 6174 6f27 2c20 2768  s=[('potato', 'h
-0000f440: 6172 7665 7374 2729 5d2c 2073 7472 6561  arvest')], strea
-0000f450: 6d69 6e67 3d54 7275 6529 0a20 2020 2020  ming=True).     
-0000f460: 2020 2020 2020 2020 2020 2073 6567 203d             seg =
-0000f470: 2065 6e63 2e61 6464 5f73 6567 6d65 6e74   enc.add_segment
-0000f480: 2874 6167 733d 5b28 2772 6169 6e62 6f77  (tags=[('rainbow
-0000f490: 272c 2027 6461 7368 2729 5d29 0a0a 2020  ', 'dash')])..  
-0000f4a0: 2020 2020 2020 7769 7468 2073 656c 662e        with self.
-0000f4b0: 6173 7365 7274 5261 6973 6573 2847 5346  assertRaises(GSF
-0000f4c0: 456e 636f 6465 4572 726f 7229 3a0a 2020  EncodeError):.  
-0000f4d0: 2020 2020 2020 2020 2020 656e 632e 6164            enc.ad
-0000f4e0: 645f 7365 676d 656e 7428 6c6f 6361 6c5f  d_segment(local_
-0000f4f0: 6964 3d31 290a 0a20 2020 2020 2020 2077  id=1)..        w
-0000f500: 6974 6820 7365 6c66 2e61 7373 6572 7452  ith self.assertR
-0000f510: 6169 7365 7328 4753 4645 6e63 6f64 6545  aises(GSFEncodeE
-0000f520: 7272 6f72 293a 0a20 2020 2020 2020 2020  rror):.         
-0000f530: 2020 2065 6e63 2e61 6464 5f73 6567 6d65     enc.add_segme
-0000f540: 6e74 2874 6167 733d 5b4e 6f6e 655d 290a  nt(tags=[None]).
-0000f550: 0a20 2020 2020 2020 2077 6974 6820 656e  .        with en
-0000f560: 633a 0a20 2020 2020 2020 2020 2020 2077  c:.            w
-0000f570: 6974 6820 7365 6c66 2e61 7373 6572 7452  ith self.assertR
-0000f580: 6169 7365 7328 4753 4645 6e63 6f64 6541  aises(GSFEncodeA
-0000f590: 6464 546f 4163 7469 7665 4475 6d70 293a  ddToActiveDump):
-0000f5a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000f5b0: 2065 6e63 2e61 6464 5f74 6167 2827 7570   enc.add_tag('up
-0000f5c0: 7369 6465 272c 2027 646f 776e 2729 0a20  side', 'down'). 
-0000f5d0: 2020 2020 2020 2020 2020 2077 6974 6820             with 
-0000f5e0: 7365 6c66 2e61 7373 6572 7452 6169 7365  self.assertRaise
-0000f5f0: 7328 4753 4645 6e63 6f64 6541 6464 546f  s(GSFEncodeAddTo
-0000f600: 4163 7469 7665 4475 6d70 293a 0a20 2020  ActiveDump):.   
-0000f610: 2020 2020 2020 2020 2020 2020 2065 6e63               enc
-0000f620: 2e61 6464 5f73 6567 6d65 6e74 2829 0a20  .add_segment(). 
-0000f630: 2020 2020 2020 2020 2020 2077 6974 6820             with 
-0000f640: 7365 6c66 2e61 7373 6572 7452 6169 7365  self.assertRaise
-0000f650: 7328 4753 4645 6e63 6f64 6541 6464 546f  s(GSFEncodeAddTo
-0000f660: 4163 7469 7665 4475 6d70 293a 0a20 2020  ActiveDump):.   
-0000f670: 2020 2020 2020 2020 2020 2020 2073 6567               seg
-0000f680: 2e61 6464 5f74 6167 2827 7570 7369 6465  .add_tag('upside
-0000f690: 272c 2027 646f 776e 2729 0a0a 2020 2020  ', 'down')..    
-0000f6a0: 6465 6620 7465 7374 5f65 6e63 6f64 6572  def test_encoder
-0000f6b0: 5f63 616e 5f61 6464 5f67 7261 696e 735f  _can_add_grains_
-0000f6c0: 746f 5f6e 6f6e 6578 6973 7465 6e74 5f73  to_nonexistent_s
-0000f6d0: 6567 6d65 6e74 2873 656c 6629 3a0a 2020  egment(self):.  
-0000f6e0: 2020 2020 2020 7372 635f 6964 203d 2055        src_id = U
-0000f6f0: 5549 4428 2765 3134 6539 6435 382d 3135  UID('e14e9d58-15
-0000f700: 3637 2d31 3165 382d 3864 6433 2d38 3331  67-11e8-8dd3-831
-0000f710: 6130 3638 6562 3033 3427 290a 2020 2020  a068eb034').    
-0000f720: 2020 2020 666c 6f77 5f69 6420 3d20 5555      flow_id = UU
-0000f730: 4944 2827 6565 3165 6564 3538 2d31 3536  ID('ee1eed58-156
-0000f740: 372d 3131 6538 2d61 3937 312d 3362 3930  7-11e8-a971-3b90
-0000f750: 3161 3264 6438 6162 2729 0a20 2020 2020  1a2dd8ab').     
-0000f760: 2020 2067 7261 696e 3020 3d20 5669 6465     grain0 = Vide
-0000f770: 6f47 7261 696e 2873 7263 5f69 642c 2066  oGrain(src_id, f
-0000f780: 6c6f 775f 6964 2c20 636f 675f 6672 616d  low_id, cog_fram
-0000f790: 655f 666f 726d 6174 3d43 6f67 4672 616d  e_format=CogFram
-0000f7a0: 6546 6f72 6d61 742e 5331 365f 3432 325f  eFormat.S16_422_
-0000f7b0: 3130 4249 542c 2077 6964 7468 3d31 3932  10BIT, width=192
-0000f7c0: 302c 2068 6569 6768 743d 3130 3830 290a  0, height=1080).
-0000f7d0: 2020 2020 2020 2020 7575 6964 7320 3d20          uuids = 
-0000f7e0: 5b55 5549 4428 2737 3932 3062 3339 342d  [UUID('7920b394-
-0000f7f0: 3135 3635 2d31 3165 382d 3836 6530 2d38  1565-11e8-86e0-8
-0000f800: 6234 3264 3436 3437 6261 3827 292c 0a20  b42d4647ba8'),. 
-0000f810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f820: 5555 4944 2827 3830 6166 3837 3563 2d31  UUID('80af875c-1
-0000f830: 3536 352d 3131 6538 2d38 6634 342d 3837  565-11e8-8f44-87
-0000f840: 6566 3038 3162 3438 6364 2729 5d0a 2020  ef081b48cd')].  
-0000f850: 2020 2020 2020 6372 6561 7465 6420 3d20        created = 
-0000f860: 6461 7465 7469 6d65 2831 3938 332c 2033  datetime(1983, 3
-0000f870: 2c20 3239 2c20 3135 2c20 3135 290a 2020  , 29, 15, 15).  
-0000f880: 2020 2020 2020 6669 6c65 203d 2042 7974        file = Byt
-0000f890: 6573 494f 2829 0a20 2020 2020 2020 2077  esIO().        w
-0000f8a0: 6974 6820 6d6f 636b 2e70 6174 6368 2827  ith mock.patch('
-0000f8b0: 6d65 6469 6167 7261 696e 732e 6773 662e  mediagrains.gsf.
-0000f8c0: 6461 7465 7469 6d65 272c 2073 6964 655f  datetime', side_
-0000f8d0: 6566 6665 6374 3d64 6174 6574 696d 652c  effect=datetime,
-0000f8e0: 206e 6f77 3d6d 6f63 6b2e 4d61 6769 634d   now=mock.MagicM
-0000f8f0: 6f63 6b28 7265 7475 726e 5f76 616c 7565  ock(return_value
-0000f900: 3d63 7265 6174 6564 2929 3a0a 2020 2020  =created)):.    
-0000f910: 2020 2020 2020 2020 7769 7468 206d 6f63          with moc
-0000f920: 6b2e 7061 7463 6828 276d 6564 6961 6772  k.patch('mediagr
-0000f930: 6169 6e73 2e67 7366 2e75 7569 6431 272c  ains.gsf.uuid1',
-0000f940: 2073 6964 655f 6566 6665 6374 3d75 7569   side_effect=uui
-0000f950: 6473 293a 0a20 2020 2020 2020 2020 2020  ds):.           
-0000f960: 2020 2020 2065 6e63 203d 2047 5346 456e       enc = GSFEn
-0000f970: 636f 6465 7228 6669 6c65 2c20 7461 6773  coder(file, tags
-0000f980: 3d5b 2827 706f 7461 746f 272c 2027 6861  =[('potato', 'ha
-0000f990: 7276 6573 7427 295d 290a 0a20 2020 2020  rvest')])..     
-0000f9a0: 2020 2065 6e63 2e61 6464 5f67 7261 696e     enc.add_grain
-0000f9b0: 2867 7261 696e 302c 2073 6567 6d65 6e74  (grain0, segment
-0000f9c0: 5f6c 6f63 616c 5f69 643d 3229 0a0a 2020  _local_id=2)..  
-0000f9d0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-0000f9e0: 7445 7175 616c 2865 6e63 2e73 6567 6d65  tEqual(enc.segme
-0000f9f0: 6e74 735b 325d 2e5f 6772 6169 6e73 5b30  nts[2]._grains[0
-0000fa00: 5d2c 2067 7261 696e 3029 0a0a 0a63 6c61  ], grain0)...cla
-0000fa10: 7373 2054 6573 7447 5346 426c 6f63 6b28  ss TestGSFBlock(
-0000fa20: 4973 6f6c 6174 6564 4173 796e 6369 6f54  IsolatedAsyncioT
-0000fa30: 6573 7443 6173 6529 3a0a 2020 2020 2222  estCase):.    ""
-0000fa40: 2254 6573 7420 7468 6520 4753 4620 6465  "Test the GSF de
-0000fa50: 636f 6465 7220 626c 6f63 6b20 6861 6e64  coder block hand
-0000fa60: 6c65 7220 636f 7272 6563 746c 7920 7061  ler correctly pa
-0000fa70: 7273 6573 2076 6172 696f 7573 2074 7970  rses various typ
-0000fa80: 6573 2222 220a 0a20 2020 2061 7379 6e63  es"""..    async
-0000fa90: 2064 6566 2074 6573 745f 7265 6164 5f75   def test_read_u
-0000faa0: 696e 7428 7365 6c66 293a 0a20 2020 2020  int(self):.     
-0000fab0: 2020 2074 6573 745f 6e75 6d62 6572 203d     test_number =
-0000fac0: 2034 3133 320a 2020 2020 2020 2020 7465   4132.        te
-0000fad0: 7374 5f64 6174 6120 3d20 6222 5c78 3234  st_data = b"\x24
-0000fae0: 5c78 3130 5c78 3030 5c78 3030 220a 0a20  \x10\x00\x00".. 
-0000faf0: 2020 2020 2020 2061 7379 6e63 2077 6974         async wit
-0000fb00: 6820 4173 796e 6342 7974 6573 494f 2874  h AsyncBytesIO(t
-0000fb10: 6573 745f 6461 7461 2920 6173 2066 703a  est_data) as fp:
-0000fb20: 0a20 2020 2020 2020 2020 2020 2055 5554  .            UUT
-0000fb30: 203d 2041 7379 6e63 4753 4642 6c6f 636b   = AsyncGSFBlock
-0000fb40: 2866 7029 0a0a 2020 2020 2020 2020 2020  (fp)..          
-0000fb50: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-0000fb60: 616c 2874 6573 745f 6e75 6d62 6572 2c20  al(test_number, 
-0000fb70: 6177 6169 7420 5555 542e 7265 6164 5f75  await UUT.read_u
-0000fb80: 696e 7428 3429 290a 0a20 2020 2061 7379  int(4))..    asy
-0000fb90: 6e63 2064 6566 2074 6573 745f 7265 6164  nc def test_read
-0000fba0: 5f62 6f6f 6c28 7365 6c66 293a 0a20 2020  _bool(self):.   
-0000fbb0: 2020 2020 2074 6573 745f 6461 7461 203d       test_data =
-0000fbc0: 2062 225c 7830 305c 7830 315c 7830 3222   b"\x00\x01\x02"
-0000fbd0: 2020 2320 4661 6c73 652c 2054 7275 6520    # False, True 
-0000fbe0: 2830 7830 3120 213d 2030 292c 2054 7275  (0x01 != 0), Tru
-0000fbf0: 6520 2830 7830 3220 213d 2030 290a 0a20  e (0x02 != 0).. 
-0000fc00: 2020 2020 2020 2061 7379 6e63 2077 6974         async wit
-0000fc10: 6820 4173 796e 6342 7974 6573 494f 2874  h AsyncBytesIO(t
-0000fc20: 6573 745f 6461 7461 2920 6173 2066 703a  est_data) as fp:
-0000fc30: 0a20 2020 2020 2020 2020 2020 2055 5554  .            UUT
-0000fc40: 203d 2041 7379 6e63 4753 4642 6c6f 636b   = AsyncGSFBlock
-0000fc50: 2866 7029 0a0a 2020 2020 2020 2020 2020  (fp)..          
-0000fc60: 2020 7365 6c66 2e61 7373 6572 7446 616c    self.assertFal
-0000fc70: 7365 2861 7761 6974 2055 5554 2e72 6561  se(await UUT.rea
-0000fc80: 645f 626f 6f6c 2829 290a 2020 2020 2020  d_bool()).      
-0000fc90: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-0000fca0: 7454 7275 6528 6177 6169 7420 5555 542e  tTrue(await UUT.
-0000fcb0: 7265 6164 5f62 6f6f 6c28 2929 0a20 2020  read_bool()).   
-0000fcc0: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
-0000fcd0: 7365 7274 5472 7565 2861 7761 6974 2055  sertTrue(await U
-0000fce0: 5554 2e72 6561 645f 626f 6f6c 2829 290a  UT.read_bool()).
-0000fcf0: 0a20 2020 2061 7379 6e63 2064 6566 2074  .    async def t
-0000fd00: 6573 745f 7265 6164 5f73 696e 7428 7365  est_read_sint(se
-0000fd10: 6c66 293a 0a20 2020 2020 2020 2074 6573  lf):.        tes
-0000fd20: 745f 6e75 6d62 6572 203d 202d 3132 3835  t_number = -1285
-0000fd30: 360a 2020 2020 2020 2020 7465 7374 5f64  6.        test_d
-0000fd40: 6174 6120 3d20 6222 5c78 4338 5c78 4344  ata = b"\xC8\xCD
-0000fd50: 5c78 4646 220a 0a20 2020 2020 2020 2061  \xFF"..        a
-0000fd60: 7379 6e63 2077 6974 6820 4173 796e 6342  sync with AsyncB
-0000fd70: 7974 6573 494f 2874 6573 745f 6461 7461  ytesIO(test_data
-0000fd80: 2920 6173 2066 703a 0a20 2020 2020 2020  ) as fp:.       
-0000fd90: 2020 2020 2055 5554 203d 2041 7379 6e63       UUT = Async
-0000fda0: 4753 4642 6c6f 636b 2866 7029 0a0a 2020  GSFBlock(fp)..  
-0000fdb0: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-0000fdc0: 7373 6572 7445 7175 616c 2874 6573 745f  ssertEqual(test_
-0000fdd0: 6e75 6d62 6572 2c20 6177 6169 7420 5555  number, await UU
-0000fde0: 542e 7265 6164 5f73 696e 7428 3329 290a  T.read_sint(3)).
-0000fdf0: 0a20 2020 2061 7379 6e63 2064 6566 2074  .    async def t
-0000fe00: 6573 745f 7265 6164 5f73 7472 696e 6728  est_read_string(
-0000fe10: 7365 6c66 293a 0a20 2020 2020 2020 2022  self):.        "
-0000fe20: 2222 5465 7374 2077 6520 6361 6e20 7265  ""Test we can re
-0000fe30: 6164 2061 2073 7472 696e 672c 2077 6974  ad a string, wit
-0000fe40: 6820 556e 6963 6f64 6520 6368 6172 6163  h Unicode charac
-0000fe50: 7465 7273 2222 220a 2020 2020 2020 2020  ters""".        
-0000fe60: 7465 7374 5f73 7472 696e 6720 3d20 7522  test_string = u"
-0000fe70: 5374 7269 6e67 73f0 9f98 81e2 9c94 220a  Strings.......".
-0000fe80: 0a20 2020 2020 2020 2074 6573 745f 6461  .        test_da
-0000fe90: 7461 203d 2062 2253 7472 696e 6773 5c78  ta = b"Strings\x
-0000fea0: 6630 5c78 3966 5c78 3938 5c78 3831 5c78  f0\x9f\x98\x81\x
-0000feb0: 6532 5c78 3963 5c78 3934 220a 0a20 2020  e2\x9c\x94"..   
-0000fec0: 2020 2020 2061 7379 6e63 2077 6974 6820       async with 
-0000fed0: 4173 796e 6342 7974 6573 494f 2874 6573  AsyncBytesIO(tes
-0000fee0: 745f 6461 7461 2920 6173 2066 703a 0a20  t_data) as fp:. 
-0000fef0: 2020 2020 2020 2020 2020 2055 5554 203d             UUT =
-0000ff00: 2041 7379 6e63 4753 4642 6c6f 636b 2866   AsyncGSFBlock(f
-0000ff10: 7029 0a0a 2020 2020 2020 2020 2020 2020  p)..            
-0000ff20: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-0000ff30: 2874 6573 745f 7374 7269 6e67 2c20 6177  (test_string, aw
-0000ff40: 6169 7420 5555 542e 7265 6164 5f73 7472  ait UUT.read_str
-0000ff50: 696e 6728 3134 2929 0a0a 2020 2020 6173  ing(14))..    as
-0000ff60: 796e 6320 6465 6620 7465 7374 5f72 6561  ync def test_rea
-0000ff70: 645f 7661 7273 7472 696e 6728 7365 6c66  d_varstring(self
-0000ff80: 293a 0a20 2020 2020 2020 2074 6573 745f  ):.        test_
-0000ff90: 7374 7269 6e67 203d 2075 2253 7472 696e  string = u"Strin
-0000ffa0: 6773 f09f 9881 e29c 9422 0a20 2020 2020  gs.......".     
-0000ffb0: 2020 2074 6573 745f 6461 7461 203d 2062     test_data = b
-0000ffc0: 225c 7830 655c 7830 3053 7472 696e 6773  "\x0e\x00Strings
-0000ffd0: 5c78 6630 5c78 3966 5c78 3938 5c78 3831  \xf0\x9f\x98\x81
-0000ffe0: 5c78 6532 5c78 3963 5c78 3934 220a 0a20  \xe2\x9c\x94".. 
-0000fff0: 2020 2020 2020 2061 7379 6e63 2077 6974         async wit
-00010000: 6820 4173 796e 6342 7974 6573 494f 2874  h AsyncBytesIO(t
-00010010: 6573 745f 6461 7461 2920 6173 2066 703a  est_data) as fp:
-00010020: 0a20 2020 2020 2020 2020 2020 2055 5554  .            UUT
-00010030: 203d 2041 7379 6e63 4753 4642 6c6f 636b   = AsyncGSFBlock
-00010040: 2866 7029 0a0a 2020 2020 2020 2020 2020  (fp)..          
-00010050: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-00010060: 616c 2874 6573 745f 7374 7269 6e67 2c20  al(test_string, 
-00010070: 6177 6169 7420 5555 542e 7265 6164 5f76  await UUT.read_v
-00010080: 6172 7374 7269 6e67 2829 290a 0a20 2020  arstring())..   
-00010090: 2061 7379 6e63 2064 6566 2074 6573 745f   async def test_
-000100a0: 7265 6164 5f75 7569 6428 7365 6c66 293a  read_uuid(self):
-000100b0: 0a20 2020 2020 2020 2074 6573 745f 7575  .        test_uu
-000100c0: 6964 203d 2055 5549 4428 2262 3036 6336  id = UUID("b06c6
-000100d0: 3563 382d 3531 6163 2d34 6164 312d 6138  5c8-51ac-4ad1-a8
-000100e0: 3339 2d32 6566 3337 3130 3763 6331 3622  39-2ef37107cc16"
-000100f0: 290a 2020 2020 2020 2020 7465 7374 5f64  ).        test_d
-00010100: 6174 6120 3d20 6222 5c78 6230 5c78 3663  ata = b"\xb0\x6c
-00010110: 5c78 3635 5c78 6338 5c78 3531 5c78 6163  \x65\xc8\x51\xac
-00010120: 5c78 3461 5c78 6431 5c78 6138 5c78 3339  \x4a\xd1\xa8\x39
-00010130: 5c78 3265 5c78 6633 5c78 3731 5c78 3037  \x2e\xf3\x71\x07
-00010140: 5c78 6363 5c78 3136 220a 0a20 2020 2020  \xcc\x16"..     
-00010150: 2020 2061 7379 6e63 2077 6974 6820 4173     async with As
-00010160: 796e 6342 7974 6573 494f 2874 6573 745f  yncBytesIO(test_
-00010170: 6461 7461 2920 6173 2066 703a 0a20 2020  data) as fp:.   
-00010180: 2020 2020 2020 2020 2055 5554 203d 2041           UUT = A
-00010190: 7379 6e63 4753 4642 6c6f 636b 2866 7029  syncGSFBlock(fp)
-000101a0: 0a0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-000101b0: 6c66 2e61 7373 6572 7445 7175 616c 2874  lf.assertEqual(t
-000101c0: 6573 745f 7575 6964 2c20 6177 6169 7420  est_uuid, await 
-000101d0: 5555 542e 7265 6164 5f75 7569 6428 2929  UUT.read_uuid())
-000101e0: 0a0a 2020 2020 6173 796e 6320 6465 6620  ..    async def 
-000101f0: 7465 7374 5f72 6561 645f 7469 6d65 7374  test_read_timest
-00010200: 616d 7028 7365 6c66 293a 0a20 2020 2020  amp(self):.     
-00010210: 2020 2074 6573 745f 7469 6d65 7374 616d     test_timestam
-00010220: 7020 3d20 6461 7465 7469 6d65 2832 3031  p = datetime(201
-00010230: 382c 2039 2c20 382c 2031 362c 2030 2c20  8, 9, 8, 16, 0, 
-00010240: 3029 0a20 2020 2020 2020 2074 6573 745f  0).        test_
-00010250: 6461 7461 203d 2062 225c 7865 325c 7830  data = b"\xe2\x0
-00010260: 375c 7830 395c 7830 385c 7831 305c 7830  7\x09\x08\x10\x0
-00010270: 305c 7830 3022 0a0a 2020 2020 2020 2020  0\x00"..        
-00010280: 6173 796e 6320 7769 7468 2041 7379 6e63  async with Async
-00010290: 4279 7465 7349 4f28 7465 7374 5f64 6174  BytesIO(test_dat
-000102a0: 6129 2061 7320 6670 3a0a 2020 2020 2020  a) as fp:.      
-000102b0: 2020 2020 2020 5555 5420 3d20 4173 796e        UUT = Asyn
-000102c0: 6347 5346 426c 6f63 6b28 6670 290a 0a20  cGSFBlock(fp).. 
-000102d0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-000102e0: 6173 7365 7274 4571 7561 6c28 7465 7374  assertEqual(test
-000102f0: 5f74 696d 6573 7461 6d70 2c20 6177 6169  _timestamp, awai
-00010300: 7420 5555 542e 7265 6164 5f74 696d 6573  t UUT.read_times
-00010310: 7461 6d70 2829 290a 0a20 2020 2061 7379  tamp())..    asy
-00010320: 6e63 2064 6566 2074 6573 745f 7265 6164  nc def test_read
-00010330: 5f69 7070 7473 2873 656c 6629 3a0a 2020  _ippts(self):.  
-00010340: 2020 2020 2020 7465 7374 5f74 696d 6573        test_times
-00010350: 7461 6d70 203d 2054 696d 6573 7461 6d70  tamp = Timestamp
-00010360: 2831 3533 3634 3232 3430 302c 2035 3030  (1536422400, 500
-00010370: 290a 2020 2020 2020 2020 7465 7374 5f64  ).        test_d
-00010380: 6174 6120 3d20 6222 5c78 3030 5c78 6632  ata = b"\x00\xf2
-00010390: 5c78 3933 5c78 3562 5c78 3030 5c78 3030  \x93\x5b\x00\x00
-000103a0: 5c78 6634 5c78 3031 5c78 3030 5c78 3030  \xf4\x01\x00\x00
-000103b0: 220a 0a20 2020 2020 2020 2061 7379 6e63  "..        async
-000103c0: 2077 6974 6820 4173 796e 6342 7974 6573   with AsyncBytes
-000103d0: 494f 2874 6573 745f 6461 7461 2920 6173  IO(test_data) as
-000103e0: 2066 703a 0a20 2020 2020 2020 2020 2020   fp:.           
-000103f0: 2055 5554 203d 2041 7379 6e63 4753 4642   UUT = AsyncGSFB
-00010400: 6c6f 636b 2866 7029 0a0a 2020 2020 2020  lock(fp)..      
-00010410: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-00010420: 7445 7175 616c 2874 6573 745f 7469 6d65  tEqual(test_time
-00010430: 7374 616d 702c 2061 7761 6974 2055 5554  stamp, await UUT
-00010440: 2e72 6561 645f 6970 7074 7328 2929 0a0a  .read_ippts())..
-00010450: 2020 2020 6173 796e 6320 6465 6620 7465      async def te
-00010460: 7374 5f72 6561 645f 7261 7469 6f6e 616c  st_read_rational
-00010470: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-00010480: 7465 7374 5f66 7261 6374 696f 6e20 3d20  test_fraction = 
-00010490: 4672 6163 7469 6f6e 2834 2c20 3329 0a20  Fraction(4, 3). 
-000104a0: 2020 2020 2020 2074 6573 745f 6461 7461         test_data
-000104b0: 203d 2062 225c 7830 345c 7830 305c 7830   = b"\x04\x00\x0
-000104c0: 305c 7830 305c 7830 335c 7830 305c 7830  0\x00\x03\x00\x0
-000104d0: 305c 7830 3022 0a0a 2020 2020 2020 2020  0\x00"..        
-000104e0: 6173 796e 6320 7769 7468 2041 7379 6e63  async with Async
-000104f0: 4279 7465 7349 4f28 7465 7374 5f64 6174  BytesIO(test_dat
-00010500: 6129 2061 7320 6670 3a0a 2020 2020 2020  a) as fp:.      
-00010510: 2020 2020 2020 5555 5420 3d20 4173 796e        UUT = Asyn
-00010520: 6347 5346 426c 6f63 6b28 6670 290a 0a20  cGSFBlock(fp).. 
-00010530: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00010540: 6173 7365 7274 4571 7561 6c28 7465 7374  assertEqual(test
-00010550: 5f66 7261 6374 696f 6e2c 2061 7761 6974  _fraction, await
-00010560: 2055 5554 2e72 6561 645f 7261 7469 6f6e   UUT.read_ration
-00010570: 616c 2829 290a 0a20 2020 2061 7379 6e63  al())..    async
-00010580: 2064 6566 2074 6573 745f 7265 6164 5f72   def test_read_r
-00010590: 6174 696f 6e61 6c5f 7a65 726f 5f64 656e  ational_zero_den
-000105a0: 6f6d 696e 6174 6f72 2873 656c 6629 3a0a  ominator(self):.
-000105b0: 2020 2020 2020 2020 2222 2245 6e73 7572          """Ensur
-000105c0: 6520 7468 6520 7265 6164 6572 2063 6f6e  e the reader con
-000105d0: 7369 6465 7273 2061 2052 6174 696f 6e61  siders a Rationa
-000105e0: 6c20 7769 7468 207a 6572 6f20 6465 6e6f  l with zero deno
-000105f0: 6d69 6e61 746f 7220 746f 2062 6520 302c  minator to be 0,
-00010600: 206e 6f74 2061 6e20 6572 726f 7222 2222   not an error"""
-00010610: 0a20 2020 2020 2020 2074 6573 745f 6461  .        test_da
-00010620: 7461 203d 2062 225c 7830 345c 7830 305c  ta = b"\x04\x00\
-00010630: 7830 305c 7830 305c 7830 305c 7830 305c  x00\x00\x00\x00\
-00010640: 7830 305c 7830 3022 0a0a 2020 2020 2020  x00\x00"..      
-00010650: 2020 6173 796e 6320 7769 7468 2041 7379    async with Asy
-00010660: 6e63 4279 7465 7349 4f28 7465 7374 5f64  ncBytesIO(test_d
-00010670: 6174 6129 2061 7320 6670 3a0a 2020 2020  ata) as fp:.    
-00010680: 2020 2020 2020 2020 5555 5420 3d20 4173          UUT = As
-00010690: 796e 6347 5346 426c 6f63 6b28 6670 290a  yncGSFBlock(fp).
-000106a0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-000106b0: 662e 6173 7365 7274 4571 7561 6c28 4672  f.assertEqual(Fr
-000106c0: 6163 7469 6f6e 2830 292c 2061 7761 6974  action(0), await
-000106d0: 2055 5554 2e72 6561 645f 7261 7469 6f6e   UUT.read_ration
-000106e0: 616c 2829 290a 0a20 2020 2061 7379 6e63  al())..    async
-000106f0: 2064 6566 2074 6573 745f 7265 6164 5f75   def test_read_u
-00010700: 696e 745f 7061 7374 5f65 6f66 2873 656c  int_past_eof(sel
-00010710: 6629 3a0a 2020 2020 2020 2020 2222 2272  f):.        """r
-00010720: 6561 645f 7569 6e74 2063 616c 6c73 2072  ead_uint calls r
-00010730: 6561 6428 2920 6469 7265 6374 6c79 202d  ead() directly -
-00010740: 2074 6573 7420 6974 2072 6169 7365 7320   test it raises 
-00010750: 454f 4645 7272 6f72 2063 6f72 7265 6374  EOFError correct
-00010760: 6c79 2222 220a 2020 2020 2020 2020 7465  ly""".        te
-00010770: 7374 5f64 6174 6120 3d20 6222 5c78 3034  st_data = b"\x04
-00010780: 5c78 3030 220a 0a20 2020 2020 2020 2061  \x00"..        a
-00010790: 7379 6e63 2077 6974 6820 4173 796e 6342  sync with AsyncB
-000107a0: 7974 6573 494f 2874 6573 745f 6461 7461  ytesIO(test_data
-000107b0: 2920 6173 2066 703a 0a20 2020 2020 2020  ) as fp:.       
-000107c0: 2020 2020 2055 5554 203d 2041 7379 6e63       UUT = Async
-000107d0: 4753 4642 6c6f 636b 2866 7029 0a0a 2020  GSFBlock(fp)..  
-000107e0: 2020 2020 2020 2020 2020 7769 7468 2073            with s
-000107f0: 656c 662e 6173 7365 7274 5261 6973 6573  elf.assertRaises
-00010800: 2845 4f46 4572 726f 7229 3a0a 2020 2020  (EOFError):.    
-00010810: 2020 2020 2020 2020 2020 2020 6177 6169              awai
-00010820: 7420 5555 542e 7265 6164 5f75 696e 7428  t UUT.read_uint(
-00010830: 3429 0a0a 2020 2020 6173 796e 6320 6465  4)..    async de
-00010840: 6620 7465 7374 5f72 6561 645f 7374 7269  f test_read_stri
-00010850: 6e67 5f70 6173 745f 656f 6628 7365 6c66  ng_past_eof(self
-00010860: 293a 0a20 2020 2020 2020 2022 2222 7265  ):.        """re
-00010870: 6164 5f73 7472 696e 6728 2920 6361 6c6c  ad_string() call
-00010880: 7320 7265 6164 2829 2064 6972 6563 746c  s read() directl
-00010890: 7920 2d20 7465 7374 2069 7420 7261 6973  y - test it rais
-000108a0: 6573 2045 4f46 4572 726f 7220 636f 7272  es EOFError corr
-000108b0: 6563 746c 7922 2222 0a20 2020 2020 2020  ectly""".       
-000108c0: 2074 6573 745f 6461 7461 203d 2062 2253   test_data = b"S
-000108d0: 7472 696e 220a 0a20 2020 2020 2020 2061  trin"..        a
-000108e0: 7379 6e63 2077 6974 6820 4173 796e 6342  sync with AsyncB
-000108f0: 7974 6573 494f 2874 6573 745f 6461 7461  ytesIO(test_data
-00010900: 2920 6173 2066 703a 0a20 2020 2020 2020  ) as fp:.       
-00010910: 2020 2020 2055 5554 203d 2041 7379 6e63       UUT = Async
-00010920: 4753 4642 6c6f 636b 2866 7029 0a0a 2020  GSFBlock(fp)..  
-00010930: 2020 2020 2020 2020 2020 7769 7468 2073            with s
-00010940: 656c 662e 6173 7365 7274 5261 6973 6573  elf.assertRaises
-00010950: 2845 4f46 4572 726f 7229 3a0a 2020 2020  (EOFError):.    
-00010960: 2020 2020 2020 2020 2020 2020 6177 6169              awai
-00010970: 7420 5555 542e 7265 6164 5f73 7472 696e  t UUT.read_strin
-00010980: 6728 3629 0a0a 2020 2020 6173 796e 6320  g(6)..    async 
-00010990: 6465 6620 7465 7374 5f72 6561 645f 7575  def test_read_uu
-000109a0: 6964 5f70 6173 745f 656f 6628 7365 6c66  id_past_eof(self
-000109b0: 293a 0a20 2020 2020 2020 2022 2222 7265  ):.        """re
-000109c0: 6164 5f75 7569 6428 2920 6361 6c6c 7320  ad_uuid() calls 
-000109d0: 7265 6164 2829 2064 6972 6563 746c 7920  read() directly 
-000109e0: 2d20 7465 7374 2069 7420 7261 6973 6573  - test it raises
-000109f0: 2045 4f46 4572 726f 7220 636f 7272 6563   EOFError correc
-00010a00: 746c 7922 2222 0a20 2020 2020 2020 2074  tly""".        t
-00010a10: 6573 745f 6461 7461 203d 2062 225c 7862  est_data = b"\xb
-00010a20: 305c 7836 635c 7836 355c 7863 385c 7835  0\x6c\x65\xc8\x5
-00010a30: 315c 7861 635c 7834 615c 7864 315c 7861  1\xac\x4a\xd1\xa
-00010a40: 385c 7833 395c 7832 6522 0a0a 2020 2020  8\x39\x2e"..    
-00010a50: 2020 2020 6173 796e 6320 7769 7468 2041      async with A
-00010a60: 7379 6e63 4279 7465 7349 4f28 7465 7374  syncBytesIO(test
-00010a70: 5f64 6174 6129 2061 7320 6670 3a0a 2020  _data) as fp:.  
-00010a80: 2020 2020 2020 2020 2020 5555 5420 3d20            UUT = 
-00010a90: 4173 796e 6347 5346 426c 6f63 6b28 6670  AsyncGSFBlock(fp
-00010aa0: 290a 0a20 2020 2020 2020 2020 2020 2077  )..            w
-00010ab0: 6974 6820 7365 6c66 2e61 7373 6572 7452  ith self.assertR
-00010ac0: 6169 7365 7328 454f 4645 7272 6f72 293a  aises(EOFError):
-00010ad0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00010ae0: 2061 7761 6974 2055 5554 2e72 6561 645f   await UUT.read_
-00010af0: 7575 6964 2829 0a0a 2020 2020 6465 6620  uuid()..    def 
-00010b00: 5f6d 616b 655f 7361 6d70 6c65 5f73 7472  _make_sample_str
-00010b10: 6561 6d28 7365 6c66 2c20 706f 7374 5f63  eam(self, post_c
-00010b20: 6869 6c64 5f6c 656e 3d30 293a 0a20 2020  hild_len=0):.   
-00010b30: 2020 2020 2022 2222 4765 6e65 7261 7465       """Generate
-00010b40: 2061 2073 7472 6561 6d20 6f66 2073 616d   a stream of sam
-00010b50: 706c 6520 626c 6f63 6b73 2066 6f72 2074  ple blocks for t
-00010b60: 6573 7469 6e67 2074 6865 2063 6f6e 7465  esting the conte
-00010b70: 7874 206d 616e 6167 6572 0a0a 2020 2020  xt manager..    
-00010b80: 2020 2020 5374 7275 6374 7572 6520 6c6f      Structure lo
-00010b90: 6f6b 7320 6c69 6b65 3a0a 2020 2020 2020  oks like:.      
-00010ba0: 2020 626c 6f6b 2028 3238 2062 7974 6573    blok (28 bytes
-00010bb0: 202b 2070 6f73 745f 6368 696c 645f 6c65   + post_child_le
-00010bc0: 6e29 0a20 2020 2020 2020 2020 2063 6869  n).          chi
-00010bd0: 6c20 2831 3220 6279 7465 7329 0a20 2020  l (12 bytes).   
-00010be0: 2020 2020 2020 2063 6869 6c20 2838 2062         chil (8 b
-00010bf0: 7974 6573 290a 2020 2020 2020 2020 2020  ytes).          
-00010c00: 6070 6f73 745f 6368 696c 645f 6c65 6e60  `post_child_len`
-00010c10: 2061 6464 6974 696f 6e61 6c20 6279 7465   additional byte
-00010c20: 7320 6f66 2064 6174 610a 2020 2020 2020  s of data.      
-00010c30: 2020 626c 6f6b 2028 3820 6279 7465 7329    blok (8 bytes)
-00010c40: 0a0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
-00010c50: 2070 6f73 745f 6368 696c 645f 6c65 6e3a   post_child_len:
-00010c60: 204e 756d 6265 7220 6f66 2062 7974 6573   Number of bytes
-00010c70: 2074 6f20 696e 636c 7564 6520 6166 7465   to include afte
-00010c80: 7220 6c61 7374 2063 6869 6c64 2062 6c6f  r last child blo
-00010c90: 636b 202d 206d 7573 7420 6265 203c 3235  ck - must be <25
-00010ca0: 360a 2020 2020 2020 2020 3a72 6574 7572  6.        :retur
-00010cb0: 6e73 3a20 4173 796e 6342 7974 6573 494f  ns: AsyncBytesIO
-00010cc0: 2063 6f6e 7461 696e 696e 6720 736f 6d65   containing some
-00010cd0: 2062 6c6f 636b 730a 2020 2020 2020 2020   blocks.        
-00010ce0: 2222 220a 2020 2020 2020 2020 6669 7273  """.        firs
-00010cf0: 745f 626c 6f63 6b5f 6c65 6e67 7468 203d  t_block_length =
-00010d00: 2032 3820 2b20 706f 7374 5f63 6869 6c64   28 + post_child
-00010d10: 5f6c 656e 0a20 2020 2020 2020 2074 6573  _len.        tes
-00010d20: 745f 7374 7265 616d 203d 2042 7974 6573  t_stream = Bytes
-00010d30: 494f 2829 0a0a 2020 2020 2020 2020 7465  IO()..        te
-00010d40: 7374 5f73 7472 6561 6d2e 7772 6974 6528  st_stream.write(
-00010d50: 6222 626c 6f6b 2229 0a20 2020 2020 2020  b"blok").       
-00010d60: 2074 6573 745f 7374 7265 616d 2e77 7269   test_stream.wri
-00010d70: 7465 2862 7974 6573 2828 6669 7273 745f  te(bytes((first_
-00010d80: 626c 6f63 6b5f 6c65 6e67 7468 2c29 2929  block_length,)))
-00010d90: 0a20 2020 2020 2020 2074 6573 745f 7374  .        test_st
-00010da0: 7265 616d 2e77 7269 7465 2862 225c 7830  ream.write(b"\x0
-00010db0: 305c 7830 305c 7830 3022 290a 2020 2020  0\x00\x00").    
-00010dc0: 2020 2020 7465 7374 5f73 7472 6561 6d2e      test_stream.
-00010dd0: 7772 6974 6528 6222 6368 696c 5c78 3063  write(b"chil\x0c
-00010de0: 5c78 3030 5c78 3030 5c78 3030 5c78 3038  \x00\x00\x00\x08
-00010df0: 5c78 3039 5c78 3061 5c78 3062 2229 0a20  \x09\x0a\x0b"). 
-00010e00: 2020 2020 2020 2074 6573 745f 7374 7265         test_stre
-00010e10: 616d 2e77 7269 7465 2862 2263 6869 6c5c  am.write(b"chil\
-00010e20: 7830 385c 7830 305c 7830 305c 7830 3022  x08\x00\x00\x00"
-00010e30: 290a 0a20 2020 2020 2020 2066 6f72 2069  )..        for i
-00010e40: 2069 6e20 7261 6e67 6528 302c 2070 6f73   in range(0, pos
-00010e50: 745f 6368 696c 645f 6c65 6e29 3a0a 2020  t_child_len):.  
-00010e60: 2020 2020 2020 2020 2020 7465 7374 5f73            test_s
-00010e70: 7472 6561 6d2e 7772 6974 6528 6222 5c78  tream.write(b"\x
-00010e80: 3432 2229 0a0a 2020 2020 2020 2020 7465  42")..        te
-00010e90: 7374 5f73 7472 6561 6d2e 7772 6974 6528  st_stream.write(
-00010ea0: 6222 626c 6b32 5c78 3038 5c78 3030 5c78  b"blk2\x08\x00\x
-00010eb0: 3030 5c78 3030 2229 0a0a 2020 2020 2020  00\x00")..      
-00010ec0: 2020 7465 7374 5f73 7472 6561 6d2e 7365    test_stream.se
-00010ed0: 656b 2830 2c20 5345 454b 5f53 4554 290a  ek(0, SEEK_SET).
-00010ee0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00010ef0: 4173 796e 6342 7974 6573 494f 2874 6573  AsyncBytesIO(tes
-00010f00: 745f 7374 7265 616d 2e67 6574 7661 6c75  t_stream.getvalu
-00010f10: 6528 2929 0a0a 2020 2020 6173 796e 6320  e())..    async 
-00010f20: 6465 6620 7465 7374 5f62 6c6f 636b 5f73  def test_block_s
-00010f30: 7461 7274 5f72 6563 6f72 6465 6428 7365  tart_recorded(se
-00010f40: 6c66 293a 0a20 2020 2020 2020 2022 2222  lf):.        """
-00010f50: 5465 7374 2074 6861 7420 6120 4173 796e  Test that a Asyn
-00010f60: 6347 5346 426c 6f63 6b20 7265 636f 7264  cGSFBlock record
-00010f70: 7320 7468 6520 626c 6f63 6b20 7374 6172  s the block star
-00010f80: 7420 706f 696e 7422 2222 0a20 2020 2020  t point""".     
-00010f90: 2020 2061 7379 6e63 2077 6974 6820 7365     async with se
-00010fa0: 6c66 2e5f 6d61 6b65 5f73 616d 706c 655f  lf._make_sample_
-00010fb0: 7374 7265 616d 2829 2061 7320 7465 7374  stream() as test
-00010fc0: 5f73 7472 6561 6d3a 0a20 2020 2020 2020  _stream:.       
-00010fd0: 2020 2020 2074 6573 745f 7374 7265 616d       test_stream
-00010fe0: 2e73 6565 6b28 3238 2c20 5345 454b 5f53  .seek(28, SEEK_S
-00010ff0: 4554 290a 0a20 2020 2020 2020 2020 2020  ET)..           
-00011000: 2055 5554 203d 2041 7379 6e63 4753 4642   UUT = AsyncGSFB
-00011010: 6c6f 636b 2874 6573 745f 7374 7265 616d  lock(test_stream
-00011020: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
-00011030: 6c66 2e61 7373 6572 7445 7175 616c 2832  lf.assertEqual(2
-00011040: 382c 2055 5554 2e62 6c6f 636b 5f73 7461  8, UUT.block_sta
-00011050: 7274 290a 0a20 2020 2061 7379 6e63 2064  rt)..    async d
-00011060: 6566 2074 6573 745f 636f 6e74 6578 746d  ef test_contextm
-00011070: 616e 6167 6572 5f72 6561 645f 7461 675f  anager_read_tag_
-00011080: 7369 7a65 2873 656c 6629 3a0a 2020 2020  size(self):.    
-00011090: 2020 2020 2222 2254 6573 7420 7468 6174      """Test that
-000110a0: 2074 6865 2062 6c6f 636b 2074 6167 2061   the block tag a
-000110b0: 6e64 2073 697a 6520 6172 6520 7265 6164  nd size are read
-000110c0: 2077 6865 6e20 7573 6564 2069 6e20 6120   when used in a 
-000110d0: 636f 6e74 6578 7420 6d61 6e61 6765 7222  context manager"
-000110e0: 2222 0a20 2020 2020 2020 2061 7379 6e63  "".        async
-000110f0: 2077 6974 6820 7365 6c66 2e5f 6d61 6b65   with self._make
-00011100: 5f73 616d 706c 655f 7374 7265 616d 2829  _sample_stream()
-00011110: 2061 7320 7465 7374 5f73 7472 6561 6d3a   as test_stream:
-00011120: 0a20 2020 2020 2020 2020 2020 2061 7379  .            asy
-00011130: 6e63 2077 6974 6820 4173 796e 6347 5346  nc with AsyncGSF
-00011140: 426c 6f63 6b28 7465 7374 5f73 7472 6561  Block(test_strea
-00011150: 6d29 2061 7320 5555 543a 0a20 2020 2020  m) as UUT:.     
-00011160: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00011170: 6173 7365 7274 4571 7561 6c28 2262 6c6f  assertEqual("blo
-00011180: 6b22 2c20 5555 542e 7461 6729 0a20 2020  k", UUT.tag).   
-00011190: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-000111a0: 662e 6173 7365 7274 4571 7561 6c28 3238  f.assertEqual(28
-000111b0: 2c20 5555 542e 7369 7a65 290a 0a20 2020  , UUT.size)..   
-000111c0: 2061 7379 6e63 2064 6566 2074 6573 745f   async def test_
-000111d0: 636f 6e74 6578 746d 616e 6167 6572 5f73  contextmanager_s
-000111e0: 6b69 7073 5f75 6e77 616e 7465 645f 626c  kips_unwanted_bl
-000111f0: 6f63 6b73 2873 656c 6629 3a0a 2020 2020  ocks(self):.    
-00011200: 2020 2020 2222 2254 6573 7420 7468 6174      """Test that
-00011210: 2041 7379 6e63 4753 4642 6c6f 636b 2829   AsyncGSFBlock()
-00011220: 2073 6565 6b73 206f 7665 7220 756e 7761   seeks over unwa
-00011230: 6e74 6564 2062 6c6f 636b 7322 2222 0a20  nted blocks""". 
-00011240: 2020 2020 2020 2061 7379 6e63 2077 6974         async wit
-00011250: 6820 7365 6c66 2e5f 6d61 6b65 5f73 616d  h self._make_sam
-00011260: 706c 655f 7374 7265 616d 2829 2061 7320  ple_stream() as 
-00011270: 7465 7374 5f73 7472 6561 6d3a 0a20 2020  test_stream:.   
-00011280: 2020 2020 2020 2020 2061 7379 6e63 2077           async w
-00011290: 6974 6820 4173 796e 6347 5346 426c 6f63  ith AsyncGSFBloc
-000112a0: 6b28 7465 7374 5f73 7472 6561 6d2c 2077  k(test_stream, w
-000112b0: 616e 745f 7461 673d 2262 6c6b 3222 2920  ant_tag="blk2") 
-000112c0: 6173 2055 5554 3a0a 2020 2020 2020 2020  as UUT:.        
-000112d0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-000112e0: 6572 7445 7175 616c 2822 626c 6b32 222c  ertEqual("blk2",
-000112f0: 2055 5554 2e74 6167 290a 0a20 2020 2020   UUT.tag)..     
-00011300: 2020 2020 2020 2020 2020 2023 2062 6c6f             # blo
-00011310: 6b20 6973 2032 3820 6279 7465 7320 6c6f  k is 28 bytes lo
-00011320: 6e67 2c20 7765 2073 686f 756c 6420 736b  ng, we should sk
-00011330: 6970 2069 742c 2070 6c75 7320 3820 6279  ip it, plus 8 by
-00011340: 7465 7320 6f66 2062 6c6b 320a 2020 2020  tes of blk2.    
-00011350: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00011360: 2e61 7373 6572 7445 7175 616c 2832 3820  .assertEqual(28 
-00011370: 2b20 382c 2074 6573 745f 7374 7265 616d  + 8, test_stream
-00011380: 2e74 656c 6c28 2929 0a0a 2020 2020 6173  .tell())..    as
-00011390: 796e 6320 6465 6620 7465 7374 5f63 6f6e  ync def test_con
-000113a0: 7465 7874 6d61 6e61 6765 725f 6572 726f  textmanager_erro
-000113b0: 7273 5f75 6e77 616e 7465 645f 626c 6f63  rs_unwanted_bloc
-000113c0: 6b73 2873 656c 6629 3a0a 2020 2020 2020  ks(self):.      
-000113d0: 2020 2222 2254 6573 7420 7468 6174 2041    """Test that A
-000113e0: 7379 6e63 4753 4642 6c6f 636b 2829 2072  syncGSFBlock() r
-000113f0: 6169 7365 7320 4753 4644 6563 6f64 6545  aises GSFDecodeE
-00011400: 7272 6f72 2077 6865 6e20 6669 6e64 696e  rror when findin
-00011410: 6720 616e 2075 6e77 616e 7465 6420 626c  g an unwanted bl
-00011420: 6f63 6b22 2222 0a20 2020 2020 2020 2061  ock""".        a
-00011430: 7379 6e63 2077 6974 6820 7365 6c66 2e5f  sync with self._
-00011440: 6d61 6b65 5f73 616d 706c 655f 7374 7265  make_sample_stre
-00011450: 616d 2829 2061 7320 7465 7374 5f73 7472  am() as test_str
-00011460: 6561 6d3a 0a20 2020 2020 2020 2020 2020  eam:.           
-00011470: 2077 6974 6820 7365 6c66 2e61 7373 6572   with self.asser
-00011480: 7452 6169 7365 7328 4753 4644 6563 6f64  tRaises(GSFDecod
-00011490: 6545 7272 6f72 293a 0a20 2020 2020 2020  eError):.       
-000114a0: 2020 2020 2020 2020 2061 7379 6e63 2077           async w
-000114b0: 6974 6820 4173 796e 6347 5346 426c 6f63  ith AsyncGSFBloc
-000114c0: 6b28 7465 7374 5f73 7472 6561 6d2c 2077  k(test_stream, w
-000114d0: 616e 745f 7461 673d 2263 6869 6c22 2c20  ant_tag="chil", 
-000114e0: 7261 6973 655f 6f6e 5f77 726f 6e67 5f74  raise_on_wrong_t
-000114f0: 6167 3d54 7275 6529 3a0a 2020 2020 2020  ag=True):.      
-00011500: 2020 2020 2020 2020 2020 2020 2020 7061                pa
-00011510: 7373 0a0a 2020 2020 6173 796e 6320 6465  ss..    async de
-00011520: 6620 7465 7374 5f63 6f6e 7465 7874 6d61  f test_contextma
-00011530: 6e61 6765 725f 7365 656b 735f 6f6e 5f65  nager_seeks_on_e
-00011540: 7869 7428 7365 6c66 293a 0a20 2020 2020  xit(self):.     
-00011550: 2020 2022 2222 5465 7374 2074 6861 7420     """Test that 
-00011560: 7468 6520 636f 6e74 6578 7420 6d61 6e61  the context mana
-00011570: 6765 7220 7365 656b 7320 746f 2074 6865  ger seeks to the
-00011580: 2065 6e64 206f 6620 6120 626c 6f63 6b20   end of a block 
-00011590: 6f6e 2065 7869 7422 2222 0a20 2020 2020  on exit""".     
-000115a0: 2020 2061 7379 6e63 2077 6974 6820 7365     async with se
-000115b0: 6c66 2e5f 6d61 6b65 5f73 616d 706c 655f  lf._make_sample_
-000115c0: 7374 7265 616d 2829 2061 7320 7465 7374  stream() as test
-000115d0: 5f73 7472 6561 6d3a 0a20 2020 2020 2020  _stream:.       
-000115e0: 2020 2020 2061 7379 6e63 2077 6974 6820       async with 
-000115f0: 4173 796e 6347 5346 426c 6f63 6b28 7465  AsyncGSFBlock(te
-00011600: 7374 5f73 7472 6561 6d29 3a0a 2020 2020  st_stream):.    
-00011610: 2020 2020 2020 2020 2020 2020 7061 7373              pass
-00011620: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
-00011630: 4669 7273 7420 626c 6f63 6b20 6973 2032  First block is 2
-00011640: 3820 6279 7465 7320 6c6f 6e67 2c20 736f  8 bytes long, so
-00011650: 2077 6520 7368 6f75 6c64 2062 6520 7a65   we should be ze
-00011660: 726f 2d69 6e64 6578 2070 6f73 6974 696f  ro-index positio
-00011670: 6e20 3238 2061 6674 6572 7761 7264 730a  n 28 afterwards.
-00011680: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00011690: 2e61 7373 6572 7445 7175 616c 2832 382c  .assertEqual(28,
-000116a0: 2074 6573 745f 7374 7265 616d 2e74 656c   test_stream.tel
-000116b0: 6c28 2929 0a0a 2020 2020 6173 796e 6320  l())..    async 
-000116c0: 6465 6620 7465 7374 5f63 6f6e 7465 7874  def test_context
-000116d0: 6d61 6e61 6765 725f 6765 745f 7265 6d61  manager_get_rema
-000116e0: 696e 696e 6728 7365 6c66 293a 0a20 2020  ining(self):.   
-000116f0: 2020 2020 2022 2222 5465 7374 2074 6865       """Test the
-00011700: 2063 6f6e 7465 7874 206d 616e 6167 6572   context manager
-00011710: 2067 6574 7320 7468 6520 6e75 6d62 6572   gets the number
-00011720: 206f 6620 6279 7465 7320 6c65 6674 2069   of bytes left i
-00011730: 6e20 7468 6520 626c 6f63 6b20 636f 7272  n the block corr
-00011740: 6563 746c 7922 2222 0a20 2020 2020 2020  ectly""".       
-00011750: 2061 7379 6e63 2077 6974 6820 7365 6c66   async with self
-00011760: 2e5f 6d61 6b65 5f73 616d 706c 655f 7374  ._make_sample_st
-00011770: 7265 616d 2829 2061 7320 7465 7374 5f73  ream() as test_s
-00011780: 7472 6561 6d3a 0a20 2020 2020 2020 2020  tream:.         
-00011790: 2020 2061 7379 6e63 2077 6974 6820 4173     async with As
-000117a0: 796e 6347 5346 426c 6f63 6b28 7465 7374  yncGSFBlock(test
-000117b0: 5f73 7472 6561 6d29 2061 7320 5555 543a  _stream) as UUT:
-000117c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000117d0: 2061 7761 6974 2055 5554 2e72 6561 645f   await UUT.read_
-000117e0: 7569 6e74 2834 2920 2023 2055 7365 2061  uint(4)  # Use a
-000117f0: 2072 6561 6420 746f 2073 6b69 7020 6168   read to skip ah
-00011800: 6561 6420 6120 6269 740a 2020 2020 2020  ead a bit.      
-00011810: 2020 2020 2020 2020 2020 2320 426c 6f63            # Bloc
-00011820: 6b20 7761 7320 3238 2062 7974 6573 2c20  k was 28 bytes, 
-00011830: 3820 6279 7465 7320 6865 6164 6572 2c20  8 bytes header, 
-00011840: 3420 6279 7465 7320 7265 6164 5f75 696e  4 bytes read_uin
-00011850: 740a 2020 2020 2020 2020 2020 2020 2020  t.              
-00011860: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-00011870: 616c 2832 3820 2d20 3820 2d20 342c 2055  al(28 - 8 - 4, U
-00011880: 5554 2e67 6574 5f72 656d 6169 6e69 6e67  UT.get_remaining
-00011890: 2829 290a 0a20 2020 2061 7379 6e63 2064  ())..    async d
-000118a0: 6566 2074 6573 745f 636f 6e74 6578 746d  ef test_contextm
-000118b0: 616e 6167 6572 5f68 6173 5f63 6869 6c64  anager_has_child
-000118c0: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-000118d0: 2222 2254 6573 7420 7468 6520 636f 6e74  """Test the cont
-000118e0: 6578 7420 6d61 6e61 6765 7220 6465 7465  ext manager dete
-000118f0: 6374 7320 7768 6574 6865 7220 616e 6f74  cts whether anot
-00011900: 6865 7220 6368 696c 6420 6973 2070 7265  her child is pre
-00011910: 7365 6e74 2063 6f72 7265 6374 6c79 2222  sent correctly""
-00011920: 220a 2020 2020 2020 2020 6173 796e 6320  ".        async 
-00011930: 7769 7468 2073 656c 662e 5f6d 616b 655f  with self._make_
-00011940: 7361 6d70 6c65 5f73 7472 6561 6d28 2920  sample_stream() 
-00011950: 6173 2074 6573 745f 7374 7265 616d 3a0a  as test_stream:.
-00011960: 2020 2020 2020 2020 2020 2020 6173 796e              asyn
-00011970: 6320 7769 7468 2041 7379 6e63 4753 4642  c with AsyncGSFB
-00011980: 6c6f 636b 2874 6573 745f 7374 7265 616d  lock(test_stream
-00011990: 2920 6173 2055 5554 3a0a 2020 2020 2020  ) as UUT:.      
-000119a0: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-000119b0: 7373 6572 7454 7275 6528 5555 542e 6861  ssertTrue(UUT.ha
-000119c0: 735f 6368 696c 645f 626c 6f63 6b28 2929  s_child_block())
-000119d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000119e0: 2061 7761 6974 2074 6573 745f 7374 7265   await test_stre
-000119f0: 616d 2e72 6561 6428 3132 290a 2020 2020  am.read(12).    
-00011a00: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00011a10: 2e61 7373 6572 7454 7275 6528 5555 542e  .assertTrue(UUT.
-00011a20: 6861 735f 6368 696c 645f 626c 6f63 6b28  has_child_block(
-00011a30: 2929 0a20 2020 2020 2020 2020 2020 2020  )).             
-00011a40: 2020 2061 7761 6974 2074 6573 745f 7374     await test_st
-00011a50: 7265 616d 2e72 6561 6428 3829 0a20 2020  ream.read(8).   
-00011a60: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00011a70: 662e 6173 7365 7274 4661 6c73 6528 5555  f.assertFalse(UU
-00011a80: 542e 6861 735f 6368 696c 645f 626c 6f63  T.has_child_bloc
-00011a90: 6b28 2929 0a0a 2020 2020 6173 796e 6320  k())..    async 
-00011aa0: 6465 6620 7465 7374 5f63 6f6e 7465 7874  def test_context
-00011ab0: 6d61 6e61 6765 725f 6861 735f 6368 696c  manager_has_chil
-00011ac0: 645f 7374 7269 6374 5f62 6c6f 636b 7328  d_strict_blocks(
-00011ad0: 7365 6c66 293a 0a20 2020 2020 2020 2022  self):.        "
-00011ae0: 2222 456e 7375 7265 2074 6861 7420 7768  ""Ensure that wh
-00011af0: 656e 2073 7472 6963 7420 6d6f 6465 2069  en strict mode i
-00011b00: 7320 656e 6162 6c65 642c 2068 6173 5f63  s enabled, has_c
-00011b10: 6869 6c64 2065 7272 6f72 7320 6f6e 2070  hild errors on p
-00011b20: 6172 7469 616c 2062 6c6f 636b 7322 2222  artial blocks"""
-00011b30: 0a20 2020 2020 2020 2061 7379 6e63 2077  .        async w
-00011b40: 6974 6820 7365 6c66 2e5f 6d61 6b65 5f73  ith self._make_s
-00011b50: 616d 706c 655f 7374 7265 616d 2870 6f73  ample_stream(pos
-00011b60: 745f 6368 696c 645f 6c65 6e3d 3429 2061  t_child_len=4) a
-00011b70: 7320 7465 7374 5f73 7472 6561 6d3a 0a20  s test_stream:. 
-00011b80: 2020 2020 2020 2020 2020 2061 7379 6e63             async
-00011b90: 2077 6974 6820 4173 796e 6347 5346 426c   with AsyncGSFBl
-00011ba0: 6f63 6b28 7465 7374 5f73 7472 6561 6d29  ock(test_stream)
-00011bb0: 2061 7320 5555 543a 0a20 2020 2020 2020   as UUT:.       
-00011bc0: 2020 2020 2020 2020 2061 7761 6974 2074           await t
-00011bd0: 6573 745f 7374 7265 616d 2e72 6561 6428  est_stream.read(
-00011be0: 3132 202b 2038 2920 2023 2052 6561 6420  12 + 8)  # Read 
-00011bf0: 746f 2074 6865 2065 6e64 206f 6620 7468  to the end of th
-00011c00: 6520 6368 696c 6420 626c 6f63 6b73 0a0a  e child blocks..
-00011c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011c20: 7769 7468 2073 656c 662e 6173 7365 7274  with self.assert
-00011c30: 5261 6973 6573 2847 5346 4465 636f 6465  Raises(GSFDecode
-00011c40: 4572 726f 7229 3a0a 2020 2020 2020 2020  Error):.        
-00011c50: 2020 2020 2020 2020 2020 2020 5555 542e              UUT.
-00011c60: 6861 735f 6368 696c 645f 626c 6f63 6b28  has_child_block(
-00011c70: 7374 7269 6374 5f62 6c6f 636b 733d 5472  strict_blocks=Tr
-00011c80: 7565 290a 0a20 2020 2061 7379 6e63 2064  ue)..    async d
-00011c90: 6566 2074 6573 745f 636f 6e74 6578 746d  ef test_contextm
-00011ca0: 616e 6167 6572 5f68 6173 5f63 6869 6c64  anager_has_child
-00011cb0: 5f6e 6f5f 7374 7269 6374 5f62 6c6f 636b  _no_strict_block
-00011cc0: 7328 7365 6c66 293a 0a20 2020 2020 2020  s(self):.       
-00011cd0: 2022 2222 456e 7375 7265 2074 6861 7420   """Ensure that 
-00011ce0: 7768 656e 2073 7472 6963 7420 6d6f 6465  when strict mode
-00011cf0: 2069 7320 6f66 662c 2068 6173 5f63 6869   is off, has_chi
-00011d00: 6c64 2064 6f65 736e 2774 2065 7272 6f72  ld doesn't error
-00011d10: 206f 6e20 7061 7274 6961 6c20 626c 6f63   on partial bloc
-00011d20: 6b73 2222 220a 2020 2020 2020 2020 6173  ks""".        as
-00011d30: 796e 6320 7769 7468 2073 656c 662e 5f6d  ync with self._m
-00011d40: 616b 655f 7361 6d70 6c65 5f73 7472 6561  ake_sample_strea
-00011d50: 6d28 706f 7374 5f63 6869 6c64 5f6c 656e  m(post_child_len
-00011d60: 3d34 2920 6173 2074 6573 745f 7374 7265  =4) as test_stre
-00011d70: 616d 3a0a 2020 2020 2020 2020 2020 2020  am:.            
-00011d80: 6173 796e 6320 7769 7468 2041 7379 6e63  async with Async
-00011d90: 4753 4642 6c6f 636b 2874 6573 745f 7374  GSFBlock(test_st
-00011da0: 7265 616d 2920 6173 2055 5554 3a0a 2020  ream) as UUT:.  
-00011db0: 2020 2020 2020 2020 2020 2020 2020 6177                aw
-00011dc0: 6169 7420 7465 7374 5f73 7472 6561 6d2e  ait test_stream.
-00011dd0: 7265 6164 2831 3220 2b20 3829 2020 2320  read(12 + 8)  # 
-00011de0: 5265 6164 2074 6f20 7468 6520 656e 6420  Read to the end 
-00011df0: 6f66 2074 6865 2063 6869 6c64 2062 6c6f  of the child blo
-00011e00: 636b 730a 0a20 2020 2020 2020 2020 2020  cks..           
-00011e10: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00011e20: 4661 6c73 6528 5555 542e 6861 735f 6368  False(UUT.has_ch
-00011e30: 696c 645f 626c 6f63 6b28 7374 7269 6374  ild_block(strict
-00011e40: 5f62 6c6f 636b 733d 4661 6c73 6529 290a  _blocks=False)).
-00011e50: 0a20 2020 2061 7379 6e63 2064 6566 2074  .    async def t
-00011e60: 6573 745f 636f 6e74 6578 746d 616e 6167  est_contextmanag
-00011e70: 6572 5f63 6869 6c64 5f62 6c6f 636b 735f  er_child_blocks_
-00011e80: 6765 6e65 7261 746f 7228 7365 6c66 293a  generator(self):
-00011e90: 0a20 2020 2020 2020 2022 2222 456e 7375  .        """Ensu
-00011ea0: 7265 2074 6865 2063 6869 6c64 2062 6c6f  re the child blo
-00011eb0: 636b 7320 6765 6e65 7261 746f 7220 7265  cks generator re
-00011ec0: 7475 726e 7320 6120 626c 6f63 6b2c 2061  turns a block, a
-00011ed0: 6e64 2073 6565 6b73 2061 6674 6572 7761  nd seeks afterwa
-00011ee0: 7264 7322 2222 0a20 2020 2020 2020 2061  rds""".        a
-00011ef0: 7379 6e63 2077 6974 6820 7365 6c66 2e5f  sync with self._
-00011f00: 6d61 6b65 5f73 616d 706c 655f 7374 7265  make_sample_stre
-00011f10: 616d 2829 2061 7320 7465 7374 5f73 7472  am() as test_str
-00011f20: 6561 6d3a 0a20 2020 2020 2020 2020 2020  eam:.           
-00011f30: 2061 7379 6e63 2077 6974 6820 4173 796e   async with Asyn
-00011f40: 6347 5346 426c 6f63 6b28 7465 7374 5f73  cGSFBlock(test_s
-00011f50: 7472 6561 6d29 2061 7320 5555 543a 0a20  tream) as UUT:. 
-00011f60: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-00011f70: 6f6f 705f 636f 756e 7420 3d20 300a 2020  oop_count = 0.  
-00011f80: 2020 2020 2020 2020 2020 2020 2020 6368                ch
-00011f90: 696c 645f 6279 7465 735f 636f 6e73 756d  ild_bytes_consum
-00011fa0: 6564 203d 2030 0a20 2020 2020 2020 2020  ed = 0.         
-00011fb0: 2020 2020 2020 2061 7379 6e63 2066 6f72         async for
-00011fc0: 2062 6c6f 636b 2069 6e20 5555 542e 6368   block in UUT.ch
-00011fd0: 696c 645f 626c 6f63 6b73 2829 3a0a 2020  ild_blocks():.  
-00011fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011ff0: 2020 6368 696c 645f 6279 7465 735f 636f    child_bytes_co
-00012000: 6e73 756d 6564 202b 3d20 626c 6f63 6b2e  nsumed += block.
-00012010: 7369 7a65 0a20 2020 2020 2020 2020 2020  size.           
-00012020: 2020 2020 2020 2020 206c 6f6f 705f 636f           loop_co
-00012030: 756e 7420 2b3d 2031 0a0a 2020 2020 2020  unt += 1..      
-00012040: 2020 2020 2020 2020 2020 2320 4469 6420            # Did 
-00012050: 7765 2067 6574 2062 6f74 6820 6368 696c  we get both chil
-00012060: 6420 626c 6f63 6b73 3f0a 2020 2020 2020  d blocks?.      
-00012070: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-00012080: 7373 6572 7445 7175 616c 2832 2c20 6c6f  ssertEqual(2, lo
-00012090: 6f70 5f63 6f75 6e74 290a 0a20 2020 2020  op_count)..     
-000120a0: 2020 2020 2020 2020 2020 2023 2044 6964             # Did
-000120b0: 2077 6520 7365 656b 206f 6e20 6578 6974   we seek on exit
-000120c0: 2066 726f 6d20 6561 6368 206c 6f6f 7020   from each loop 
-000120d0: 6974 6572 6174 696f 6e0a 2020 2020 2020  iteration.      
-000120e0: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-000120f0: 7373 6572 7445 7175 616c 2863 6869 6c64  ssertEqual(child
-00012100: 5f62 7974 6573 5f63 6f6e 7375 6d65 6420  _bytes_consumed 
-00012110: 2b20 5555 542e 626c 6f63 6b5f 7374 6172  + UUT.block_star
-00012120: 7420 2b20 382c 2074 6573 745f 7374 7265  t + 8, test_stre
-00012130: 616d 2e74 656c 6c28 2929 0a0a 0a63 6c61  am.tell())...cla
-00012140: 7373 2054 6573 7447 5346 4465 636f 6465  ss TestGSFDecode
-00012150: 7228 4973 6f6c 6174 6564 4173 796e 6369  r(IsolatedAsynci
-00012160: 6f54 6573 7443 6173 6529 3a0a 2020 2020  oTestCase):.    
-00012170: 2222 2254 6573 7473 2066 6f72 2074 6865  """Tests for the
-00012180: 2047 5346 4465 636f 6465 7220 696e 2069   GSFDecoder in i
-00012190: 7473 206d 6f72 6520 6f62 6a65 6374 2d6f  ts more object-o
-000121a0: 7269 656e 7465 6420 6d6f 6465 0a0a 2020  riented mode..  
-000121b0: 2020 4e6f 7465 2074 6861 7420 7665 7279    Note that very
-000121c0: 206c 6974 746c 6520 7465 7374 696e 6720   little testing 
-000121d0: 6f66 2074 6865 2064 6563 6f64 6564 2064  of the decoded d
-000121e0: 6174 6120 6861 7070 656e 7320 6865 7265  ata happens here
-000121f0: 2c20 7468 6174 2773 2068 616e 646c 6564  , that's handled
-00012200: 2062 7920 5465 7374 4753 464c 6f61 6473   by TestGSFLoads
-00012210: 2829 0a20 2020 2022 2222 0a20 2020 2064  ().    """.    d
-00012220: 6566 2074 6573 745f 6465 636f 6465 5f68  ef test_decode_h
-00012230: 6561 6465 7273 2873 656c 6629 3a0a 2020  eaders(self):.  
-00012240: 2020 2020 2020 7669 6465 6f5f 6461 7461        video_data
-00012250: 5f73 7472 6561 6d20 3d20 4279 7465 7349  _stream = BytesI
-00012260: 4f28 5649 4445 4f5f 4441 5441 290a 0a20  O(VIDEO_DATA).. 
-00012270: 2020 2020 2020 2077 6974 6820 4753 4644         with GSFD
-00012280: 6563 6f64 6572 2866 696c 655f 6461 7461  ecoder(file_data
-00012290: 3d76 6964 656f 5f64 6174 615f 7374 7265  =video_data_stre
-000122a0: 616d 2920 6173 2064 6563 3a0a 2020 2020  am) as dec:.    
-000122b0: 2020 2020 2020 2020 6865 6164 203d 2064          head = d
-000122c0: 6563 2e66 696c 655f 6865 6164 6572 730a  ec.file_headers.
-000122d0: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-000122e0: 7365 7274 4571 7561 6c28 6865 6164 5b27  sertEqual(head['
-000122f0: 6372 6561 7465 6427 5d2c 2064 6174 6574  created'], datet
-00012300: 696d 6528 3230 3138 2c20 322c 2037 2c20  ime(2018, 2, 7, 
-00012310: 3130 2c20 3338 2c20 3232 2929 0a20 2020  10, 38, 22)).   
-00012320: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00012330: 4571 7561 6c28 6865 6164 5b27 6964 275d  Equal(head['id']
-00012340: 2c20 5555 4944 2827 3136 3366 6439 6237  , UUID('163fd9b7
-00012350: 2d62 6566 342d 3464 3932 2d38 3438 382d  -bef4-4d92-8488-
-00012360: 3331 6633 3831 3962 6530 3038 2729 290a  31f3819be008')).
-00012370: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-00012380: 6572 7445 7175 616c 286c 656e 2868 6561  ertEqual(len(hea
-00012390: 645b 2773 6567 6d65 6e74 7327 5d29 2c20  d['segments']), 
-000123a0: 3129 0a20 2020 2020 2020 2073 656c 662e  1).        self.
-000123b0: 6173 7365 7274 4571 7561 6c28 6865 6164  assertEqual(head
-000123c0: 5b27 7365 676d 656e 7473 275d 5b30 5d5b  ['segments'][0][
-000123d0: 2769 6427 5d2c 2055 5549 4428 2763 3661  'id'], UUID('c6a
-000123e0: 3364 3366 662d 3734 6330 2d34 3436 642d  3d3ff-74c0-446d-
-000123f0: 6235 3965 2d64 6531 3034 3166 3237 6538  b59e-de1041f27e8
-00012400: 6127 2929 0a0a 2020 2020 6465 6620 7465  a'))..    def te
-00012410: 7374 5f67 656e 6572 6174 655f 6772 6169  st_generate_grai
-00012420: 6e73 2873 656c 6629 3a0a 2020 2020 2020  ns(self):.      
-00012430: 2020 2222 2254 6573 7420 7468 6174 2074    """Test that t
-00012440: 6865 2067 656e 6572 6174 6f72 2079 6965  he generator yie
-00012450: 6c64 7320 6561 6368 2067 7261 696e 2222  lds each grain""
-00012460: 220a 2020 2020 2020 2020 7669 6465 6f5f  ".        video_
-00012470: 6461 7461 5f73 7472 6561 6d20 3d20 4279  data_stream = By
-00012480: 7465 7349 4f28 5649 4445 4f5f 4441 5441  tesIO(VIDEO_DATA
-00012490: 290a 0a20 2020 2020 2020 2077 6974 6820  )..        with 
-000124a0: 4753 4644 6563 6f64 6572 2866 696c 655f  GSFDecoder(file_
-000124b0: 6461 7461 3d76 6964 656f 5f64 6174 615f  data=video_data_
-000124c0: 7374 7265 616d 2920 6173 2064 6563 3a0a  stream) as dec:.
-000124d0: 2020 2020 2020 2020 2020 2020 6772 6169              grai
-000124e0: 6e5f 636f 756e 7420 3d20 300a 2020 2020  n_count = 0.    
-000124f0: 2020 2020 2020 2020 666f 7220 2867 7261          for (gra
-00012500: 696e 2c20 6c6f 6361 6c5f 6964 2920 696e  in, local_id) in
-00012510: 2064 6563 2e67 7261 696e 7328 293a 0a20   dec.grains():. 
-00012520: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00012530: 656c 662e 6173 7365 7274 4973 496e 7374  elf.assertIsInst
-00012540: 616e 6365 2867 7261 696e 2c20 5649 4445  ance(grain, VIDE
-00012550: 4f47 5241 494e 290a 2020 2020 2020 2020  OGRAIN).        
-00012560: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-00012570: 6572 7445 7175 616c 2867 7261 696e 2e73  ertEqual(grain.s
-00012580: 6f75 7263 655f 6964 2c20 5555 4944 2827  ource_id, UUID('
-00012590: 3439 3537 3835 3532 2d66 6239 652d 3464  49578552-fb9e-4d
-000125a0: 3365 2d61 3139 372d 3365 3363 3433 3761  3e-a197-3e3c437a
-000125b0: 3839 3564 2729 290a 2020 2020 2020 2020  895d')).        
-000125c0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-000125d0: 6572 7445 7175 616c 2867 7261 696e 2e66  ertEqual(grain.f
-000125e0: 6c6f 775f 6964 2c20 5555 4944 2827 3665  low_id, UUID('6e
-000125f0: 3535 6632 3531 2d66 3735 612d 3464 3536  55f251-f75a-4d56
-00012600: 2d62 3361 662d 6564 6238 6237 3939 3363  -b3af-edb8b7993c
-00012610: 3363 2729 290a 0a20 2020 2020 2020 2020  3c'))..         
-00012620: 2020 2020 2020 2067 7261 696e 5f63 6f75         grain_cou
-00012630: 6e74 202b 3d20 310a 0a20 2020 2020 2020  nt += 1..       
-00012640: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-00012650: 6c28 3130 2c20 6772 6169 6e5f 636f 756e  l(10, grain_coun
-00012660: 7429 2020 2320 5468 6572 6520 6172 6520  t)  # There are 
-00012670: 3130 2067 7261 696e 7320 696e 2074 6865  10 grains in the
-00012680: 2066 696c 650a 0a20 2020 2061 7379 6e63   file..    async
-00012690: 2064 6566 2074 6573 745f 6173 796e 635f   def test_async_
-000126a0: 6465 636f 6465 5f68 6561 6465 7273 2873  decode_headers(s
-000126b0: 656c 6629 3a0a 2020 2020 2020 2020 7669  elf):.        vi
-000126c0: 6465 6f5f 6461 7461 5f73 7472 6561 6d20  deo_data_stream 
-000126d0: 3d20 4173 796e 6342 7974 6573 494f 2856  = AsyncBytesIO(V
-000126e0: 4944 454f 5f44 4154 4129 0a0a 2020 2020  IDEO_DATA)..    
-000126f0: 2020 2020 6173 796e 6320 7769 7468 2047      async with G
-00012700: 5346 4465 636f 6465 7228 6669 6c65 5f64  SFDecoder(file_d
-00012710: 6174 613d 7669 6465 6f5f 6461 7461 5f73  ata=video_data_s
-00012720: 7472 6561 6d29 2061 7320 6465 633a 0a20  tream) as dec:. 
-00012730: 2020 2020 2020 2020 2020 2068 6561 6420             head 
-00012740: 3d20 6465 632e 6669 6c65 5f68 6561 6465  = dec.file_heade
-00012750: 7273 0a0a 2020 2020 2020 2020 7365 6c66  rs..        self
-00012760: 2e61 7373 6572 7445 7175 616c 2868 6561  .assertEqual(hea
-00012770: 645b 2763 7265 6174 6564 275d 2c20 6461  d['created'], da
-00012780: 7465 7469 6d65 2832 3031 382c 2032 2c20  tetime(2018, 2, 
-00012790: 372c 2031 302c 2033 382c 2032 3229 290a  7, 10, 38, 22)).
-000127a0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-000127b0: 6572 7445 7175 616c 2868 6561 645b 2769  ertEqual(head['i
-000127c0: 6427 5d2c 2055 5549 4428 2731 3633 6664  d'], UUID('163fd
-000127d0: 3962 372d 6265 6634 2d34 6439 322d 3834  9b7-bef4-4d92-84
-000127e0: 3838 2d33 3166 3338 3139 6265 3030 3827  88-31f3819be008'
-000127f0: 2929 0a20 2020 2020 2020 2073 656c 662e  )).        self.
-00012800: 6173 7365 7274 4571 7561 6c28 6c65 6e28  assertEqual(len(
-00012810: 6865 6164 5b27 7365 676d 656e 7473 275d  head['segments']
-00012820: 292c 2031 290a 2020 2020 2020 2020 7365  ), 1).        se
-00012830: 6c66 2e61 7373 6572 7445 7175 616c 2868  lf.assertEqual(h
-00012840: 6561 645b 2773 6567 6d65 6e74 7327 5d5b  ead['segments'][
-00012850: 305d 5b27 6964 275d 2c20 5555 4944 2827  0]['id'], UUID('
-00012860: 6336 6133 6433 6666 2d37 3463 302d 3434  c6a3d3ff-74c0-44
-00012870: 3664 2d62 3539 652d 6465 3130 3431 6632  6d-b59e-de1041f2
-00012880: 3765 3861 2729 290a 0a20 2020 2061 7379  7e8a'))..    asy
-00012890: 6e63 2064 6566 2074 6573 745f 6173 796e  nc def test_asyn
-000128a0: 635f 6765 6e65 7261 7465 5f67 7261 696e  c_generate_grain
-000128b0: 7328 7365 6c66 293a 0a20 2020 2020 2020  s(self):.       
-000128c0: 2022 2222 5465 7374 2074 6861 7420 7468   """Test that th
-000128d0: 6520 6765 6e65 7261 746f 7220 7969 656c  e generator yiel
-000128e0: 6473 2065 6163 6820 6772 6169 6e22 2222  ds each grain"""
-000128f0: 0a20 2020 2020 2020 2076 6964 656f 5f64  .        video_d
-00012900: 6174 615f 7374 7265 616d 203d 2041 7379  ata_stream = Asy
-00012910: 6e63 4279 7465 7349 4f28 5649 4445 4f5f  ncBytesIO(VIDEO_
-00012920: 4441 5441 290a 0a20 2020 2020 2020 2061  DATA)..        a
-00012930: 7379 6e63 2077 6974 6820 4753 4644 6563  sync with GSFDec
-00012940: 6f64 6572 2866 696c 655f 6461 7461 3d76  oder(file_data=v
-00012950: 6964 656f 5f64 6174 615f 7374 7265 616d  ideo_data_stream
-00012960: 2920 6173 2064 6563 3a0a 2020 2020 2020  ) as dec:.      
-00012970: 2020 2020 2020 6772 6169 6e5f 636f 756e        grain_coun
-00012980: 7420 3d20 300a 2020 2020 2020 2020 2020  t = 0.          
-00012990: 2020 6173 796e 6320 666f 7220 2867 7261    async for (gra
-000129a0: 696e 2c20 6c6f 6361 6c5f 6964 2920 696e  in, local_id) in
-000129b0: 2064 6563 2e67 7261 696e 7328 6c6f 6164   dec.grains(load
-000129c0: 696e 675f 6d6f 6465 3d47 7261 696e 4461  ing_mode=GrainDa
-000129d0: 7461 4c6f 6164 696e 674d 6f64 652e 4c4f  taLoadingMode.LO
-000129e0: 4144 5f49 4d4d 4544 4941 5445 4c59 293a  AD_IMMEDIATELY):
-000129f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00012a00: 2073 656c 662e 6173 7365 7274 4973 496e   self.assertIsIn
-00012a10: 7374 616e 6365 2867 7261 696e 2c20 5649  stance(grain, VI
-00012a20: 4445 4f47 5241 494e 290a 2020 2020 2020  DEOGRAIN).      
-00012a30: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-00012a40: 7373 6572 7445 7175 616c 2867 7261 696e  ssertEqual(grain
-00012a50: 2e73 6f75 7263 655f 6964 2c20 5555 4944  .source_id, UUID
-00012a60: 2827 3439 3537 3835 3532 2d66 6239 652d  ('49578552-fb9e-
-00012a70: 3464 3365 2d61 3139 372d 3365 3363 3433  4d3e-a197-3e3c43
-00012a80: 3761 3839 3564 2729 290a 2020 2020 2020  7a895d')).      
-00012a90: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-00012aa0: 7373 6572 7445 7175 616c 2867 7261 696e  ssertEqual(grain
-00012ab0: 2e66 6c6f 775f 6964 2c20 5555 4944 2827  .flow_id, UUID('
-00012ac0: 3665 3535 6632 3531 2d66 3735 612d 3464  6e55f251-f75a-4d
-00012ad0: 3536 2d62 3361 662d 6564 6238 6237 3939  56-b3af-edb8b799
-00012ae0: 3363 3363 2729 290a 0a20 2020 2020 2020  3c3c'))..       
-00012af0: 2020 2020 2020 2020 2067 7261 696e 5f63           grain_c
-00012b00: 6f75 6e74 202b 3d20 310a 0a20 2020 2020  ount += 1..     
-00012b10: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-00012b20: 7561 6c28 3130 2c20 6772 6169 6e5f 636f  ual(10, grain_co
-00012b30: 756e 7429 2020 2320 5468 6572 6520 6172  unt)  # There ar
-00012b40: 6520 3130 2067 7261 696e 7320 696e 2074  e 10 grains in t
-00012b50: 6865 2066 696c 650a 0a20 2020 2061 7379  he file..    asy
-00012b60: 6e63 2064 6566 2074 6573 745f 6173 796e  nc def test_asyn
-00012b70: 635f 746f 5f73 796e 635f 6765 6e65 7261  c_to_sync_genera
-00012b80: 7465 5f67 7261 696e 7328 7365 6c66 293a  te_grains(self):
-00012b90: 0a20 2020 2020 2020 2022 2222 5465 7374  .        """Test
-00012ba0: 2074 6861 7420 7468 6520 6765 6e65 7261   that the genera
-00012bb0: 746f 7220 7969 656c 6473 2065 6163 6820  tor yields each 
-00012bc0: 6772 6169 6e20 7768 656e 2072 756e 2073  grain when run s
-00012bd0: 6e63 6872 6f6e 6f75 736c 7920 6672 6f6d  nchronously from
-00012be0: 2061 7379 6e63 6872 6f6e 6f75 7320 636f   asynchronous co
-00012bf0: 6465 2222 220a 2020 2020 2020 2020 7669  de""".        vi
-00012c00: 6465 6f5f 6461 7461 5f73 7472 6561 6d20  deo_data_stream 
-00012c10: 3d20 4279 7465 7349 4f28 5649 4445 4f5f  = BytesIO(VIDEO_
-00012c20: 4441 5441 290a 0a20 2020 2020 2020 2077  DATA)..        w
-00012c30: 6974 6820 4753 4644 6563 6f64 6572 2866  ith GSFDecoder(f
-00012c40: 696c 655f 6461 7461 3d76 6964 656f 5f64  ile_data=video_d
-00012c50: 6174 615f 7374 7265 616d 2920 6173 2064  ata_stream) as d
-00012c60: 6563 3a0a 2020 2020 2020 2020 2020 2020  ec:.            
-00012c70: 6772 6169 6e5f 636f 756e 7420 3d20 300a  grain_count = 0.
-00012c80: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00012c90: 2867 7261 696e 2c20 6c6f 6361 6c5f 6964  (grain, local_id
-00012ca0: 2920 696e 2064 6563 2e67 7261 696e 7328  ) in dec.grains(
-00012cb0: 6c6f 6164 696e 675f 6d6f 6465 3d47 7261  loading_mode=Gra
-00012cc0: 696e 4461 7461 4c6f 6164 696e 674d 6f64  inDataLoadingMod
-00012cd0: 652e 4c4f 4144 5f49 4d4d 4544 4941 5445  e.LOAD_IMMEDIATE
-00012ce0: 4c59 293a 0a20 2020 2020 2020 2020 2020  LY):.           
-00012cf0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00012d00: 4973 496e 7374 616e 6365 2867 7261 696e  IsInstance(grain
-00012d10: 2c20 5649 4445 4f47 5241 494e 290a 2020  , VIDEOGRAIN).  
-00012d20: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00012d30: 6c66 2e61 7373 6572 7445 7175 616c 2867  lf.assertEqual(g
-00012d40: 7261 696e 2e73 6f75 7263 655f 6964 2c20  rain.source_id, 
-00012d50: 5555 4944 2827 3439 3537 3835 3532 2d66  UUID('49578552-f
-00012d60: 6239 652d 3464 3365 2d61 3139 372d 3365  b9e-4d3e-a197-3e
-00012d70: 3363 3433 3761 3839 3564 2729 290a 2020  3c437a895d')).  
-00012d80: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00012d90: 6c66 2e61 7373 6572 7445 7175 616c 2867  lf.assertEqual(g
-00012da0: 7261 696e 2e66 6c6f 775f 6964 2c20 5555  rain.flow_id, UU
-00012db0: 4944 2827 3665 3535 6632 3531 2d66 3735  ID('6e55f251-f75
-00012dc0: 612d 3464 3536 2d62 3361 662d 6564 6238  a-4d56-b3af-edb8
-00012dd0: 6237 3939 3363 3363 2729 290a 0a20 2020  b7993c3c'))..   
-00012de0: 2020 2020 2020 2020 2020 2020 2067 7261               gra
-00012df0: 696e 5f63 6f75 6e74 202b 3d20 310a 0a20  in_count += 1.. 
-00012e00: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00012e10: 7274 4571 7561 6c28 3130 2c20 6772 6169  rtEqual(10, grai
-00012e20: 6e5f 636f 756e 7429 2020 2320 5468 6572  n_count)  # Ther
-00012e30: 6520 6172 6520 3130 2067 7261 696e 7320  e are 10 grains 
-00012e40: 696e 2074 6865 2066 696c 650a 0a20 2020  in the file..   
-00012e50: 2061 7379 6e63 2064 6566 2074 6573 745f   async def test_
-00012e60: 6173 796e 635f 6765 6e65 7261 7465 5f67  async_generate_g
-00012e70: 7261 696e 735f 6c6f 6164 5f6c 617a 696c  rains_load_lazil
-00012e80: 7928 7365 6c66 293a 0a20 2020 2020 2020  y(self):.       
-00012e90: 2022 2222 5465 7374 2074 6861 7420 7468   """Test that th
-00012ea0: 6520 6765 6e65 7261 746f 7220 7969 656c  e generator yiel
-00012eb0: 6473 2065 6163 6820 6772 6169 6e22 2222  ds each grain"""
-00012ec0: 0a20 2020 2020 2020 2076 6964 656f 5f64  .        video_d
-00012ed0: 6174 615f 7374 7265 616d 203d 2041 7379  ata_stream = Asy
-00012ee0: 6e63 4279 7465 7349 4f28 5649 4445 4f5f  ncBytesIO(VIDEO_
-00012ef0: 4441 5441 290a 0a20 2020 2020 2020 2061  DATA)..        a
-00012f00: 7379 6e63 2077 6974 6820 4753 4644 6563  sync with GSFDec
-00012f10: 6f64 6572 2866 696c 655f 6461 7461 3d76  oder(file_data=v
-00012f20: 6964 656f 5f64 6174 615f 7374 7265 616d  ideo_data_stream
-00012f30: 2920 6173 2064 6563 3a0a 2020 2020 2020  ) as dec:.      
-00012f40: 2020 2020 2020 6772 6169 6e5f 636f 756e        grain_coun
-00012f50: 7420 3d20 300a 2020 2020 2020 2020 2020  t = 0.          
-00012f60: 2020 6173 796e 6320 666f 7220 2867 7261    async for (gra
-00012f70: 696e 2c20 6c6f 6361 6c5f 6964 2920 696e  in, local_id) in
-00012f80: 2064 6563 2e67 7261 696e 7328 6c6f 6164   dec.grains(load
-00012f90: 696e 675f 6d6f 6465 3d47 7261 696e 4461  ing_mode=GrainDa
-00012fa0: 7461 4c6f 6164 696e 674d 6f64 652e 414c  taLoadingMode.AL
-00012fb0: 5741 5953 5f44 4546 4552 5f4c 4f41 445f  WAYS_DEFER_LOAD_
-00012fc0: 4946 5f50 4f53 5349 424c 4529 3a0a 2020  IF_POSSIBLE):.  
-00012fd0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00012fe0: 6c66 2e61 7373 6572 7449 7349 6e73 7461  lf.assertIsInsta
-00012ff0: 6e63 6528 6772 6169 6e2c 2056 4944 454f  nce(grain, VIDEO
-00013000: 4752 4149 4e29 0a20 2020 2020 2020 2020  GRAIN).         
-00013010: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00013020: 7274 4571 7561 6c28 6772 6169 6e2e 736f  rtEqual(grain.so
-00013030: 7572 6365 5f69 642c 2055 5549 4428 2734  urce_id, UUID('4
-00013040: 3935 3738 3535 322d 6662 3965 2d34 6433  9578552-fb9e-4d3
-00013050: 652d 6131 3937 2d33 6533 6334 3337 6138  e-a197-3e3c437a8
-00013060: 3935 6427 2929 0a20 2020 2020 2020 2020  95d')).         
-00013070: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00013080: 7274 4571 7561 6c28 6772 6169 6e2e 666c  rtEqual(grain.fl
-00013090: 6f77 5f69 642c 2055 5549 4428 2736 6535  ow_id, UUID('6e5
-000130a0: 3566 3235 312d 6637 3561 2d34 6435 362d  5f251-f75a-4d56-
-000130b0: 6233 6166 2d65 6462 3862 3739 3933 6333  b3af-edb8b7993c3
-000130c0: 6327 2929 0a0a 2020 2020 2020 2020 2020  c'))..          
-000130d0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-000130e0: 7449 734e 6f6e 6528 6772 6169 6e2e 6461  tIsNone(grain.da
-000130f0: 7461 290a 0a20 2020 2020 2020 2020 2020  ta)..           
-00013100: 2020 2020 2061 7761 6974 2067 7261 696e       await grain
-00013110: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00013120: 2020 7365 6c66 2e61 7373 6572 7449 734e    self.assertIsN
-00013130: 6f74 4e6f 6e65 2867 7261 696e 2e64 6174  otNone(grain.dat
-00013140: 6129 0a0a 2020 2020 2020 2020 2020 2020  a)..            
-00013150: 2020 2020 6772 6169 6e5f 636f 756e 7420      grain_count 
-00013160: 2b3d 2031 0a0a 2020 2020 2020 2020 7365  += 1..        se
-00013170: 6c66 2e61 7373 6572 7445 7175 616c 2831  lf.assertEqual(1
-00013180: 302c 2067 7261 696e 5f63 6f75 6e74 2920  0, grain_count) 
-00013190: 2023 2054 6865 7265 2061 7265 2031 3020   # There are 10 
-000131a0: 6772 6169 6e73 2069 6e20 7468 6520 6669  grains in the fi
-000131b0: 6c65 0a0a 2020 2020 4073 7570 7072 6573  le..    @suppres
-000131c0: 735f 6465 7072 6563 6174 696f 6e5f 7761  s_deprecation_wa
-000131d0: 726e 696e 6773 0a20 2020 2064 6566 2074  rnings.    def t
-000131e0: 6573 745f 6465 636f 6465 5f68 6561 6465  est_decode_heade
-000131f0: 7273 5f5f 6465 7072 6563 6174 6564 2873  rs__deprecated(s
-00013200: 656c 6629 3a0a 2020 2020 2020 2020 7669  elf):.        vi
-00013210: 6465 6f5f 6461 7461 5f73 7472 6561 6d20  deo_data_stream 
-00013220: 3d20 4279 7465 7349 4f28 5649 4445 4f5f  = BytesIO(VIDEO_
-00013230: 4441 5441 290a 0a20 2020 2020 2020 2055  DATA)..        U
-00013240: 5554 203d 2047 5346 4465 636f 6465 7228  UT = GSFDecoder(
-00013250: 6669 6c65 5f64 6174 613d 7669 6465 6f5f  file_data=video_
-00013260: 6461 7461 5f73 7472 6561 6d29 0a20 2020  data_stream).   
-00013270: 2020 2020 2068 6561 6420 3d20 5555 542e       head = UUT.
-00013280: 6465 636f 6465 5f66 696c 655f 6865 6164  decode_file_head
-00013290: 6572 7328 290a 0a20 2020 2020 2020 2073  ers()..        s
-000132a0: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-000132b0: 6865 6164 5b27 6372 6561 7465 6427 5d2c  head['created'],
-000132c0: 2064 6174 6574 696d 6528 3230 3138 2c20   datetime(2018, 
-000132d0: 322c 2037 2c20 3130 2c20 3338 2c20 3232  2, 7, 10, 38, 22
-000132e0: 2929 0a20 2020 2020 2020 2073 656c 662e  )).        self.
-000132f0: 6173 7365 7274 4571 7561 6c28 6865 6164  assertEqual(head
-00013300: 5b27 6964 275d 2c20 5555 4944 2827 3136  ['id'], UUID('16
-00013310: 3366 6439 6237 2d62 6566 342d 3464 3932  3fd9b7-bef4-4d92
-00013320: 2d38 3438 382d 3331 6633 3831 3962 6530  -8488-31f3819be0
-00013330: 3038 2729 290a 2020 2020 2020 2020 7365  08')).        se
-00013340: 6c66 2e61 7373 6572 7445 7175 616c 286c  lf.assertEqual(l
-00013350: 656e 2868 6561 645b 2773 6567 6d65 6e74  en(head['segment
-00013360: 7327 5d29 2c20 3129 0a20 2020 2020 2020  s']), 1).       
-00013370: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-00013380: 6c28 6865 6164 5b27 7365 676d 656e 7473  l(head['segments
-00013390: 275d 5b30 5d5b 2769 6427 5d2c 2055 5549  '][0]['id'], UUI
-000133a0: 4428 2763 3661 3364 3366 662d 3734 6330  D('c6a3d3ff-74c0
-000133b0: 2d34 3436 642d 6235 3965 2d64 6531 3034  -446d-b59e-de104
-000133c0: 3166 3237 6538 6127 2929 0a0a 2020 2020  1f27e8a'))..    
-000133d0: 4073 7570 7072 6573 735f 6465 7072 6563  @suppress_deprec
-000133e0: 6174 696f 6e5f 7761 726e 696e 6773 0a20  ation_warnings. 
-000133f0: 2020 2064 6566 2074 6573 745f 6765 6e65     def test_gene
-00013400: 7261 7465 5f67 7261 696e 735f 5f64 6570  rate_grains__dep
-00013410: 7265 6361 7465 6428 7365 6c66 293a 0a20  recated(self):. 
-00013420: 2020 2020 2020 2022 2222 5465 7374 2074         """Test t
-00013430: 6861 7420 7468 6520 6765 6e65 7261 746f  hat the generato
-00013440: 7220 7969 656c 6473 2065 6163 6820 6772  r yields each gr
-00013450: 6169 6e22 2222 0a20 2020 2020 2020 2076  ain""".        v
-00013460: 6964 656f 5f64 6174 615f 7374 7265 616d  ideo_data_stream
-00013470: 203d 2042 7974 6573 494f 2856 4944 454f   = BytesIO(VIDEO
-00013480: 5f44 4154 4129 0a0a 2020 2020 2020 2020  _DATA)..        
-00013490: 5555 5420 3d20 4753 4644 6563 6f64 6572  UUT = GSFDecoder
-000134a0: 2866 696c 655f 6461 7461 3d76 6964 656f  (file_data=video
-000134b0: 5f64 6174 615f 7374 7265 616d 290a 2020  _data_stream).  
-000134c0: 2020 2020 2020 5555 542e 6465 636f 6465        UUT.decode
-000134d0: 5f66 696c 655f 6865 6164 6572 7328 290a  _file_headers().
-000134e0: 0a20 2020 2020 2020 2067 7261 696e 5f63  .        grain_c
-000134f0: 6f75 6e74 203d 2030 0a20 2020 2020 2020  ount = 0.       
-00013500: 2066 6f72 2028 6772 6169 6e2c 206c 6f63   for (grain, loc
-00013510: 616c 5f69 6429 2069 6e20 5555 542e 6772  al_id) in UUT.gr
-00013520: 6169 6e73 2829 3a0a 2020 2020 2020 2020  ains():.        
-00013530: 2020 2020 7365 6c66 2e61 7373 6572 7449      self.assertI
-00013540: 7349 6e73 7461 6e63 6528 6772 6169 6e2c  sInstance(grain,
-00013550: 2056 4944 454f 4752 4149 4e29 0a20 2020   VIDEOGRAIN).   
-00013560: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
-00013570: 7365 7274 4571 7561 6c28 6772 6169 6e2e  sertEqual(grain.
-00013580: 736f 7572 6365 5f69 642c 2055 5549 4428  source_id, UUID(
-00013590: 2734 3935 3738 3535 322d 6662 3965 2d34  '49578552-fb9e-4
-000135a0: 6433 652d 6131 3937 2d33 6533 6334 3337  d3e-a197-3e3c437
-000135b0: 6138 3935 6427 2929 0a20 2020 2020 2020  a895d')).       
-000135c0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-000135d0: 4571 7561 6c28 6772 6169 6e2e 666c 6f77  Equal(grain.flow
-000135e0: 5f69 642c 2055 5549 4428 2736 6535 3566  _id, UUID('6e55f
-000135f0: 3235 312d 6637 3561 2d34 6435 362d 6233  251-f75a-4d56-b3
-00013600: 6166 2d65 6462 3862 3739 3933 6333 6327  af-edb8b7993c3c'
-00013610: 2929 0a0a 2020 2020 2020 2020 2020 2020  ))..            
-00013620: 6772 6169 6e5f 636f 756e 7420 2b3d 2031  grain_count += 1
-00013630: 0a0a 2020 2020 2020 2020 7365 6c66 2e61  ..        self.a
-00013640: 7373 6572 7445 7175 616c 2831 302c 2067  ssertEqual(10, g
-00013650: 7261 696e 5f63 6f75 6e74 2920 2023 2054  rain_count)  # T
-00013660: 6865 7265 2061 7265 2031 3020 6772 6169  here are 10 grai
-00013670: 6e73 2069 6e20 7468 6520 6669 6c65 0a0a  ns in the file..
-00013680: 2020 2020 6173 796e 6320 6465 6620 7465      async def te
-00013690: 7374 5f61 7379 6e63 5f63 6f6d 7061 7269  st_async_compari
-000136a0: 736f 6e5f 6f66 5f6c 617a 795f 6c6f 6164  son_of_lazy_load
-000136b0: 6564 5f67 7261 696e 7328 7365 6c66 293a  ed_grains(self):
-000136c0: 0a20 2020 2020 2020 2061 7379 6e63 2077  .        async w
-000136d0: 6974 6820 4753 4644 6563 6f64 6572 2866  ith GSFDecoder(f
-000136e0: 696c 655f 6461 7461 3d41 7379 6e63 4279  ile_data=AsyncBy
-000136f0: 7465 7349 4f28 5649 4445 4f5f 4441 5441  tesIO(VIDEO_DATA
-00013700: 2929 2061 7320 6465 633a 0a20 2020 2020  )) as dec:.     
-00013710: 2020 2020 2020 2067 7261 696e 7320 3d20         grains = 
-00013720: 5b0a 2020 2020 2020 2020 2020 2020 2020  [.              
-00013730: 2020 6772 6169 6e20 6173 796e 6320 666f    grain async fo
-00013740: 7220 2867 7261 696e 2c20 6c6f 6361 6c5f  r (grain, local_
-00013750: 6964 2920 696e 2064 6563 2e67 7261 696e  id) in dec.grain
-00013760: 7328 6c6f 6164 696e 675f 6d6f 6465 3d47  s(loading_mode=G
-00013770: 7261 696e 4461 7461 4c6f 6164 696e 674d  rainDataLoadingM
-00013780: 6f64 652e 4c4f 4144 5f49 4d4d 4544 4941  ode.LOAD_IMMEDIA
-00013790: 5445 4c59 295d 0a0a 2020 2020 2020 2020  TELY)]..        
-000137a0: 2320 5265 7374 6172 7420 7468 6520 6465  # Restart the de
-000137b0: 636f 6465 720a 2020 2020 2020 2020 6173  coder.        as
-000137c0: 796e 6320 7769 7468 2047 5346 4465 636f  ync with GSFDeco
-000137d0: 6465 7228 6669 6c65 5f64 6174 613d 4173  der(file_data=As
-000137e0: 796e 6342 7974 6573 494f 2856 4944 454f  yncBytesIO(VIDEO
-000137f0: 5f44 4154 4129 2920 6173 2064 6563 3a0a  _DATA)) as dec:.
-00013800: 2020 2020 2020 2020 2020 2020 2320 416e              # An
-00013810: 6e6f 7969 6e67 6c79 2061 6e65 7874 2069  noyingly anext i
-00013820: 736e 2774 2061 2067 6c6f 6261 6c20 696e  sn't a global in
-00013830: 2070 7974 686f 6e20 332e 360a 2020 2020   python 3.6.    
-00013840: 2020 2020 2020 2020 6772 6169 6e20 3d20          grain = 
-00013850: 2861 7761 6974 2064 6563 2e67 7261 696e  (await dec.grain
-00013860: 7328 6c6f 6164 696e 675f 6d6f 6465 3d47  s(loading_mode=G
-00013870: 7261 696e 4461 7461 4c6f 6164 696e 674d  rainDataLoadingM
-00013880: 6f64 652e 414c 5741 5953 5f44 4546 4552  ode.ALWAYS_DEFER
-00013890: 5f4c 4f41 445f 4946 5f50 4f53 5349 424c  _LOAD_IF_POSSIBL
-000138a0: 4529 2e5f 5f61 6e65 7874 5f5f 2829 295b  E).__anext__())[
-000138b0: 305d 0a20 2020 2020 2020 2020 2020 2061  0].            a
-000138c0: 7761 6974 2067 7261 696e 0a20 2020 2020  wait grain.     
-000138d0: 2020 2020 2020 2063 6f6d 7020 3d20 636f         comp = co
-000138e0: 6d70 6172 655f 6772 6169 6e28 6772 6169  mpare_grain(grai
-000138f0: 6e73 5b30 5d2c 2067 7261 696e 290a 2020  ns[0], grain).  
-00013900: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-00013910: 7373 6572 7454 7275 6528 636f 6d70 2c20  ssertTrue(comp, 
-00013920: 6d73 673d 227b 2172 7d22 2e66 6f72 6d61  msg="{!r}".forma
-00013930: 7428 636f 6d70 2929 0a0a 2020 2020 6465  t(comp))..    de
-00013940: 6620 7465 7374 5f63 6f6d 7061 7269 736f  f test_compariso
-00013950: 6e5f 6f66 5f6c 617a 795f 6c6f 6164 6564  n_of_lazy_loaded
-00013960: 5f67 7261 696e 7328 7365 6c66 293a 0a20  _grains(self):. 
-00013970: 2020 2020 2020 2076 6964 656f 5f64 6174         video_dat
-00013980: 615f 7374 7265 616d 203d 2042 7974 6573  a_stream = Bytes
-00013990: 494f 2856 4944 454f 5f44 4154 4129 0a0a  IO(VIDEO_DATA)..
-000139a0: 2020 2020 2020 2020 7769 7468 2047 5346          with GSF
-000139b0: 4465 636f 6465 7228 6669 6c65 5f64 6174  Decoder(file_dat
-000139c0: 613d 7669 6465 6f5f 6461 7461 5f73 7472  a=video_data_str
-000139d0: 6561 6d29 2061 7320 6465 633a 0a20 2020  eam) as dec:.   
-000139e0: 2020 2020 2020 2020 2067 7261 696e 7320           grains 
-000139f0: 3d20 5b67 7261 696e 2066 6f72 2028 6772  = [grain for (gr
-00013a00: 6169 6e2c 206c 6f63 616c 5f69 6429 2069  ain, local_id) i
-00013a10: 6e20 6465 632e 6772 6169 6e73 286c 6f61  n dec.grains(loa
-00013a20: 6469 6e67 5f6d 6f64 653d 4772 6169 6e44  ding_mode=GrainD
-00013a30: 6174 614c 6f61 6469 6e67 4d6f 6465 2e4c  ataLoadingMode.L
-00013a40: 4f41 445f 494d 4d45 4449 4154 454c 5929  OAD_IMMEDIATELY)
-00013a50: 5d0a 0a20 2020 2020 2020 2023 2052 6573  ]..        # Res
-00013a60: 7461 7274 2074 6865 2064 6563 6f64 6572  tart the decoder
-00013a70: 0a20 2020 2020 2020 2076 6964 656f 5f64  .        video_d
-00013a80: 6174 615f 7374 7265 616d 2e73 6565 6b28  ata_stream.seek(
-00013a90: 3029 0a20 2020 2020 2020 2077 6974 6820  0).        with 
-00013aa0: 4753 4644 6563 6f64 6572 2866 696c 655f  GSFDecoder(file_
-00013ab0: 6461 7461 3d76 6964 656f 5f64 6174 615f  data=video_data_
-00013ac0: 7374 7265 616d 2920 6173 2064 6563 3a0a  stream) as dec:.
-00013ad0: 2020 2020 2020 2020 2020 2020 636f 6d70              comp
-00013ae0: 203d 2063 6f6d 7061 7265 5f67 7261 696e   = compare_grain
-00013af0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00013b00: 2020 6772 6169 6e73 5b30 5d2c 206e 6578    grains[0], nex
-00013b10: 7428 6465 632e 6772 6169 6e73 286c 6f61  t(dec.grains(loa
-00013b20: 6469 6e67 5f6d 6f64 653d 4772 6169 6e44  ding_mode=GrainD
-00013b30: 6174 614c 6f61 6469 6e67 4d6f 6465 2e41  ataLoadingMode.A
-00013b40: 4c57 4159 535f 4445 4645 525f 4c4f 4144  LWAYS_DEFER_LOAD
-00013b50: 5f49 465f 504f 5353 4942 4c45 2929 5b30  _IF_POSSIBLE))[0
-00013b60: 5d29 0a20 2020 2020 2020 2020 2020 2073  ]).            s
-00013b70: 656c 662e 6173 7365 7274 5472 7565 2863  elf.assertTrue(c
-00013b80: 6f6d 702c 206d 7367 3d22 7b21 737d 222e  omp, msg="{!s}".
-00013b90: 666f 726d 6174 2863 6f6d 7029 290a 0a20  format(comp)).. 
-00013ba0: 2020 2040 7375 7070 7265 7373 5f64 6570     @suppress_dep
-00013bb0: 7265 6361 7469 6f6e 5f77 6172 6e69 6e67  recation_warning
-00013bc0: 730a 2020 2020 6465 6620 7465 7374 5f63  s.    def test_c
-00013bd0: 6f6d 7061 7269 736f 6e5f 6f66 5f6c 617a  omparison_of_laz
-00013be0: 795f 6c6f 6164 6564 5f67 7261 696e 735f  y_loaded_grains_
-00013bf0: 5f64 6570 7265 6361 7465 6428 7365 6c66  _deprecated(self
-00013c00: 293a 0a20 2020 2020 2020 2076 6964 656f  ):.        video
-00013c10: 5f64 6174 615f 7374 7265 616d 203d 2042  _data_stream = B
-00013c20: 7974 6573 494f 2856 4944 454f 5f44 4154  ytesIO(VIDEO_DAT
-00013c30: 4129 0a0a 2020 2020 2020 2020 5555 5420  A)..        UUT 
-00013c40: 3d20 4753 4644 6563 6f64 6572 2866 696c  = GSFDecoder(fil
-00013c50: 655f 6461 7461 3d76 6964 656f 5f64 6174  e_data=video_dat
-00013c60: 615f 7374 7265 616d 290a 2020 2020 2020  a_stream).      
-00013c70: 2020 5555 542e 6465 636f 6465 5f66 696c    UUT.decode_fil
-00013c80: 655f 6865 6164 6572 7328 290a 0a20 2020  e_headers()..   
-00013c90: 2020 2020 2067 7261 696e 7320 3d20 5b67       grains = [g
-00013ca0: 7261 696e 2066 6f72 2028 6772 6169 6e2c  rain for (grain,
-00013cb0: 206c 6f63 616c 5f69 6429 2069 6e20 5555   local_id) in UU
-00013cc0: 542e 6772 6169 6e73 286c 6f61 6469 6e67  T.grains(loading
-00013cd0: 5f6d 6f64 653d 4772 6169 6e44 6174 614c  _mode=GrainDataL
-00013ce0: 6f61 6469 6e67 4d6f 6465 2e4c 4f41 445f  oadingMode.LOAD_
-00013cf0: 494d 4d45 4449 4154 454c 5929 5d0a 0a20  IMMEDIATELY)].. 
-00013d00: 2020 2020 2020 2023 2052 6573 7461 7274         # Restart
-00013d10: 2074 6865 2064 6563 6f64 6572 0a20 2020   the decoder.   
-00013d20: 2020 2020 2076 6964 656f 5f64 6174 615f       video_data_
-00013d30: 7374 7265 616d 2e73 6565 6b28 3029 0a20  stream.seek(0). 
-00013d40: 2020 2020 2020 2055 5554 203d 2047 5346         UUT = GSF
-00013d50: 4465 636f 6465 7228 6669 6c65 5f64 6174  Decoder(file_dat
-00013d60: 613d 7669 6465 6f5f 6461 7461 5f73 7472  a=video_data_str
-00013d70: 6561 6d29 0a20 2020 2020 2020 2055 5554  eam).        UUT
-00013d80: 2e64 6563 6f64 655f 6669 6c65 5f68 6561  .decode_file_hea
-00013d90: 6465 7273 2829 0a0a 2020 2020 2020 2020  ders()..        
-00013da0: 7365 6c66 2e61 7373 6572 7454 7275 6528  self.assertTrue(
-00013db0: 636f 6d70 6172 655f 6772 6169 6e28 6772  compare_grain(gr
-00013dc0: 6169 6e73 5b30 5d2c 206e 6578 7428 5555  ains[0], next(UU
-00013dd0: 542e 6772 6169 6e73 286c 6f61 645f 6c61  T.grains(load_la
-00013de0: 7a69 6c79 3d54 7275 6529 295b 305d 2929  zily=True))[0]))
-00013df0: 0a0a 2020 2020 6173 796e 6320 6465 6620  ..    async def 
-00013e00: 7465 7374 5f61 7379 6e63 5f6c 6f63 616c  test_async_local
-00013e10: 5f69 645f 6669 6c74 6572 696e 6728 7365  _id_filtering(se
-00013e20: 6c66 293a 0a20 2020 2020 2020 2069 6e74  lf):.        int
-00013e30: 6572 6c65 6176 6564 5f64 6174 615f 7374  erleaved_data_st
-00013e40: 7265 616d 203d 2041 7379 6e63 4279 7465  ream = AsyncByte
-00013e50: 7349 4f28 494e 5445 524c 4541 5645 445f  sIO(INTERLEAVED_
-00013e60: 4441 5441 290a 0a20 2020 2020 2020 2061  DATA)..        a
-00013e70: 7379 6e63 2077 6974 6820 4753 4644 6563  sync with GSFDec
-00013e80: 6f64 6572 2866 696c 655f 6461 7461 3d69  oder(file_data=i
-00013e90: 6e74 6572 6c65 6176 6564 5f64 6174 615f  nterleaved_data_
-00013ea0: 7374 7265 616d 2920 6173 2064 6563 3a0a  stream) as dec:.
-00013eb0: 2020 2020 2020 2020 2020 2020 6c6f 6361              loca
-00013ec0: 6c5f 6964 7320 3d20 7365 7428 290a 2020  l_ids = set().  
-00013ed0: 2020 2020 2020 2020 2020 666c 6f77 5f69            flow_i
-00013ee0: 6473 203d 2073 6574 2829 0a20 2020 2020  ds = set().     
-00013ef0: 2020 2020 2020 2061 7379 6e63 2066 6f72         async for
-00013f00: 2028 6772 6169 6e2c 206c 6f63 616c 5f69   (grain, local_i
-00013f10: 6429 2069 6e20 6465 632e 6772 6169 6e73  d) in dec.grains
-00013f20: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
-00013f30: 2020 2020 6c6f 6361 6c5f 6964 732e 6164      local_ids.ad
-00013f40: 6428 6c6f 6361 6c5f 6964 290a 2020 2020  d(local_id).    
-00013f50: 2020 2020 2020 2020 2020 2020 666c 6f77              flow
-00013f60: 5f69 6473 2e61 6464 2867 7261 696e 2e66  _ids.add(grain.f
-00013f70: 6c6f 775f 6964 290a 0a20 2020 2020 2020  low_id)..       
-00013f80: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-00013f90: 6c28 6c6f 6361 6c5f 6964 732c 2073 6574  l(local_ids, set
-00013fa0: 285b 312c 2032 5d29 290a 2020 2020 2020  ([1, 2])).      
-00013fb0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-00013fc0: 616c 2866 6c6f 775f 6964 732c 2073 6574  al(flow_ids, set
-00013fd0: 285b 5555 4944 2827 3238 6534 6530 3965  ([UUID('28e4e09e
-00013fe0: 2d33 3531 372d 3131 6539 2d38 6461 322d  -3517-11e9-8da2-
-00013ff0: 3530 3635 6633 3465 6430 3037 2729 2c0a  5065f34ed007'),.
-00014000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014020: 2020 2020 2020 2020 5555 4944 2827 3234          UUID('24
-00014030: 3732 6633 3865 2d33 3531 372d 3131 6539  72f38e-3517-11e9
-00014040: 2d38 6461 322d 3530 3635 6633 3465 6430  -8da2-5065f34ed0
-00014050: 3037 2729 5d29 290a 0a20 2020 2020 2020  07')]))..       
-00014060: 2061 7379 6e63 2077 6974 6820 4753 4644   async with GSFD
-00014070: 6563 6f64 6572 2866 696c 655f 6461 7461  ecoder(file_data
-00014080: 3d69 6e74 6572 6c65 6176 6564 5f64 6174  =interleaved_dat
-00014090: 615f 7374 7265 616d 2920 6173 2064 6563  a_stream) as dec
-000140a0: 3a0a 2020 2020 2020 2020 2020 2020 6173  :.            as
-000140b0: 796e 6320 666f 7220 2867 7261 696e 2c20  ync for (grain, 
-000140c0: 6c6f 6361 6c5f 6964 2920 696e 2064 6563  local_id) in dec
-000140d0: 2e67 7261 696e 7328 6c6f 6361 6c5f 6964  .grains(local_id
-000140e0: 733d 5b31 5d29 3a0a 2020 2020 2020 2020  s=[1]):.        
-000140f0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-00014100: 6572 7449 7349 6e73 7461 6e63 6528 6772  ertIsInstance(gr
-00014110: 6169 6e2c 2041 5544 494f 4752 4149 4e29  ain, AUDIOGRAIN)
-00014120: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014130: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-00014140: 6c28 6772 6169 6e2e 736f 7572 6365 5f69  l(grain.source_i
-00014150: 642c 2055 5549 4428 2731 6638 6664 3237  d, UUID('1f8fd27
-00014160: 652d 3335 3137 2d31 3165 392d 3864 6132  e-3517-11e9-8da2
-00014170: 2d35 3036 3566 3334 6564 3030 3727 2929  -5065f34ed007'))
-00014180: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014190: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-000141a0: 6c28 6772 6169 6e2e 666c 6f77 5f69 642c  l(grain.flow_id,
-000141b0: 2055 5549 4428 2732 3865 3465 3039 652d   UUID('28e4e09e-
-000141c0: 3335 3137 2d31 3165 392d 3864 6132 2d35  3517-11e9-8da2-5
-000141d0: 3036 3566 3334 6564 3030 3727 2929 0a20  065f34ed007')). 
-000141e0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-000141f0: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-00014200: 6c6f 6361 6c5f 6964 2c20 3129 0a0a 2020  local_id, 1)..  
-00014210: 2020 2020 2020 6173 796e 6320 7769 7468        async with
-00014220: 2047 5346 4465 636f 6465 7228 6669 6c65   GSFDecoder(file
-00014230: 5f64 6174 613d 696e 7465 726c 6561 7665  _data=interleave
-00014240: 645f 6461 7461 5f73 7472 6561 6d29 2061  d_data_stream) a
-00014250: 7320 6465 633a 0a20 2020 2020 2020 2020  s dec:.         
-00014260: 2020 2061 7379 6e63 2066 6f72 2028 6772     async for (gr
-00014270: 6169 6e2c 206c 6f63 616c 5f69 6429 2069  ain, local_id) i
-00014280: 6e20 6465 632e 6772 6169 6e73 286c 6f63  n dec.grains(loc
-00014290: 616c 5f69 6473 3d5b 325d 293a 0a20 2020  al_ids=[2]):.   
-000142a0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-000142b0: 662e 6173 7365 7274 4973 496e 7374 616e  f.assertIsInstan
-000142c0: 6365 2867 7261 696e 2c20 5649 4445 4f47  ce(grain, VIDEOG
-000142d0: 5241 494e 290a 2020 2020 2020 2020 2020  RAIN).          
-000142e0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-000142f0: 7445 7175 616c 2867 7261 696e 2e73 6f75  tEqual(grain.sou
-00014300: 7263 655f 6964 2c20 5555 4944 2827 3166  rce_id, UUID('1f
-00014310: 3866 6432 3765 2d33 3531 372d 3131 6539  8fd27e-3517-11e9
-00014320: 2d38 6461 322d 3530 3635 6633 3465 6430  -8da2-5065f34ed0
-00014330: 3037 2729 290a 2020 2020 2020 2020 2020  07')).          
-00014340: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-00014350: 7445 7175 616c 2867 7261 696e 2e66 6c6f  tEqual(grain.flo
-00014360: 775f 6964 2c20 5555 4944 2827 3234 3732  w_id, UUID('2472
-00014370: 6633 3865 2d33 3531 372d 3131 6539 2d38  f38e-3517-11e9-8
-00014380: 6461 322d 3530 3635 6633 3465 6430 3037  da2-5065f34ed007
-00014390: 2729 290a 2020 2020 2020 2020 2020 2020  ')).            
-000143a0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-000143b0: 7175 616c 286c 6f63 616c 5f69 642c 2032  qual(local_id, 2
-000143c0: 290a 0a20 2020 2064 6566 2074 6573 745f  )..    def test_
-000143d0: 6c6f 6361 6c5f 6964 5f66 696c 7465 7269  local_id_filteri
-000143e0: 6e67 2873 656c 6629 3a0a 2020 2020 2020  ng(self):.      
-000143f0: 2020 696e 7465 726c 6561 7665 645f 6461    interleaved_da
-00014400: 7461 5f73 7472 6561 6d20 3d20 4279 7465  ta_stream = Byte
-00014410: 7349 4f28 494e 5445 524c 4541 5645 445f  sIO(INTERLEAVED_
-00014420: 4441 5441 290a 0a20 2020 2020 2020 2077  DATA)..        w
-00014430: 6974 6820 4753 4644 6563 6f64 6572 2866  ith GSFDecoder(f
-00014440: 696c 655f 6461 7461 3d69 6e74 6572 6c65  ile_data=interle
-00014450: 6176 6564 5f64 6174 615f 7374 7265 616d  aved_data_stream
-00014460: 2920 6173 2064 6563 3a0a 2020 2020 2020  ) as dec:.      
-00014470: 2020 2020 2020 6c6f 6361 6c5f 6964 7320        local_ids 
-00014480: 3d20 7365 7428 290a 2020 2020 2020 2020  = set().        
-00014490: 2020 2020 666c 6f77 5f69 6473 203d 2073      flow_ids = s
-000144a0: 6574 2829 0a20 2020 2020 2020 2020 2020  et().           
-000144b0: 2066 6f72 2028 6772 6169 6e2c 206c 6f63   for (grain, loc
-000144c0: 616c 5f69 6429 2069 6e20 6465 632e 6772  al_id) in dec.gr
-000144d0: 6169 6e73 2829 3a0a 2020 2020 2020 2020  ains():.        
-000144e0: 2020 2020 2020 2020 6c6f 6361 6c5f 6964          local_id
-000144f0: 732e 6164 6428 6c6f 6361 6c5f 6964 290a  s.add(local_id).
-00014500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014510: 666c 6f77 5f69 6473 2e61 6464 2867 7261  flow_ids.add(gra
-00014520: 696e 2e66 6c6f 775f 6964 290a 0a20 2020  in.flow_id)..   
-00014530: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00014540: 4571 7561 6c28 6c6f 6361 6c5f 6964 732c  Equal(local_ids,
-00014550: 2073 6574 285b 312c 2032 5d29 290a 2020   set([1, 2])).  
-00014560: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-00014570: 7445 7175 616c 2866 6c6f 775f 6964 732c  tEqual(flow_ids,
-00014580: 2073 6574 285b 5555 4944 2827 3238 6534   set([UUID('28e4
-00014590: 6530 3965 2d33 3531 372d 3131 6539 2d38  e09e-3517-11e9-8
-000145a0: 6461 322d 3530 3635 6633 3465 6430 3037  da2-5065f34ed007
-000145b0: 2729 2c0a 2020 2020 2020 2020 2020 2020  '),.            
-000145c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000145d0: 2020 2020 2020 2020 2020 2020 5555 4944              UUID
-000145e0: 2827 3234 3732 6633 3865 2d33 3531 372d  ('2472f38e-3517-
-000145f0: 3131 6539 2d38 6461 322d 3530 3635 6633  11e9-8da2-5065f3
-00014600: 3465 6430 3037 2729 5d29 290a 0a20 2020  4ed007')]))..   
-00014610: 2020 2020 2069 6e74 6572 6c65 6176 6564       interleaved
-00014620: 5f64 6174 615f 7374 7265 616d 2e73 6565  _data_stream.see
-00014630: 6b28 3029 0a20 2020 2020 2020 2077 6974  k(0).        wit
-00014640: 6820 4753 4644 6563 6f64 6572 2866 696c  h GSFDecoder(fil
-00014650: 655f 6461 7461 3d69 6e74 6572 6c65 6176  e_data=interleav
-00014660: 6564 5f64 6174 615f 7374 7265 616d 2920  ed_data_stream) 
-00014670: 6173 2064 6563 3a0a 2020 2020 2020 2020  as dec:.        
-00014680: 2020 2020 666f 7220 2867 7261 696e 2c20      for (grain, 
-00014690: 6c6f 6361 6c5f 6964 2920 696e 2064 6563  local_id) in dec
-000146a0: 2e67 7261 696e 7328 6c6f 6361 6c5f 6964  .grains(local_id
-000146b0: 733d 5b31 5d29 3a0a 2020 2020 2020 2020  s=[1]):.        
-000146c0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-000146d0: 6572 7449 7349 6e73 7461 6e63 6528 6772  ertIsInstance(gr
-000146e0: 6169 6e2c 2041 5544 494f 4752 4149 4e29  ain, AUDIOGRAIN)
-000146f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014700: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-00014710: 6c28 6772 6169 6e2e 736f 7572 6365 5f69  l(grain.source_i
-00014720: 642c 2055 5549 4428 2731 6638 6664 3237  d, UUID('1f8fd27
-00014730: 652d 3335 3137 2d31 3165 392d 3864 6132  e-3517-11e9-8da2
-00014740: 2d35 3036 3566 3334 6564 3030 3727 2929  -5065f34ed007'))
-00014750: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014760: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-00014770: 6c28 6772 6169 6e2e 666c 6f77 5f69 642c  l(grain.flow_id,
-00014780: 2055 5549 4428 2732 3865 3465 3039 652d   UUID('28e4e09e-
-00014790: 3335 3137 2d31 3165 392d 3864 6132 2d35  3517-11e9-8da2-5
-000147a0: 3036 3566 3334 6564 3030 3727 2929 0a20  065f34ed007')). 
-000147b0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-000147c0: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-000147d0: 6c6f 6361 6c5f 6964 2c20 3129 0a0a 2020  local_id, 1)..  
-000147e0: 2020 2020 2020 696e 7465 726c 6561 7665        interleave
-000147f0: 645f 6461 7461 5f73 7472 6561 6d2e 7365  d_data_stream.se
-00014800: 656b 2830 290a 2020 2020 2020 2020 7769  ek(0).        wi
-00014810: 7468 2047 5346 4465 636f 6465 7228 6669  th GSFDecoder(fi
-00014820: 6c65 5f64 6174 613d 696e 7465 726c 6561  le_data=interlea
-00014830: 7665 645f 6461 7461 5f73 7472 6561 6d29  ved_data_stream)
-00014840: 2061 7320 6465 633a 0a20 2020 2020 2020   as dec:.       
-00014850: 2020 2020 2066 6f72 2028 6772 6169 6e2c       for (grain,
-00014860: 206c 6f63 616c 5f69 6429 2069 6e20 6465   local_id) in de
-00014870: 632e 6772 6169 6e73 286c 6f63 616c 5f69  c.grains(local_i
-00014880: 6473 3d5b 325d 293a 0a20 2020 2020 2020  ds=[2]):.       
-00014890: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
-000148a0: 7365 7274 4973 496e 7374 616e 6365 2867  sertIsInstance(g
-000148b0: 7261 696e 2c20 5649 4445 4f47 5241 494e  rain, VIDEOGRAIN
-000148c0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000148d0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-000148e0: 616c 2867 7261 696e 2e73 6f75 7263 655f  al(grain.source_
-000148f0: 6964 2c20 5555 4944 2827 3166 3866 6432  id, UUID('1f8fd2
-00014900: 3765 2d33 3531 372d 3131 6539 2d38 6461  7e-3517-11e9-8da
-00014910: 322d 3530 3635 6633 3465 6430 3037 2729  2-5065f34ed007')
-00014920: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00014930: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-00014940: 616c 2867 7261 696e 2e66 6c6f 775f 6964  al(grain.flow_id
-00014950: 2c20 5555 4944 2827 3234 3732 6633 3865  , UUID('2472f38e
-00014960: 2d33 3531 372d 3131 6539 2d38 6461 322d  -3517-11e9-8da2-
-00014970: 3530 3635 6633 3465 6430 3037 2729 290a  5065f34ed007')).
-00014980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014990: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-000149a0: 286c 6f63 616c 5f69 642c 2032 290a 0a20  (local_id, 2).. 
-000149b0: 2020 2040 7375 7070 7265 7373 5f64 6570     @suppress_dep
-000149c0: 7265 6361 7469 6f6e 5f77 6172 6e69 6e67  recation_warning
-000149d0: 730a 2020 2020 6465 6620 7465 7374 5f6c  s.    def test_l
-000149e0: 6f63 616c 5f69 645f 6669 6c74 6572 696e  ocal_id_filterin
-000149f0: 675f 5f64 6570 7265 6361 7465 6428 7365  g__deprecated(se
-00014a00: 6c66 293a 0a20 2020 2020 2020 2069 6e74  lf):.        int
-00014a10: 6572 6c65 6176 6564 5f64 6174 615f 7374  erleaved_data_st
-00014a20: 7265 616d 203d 2042 7974 6573 494f 2849  ream = BytesIO(I
-00014a30: 4e54 4552 4c45 4156 4544 5f44 4154 4129  NTERLEAVED_DATA)
-00014a40: 0a0a 2020 2020 2020 2020 5555 5420 3d20  ..        UUT = 
-00014a50: 4753 4644 6563 6f64 6572 2866 696c 655f  GSFDecoder(file_
-00014a60: 6461 7461 3d69 6e74 6572 6c65 6176 6564  data=interleaved
-00014a70: 5f64 6174 615f 7374 7265 616d 290a 2020  _data_stream).  
-00014a80: 2020 2020 2020 5555 542e 6465 636f 6465        UUT.decode
-00014a90: 5f66 696c 655f 6865 6164 6572 7328 290a  _file_headers().
-00014aa0: 0a20 2020 2020 2020 206c 6f63 616c 5f69  .        local_i
-00014ab0: 6473 203d 2073 6574 2829 0a20 2020 2020  ds = set().     
-00014ac0: 2020 2066 6c6f 775f 6964 7320 3d20 7365     flow_ids = se
-00014ad0: 7428 290a 2020 2020 2020 2020 666f 7220  t().        for 
-00014ae0: 2867 7261 696e 2c20 6c6f 6361 6c5f 6964  (grain, local_id
-00014af0: 2920 696e 2055 5554 2e67 7261 696e 7328  ) in UUT.grains(
-00014b00: 293a 0a20 2020 2020 2020 2020 2020 206c  ):.            l
-00014b10: 6f63 616c 5f69 6473 2e61 6464 286c 6f63  ocal_ids.add(loc
-00014b20: 616c 5f69 6429 0a20 2020 2020 2020 2020  al_id).         
-00014b30: 2020 2066 6c6f 775f 6964 732e 6164 6428     flow_ids.add(
-00014b40: 6772 6169 6e2e 666c 6f77 5f69 6429 0a0a  grain.flow_id)..
-00014b50: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-00014b60: 6572 7445 7175 616c 286c 6f63 616c 5f69  ertEqual(local_i
-00014b70: 6473 2c20 7365 7428 5b31 2c20 325d 2929  ds, set([1, 2]))
-00014b80: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-00014b90: 7365 7274 4571 7561 6c28 666c 6f77 5f69  sertEqual(flow_i
-00014ba0: 6473 2c20 7365 7428 5b55 5549 4428 2732  ds, set([UUID('2
-00014bb0: 3865 3465 3039 652d 3335 3137 2d31 3165  8e4e09e-3517-11e
-00014bc0: 392d 3864 6132 2d35 3036 3566 3334 6564  9-8da2-5065f34ed
-00014bd0: 3030 3727 292c 0a20 2020 2020 2020 2020  007'),.         
-00014be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014bf0: 2020 2020 2020 2020 2020 2020 2020 2055                 U
-00014c00: 5549 4428 2732 3437 3266 3338 652d 3335  UID('2472f38e-35
-00014c10: 3137 2d31 3165 392d 3864 6132 2d35 3036  17-11e9-8da2-506
-00014c20: 3566 3334 6564 3030 3727 295d 2929 0a0a  5f34ed007')]))..
-00014c30: 2020 2020 2020 2020 696e 7465 726c 6561          interlea
-00014c40: 7665 645f 6461 7461 5f73 7472 6561 6d2e  ved_data_stream.
-00014c50: 7365 656b 2830 290a 2020 2020 2020 2020  seek(0).        
-00014c60: 5555 542e 6465 636f 6465 5f66 696c 655f  UUT.decode_file_
-00014c70: 6865 6164 6572 7328 290a 0a20 2020 2020  headers()..     
-00014c80: 2020 2066 6f72 2028 6772 6169 6e2c 206c     for (grain, l
-00014c90: 6f63 616c 5f69 6429 2069 6e20 5555 542e  ocal_id) in UUT.
-00014ca0: 6772 6169 6e73 286c 6f63 616c 5f69 6473  grains(local_ids
-00014cb0: 3d5b 315d 293a 0a20 2020 2020 2020 2020  =[1]):.         
-00014cc0: 2020 2073 656c 662e 6173 7365 7274 4973     self.assertIs
-00014cd0: 496e 7374 616e 6365 2867 7261 696e 2c20  Instance(grain, 
-00014ce0: 4155 4449 4f47 5241 494e 290a 2020 2020  AUDIOGRAIN).    
-00014cf0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-00014d00: 6572 7445 7175 616c 2867 7261 696e 2e73  ertEqual(grain.s
-00014d10: 6f75 7263 655f 6964 2c20 5555 4944 2827  ource_id, UUID('
-00014d20: 3166 3866 6432 3765 2d33 3531 372d 3131  1f8fd27e-3517-11
-00014d30: 6539 2d38 6461 322d 3530 3635 6633 3465  e9-8da2-5065f34e
-00014d40: 6430 3037 2729 290a 2020 2020 2020 2020  d007')).        
-00014d50: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-00014d60: 7175 616c 2867 7261 696e 2e66 6c6f 775f  qual(grain.flow_
-00014d70: 6964 2c20 5555 4944 2827 3238 6534 6530  id, UUID('28e4e0
-00014d80: 3965 2d33 3531 372d 3131 6539 2d38 6461  9e-3517-11e9-8da
-00014d90: 322d 3530 3635 6633 3465 6430 3037 2729  2-5065f34ed007')
-00014da0: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
-00014db0: 6c66 2e61 7373 6572 7445 7175 616c 286c  lf.assertEqual(l
-00014dc0: 6f63 616c 5f69 642c 2031 290a 0a20 2020  ocal_id, 1)..   
-00014dd0: 2020 2020 2069 6e74 6572 6c65 6176 6564       interleaved
-00014de0: 5f64 6174 615f 7374 7265 616d 2e73 6565  _data_stream.see
-00014df0: 6b28 3029 0a20 2020 2020 2020 2055 5554  k(0).        UUT
-00014e00: 2e64 6563 6f64 655f 6669 6c65 5f68 6561  .decode_file_hea
-00014e10: 6465 7273 2829 0a0a 2020 2020 2020 2020  ders()..        
-00014e20: 666f 7220 2867 7261 696e 2c20 6c6f 6361  for (grain, loca
-00014e30: 6c5f 6964 2920 696e 2055 5554 2e67 7261  l_id) in UUT.gra
-00014e40: 696e 7328 6c6f 6361 6c5f 6964 733d 5b32  ins(local_ids=[2
-00014e50: 5d29 3a0a 2020 2020 2020 2020 2020 2020  ]):.            
-00014e60: 7365 6c66 2e61 7373 6572 7449 7349 6e73  self.assertIsIns
-00014e70: 7461 6e63 6528 6772 6169 6e2c 2056 4944  tance(grain, VID
-00014e80: 454f 4752 4149 4e29 0a20 2020 2020 2020  EOGRAIN).       
-00014e90: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00014ea0: 4571 7561 6c28 6772 6169 6e2e 736f 7572  Equal(grain.sour
-00014eb0: 6365 5f69 642c 2055 5549 4428 2731 6638  ce_id, UUID('1f8
-00014ec0: 6664 3237 652d 3335 3137 2d31 3165 392d  fd27e-3517-11e9-
-00014ed0: 3864 6132 2d35 3036 3566 3334 6564 3030  8da2-5065f34ed00
-00014ee0: 3727 2929 0a20 2020 2020 2020 2020 2020  7')).           
-00014ef0: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-00014f00: 6c28 6772 6169 6e2e 666c 6f77 5f69 642c  l(grain.flow_id,
-00014f10: 2055 5549 4428 2732 3437 3266 3338 652d   UUID('2472f38e-
-00014f20: 3335 3137 2d31 3165 392d 3864 6132 2d35  3517-11e9-8da2-5
-00014f30: 3036 3566 3334 6564 3030 3727 2929 0a20  065f34ed007')). 
-00014f40: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00014f50: 6173 7365 7274 4571 7561 6c28 6c6f 6361  assertEqual(loca
-00014f60: 6c5f 6964 2c20 3229 0a0a 2020 2020 4073  l_id, 2)..    @s
-00014f70: 7570 7072 6573 735f 6465 7072 6563 6174  uppress_deprecat
-00014f80: 696f 6e5f 7761 726e 696e 6773 0a20 2020  ion_warnings.   
-00014f90: 2064 6566 2074 6573 745f 736b 6970 5f67   def test_skip_g
-00014fa0: 7261 696e 5f64 6174 615f 5f64 6570 7265  rain_data__depre
-00014fb0: 6361 7465 6428 7365 6c66 293a 0a20 2020  cated(self):.   
-00014fc0: 2020 2020 2022 2222 5465 7374 2074 6861       """Test tha
-00014fd0: 7420 7468 6520 6073 6b69 705f 6461 7461  t the `skip_data
-00014fe0: 6020 7061 7261 6d65 7465 7220 6361 7573  ` parameter caus
-00014ff0: 6573 2067 7261 696e 2064 6174 6120 746f  es grain data to
-00015000: 2062 6520 7365 656b 6564 206f 7665 7222   be seeked over"
-00015010: 2222 0a20 2020 2020 2020 2067 7261 696e  "".        grain
-00015020: 5f73 697a 6520 3d20 3139 3436 3132 2020  _size = 194612  
-00015030: 2320 5061 7273 6564 2066 726f 6d20 6578  # Parsed from ex
-00015040: 616d 706c 6573 2f76 6964 656f 2e67 7366  amples/video.gsf
-00015050: 2068 6578 2064 756d 700a 2020 2020 2020   hex dump.      
-00015060: 2020 6772 6474 5f62 6c6f 636b 5f73 697a    grdt_block_siz
-00015070: 6520 3d20 3139 3434 3038 2020 2320 5061  e = 194408  # Pa
-00015080: 7273 6564 2066 726f 6d20 6578 616d 706c  rsed from exampl
-00015090: 6573 2f76 6964 656f 2e67 7366 2068 6578  es/video.gsf hex
-000150a0: 2064 756d 700a 2020 2020 2020 2020 6772   dump.        gr
-000150b0: 6169 6e5f 6865 6164 6572 5f73 697a 6520  ain_header_size 
-000150c0: 3d20 6772 6169 6e5f 7369 7a65 202d 2067  = grain_size - g
-000150d0: 7264 745f 626c 6f63 6b5f 7369 7a65 0a0a  rdt_block_size..
-000150e0: 2020 2020 2020 2020 7669 6465 6f5f 6461          video_da
-000150f0: 7461 5f73 7472 6561 6d20 3d20 4279 7465  ta_stream = Byte
-00015100: 7349 4f28 5649 4445 4f5f 4441 5441 290a  sIO(VIDEO_DATA).
-00015110: 0a20 2020 2020 2020 2055 5554 203d 2047  .        UUT = G
-00015120: 5346 4465 636f 6465 7228 6669 6c65 5f64  SFDecoder(file_d
-00015130: 6174 613d 7669 6465 6f5f 6461 7461 5f73  ata=video_data_s
-00015140: 7472 6561 6d29 0a20 2020 2020 2020 2055  tream).        U
-00015150: 5554 2e64 6563 6f64 655f 6669 6c65 5f68  UT.decode_file_h
-00015160: 6561 6465 7273 2829 0a0a 2020 2020 2020  eaders()..      
-00015170: 2020 7265 6164 6572 5f6d 6f63 6b20 3d20    reader_mock = 
-00015180: 6d6f 636b 2e4d 6167 6963 4d6f 636b 2873  mock.MagicMock(s
-00015190: 6964 655f 6566 6665 6374 3d76 6964 656f  ide_effect=video
-000151a0: 5f64 6174 615f 7374 7265 616d 2e72 6561  _data_stream.rea
-000151b0: 6429 0a20 2020 2020 2020 2077 6974 6820  d).        with 
-000151c0: 6d6f 636b 2e70 6174 6368 2e6f 626a 6563  mock.patch.objec
-000151d0: 7428 7669 6465 6f5f 6461 7461 5f73 7472  t(video_data_str
-000151e0: 6561 6d2c 2022 7265 6164 222c 206e 6577  eam, "read", new
-000151f0: 3d72 6561 6465 725f 6d6f 636b 293a 0a20  =reader_mock):. 
-00015200: 2020 2020 2020 2020 2020 2066 6f72 2028             for (
-00015210: 6772 6169 6e2c 206c 6f63 616c 5f69 6429  grain, local_id)
-00015220: 2069 6e20 5555 542e 6772 6169 6e73 2873   in UUT.grains(s
-00015230: 6b69 705f 6461 7461 3d54 7275 6529 3a0a  kip_data=True):.
-00015240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015250: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-00015260: 2830 2c20 6c65 6e28 6772 6169 6e2e 6461  (0, len(grain.da
-00015270: 7461 2929 0a0a 2020 2020 2020 2020 2020  ta))..          
-00015280: 2020 2020 2020 2320 4164 6420 7570 2074        # Add up t
-00015290: 6865 2062 7974 6573 2072 6561 6420 666f  he bytes read fo
-000152a0: 7220 7468 6973 2067 7261 696e 2c20 7468  r this grain, th
-000152b0: 656e 2072 6573 6574 2074 6865 2072 6561  en reset the rea
-000152c0: 6420 636f 756e 7465 720a 2020 2020 2020  d counter.      
-000152d0: 2020 2020 2020 2020 2020 6279 7465 735f            bytes_
-000152e0: 7265 6164 203d 2030 0a20 2020 2020 2020  read = 0.       
-000152f0: 2020 2020 2020 2020 2066 6f72 2061 7267           for arg
-00015300: 732c 205f 2069 6e20 7265 6164 6572 5f6d  s, _ in reader_m
-00015310: 6f63 6b2e 6361 6c6c 5f61 7267 735f 6c69  ock.call_args_li
-00015320: 7374 3a0a 2020 2020 2020 2020 2020 2020  st:.            
-00015330: 2020 2020 2020 2020 6279 7465 735f 7265          bytes_re
-00015340: 6164 202b 3d20 6172 6773 5b30 5d0a 0a20  ad += args[0].. 
-00015350: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00015360: 6561 6465 725f 6d6f 636b 2e72 6573 6574  eader_mock.reset
-00015370: 5f6d 6f63 6b28 290a 0a20 2020 2020 2020  _mock()..       
-00015380: 2020 2020 2020 2020 2023 204e 6f20 6d6f           # No mo
-00015390: 7265 2074 6861 6e20 7468 6520 6e75 6d62  re than the numb
-000153a0: 6572 206f 6620 6279 7465 7320 696e 2074  er of bytes in t
-000153b0: 6865 2068 6561 6465 7220 7368 6f75 6c64  he header should
-000153c0: 2068 6176 6520 6265 656e 2072 6561 640a   have been read.
-000153d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000153e0: 2320 486f 7765 7665 7220 736f 6d65 2068  # However some h
-000153f0: 6561 6465 7220 6279 7465 7320 6d61 7920  eader bytes may 
-00015400: 6265 2073 6565 6b65 6420 6f76 6572 2069  be seeked over i
-00015410: 6e73 7465 6164 0a20 2020 2020 2020 2020  nstead.         
-00015420: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00015430: 7274 4c65 7373 4571 7561 6c28 6279 7465  rtLessEqual(byte
-00015440: 735f 7265 6164 2c20 6772 6169 6e5f 6865  s_read, grain_he
-00015450: 6164 6572 5f73 697a 6529 0a0a 2020 2020  ader_size)..    
-00015460: 6465 6620 7465 7374 5f6c 617a 795f 6c6f  def test_lazy_lo
-00015470: 6164 5f67 7261 696e 5f64 6174 6128 7365  ad_grain_data(se
-00015480: 6c66 293a 0a20 2020 2020 2020 2022 2222  lf):.        """
-00015490: 5465 7374 2074 6861 7420 7468 6520 606c  Test that the `l
-000154a0: 6f61 645f 6c61 7a69 6c79 6020 7061 7261  oad_lazily` para
-000154b0: 6d65 7465 7220 6361 7573 6573 2067 7261  meter causes gra
-000154c0: 696e 2064 6174 6120 746f 2062 6520 7365  in data to be se
-000154d0: 656b 6564 206f 7665 722c 0a20 2020 2020  eked over,.     
-000154e0: 2020 2062 7574 2074 6865 6e20 6c6f 6164     but then load
-000154f0: 6564 2069 6e76 6973 6962 6c79 2077 6865  ed invisibly whe
-00015500: 6e20 6e65 6564 6564 206c 6174 6572 2222  n needed later""
-00015510: 220a 2020 2020 2020 2020 6772 6169 6e5f  ".        grain_
-00015520: 7369 7a65 203d 2031 3934 3631 3220 2023  size = 194612  #
-00015530: 2050 6172 7365 6420 6672 6f6d 2065 7861   Parsed from exa
-00015540: 6d70 6c65 732f 7669 6465 6f2e 6773 6620  mples/video.gsf 
-00015550: 6865 7820 6475 6d70 0a20 2020 2020 2020  hex dump.       
-00015560: 2067 7264 745f 626c 6f63 6b5f 7369 7a65   grdt_block_size
-00015570: 203d 2031 3934 3430 3820 2023 2050 6172   = 194408  # Par
-00015580: 7365 6420 6672 6f6d 2065 7861 6d70 6c65  sed from example
-00015590: 732f 7669 6465 6f2e 6773 6620 6865 7820  s/video.gsf hex 
-000155a0: 6475 6d70 0a20 2020 2020 2020 2067 7261  dump.        gra
-000155b0: 696e 5f68 6561 6465 725f 7369 7a65 203d  in_header_size =
-000155c0: 2067 7261 696e 5f73 697a 6520 2d20 6772   grain_size - gr
-000155d0: 6474 5f62 6c6f 636b 5f73 697a 650a 2020  dt_block_size.  
-000155e0: 2020 2020 2020 6772 6169 6e5f 6461 7461        grain_data
-000155f0: 5f73 697a 6520 3d20 6772 6474 5f62 6c6f  _size = grdt_blo
-00015600: 636b 5f73 697a 6520 2d20 380a 0a20 2020  ck_size - 8..   
-00015610: 2020 2020 2076 6964 656f 5f64 6174 615f       video_data_
-00015620: 7374 7265 616d 203d 2042 7974 6573 494f  stream = BytesIO
-00015630: 2856 4944 454f 5f44 4154 4129 0a0a 2020  (VIDEO_DATA)..  
-00015640: 2020 2020 2020 7265 6164 6572 5f6d 6f63        reader_moc
-00015650: 6b20 3d20 6d6f 636b 2e4d 6167 6963 4d6f  k = mock.MagicMo
-00015660: 636b 2873 6964 655f 6566 6665 6374 3d76  ck(side_effect=v
-00015670: 6964 656f 5f64 6174 615f 7374 7265 616d  ideo_data_stream
-00015680: 2e72 6561 6429 0a20 2020 2020 2020 2077  .read).        w
-00015690: 6974 6820 6d6f 636b 2e70 6174 6368 2e6f  ith mock.patch.o
-000156a0: 626a 6563 7428 7669 6465 6f5f 6461 7461  bject(video_data
-000156b0: 5f73 7472 6561 6d2c 2022 7265 6164 222c  _stream, "read",
-000156c0: 206e 6577 3d72 6561 6465 725f 6d6f 636b   new=reader_mock
-000156d0: 293a 0a20 2020 2020 2020 2020 2020 2067  ):.            g
-000156e0: 7261 696e 7320 3d20 5b5d 0a20 2020 2020  rains = [].     
-000156f0: 2020 2020 2020 2077 6974 6820 4753 4644         with GSFD
-00015700: 6563 6f64 6572 2866 696c 655f 6461 7461  ecoder(file_data
-00015710: 3d76 6964 656f 5f64 6174 615f 7374 7265  =video_data_stre
-00015720: 616d 2920 6173 2064 6563 3a0a 2020 2020  am) as dec:.    
-00015730: 2020 2020 2020 2020 2020 2020 7265 6164              read
-00015740: 6572 5f6d 6f63 6b2e 7265 7365 745f 6d6f  er_mock.reset_mo
-00015750: 636b 2829 0a0a 2020 2020 2020 2020 2020  ck()..          
-00015760: 2020 2020 2020 666f 7220 2867 7261 696e        for (grain
-00015770: 2c20 6c6f 6361 6c5f 6964 2920 696e 2064  , local_id) in d
-00015780: 6563 2e67 7261 696e 7328 6c6f 6164 696e  ec.grains(loadin
-00015790: 675f 6d6f 6465 3d47 7261 696e 4461 7461  g_mode=GrainData
-000157a0: 4c6f 6164 696e 674d 6f64 652e 414c 5741  LoadingMode.ALWA
-000157b0: 5953 5f44 4546 4552 5f4c 4f41 445f 4946  YS_DEFER_LOAD_IF
-000157c0: 5f50 4f53 5349 424c 4529 3a0a 2020 2020  _POSSIBLE):.    
-000157d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000157e0: 6772 6169 6e73 2e61 7070 656e 6428 6772  grains.append(gr
-000157f0: 6169 6e29 0a20 2020 2020 2020 2020 2020  ain).           
-00015800: 2020 2020 2020 2020 2023 2041 6464 2075           # Add u
-00015810: 7020 7468 6520 6279 7465 7320 7265 6164  p the bytes read
-00015820: 2066 6f72 2074 6869 7320 6772 6169 6e2c   for this grain,
-00015830: 2074 6865 6e20 7265 7365 7420 7468 6520   then reset the 
-00015840: 7265 6164 2063 6f75 6e74 6572 0a20 2020  read counter.   
-00015850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015860: 2062 7974 6573 5f72 6561 6420 3d20 300a   bytes_read = 0.
-00015870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015880: 2020 2020 666f 7220 6172 6773 2c20 5f20      for args, _ 
-00015890: 696e 2072 6561 6465 725f 6d6f 636b 2e63  in reader_mock.c
-000158a0: 616c 6c5f 6172 6773 5f6c 6973 743a 0a20  all_args_list:. 
-000158b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000158c0: 2020 2020 2020 2062 7974 6573 5f72 6561         bytes_rea
-000158d0: 6420 2b3d 2061 7267 735b 305d 0a0a 2020  d += args[0]..  
-000158e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000158f0: 2020 7265 6164 6572 5f6d 6f63 6b2e 7265    reader_mock.re
-00015900: 7365 745f 6d6f 636b 2829 0a0a 2020 2020  set_mock()..    
-00015910: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015920: 2320 4e6f 206d 6f72 6520 7468 616e 2074  # No more than t
-00015930: 6865 206e 756d 6265 7220 6f66 2062 7974  he number of byt
-00015940: 6573 2069 6e20 7468 6520 6865 6164 6572  es in the header
-00015950: 2073 686f 756c 6420 6861 7665 2062 6565   should have bee
-00015960: 6e20 7265 6164 0a20 2020 2020 2020 2020  n read.         
-00015970: 2020 2020 2020 2020 2020 2023 2048 6f77             # How
-00015980: 6576 6572 2073 6f6d 6520 6865 6164 6572  ever some header
-00015990: 2062 7974 6573 206d 6179 2062 6520 7365   bytes may be se
-000159a0: 656b 6564 206f 7665 7220 696e 7374 6561  eked over instea
-000159b0: 640a 2020 2020 2020 2020 2020 2020 2020  d.              
-000159c0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-000159d0: 7447 7265 6174 6572 2862 7974 6573 5f72  tGreater(bytes_r
-000159e0: 6561 642c 2030 290a 2020 2020 2020 2020  ead, 0).        
-000159f0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00015a00: 2e61 7373 6572 744c 6573 7345 7175 616c  .assertLessEqual
-00015a10: 2862 7974 6573 5f72 6561 642c 2067 7261  (bytes_read, gra
-00015a20: 696e 5f68 6561 6465 725f 7369 7a65 290a  in_header_size).
-00015a30: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-00015a40: 2067 7261 696e 2069 6e20 6772 6169 6e73   grain in grains
-00015a50: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00015a60: 2020 7265 6164 6572 5f6d 6f63 6b2e 7265    reader_mock.re
-00015a70: 7365 745f 6d6f 636b 2829 0a0a 2020 2020  set_mock()..    
-00015a80: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00015a90: 2e61 7373 6572 7445 7175 616c 2867 7261  .assertEqual(gra
-00015aa0: 696e 2e6c 656e 6774 682c 2067 7261 696e  in.length, grain
-00015ab0: 5f64 6174 615f 7369 7a65 290a 2020 2020  _data_size).    
-00015ac0: 2020 2020 2020 2020 2020 2020 7265 6164              read
-00015ad0: 6572 5f6d 6f63 6b2e 6173 7365 7274 5f6e  er_mock.assert_n
-00015ae0: 6f74 5f63 616c 6c65 6428 290a 0a20 2020  ot_called()..   
-00015af0: 2020 2020 2020 2020 2020 2020 2078 203d               x =
-00015b00: 2067 7261 696e 2e64 6174 615b 6772 6169   grain.data[grai
-00015b10: 6e5f 6461 7461 5f73 697a 652d 315d 2020  n_data_size-1]  
-00015b20: 2320 6e6f 7161 3a20 4638 3431 0a20 2020  # noqa: F841.   
-00015b30: 2020 2020 2020 2020 2020 2020 2062 7974               byt
-00015b40: 6573 5f72 6561 6420 3d20 300a 2020 2020  es_read = 0.    
-00015b50: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00015b60: 2861 7267 732c 205f 2920 696e 2072 6561  (args, _) in rea
-00015b70: 6465 725f 6d6f 636b 2e63 616c 6c5f 6172  der_mock.call_ar
-00015b80: 6773 5f6c 6973 743a 0a20 2020 2020 2020  gs_list:.       
-00015b90: 2020 2020 2020 2020 2020 2020 2062 7974               byt
-00015ba0: 6573 5f72 6561 6420 2b3d 2061 7267 735b  es_read += args[
-00015bb0: 305d 0a0a 2020 2020 2020 2020 2020 2020  0]..            
-00015bc0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-00015bd0: 7175 616c 2862 7974 6573 5f72 6561 642c  qual(bytes_read,
-00015be0: 2067 7261 696e 5f64 6174 615f 7369 7a65   grain_data_size
-00015bf0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00015c00: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-00015c10: 616c 2867 7261 696e 2e6c 656e 6774 682c  al(grain.length,
-00015c20: 2067 7261 696e 5f64 6174 615f 7369 7a65   grain_data_size
-00015c30: 290a 0a20 2020 2040 7375 7070 7265 7373  )..    @suppress
-00015c40: 5f64 6570 7265 6361 7469 6f6e 5f77 6172  _deprecation_war
-00015c50: 6e69 6e67 730a 2020 2020 6465 6620 7465  nings.    def te
-00015c60: 7374 5f6c 617a 795f 6c6f 6164 5f67 7261  st_lazy_load_gra
-00015c70: 696e 5f64 6174 615f 5f64 6570 7265 6361  in_data__depreca
-00015c80: 7465 6428 7365 6c66 293a 0a20 2020 2020  ted(self):.     
-00015c90: 2020 2022 2222 5465 7374 2074 6861 7420     """Test that 
-00015ca0: 7468 6520 606c 6f61 645f 6c61 7a69 6c79  the `load_lazily
-00015cb0: 6020 7061 7261 6d65 7465 7220 6361 7573  ` parameter caus
-00015cc0: 6573 2067 7261 696e 2064 6174 6120 746f  es grain data to
-00015cd0: 2062 6520 7365 656b 6564 206f 7665 722c   be seeked over,
-00015ce0: 0a20 2020 2020 2020 2062 7574 2074 6865  .        but the
-00015cf0: 6e20 6c6f 6164 6564 2069 6e76 6973 6962  n loaded invisib
-00015d00: 6c79 2077 6865 6e20 6e65 6564 6564 206c  ly when needed l
-00015d10: 6174 6572 2222 220a 2020 2020 2020 2020  ater""".        
-00015d20: 6772 6169 6e5f 7369 7a65 203d 2031 3934  grain_size = 194
-00015d30: 3631 3220 2023 2050 6172 7365 6420 6672  612  # Parsed fr
-00015d40: 6f6d 2065 7861 6d70 6c65 732f 7669 6465  om examples/vide
-00015d50: 6f2e 6773 6620 6865 7820 6475 6d70 0a20  o.gsf hex dump. 
-00015d60: 2020 2020 2020 2067 7264 745f 626c 6f63         grdt_bloc
-00015d70: 6b5f 7369 7a65 203d 2031 3934 3430 3820  k_size = 194408 
-00015d80: 2023 2050 6172 7365 6420 6672 6f6d 2065   # Parsed from e
-00015d90: 7861 6d70 6c65 732f 7669 6465 6f2e 6773  xamples/video.gs
-00015da0: 6620 6865 7820 6475 6d70 0a20 2020 2020  f hex dump.     
-00015db0: 2020 2067 7261 696e 5f68 6561 6465 725f     grain_header_
-00015dc0: 7369 7a65 203d 2067 7261 696e 5f73 697a  size = grain_siz
-00015dd0: 6520 2d20 6772 6474 5f62 6c6f 636b 5f73  e - grdt_block_s
-00015de0: 697a 650a 2020 2020 2020 2020 6772 6169  ize.        grai
-00015df0: 6e5f 6461 7461 5f73 697a 6520 3d20 6772  n_data_size = gr
-00015e00: 6474 5f62 6c6f 636b 5f73 697a 6520 2d20  dt_block_size - 
-00015e10: 380a 0a20 2020 2020 2020 2076 6964 656f  8..        video
-00015e20: 5f64 6174 615f 7374 7265 616d 203d 2042  _data_stream = B
-00015e30: 7974 6573 494f 2856 4944 454f 5f44 4154  ytesIO(VIDEO_DAT
-00015e40: 4129 0a0a 2020 2020 2020 2020 5555 5420  A)..        UUT 
-00015e50: 3d20 4753 4644 6563 6f64 6572 2866 696c  = GSFDecoder(fil
-00015e60: 655f 6461 7461 3d76 6964 656f 5f64 6174  e_data=video_dat
-00015e70: 615f 7374 7265 616d 290a 2020 2020 2020  a_stream).      
-00015e80: 2020 5555 542e 6465 636f 6465 5f66 696c    UUT.decode_fil
-00015e90: 655f 6865 6164 6572 7328 290a 0a20 2020  e_headers()..   
-00015ea0: 2020 2020 2067 7261 696e 7320 3d20 5b5d       grains = []
-00015eb0: 0a20 2020 2020 2020 2072 6561 6465 725f  .        reader_
-00015ec0: 6d6f 636b 203d 206d 6f63 6b2e 4d61 6769  mock = mock.Magi
-00015ed0: 634d 6f63 6b28 7369 6465 5f65 6666 6563  cMock(side_effec
-00015ee0: 743d 7669 6465 6f5f 6461 7461 5f73 7472  t=video_data_str
-00015ef0: 6561 6d2e 7265 6164 290a 2020 2020 2020  eam.read).      
-00015f00: 2020 7769 7468 206d 6f63 6b2e 7061 7463    with mock.patc
-00015f10: 682e 6f62 6a65 6374 2876 6964 656f 5f64  h.object(video_d
-00015f20: 6174 615f 7374 7265 616d 2c20 2272 6561  ata_stream, "rea
-00015f30: 6422 2c20 6e65 773d 7265 6164 6572 5f6d  d", new=reader_m
-00015f40: 6f63 6b29 3a0a 2020 2020 2020 2020 2020  ock):.          
-00015f50: 2020 666f 7220 2867 7261 696e 2c20 6c6f    for (grain, lo
-00015f60: 6361 6c5f 6964 2920 696e 2055 5554 2e67  cal_id) in UUT.g
-00015f70: 7261 696e 7328 6c6f 6164 5f6c 617a 696c  rains(load_lazil
-00015f80: 793d 5472 7565 293a 0a20 2020 2020 2020  y=True):.       
-00015f90: 2020 2020 2020 2020 2067 7261 696e 732e           grains.
-00015fa0: 6170 7065 6e64 2867 7261 696e 290a 2020  append(grain).  
-00015fb0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00015fc0: 4164 6420 7570 2074 6865 2062 7974 6573  Add up the bytes
-00015fd0: 2072 6561 6420 666f 7220 7468 6973 2067   read for this g
-00015fe0: 7261 696e 2c20 7468 656e 2072 6573 6574  rain, then reset
-00015ff0: 2074 6865 2072 6561 6420 636f 756e 7465   the read counte
-00016000: 720a 2020 2020 2020 2020 2020 2020 2020  r.              
-00016010: 2020 6279 7465 735f 7265 6164 203d 2030    bytes_read = 0
-00016020: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016030: 2066 6f72 2061 7267 732c 205f 2069 6e20   for args, _ in 
-00016040: 7265 6164 6572 5f6d 6f63 6b2e 6361 6c6c  reader_mock.call
-00016050: 5f61 7267 735f 6c69 7374 3a0a 2020 2020  _args_list:.    
-00016060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016070: 6279 7465 735f 7265 6164 202b 3d20 6172  bytes_read += ar
-00016080: 6773 5b30 5d0a 0a20 2020 2020 2020 2020  gs[0]..         
-00016090: 2020 2020 2020 2072 6561 6465 725f 6d6f         reader_mo
-000160a0: 636b 2e72 6573 6574 5f6d 6f63 6b28 290a  ck.reset_mock().
-000160b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000160c0: 2023 204e 6f20 6d6f 7265 2074 6861 6e20   # No more than 
-000160d0: 7468 6520 6e75 6d62 6572 206f 6620 6279  the number of by
-000160e0: 7465 7320 696e 2074 6865 2068 6561 6465  tes in the heade
-000160f0: 7220 7368 6f75 6c64 2068 6176 6520 6265  r should have be
-00016100: 656e 2072 6561 640a 2020 2020 2020 2020  en read.        
-00016110: 2020 2020 2020 2020 2320 486f 7765 7665          # Howeve
-00016120: 7220 736f 6d65 2068 6561 6465 7220 6279  r some header by
-00016130: 7465 7320 6d61 7920 6265 2073 6565 6b65  tes may be seeke
-00016140: 6420 6f76 6572 2069 6e73 7465 6164 0a20  d over instead. 
-00016150: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00016160: 656c 662e 6173 7365 7274 4772 6561 7465  elf.assertGreate
-00016170: 7228 6279 7465 735f 7265 6164 2c20 3029  r(bytes_read, 0)
-00016180: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016190: 2073 656c 662e 6173 7365 7274 4c65 7373   self.assertLess
-000161a0: 4571 7561 6c28 6279 7465 735f 7265 6164  Equal(bytes_read
-000161b0: 2c20 6772 6169 6e5f 6865 6164 6572 5f73  , grain_header_s
-000161c0: 697a 6529 0a0a 2020 2020 2020 2020 2020  ize)..          
-000161d0: 2020 666f 7220 6772 6169 6e20 696e 2067    for grain in g
-000161e0: 7261 696e 733a 0a20 2020 2020 2020 2020  rains:.         
-000161f0: 2020 2020 2020 2072 6561 6465 725f 6d6f         reader_mo
-00016200: 636b 2e72 6573 6574 5f6d 6f63 6b28 290a  ck.reset_mock().
-00016210: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016220: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-00016230: 6c28 6772 6169 6e2e 6c65 6e67 7468 2c20  l(grain.length, 
-00016240: 6772 6169 6e5f 6461 7461 5f73 697a 6529  grain_data_size)
-00016250: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016260: 2072 6561 6465 725f 6d6f 636b 2e61 7373   reader_mock.ass
-00016270: 6572 745f 6e6f 745f 6361 6c6c 6564 2829  ert_not_called()
-00016280: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00016290: 2020 7820 3d20 6772 6169 6e2e 6461 7461    x = grain.data
-000162a0: 5b67 7261 696e 5f64 6174 615f 7369 7a65  [grain_data_size
-000162b0: 2d31 5d20 2023 206e 6f71 613a 2046 3834  -1]  # noqa: F84
-000162c0: 310a 2020 2020 2020 2020 2020 2020 2020  1.              
-000162d0: 2020 6279 7465 735f 7265 6164 203d 2030    bytes_read = 0
-000162e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000162f0: 2066 6f72 2028 6172 6773 2c20 5f29 2069   for (args, _) i
-00016300: 6e20 7265 6164 6572 5f6d 6f63 6b2e 6361  n reader_mock.ca
-00016310: 6c6c 5f61 7267 735f 6c69 7374 3a0a 2020  ll_args_list:.  
-00016320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016330: 2020 6279 7465 735f 7265 6164 202b 3d20    bytes_read += 
-00016340: 6172 6773 5b30 5d0a 0a20 2020 2020 2020  args[0]..       
-00016350: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
-00016360: 7365 7274 4571 7561 6c28 6279 7465 735f  sertEqual(bytes_
-00016370: 7265 6164 2c20 6772 6169 6e5f 6461 7461  read, grain_data
-00016380: 5f73 697a 6529 0a20 2020 2020 2020 2020  _size).         
-00016390: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-000163a0: 7274 4571 7561 6c28 6772 6169 6e2e 6c65  rtEqual(grain.le
-000163b0: 6e67 7468 2c20 6772 6169 6e5f 6461 7461  ngth, grain_data
-000163c0: 5f73 697a 6529 0a0a 0a63 6c61 7373 2054  _size)...class T
-000163d0: 6573 7447 5346 4c6f 6164 7328 4973 6f6c  estGSFLoads(Isol
-000163e0: 6174 6564 4173 796e 6369 6f54 6573 7443  atedAsyncioTestC
-000163f0: 6173 6529 3a0a 2020 2020 6465 6620 7465  ase):.    def te
-00016400: 7374 5f6c 6f61 6473 5f76 6964 656f 2873  st_loads_video(s
-00016410: 656c 6629 3a0a 2020 2020 2020 2020 2868  elf):.        (h
-00016420: 6561 642c 2073 6567 6d65 6e74 7329 203d  ead, segments) =
-00016430: 206c 6f61 6473 2856 4944 454f 5f44 4154   loads(VIDEO_DAT
-00016440: 4129 0a0a 2020 2020 2020 2020 7365 6c66  A)..        self
-00016450: 2e61 7373 6572 7445 7175 616c 2868 6561  .assertEqual(hea
-00016460: 645b 2763 7265 6174 6564 275d 2c20 6461  d['created'], da
-00016470: 7465 7469 6d65 2832 3031 382c 2032 2c20  tetime(2018, 2, 
-00016480: 372c 2031 302c 2033 382c 2032 3229 290a  7, 10, 38, 22)).
-00016490: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-000164a0: 6572 7445 7175 616c 2868 6561 645b 2769  ertEqual(head['i
-000164b0: 6427 5d2c 2055 5549 4428 2731 3633 6664  d'], UUID('163fd
-000164c0: 3962 372d 6265 6634 2d34 6439 322d 3834  9b7-bef4-4d92-84
-000164d0: 3838 2d33 3166 3338 3139 6265 3030 3827  88-31f3819be008'
-000164e0: 2929 0a20 2020 2020 2020 2073 656c 662e  )).        self.
-000164f0: 6173 7365 7274 4571 7561 6c28 6c65 6e28  assertEqual(len(
-00016500: 6865 6164 5b27 7365 676d 656e 7473 275d  head['segments']
-00016510: 292c 2031 290a 2020 2020 2020 2020 7365  ), 1).        se
-00016520: 6c66 2e61 7373 6572 7445 7175 616c 2868  lf.assertEqual(h
-00016530: 6561 645b 2773 6567 6d65 6e74 7327 5d5b  ead['segments'][
-00016540: 305d 5b27 6964 275d 2c20 5555 4944 2827  0]['id'], UUID('
-00016550: 6336 6133 6433 6666 2d37 3463 302d 3434  c6a3d3ff-74c0-44
-00016560: 3664 2d62 3539 652d 6465 3130 3431 6632  6d-b59e-de1041f2
-00016570: 3765 3861 2729 290a 2020 2020 2020 2020  7e8a')).        
-00016580: 7365 6c66 2e61 7373 6572 7449 6e28 6865  self.assertIn(he
-00016590: 6164 5b27 7365 676d 656e 7473 275d 5b30  ad['segments'][0
-000165a0: 5d5b 276c 6f63 616c 5f69 6427 5d2c 2073  ]['local_id'], s
-000165b0: 6567 6d65 6e74 7329 0a20 2020 2020 2020  egments).       
-000165c0: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-000165d0: 6c28 6c65 6e28 7365 676d 656e 7473 5b68  l(len(segments[h
-000165e0: 6561 645b 2773 6567 6d65 6e74 7327 5d5b  ead['segments'][
-000165f0: 305d 5b27 6c6f 6361 6c5f 6964 275d 5d29  0]['local_id']])
-00016600: 2c20 6865 6164 5b27 7365 676d 656e 7473  , head['segments
-00016610: 275d 5b30 5d5b 2763 6f75 6e74 275d 290a  '][0]['count']).
-00016620: 0a20 2020 2020 2020 206f 7473 203d 2054  .        ots = T
-00016630: 696d 6573 7461 6d70 2831 3432 3031 3032  imestamp(1420102
-00016640: 3830 302c 2030 290a 2020 2020 2020 2020  800, 0).        
-00016650: 666f 7220 6772 6169 6e20 696e 2073 6567  for grain in seg
-00016660: 6d65 6e74 735b 6865 6164 5b27 7365 676d  ments[head['segm
-00016670: 656e 7473 275d 5b30 5d5b 276c 6f63 616c  ents'][0]['local
-00016680: 5f69 6427 5d5d 3a0a 2020 2020 2020 2020  _id']]:.        
-00016690: 2020 2020 7365 6c66 2e61 7373 6572 7449      self.assertI
-000166a0: 7349 6e73 7461 6e63 6528 6772 6169 6e2c  sInstance(grain,
-000166b0: 2056 4944 454f 4752 4149 4e29 0a20 2020   VIDEOGRAIN).   
-000166c0: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
-000166d0: 7365 7274 4571 7561 6c28 6772 6169 6e2e  sertEqual(grain.
-000166e0: 6772 6169 6e5f 7479 7065 2c20 2276 6964  grain_type, "vid
-000166f0: 656f 2229 0a20 2020 2020 2020 2020 2020  eo").           
-00016700: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-00016710: 6c28 6772 6169 6e2e 736f 7572 6365 5f69  l(grain.source_i
-00016720: 642c 2055 5549 4428 2734 3935 3738 3535  d, UUID('4957855
-00016730: 322d 6662 3965 2d34 6433 652d 6131 3937  2-fb9e-4d3e-a197
-00016740: 2d33 6533 6334 3337 6138 3935 6427 2929  -3e3c437a895d'))
-00016750: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00016760: 662e 6173 7365 7274 4571 7561 6c28 6772  f.assertEqual(gr
-00016770: 6169 6e2e 666c 6f77 5f69 642c 2055 5549  ain.flow_id, UUI
-00016780: 4428 2736 6535 3566 3235 312d 6637 3561  D('6e55f251-f75a
-00016790: 2d34 6435 362d 6233 6166 2d65 6462 3862  -4d56-b3af-edb8b
-000167a0: 3739 3933 6333 6327 2929 0a20 2020 2020  7993c3c')).     
-000167b0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-000167c0: 7274 4571 7561 6c28 6772 6169 6e2e 6f72  rtEqual(grain.or
-000167d0: 6967 696e 5f74 696d 6573 7461 6d70 2c20  igin_timestamp, 
-000167e0: 6f74 7329 0a20 2020 2020 2020 2020 2020  ots).           
-000167f0: 206f 7473 202b 3d20 5469 6d65 4f66 6673   ots += TimeOffs
-00016800: 6574 2e66 726f 6d5f 6e61 6e6f 7365 6328  et.from_nanosec(
-00016810: 3230 3030 3030 3030 290a 0a20 2020 2020  20000000)..     
-00016820: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00016830: 7274 4571 7561 6c28 6772 6169 6e2e 666f  rtEqual(grain.fo
-00016840: 726d 6174 2c20 436f 6746 7261 6d65 466f  rmat, CogFrameFo
-00016850: 726d 6174 2e55 385f 3432 3029 0a20 2020  rmat.U8_420).   
-00016860: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
-00016870: 7365 7274 4571 7561 6c28 6772 6169 6e2e  sertEqual(grain.
-00016880: 6c61 796f 7574 2c20 436f 6746 7261 6d65  layout, CogFrame
-00016890: 4c61 796f 7574 2e46 554c 4c5f 4652 414d  Layout.FULL_FRAM
-000168a0: 4529 0a20 2020 2020 2020 2020 2020 2073  E).            s
-000168b0: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-000168c0: 6772 6169 6e2e 7769 6474 682c 2034 3830  grain.width, 480
-000168d0: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
-000168e0: 6c66 2e61 7373 6572 7445 7175 616c 2867  lf.assertEqual(g
-000168f0: 7261 696e 2e68 6569 6768 742c 2032 3730  rain.height, 270
-00016900: 290a 0a20 2020 2020 2020 2020 2020 2073  )..            s
-00016910: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-00016920: 6c65 6e28 6772 6169 6e2e 636f 6d70 6f6e  len(grain.compon
-00016930: 656e 7473 292c 2033 290a 0a20 2020 2020  ents), 3)..     
-00016940: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00016950: 7274 4571 7561 6c28 6772 6169 6e2e 636f  rtEqual(grain.co
-00016960: 6d70 6f6e 656e 7473 5b30 5d2e 7769 6474  mponents[0].widt
-00016970: 682c 2034 3830 290a 2020 2020 2020 2020  h, 480).        
-00016980: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-00016990: 7175 616c 2867 7261 696e 2e63 6f6d 706f  qual(grain.compo
-000169a0: 6e65 6e74 735b 305d 2e68 6569 6768 742c  nents[0].height,
-000169b0: 2032 3730 290a 2020 2020 2020 2020 2020   270).          
-000169c0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-000169d0: 616c 2867 7261 696e 2e63 6f6d 706f 6e65  al(grain.compone
-000169e0: 6e74 735b 305d 2e73 7472 6964 652c 2034  nts[0].stride, 4
-000169f0: 3830 290a 2020 2020 2020 2020 2020 2020  80).            
-00016a00: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-00016a10: 2867 7261 696e 2e63 6f6d 706f 6e65 6e74  (grain.component
-00016a20: 735b 305d 2e6c 656e 6774 682c 2034 3830  s[0].length, 480
-00016a30: 2a32 3730 290a 2020 2020 2020 2020 2020  *270).          
-00016a40: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-00016a50: 616c 2867 7261 696e 2e63 6f6d 706f 6e65  al(grain.compone
-00016a60: 6e74 735b 305d 2e6f 6666 7365 742c 2030  nts[0].offset, 0
-00016a70: 290a 0a20 2020 2020 2020 2020 2020 2073  )..            s
-00016a80: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-00016a90: 6772 6169 6e2e 636f 6d70 6f6e 656e 7473  grain.components
-00016aa0: 5b31 5d2e 7769 6474 682c 2032 3430 290a  [1].width, 240).
-00016ab0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00016ac0: 2e61 7373 6572 7445 7175 616c 2867 7261  .assertEqual(gra
-00016ad0: 696e 2e63 6f6d 706f 6e65 6e74 735b 315d  in.components[1]
-00016ae0: 2e68 6569 6768 742c 2031 3335 290a 2020  .height, 135).  
-00016af0: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-00016b00: 7373 6572 7445 7175 616c 2867 7261 696e  ssertEqual(grain
-00016b10: 2e63 6f6d 706f 6e65 6e74 735b 315d 2e73  .components[1].s
-00016b20: 7472 6964 652c 2032 3430 290a 2020 2020  tride, 240).    
-00016b30: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-00016b40: 6572 7445 7175 616c 2867 7261 696e 2e63  ertEqual(grain.c
-00016b50: 6f6d 706f 6e65 6e74 735b 315d 2e6c 656e  omponents[1].len
-00016b60: 6774 682c 2032 3430 2a31 3335 290a 2020  gth, 240*135).  
-00016b70: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-00016b80: 7373 6572 7445 7175 616c 2867 7261 696e  ssertEqual(grain
-00016b90: 2e63 6f6d 706f 6e65 6e74 735b 315d 2e6f  .components[1].o
-00016ba0: 6666 7365 742c 2034 3830 2a32 3730 290a  ffset, 480*270).
-00016bb0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00016bc0: 662e 6173 7365 7274 4571 7561 6c28 6772  f.assertEqual(gr
-00016bd0: 6169 6e2e 636f 6d70 6f6e 656e 7473 5b32  ain.components[2
-00016be0: 5d2e 7769 6474 682c 2032 3430 290a 2020  ].width, 240).  
-00016bf0: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-00016c00: 7373 6572 7445 7175 616c 2867 7261 696e  ssertEqual(grain
-00016c10: 2e63 6f6d 706f 6e65 6e74 735b 325d 2e68  .components[2].h
-00016c20: 6569 6768 742c 2031 3335 290a 2020 2020  eight, 135).    
-00016c30: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-00016c40: 6572 7445 7175 616c 2867 7261 696e 2e63  ertEqual(grain.c
-00016c50: 6f6d 706f 6e65 6e74 735b 325d 2e73 7472  omponents[2].str
-00016c60: 6964 652c 2032 3430 290a 2020 2020 2020  ide, 240).      
-00016c70: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-00016c80: 7445 7175 616c 2867 7261 696e 2e63 6f6d  tEqual(grain.com
-00016c90: 706f 6e65 6e74 735b 325d 2e6c 656e 6774  ponents[2].lengt
-00016ca0: 682c 2032 3430 2a31 3335 290a 2020 2020  h, 240*135).    
-00016cb0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-00016cc0: 6572 7445 7175 616c 2867 7261 696e 2e63  ertEqual(grain.c
-00016cd0: 6f6d 706f 6e65 6e74 735b 325d 2e6f 6666  omponents[2].off
-00016ce0: 7365 742c 2034 3830 2a32 3730 202b 2032  set, 480*270 + 2
-00016cf0: 3430 2a31 3335 290a 0a20 2020 2020 2020  40*135)..       
-00016d00: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00016d10: 4571 7561 6c28 0a20 2020 2020 2020 2020  Equal(.         
-00016d20: 2020 2020 2020 206c 656e 2867 7261 696e         len(grain
-00016d30: 2e64 6174 6129 2c0a 2020 2020 2020 2020  .data),.        
-00016d40: 2020 2020 2020 2020 6772 6169 6e2e 636f          grain.co
-00016d50: 6d70 6f6e 656e 7473 5b30 5d2e 6c65 6e67  mponents[0].leng
-00016d60: 7468 202b 2067 7261 696e 2e63 6f6d 706f  th + grain.compo
-00016d70: 6e65 6e74 735b 315d 2e6c 656e 6774 6820  nents[1].length 
-00016d80: 2b20 6772 6169 6e2e 636f 6d70 6f6e 656e  + grain.componen
-00016d90: 7473 5b32 5d2e 6c65 6e67 7468 290a 0a20  ts[2].length).. 
-00016da0: 2020 2064 6566 2074 6573 745f 6c6f 6164     def test_load
-00016db0: 5f76 6964 656f 2873 656c 6629 3a0a 2020  _video(self):.  
-00016dc0: 2020 2020 2020 6669 6c65 203d 2042 7974        file = Byt
-00016dd0: 6573 494f 2856 4944 454f 5f44 4154 4129  esIO(VIDEO_DATA)
-00016de0: 0a20 2020 2020 2020 2028 6865 6164 2c20  .        (head, 
-00016df0: 7365 676d 656e 7473 2920 3d20 6c6f 6164  segments) = load
-00016e00: 2866 696c 6529 0a0a 2020 2020 2020 2020  (file)..        
-00016e10: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-00016e20: 2868 6561 645b 2763 7265 6174 6564 275d  (head['created']
-00016e30: 2c20 6461 7465 7469 6d65 2832 3031 382c  , datetime(2018,
-00016e40: 2032 2c20 372c 2031 302c 2033 382c 2032   2, 7, 10, 38, 2
-00016e50: 3229 290a 2020 2020 2020 2020 7365 6c66  2)).        self
-00016e60: 2e61 7373 6572 7445 7175 616c 2868 6561  .assertEqual(hea
-00016e70: 645b 2769 6427 5d2c 2055 5549 4428 2731  d['id'], UUID('1
-00016e80: 3633 6664 3962 372d 6265 6634 2d34 6439  63fd9b7-bef4-4d9
-00016e90: 322d 3834 3838 2d33 3166 3338 3139 6265  2-8488-31f3819be
-00016ea0: 3030 3827 2929 0a20 2020 2020 2020 2073  008')).        s
-00016eb0: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-00016ec0: 6c65 6e28 6865 6164 5b27 7365 676d 656e  len(head['segmen
-00016ed0: 7473 275d 292c 2031 290a 2020 2020 2020  ts']), 1).      
-00016ee0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-00016ef0: 616c 2868 6561 645b 2773 6567 6d65 6e74  al(head['segment
-00016f00: 7327 5d5b 305d 5b27 6964 275d 2c20 5555  s'][0]['id'], UU
-00016f10: 4944 2827 6336 6133 6433 6666 2d37 3463  ID('c6a3d3ff-74c
-00016f20: 302d 3434 3664 2d62 3539 652d 6465 3130  0-446d-b59e-de10
-00016f30: 3431 6632 3765 3861 2729 290a 2020 2020  41f27e8a')).    
-00016f40: 2020 2020 7365 6c66 2e61 7373 6572 7449      self.assertI
-00016f50: 6e28 6865 6164 5b27 7365 676d 656e 7473  n(head['segments
-00016f60: 275d 5b30 5d5b 276c 6f63 616c 5f69 6427  '][0]['local_id'
-00016f70: 5d2c 2073 6567 6d65 6e74 7329 0a20 2020  ], segments).   
-00016f80: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00016f90: 4571 7561 6c28 6c65 6e28 7365 676d 656e  Equal(len(segmen
-00016fa0: 7473 5b68 6561 645b 2773 6567 6d65 6e74  ts[head['segment
-00016fb0: 7327 5d5b 305d 5b27 6c6f 6361 6c5f 6964  s'][0]['local_id
-00016fc0: 275d 5d29 2c20 6865 6164 5b27 7365 676d  ']]), head['segm
-00016fd0: 656e 7473 275d 5b30 5d5b 2763 6f75 6e74  ents'][0]['count
-00016fe0: 275d 290a 0a20 2020 2020 2020 206f 7473  '])..        ots
-00016ff0: 203d 2054 696d 6573 7461 6d70 2831 3432   = Timestamp(142
-00017000: 3031 3032 3830 302c 2030 290a 2020 2020  0102800, 0).    
-00017010: 2020 2020 666f 7220 6772 6169 6e20 696e      for grain in
-00017020: 2073 6567 6d65 6e74 735b 6865 6164 5b27   segments[head['
-00017030: 7365 676d 656e 7473 275d 5b30 5d5b 276c  segments'][0]['l
-00017040: 6f63 616c 5f69 6427 5d5d 3a0a 2020 2020  ocal_id']]:.    
-00017050: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-00017060: 6572 7449 7349 6e73 7461 6e63 6528 6772  ertIsInstance(gr
-00017070: 6169 6e2c 2056 4944 454f 4752 4149 4e29  ain, VIDEOGRAIN)
-00017080: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00017090: 662e 6173 7365 7274 4571 7561 6c28 6772  f.assertEqual(gr
-000170a0: 6169 6e2e 6772 6169 6e5f 7479 7065 2c20  ain.grain_type, 
-000170b0: 2276 6964 656f 2229 0a20 2020 2020 2020  "video").       
-000170c0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-000170d0: 4571 7561 6c28 6772 6169 6e2e 736f 7572  Equal(grain.sour
-000170e0: 6365 5f69 642c 2055 5549 4428 2734 3935  ce_id, UUID('495
-000170f0: 3738 3535 322d 6662 3965 2d34 6433 652d  78552-fb9e-4d3e-
-00017100: 6131 3937 2d33 6533 6334 3337 6138 3935  a197-3e3c437a895
-00017110: 6427 2929 0a20 2020 2020 2020 2020 2020  d')).           
-00017120: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-00017130: 6c28 6772 6169 6e2e 666c 6f77 5f69 642c  l(grain.flow_id,
-00017140: 2055 5549 4428 2736 6535 3566 3235 312d   UUID('6e55f251-
-00017150: 6637 3561 2d34 6435 362d 6233 6166 2d65  f75a-4d56-b3af-e
-00017160: 6462 3862 3739 3933 6333 6327 2929 0a20  db8b7993c3c')). 
-00017170: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00017180: 6173 7365 7274 4571 7561 6c28 6772 6169  assertEqual(grai
-00017190: 6e2e 6f72 6967 696e 5f74 696d 6573 7461  n.origin_timesta
-000171a0: 6d70 2c20 6f74 7329 0a20 2020 2020 2020  mp, ots).       
-000171b0: 2020 2020 206f 7473 202b 3d20 5469 6d65       ots += Time
-000171c0: 4f66 6673 6574 2e66 726f 6d5f 6e61 6e6f  Offset.from_nano
-000171d0: 7365 6328 3230 3030 3030 3030 290a 0a20  sec(20000000).. 
-000171e0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-000171f0: 6173 7365 7274 4571 7561 6c28 6772 6169  assertEqual(grai
-00017200: 6e2e 666f 726d 6174 2c20 436f 6746 7261  n.format, CogFra
-00017210: 6d65 466f 726d 6174 2e55 385f 3432 3029  meFormat.U8_420)
-00017220: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00017230: 662e 6173 7365 7274 4571 7561 6c28 6772  f.assertEqual(gr
-00017240: 6169 6e2e 6c61 796f 7574 2c20 436f 6746  ain.layout, CogF
-00017250: 7261 6d65 4c61 796f 7574 2e46 554c 4c5f  rameLayout.FULL_
-00017260: 4652 414d 4529 0a20 2020 2020 2020 2020  FRAME).         
-00017270: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-00017280: 7561 6c28 6772 6169 6e2e 7769 6474 682c  ual(grain.width,
-00017290: 2034 3830 290a 2020 2020 2020 2020 2020   480).          
-000172a0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-000172b0: 616c 2867 7261 696e 2e68 6569 6768 742c  al(grain.height,
-000172c0: 2032 3730 290a 0a20 2020 2020 2020 2020   270)..         
-000172d0: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-000172e0: 7561 6c28 6c65 6e28 6772 6169 6e2e 636f  ual(len(grain.co
-000172f0: 6d70 6f6e 656e 7473 292c 2033 290a 0a20  mponents), 3).. 
-00017300: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00017310: 6173 7365 7274 4571 7561 6c28 6772 6169  assertEqual(grai
-00017320: 6e2e 636f 6d70 6f6e 656e 7473 5b30 5d2e  n.components[0].
-00017330: 7769 6474 682c 2034 3830 290a 2020 2020  width, 480).    
-00017340: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-00017350: 6572 7445 7175 616c 2867 7261 696e 2e63  ertEqual(grain.c
-00017360: 6f6d 706f 6e65 6e74 735b 305d 2e68 6569  omponents[0].hei
-00017370: 6768 742c 2032 3730 290a 2020 2020 2020  ght, 270).      
-00017380: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-00017390: 7445 7175 616c 2867 7261 696e 2e63 6f6d  tEqual(grain.com
-000173a0: 706f 6e65 6e74 735b 305d 2e73 7472 6964  ponents[0].strid
-000173b0: 652c 2034 3830 290a 2020 2020 2020 2020  e, 480).        
-000173c0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-000173d0: 7175 616c 2867 7261 696e 2e63 6f6d 706f  qual(grain.compo
-000173e0: 6e65 6e74 735b 305d 2e6c 656e 6774 682c  nents[0].length,
-000173f0: 2034 3830 2a32 3730 290a 0a20 2020 2020   480*270)..     
-00017400: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00017410: 7274 4571 7561 6c28 6772 6169 6e2e 636f  rtEqual(grain.co
-00017420: 6d70 6f6e 656e 7473 5b31 5d2e 7769 6474  mponents[1].widt
-00017430: 682c 2032 3430 290a 2020 2020 2020 2020  h, 240).        
-00017440: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-00017450: 7175 616c 2867 7261 696e 2e63 6f6d 706f  qual(grain.compo
-00017460: 6e65 6e74 735b 315d 2e68 6569 6768 742c  nents[1].height,
-00017470: 2031 3335 290a 2020 2020 2020 2020 2020   135).          
-00017480: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-00017490: 616c 2867 7261 696e 2e63 6f6d 706f 6e65  al(grain.compone
-000174a0: 6e74 735b 315d 2e73 7472 6964 652c 2032  nts[1].stride, 2
-000174b0: 3430 290a 2020 2020 2020 2020 2020 2020  40).            
-000174c0: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-000174d0: 2867 7261 696e 2e63 6f6d 706f 6e65 6e74  (grain.component
-000174e0: 735b 315d 2e6c 656e 6774 682c 2032 3430  s[1].length, 240
-000174f0: 2a31 3335 290a 0a20 2020 2020 2020 2020  *135)..         
-00017500: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-00017510: 7561 6c28 6772 6169 6e2e 636f 6d70 6f6e  ual(grain.compon
-00017520: 656e 7473 5b32 5d2e 7769 6474 682c 2032  ents[2].width, 2
-00017530: 3430 290a 2020 2020 2020 2020 2020 2020  40).            
-00017540: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-00017550: 2867 7261 696e 2e63 6f6d 706f 6e65 6e74  (grain.component
-00017560: 735b 325d 2e68 6569 6768 742c 2031 3335  s[2].height, 135
-00017570: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
-00017580: 6c66 2e61 7373 6572 7445 7175 616c 2867  lf.assertEqual(g
-00017590: 7261 696e 2e63 6f6d 706f 6e65 6e74 735b  rain.components[
-000175a0: 325d 2e73 7472 6964 652c 2032 3430 290a  2].stride, 240).
-000175b0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-000175c0: 2e61 7373 6572 7445 7175 616c 2867 7261  .assertEqual(gra
-000175d0: 696e 2e63 6f6d 706f 6e65 6e74 735b 325d  in.components[2]
-000175e0: 2e6c 656e 6774 682c 2032 3430 2a31 3335  .length, 240*135
-000175f0: 290a 0a20 2020 2020 2020 2020 2020 2073  )..            s
-00017600: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-00017610: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00017620: 206c 656e 2867 7261 696e 2e64 6174 6129   len(grain.data)
-00017630: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00017640: 2020 6772 6169 6e2e 636f 6d70 6f6e 656e    grain.componen
-00017650: 7473 5b30 5d2e 6c65 6e67 7468 202b 2067  ts[0].length + g
-00017660: 7261 696e 2e63 6f6d 706f 6e65 6e74 735b  rain.components[
-00017670: 315d 2e6c 656e 6774 6820 2b20 6772 6169  1].length + grai
-00017680: 6e2e 636f 6d70 6f6e 656e 7473 5b32 5d2e  n.components[2].
-00017690: 6c65 6e67 7468 290a 0a20 2020 2064 6566  length)..    def
-000176a0: 2074 6573 745f 6c6f 6164 5f75 7365 735f   test_load_uses_
-000176b0: 6375 7374 6f6d 5f67 7261 696e 5f66 756e  custom_grain_fun
-000176c0: 6374 696f 6e28 7365 6c66 293a 0a20 2020  ction(self):.   
-000176d0: 2020 2020 2066 696c 6520 3d20 4279 7465       file = Byte
-000176e0: 7349 4f28 5649 4445 4f5f 4441 5441 290a  sIO(VIDEO_DATA).
-000176f0: 2020 2020 2020 2020 6772 6169 6e5f 7061          grain_pa
-00017700: 7273 6572 203d 206d 6f63 6b2e 4d61 6769  rser = mock.Magi
-00017710: 634d 6f63 6b28 6e61 6d65 3d22 6772 6169  cMock(name="grai
-00017720: 6e5f 7061 7273 6572 2229 0a20 2020 2020  n_parser").     
-00017730: 2020 2028 6865 6164 2c20 7365 676d 656e     (head, segmen
-00017740: 7473 2920 3d20 6c6f 6164 2866 696c 652c  ts) = load(file,
-00017750: 2070 6172 7365 5f67 7261 696e 3d67 7261   parse_grain=gra
-00017760: 696e 5f70 6172 7365 7229 0a0a 2020 2020  in_parser)..    
-00017770: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-00017780: 7175 616c 286c 656e 2873 6567 6d65 6e74  qual(len(segment
-00017790: 7329 2c20 3129 0a20 2020 2020 2020 2073  s), 1).        s
-000177a0: 656c 662e 6173 7365 7274 496e 2831 2c20  elf.assertIn(1, 
-000177b0: 7365 676d 656e 7473 290a 2020 2020 2020  segments).      
-000177c0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-000177d0: 616c 286c 656e 2873 6567 6d65 6e74 735b  al(len(segments[
-000177e0: 315d 292c 2031 3029 0a20 2020 2020 2020  1]), 10).       
-000177f0: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-00017800: 6c28 6772 6169 6e5f 7061 7273 6572 2e63  l(grain_parser.c
-00017810: 616c 6c5f 636f 756e 742c 2031 3029 0a0a  all_count, 10)..
-00017820: 2020 2020 6173 796e 6320 6465 6620 7465      async def te
-00017830: 7374 5f61 7379 6e63 5f6c 6f61 645f 7573  st_async_load_us
-00017840: 6573 5f63 7573 746f 6d5f 6772 6169 6e5f  es_custom_grain_
-00017850: 6675 6e63 7469 6f6e 2873 656c 6629 3a0a  function(self):.
-00017860: 2020 2020 2020 2020 6669 6c65 203d 2041          file = A
-00017870: 7379 6e63 4279 7465 7349 4f28 5649 4445  syncBytesIO(VIDE
-00017880: 4f5f 4441 5441 290a 2020 2020 2020 2020  O_DATA).        
-00017890: 6772 6169 6e5f 7061 7273 6572 203d 206d  grain_parser = m
-000178a0: 6f63 6b2e 4d61 6769 634d 6f63 6b28 6e61  ock.MagicMock(na
-000178b0: 6d65 3d22 6772 6169 6e5f 7061 7273 6572  me="grain_parser
-000178c0: 2229 0a20 2020 2020 2020 2028 6865 6164  ").        (head
-000178d0: 2c20 7365 676d 656e 7473 2920 3d20 6177  , segments) = aw
-000178e0: 6169 7420 6c6f 6164 2866 696c 652c 2070  ait load(file, p
-000178f0: 6172 7365 5f67 7261 696e 3d67 7261 696e  arse_grain=grain
-00017900: 5f70 6172 7365 7229 0a0a 2020 2020 2020  _parser)..      
-00017910: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-00017920: 616c 286c 656e 2873 6567 6d65 6e74 7329  al(len(segments)
-00017930: 2c20 3129 0a20 2020 2020 2020 2073 656c  , 1).        sel
-00017940: 662e 6173 7365 7274 496e 2831 2c20 7365  f.assertIn(1, se
-00017950: 676d 656e 7473 290a 2020 2020 2020 2020  gments).        
-00017960: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-00017970: 286c 656e 2873 6567 6d65 6e74 735b 315d  (len(segments[1]
-00017980: 292c 2031 3029 0a20 2020 2020 2020 2073  ), 10).        s
-00017990: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-000179a0: 6772 6169 6e5f 7061 7273 6572 2e63 616c  grain_parser.cal
-000179b0: 6c5f 636f 756e 742c 2031 3029 0a0a 2020  l_count, 10)..  
-000179c0: 2020 6465 6620 7465 7374 5f6c 6f61 6473    def test_loads
-000179d0: 5f75 7365 735f 6375 7374 6f6d 5f67 7261  _uses_custom_gra
-000179e0: 696e 5f66 756e 6374 696f 6e28 7365 6c66  in_function(self
-000179f0: 293a 0a20 2020 2020 2020 2073 203d 2056  ):.        s = V
-00017a00: 4944 454f 5f44 4154 410a 2020 2020 2020  IDEO_DATA.      
-00017a10: 2020 6772 6169 6e5f 7061 7273 6572 203d    grain_parser =
-00017a20: 206d 6f63 6b2e 4d61 6769 634d 6f63 6b28   mock.MagicMock(
-00017a30: 6e61 6d65 3d22 6772 6169 6e5f 7061 7273  name="grain_pars
-00017a40: 6572 2229 0a20 2020 2020 2020 2028 6865  er").        (he
-00017a50: 6164 2c20 7365 676d 656e 7473 2920 3d20  ad, segments) = 
-00017a60: 6c6f 6164 7328 732c 2070 6172 7365 5f67  loads(s, parse_g
-00017a70: 7261 696e 3d67 7261 696e 5f70 6172 7365  rain=grain_parse
-00017a80: 7229 0a0a 2020 2020 2020 2020 7365 6c66  r)..        self
-00017a90: 2e61 7373 6572 7445 7175 616c 286c 656e  .assertEqual(len
-00017aa0: 2873 6567 6d65 6e74 7329 2c20 3129 0a20  (segments), 1). 
-00017ab0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00017ac0: 7274 496e 2831 2c20 7365 676d 656e 7473  rtIn(1, segments
-00017ad0: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-00017ae0: 7373 6572 7445 7175 616c 286c 656e 2873  ssertEqual(len(s
-00017af0: 6567 6d65 6e74 735b 315d 292c 2031 3029  egments[1]), 10)
-00017b00: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-00017b10: 7365 7274 4571 7561 6c28 6772 6169 6e5f  sertEqual(grain_
-00017b20: 7061 7273 6572 2e63 616c 6c5f 636f 756e  parser.call_coun
-00017b30: 742c 2031 3029 0a0a 2020 2020 6465 6620  t, 10)..    def 
-00017b40: 7465 7374 5f6c 6f61 6473 5f61 7564 696f  test_loads_audio
-00017b50: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-00017b60: 2868 6561 642c 2073 6567 6d65 6e74 7329  (head, segments)
-00017b70: 203d 206c 6f61 6473 2841 5544 494f 5f44   = loads(AUDIO_D
-00017b80: 4154 4129 0a0a 2020 2020 2020 2020 7365  ATA)..        se
-00017b90: 6c66 2e61 7373 6572 7445 7175 616c 2868  lf.assertEqual(h
-00017ba0: 6561 645b 2763 7265 6174 6564 275d 2c20  ead['created'], 
-00017bb0: 6461 7465 7469 6d65 2832 3031 382c 2032  datetime(2018, 2
-00017bc0: 2c20 372c 2031 302c 2033 372c 2035 3029  , 7, 10, 37, 50)
-00017bd0: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-00017be0: 7373 6572 7445 7175 616c 2868 6561 645b  ssertEqual(head[
-00017bf0: 2769 6427 5d2c 2055 5549 4428 2737 3831  'id'], UUID('781
-00017c00: 6662 3663 352d 6432 3266 2d34 6466 352d  fb6c5-d22f-4df5-
-00017c10: 6261 3639 2d36 3930 3539 6566 6435 6365  ba69-69059efd5ce
-00017c20: 6427 2929 0a20 2020 2020 2020 2073 656c  d')).        sel
-00017c30: 662e 6173 7365 7274 4571 7561 6c28 6c65  f.assertEqual(le
-00017c40: 6e28 6865 6164 5b27 7365 676d 656e 7473  n(head['segments
-00017c50: 275d 292c 2031 290a 2020 2020 2020 2020  ']), 1).        
-00017c60: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-00017c70: 2868 6561 645b 2773 6567 6d65 6e74 7327  (head['segments'
-00017c80: 5d5b 305d 5b27 6964 275d 2c20 5555 4944  ][0]['id'], UUID
-00017c90: 2827 6663 3463 3535 3333 2d33 6661 642d  ('fc4c5533-3fad-
-00017ca0: 3434 3337 2d39 3363 302d 3836 3638 6362  4437-93c0-8668cb
-00017cb0: 3837 3635 3738 2729 290a 2020 2020 2020  876578')).      
-00017cc0: 2020 7365 6c66 2e61 7373 6572 7449 6e28    self.assertIn(
-00017cd0: 6865 6164 5b27 7365 676d 656e 7473 275d  head['segments']
-00017ce0: 5b30 5d5b 276c 6f63 616c 5f69 6427 5d2c  [0]['local_id'],
-00017cf0: 2073 6567 6d65 6e74 7329 0a20 2020 2020   segments).     
-00017d00: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-00017d10: 7561 6c28 6c65 6e28 7365 676d 656e 7473  ual(len(segments
-00017d20: 5b68 6561 645b 2773 6567 6d65 6e74 7327  [head['segments'
-00017d30: 5d5b 305d 5b27 6c6f 6361 6c5f 6964 275d  ][0]['local_id']
-00017d40: 5d29 2c20 6865 6164 5b27 7365 676d 656e  ]), head['segmen
-00017d50: 7473 275d 5b30 5d5b 2763 6f75 6e74 275d  ts'][0]['count']
-00017d60: 290a 0a20 2020 2020 2020 2073 7461 7274  )..        start
-00017d70: 5f6f 7473 203d 2054 696d 6573 7461 6d70  _ots = Timestamp
-00017d80: 2831 3432 3031 3032 3830 302c 2030 290a  (1420102800, 0).
-00017d90: 2020 2020 2020 2020 6f74 7320 3d20 7374          ots = st
-00017da0: 6172 745f 6f74 730a 2020 2020 2020 2020  art_ots.        
-00017db0: 746f 7461 6c5f 7361 6d70 6c65 7320 3d20  total_samples = 
-00017dc0: 300a 2020 2020 2020 2020 666f 7220 6772  0.        for gr
-00017dd0: 6169 6e20 696e 2073 6567 6d65 6e74 735b  ain in segments[
-00017de0: 6865 6164 5b27 7365 676d 656e 7473 275d  head['segments']
-00017df0: 5b30 5d5b 276c 6f63 616c 5f69 6427 5d5d  [0]['local_id']]
-00017e00: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
-00017e10: 6c66 2e61 7373 6572 7449 7349 6e73 7461  lf.assertIsInsta
-00017e20: 6e63 6528 6772 6169 6e2c 2041 5544 494f  nce(grain, AUDIO
-00017e30: 4752 4149 4e29 0a20 2020 2020 2020 2020  GRAIN).         
-00017e40: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-00017e50: 7561 6c28 6772 6169 6e2e 6772 6169 6e5f  ual(grain.grain_
-00017e60: 7479 7065 2c20 2261 7564 696f 2229 0a20  type, "audio"). 
-00017e70: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00017e80: 6173 7365 7274 4571 7561 6c28 6772 6169  assertEqual(grai
-00017e90: 6e2e 736f 7572 6365 5f69 642c 2055 5549  n.source_id, UUI
-00017ea0: 4428 2733 3862 6664 3930 322d 6233 3566  D('38bfd902-b35f
-00017eb0: 2d34 3064 362d 3965 6366 2d64 6339 3538  -40d6-9ecf-dc958
-00017ec0: 3639 3133 3063 6627 2929 0a20 2020 2020  69130cf')).     
-00017ed0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00017ee0: 7274 4571 7561 6c28 6772 6169 6e2e 666c  rtEqual(grain.fl
-00017ef0: 6f77 5f69 642c 2055 5549 4428 2766 3163  ow_id, UUID('f1c
-00017f00: 3863 3039 352d 3537 3339 2d34 3666 342d  8c095-5739-46f4-
-00017f10: 3962 6263 2d33 6437 3035 3063 3962 6132  9bbc-3d7050c9ba2
-00017f20: 3327 2929 0a20 2020 2020 2020 2020 2020  3')).           
-00017f30: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-00017f40: 6c28 6772 6169 6e2e 6f72 6967 696e 5f74  l(grain.origin_t
-00017f50: 696d 6573 7461 6d70 2c20 6f74 7329 0a0a  imestamp, ots)..
-00017f60: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00017f70: 2e61 7373 6572 7445 7175 616c 2867 7261  .assertEqual(gra
-00017f80: 696e 2e66 6f72 6d61 742c 2043 6f67 4175  in.format, CogAu
-00017f90: 6469 6f46 6f72 6d61 742e 5332 345f 494e  dioFormat.S24_IN
-00017fa0: 5445 524c 4541 5645 4429 0a20 2020 2020  TERLEAVED).     
-00017fb0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00017fc0: 7274 4571 7561 6c28 6772 6169 6e2e 6368  rtEqual(grain.ch
-00017fd0: 616e 6e65 6c73 2c20 3229 0a20 2020 2020  annels, 2).     
-00017fe0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00017ff0: 7274 4571 7561 6c28 6772 6169 6e2e 7361  rtEqual(grain.sa
-00018000: 6d70 6c65 732c 2031 3032 3429 0a20 2020  mples, 1024).   
-00018010: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
-00018020: 7365 7274 4571 7561 6c28 6772 6169 6e2e  sertEqual(grain.
-00018030: 7361 6d70 6c65 5f72 6174 652c 2034 3830  sample_rate, 480
-00018040: 3030 290a 0a20 2020 2020 2020 2020 2020  00)..           
-00018050: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-00018060: 6c28 6c65 6e28 6772 6169 6e2e 6461 7461  l(len(grain.data
-00018070: 292c 2036 3134 3429 0a20 2020 2020 2020  ), 6144).       
-00018080: 2020 2020 2074 6f74 616c 5f73 616d 706c       total_sampl
-00018090: 6573 202b 3d20 6772 6169 6e2e 7361 6d70  es += grain.samp
-000180a0: 6c65 730a 2020 2020 2020 2020 2020 2020  les.            
-000180b0: 6f74 7320 3d20 7374 6172 745f 6f74 7320  ots = start_ots 
-000180c0: 2b20 5469 6d65 4f66 6673 6574 2e66 726f  + TimeOffset.fro
-000180d0: 6d5f 636f 756e 7428 746f 7461 6c5f 7361  m_count(total_sa
-000180e0: 6d70 6c65 732c 2067 7261 696e 2e73 616d  mples, grain.sam
-000180f0: 706c 655f 7261 7465 290a 0a20 2020 2064  ple_rate)..    d
-00018100: 6566 2074 6573 745f 6c6f 6164 735f 636f  ef test_loads_co
-00018110: 6465 645f 7669 6465 6f28 7365 6c66 293a  ded_video(self):
-00018120: 0a20 2020 2020 2020 2028 6865 6164 2c20  .        (head, 
-00018130: 7365 676d 656e 7473 2920 3d20 6c6f 6164  segments) = load
-00018140: 7328 434f 4445 445f 5649 4445 4f5f 4441  s(CODED_VIDEO_DA
-00018150: 5441 290a 0a20 2020 2020 2020 2073 656c  TA)..        sel
-00018160: 662e 6173 7365 7274 4571 7561 6c28 6865  f.assertEqual(he
-00018170: 6164 5b27 6372 6561 7465 6427 5d2c 2064  ad['created'], d
-00018180: 6174 6574 696d 6528 3230 3138 2c20 322c  atetime(2018, 2,
-00018190: 2037 2c20 3130 2c20 3338 2c20 3431 2929   7, 10, 38, 41))
-000181a0: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-000181b0: 7365 7274 4571 7561 6c28 6865 6164 5b27  sertEqual(head['
-000181c0: 6964 275d 2c20 5555 4944 2827 3838 3735  id'], UUID('8875
-000181d0: 6630 3263 2d32 3532 382d 3435 3636 2d39  f02c-2528-4566-9
-000181e0: 6539 612d 3233 6566 6333 6139 6262 6535  e9a-23efc3a9bbe5
-000181f0: 2729 290a 2020 2020 2020 2020 7365 6c66  ')).        self
-00018200: 2e61 7373 6572 7445 7175 616c 286c 656e  .assertEqual(len
-00018210: 2868 6561 645b 2773 6567 6d65 6e74 7327  (head['segments'
-00018220: 5d29 2c20 3129 0a20 2020 2020 2020 2073  ]), 1).        s
-00018230: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-00018240: 6865 6164 5b27 7365 676d 656e 7473 275d  head['segments']
-00018250: 5b30 5d5b 2769 6427 5d2c 2055 5549 4428  [0]['id'], UUID(
-00018260: 2762 6466 6131 3334 332d 3061 3230 2d34  'bdfa1343-0a20-4
-00018270: 6139 382d 3932 6635 2d30 6637 6630 6562  a98-92f5-0f7f0eb
-00018280: 3735 3437 3927 2929 0a20 2020 2020 2020  75479')).       
-00018290: 2073 656c 662e 6173 7365 7274 496e 2868   self.assertIn(h
-000182a0: 6561 645b 2773 6567 6d65 6e74 7327 5d5b  ead['segments'][
-000182b0: 305d 5b27 6c6f 6361 6c5f 6964 275d 2c20  0]['local_id'], 
-000182c0: 7365 676d 656e 7473 290a 2020 2020 2020  segments).      
-000182d0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-000182e0: 616c 286c 656e 2873 6567 6d65 6e74 735b  al(len(segments[
-000182f0: 6865 6164 5b27 7365 676d 656e 7473 275d  head['segments']
-00018300: 5b30 5d5b 276c 6f63 616c 5f69 6427 5d5d  [0]['local_id']]
-00018310: 292c 2068 6561 645b 2773 6567 6d65 6e74  ), head['segment
-00018320: 7327 5d5b 305d 5b27 636f 756e 7427 5d29  s'][0]['count'])
-00018330: 0a0a 2020 2020 2020 2020 6f74 7320 3d20  ..        ots = 
-00018340: 5469 6d65 7374 616d 7028 3134 3230 3130  Timestamp(142010
-00018350: 3238 3030 2c20 3029 0a20 2020 2020 2020  2800, 0).       
-00018360: 2075 6e69 745f 6f66 6673 6574 7320 3d20   unit_offsets = 
-00018370: 5b0a 2020 2020 2020 2020 2020 2020 285b  [.            ([
-00018380: 302c 2036 2c20 3334 2c20 3432 2c20 3731  0, 6, 34, 42, 71
-00018390: 312c 2037 3139 5d2c 2033 3631 3134 292c  1, 719], 36114),
-000183a0: 0a20 2020 2020 2020 2020 2020 2028 5b30  .            ([0
-000183b0: 2c20 362c 2031 345d 2c20 3338 3029 2c0a  , 6, 14], 380),.
-000183c0: 2020 2020 2020 2020 2020 2020 285b 302c              ([0,
-000183d0: 2036 2c20 3134 5d2c 2038 3237 3729 2c0a   6, 14], 8277),.
-000183e0: 2020 2020 2020 2020 2020 2020 285b 302c              ([0,
-000183f0: 2036 2c20 3134 5d2c 2034 3931 3429 2c0a   6, 14], 4914),.
-00018400: 2020 2020 2020 2020 2020 2020 285b 302c              ([0,
-00018410: 2036 2c20 3134 5d2c 2034 3936 3129 2c0a   6, 14], 4961),.
-00018420: 2020 2020 2020 2020 2020 2020 285b 302c              ([0,
-00018430: 2036 2c20 3134 5d2c 2033 3737 3729 2c0a   6, 14], 3777),.
-00018440: 2020 2020 2020 2020 2020 2020 285b 302c              ([0,
-00018450: 2036 2c20 3134 5d2c 2031 3935 3029 2c0a   6, 14], 1950),.
-00018460: 2020 2020 2020 2020 2020 2020 285b 302c              ([0,
-00018470: 2036 2c20 3134 5d2c 2033 3129 2c0a 2020   6, 14], 31),.  
-00018480: 2020 2020 2020 2020 2020 285b 302c 2036            ([0, 6
-00018490: 2c20 3134 5d2c 2032 3529 2c0a 2020 2020  , 14], 25),.    
-000184a0: 2020 2020 2020 2020 285b 302c 2036 2c20          ([0, 6, 
-000184b0: 3134 5d2c 2036 3234 3129 5d0a 2020 2020  14], 6241)].    
-000184c0: 2020 2020 666f 7220 6772 6169 6e20 696e      for grain in
-000184d0: 2073 6567 6d65 6e74 735b 6865 6164 5b27   segments[head['
-000184e0: 7365 676d 656e 7473 275d 5b30 5d5b 276c  segments'][0]['l
-000184f0: 6f63 616c 5f69 6427 5d5d 3a0a 2020 2020  ocal_id']]:.    
-00018500: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-00018510: 6572 7449 7349 6e73 7461 6e63 6528 6772  ertIsInstance(gr
-00018520: 6169 6e2c 2043 4f44 4544 5649 4445 4f47  ain, CODEDVIDEOG
-00018530: 5241 494e 290a 2020 2020 2020 2020 2020  RAIN).          
-00018540: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-00018550: 616c 2867 7261 696e 2e67 7261 696e 5f74  al(grain.grain_t
-00018560: 7970 652c 2022 636f 6465 645f 7669 6465  ype, "coded_vide
-00018570: 6f22 290a 2020 2020 2020 2020 2020 2020  o").            
-00018580: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-00018590: 2867 7261 696e 2e73 6f75 7263 655f 6964  (grain.source_id
-000185a0: 2c20 5555 4944 2827 3439 3537 3835 3532  , UUID('49578552
-000185b0: 2d66 6239 652d 3464 3365 2d61 3139 372d  -fb9e-4d3e-a197-
-000185c0: 3365 3363 3433 3761 3839 3564 2729 290a  3e3c437a895d')).
-000185d0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-000185e0: 2e61 7373 6572 7445 7175 616c 2867 7261  .assertEqual(gra
-000185f0: 696e 2e66 6c6f 775f 6964 2c20 5555 4944  in.flow_id, UUID
-00018600: 2827 6236 6230 3565 6662 2d36 3036 372d  ('b6b05efb-6067-
-00018610: 3466 6638 2d61 6661 632d 6563 3733 3561  4ff8-afac-ec735a
-00018620: 3835 3637 3465 2729 290a 2020 2020 2020  85674e')).      
-00018630: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-00018640: 7445 7175 616c 2867 7261 696e 2e6f 7269  tEqual(grain.ori
-00018650: 6769 6e5f 7469 6d65 7374 616d 702c 206f  gin_timestamp, o
-00018660: 7473 290a 2020 2020 2020 2020 2020 2020  ts).            
-00018670: 6f74 7320 2b3d 2054 696d 654f 6666 7365  ots += TimeOffse
-00018680: 742e 6672 6f6d 5f6e 616e 6f73 6563 2832  t.from_nanosec(2
-00018690: 3030 3030 3030 3029 0a0a 2020 2020 2020  0000000)..      
-000186a0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-000186b0: 7445 7175 616c 2867 7261 696e 2e66 6f72  tEqual(grain.for
-000186c0: 6d61 742c 2043 6f67 4672 616d 6546 6f72  mat, CogFrameFor
-000186d0: 6d61 742e 4832 3634 290a 2020 2020 2020  mat.H264).      
-000186e0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-000186f0: 7445 7175 616c 2867 7261 696e 2e6c 6179  tEqual(grain.lay
-00018700: 6f75 742c 2043 6f67 4672 616d 654c 6179  out, CogFrameLay
-00018710: 6f75 742e 4655 4c4c 5f46 5241 4d45 290a  out.FULL_FRAME).
-00018720: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00018730: 2e61 7373 6572 7445 7175 616c 2867 7261  .assertEqual(gra
-00018740: 696e 2e6f 7269 6769 6e5f 7769 6474 682c  in.origin_width,
-00018750: 2031 3932 3029 0a20 2020 2020 2020 2020   1920).         
-00018760: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-00018770: 7561 6c28 6772 6169 6e2e 6f72 6967 696e  ual(grain.origin
-00018780: 5f68 6569 6768 742c 2031 3038 3029 0a20  _height, 1080). 
-00018790: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-000187a0: 6173 7365 7274 4571 7561 6c28 6772 6169  assertEqual(grai
-000187b0: 6e2e 636f 6465 645f 7769 6474 682c 2030  n.coded_width, 0
-000187c0: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
-000187d0: 6c66 2e61 7373 6572 7445 7175 616c 2867  lf.assertEqual(g
-000187e0: 7261 696e 2e63 6f64 6564 5f68 6569 6768  rain.coded_heigh
-000187f0: 742c 2030 290a 2020 2020 2020 2020 2020  t, 0).          
-00018800: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-00018810: 616c 2867 7261 696e 2e6c 656e 6774 682c  al(grain.length,
-00018820: 2075 6e69 745f 6f66 6673 6574 735b 305d   unit_offsets[0]
-00018830: 5b31 5d29 0a20 2020 2020 2020 2020 2020  [1]).           
-00018840: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-00018850: 6c28 6772 6169 6e2e 7465 6d70 6f72 616c  l(grain.temporal
-00018860: 5f6f 6666 7365 742c 2030 290a 2020 2020  _offset, 0).    
-00018870: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-00018880: 6572 7445 7175 616c 2867 7261 696e 2e75  ertEqual(grain.u
-00018890: 6e69 745f 6f66 6673 6574 732c 2075 6e69  nit_offsets, uni
-000188a0: 745f 6f66 6673 6574 735b 305d 5b30 5d29  t_offsets[0][0])
-000188b0: 0a20 2020 2020 2020 2020 2020 2075 6e69  .            uni
-000188c0: 745f 6f66 6673 6574 732e 706f 7028 3029  t_offsets.pop(0)
-000188d0: 0a0a 2020 2020 6465 6620 7465 7374 5f6c  ..    def test_l
-000188e0: 6f61 6473 5f72 656a 6563 7473 5f69 6e63  oads_rejects_inc
-000188f0: 6f72 7265 6374 5f74 7970 655f 6669 6c65  orrect_type_file
-00018900: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-00018910: 7769 7468 2073 656c 662e 6173 7365 7274  with self.assert
-00018920: 5261 6973 6573 2847 5346 4465 636f 6465  Raises(GSFDecode
-00018930: 4261 6446 696c 6554 7970 6545 7272 6f72  BadFileTypeError
-00018940: 2920 6173 2063 6d3a 0a20 2020 2020 2020  ) as cm:.       
-00018950: 2020 2020 206c 6f61 6473 2862 2250 4f54       loads(b"POT
-00018960: 4154 4f32 335c 7830 375c 7830 305c 7830  ATO23\x07\x00\x0
-00018970: 305c 7830 3022 290a 2020 2020 2020 2020  0\x00").        
-00018980: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-00018990: 2863 6d2e 6578 6365 7074 696f 6e2e 6f66  (cm.exception.of
-000189a0: 6673 6574 2c20 3029 0a20 2020 2020 2020  fset, 0).       
-000189b0: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-000189c0: 6c28 636d 2e65 7863 6570 7469 6f6e 2e66  l(cm.exception.f
-000189d0: 696c 6574 7970 652c 2022 504f 5441 544f  iletype, "POTATO
-000189e0: 3233 2229 0a0a 2020 2020 6465 6620 7465  23")..    def te
-000189f0: 7374 5f6c 6f61 6473 5f72 656a 6563 7473  st_loads_rejects
-00018a00: 5f69 6e63 6f72 7265 6374 5f76 6572 7369  _incorrect_versi
-00018a10: 6f6e 5f66 696c 6528 7365 6c66 293a 0a20  on_file(self):. 
-00018a20: 2020 2020 2020 2077 6974 6820 7365 6c66         with self
-00018a30: 2e61 7373 6572 7452 6169 7365 7328 4753  .assertRaises(GS
-00018a40: 4644 6563 6f64 6542 6164 5665 7273 696f  FDecodeBadVersio
-00018a50: 6e45 7272 6f72 2920 6173 2063 6d3a 0a20  nError) as cm:. 
-00018a60: 2020 2020 2020 2020 2020 206c 6f61 6473             loads
-00018a70: 2862 2253 5342 4267 7273 675c 7830 385c  (b"SSBBgrsg\x08\
-00018a80: 7830 305c 7830 335c 7830 3022 290a 2020  x00\x03\x00").  
-00018a90: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-00018aa0: 7445 7175 616c 2863 6d2e 6578 6365 7074  tEqual(cm.except
-00018ab0: 696f 6e2e 6f66 6673 6574 2c20 3029 0a20  ion.offset, 0). 
-00018ac0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00018ad0: 7274 4571 7561 6c28 636d 2e65 7863 6570  rtEqual(cm.excep
-00018ae0: 7469 6f6e 2e6d 616a 6f72 2c20 3829 0a20  tion.major, 8). 
-00018af0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00018b00: 7274 4571 7561 6c28 636d 2e65 7863 6570  rtEqual(cm.excep
-00018b10: 7469 6f6e 2e6d 696e 6f72 2c20 3329 0a0a  tion.minor, 3)..
-00018b20: 2020 2020 6465 6620 7465 7374 5f6c 6f61      def test_loa
-00018b30: 6473 5f72 656a 6563 7473 5f62 6164 5f68  ds_rejects_bad_h
-00018b40: 6561 645f 7461 6728 7365 6c66 293a 0a20  ead_tag(self):. 
-00018b50: 2020 2020 2020 2077 6974 6820 7365 6c66         with self
-00018b60: 2e61 7373 6572 7452 6169 7365 7328 4753  .assertRaises(GS
-00018b70: 4644 6563 6f64 6545 7272 6f72 2920 6173  FDecodeError) as
-00018b80: 2063 6d3a 0a20 2020 2020 2020 2020 2020   cm:.           
-00018b90: 206c 6f61 6473 2862 2253 5342 4267 7273   loads(b"SSBBgrs
-00018ba0: 675c 7830 375c 7830 305c 7830 305c 7830  g\x07\x00\x00\x0
-00018bb0: 3022 202b 0a20 2020 2020 2020 2020 2020  0" +.           
-00018bc0: 2020 2020 2020 2062 225c 7866 665c 7866         b"\xff\xf
-00018bd0: 665c 7866 665c 7866 665c 7830 305c 7830  f\xff\xff\x00\x0
-00018be0: 305c 7830 305c 7830 3022 290a 2020 2020  0\x00\x00").    
-00018bf0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-00018c00: 7175 616c 2863 6d2e 6578 6365 7074 696f  qual(cm.exceptio
-00018c10: 6e2e 6f66 6673 6574 2c20 3132 290a 0a20  n.offset, 12).. 
-00018c20: 2020 2064 6566 2074 6573 745f 6c6f 6164     def test_load
-00018c30: 735f 7261 6973 6573 5f65 7863 6570 7469  s_raises_excepti
-00018c40: 6f6e 5f77 6974 686f 7574 5f68 6561 6428  on_without_head(
-00018c50: 7365 6c66 293a 0a20 2020 2020 2020 2077  self):.        w
-00018c60: 6974 6820 7365 6c66 2e61 7373 6572 7452  ith self.assertR
-00018c70: 6169 7365 7328 4753 4644 6563 6f64 6545  aises(GSFDecodeE
-00018c80: 7272 6f72 2920 6173 2063 6d3a 0a20 2020  rror) as cm:.   
-00018c90: 2020 2020 2020 2020 206c 6f61 6473 2862           loads(b
-00018ca0: 2253 5342 4267 7273 675c 7830 375c 7830  "SSBBgrsg\x07\x0
-00018cb0: 305c 7830 305c 7830 3022 290a 2020 2020  0\x00\x00").    
-00018cc0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-00018cd0: 7175 616c 2863 6d2e 6578 6365 7074 696f  qual(cm.exceptio
-00018ce0: 6e2e 6f66 6673 6574 2c20 3132 290a 0a20  n.offset, 12).. 
-00018cf0: 2020 2064 6566 2074 6573 745f 6c6f 6164     def test_load
-00018d00: 735f 736b 6970 735f 756e 6b6e 6f77 6e5f  s_skips_unknown_
-00018d10: 626c 6f63 6b5f 6265 666f 7265 5f68 6561  block_before_hea
-00018d20: 6428 7365 6c66 293a 0a20 2020 2020 2020  d(self):.       
-00018d30: 2028 6865 6164 2c20 7365 676d 656e 7473   (head, segments
-00018d40: 2920 3d20 6c6f 6164 7328 6222 5353 4242  ) = loads(b"SSBB
-00018d50: 6772 7367 5c78 3037 5c78 3030 5c78 3030  grsg\x07\x00\x00
-00018d60: 5c78 3030 2220 2b0a 2020 2020 2020 2020  \x00" +.        
-00018d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018d80: 2020 2020 2020 2020 2062 2264 756d 795c           b"dumy\
-00018d90: 7830 385c 7830 305c 7830 305c 7830 3022  x08\x00\x00\x00"
-00018da0: 202b 0a20 2020 2020 2020 2020 2020 2020   +.             
-00018db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018dc0: 2020 2020 6222 6865 6164 5c78 3166 5c78      b"head\x1f\x
-00018dd0: 3030 5c78 3030 5c78 3030 2220 2b0a 2020  00\x00\x00" +.  
-00018de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018df0: 2020 2020 2020 2020 2020 2020 2020 2062                 b
-00018e00: 225c 7864 315c 7839 635c 7830 625c 7839  "\xd1\x9c\x0b\x9
-00018e10: 315c 7831 355c 7839 305c 7831 315c 7865  1\x15\x90\x11\xe
-00018e20: 385c 7838 355c 7838 305c 7864 635c 7861  8\x85\x80\xdc\xa
-00018e30: 395c 7830 345c 7838 324e 5c78 6563 2220  9\x04\x82N\xec" 
-00018e40: 2b0a 2020 2020 2020 2020 2020 2020 2020  +.              
-00018e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018e60: 2020 2062 225c 7862 665c 7830 375c 7830     b"\xbf\x07\x0
-00018e70: 335c 7831 645c 7830 665c 7830 665c 7830  3\x1d\x0f\x0f\x0
-00018e80: 6622 290a 0a20 2020 2020 2020 2073 656c  f")..        sel
-00018e90: 662e 6173 7365 7274 4571 7561 6c28 6865  f.assertEqual(he
-00018ea0: 6164 5b27 6964 275d 2c20 5555 4944 2827  ad['id'], UUID('
-00018eb0: 6431 3963 3062 3931 2d31 3539 302d 3131  d19c0b91-1590-11
-00018ec0: 6538 2d38 3538 302d 6463 6139 3034 3832  e8-8580-dca90482
-00018ed0: 3465 6563 2729 290a 2020 2020 2020 2020  4eec')).        
-00018ee0: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-00018ef0: 2868 6561 645b 2763 7265 6174 6564 275d  (head['created']
-00018f00: 2c20 6461 7465 7469 6d65 2831 3938 332c  , datetime(1983,
-00018f10: 2033 2c20 3239 2c20 3135 2c20 3135 2c20   3, 29, 15, 15, 
-00018f20: 3135 2929 0a20 2020 2020 2020 2073 656c  15)).        sel
-00018f30: 662e 6173 7365 7274 4571 7561 6c28 6865  f.assertEqual(he
-00018f40: 6164 5b27 7365 676d 656e 7473 275d 2c20  ad['segments'], 
-00018f50: 5b5d 290a 2020 2020 2020 2020 7365 6c66  []).        self
-00018f60: 2e61 7373 6572 7445 7175 616c 2868 6561  .assertEqual(hea
-00018f70: 645b 2774 6167 7327 5d2c 205b 5d29 0a0a  d['tags'], [])..
-00018f80: 2020 2020 6465 6620 7465 7374 5f6c 6f61      def test_loa
-00018f90: 6473 5f73 6b69 7073 5f75 6e6b 6e6f 776e  ds_skips_unknown
-00018fa0: 5f62 6c6f 636b 5f69 6e73 7465 6164 5f6f  _block_instead_o
-00018fb0: 665f 7365 676d 2873 656c 6629 3a0a 2020  f_segm(self):.  
-00018fc0: 2020 2020 2020 2868 6561 642c 2073 6567        (head, seg
-00018fd0: 6d65 6e74 7329 203d 206c 6f61 6473 2862  ments) = loads(b
-00018fe0: 2253 5342 4267 7273 675c 7830 375c 7830  "SSBBgrsg\x07\x0
-00018ff0: 305c 7830 305c 7830 3022 202b 0a20 2020  0\x00\x00" +.   
-00019000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019010: 2020 2020 2020 2020 2020 2020 2020 6222                b"
-00019020: 6865 6164 5c78 3237 5c78 3030 5c78 3030  head\x27\x00\x00
-00019030: 5c78 3030 2220 2b0a 2020 2020 2020 2020  \x00" +.        
-00019040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019050: 2020 2020 2020 2020 2062 225c 7864 315c           b"\xd1\
-00019060: 7839 635c 7830 625c 7839 315c 7831 355c  x9c\x0b\x91\x15\
-00019070: 7839 305c 7831 315c 7865 385c 7838 355c  x90\x11\xe8\x85\
-00019080: 7838 305c 7864 635c 7861 395c 7830 345c  x80\xdc\xa9\x04\
-00019090: 7838 324e 5c78 6563 2220 2b0a 2020 2020  x82N\xec" +.    
-000190a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000190b0: 2020 2020 2020 2020 2020 2020 2062 225c               b"\
-000190c0: 7862 665c 7830 375c 7830 335c 7831 645c  xbf\x07\x03\x1d\
-000190d0: 7830 665c 7830 665c 7830 6622 202b 0a20  x0f\x0f\x0f" +. 
-000190e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000190f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019100: 6222 6475 6d79 5c78 3038 5c78 3030 5c78  b"dumy\x08\x00\x
-00019110: 3030 5c78 3030 2229 0a0a 2020 2020 2020  00\x00")..      
-00019120: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-00019130: 616c 2868 6561 645b 2769 6427 5d2c 2055  al(head['id'], U
-00019140: 5549 4428 2764 3139 6330 6239 312d 3135  UID('d19c0b91-15
-00019150: 3930 2d31 3165 382d 3835 3830 2d64 6361  90-11e8-8580-dca
-00019160: 3930 3438 3234 6565 6327 2929 0a20 2020  904824eec')).   
-00019170: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00019180: 4571 7561 6c28 6865 6164 5b27 6372 6561  Equal(head['crea
-00019190: 7465 6427 5d2c 2064 6174 6574 696d 6528  ted'], datetime(
-000191a0: 3139 3833 2c20 332c 2032 392c 2031 352c  1983, 3, 29, 15,
-000191b0: 2031 352c 2031 3529 290a 2020 2020 2020   15, 15)).      
-000191c0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-000191d0: 616c 2868 6561 645b 2773 6567 6d65 6e74  al(head['segment
-000191e0: 7327 5d2c 205b 5d29 0a20 2020 2020 2020  s'], []).       
-000191f0: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-00019200: 6c28 6865 6164 5b27 7461 6773 275d 2c20  l(head['tags'], 
-00019210: 5b5d 290a 0a20 2020 2064 6566 2074 6573  [])..    def tes
-00019220: 745f 6c6f 6164 735f 736b 6970 735f 756e  t_loads_skips_un
-00019230: 6b6e 6f77 6e5f 626c 6f63 6b5f 6265 666f  known_block_befo
-00019240: 7265 5f73 6567 6d28 7365 6c66 293a 0a20  re_segm(self):. 
-00019250: 2020 2020 2020 2028 6865 6164 2c20 7365         (head, se
-00019260: 676d 656e 7473 2920 3d20 6c6f 6164 7328  gments) = loads(
-00019270: 6222 5353 4242 6772 7367 5c78 3037 5c78  b"SSBBgrsg\x07\x
-00019280: 3030 5c78 3030 5c78 3030 2220 2b0a 2020  00\x00\x00" +.  
-00019290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000192a0: 2020 2020 2020 2020 2020 2020 2020 2028                 (
-000192b0: 6222 6865 6164 5c78 3439 5c78 3030 5c78  b"head\x49\x00\x
-000192c0: 3030 5c78 3030 2220 2b0a 2020 2020 2020  00\x00" +.      
-000192d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000192e0: 2020 2020 2020 2020 2020 2020 6222 5c78              b"\x
-000192f0: 6431 5c78 3963 5c78 3062 5c78 3931 5c78  d1\x9c\x0b\x91\x
-00019300: 3135 5c78 3930 5c78 3131 5c78 6538 5c78  15\x90\x11\xe8\x
-00019310: 3835 5c78 3830 5c78 6463 5c78 6139 5c78  85\x80\xdc\xa9\x
-00019320: 3034 5c78 3832 4e5c 7865 6322 202b 0a20  04\x82N\xec" +. 
-00019330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019340: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019350: 2062 225c 7862 665c 7830 375c 7830 335c   b"\xbf\x07\x03\
-00019360: 7831 645c 7830 665c 7830 665c 7830 6622  x1d\x0f\x0f\x0f"
-00019370: 202b 0a20 2020 2020 2020 2020 2020 2020   +.             
-00019380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019390: 2020 2020 2028 6222 6475 6d79 5c78 3038       (b"dumy\x08
-000193a0: 5c78 3030 5c78 3030 5c78 3030 2229 202b  \x00\x00\x00") +
-000193b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000193c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000193d0: 2020 2028 6222 7365 676d 5c78 3232 5c78     (b"segm\x22\x
-000193e0: 3030 5c78 3030 5c78 3030 2220 2b0a 2020  00\x00\x00" +.  
-000193f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019410: 2062 225c 7830 315c 7830 3022 202b 0a20   b"\x01\x00" +. 
-00019420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019440: 2020 6222 5c78 6433 5c78 6531 5c78 3931    b"\xd3\xe1\x91
-00019450: 5c78 6630 5c78 3135 5c78 3934 5c78 3131  \xf0\x15\x94\x11
-00019460: 5c78 6538 5c78 3931 5c78 6163 5c78 6463  \xe8\x91\xac\xdc
-00019470: 5c78 6139 5c78 3034 5c78 3832 4e5c 7865  \xa9\x04\x82N\xe
-00019480: 6322 202b 0a20 2020 2020 2020 2020 2020  c" +.           
-00019490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000194a0: 2020 2020 2020 2020 6222 5c78 3030 5c78          b"\x00\x
-000194b0: 3030 5c78 3030 5c78 3030 5c78 3030 5c78  00\x00\x00\x00\x
-000194c0: 3030 5c78 3030 5c78 3030 2229 2929 0a0a  00\x00\x00")))..
-000194d0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-000194e0: 6572 7445 7175 616c 2868 6561 645b 2769  ertEqual(head['i
-000194f0: 6427 5d2c 2055 5549 4428 2764 3139 6330  d'], UUID('d19c0
-00019500: 6239 312d 3135 3930 2d31 3165 382d 3835  b91-1590-11e8-85
-00019510: 3830 2d64 6361 3930 3438 3234 6565 6327  80-dca904824eec'
-00019520: 2929 0a20 2020 2020 2020 2073 656c 662e  )).        self.
-00019530: 6173 7365 7274 4571 7561 6c28 6865 6164  assertEqual(head
-00019540: 5b27 6372 6561 7465 6427 5d2c 2064 6174  ['created'], dat
-00019550: 6574 696d 6528 3139 3833 2c20 332c 2032  etime(1983, 3, 2
-00019560: 392c 2031 352c 2031 352c 2031 3529 290a  9, 15, 15, 15)).
-00019570: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-00019580: 6572 7445 7175 616c 286c 656e 2868 6561  ertEqual(len(hea
-00019590: 645b 2773 6567 6d65 6e74 7327 5d29 2c20  d['segments']), 
-000195a0: 3129 0a20 2020 2020 2020 2073 656c 662e  1).        self.
-000195b0: 6173 7365 7274 4571 7561 6c28 6865 6164  assertEqual(head
-000195c0: 5b27 7365 676d 656e 7473 275d 5b30 5d5b  ['segments'][0][
-000195d0: 276c 6f63 616c 5f69 6427 5d2c 2031 290a  'local_id'], 1).
-000195e0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-000195f0: 6572 7445 7175 616c 2868 6561 645b 2773  ertEqual(head['s
-00019600: 6567 6d65 6e74 7327 5d5b 305d 5b27 6964  egments'][0]['id
-00019610: 275d 2c20 5555 4944 2827 6433 6531 3931  '], UUID('d3e191
-00019620: 6630 2d31 3539 342d 3131 6538 2d39 3161  f0-1594-11e8-91a
-00019630: 632d 6463 6139 3034 3832 3465 6563 2729  c-dca904824eec')
-00019640: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-00019650: 7373 6572 7445 7175 616c 2868 6561 645b  ssertEqual(head[
-00019660: 2773 6567 6d65 6e74 7327 5d5b 305d 5b27  'segments'][0]['
-00019670: 7461 6773 275d 2c20 5b5d 290a 2020 2020  tags'], []).    
-00019680: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-00019690: 7175 616c 2868 6561 645b 2773 6567 6d65  qual(head['segme
-000196a0: 6e74 7327 5d5b 305d 5b27 636f 756e 7427  nts'][0]['count'
-000196b0: 5d2c 2030 290a 2020 2020 2020 2020 7365  ], 0).        se
-000196c0: 6c66 2e61 7373 6572 7445 7175 616c 2868  lf.assertEqual(h
-000196d0: 6561 645b 2774 6167 7327 5d2c 205b 5d29  ead['tags'], [])
-000196e0: 0a0a 2020 2020 6465 6620 7465 7374 5f6c  ..    def test_l
-000196f0: 6f61 6473 5f72 6169 7365 735f 7768 656e  oads_raises_when
-00019700: 5f68 6561 645f 746f 6f5f 736d 616c 6c28  _head_too_small(
-00019710: 7365 6c66 293a 0a20 2020 2020 2020 2077  self):.        w
-00019720: 6974 6820 7365 6c66 2e61 7373 6572 7452  ith self.assertR
-00019730: 6169 7365 7328 4753 4644 6563 6f64 6545  aises(GSFDecodeE
-00019740: 7272 6f72 2920 6173 2063 6d3a 0a20 2020  rror) as cm:.   
-00019750: 2020 2020 2020 2020 2028 6865 6164 2c20           (head, 
-00019760: 7365 676d 656e 7473 2920 3d20 6c6f 6164  segments) = load
-00019770: 7328 6222 5353 4242 6772 7367 5c78 3037  s(b"SSBBgrsg\x07
-00019780: 5c78 3030 5c78 3030 5c78 3030 2220 2b0a  \x00\x00\x00" +.
-00019790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000197a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000197b0: 2020 2020 2028 6222 6865 6164 5c78 3239       (b"head\x29
-000197c0: 5c78 3030 5c78 3030 5c78 3030 2220 2b0a  \x00\x00\x00" +.
-000197d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000197e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000197f0: 2020 2020 2020 6222 5c78 6431 5c78 3963        b"\xd1\x9c
-00019800: 5c78 3062 5c78 3931 5c78 3135 5c78 3930  \x0b\x91\x15\x90
-00019810: 5c78 3131 5c78 6538 5c78 3835 5c78 3830  \x11\xe8\x85\x80
-00019820: 5c78 6463 5c78 6139 5c78 3034 5c78 3832  \xdc\xa9\x04\x82
-00019830: 4e5c 7865 6322 202b 0a20 2020 2020 2020  N\xec" +.       
-00019840: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019850: 2020 2020 2020 2020 2020 2020 2020 2062                 b
-00019860: 225c 7862 665c 7830 375c 7830 335c 7831  "\xbf\x07\x03\x1
-00019870: 645c 7830 665c 7830 665c 7830 6622 202b  d\x0f\x0f\x0f" +
-00019880: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00019890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000198a0: 2020 2020 2020 2028 6222 6475 6d79 5c78         (b"dumy\x
-000198b0: 3038 5c78 3030 5c78 3030 5c78 3030 2229  08\x00\x00\x00")
-000198c0: 202b 0a20 2020 2020 2020 2020 2020 2020   +.             
-000198d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000198e0: 2020 2020 2020 2020 2028 6222 7365 676d           (b"segm
-000198f0: 5c78 3232 5c78 3030 5c78 3030 5c78 3030  \x22\x00\x00\x00
-00019900: 2220 2b0a 2020 2020 2020 2020 2020 2020  " +.            
-00019910: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019920: 2020 2020 2020 2020 2020 2062 225c 7830             b"\x0
-00019930: 315c 7830 3022 202b 0a20 2020 2020 2020  1\x00" +.       
-00019940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019960: 6222 5c78 6433 5c78 6531 5c78 3931 5c78  b"\xd3\xe1\x91\x
-00019970: 6630 5c78 3135 5c78 3934 5c78 3131 5c78  f0\x15\x94\x11\x
-00019980: 6538 5c78 3931 5c78 6163 5c78 6463 5c78  e8\x91\xac\xdc\x
-00019990: 6139 5c78 3034 5c78 3832 4e5c 7865 6322  a9\x04\x82N\xec"
-000199a0: 202b 0a20 2020 2020 2020 2020 2020 2020   +.             
-000199b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000199c0: 2020 2020 2020 2020 2020 6222 5c78 3030            b"\x00
-000199d0: 5c78 3030 5c78 3030 5c78 3030 5c78 3030  \x00\x00\x00\x00
-000199e0: 5c78 3030 5c78 3030 5c78 3030 2229 2929  \x00\x00\x00")))
-000199f0: 0a0a 2020 2020 2020 2020 7365 6c66 2e61  ..        self.a
-00019a00: 7373 6572 7445 7175 616c 2863 6d2e 6578  ssertEqual(cm.ex
-00019a10: 6365 7074 696f 6e2e 6f66 6673 6574 2c20  ception.offset, 
-00019a20: 3531 290a 0a20 2020 2064 6566 2074 6573  51)..    def tes
-00019a30: 745f 6c6f 6164 735f 7261 6973 6573 5f77  t_loads_raises_w
-00019a40: 6865 6e5f 7365 676d 5f74 6f6f 5f73 6d61  hen_segm_too_sma
-00019a50: 6c6c 2873 656c 6629 3a0a 2020 2020 2020  ll(self):.      
-00019a60: 2020 7769 7468 2073 656c 662e 6173 7365    with self.asse
-00019a70: 7274 5261 6973 6573 2847 5346 4465 636f  rtRaises(GSFDeco
-00019a80: 6465 4572 726f 7229 2061 7320 636d 3a0a  deError) as cm:.
-00019a90: 2020 2020 2020 2020 2020 2020 2868 6561              (hea
-00019aa0: 642c 2073 6567 6d65 6e74 7329 203d 206c  d, segments) = l
-00019ab0: 6f61 6473 2862 2253 5342 4267 7273 675c  oads(b"SSBBgrsg\
-00019ac0: 7830 375c 7830 305c 7830 305c 7830 3022  x07\x00\x00\x00"
-00019ad0: 202b 0a20 2020 2020 2020 2020 2020 2020   +.             
-00019ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019af0: 2020 2020 2020 2020 2862 2268 6561 645c          (b"head\
-00019b00: 7834 315c 7830 305c 7830 305c 7830 3022  x41\x00\x00\x00"
-00019b10: 202b 0a20 2020 2020 2020 2020 2020 2020   +.             
-00019b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019b30: 2020 2020 2020 2020 2062 225c 7864 315c           b"\xd1\
-00019b40: 7839 635c 7830 625c 7839 315c 7831 355c  x9c\x0b\x91\x15\
-00019b50: 7839 305c 7831 315c 7865 385c 7838 355c  x90\x11\xe8\x85\
-00019b60: 7838 305c 7864 635c 7861 395c 7830 345c  x80\xdc\xa9\x04\
-00019b70: 7838 324e 5c78 6563 2220 2b0a 2020 2020  x82N\xec" +.    
-00019b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019ba0: 2020 6222 5c78 6266 5c78 3037 5c78 3033    b"\xbf\x07\x03
-00019bb0: 5c78 3164 5c78 3066 5c78 3066 5c78 3066  \x1d\x0f\x0f\x0f
-00019bc0: 2220 2b0a 2020 2020 2020 2020 2020 2020  " +.            
-00019bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019be0: 2020 2020 2020 2020 2020 2862 2273 6567            (b"seg
-00019bf0: 6d5c 7832 315c 7830 305c 7830 305c 7830  m\x21\x00\x00\x0
-00019c00: 3022 202b 0a20 2020 2020 2020 2020 2020  0" +.           
-00019c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019c20: 2020 2020 2020 2020 2020 2020 6222 5c78              b"\x
-00019c30: 3031 5c78 3030 2220 2b0a 2020 2020 2020  01\x00" +.      
-00019c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019c60: 2062 225c 7864 335c 7865 315c 7839 315c   b"\xd3\xe1\x91\
-00019c70: 7866 305c 7831 355c 7839 345c 7831 315c  xf0\x15\x94\x11\
-00019c80: 7865 385c 7839 315c 7861 635c 7864 635c  xe8\x91\xac\xdc\
-00019c90: 7861 395c 7830 345c 7838 324e 5c78 6563  xa9\x04\x82N\xec
-00019ca0: 2220 2b0a 2020 2020 2020 2020 2020 2020  " +.            
-00019cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019cc0: 2020 2020 2020 2020 2020 2062 225c 7830             b"\x0
-00019cd0: 305c 7830 305c 7830 305c 7830 305c 7830  0\x00\x00\x00\x0
-00019ce0: 305c 7830 305c 7830 305c 7830 3022 2929  0\x00\x00\x00"))
-00019cf0: 290a 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-00019d00: 6173 7365 7274 4571 7561 6c28 636d 2e65  assertEqual(cm.e
-00019d10: 7863 6570 7469 6f6e 2e6f 6666 7365 742c  xception.offset,
-00019d20: 2037 3729 0a0a 2020 2020 6465 6620 7465   77)..    def te
-00019d30: 7374 5f6c 6f61 6473 5f64 6563 6f64 6573  st_loads_decodes
-00019d40: 5f74 696c 7328 7365 6c66 293a 0a20 2020  _tils(self):.   
-00019d50: 2020 2020 2073 7263 5f69 6420 3d20 5555       src_id = UU
-00019d60: 4944 2827 6337 3037 6436 3463 2d31 3539  ID('c707d64c-159
-00019d70: 362d 3131 6538 2d61 3366 622d 6463 6139  6-11e8-a3fb-dca9
-00019d80: 3034 3832 3465 6563 2729 0a20 2020 2020  04824eec').     
-00019d90: 2020 2066 6c6f 775f 6964 203d 2055 5549     flow_id = UUI
-00019da0: 4428 2764 6137 3836 3638 612d 3135 3936  D('da78668a-1596
-00019db0: 2d31 3165 382d 6135 3737 2d64 6361 3930  -11e8-a577-dca90
-00019dc0: 3438 3234 6565 6327 290a 2020 2020 2020  4824eec').      
-00019dd0: 2020 2868 6561 642c 2073 6567 6d65 6e74    (head, segment
-00019de0: 7329 203d 206c 6f61 6473 2862 2253 5342  s) = loads(b"SSB
-00019df0: 4267 7273 675c 7830 375c 7830 305c 7830  Bgrsg\x07\x00\x0
-00019e00: 305c 7830 3022 202b 0a20 2020 2020 2020  0\x00" +.       
-00019e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019e20: 2020 2020 2020 2020 2020 2862 2268 6561            (b"hea
-00019e30: 645c 7834 315c 7830 305c 7830 305c 7830  d\x41\x00\x00\x0
-00019e40: 3022 202b 0a20 2020 2020 2020 2020 2020  0" +.           
-00019e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019e60: 2020 2020 2020 2062 225c 7864 315c 7839         b"\xd1\x9
-00019e70: 635c 7830 625c 7839 315c 7831 355c 7839  c\x0b\x91\x15\x9
-00019e80: 305c 7831 315c 7865 385c 7838 355c 7838  0\x11\xe8\x85\x8
-00019e90: 305c 7864 635c 7861 395c 7830 345c 7838  0\xdc\xa9\x04\x8
-00019ea0: 324e 5c78 6563 2220 2b0a 2020 2020 2020  2N\xec" +.      
-00019eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019ec0: 2020 2020 2020 2020 2020 2020 6222 5c78              b"\x
-00019ed0: 6266 5c78 3037 5c78 3033 5c78 3164 5c78  bf\x07\x03\x1d\x
-00019ee0: 3066 5c78 3066 5c78 3066 2220 2b0a 2020  0f\x0f\x0f" +.  
-00019ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019f10: 2862 2273 6567 6d5c 7832 325c 7830 305c  (b"segm\x22\x00\
-00019f20: 7830 305c 7830 3022 202b 0a20 2020 2020  x00\x00" +.     
+000080a0: 286c 656e 2868 6561 645b 2774 6167 7327  (len(head['tags'
+000080b0: 5d29 2c20 3029 0a20 2020 2020 2020 2073  ]), 0).        s
+000080c0: 656c 662e 6173 7365 7274 496e 2827 6372  elf.assertIn('cr
+000080d0: 6561 7465 6427 2c20 6865 6164 290a 2020  eated', head).  
+000080e0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+000080f0: 7445 7175 616c 2868 6561 645b 2763 7265  tEqual(head['cre
+00008100: 6174 6564 275d 2c20 6372 6561 7465 6429  ated'], created)
+00008110: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+00008120: 7365 7274 496e 2827 7365 676d 656e 7473  sertIn('segments
+00008130: 272c 2068 6561 6429 0a20 2020 2020 2020  ', head).       
+00008140: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+00008150: 6c28 6c65 6e28 6865 6164 5b27 7365 676d  l(len(head['segm
+00008160: 656e 7473 275d 292c 2031 290a 2020 2020  ents']), 1).    
+00008170: 2020 2020 7365 6c66 2e61 7373 6572 7449      self.assertI
+00008180: 6e28 2763 6f75 6e74 272c 2068 6561 645b  n('count', head[
+00008190: 2773 6567 6d65 6e74 7327 5d5b 305d 290a  'segments'][0]).
+000081a0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+000081b0: 6572 7445 7175 616c 2868 6561 645b 2773  ertEqual(head['s
+000081c0: 6567 6d65 6e74 7327 5d5b 305d 5b27 636f  egments'][0]['co
+000081d0: 756e 7427 5d2c 2032 290a 2020 2020 2020  unt'], 2).      
+000081e0: 2020 7365 6c66 2e61 7373 6572 7449 6e28    self.assertIn(
+000081f0: 276c 6f63 616c 5f69 6427 2c20 6865 6164  'local_id', head
+00008200: 5b27 7365 676d 656e 7473 275d 5b30 5d29  ['segments'][0])
+00008210: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+00008220: 7365 7274 4571 7561 6c28 6865 6164 5b27  sertEqual(head['
+00008230: 7365 676d 656e 7473 275d 5b30 5d5b 276c  segments'][0]['l
+00008240: 6f63 616c 5f69 6427 5d2c 2031 290a 2020  ocal_id'], 1).  
+00008250: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00008260: 7449 6e28 2769 6427 2c20 6865 6164 5b27  tIn('id', head['
+00008270: 7365 676d 656e 7473 275d 5b30 5d29 0a20  segments'][0]). 
+00008280: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+00008290: 7274 496e 2868 6561 645b 2773 6567 6d65  rtIn(head['segme
+000082a0: 6e74 7327 5d5b 305d 5b27 6964 275d 2c20  nts'][0]['id'], 
+000082b0: 7575 6964 7329 0a20 2020 2020 2020 2073  uuids).        s
+000082c0: 656c 662e 6173 7365 7274 496e 2827 7461  elf.assertIn('ta
+000082d0: 6773 272c 2068 6561 645b 2773 6567 6d65  gs', head['segme
+000082e0: 6e74 7327 5d5b 305d 290a 2020 2020 2020  nts'][0]).      
+000082f0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+00008300: 616c 286c 656e 2868 6561 645b 2773 6567  al(len(head['seg
+00008310: 6d65 6e74 7327 5d5b 305d 5b27 7461 6773  ments'][0]['tags
+00008320: 275d 292c 2030 290a 0a20 2020 2020 2020  ']), 0)..       
+00008330: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+00008340: 6c28 6c65 6e28 7365 676d 656e 7473 292c  l(len(segments),
+00008350: 2031 290a 2020 2020 2020 2020 7365 6c66   1).        self
+00008360: 2e61 7373 6572 7449 6e28 312c 2073 6567  .assertIn(1, seg
+00008370: 6d65 6e74 7329 0a20 2020 2020 2020 2073  ments).        s
+00008380: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+00008390: 6c65 6e28 7365 676d 656e 7473 5b31 5d29  len(segments[1])
+000083a0: 2c20 6865 6164 5b27 7365 676d 656e 7473  , head['segments
+000083b0: 275d 5b30 5d5b 2763 6f75 6e74 275d 290a  '][0]['count']).
+000083c0: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+000083d0: 7365 7274 4571 7561 6c28 7365 676d 656e  sertEqual(segmen
+000083e0: 7473 5b31 5d5b 305d 2e73 6f75 7263 655f  ts[1][0].source_
+000083f0: 6964 2c20 7372 635f 6964 290a 2020 2020  id, src_id).    
+00008400: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+00008410: 7175 616c 2873 6567 6d65 6e74 735b 315d  qual(segments[1]
+00008420: 5b30 5d2e 666c 6f77 5f69 642c 2066 6c6f  [0].flow_id, flo
+00008430: 775f 6964 290a 2020 2020 2020 2020 7365  w_id).        se
+00008440: 6c66 2e61 7373 6572 7445 7175 616c 2873  lf.assertEqual(s
+00008450: 6567 6d65 6e74 735b 315d 5b30 5d2e 6772  egments[1][0].gr
+00008460: 6169 6e5f 7479 7065 2c20 2763 6f64 6564  ain_type, 'coded
+00008470: 5f61 7564 696f 2729 0a20 2020 2020 2020  _audio').       
+00008480: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+00008490: 6c28 7365 676d 656e 7473 5b31 5d5b 305d  l(segments[1][0]
+000084a0: 2e66 6f72 6d61 742c 2043 6f67 4175 6469  .format, CogAudi
+000084b0: 6f46 6f72 6d61 742e 4141 4329 0a20 2020  oFormat.AAC).   
+000084c0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+000084d0: 4571 7561 6c28 7365 676d 656e 7473 5b31  Equal(segments[1
+000084e0: 5d5b 305d 2e73 616d 706c 6573 2c20 3139  ][0].samples, 19
+000084f0: 3230 290a 2020 2020 2020 2020 7365 6c66  20).        self
+00008500: 2e61 7373 6572 7445 7175 616c 2873 6567  .assertEqual(seg
+00008510: 6d65 6e74 735b 315d 5b30 5d2e 7361 6d70  ments[1][0].samp
+00008520: 6c65 5f72 6174 652c 2034 3830 3030 290a  le_rate, 48000).
+00008530: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+00008540: 6572 7445 7175 616c 2873 6567 6d65 6e74  ertEqual(segment
+00008550: 735b 315d 5b30 5d2e 7072 696d 696e 672c  s[1][0].priming,
+00008560: 2032 3329 0a20 2020 2020 2020 2073 656c   23).        sel
+00008570: 662e 6173 7365 7274 4571 7561 6c28 7365  f.assertEqual(se
+00008580: 676d 656e 7473 5b31 5d5b 305d 2e72 656d  gments[1][0].rem
+00008590: 6169 6e64 6572 2c20 3137 290a 0a20 2020  ainder, 17)..   
+000085a0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+000085b0: 4571 7561 6c28 7365 676d 656e 7473 5b31  Equal(segments[1
+000085c0: 5d5b 305d 2e64 6174 612c 2067 7261 696e  ][0].data, grain
+000085d0: 302e 6461 7461 290a 0a20 2020 2020 2020  0.data)..       
+000085e0: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+000085f0: 6c28 7365 676d 656e 7473 5b31 5d5b 315d  l(segments[1][1]
+00008600: 2e73 6f75 7263 655f 6964 2c20 7372 635f  .source_id, src_
+00008610: 6964 290a 2020 2020 2020 2020 7365 6c66  id).        self
+00008620: 2e61 7373 6572 7445 7175 616c 2873 6567  .assertEqual(seg
+00008630: 6d65 6e74 735b 315d 5b31 5d2e 666c 6f77  ments[1][1].flow
+00008640: 5f69 642c 2066 6c6f 775f 6964 290a 2020  _id, flow_id).  
+00008650: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00008660: 7445 7175 616c 2873 6567 6d65 6e74 735b  tEqual(segments[
+00008670: 315d 5b31 5d2e 6772 6169 6e5f 7479 7065  1][1].grain_type
+00008680: 2c20 2763 6f64 6564 5f61 7564 696f 2729  , 'coded_audio')
+00008690: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+000086a0: 7365 7274 4571 7561 6c28 7365 676d 656e  sertEqual(segmen
+000086b0: 7473 5b31 5d5b 315d 2e66 6f72 6d61 742c  ts[1][1].format,
+000086c0: 2043 6f67 4175 6469 6f46 6f72 6d61 742e   CogAudioFormat.
+000086d0: 4141 4329 0a20 2020 2020 2020 2073 656c  AAC).        sel
+000086e0: 662e 6173 7365 7274 4571 7561 6c28 7365  f.assertEqual(se
+000086f0: 676d 656e 7473 5b31 5d5b 315d 2e73 616d  gments[1][1].sam
+00008700: 706c 6573 2c20 3139 3230 290a 2020 2020  ples, 1920).    
+00008710: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+00008720: 7175 616c 2873 6567 6d65 6e74 735b 315d  qual(segments[1]
+00008730: 5b31 5d2e 7361 6d70 6c65 5f72 6174 652c  [1].sample_rate,
+00008740: 2034 3830 3030 290a 2020 2020 2020 2020   48000).        
+00008750: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+00008760: 2873 6567 6d65 6e74 735b 315d 5b31 5d2e  (segments[1][1].
+00008770: 7072 696d 696e 672c 2035 290a 2020 2020  priming, 5).    
+00008780: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+00008790: 7175 616c 2873 6567 6d65 6e74 735b 315d  qual(segments[1]
+000087a0: 5b31 5d2e 7265 6d61 696e 6465 722c 2031  [1].remainder, 1
+000087b0: 3034 290a 0a20 2020 2020 2020 2073 656c  04)..        sel
+000087c0: 662e 6173 7365 7274 4571 7561 6c28 7365  f.assertEqual(se
+000087d0: 676d 656e 7473 5b31 5d5b 315d 2e64 6174  gments[1][1].dat
+000087e0: 612c 2067 7261 696e 312e 6461 7461 290a  a, grain1.data).
+000087f0: 0a20 2020 2061 7379 6e63 2064 6566 2074  .    async def t
+00008800: 6573 745f 6173 796e 635f 656e 636f 6465  est_async_encode
+00008810: 5f63 6f64 6564 6175 6469 6f67 7261 696e  _codedaudiograin
+00008820: 7328 7365 6c66 293a 0a20 2020 2020 2020  s(self):.       
+00008830: 2073 7263 5f69 6420 3d20 5555 4944 2827   src_id = UUID('
+00008840: 6531 3465 3964 3538 2d31 3536 372d 3131  e14e9d58-1567-11
+00008850: 6538 2d38 6464 332d 3833 3161 3036 3865  e8-8dd3-831a068e
+00008860: 6230 3334 2729 0a20 2020 2020 2020 2066  b034').        f
+00008870: 6c6f 775f 6964 203d 2055 5549 4428 2765  low_id = UUID('e
+00008880: 6531 6565 6435 382d 3135 3637 2d31 3165  e1eed58-1567-11e
+00008890: 382d 6139 3731 2d33 6239 3031 6132 6464  8-a971-3b901a2dd
+000088a0: 3861 6227 290a 2020 2020 2020 2020 6772  8ab').        gr
+000088b0: 6169 6e30 203d 2043 6f64 6564 4175 6469  ain0 = CodedAudi
+000088c0: 6f47 7261 696e 280a 2020 2020 2020 2020  oGrain(.        
+000088d0: 2020 2020 7372 635f 6964 3d73 7263 5f69      src_id=src_i
+000088e0: 642c 0a20 2020 2020 2020 2020 2020 2066  d,.            f
+000088f0: 6c6f 775f 6964 3d66 6c6f 775f 6964 2c0a  low_id=flow_id,.
+00008900: 2020 2020 2020 2020 2020 2020 636f 675f              cog_
+00008910: 6175 6469 6f5f 666f 726d 6174 3d43 6f67  audio_format=Cog
+00008920: 4175 6469 6f46 6f72 6d61 742e 4141 432c  AudioFormat.AAC,
+00008930: 0a20 2020 2020 2020 2020 2020 2073 616d  .            sam
+00008940: 706c 6573 3d31 3932 302c 0a20 2020 2020  ples=1920,.     
+00008950: 2020 2020 2020 2073 616d 706c 655f 7261         sample_ra
+00008960: 7465 3d34 3830 3030 2c0a 2020 2020 2020  te=48000,.      
+00008970: 2020 2020 2020 7072 696d 696e 673d 3233        priming=23
+00008980: 2c0a 2020 2020 2020 2020 2020 2020 7265  ,.            re
+00008990: 6d61 696e 6465 723d 3137 2c0a 2020 2020  mainder=17,.    
+000089a0: 2020 2020 2020 2020 6c65 6e67 7468 3d31          length=1
+000089b0: 3032 3429 0a20 2020 2020 2020 2067 7261  024).        gra
+000089c0: 696e 3120 3d20 436f 6465 6441 7564 696f  in1 = CodedAudio
+000089d0: 4772 6169 6e28 0a20 2020 2020 2020 2020  Grain(.         
+000089e0: 2020 2073 7263 5f69 643d 7372 635f 6964     src_id=src_id
+000089f0: 2c0a 2020 2020 2020 2020 2020 2020 666c  ,.            fl
+00008a00: 6f77 5f69 643d 666c 6f77 5f69 642c 0a20  ow_id=flow_id,. 
+00008a10: 2020 2020 2020 2020 2020 2063 6f67 5f61             cog_a
+00008a20: 7564 696f 5f66 6f72 6d61 743d 436f 6741  udio_format=CogA
+00008a30: 7564 696f 466f 726d 6174 2e41 4143 2c0a  udioFormat.AAC,.
+00008a40: 2020 2020 2020 2020 2020 2020 7361 6d70              samp
+00008a50: 6c65 733d 3139 3230 2c0a 2020 2020 2020  les=1920,.      
+00008a60: 2020 2020 2020 7361 6d70 6c65 5f72 6174        sample_rat
+00008a70: 653d 3438 3030 302c 0a20 2020 2020 2020  e=48000,.       
+00008a80: 2020 2020 2070 7269 6d69 6e67 3d35 2c0a       priming=5,.
+00008a90: 2020 2020 2020 2020 2020 2020 7265 6d61              rema
+00008aa0: 696e 6465 723d 3130 342c 0a20 2020 2020  inder=104,.     
+00008ab0: 2020 2020 2020 206c 656e 6774 683d 3135         length=15
+00008ac0: 3030 290a 2020 2020 2020 2020 666f 7220  00).        for 
+00008ad0: 6920 696e 2072 616e 6765 2830 2c20 6c65  i in range(0, le
+00008ae0: 6e28 6772 6169 6e30 2e64 6174 6129 293a  n(grain0.data)):
+00008af0: 0a20 2020 2020 2020 2020 2020 2067 7261  .            gra
+00008b00: 696e 302e 6461 7461 5b69 5d20 3d20 6920  in0.data[i] = i 
+00008b10: 2620 3078 4646 0a20 2020 2020 2020 2066  & 0xFF.        f
+00008b20: 6f72 2069 2069 6e20 7261 6e67 6528 302c  or i in range(0,
+00008b30: 206c 656e 2867 7261 696e 312e 6461 7461   len(grain1.data
+00008b40: 2929 3a0a 2020 2020 2020 2020 2020 2020  )):.            
+00008b50: 6772 6169 6e31 2e64 6174 615b 695d 203d  grain1.data[i] =
+00008b60: 2030 7846 4620 2d20 2869 2026 2030 7846   0xFF - (i & 0xF
+00008b70: 4629 0a20 2020 2020 2020 2075 7569 6473  F).        uuids
+00008b80: 203d 205b 5555 4944 2827 3739 3230 6233   = [UUID('7920b3
+00008b90: 3934 2d31 3536 352d 3131 6538 2d38 3665  94-1565-11e8-86e
+00008ba0: 302d 3862 3432 6434 3634 3762 6138 2729  0-8b42d4647ba8')
+00008bb0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00008bc0: 2020 2055 5549 4428 2738 3061 6638 3735     UUID('80af875
+00008bd0: 632d 3135 3635 2d31 3165 382d 3866 3434  c-1565-11e8-8f44
+00008be0: 2d38 3765 6630 3831 6234 3863 6427 295d  -87ef081b48cd')]
+00008bf0: 0a20 2020 2020 2020 2063 7265 6174 6564  .        created
+00008c00: 203d 2064 6174 6574 696d 6528 3139 3833   = datetime(1983
+00008c10: 2c20 332c 2032 392c 2031 352c 2031 3529  , 3, 29, 15, 15)
+00008c20: 0a20 2020 2020 2020 2077 6974 6820 6d6f  .        with mo
+00008c30: 636b 2e70 6174 6368 2827 6d65 6469 6167  ck.patch('mediag
+00008c40: 7261 696e 732e 6773 662e 6461 7465 7469  rains.gsf.dateti
+00008c50: 6d65 272c 2073 6964 655f 6566 6665 6374  me', side_effect
+00008c60: 3d64 6174 6574 696d 652c 206e 6f77 3d6d  =datetime, now=m
+00008c70: 6f63 6b2e 4d61 6769 634d 6f63 6b28 7265  ock.MagicMock(re
+00008c80: 7475 726e 5f76 616c 7565 3d63 7265 6174  turn_value=creat
+00008c90: 6564 2929 3a0a 2020 2020 2020 2020 2020  ed)):.          
+00008ca0: 2020 7769 7468 206d 6f63 6b2e 7061 7463    with mock.patc
+00008cb0: 6828 276d 6564 6961 6772 6169 6e73 2e67  h('mediagrains.g
+00008cc0: 7366 2e75 7569 6431 272c 2073 6964 655f  sf.uuid1', side_
+00008cd0: 6566 6665 6374 3d75 7569 6473 293a 0a20  effect=uuids):. 
+00008ce0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00008cf0: 203d 2042 7974 6573 494f 2829 0a20 2020   = BytesIO().   
+00008d00: 2020 2020 2020 2020 2020 2020 2061 7379               asy
+00008d10: 6e63 2077 6974 6820 4753 4645 6e63 6f64  nc with GSFEncod
+00008d20: 6572 2866 2920 6173 2065 6e63 3a0a 2020  er(f) as enc:.  
+00008d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008d40: 2020 6177 6169 7420 656e 632e 6164 645f    await enc.add_
+00008d50: 6772 6169 6e73 285b 6772 6169 6e30 2c20  grains([grain0, 
+00008d60: 6772 6169 6e31 5d29 0a20 2020 2020 2020  grain1]).       
+00008d70: 2020 2020 2020 2020 2028 6865 6164 2c20           (head, 
+00008d80: 7365 676d 656e 7473 2920 3d20 6c6f 6164  segments) = load
+00008d90: 7328 662e 6765 7476 616c 7565 2829 290a  s(f.getvalue()).
+00008da0: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+00008db0: 7365 7274 496e 2827 6964 272c 2068 6561  sertIn('id', hea
+00008dc0: 6429 0a20 2020 2020 2020 2073 656c 662e  d).        self.
+00008dd0: 6173 7365 7274 496e 2868 6561 645b 2769  assertIn(head['i
+00008de0: 6427 5d2c 2075 7569 6473 290a 2020 2020  d'], uuids).    
+00008df0: 2020 2020 7365 6c66 2e61 7373 6572 7449      self.assertI
+00008e00: 6e28 2774 6167 7327 2c20 6865 6164 290a  n('tags', head).
+00008e10: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+00008e20: 6572 7445 7175 616c 286c 656e 2868 6561  ertEqual(len(hea
+00008e30: 645b 2774 6167 7327 5d29 2c20 3029 0a20  d['tags']), 0). 
+00008e40: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+00008e50: 7274 496e 2827 6372 6561 7465 6427 2c20  rtIn('created', 
+00008e60: 6865 6164 290a 2020 2020 2020 2020 7365  head).        se
+00008e70: 6c66 2e61 7373 6572 7445 7175 616c 2868  lf.assertEqual(h
+00008e80: 6561 645b 2763 7265 6174 6564 275d 2c20  ead['created'], 
+00008e90: 6372 6561 7465 6429 0a20 2020 2020 2020  created).       
+00008ea0: 2073 656c 662e 6173 7365 7274 496e 2827   self.assertIn('
+00008eb0: 7365 676d 656e 7473 272c 2068 6561 6429  segments', head)
+00008ec0: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+00008ed0: 7365 7274 4571 7561 6c28 6c65 6e28 6865  sertEqual(len(he
+00008ee0: 6164 5b27 7365 676d 656e 7473 275d 292c  ad['segments']),
+00008ef0: 2031 290a 2020 2020 2020 2020 7365 6c66   1).        self
+00008f00: 2e61 7373 6572 7449 6e28 2763 6f75 6e74  .assertIn('count
+00008f10: 272c 2068 6561 645b 2773 6567 6d65 6e74  ', head['segment
+00008f20: 7327 5d5b 305d 290a 2020 2020 2020 2020  s'][0]).        
+00008f30: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+00008f40: 2868 6561 645b 2773 6567 6d65 6e74 7327  (head['segments'
+00008f50: 5d5b 305d 5b27 636f 756e 7427 5d2c 2032  ][0]['count'], 2
+00008f60: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+00008f70: 7373 6572 7449 6e28 276c 6f63 616c 5f69  ssertIn('local_i
+00008f80: 6427 2c20 6865 6164 5b27 7365 676d 656e  d', head['segmen
+00008f90: 7473 275d 5b30 5d29 0a20 2020 2020 2020  ts'][0]).       
+00008fa0: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+00008fb0: 6c28 6865 6164 5b27 7365 676d 656e 7473  l(head['segments
+00008fc0: 275d 5b30 5d5b 276c 6f63 616c 5f69 6427  '][0]['local_id'
+00008fd0: 5d2c 2031 290a 2020 2020 2020 2020 7365  ], 1).        se
+00008fe0: 6c66 2e61 7373 6572 7449 6e28 2769 6427  lf.assertIn('id'
+00008ff0: 2c20 6865 6164 5b27 7365 676d 656e 7473  , head['segments
+00009000: 275d 5b30 5d29 0a20 2020 2020 2020 2073  '][0]).        s
+00009010: 656c 662e 6173 7365 7274 496e 2868 6561  elf.assertIn(hea
+00009020: 645b 2773 6567 6d65 6e74 7327 5d5b 305d  d['segments'][0]
+00009030: 5b27 6964 275d 2c20 7575 6964 7329 0a20  ['id'], uuids). 
+00009040: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+00009050: 7274 496e 2827 7461 6773 272c 2068 6561  rtIn('tags', hea
+00009060: 645b 2773 6567 6d65 6e74 7327 5d5b 305d  d['segments'][0]
+00009070: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+00009080: 7373 6572 7445 7175 616c 286c 656e 2868  ssertEqual(len(h
+00009090: 6561 645b 2773 6567 6d65 6e74 7327 5d5b  ead['segments'][
+000090a0: 305d 5b27 7461 6773 275d 292c 2030 290a  0]['tags']), 0).
+000090b0: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+000090c0: 7365 7274 4571 7561 6c28 6c65 6e28 7365  sertEqual(len(se
+000090d0: 676d 656e 7473 292c 2031 290a 2020 2020  gments), 1).    
+000090e0: 2020 2020 7365 6c66 2e61 7373 6572 7449      self.assertI
+000090f0: 6e28 312c 2073 6567 6d65 6e74 7329 0a20  n(1, segments). 
+00009100: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+00009110: 7274 4571 7561 6c28 6c65 6e28 7365 676d  rtEqual(len(segm
+00009120: 656e 7473 5b31 5d29 2c20 6865 6164 5b27  ents[1]), head['
+00009130: 7365 676d 656e 7473 275d 5b30 5d5b 2763  segments'][0]['c
+00009140: 6f75 6e74 275d 290a 0a20 2020 2020 2020  ount'])..       
+00009150: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+00009160: 6c28 7365 676d 656e 7473 5b31 5d5b 305d  l(segments[1][0]
+00009170: 2e73 6f75 7263 655f 6964 2c20 7372 635f  .source_id, src_
+00009180: 6964 290a 2020 2020 2020 2020 7365 6c66  id).        self
+00009190: 2e61 7373 6572 7445 7175 616c 2873 6567  .assertEqual(seg
+000091a0: 6d65 6e74 735b 315d 5b30 5d2e 666c 6f77  ments[1][0].flow
+000091b0: 5f69 642c 2066 6c6f 775f 6964 290a 2020  _id, flow_id).  
+000091c0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+000091d0: 7445 7175 616c 2873 6567 6d65 6e74 735b  tEqual(segments[
+000091e0: 315d 5b30 5d2e 6772 6169 6e5f 7479 7065  1][0].grain_type
+000091f0: 2c20 2763 6f64 6564 5f61 7564 696f 2729  , 'coded_audio')
+00009200: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+00009210: 7365 7274 4571 7561 6c28 7365 676d 656e  sertEqual(segmen
+00009220: 7473 5b31 5d5b 305d 2e66 6f72 6d61 742c  ts[1][0].format,
+00009230: 2043 6f67 4175 6469 6f46 6f72 6d61 742e   CogAudioFormat.
+00009240: 4141 4329 0a20 2020 2020 2020 2073 656c  AAC).        sel
+00009250: 662e 6173 7365 7274 4571 7561 6c28 7365  f.assertEqual(se
+00009260: 676d 656e 7473 5b31 5d5b 305d 2e73 616d  gments[1][0].sam
+00009270: 706c 6573 2c20 3139 3230 290a 2020 2020  ples, 1920).    
+00009280: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+00009290: 7175 616c 2873 6567 6d65 6e74 735b 315d  qual(segments[1]
+000092a0: 5b30 5d2e 7361 6d70 6c65 5f72 6174 652c  [0].sample_rate,
+000092b0: 2034 3830 3030 290a 2020 2020 2020 2020   48000).        
+000092c0: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+000092d0: 2873 6567 6d65 6e74 735b 315d 5b30 5d2e  (segments[1][0].
+000092e0: 7072 696d 696e 672c 2032 3329 0a20 2020  priming, 23).   
+000092f0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00009300: 4571 7561 6c28 7365 676d 656e 7473 5b31  Equal(segments[1
+00009310: 5d5b 305d 2e72 656d 6169 6e64 6572 2c20  ][0].remainder, 
+00009320: 3137 290a 0a20 2020 2020 2020 2073 656c  17)..        sel
+00009330: 662e 6173 7365 7274 4571 7561 6c28 7365  f.assertEqual(se
+00009340: 676d 656e 7473 5b31 5d5b 305d 2e64 6174  gments[1][0].dat
+00009350: 612c 2067 7261 696e 302e 6461 7461 290a  a, grain0.data).
+00009360: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+00009370: 7365 7274 4571 7561 6c28 7365 676d 656e  sertEqual(segmen
+00009380: 7473 5b31 5d5b 315d 2e73 6f75 7263 655f  ts[1][1].source_
+00009390: 6964 2c20 7372 635f 6964 290a 2020 2020  id, src_id).    
+000093a0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+000093b0: 7175 616c 2873 6567 6d65 6e74 735b 315d  qual(segments[1]
+000093c0: 5b31 5d2e 666c 6f77 5f69 642c 2066 6c6f  [1].flow_id, flo
+000093d0: 775f 6964 290a 2020 2020 2020 2020 7365  w_id).        se
+000093e0: 6c66 2e61 7373 6572 7445 7175 616c 2873  lf.assertEqual(s
+000093f0: 6567 6d65 6e74 735b 315d 5b31 5d2e 6772  egments[1][1].gr
+00009400: 6169 6e5f 7479 7065 2c20 2763 6f64 6564  ain_type, 'coded
+00009410: 5f61 7564 696f 2729 0a20 2020 2020 2020  _audio').       
+00009420: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+00009430: 6c28 7365 676d 656e 7473 5b31 5d5b 315d  l(segments[1][1]
+00009440: 2e66 6f72 6d61 742c 2043 6f67 4175 6469  .format, CogAudi
+00009450: 6f46 6f72 6d61 742e 4141 4329 0a20 2020  oFormat.AAC).   
+00009460: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00009470: 4571 7561 6c28 7365 676d 656e 7473 5b31  Equal(segments[1
+00009480: 5d5b 315d 2e73 616d 706c 6573 2c20 3139  ][1].samples, 19
+00009490: 3230 290a 2020 2020 2020 2020 7365 6c66  20).        self
+000094a0: 2e61 7373 6572 7445 7175 616c 2873 6567  .assertEqual(seg
+000094b0: 6d65 6e74 735b 315d 5b31 5d2e 7361 6d70  ments[1][1].samp
+000094c0: 6c65 5f72 6174 652c 2034 3830 3030 290a  le_rate, 48000).
+000094d0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+000094e0: 6572 7445 7175 616c 2873 6567 6d65 6e74  ertEqual(segment
+000094f0: 735b 315d 5b31 5d2e 7072 696d 696e 672c  s[1][1].priming,
+00009500: 2035 290a 2020 2020 2020 2020 7365 6c66   5).        self
+00009510: 2e61 7373 6572 7445 7175 616c 2873 6567  .assertEqual(seg
+00009520: 6d65 6e74 735b 315d 5b31 5d2e 7265 6d61  ments[1][1].rema
+00009530: 696e 6465 722c 2031 3034 290a 0a20 2020  inder, 104)..   
+00009540: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00009550: 4571 7561 6c28 7365 676d 656e 7473 5b31  Equal(segments[1
+00009560: 5d5b 315d 2e64 6174 612c 2067 7261 696e  ][1].data, grain
+00009570: 312e 6461 7461 290a 0a20 2020 2064 6566  1.data)..    def
+00009580: 2074 6573 745f 6475 6d70 735f 6576 656e   test_dumps_even
+00009590: 7467 7261 696e 7328 7365 6c66 293a 0a20  tgrains(self):. 
+000095a0: 2020 2020 2020 2073 7263 5f69 6420 3d20         src_id = 
+000095b0: 5555 4944 2827 6531 3465 3964 3538 2d31  UUID('e14e9d58-1
+000095c0: 3536 372d 3131 6538 2d38 6464 332d 3833  567-11e8-8dd3-83
+000095d0: 3161 3036 3865 6230 3334 2729 0a20 2020  1a068eb034').   
+000095e0: 2020 2020 2066 6c6f 775f 6964 203d 2055       flow_id = U
+000095f0: 5549 4428 2765 6531 6565 6435 382d 3135  UID('ee1eed58-15
+00009600: 3637 2d31 3165 382d 6139 3731 2d33 6239  67-11e8-a971-3b9
+00009610: 3031 6132 6464 3861 6227 290a 2020 2020  01a2dd8ab').    
+00009620: 2020 2020 6772 6169 6e30 203d 2045 7665      grain0 = Eve
+00009630: 6e74 4772 6169 6e28 7372 635f 6964 3d73  ntGrain(src_id=s
+00009640: 7263 5f69 642c 2066 6c6f 775f 6964 3d66  rc_id, flow_id=f
+00009650: 6c6f 775f 6964 290a 2020 2020 2020 2020  low_id).        
+00009660: 6772 6169 6e30 2e65 7665 6e74 5f74 7970  grain0.event_typ
+00009670: 6520 3d20 2275 726e 3a78 2d74 6573 7469  e = "urn:x-testi
+00009680: 6e67 3a73 7475 7069 642f 7479 7065 220a  ng:stupid/type".
+00009690: 2020 2020 2020 2020 6772 6169 6e30 2e74          grain0.t
+000096a0: 6f70 6963 203d 2022 2f77 6174 6173 6869  opic = "/watashi
+000096b0: 220a 2020 2020 2020 2020 6772 6169 6e30  ".        grain0
+000096c0: 2e61 7070 656e 6428 222f 696e 7522 2c20  .append("/inu", 
+000096d0: 706f 7374 3d22 6465 7375 2229 0a20 2020  post="desu").   
+000096e0: 2020 2020 2067 7261 696e 3120 3d20 4576       grain1 = Ev
+000096f0: 656e 7447 7261 696e 2873 7263 5f69 643d  entGrain(src_id=
+00009700: 7372 635f 6964 2c20 666c 6f77 5f69 643d  src_id, flow_id=
+00009710: 666c 6f77 5f69 6429 0a20 2020 2020 2020  flow_id).       
+00009720: 2067 7261 696e 312e 6576 656e 745f 7479   grain1.event_ty
+00009730: 7065 203d 2022 7572 6e3a 782d 7465 7374  pe = "urn:x-test
+00009740: 696e 673a 636c 6576 6572 2f74 7970 6522  ing:clever/type"
+00009750: 0a20 2020 2020 2020 2067 7261 696e 312e  .        grain1.
+00009760: 746f 7069 6320 3d20 222f 696e 7522 0a20  topic = "/inu". 
+00009770: 2020 2020 2020 2067 7261 696e 312e 6170         grain1.ap
+00009780: 7065 6e64 2822 2f73 756b 696d 6f6e 6f22  pend("/sukimono"
+00009790: 2c20 7072 653d 2264 6122 290a 2020 2020  , pre="da").    
+000097a0: 2020 2020 7575 6964 7320 3d20 5b55 5549      uuids = [UUI
+000097b0: 4428 2737 3932 3062 3339 342d 3135 3635  D('7920b394-1565
+000097c0: 2d31 3165 382d 3836 6530 2d38 6234 3264  -11e8-86e0-8b42d
+000097d0: 3436 3437 6261 3827 292c 0a20 2020 2020  4647ba8'),.     
+000097e0: 2020 2020 2020 2020 2020 2020 5555 4944              UUID
+000097f0: 2827 3830 6166 3837 3563 2d31 3536 352d  ('80af875c-1565-
+00009800: 3131 6538 2d38 6634 342d 3837 6566 3038  11e8-8f44-87ef08
+00009810: 3162 3438 6364 2729 5d0a 2020 2020 2020  1b48cd')].      
+00009820: 2020 6372 6561 7465 6420 3d20 6461 7465    created = date
+00009830: 7469 6d65 2831 3938 332c 2033 2c20 3239  time(1983, 3, 29
+00009840: 2c20 3135 2c20 3135 290a 2020 2020 2020  , 15, 15).      
+00009850: 2020 7769 7468 206d 6f63 6b2e 7061 7463    with mock.patc
+00009860: 6828 276d 6564 6961 6772 6169 6e73 2e67  h('mediagrains.g
+00009870: 7366 2e64 6174 6574 696d 6527 2c20 7369  sf.datetime', si
+00009880: 6465 5f65 6666 6563 743d 6461 7465 7469  de_effect=dateti
+00009890: 6d65 2c20 6e6f 773d 6d6f 636b 2e4d 6167  me, now=mock.Mag
+000098a0: 6963 4d6f 636b 2872 6574 7572 6e5f 7661  icMock(return_va
+000098b0: 6c75 653d 6372 6561 7465 6429 293a 0a20  lue=created)):. 
+000098c0: 2020 2020 2020 2020 2020 2077 6974 6820             with 
+000098d0: 6d6f 636b 2e70 6174 6368 2827 6d65 6469  mock.patch('medi
+000098e0: 6167 7261 696e 732e 6773 662e 7575 6964  agrains.gsf.uuid
+000098f0: 3127 2c20 7369 6465 5f65 6666 6563 743d  1', side_effect=
+00009900: 7575 6964 7329 3a0a 2020 2020 2020 2020  uuids):.        
+00009910: 2020 2020 2020 2020 2868 6561 642c 2073          (head, s
+00009920: 6567 6d65 6e74 7329 203d 206c 6f61 6473  egments) = loads
+00009930: 2864 756d 7073 285b 6772 6169 6e30 2c20  (dumps([grain0, 
+00009940: 6772 6169 6e31 5d29 290a 0a20 2020 2020  grain1]))..     
+00009950: 2020 2073 656c 662e 6173 7365 7274 496e     self.assertIn
+00009960: 2827 6964 272c 2068 6561 6429 0a20 2020  ('id', head).   
+00009970: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00009980: 496e 2868 6561 645b 2769 6427 5d2c 2075  In(head['id'], u
+00009990: 7569 6473 290a 2020 2020 2020 2020 7365  uids).        se
+000099a0: 6c66 2e61 7373 6572 7449 6e28 2774 6167  lf.assertIn('tag
+000099b0: 7327 2c20 6865 6164 290a 2020 2020 2020  s', head).      
+000099c0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+000099d0: 616c 286c 656e 2868 6561 645b 2774 6167  al(len(head['tag
+000099e0: 7327 5d29 2c20 3029 0a20 2020 2020 2020  s']), 0).       
+000099f0: 2073 656c 662e 6173 7365 7274 496e 2827   self.assertIn('
+00009a00: 6372 6561 7465 6427 2c20 6865 6164 290a  created', head).
+00009a10: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+00009a20: 6572 7445 7175 616c 2868 6561 645b 2763  ertEqual(head['c
+00009a30: 7265 6174 6564 275d 2c20 6372 6561 7465  reated'], create
+00009a40: 6429 0a20 2020 2020 2020 2073 656c 662e  d).        self.
+00009a50: 6173 7365 7274 496e 2827 7365 676d 656e  assertIn('segmen
+00009a60: 7473 272c 2068 6561 6429 0a20 2020 2020  ts', head).     
+00009a70: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+00009a80: 7561 6c28 6c65 6e28 6865 6164 5b27 7365  ual(len(head['se
+00009a90: 676d 656e 7473 275d 292c 2031 290a 2020  gments']), 1).  
+00009aa0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00009ab0: 7449 6e28 2763 6f75 6e74 272c 2068 6561  tIn('count', hea
+00009ac0: 645b 2773 6567 6d65 6e74 7327 5d5b 305d  d['segments'][0]
+00009ad0: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+00009ae0: 7373 6572 7445 7175 616c 2868 6561 645b  ssertEqual(head[
+00009af0: 2773 6567 6d65 6e74 7327 5d5b 305d 5b27  'segments'][0]['
+00009b00: 636f 756e 7427 5d2c 2032 290a 2020 2020  count'], 2).    
+00009b10: 2020 2020 7365 6c66 2e61 7373 6572 7449      self.assertI
+00009b20: 6e28 276c 6f63 616c 5f69 6427 2c20 6865  n('local_id', he
+00009b30: 6164 5b27 7365 676d 656e 7473 275d 5b30  ad['segments'][0
+00009b40: 5d29 0a20 2020 2020 2020 2073 656c 662e  ]).        self.
+00009b50: 6173 7365 7274 4571 7561 6c28 6865 6164  assertEqual(head
+00009b60: 5b27 7365 676d 656e 7473 275d 5b30 5d5b  ['segments'][0][
+00009b70: 276c 6f63 616c 5f69 6427 5d2c 2031 290a  'local_id'], 1).
+00009b80: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+00009b90: 6572 7449 6e28 2769 6427 2c20 6865 6164  ertIn('id', head
+00009ba0: 5b27 7365 676d 656e 7473 275d 5b30 5d29  ['segments'][0])
+00009bb0: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+00009bc0: 7365 7274 496e 2868 6561 645b 2773 6567  sertIn(head['seg
+00009bd0: 6d65 6e74 7327 5d5b 305d 5b27 6964 275d  ments'][0]['id']
+00009be0: 2c20 7575 6964 7329 0a20 2020 2020 2020  , uuids).       
+00009bf0: 2073 656c 662e 6173 7365 7274 496e 2827   self.assertIn('
+00009c00: 7461 6773 272c 2068 6561 645b 2773 6567  tags', head['seg
+00009c10: 6d65 6e74 7327 5d5b 305d 290a 2020 2020  ments'][0]).    
+00009c20: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+00009c30: 7175 616c 286c 656e 2868 6561 645b 2773  qual(len(head['s
+00009c40: 6567 6d65 6e74 7327 5d5b 305d 5b27 7461  egments'][0]['ta
+00009c50: 6773 275d 292c 2030 290a 0a20 2020 2020  gs']), 0)..     
+00009c60: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+00009c70: 7561 6c28 6c65 6e28 7365 676d 656e 7473  ual(len(segments
+00009c80: 292c 2031 290a 2020 2020 2020 2020 7365  ), 1).        se
+00009c90: 6c66 2e61 7373 6572 7449 6e28 312c 2073  lf.assertIn(1, s
+00009ca0: 6567 6d65 6e74 7329 0a20 2020 2020 2020  egments).       
+00009cb0: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+00009cc0: 6c28 6c65 6e28 7365 676d 656e 7473 5b31  l(len(segments[1
+00009cd0: 5d29 2c20 6865 6164 5b27 7365 676d 656e  ]), head['segmen
+00009ce0: 7473 275d 5b30 5d5b 2763 6f75 6e74 275d  ts'][0]['count']
+00009cf0: 290a 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+00009d00: 6173 7365 7274 4571 7561 6c28 7365 676d  assertEqual(segm
+00009d10: 656e 7473 5b31 5d5b 305d 2e73 6f75 7263  ents[1][0].sourc
+00009d20: 655f 6964 2c20 7372 635f 6964 290a 2020  e_id, src_id).  
+00009d30: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00009d40: 7445 7175 616c 2873 6567 6d65 6e74 735b  tEqual(segments[
+00009d50: 315d 5b30 5d2e 666c 6f77 5f69 642c 2066  1][0].flow_id, f
+00009d60: 6c6f 775f 6964 290a 2020 2020 2020 2020  low_id).        
+00009d70: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+00009d80: 2873 6567 6d65 6e74 735b 315d 5b30 5d2e  (segments[1][0].
+00009d90: 6772 6169 6e5f 7479 7065 2c20 2765 7665  grain_type, 'eve
+00009da0: 6e74 2729 0a20 2020 2020 2020 2073 656c  nt').        sel
+00009db0: 662e 6173 7365 7274 4571 7561 6c28 7365  f.assertEqual(se
+00009dc0: 676d 656e 7473 5b31 5d5b 305d 2e65 7665  gments[1][0].eve
+00009dd0: 6e74 5f74 7970 652c 2022 7572 6e3a 782d  nt_type, "urn:x-
+00009de0: 7465 7374 696e 673a 7374 7570 6964 2f74  testing:stupid/t
+00009df0: 7970 6522 290a 2020 2020 2020 2020 7365  ype").        se
+00009e00: 6c66 2e61 7373 6572 7445 7175 616c 2873  lf.assertEqual(s
+00009e10: 6567 6d65 6e74 735b 315d 5b30 5d2e 746f  egments[1][0].to
+00009e20: 7069 632c 2022 2f77 6174 6173 6869 2229  pic, "/watashi")
+00009e30: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+00009e40: 7365 7274 4571 7561 6c28 6c65 6e28 7365  sertEqual(len(se
+00009e50: 676d 656e 7473 5b31 5d5b 305d 2e65 7665  gments[1][0].eve
+00009e60: 6e74 5f64 6174 6129 2c20 3129 0a20 2020  nt_data), 1).   
+00009e70: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00009e80: 4571 7561 6c28 7365 676d 656e 7473 5b31  Equal(segments[1
+00009e90: 5d5b 305d 2e65 7665 6e74 5f64 6174 615b  ][0].event_data[
+00009ea0: 305d 2e70 6174 682c 2022 2f69 6e75 2229  0].path, "/inu")
+00009eb0: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+00009ec0: 7365 7274 4973 4e6f 6e65 2873 6567 6d65  sertIsNone(segme
+00009ed0: 6e74 735b 315d 5b30 5d2e 6576 656e 745f  nts[1][0].event_
+00009ee0: 6461 7461 5b30 5d2e 7072 6529 0a20 2020  data[0].pre).   
+00009ef0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00009f00: 4571 7561 6c28 7365 676d 656e 7473 5b31  Equal(segments[1
+00009f10: 5d5b 305d 2e65 7665 6e74 5f64 6174 615b  ][0].event_data[
+00009f20: 305d 2e70 6f73 742c 2022 6465 7375 2229  0].post, "desu")
+00009f30: 0a0a 2020 2020 2020 2020 7365 6c66 2e61  ..        self.a
+00009f40: 7373 6572 7445 7175 616c 2873 6567 6d65  ssertEqual(segme
+00009f50: 6e74 735b 315d 5b31 5d2e 736f 7572 6365  nts[1][1].source
+00009f60: 5f69 642c 2073 7263 5f69 6429 0a20 2020  _id, src_id).   
+00009f70: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00009f80: 4571 7561 6c28 7365 676d 656e 7473 5b31  Equal(segments[1
+00009f90: 5d5b 315d 2e66 6c6f 775f 6964 2c20 666c  ][1].flow_id, fl
+00009fa0: 6f77 5f69 6429 0a20 2020 2020 2020 2073  ow_id).        s
+00009fb0: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+00009fc0: 7365 676d 656e 7473 5b31 5d5b 315d 2e67  segments[1][1].g
+00009fd0: 7261 696e 5f74 7970 652c 2027 6576 656e  rain_type, 'even
+00009fe0: 7427 290a 2020 2020 2020 2020 7365 6c66  t').        self
+00009ff0: 2e61 7373 6572 7445 7175 616c 2873 6567  .assertEqual(seg
+0000a000: 6d65 6e74 735b 315d 5b31 5d2e 6576 656e  ments[1][1].even
+0000a010: 745f 7479 7065 2c20 2275 726e 3a78 2d74  t_type, "urn:x-t
+0000a020: 6573 7469 6e67 3a63 6c65 7665 722f 7479  esting:clever/ty
+0000a030: 7065 2229 0a20 2020 2020 2020 2073 656c  pe").        sel
+0000a040: 662e 6173 7365 7274 4571 7561 6c28 7365  f.assertEqual(se
+0000a050: 676d 656e 7473 5b31 5d5b 315d 2e74 6f70  gments[1][1].top
+0000a060: 6963 2c20 222f 696e 7522 290a 2020 2020  ic, "/inu").    
+0000a070: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+0000a080: 7175 616c 286c 656e 2873 6567 6d65 6e74  qual(len(segment
+0000a090: 735b 315d 5b31 5d2e 6576 656e 745f 6461  s[1][1].event_da
+0000a0a0: 7461 292c 2031 290a 2020 2020 2020 2020  ta), 1).        
+0000a0b0: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+0000a0c0: 2873 6567 6d65 6e74 735b 315d 5b31 5d2e  (segments[1][1].
+0000a0d0: 6576 656e 745f 6461 7461 5b30 5d2e 7061  event_data[0].pa
+0000a0e0: 7468 2c20 222f 7375 6b69 6d6f 6e6f 2229  th, "/sukimono")
+0000a0f0: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+0000a100: 7365 7274 4571 7561 6c28 7365 676d 656e  sertEqual(segmen
+0000a110: 7473 5b31 5d5b 315d 2e65 7665 6e74 5f64  ts[1][1].event_d
+0000a120: 6174 615b 305d 2e70 7265 2c20 2264 6122  ata[0].pre, "da"
+0000a130: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+0000a140: 7373 6572 7449 734e 6f6e 6528 7365 676d  ssertIsNone(segm
+0000a150: 656e 7473 5b31 5d5b 315d 2e65 7665 6e74  ents[1][1].event
+0000a160: 5f64 6174 615b 305d 2e70 6f73 7429 0a0a  _data[0].post)..
+0000a170: 2020 2020 6173 796e 6320 6465 6620 7465      async def te
+0000a180: 7374 5f61 7379 6e63 5f65 6e63 6f64 655f  st_async_encode_
+0000a190: 6576 656e 7467 7261 696e 7328 7365 6c66  eventgrains(self
+0000a1a0: 293a 0a20 2020 2020 2020 2073 7263 5f69  ):.        src_i
+0000a1b0: 6420 3d20 5555 4944 2827 6531 3465 3964  d = UUID('e14e9d
+0000a1c0: 3538 2d31 3536 372d 3131 6538 2d38 6464  58-1567-11e8-8dd
+0000a1d0: 332d 3833 3161 3036 3865 6230 3334 2729  3-831a068eb034')
+0000a1e0: 0a20 2020 2020 2020 2066 6c6f 775f 6964  .        flow_id
+0000a1f0: 203d 2055 5549 4428 2765 6531 6565 6435   = UUID('ee1eed5
+0000a200: 382d 3135 3637 2d31 3165 382d 6139 3731  8-1567-11e8-a971
+0000a210: 2d33 6239 3031 6132 6464 3861 6227 290a  -3b901a2dd8ab').
+0000a220: 2020 2020 2020 2020 6772 6169 6e30 203d          grain0 =
+0000a230: 2045 7665 6e74 4772 6169 6e28 7372 635f   EventGrain(src_
+0000a240: 6964 3d73 7263 5f69 642c 2066 6c6f 775f  id=src_id, flow_
+0000a250: 6964 3d66 6c6f 775f 6964 290a 2020 2020  id=flow_id).    
+0000a260: 2020 2020 6772 6169 6e30 2e65 7665 6e74      grain0.event
+0000a270: 5f74 7970 6520 3d20 2275 726e 3a78 2d74  _type = "urn:x-t
+0000a280: 6573 7469 6e67 3a73 7475 7069 642f 7479  esting:stupid/ty
+0000a290: 7065 220a 2020 2020 2020 2020 6772 6169  pe".        grai
+0000a2a0: 6e30 2e74 6f70 6963 203d 2022 2f77 6174  n0.topic = "/wat
+0000a2b0: 6173 6869 220a 2020 2020 2020 2020 6772  ashi".        gr
+0000a2c0: 6169 6e30 2e61 7070 656e 6428 222f 696e  ain0.append("/in
+0000a2d0: 7522 2c20 706f 7374 3d22 6465 7375 2229  u", post="desu")
+0000a2e0: 0a20 2020 2020 2020 2067 7261 696e 3120  .        grain1 
+0000a2f0: 3d20 4576 656e 7447 7261 696e 2873 7263  = EventGrain(src
+0000a300: 5f69 643d 7372 635f 6964 2c20 666c 6f77  _id=src_id, flow
+0000a310: 5f69 643d 666c 6f77 5f69 6429 0a20 2020  _id=flow_id).   
+0000a320: 2020 2020 2067 7261 696e 312e 6576 656e       grain1.even
+0000a330: 745f 7479 7065 203d 2022 7572 6e3a 782d  t_type = "urn:x-
+0000a340: 7465 7374 696e 673a 636c 6576 6572 2f74  testing:clever/t
+0000a350: 7970 6522 0a20 2020 2020 2020 2067 7261  ype".        gra
+0000a360: 696e 312e 746f 7069 6320 3d20 222f 696e  in1.topic = "/in
+0000a370: 7522 0a20 2020 2020 2020 2067 7261 696e  u".        grain
+0000a380: 312e 6170 7065 6e64 2822 2f73 756b 696d  1.append("/sukim
+0000a390: 6f6e 6f22 2c20 7072 653d 2264 6122 290a  ono", pre="da").
+0000a3a0: 2020 2020 2020 2020 7575 6964 7320 3d20          uuids = 
+0000a3b0: 5b55 5549 4428 2737 3932 3062 3339 342d  [UUID('7920b394-
+0000a3c0: 3135 3635 2d31 3165 382d 3836 6530 2d38  1565-11e8-86e0-8
+0000a3d0: 6234 3264 3436 3437 6261 3827 292c 0a20  b42d4647ba8'),. 
+0000a3e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a3f0: 5555 4944 2827 3830 6166 3837 3563 2d31  UUID('80af875c-1
+0000a400: 3536 352d 3131 6538 2d38 6634 342d 3837  565-11e8-8f44-87
+0000a410: 6566 3038 3162 3438 6364 2729 5d0a 2020  ef081b48cd')].  
+0000a420: 2020 2020 2020 6372 6561 7465 6420 3d20        created = 
+0000a430: 6461 7465 7469 6d65 2831 3938 332c 2033  datetime(1983, 3
+0000a440: 2c20 3239 2c20 3135 2c20 3135 290a 2020  , 29, 15, 15).  
+0000a450: 2020 2020 2020 7769 7468 206d 6f63 6b2e        with mock.
+0000a460: 7061 7463 6828 276d 6564 6961 6772 6169  patch('mediagrai
+0000a470: 6e73 2e67 7366 2e64 6174 6574 696d 6527  ns.gsf.datetime'
+0000a480: 2c20 7369 6465 5f65 6666 6563 743d 6461  , side_effect=da
+0000a490: 7465 7469 6d65 2c20 6e6f 773d 6d6f 636b  tetime, now=mock
+0000a4a0: 2e4d 6167 6963 4d6f 636b 2872 6574 7572  .MagicMock(retur
+0000a4b0: 6e5f 7661 6c75 653d 6372 6561 7465 6429  n_value=created)
+0000a4c0: 293a 0a20 2020 2020 2020 2020 2020 2077  ):.            w
+0000a4d0: 6974 6820 6d6f 636b 2e70 6174 6368 2827  ith mock.patch('
+0000a4e0: 6d65 6469 6167 7261 696e 732e 6773 662e  mediagrains.gsf.
+0000a4f0: 7575 6964 3127 2c20 7369 6465 5f65 6666  uuid1', side_eff
+0000a500: 6563 743d 7575 6964 7329 3a0a 2020 2020  ect=uuids):.    
+0000a510: 2020 2020 2020 2020 2020 2020 6620 3d20              f = 
+0000a520: 4279 7465 7349 4f28 290a 2020 2020 2020  BytesIO().      
+0000a530: 2020 2020 2020 2020 2020 6173 796e 6320            async 
+0000a540: 7769 7468 2047 5346 456e 636f 6465 7228  with GSFEncoder(
+0000a550: 6629 2061 7320 656e 633a 0a20 2020 2020  f) as enc:.     
+0000a560: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+0000a570: 7761 6974 2065 6e63 2e61 6464 5f67 7261  wait enc.add_gra
+0000a580: 696e 7328 5b67 7261 696e 302c 2067 7261  ins([grain0, gra
+0000a590: 696e 315d 290a 2020 2020 2020 2020 2020  in1]).          
+0000a5a0: 2020 2020 2020 2868 6561 642c 2073 6567        (head, seg
+0000a5b0: 6d65 6e74 7329 203d 206c 6f61 6473 2866  ments) = loads(f
+0000a5c0: 2e67 6574 7661 6c75 6528 2929 0a0a 2020  .getvalue())..  
+0000a5d0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+0000a5e0: 7449 6e28 2769 6427 2c20 6865 6164 290a  tIn('id', head).
+0000a5f0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+0000a600: 6572 7449 6e28 6865 6164 5b27 6964 275d  ertIn(head['id']
+0000a610: 2c20 7575 6964 7329 0a20 2020 2020 2020  , uuids).       
+0000a620: 2073 656c 662e 6173 7365 7274 496e 2827   self.assertIn('
+0000a630: 7461 6773 272c 2068 6561 6429 0a20 2020  tags', head).   
+0000a640: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+0000a650: 4571 7561 6c28 6c65 6e28 6865 6164 5b27  Equal(len(head['
+0000a660: 7461 6773 275d 292c 2030 290a 2020 2020  tags']), 0).    
+0000a670: 2020 2020 7365 6c66 2e61 7373 6572 7449      self.assertI
+0000a680: 6e28 2763 7265 6174 6564 272c 2068 6561  n('created', hea
+0000a690: 6429 0a20 2020 2020 2020 2073 656c 662e  d).        self.
+0000a6a0: 6173 7365 7274 4571 7561 6c28 6865 6164  assertEqual(head
+0000a6b0: 5b27 6372 6561 7465 6427 5d2c 2063 7265  ['created'], cre
+0000a6c0: 6174 6564 290a 2020 2020 2020 2020 7365  ated).        se
+0000a6d0: 6c66 2e61 7373 6572 7449 6e28 2773 6567  lf.assertIn('seg
+0000a6e0: 6d65 6e74 7327 2c20 6865 6164 290a 2020  ments', head).  
+0000a6f0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+0000a700: 7445 7175 616c 286c 656e 2868 6561 645b  tEqual(len(head[
+0000a710: 2773 6567 6d65 6e74 7327 5d29 2c20 3129  'segments']), 1)
+0000a720: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+0000a730: 7365 7274 496e 2827 636f 756e 7427 2c20  sertIn('count', 
+0000a740: 6865 6164 5b27 7365 676d 656e 7473 275d  head['segments']
+0000a750: 5b30 5d29 0a20 2020 2020 2020 2073 656c  [0]).        sel
+0000a760: 662e 6173 7365 7274 4571 7561 6c28 6865  f.assertEqual(he
+0000a770: 6164 5b27 7365 676d 656e 7473 275d 5b30  ad['segments'][0
+0000a780: 5d5b 2763 6f75 6e74 275d 2c20 3229 0a20  ]['count'], 2). 
+0000a790: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+0000a7a0: 7274 496e 2827 6c6f 6361 6c5f 6964 272c  rtIn('local_id',
+0000a7b0: 2068 6561 645b 2773 6567 6d65 6e74 7327   head['segments'
+0000a7c0: 5d5b 305d 290a 2020 2020 2020 2020 7365  ][0]).        se
+0000a7d0: 6c66 2e61 7373 6572 7445 7175 616c 2868  lf.assertEqual(h
+0000a7e0: 6561 645b 2773 6567 6d65 6e74 7327 5d5b  ead['segments'][
+0000a7f0: 305d 5b27 6c6f 6361 6c5f 6964 275d 2c20  0]['local_id'], 
+0000a800: 3129 0a20 2020 2020 2020 2073 656c 662e  1).        self.
+0000a810: 6173 7365 7274 496e 2827 6964 272c 2068  assertIn('id', h
+0000a820: 6561 645b 2773 6567 6d65 6e74 7327 5d5b  ead['segments'][
+0000a830: 305d 290a 2020 2020 2020 2020 7365 6c66  0]).        self
+0000a840: 2e61 7373 6572 7449 6e28 6865 6164 5b27  .assertIn(head['
+0000a850: 7365 676d 656e 7473 275d 5b30 5d5b 2769  segments'][0]['i
+0000a860: 6427 5d2c 2075 7569 6473 290a 2020 2020  d'], uuids).    
+0000a870: 2020 2020 7365 6c66 2e61 7373 6572 7449      self.assertI
+0000a880: 6e28 2774 6167 7327 2c20 6865 6164 5b27  n('tags', head['
+0000a890: 7365 676d 656e 7473 275d 5b30 5d29 0a20  segments'][0]). 
+0000a8a0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+0000a8b0: 7274 4571 7561 6c28 6c65 6e28 6865 6164  rtEqual(len(head
+0000a8c0: 5b27 7365 676d 656e 7473 275d 5b30 5d5b  ['segments'][0][
+0000a8d0: 2774 6167 7327 5d29 2c20 3029 0a0a 2020  'tags']), 0)..  
+0000a8e0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+0000a8f0: 7445 7175 616c 286c 656e 2873 6567 6d65  tEqual(len(segme
+0000a900: 6e74 7329 2c20 3129 0a20 2020 2020 2020  nts), 1).       
+0000a910: 2073 656c 662e 6173 7365 7274 496e 2831   self.assertIn(1
+0000a920: 2c20 7365 676d 656e 7473 290a 2020 2020  , segments).    
+0000a930: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+0000a940: 7175 616c 286c 656e 2873 6567 6d65 6e74  qual(len(segment
+0000a950: 735b 315d 292c 2068 6561 645b 2773 6567  s[1]), head['seg
+0000a960: 6d65 6e74 7327 5d5b 305d 5b27 636f 756e  ments'][0]['coun
+0000a970: 7427 5d29 0a0a 2020 2020 2020 2020 7365  t'])..        se
+0000a980: 6c66 2e61 7373 6572 7445 7175 616c 2873  lf.assertEqual(s
+0000a990: 6567 6d65 6e74 735b 315d 5b30 5d2e 736f  egments[1][0].so
+0000a9a0: 7572 6365 5f69 642c 2073 7263 5f69 6429  urce_id, src_id)
+0000a9b0: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+0000a9c0: 7365 7274 4571 7561 6c28 7365 676d 656e  sertEqual(segmen
+0000a9d0: 7473 5b31 5d5b 305d 2e66 6c6f 775f 6964  ts[1][0].flow_id
+0000a9e0: 2c20 666c 6f77 5f69 6429 0a20 2020 2020  , flow_id).     
+0000a9f0: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+0000aa00: 7561 6c28 7365 676d 656e 7473 5b31 5d5b  ual(segments[1][
+0000aa10: 305d 2e67 7261 696e 5f74 7970 652c 2027  0].grain_type, '
+0000aa20: 6576 656e 7427 290a 2020 2020 2020 2020  event').        
+0000aa30: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+0000aa40: 2873 6567 6d65 6e74 735b 315d 5b30 5d2e  (segments[1][0].
+0000aa50: 6576 656e 745f 7479 7065 2c20 2275 726e  event_type, "urn
+0000aa60: 3a78 2d74 6573 7469 6e67 3a73 7475 7069  :x-testing:stupi
+0000aa70: 642f 7479 7065 2229 0a20 2020 2020 2020  d/type").       
+0000aa80: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+0000aa90: 6c28 7365 676d 656e 7473 5b31 5d5b 305d  l(segments[1][0]
+0000aaa0: 2e74 6f70 6963 2c20 222f 7761 7461 7368  .topic, "/watash
+0000aab0: 6922 290a 2020 2020 2020 2020 7365 6c66  i").        self
+0000aac0: 2e61 7373 6572 7445 7175 616c 286c 656e  .assertEqual(len
+0000aad0: 2873 6567 6d65 6e74 735b 315d 5b30 5d2e  (segments[1][0].
+0000aae0: 6576 656e 745f 6461 7461 292c 2031 290a  event_data), 1).
+0000aaf0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+0000ab00: 6572 7445 7175 616c 2873 6567 6d65 6e74  ertEqual(segment
+0000ab10: 735b 315d 5b30 5d2e 6576 656e 745f 6461  s[1][0].event_da
+0000ab20: 7461 5b30 5d2e 7061 7468 2c20 222f 696e  ta[0].path, "/in
+0000ab30: 7522 290a 2020 2020 2020 2020 7365 6c66  u").        self
+0000ab40: 2e61 7373 6572 7449 734e 6f6e 6528 7365  .assertIsNone(se
+0000ab50: 676d 656e 7473 5b31 5d5b 305d 2e65 7665  gments[1][0].eve
+0000ab60: 6e74 5f64 6174 615b 305d 2e70 7265 290a  nt_data[0].pre).
+0000ab70: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+0000ab80: 6572 7445 7175 616c 2873 6567 6d65 6e74  ertEqual(segment
+0000ab90: 735b 315d 5b30 5d2e 6576 656e 745f 6461  s[1][0].event_da
+0000aba0: 7461 5b30 5d2e 706f 7374 2c20 2264 6573  ta[0].post, "des
+0000abb0: 7522 290a 0a20 2020 2020 2020 2073 656c  u")..        sel
+0000abc0: 662e 6173 7365 7274 4571 7561 6c28 7365  f.assertEqual(se
+0000abd0: 676d 656e 7473 5b31 5d5b 315d 2e73 6f75  gments[1][1].sou
+0000abe0: 7263 655f 6964 2c20 7372 635f 6964 290a  rce_id, src_id).
+0000abf0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+0000ac00: 6572 7445 7175 616c 2873 6567 6d65 6e74  ertEqual(segment
+0000ac10: 735b 315d 5b31 5d2e 666c 6f77 5f69 642c  s[1][1].flow_id,
+0000ac20: 2066 6c6f 775f 6964 290a 2020 2020 2020   flow_id).      
+0000ac30: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+0000ac40: 616c 2873 6567 6d65 6e74 735b 315d 5b31  al(segments[1][1
+0000ac50: 5d2e 6772 6169 6e5f 7479 7065 2c20 2765  ].grain_type, 'e
+0000ac60: 7665 6e74 2729 0a20 2020 2020 2020 2073  vent').        s
+0000ac70: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+0000ac80: 7365 676d 656e 7473 5b31 5d5b 315d 2e65  segments[1][1].e
+0000ac90: 7665 6e74 5f74 7970 652c 2022 7572 6e3a  vent_type, "urn:
+0000aca0: 782d 7465 7374 696e 673a 636c 6576 6572  x-testing:clever
+0000acb0: 2f74 7970 6522 290a 2020 2020 2020 2020  /type").        
+0000acc0: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+0000acd0: 2873 6567 6d65 6e74 735b 315d 5b31 5d2e  (segments[1][1].
+0000ace0: 746f 7069 632c 2022 2f69 6e75 2229 0a20  topic, "/inu"). 
+0000acf0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+0000ad00: 7274 4571 7561 6c28 6c65 6e28 7365 676d  rtEqual(len(segm
+0000ad10: 656e 7473 5b31 5d5b 315d 2e65 7665 6e74  ents[1][1].event
+0000ad20: 5f64 6174 6129 2c20 3129 0a20 2020 2020  _data), 1).     
+0000ad30: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+0000ad40: 7561 6c28 7365 676d 656e 7473 5b31 5d5b  ual(segments[1][
+0000ad50: 315d 2e65 7665 6e74 5f64 6174 615b 305d  1].event_data[0]
+0000ad60: 2e70 6174 682c 2022 2f73 756b 696d 6f6e  .path, "/sukimon
+0000ad70: 6f22 290a 2020 2020 2020 2020 7365 6c66  o").        self
+0000ad80: 2e61 7373 6572 7445 7175 616c 2873 6567  .assertEqual(seg
+0000ad90: 6d65 6e74 735b 315d 5b31 5d2e 6576 656e  ments[1][1].even
+0000ada0: 745f 6461 7461 5b30 5d2e 7072 652c 2022  t_data[0].pre, "
+0000adb0: 6461 2229 0a20 2020 2020 2020 2073 656c  da").        sel
+0000adc0: 662e 6173 7365 7274 4973 4e6f 6e65 2873  f.assertIsNone(s
+0000add0: 6567 6d65 6e74 735b 315d 5b31 5d2e 6576  egments[1][1].ev
+0000ade0: 656e 745f 6461 7461 5b30 5d2e 706f 7374  ent_data[0].post
+0000adf0: 290a 0a20 2020 2064 6566 2074 6573 745f  )..    def test_
+0000ae00: 6475 6d70 735f 656d 7074 7967 7261 696e  dumps_emptygrain
+0000ae10: 7328 7365 6c66 293a 0a20 2020 2020 2020  s(self):.       
+0000ae20: 2073 7263 5f69 6420 3d20 5555 4944 2827   src_id = UUID('
+0000ae30: 6531 3465 3964 3538 2d31 3536 372d 3131  e14e9d58-1567-11
+0000ae40: 6538 2d38 6464 332d 3833 3161 3036 3865  e8-8dd3-831a068e
+0000ae50: 6230 3334 2729 0a20 2020 2020 2020 2066  b034').        f
+0000ae60: 6c6f 775f 6964 203d 2055 5549 4428 2765  low_id = UUID('e
+0000ae70: 6531 6565 6435 382d 3135 3637 2d31 3165  e1eed58-1567-11e
+0000ae80: 382d 6139 3731 2d33 6239 3031 6132 6464  8-a971-3b901a2dd
+0000ae90: 3861 6227 290a 2020 2020 2020 2020 6772  8ab').        gr
+0000aea0: 6169 6e30 203d 2047 7261 696e 2873 7263  ain0 = Grain(src
+0000aeb0: 5f69 643d 7372 635f 6964 2c20 666c 6f77  _id=src_id, flow
+0000aec0: 5f69 643d 666c 6f77 5f69 6429 0a20 2020  _id=flow_id).   
+0000aed0: 2020 2020 2067 7261 696e 302e 7469 6d65       grain0.time
+0000aee0: 6c61 6265 6c73 203d 205b 7b0a 2020 2020  labels = [{.    
+0000aef0: 2020 2020 2020 2020 2774 6167 273a 2027          'tag': '
+0000af00: 7469 6767 6c65 272c 0a20 2020 2020 2020  tiggle',.       
+0000af10: 2020 2020 2027 7469 6d65 6c61 6265 6c27       'timelabel'
+0000af20: 3a20 7b0a 2020 2020 2020 2020 2020 2020  : {.            
+0000af30: 2020 2020 2766 7261 6d65 735f 7369 6e63      'frames_sinc
+0000af40: 655f 6d69 646e 6967 6874 273a 2037 2c0a  e_midnight': 7,.
+0000af50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000af60: 2766 7261 6d65 5f72 6174 655f 6e75 6d65  'frame_rate_nume
+0000af70: 7261 746f 7227 3a20 3330 302c 0a20 2020  rator': 300,.   
+0000af80: 2020 2020 2020 2020 2020 2020 2027 6672               'fr
+0000af90: 616d 655f 7261 7465 5f64 656e 6f6d 696e  ame_rate_denomin
+0000afa0: 6174 6f72 273a 2031 2c0a 2020 2020 2020  ator': 1,.      
+0000afb0: 2020 2020 2020 2020 2020 2764 726f 705f            'drop_
+0000afc0: 6672 616d 6527 3a20 4661 6c73 650a 2020  frame': False.  
+0000afd0: 2020 2020 2020 2020 2020 7d0a 2020 2020            }.    
+0000afe0: 2020 2020 7d5d 0a20 2020 2020 2020 2067      }].        g
+0000aff0: 7261 696e 3120 3d20 4772 6169 6e28 7372  rain1 = Grain(sr
+0000b000: 635f 6964 3d73 7263 5f69 642c 2066 6c6f  c_id=src_id, flo
+0000b010: 775f 6964 3d66 6c6f 775f 6964 290a 2020  w_id=flow_id).  
+0000b020: 2020 2020 2020 7575 6964 7320 3d20 5b55        uuids = [U
+0000b030: 5549 4428 2737 3932 3062 3339 342d 3135  UID('7920b394-15
+0000b040: 3635 2d31 3165 382d 3836 6530 2d38 6234  65-11e8-86e0-8b4
+0000b050: 3264 3436 3437 6261 3827 292c 0a20 2020  2d4647ba8'),.   
+0000b060: 2020 2020 2020 2020 2020 2020 2020 5555                UU
+0000b070: 4944 2827 3830 6166 3837 3563 2d31 3536  ID('80af875c-156
+0000b080: 352d 3131 6538 2d38 6634 342d 3837 6566  5-11e8-8f44-87ef
+0000b090: 3038 3162 3438 6364 2729 5d0a 2020 2020  081b48cd')].    
+0000b0a0: 2020 2020 6372 6561 7465 6420 3d20 6461      created = da
+0000b0b0: 7465 7469 6d65 2831 3938 332c 2033 2c20  tetime(1983, 3, 
+0000b0c0: 3239 2c20 3135 2c20 3135 290a 2020 2020  29, 15, 15).    
+0000b0d0: 2020 2020 7769 7468 206d 6f63 6b2e 7061      with mock.pa
+0000b0e0: 7463 6828 276d 6564 6961 6772 6169 6e73  tch('mediagrains
+0000b0f0: 2e67 7366 2e64 6174 6574 696d 6527 2c20  .gsf.datetime', 
+0000b100: 7369 6465 5f65 6666 6563 743d 6461 7465  side_effect=date
+0000b110: 7469 6d65 2c20 6e6f 773d 6d6f 636b 2e4d  time, now=mock.M
+0000b120: 6167 6963 4d6f 636b 2872 6574 7572 6e5f  agicMock(return_
+0000b130: 7661 6c75 653d 6372 6561 7465 6429 293a  value=created)):
+0000b140: 0a20 2020 2020 2020 2020 2020 2077 6974  .            wit
+0000b150: 6820 6d6f 636b 2e70 6174 6368 2827 6d65  h mock.patch('me
+0000b160: 6469 6167 7261 696e 732e 6773 662e 7575  diagrains.gsf.uu
+0000b170: 6964 3127 2c20 7369 6465 5f65 6666 6563  id1', side_effec
+0000b180: 743d 7575 6964 7329 3a0a 2020 2020 2020  t=uuids):.      
+0000b190: 2020 2020 2020 2020 2020 2868 6561 642c            (head,
+0000b1a0: 2073 6567 6d65 6e74 7329 203d 206c 6f61   segments) = loa
+0000b1b0: 6473 2864 756d 7073 285b 6772 6169 6e30  ds(dumps([grain0
+0000b1c0: 2c20 6772 6169 6e31 5d29 290a 0a20 2020  , grain1]))..   
+0000b1d0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+0000b1e0: 496e 2827 6964 272c 2068 6561 6429 0a20  In('id', head). 
+0000b1f0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+0000b200: 7274 496e 2868 6561 645b 2769 6427 5d2c  rtIn(head['id'],
+0000b210: 2075 7569 6473 290a 2020 2020 2020 2020   uuids).        
+0000b220: 7365 6c66 2e61 7373 6572 7449 6e28 2774  self.assertIn('t
+0000b230: 6167 7327 2c20 6865 6164 290a 2020 2020  ags', head).    
+0000b240: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+0000b250: 7175 616c 286c 656e 2868 6561 645b 2774  qual(len(head['t
+0000b260: 6167 7327 5d29 2c20 3029 0a20 2020 2020  ags']), 0).     
+0000b270: 2020 2073 656c 662e 6173 7365 7274 496e     self.assertIn
+0000b280: 2827 6372 6561 7465 6427 2c20 6865 6164  ('created', head
+0000b290: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+0000b2a0: 7373 6572 7445 7175 616c 2868 6561 645b  ssertEqual(head[
+0000b2b0: 2763 7265 6174 6564 275d 2c20 6372 6561  'created'], crea
+0000b2c0: 7465 6429 0a20 2020 2020 2020 2073 656c  ted).        sel
+0000b2d0: 662e 6173 7365 7274 496e 2827 7365 676d  f.assertIn('segm
+0000b2e0: 656e 7473 272c 2068 6561 6429 0a20 2020  ents', head).   
+0000b2f0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+0000b300: 4571 7561 6c28 6c65 6e28 6865 6164 5b27  Equal(len(head['
+0000b310: 7365 676d 656e 7473 275d 292c 2031 290a  segments']), 1).
+0000b320: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+0000b330: 6572 7449 6e28 2763 6f75 6e74 272c 2068  ertIn('count', h
+0000b340: 6561 645b 2773 6567 6d65 6e74 7327 5d5b  ead['segments'][
+0000b350: 305d 290a 2020 2020 2020 2020 7365 6c66  0]).        self
+0000b360: 2e61 7373 6572 7445 7175 616c 2868 6561  .assertEqual(hea
+0000b370: 645b 2773 6567 6d65 6e74 7327 5d5b 305d  d['segments'][0]
+0000b380: 5b27 636f 756e 7427 5d2c 2032 290a 2020  ['count'], 2).  
+0000b390: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+0000b3a0: 7449 6e28 276c 6f63 616c 5f69 6427 2c20  tIn('local_id', 
+0000b3b0: 6865 6164 5b27 7365 676d 656e 7473 275d  head['segments']
+0000b3c0: 5b30 5d29 0a20 2020 2020 2020 2073 656c  [0]).        sel
+0000b3d0: 662e 6173 7365 7274 4571 7561 6c28 6865  f.assertEqual(he
+0000b3e0: 6164 5b27 7365 676d 656e 7473 275d 5b30  ad['segments'][0
+0000b3f0: 5d5b 276c 6f63 616c 5f69 6427 5d2c 2031  ]['local_id'], 1
+0000b400: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+0000b410: 7373 6572 7449 6e28 2769 6427 2c20 6865  ssertIn('id', he
+0000b420: 6164 5b27 7365 676d 656e 7473 275d 5b30  ad['segments'][0
+0000b430: 5d29 0a20 2020 2020 2020 2073 656c 662e  ]).        self.
+0000b440: 6173 7365 7274 496e 2868 6561 645b 2773  assertIn(head['s
+0000b450: 6567 6d65 6e74 7327 5d5b 305d 5b27 6964  egments'][0]['id
+0000b460: 275d 2c20 7575 6964 7329 0a20 2020 2020  '], uuids).     
+0000b470: 2020 2073 656c 662e 6173 7365 7274 496e     self.assertIn
+0000b480: 2827 7461 6773 272c 2068 6561 645b 2773  ('tags', head['s
+0000b490: 6567 6d65 6e74 7327 5d5b 305d 290a 2020  egments'][0]).  
+0000b4a0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+0000b4b0: 7445 7175 616c 286c 656e 2868 6561 645b  tEqual(len(head[
+0000b4c0: 2773 6567 6d65 6e74 7327 5d5b 305d 5b27  'segments'][0]['
+0000b4d0: 7461 6773 275d 292c 2030 290a 0a20 2020  tags']), 0)..   
+0000b4e0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+0000b4f0: 4571 7561 6c28 6c65 6e28 7365 676d 656e  Equal(len(segmen
+0000b500: 7473 292c 2031 290a 2020 2020 2020 2020  ts), 1).        
+0000b510: 7365 6c66 2e61 7373 6572 7449 6e28 312c  self.assertIn(1,
+0000b520: 2073 6567 6d65 6e74 7329 0a20 2020 2020   segments).     
+0000b530: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+0000b540: 7561 6c28 6c65 6e28 7365 676d 656e 7473  ual(len(segments
+0000b550: 5b31 5d29 2c20 6865 6164 5b27 7365 676d  [1]), head['segm
+0000b560: 656e 7473 275d 5b30 5d5b 2763 6f75 6e74  ents'][0]['count
+0000b570: 275d 290a 0a20 2020 2020 2020 2073 656c  '])..        sel
+0000b580: 662e 6173 7365 7274 4571 7561 6c28 7365  f.assertEqual(se
+0000b590: 676d 656e 7473 5b31 5d5b 305d 2e73 6f75  gments[1][0].sou
+0000b5a0: 7263 655f 6964 2c20 7372 635f 6964 290a  rce_id, src_id).
+0000b5b0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+0000b5c0: 6572 7445 7175 616c 2873 6567 6d65 6e74  ertEqual(segment
+0000b5d0: 735b 315d 5b30 5d2e 666c 6f77 5f69 642c  s[1][0].flow_id,
+0000b5e0: 2066 6c6f 775f 6964 290a 2020 2020 2020   flow_id).      
+0000b5f0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+0000b600: 616c 2873 6567 6d65 6e74 735b 315d 5b30  al(segments[1][0
+0000b610: 5d2e 6772 6169 6e5f 7479 7065 2c20 2765  ].grain_type, 'e
+0000b620: 6d70 7479 2729 0a20 2020 2020 2020 2073  mpty').        s
+0000b630: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+0000b640: 7365 676d 656e 7473 5b31 5d5b 305d 2e74  segments[1][0].t
+0000b650: 696d 656c 6162 656c 732c 2020 5b7b 0a20  imelabels,  [{. 
+0000b660: 2020 2020 2020 2020 2020 2027 7461 6727             'tag'
+0000b670: 3a20 2774 6967 676c 6527 2c0a 2020 2020  : 'tiggle',.    
+0000b680: 2020 2020 2020 2020 2774 696d 656c 6162          'timelab
+0000b690: 656c 273a 207b 0a20 2020 2020 2020 2020  el': {.         
+0000b6a0: 2020 2020 2020 2027 6672 616d 6573 5f73         'frames_s
+0000b6b0: 696e 6365 5f6d 6964 6e69 6768 7427 3a20  ince_midnight': 
+0000b6c0: 372c 0a20 2020 2020 2020 2020 2020 2020  7,.             
+0000b6d0: 2020 2027 6672 616d 655f 7261 7465 5f6e     'frame_rate_n
+0000b6e0: 756d 6572 6174 6f72 273a 2033 3030 2c0a  umerator': 300,.
+0000b6f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b700: 2766 7261 6d65 5f72 6174 655f 6465 6e6f  'frame_rate_deno
+0000b710: 6d69 6e61 746f 7227 3a20 312c 0a20 2020  minator': 1,.   
+0000b720: 2020 2020 2020 2020 2020 2020 2027 6472               'dr
+0000b730: 6f70 5f66 7261 6d65 273a 2046 616c 7365  op_frame': False
+0000b740: 0a20 2020 2020 2020 2020 2020 207d 0a20  .            }. 
+0000b750: 2020 2020 2020 207d 5d29 0a20 2020 2020         }]).     
+0000b760: 2020 2073 656c 662e 6173 7365 7274 4973     self.assertIs
+0000b770: 4e6f 6e65 2873 6567 6d65 6e74 735b 315d  None(segments[1]
+0000b780: 5b30 5d2e 6461 7461 290a 0a20 2020 2020  [0].data)..     
+0000b790: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+0000b7a0: 7561 6c28 7365 676d 656e 7473 5b31 5d5b  ual(segments[1][
+0000b7b0: 315d 2e73 6f75 7263 655f 6964 2c20 7372  1].source_id, sr
+0000b7c0: 635f 6964 290a 2020 2020 2020 2020 7365  c_id).        se
+0000b7d0: 6c66 2e61 7373 6572 7445 7175 616c 2873  lf.assertEqual(s
+0000b7e0: 6567 6d65 6e74 735b 315d 5b31 5d2e 666c  egments[1][1].fl
+0000b7f0: 6f77 5f69 642c 2066 6c6f 775f 6964 290a  ow_id, flow_id).
+0000b800: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+0000b810: 6572 7445 7175 616c 2873 6567 6d65 6e74  ertEqual(segment
+0000b820: 735b 315d 5b31 5d2e 6772 6169 6e5f 7479  s[1][1].grain_ty
+0000b830: 7065 2c20 2765 6d70 7479 2729 0a20 2020  pe, 'empty').   
+0000b840: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+0000b850: 4973 4e6f 6e65 2873 6567 6d65 6e74 735b  IsNone(segments[
+0000b860: 315d 5b31 5d2e 6461 7461 290a 0a20 2020  1][1].data)..   
+0000b870: 2061 7379 6e63 2064 6566 2074 6573 745f   async def test_
+0000b880: 6173 796e 635f 656e 636f 6465 5f65 6d70  async_encode_emp
+0000b890: 7479 6772 6169 6e73 2873 656c 6629 3a0a  tygrains(self):.
+0000b8a0: 2020 2020 2020 2020 7372 635f 6964 203d          src_id =
+0000b8b0: 2055 5549 4428 2765 3134 6539 6435 382d   UUID('e14e9d58-
+0000b8c0: 3135 3637 2d31 3165 382d 3864 6433 2d38  1567-11e8-8dd3-8
+0000b8d0: 3331 6130 3638 6562 3033 3427 290a 2020  31a068eb034').  
+0000b8e0: 2020 2020 2020 666c 6f77 5f69 6420 3d20        flow_id = 
+0000b8f0: 5555 4944 2827 6565 3165 6564 3538 2d31  UUID('ee1eed58-1
+0000b900: 3536 372d 3131 6538 2d61 3937 312d 3362  567-11e8-a971-3b
+0000b910: 3930 3161 3264 6438 6162 2729 0a20 2020  901a2dd8ab').   
+0000b920: 2020 2020 2067 7261 696e 3020 3d20 4772       grain0 = Gr
+0000b930: 6169 6e28 7372 635f 6964 3d73 7263 5f69  ain(src_id=src_i
+0000b940: 642c 2066 6c6f 775f 6964 3d66 6c6f 775f  d, flow_id=flow_
+0000b950: 6964 290a 2020 2020 2020 2020 6772 6169  id).        grai
+0000b960: 6e30 2e74 696d 656c 6162 656c 7320 3d20  n0.timelabels = 
+0000b970: 5b7b 0a20 2020 2020 2020 2020 2020 2027  [{.            '
+0000b980: 7461 6727 3a20 2774 6967 676c 6527 2c0a  tag': 'tiggle',.
+0000b990: 2020 2020 2020 2020 2020 2020 2774 696d              'tim
+0000b9a0: 656c 6162 656c 273a 207b 0a20 2020 2020  elabel': {.     
+0000b9b0: 2020 2020 2020 2020 2020 2027 6672 616d             'fram
+0000b9c0: 6573 5f73 696e 6365 5f6d 6964 6e69 6768  es_since_midnigh
+0000b9d0: 7427 3a20 372c 0a20 2020 2020 2020 2020  t': 7,.         
+0000b9e0: 2020 2020 2020 2027 6672 616d 655f 7261         'frame_ra
+0000b9f0: 7465 5f6e 756d 6572 6174 6f72 273a 2033  te_numerator': 3
+0000ba00: 3030 2c0a 2020 2020 2020 2020 2020 2020  00,.            
+0000ba10: 2020 2020 2766 7261 6d65 5f72 6174 655f      'frame_rate_
+0000ba20: 6465 6e6f 6d69 6e61 746f 7227 3a20 312c  denominator': 1,
+0000ba30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000ba40: 2027 6472 6f70 5f66 7261 6d65 273a 2046   'drop_frame': F
+0000ba50: 616c 7365 0a20 2020 2020 2020 2020 2020  alse.           
+0000ba60: 207d 0a20 2020 2020 2020 207d 5d0a 2020   }.        }].  
+0000ba70: 2020 2020 2020 6772 6169 6e31 203d 2047        grain1 = G
+0000ba80: 7261 696e 2873 7263 5f69 643d 7372 635f  rain(src_id=src_
+0000ba90: 6964 2c20 666c 6f77 5f69 643d 666c 6f77  id, flow_id=flow
+0000baa0: 5f69 6429 0a20 2020 2020 2020 2075 7569  _id).        uui
+0000bab0: 6473 203d 205b 5555 4944 2827 3739 3230  ds = [UUID('7920
+0000bac0: 6233 3934 2d31 3536 352d 3131 6538 2d38  b394-1565-11e8-8
+0000bad0: 3665 302d 3862 3432 6434 3634 3762 6138  6e0-8b42d4647ba8
+0000bae0: 2729 2c0a 2020 2020 2020 2020 2020 2020  '),.            
+0000baf0: 2020 2020 2055 5549 4428 2738 3061 6638       UUID('80af8
+0000bb00: 3735 632d 3135 3635 2d31 3165 382d 3866  75c-1565-11e8-8f
+0000bb10: 3434 2d38 3765 6630 3831 6234 3863 6427  44-87ef081b48cd'
+0000bb20: 295d 0a20 2020 2020 2020 2063 7265 6174  )].        creat
+0000bb30: 6564 203d 2064 6174 6574 696d 6528 3139  ed = datetime(19
+0000bb40: 3833 2c20 332c 2032 392c 2031 352c 2031  83, 3, 29, 15, 1
+0000bb50: 3529 0a20 2020 2020 2020 2077 6974 6820  5).        with 
+0000bb60: 6d6f 636b 2e70 6174 6368 2827 6d65 6469  mock.patch('medi
+0000bb70: 6167 7261 696e 732e 6773 662e 6461 7465  agrains.gsf.date
+0000bb80: 7469 6d65 272c 2073 6964 655f 6566 6665  time', side_effe
+0000bb90: 6374 3d64 6174 6574 696d 652c 206e 6f77  ct=datetime, now
+0000bba0: 3d6d 6f63 6b2e 4d61 6769 634d 6f63 6b28  =mock.MagicMock(
+0000bbb0: 7265 7475 726e 5f76 616c 7565 3d63 7265  return_value=cre
+0000bbc0: 6174 6564 2929 3a0a 2020 2020 2020 2020  ated)):.        
+0000bbd0: 2020 2020 7769 7468 206d 6f63 6b2e 7061      with mock.pa
+0000bbe0: 7463 6828 276d 6564 6961 6772 6169 6e73  tch('mediagrains
+0000bbf0: 2e67 7366 2e75 7569 6431 272c 2073 6964  .gsf.uuid1', sid
+0000bc00: 655f 6566 6665 6374 3d75 7569 6473 293a  e_effect=uuids):
+0000bc10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000bc20: 2066 203d 2042 7974 6573 494f 2829 0a20   f = BytesIO(). 
+0000bc30: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+0000bc40: 7379 6e63 2077 6974 6820 4753 4645 6e63  sync with GSFEnc
+0000bc50: 6f64 6572 2866 2920 6173 2065 6e63 3a0a  oder(f) as enc:.
+0000bc60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bc70: 2020 2020 6177 6169 7420 656e 632e 6164      await enc.ad
+0000bc80: 645f 6772 6169 6e73 285b 6772 6169 6e30  d_grains([grain0
+0000bc90: 2c20 6772 6169 6e31 5d29 0a20 2020 2020  , grain1]).     
+0000bca0: 2020 2020 2020 2020 2020 2028 6865 6164             (head
+0000bcb0: 2c20 7365 676d 656e 7473 2920 3d20 6c6f  , segments) = lo
+0000bcc0: 6164 7328 662e 6765 7476 616c 7565 2829  ads(f.getvalue()
+0000bcd0: 290a 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+0000bce0: 6173 7365 7274 496e 2827 6964 272c 2068  assertIn('id', h
+0000bcf0: 6561 6429 0a20 2020 2020 2020 2073 656c  ead).        sel
+0000bd00: 662e 6173 7365 7274 496e 2868 6561 645b  f.assertIn(head[
+0000bd10: 2769 6427 5d2c 2075 7569 6473 290a 2020  'id'], uuids).  
+0000bd20: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+0000bd30: 7449 6e28 2774 6167 7327 2c20 6865 6164  tIn('tags', head
+0000bd40: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+0000bd50: 7373 6572 7445 7175 616c 286c 656e 2868  ssertEqual(len(h
+0000bd60: 6561 645b 2774 6167 7327 5d29 2c20 3029  ead['tags']), 0)
+0000bd70: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+0000bd80: 7365 7274 496e 2827 6372 6561 7465 6427  sertIn('created'
+0000bd90: 2c20 6865 6164 290a 2020 2020 2020 2020  , head).        
+0000bda0: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+0000bdb0: 2868 6561 645b 2763 7265 6174 6564 275d  (head['created']
+0000bdc0: 2c20 6372 6561 7465 6429 0a20 2020 2020  , created).     
+0000bdd0: 2020 2073 656c 662e 6173 7365 7274 496e     self.assertIn
+0000bde0: 2827 7365 676d 656e 7473 272c 2068 6561  ('segments', hea
+0000bdf0: 6429 0a20 2020 2020 2020 2073 656c 662e  d).        self.
+0000be00: 6173 7365 7274 4571 7561 6c28 6c65 6e28  assertEqual(len(
+0000be10: 6865 6164 5b27 7365 676d 656e 7473 275d  head['segments']
+0000be20: 292c 2031 290a 2020 2020 2020 2020 7365  ), 1).        se
+0000be30: 6c66 2e61 7373 6572 7449 6e28 2763 6f75  lf.assertIn('cou
+0000be40: 6e74 272c 2068 6561 645b 2773 6567 6d65  nt', head['segme
+0000be50: 6e74 7327 5d5b 305d 290a 2020 2020 2020  nts'][0]).      
+0000be60: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+0000be70: 616c 2868 6561 645b 2773 6567 6d65 6e74  al(head['segment
+0000be80: 7327 5d5b 305d 5b27 636f 756e 7427 5d2c  s'][0]['count'],
+0000be90: 2032 290a 2020 2020 2020 2020 7365 6c66   2).        self
+0000bea0: 2e61 7373 6572 7449 6e28 276c 6f63 616c  .assertIn('local
+0000beb0: 5f69 6427 2c20 6865 6164 5b27 7365 676d  _id', head['segm
+0000bec0: 656e 7473 275d 5b30 5d29 0a20 2020 2020  ents'][0]).     
+0000bed0: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+0000bee0: 7561 6c28 6865 6164 5b27 7365 676d 656e  ual(head['segmen
+0000bef0: 7473 275d 5b30 5d5b 276c 6f63 616c 5f69  ts'][0]['local_i
+0000bf00: 6427 5d2c 2031 290a 2020 2020 2020 2020  d'], 1).        
+0000bf10: 7365 6c66 2e61 7373 6572 7449 6e28 2769  self.assertIn('i
+0000bf20: 6427 2c20 6865 6164 5b27 7365 676d 656e  d', head['segmen
+0000bf30: 7473 275d 5b30 5d29 0a20 2020 2020 2020  ts'][0]).       
+0000bf40: 2073 656c 662e 6173 7365 7274 496e 2868   self.assertIn(h
+0000bf50: 6561 645b 2773 6567 6d65 6e74 7327 5d5b  ead['segments'][
+0000bf60: 305d 5b27 6964 275d 2c20 7575 6964 7329  0]['id'], uuids)
+0000bf70: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+0000bf80: 7365 7274 496e 2827 7461 6773 272c 2068  sertIn('tags', h
+0000bf90: 6561 645b 2773 6567 6d65 6e74 7327 5d5b  ead['segments'][
+0000bfa0: 305d 290a 2020 2020 2020 2020 7365 6c66  0]).        self
+0000bfb0: 2e61 7373 6572 7445 7175 616c 286c 656e  .assertEqual(len
+0000bfc0: 2868 6561 645b 2773 6567 6d65 6e74 7327  (head['segments'
+0000bfd0: 5d5b 305d 5b27 7461 6773 275d 292c 2030  ][0]['tags']), 0
+0000bfe0: 290a 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+0000bff0: 6173 7365 7274 4571 7561 6c28 6c65 6e28  assertEqual(len(
+0000c000: 7365 676d 656e 7473 292c 2031 290a 2020  segments), 1).  
+0000c010: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+0000c020: 7449 6e28 312c 2073 6567 6d65 6e74 7329  tIn(1, segments)
+0000c030: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+0000c040: 7365 7274 4571 7561 6c28 6c65 6e28 7365  sertEqual(len(se
+0000c050: 676d 656e 7473 5b31 5d29 2c20 6865 6164  gments[1]), head
+0000c060: 5b27 7365 676d 656e 7473 275d 5b30 5d5b  ['segments'][0][
+0000c070: 2763 6f75 6e74 275d 290a 0a20 2020 2020  'count'])..     
+0000c080: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+0000c090: 7561 6c28 7365 676d 656e 7473 5b31 5d5b  ual(segments[1][
+0000c0a0: 305d 2e73 6f75 7263 655f 6964 2c20 7372  0].source_id, sr
+0000c0b0: 635f 6964 290a 2020 2020 2020 2020 7365  c_id).        se
+0000c0c0: 6c66 2e61 7373 6572 7445 7175 616c 2873  lf.assertEqual(s
+0000c0d0: 6567 6d65 6e74 735b 315d 5b30 5d2e 666c  egments[1][0].fl
+0000c0e0: 6f77 5f69 642c 2066 6c6f 775f 6964 290a  ow_id, flow_id).
+0000c0f0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+0000c100: 6572 7445 7175 616c 2873 6567 6d65 6e74  ertEqual(segment
+0000c110: 735b 315d 5b30 5d2e 6772 6169 6e5f 7479  s[1][0].grain_ty
+0000c120: 7065 2c20 2765 6d70 7479 2729 0a20 2020  pe, 'empty').   
+0000c130: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+0000c140: 4571 7561 6c28 7365 676d 656e 7473 5b31  Equal(segments[1
+0000c150: 5d5b 305d 2e74 696d 656c 6162 656c 732c  ][0].timelabels,
+0000c160: 2020 5b7b 0a20 2020 2020 2020 2020 2020    [{.           
+0000c170: 2027 7461 6727 3a20 2774 6967 676c 6527   'tag': 'tiggle'
+0000c180: 2c0a 2020 2020 2020 2020 2020 2020 2774  ,.            't
+0000c190: 696d 656c 6162 656c 273a 207b 0a20 2020  imelabel': {.   
+0000c1a0: 2020 2020 2020 2020 2020 2020 2027 6672               'fr
+0000c1b0: 616d 6573 5f73 696e 6365 5f6d 6964 6e69  ames_since_midni
+0000c1c0: 6768 7427 3a20 372c 0a20 2020 2020 2020  ght': 7,.       
+0000c1d0: 2020 2020 2020 2020 2027 6672 616d 655f           'frame_
+0000c1e0: 7261 7465 5f6e 756d 6572 6174 6f72 273a  rate_numerator':
+0000c1f0: 2033 3030 2c0a 2020 2020 2020 2020 2020   300,.          
+0000c200: 2020 2020 2020 2766 7261 6d65 5f72 6174        'frame_rat
+0000c210: 655f 6465 6e6f 6d69 6e61 746f 7227 3a20  e_denominator': 
+0000c220: 312c 0a20 2020 2020 2020 2020 2020 2020  1,.             
+0000c230: 2020 2027 6472 6f70 5f66 7261 6d65 273a     'drop_frame':
+0000c240: 2046 616c 7365 0a20 2020 2020 2020 2020   False.         
+0000c250: 2020 207d 0a20 2020 2020 2020 207d 5d29     }.        }])
+0000c260: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+0000c270: 7365 7274 4973 4e6f 6e65 2873 6567 6d65  sertIsNone(segme
+0000c280: 6e74 735b 315d 5b30 5d2e 6461 7461 290a  nts[1][0].data).
+0000c290: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+0000c2a0: 7365 7274 4571 7561 6c28 7365 676d 656e  sertEqual(segmen
+0000c2b0: 7473 5b31 5d5b 315d 2e73 6f75 7263 655f  ts[1][1].source_
+0000c2c0: 6964 2c20 7372 635f 6964 290a 2020 2020  id, src_id).    
+0000c2d0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+0000c2e0: 7175 616c 2873 6567 6d65 6e74 735b 315d  qual(segments[1]
+0000c2f0: 5b31 5d2e 666c 6f77 5f69 642c 2066 6c6f  [1].flow_id, flo
+0000c300: 775f 6964 290a 2020 2020 2020 2020 7365  w_id).        se
+0000c310: 6c66 2e61 7373 6572 7445 7175 616c 2873  lf.assertEqual(s
+0000c320: 6567 6d65 6e74 735b 315d 5b31 5d2e 6772  egments[1][1].gr
+0000c330: 6169 6e5f 7479 7065 2c20 2765 6d70 7479  ain_type, 'empty
+0000c340: 2729 0a20 2020 2020 2020 2073 656c 662e  ').        self.
+0000c350: 6173 7365 7274 4973 4e6f 6e65 2873 6567  assertIsNone(seg
+0000c360: 6d65 6e74 735b 315d 5b31 5d2e 6461 7461  ments[1][1].data
+0000c370: 290a 0a20 2020 2064 6566 2074 6573 745f  )..    def test_
+0000c380: 6475 6d70 735f 696e 7661 6c69 6467 7261  dumps_invalidgra
+0000c390: 696e 7328 7365 6c66 293a 0a20 2020 2020  ins(self):.     
+0000c3a0: 2020 2073 7263 5f69 6420 3d20 5555 4944     src_id = UUID
+0000c3b0: 2827 6531 3465 3964 3538 2d31 3536 372d  ('e14e9d58-1567-
+0000c3c0: 3131 6538 2d38 6464 332d 3833 3161 3036  11e8-8dd3-831a06
+0000c3d0: 3865 6230 3334 2729 0a20 2020 2020 2020  8eb034').       
+0000c3e0: 2066 6c6f 775f 6964 203d 2055 5549 4428   flow_id = UUID(
+0000c3f0: 2765 6531 6565 6435 382d 3135 3637 2d31  'ee1eed58-1567-1
+0000c400: 3165 382d 6139 3731 2d33 6239 3031 6132  1e8-a971-3b901a2
+0000c410: 6464 3861 6227 290a 2020 2020 2020 2020  dd8ab').        
+0000c420: 6772 6169 6e20 3d20 4772 6169 6e28 7372  grain = Grain(sr
+0000c430: 635f 6964 3d73 7263 5f69 642c 2066 6c6f  c_id=src_id, flo
+0000c440: 775f 6964 3d66 6c6f 775f 6964 290a 2020  w_id=flow_id).  
+0000c450: 2020 2020 2020 6772 6169 6e2e 6772 6169        grain.grai
+0000c460: 6e5f 7479 7065 203d 2022 696e 7661 6c69  n_type = "invali
+0000c470: 6422 0a20 2020 2020 2020 2075 7569 6473  d".        uuids
+0000c480: 203d 205b 5555 4944 2827 3739 3230 6233   = [UUID('7920b3
+0000c490: 3934 2d31 3536 352d 3131 6538 2d38 3665  94-1565-11e8-86e
+0000c4a0: 302d 3862 3432 6434 3634 3762 6138 2729  0-8b42d4647ba8')
+0000c4b0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000c4c0: 2020 2055 5549 4428 2738 3061 6638 3735     UUID('80af875
+0000c4d0: 632d 3135 3635 2d31 3165 382d 3866 3434  c-1565-11e8-8f44
+0000c4e0: 2d38 3765 6630 3831 6234 3863 6427 295d  -87ef081b48cd')]
+0000c4f0: 0a20 2020 2020 2020 2063 7265 6174 6564  .        created
+0000c500: 203d 2064 6174 6574 696d 6528 3139 3833   = datetime(1983
+0000c510: 2c20 332c 2032 392c 2031 352c 2031 3529  , 3, 29, 15, 15)
+0000c520: 0a20 2020 2020 2020 2077 6974 6820 7365  .        with se
+0000c530: 6c66 2e61 7373 6572 7452 6169 7365 7328  lf.assertRaises(
+0000c540: 4753 4645 6e63 6f64 6545 7272 6f72 293a  GSFEncodeError):
+0000c550: 0a20 2020 2020 2020 2020 2020 2077 6974  .            wit
+0000c560: 6820 6d6f 636b 2e70 6174 6368 2827 6d65  h mock.patch('me
+0000c570: 6469 6167 7261 696e 732e 6773 662e 6461  diagrains.gsf.da
+0000c580: 7465 7469 6d65 272c 2073 6964 655f 6566  tetime', side_ef
+0000c590: 6665 6374 3d64 6174 6574 696d 652c 206e  fect=datetime, n
+0000c5a0: 6f77 3d6d 6f63 6b2e 4d61 6769 634d 6f63  ow=mock.MagicMoc
+0000c5b0: 6b28 7265 7475 726e 5f76 616c 7565 3d63  k(return_value=c
+0000c5c0: 7265 6174 6564 2929 3a0a 2020 2020 2020  reated)):.      
+0000c5d0: 2020 2020 2020 2020 2020 7769 7468 206d            with m
+0000c5e0: 6f63 6b2e 7061 7463 6828 276d 6564 6961  ock.patch('media
+0000c5f0: 6772 6169 6e73 2e67 7366 2e75 7569 6431  grains.gsf.uuid1
+0000c600: 272c 2073 6964 655f 6566 6665 6374 3d75  ', side_effect=u
+0000c610: 7569 6473 293a 0a20 2020 2020 2020 2020  uids):.         
+0000c620: 2020 2020 2020 2020 2020 2028 6865 6164             (head
+0000c630: 2c20 7365 676d 656e 7473 2920 3d20 6c6f  , segments) = lo
+0000c640: 6164 7328 6475 6d70 7328 5b67 7261 696e  ads(dumps([grain
+0000c650: 5d29 290a 0a20 2020 2061 7379 6e63 2064  ]))..    async d
+0000c660: 6566 2074 6573 745f 6173 796e 635f 656e  ef test_async_en
+0000c670: 636f 6465 5f69 6e76 616c 6964 6772 6169  code_invalidgrai
+0000c680: 6e73 2873 656c 6629 3a0a 2020 2020 2020  ns(self):.      
+0000c690: 2020 7372 635f 6964 203d 2055 5549 4428    src_id = UUID(
+0000c6a0: 2765 3134 6539 6435 382d 3135 3637 2d31  'e14e9d58-1567-1
+0000c6b0: 3165 382d 3864 6433 2d38 3331 6130 3638  1e8-8dd3-831a068
+0000c6c0: 6562 3033 3427 290a 2020 2020 2020 2020  eb034').        
+0000c6d0: 666c 6f77 5f69 6420 3d20 5555 4944 2827  flow_id = UUID('
+0000c6e0: 6565 3165 6564 3538 2d31 3536 372d 3131  ee1eed58-1567-11
+0000c6f0: 6538 2d61 3937 312d 3362 3930 3161 3264  e8-a971-3b901a2d
+0000c700: 6438 6162 2729 0a20 2020 2020 2020 2067  d8ab').        g
+0000c710: 7261 696e 203d 2047 7261 696e 2873 7263  rain = Grain(src
+0000c720: 5f69 643d 7372 635f 6964 2c20 666c 6f77  _id=src_id, flow
+0000c730: 5f69 643d 666c 6f77 5f69 6429 0a20 2020  _id=flow_id).   
+0000c740: 2020 2020 2067 7261 696e 2e67 7261 696e       grain.grain
+0000c750: 5f74 7970 6520 3d20 2269 6e76 616c 6964  _type = "invalid
+0000c760: 220a 2020 2020 2020 2020 7575 6964 7320  ".        uuids 
+0000c770: 3d20 5b55 5549 4428 2737 3932 3062 3339  = [UUID('7920b39
+0000c780: 342d 3135 3635 2d31 3165 382d 3836 6530  4-1565-11e8-86e0
+0000c790: 2d38 6234 3264 3436 3437 6261 3827 292c  -8b42d4647ba8'),
+0000c7a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000c7b0: 2020 5555 4944 2827 3830 6166 3837 3563    UUID('80af875c
+0000c7c0: 2d31 3536 352d 3131 6538 2d38 6634 342d  -1565-11e8-8f44-
+0000c7d0: 3837 6566 3038 3162 3438 6364 2729 5d0a  87ef081b48cd')].
+0000c7e0: 2020 2020 2020 2020 6372 6561 7465 6420          created 
+0000c7f0: 3d20 6461 7465 7469 6d65 2831 3938 332c  = datetime(1983,
+0000c800: 2033 2c20 3239 2c20 3135 2c20 3135 290a   3, 29, 15, 15).
+0000c810: 2020 2020 2020 2020 7769 7468 2073 656c          with sel
+0000c820: 662e 6173 7365 7274 5261 6973 6573 2847  f.assertRaises(G
+0000c830: 5346 456e 636f 6465 4572 726f 7229 3a0a  SFEncodeError):.
+0000c840: 2020 2020 2020 2020 2020 2020 7769 7468              with
+0000c850: 206d 6f63 6b2e 7061 7463 6828 276d 6564   mock.patch('med
+0000c860: 6961 6772 6169 6e73 2e67 7366 2e64 6174  iagrains.gsf.dat
+0000c870: 6574 696d 6527 2c20 7369 6465 5f65 6666  etime', side_eff
+0000c880: 6563 743d 6461 7465 7469 6d65 2c20 6e6f  ect=datetime, no
+0000c890: 773d 6d6f 636b 2e4d 6167 6963 4d6f 636b  w=mock.MagicMock
+0000c8a0: 2872 6574 7572 6e5f 7661 6c75 653d 6372  (return_value=cr
+0000c8b0: 6561 7465 6429 293a 0a20 2020 2020 2020  eated)):.       
+0000c8c0: 2020 2020 2020 2020 2077 6974 6820 6d6f           with mo
+0000c8d0: 636b 2e70 6174 6368 2827 6d65 6469 6167  ck.patch('mediag
+0000c8e0: 7261 696e 732e 6773 662e 7575 6964 3127  rains.gsf.uuid1'
+0000c8f0: 2c20 7369 6465 5f65 6666 6563 743d 7575  , side_effect=uu
+0000c900: 6964 7329 3a0a 2020 2020 2020 2020 2020  ids):.          
+0000c910: 2020 2020 2020 2020 2020 6173 796e 6320            async 
+0000c920: 7769 7468 2047 5346 456e 636f 6465 7228  with GSFEncoder(
+0000c930: 4279 7465 7349 4f28 2929 2061 7320 656e  BytesIO()) as en
+0000c940: 633a 0a20 2020 2020 2020 2020 2020 2020  c:.             
+0000c950: 2020 2020 2020 2020 2020 2061 7761 6974             await
+0000c960: 2065 6e63 2e61 6464 5f67 7261 696e 7328   enc.add_grains(
+0000c970: 5b67 7261 696e 5d29 0a0a 2020 2020 4073  [grain])..    @s
+0000c980: 7570 7072 6573 735f 6465 7072 6563 6174  uppress_deprecat
+0000c990: 696f 6e5f 7761 726e 696e 6773 0a20 2020  ion_warnings.   
+0000c9a0: 2064 6566 2074 6573 745f 6475 6d70 5f70   def test_dump_p
+0000c9b0: 726f 6772 6573 7369 7665 6c79 5f5f 6465  rogressively__de
+0000c9c0: 7072 6563 6174 6564 2873 656c 6629 3a0a  precated(self):.
+0000c9d0: 2020 2020 2020 2020 7372 635f 6964 203d          src_id =
+0000c9e0: 2055 5549 4428 2765 3134 6539 6435 382d   UUID('e14e9d58-
+0000c9f0: 3135 3637 2d31 3165 382d 3864 6433 2d38  1567-11e8-8dd3-8
+0000ca00: 3331 6130 3638 6562 3033 3427 290a 2020  31a068eb034').  
+0000ca10: 2020 2020 2020 666c 6f77 5f69 6420 3d20        flow_id = 
+0000ca20: 5555 4944 2827 6565 3165 6564 3538 2d31  UUID('ee1eed58-1
+0000ca30: 3536 372d 3131 6538 2d61 3937 312d 3362  567-11e8-a971-3b
+0000ca40: 3930 3161 3264 6438 6162 2729 0a20 2020  901a2dd8ab').   
+0000ca50: 2020 2020 2067 7261 696e 3020 3d20 5669       grain0 = Vi
+0000ca60: 6465 6f47 7261 696e 2873 7263 5f69 643d  deoGrain(src_id=
+0000ca70: 7372 635f 6964 2c20 666c 6f77 5f69 643d  src_id, flow_id=
+0000ca80: 666c 6f77 5f69 642c 2063 6f67 5f66 7261  flow_id, cog_fra
+0000ca90: 6d65 5f66 6f72 6d61 743d 436f 6746 7261  me_format=CogFra
+0000caa0: 6d65 466f 726d 6174 2e53 3136 5f34 3232  meFormat.S16_422
+0000cab0: 5f31 3042 4954 2c20 7769 6474 683d 3139  _10BIT, width=19
+0000cac0: 3230 2c0a 2020 2020 2020 2020 2020 2020  20,.            
+0000cad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cae0: 6865 6967 6874 3d31 3038 3029 0a20 2020  height=1080).   
+0000caf0: 2020 2020 2067 7261 696e 3120 3d20 5669       grain1 = Vi
+0000cb00: 6465 6f47 7261 696e 2873 7263 5f69 643d  deoGrain(src_id=
+0000cb10: 7372 635f 6964 2c20 666c 6f77 5f69 643d  src_id, flow_id=
+0000cb20: 666c 6f77 5f69 642c 2063 6f67 5f66 7261  flow_id, cog_fra
+0000cb30: 6d65 5f66 6f72 6d61 743d 436f 6746 7261  me_format=CogFra
+0000cb40: 6d65 466f 726d 6174 2e53 3136 5f34 3232  meFormat.S16_422
+0000cb50: 5f31 3042 4954 2c20 7769 6474 683d 3139  _10BIT, width=19
+0000cb60: 3230 2c0a 2020 2020 2020 2020 2020 2020  20,.            
+0000cb70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cb80: 6865 6967 6874 3d31 3038 3029 0a0a 2020  height=1080)..  
+0000cb90: 2020 2020 2020 7575 6964 7320 3d20 5b55        uuids = [U
+0000cba0: 5549 4428 2737 3932 3062 3339 342d 3135  UID('7920b394-15
+0000cbb0: 3635 2d31 3165 382d 3836 6530 2d38 6234  65-11e8-86e0-8b4
+0000cbc0: 3264 3436 3437 6261 3827 292c 0a20 2020  2d4647ba8'),.   
+0000cbd0: 2020 2020 2020 2020 2020 2020 2020 5555                UU
+0000cbe0: 4944 2827 3830 6166 3837 3563 2d31 3536  ID('80af875c-156
+0000cbf0: 352d 3131 6538 2d38 6634 342d 3837 6566  5-11e8-8f44-87ef
+0000cc00: 3038 3162 3438 6364 2729 5d0a 2020 2020  081b48cd')].    
+0000cc10: 2020 2020 6372 6561 7465 6420 3d20 6461      created = da
+0000cc20: 7465 7469 6d65 2831 3938 332c 2033 2c20  tetime(1983, 3, 
+0000cc30: 3239 2c20 3135 2c20 3135 290a 0a20 2020  29, 15, 15)..   
+0000cc40: 2020 2020 2066 696c 6520 3d20 4279 7465       file = Byte
+0000cc50: 7349 4f28 290a 2020 2020 2020 2020 7769  sIO().        wi
+0000cc60: 7468 206d 6f63 6b2e 7061 7463 6828 276d  th mock.patch('m
+0000cc70: 6564 6961 6772 6169 6e73 2e67 7366 2e64  ediagrains.gsf.d
+0000cc80: 6174 6574 696d 6527 2c20 7369 6465 5f65  atetime', side_e
+0000cc90: 6666 6563 743d 6461 7465 7469 6d65 2c20  ffect=datetime, 
+0000cca0: 6e6f 773d 6d6f 636b 2e4d 6167 6963 4d6f  now=mock.MagicMo
+0000ccb0: 636b 2872 6574 7572 6e5f 7661 6c75 653d  ck(return_value=
+0000ccc0: 6372 6561 7465 6429 293a 0a20 2020 2020  created)):.     
+0000ccd0: 2020 2020 2020 2077 6974 6820 6d6f 636b         with mock
+0000cce0: 2e70 6174 6368 2827 6d65 6469 6167 7261  .patch('mediagra
+0000ccf0: 696e 732e 6773 662e 7575 6964 3127 2c20  ins.gsf.uuid1', 
+0000cd00: 7369 6465 5f65 6666 6563 743d 7575 6964  side_effect=uuid
+0000cd10: 7329 3a0a 2020 2020 2020 2020 2020 2020  s):.            
+0000cd20: 2020 2020 656e 6320 3d20 4753 4645 6e63      enc = GSFEnc
+0000cd30: 6f64 6572 2866 696c 6529 0a20 2020 2020  oder(file).     
+0000cd40: 2020 2020 2020 2020 2020 2065 6e63 2e61             enc.a
+0000cd50: 6464 5f73 6567 6d65 6e74 2829 0a20 2020  dd_segment().   
+0000cd60: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0000cd70: 662e 6173 7365 7274 4571 7561 6c28 6c65  f.assertEqual(le
+0000cd80: 6e28 6669 6c65 2e67 6574 7661 6c75 6528  n(file.getvalue(
+0000cd90: 2929 2c20 3029 0a20 2020 2020 2020 2020  )), 0).         
+0000cda0: 2020 2020 2020 2065 6e63 2e73 7461 7274         enc.start
+0000cdb0: 5f64 756d 7028 290a 2020 2020 2020 2020  _dump().        
+0000cdc0: 2020 2020 2020 2020 6475 6d70 3020 3d20          dump0 = 
+0000cdd0: 6669 6c65 2e67 6574 7661 6c75 6528 290a  file.getvalue().
+0000cde0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cdf0: 2868 6561 6430 2c20 7365 676d 656e 7473  (head0, segments
+0000ce00: 3029 203d 206c 6f61 6473 2864 756d 7030  0) = loads(dump0
+0000ce10: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000ce20: 2020 656e 632e 6164 645f 6772 6169 6e28    enc.add_grain(
+0000ce30: 6772 6169 6e30 290a 2020 2020 2020 2020  grain0).        
+0000ce40: 2020 2020 2020 2020 6475 6d70 3120 3d20          dump1 = 
+0000ce50: 6669 6c65 2e67 6574 7661 6c75 6528 290a  file.getvalue().
+0000ce60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ce70: 2868 6561 6431 2c20 7365 676d 656e 7473  (head1, segments
+0000ce80: 3129 203d 206c 6f61 6473 2864 756d 7031  1) = loads(dump1
+0000ce90: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000cea0: 2020 656e 632e 6164 645f 6772 6169 6e28    enc.add_grain(
+0000ceb0: 6772 6169 6e31 2c20 7365 676d 656e 745f  grain1, segment_
+0000cec0: 6c6f 6361 6c5f 6964 3d31 290a 2020 2020  local_id=1).    
+0000ced0: 2020 2020 2020 2020 2020 2020 6475 6d70              dump
+0000cee0: 3220 3d20 6669 6c65 2e67 6574 7661 6c75  2 = file.getvalu
+0000cef0: 6528 290a 2020 2020 2020 2020 2020 2020  e().            
+0000cf00: 2020 2020 2868 6561 6432 2c20 7365 676d      (head2, segm
+0000cf10: 656e 7473 3229 203d 206c 6f61 6473 2864  ents2) = loads(d
+0000cf20: 756d 7032 290a 2020 2020 2020 2020 2020  ump2).          
+0000cf30: 2020 2020 2020 656e 632e 656e 645f 6475        enc.end_du
+0000cf40: 6d70 2829 0a20 2020 2020 2020 2020 2020  mp().           
+0000cf50: 2020 2020 2064 756d 7033 203d 2066 696c       dump3 = fil
+0000cf60: 652e 6765 7476 616c 7565 2829 0a20 2020  e.getvalue().   
+0000cf70: 2020 2020 2020 2020 2020 2020 2028 6865               (he
+0000cf80: 6164 332c 2073 6567 6d65 6e74 7333 2920  ad3, segments3) 
+0000cf90: 3d20 6c6f 6164 7328 6475 6d70 3329 0a0a  = loads(dump3)..
+0000cfa0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+0000cfb0: 6572 7445 7175 616c 2868 6561 6430 5b27  ertEqual(head0['
+0000cfc0: 7365 676d 656e 7473 275d 5b30 5d5b 2763  segments'][0]['c
+0000cfd0: 6f75 6e74 275d 2c20 2d31 290a 2020 2020  ount'], -1).    
+0000cfe0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+0000cff0: 7175 616c 2868 6561 6431 5b27 7365 676d  qual(head1['segm
+0000d000: 656e 7473 275d 5b30 5d5b 2763 6f75 6e74  ents'][0]['count
+0000d010: 275d 2c20 2d31 290a 2020 2020 2020 2020  '], -1).        
+0000d020: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+0000d030: 2868 6561 6432 5b27 7365 676d 656e 7473  (head2['segments
+0000d040: 275d 5b30 5d5b 2763 6f75 6e74 275d 2c20  '][0]['count'], 
+0000d050: 2d31 290a 2020 2020 2020 2020 7365 6c66  -1).        self
+0000d060: 2e61 7373 6572 7445 7175 616c 2868 6561  .assertEqual(hea
+0000d070: 6433 5b27 7365 676d 656e 7473 275d 5b30  d3['segments'][0
+0000d080: 5d5b 2763 6f75 6e74 275d 2c20 3229 0a0a  ]['count'], 2)..
+0000d090: 2020 2020 2020 2020 6966 2031 2069 6e20          if 1 in 
+0000d0a0: 7365 676d 656e 7473 303a 0a20 2020 2020  segments0:.     
+0000d0b0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+0000d0c0: 7274 4571 7561 6c28 6c65 6e28 7365 676d  rtEqual(len(segm
+0000d0d0: 656e 7473 305b 315d 292c 2030 290a 2020  ents0[1]), 0).  
+0000d0e0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+0000d0f0: 7445 7175 616c 286c 656e 2873 6567 6d65  tEqual(len(segme
+0000d100: 6e74 7331 5b31 5d29 2c20 3129 0a20 2020  nts1[1]), 1).   
+0000d110: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+0000d120: 4571 7561 6c28 6c65 6e28 7365 676d 656e  Equal(len(segmen
+0000d130: 7473 325b 315d 292c 2032 290a 2020 2020  ts2[1]), 2).    
+0000d140: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+0000d150: 7175 616c 286c 656e 2873 6567 6d65 6e74  qual(len(segment
+0000d160: 7333 5b31 5d29 2c20 3229 0a0a 2020 2020  s3[1]), 2)..    
+0000d170: 4073 7570 7072 6573 735f 6465 7072 6563  @suppress_deprec
+0000d180: 6174 696f 6e5f 7761 726e 696e 6773 0a20  ation_warnings. 
+0000d190: 2020 2064 6566 2074 6573 745f 6475 6d70     def test_dump
+0000d1a0: 5f70 726f 6772 6573 7369 7665 6c79 5f77  _progressively_w
+0000d1b0: 6974 685f 7365 676d 656e 7473 5f5f 6465  ith_segments__de
+0000d1c0: 7072 6563 6174 6564 2873 656c 6629 3a0a  precated(self):.
+0000d1d0: 2020 2020 2020 2020 7372 635f 6964 203d          src_id =
+0000d1e0: 2055 5549 4428 2765 3134 6539 6435 382d   UUID('e14e9d58-
+0000d1f0: 3135 3637 2d31 3165 382d 3864 6433 2d38  1567-11e8-8dd3-8
+0000d200: 3331 6130 3638 6562 3033 3427 290a 2020  31a068eb034').  
+0000d210: 2020 2020 2020 666c 6f77 5f69 6420 3d20        flow_id = 
+0000d220: 5555 4944 2827 6565 3165 6564 3538 2d31  UUID('ee1eed58-1
+0000d230: 3536 372d 3131 6538 2d61 3937 312d 3362  567-11e8-a971-3b
+0000d240: 3930 3161 3264 6438 6162 2729 0a20 2020  901a2dd8ab').   
+0000d250: 2020 2020 2067 7261 696e 3020 3d20 5669       grain0 = Vi
+0000d260: 6465 6f47 7261 696e 2873 7263 5f69 643d  deoGrain(src_id=
+0000d270: 7372 635f 6964 2c20 666c 6f77 5f69 643d  src_id, flow_id=
+0000d280: 666c 6f77 5f69 642c 2063 6f67 5f66 7261  flow_id, cog_fra
+0000d290: 6d65 5f66 6f72 6d61 743d 436f 6746 7261  me_format=CogFra
+0000d2a0: 6d65 466f 726d 6174 2e53 3136 5f34 3232  meFormat.S16_422
+0000d2b0: 5f31 3042 4954 2c20 7769 6474 683d 3139  _10BIT, width=19
+0000d2c0: 3230 2c0a 2020 2020 2020 2020 2020 2020  20,.            
+0000d2d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d2e0: 6865 6967 6874 3d31 3038 3029 0a20 2020  height=1080).   
+0000d2f0: 2020 2020 2067 7261 696e 3120 3d20 5669       grain1 = Vi
+0000d300: 6465 6f47 7261 696e 2873 7263 5f69 643d  deoGrain(src_id=
+0000d310: 7372 635f 6964 2c20 666c 6f77 5f69 643d  src_id, flow_id=
+0000d320: 666c 6f77 5f69 642c 2063 6f67 5f66 7261  flow_id, cog_fra
+0000d330: 6d65 5f66 6f72 6d61 743d 436f 6746 7261  me_format=CogFra
+0000d340: 6d65 466f 726d 6174 2e53 3136 5f34 3232  meFormat.S16_422
+0000d350: 5f31 3042 4954 2c20 7769 6474 683d 3139  _10BIT, width=19
+0000d360: 3230 2c0a 2020 2020 2020 2020 2020 2020  20,.            
+0000d370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d380: 6865 6967 6874 3d31 3038 3029 0a0a 2020  height=1080)..  
+0000d390: 2020 2020 2020 7575 6964 7320 3d20 5b55        uuids = [U
+0000d3a0: 5549 4428 2737 3932 3062 3339 342d 3135  UID('7920b394-15
+0000d3b0: 3635 2d31 3165 382d 3836 6530 2d38 6234  65-11e8-86e0-8b4
+0000d3c0: 3264 3436 3437 6261 3827 292c 0a20 2020  2d4647ba8'),.   
+0000d3d0: 2020 2020 2020 2020 2020 2020 2020 5555                UU
+0000d3e0: 4944 2827 3830 6166 3837 3563 2d31 3536  ID('80af875c-156
+0000d3f0: 352d 3131 6538 2d38 6634 342d 3837 6566  5-11e8-8f44-87ef
+0000d400: 3038 3162 3438 6364 2729 5d0a 2020 2020  081b48cd')].    
+0000d410: 2020 2020 6372 6561 7465 6420 3d20 6461      created = da
+0000d420: 7465 7469 6d65 2831 3938 332c 2033 2c20  tetime(1983, 3, 
+0000d430: 3239 2c20 3135 2c20 3135 290a 0a20 2020  29, 15, 15)..   
+0000d440: 2020 2020 2066 696c 6520 3d20 4279 7465       file = Byte
+0000d450: 7349 4f28 290a 2020 2020 2020 2020 7769  sIO().        wi
+0000d460: 7468 206d 6f63 6b2e 7061 7463 6828 276d  th mock.patch('m
+0000d470: 6564 6961 6772 6169 6e73 2e67 7366 2e64  ediagrains.gsf.d
+0000d480: 6174 6574 696d 6527 2c20 7369 6465 5f65  atetime', side_e
+0000d490: 6666 6563 743d 6461 7465 7469 6d65 2c20  ffect=datetime, 
+0000d4a0: 6e6f 773d 6d6f 636b 2e4d 6167 6963 4d6f  now=mock.MagicMo
+0000d4b0: 636b 2872 6574 7572 6e5f 7661 6c75 653d  ck(return_value=
+0000d4c0: 6372 6561 7465 6429 293a 0a20 2020 2020  created)):.     
+0000d4d0: 2020 2020 2020 2077 6974 6820 6d6f 636b         with mock
+0000d4e0: 2e70 6174 6368 2827 6d65 6469 6167 7261  .patch('mediagra
+0000d4f0: 696e 732e 6773 662e 7575 6964 3127 2c20  ins.gsf.uuid1', 
+0000d500: 7369 6465 5f65 6666 6563 743d 7575 6964  side_effect=uuid
+0000d510: 7329 3a0a 2020 2020 2020 2020 2020 2020  s):.            
+0000d520: 2020 2020 656e 6320 3d20 4753 4645 6e63      enc = GSFEnc
+0000d530: 6f64 6572 2866 696c 6529 0a20 2020 2020  oder(file).     
+0000d540: 2020 2020 2020 2020 2020 2073 6567 203d             seg =
+0000d550: 2065 6e63 2e61 6464 5f73 6567 6d65 6e74   enc.add_segment
+0000d560: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
+0000d570: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+0000d580: 7561 6c28 6c65 6e28 6669 6c65 2e67 6574  ual(len(file.get
+0000d590: 7661 6c75 6528 2929 2c20 3029 0a20 2020  value()), 0).   
+0000d5a0: 2020 2020 2020 2020 2020 2020 2065 6e63               enc
+0000d5b0: 2e73 7461 7274 5f64 756d 7028 290a 2020  .start_dump().  
+0000d5c0: 2020 2020 2020 2020 2020 2020 2020 6475                du
+0000d5d0: 6d70 3020 3d20 6669 6c65 2e67 6574 7661  mp0 = file.getva
+0000d5e0: 6c75 6528 290a 2020 2020 2020 2020 2020  lue().          
+0000d5f0: 2020 2020 2020 2868 6561 6430 2c20 7365        (head0, se
+0000d600: 676d 656e 7473 3029 203d 206c 6f61 6473  gments0) = loads
+0000d610: 2864 756d 7030 290a 2020 2020 2020 2020  (dump0).        
+0000d620: 2020 2020 2020 2020 7365 672e 6164 645f          seg.add_
+0000d630: 6772 6169 6e28 6772 6169 6e30 290a 2020  grain(grain0).  
+0000d640: 2020 2020 2020 2020 2020 2020 2020 6475                du
+0000d650: 6d70 3120 3d20 6669 6c65 2e67 6574 7661  mp1 = file.getva
+0000d660: 6c75 6528 290a 2020 2020 2020 2020 2020  lue().          
+0000d670: 2020 2020 2020 2868 6561 6431 2c20 7365        (head1, se
+0000d680: 676d 656e 7473 3129 203d 206c 6f61 6473  gments1) = loads
+0000d690: 2864 756d 7031 290a 2020 2020 2020 2020  (dump1).        
+0000d6a0: 2020 2020 2020 2020 7365 672e 6164 645f          seg.add_
+0000d6b0: 6772 6169 6e28 6772 6169 6e31 2c20 7365  grain(grain1, se
+0000d6c0: 676d 656e 745f 6c6f 6361 6c5f 6964 3d31  gment_local_id=1
+0000d6d0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000d6e0: 2020 6475 6d70 3220 3d20 6669 6c65 2e67    dump2 = file.g
+0000d6f0: 6574 7661 6c75 6528 290a 2020 2020 2020  etvalue().      
+0000d700: 2020 2020 2020 2020 2020 2868 6561 6432            (head2
+0000d710: 2c20 7365 676d 656e 7473 3229 203d 206c  , segments2) = l
+0000d720: 6f61 6473 2864 756d 7032 290a 2020 2020  oads(dump2).    
+0000d730: 2020 2020 2020 2020 2020 2020 656e 632e              enc.
+0000d740: 656e 645f 6475 6d70 2829 0a20 2020 2020  end_dump().     
+0000d750: 2020 2020 2020 2020 2020 2064 756d 7033             dump3
+0000d760: 203d 2066 696c 652e 6765 7476 616c 7565   = file.getvalue
+0000d770: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
+0000d780: 2020 2028 6865 6164 332c 2073 6567 6d65     (head3, segme
+0000d790: 6e74 7333 2920 3d20 6c6f 6164 7328 6475  nts3) = loads(du
+0000d7a0: 6d70 3329 0a0a 2020 2020 2020 2020 7365  mp3)..        se
+0000d7b0: 6c66 2e61 7373 6572 7445 7175 616c 2868  lf.assertEqual(h
+0000d7c0: 6561 6430 5b27 7365 676d 656e 7473 275d  ead0['segments']
+0000d7d0: 5b30 5d5b 2763 6f75 6e74 275d 2c20 2d31  [0]['count'], -1
+0000d7e0: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+0000d7f0: 7373 6572 7445 7175 616c 2868 6561 6431  ssertEqual(head1
+0000d800: 5b27 7365 676d 656e 7473 275d 5b30 5d5b  ['segments'][0][
+0000d810: 2763 6f75 6e74 275d 2c20 2d31 290a 2020  'count'], -1).  
+0000d820: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+0000d830: 7445 7175 616c 2868 6561 6432 5b27 7365  tEqual(head2['se
+0000d840: 676d 656e 7473 275d 5b30 5d5b 2763 6f75  gments'][0]['cou
+0000d850: 6e74 275d 2c20 2d31 290a 2020 2020 2020  nt'], -1).      
+0000d860: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+0000d870: 616c 2868 6561 6433 5b27 7365 676d 656e  al(head3['segmen
+0000d880: 7473 275d 5b30 5d5b 2763 6f75 6e74 275d  ts'][0]['count']
+0000d890: 2c20 3229 0a0a 2020 2020 2020 2020 6966  , 2)..        if
+0000d8a0: 2031 2069 6e20 7365 676d 656e 7473 303a   1 in segments0:
+0000d8b0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0000d8c0: 662e 6173 7365 7274 4571 7561 6c28 6c65  f.assertEqual(le
+0000d8d0: 6e28 7365 676d 656e 7473 305b 315d 292c  n(segments0[1]),
+0000d8e0: 2030 290a 2020 2020 2020 2020 7365 6c66   0).        self
+0000d8f0: 2e61 7373 6572 7445 7175 616c 286c 656e  .assertEqual(len
+0000d900: 2873 6567 6d65 6e74 7331 5b31 5d29 2c20  (segments1[1]), 
+0000d910: 3129 0a20 2020 2020 2020 2073 656c 662e  1).        self.
+0000d920: 6173 7365 7274 4571 7561 6c28 6c65 6e28  assertEqual(len(
+0000d930: 7365 676d 656e 7473 325b 315d 292c 2032  segments2[1]), 2
+0000d940: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+0000d950: 7373 6572 7445 7175 616c 286c 656e 2873  ssertEqual(len(s
+0000d960: 6567 6d65 6e74 7333 5b31 5d29 2c20 3229  egments3[1]), 2)
+0000d970: 0a0a 2020 2020 6465 6620 7465 7374 5f64  ..    def test_d
+0000d980: 756d 705f 7072 6f67 7265 7373 6976 656c  ump_progressivel
+0000d990: 7928 7365 6c66 293a 0a20 2020 2020 2020  y(self):.       
+0000d9a0: 2073 7263 5f69 6420 3d20 5555 4944 2827   src_id = UUID('
+0000d9b0: 6531 3465 3964 3538 2d31 3536 372d 3131  e14e9d58-1567-11
+0000d9c0: 6538 2d38 6464 332d 3833 3161 3036 3865  e8-8dd3-831a068e
+0000d9d0: 6230 3334 2729 0a20 2020 2020 2020 2066  b034').        f
+0000d9e0: 6c6f 775f 6964 203d 2055 5549 4428 2765  low_id = UUID('e
+0000d9f0: 6531 6565 6435 382d 3135 3637 2d31 3165  e1eed58-1567-11e
+0000da00: 382d 6139 3731 2d33 6239 3031 6132 6464  8-a971-3b901a2dd
+0000da10: 3861 6227 290a 2020 2020 2020 2020 6772  8ab').        gr
+0000da20: 6169 6e30 203d 2056 6964 656f 4772 6169  ain0 = VideoGrai
+0000da30: 6e28 7372 635f 6964 3d73 7263 5f69 642c  n(src_id=src_id,
+0000da40: 2066 6c6f 775f 6964 3d66 6c6f 775f 6964   flow_id=flow_id
+0000da50: 2c20 636f 675f 6672 616d 655f 666f 726d  , cog_frame_form
+0000da60: 6174 3d43 6f67 4672 616d 6546 6f72 6d61  at=CogFrameForma
+0000da70: 742e 5331 365f 3432 325f 3130 4249 542c  t.S16_422_10BIT,
+0000da80: 2077 6964 7468 3d31 3932 302c 0a20 2020   width=1920,.   
+0000da90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000daa0: 2020 2020 2020 2020 2068 6569 6768 743d           height=
+0000dab0: 3130 3830 290a 2020 2020 2020 2020 6772  1080).        gr
+0000dac0: 6169 6e31 203d 2056 6964 656f 4772 6169  ain1 = VideoGrai
+0000dad0: 6e28 7372 635f 6964 3d73 7263 5f69 642c  n(src_id=src_id,
+0000dae0: 2066 6c6f 775f 6964 3d66 6c6f 775f 6964   flow_id=flow_id
+0000daf0: 2c20 636f 675f 6672 616d 655f 666f 726d  , cog_frame_form
+0000db00: 6174 3d43 6f67 4672 616d 6546 6f72 6d61  at=CogFrameForma
+0000db10: 742e 5331 365f 3432 325f 3130 4249 542c  t.S16_422_10BIT,
+0000db20: 2077 6964 7468 3d31 3932 302c 0a20 2020   width=1920,.   
+0000db30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000db40: 2020 2020 2020 2020 2068 6569 6768 743d           height=
+0000db50: 3130 3830 290a 0a20 2020 2020 2020 2075  1080)..        u
+0000db60: 7569 6473 203d 205b 5555 4944 2827 3739  uids = [UUID('79
+0000db70: 3230 6233 3934 2d31 3536 352d 3131 6538  20b394-1565-11e8
+0000db80: 2d38 3665 302d 3862 3432 6434 3634 3762  -86e0-8b42d4647b
+0000db90: 6138 2729 2c0a 2020 2020 2020 2020 2020  a8'),.          
+0000dba0: 2020 2020 2020 2055 5549 4428 2738 3061         UUID('80a
+0000dbb0: 6638 3735 632d 3135 3635 2d31 3165 382d  f875c-1565-11e8-
+0000dbc0: 3866 3434 2d38 3765 6630 3831 6234 3863  8f44-87ef081b48c
+0000dbd0: 6427 295d 0a20 2020 2020 2020 2063 7265  d')].        cre
+0000dbe0: 6174 6564 203d 2064 6174 6574 696d 6528  ated = datetime(
+0000dbf0: 3139 3833 2c20 332c 2032 392c 2031 352c  1983, 3, 29, 15,
+0000dc00: 2031 3529 0a0a 2020 2020 2020 2020 6669   15)..        fi
+0000dc10: 6c65 203d 2042 7974 6573 494f 2829 0a20  le = BytesIO(). 
+0000dc20: 2020 2020 2020 2077 6974 6820 6d6f 636b         with mock
+0000dc30: 2e70 6174 6368 2827 6d65 6469 6167 7261  .patch('mediagra
+0000dc40: 696e 732e 6773 662e 6461 7465 7469 6d65  ins.gsf.datetime
+0000dc50: 272c 2073 6964 655f 6566 6665 6374 3d64  ', side_effect=d
+0000dc60: 6174 6574 696d 652c 206e 6f77 3d6d 6f63  atetime, now=moc
+0000dc70: 6b2e 4d61 6769 634d 6f63 6b28 7265 7475  k.MagicMock(retu
+0000dc80: 726e 5f76 616c 7565 3d63 7265 6174 6564  rn_value=created
+0000dc90: 2929 3a0a 2020 2020 2020 2020 2020 2020  )):.            
+0000dca0: 7769 7468 206d 6f63 6b2e 7061 7463 6828  with mock.patch(
+0000dcb0: 276d 6564 6961 6772 6169 6e73 2e67 7366  'mediagrains.gsf
+0000dcc0: 2e75 7569 6431 272c 2073 6964 655f 6566  .uuid1', side_ef
+0000dcd0: 6665 6374 3d75 7569 6473 293a 0a20 2020  fect=uuids):.   
+0000dce0: 2020 2020 2020 2020 2020 2020 2065 6e63               enc
+0000dcf0: 203d 2047 5346 456e 636f 6465 7228 6669   = GSFEncoder(fi
+0000dd00: 6c65 2c20 7374 7265 616d 696e 673d 5472  le, streaming=Tr
+0000dd10: 7565 290a 2020 2020 2020 2020 2020 2020  ue).            
+0000dd20: 2020 2020 656e 632e 6164 645f 7365 676d      enc.add_segm
+0000dd30: 656e 7428 290a 2020 2020 2020 2020 2020  ent().          
+0000dd40: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+0000dd50: 7445 7175 616c 286c 656e 2866 696c 652e  tEqual(len(file.
+0000dd60: 6765 7476 616c 7565 2829 292c 2030 290a  getvalue()), 0).
+0000dd70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dd80: 7769 7468 2065 6e63 3a0a 2020 2020 2020  with enc:.      
+0000dd90: 2020 2020 2020 2020 2020 2020 2020 6475                du
+0000dda0: 6d70 3020 3d20 6669 6c65 2e67 6574 7661  mp0 = file.getva
+0000ddb0: 6c75 6528 290a 2020 2020 2020 2020 2020  lue().          
+0000ddc0: 2020 2020 2020 2020 2020 2868 6561 6430            (head0
+0000ddd0: 2c20 7365 676d 656e 7473 3029 203d 206c  , segments0) = l
+0000dde0: 6f61 6473 2864 756d 7030 290a 2020 2020  oads(dump0).    
+0000ddf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000de00: 656e 632e 6164 645f 6772 6169 6e28 6772  enc.add_grain(gr
+0000de10: 6169 6e30 290a 2020 2020 2020 2020 2020  ain0).          
+0000de20: 2020 2020 2020 2020 2020 6475 6d70 3120            dump1 
+0000de30: 3d20 6669 6c65 2e67 6574 7661 6c75 6528  = file.getvalue(
+0000de40: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000de50: 2020 2020 2020 2868 6561 6431 2c20 7365        (head1, se
+0000de60: 676d 656e 7473 3129 203d 206c 6f61 6473  gments1) = loads
+0000de70: 2864 756d 7031 290a 2020 2020 2020 2020  (dump1).        
+0000de80: 2020 2020 2020 2020 2020 2020 656e 632e              enc.
+0000de90: 6164 645f 6772 6169 6e28 6772 6169 6e31  add_grain(grain1
+0000dea0: 2c20 7365 676d 656e 745f 6c6f 6361 6c5f  , segment_local_
+0000deb0: 6964 3d31 290a 2020 2020 2020 2020 2020  id=1).          
+0000dec0: 2020 2020 2020 2020 2020 6475 6d70 3220            dump2 
+0000ded0: 3d20 6669 6c65 2e67 6574 7661 6c75 6528  = file.getvalue(
+0000dee0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000def0: 2020 2020 2020 2868 6561 6432 2c20 7365        (head2, se
+0000df00: 676d 656e 7473 3229 203d 206c 6f61 6473  gments2) = loads
+0000df10: 2864 756d 7032 290a 2020 2020 2020 2020  (dump2).        
+0000df20: 2020 2020 2020 2020 6475 6d70 3320 3d20          dump3 = 
+0000df30: 6669 6c65 2e67 6574 7661 6c75 6528 290a  file.getvalue().
+0000df40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000df50: 2868 6561 6433 2c20 7365 676d 656e 7473  (head3, segments
+0000df60: 3329 203d 206c 6f61 6473 2864 756d 7033  3) = loads(dump3
+0000df70: 290a 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+0000df80: 6173 7365 7274 4571 7561 6c28 6865 6164  assertEqual(head
+0000df90: 305b 2773 6567 6d65 6e74 7327 5d5b 305d  0['segments'][0]
+0000dfa0: 5b27 636f 756e 7427 5d2c 202d 3129 0a20  ['count'], -1). 
+0000dfb0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+0000dfc0: 7274 4571 7561 6c28 6865 6164 315b 2773  rtEqual(head1['s
+0000dfd0: 6567 6d65 6e74 7327 5d5b 305d 5b27 636f  egments'][0]['co
+0000dfe0: 756e 7427 5d2c 202d 3129 0a20 2020 2020  unt'], -1).     
+0000dff0: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+0000e000: 7561 6c28 6865 6164 325b 2773 6567 6d65  ual(head2['segme
+0000e010: 6e74 7327 5d5b 305d 5b27 636f 756e 7427  nts'][0]['count'
+0000e020: 5d2c 202d 3129 0a20 2020 2020 2020 2073  ], -1).        s
+0000e030: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+0000e040: 6865 6164 335b 2773 6567 6d65 6e74 7327  head3['segments'
+0000e050: 5d5b 305d 5b27 636f 756e 7427 5d2c 2032  ][0]['count'], 2
+0000e060: 290a 0a20 2020 2020 2020 2069 6620 3120  )..        if 1 
+0000e070: 696e 2073 6567 6d65 6e74 7330 3a0a 2020  in segments0:.  
+0000e080: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+0000e090: 7373 6572 7445 7175 616c 286c 656e 2873  ssertEqual(len(s
+0000e0a0: 6567 6d65 6e74 7330 5b31 5d29 2c20 3029  egments0[1]), 0)
+0000e0b0: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+0000e0c0: 7365 7274 4571 7561 6c28 6c65 6e28 7365  sertEqual(len(se
+0000e0d0: 676d 656e 7473 315b 315d 292c 2031 290a  gments1[1]), 1).
+0000e0e0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+0000e0f0: 6572 7445 7175 616c 286c 656e 2873 6567  ertEqual(len(seg
+0000e100: 6d65 6e74 7332 5b31 5d29 2c20 3229 0a20  ments2[1]), 2). 
+0000e110: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+0000e120: 7274 4571 7561 6c28 6c65 6e28 7365 676d  rtEqual(len(segm
+0000e130: 656e 7473 335b 315d 292c 2032 290a 0a20  ents3[1]), 2).. 
+0000e140: 2020 2061 7379 6e63 2064 6566 2074 6573     async def tes
+0000e150: 745f 6173 796e 635f 656e 636f 6465 5f70  t_async_encode_p
+0000e160: 726f 6772 6573 7369 7665 6c79 2873 656c  rogressively(sel
+0000e170: 6629 3a0a 2020 2020 2020 2020 7372 635f  f):.        src_
+0000e180: 6964 203d 2055 5549 4428 2765 3134 6539  id = UUID('e14e9
+0000e190: 6435 382d 3135 3637 2d31 3165 382d 3864  d58-1567-11e8-8d
+0000e1a0: 6433 2d38 3331 6130 3638 6562 3033 3427  d3-831a068eb034'
+0000e1b0: 290a 2020 2020 2020 2020 666c 6f77 5f69  ).        flow_i
+0000e1c0: 6420 3d20 5555 4944 2827 6565 3165 6564  d = UUID('ee1eed
+0000e1d0: 3538 2d31 3536 372d 3131 6538 2d61 3937  58-1567-11e8-a97
+0000e1e0: 312d 3362 3930 3161 3264 6438 6162 2729  1-3b901a2dd8ab')
+0000e1f0: 0a20 2020 2020 2020 2067 7261 696e 3020  .        grain0 
+0000e200: 3d20 5669 6465 6f47 7261 696e 2873 7263  = VideoGrain(src
+0000e210: 5f69 643d 7372 635f 6964 2c20 666c 6f77  _id=src_id, flow
+0000e220: 5f69 643d 666c 6f77 5f69 642c 2063 6f67  _id=flow_id, cog
+0000e230: 5f66 7261 6d65 5f66 6f72 6d61 743d 436f  _frame_format=Co
+0000e240: 6746 7261 6d65 466f 726d 6174 2e53 3136  gFrameFormat.S16
+0000e250: 5f34 3232 5f31 3042 4954 2c20 7769 6474  _422_10BIT, widt
+0000e260: 683d 3139 3230 2c0a 2020 2020 2020 2020  h=1920,.        
+0000e270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e280: 2020 2020 6865 6967 6874 3d31 3038 3029      height=1080)
+0000e290: 0a20 2020 2020 2020 2067 7261 696e 3120  .        grain1 
+0000e2a0: 3d20 5669 6465 6f47 7261 696e 2873 7263  = VideoGrain(src
+0000e2b0: 5f69 643d 7372 635f 6964 2c20 666c 6f77  _id=src_id, flow
+0000e2c0: 5f69 643d 666c 6f77 5f69 642c 2063 6f67  _id=flow_id, cog
+0000e2d0: 5f66 7261 6d65 5f66 6f72 6d61 743d 436f  _frame_format=Co
+0000e2e0: 6746 7261 6d65 466f 726d 6174 2e53 3136  gFrameFormat.S16
+0000e2f0: 5f34 3232 5f31 3042 4954 2c20 7769 6474  _422_10BIT, widt
+0000e300: 683d 3139 3230 2c0a 2020 2020 2020 2020  h=1920,.        
+0000e310: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e320: 2020 2020 6865 6967 6874 3d31 3038 3029      height=1080)
+0000e330: 0a0a 2020 2020 2020 2020 7575 6964 7320  ..        uuids 
+0000e340: 3d20 5b55 5549 4428 2737 3932 3062 3339  = [UUID('7920b39
+0000e350: 342d 3135 3635 2d31 3165 382d 3836 6530  4-1565-11e8-86e0
+0000e360: 2d38 6234 3264 3436 3437 6261 3827 292c  -8b42d4647ba8'),
+0000e370: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000e380: 2020 5555 4944 2827 3830 6166 3837 3563    UUID('80af875c
+0000e390: 2d31 3536 352d 3131 6538 2d38 6634 342d  -1565-11e8-8f44-
+0000e3a0: 3837 6566 3038 3162 3438 6364 2729 5d0a  87ef081b48cd')].
+0000e3b0: 2020 2020 2020 2020 6372 6561 7465 6420          created 
+0000e3c0: 3d20 6461 7465 7469 6d65 2831 3938 332c  = datetime(1983,
+0000e3d0: 2033 2c20 3239 2c20 3135 2c20 3135 290a   3, 29, 15, 15).
+0000e3e0: 0a20 2020 2020 2020 2066 696c 6520 3d20  .        file = 
+0000e3f0: 4279 7465 7349 4f28 290a 2020 2020 2020  BytesIO().      
+0000e400: 2020 7769 7468 206d 6f63 6b2e 7061 7463    with mock.patc
+0000e410: 6828 276d 6564 6961 6772 6169 6e73 2e67  h('mediagrains.g
+0000e420: 7366 2e64 6174 6574 696d 6527 2c20 7369  sf.datetime', si
+0000e430: 6465 5f65 6666 6563 743d 6461 7465 7469  de_effect=dateti
+0000e440: 6d65 2c20 6e6f 773d 6d6f 636b 2e4d 6167  me, now=mock.Mag
+0000e450: 6963 4d6f 636b 2872 6574 7572 6e5f 7661  icMock(return_va
+0000e460: 6c75 653d 6372 6561 7465 6429 293a 0a20  lue=created)):. 
+0000e470: 2020 2020 2020 2020 2020 2077 6974 6820             with 
+0000e480: 6d6f 636b 2e70 6174 6368 2827 6d65 6469  mock.patch('medi
+0000e490: 6167 7261 696e 732e 6773 662e 7575 6964  agrains.gsf.uuid
+0000e4a0: 3127 2c20 7369 6465 5f65 6666 6563 743d  1', side_effect=
+0000e4b0: 7575 6964 7329 3a0a 2020 2020 2020 2020  uuids):.        
+0000e4c0: 2020 2020 2020 2020 656e 6320 3d20 4753          enc = GS
+0000e4d0: 4645 6e63 6f64 6572 2866 696c 652c 2073  FEncoder(file, s
+0000e4e0: 7472 6561 6d69 6e67 3d54 7275 652c 2073  treaming=True, s
+0000e4f0: 6567 6d65 6e74 733d 5b7b 7d5d 290a 2020  egments=[{}]).  
+0000e500: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0000e510: 6c66 2e61 7373 6572 7445 7175 616c 286c  lf.assertEqual(l
+0000e520: 656e 2866 696c 652e 6765 7476 616c 7565  en(file.getvalue
+0000e530: 2829 292c 2030 290a 2020 2020 2020 2020  ()), 0).        
+0000e540: 2020 2020 2020 2020 6173 796e 6320 7769          async wi
+0000e550: 7468 2065 6e63 2061 7320 656e 633a 0a20  th enc as enc:. 
+0000e560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e570: 2020 2064 756d 7030 203d 2066 696c 652e     dump0 = file.
+0000e580: 6765 7476 616c 7565 2829 0a20 2020 2020  getvalue().     
+0000e590: 2020 2020 2020 2020 2020 2020 2020 2028                 (
+0000e5a0: 6865 6164 302c 2073 6567 6d65 6e74 7330  head0, segments0
+0000e5b0: 2920 3d20 6c6f 6164 7328 6475 6d70 3029  ) = loads(dump0)
+0000e5c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000e5d0: 2020 2020 2061 7761 6974 2065 6e63 2e61       await enc.a
+0000e5e0: 6464 5f67 7261 696e 2867 7261 696e 3029  dd_grain(grain0)
+0000e5f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000e600: 2020 2020 2064 756d 7031 203d 2066 696c       dump1 = fil
+0000e610: 652e 6765 7476 616c 7565 2829 0a20 2020  e.getvalue().   
+0000e620: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e630: 2028 6865 6164 312c 2073 6567 6d65 6e74   (head1, segment
+0000e640: 7331 2920 3d20 6c6f 6164 7328 6475 6d70  s1) = loads(dump
+0000e650: 3129 0a20 2020 2020 2020 2020 2020 2020  1).             
+0000e660: 2020 2020 2020 2061 7761 6974 2065 6e63         await enc
+0000e670: 2e61 6464 5f67 7261 696e 2867 7261 696e  .add_grain(grain
+0000e680: 312c 2073 6567 6d65 6e74 5f6c 6f63 616c  1, segment_local
+0000e690: 5f69 643d 3129 0a20 2020 2020 2020 2020  _id=1).         
+0000e6a0: 2020 2020 2020 2020 2020 2064 756d 7032             dump2
+0000e6b0: 203d 2066 696c 652e 6765 7476 616c 7565   = file.getvalue
+0000e6c0: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
+0000e6d0: 2020 2020 2020 2028 6865 6164 322c 2073         (head2, s
+0000e6e0: 6567 6d65 6e74 7332 2920 3d20 6c6f 6164  egments2) = load
+0000e6f0: 7328 6475 6d70 3229 0a20 2020 2020 2020  s(dump2).       
+0000e700: 2020 2020 2020 2020 2064 756d 7033 203d           dump3 =
+0000e710: 2066 696c 652e 6765 7476 616c 7565 2829   file.getvalue()
+0000e720: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000e730: 2028 6865 6164 332c 2073 6567 6d65 6e74   (head3, segment
+0000e740: 7333 2920 3d20 6c6f 6164 7328 6475 6d70  s3) = loads(dump
+0000e750: 3329 0a0a 2020 2020 2020 2020 7365 6c66  3)..        self
+0000e760: 2e61 7373 6572 7445 7175 616c 2868 6561  .assertEqual(hea
+0000e770: 6430 5b27 7365 676d 656e 7473 275d 5b30  d0['segments'][0
+0000e780: 5d5b 2763 6f75 6e74 275d 2c20 2d31 290a  ]['count'], -1).
+0000e790: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+0000e7a0: 6572 7445 7175 616c 2868 6561 6431 5b27  ertEqual(head1['
+0000e7b0: 7365 676d 656e 7473 275d 5b30 5d5b 2763  segments'][0]['c
+0000e7c0: 6f75 6e74 275d 2c20 2d31 290a 2020 2020  ount'], -1).    
+0000e7d0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+0000e7e0: 7175 616c 2868 6561 6432 5b27 7365 676d  qual(head2['segm
+0000e7f0: 656e 7473 275d 5b30 5d5b 2763 6f75 6e74  ents'][0]['count
+0000e800: 275d 2c20 2d31 290a 2020 2020 2020 2020  '], -1).        
+0000e810: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+0000e820: 2868 6561 6433 5b27 7365 676d 656e 7473  (head3['segments
+0000e830: 275d 5b30 5d5b 2763 6f75 6e74 275d 2c20  '][0]['count'], 
+0000e840: 3229 0a0a 2020 2020 2020 2020 6966 2031  2)..        if 1
+0000e850: 2069 6e20 7365 676d 656e 7473 303a 0a20   in segments0:. 
+0000e860: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0000e870: 6173 7365 7274 4571 7561 6c28 6c65 6e28  assertEqual(len(
+0000e880: 7365 676d 656e 7473 305b 315d 292c 2030  segments0[1]), 0
+0000e890: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+0000e8a0: 7373 6572 7445 7175 616c 286c 656e 2873  ssertEqual(len(s
+0000e8b0: 6567 6d65 6e74 7331 5b31 5d29 2c20 3129  egments1[1]), 1)
+0000e8c0: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+0000e8d0: 7365 7274 4571 7561 6c28 6c65 6e28 7365  sertEqual(len(se
+0000e8e0: 676d 656e 7473 325b 315d 292c 2032 290a  gments2[1]), 2).
+0000e8f0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+0000e900: 6572 7445 7175 616c 286c 656e 2873 6567  ertEqual(len(seg
+0000e910: 6d65 6e74 7333 5b31 5d29 2c20 3229 0a0a  ments3[1]), 2)..
+0000e920: 2020 2020 4073 7570 7072 6573 735f 6465      @suppress_de
+0000e930: 7072 6563 6174 696f 6e5f 7761 726e 696e  precation_warnin
+0000e940: 6773 0a20 2020 2064 6566 2074 6573 745f  gs.    def test_
+0000e950: 656e 645f 6475 6d70 5f77 6974 686f 7574  end_dump_without
+0000e960: 5f73 7461 7274 5f64 6f65 735f 6e6f 7468  _start_does_noth
+0000e970: 696e 6728 7365 6c66 293a 0a20 2020 2020  ing(self):.     
+0000e980: 2020 2075 7569 6473 203d 205b 5555 4944     uuids = [UUID
+0000e990: 2827 3739 3230 6233 3934 2d31 3536 352d  ('7920b394-1565-
+0000e9a0: 3131 6538 2d38 3665 302d 3862 3432 6434  11e8-86e0-8b42d4
+0000e9b0: 3634 3762 6138 2729 2c0a 2020 2020 2020  647ba8'),.      
+0000e9c0: 2020 2020 2020 2020 2020 2055 5549 4428             UUID(
+0000e9d0: 2738 3061 6638 3735 632d 3135 3635 2d31  '80af875c-1565-1
+0000e9e0: 3165 382d 3866 3434 2d38 3765 6630 3831  1e8-8f44-87ef081
+0000e9f0: 6234 3863 6427 295d 0a20 2020 2020 2020  b48cd')].       
+0000ea00: 2063 7265 6174 6564 203d 2064 6174 6574   created = datet
+0000ea10: 696d 6528 3139 3833 2c20 332c 2032 392c  ime(1983, 3, 29,
+0000ea20: 2031 352c 2031 3529 0a0a 2020 2020 2020   15, 15)..      
+0000ea30: 2020 6669 6c65 203d 2042 7974 6573 494f    file = BytesIO
+0000ea40: 2829 0a20 2020 2020 2020 2077 6974 6820  ().        with 
+0000ea50: 6d6f 636b 2e70 6174 6368 2827 6d65 6469  mock.patch('medi
+0000ea60: 6167 7261 696e 732e 6773 662e 6461 7465  agrains.gsf.date
+0000ea70: 7469 6d65 272c 2073 6964 655f 6566 6665  time', side_effe
+0000ea80: 6374 3d64 6174 6574 696d 652c 206e 6f77  ct=datetime, now
+0000ea90: 3d6d 6f63 6b2e 4d61 6769 634d 6f63 6b28  =mock.MagicMock(
+0000eaa0: 7265 7475 726e 5f76 616c 7565 3d63 7265  return_value=cre
+0000eab0: 6174 6564 2929 3a0a 2020 2020 2020 2020  ated)):.        
+0000eac0: 2020 2020 7769 7468 206d 6f63 6b2e 7061      with mock.pa
+0000ead0: 7463 6828 276d 6564 6961 6772 6169 6e73  tch('mediagrains
+0000eae0: 2e67 7366 2e75 7569 6431 272c 2073 6964  .gsf.uuid1', sid
+0000eaf0: 655f 6566 6665 6374 3d75 7569 6473 293a  e_effect=uuids):
+0000eb00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000eb10: 2065 6e63 203d 2047 5346 456e 636f 6465   enc = GSFEncode
+0000eb20: 7228 6669 6c65 290a 2020 2020 2020 2020  r(file).        
+0000eb30: 2020 2020 2020 2020 656e 632e 6164 645f          enc.add_
+0000eb40: 7365 676d 656e 7428 290a 2020 2020 2020  segment().      
+0000eb50: 2020 2020 2020 2020 2020 6475 6d70 3020            dump0 
+0000eb60: 3d20 6669 6c65 2e67 6574 7661 6c75 6528  = file.getvalue(
+0000eb70: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000eb80: 2020 656e 632e 656e 645f 6475 6d70 2829    enc.end_dump()
+0000eb90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000eba0: 2064 756d 7031 203d 2066 696c 652e 6765   dump1 = file.ge
+0000ebb0: 7476 616c 7565 2829 0a0a 2020 2020 2020  tvalue()..      
+0000ebc0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+0000ebd0: 616c 2864 756d 7030 2c20 6475 6d70 3129  al(dump0, dump1)
+0000ebe0: 0a0a 2020 2020 6465 6620 7465 7374 5f64  ..    def test_d
+0000ebf0: 756d 7073 5f66 6169 6c73 5f77 6974 685f  umps_fails_with_
+0000ec00: 696e 7661 6c69 645f 7461 6773 2873 656c  invalid_tags(sel
+0000ec10: 6629 3a0a 2020 2020 2020 2020 7575 6964  f):.        uuid
+0000ec20: 7320 3d20 5b55 5549 4428 2737 3932 3062  s = [UUID('7920b
+0000ec30: 3339 342d 3135 3635 2d31 3165 382d 3836  394-1565-11e8-86
+0000ec40: 6530 2d38 6234 3264 3436 3437 6261 3827  e0-8b42d4647ba8'
+0000ec50: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
+0000ec60: 2020 2020 5555 4944 2827 3830 6166 3837      UUID('80af87
+0000ec70: 3563 2d31 3536 352d 3131 6538 2d38 6634  5c-1565-11e8-8f4
+0000ec80: 342d 3837 6566 3038 3162 3438 6364 2729  4-87ef081b48cd')
+0000ec90: 5d0a 2020 2020 2020 2020 6372 6561 7465  ].        create
+0000eca0: 6420 3d20 6461 7465 7469 6d65 2831 3938  d = datetime(198
+0000ecb0: 332c 2033 2c20 3239 2c20 3135 2c20 3135  3, 3, 29, 15, 15
+0000ecc0: 290a 2020 2020 2020 2020 7769 7468 2073  ).        with s
+0000ecd0: 656c 662e 6173 7365 7274 5261 6973 6573  elf.assertRaises
+0000ece0: 2847 5346 456e 636f 6465 4572 726f 7229  (GSFEncodeError)
+0000ecf0: 3a0a 2020 2020 2020 2020 2020 2020 7769  :.            wi
+0000ed00: 7468 206d 6f63 6b2e 7061 7463 6828 276d  th mock.patch('m
+0000ed10: 6564 6961 6772 6169 6e73 2e67 7366 2e64  ediagrains.gsf.d
+0000ed20: 6174 6574 696d 6527 2c20 7369 6465 5f65  atetime', side_e
+0000ed30: 6666 6563 743d 6461 7465 7469 6d65 2c20  ffect=datetime, 
+0000ed40: 6e6f 773d 6d6f 636b 2e4d 6167 6963 4d6f  now=mock.MagicMo
+0000ed50: 636b 2872 6574 7572 6e5f 7661 6c75 653d  ck(return_value=
+0000ed60: 6372 6561 7465 6429 293a 0a20 2020 2020  created)):.     
+0000ed70: 2020 2020 2020 2020 2020 2077 6974 6820             with 
+0000ed80: 6d6f 636b 2e70 6174 6368 2827 6d65 6469  mock.patch('medi
+0000ed90: 6167 7261 696e 732e 6773 662e 7575 6964  agrains.gsf.uuid
+0000eda0: 3127 2c20 7369 6465 5f65 6666 6563 743d  1', side_effect=
+0000edb0: 7575 6964 7329 3a0a 2020 2020 2020 2020  uuids):.        
+0000edc0: 2020 2020 2020 2020 2020 2020 2868 6561              (hea
+0000edd0: 642c 2073 6567 6d65 6e74 7329 203d 206c  d, segments) = l
+0000ede0: 6f61 6473 2864 756d 7073 285b 5d2c 2074  oads(dumps([], t
+0000edf0: 6167 733d 5b4e 6f6e 652c 204e 6f6e 655d  ags=[None, None]
+0000ee00: 2929 0a0a 2020 2020 6465 6620 7465 7374  ))..    def test
+0000ee10: 5f64 756d 7073 5f63 616e 5f73 6574 5f74  _dumps_can_set_t
+0000ee20: 6167 7328 7365 6c66 293a 0a20 2020 2020  ags(self):.     
+0000ee30: 2020 2075 7569 6473 203d 205b 5555 4944     uuids = [UUID
+0000ee40: 2827 3739 3230 6233 3934 2d31 3536 352d  ('7920b394-1565-
+0000ee50: 3131 6538 2d38 3665 302d 3862 3432 6434  11e8-86e0-8b42d4
+0000ee60: 3634 3762 6138 2729 2c0a 2020 2020 2020  647ba8'),.      
+0000ee70: 2020 2020 2020 2020 2020 2055 5549 4428             UUID(
+0000ee80: 2738 3061 6638 3735 632d 3135 3635 2d31  '80af875c-1565-1
+0000ee90: 3165 382d 3866 3434 2d38 3765 6630 3831  1e8-8f44-87ef081
+0000eea0: 6234 3863 6427 295d 0a20 2020 2020 2020  b48cd')].       
+0000eeb0: 2063 7265 6174 6564 203d 2064 6174 6574   created = datet
+0000eec0: 696d 6528 3139 3833 2c20 332c 2032 392c  ime(1983, 3, 29,
+0000eed0: 2031 352c 2031 3529 0a20 2020 2020 2020   15, 15).       
+0000eee0: 2077 6974 6820 6d6f 636b 2e70 6174 6368   with mock.patch
+0000eef0: 2827 6d65 6469 6167 7261 696e 732e 6773  ('mediagrains.gs
+0000ef00: 662e 6461 7465 7469 6d65 272c 2073 6964  f.datetime', sid
+0000ef10: 655f 6566 6665 6374 3d64 6174 6574 696d  e_effect=datetim
+0000ef20: 652c 206e 6f77 3d6d 6f63 6b2e 4d61 6769  e, now=mock.Magi
+0000ef30: 634d 6f63 6b28 7265 7475 726e 5f76 616c  cMock(return_val
+0000ef40: 7565 3d63 7265 6174 6564 2929 3a0a 2020  ue=created)):.  
+0000ef50: 2020 2020 2020 2020 2020 7769 7468 206d            with m
+0000ef60: 6f63 6b2e 7061 7463 6828 276d 6564 6961  ock.patch('media
+0000ef70: 6772 6169 6e73 2e67 7366 2e75 7569 6431  grains.gsf.uuid1
+0000ef80: 272c 2073 6964 655f 6566 6665 6374 3d75  ', side_effect=u
+0000ef90: 7569 6473 293a 0a20 2020 2020 2020 2020  uids):.         
+0000efa0: 2020 2020 2020 2028 6865 6164 2c20 7365         (head, se
+0000efb0: 676d 656e 7473 2920 3d20 6c6f 6164 7328  gments) = loads(
+0000efc0: 6475 6d70 7328 5b5d 2c20 7461 6773 3d5b  dumps([], tags=[
+0000efd0: 2827 706f 7461 746f 272c 2027 6861 7276  ('potato', 'harv
+0000efe0: 6573 7427 295d 2c20 7365 676d 656e 745f  est')], segment_
+0000eff0: 7461 6773 3d5b 2827 7261 696e 626f 7727  tags=[('rainbow'
+0000f000: 2c20 2764 6173 6827 295d 2929 0a0a 2020  , 'dash')]))..  
+0000f010: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+0000f020: 7445 7175 616c 286c 656e 2868 6561 645b  tEqual(len(head[
+0000f030: 2774 6167 7327 5d29 2c20 3129 0a20 2020  'tags']), 1).   
+0000f040: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+0000f050: 496e 2828 2770 6f74 6174 6f27 2c20 2768  In(('potato', 'h
+0000f060: 6172 7665 7374 2729 2c20 6865 6164 5b27  arvest'), head['
+0000f070: 7461 6773 275d 290a 0a20 2020 2020 2020  tags'])..       
+0000f080: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+0000f090: 6c28 6c65 6e28 6865 6164 5b27 7365 676d  l(len(head['segm
+0000f0a0: 656e 7473 275d 5b30 5d5b 2774 6167 7327  ents'][0]['tags'
+0000f0b0: 5d29 2c20 3129 0a20 2020 2020 2020 2073  ]), 1).        s
+0000f0c0: 656c 662e 6173 7365 7274 496e 2828 2772  elf.assertIn(('r
+0000f0d0: 6169 6e62 6f77 272c 2027 6461 7368 2729  ainbow', 'dash')
+0000f0e0: 2c20 6865 6164 5b27 7365 676d 656e 7473  , head['segments
+0000f0f0: 275d 5b30 5d5b 2774 6167 7327 5d29 0a0a  '][0]['tags'])..
+0000f100: 2020 2020 6173 796e 6320 6465 6620 7465      async def te
+0000f110: 7374 5f73 796e 635f 656e 636f 6465 5f66  st_sync_encode_f
+0000f120: 6c6f 7728 7365 6c66 293a 0a20 2020 2020  low(self):.     
+0000f130: 2020 2073 7263 5f69 6420 3d20 5555 4944     src_id = UUID
+0000f140: 2827 6531 3465 3964 3538 2d31 3536 372d  ('e14e9d58-1567-
+0000f150: 3131 6538 2d38 6464 332d 3833 3161 3036  11e8-8dd3-831a06
+0000f160: 3865 6230 3334 2729 0a20 2020 2020 2020  8eb034').       
+0000f170: 2066 6c6f 775f 6964 203d 2055 5549 4428   flow_id = UUID(
+0000f180: 2765 6531 6565 6435 382d 3135 3637 2d31  'ee1eed58-1567-1
+0000f190: 3165 382d 6139 3731 2d33 6239 3031 6132  1e8-a971-3b901a2
+0000f1a0: 6464 3861 6227 290a 2020 2020 2020 2020  dd8ab').        
+0000f1b0: 666f 726d 6174 203d 2022 7572 6e3a 782d  format = "urn:x-
+0000f1c0: 6e6d 6f73 3a66 6f72 6d61 743a 7669 6465  nmos:format:vide
+0000f1d0: 6f22 0a20 2020 2020 2020 2067 7261 696e  o".        grain
+0000f1e0: 203d 2056 6964 656f 4772 6169 6e28 7372   = VideoGrain(sr
+0000f1f0: 635f 6964 3d73 7263 5f69 642c 2066 6c6f  c_id=src_id, flo
+0000f200: 775f 6964 3d66 6c6f 775f 6964 290a 0a20  w_id=flow_id).. 
+0000f210: 2020 2020 2020 2066 203d 2042 7974 6573         f = Bytes
+0000f220: 494f 2829 0a20 2020 2020 2020 2077 6974  IO().        wit
+0000f230: 6820 4753 4645 6e63 6f64 6572 2866 2920  h GSFEncoder(f) 
+0000f240: 6173 2065 6e63 3a0a 2020 2020 2020 2020  as enc:.        
+0000f250: 2020 2020 656e 632e 6164 645f 6772 6169      enc.add_grai
+0000f260: 6e73 285b 6772 6169 6e5d 290a 2020 2020  ns([grain]).    
+0000f270: 2020 2020 2020 2020 656e 632e 7365 676d          enc.segm
+0000f280: 656e 7473 5b31 5d2e 6164 645f 666c 6f77  ents[1].add_flow
+0000f290: 2873 7263 5f69 642c 2066 6c6f 775f 6964  (src_id, flow_id
+0000f2a0: 2c20 666f 726d 6174 2c20 227b 7d22 290a  , format, "{}").
+0000f2b0: 2020 2020 2020 2020 2868 6561 642c 2073          (head, s
+0000f2c0: 6567 6d65 6e74 7329 203d 206c 6f61 6473  egments) = loads
+0000f2d0: 2866 2e67 6574 7661 6c75 6528 2929 0a0a  (f.getvalue())..
+0000f2e0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+0000f2f0: 6572 7445 7175 616c 2868 6561 645b 2773  ertEqual(head['s
+0000f300: 6567 6d65 6e74 7327 5d5b 305d 5b27 666c  egments'][0]['fl
+0000f310: 6f77 275d 5b27 736f 7572 6365 5f69 6427  ow']['source_id'
+0000f320: 5d2c 2073 7263 5f69 6429 0a20 2020 2020  ], src_id).     
+0000f330: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+0000f340: 7561 6c28 6865 6164 5b27 7365 676d 656e  ual(head['segmen
+0000f350: 7473 275d 5b30 5d5b 2766 6c6f 7727 5d5b  ts'][0]['flow'][
+0000f360: 2766 6c6f 775f 6964 275d 2c20 666c 6f77  'flow_id'], flow
+0000f370: 5f69 6429 0a20 2020 2020 2020 2073 656c  _id).        sel
+0000f380: 662e 6173 7365 7274 4571 7561 6c28 6865  f.assertEqual(he
+0000f390: 6164 5b27 7365 676d 656e 7473 275d 5b30  ad['segments'][0
+0000f3a0: 5d5b 2766 6c6f 7727 5d5b 2766 6f72 6d61  ]['flow']['forma
+0000f3b0: 7427 5d2c 2066 6f72 6d61 7429 0a0a 2020  t'], format)..  
+0000f3c0: 2020 6173 796e 6320 6465 6620 7465 7374    async def test
+0000f3d0: 5f61 7379 6e63 5f65 6e63 6f64 655f 666c  _async_encode_fl
+0000f3e0: 6f77 2873 656c 6629 3a0a 2020 2020 2020  ow(self):.      
+0000f3f0: 2020 7372 635f 6964 203d 2055 5549 4428    src_id = UUID(
+0000f400: 2765 3134 6539 6435 382d 3135 3637 2d31  'e14e9d58-1567-1
+0000f410: 3165 382d 3864 6433 2d38 3331 6130 3638  1e8-8dd3-831a068
+0000f420: 6562 3033 3427 290a 2020 2020 2020 2020  eb034').        
+0000f430: 666c 6f77 5f69 6420 3d20 5555 4944 2827  flow_id = UUID('
+0000f440: 6565 3165 6564 3538 2d31 3536 372d 3131  ee1eed58-1567-11
+0000f450: 6538 2d61 3937 312d 3362 3930 3161 3264  e8-a971-3b901a2d
+0000f460: 6438 6162 2729 0a20 2020 2020 2020 2066  d8ab').        f
+0000f470: 6f72 6d61 7420 3d20 2275 726e 3a78 2d6e  ormat = "urn:x-n
+0000f480: 6d6f 733a 666f 726d 6174 3a76 6964 656f  mos:format:video
+0000f490: 220a 2020 2020 2020 2020 6772 6169 6e20  ".        grain 
+0000f4a0: 3d20 5669 6465 6f47 7261 696e 2873 7263  = VideoGrain(src
+0000f4b0: 5f69 643d 7372 635f 6964 2c20 666c 6f77  _id=src_id, flow
+0000f4c0: 5f69 643d 666c 6f77 5f69 6429 0a0a 2020  _id=flow_id)..  
+0000f4d0: 2020 2020 2020 6620 3d20 4279 7465 7349        f = BytesI
+0000f4e0: 4f28 290a 2020 2020 2020 2020 6173 796e  O().        asyn
+0000f4f0: 6320 7769 7468 2047 5346 456e 636f 6465  c with GSFEncode
+0000f500: 7228 6629 2061 7320 656e 633a 0a20 2020  r(f) as enc:.   
+0000f510: 2020 2020 2020 2020 2061 7761 6974 2065           await e
+0000f520: 6e63 2e61 6464 5f67 7261 696e 7328 5b67  nc.add_grains([g
+0000f530: 7261 696e 5d29 0a20 2020 2020 2020 2020  rain]).         
+0000f540: 2020 2065 6e63 2e73 6567 6d65 6e74 735b     enc.segments[
+0000f550: 315d 2e61 6464 5f66 6c6f 7728 7372 635f  1].add_flow(src_
+0000f560: 6964 2c20 666c 6f77 5f69 642c 2066 6f72  id, flow_id, for
+0000f570: 6d61 742c 2022 7b7d 2229 0a20 2020 2020  mat, "{}").     
+0000f580: 2020 2028 6865 6164 2c20 7365 676d 656e     (head, segmen
+0000f590: 7473 2920 3d20 6c6f 6164 7328 662e 6765  ts) = loads(f.ge
+0000f5a0: 7476 616c 7565 2829 290a 0a20 2020 2020  tvalue())..     
+0000f5b0: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+0000f5c0: 7561 6c28 6865 6164 5b27 7365 676d 656e  ual(head['segmen
+0000f5d0: 7473 275d 5b30 5d5b 2766 6c6f 7727 5d5b  ts'][0]['flow'][
+0000f5e0: 2773 6f75 7263 655f 6964 275d 2c20 7372  'source_id'], sr
+0000f5f0: 635f 6964 290a 2020 2020 2020 2020 7365  c_id).        se
+0000f600: 6c66 2e61 7373 6572 7445 7175 616c 2868  lf.assertEqual(h
+0000f610: 6561 645b 2773 6567 6d65 6e74 7327 5d5b  ead['segments'][
+0000f620: 305d 5b27 666c 6f77 275d 5b27 666c 6f77  0]['flow']['flow
+0000f630: 5f69 6427 5d2c 2066 6c6f 775f 6964 290a  _id'], flow_id).
+0000f640: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+0000f650: 6572 7445 7175 616c 2868 6561 645b 2773  ertEqual(head['s
+0000f660: 6567 6d65 6e74 7327 5d5b 305d 5b27 666c  egments'][0]['fl
+0000f670: 6f77 275d 5b27 666f 726d 6174 275d 2c20  ow']['format'], 
+0000f680: 666f 726d 6174 290a 0a20 2020 2064 6566  format)..    def
+0000f690: 2074 6573 745f 656e 636f 6465 725f 6163   test_encoder_ac
+0000f6a0: 6365 7373 5f6d 6574 686f 6473 2873 656c  cess_methods(sel
+0000f6b0: 6629 3a0a 2020 2020 2020 2020 7575 6964  f):.        uuid
+0000f6c0: 7320 3d20 5b55 5549 4428 2737 3932 3062  s = [UUID('7920b
+0000f6d0: 3339 342d 3135 3635 2d31 3165 382d 3836  394-1565-11e8-86
+0000f6e0: 6530 2d38 6234 3264 3436 3437 6261 3827  e0-8b42d4647ba8'
+0000f6f0: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
+0000f700: 2020 2020 5555 4944 2827 3830 6166 3837      UUID('80af87
+0000f710: 3563 2d31 3536 352d 3131 6538 2d38 6634  5c-1565-11e8-8f4
+0000f720: 342d 3837 6566 3038 3162 3438 6364 2729  4-87ef081b48cd')
+0000f730: 5d0a 2020 2020 2020 2020 6372 6561 7465  ].        create
+0000f740: 6420 3d20 6461 7465 7469 6d65 2831 3938  d = datetime(198
+0000f750: 332c 2033 2c20 3239 2c20 3135 2c20 3135  3, 3, 29, 15, 15
+0000f760: 290a 2020 2020 2020 2020 7769 7468 206d  ).        with m
+0000f770: 6f63 6b2e 7061 7463 6828 276d 6564 6961  ock.patch('media
+0000f780: 6772 6169 6e73 2e67 7366 2e64 6174 6574  grains.gsf.datet
+0000f790: 696d 6527 2c20 7369 6465 5f65 6666 6563  ime', side_effec
+0000f7a0: 743d 6461 7465 7469 6d65 2c20 6e6f 773d  t=datetime, now=
+0000f7b0: 6d6f 636b 2e4d 6167 6963 4d6f 636b 2872  mock.MagicMock(r
+0000f7c0: 6574 7572 6e5f 7661 6c75 653d 6372 6561  eturn_value=crea
+0000f7d0: 7465 6429 293a 0a20 2020 2020 2020 2020  ted)):.         
+0000f7e0: 2020 2077 6974 6820 6d6f 636b 2e70 6174     with mock.pat
+0000f7f0: 6368 2827 6d65 6469 6167 7261 696e 732e  ch('mediagrains.
+0000f800: 6773 662e 7575 6964 3127 2c20 7369 6465  gsf.uuid1', side
+0000f810: 5f65 6666 6563 743d 7575 6964 7329 3a0a  _effect=uuids):.
+0000f820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f830: 656e 6320 3d20 4753 4645 6e63 6f64 6572  enc = GSFEncoder
+0000f840: 285b 5d2c 2074 6167 733d 5b28 2770 6f74  ([], tags=[('pot
+0000f850: 6174 6f27 2c20 2768 6172 7665 7374 2729  ato', 'harvest')
+0000f860: 5d29 0a20 2020 2020 2020 2020 2020 2020  ]).             
+0000f870: 2020 2065 6e63 2e61 6464 5f73 6567 6d65     enc.add_segme
+0000f880: 6e74 2874 6167 733d 5b28 2772 6169 6e62  nt(tags=[('rainb
+0000f890: 6f77 272c 2027 6461 7368 2729 5d29 0a0a  ow', 'dash')])..
+0000f8a0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+0000f8b0: 6572 7445 7175 616c 2865 6e63 2e74 6167  ertEqual(enc.tag
+0000f8c0: 732c 2028 2827 706f 7461 746f 272c 2027  s, (('potato', '
+0000f8d0: 6861 7276 6573 7427 292c 2929 0a20 2020  harvest'),)).   
+0000f8e0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+0000f8f0: 4973 496e 7374 616e 6365 2865 6e63 2e73  IsInstance(enc.s
+0000f900: 6567 6d65 6e74 732c 2066 726f 7a65 6e64  egments, frozend
+0000f910: 6963 7429 0a20 2020 2020 2020 2073 656c  ict).        sel
+0000f920: 662e 6173 7365 7274 4571 7561 6c28 656e  f.assertEqual(en
+0000f930: 632e 7365 676d 656e 7473 5b31 5d2e 7461  c.segments[1].ta
+0000f940: 6773 2c20 2828 2772 6169 6e62 6f77 272c  gs, (('rainbow',
+0000f950: 2027 6461 7368 2729 2c29 290a 0a20 2020   'dash'),))..   
+0000f960: 2040 7375 7070 7265 7373 5f64 6570 7265   @suppress_depre
+0000f970: 6361 7469 6f6e 5f77 6172 6e69 6e67 730a  cation_warnings.
+0000f980: 2020 2020 6465 6620 7465 7374 5f65 6e63      def test_enc
+0000f990: 6f64 6572 5f72 6169 7365 735f 7768 656e  oder_raises_when
+0000f9a0: 5f61 6464 696e 675f 746f 5f61 6374 6976  _adding_to_activ
+0000f9b0: 655f 656e 636f 6465 5f5f 6465 7072 6563  e_encode__deprec
+0000f9c0: 6174 6564 2873 656c 6629 3a0a 2020 2020  ated(self):.    
+0000f9d0: 2020 2020 7575 6964 7320 3d20 5b55 5549      uuids = [UUI
+0000f9e0: 4428 2737 3932 3062 3339 342d 3135 3635  D('7920b394-1565
+0000f9f0: 2d31 3165 382d 3836 6530 2d38 6234 3264  -11e8-86e0-8b42d
+0000fa00: 3436 3437 6261 3827 292c 0a20 2020 2020  4647ba8'),.     
+0000fa10: 2020 2020 2020 2020 2020 2020 5555 4944              UUID
+0000fa20: 2827 3830 6166 3837 3563 2d31 3536 352d  ('80af875c-1565-
+0000fa30: 3131 6538 2d38 6634 342d 3837 6566 3038  11e8-8f44-87ef08
+0000fa40: 3162 3438 6364 2729 5d0a 2020 2020 2020  1b48cd')].      
+0000fa50: 2020 6372 6561 7465 6420 3d20 6461 7465    created = date
+0000fa60: 7469 6d65 2831 3938 332c 2033 2c20 3239  time(1983, 3, 29
+0000fa70: 2c20 3135 2c20 3135 290a 2020 2020 2020  , 15, 15).      
+0000fa80: 2020 6669 6c65 203d 2042 7974 6573 494f    file = BytesIO
+0000fa90: 2829 0a20 2020 2020 2020 2077 6974 6820  ().        with 
+0000faa0: 6d6f 636b 2e70 6174 6368 2827 6d65 6469  mock.patch('medi
+0000fab0: 6167 7261 696e 732e 6773 662e 6461 7465  agrains.gsf.date
+0000fac0: 7469 6d65 272c 2073 6964 655f 6566 6665  time', side_effe
+0000fad0: 6374 3d64 6174 6574 696d 652c 206e 6f77  ct=datetime, now
+0000fae0: 3d6d 6f63 6b2e 4d61 6769 634d 6f63 6b28  =mock.MagicMock(
+0000faf0: 7265 7475 726e 5f76 616c 7565 3d63 7265  return_value=cre
+0000fb00: 6174 6564 2929 3a0a 2020 2020 2020 2020  ated)):.        
+0000fb10: 2020 2020 7769 7468 206d 6f63 6b2e 7061      with mock.pa
+0000fb20: 7463 6828 276d 6564 6961 6772 6169 6e73  tch('mediagrains
+0000fb30: 2e67 7366 2e75 7569 6431 272c 2073 6964  .gsf.uuid1', sid
+0000fb40: 655f 6566 6665 6374 3d75 7569 6473 293a  e_effect=uuids):
+0000fb50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000fb60: 2065 6e63 203d 2047 5346 456e 636f 6465   enc = GSFEncode
+0000fb70: 7228 6669 6c65 2c20 7461 6773 3d5b 2827  r(file, tags=[('
+0000fb80: 706f 7461 746f 272c 2027 6861 7276 6573  potato', 'harves
+0000fb90: 7427 295d 290a 2020 2020 2020 2020 2020  t')]).          
+0000fba0: 2020 2020 2020 7365 6720 3d20 656e 632e        seg = enc.
+0000fbb0: 6164 645f 7365 676d 656e 7428 7461 6773  add_segment(tags
+0000fbc0: 3d5b 2827 7261 696e 626f 7727 2c20 2764  =[('rainbow', 'd
+0000fbd0: 6173 6827 295d 290a 0a20 2020 2020 2020  ash')])..       
+0000fbe0: 2077 6974 6820 7365 6c66 2e61 7373 6572   with self.asser
+0000fbf0: 7452 6169 7365 7328 4753 4645 6e63 6f64  tRaises(GSFEncod
+0000fc00: 6545 7272 6f72 293a 0a20 2020 2020 2020  eError):.       
+0000fc10: 2020 2020 2065 6e63 2e61 6464 5f73 6567       enc.add_seg
+0000fc20: 6d65 6e74 286c 6f63 616c 5f69 643d 3129  ment(local_id=1)
+0000fc30: 0a0a 2020 2020 2020 2020 7769 7468 2073  ..        with s
+0000fc40: 656c 662e 6173 7365 7274 5261 6973 6573  elf.assertRaises
+0000fc50: 2847 5346 456e 636f 6465 4572 726f 7229  (GSFEncodeError)
+0000fc60: 3a0a 2020 2020 2020 2020 2020 2020 656e  :.            en
+0000fc70: 632e 6164 645f 7365 676d 656e 7428 7461  c.add_segment(ta
+0000fc80: 6773 3d5b 4e6f 6e65 5d29 0a0a 2020 2020  gs=[None])..    
+0000fc90: 2020 2020 656e 632e 7374 6172 745f 6475      enc.start_du
+0000fca0: 6d70 2829 0a0a 2020 2020 2020 2020 7769  mp()..        wi
+0000fcb0: 7468 2073 656c 662e 6173 7365 7274 5261  th self.assertRa
+0000fcc0: 6973 6573 2847 5346 456e 636f 6465 4164  ises(GSFEncodeAd
+0000fcd0: 6454 6f41 6374 6976 6544 756d 7029 3a0a  dToActiveDump):.
+0000fce0: 2020 2020 2020 2020 2020 2020 656e 632e              enc.
+0000fcf0: 6164 645f 7461 6728 2775 7073 6964 6527  add_tag('upside'
+0000fd00: 2c20 2764 6f77 6e27 290a 2020 2020 2020  , 'down').      
+0000fd10: 2020 7769 7468 2073 656c 662e 6173 7365    with self.asse
+0000fd20: 7274 5261 6973 6573 2847 5346 456e 636f  rtRaises(GSFEnco
+0000fd30: 6465 4164 6454 6f41 6374 6976 6544 756d  deAddToActiveDum
+0000fd40: 7029 3a0a 2020 2020 2020 2020 2020 2020  p):.            
+0000fd50: 656e 632e 6164 645f 7365 676d 656e 7428  enc.add_segment(
+0000fd60: 290a 2020 2020 2020 2020 7769 7468 2073  ).        with s
+0000fd70: 656c 662e 6173 7365 7274 5261 6973 6573  elf.assertRaises
+0000fd80: 2847 5346 456e 636f 6465 4164 6454 6f41  (GSFEncodeAddToA
+0000fd90: 6374 6976 6544 756d 7029 3a0a 2020 2020  ctiveDump):.    
+0000fda0: 2020 2020 2020 2020 7365 672e 6164 645f          seg.add_
+0000fdb0: 7461 6728 2775 7073 6964 6527 2c20 2764  tag('upside', 'd
+0000fdc0: 6f77 6e27 290a 0a20 2020 2064 6566 2074  own')..    def t
+0000fdd0: 6573 745f 656e 636f 6465 725f 7261 6973  est_encoder_rais
+0000fde0: 6573 5f77 6865 6e5f 6164 6469 6e67 5f74  es_when_adding_t
+0000fdf0: 6f5f 6163 7469 7665 5f65 6e63 6f64 6528  o_active_encode(
+0000fe00: 7365 6c66 293a 0a20 2020 2020 2020 2075  self):.        u
+0000fe10: 7569 6473 203d 205b 5555 4944 2827 3739  uids = [UUID('79
+0000fe20: 3230 6233 3934 2d31 3536 352d 3131 6538  20b394-1565-11e8
+0000fe30: 2d38 3665 302d 3862 3432 6434 3634 3762  -86e0-8b42d4647b
+0000fe40: 6138 2729 2c0a 2020 2020 2020 2020 2020  a8'),.          
+0000fe50: 2020 2020 2020 2055 5549 4428 2738 3061         UUID('80a
+0000fe60: 6638 3735 632d 3135 3635 2d31 3165 382d  f875c-1565-11e8-
+0000fe70: 3866 3434 2d38 3765 6630 3831 6234 3863  8f44-87ef081b48c
+0000fe80: 6427 295d 0a20 2020 2020 2020 2063 7265  d')].        cre
+0000fe90: 6174 6564 203d 2064 6174 6574 696d 6528  ated = datetime(
+0000fea0: 3139 3833 2c20 332c 2032 392c 2031 352c  1983, 3, 29, 15,
+0000feb0: 2031 3529 0a20 2020 2020 2020 2066 696c   15).        fil
+0000fec0: 6520 3d20 4279 7465 7349 4f28 290a 2020  e = BytesIO().  
+0000fed0: 2020 2020 2020 7769 7468 206d 6f63 6b2e        with mock.
+0000fee0: 7061 7463 6828 276d 6564 6961 6772 6169  patch('mediagrai
+0000fef0: 6e73 2e67 7366 2e64 6174 6574 696d 6527  ns.gsf.datetime'
+0000ff00: 2c20 7369 6465 5f65 6666 6563 743d 6461  , side_effect=da
+0000ff10: 7465 7469 6d65 2c20 6e6f 773d 6d6f 636b  tetime, now=mock
+0000ff20: 2e4d 6167 6963 4d6f 636b 2872 6574 7572  .MagicMock(retur
+0000ff30: 6e5f 7661 6c75 653d 6372 6561 7465 6429  n_value=created)
+0000ff40: 293a 0a20 2020 2020 2020 2020 2020 2077  ):.            w
+0000ff50: 6974 6820 6d6f 636b 2e70 6174 6368 2827  ith mock.patch('
+0000ff60: 6d65 6469 6167 7261 696e 732e 6773 662e  mediagrains.gsf.
+0000ff70: 7575 6964 3127 2c20 7369 6465 5f65 6666  uuid1', side_eff
+0000ff80: 6563 743d 7575 6964 7329 3a0a 2020 2020  ect=uuids):.    
+0000ff90: 2020 2020 2020 2020 2020 2020 656e 6320              enc 
+0000ffa0: 3d20 4753 4645 6e63 6f64 6572 2866 696c  = GSFEncoder(fil
+0000ffb0: 652c 2074 6167 733d 5b28 2770 6f74 6174  e, tags=[('potat
+0000ffc0: 6f27 2c20 2768 6172 7665 7374 2729 5d2c  o', 'harvest')],
+0000ffd0: 2073 7472 6561 6d69 6e67 3d54 7275 6529   streaming=True)
+0000ffe0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000fff0: 2073 6567 203d 2065 6e63 2e61 6464 5f73   seg = enc.add_s
+00010000: 6567 6d65 6e74 2874 6167 733d 5b28 2772  egment(tags=[('r
+00010010: 6169 6e62 6f77 272c 2027 6461 7368 2729  ainbow', 'dash')
+00010020: 5d29 0a0a 2020 2020 2020 2020 7769 7468  ])..        with
+00010030: 2073 656c 662e 6173 7365 7274 5261 6973   self.assertRais
+00010040: 6573 2847 5346 456e 636f 6465 4572 726f  es(GSFEncodeErro
+00010050: 7229 3a0a 2020 2020 2020 2020 2020 2020  r):.            
+00010060: 656e 632e 6164 645f 7365 676d 656e 7428  enc.add_segment(
+00010070: 6c6f 6361 6c5f 6964 3d31 290a 0a20 2020  local_id=1)..   
+00010080: 2020 2020 2077 6974 6820 7365 6c66 2e61       with self.a
+00010090: 7373 6572 7452 6169 7365 7328 4753 4645  ssertRaises(GSFE
+000100a0: 6e63 6f64 6545 7272 6f72 293a 0a20 2020  ncodeError):.   
+000100b0: 2020 2020 2020 2020 2065 6e63 2e61 6464           enc.add
+000100c0: 5f73 6567 6d65 6e74 2874 6167 733d 5b4e  _segment(tags=[N
+000100d0: 6f6e 655d 290a 0a20 2020 2020 2020 2077  one])..        w
+000100e0: 6974 6820 656e 633a 0a20 2020 2020 2020  ith enc:.       
+000100f0: 2020 2020 2077 6974 6820 7365 6c66 2e61       with self.a
+00010100: 7373 6572 7452 6169 7365 7328 4753 4645  ssertRaises(GSFE
+00010110: 6e63 6f64 6541 6464 546f 4163 7469 7665  ncodeAddToActive
+00010120: 4475 6d70 293a 0a20 2020 2020 2020 2020  Dump):.         
+00010130: 2020 2020 2020 2065 6e63 2e61 6464 5f74         enc.add_t
+00010140: 6167 2827 7570 7369 6465 272c 2027 646f  ag('upside', 'do
+00010150: 776e 2729 0a20 2020 2020 2020 2020 2020  wn').           
+00010160: 2077 6974 6820 7365 6c66 2e61 7373 6572   with self.asser
+00010170: 7452 6169 7365 7328 4753 4645 6e63 6f64  tRaises(GSFEncod
+00010180: 6541 6464 546f 4163 7469 7665 4475 6d70  eAddToActiveDump
+00010190: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+000101a0: 2020 2065 6e63 2e61 6464 5f73 6567 6d65     enc.add_segme
+000101b0: 6e74 2829 0a20 2020 2020 2020 2020 2020  nt().           
+000101c0: 2077 6974 6820 7365 6c66 2e61 7373 6572   with self.asser
+000101d0: 7452 6169 7365 7328 4753 4645 6e63 6f64  tRaises(GSFEncod
+000101e0: 6541 6464 546f 4163 7469 7665 4475 6d70  eAddToActiveDump
+000101f0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00010200: 2020 2073 6567 2e61 6464 5f74 6167 2827     seg.add_tag('
+00010210: 7570 7369 6465 272c 2027 646f 776e 2729  upside', 'down')
+00010220: 0a0a 2020 2020 6465 6620 7465 7374 5f65  ..    def test_e
+00010230: 6e63 6f64 6572 5f63 616e 5f61 6464 5f67  ncoder_can_add_g
+00010240: 7261 696e 735f 746f 5f6e 6f6e 6578 6973  rains_to_nonexis
+00010250: 7465 6e74 5f73 6567 6d65 6e74 2873 656c  tent_segment(sel
+00010260: 6629 3a0a 2020 2020 2020 2020 7372 635f  f):.        src_
+00010270: 6964 203d 2055 5549 4428 2765 3134 6539  id = UUID('e14e9
+00010280: 6435 382d 3135 3637 2d31 3165 382d 3864  d58-1567-11e8-8d
+00010290: 6433 2d38 3331 6130 3638 6562 3033 3427  d3-831a068eb034'
+000102a0: 290a 2020 2020 2020 2020 666c 6f77 5f69  ).        flow_i
+000102b0: 6420 3d20 5555 4944 2827 6565 3165 6564  d = UUID('ee1eed
+000102c0: 3538 2d31 3536 372d 3131 6538 2d61 3937  58-1567-11e8-a97
+000102d0: 312d 3362 3930 3161 3264 6438 6162 2729  1-3b901a2dd8ab')
+000102e0: 0a20 2020 2020 2020 2067 7261 696e 3020  .        grain0 
+000102f0: 3d20 5669 6465 6f47 7261 696e 2873 7263  = VideoGrain(src
+00010300: 5f69 643d 7372 635f 6964 2c20 666c 6f77  _id=src_id, flow
+00010310: 5f69 643d 666c 6f77 5f69 642c 2063 6f67  _id=flow_id, cog
+00010320: 5f66 7261 6d65 5f66 6f72 6d61 743d 436f  _frame_format=Co
+00010330: 6746 7261 6d65 466f 726d 6174 2e53 3136  gFrameFormat.S16
+00010340: 5f34 3232 5f31 3042 4954 2c20 7769 6474  _422_10BIT, widt
+00010350: 683d 3139 3230 2c0a 2020 2020 2020 2020  h=1920,.        
+00010360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010370: 2020 2020 6865 6967 6874 3d31 3038 3029      height=1080)
+00010380: 0a20 2020 2020 2020 2075 7569 6473 203d  .        uuids =
+00010390: 205b 5555 4944 2827 3739 3230 6233 3934   [UUID('7920b394
+000103a0: 2d31 3536 352d 3131 6538 2d38 3665 302d  -1565-11e8-86e0-
+000103b0: 3862 3432 6434 3634 3762 6138 2729 2c0a  8b42d4647ba8'),.
+000103c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000103d0: 2055 5549 4428 2738 3061 6638 3735 632d   UUID('80af875c-
+000103e0: 3135 3635 2d31 3165 382d 3866 3434 2d38  1565-11e8-8f44-8
+000103f0: 3765 6630 3831 6234 3863 6427 295d 0a20  7ef081b48cd')]. 
+00010400: 2020 2020 2020 2063 7265 6174 6564 203d         created =
+00010410: 2064 6174 6574 696d 6528 3139 3833 2c20   datetime(1983, 
+00010420: 332c 2032 392c 2031 352c 2031 3529 0a20  3, 29, 15, 15). 
+00010430: 2020 2020 2020 2066 696c 6520 3d20 4279         file = By
+00010440: 7465 7349 4f28 290a 2020 2020 2020 2020  tesIO().        
+00010450: 7769 7468 206d 6f63 6b2e 7061 7463 6828  with mock.patch(
+00010460: 276d 6564 6961 6772 6169 6e73 2e67 7366  'mediagrains.gsf
+00010470: 2e64 6174 6574 696d 6527 2c20 7369 6465  .datetime', side
+00010480: 5f65 6666 6563 743d 6461 7465 7469 6d65  _effect=datetime
+00010490: 2c20 6e6f 773d 6d6f 636b 2e4d 6167 6963  , now=mock.Magic
+000104a0: 4d6f 636b 2872 6574 7572 6e5f 7661 6c75  Mock(return_valu
+000104b0: 653d 6372 6561 7465 6429 293a 0a20 2020  e=created)):.   
+000104c0: 2020 2020 2020 2020 2077 6974 6820 6d6f           with mo
+000104d0: 636b 2e70 6174 6368 2827 6d65 6469 6167  ck.patch('mediag
+000104e0: 7261 696e 732e 6773 662e 7575 6964 3127  rains.gsf.uuid1'
+000104f0: 2c20 7369 6465 5f65 6666 6563 743d 7575  , side_effect=uu
+00010500: 6964 7329 3a0a 2020 2020 2020 2020 2020  ids):.          
+00010510: 2020 2020 2020 656e 6320 3d20 4753 4645        enc = GSFE
+00010520: 6e63 6f64 6572 2866 696c 652c 2074 6167  ncoder(file, tag
+00010530: 733d 5b28 2770 6f74 6174 6f27 2c20 2768  s=[('potato', 'h
+00010540: 6172 7665 7374 2729 5d29 0a0a 2020 2020  arvest')])..    
+00010550: 2020 2020 656e 632e 6164 645f 6772 6169      enc.add_grai
+00010560: 6e28 6772 6169 6e30 2c20 7365 676d 656e  n(grain0, segmen
+00010570: 745f 6c6f 6361 6c5f 6964 3d32 290a 0a20  t_local_id=2).. 
+00010580: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+00010590: 7274 4571 7561 6c28 656e 632e 7365 676d  rtEqual(enc.segm
+000105a0: 656e 7473 5b32 5d2e 5f67 7261 696e 735b  ents[2]._grains[
+000105b0: 305d 2c20 6772 6169 6e30 290a 0a0a 636c  0], grain0)...cl
+000105c0: 6173 7320 5465 7374 4753 4642 6c6f 636b  ass TestGSFBlock
+000105d0: 2849 736f 6c61 7465 6441 7379 6e63 696f  (IsolatedAsyncio
+000105e0: 5465 7374 4361 7365 293a 0a20 2020 2022  TestCase):.    "
+000105f0: 2222 5465 7374 2074 6865 2047 5346 2064  ""Test the GSF d
+00010600: 6563 6f64 6572 2062 6c6f 636b 2068 616e  ecoder block han
+00010610: 646c 6572 2063 6f72 7265 6374 6c79 2070  dler correctly p
+00010620: 6172 7365 7320 7661 7269 6f75 7320 7479  arses various ty
+00010630: 7065 7322 2222 0a0a 2020 2020 6173 796e  pes"""..    asyn
+00010640: 6320 6465 6620 7465 7374 5f61 7379 6e63  c def test_async
+00010650: 5f72 6561 645f 7569 6e74 2873 656c 6629  _read_uint(self)
+00010660: 3a0a 2020 2020 2020 2020 7465 7374 5f6e  :.        test_n
+00010670: 756d 6265 7220 3d20 3431 3332 0a20 2020  umber = 4132.   
+00010680: 2020 2020 2074 6573 745f 6461 7461 203d       test_data =
+00010690: 2062 225c 7832 345c 7831 305c 7830 305c   b"\x24\x10\x00\
+000106a0: 7830 3022 0a0a 2020 2020 2020 2020 6173  x00"..        as
+000106b0: 796e 6320 7769 7468 2041 7379 6e63 4279  ync with AsyncBy
+000106c0: 7465 7349 4f28 7465 7374 5f64 6174 6129  tesIO(test_data)
+000106d0: 2061 7320 6670 3a0a 2020 2020 2020 2020   as fp:.        
+000106e0: 2020 2020 5555 5420 3d20 4173 796e 6347      UUT = AsyncG
+000106f0: 5346 426c 6f63 6b28 6670 290a 0a20 2020  SFBlock(fp)..   
+00010700: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
+00010710: 7365 7274 4571 7561 6c28 7465 7374 5f6e  sertEqual(test_n
+00010720: 756d 6265 722c 2061 7761 6974 2055 5554  umber, await UUT
+00010730: 2e72 6561 645f 7569 6e74 2834 2929 0a0a  .read_uint(4))..
+00010740: 2020 2020 6173 796e 6320 6465 6620 7465      async def te
+00010750: 7374 5f61 7379 6e63 5f72 6561 645f 7374  st_async_read_st
+00010760: 7269 6e67 2873 656c 6629 3a0a 2020 2020  ring(self):.    
+00010770: 2020 2020 2222 2254 6573 7420 7765 2063      """Test we c
+00010780: 616e 2072 6561 6420 6120 7374 7269 6e67  an read a string
+00010790: 2c20 7769 7468 2055 6e69 636f 6465 2063  , with Unicode c
+000107a0: 6861 7261 6374 6572 7322 2222 0a20 2020  haracters""".   
+000107b0: 2020 2020 2074 6573 745f 7374 7269 6e67       test_string
+000107c0: 203d 2075 2253 7472 696e 6773 f09f 9881   = u"Strings....
+000107d0: e29c 9422 0a0a 2020 2020 2020 2020 7465  ..."..        te
+000107e0: 7374 5f64 6174 6120 3d20 6222 5374 7269  st_data = b"Stri
+000107f0: 6e67 735c 7866 305c 7839 665c 7839 385c  ngs\xf0\x9f\x98\
+00010800: 7838 315c 7865 325c 7839 635c 7839 3422  x81\xe2\x9c\x94"
+00010810: 0a0a 2020 2020 2020 2020 6173 796e 6320  ..        async 
+00010820: 7769 7468 2041 7379 6e63 4279 7465 7349  with AsyncBytesI
+00010830: 4f28 7465 7374 5f64 6174 6129 2061 7320  O(test_data) as 
+00010840: 6670 3a0a 2020 2020 2020 2020 2020 2020  fp:.            
+00010850: 5555 5420 3d20 4173 796e 6347 5346 426c  UUT = AsyncGSFBl
+00010860: 6f63 6b28 6670 290a 0a20 2020 2020 2020  ock(fp)..       
+00010870: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00010880: 4571 7561 6c28 7465 7374 5f73 7472 696e  Equal(test_strin
+00010890: 672c 2061 7761 6974 2055 5554 2e72 6561  g, await UUT.rea
+000108a0: 645f 7374 7269 6e67 2831 3429 290a 0a20  d_string(14)).. 
+000108b0: 2020 2064 6566 2074 6573 745f 7265 6164     def test_read
+000108c0: 5f75 696e 7428 7365 6c66 293a 0a20 2020  _uint(self):.   
+000108d0: 2020 2020 2074 6573 745f 6e75 6d62 6572       test_number
+000108e0: 203d 2034 3133 320a 2020 2020 2020 2020   = 4132.        
+000108f0: 7465 7374 5f64 6174 6120 3d20 6222 5c78  test_data = b"\x
+00010900: 3234 5c78 3130 5c78 3030 5c78 3030 220a  24\x10\x00\x00".
+00010910: 0a20 2020 2020 2020 2077 6974 6820 4279  .        with By
+00010920: 7465 7349 4f28 7465 7374 5f64 6174 6129  tesIO(test_data)
+00010930: 2061 7320 6670 3a0a 2020 2020 2020 2020   as fp:.        
+00010940: 2020 2020 5555 5420 3d20 5379 6e63 4753      UUT = SyncGS
+00010950: 4642 6c6f 636b 2866 7029 0a0a 2020 2020  FBlock(fp)..    
+00010960: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+00010970: 6572 7445 7175 616c 2874 6573 745f 6e75  ertEqual(test_nu
+00010980: 6d62 6572 2c20 5555 542e 7265 6164 5f75  mber, UUT.read_u
+00010990: 696e 7428 3429 290a 0a20 2020 2064 6566  int(4))..    def
+000109a0: 2074 6573 745f 7265 6164 5f62 6f6f 6c28   test_read_bool(
+000109b0: 7365 6c66 293a 0a20 2020 2020 2020 2074  self):.        t
+000109c0: 6573 745f 6461 7461 203d 2062 225c 7830  est_data = b"\x0
+000109d0: 305c 7830 315c 7830 3222 2020 2320 4661  0\x01\x02"  # Fa
+000109e0: 6c73 652c 2054 7275 6520 2830 7830 3120  lse, True (0x01 
+000109f0: 213d 2030 292c 2054 7275 6520 2830 7830  != 0), True (0x0
+00010a00: 3220 213d 2030 290a 0a20 2020 2020 2020  2 != 0)..       
+00010a10: 2077 6974 6820 4279 7465 7349 4f28 7465   with BytesIO(te
+00010a20: 7374 5f64 6174 6129 2061 7320 6670 3a0a  st_data) as fp:.
+00010a30: 2020 2020 2020 2020 2020 2020 5555 5420              UUT 
+00010a40: 3d20 5379 6e63 4753 4642 6c6f 636b 2866  = SyncGSFBlock(f
+00010a50: 7029 0a0a 2020 2020 2020 2020 2020 2020  p)..            
+00010a60: 7365 6c66 2e61 7373 6572 7446 616c 7365  self.assertFalse
+00010a70: 2855 5554 2e72 6561 645f 626f 6f6c 2829  (UUT.read_bool()
+00010a80: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+00010a90: 6c66 2e61 7373 6572 7454 7275 6528 5555  lf.assertTrue(UU
+00010aa0: 542e 7265 6164 5f62 6f6f 6c28 2929 0a20  T.read_bool()). 
+00010ab0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00010ac0: 6173 7365 7274 5472 7565 2855 5554 2e72  assertTrue(UUT.r
+00010ad0: 6561 645f 626f 6f6c 2829 290a 0a20 2020  ead_bool())..   
+00010ae0: 2064 6566 2074 6573 745f 7265 6164 5f73   def test_read_s
+00010af0: 696e 7428 7365 6c66 293a 0a20 2020 2020  int(self):.     
+00010b00: 2020 2074 6573 745f 6e75 6d62 6572 203d     test_number =
+00010b10: 202d 3132 3835 360a 2020 2020 2020 2020   -12856.        
+00010b20: 7465 7374 5f64 6174 6120 3d20 6222 5c78  test_data = b"\x
+00010b30: 4338 5c78 4344 5c78 4646 220a 0a20 2020  C8\xCD\xFF"..   
+00010b40: 2020 2020 2077 6974 6820 4279 7465 7349       with BytesI
+00010b50: 4f28 7465 7374 5f64 6174 6129 2061 7320  O(test_data) as 
+00010b60: 6670 3a0a 2020 2020 2020 2020 2020 2020  fp:.            
+00010b70: 5555 5420 3d20 5379 6e63 4753 4642 6c6f  UUT = SyncGSFBlo
+00010b80: 636b 2866 7029 0a0a 2020 2020 2020 2020  ck(fp)..        
+00010b90: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+00010ba0: 7175 616c 2874 6573 745f 6e75 6d62 6572  qual(test_number
+00010bb0: 2c20 5555 542e 7265 6164 5f73 696e 7428  , UUT.read_sint(
+00010bc0: 3329 290a 0a20 2020 2064 6566 2074 6573  3))..    def tes
+00010bd0: 745f 7265 6164 5f73 7472 696e 6728 7365  t_read_string(se
+00010be0: 6c66 293a 0a20 2020 2020 2020 2022 2222  lf):.        """
+00010bf0: 5465 7374 2077 6520 6361 6e20 7265 6164  Test we can read
+00010c00: 2061 2073 7472 696e 672c 2077 6974 6820   a string, with 
+00010c10: 556e 6963 6f64 6520 6368 6172 6163 7465  Unicode characte
+00010c20: 7273 2222 220a 2020 2020 2020 2020 7465  rs""".        te
+00010c30: 7374 5f73 7472 696e 6720 3d20 7522 5374  st_string = u"St
+00010c40: 7269 6e67 73f0 9f98 81e2 9c94 220a 0a20  rings.......".. 
+00010c50: 2020 2020 2020 2074 6573 745f 6461 7461         test_data
+00010c60: 203d 2062 2253 7472 696e 6773 5c78 6630   = b"Strings\xf0
+00010c70: 5c78 3966 5c78 3938 5c78 3831 5c78 6532  \x9f\x98\x81\xe2
+00010c80: 5c78 3963 5c78 3934 220a 0a20 2020 2020  \x9c\x94"..     
+00010c90: 2020 2077 6974 6820 4279 7465 7349 4f28     with BytesIO(
+00010ca0: 7465 7374 5f64 6174 6129 2061 7320 6670  test_data) as fp
+00010cb0: 3a0a 2020 2020 2020 2020 2020 2020 5555  :.            UU
+00010cc0: 5420 3d20 5379 6e63 4753 4642 6c6f 636b  T = SyncGSFBlock
+00010cd0: 2866 7029 0a0a 2020 2020 2020 2020 2020  (fp)..          
+00010ce0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+00010cf0: 616c 2874 6573 745f 7374 7269 6e67 2c20  al(test_string, 
+00010d00: 5555 542e 7265 6164 5f73 7472 696e 6728  UUT.read_string(
+00010d10: 3134 2929 0a0a 2020 2020 6465 6620 7465  14))..    def te
+00010d20: 7374 5f72 6561 645f 7661 7273 7472 696e  st_read_varstrin
+00010d30: 6728 7365 6c66 293a 0a20 2020 2020 2020  g(self):.       
+00010d40: 2074 6573 745f 7374 7269 6e67 203d 2075   test_string = u
+00010d50: 2253 7472 696e 6773 f09f 9881 e29c 9422  "Strings......."
+00010d60: 0a20 2020 2020 2020 2074 6573 745f 6461  .        test_da
+00010d70: 7461 203d 2062 225c 7830 655c 7830 3053  ta = b"\x0e\x00S
+00010d80: 7472 696e 6773 5c78 6630 5c78 3966 5c78  trings\xf0\x9f\x
+00010d90: 3938 5c78 3831 5c78 6532 5c78 3963 5c78  98\x81\xe2\x9c\x
+00010da0: 3934 220a 0a20 2020 2020 2020 2077 6974  94"..        wit
+00010db0: 6820 4279 7465 7349 4f28 7465 7374 5f64  h BytesIO(test_d
+00010dc0: 6174 6129 2061 7320 6670 3a0a 2020 2020  ata) as fp:.    
+00010dd0: 2020 2020 2020 2020 5555 5420 3d20 5379          UUT = Sy
+00010de0: 6e63 4753 4642 6c6f 636b 2866 7029 0a0a  ncGSFBlock(fp)..
+00010df0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00010e00: 2e61 7373 6572 7445 7175 616c 2874 6573  .assertEqual(tes
+00010e10: 745f 7374 7269 6e67 2c20 5555 542e 7265  t_string, UUT.re
+00010e20: 6164 5f76 6172 7374 7269 6e67 2829 290a  ad_varstring()).
+00010e30: 0a20 2020 2064 6566 2074 6573 745f 7265  .    def test_re
+00010e40: 6164 5f75 7569 6428 7365 6c66 293a 0a20  ad_uuid(self):. 
+00010e50: 2020 2020 2020 2074 6573 745f 7575 6964         test_uuid
+00010e60: 203d 2055 5549 4428 2262 3036 6336 3563   = UUID("b06c65c
+00010e70: 382d 3531 6163 2d34 6164 312d 6138 3339  8-51ac-4ad1-a839
+00010e80: 2d32 6566 3337 3130 3763 6331 3622 290a  -2ef37107cc16").
+00010e90: 2020 2020 2020 2020 7465 7374 5f64 6174          test_dat
+00010ea0: 6120 3d20 6222 5c78 6230 5c78 3663 5c78  a = b"\xb0\x6c\x
+00010eb0: 3635 5c78 6338 5c78 3531 5c78 6163 5c78  65\xc8\x51\xac\x
+00010ec0: 3461 5c78 6431 5c78 6138 5c78 3339 5c78  4a\xd1\xa8\x39\x
+00010ed0: 3265 5c78 6633 5c78 3731 5c78 3037 5c78  2e\xf3\x71\x07\x
+00010ee0: 6363 5c78 3136 220a 0a20 2020 2020 2020  cc\x16"..       
+00010ef0: 2077 6974 6820 4279 7465 7349 4f28 7465   with BytesIO(te
+00010f00: 7374 5f64 6174 6129 2061 7320 6670 3a0a  st_data) as fp:.
+00010f10: 2020 2020 2020 2020 2020 2020 5555 5420              UUT 
+00010f20: 3d20 5379 6e63 4753 4642 6c6f 636b 2866  = SyncGSFBlock(f
+00010f30: 7029 0a0a 2020 2020 2020 2020 2020 2020  p)..            
+00010f40: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+00010f50: 2874 6573 745f 7575 6964 2c20 5555 542e  (test_uuid, UUT.
+00010f60: 7265 6164 5f75 7569 6428 2929 0a0a 2020  read_uuid())..  
+00010f70: 2020 6465 6620 7465 7374 5f72 6561 645f    def test_read_
+00010f80: 6461 7465 7469 6d65 2873 656c 6629 3a0a  datetime(self):.
+00010f90: 2020 2020 2020 2020 7465 7374 5f64 6174          test_dat
+00010fa0: 6574 696d 6520 3d20 6461 7465 7469 6d65  etime = datetime
+00010fb0: 2832 3031 382c 2039 2c20 382c 2031 362c  (2018, 9, 8, 16,
+00010fc0: 2030 2c20 3029 0a20 2020 2020 2020 2074   0, 0).        t
+00010fd0: 6573 745f 6461 7461 203d 2062 225c 7865  est_data = b"\xe
+00010fe0: 325c 7830 375c 7830 395c 7830 385c 7831  2\x07\x09\x08\x1
+00010ff0: 305c 7830 305c 7830 3022 0a0a 2020 2020  0\x00\x00"..    
+00011000: 2020 2020 7769 7468 2042 7974 6573 494f      with BytesIO
+00011010: 2874 6573 745f 6461 7461 2920 6173 2066  (test_data) as f
+00011020: 703a 0a20 2020 2020 2020 2020 2020 2055  p:.            U
+00011030: 5554 203d 2053 796e 6347 5346 426c 6f63  UT = SyncGSFBloc
+00011040: 6b28 6670 290a 0a20 2020 2020 2020 2020  k(fp)..         
+00011050: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+00011060: 7561 6c28 7465 7374 5f64 6174 6574 696d  ual(test_datetim
+00011070: 652c 2055 5554 2e72 6561 645f 6461 7465  e, UUT.read_date
+00011080: 7469 6d65 2829 290a 0a20 2020 2064 6566  time())..    def
+00011090: 2074 6573 745f 7265 6164 5f74 696d 6573   test_read_times
+000110a0: 7461 6d70 5f76 3728 7365 6c66 293a 0a20  tamp_v7(self):. 
+000110b0: 2020 2020 2020 2074 6573 745f 7469 6d65         test_time
+000110c0: 7374 616d 7020 3d20 5469 6d65 7374 616d  stamp = Timestam
+000110d0: 7028 3135 3336 3432 3234 3030 2c20 3530  p(1536422400, 50
+000110e0: 3029 0a20 2020 2020 2020 2074 6573 745f  0).        test_
+000110f0: 6461 7461 203d 2062 225c 7830 305c 7866  data = b"\x00\xf
+00011100: 325c 7839 335c 7835 625c 7830 305c 7830  2\x93\x5b\x00\x0
+00011110: 305c 7866 345c 7830 315c 7830 305c 7830  0\xf4\x01\x00\x0
+00011120: 3022 0a0a 2020 2020 2020 2020 7769 7468  0"..        with
+00011130: 2042 7974 6573 494f 2874 6573 745f 6461   BytesIO(test_da
+00011140: 7461 2920 6173 2066 703a 0a20 2020 2020  ta) as fp:.     
+00011150: 2020 2020 2020 2055 5554 203d 2053 796e         UUT = Syn
+00011160: 6347 5346 426c 6f63 6b28 6670 290a 0a20  cGSFBlock(fp).. 
+00011170: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00011180: 6173 7365 7274 4571 7561 6c28 7465 7374  assertEqual(test
+00011190: 5f74 696d 6573 7461 6d70 2c20 5555 542e  _timestamp, UUT.
+000111a0: 7265 6164 5f74 696d 6573 7461 6d70 5f76  read_timestamp_v
+000111b0: 3728 2929 0a0a 2020 2020 6465 6620 7465  7())..    def te
+000111c0: 7374 5f72 6561 645f 7469 6d65 7374 616d  st_read_timestam
+000111d0: 7028 7365 6c66 293a 0a20 2020 2020 2020  p(self):.       
+000111e0: 2074 6573 745f 7469 6d65 7374 616d 7020   test_timestamp 
+000111f0: 3d20 5469 6d65 7374 616d 7028 3135 3336  = Timestamp(1536
+00011200: 3432 3234 3030 2c20 3530 3029 0a20 2020  422400, 500).   
+00011210: 2020 2020 2074 6573 745f 6461 7461 203d       test_data =
+00011220: 2062 225c 7830 315c 7830 305c 7866 325c   b"\x01\x00\xf2\
+00011230: 7839 335c 7835 625c 7830 305c 7830 305c  x93\x5b\x00\x00\
+00011240: 7866 345c 7830 315c 7830 305c 7830 3022  xf4\x01\x00\x00"
+00011250: 0a0a 2020 2020 2020 2020 7769 7468 2042  ..        with B
+00011260: 7974 6573 494f 2874 6573 745f 6461 7461  ytesIO(test_data
+00011270: 2920 6173 2066 703a 0a20 2020 2020 2020  ) as fp:.       
+00011280: 2020 2020 2055 5554 203d 2053 796e 6347       UUT = SyncG
+00011290: 5346 426c 6f63 6b28 6670 290a 0a20 2020  SFBlock(fp)..   
+000112a0: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
+000112b0: 7365 7274 4571 7561 6c28 7465 7374 5f74  sertEqual(test_t
+000112c0: 696d 6573 7461 6d70 2c20 5555 542e 7265  imestamp, UUT.re
+000112d0: 6164 5f74 696d 6573 7461 6d70 2829 290a  ad_timestamp()).
+000112e0: 0a20 2020 2064 6566 2074 6573 745f 7265  .    def test_re
+000112f0: 6164 5f74 696d 6573 7461 6d70 5f5f 6e65  ad_timestamp__ne
+00011300: 6761 7469 7665 2873 656c 6629 3a0a 2020  gative(self):.  
+00011310: 2020 2020 2020 7465 7374 5f74 696d 6573        test_times
+00011320: 7461 6d70 203d 2054 696d 6573 7461 6d70  tamp = Timestamp
+00011330: 2831 3533 3634 3232 3430 302c 2035 3030  (1536422400, 500
+00011340: 2c20 2d31 290a 2020 2020 2020 2020 7465  , -1).        te
+00011350: 7374 5f64 6174 6120 3d20 6222 5c78 3030  st_data = b"\x00
+00011360: 5c78 3030 5c78 6632 5c78 3933 5c78 3562  \x00\xf2\x93\x5b
+00011370: 5c78 3030 5c78 3030 5c78 6634 5c78 3031  \x00\x00\xf4\x01
+00011380: 5c78 3030 5c78 3030 220a 0a20 2020 2020  \x00\x00"..     
+00011390: 2020 2077 6974 6820 4279 7465 7349 4f28     with BytesIO(
+000113a0: 7465 7374 5f64 6174 6129 2061 7320 6670  test_data) as fp
+000113b0: 3a0a 2020 2020 2020 2020 2020 2020 5555  :.            UU
+000113c0: 5420 3d20 5379 6e63 4753 4642 6c6f 636b  T = SyncGSFBlock
+000113d0: 2866 7029 0a0a 2020 2020 2020 2020 2020  (fp)..          
+000113e0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+000113f0: 616c 2874 6573 745f 7469 6d65 7374 616d  al(test_timestam
+00011400: 702c 2055 5554 2e72 6561 645f 7469 6d65  p, UUT.read_time
+00011410: 7374 616d 7028 2929 0a0a 2020 2020 6465  stamp())..    de
+00011420: 6620 7465 7374 5f72 6561 645f 7261 7469  f test_read_rati
+00011430: 6f6e 616c 2873 656c 6629 3a0a 2020 2020  onal(self):.    
+00011440: 2020 2020 7465 7374 5f66 7261 6374 696f      test_fractio
+00011450: 6e20 3d20 4672 6163 7469 6f6e 2834 2c20  n = Fraction(4, 
+00011460: 3329 0a20 2020 2020 2020 2074 6573 745f  3).        test_
+00011470: 6461 7461 203d 2062 225c 7830 345c 7830  data = b"\x04\x0
+00011480: 305c 7830 305c 7830 305c 7830 335c 7830  0\x00\x00\x03\x0
+00011490: 305c 7830 305c 7830 3022 0a0a 2020 2020  0\x00\x00"..    
+000114a0: 2020 2020 7769 7468 2042 7974 6573 494f      with BytesIO
+000114b0: 2874 6573 745f 6461 7461 2920 6173 2066  (test_data) as f
+000114c0: 703a 0a20 2020 2020 2020 2020 2020 2055  p:.            U
+000114d0: 5554 203d 2053 796e 6347 5346 426c 6f63  UT = SyncGSFBloc
+000114e0: 6b28 6670 290a 0a20 2020 2020 2020 2020  k(fp)..         
+000114f0: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+00011500: 7561 6c28 7465 7374 5f66 7261 6374 696f  ual(test_fractio
+00011510: 6e2c 2055 5554 2e72 6561 645f 7261 7469  n, UUT.read_rati
+00011520: 6f6e 616c 2829 290a 0a20 2020 2064 6566  onal())..    def
+00011530: 2074 6573 745f 7265 6164 5f72 6174 696f   test_read_ratio
+00011540: 6e61 6c5f 7a65 726f 5f64 656e 6f6d 696e  nal_zero_denomin
+00011550: 6174 6f72 2873 656c 6629 3a0a 2020 2020  ator(self):.    
+00011560: 2020 2020 2222 2245 6e73 7572 6520 7468      """Ensure th
+00011570: 6520 7265 6164 6572 2063 6f6e 7369 6465  e reader conside
+00011580: 7273 2061 2052 6174 696f 6e61 6c20 7769  rs a Rational wi
+00011590: 7468 207a 6572 6f20 6465 6e6f 6d69 6e61  th zero denomina
+000115a0: 746f 7220 746f 2062 6520 302c 206e 6f74  tor to be 0, not
+000115b0: 2061 6e20 6572 726f 7222 2222 0a20 2020   an error""".   
+000115c0: 2020 2020 2074 6573 745f 6461 7461 203d       test_data =
+000115d0: 2062 225c 7830 345c 7830 305c 7830 305c   b"\x04\x00\x00\
+000115e0: 7830 305c 7830 305c 7830 305c 7830 305c  x00\x00\x00\x00\
+000115f0: 7830 3022 0a0a 2020 2020 2020 2020 7769  x00"..        wi
+00011600: 7468 2042 7974 6573 494f 2874 6573 745f  th BytesIO(test_
+00011610: 6461 7461 2920 6173 2066 703a 0a20 2020  data) as fp:.   
+00011620: 2020 2020 2020 2020 2055 5554 203d 2053           UUT = S
+00011630: 796e 6347 5346 426c 6f63 6b28 6670 290a  yncGSFBlock(fp).
+00011640: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00011650: 662e 6173 7365 7274 4571 7561 6c28 4672  f.assertEqual(Fr
+00011660: 6163 7469 6f6e 2830 292c 2055 5554 2e72  action(0), UUT.r
+00011670: 6561 645f 7261 7469 6f6e 616c 2829 290a  ead_rational()).
+00011680: 0a20 2020 2064 6566 2074 6573 745f 7265  .    def test_re
+00011690: 6164 5f76 6172 6279 7465 7328 7365 6c66  ad_varbytes(self
+000116a0: 293a 0a20 2020 2020 2020 2074 6573 745f  ):.        test_
+000116b0: 6279 7465 7320 3d20 6227 7b22 7465 7374  bytes = b'{"test
+000116c0: 227d 270a 2020 2020 2020 2020 7465 7374  "}'.        test
+000116d0: 5f64 6174 6120 3d20 6227 5c78 3038 5c78  _data = b'\x08\x
+000116e0: 3030 5c78 3030 5c78 3030 7b22 7465 7374  00\x00\x00{"test
+000116f0: 227d 270a 0a20 2020 2020 2020 2077 6974  "}'..        wit
+00011700: 6820 4279 7465 7349 4f28 7465 7374 5f64  h BytesIO(test_d
+00011710: 6174 6129 2061 7320 6670 3a0a 2020 2020  ata) as fp:.    
+00011720: 2020 2020 2020 2020 5555 5420 3d20 5379          UUT = Sy
+00011730: 6e63 4753 4642 6c6f 636b 2866 7029 0a0a  ncGSFBlock(fp)..
+00011740: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00011750: 2e61 7373 6572 7445 7175 616c 2874 6573  .assertEqual(tes
+00011760: 745f 6279 7465 732c 2055 5554 2e72 6561  t_bytes, UUT.rea
+00011770: 645f 7661 7262 7974 6573 2829 290a 0a20  d_varbytes()).. 
+00011780: 2020 2064 6566 2074 6573 745f 7265 6164     def test_read
+00011790: 5f75 696e 745f 7061 7374 5f65 6f66 2873  _uint_past_eof(s
+000117a0: 656c 6629 3a0a 2020 2020 2020 2020 2222  elf):.        ""
+000117b0: 2272 6561 645f 7569 6e74 2063 616c 6c73  "read_uint calls
+000117c0: 2072 6561 6428 2920 6469 7265 6374 6c79   read() directly
+000117d0: 202d 2074 6573 7420 6974 2072 6169 7365   - test it raise
+000117e0: 7320 454f 4645 7272 6f72 2063 6f72 7265  s EOFError corre
+000117f0: 6374 6c79 2222 220a 2020 2020 2020 2020  ctly""".        
+00011800: 7465 7374 5f64 6174 6120 3d20 6222 5c78  test_data = b"\x
+00011810: 3034 5c78 3030 220a 0a20 2020 2020 2020  04\x00"..       
+00011820: 2077 6974 6820 4279 7465 7349 4f28 7465   with BytesIO(te
+00011830: 7374 5f64 6174 6129 2061 7320 6670 3a0a  st_data) as fp:.
+00011840: 2020 2020 2020 2020 2020 2020 5555 5420              UUT 
+00011850: 3d20 5379 6e63 4753 4642 6c6f 636b 2866  = SyncGSFBlock(f
+00011860: 7029 0a0a 2020 2020 2020 2020 2020 2020  p)..            
+00011870: 7769 7468 2073 656c 662e 6173 7365 7274  with self.assert
+00011880: 5261 6973 6573 2845 4f46 4572 726f 7229  Raises(EOFError)
+00011890: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000118a0: 2020 5555 542e 7265 6164 5f75 696e 7428    UUT.read_uint(
+000118b0: 3429 0a0a 2020 2020 6465 6620 7465 7374  4)..    def test
+000118c0: 5f72 6561 645f 7374 7269 6e67 5f70 6173  _read_string_pas
+000118d0: 745f 656f 6628 7365 6c66 293a 0a20 2020  t_eof(self):.   
+000118e0: 2020 2020 2022 2222 7265 6164 5f73 7472       """read_str
+000118f0: 696e 6728 2920 6361 6c6c 7320 7265 6164  ing() calls read
+00011900: 2829 2064 6972 6563 746c 7920 2d20 7465  () directly - te
+00011910: 7374 2069 7420 7261 6973 6573 2045 4f46  st it raises EOF
+00011920: 4572 726f 7220 636f 7272 6563 746c 7922  Error correctly"
+00011930: 2222 0a20 2020 2020 2020 2074 6573 745f  "".        test_
+00011940: 6461 7461 203d 2062 2253 7472 696e 220a  data = b"Strin".
+00011950: 0a20 2020 2020 2020 2077 6974 6820 4279  .        with By
+00011960: 7465 7349 4f28 7465 7374 5f64 6174 6129  tesIO(test_data)
+00011970: 2061 7320 6670 3a0a 2020 2020 2020 2020   as fp:.        
+00011980: 2020 2020 5555 5420 3d20 5379 6e63 4753      UUT = SyncGS
+00011990: 4642 6c6f 636b 2866 7029 0a0a 2020 2020  FBlock(fp)..    
+000119a0: 2020 2020 2020 2020 7769 7468 2073 656c          with sel
+000119b0: 662e 6173 7365 7274 5261 6973 6573 2845  f.assertRaises(E
+000119c0: 4f46 4572 726f 7229 3a0a 2020 2020 2020  OFError):.      
+000119d0: 2020 2020 2020 2020 2020 5555 542e 7265            UUT.re
+000119e0: 6164 5f73 7472 696e 6728 3629 0a0a 2020  ad_string(6)..  
+000119f0: 2020 6465 6620 7465 7374 5f72 6561 645f    def test_read_
+00011a00: 7575 6964 5f70 6173 745f 656f 6628 7365  uuid_past_eof(se
+00011a10: 6c66 293a 0a20 2020 2020 2020 2022 2222  lf):.        """
+00011a20: 7265 6164 5f75 7569 6428 2920 6361 6c6c  read_uuid() call
+00011a30: 7320 7265 6164 2829 2064 6972 6563 746c  s read() directl
+00011a40: 7920 2d20 7465 7374 2069 7420 7261 6973  y - test it rais
+00011a50: 6573 2045 4f46 4572 726f 7220 636f 7272  es EOFError corr
+00011a60: 6563 746c 7922 2222 0a20 2020 2020 2020  ectly""".       
+00011a70: 2074 6573 745f 6461 7461 203d 2062 225c   test_data = b"\
+00011a80: 7862 305c 7836 635c 7836 355c 7863 385c  xb0\x6c\x65\xc8\
+00011a90: 7835 315c 7861 635c 7834 615c 7864 315c  x51\xac\x4a\xd1\
+00011aa0: 7861 385c 7833 395c 7832 6522 0a0a 2020  xa8\x39\x2e"..  
+00011ab0: 2020 2020 2020 7769 7468 2042 7974 6573        with Bytes
+00011ac0: 494f 2874 6573 745f 6461 7461 2920 6173  IO(test_data) as
+00011ad0: 2066 703a 0a20 2020 2020 2020 2020 2020   fp:.           
+00011ae0: 2055 5554 203d 2053 796e 6347 5346 426c   UUT = SyncGSFBl
+00011af0: 6f63 6b28 6670 290a 0a20 2020 2020 2020  ock(fp)..       
+00011b00: 2020 2020 2077 6974 6820 7365 6c66 2e61       with self.a
+00011b10: 7373 6572 7452 6169 7365 7328 454f 4645  ssertRaises(EOFE
+00011b20: 7272 6f72 293a 0a20 2020 2020 2020 2020  rror):.         
+00011b30: 2020 2020 2020 2055 5554 2e72 6561 645f         UUT.read_
+00011b40: 7575 6964 2829 0a0a 2020 2020 6465 6620  uuid()..    def 
+00011b50: 5f6d 616b 655f 7361 6d70 6c65 5f73 7472  _make_sample_str
+00011b60: 6561 6d28 7365 6c66 2c20 706f 7374 5f63  eam(self, post_c
+00011b70: 6869 6c64 5f6c 656e 3d30 293a 0a20 2020  hild_len=0):.   
+00011b80: 2020 2020 2022 2222 4765 6e65 7261 7465       """Generate
+00011b90: 2061 2073 7472 6561 6d20 6f66 2073 616d   a stream of sam
+00011ba0: 706c 6520 626c 6f63 6b73 2066 6f72 2074  ple blocks for t
+00011bb0: 6573 7469 6e67 2074 6865 2063 6f6e 7465  esting the conte
+00011bc0: 7874 206d 616e 6167 6572 0a0a 2020 2020  xt manager..    
+00011bd0: 2020 2020 5374 7275 6374 7572 6520 6c6f      Structure lo
+00011be0: 6f6b 7320 6c69 6b65 3a0a 2020 2020 2020  oks like:.      
+00011bf0: 2020 626c 6f6b 2028 3238 2062 7974 6573    blok (28 bytes
+00011c00: 202b 2070 6f73 745f 6368 696c 645f 6c65   + post_child_le
+00011c10: 6e29 0a20 2020 2020 2020 2020 2063 6869  n).          chi
+00011c20: 6c20 2831 3220 6279 7465 7329 0a20 2020  l (12 bytes).   
+00011c30: 2020 2020 2020 2063 6869 6c20 2838 2062         chil (8 b
+00011c40: 7974 6573 290a 2020 2020 2020 2020 2020  ytes).          
+00011c50: 6070 6f73 745f 6368 696c 645f 6c65 6e60  `post_child_len`
+00011c60: 2061 6464 6974 696f 6e61 6c20 6279 7465   additional byte
+00011c70: 7320 6f66 2064 6174 610a 2020 2020 2020  s of data.      
+00011c80: 2020 626c 6f6b 2028 3820 6279 7465 7329    blok (8 bytes)
+00011c90: 0a0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
+00011ca0: 2070 6f73 745f 6368 696c 645f 6c65 6e3a   post_child_len:
+00011cb0: 204e 756d 6265 7220 6f66 2062 7974 6573   Number of bytes
+00011cc0: 2074 6f20 696e 636c 7564 6520 6166 7465   to include afte
+00011cd0: 7220 6c61 7374 2063 6869 6c64 2062 6c6f  r last child blo
+00011ce0: 636b 202d 206d 7573 7420 6265 203c 3235  ck - must be <25
+00011cf0: 360a 2020 2020 2020 2020 3a72 6574 7572  6.        :retur
+00011d00: 6e73 3a20 4173 796e 6342 7974 6573 494f  ns: AsyncBytesIO
+00011d10: 2063 6f6e 7461 696e 696e 6720 736f 6d65   containing some
+00011d20: 2062 6c6f 636b 730a 2020 2020 2020 2020   blocks.        
+00011d30: 2222 220a 2020 2020 2020 2020 6669 7273  """.        firs
+00011d40: 745f 626c 6f63 6b5f 6c65 6e67 7468 203d  t_block_length =
+00011d50: 2032 3820 2b20 706f 7374 5f63 6869 6c64   28 + post_child
+00011d60: 5f6c 656e 0a20 2020 2020 2020 2074 6573  _len.        tes
+00011d70: 745f 7374 7265 616d 203d 2042 7974 6573  t_stream = Bytes
+00011d80: 494f 2829 0a0a 2020 2020 2020 2020 7465  IO()..        te
+00011d90: 7374 5f73 7472 6561 6d2e 7772 6974 6528  st_stream.write(
+00011da0: 6222 626c 6f6b 2229 0a20 2020 2020 2020  b"blok").       
+00011db0: 2074 6573 745f 7374 7265 616d 2e77 7269   test_stream.wri
+00011dc0: 7465 2862 7974 6573 2828 6669 7273 745f  te(bytes((first_
+00011dd0: 626c 6f63 6b5f 6c65 6e67 7468 2c29 2929  block_length,)))
+00011de0: 0a20 2020 2020 2020 2074 6573 745f 7374  .        test_st
+00011df0: 7265 616d 2e77 7269 7465 2862 225c 7830  ream.write(b"\x0
+00011e00: 305c 7830 305c 7830 3022 290a 2020 2020  0\x00\x00").    
+00011e10: 2020 2020 7465 7374 5f73 7472 6561 6d2e      test_stream.
+00011e20: 7772 6974 6528 6222 6368 696c 5c78 3063  write(b"chil\x0c
+00011e30: 5c78 3030 5c78 3030 5c78 3030 5c78 3038  \x00\x00\x00\x08
+00011e40: 5c78 3039 5c78 3061 5c78 3062 2229 0a20  \x09\x0a\x0b"). 
+00011e50: 2020 2020 2020 2074 6573 745f 7374 7265         test_stre
+00011e60: 616d 2e77 7269 7465 2862 2263 6869 6c5c  am.write(b"chil\
+00011e70: 7830 385c 7830 305c 7830 305c 7830 3022  x08\x00\x00\x00"
+00011e80: 290a 0a20 2020 2020 2020 2066 6f72 2069  )..        for i
+00011e90: 2069 6e20 7261 6e67 6528 302c 2070 6f73   in range(0, pos
+00011ea0: 745f 6368 696c 645f 6c65 6e29 3a0a 2020  t_child_len):.  
+00011eb0: 2020 2020 2020 2020 2020 7465 7374 5f73            test_s
+00011ec0: 7472 6561 6d2e 7772 6974 6528 6222 5c78  tream.write(b"\x
+00011ed0: 3432 2229 0a0a 2020 2020 2020 2020 7465  42")..        te
+00011ee0: 7374 5f73 7472 6561 6d2e 7772 6974 6528  st_stream.write(
+00011ef0: 6222 626c 6b32 5c78 3038 5c78 3030 5c78  b"blk2\x08\x00\x
+00011f00: 3030 5c78 3030 2229 0a0a 2020 2020 2020  00\x00")..      
+00011f10: 2020 7465 7374 5f73 7472 6561 6d2e 7365    test_stream.se
+00011f20: 656b 2830 2c20 5345 454b 5f53 4554 290a  ek(0, SEEK_SET).
+00011f30: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00011f40: 4173 796e 6342 7974 6573 494f 2874 6573  AsyncBytesIO(tes
+00011f50: 745f 7374 7265 616d 2e67 6574 7661 6c75  t_stream.getvalu
+00011f60: 6528 2929 0a0a 2020 2020 6173 796e 6320  e())..    async 
+00011f70: 6465 6620 7465 7374 5f62 6c6f 636b 5f73  def test_block_s
+00011f80: 7461 7274 5f72 6563 6f72 6465 6428 7365  tart_recorded(se
+00011f90: 6c66 293a 0a20 2020 2020 2020 2022 2222  lf):.        """
+00011fa0: 5465 7374 2074 6861 7420 6120 4173 796e  Test that a Asyn
+00011fb0: 6347 5346 426c 6f63 6b20 7265 636f 7264  cGSFBlock record
+00011fc0: 7320 7468 6520 626c 6f63 6b20 7374 6172  s the block star
+00011fd0: 7420 706f 696e 7422 2222 0a20 2020 2020  t point""".     
+00011fe0: 2020 2061 7379 6e63 2077 6974 6820 7365     async with se
+00011ff0: 6c66 2e5f 6d61 6b65 5f73 616d 706c 655f  lf._make_sample_
+00012000: 7374 7265 616d 2829 2061 7320 7465 7374  stream() as test
+00012010: 5f73 7472 6561 6d3a 0a20 2020 2020 2020  _stream:.       
+00012020: 2020 2020 2074 6573 745f 7374 7265 616d       test_stream
+00012030: 2e73 6565 6b28 3238 2c20 5345 454b 5f53  .seek(28, SEEK_S
+00012040: 4554 290a 0a20 2020 2020 2020 2020 2020  ET)..           
+00012050: 2055 5554 203d 2041 7379 6e63 4753 4642   UUT = AsyncGSFB
+00012060: 6c6f 636b 2874 6573 745f 7374 7265 616d  lock(test_stream
+00012070: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+00012080: 6c66 2e61 7373 6572 7445 7175 616c 2832  lf.assertEqual(2
+00012090: 382c 2055 5554 2e62 6c6f 636b 5f73 7461  8, UUT.block_sta
+000120a0: 7274 290a 0a20 2020 2061 7379 6e63 2064  rt)..    async d
+000120b0: 6566 2074 6573 745f 636f 6e74 6578 746d  ef test_contextm
+000120c0: 616e 6167 6572 5f72 6561 645f 7461 675f  anager_read_tag_
+000120d0: 7369 7a65 2873 656c 6629 3a0a 2020 2020  size(self):.    
+000120e0: 2020 2020 2222 2254 6573 7420 7468 6174      """Test that
+000120f0: 2074 6865 2062 6c6f 636b 2074 6167 2061   the block tag a
+00012100: 6e64 2073 697a 6520 6172 6520 7265 6164  nd size are read
+00012110: 2077 6865 6e20 7573 6564 2069 6e20 6120   when used in a 
+00012120: 636f 6e74 6578 7420 6d61 6e61 6765 7222  context manager"
+00012130: 2222 0a20 2020 2020 2020 2061 7379 6e63  "".        async
+00012140: 2077 6974 6820 7365 6c66 2e5f 6d61 6b65   with self._make
+00012150: 5f73 616d 706c 655f 7374 7265 616d 2829  _sample_stream()
+00012160: 2061 7320 7465 7374 5f73 7472 6561 6d3a   as test_stream:
+00012170: 0a20 2020 2020 2020 2020 2020 2061 7379  .            asy
+00012180: 6e63 2077 6974 6820 4173 796e 6347 5346  nc with AsyncGSF
+00012190: 426c 6f63 6b28 7465 7374 5f73 7472 6561  Block(test_strea
+000121a0: 6d29 2061 7320 5555 543a 0a20 2020 2020  m) as UUT:.     
+000121b0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+000121c0: 6173 7365 7274 4571 7561 6c28 2262 6c6f  assertEqual("blo
+000121d0: 6b22 2c20 5555 542e 7461 6729 0a20 2020  k", UUT.tag).   
+000121e0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+000121f0: 662e 6173 7365 7274 4571 7561 6c28 3238  f.assertEqual(28
+00012200: 2c20 5555 542e 7369 7a65 290a 0a20 2020  , UUT.size)..   
+00012210: 2061 7379 6e63 2064 6566 2074 6573 745f   async def test_
+00012220: 636f 6e74 6578 746d 616e 6167 6572 5f73  contextmanager_s
+00012230: 6b69 7073 5f75 6e77 616e 7465 645f 626c  kips_unwanted_bl
+00012240: 6f63 6b73 2873 656c 6629 3a0a 2020 2020  ocks(self):.    
+00012250: 2020 2020 2222 2254 6573 7420 7468 6174      """Test that
+00012260: 2041 7379 6e63 4753 4642 6c6f 636b 2829   AsyncGSFBlock()
+00012270: 2073 6565 6b73 206f 7665 7220 756e 7761   seeks over unwa
+00012280: 6e74 6564 2062 6c6f 636b 7322 2222 0a20  nted blocks""". 
+00012290: 2020 2020 2020 2061 7379 6e63 2077 6974         async wit
+000122a0: 6820 7365 6c66 2e5f 6d61 6b65 5f73 616d  h self._make_sam
+000122b0: 706c 655f 7374 7265 616d 2829 2061 7320  ple_stream() as 
+000122c0: 7465 7374 5f73 7472 6561 6d3a 0a20 2020  test_stream:.   
+000122d0: 2020 2020 2020 2020 2061 7379 6e63 2077           async w
+000122e0: 6974 6820 4173 796e 6347 5346 426c 6f63  ith AsyncGSFBloc
+000122f0: 6b28 7465 7374 5f73 7472 6561 6d2c 2077  k(test_stream, w
+00012300: 616e 745f 7461 673d 2262 6c6b 3222 2920  ant_tag="blk2") 
+00012310: 6173 2055 5554 3a0a 2020 2020 2020 2020  as UUT:.        
+00012320: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+00012330: 6572 7445 7175 616c 2822 626c 6b32 222c  ertEqual("blk2",
+00012340: 2055 5554 2e74 6167 290a 0a20 2020 2020   UUT.tag)..     
+00012350: 2020 2020 2020 2020 2020 2023 2062 6c6f             # blo
+00012360: 6b20 6973 2032 3820 6279 7465 7320 6c6f  k is 28 bytes lo
+00012370: 6e67 2c20 7765 2073 686f 756c 6420 736b  ng, we should sk
+00012380: 6970 2069 742c 2070 6c75 7320 3820 6279  ip it, plus 8 by
+00012390: 7465 7320 6f66 2062 6c6b 320a 2020 2020  tes of blk2.    
+000123a0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000123b0: 2e61 7373 6572 7445 7175 616c 2832 3820  .assertEqual(28 
+000123c0: 2b20 382c 2074 6573 745f 7374 7265 616d  + 8, test_stream
+000123d0: 2e74 656c 6c28 2929 0a0a 2020 2020 6173  .tell())..    as
+000123e0: 796e 6320 6465 6620 7465 7374 5f63 6f6e  ync def test_con
+000123f0: 7465 7874 6d61 6e61 6765 725f 6572 726f  textmanager_erro
+00012400: 7273 5f75 6e77 616e 7465 645f 626c 6f63  rs_unwanted_bloc
+00012410: 6b73 2873 656c 6629 3a0a 2020 2020 2020  ks(self):.      
+00012420: 2020 2222 2254 6573 7420 7468 6174 2041    """Test that A
+00012430: 7379 6e63 4753 4642 6c6f 636b 2829 2072  syncGSFBlock() r
+00012440: 6169 7365 7320 4753 4644 6563 6f64 6545  aises GSFDecodeE
+00012450: 7272 6f72 2077 6865 6e20 6669 6e64 696e  rror when findin
+00012460: 6720 616e 2075 6e77 616e 7465 6420 626c  g an unwanted bl
+00012470: 6f63 6b22 2222 0a20 2020 2020 2020 2061  ock""".        a
+00012480: 7379 6e63 2077 6974 6820 7365 6c66 2e5f  sync with self._
+00012490: 6d61 6b65 5f73 616d 706c 655f 7374 7265  make_sample_stre
+000124a0: 616d 2829 2061 7320 7465 7374 5f73 7472  am() as test_str
+000124b0: 6561 6d3a 0a20 2020 2020 2020 2020 2020  eam:.           
+000124c0: 2077 6974 6820 7365 6c66 2e61 7373 6572   with self.asser
+000124d0: 7452 6169 7365 7328 4753 4644 6563 6f64  tRaises(GSFDecod
+000124e0: 6545 7272 6f72 293a 0a20 2020 2020 2020  eError):.       
+000124f0: 2020 2020 2020 2020 2061 7379 6e63 2077           async w
+00012500: 6974 6820 4173 796e 6347 5346 426c 6f63  ith AsyncGSFBloc
+00012510: 6b28 7465 7374 5f73 7472 6561 6d2c 2077  k(test_stream, w
+00012520: 616e 745f 7461 673d 2263 6869 6c22 2c20  ant_tag="chil", 
+00012530: 7261 6973 655f 6f6e 5f77 726f 6e67 5f74  raise_on_wrong_t
+00012540: 6167 3d54 7275 6529 3a0a 2020 2020 2020  ag=True):.      
+00012550: 2020 2020 2020 2020 2020 2020 2020 7061                pa
+00012560: 7373 0a0a 2020 2020 6173 796e 6320 6465  ss..    async de
+00012570: 6620 7465 7374 5f63 6f6e 7465 7874 6d61  f test_contextma
+00012580: 6e61 6765 725f 7365 656b 735f 6f6e 5f65  nager_seeks_on_e
+00012590: 7869 7428 7365 6c66 293a 0a20 2020 2020  xit(self):.     
+000125a0: 2020 2022 2222 5465 7374 2074 6861 7420     """Test that 
+000125b0: 7468 6520 636f 6e74 6578 7420 6d61 6e61  the context mana
+000125c0: 6765 7220 7365 656b 7320 746f 2074 6865  ger seeks to the
+000125d0: 2065 6e64 206f 6620 6120 626c 6f63 6b20   end of a block 
+000125e0: 6f6e 2065 7869 7422 2222 0a20 2020 2020  on exit""".     
+000125f0: 2020 2061 7379 6e63 2077 6974 6820 7365     async with se
+00012600: 6c66 2e5f 6d61 6b65 5f73 616d 706c 655f  lf._make_sample_
+00012610: 7374 7265 616d 2829 2061 7320 7465 7374  stream() as test
+00012620: 5f73 7472 6561 6d3a 0a20 2020 2020 2020  _stream:.       
+00012630: 2020 2020 2061 7379 6e63 2077 6974 6820       async with 
+00012640: 4173 796e 6347 5346 426c 6f63 6b28 7465  AsyncGSFBlock(te
+00012650: 7374 5f73 7472 6561 6d29 3a0a 2020 2020  st_stream):.    
+00012660: 2020 2020 2020 2020 2020 2020 7061 7373              pass
+00012670: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+00012680: 4669 7273 7420 626c 6f63 6b20 6973 2032  First block is 2
+00012690: 3820 6279 7465 7320 6c6f 6e67 2c20 736f  8 bytes long, so
+000126a0: 2077 6520 7368 6f75 6c64 2062 6520 7a65   we should be ze
+000126b0: 726f 2d69 6e64 6578 2070 6f73 6974 696f  ro-index positio
+000126c0: 6e20 3238 2061 6674 6572 7761 7264 730a  n 28 afterwards.
+000126d0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000126e0: 2e61 7373 6572 7445 7175 616c 2832 382c  .assertEqual(28,
+000126f0: 2074 6573 745f 7374 7265 616d 2e74 656c   test_stream.tel
+00012700: 6c28 2929 0a0a 2020 2020 6173 796e 6320  l())..    async 
+00012710: 6465 6620 7465 7374 5f63 6f6e 7465 7874  def test_context
+00012720: 6d61 6e61 6765 725f 6765 745f 7265 6d61  manager_get_rema
+00012730: 696e 696e 6728 7365 6c66 293a 0a20 2020  ining(self):.   
+00012740: 2020 2020 2022 2222 5465 7374 2074 6865       """Test the
+00012750: 2063 6f6e 7465 7874 206d 616e 6167 6572   context manager
+00012760: 2067 6574 7320 7468 6520 6e75 6d62 6572   gets the number
+00012770: 206f 6620 6279 7465 7320 6c65 6674 2069   of bytes left i
+00012780: 6e20 7468 6520 626c 6f63 6b20 636f 7272  n the block corr
+00012790: 6563 746c 7922 2222 0a20 2020 2020 2020  ectly""".       
+000127a0: 2061 7379 6e63 2077 6974 6820 7365 6c66   async with self
+000127b0: 2e5f 6d61 6b65 5f73 616d 706c 655f 7374  ._make_sample_st
+000127c0: 7265 616d 2829 2061 7320 7465 7374 5f73  ream() as test_s
+000127d0: 7472 6561 6d3a 0a20 2020 2020 2020 2020  tream:.         
+000127e0: 2020 2061 7379 6e63 2077 6974 6820 4173     async with As
+000127f0: 796e 6347 5346 426c 6f63 6b28 7465 7374  yncGSFBlock(test
+00012800: 5f73 7472 6561 6d29 2061 7320 5555 543a  _stream) as UUT:
+00012810: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00012820: 2061 7761 6974 2055 5554 2e72 6561 645f   await UUT.read_
+00012830: 7569 6e74 2834 2920 2023 2055 7365 2061  uint(4)  # Use a
+00012840: 2072 6561 6420 746f 2073 6b69 7020 6168   read to skip ah
+00012850: 6561 6420 6120 6269 740a 2020 2020 2020  ead a bit.      
+00012860: 2020 2020 2020 2020 2020 2320 426c 6f63            # Bloc
+00012870: 6b20 7761 7320 3238 2062 7974 6573 2c20  k was 28 bytes, 
+00012880: 3820 6279 7465 7320 6865 6164 6572 2c20  8 bytes header, 
+00012890: 3420 6279 7465 7320 7265 6164 5f75 696e  4 bytes read_uin
+000128a0: 740a 2020 2020 2020 2020 2020 2020 2020  t.              
+000128b0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+000128c0: 616c 2832 3820 2d20 3820 2d20 342c 2055  al(28 - 8 - 4, U
+000128d0: 5554 2e67 6574 5f72 656d 6169 6e69 6e67  UT.get_remaining
+000128e0: 2829 290a 0a20 2020 2061 7379 6e63 2064  ())..    async d
+000128f0: 6566 2074 6573 745f 636f 6e74 6578 746d  ef test_contextm
+00012900: 616e 6167 6572 5f68 6173 5f63 6869 6c64  anager_has_child
+00012910: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+00012920: 2222 2254 6573 7420 7468 6520 636f 6e74  """Test the cont
+00012930: 6578 7420 6d61 6e61 6765 7220 6465 7465  ext manager dete
+00012940: 6374 7320 7768 6574 6865 7220 616e 6f74  cts whether anot
+00012950: 6865 7220 6368 696c 6420 6973 2070 7265  her child is pre
+00012960: 7365 6e74 2063 6f72 7265 6374 6c79 2222  sent correctly""
+00012970: 220a 2020 2020 2020 2020 6173 796e 6320  ".        async 
+00012980: 7769 7468 2073 656c 662e 5f6d 616b 655f  with self._make_
+00012990: 7361 6d70 6c65 5f73 7472 6561 6d28 2920  sample_stream() 
+000129a0: 6173 2074 6573 745f 7374 7265 616d 3a0a  as test_stream:.
+000129b0: 2020 2020 2020 2020 2020 2020 6173 796e              asyn
+000129c0: 6320 7769 7468 2041 7379 6e63 4753 4642  c with AsyncGSFB
+000129d0: 6c6f 636b 2874 6573 745f 7374 7265 616d  lock(test_stream
+000129e0: 2920 6173 2055 5554 3a0a 2020 2020 2020  ) as UUT:.      
+000129f0: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+00012a00: 7373 6572 7454 7275 6528 5555 542e 6861  ssertTrue(UUT.ha
+00012a10: 735f 6368 696c 645f 626c 6f63 6b28 2929  s_child_block())
+00012a20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00012a30: 2061 7761 6974 2074 6573 745f 7374 7265   await test_stre
+00012a40: 616d 2e72 6561 6428 3132 290a 2020 2020  am.read(12).    
+00012a50: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00012a60: 2e61 7373 6572 7454 7275 6528 5555 542e  .assertTrue(UUT.
+00012a70: 6861 735f 6368 696c 645f 626c 6f63 6b28  has_child_block(
+00012a80: 2929 0a20 2020 2020 2020 2020 2020 2020  )).             
+00012a90: 2020 2061 7761 6974 2074 6573 745f 7374     await test_st
+00012aa0: 7265 616d 2e72 6561 6428 3829 0a20 2020  ream.read(8).   
+00012ab0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00012ac0: 662e 6173 7365 7274 4661 6c73 6528 5555  f.assertFalse(UU
+00012ad0: 542e 6861 735f 6368 696c 645f 626c 6f63  T.has_child_bloc
+00012ae0: 6b28 2929 0a0a 2020 2020 6173 796e 6320  k())..    async 
+00012af0: 6465 6620 7465 7374 5f63 6f6e 7465 7874  def test_context
+00012b00: 6d61 6e61 6765 725f 6861 735f 6368 696c  manager_has_chil
+00012b10: 645f 7374 7269 6374 5f62 6c6f 636b 7328  d_strict_blocks(
+00012b20: 7365 6c66 293a 0a20 2020 2020 2020 2022  self):.        "
+00012b30: 2222 456e 7375 7265 2074 6861 7420 7768  ""Ensure that wh
+00012b40: 656e 2073 7472 6963 7420 6d6f 6465 2069  en strict mode i
+00012b50: 7320 656e 6162 6c65 642c 2068 6173 5f63  s enabled, has_c
+00012b60: 6869 6c64 2065 7272 6f72 7320 6f6e 2070  hild errors on p
+00012b70: 6172 7469 616c 2062 6c6f 636b 7322 2222  artial blocks"""
+00012b80: 0a20 2020 2020 2020 2061 7379 6e63 2077  .        async w
+00012b90: 6974 6820 7365 6c66 2e5f 6d61 6b65 5f73  ith self._make_s
+00012ba0: 616d 706c 655f 7374 7265 616d 2870 6f73  ample_stream(pos
+00012bb0: 745f 6368 696c 645f 6c65 6e3d 3429 2061  t_child_len=4) a
+00012bc0: 7320 7465 7374 5f73 7472 6561 6d3a 0a20  s test_stream:. 
+00012bd0: 2020 2020 2020 2020 2020 2061 7379 6e63             async
+00012be0: 2077 6974 6820 4173 796e 6347 5346 426c   with AsyncGSFBl
+00012bf0: 6f63 6b28 7465 7374 5f73 7472 6561 6d29  ock(test_stream)
+00012c00: 2061 7320 5555 543a 0a20 2020 2020 2020   as UUT:.       
+00012c10: 2020 2020 2020 2020 2061 7761 6974 2074           await t
+00012c20: 6573 745f 7374 7265 616d 2e72 6561 6428  est_stream.read(
+00012c30: 3132 202b 2038 2920 2023 2052 6561 6420  12 + 8)  # Read 
+00012c40: 746f 2074 6865 2065 6e64 206f 6620 7468  to the end of th
+00012c50: 6520 6368 696c 6420 626c 6f63 6b73 0a0a  e child blocks..
+00012c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012c70: 7769 7468 2073 656c 662e 6173 7365 7274  with self.assert
+00012c80: 5261 6973 6573 2847 5346 4465 636f 6465  Raises(GSFDecode
+00012c90: 4572 726f 7229 3a0a 2020 2020 2020 2020  Error):.        
+00012ca0: 2020 2020 2020 2020 2020 2020 5555 542e              UUT.
+00012cb0: 6861 735f 6368 696c 645f 626c 6f63 6b28  has_child_block(
+00012cc0: 7374 7269 6374 5f62 6c6f 636b 733d 5472  strict_blocks=Tr
+00012cd0: 7565 290a 0a20 2020 2061 7379 6e63 2064  ue)..    async d
+00012ce0: 6566 2074 6573 745f 636f 6e74 6578 746d  ef test_contextm
+00012cf0: 616e 6167 6572 5f68 6173 5f63 6869 6c64  anager_has_child
+00012d00: 5f6e 6f5f 7374 7269 6374 5f62 6c6f 636b  _no_strict_block
+00012d10: 7328 7365 6c66 293a 0a20 2020 2020 2020  s(self):.       
+00012d20: 2022 2222 456e 7375 7265 2074 6861 7420   """Ensure that 
+00012d30: 7768 656e 2073 7472 6963 7420 6d6f 6465  when strict mode
+00012d40: 2069 7320 6f66 662c 2068 6173 5f63 6869   is off, has_chi
+00012d50: 6c64 2064 6f65 736e 2774 2065 7272 6f72  ld doesn't error
+00012d60: 206f 6e20 7061 7274 6961 6c20 626c 6f63   on partial bloc
+00012d70: 6b73 2222 220a 2020 2020 2020 2020 6173  ks""".        as
+00012d80: 796e 6320 7769 7468 2073 656c 662e 5f6d  ync with self._m
+00012d90: 616b 655f 7361 6d70 6c65 5f73 7472 6561  ake_sample_strea
+00012da0: 6d28 706f 7374 5f63 6869 6c64 5f6c 656e  m(post_child_len
+00012db0: 3d34 2920 6173 2074 6573 745f 7374 7265  =4) as test_stre
+00012dc0: 616d 3a0a 2020 2020 2020 2020 2020 2020  am:.            
+00012dd0: 6173 796e 6320 7769 7468 2041 7379 6e63  async with Async
+00012de0: 4753 4642 6c6f 636b 2874 6573 745f 7374  GSFBlock(test_st
+00012df0: 7265 616d 2920 6173 2055 5554 3a0a 2020  ream) as UUT:.  
+00012e00: 2020 2020 2020 2020 2020 2020 2020 6177                aw
+00012e10: 6169 7420 7465 7374 5f73 7472 6561 6d2e  ait test_stream.
+00012e20: 7265 6164 2831 3220 2b20 3829 2020 2320  read(12 + 8)  # 
+00012e30: 5265 6164 2074 6f20 7468 6520 656e 6420  Read to the end 
+00012e40: 6f66 2074 6865 2063 6869 6c64 2062 6c6f  of the child blo
+00012e50: 636b 730a 0a20 2020 2020 2020 2020 2020  cks..           
+00012e60: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00012e70: 4661 6c73 6528 5555 542e 6861 735f 6368  False(UUT.has_ch
+00012e80: 696c 645f 626c 6f63 6b28 7374 7269 6374  ild_block(strict
+00012e90: 5f62 6c6f 636b 733d 4661 6c73 6529 290a  _blocks=False)).
+00012ea0: 0a20 2020 2061 7379 6e63 2064 6566 2074  .    async def t
+00012eb0: 6573 745f 636f 6e74 6578 746d 616e 6167  est_contextmanag
+00012ec0: 6572 5f63 6869 6c64 5f62 6c6f 636b 735f  er_child_blocks_
+00012ed0: 6765 6e65 7261 746f 7228 7365 6c66 293a  generator(self):
+00012ee0: 0a20 2020 2020 2020 2022 2222 456e 7375  .        """Ensu
+00012ef0: 7265 2074 6865 2063 6869 6c64 2062 6c6f  re the child blo
+00012f00: 636b 7320 6765 6e65 7261 746f 7220 7265  cks generator re
+00012f10: 7475 726e 7320 6120 626c 6f63 6b2c 2061  turns a block, a
+00012f20: 6e64 2073 6565 6b73 2061 6674 6572 7761  nd seeks afterwa
+00012f30: 7264 7322 2222 0a20 2020 2020 2020 2061  rds""".        a
+00012f40: 7379 6e63 2077 6974 6820 7365 6c66 2e5f  sync with self._
+00012f50: 6d61 6b65 5f73 616d 706c 655f 7374 7265  make_sample_stre
+00012f60: 616d 2829 2061 7320 7465 7374 5f73 7472  am() as test_str
+00012f70: 6561 6d3a 0a20 2020 2020 2020 2020 2020  eam:.           
+00012f80: 2061 7379 6e63 2077 6974 6820 4173 796e   async with Asyn
+00012f90: 6347 5346 426c 6f63 6b28 7465 7374 5f73  cGSFBlock(test_s
+00012fa0: 7472 6561 6d29 2061 7320 5555 543a 0a20  tream) as UUT:. 
+00012fb0: 2020 2020 2020 2020 2020 2020 2020 206c                 l
+00012fc0: 6f6f 705f 636f 756e 7420 3d20 300a 2020  oop_count = 0.  
+00012fd0: 2020 2020 2020 2020 2020 2020 2020 6368                ch
+00012fe0: 696c 645f 6279 7465 735f 636f 6e73 756d  ild_bytes_consum
+00012ff0: 6564 203d 2030 0a20 2020 2020 2020 2020  ed = 0.         
+00013000: 2020 2020 2020 2061 7379 6e63 2066 6f72         async for
+00013010: 2062 6c6f 636b 2069 6e20 5555 542e 6368   block in UUT.ch
+00013020: 696c 645f 626c 6f63 6b73 2829 3a0a 2020  ild_blocks():.  
+00013030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013040: 2020 6368 696c 645f 6279 7465 735f 636f    child_bytes_co
+00013050: 6e73 756d 6564 202b 3d20 626c 6f63 6b2e  nsumed += block.
+00013060: 7369 7a65 0a20 2020 2020 2020 2020 2020  size.           
+00013070: 2020 2020 2020 2020 206c 6f6f 705f 636f           loop_co
+00013080: 756e 7420 2b3d 2031 0a0a 2020 2020 2020  unt += 1..      
+00013090: 2020 2020 2020 2020 2020 2320 4469 6420            # Did 
+000130a0: 7765 2067 6574 2062 6f74 6820 6368 696c  we get both chil
+000130b0: 6420 626c 6f63 6b73 3f0a 2020 2020 2020  d blocks?.      
+000130c0: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+000130d0: 7373 6572 7445 7175 616c 2832 2c20 6c6f  ssertEqual(2, lo
+000130e0: 6f70 5f63 6f75 6e74 290a 0a20 2020 2020  op_count)..     
+000130f0: 2020 2020 2020 2020 2020 2023 2044 6964             # Did
+00013100: 2077 6520 7365 656b 206f 6e20 6578 6974   we seek on exit
+00013110: 2066 726f 6d20 6561 6368 206c 6f6f 7020   from each loop 
+00013120: 6974 6572 6174 696f 6e0a 2020 2020 2020  iteration.      
+00013130: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+00013140: 7373 6572 7445 7175 616c 2863 6869 6c64  ssertEqual(child
+00013150: 5f62 7974 6573 5f63 6f6e 7375 6d65 6420  _bytes_consumed 
+00013160: 2b20 5555 542e 626c 6f63 6b5f 7374 6172  + UUT.block_star
+00013170: 7420 2b20 382c 2074 6573 745f 7374 7265  t + 8, test_stre
+00013180: 616d 2e74 656c 6c28 2929 0a0a 0a63 6c61  am.tell())...cla
+00013190: 7373 2054 6573 7447 5346 4465 636f 6465  ss TestGSFDecode
+000131a0: 7228 4973 6f6c 6174 6564 4173 796e 6369  r(IsolatedAsynci
+000131b0: 6f54 6573 7443 6173 6529 3a0a 2020 2020  oTestCase):.    
+000131c0: 2222 2254 6573 7473 2066 6f72 2074 6865  """Tests for the
+000131d0: 2047 5346 4465 636f 6465 7220 696e 2069   GSFDecoder in i
+000131e0: 7473 206d 6f72 6520 6f62 6a65 6374 2d6f  ts more object-o
+000131f0: 7269 656e 7465 6420 6d6f 6465 0a0a 2020  riented mode..  
+00013200: 2020 4e6f 7465 2074 6861 7420 7665 7279    Note that very
+00013210: 206c 6974 746c 6520 7465 7374 696e 6720   little testing 
+00013220: 6f66 2074 6865 2064 6563 6f64 6564 2064  of the decoded d
+00013230: 6174 6120 6861 7070 656e 7320 6865 7265  ata happens here
+00013240: 2c20 7468 6174 2773 2068 616e 646c 6564  , that's handled
+00013250: 2062 7920 5465 7374 4753 464c 6f61 6473   by TestGSFLoads
+00013260: 2829 0a20 2020 2022 2222 0a20 2020 2064  ().    """.    d
+00013270: 6566 2074 6573 745f 6465 636f 6465 5f68  ef test_decode_h
+00013280: 6561 6465 7273 2873 656c 6629 3a0a 2020  eaders(self):.  
+00013290: 2020 2020 2020 7669 6465 6f5f 6461 7461        video_data
+000132a0: 5f73 7472 6561 6d20 3d20 4279 7465 7349  _stream = BytesI
+000132b0: 4f28 5649 4445 4f5f 4441 5441 5f38 290a  O(VIDEO_DATA_8).
+000132c0: 0a20 2020 2020 2020 2077 6974 6820 4753  .        with GS
+000132d0: 4644 6563 6f64 6572 2866 696c 655f 6461  FDecoder(file_da
+000132e0: 7461 3d76 6964 656f 5f64 6174 615f 7374  ta=video_data_st
+000132f0: 7265 616d 2920 6173 2064 6563 3a0a 2020  ream) as dec:.  
+00013300: 2020 2020 2020 2020 2020 6865 6164 203d            head =
+00013310: 2064 6563 2e66 696c 655f 6865 6164 6572   dec.file_header
+00013320: 730a 0a20 2020 2020 2020 2073 656c 662e  s..        self.
+00013330: 6173 7365 7274 4571 7561 6c28 6865 6164  assertEqual(head
+00013340: 5b27 6372 6561 7465 6427 5d2c 2064 6174  ['created'], dat
+00013350: 6574 696d 6528 3230 3233 2c20 362c 2031  etime(2023, 6, 1
+00013360: 352c 2031 372c 2034 322c 2034 3429 290a  5, 17, 42, 44)).
+00013370: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+00013380: 6572 7445 7175 616c 2868 6561 645b 2769  ertEqual(head['i
+00013390: 6427 5d2c 2055 5549 4428 2761 3731 6165  d'], UUID('a71ae
+000133a0: 6534 612d 3062 3962 2d31 3165 652d 3930  e4a-0b9b-11ee-90
+000133b0: 3034 2d30 3937 3432 6230 6133 6666 3227  04-09742b0a3ff2'
+000133c0: 2929 0a20 2020 2020 2020 2073 656c 662e  )).        self.
+000133d0: 6173 7365 7274 4571 7561 6c28 6c65 6e28  assertEqual(len(
+000133e0: 6865 6164 5b27 7365 676d 656e 7473 275d  head['segments']
+000133f0: 292c 2031 290a 2020 2020 2020 2020 7365  ), 1).        se
+00013400: 6c66 2e61 7373 6572 7445 7175 616c 2868  lf.assertEqual(h
+00013410: 6561 645b 2773 6567 6d65 6e74 7327 5d5b  ead['segments'][
+00013420: 305d 5b27 6964 275d 2c20 5555 4944 2827  0]['id'], UUID('
+00013430: 6137 3161 6565 3462 2d30 6239 622d 3131  a71aee4b-0b9b-11
+00013440: 6565 2d39 3030 342d 3039 3734 3262 3061  ee-9004-09742b0a
+00013450: 3366 6632 2729 290a 0a20 2020 2064 6566  3ff2'))..    def
+00013460: 2074 6573 745f 6765 6e65 7261 7465 5f67   test_generate_g
+00013470: 7261 696e 7328 7365 6c66 293a 0a20 2020  rains(self):.   
+00013480: 2020 2020 2022 2222 5465 7374 2074 6861       """Test tha
+00013490: 7420 7468 6520 6765 6e65 7261 746f 7220  t the generator 
+000134a0: 7969 656c 6473 2065 6163 6820 6772 6169  yields each grai
+000134b0: 6e22 2222 0a20 2020 2020 2020 2076 6964  n""".        vid
+000134c0: 656f 5f64 6174 615f 7374 7265 616d 203d  eo_data_stream =
+000134d0: 2042 7974 6573 494f 2856 4944 454f 5f44   BytesIO(VIDEO_D
+000134e0: 4154 415f 3829 0a0a 2020 2020 2020 2020  ATA_8)..        
+000134f0: 7769 7468 2047 5346 4465 636f 6465 7228  with GSFDecoder(
+00013500: 6669 6c65 5f64 6174 613d 7669 6465 6f5f  file_data=video_
+00013510: 6461 7461 5f73 7472 6561 6d29 2061 7320  data_stream) as 
+00013520: 6465 633a 0a20 2020 2020 2020 2020 2020  dec:.           
+00013530: 2067 7261 696e 5f63 6f75 6e74 203d 2030   grain_count = 0
+00013540: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+00013550: 2028 6772 6169 6e2c 206c 6f63 616c 5f69   (grain, local_i
+00013560: 6429 2069 6e20 6465 632e 6772 6169 6e73  d) in dec.grains
+00013570: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
+00013580: 2020 2020 7365 6c66 2e61 7373 6572 7449      self.assertI
+00013590: 7349 6e73 7461 6e63 6528 6772 6169 6e2c  sInstance(grain,
+000135a0: 2056 6964 656f 4772 6169 6e29 0a20 2020   VideoGrain).   
+000135b0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+000135c0: 662e 6173 7365 7274 4571 7561 6c28 6772  f.assertEqual(gr
+000135d0: 6169 6e2e 736f 7572 6365 5f69 642c 2055  ain.source_id, U
+000135e0: 5549 4428 2734 3935 3738 3535 322d 6662  UID('49578552-fb
+000135f0: 3965 2d34 6433 652d 6131 3937 2d33 6533  9e-4d3e-a197-3e3
+00013600: 6334 3337 6138 3935 6427 2929 0a20 2020  c437a895d')).   
+00013610: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00013620: 662e 6173 7365 7274 4571 7561 6c28 6772  f.assertEqual(gr
+00013630: 6169 6e2e 666c 6f77 5f69 642c 2055 5549  ain.flow_id, UUI
+00013640: 4428 2736 6535 3566 3235 312d 6637 3561  D('6e55f251-f75a
+00013650: 2d34 6435 362d 6233 6166 2d65 6462 3862  -4d56-b3af-edb8b
+00013660: 3739 3933 6333 6327 2929 0a0a 2020 2020  7993c3c'))..    
+00013670: 2020 2020 2020 2020 2020 2020 6772 6169              grai
+00013680: 6e5f 636f 756e 7420 2b3d 2031 0a0a 2020  n_count += 1..  
+00013690: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+000136a0: 7445 7175 616c 2831 302c 2067 7261 696e  tEqual(10, grain
+000136b0: 5f63 6f75 6e74 2920 2023 2054 6865 7265  _count)  # There
+000136c0: 2061 7265 2031 3020 6772 6169 6e73 2069   are 10 grains i
+000136d0: 6e20 7468 6520 6669 6c65 0a0a 2020 2020  n the file..    
+000136e0: 6173 796e 6320 6465 6620 7465 7374 5f61  async def test_a
+000136f0: 7379 6e63 5f64 6563 6f64 655f 6865 6164  sync_decode_head
+00013700: 6572 7328 7365 6c66 293a 0a20 2020 2020  ers(self):.     
+00013710: 2020 2076 6964 656f 5f64 6174 615f 7374     video_data_st
+00013720: 7265 616d 203d 2041 7379 6e63 4279 7465  ream = AsyncByte
+00013730: 7349 4f28 5649 4445 4f5f 4441 5441 5f38  sIO(VIDEO_DATA_8
+00013740: 290a 0a20 2020 2020 2020 2061 7379 6e63  )..        async
+00013750: 2077 6974 6820 4753 4644 6563 6f64 6572   with GSFDecoder
+00013760: 2866 696c 655f 6461 7461 3d76 6964 656f  (file_data=video
+00013770: 5f64 6174 615f 7374 7265 616d 2920 6173  _data_stream) as
+00013780: 2064 6563 3a0a 2020 2020 2020 2020 2020   dec:.          
+00013790: 2020 6865 6164 203d 2064 6563 2e66 696c    head = dec.fil
+000137a0: 655f 6865 6164 6572 730a 0a20 2020 2020  e_headers..     
+000137b0: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+000137c0: 7561 6c28 6865 6164 5b27 6372 6561 7465  ual(head['create
+000137d0: 6427 5d2c 2064 6174 6574 696d 6528 3230  d'], datetime(20
+000137e0: 3233 2c20 362c 2031 352c 2031 372c 2034  23, 6, 15, 17, 4
+000137f0: 322c 2034 3429 290a 2020 2020 2020 2020  2, 44)).        
+00013800: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+00013810: 2868 6561 645b 2769 6427 5d2c 2055 5549  (head['id'], UUI
+00013820: 4428 2761 3731 6165 6534 612d 3062 3962  D('a71aee4a-0b9b
+00013830: 2d31 3165 652d 3930 3034 2d30 3937 3432  -11ee-9004-09742
+00013840: 6230 6133 6666 3227 2929 0a20 2020 2020  b0a3ff2')).     
+00013850: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+00013860: 7561 6c28 6c65 6e28 6865 6164 5b27 7365  ual(len(head['se
+00013870: 676d 656e 7473 275d 292c 2031 290a 2020  gments']), 1).  
+00013880: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00013890: 7445 7175 616c 2868 6561 645b 2773 6567  tEqual(head['seg
+000138a0: 6d65 6e74 7327 5d5b 305d 5b27 6964 275d  ments'][0]['id']
+000138b0: 2c20 5555 4944 2827 6137 3161 6565 3462  , UUID('a71aee4b
+000138c0: 2d30 6239 622d 3131 6565 2d39 3030 342d  -0b9b-11ee-9004-
+000138d0: 3039 3734 3262 3061 3366 6632 2729 290a  09742b0a3ff2')).
+000138e0: 0a20 2020 2061 7379 6e63 2064 6566 2074  .    async def t
+000138f0: 6573 745f 6173 796e 635f 6765 6e65 7261  est_async_genera
+00013900: 7465 5f67 7261 696e 7328 7365 6c66 293a  te_grains(self):
+00013910: 0a20 2020 2020 2020 2022 2222 5465 7374  .        """Test
+00013920: 2074 6861 7420 7468 6520 6765 6e65 7261   that the genera
+00013930: 746f 7220 7969 656c 6473 2065 6163 6820  tor yields each 
+00013940: 6772 6169 6e22 2222 0a20 2020 2020 2020  grain""".       
+00013950: 2076 6964 656f 5f64 6174 615f 7374 7265   video_data_stre
+00013960: 616d 203d 2041 7379 6e63 4279 7465 7349  am = AsyncBytesI
+00013970: 4f28 5649 4445 4f5f 4441 5441 5f38 290a  O(VIDEO_DATA_8).
+00013980: 0a20 2020 2020 2020 2061 7379 6e63 2077  .        async w
+00013990: 6974 6820 4753 4644 6563 6f64 6572 2866  ith GSFDecoder(f
+000139a0: 696c 655f 6461 7461 3d76 6964 656f 5f64  ile_data=video_d
+000139b0: 6174 615f 7374 7265 616d 2920 6173 2064  ata_stream) as d
+000139c0: 6563 3a0a 2020 2020 2020 2020 2020 2020  ec:.            
+000139d0: 6772 6169 6e5f 636f 756e 7420 3d20 300a  grain_count = 0.
+000139e0: 2020 2020 2020 2020 2020 2020 6173 796e              asyn
+000139f0: 6320 666f 7220 2867 7261 696e 2c20 6c6f  c for (grain, lo
+00013a00: 6361 6c5f 6964 2920 696e 2064 6563 2e67  cal_id) in dec.g
+00013a10: 7261 696e 7328 6c6f 6164 696e 675f 6d6f  rains(loading_mo
+00013a20: 6465 3d47 7261 696e 4461 7461 4c6f 6164  de=GrainDataLoad
+00013a30: 696e 674d 6f64 652e 4c4f 4144 5f49 4d4d  ingMode.LOAD_IMM
+00013a40: 4544 4941 5445 4c59 293a 0a20 2020 2020  EDIATELY):.     
+00013a50: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00013a60: 6173 7365 7274 4973 496e 7374 616e 6365  assertIsInstance
+00013a70: 2867 7261 696e 2c20 5669 6465 6f47 7261  (grain, VideoGra
+00013a80: 696e 290a 2020 2020 2020 2020 2020 2020  in).            
+00013a90: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+00013aa0: 7175 616c 2867 7261 696e 2e73 6f75 7263  qual(grain.sourc
+00013ab0: 655f 6964 2c20 5555 4944 2827 3439 3537  e_id, UUID('4957
+00013ac0: 3835 3532 2d66 6239 652d 3464 3365 2d61  8552-fb9e-4d3e-a
+00013ad0: 3139 372d 3365 3363 3433 3761 3839 3564  197-3e3c437a895d
+00013ae0: 2729 290a 2020 2020 2020 2020 2020 2020  ')).            
+00013af0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+00013b00: 7175 616c 2867 7261 696e 2e66 6c6f 775f  qual(grain.flow_
+00013b10: 6964 2c20 5555 4944 2827 3665 3535 6632  id, UUID('6e55f2
+00013b20: 3531 2d66 3735 612d 3464 3536 2d62 3361  51-f75a-4d56-b3a
+00013b30: 662d 6564 6238 6237 3939 3363 3363 2729  f-edb8b7993c3c')
+00013b40: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
+00013b50: 2020 2067 7261 696e 5f63 6f75 6e74 202b     grain_count +
+00013b60: 3d20 310a 0a20 2020 2020 2020 2073 656c  = 1..        sel
+00013b70: 662e 6173 7365 7274 4571 7561 6c28 3130  f.assertEqual(10
+00013b80: 2c20 6772 6169 6e5f 636f 756e 7429 2020  , grain_count)  
+00013b90: 2320 5468 6572 6520 6172 6520 3130 2067  # There are 10 g
+00013ba0: 7261 696e 7320 696e 2074 6865 2066 696c  rains in the fil
+00013bb0: 650a 0a20 2020 2061 7379 6e63 2064 6566  e..    async def
+00013bc0: 2074 6573 745f 6173 796e 635f 746f 5f73   test_async_to_s
+00013bd0: 796e 635f 6765 6e65 7261 7465 5f67 7261  ync_generate_gra
+00013be0: 696e 7328 7365 6c66 293a 0a20 2020 2020  ins(self):.     
+00013bf0: 2020 2022 2222 5465 7374 2074 6861 7420     """Test that 
+00013c00: 7468 6520 6765 6e65 7261 746f 7220 7969  the generator yi
+00013c10: 656c 6473 2065 6163 6820 6772 6169 6e20  elds each grain 
+00013c20: 7768 656e 2072 756e 2073 6e63 6872 6f6e  when run snchron
+00013c30: 6f75 736c 7920 6672 6f6d 2061 7379 6e63  ously from async
+00013c40: 6872 6f6e 6f75 7320 636f 6465 2222 220a  hronous code""".
+00013c50: 2020 2020 2020 2020 7669 6465 6f5f 6461          video_da
+00013c60: 7461 5f73 7472 6561 6d20 3d20 4279 7465  ta_stream = Byte
+00013c70: 7349 4f28 5649 4445 4f5f 4441 5441 5f38  sIO(VIDEO_DATA_8
+00013c80: 290a 0a20 2020 2020 2020 2077 6974 6820  )..        with 
+00013c90: 4753 4644 6563 6f64 6572 2866 696c 655f  GSFDecoder(file_
+00013ca0: 6461 7461 3d76 6964 656f 5f64 6174 615f  data=video_data_
+00013cb0: 7374 7265 616d 2920 6173 2064 6563 3a0a  stream) as dec:.
+00013cc0: 2020 2020 2020 2020 2020 2020 6772 6169              grai
+00013cd0: 6e5f 636f 756e 7420 3d20 300a 2020 2020  n_count = 0.    
+00013ce0: 2020 2020 2020 2020 666f 7220 2867 7261          for (gra
+00013cf0: 696e 2c20 6c6f 6361 6c5f 6964 2920 696e  in, local_id) in
+00013d00: 2064 6563 2e67 7261 696e 7328 6c6f 6164   dec.grains(load
+00013d10: 696e 675f 6d6f 6465 3d47 7261 696e 4461  ing_mode=GrainDa
+00013d20: 7461 4c6f 6164 696e 674d 6f64 652e 4c4f  taLoadingMode.LO
+00013d30: 4144 5f49 4d4d 4544 4941 5445 4c59 293a  AD_IMMEDIATELY):
+00013d40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00013d50: 2073 656c 662e 6173 7365 7274 4973 496e   self.assertIsIn
+00013d60: 7374 616e 6365 2867 7261 696e 2c20 5669  stance(grain, Vi
+00013d70: 6465 6f47 7261 696e 290a 2020 2020 2020  deoGrain).      
+00013d80: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+00013d90: 7373 6572 7445 7175 616c 2867 7261 696e  ssertEqual(grain
+00013da0: 2e73 6f75 7263 655f 6964 2c20 5555 4944  .source_id, UUID
+00013db0: 2827 3439 3537 3835 3532 2d66 6239 652d  ('49578552-fb9e-
+00013dc0: 3464 3365 2d61 3139 372d 3365 3363 3433  4d3e-a197-3e3c43
+00013dd0: 3761 3839 3564 2729 290a 2020 2020 2020  7a895d')).      
+00013de0: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+00013df0: 7373 6572 7445 7175 616c 2867 7261 696e  ssertEqual(grain
+00013e00: 2e66 6c6f 775f 6964 2c20 5555 4944 2827  .flow_id, UUID('
+00013e10: 3665 3535 6632 3531 2d66 3735 612d 3464  6e55f251-f75a-4d
+00013e20: 3536 2d62 3361 662d 6564 6238 6237 3939  56-b3af-edb8b799
+00013e30: 3363 3363 2729 290a 0a20 2020 2020 2020  3c3c'))..       
+00013e40: 2020 2020 2020 2020 2067 7261 696e 5f63           grain_c
+00013e50: 6f75 6e74 202b 3d20 310a 0a20 2020 2020  ount += 1..     
+00013e60: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+00013e70: 7561 6c28 3130 2c20 6772 6169 6e5f 636f  ual(10, grain_co
+00013e80: 756e 7429 2020 2320 5468 6572 6520 6172  unt)  # There ar
+00013e90: 6520 3130 2067 7261 696e 7320 696e 2074  e 10 grains in t
+00013ea0: 6865 2066 696c 650a 0a20 2020 2061 7379  he file..    asy
+00013eb0: 6e63 2064 6566 2074 6573 745f 6173 796e  nc def test_asyn
+00013ec0: 635f 6765 6e65 7261 7465 5f67 7261 696e  c_generate_grain
+00013ed0: 735f 6c6f 6164 5f6c 617a 696c 7928 7365  s_load_lazily(se
+00013ee0: 6c66 293a 0a20 2020 2020 2020 2022 2222  lf):.        """
+00013ef0: 5465 7374 2074 6861 7420 7468 6520 6765  Test that the ge
+00013f00: 6e65 7261 746f 7220 7969 656c 6473 2065  nerator yields e
+00013f10: 6163 6820 6772 6169 6e22 2222 0a20 2020  ach grain""".   
+00013f20: 2020 2020 2076 6964 656f 5f64 6174 615f       video_data_
+00013f30: 7374 7265 616d 203d 2041 7379 6e63 4279  stream = AsyncBy
+00013f40: 7465 7349 4f28 5649 4445 4f5f 4441 5441  tesIO(VIDEO_DATA
+00013f50: 5f38 290a 0a20 2020 2020 2020 2061 7379  _8)..        asy
+00013f60: 6e63 2077 6974 6820 4753 4644 6563 6f64  nc with GSFDecod
+00013f70: 6572 2866 696c 655f 6461 7461 3d76 6964  er(file_data=vid
+00013f80: 656f 5f64 6174 615f 7374 7265 616d 2920  eo_data_stream) 
+00013f90: 6173 2064 6563 3a0a 2020 2020 2020 2020  as dec:.        
+00013fa0: 2020 2020 6772 6169 6e5f 636f 756e 7420      grain_count 
+00013fb0: 3d20 300a 2020 2020 2020 2020 2020 2020  = 0.            
+00013fc0: 6173 796e 6320 666f 7220 2867 7261 696e  async for (grain
+00013fd0: 2c20 6c6f 6361 6c5f 6964 2920 696e 2064  , local_id) in d
+00013fe0: 6563 2e67 7261 696e 7328 6c6f 6164 696e  ec.grains(loadin
+00013ff0: 675f 6d6f 6465 3d47 7261 696e 4461 7461  g_mode=GrainData
+00014000: 4c6f 6164 696e 674d 6f64 652e 414c 5741  LoadingMode.ALWA
+00014010: 5953 5f44 4546 4552 5f4c 4f41 445f 4946  YS_DEFER_LOAD_IF
+00014020: 5f50 4f53 5349 424c 4529 3a0a 2020 2020  _POSSIBLE):.    
+00014030: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00014040: 2e61 7373 6572 7449 7349 6e73 7461 6e63  .assertIsInstanc
+00014050: 6528 6772 6169 6e2c 2056 6964 656f 4772  e(grain, VideoGr
+00014060: 6169 6e29 0a20 2020 2020 2020 2020 2020  ain).           
+00014070: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00014080: 4571 7561 6c28 6772 6169 6e2e 736f 7572  Equal(grain.sour
+00014090: 6365 5f69 642c 2055 5549 4428 2734 3935  ce_id, UUID('495
+000140a0: 3738 3535 322d 6662 3965 2d34 6433 652d  78552-fb9e-4d3e-
+000140b0: 6131 3937 2d33 6533 6334 3337 6138 3935  a197-3e3c437a895
+000140c0: 6427 2929 0a20 2020 2020 2020 2020 2020  d')).           
+000140d0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+000140e0: 4571 7561 6c28 6772 6169 6e2e 666c 6f77  Equal(grain.flow
+000140f0: 5f69 642c 2055 5549 4428 2736 6535 3566  _id, UUID('6e55f
+00014100: 3235 312d 6637 3561 2d34 6435 362d 6233  251-f75a-4d56-b3
+00014110: 6166 2d65 6462 3862 3739 3933 6333 6327  af-edb8b7993c3c'
+00014120: 2929 0a0a 2020 2020 2020 2020 2020 2020  ))..            
+00014130: 2020 2020 7365 6c66 2e61 7373 6572 7449      self.assertI
+00014140: 734e 6f6e 6528 6772 6169 6e2e 6461 7461  sNone(grain.data
+00014150: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
+00014160: 2020 2061 7761 6974 2067 7261 696e 0a0a     await grain..
+00014170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014180: 7365 6c66 2e61 7373 6572 7449 734e 6f74  self.assertIsNot
+00014190: 4e6f 6e65 2867 7261 696e 2e64 6174 6129  None(grain.data)
+000141a0: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000141b0: 2020 6772 6169 6e5f 636f 756e 7420 2b3d    grain_count +=
+000141c0: 2031 0a0a 2020 2020 2020 2020 7365 6c66   1..        self
+000141d0: 2e61 7373 6572 7445 7175 616c 2831 302c  .assertEqual(10,
+000141e0: 2067 7261 696e 5f63 6f75 6e74 2920 2023   grain_count)  #
+000141f0: 2054 6865 7265 2061 7265 2031 3020 6772   There are 10 gr
+00014200: 6169 6e73 2069 6e20 7468 6520 6669 6c65  ains in the file
+00014210: 0a0a 2020 2020 4073 7570 7072 6573 735f  ..    @suppress_
+00014220: 6465 7072 6563 6174 696f 6e5f 7761 726e  deprecation_warn
+00014230: 696e 6773 0a20 2020 2064 6566 2074 6573  ings.    def tes
+00014240: 745f 6465 636f 6465 5f68 6561 6465 7273  t_decode_headers
+00014250: 5f5f 6465 7072 6563 6174 6564 2873 656c  __deprecated(sel
+00014260: 6629 3a0a 2020 2020 2020 2020 7669 6465  f):.        vide
+00014270: 6f5f 6461 7461 5f73 7472 6561 6d20 3d20  o_data_stream = 
+00014280: 4279 7465 7349 4f28 5649 4445 4f5f 4441  BytesIO(VIDEO_DA
+00014290: 5441 5f38 290a 0a20 2020 2020 2020 2055  TA_8)..        U
+000142a0: 5554 203d 2047 5346 4465 636f 6465 7228  UT = GSFDecoder(
+000142b0: 6669 6c65 5f64 6174 613d 7669 6465 6f5f  file_data=video_
+000142c0: 6461 7461 5f73 7472 6561 6d29 0a20 2020  data_stream).   
+000142d0: 2020 2020 2068 6561 6420 3d20 5555 542e       head = UUT.
+000142e0: 6465 636f 6465 5f66 696c 655f 6865 6164  decode_file_head
+000142f0: 6572 7328 290a 0a20 2020 2020 2020 2073  ers()..        s
+00014300: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+00014310: 6865 6164 5b27 6372 6561 7465 6427 5d2c  head['created'],
+00014320: 2064 6174 6574 696d 6528 3230 3233 2c20   datetime(2023, 
+00014330: 362c 2031 352c 2031 372c 2034 322c 2034  6, 15, 17, 42, 4
+00014340: 3429 290a 2020 2020 2020 2020 7365 6c66  4)).        self
+00014350: 2e61 7373 6572 7445 7175 616c 2868 6561  .assertEqual(hea
+00014360: 645b 2769 6427 5d2c 2055 5549 4428 2761  d['id'], UUID('a
+00014370: 3731 6165 6534 612d 3062 3962 2d31 3165  71aee4a-0b9b-11e
+00014380: 652d 3930 3034 2d30 3937 3432 6230 6133  e-9004-09742b0a3
+00014390: 6666 3227 2929 0a20 2020 2020 2020 2073  ff2')).        s
+000143a0: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+000143b0: 6c65 6e28 6865 6164 5b27 7365 676d 656e  len(head['segmen
+000143c0: 7473 275d 292c 2031 290a 2020 2020 2020  ts']), 1).      
+000143d0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+000143e0: 616c 2868 6561 645b 2773 6567 6d65 6e74  al(head['segment
+000143f0: 7327 5d5b 305d 5b27 6964 275d 2c20 5555  s'][0]['id'], UU
+00014400: 4944 2827 6137 3161 6565 3462 2d30 6239  ID('a71aee4b-0b9
+00014410: 622d 3131 6565 2d39 3030 342d 3039 3734  b-11ee-9004-0974
+00014420: 3262 3061 3366 6632 2729 290a 0a20 2020  2b0a3ff2'))..   
+00014430: 2040 7375 7070 7265 7373 5f64 6570 7265   @suppress_depre
+00014440: 6361 7469 6f6e 5f77 6172 6e69 6e67 730a  cation_warnings.
+00014450: 2020 2020 6465 6620 7465 7374 5f67 656e      def test_gen
+00014460: 6572 6174 655f 6772 6169 6e73 5f5f 6465  erate_grains__de
+00014470: 7072 6563 6174 6564 2873 656c 6629 3a0a  precated(self):.
+00014480: 2020 2020 2020 2020 2222 2254 6573 7420          """Test 
+00014490: 7468 6174 2074 6865 2067 656e 6572 6174  that the generat
+000144a0: 6f72 2079 6965 6c64 7320 6561 6368 2067  or yields each g
+000144b0: 7261 696e 2222 220a 2020 2020 2020 2020  rain""".        
+000144c0: 7669 6465 6f5f 6461 7461 5f73 7472 6561  video_data_strea
+000144d0: 6d20 3d20 4279 7465 7349 4f28 5649 4445  m = BytesIO(VIDE
+000144e0: 4f5f 4441 5441 5f38 290a 0a20 2020 2020  O_DATA_8)..     
+000144f0: 2020 2055 5554 203d 2047 5346 4465 636f     UUT = GSFDeco
+00014500: 6465 7228 6669 6c65 5f64 6174 613d 7669  der(file_data=vi
+00014510: 6465 6f5f 6461 7461 5f73 7472 6561 6d29  deo_data_stream)
+00014520: 0a20 2020 2020 2020 2055 5554 2e64 6563  .        UUT.dec
+00014530: 6f64 655f 6669 6c65 5f68 6561 6465 7273  ode_file_headers
+00014540: 2829 0a0a 2020 2020 2020 2020 6772 6169  ()..        grai
+00014550: 6e5f 636f 756e 7420 3d20 300a 2020 2020  n_count = 0.    
+00014560: 2020 2020 666f 7220 2867 7261 696e 2c20      for (grain, 
+00014570: 6c6f 6361 6c5f 6964 2920 696e 2055 5554  local_id) in UUT
+00014580: 2e67 7261 696e 7328 293a 0a20 2020 2020  .grains():.     
+00014590: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+000145a0: 7274 4973 496e 7374 616e 6365 2867 7261  rtIsInstance(gra
+000145b0: 696e 2c20 5669 6465 6f47 7261 696e 290a  in, VideoGrain).
+000145c0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000145d0: 2e61 7373 6572 7445 7175 616c 2867 7261  .assertEqual(gra
+000145e0: 696e 2e73 6f75 7263 655f 6964 2c20 5555  in.source_id, UU
+000145f0: 4944 2827 3439 3537 3835 3532 2d66 6239  ID('49578552-fb9
+00014600: 652d 3464 3365 2d61 3139 372d 3365 3363  e-4d3e-a197-3e3c
+00014610: 3433 3761 3839 3564 2729 290a 2020 2020  437a895d')).    
+00014620: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+00014630: 6572 7445 7175 616c 2867 7261 696e 2e66  ertEqual(grain.f
+00014640: 6c6f 775f 6964 2c20 5555 4944 2827 3665  low_id, UUID('6e
+00014650: 3535 6632 3531 2d66 3735 612d 3464 3536  55f251-f75a-4d56
+00014660: 2d62 3361 662d 6564 6238 6237 3939 3363  -b3af-edb8b7993c
+00014670: 3363 2729 290a 0a20 2020 2020 2020 2020  3c'))..         
+00014680: 2020 2067 7261 696e 5f63 6f75 6e74 202b     grain_count +
+00014690: 3d20 310a 0a20 2020 2020 2020 2073 656c  = 1..        sel
+000146a0: 662e 6173 7365 7274 4571 7561 6c28 3130  f.assertEqual(10
+000146b0: 2c20 6772 6169 6e5f 636f 756e 7429 2020  , grain_count)  
+000146c0: 2320 5468 6572 6520 6172 6520 3130 2067  # There are 10 g
+000146d0: 7261 696e 7320 696e 2074 6865 2066 696c  rains in the fil
+000146e0: 650a 0a20 2020 2061 7379 6e63 2064 6566  e..    async def
+000146f0: 2074 6573 745f 6173 796e 635f 636f 6d70   test_async_comp
+00014700: 6172 6973 6f6e 5f6f 665f 6c61 7a79 5f6c  arison_of_lazy_l
+00014710: 6f61 6465 645f 6772 6169 6e73 2873 656c  oaded_grains(sel
+00014720: 6629 3a0a 2020 2020 2020 2020 6173 796e  f):.        asyn
+00014730: 6320 7769 7468 2047 5346 4465 636f 6465  c with GSFDecode
+00014740: 7228 6669 6c65 5f64 6174 613d 4173 796e  r(file_data=Asyn
+00014750: 6342 7974 6573 494f 2856 4944 454f 5f44  cBytesIO(VIDEO_D
+00014760: 4154 415f 3829 2920 6173 2064 6563 3a0a  ATA_8)) as dec:.
+00014770: 2020 2020 2020 2020 2020 2020 6772 6169              grai
+00014780: 6e73 203d 205b 0a20 2020 2020 2020 2020  ns = [.         
+00014790: 2020 2020 2020 2067 7261 696e 2061 7379         grain asy
+000147a0: 6e63 2066 6f72 2028 6772 6169 6e2c 206c  nc for (grain, l
+000147b0: 6f63 616c 5f69 6429 2069 6e20 6465 632e  ocal_id) in dec.
+000147c0: 6772 6169 6e73 286c 6f61 6469 6e67 5f6d  grains(loading_m
+000147d0: 6f64 653d 4772 6169 6e44 6174 614c 6f61  ode=GrainDataLoa
+000147e0: 6469 6e67 4d6f 6465 2e4c 4f41 445f 494d  dingMode.LOAD_IM
+000147f0: 4d45 4449 4154 454c 5929 5d0a 0a20 2020  MEDIATELY)]..   
+00014800: 2020 2020 2023 2052 6573 7461 7274 2074       # Restart t
+00014810: 6865 2064 6563 6f64 6572 0a20 2020 2020  he decoder.     
+00014820: 2020 2061 7379 6e63 2077 6974 6820 4753     async with GS
+00014830: 4644 6563 6f64 6572 2866 696c 655f 6461  FDecoder(file_da
+00014840: 7461 3d41 7379 6e63 4279 7465 7349 4f28  ta=AsyncBytesIO(
+00014850: 5649 4445 4f5f 4441 5441 5f38 2929 2061  VIDEO_DATA_8)) a
+00014860: 7320 6465 633a 0a20 2020 2020 2020 2020  s dec:.         
+00014870: 2020 2023 2041 6e6e 6f79 696e 676c 7920     # Annoyingly 
+00014880: 616e 6578 7420 6973 6e27 7420 6120 676c  anext isn't a gl
+00014890: 6f62 616c 2069 6e20 7079 7468 6f6e 2033  obal in python 3
+000148a0: 2e36 0a20 2020 2020 2020 2020 2020 2067  .6.            g
+000148b0: 7261 696e 203d 2028 6177 6169 7420 6465  rain = (await de
+000148c0: 632e 6772 6169 6e73 286c 6f61 6469 6e67  c.grains(loading
+000148d0: 5f6d 6f64 653d 4772 6169 6e44 6174 614c  _mode=GrainDataL
+000148e0: 6f61 6469 6e67 4d6f 6465 2e41 4c57 4159  oadingMode.ALWAY
+000148f0: 535f 4445 4645 525f 4c4f 4144 5f49 465f  S_DEFER_LOAD_IF_
+00014900: 504f 5353 4942 4c45 292e 5f5f 616e 6578  POSSIBLE).__anex
+00014910: 745f 5f28 2929 5b30 5d0a 2020 2020 2020  t__())[0].      
+00014920: 2020 2020 2020 6177 6169 7420 6772 6169        await grai
+00014930: 6e0a 2020 2020 2020 2020 2020 2020 636f  n.            co
+00014940: 6d70 203d 2063 6f6d 7061 7265 5f67 7261  mp = compare_gra
+00014950: 696e 2867 7261 696e 735b 305d 2c20 6772  in(grains[0], gr
+00014960: 6169 6e29 0a20 2020 2020 2020 2020 2020  ain).           
+00014970: 2073 656c 662e 6173 7365 7274 5472 7565   self.assertTrue
+00014980: 2863 6f6d 702c 206d 7367 3d22 7b21 727d  (comp, msg="{!r}
+00014990: 222e 666f 726d 6174 2863 6f6d 7029 290a  ".format(comp)).
+000149a0: 0a20 2020 2064 6566 2074 6573 745f 636f  .    def test_co
+000149b0: 6d70 6172 6973 6f6e 5f6f 665f 6c61 7a79  mparison_of_lazy
+000149c0: 5f6c 6f61 6465 645f 6772 6169 6e73 2873  _loaded_grains(s
+000149d0: 656c 6629 3a0a 2020 2020 2020 2020 7669  elf):.        vi
+000149e0: 6465 6f5f 6461 7461 5f73 7472 6561 6d20  deo_data_stream 
+000149f0: 3d20 4279 7465 7349 4f28 5649 4445 4f5f  = BytesIO(VIDEO_
+00014a00: 4441 5441 5f38 290a 0a20 2020 2020 2020  DATA_8)..       
+00014a10: 2077 6974 6820 4753 4644 6563 6f64 6572   with GSFDecoder
+00014a20: 2866 696c 655f 6461 7461 3d76 6964 656f  (file_data=video
+00014a30: 5f64 6174 615f 7374 7265 616d 2920 6173  _data_stream) as
+00014a40: 2064 6563 3a0a 2020 2020 2020 2020 2020   dec:.          
+00014a50: 2020 6772 6169 6e73 203d 205b 6772 6169    grains = [grai
+00014a60: 6e20 666f 7220 2867 7261 696e 2c20 6c6f  n for (grain, lo
+00014a70: 6361 6c5f 6964 2920 696e 2064 6563 2e67  cal_id) in dec.g
+00014a80: 7261 696e 7328 6c6f 6164 696e 675f 6d6f  rains(loading_mo
+00014a90: 6465 3d47 7261 696e 4461 7461 4c6f 6164  de=GrainDataLoad
+00014aa0: 696e 674d 6f64 652e 4c4f 4144 5f49 4d4d  ingMode.LOAD_IMM
+00014ab0: 4544 4941 5445 4c59 295d 0a0a 2020 2020  EDIATELY)]..    
+00014ac0: 2020 2020 2320 5265 7374 6172 7420 7468      # Restart th
+00014ad0: 6520 6465 636f 6465 720a 2020 2020 2020  e decoder.      
+00014ae0: 2020 7669 6465 6f5f 6461 7461 5f73 7472    video_data_str
+00014af0: 6561 6d2e 7365 656b 2830 290a 2020 2020  eam.seek(0).    
+00014b00: 2020 2020 7769 7468 2047 5346 4465 636f      with GSFDeco
+00014b10: 6465 7228 6669 6c65 5f64 6174 613d 7669  der(file_data=vi
+00014b20: 6465 6f5f 6461 7461 5f73 7472 6561 6d29  deo_data_stream)
+00014b30: 2061 7320 6465 633a 0a20 2020 2020 2020   as dec:.       
+00014b40: 2020 2020 2063 6f6d 7020 3d20 636f 6d70       comp = comp
+00014b50: 6172 655f 6772 6169 6e28 0a20 2020 2020  are_grain(.     
+00014b60: 2020 2020 2020 2020 2020 2067 7261 696e             grain
+00014b70: 735b 305d 2c20 6e65 7874 2864 6563 2e67  s[0], next(dec.g
+00014b80: 7261 696e 7328 6c6f 6164 696e 675f 6d6f  rains(loading_mo
+00014b90: 6465 3d47 7261 696e 4461 7461 4c6f 6164  de=GrainDataLoad
+00014ba0: 696e 674d 6f64 652e 414c 5741 5953 5f44  ingMode.ALWAYS_D
+00014bb0: 4546 4552 5f4c 4f41 445f 4946 5f50 4f53  EFER_LOAD_IF_POS
+00014bc0: 5349 424c 4529 295b 305d 290a 2020 2020  SIBLE))[0]).    
+00014bd0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+00014be0: 6572 7454 7275 6528 636f 6d70 2c20 6d73  ertTrue(comp, ms
+00014bf0: 673d 227b 2173 7d22 2e66 6f72 6d61 7428  g="{!s}".format(
+00014c00: 636f 6d70 2929 0a0a 2020 2020 4073 7570  comp))..    @sup
+00014c10: 7072 6573 735f 6465 7072 6563 6174 696f  press_deprecatio
+00014c20: 6e5f 7761 726e 696e 6773 0a20 2020 2064  n_warnings.    d
+00014c30: 6566 2074 6573 745f 636f 6d70 6172 6973  ef test_comparis
+00014c40: 6f6e 5f6f 665f 6c61 7a79 5f6c 6f61 6465  on_of_lazy_loade
+00014c50: 645f 6772 6169 6e73 5f5f 6465 7072 6563  d_grains__deprec
+00014c60: 6174 6564 2873 656c 6629 3a0a 2020 2020  ated(self):.    
+00014c70: 2020 2020 7669 6465 6f5f 6461 7461 5f73      video_data_s
+00014c80: 7472 6561 6d20 3d20 4279 7465 7349 4f28  tream = BytesIO(
+00014c90: 5649 4445 4f5f 4441 5441 5f38 290a 0a20  VIDEO_DATA_8).. 
+00014ca0: 2020 2020 2020 2055 5554 203d 2047 5346         UUT = GSF
+00014cb0: 4465 636f 6465 7228 6669 6c65 5f64 6174  Decoder(file_dat
+00014cc0: 613d 7669 6465 6f5f 6461 7461 5f73 7472  a=video_data_str
+00014cd0: 6561 6d29 0a20 2020 2020 2020 2055 5554  eam).        UUT
+00014ce0: 2e64 6563 6f64 655f 6669 6c65 5f68 6561  .decode_file_hea
+00014cf0: 6465 7273 2829 0a0a 2020 2020 2020 2020  ders()..        
+00014d00: 6772 6169 6e73 203d 205b 6772 6169 6e20  grains = [grain 
+00014d10: 666f 7220 2867 7261 696e 2c20 6c6f 6361  for (grain, loca
+00014d20: 6c5f 6964 2920 696e 2055 5554 2e67 7261  l_id) in UUT.gra
+00014d30: 696e 7328 6c6f 6164 696e 675f 6d6f 6465  ins(loading_mode
+00014d40: 3d47 7261 696e 4461 7461 4c6f 6164 696e  =GrainDataLoadin
+00014d50: 674d 6f64 652e 4c4f 4144 5f49 4d4d 4544  gMode.LOAD_IMMED
+00014d60: 4941 5445 4c59 295d 0a0a 2020 2020 2020  IATELY)]..      
+00014d70: 2020 2320 5265 7374 6172 7420 7468 6520    # Restart the 
+00014d80: 6465 636f 6465 720a 2020 2020 2020 2020  decoder.        
+00014d90: 7669 6465 6f5f 6461 7461 5f73 7472 6561  video_data_strea
+00014da0: 6d2e 7365 656b 2830 290a 2020 2020 2020  m.seek(0).      
+00014db0: 2020 5555 5420 3d20 4753 4644 6563 6f64    UUT = GSFDecod
+00014dc0: 6572 2866 696c 655f 6461 7461 3d76 6964  er(file_data=vid
+00014dd0: 656f 5f64 6174 615f 7374 7265 616d 290a  eo_data_stream).
+00014de0: 2020 2020 2020 2020 5555 542e 6465 636f          UUT.deco
+00014df0: 6465 5f66 696c 655f 6865 6164 6572 7328  de_file_headers(
+00014e00: 290a 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+00014e10: 6173 7365 7274 5472 7565 2863 6f6d 7061  assertTrue(compa
+00014e20: 7265 5f67 7261 696e 2867 7261 696e 735b  re_grain(grains[
+00014e30: 305d 2c20 6e65 7874 2855 5554 2e67 7261  0], next(UUT.gra
+00014e40: 696e 7328 6c6f 6164 5f6c 617a 696c 793d  ins(load_lazily=
+00014e50: 5472 7565 2929 5b30 5d29 290a 0a20 2020  True))[0]))..   
+00014e60: 2061 7379 6e63 2064 6566 2074 6573 745f   async def test_
+00014e70: 6173 796e 635f 6c6f 6361 6c5f 6964 5f66  async_local_id_f
+00014e80: 696c 7465 7269 6e67 2873 656c 6629 3a0a  iltering(self):.
+00014e90: 2020 2020 2020 2020 696e 7465 726c 6561          interlea
+00014ea0: 7665 645f 6461 7461 5f73 7472 6561 6d20  ved_data_stream 
+00014eb0: 3d20 4173 796e 6342 7974 6573 494f 2849  = AsyncBytesIO(I
+00014ec0: 4e54 4552 4c45 4156 4544 5f44 4154 415f  NTERLEAVED_DATA_
+00014ed0: 3829 0a0a 2020 2020 2020 2020 6173 796e  8)..        asyn
+00014ee0: 6320 7769 7468 2047 5346 4465 636f 6465  c with GSFDecode
+00014ef0: 7228 6669 6c65 5f64 6174 613d 696e 7465  r(file_data=inte
+00014f00: 726c 6561 7665 645f 6461 7461 5f73 7472  rleaved_data_str
+00014f10: 6561 6d29 2061 7320 6465 633a 0a20 2020  eam) as dec:.   
+00014f20: 2020 2020 2020 2020 206c 6f63 616c 5f69           local_i
+00014f30: 6473 203d 2073 6574 2829 0a20 2020 2020  ds = set().     
+00014f40: 2020 2020 2020 2066 6c6f 775f 6964 7320         flow_ids 
+00014f50: 3d20 7365 7428 290a 2020 2020 2020 2020  = set().        
+00014f60: 2020 2020 6173 796e 6320 666f 7220 2867      async for (g
+00014f70: 7261 696e 2c20 6c6f 6361 6c5f 6964 2920  rain, local_id) 
+00014f80: 696e 2064 6563 2e67 7261 696e 7328 293a  in dec.grains():
+00014f90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014fa0: 206c 6f63 616c 5f69 6473 2e61 6464 286c   local_ids.add(l
+00014fb0: 6f63 616c 5f69 6429 0a20 2020 2020 2020  ocal_id).       
+00014fc0: 2020 2020 2020 2020 2066 6c6f 775f 6964           flow_id
+00014fd0: 732e 6164 6428 6772 6169 6e2e 666c 6f77  s.add(grain.flow
+00014fe0: 5f69 6429 0a0a 2020 2020 2020 2020 7365  _id)..        se
+00014ff0: 6c66 2e61 7373 6572 7445 7175 616c 286c  lf.assertEqual(l
+00015000: 6f63 616c 5f69 6473 2c20 7365 7428 5b31  ocal_ids, set([1
+00015010: 2c20 325d 2929 0a20 2020 2020 2020 2073  , 2])).        s
+00015020: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+00015030: 666c 6f77 5f69 6473 2c20 7365 7428 5b55  flow_ids, set([U
+00015040: 5549 4428 2732 3865 3465 3039 652d 3335  UID('28e4e09e-35
+00015050: 3137 2d31 3165 392d 3864 6132 2d35 3036  17-11e9-8da2-506
+00015060: 3566 3334 6564 3030 3727 292c 0a20 2020  5f34ed007'),.   
+00015070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015080: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015090: 2020 2020 2055 5549 4428 2732 3437 3266       UUID('2472f
+000150a0: 3338 652d 3335 3137 2d31 3165 392d 3864  38e-3517-11e9-8d
+000150b0: 6132 2d35 3036 3566 3334 6564 3030 3727  a2-5065f34ed007'
+000150c0: 295d 2929 0a0a 2020 2020 2020 2020 6173  )]))..        as
+000150d0: 796e 6320 7769 7468 2047 5346 4465 636f  ync with GSFDeco
+000150e0: 6465 7228 6669 6c65 5f64 6174 613d 696e  der(file_data=in
+000150f0: 7465 726c 6561 7665 645f 6461 7461 5f73  terleaved_data_s
+00015100: 7472 6561 6d29 2061 7320 6465 633a 0a20  tream) as dec:. 
+00015110: 2020 2020 2020 2020 2020 2061 7379 6e63             async
+00015120: 2066 6f72 2028 6772 6169 6e2c 206c 6f63   for (grain, loc
+00015130: 616c 5f69 6429 2069 6e20 6465 632e 6772  al_id) in dec.gr
+00015140: 6169 6e73 286c 6f63 616c 5f69 6473 3d5b  ains(local_ids=[
+00015150: 315d 293a 0a20 2020 2020 2020 2020 2020  1]):.           
+00015160: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00015170: 4973 496e 7374 616e 6365 2867 7261 696e  IsInstance(grain
+00015180: 2c20 4175 6469 6f47 7261 696e 290a 2020  , AudioGrain).  
+00015190: 2020 2020 2020 2020 2020 2020 2020 7365                se
+000151a0: 6c66 2e61 7373 6572 7445 7175 616c 2867  lf.assertEqual(g
+000151b0: 7261 696e 2e73 6f75 7263 655f 6964 2c20  rain.source_id, 
+000151c0: 5555 4944 2827 3166 3866 6432 3765 2d33  UUID('1f8fd27e-3
+000151d0: 3531 372d 3131 6539 2d38 6461 322d 3530  517-11e9-8da2-50
+000151e0: 3635 6633 3465 6430 3037 2729 290a 2020  65f34ed007')).  
+000151f0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00015200: 6c66 2e61 7373 6572 7445 7175 616c 2867  lf.assertEqual(g
+00015210: 7261 696e 2e66 6c6f 775f 6964 2c20 5555  rain.flow_id, UU
+00015220: 4944 2827 3238 6534 6530 3965 2d33 3531  ID('28e4e09e-351
+00015230: 372d 3131 6539 2d38 6461 322d 3530 3635  7-11e9-8da2-5065
+00015240: 6633 3465 6430 3037 2729 290a 2020 2020  f34ed007')).    
+00015250: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00015260: 2e61 7373 6572 7445 7175 616c 286c 6f63  .assertEqual(loc
+00015270: 616c 5f69 642c 2031 290a 0a20 2020 2020  al_id, 1)..     
+00015280: 2020 2061 7379 6e63 2077 6974 6820 4753     async with GS
+00015290: 4644 6563 6f64 6572 2866 696c 655f 6461  FDecoder(file_da
+000152a0: 7461 3d69 6e74 6572 6c65 6176 6564 5f64  ta=interleaved_d
+000152b0: 6174 615f 7374 7265 616d 2920 6173 2064  ata_stream) as d
+000152c0: 6563 3a0a 2020 2020 2020 2020 2020 2020  ec:.            
+000152d0: 6173 796e 6320 666f 7220 2867 7261 696e  async for (grain
+000152e0: 2c20 6c6f 6361 6c5f 6964 2920 696e 2064  , local_id) in d
+000152f0: 6563 2e67 7261 696e 7328 6c6f 6361 6c5f  ec.grains(local_
+00015300: 6964 733d 5b32 5d29 3a0a 2020 2020 2020  ids=[2]):.      
+00015310: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+00015320: 7373 6572 7449 7349 6e73 7461 6e63 6528  ssertIsInstance(
+00015330: 6772 6169 6e2c 2056 6964 656f 4772 6169  grain, VideoGrai
+00015340: 6e29 0a20 2020 2020 2020 2020 2020 2020  n).             
+00015350: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+00015360: 7561 6c28 6772 6169 6e2e 736f 7572 6365  ual(grain.source
+00015370: 5f69 642c 2055 5549 4428 2731 6638 6664  _id, UUID('1f8fd
+00015380: 3237 652d 3335 3137 2d31 3165 392d 3864  27e-3517-11e9-8d
+00015390: 6132 2d35 3036 3566 3334 6564 3030 3727  a2-5065f34ed007'
+000153a0: 2929 0a20 2020 2020 2020 2020 2020 2020  )).             
+000153b0: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+000153c0: 7561 6c28 6772 6169 6e2e 666c 6f77 5f69  ual(grain.flow_i
+000153d0: 642c 2055 5549 4428 2732 3437 3266 3338  d, UUID('2472f38
+000153e0: 652d 3335 3137 2d31 3165 392d 3864 6132  e-3517-11e9-8da2
+000153f0: 2d35 3036 3566 3334 6564 3030 3727 2929  -5065f34ed007'))
+00015400: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00015410: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+00015420: 6c28 6c6f 6361 6c5f 6964 2c20 3229 0a0a  l(local_id, 2)..
+00015430: 2020 2020 6465 6620 7465 7374 5f6c 6f63      def test_loc
+00015440: 616c 5f69 645f 6669 6c74 6572 696e 6728  al_id_filtering(
+00015450: 7365 6c66 293a 0a20 2020 2020 2020 2069  self):.        i
+00015460: 6e74 6572 6c65 6176 6564 5f64 6174 615f  nterleaved_data_
+00015470: 7374 7265 616d 203d 2042 7974 6573 494f  stream = BytesIO
+00015480: 2849 4e54 4552 4c45 4156 4544 5f44 4154  (INTERLEAVED_DAT
+00015490: 415f 3829 0a0a 2020 2020 2020 2020 7769  A_8)..        wi
+000154a0: 7468 2047 5346 4465 636f 6465 7228 6669  th GSFDecoder(fi
+000154b0: 6c65 5f64 6174 613d 696e 7465 726c 6561  le_data=interlea
+000154c0: 7665 645f 6461 7461 5f73 7472 6561 6d29  ved_data_stream)
+000154d0: 2061 7320 6465 633a 0a20 2020 2020 2020   as dec:.       
+000154e0: 2020 2020 206c 6f63 616c 5f69 6473 203d       local_ids =
+000154f0: 2073 6574 2829 0a20 2020 2020 2020 2020   set().         
+00015500: 2020 2066 6c6f 775f 6964 7320 3d20 7365     flow_ids = se
+00015510: 7428 290a 2020 2020 2020 2020 2020 2020  t().            
+00015520: 666f 7220 2867 7261 696e 2c20 6c6f 6361  for (grain, loca
+00015530: 6c5f 6964 2920 696e 2064 6563 2e67 7261  l_id) in dec.gra
+00015540: 696e 7328 293a 0a20 2020 2020 2020 2020  ins():.         
+00015550: 2020 2020 2020 206c 6f63 616c 5f69 6473         local_ids
+00015560: 2e61 6464 286c 6f63 616c 5f69 6429 0a20  .add(local_id). 
+00015570: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00015580: 6c6f 775f 6964 732e 6164 6428 6772 6169  low_ids.add(grai
+00015590: 6e2e 666c 6f77 5f69 6429 0a0a 2020 2020  n.flow_id)..    
+000155a0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+000155b0: 7175 616c 286c 6f63 616c 5f69 6473 2c20  qual(local_ids, 
+000155c0: 7365 7428 5b31 2c20 325d 2929 0a20 2020  set([1, 2])).   
+000155d0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+000155e0: 4571 7561 6c28 666c 6f77 5f69 6473 2c20  Equal(flow_ids, 
+000155f0: 7365 7428 5b55 5549 4428 2732 3865 3465  set([UUID('28e4e
+00015600: 3039 652d 3335 3137 2d31 3165 392d 3864  09e-3517-11e9-8d
+00015610: 6132 2d35 3036 3566 3334 6564 3030 3727  a2-5065f34ed007'
+00015620: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
+00015630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015640: 2020 2020 2020 2020 2020 2055 5549 4428             UUID(
+00015650: 2732 3437 3266 3338 652d 3335 3137 2d31  '2472f38e-3517-1
+00015660: 3165 392d 3864 6132 2d35 3036 3566 3334  1e9-8da2-5065f34
+00015670: 6564 3030 3727 295d 2929 0a0a 2020 2020  ed007')]))..    
+00015680: 2020 2020 696e 7465 726c 6561 7665 645f      interleaved_
+00015690: 6461 7461 5f73 7472 6561 6d2e 7365 656b  data_stream.seek
+000156a0: 2830 290a 2020 2020 2020 2020 7769 7468  (0).        with
+000156b0: 2047 5346 4465 636f 6465 7228 6669 6c65   GSFDecoder(file
+000156c0: 5f64 6174 613d 696e 7465 726c 6561 7665  _data=interleave
+000156d0: 645f 6461 7461 5f73 7472 6561 6d29 2061  d_data_stream) a
+000156e0: 7320 6465 633a 0a20 2020 2020 2020 2020  s dec:.         
+000156f0: 2020 2066 6f72 2028 6772 6169 6e2c 206c     for (grain, l
+00015700: 6f63 616c 5f69 6429 2069 6e20 6465 632e  ocal_id) in dec.
+00015710: 6772 6169 6e73 286c 6f63 616c 5f69 6473  grains(local_ids
+00015720: 3d5b 315d 293a 0a20 2020 2020 2020 2020  =[1]):.         
+00015730: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+00015740: 7274 4973 496e 7374 616e 6365 2867 7261  rtIsInstance(gra
+00015750: 696e 2c20 4175 6469 6f47 7261 696e 290a  in, AudioGrain).
+00015760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015770: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+00015780: 2867 7261 696e 2e73 6f75 7263 655f 6964  (grain.source_id
+00015790: 2c20 5555 4944 2827 3166 3866 6432 3765  , UUID('1f8fd27e
+000157a0: 2d33 3531 372d 3131 6539 2d38 6461 322d  -3517-11e9-8da2-
+000157b0: 3530 3635 6633 3465 6430 3037 2729 290a  5065f34ed007')).
+000157c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000157d0: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+000157e0: 2867 7261 696e 2e66 6c6f 775f 6964 2c20  (grain.flow_id, 
+000157f0: 5555 4944 2827 3238 6534 6530 3965 2d33  UUID('28e4e09e-3
+00015800: 3531 372d 3131 6539 2d38 6461 322d 3530  517-11e9-8da2-50
+00015810: 3635 6633 3465 6430 3037 2729 290a 2020  65f34ed007')).  
+00015820: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00015830: 6c66 2e61 7373 6572 7445 7175 616c 286c  lf.assertEqual(l
+00015840: 6f63 616c 5f69 642c 2031 290a 0a20 2020  ocal_id, 1)..   
+00015850: 2020 2020 2069 6e74 6572 6c65 6176 6564       interleaved
+00015860: 5f64 6174 615f 7374 7265 616d 2e73 6565  _data_stream.see
+00015870: 6b28 3029 0a20 2020 2020 2020 2077 6974  k(0).        wit
+00015880: 6820 4753 4644 6563 6f64 6572 2866 696c  h GSFDecoder(fil
+00015890: 655f 6461 7461 3d69 6e74 6572 6c65 6176  e_data=interleav
+000158a0: 6564 5f64 6174 615f 7374 7265 616d 2920  ed_data_stream) 
+000158b0: 6173 2064 6563 3a0a 2020 2020 2020 2020  as dec:.        
+000158c0: 2020 2020 666f 7220 2867 7261 696e 2c20      for (grain, 
+000158d0: 6c6f 6361 6c5f 6964 2920 696e 2064 6563  local_id) in dec
+000158e0: 2e67 7261 696e 7328 6c6f 6361 6c5f 6964  .grains(local_id
+000158f0: 733d 5b32 5d29 3a0a 2020 2020 2020 2020  s=[2]):.        
+00015900: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+00015910: 6572 7449 7349 6e73 7461 6e63 6528 6772  ertIsInstance(gr
+00015920: 6169 6e2c 2056 6964 656f 4772 6169 6e29  ain, VideoGrain)
+00015930: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00015940: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+00015950: 6c28 6772 6169 6e2e 736f 7572 6365 5f69  l(grain.source_i
+00015960: 642c 2055 5549 4428 2731 6638 6664 3237  d, UUID('1f8fd27
+00015970: 652d 3335 3137 2d31 3165 392d 3864 6132  e-3517-11e9-8da2
+00015980: 2d35 3036 3566 3334 6564 3030 3727 2929  -5065f34ed007'))
+00015990: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000159a0: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+000159b0: 6c28 6772 6169 6e2e 666c 6f77 5f69 642c  l(grain.flow_id,
+000159c0: 2055 5549 4428 2732 3437 3266 3338 652d   UUID('2472f38e-
+000159d0: 3335 3137 2d31 3165 392d 3864 6132 2d35  3517-11e9-8da2-5
+000159e0: 3036 3566 3334 6564 3030 3727 2929 0a20  065f34ed007')). 
+000159f0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00015a00: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+00015a10: 6c6f 6361 6c5f 6964 2c20 3229 0a0a 2020  local_id, 2)..  
+00015a20: 2020 4073 7570 7072 6573 735f 6465 7072    @suppress_depr
+00015a30: 6563 6174 696f 6e5f 7761 726e 696e 6773  ecation_warnings
+00015a40: 0a20 2020 2064 6566 2074 6573 745f 6c6f  .    def test_lo
+00015a50: 6361 6c5f 6964 5f66 696c 7465 7269 6e67  cal_id_filtering
+00015a60: 5f5f 6465 7072 6563 6174 6564 2873 656c  __deprecated(sel
+00015a70: 6629 3a0a 2020 2020 2020 2020 696e 7465  f):.        inte
+00015a80: 726c 6561 7665 645f 6461 7461 5f73 7472  rleaved_data_str
+00015a90: 6561 6d20 3d20 4279 7465 7349 4f28 494e  eam = BytesIO(IN
+00015aa0: 5445 524c 4541 5645 445f 4441 5441 5f38  TERLEAVED_DATA_8
+00015ab0: 290a 0a20 2020 2020 2020 2055 5554 203d  )..        UUT =
+00015ac0: 2047 5346 4465 636f 6465 7228 6669 6c65   GSFDecoder(file
+00015ad0: 5f64 6174 613d 696e 7465 726c 6561 7665  _data=interleave
+00015ae0: 645f 6461 7461 5f73 7472 6561 6d29 0a20  d_data_stream). 
+00015af0: 2020 2020 2020 2055 5554 2e64 6563 6f64         UUT.decod
+00015b00: 655f 6669 6c65 5f68 6561 6465 7273 2829  e_file_headers()
+00015b10: 0a0a 2020 2020 2020 2020 6c6f 6361 6c5f  ..        local_
+00015b20: 6964 7320 3d20 7365 7428 290a 2020 2020  ids = set().    
+00015b30: 2020 2020 666c 6f77 5f69 6473 203d 2073      flow_ids = s
+00015b40: 6574 2829 0a20 2020 2020 2020 2066 6f72  et().        for
+00015b50: 2028 6772 6169 6e2c 206c 6f63 616c 5f69   (grain, local_i
+00015b60: 6429 2069 6e20 5555 542e 6772 6169 6e73  d) in UUT.grains
+00015b70: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
+00015b80: 6c6f 6361 6c5f 6964 732e 6164 6428 6c6f  local_ids.add(lo
+00015b90: 6361 6c5f 6964 290a 2020 2020 2020 2020  cal_id).        
+00015ba0: 2020 2020 666c 6f77 5f69 6473 2e61 6464      flow_ids.add
+00015bb0: 2867 7261 696e 2e66 6c6f 775f 6964 290a  (grain.flow_id).
+00015bc0: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+00015bd0: 7365 7274 4571 7561 6c28 6c6f 6361 6c5f  sertEqual(local_
+00015be0: 6964 732c 2073 6574 285b 312c 2032 5d29  ids, set([1, 2])
+00015bf0: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+00015c00: 7373 6572 7445 7175 616c 2866 6c6f 775f  ssertEqual(flow_
+00015c10: 6964 732c 2073 6574 285b 5555 4944 2827  ids, set([UUID('
+00015c20: 3238 6534 6530 3965 2d33 3531 372d 3131  28e4e09e-3517-11
+00015c30: 6539 2d38 6461 322d 3530 3635 6633 3465  e9-8da2-5065f34e
+00015c40: 6430 3037 2729 2c0a 2020 2020 2020 2020  d007'),.        
+00015c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015c70: 5555 4944 2827 3234 3732 6633 3865 2d33  UUID('2472f38e-3
+00015c80: 3531 372d 3131 6539 2d38 6461 322d 3530  517-11e9-8da2-50
+00015c90: 3635 6633 3465 6430 3037 2729 5d29 290a  65f34ed007')])).
+00015ca0: 0a20 2020 2020 2020 2069 6e74 6572 6c65  .        interle
+00015cb0: 6176 6564 5f64 6174 615f 7374 7265 616d  aved_data_stream
+00015cc0: 2e73 6565 6b28 3029 0a20 2020 2020 2020  .seek(0).       
+00015cd0: 2055 5554 2e64 6563 6f64 655f 6669 6c65   UUT.decode_file
+00015ce0: 5f68 6561 6465 7273 2829 0a0a 2020 2020  _headers()..    
+00015cf0: 2020 2020 666f 7220 2867 7261 696e 2c20      for (grain, 
+00015d00: 6c6f 6361 6c5f 6964 2920 696e 2055 5554  local_id) in UUT
+00015d10: 2e67 7261 696e 7328 6c6f 6361 6c5f 6964  .grains(local_id
+00015d20: 733d 5b31 5d29 3a0a 2020 2020 2020 2020  s=[1]):.        
+00015d30: 2020 2020 7365 6c66 2e61 7373 6572 7449      self.assertI
+00015d40: 7349 6e73 7461 6e63 6528 6772 6169 6e2c  sInstance(grain,
+00015d50: 2041 7564 696f 4772 6169 6e29 0a20 2020   AudioGrain).   
+00015d60: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
+00015d70: 7365 7274 4571 7561 6c28 6772 6169 6e2e  sertEqual(grain.
+00015d80: 736f 7572 6365 5f69 642c 2055 5549 4428  source_id, UUID(
+00015d90: 2731 6638 6664 3237 652d 3335 3137 2d31  '1f8fd27e-3517-1
+00015da0: 3165 392d 3864 6132 2d35 3036 3566 3334  1e9-8da2-5065f34
+00015db0: 6564 3030 3727 2929 0a20 2020 2020 2020  ed007')).       
+00015dc0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00015dd0: 4571 7561 6c28 6772 6169 6e2e 666c 6f77  Equal(grain.flow
+00015de0: 5f69 642c 2055 5549 4428 2732 3865 3465  _id, UUID('28e4e
+00015df0: 3039 652d 3335 3137 2d31 3165 392d 3864  09e-3517-11e9-8d
+00015e00: 6132 2d35 3036 3566 3334 6564 3030 3727  a2-5065f34ed007'
+00015e10: 2929 0a20 2020 2020 2020 2020 2020 2073  )).            s
+00015e20: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+00015e30: 6c6f 6361 6c5f 6964 2c20 3129 0a0a 2020  local_id, 1)..  
+00015e40: 2020 2020 2020 696e 7465 726c 6561 7665        interleave
+00015e50: 645f 6461 7461 5f73 7472 6561 6d2e 7365  d_data_stream.se
+00015e60: 656b 2830 290a 2020 2020 2020 2020 5555  ek(0).        UU
+00015e70: 542e 6465 636f 6465 5f66 696c 655f 6865  T.decode_file_he
+00015e80: 6164 6572 7328 290a 0a20 2020 2020 2020  aders()..       
+00015e90: 2066 6f72 2028 6772 6169 6e2c 206c 6f63   for (grain, loc
+00015ea0: 616c 5f69 6429 2069 6e20 5555 542e 6772  al_id) in UUT.gr
+00015eb0: 6169 6e73 286c 6f63 616c 5f69 6473 3d5b  ains(local_ids=[
+00015ec0: 325d 293a 0a20 2020 2020 2020 2020 2020  2]):.           
+00015ed0: 2073 656c 662e 6173 7365 7274 4973 496e   self.assertIsIn
+00015ee0: 7374 616e 6365 2867 7261 696e 2c20 5669  stance(grain, Vi
+00015ef0: 6465 6f47 7261 696e 290a 2020 2020 2020  deoGrain).      
+00015f00: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00015f10: 7445 7175 616c 2867 7261 696e 2e73 6f75  tEqual(grain.sou
+00015f20: 7263 655f 6964 2c20 5555 4944 2827 3166  rce_id, UUID('1f
+00015f30: 3866 6432 3765 2d33 3531 372d 3131 6539  8fd27e-3517-11e9
+00015f40: 2d38 6461 322d 3530 3635 6633 3465 6430  -8da2-5065f34ed0
+00015f50: 3037 2729 290a 2020 2020 2020 2020 2020  07')).          
+00015f60: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+00015f70: 616c 2867 7261 696e 2e66 6c6f 775f 6964  al(grain.flow_id
+00015f80: 2c20 5555 4944 2827 3234 3732 6633 3865  , UUID('2472f38e
+00015f90: 2d33 3531 372d 3131 6539 2d38 6461 322d  -3517-11e9-8da2-
+00015fa0: 3530 3635 6633 3465 6430 3037 2729 290a  5065f34ed007')).
+00015fb0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00015fc0: 2e61 7373 6572 7445 7175 616c 286c 6f63  .assertEqual(loc
+00015fd0: 616c 5f69 642c 2032 290a 0a20 2020 2040  al_id, 2)..    @
+00015fe0: 7375 7070 7265 7373 5f64 6570 7265 6361  suppress_depreca
+00015ff0: 7469 6f6e 5f77 6172 6e69 6e67 730a 2020  tion_warnings.  
+00016000: 2020 6465 6620 7465 7374 5f73 6b69 705f    def test_skip_
+00016010: 6772 6169 6e5f 6461 7461 5f5f 6465 7072  grain_data__depr
+00016020: 6563 6174 6564 2873 656c 6629 3a0a 2020  ecated(self):.  
+00016030: 2020 2020 2020 2222 2254 6573 7420 7468        """Test th
+00016040: 6174 2074 6865 2060 736b 6970 5f64 6174  at the `skip_dat
+00016050: 6160 2070 6172 616d 6574 6572 2063 6175  a` parameter cau
+00016060: 7365 7320 6772 6169 6e20 6461 7461 2074  ses grain data t
+00016070: 6f20 6265 2073 6565 6b65 6420 6f76 6572  o be seeked over
+00016080: 2222 220a 2020 2020 2020 2020 6772 6169  """.        grai
+00016090: 6e5f 7369 7a65 203d 2031 3934 3631 3220  n_size = 194612 
+000160a0: 2023 2050 6172 7365 6420 6672 6f6d 2065   # Parsed from e
+000160b0: 7861 6d70 6c65 732f 7669 6465 6f2e 6773  xamples/video.gs
+000160c0: 6620 6865 7820 6475 6d70 0a20 2020 2020  f hex dump.     
+000160d0: 2020 2067 7264 745f 626c 6f63 6b5f 7369     grdt_block_si
+000160e0: 7a65 203d 2031 3934 3430 3820 2023 2050  ze = 194408  # P
+000160f0: 6172 7365 6420 6672 6f6d 2065 7861 6d70  arsed from examp
+00016100: 6c65 732f 7669 6465 6f2e 6773 6620 6865  les/video.gsf he
+00016110: 7820 6475 6d70 0a20 2020 2020 2020 2067  x dump.        g
+00016120: 7261 696e 5f68 6561 6465 725f 7369 7a65  rain_header_size
+00016130: 203d 2067 7261 696e 5f73 697a 6520 2d20   = grain_size - 
+00016140: 6772 6474 5f62 6c6f 636b 5f73 697a 650a  grdt_block_size.
+00016150: 0a20 2020 2020 2020 2076 6964 656f 5f64  .        video_d
+00016160: 6174 615f 7374 7265 616d 203d 2042 7974  ata_stream = Byt
+00016170: 6573 494f 2856 4944 454f 5f44 4154 415f  esIO(VIDEO_DATA_
+00016180: 3829 0a0a 2020 2020 2020 2020 5555 5420  8)..        UUT 
+00016190: 3d20 4753 4644 6563 6f64 6572 2866 696c  = GSFDecoder(fil
+000161a0: 655f 6461 7461 3d76 6964 656f 5f64 6174  e_data=video_dat
+000161b0: 615f 7374 7265 616d 290a 2020 2020 2020  a_stream).      
+000161c0: 2020 5555 542e 6465 636f 6465 5f66 696c    UUT.decode_fil
+000161d0: 655f 6865 6164 6572 7328 290a 0a20 2020  e_headers()..   
+000161e0: 2020 2020 2072 6561 6465 725f 6d6f 636b       reader_mock
+000161f0: 203d 206d 6f63 6b2e 4d61 6769 634d 6f63   = mock.MagicMoc
+00016200: 6b28 7369 6465 5f65 6666 6563 743d 7669  k(side_effect=vi
+00016210: 6465 6f5f 6461 7461 5f73 7472 6561 6d2e  deo_data_stream.
+00016220: 7265 6164 290a 2020 2020 2020 2020 7769  read).        wi
+00016230: 7468 206d 6f63 6b2e 7061 7463 682e 6f62  th mock.patch.ob
+00016240: 6a65 6374 2876 6964 656f 5f64 6174 615f  ject(video_data_
+00016250: 7374 7265 616d 2c20 2272 6561 6422 2c20  stream, "read", 
+00016260: 6e65 773d 7265 6164 6572 5f6d 6f63 6b29  new=reader_mock)
+00016270: 3a0a 2020 2020 2020 2020 2020 2020 666f  :.            fo
+00016280: 7220 2867 7261 696e 2c20 6c6f 6361 6c5f  r (grain, local_
+00016290: 6964 2920 696e 2055 5554 2e67 7261 696e  id) in UUT.grain
+000162a0: 7328 736b 6970 5f64 6174 613d 5472 7565  s(skip_data=True
+000162b0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+000162c0: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+000162d0: 7561 6c28 302c 206c 656e 2867 7261 696e  ual(0, len(grain
+000162e0: 2e64 6174 6129 290a 0a20 2020 2020 2020  .data))..       
+000162f0: 2020 2020 2020 2020 2023 2041 6464 2075           # Add u
+00016300: 7020 7468 6520 6279 7465 7320 7265 6164  p the bytes read
+00016310: 2066 6f72 2074 6869 7320 6772 6169 6e2c   for this grain,
+00016320: 2074 6865 6e20 7265 7365 7420 7468 6520   then reset the 
+00016330: 7265 6164 2063 6f75 6e74 6572 0a20 2020  read counter.   
+00016340: 2020 2020 2020 2020 2020 2020 2062 7974               byt
+00016350: 6573 5f72 6561 6420 3d20 300a 2020 2020  es_read = 0.    
+00016360: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00016370: 6172 6773 2c20 5f20 696e 2072 6561 6465  args, _ in reade
+00016380: 725f 6d6f 636b 2e63 616c 6c5f 6172 6773  r_mock.call_args
+00016390: 5f6c 6973 743a 0a20 2020 2020 2020 2020  _list:.         
+000163a0: 2020 2020 2020 2020 2020 2062 7974 6573             bytes
+000163b0: 5f72 6561 6420 2b3d 2061 7267 735b 305d  _read += args[0]
+000163c0: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000163d0: 2020 7265 6164 6572 5f6d 6f63 6b2e 7265    reader_mock.re
+000163e0: 7365 745f 6d6f 636b 2829 0a0a 2020 2020  set_mock()..    
+000163f0: 2020 2020 2020 2020 2020 2020 2320 4e6f              # No
+00016400: 206d 6f72 6520 7468 616e 2074 6865 206e   more than the n
+00016410: 756d 6265 7220 6f66 2062 7974 6573 2069  umber of bytes i
+00016420: 6e20 7468 6520 6865 6164 6572 2073 686f  n the header sho
+00016430: 756c 6420 6861 7665 2062 6565 6e20 7265  uld have been re
+00016440: 6164 0a20 2020 2020 2020 2020 2020 2020  ad.             
+00016450: 2020 2023 2048 6f77 6576 6572 2073 6f6d     # However som
+00016460: 6520 6865 6164 6572 2062 7974 6573 206d  e header bytes m
+00016470: 6179 2062 6520 7365 656b 6564 206f 7665  ay be seeked ove
+00016480: 7220 696e 7374 6561 640a 2020 2020 2020  r instead.      
+00016490: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+000164a0: 7373 6572 744c 6573 7345 7175 616c 2862  ssertLessEqual(b
+000164b0: 7974 6573 5f72 6561 642c 2067 7261 696e  ytes_read, grain
+000164c0: 5f68 6561 6465 725f 7369 7a65 290a 0a20  _header_size).. 
+000164d0: 2020 2064 6566 2074 6573 745f 6c61 7a79     def test_lazy
+000164e0: 5f6c 6f61 645f 6772 6169 6e5f 6461 7461  _load_grain_data
+000164f0: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+00016500: 2222 2254 6573 7420 7468 6174 2074 6865  """Test that the
+00016510: 2060 6c6f 6164 5f6c 617a 696c 7960 2070   `load_lazily` p
+00016520: 6172 616d 6574 6572 2063 6175 7365 7320  arameter causes 
+00016530: 6772 6169 6e20 6461 7461 2074 6f20 6265  grain data to be
+00016540: 2073 6565 6b65 6420 6f76 6572 2c0a 2020   seeked over,.  
+00016550: 2020 2020 2020 6275 7420 7468 656e 206c        but then l
+00016560: 6f61 6465 6420 696e 7669 7369 626c 7920  oaded invisibly 
+00016570: 7768 656e 206e 6565 6465 6420 6c61 7465  when needed late
+00016580: 7222 2222 0a20 2020 2020 2020 2067 7261  r""".        gra
+00016590: 696e 5f73 697a 6520 3d20 3139 3436 3132  in_size = 194612
+000165a0: 2020 2320 5061 7273 6564 2066 726f 6d20    # Parsed from 
+000165b0: 6578 616d 706c 6573 2f76 6964 656f 2e67  examples/video.g
+000165c0: 7366 2068 6578 2064 756d 700a 2020 2020  sf hex dump.    
+000165d0: 2020 2020 6772 6474 5f62 6c6f 636b 5f73      grdt_block_s
+000165e0: 697a 6520 3d20 3139 3434 3038 2020 2320  ize = 194408  # 
+000165f0: 5061 7273 6564 2066 726f 6d20 6578 616d  Parsed from exam
+00016600: 706c 6573 2f76 6964 656f 2e67 7366 2068  ples/video.gsf h
+00016610: 6578 2064 756d 700a 2020 2020 2020 2020  ex dump.        
+00016620: 6772 6169 6e5f 6865 6164 6572 5f73 697a  grain_header_siz
+00016630: 6520 3d20 6772 6169 6e5f 7369 7a65 202d  e = grain_size -
+00016640: 2067 7264 745f 626c 6f63 6b5f 7369 7a65   grdt_block_size
+00016650: 0a20 2020 2020 2020 2067 7261 696e 5f64  .        grain_d
+00016660: 6174 615f 7369 7a65 203d 2067 7264 745f  ata_size = grdt_
+00016670: 626c 6f63 6b5f 7369 7a65 202d 2038 0a0a  block_size - 8..
+00016680: 2020 2020 2020 2020 7669 6465 6f5f 6461          video_da
+00016690: 7461 5f73 7472 6561 6d20 3d20 4279 7465  ta_stream = Byte
+000166a0: 7349 4f28 5649 4445 4f5f 4441 5441 5f38  sIO(VIDEO_DATA_8
+000166b0: 290a 0a20 2020 2020 2020 2072 6561 6465  )..        reade
+000166c0: 725f 6d6f 636b 203d 206d 6f63 6b2e 4d61  r_mock = mock.Ma
+000166d0: 6769 634d 6f63 6b28 7369 6465 5f65 6666  gicMock(side_eff
+000166e0: 6563 743d 7669 6465 6f5f 6461 7461 5f73  ect=video_data_s
+000166f0: 7472 6561 6d2e 7265 6164 290a 2020 2020  tream.read).    
+00016700: 2020 2020 7769 7468 206d 6f63 6b2e 7061      with mock.pa
+00016710: 7463 682e 6f62 6a65 6374 2876 6964 656f  tch.object(video
+00016720: 5f64 6174 615f 7374 7265 616d 2c20 2272  _data_stream, "r
+00016730: 6561 6422 2c20 6e65 773d 7265 6164 6572  ead", new=reader
+00016740: 5f6d 6f63 6b29 3a0a 2020 2020 2020 2020  _mock):.        
+00016750: 2020 2020 6772 6169 6e73 203d 205b 5d0a      grains = [].
+00016760: 2020 2020 2020 2020 2020 2020 7769 7468              with
+00016770: 2047 5346 4465 636f 6465 7228 6669 6c65   GSFDecoder(file
+00016780: 5f64 6174 613d 7669 6465 6f5f 6461 7461  _data=video_data
+00016790: 5f73 7472 6561 6d29 2061 7320 6465 633a  _stream) as dec:
+000167a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000167b0: 2072 6561 6465 725f 6d6f 636b 2e72 6573   reader_mock.res
+000167c0: 6574 5f6d 6f63 6b28 290a 0a20 2020 2020  et_mock()..     
+000167d0: 2020 2020 2020 2020 2020 2066 6f72 2028             for (
+000167e0: 6772 6169 6e2c 206c 6f63 616c 5f69 6429  grain, local_id)
+000167f0: 2069 6e20 6465 632e 6772 6169 6e73 286c   in dec.grains(l
+00016800: 6f61 6469 6e67 5f6d 6f64 653d 4772 6169  oading_mode=Grai
+00016810: 6e44 6174 614c 6f61 6469 6e67 4d6f 6465  nDataLoadingMode
+00016820: 2e41 4c57 4159 535f 4445 4645 525f 4c4f  .ALWAYS_DEFER_LO
+00016830: 4144 5f49 465f 504f 5353 4942 4c45 293a  AD_IF_POSSIBLE):
+00016840: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00016850: 2020 2020 2067 7261 696e 732e 6170 7065       grains.appe
+00016860: 6e64 2867 7261 696e 290a 2020 2020 2020  nd(grain).      
+00016870: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+00016880: 4164 6420 7570 2074 6865 2062 7974 6573  Add up the bytes
+00016890: 2072 6561 6420 666f 7220 7468 6973 2067   read for this g
+000168a0: 7261 696e 2c20 7468 656e 2072 6573 6574  rain, then reset
+000168b0: 2074 6865 2072 6561 6420 636f 756e 7465   the read counte
+000168c0: 720a 2020 2020 2020 2020 2020 2020 2020  r.              
+000168d0: 2020 2020 2020 6279 7465 735f 7265 6164        bytes_read
+000168e0: 203d 2030 0a20 2020 2020 2020 2020 2020   = 0.           
+000168f0: 2020 2020 2020 2020 2066 6f72 2061 7267           for arg
+00016900: 732c 205f 2069 6e20 7265 6164 6572 5f6d  s, _ in reader_m
+00016910: 6f63 6b2e 6361 6c6c 5f61 7267 735f 6c69  ock.call_args_li
+00016920: 7374 3a0a 2020 2020 2020 2020 2020 2020  st:.            
+00016930: 2020 2020 2020 2020 2020 2020 6279 7465              byte
+00016940: 735f 7265 6164 202b 3d20 6172 6773 5b30  s_read += args[0
+00016950: 5d0a 0a20 2020 2020 2020 2020 2020 2020  ]..             
+00016960: 2020 2020 2020 2072 6561 6465 725f 6d6f         reader_mo
+00016970: 636b 2e72 6573 6574 5f6d 6f63 6b28 290a  ck.reset_mock().
+00016980: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00016990: 2020 2020 2023 204e 6f20 6d6f 7265 2074       # No more t
+000169a0: 6861 6e20 7468 6520 6e75 6d62 6572 206f  han the number o
+000169b0: 6620 6279 7465 7320 696e 2074 6865 2068  f bytes in the h
+000169c0: 6561 6465 7220 7368 6f75 6c64 2068 6176  eader should hav
+000169d0: 6520 6265 656e 2072 6561 640a 2020 2020  e been read.    
+000169e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000169f0: 2320 486f 7765 7665 7220 736f 6d65 2068  # However some h
+00016a00: 6561 6465 7220 6279 7465 7320 6d61 7920  eader bytes may 
+00016a10: 6265 2073 6565 6b65 6420 6f76 6572 2069  be seeked over i
+00016a20: 6e73 7465 6164 0a20 2020 2020 2020 2020  nstead.         
+00016a30: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00016a40: 6173 7365 7274 4772 6561 7465 7228 6279  assertGreater(by
+00016a50: 7465 735f 7265 6164 2c20 3029 0a20 2020  tes_read, 0).   
+00016a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016a70: 2073 656c 662e 6173 7365 7274 4c65 7373   self.assertLess
+00016a80: 4571 7561 6c28 6279 7465 735f 7265 6164  Equal(bytes_read
+00016a90: 2c20 6772 6169 6e5f 6865 6164 6572 5f73  , grain_header_s
+00016aa0: 697a 6529 0a0a 2020 2020 2020 2020 2020  ize)..          
+00016ab0: 2020 666f 7220 6772 6169 6e20 696e 2067    for grain in g
+00016ac0: 7261 696e 733a 0a20 2020 2020 2020 2020  rains:.         
+00016ad0: 2020 2020 2020 2072 6561 6465 725f 6d6f         reader_mo
+00016ae0: 636b 2e72 6573 6574 5f6d 6f63 6b28 290a  ck.reset_mock().
+00016af0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00016b00: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+00016b10: 6c28 6772 6169 6e2e 6c65 6e67 7468 2c20  l(grain.length, 
+00016b20: 6772 6169 6e5f 6461 7461 5f73 697a 6529  grain_data_size)
+00016b30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00016b40: 2072 6561 6465 725f 6d6f 636b 2e61 7373   reader_mock.ass
+00016b50: 6572 745f 6e6f 745f 6361 6c6c 6564 2829  ert_not_called()
+00016b60: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00016b70: 2020 7820 3d20 6772 6169 6e2e 6461 7461    x = grain.data
+00016b80: 5b67 7261 696e 5f64 6174 615f 7369 7a65  [grain_data_size
+00016b90: 2d31 5d20 2023 206e 6f71 613a 2046 3834  -1]  # noqa: F84
+00016ba0: 310a 2020 2020 2020 2020 2020 2020 2020  1.              
+00016bb0: 2020 6279 7465 735f 7265 6164 203d 2030    bytes_read = 0
+00016bc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00016bd0: 2066 6f72 2028 6172 6773 2c20 5f29 2069   for (args, _) i
+00016be0: 6e20 7265 6164 6572 5f6d 6f63 6b2e 6361  n reader_mock.ca
+00016bf0: 6c6c 5f61 7267 735f 6c69 7374 3a0a 2020  ll_args_list:.  
+00016c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016c10: 2020 6279 7465 735f 7265 6164 202b 3d20    bytes_read += 
+00016c20: 6172 6773 5b30 5d0a 0a20 2020 2020 2020  args[0]..       
+00016c30: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
+00016c40: 7365 7274 4571 7561 6c28 6279 7465 735f  sertEqual(bytes_
+00016c50: 7265 6164 2c20 6772 6169 6e5f 6461 7461  read, grain_data
+00016c60: 5f73 697a 6529 0a20 2020 2020 2020 2020  _size).         
+00016c70: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+00016c80: 7274 4571 7561 6c28 6772 6169 6e2e 6c65  rtEqual(grain.le
+00016c90: 6e67 7468 2c20 6772 6169 6e5f 6461 7461  ngth, grain_data
+00016ca0: 5f73 697a 6529 0a0a 2020 2020 4073 7570  _size)..    @sup
+00016cb0: 7072 6573 735f 6465 7072 6563 6174 696f  press_deprecatio
+00016cc0: 6e5f 7761 726e 696e 6773 0a20 2020 2064  n_warnings.    d
+00016cd0: 6566 2074 6573 745f 6c61 7a79 5f6c 6f61  ef test_lazy_loa
+00016ce0: 645f 6772 6169 6e5f 6461 7461 5f5f 6465  d_grain_data__de
+00016cf0: 7072 6563 6174 6564 2873 656c 6629 3a0a  precated(self):.
+00016d00: 2020 2020 2020 2020 2222 2254 6573 7420          """Test 
+00016d10: 7468 6174 2074 6865 2060 6c6f 6164 5f6c  that the `load_l
+00016d20: 617a 696c 7960 2070 6172 616d 6574 6572  azily` parameter
+00016d30: 2063 6175 7365 7320 6772 6169 6e20 6461   causes grain da
+00016d40: 7461 2074 6f20 6265 2073 6565 6b65 6420  ta to be seeked 
+00016d50: 6f76 6572 2c0a 2020 2020 2020 2020 6275  over,.        bu
+00016d60: 7420 7468 656e 206c 6f61 6465 6420 696e  t then loaded in
+00016d70: 7669 7369 626c 7920 7768 656e 206e 6565  visibly when nee
+00016d80: 6465 6420 6c61 7465 7222 2222 0a20 2020  ded later""".   
+00016d90: 2020 2020 2067 7261 696e 5f73 697a 6520       grain_size 
+00016da0: 3d20 3139 3436 3132 2020 2320 5061 7273  = 194612  # Pars
+00016db0: 6564 2066 726f 6d20 6578 616d 706c 6573  ed from examples
+00016dc0: 2f76 6964 656f 2e67 7366 2068 6578 2064  /video.gsf hex d
+00016dd0: 756d 700a 2020 2020 2020 2020 6772 6474  ump.        grdt
+00016de0: 5f62 6c6f 636b 5f73 697a 6520 3d20 3139  _block_size = 19
+00016df0: 3434 3038 2020 2320 5061 7273 6564 2066  4408  # Parsed f
+00016e00: 726f 6d20 6578 616d 706c 6573 2f76 6964  rom examples/vid
+00016e10: 656f 2e67 7366 2068 6578 2064 756d 700a  eo.gsf hex dump.
+00016e20: 2020 2020 2020 2020 6772 6169 6e5f 6865          grain_he
+00016e30: 6164 6572 5f73 697a 6520 3d20 6772 6169  ader_size = grai
+00016e40: 6e5f 7369 7a65 202d 2067 7264 745f 626c  n_size - grdt_bl
+00016e50: 6f63 6b5f 7369 7a65 0a20 2020 2020 2020  ock_size.       
+00016e60: 2067 7261 696e 5f64 6174 615f 7369 7a65   grain_data_size
+00016e70: 203d 2067 7264 745f 626c 6f63 6b5f 7369   = grdt_block_si
+00016e80: 7a65 202d 2038 0a0a 2020 2020 2020 2020  ze - 8..        
+00016e90: 7669 6465 6f5f 6461 7461 5f73 7472 6561  video_data_strea
+00016ea0: 6d20 3d20 4279 7465 7349 4f28 5649 4445  m = BytesIO(VIDE
+00016eb0: 4f5f 4441 5441 5f38 290a 0a20 2020 2020  O_DATA_8)..     
+00016ec0: 2020 2055 5554 203d 2047 5346 4465 636f     UUT = GSFDeco
+00016ed0: 6465 7228 6669 6c65 5f64 6174 613d 7669  der(file_data=vi
+00016ee0: 6465 6f5f 6461 7461 5f73 7472 6561 6d29  deo_data_stream)
+00016ef0: 0a20 2020 2020 2020 2055 5554 2e64 6563  .        UUT.dec
+00016f00: 6f64 655f 6669 6c65 5f68 6561 6465 7273  ode_file_headers
+00016f10: 2829 0a0a 2020 2020 2020 2020 6772 6169  ()..        grai
+00016f20: 6e73 203d 205b 5d0a 2020 2020 2020 2020  ns = [].        
+00016f30: 7265 6164 6572 5f6d 6f63 6b20 3d20 6d6f  reader_mock = mo
+00016f40: 636b 2e4d 6167 6963 4d6f 636b 2873 6964  ck.MagicMock(sid
+00016f50: 655f 6566 6665 6374 3d76 6964 656f 5f64  e_effect=video_d
+00016f60: 6174 615f 7374 7265 616d 2e72 6561 6429  ata_stream.read)
+00016f70: 0a20 2020 2020 2020 2077 6974 6820 6d6f  .        with mo
+00016f80: 636b 2e70 6174 6368 2e6f 626a 6563 7428  ck.patch.object(
+00016f90: 7669 6465 6f5f 6461 7461 5f73 7472 6561  video_data_strea
+00016fa0: 6d2c 2022 7265 6164 222c 206e 6577 3d72  m, "read", new=r
+00016fb0: 6561 6465 725f 6d6f 636b 293a 0a20 2020  eader_mock):.   
+00016fc0: 2020 2020 2020 2020 2066 6f72 2028 6772           for (gr
+00016fd0: 6169 6e2c 206c 6f63 616c 5f69 6429 2069  ain, local_id) i
+00016fe0: 6e20 5555 542e 6772 6169 6e73 286c 6f61  n UUT.grains(loa
+00016ff0: 645f 6c61 7a69 6c79 3d54 7275 6529 3a0a  d_lazily=True):.
+00017000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017010: 6772 6169 6e73 2e61 7070 656e 6428 6772  grains.append(gr
+00017020: 6169 6e29 0a20 2020 2020 2020 2020 2020  ain).           
+00017030: 2020 2020 2023 2041 6464 2075 7020 7468       # Add up th
+00017040: 6520 6279 7465 7320 7265 6164 2066 6f72  e bytes read for
+00017050: 2074 6869 7320 6772 6169 6e2c 2074 6865   this grain, the
+00017060: 6e20 7265 7365 7420 7468 6520 7265 6164  n reset the read
+00017070: 2063 6f75 6e74 6572 0a20 2020 2020 2020   counter.       
+00017080: 2020 2020 2020 2020 2062 7974 6573 5f72           bytes_r
+00017090: 6561 6420 3d20 300a 2020 2020 2020 2020  ead = 0.        
+000170a0: 2020 2020 2020 2020 666f 7220 6172 6773          for args
+000170b0: 2c20 5f20 696e 2072 6561 6465 725f 6d6f  , _ in reader_mo
+000170c0: 636b 2e63 616c 6c5f 6172 6773 5f6c 6973  ck.call_args_lis
+000170d0: 743a 0a20 2020 2020 2020 2020 2020 2020  t:.             
+000170e0: 2020 2020 2020 2062 7974 6573 5f72 6561         bytes_rea
+000170f0: 6420 2b3d 2061 7267 735b 305d 0a0a 2020  d += args[0]..  
+00017100: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00017110: 6164 6572 5f6d 6f63 6b2e 7265 7365 745f  ader_mock.reset_
+00017120: 6d6f 636b 2829 0a0a 2020 2020 2020 2020  mock()..        
+00017130: 2020 2020 2020 2020 2320 4e6f 206d 6f72          # No mor
+00017140: 6520 7468 616e 2074 6865 206e 756d 6265  e than the numbe
+00017150: 7220 6f66 2062 7974 6573 2069 6e20 7468  r of bytes in th
+00017160: 6520 6865 6164 6572 2073 686f 756c 6420  e header should 
+00017170: 6861 7665 2062 6565 6e20 7265 6164 0a20  have been read. 
+00017180: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00017190: 2048 6f77 6576 6572 2073 6f6d 6520 6865   However some he
+000171a0: 6164 6572 2062 7974 6573 206d 6179 2062  ader bytes may b
+000171b0: 6520 7365 656b 6564 206f 7665 7220 696e  e seeked over in
+000171c0: 7374 6561 640a 2020 2020 2020 2020 2020  stead.          
+000171d0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+000171e0: 7447 7265 6174 6572 2862 7974 6573 5f72  tGreater(bytes_r
+000171f0: 6561 642c 2030 290a 2020 2020 2020 2020  ead, 0).        
+00017200: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+00017210: 6572 744c 6573 7345 7175 616c 2862 7974  ertLessEqual(byt
+00017220: 6573 5f72 6561 642c 2067 7261 696e 5f68  es_read, grain_h
+00017230: 6561 6465 725f 7369 7a65 290a 0a20 2020  eader_size)..   
+00017240: 2020 2020 2020 2020 2066 6f72 2067 7261           for gra
+00017250: 696e 2069 6e20 6772 6169 6e73 3a0a 2020  in in grains:.  
+00017260: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00017270: 6164 6572 5f6d 6f63 6b2e 7265 7365 745f  ader_mock.reset_
+00017280: 6d6f 636b 2829 0a0a 2020 2020 2020 2020  mock()..        
+00017290: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+000172a0: 6572 7445 7175 616c 2867 7261 696e 2e6c  ertEqual(grain.l
+000172b0: 656e 6774 682c 2067 7261 696e 5f64 6174  ength, grain_dat
+000172c0: 615f 7369 7a65 290a 2020 2020 2020 2020  a_size).        
+000172d0: 2020 2020 2020 2020 7265 6164 6572 5f6d          reader_m
+000172e0: 6f63 6b2e 6173 7365 7274 5f6e 6f74 5f63  ock.assert_not_c
+000172f0: 616c 6c65 6428 290a 0a20 2020 2020 2020  alled()..       
+00017300: 2020 2020 2020 2020 2078 203d 2067 7261           x = gra
+00017310: 696e 2e64 6174 615b 6772 6169 6e5f 6461  in.data[grain_da
+00017320: 7461 5f73 697a 652d 315d 2020 2320 6e6f  ta_size-1]  # no
+00017330: 7161 3a20 4638 3431 0a20 2020 2020 2020  qa: F841.       
+00017340: 2020 2020 2020 2020 2062 7974 6573 5f72           bytes_r
+00017350: 6561 6420 3d20 300a 2020 2020 2020 2020  ead = 0.        
+00017360: 2020 2020 2020 2020 666f 7220 2861 7267          for (arg
+00017370: 732c 205f 2920 696e 2072 6561 6465 725f  s, _) in reader_
+00017380: 6d6f 636b 2e63 616c 6c5f 6172 6773 5f6c  mock.call_args_l
+00017390: 6973 743a 0a20 2020 2020 2020 2020 2020  ist:.           
+000173a0: 2020 2020 2020 2020 2062 7974 6573 5f72           bytes_r
+000173b0: 6561 6420 2b3d 2061 7267 735b 305d 0a0a  ead += args[0]..
+000173c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000173d0: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+000173e0: 2862 7974 6573 5f72 6561 642c 2067 7261  (bytes_read, gra
+000173f0: 696e 5f64 6174 615f 7369 7a65 290a 2020  in_data_size).  
+00017400: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00017410: 6c66 2e61 7373 6572 7445 7175 616c 2867  lf.assertEqual(g
+00017420: 7261 696e 2e6c 656e 6774 682c 2067 7261  rain.length, gra
+00017430: 696e 5f64 6174 615f 7369 7a65 290a 0a0a  in_data_size)...
+00017440: 636c 6173 7320 5465 7374 4753 464c 6f61  class TestGSFLoa
+00017450: 6473 2849 736f 6c61 7465 6441 7379 6e63  ds(IsolatedAsync
+00017460: 696f 5465 7374 4361 7365 293a 0a20 2020  ioTestCase):.   
+00017470: 2064 6566 205f 7665 7269 6679 5f6c 6f61   def _verify_loa
+00017480: 6465 645f 7669 6465 6f28 7365 6c66 2c20  ded_video(self, 
+00017490: 6865 6164 2c20 7365 676d 656e 7473 293a  head, segments):
+000174a0: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+000174b0: 7365 7274 4571 7561 6c28 6865 6164 5b27  sertEqual(head['
+000174c0: 6372 6561 7465 6427 5d2c 2064 6174 6574  created'], datet
+000174d0: 696d 6528 3230 3233 2c20 362c 2031 352c  ime(2023, 6, 15,
+000174e0: 2031 372c 2034 322c 2034 3429 290a 2020   17, 42, 44)).  
+000174f0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00017500: 7445 7175 616c 2868 6561 645b 2769 6427  tEqual(head['id'
+00017510: 5d2c 2055 5549 4428 2761 3731 6165 6534  ], UUID('a71aee4
+00017520: 612d 3062 3962 2d31 3165 652d 3930 3034  a-0b9b-11ee-9004
+00017530: 2d30 3937 3432 6230 6133 6666 3227 2929  -09742b0a3ff2'))
+00017540: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+00017550: 7365 7274 4571 7561 6c28 6c65 6e28 6865  sertEqual(len(he
+00017560: 6164 5b27 7365 676d 656e 7473 275d 292c  ad['segments']),
+00017570: 2031 290a 2020 2020 2020 2020 7365 6c66   1).        self
+00017580: 2e61 7373 6572 7445 7175 616c 2868 6561  .assertEqual(hea
+00017590: 645b 2773 6567 6d65 6e74 7327 5d5b 305d  d['segments'][0]
+000175a0: 5b27 6964 275d 2c20 5555 4944 2827 6137  ['id'], UUID('a7
+000175b0: 3161 6565 3462 2d30 6239 622d 3131 6565  1aee4b-0b9b-11ee
+000175c0: 2d39 3030 342d 3039 3734 3262 3061 3366  -9004-09742b0a3f
+000175d0: 6632 2729 290a 2020 2020 2020 2020 7365  f2')).        se
+000175e0: 6c66 2e61 7373 6572 7449 6e28 6865 6164  lf.assertIn(head
+000175f0: 5b27 7365 676d 656e 7473 275d 5b30 5d5b  ['segments'][0][
+00017600: 276c 6f63 616c 5f69 6427 5d2c 2073 6567  'local_id'], seg
+00017610: 6d65 6e74 7329 0a20 2020 2020 2020 2073  ments).        s
+00017620: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+00017630: 6c65 6e28 7365 676d 656e 7473 5b68 6561  len(segments[hea
+00017640: 645b 2773 6567 6d65 6e74 7327 5d5b 305d  d['segments'][0]
+00017650: 5b27 6c6f 6361 6c5f 6964 275d 5d29 2c20  ['local_id']]), 
+00017660: 6865 6164 5b27 7365 676d 656e 7473 275d  head['segments']
+00017670: 5b30 5d5b 2763 6f75 6e74 275d 290a 0a20  [0]['count']).. 
+00017680: 2020 2020 2020 206f 7473 203d 2054 696d         ots = Tim
+00017690: 6573 7461 6d70 2831 3432 3031 3032 3830  estamp(142010280
+000176a0: 302c 2030 290a 2020 2020 2020 2020 666f  0, 0).        fo
+000176b0: 7220 6772 6169 6e20 696e 2073 6567 6d65  r grain in segme
+000176c0: 6e74 735b 6865 6164 5b27 7365 676d 656e  nts[head['segmen
+000176d0: 7473 275d 5b30 5d5b 276c 6f63 616c 5f69  ts'][0]['local_i
+000176e0: 6427 5d5d 3a0a 2020 2020 2020 2020 2020  d']]:.          
+000176f0: 2020 7365 6c66 2e61 7373 6572 7449 7349    self.assertIsI
+00017700: 6e73 7461 6e63 6528 6772 6169 6e2c 2056  nstance(grain, V
+00017710: 6964 656f 4772 6169 6e29 0a20 2020 2020  ideoGrain).     
+00017720: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+00017730: 7274 4571 7561 6c28 6772 6169 6e2e 6772  rtEqual(grain.gr
+00017740: 6169 6e5f 7479 7065 2c20 2276 6964 656f  ain_type, "video
+00017750: 2229 0a20 2020 2020 2020 2020 2020 2073  ").            s
+00017760: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+00017770: 6772 6169 6e2e 736f 7572 6365 5f69 642c  grain.source_id,
+00017780: 2055 5549 4428 2734 3935 3738 3535 322d   UUID('49578552-
+00017790: 6662 3965 2d34 6433 652d 6131 3937 2d33  fb9e-4d3e-a197-3
+000177a0: 6533 6334 3337 6138 3935 6427 2929 0a20  e3c437a895d')). 
+000177b0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+000177c0: 6173 7365 7274 4571 7561 6c28 6772 6169  assertEqual(grai
+000177d0: 6e2e 666c 6f77 5f69 642c 2055 5549 4428  n.flow_id, UUID(
+000177e0: 2736 6535 3566 3235 312d 6637 3561 2d34  '6e55f251-f75a-4
+000177f0: 6435 362d 6233 6166 2d65 6462 3862 3739  d56-b3af-edb8b79
+00017800: 3933 6333 6327 2929 0a20 2020 2020 2020  93c3c')).       
+00017810: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00017820: 4571 7561 6c28 6772 6169 6e2e 6f72 6967  Equal(grain.orig
+00017830: 696e 5f74 696d 6573 7461 6d70 2c20 6f74  in_timestamp, ot
+00017840: 7329 0a20 2020 2020 2020 2020 2020 206f  s).            o
+00017850: 7473 202b 3d20 5469 6d65 4f66 6673 6574  ts += TimeOffset
+00017860: 2e66 726f 6d5f 6e61 6e6f 7365 6328 3230  .from_nanosec(20
+00017870: 3030 3030 3030 290a 0a20 2020 2020 2020  000000)..       
+00017880: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00017890: 4571 7561 6c28 6772 6169 6e2e 636f 675f  Equal(grain.cog_
+000178a0: 6672 616d 655f 666f 726d 6174 2c20 436f  frame_format, Co
+000178b0: 6746 7261 6d65 466f 726d 6174 2e55 385f  gFrameFormat.U8_
+000178c0: 3432 3029 0a20 2020 2020 2020 2020 2020  420).           
+000178d0: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+000178e0: 6c28 6772 6169 6e2e 636f 675f 6672 616d  l(grain.cog_fram
+000178f0: 655f 6c61 796f 7574 2c20 436f 6746 7261  e_layout, CogFra
+00017900: 6d65 4c61 796f 7574 2e46 554c 4c5f 4652  meLayout.FULL_FR
+00017910: 414d 4529 0a20 2020 2020 2020 2020 2020  AME).           
+00017920: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+00017930: 6c28 6772 6169 6e2e 7769 6474 682c 2034  l(grain.width, 4
+00017940: 3830 290a 2020 2020 2020 2020 2020 2020  80).            
+00017950: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+00017960: 2867 7261 696e 2e68 6569 6768 742c 2032  (grain.height, 2
+00017970: 3730 290a 0a20 2020 2020 2020 2020 2020  70)..           
+00017980: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+00017990: 6c28 6c65 6e28 6772 6169 6e2e 636f 6d70  l(len(grain.comp
+000179a0: 6f6e 656e 7473 292c 2033 290a 0a20 2020  onents), 3)..   
+000179b0: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
+000179c0: 7365 7274 4571 7561 6c28 6772 6169 6e2e  sertEqual(grain.
+000179d0: 636f 6d70 6f6e 656e 7473 5b30 5d2e 7769  components[0].wi
+000179e0: 6474 682c 2034 3830 290a 2020 2020 2020  dth, 480).      
+000179f0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00017a00: 7445 7175 616c 2867 7261 696e 2e63 6f6d  tEqual(grain.com
+00017a10: 706f 6e65 6e74 735b 305d 2e68 6569 6768  ponents[0].heigh
+00017a20: 742c 2032 3730 290a 2020 2020 2020 2020  t, 270).        
+00017a30: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+00017a40: 7175 616c 2867 7261 696e 2e63 6f6d 706f  qual(grain.compo
+00017a50: 6e65 6e74 735b 305d 2e73 7472 6964 652c  nents[0].stride,
+00017a60: 2034 3830 290a 2020 2020 2020 2020 2020   480).          
+00017a70: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+00017a80: 616c 2867 7261 696e 2e63 6f6d 706f 6e65  al(grain.compone
+00017a90: 6e74 735b 305d 2e6c 656e 6774 682c 2034  nts[0].length, 4
+00017aa0: 3830 2a32 3730 290a 0a20 2020 2020 2020  80*270)..       
+00017ab0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00017ac0: 4571 7561 6c28 6772 6169 6e2e 636f 6d70  Equal(grain.comp
+00017ad0: 6f6e 656e 7473 5b31 5d2e 7769 6474 682c  onents[1].width,
+00017ae0: 2032 3430 290a 2020 2020 2020 2020 2020   240).          
+00017af0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+00017b00: 616c 2867 7261 696e 2e63 6f6d 706f 6e65  al(grain.compone
+00017b10: 6e74 735b 315d 2e68 6569 6768 742c 2031  nts[1].height, 1
+00017b20: 3335 290a 2020 2020 2020 2020 2020 2020  35).            
+00017b30: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+00017b40: 2867 7261 696e 2e63 6f6d 706f 6e65 6e74  (grain.component
+00017b50: 735b 315d 2e73 7472 6964 652c 2032 3430  s[1].stride, 240
+00017b60: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+00017b70: 6c66 2e61 7373 6572 7445 7175 616c 2867  lf.assertEqual(g
+00017b80: 7261 696e 2e63 6f6d 706f 6e65 6e74 735b  rain.components[
+00017b90: 315d 2e6c 656e 6774 682c 2032 3430 2a31  1].length, 240*1
+00017ba0: 3335 290a 0a20 2020 2020 2020 2020 2020  35)..           
+00017bb0: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+00017bc0: 6c28 6772 6169 6e2e 636f 6d70 6f6e 656e  l(grain.componen
+00017bd0: 7473 5b32 5d2e 7769 6474 682c 2032 3430  ts[2].width, 240
+00017be0: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+00017bf0: 6c66 2e61 7373 6572 7445 7175 616c 2867  lf.assertEqual(g
+00017c00: 7261 696e 2e63 6f6d 706f 6e65 6e74 735b  rain.components[
+00017c10: 325d 2e68 6569 6768 742c 2031 3335 290a  2].height, 135).
+00017c20: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00017c30: 2e61 7373 6572 7445 7175 616c 2867 7261  .assertEqual(gra
+00017c40: 696e 2e63 6f6d 706f 6e65 6e74 735b 325d  in.components[2]
+00017c50: 2e73 7472 6964 652c 2032 3430 290a 2020  .stride, 240).  
+00017c60: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+00017c70: 7373 6572 7445 7175 616c 2867 7261 696e  ssertEqual(grain
+00017c80: 2e63 6f6d 706f 6e65 6e74 735b 325d 2e6c  .components[2].l
+00017c90: 656e 6774 682c 2032 3430 2a31 3335 290a  ength, 240*135).
+00017ca0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00017cb0: 662e 6173 7365 7274 4571 7561 6c28 0a20  f.assertEqual(. 
+00017cc0: 2020 2020 2020 2020 2020 2020 2020 206c                 l
+00017cd0: 656e 2867 7261 696e 2e64 6174 6129 2c0a  en(grain.data),.
+00017ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017cf0: 6772 6169 6e2e 636f 6d70 6f6e 656e 7473  grain.components
+00017d00: 5b30 5d2e 6c65 6e67 7468 202b 2067 7261  [0].length + gra
+00017d10: 696e 2e63 6f6d 706f 6e65 6e74 735b 315d  in.components[1]
+00017d20: 2e6c 656e 6774 6820 2b20 6772 6169 6e2e  .length + grain.
+00017d30: 636f 6d70 6f6e 656e 7473 5b32 5d2e 6c65  components[2].le
+00017d40: 6e67 7468 290a 0a20 2020 2064 6566 2074  ngth)..    def t
+00017d50: 6573 745f 6c6f 6164 735f 7669 6465 6f28  est_loads_video(
+00017d60: 7365 6c66 293a 0a20 2020 2020 2020 2028  self):.        (
+00017d70: 6865 6164 2c20 7365 676d 656e 7473 2920  head, segments) 
+00017d80: 3d20 6c6f 6164 7328 5649 4445 4f5f 4441  = loads(VIDEO_DA
+00017d90: 5441 5f38 290a 0a20 2020 2020 2020 2073  TA_8)..        s
+00017da0: 656c 662e 5f76 6572 6966 795f 6c6f 6164  elf._verify_load
+00017db0: 6564 5f76 6964 656f 2868 6561 642c 2073  ed_video(head, s
+00017dc0: 6567 6d65 6e74 7329 0a0a 2020 2020 6465  egments)..    de
+00017dd0: 6620 7465 7374 5f6c 6f61 645f 7669 6465  f test_load_vide
+00017de0: 6f28 7365 6c66 293a 0a20 2020 2020 2020  o(self):.       
+00017df0: 2066 696c 6520 3d20 4279 7465 7349 4f28   file = BytesIO(
+00017e00: 5649 4445 4f5f 4441 5441 5f38 290a 2020  VIDEO_DATA_8).  
+00017e10: 2020 2020 2020 2868 6561 642c 2073 6567        (head, seg
+00017e20: 6d65 6e74 7329 203d 206c 6f61 6428 6669  ments) = load(fi
+00017e30: 6c65 290a 0a20 2020 2020 2020 2073 656c  le)..        sel
+00017e40: 662e 5f76 6572 6966 795f 6c6f 6164 6564  f._verify_loaded
+00017e50: 5f76 6964 656f 2868 6561 642c 2073 6567  _video(head, seg
+00017e60: 6d65 6e74 7329 0a0a 2020 2020 6173 796e  ments)..    asyn
+00017e70: 6320 6465 6620 7465 7374 5f61 7379 6e63  c def test_async
+00017e80: 5f6c 6f61 645f 7669 6465 6f28 7365 6c66  _load_video(self
+00017e90: 293a 0a20 2020 2020 2020 2066 696c 6520  ):.        file 
+00017ea0: 3d20 4173 796e 6342 7974 6573 494f 2856  = AsyncBytesIO(V
+00017eb0: 4944 454f 5f44 4154 415f 3829 0a20 2020  IDEO_DATA_8).   
+00017ec0: 2020 2020 2028 6865 6164 2c20 7365 676d       (head, segm
+00017ed0: 656e 7473 2920 3d20 6177 6169 7420 6c6f  ents) = await lo
+00017ee0: 6164 2866 696c 6529 0a0a 2020 2020 2020  ad(file)..      
+00017ef0: 2020 7365 6c66 2e5f 7665 7269 6679 5f6c    self._verify_l
+00017f00: 6f61 6465 645f 7669 6465 6f28 6865 6164  oaded_video(head
+00017f10: 2c20 7365 676d 656e 7473 290a 0a20 2020  , segments)..   
+00017f20: 2064 6566 2074 6573 745f 6c6f 6164 5f75   def test_load_u
+00017f30: 7365 735f 6375 7374 6f6d 5f67 7261 696e  ses_custom_grain
+00017f40: 5f66 756e 6374 696f 6e28 7365 6c66 293a  _function(self):
+00017f50: 0a20 2020 2020 2020 2066 696c 6520 3d20  .        file = 
+00017f60: 4279 7465 7349 4f28 5649 4445 4f5f 4441  BytesIO(VIDEO_DA
+00017f70: 5441 5f38 290a 2020 2020 2020 2020 6772  TA_8).        gr
+00017f80: 6169 6e5f 7061 7273 6572 203d 206d 6f63  ain_parser = moc
+00017f90: 6b2e 4d61 6769 634d 6f63 6b28 6e61 6d65  k.MagicMock(name
+00017fa0: 3d22 6772 6169 6e5f 7061 7273 6572 2229  ="grain_parser")
+00017fb0: 0a20 2020 2020 2020 2028 6865 6164 2c20  .        (head, 
+00017fc0: 7365 676d 656e 7473 2920 3d20 6c6f 6164  segments) = load
+00017fd0: 2866 696c 652c 2070 6172 7365 5f67 7261  (file, parse_gra
+00017fe0: 696e 3d67 7261 696e 5f70 6172 7365 7229  in=grain_parser)
+00017ff0: 0a0a 2020 2020 2020 2020 7365 6c66 2e61  ..        self.a
+00018000: 7373 6572 7445 7175 616c 286c 656e 2873  ssertEqual(len(s
+00018010: 6567 6d65 6e74 7329 2c20 3129 0a20 2020  egments), 1).   
+00018020: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00018030: 496e 2831 2c20 7365 676d 656e 7473 290a  In(1, segments).
+00018040: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+00018050: 6572 7445 7175 616c 286c 656e 2873 6567  ertEqual(len(seg
+00018060: 6d65 6e74 735b 315d 292c 2031 3029 0a20  ments[1]), 10). 
+00018070: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+00018080: 7274 4571 7561 6c28 6772 6169 6e5f 7061  rtEqual(grain_pa
+00018090: 7273 6572 2e63 616c 6c5f 636f 756e 742c  rser.call_count,
+000180a0: 2031 3029 0a0a 2020 2020 6173 796e 6320   10)..    async 
+000180b0: 6465 6620 7465 7374 5f61 7379 6e63 5f6c  def test_async_l
+000180c0: 6f61 645f 7573 6573 5f63 7573 746f 6d5f  oad_uses_custom_
+000180d0: 6772 6169 6e5f 6675 6e63 7469 6f6e 2873  grain_function(s
+000180e0: 656c 6629 3a0a 2020 2020 2020 2020 6669  elf):.        fi
+000180f0: 6c65 203d 2041 7379 6e63 4279 7465 7349  le = AsyncBytesI
+00018100: 4f28 5649 4445 4f5f 4441 5441 5f38 290a  O(VIDEO_DATA_8).
+00018110: 2020 2020 2020 2020 6772 6169 6e5f 7061          grain_pa
+00018120: 7273 6572 203d 206d 6f63 6b2e 4d61 6769  rser = mock.Magi
+00018130: 634d 6f63 6b28 6e61 6d65 3d22 6772 6169  cMock(name="grai
+00018140: 6e5f 7061 7273 6572 2229 0a20 2020 2020  n_parser").     
+00018150: 2020 2028 6865 6164 2c20 7365 676d 656e     (head, segmen
+00018160: 7473 2920 3d20 6177 6169 7420 6c6f 6164  ts) = await load
+00018170: 2866 696c 652c 2070 6172 7365 5f67 7261  (file, parse_gra
+00018180: 696e 3d67 7261 696e 5f70 6172 7365 7229  in=grain_parser)
+00018190: 0a0a 2020 2020 2020 2020 7365 6c66 2e61  ..        self.a
+000181a0: 7373 6572 7445 7175 616c 286c 656e 2873  ssertEqual(len(s
+000181b0: 6567 6d65 6e74 7329 2c20 3129 0a20 2020  egments), 1).   
+000181c0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+000181d0: 496e 2831 2c20 7365 676d 656e 7473 290a  In(1, segments).
+000181e0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+000181f0: 6572 7445 7175 616c 286c 656e 2873 6567  ertEqual(len(seg
+00018200: 6d65 6e74 735b 315d 292c 2031 3029 0a20  ments[1]), 10). 
+00018210: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+00018220: 7274 4571 7561 6c28 6772 6169 6e5f 7061  rtEqual(grain_pa
+00018230: 7273 6572 2e63 616c 6c5f 636f 756e 742c  rser.call_count,
+00018240: 2031 3029 0a0a 2020 2020 6465 6620 7465   10)..    def te
+00018250: 7374 5f6c 6f61 6473 5f75 7365 735f 6375  st_loads_uses_cu
+00018260: 7374 6f6d 5f67 7261 696e 5f66 756e 6374  stom_grain_funct
+00018270: 696f 6e28 7365 6c66 293a 0a20 2020 2020  ion(self):.     
+00018280: 2020 2073 203d 2056 4944 454f 5f44 4154     s = VIDEO_DAT
+00018290: 415f 380a 2020 2020 2020 2020 6772 6169  A_8.        grai
+000182a0: 6e5f 7061 7273 6572 203d 206d 6f63 6b2e  n_parser = mock.
+000182b0: 4d61 6769 634d 6f63 6b28 6e61 6d65 3d22  MagicMock(name="
+000182c0: 6772 6169 6e5f 7061 7273 6572 2229 0a20  grain_parser"). 
+000182d0: 2020 2020 2020 2028 6865 6164 2c20 7365         (head, se
+000182e0: 676d 656e 7473 2920 3d20 6c6f 6164 7328  gments) = loads(
+000182f0: 732c 2070 6172 7365 5f67 7261 696e 3d67  s, parse_grain=g
+00018300: 7261 696e 5f70 6172 7365 7229 0a0a 2020  rain_parser)..  
+00018310: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00018320: 7445 7175 616c 286c 656e 2873 6567 6d65  tEqual(len(segme
+00018330: 6e74 7329 2c20 3129 0a20 2020 2020 2020  nts), 1).       
+00018340: 2073 656c 662e 6173 7365 7274 496e 2831   self.assertIn(1
+00018350: 2c20 7365 676d 656e 7473 290a 2020 2020  , segments).    
+00018360: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+00018370: 7175 616c 286c 656e 2873 6567 6d65 6e74  qual(len(segment
+00018380: 735b 315d 292c 2031 3029 0a20 2020 2020  s[1]), 10).     
+00018390: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+000183a0: 7561 6c28 6772 6169 6e5f 7061 7273 6572  ual(grain_parser
+000183b0: 2e63 616c 6c5f 636f 756e 742c 2031 3029  .call_count, 10)
+000183c0: 0a0a 2020 2020 6465 6620 7465 7374 5f6c  ..    def test_l
+000183d0: 6f61 6473 5f61 7564 696f 2873 656c 6629  oads_audio(self)
+000183e0: 3a0a 2020 2020 2020 2020 2868 6561 642c  :.        (head,
+000183f0: 2073 6567 6d65 6e74 7329 203d 206c 6f61   segments) = loa
+00018400: 6473 2841 5544 494f 5f44 4154 415f 3829  ds(AUDIO_DATA_8)
+00018410: 0a0a 2020 2020 2020 2020 7365 6c66 2e61  ..        self.a
+00018420: 7373 6572 7445 7175 616c 2868 6561 645b  ssertEqual(head[
+00018430: 2763 7265 6174 6564 275d 2c20 6461 7465  'created'], date
+00018440: 7469 6d65 2832 3032 332c 2036 2c20 382c  time(2023, 6, 8,
+00018450: 2031 312c 2033 342c 2033 2929 0a20 2020   11, 34, 3)).   
+00018460: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00018470: 4571 7561 6c28 6865 6164 5b27 6964 275d  Equal(head['id']
+00018480: 2c20 5555 4944 2827 6663 6666 3830 3738  , UUID('fcff8078
+00018490: 2d30 3565 372d 3131 6565 2d39 6365 662d  -05e7-11ee-9cef-
+000184a0: 6666 3438 6637 6638 3161 6366 2729 290a  ff48f7f81acf')).
+000184b0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+000184c0: 6572 7445 7175 616c 286c 656e 2868 6561  ertEqual(len(hea
+000184d0: 645b 2773 6567 6d65 6e74 7327 5d29 2c20  d['segments']), 
+000184e0: 3129 0a20 2020 2020 2020 2073 656c 662e  1).        self.
+000184f0: 6173 7365 7274 4571 7561 6c28 6865 6164  assertEqual(head
+00018500: 5b27 7365 676d 656e 7473 275d 5b30 5d5b  ['segments'][0][
+00018510: 2769 6427 5d2c 2055 5549 4428 2766 6366  'id'], UUID('fcf
+00018520: 6638 3037 392d 3035 6537 2d31 3165 652d  f8079-05e7-11ee-
+00018530: 3963 6566 2d66 6634 3866 3766 3831 6163  9cef-ff48f7f81ac
+00018540: 6627 2929 0a20 2020 2020 2020 2073 656c  f')).        sel
+00018550: 662e 6173 7365 7274 496e 2868 6561 645b  f.assertIn(head[
+00018560: 2773 6567 6d65 6e74 7327 5d5b 305d 5b27  'segments'][0]['
+00018570: 6c6f 6361 6c5f 6964 275d 2c20 7365 676d  local_id'], segm
+00018580: 656e 7473 290a 2020 2020 2020 2020 7365  ents).        se
+00018590: 6c66 2e61 7373 6572 7445 7175 616c 286c  lf.assertEqual(l
+000185a0: 656e 2873 6567 6d65 6e74 735b 6865 6164  en(segments[head
+000185b0: 5b27 7365 676d 656e 7473 275d 5b30 5d5b  ['segments'][0][
+000185c0: 276c 6f63 616c 5f69 6427 5d5d 292c 2068  'local_id']]), h
+000185d0: 6561 645b 2773 6567 6d65 6e74 7327 5d5b  ead['segments'][
+000185e0: 305d 5b27 636f 756e 7427 5d29 0a0a 2020  0]['count'])..  
+000185f0: 2020 2020 2020 7374 6172 745f 6f74 7320        start_ots 
+00018600: 3d20 5469 6d65 7374 616d 7028 3134 3230  = Timestamp(1420
+00018610: 3130 3238 3030 2c20 3029 0a20 2020 2020  102800, 0).     
+00018620: 2020 206f 7473 203d 2073 7461 7274 5f6f     ots = start_o
+00018630: 7473 0a20 2020 2020 2020 2074 6f74 616c  ts.        total
+00018640: 5f73 616d 706c 6573 203d 2030 0a20 2020  _samples = 0.   
+00018650: 2020 2020 2066 6f72 2067 7261 696e 2069       for grain i
+00018660: 6e20 7365 676d 656e 7473 5b68 6561 645b  n segments[head[
+00018670: 2773 6567 6d65 6e74 7327 5d5b 305d 5b27  'segments'][0]['
+00018680: 6c6f 6361 6c5f 6964 275d 5d3a 0a20 2020  local_id']]:.   
+00018690: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
+000186a0: 7365 7274 4973 496e 7374 616e 6365 2867  sertIsInstance(g
+000186b0: 7261 696e 2c20 4175 6469 6f47 7261 696e  rain, AudioGrain
+000186c0: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+000186d0: 6c66 2e61 7373 6572 7445 7175 616c 2867  lf.assertEqual(g
+000186e0: 7261 696e 2e67 7261 696e 5f74 7970 652c  rain.grain_type,
+000186f0: 2022 6175 6469 6f22 290a 2020 2020 2020   "audio").      
+00018700: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00018710: 7445 7175 616c 2867 7261 696e 2e73 6f75  tEqual(grain.sou
+00018720: 7263 655f 6964 2c20 5555 4944 2827 3338  rce_id, UUID('38
+00018730: 6266 6439 3032 2d62 3335 662d 3430 6436  bfd902-b35f-40d6
+00018740: 2d39 6563 662d 6463 3935 3836 3931 3330  -9ecf-dc95869130
+00018750: 6366 2729 290a 2020 2020 2020 2020 2020  cf')).          
+00018760: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+00018770: 616c 2867 7261 696e 2e66 6c6f 775f 6964  al(grain.flow_id
+00018780: 2c20 5555 4944 2827 6631 6338 6330 3935  , UUID('f1c8c095
+00018790: 2d35 3733 392d 3436 6634 2d39 6262 632d  -5739-46f4-9bbc-
+000187a0: 3364 3730 3530 6339 6261 3233 2729 290a  3d7050c9ba23')).
+000187b0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000187c0: 2e61 7373 6572 7445 7175 616c 2867 7261  .assertEqual(gra
+000187d0: 696e 2e6f 7269 6769 6e5f 7469 6d65 7374  in.origin_timest
+000187e0: 616d 702c 206f 7473 290a 0a20 2020 2020  amp, ots)..     
+000187f0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+00018800: 7274 4571 7561 6c28 6772 6169 6e2e 666f  rtEqual(grain.fo
+00018810: 726d 6174 2c20 436f 6741 7564 696f 466f  rmat, CogAudioFo
+00018820: 726d 6174 2e53 3234 5f49 4e54 4552 4c45  rmat.S24_INTERLE
+00018830: 4156 4544 290a 2020 2020 2020 2020 2020  AVED).          
+00018840: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+00018850: 616c 2867 7261 696e 2e63 6861 6e6e 656c  al(grain.channel
+00018860: 732c 2032 290a 2020 2020 2020 2020 2020  s, 2).          
+00018870: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+00018880: 616c 2867 7261 696e 2e73 616d 706c 6573  al(grain.samples
+00018890: 2c20 3130 3234 290a 2020 2020 2020 2020  , 1024).        
+000188a0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+000188b0: 7175 616c 2867 7261 696e 2e73 616d 706c  qual(grain.sampl
+000188c0: 655f 7261 7465 2c20 3438 3030 3029 0a0a  e_rate, 48000)..
+000188d0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000188e0: 2e61 7373 6572 7445 7175 616c 286c 656e  .assertEqual(len
+000188f0: 2867 7261 696e 2e64 6174 6129 2c20 3631  (grain.data), 61
+00018900: 3434 290a 2020 2020 2020 2020 2020 2020  44).            
+00018910: 746f 7461 6c5f 7361 6d70 6c65 7320 2b3d  total_samples +=
+00018920: 2067 7261 696e 2e73 616d 706c 6573 0a20   grain.samples. 
+00018930: 2020 2020 2020 2020 2020 206f 7473 203d             ots =
+00018940: 2073 7461 7274 5f6f 7473 202b 2054 696d   start_ots + Tim
+00018950: 654f 6666 7365 742e 6672 6f6d 5f63 6f75  eOffset.from_cou
+00018960: 6e74 2874 6f74 616c 5f73 616d 706c 6573  nt(total_samples
+00018970: 2c20 6772 6169 6e2e 7361 6d70 6c65 5f72  , grain.sample_r
+00018980: 6174 6529 0a0a 2020 2020 6465 6620 7465  ate)..    def te
+00018990: 7374 5f6c 6f61 6473 5f63 6f64 6564 5f76  st_loads_coded_v
+000189a0: 6964 656f 2873 656c 6629 3a0a 2020 2020  ideo(self):.    
+000189b0: 2020 2020 2868 6561 642c 2073 6567 6d65      (head, segme
+000189c0: 6e74 7329 203d 206c 6f61 6473 2843 4f44  nts) = loads(COD
+000189d0: 4544 5f56 4944 454f 5f44 4154 415f 3829  ED_VIDEO_DATA_8)
+000189e0: 0a0a 2020 2020 2020 2020 7365 6c66 2e61  ..        self.a
+000189f0: 7373 6572 7445 7175 616c 2868 6561 645b  ssertEqual(head[
+00018a00: 2763 7265 6174 6564 275d 2c20 6461 7465  'created'], date
+00018a10: 7469 6d65 2832 3032 332c 2036 2c20 382c  time(2023, 6, 8,
+00018a20: 2031 312c 2033 342c 2033 2929 0a20 2020   11, 34, 3)).   
+00018a30: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00018a40: 4571 7561 6c28 6865 6164 5b27 6964 275d  Equal(head['id']
+00018a50: 2c20 5555 4944 2827 6663 6666 3830 3763  , UUID('fcff807c
+00018a60: 2d30 3565 372d 3131 6565 2d39 6365 662d  -05e7-11ee-9cef-
+00018a70: 6666 3438 6637 6638 3161 6366 2729 290a  ff48f7f81acf')).
+00018a80: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+00018a90: 6572 7445 7175 616c 286c 656e 2868 6561  ertEqual(len(hea
+00018aa0: 645b 2773 6567 6d65 6e74 7327 5d29 2c20  d['segments']), 
+00018ab0: 3129 0a20 2020 2020 2020 2073 656c 662e  1).        self.
+00018ac0: 6173 7365 7274 4571 7561 6c28 6865 6164  assertEqual(head
+00018ad0: 5b27 7365 676d 656e 7473 275d 5b30 5d5b  ['segments'][0][
+00018ae0: 2769 6427 5d2c 2055 5549 4428 2766 6366  'id'], UUID('fcf
+00018af0: 6638 3037 642d 3035 6537 2d31 3165 652d  f807d-05e7-11ee-
+00018b00: 3963 6566 2d66 6634 3866 3766 3831 6163  9cef-ff48f7f81ac
+00018b10: 6627 2929 0a20 2020 2020 2020 2073 656c  f')).        sel
+00018b20: 662e 6173 7365 7274 496e 2868 6561 645b  f.assertIn(head[
+00018b30: 2773 6567 6d65 6e74 7327 5d5b 305d 5b27  'segments'][0]['
+00018b40: 6c6f 6361 6c5f 6964 275d 2c20 7365 676d  local_id'], segm
+00018b50: 656e 7473 290a 2020 2020 2020 2020 7365  ents).        se
+00018b60: 6c66 2e61 7373 6572 7445 7175 616c 286c  lf.assertEqual(l
+00018b70: 656e 2873 6567 6d65 6e74 735b 6865 6164  en(segments[head
+00018b80: 5b27 7365 676d 656e 7473 275d 5b30 5d5b  ['segments'][0][
+00018b90: 276c 6f63 616c 5f69 6427 5d5d 292c 2068  'local_id']]), h
+00018ba0: 6561 645b 2773 6567 6d65 6e74 7327 5d5b  ead['segments'][
+00018bb0: 305d 5b27 636f 756e 7427 5d29 0a0a 2020  0]['count'])..  
+00018bc0: 2020 2020 2020 6f74 7320 3d20 5469 6d65        ots = Time
+00018bd0: 7374 616d 7028 3134 3230 3130 3238 3030  stamp(1420102800
+00018be0: 2c20 3029 0a20 2020 2020 2020 2075 6e69  , 0).        uni
+00018bf0: 745f 6f66 6673 6574 7320 3d20 5b0a 2020  t_offsets = [.  
+00018c00: 2020 2020 2020 2020 2020 285b 302c 2036            ([0, 6
+00018c10: 2c20 3334 2c20 3432 2c20 3731 312c 2037  , 34, 42, 711, 7
+00018c20: 3139 5d2c 2033 3631 3134 292c 0a20 2020  19], 36114),.   
+00018c30: 2020 2020 2020 2020 2028 5b30 2c20 362c           ([0, 6,
+00018c40: 2031 345d 2c20 3338 3029 2c0a 2020 2020   14], 380),.    
+00018c50: 2020 2020 2020 2020 285b 302c 2036 2c20          ([0, 6, 
+00018c60: 3134 5d2c 2038 3237 3729 2c0a 2020 2020  14], 8277),.    
+00018c70: 2020 2020 2020 2020 285b 302c 2036 2c20          ([0, 6, 
+00018c80: 3134 5d2c 2034 3931 3429 2c0a 2020 2020  14], 4914),.    
+00018c90: 2020 2020 2020 2020 285b 302c 2036 2c20          ([0, 6, 
+00018ca0: 3134 5d2c 2034 3936 3129 2c0a 2020 2020  14], 4961),.    
+00018cb0: 2020 2020 2020 2020 285b 302c 2036 2c20          ([0, 6, 
+00018cc0: 3134 5d2c 2033 3737 3729 2c0a 2020 2020  14], 3777),.    
+00018cd0: 2020 2020 2020 2020 285b 302c 2036 2c20          ([0, 6, 
+00018ce0: 3134 5d2c 2031 3935 3029 2c0a 2020 2020  14], 1950),.    
+00018cf0: 2020 2020 2020 2020 285b 302c 2036 2c20          ([0, 6, 
+00018d00: 3134 5d2c 2033 3129 2c0a 2020 2020 2020  14], 31),.      
+00018d10: 2020 2020 2020 285b 302c 2036 2c20 3134        ([0, 6, 14
+00018d20: 5d2c 2032 3529 2c0a 2020 2020 2020 2020  ], 25),.        
+00018d30: 2020 2020 285b 302c 2036 2c20 3134 5d2c      ([0, 6, 14],
+00018d40: 2036 3234 3129 5d0a 2020 2020 2020 2020   6241)].        
+00018d50: 666f 7220 6772 6169 6e20 696e 2073 6567  for grain in seg
+00018d60: 6d65 6e74 735b 6865 6164 5b27 7365 676d  ments[head['segm
+00018d70: 656e 7473 275d 5b30 5d5b 276c 6f63 616c  ents'][0]['local
+00018d80: 5f69 6427 5d5d 3a0a 2020 2020 2020 2020  _id']]:.        
+00018d90: 2020 2020 7365 6c66 2e61 7373 6572 7449      self.assertI
+00018da0: 7349 6e73 7461 6e63 6528 6772 6169 6e2c  sInstance(grain,
+00018db0: 2043 6f64 6564 5669 6465 6f47 7261 696e   CodedVideoGrain
+00018dc0: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+00018dd0: 6c66 2e61 7373 6572 7445 7175 616c 2867  lf.assertEqual(g
+00018de0: 7261 696e 2e67 7261 696e 5f74 7970 652c  rain.grain_type,
+00018df0: 2022 636f 6465 645f 7669 6465 6f22 290a   "coded_video").
+00018e00: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00018e10: 2e61 7373 6572 7445 7175 616c 2867 7261  .assertEqual(gra
+00018e20: 696e 2e73 6f75 7263 655f 6964 2c20 5555  in.source_id, UU
+00018e30: 4944 2827 3439 3537 3835 3532 2d66 6239  ID('49578552-fb9
+00018e40: 652d 3464 3365 2d61 3139 372d 3365 3363  e-4d3e-a197-3e3c
+00018e50: 3433 3761 3839 3564 2729 290a 2020 2020  437a895d')).    
+00018e60: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+00018e70: 6572 7445 7175 616c 2867 7261 696e 2e66  ertEqual(grain.f
+00018e80: 6c6f 775f 6964 2c20 5555 4944 2827 6236  low_id, UUID('b6
+00018e90: 6230 3565 6662 2d36 3036 372d 3466 6638  b05efb-6067-4ff8
+00018ea0: 2d61 6661 632d 6563 3733 3561 3835 3637  -afac-ec735a8567
+00018eb0: 3465 2729 290a 2020 2020 2020 2020 2020  4e')).          
+00018ec0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+00018ed0: 616c 2867 7261 696e 2e6f 7269 6769 6e5f  al(grain.origin_
+00018ee0: 7469 6d65 7374 616d 702c 206f 7473 290a  timestamp, ots).
+00018ef0: 2020 2020 2020 2020 2020 2020 6f74 7320              ots 
+00018f00: 2b3d 2054 696d 654f 6666 7365 742e 6672  += TimeOffset.fr
+00018f10: 6f6d 5f6e 616e 6f73 6563 2832 3030 3030  om_nanosec(20000
+00018f20: 3030 3029 0a0a 2020 2020 2020 2020 2020  000)..          
+00018f30: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+00018f40: 616c 2867 7261 696e 2e66 6f72 6d61 742c  al(grain.format,
+00018f50: 2043 6f67 4672 616d 6546 6f72 6d61 742e   CogFrameFormat.
+00018f60: 4832 3634 290a 2020 2020 2020 2020 2020  H264).          
+00018f70: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+00018f80: 616c 2867 7261 696e 2e6c 6179 6f75 742c  al(grain.layout,
+00018f90: 2043 6f67 4672 616d 654c 6179 6f75 742e   CogFrameLayout.
+00018fa0: 4655 4c4c 5f46 5241 4d45 290a 2020 2020  FULL_FRAME).    
+00018fb0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+00018fc0: 6572 7445 7175 616c 2867 7261 696e 2e6f  ertEqual(grain.o
+00018fd0: 7269 6769 6e5f 7769 6474 682c 2031 3932  rigin_width, 192
+00018fe0: 3029 0a20 2020 2020 2020 2020 2020 2073  0).            s
+00018ff0: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+00019000: 6772 6169 6e2e 6f72 6967 696e 5f68 6569  grain.origin_hei
+00019010: 6768 742c 2031 3038 3029 0a20 2020 2020  ght, 1080).     
+00019020: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+00019030: 7274 4571 7561 6c28 6772 6169 6e2e 636f  rtEqual(grain.co
+00019040: 6465 645f 7769 6474 682c 2030 290a 2020  ded_width, 0).  
+00019050: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+00019060: 7373 6572 7445 7175 616c 2867 7261 696e  ssertEqual(grain
+00019070: 2e63 6f64 6564 5f68 6569 6768 742c 2030  .coded_height, 0
+00019080: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+00019090: 6c66 2e61 7373 6572 7445 7175 616c 2867  lf.assertEqual(g
+000190a0: 7261 696e 2e6c 656e 6774 682c 2075 6e69  rain.length, uni
+000190b0: 745f 6f66 6673 6574 735b 305d 5b31 5d29  t_offsets[0][1])
+000190c0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+000190d0: 662e 6173 7365 7274 4571 7561 6c28 6772  f.assertEqual(gr
+000190e0: 6169 6e2e 7465 6d70 6f72 616c 5f6f 6666  ain.temporal_off
+000190f0: 7365 742c 2030 290a 2020 2020 2020 2020  set, 0).        
+00019100: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+00019110: 7175 616c 2867 7261 696e 2e75 6e69 745f  qual(grain.unit_
+00019120: 6f66 6673 6574 732c 2075 6e69 745f 6f66  offsets, unit_of
+00019130: 6673 6574 735b 305d 5b30 5d29 0a20 2020  fsets[0][0]).   
+00019140: 2020 2020 2020 2020 2075 6e69 745f 6f66           unit_of
+00019150: 6673 6574 732e 706f 7028 3029 0a0a 2020  fsets.pop(0)..  
+00019160: 2020 6465 6620 7465 7374 5f6c 6f61 6473    def test_loads
+00019170: 5f66 6c6f 7728 7365 6c66 293a 0a20 2020  _flow(self):.   
+00019180: 2020 2020 2028 6865 6164 2c20 7365 676d       (head, segm
+00019190: 656e 7473 2920 3d20 6c6f 6164 7328 5649  ents) = loads(VI
+000191a0: 4445 4f5f 4441 5441 5f38 290a 0a20 2020  DEO_DATA_8)..   
+000191b0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+000191c0: 496e 2827 666c 6f77 272c 2068 6561 645b  In('flow', head[
+000191d0: 2773 6567 6d65 6e74 7327 5d5b 305d 290a  'segments'][0]).
+000191e0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+000191f0: 6572 7445 7175 616c 2868 6561 645b 2773  ertEqual(head['s
+00019200: 6567 6d65 6e74 7327 5d5b 305d 5b27 666c  egments'][0]['fl
+00019210: 6f77 275d 5b27 736f 7572 6365 5f69 6427  ow']['source_id'
+00019220: 5d2c 2055 5549 4428 2734 3935 3738 3535  ], UUID('4957855
+00019230: 322d 6662 3965 2d34 6433 652d 6131 3937  2-fb9e-4d3e-a197
+00019240: 2d33 6533 6334 3337 6138 3935 6427 2929  -3e3c437a895d'))
+00019250: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+00019260: 7365 7274 4571 7561 6c28 6865 6164 5b27  sertEqual(head['
+00019270: 7365 676d 656e 7473 275d 5b30 5d5b 2766  segments'][0]['f
+00019280: 6c6f 7727 5d5b 2766 6c6f 775f 6964 275d  low']['flow_id']
+00019290: 2c20 5555 4944 2827 3665 3535 6632 3531  , UUID('6e55f251
+000192a0: 2d66 3735 612d 3464 3536 2d62 3361 662d  -f75a-4d56-b3af-
+000192b0: 6564 6238 6237 3939 3363 3363 2729 290a  edb8b7993c3c')).
+000192c0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+000192d0: 6572 7445 7175 616c 2868 6561 645b 2773  ertEqual(head['s
+000192e0: 6567 6d65 6e74 7327 5d5b 305d 5b27 666c  egments'][0]['fl
+000192f0: 6f77 275d 5b27 666f 726d 6174 275d 2c20  ow']['format'], 
+00019300: 2275 726e 3a78 2d6e 6d6f 733a 666f 726d  "urn:x-nmos:form
+00019310: 6174 3a76 6964 656f 2229 0a20 2020 2020  at:video").     
+00019320: 2020 2066 6c6f 7720 3d20 6a73 6f6e 2e6c     flow = json.l
+00019330: 6f61 6473 2868 6561 645b 2773 6567 6d65  oads(head['segme
+00019340: 6e74 7327 5d5b 305d 5b27 666c 6f77 275d  nts'][0]['flow']
+00019350: 5b27 6461 7461 275d 290a 2020 2020 2020  ['data']).      
+00019360: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+00019370: 616c 2866 6c6f 775b 2773 6f75 7263 655f  al(flow['source_
+00019380: 6964 275d 2c20 2734 3935 3738 3535 322d  id'], '49578552-
+00019390: 6662 3965 2d34 6433 652d 6131 3937 2d33  fb9e-4d3e-a197-3
+000193a0: 6533 6334 3337 6138 3935 6427 290a 2020  e3c437a895d').  
+000193b0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+000193c0: 7445 7175 616c 2866 6c6f 775b 2769 6427  tEqual(flow['id'
+000193d0: 5d2c 2027 3665 3535 6632 3531 2d66 3735  ], '6e55f251-f75
+000193e0: 612d 3464 3536 2d62 3361 662d 6564 6238  a-4d56-b3af-edb8
+000193f0: 6237 3939 3363 3363 2729 0a20 2020 2020  b7993c3c').     
+00019400: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+00019410: 7561 6c28 666c 6f77 5b27 666f 726d 6174  ual(flow['format
+00019420: 275d 2c20 2275 726e 3a78 2d6e 6d6f 733a  '], "urn:x-nmos:
+00019430: 666f 726d 6174 3a76 6964 656f 2229 0a0a  format:video")..
+00019440: 2020 2020 6465 6620 7465 7374 5f6c 6f61      def test_loa
+00019450: 6473 5f72 656a 6563 7473 5f69 6e63 6f72  ds_rejects_incor
+00019460: 7265 6374 5f74 7970 655f 6669 6c65 2873  rect_type_file(s
+00019470: 656c 6629 3a0a 2020 2020 2020 2020 7769  elf):.        wi
+00019480: 7468 2073 656c 662e 6173 7365 7274 5261  th self.assertRa
+00019490: 6973 6573 2847 5346 4465 636f 6465 4261  ises(GSFDecodeBa
+000194a0: 6446 696c 6554 7970 6545 7272 6f72 2920  dFileTypeError) 
+000194b0: 6173 2063 6d3a 0a20 2020 2020 2020 2020  as cm:.         
+000194c0: 2020 206c 6f61 6473 2862 2250 4f54 4154     loads(b"POTAT
+000194d0: 4f32 335c 7830 375c 7830 305c 7830 305c  O23\x07\x00\x00\
+000194e0: 7830 3022 290a 2020 2020 2020 2020 7365  x00").        se
+000194f0: 6c66 2e61 7373 6572 7445 7175 616c 2863  lf.assertEqual(c
+00019500: 6d2e 6578 6365 7074 696f 6e2e 6f66 6673  m.exception.offs
+00019510: 6574 2c20 3029 0a20 2020 2020 2020 2073  et, 0).        s
+00019520: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+00019530: 636d 2e65 7863 6570 7469 6f6e 2e66 696c  cm.exception.fil
+00019540: 6574 7970 652c 2022 504f 5441 544f 3233  etype, "POTATO23
+00019550: 2229 0a0a 2020 2020 6465 6620 7465 7374  ")..    def test
+00019560: 5f6c 6f61 6473 5f61 6363 6570 7473 5f76  _loads_accepts_v
+00019570: 6572 7369 6f6e 5f37 5f66 696c 6528 7365  ersion_7_file(se
+00019580: 6c66 293a 0a20 2020 2020 2020 206c 6f61  lf):.        loa
+00019590: 6473 2862 2253 5342 4267 7273 675c 7830  ds(b"SSBBgrsg\x0
+000195a0: 375c 7830 305c 7830 305c 7830 3022 202b  7\x00\x00\x00" +
+000195b0: 0a20 2020 2020 2020 2020 2020 2020 2062  .              b
+000195c0: 2268 6561 645c 7831 665c 7830 305c 7830  "head\x1f\x00\x0
+000195d0: 305c 7830 3022 202b 0a20 2020 2020 2020  0\x00" +.       
+000195e0: 2020 2020 2020 2062 225c 7864 315c 7839         b"\xd1\x9
+000195f0: 635c 7830 625c 7839 315c 7831 355c 7839  c\x0b\x91\x15\x9
+00019600: 305c 7831 315c 7865 385c 7838 355c 7838  0\x11\xe8\x85\x8
+00019610: 305c 7864 635c 7861 395c 7830 345c 7838  0\xdc\xa9\x04\x8
+00019620: 324e 5c78 6563 2220 2b0a 2020 2020 2020  2N\xec" +.      
+00019630: 2020 2020 2020 2020 6222 5c78 6266 5c78          b"\xbf\x
+00019640: 3037 5c78 3033 5c78 3164 5c78 3066 5c78  07\x03\x1d\x0f\x
+00019650: 3066 5c78 3066 2229 0a0a 2020 2020 6465  0f\x0f")..    de
+00019660: 6620 7465 7374 5f6c 6f61 6473 5f61 6363  f test_loads_acc
+00019670: 6570 7473 5f76 6572 7369 6f6e 5f38 5f66  epts_version_8_f
+00019680: 696c 6528 7365 6c66 293a 0a20 2020 2020  ile(self):.     
+00019690: 2020 206c 6f61 6473 2862 2253 5342 4267     loads(b"SSBBg
+000196a0: 7273 675c 7830 385c 7830 305c 7830 305c  rsg\x08\x00\x00\
+000196b0: 7830 3022 202b 0a20 2020 2020 2020 2020  x00" +.         
+000196c0: 2020 2020 2062 2268 6561 645c 7831 665c       b"head\x1f\
+000196d0: 7830 305c 7830 305c 7830 3022 202b 0a20  x00\x00\x00" +. 
+000196e0: 2020 2020 2020 2020 2020 2020 2062 225c               b"\
+000196f0: 7864 315c 7839 635c 7830 625c 7839 315c  xd1\x9c\x0b\x91\
+00019700: 7831 355c 7839 305c 7831 315c 7865 385c  x15\x90\x11\xe8\
+00019710: 7838 355c 7838 305c 7864 635c 7861 395c  x85\x80\xdc\xa9\
+00019720: 7830 345c 7838 324e 5c78 6563 2220 2b0a  x04\x82N\xec" +.
+00019730: 2020 2020 2020 2020 2020 2020 2020 6222                b"
+00019740: 5c78 6266 5c78 3037 5c78 3033 5c78 3164  \xbf\x07\x03\x1d
+00019750: 5c78 3066 5c78 3066 5c78 3066 2229 0a0a  \x0f\x0f\x0f")..
+00019760: 2020 2020 6465 6620 7465 7374 5f6c 6f61      def test_loa
+00019770: 6473 5f61 6363 6570 7473 5f75 6e6b 6e6f  ds_accepts_unkno
+00019780: 776e 5f6d 696e 6f72 5f76 6572 7369 6f6e  wn_minor_version
+00019790: 5f66 696c 6528 7365 6c66 293a 0a20 2020  _file(self):.   
+000197a0: 2020 2020 206c 6f61 6473 2862 2253 5342       loads(b"SSB
+000197b0: 4267 7273 675c 7830 375c 7830 305c 7830  Bgrsg\x07\x00\x0
+000197c0: 335c 7830 3022 202b 0a20 2020 2020 2020  3\x00" +.       
+000197d0: 2020 2020 2020 2062 2268 6561 645c 7831         b"head\x1
+000197e0: 665c 7830 305c 7830 305c 7830 3022 202b  f\x00\x00\x00" +
+000197f0: 0a20 2020 2020 2020 2020 2020 2020 2062  .              b
+00019800: 225c 7864 315c 7839 635c 7830 625c 7839  "\xd1\x9c\x0b\x9
+00019810: 315c 7831 355c 7839 305c 7831 315c 7865  1\x15\x90\x11\xe
+00019820: 385c 7838 355c 7838 305c 7864 635c 7861  8\x85\x80\xdc\xa
+00019830: 395c 7830 345c 7838 324e 5c78 6563 2220  9\x04\x82N\xec" 
+00019840: 2b0a 2020 2020 2020 2020 2020 2020 2020  +.              
+00019850: 6222 5c78 6266 5c78 3037 5c78 3033 5c78  b"\xbf\x07\x03\x
+00019860: 3164 5c78 3066 5c78 3066 5c78 3066 2229  1d\x0f\x0f\x0f")
+00019870: 0a0a 2020 2020 6465 6620 7465 7374 5f6c  ..    def test_l
+00019880: 6f61 6473 5f72 656a 6563 7473 5f75 6e6b  oads_rejects_unk
+00019890: 6e6f 776e 5f76 6572 7369 6f6e 5f66 696c  nown_version_fil
+000198a0: 6528 7365 6c66 293a 0a20 2020 2020 2020  e(self):.       
+000198b0: 2077 6974 6820 7365 6c66 2e61 7373 6572   with self.asser
+000198c0: 7452 6169 7365 7328 4753 4644 6563 6f64  tRaises(GSFDecod
+000198d0: 6542 6164 5665 7273 696f 6e45 7272 6f72  eBadVersionError
+000198e0: 2920 6173 2063 6d3a 0a20 2020 2020 2020  ) as cm:.       
+000198f0: 2020 2020 206c 6f61 6473 2862 2253 5342       loads(b"SSB
+00019900: 4267 7273 675c 7830 395c 7830 305c 7830  Bgrsg\x09\x00\x0
+00019910: 335c 7830 3022 290a 2020 2020 2020 2020  3\x00").        
+00019920: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+00019930: 2863 6d2e 6578 6365 7074 696f 6e2e 6f66  (cm.exception.of
+00019940: 6673 6574 2c20 3029 0a20 2020 2020 2020  fset, 0).       
+00019950: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+00019960: 6c28 636d 2e65 7863 6570 7469 6f6e 2e6d  l(cm.exception.m
+00019970: 616a 6f72 2c20 3929 0a20 2020 2020 2020  ajor, 9).       
+00019980: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+00019990: 6c28 636d 2e65 7863 6570 7469 6f6e 2e6d  l(cm.exception.m
+000199a0: 696e 6f72 2c20 3329 0a0a 2020 2020 6465  inor, 3)..    de
+000199b0: 6620 7465 7374 5f6c 6f61 6473 5f72 656a  f test_loads_rej
+000199c0: 6563 7473 5f62 6164 5f68 6561 645f 7461  ects_bad_head_ta
+000199d0: 6728 7365 6c66 293a 0a20 2020 2020 2020  g(self):.       
+000199e0: 2077 6974 6820 7365 6c66 2e61 7373 6572   with self.asser
+000199f0: 7452 6169 7365 7328 4753 4644 6563 6f64  tRaises(GSFDecod
+00019a00: 6545 7272 6f72 2920 6173 2063 6d3a 0a20  eError) as cm:. 
+00019a10: 2020 2020 2020 2020 2020 206c 6f61 6473             loads
+00019a20: 2862 2253 5342 4267 7273 675c 7830 375c  (b"SSBBgrsg\x07\
+00019a30: 7830 305c 7830 305c 7830 3022 202b 0a20  x00\x00\x00" +. 
+00019a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019a50: 2062 225c 7866 665c 7866 665c 7866 665c   b"\xff\xff\xff\
+00019a60: 7866 665c 7830 305c 7830 305c 7830 305c  xff\x00\x00\x00\
+00019a70: 7830 3022 290a 2020 2020 2020 2020 7365  x00").        se
+00019a80: 6c66 2e61 7373 6572 7445 7175 616c 2863  lf.assertEqual(c
+00019a90: 6d2e 6578 6365 7074 696f 6e2e 6f66 6673  m.exception.offs
+00019aa0: 6574 2c20 3132 290a 0a20 2020 2064 6566  et, 12)..    def
+00019ab0: 2074 6573 745f 6c6f 6164 735f 7261 6973   test_loads_rais
+00019ac0: 6573 5f65 7863 6570 7469 6f6e 5f77 6974  es_exception_wit
+00019ad0: 686f 7574 5f68 6561 6428 7365 6c66 293a  hout_head(self):
+00019ae0: 0a20 2020 2020 2020 2077 6974 6820 7365  .        with se
+00019af0: 6c66 2e61 7373 6572 7452 6169 7365 7328  lf.assertRaises(
+00019b00: 4753 4644 6563 6f64 6545 7272 6f72 2920  GSFDecodeError) 
+00019b10: 6173 2063 6d3a 0a20 2020 2020 2020 2020  as cm:.         
+00019b20: 2020 206c 6f61 6473 2862 2253 5342 4267     loads(b"SSBBg
+00019b30: 7273 675c 7830 375c 7830 305c 7830 305c  rsg\x07\x00\x00\
+00019b40: 7830 3022 290a 2020 2020 2020 2020 7365  x00").        se
+00019b50: 6c66 2e61 7373 6572 7445 7175 616c 2863  lf.assertEqual(c
+00019b60: 6d2e 6578 6365 7074 696f 6e2e 6f66 6673  m.exception.offs
+00019b70: 6574 2c20 3132 290a 0a20 2020 2064 6566  et, 12)..    def
+00019b80: 2074 6573 745f 6c6f 6164 735f 736b 6970   test_loads_skip
+00019b90: 735f 756e 6b6e 6f77 6e5f 626c 6f63 6b5f  s_unknown_block_
+00019ba0: 6265 666f 7265 5f68 6561 6428 7365 6c66  before_head(self
+00019bb0: 293a 0a20 2020 2020 2020 2028 6865 6164  ):.        (head
+00019bc0: 2c20 7365 676d 656e 7473 2920 3d20 6c6f  , segments) = lo
+00019bd0: 6164 7328 6222 5353 4242 6772 7367 5c78  ads(b"SSBBgrsg\x
+00019be0: 3037 5c78 3030 5c78 3030 5c78 3030 2220  07\x00\x00\x00" 
+00019bf0: 2b0a 2020 2020 2020 2020 2020 2020 2020  +.              
+00019c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019c10: 2020 2062 2264 756d 795c 7830 385c 7830     b"dumy\x08\x0
+00019c20: 305c 7830 305c 7830 3022 202b 0a20 2020  0\x00\x00" +.   
+00019c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019c40: 2020 2020 2020 2020 2020 2020 2020 6222                b"
+00019c50: 6865 6164 5c78 3166 5c78 3030 5c78 3030  head\x1f\x00\x00
+00019c60: 5c78 3030 2220 2b0a 2020 2020 2020 2020  \x00" +.        
+00019c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019c80: 2020 2020 2020 2020 2062 225c 7864 315c           b"\xd1\
+00019c90: 7839 635c 7830 625c 7839 315c 7831 355c  x9c\x0b\x91\x15\
+00019ca0: 7839 305c 7831 315c 7865 385c 7838 355c  x90\x11\xe8\x85\
+00019cb0: 7838 305c 7864 635c 7861 395c 7830 345c  x80\xdc\xa9\x04\
+00019cc0: 7838 324e 5c78 6563 2220 2b0a 2020 2020  x82N\xec" +.    
+00019cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019ce0: 2020 2020 2020 2020 2020 2020 2062 225c               b"\
+00019cf0: 7862 665c 7830 375c 7830 335c 7831 645c  xbf\x07\x03\x1d\
+00019d00: 7830 665c 7830 665c 7830 6622 290a 0a20  x0f\x0f\x0f").. 
+00019d10: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+00019d20: 7274 4571 7561 6c28 6865 6164 5b27 6964  rtEqual(head['id
+00019d30: 275d 2c20 5555 4944 2827 6431 3963 3062  '], UUID('d19c0b
+00019d40: 3931 2d31 3539 302d 3131 6538 2d38 3538  91-1590-11e8-858
+00019d50: 302d 6463 6139 3034 3832 3465 6563 2729  0-dca904824eec')
+00019d60: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+00019d70: 7373 6572 7445 7175 616c 2868 6561 645b  ssertEqual(head[
+00019d80: 2763 7265 6174 6564 275d 2c20 6461 7465  'created'], date
+00019d90: 7469 6d65 2831 3938 332c 2033 2c20 3239  time(1983, 3, 29
+00019da0: 2c20 3135 2c20 3135 2c20 3135 2929 0a20  , 15, 15, 15)). 
+00019db0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+00019dc0: 7274 4571 7561 6c28 6865 6164 5b27 7365  rtEqual(head['se
+00019dd0: 676d 656e 7473 275d 2c20 5b5d 290a 2020  gments'], []).  
+00019de0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00019df0: 7445 7175 616c 2868 6561 645b 2774 6167  tEqual(head['tag
+00019e00: 7327 5d2c 205b 5d29 0a0a 2020 2020 6465  s'], [])..    de
+00019e10: 6620 7465 7374 5f6c 6f61 6473 5f73 6b69  f test_loads_ski
+00019e20: 7073 5f75 6e6b 6e6f 776e 5f62 6c6f 636b  ps_unknown_block
+00019e30: 5f69 6e73 7465 6164 5f6f 665f 7365 676d  _instead_of_segm
+00019e40: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+00019e50: 2868 6561 642c 2073 6567 6d65 6e74 7329  (head, segments)
+00019e60: 203d 206c 6f61 6473 2862 2253 5342 4267   = loads(b"SSBBg
+00019e70: 7273 675c 7830 375c 7830 305c 7830 305c  rsg\x07\x00\x00\
+00019e80: 7830 3022 202b 0a20 2020 2020 2020 2020  x00" +.         
+00019e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019ea0: 2020 2020 2020 2020 6222 6865 6164 5c78          b"head\x
+00019eb0: 3237 5c78 3030 5c78 3030 5c78 3030 2220  27\x00\x00\x00" 
+00019ec0: 2b0a 2020 2020 2020 2020 2020 2020 2020  +.              
+00019ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019ee0: 2020 2062 225c 7864 315c 7839 635c 7830     b"\xd1\x9c\x0
+00019ef0: 625c 7839 315c 7831 355c 7839 305c 7831  b\x91\x15\x90\x1
+00019f00: 315c 7865 385c 7838 355c 7838 305c 7864  1\xe8\x85\x80\xd
+00019f10: 635c 7861 395c 7830 345c 7838 324e 5c78  c\xa9\x04\x82N\x
+00019f20: 6563 2220 2b0a 2020 2020 2020 2020 2020  ec" +.          
 00019f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019f40: 2020 2020 2020 2020 2020 2020 2020 6222                b"
-00019f50: 5c78 3031 5c78 3030 2220 2b0a 2020 2020  \x01\x00" +.    
-00019f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019f70: 2020 2020 2020 2020 2020 2020 2020 2062                 b
-00019f80: 225c 7864 335c 7865 315c 7839 315c 7866  "\xd3\xe1\x91\xf
-00019f90: 305c 7831 355c 7839 345c 7831 315c 7865  0\x15\x94\x11\xe
-00019fa0: 385c 7839 315c 7861 635c 7864 635c 7861  8\x91\xac\xdc\xa
-00019fb0: 395c 7830 345c 7838 324e 5c78 6563 2220  9\x04\x82N\xec" 
-00019fc0: 2b0a 2020 2020 2020 2020 2020 2020 2020  +.              
-00019fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019fe0: 2020 2020 2062 225c 7830 315c 7830 305c       b"\x01\x00\
-00019ff0: 7830 305c 7830 305c 7830 305c 7830 305c  x00\x00\x00\x00\
-0001a000: 7830 305c 7830 3022 2929 202b 0a20 2020  x00\x00")) +.   
-0001a010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a020: 2020 2020 2020 2020 2020 2020 2020 2862                (b
-0001a030: 2267 7261 695c 7838 645c 7830 305c 7830  "grai\x8d\x00\x0
-0001a040: 305c 7830 3022 202b 0a20 2020 2020 2020  0\x00" +.       
-0001a050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a060: 2020 2020 2020 2020 2020 2062 225c 7830             b"\x0
-0001a070: 315c 7830 3022 202b 0a20 2020 2020 2020  1\x00" +.       
-0001a080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a090: 2020 2020 2020 2020 2020 2028 6222 6762             (b"gb
-0001a0a0: 6864 5c78 3833 5c78 3030 5c78 3030 5c78  hd\x83\x00\x00\x
-0001a0b0: 3030 2220 2b0a 2020 2020 2020 2020 2020  00" +.          
-0001a0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a0d0: 2020 2020 2020 2020 2073 7263 5f69 642e           src_id.
-0001a0e0: 6279 7465 7320 2b0a 2020 2020 2020 2020  bytes +.        
-0001a0f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a100: 2020 2020 2020 2020 2020 2066 6c6f 775f             flow_
-0001a110: 6964 2e62 7974 6573 202b 0a20 2020 2020  id.bytes +.     
+00019f40: 2020 2020 2020 2062 225c 7862 665c 7830         b"\xbf\x0
+00019f50: 375c 7830 335c 7831 645c 7830 665c 7830  7\x03\x1d\x0f\x0
+00019f60: 665c 7830 6622 202b 0a20 2020 2020 2020  f\x0f" +.       
+00019f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019f80: 2020 2020 2020 2020 2020 6222 6475 6d79            b"dumy
+00019f90: 5c78 3038 5c78 3030 5c78 3030 5c78 3030  \x08\x00\x00\x00
+00019fa0: 2229 0a0a 2020 2020 2020 2020 7365 6c66  ")..        self
+00019fb0: 2e61 7373 6572 7445 7175 616c 2868 6561  .assertEqual(hea
+00019fc0: 645b 2769 6427 5d2c 2055 5549 4428 2764  d['id'], UUID('d
+00019fd0: 3139 6330 6239 312d 3135 3930 2d31 3165  19c0b91-1590-11e
+00019fe0: 382d 3835 3830 2d64 6361 3930 3438 3234  8-8580-dca904824
+00019ff0: 6565 6327 2929 0a20 2020 2020 2020 2073  eec')).        s
+0001a000: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+0001a010: 6865 6164 5b27 6372 6561 7465 6427 5d2c  head['created'],
+0001a020: 2064 6174 6574 696d 6528 3139 3833 2c20   datetime(1983, 
+0001a030: 332c 2032 392c 2031 352c 2031 352c 2031  3, 29, 15, 15, 1
+0001a040: 3529 290a 2020 2020 2020 2020 7365 6c66  5)).        self
+0001a050: 2e61 7373 6572 7445 7175 616c 2868 6561  .assertEqual(hea
+0001a060: 645b 2773 6567 6d65 6e74 7327 5d2c 205b  d['segments'], [
+0001a070: 5d29 0a20 2020 2020 2020 2073 656c 662e  ]).        self.
+0001a080: 6173 7365 7274 4571 7561 6c28 6865 6164  assertEqual(head
+0001a090: 5b27 7461 6773 275d 2c20 5b5d 290a 0a20  ['tags'], []).. 
+0001a0a0: 2020 2064 6566 2074 6573 745f 6c6f 6164     def test_load
+0001a0b0: 735f 736b 6970 735f 756e 6b6e 6f77 6e5f  s_skips_unknown_
+0001a0c0: 626c 6f63 6b5f 6265 666f 7265 5f73 6567  block_before_seg
+0001a0d0: 6d28 7365 6c66 293a 0a20 2020 2020 2020  m(self):.       
+0001a0e0: 2028 6865 6164 2c20 7365 676d 656e 7473   (head, segments
+0001a0f0: 2920 3d20 6c6f 6164 7328 6222 5353 4242  ) = loads(b"SSBB
+0001a100: 6772 7367 5c78 3037 5c78 3030 5c78 3030  grsg\x07\x00\x00
+0001a110: 5c78 3030 2220 2b0a 2020 2020 2020 2020  \x00" +.        
 0001a120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a130: 2020 2020 2020 2020 2020 2020 2020 6222                b"
-0001a140: 5c78 3030 5c78 3030 5c78 3030 5c78 3030  \x00\x00\x00\x00
-0001a150: 5c78 3030 5c78 3030 5c78 3030 5c78 3030  \x00\x00\x00\x00
-0001a160: 5c78 3030 5c78 3030 5c78 3030 5c78 3030  \x00\x00\x00\x00
-0001a170: 5c78 3030 5c78 3030 5c78 3030 5c78 3030  \x00\x00\x00\x00
-0001a180: 2220 2b0a 2020 2020 2020 2020 2020 2020  " +.            
-0001a190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a1a0: 2020 2020 2020 2062 225c 7830 305c 7830         b"\x00\x0
-0001a1b0: 305c 7830 305c 7830 305c 7830 305c 7830  0\x00\x00\x00\x0
-0001a1c0: 305c 7830 305c 7830 305c 7830 305c 7830  0\x00\x00\x00\x0
-0001a1d0: 3022 202b 0a20 2020 2020 2020 2020 2020  0" +.           
-0001a1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a1f0: 2020 2020 2020 2020 6222 5c78 3030 5c78          b"\x00\x
-0001a200: 3030 5c78 3030 5c78 3030 5c78 3030 5c78  00\x00\x00\x00\x
-0001a210: 3030 5c78 3030 5c78 3030 5c78 3030 5c78  00\x00\x00\x00\x
-0001a220: 3030 2220 2b0a 2020 2020 2020 2020 2020  00" +.          
-0001a230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a240: 2020 2020 2020 2020 2062 225c 7830 305c           b"\x00\
-0001a250: 7830 305c 7830 305c 7830 305c 7830 305c  x00\x00\x00\x00\
-0001a260: 7830 305c 7830 305c 7830 3022 202b 0a20  x00\x00\x00" +. 
-0001a270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a130: 2020 2020 2020 2020 2028 6222 6865 6164           (b"head
+0001a140: 5c78 3439 5c78 3030 5c78 3030 5c78 3030  \x49\x00\x00\x00
+0001a150: 2220 2b0a 2020 2020 2020 2020 2020 2020  " +.            
+0001a160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a170: 2020 2020 2020 6222 5c78 6431 5c78 3963        b"\xd1\x9c
+0001a180: 5c78 3062 5c78 3931 5c78 3135 5c78 3930  \x0b\x91\x15\x90
+0001a190: 5c78 3131 5c78 6538 5c78 3835 5c78 3830  \x11\xe8\x85\x80
+0001a1a0: 5c78 6463 5c78 6139 5c78 3034 5c78 3832  \xdc\xa9\x04\x82
+0001a1b0: 4e5c 7865 6322 202b 0a20 2020 2020 2020  N\xec" +.       
+0001a1c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a1d0: 2020 2020 2020 2020 2020 2062 225c 7862             b"\xb
+0001a1e0: 665c 7830 375c 7830 335c 7831 645c 7830  f\x07\x03\x1d\x0
+0001a1f0: 665c 7830 665c 7830 6622 202b 0a20 2020  f\x0f\x0f" +.   
+0001a200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a210: 2020 2020 2020 2020 2020 2020 2020 2028                 (
+0001a220: 6222 6475 6d79 5c78 3038 5c78 3030 5c78  b"dumy\x08\x00\x
+0001a230: 3030 5c78 3030 2229 202b 0a20 2020 2020  00\x00") +.     
+0001a240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a250: 2020 2020 2020 2020 2020 2020 2028 6222               (b"
+0001a260: 7365 676d 5c78 3232 5c78 3030 5c78 3030  segm\x22\x00\x00
+0001a270: 5c78 3030 2220 2b0a 2020 2020 2020 2020  \x00" +.        
 0001a280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a290: 2020 6222 5c78 3030 5c78 3030 5c78 3030    b"\x00\x00\x00
-0001a2a0: 5c78 3030 5c78 3030 5c78 3030 5c78 3030  \x00\x00\x00\x00
-0001a2b0: 5c78 3030 2220 2b0a 2020 2020 2020 2020  \x00" +.        
-0001a2c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a2d0: 2020 2020 2020 2020 2020 2028 6222 7469             (b"ti
-0001a2e0: 6c73 5c78 3237 5c78 3030 5c78 3030 5c78  ls\x27\x00\x00\x
-0001a2f0: 3030 2220 2b0a 2020 2020 2020 2020 2020  00" +.          
-0001a300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a310: 2020 2020 2020 2020 2020 6222 5c78 3031            b"\x01
-0001a320: 5c78 3030 2220 2b0a 2020 2020 2020 2020  \x00" +.        
-0001a330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a340: 2020 2020 2020 2020 2020 2020 6222 6475              b"du
-0001a350: 6d6d 7920 7469 6d65 636f 6465 5c78 3030  mmy timecode\x00
-0001a360: 5c78 3030 2220 2b0a 2020 2020 2020 2020  \x00" +.        
-0001a370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a380: 2020 2020 2020 2020 2020 2020 6222 5c78              b"\x
-0001a390: 3037 5c78 3030 5c78 3030 5c78 3030 2220  07\x00\x00\x00" 
-0001a3a0: 2b0a 2020 2020 2020 2020 2020 2020 2020  +.              
-0001a3b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a3c0: 2020 2020 2020 6222 5c78 3139 5c78 3030        b"\x19\x00
-0001a3d0: 5c78 3030 5c78 3030 5c78 3031 5c78 3030  \x00\x00\x01\x00
-0001a3e0: 5c78 3030 5c78 3030 2220 2b0a 2020 2020  \x00\x00" +.    
-0001a3f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a410: 6222 5c78 3030 2229 2929 202b 0a20 2020  b"\x00"))) +.   
-0001a420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a430: 2020 2020 2020 2020 2020 2020 2020 2862                (b
-0001a440: 2267 7261 695c 7830 385c 7830 305c 7830  "grai\x08\x00\x0
-0001a450: 305c 7830 3022 2929 0a0a 2020 2020 2020  0\x00"))..      
-0001a460: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-0001a470: 616c 2868 6561 645b 2769 6427 5d2c 2055  al(head['id'], U
-0001a480: 5549 4428 2764 3139 6330 6239 312d 3135  UID('d19c0b91-15
-0001a490: 3930 2d31 3165 382d 3835 3830 2d64 6361  90-11e8-8580-dca
-0001a4a0: 3930 3438 3234 6565 6327 2929 0a20 2020  904824eec')).   
-0001a4b0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-0001a4c0: 4571 7561 6c28 6865 6164 5b27 6372 6561  Equal(head['crea
-0001a4d0: 7465 6427 5d2c 2064 6174 6574 696d 6528  ted'], datetime(
-0001a4e0: 3139 3833 2c20 332c 2032 392c 2031 352c  1983, 3, 29, 15,
-0001a4f0: 2031 352c 2031 3529 290a 2020 2020 2020   15, 15)).      
-0001a500: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-0001a510: 616c 286c 656e 2868 6561 645b 2773 6567  al(len(head['seg
-0001a520: 6d65 6e74 7327 5d29 2c20 3129 0a20 2020  ments']), 1).   
-0001a530: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-0001a540: 4571 7561 6c28 6865 6164 5b27 7365 676d  Equal(head['segm
-0001a550: 656e 7473 275d 5b30 5d5b 276c 6f63 616c  ents'][0]['local
-0001a560: 5f69 6427 5d2c 2031 290a 2020 2020 2020  _id'], 1).      
-0001a570: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-0001a580: 616c 2868 6561 645b 2773 6567 6d65 6e74  al(head['segment
-0001a590: 7327 5d5b 305d 5b27 6964 275d 2c20 5555  s'][0]['id'], UU
-0001a5a0: 4944 2827 6433 6531 3931 6630 2d31 3539  ID('d3e191f0-159
-0001a5b0: 342d 3131 6538 2d39 3161 632d 6463 6139  4-11e8-91ac-dca9
-0001a5c0: 3034 3832 3465 6563 2729 290a 2020 2020  04824eec')).    
-0001a5d0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-0001a5e0: 7175 616c 2868 6561 645b 2773 6567 6d65  qual(head['segme
-0001a5f0: 6e74 7327 5d5b 305d 5b27 7461 6773 275d  nts'][0]['tags']
-0001a600: 2c20 5b5d 290a 2020 2020 2020 2020 7365  , []).        se
-0001a610: 6c66 2e61 7373 6572 7445 7175 616c 2868  lf.assertEqual(h
-0001a620: 6561 645b 2773 6567 6d65 6e74 7327 5d5b  ead['segments'][
-0001a630: 305d 5b27 636f 756e 7427 5d2c 2031 290a  0]['count'], 1).
-0001a640: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-0001a650: 6572 7445 7175 616c 2868 6561 645b 2774  ertEqual(head['t
-0001a660: 6167 7327 5d2c 205b 5d29 0a20 2020 2020  ags'], []).     
-0001a670: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-0001a680: 7561 6c28 7365 676d 656e 7473 5b31 5d5b  ual(segments[1][
-0001a690: 305d 2e74 696d 656c 6162 656c 732c 205b  0].timelabels, [
-0001a6a0: 7b0a 2020 2020 2020 2020 2020 2020 2774  {.            't
-0001a6b0: 6167 273a 2027 6475 6d6d 7920 7469 6d65  ag': 'dummy time
-0001a6c0: 636f 6465 272c 0a20 2020 2020 2020 2020  code',.         
-0001a6d0: 2020 2027 7469 6d65 6c61 6265 6c27 3a20     'timelabel': 
-0001a6e0: 7b0a 2020 2020 2020 2020 2020 2020 2020  {.              
-0001a6f0: 2020 2766 7261 6d65 735f 7369 6e63 655f    'frames_since_
-0001a700: 6d69 646e 6967 6874 273a 2037 2c0a 2020  midnight': 7,.  
-0001a710: 2020 2020 2020 2020 2020 2020 2020 2766                'f
-0001a720: 7261 6d65 5f72 6174 655f 6e75 6d65 7261  rame_rate_numera
-0001a730: 746f 7227 3a20 3235 2c0a 2020 2020 2020  tor': 25,.      
-0001a740: 2020 2020 2020 2020 2020 2766 7261 6d65            'frame
-0001a750: 5f72 6174 655f 6465 6e6f 6d69 6e61 746f  _rate_denominato
-0001a760: 7227 3a20 312c 0a20 2020 2020 2020 2020  r': 1,.         
-0001a770: 2020 2020 2020 2027 6472 6f70 5f66 7261         'drop_fra
-0001a780: 6d65 273a 2046 616c 7365 7d7d 5d29 0a0a  me': False}}])..
-0001a790: 2020 2020 6173 796e 6320 6465 6620 7465      async def te
-0001a7a0: 7374 5f61 7379 6e63 5f6c 6f61 645f 6465  st_async_load_de
-0001a7b0: 636f 6465 735f 7469 6c73 2873 656c 6629  codes_tils(self)
-0001a7c0: 3a0a 2020 2020 2020 2020 7372 635f 6964  :.        src_id
-0001a7d0: 203d 2055 5549 4428 2763 3730 3764 3634   = UUID('c707d64
-0001a7e0: 632d 3135 3936 2d31 3165 382d 6133 6662  c-1596-11e8-a3fb
-0001a7f0: 2d64 6361 3930 3438 3234 6565 6327 290a  -dca904824eec').
-0001a800: 2020 2020 2020 2020 666c 6f77 5f69 6420          flow_id 
-0001a810: 3d20 5555 4944 2827 6461 3738 3636 3861  = UUID('da78668a
-0001a820: 2d31 3539 362d 3131 6538 2d61 3537 372d  -1596-11e8-a577-
-0001a830: 6463 6139 3034 3832 3465 6563 2729 0a20  dca904824eec'). 
-0001a840: 2020 2020 2020 2066 7020 3d20 4173 796e         fp = Asyn
-0001a850: 6342 7974 6573 494f 2862 2253 5342 4267  cBytesIO(b"SSBBg
-0001a860: 7273 675c 7830 375c 7830 305c 7830 305c  rsg\x07\x00\x00\
-0001a870: 7830 3022 202b 0a20 2020 2020 2020 2020  x00" +.         
-0001a880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a890: 2028 6222 6865 6164 5c78 3431 5c78 3030   (b"head\x41\x00
-0001a8a0: 5c78 3030 5c78 3030 2220 2b0a 2020 2020  \x00\x00" +.    
-0001a8b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a8c0: 2020 2020 2020 2062 225c 7864 315c 7839         b"\xd1\x9
-0001a8d0: 635c 7830 625c 7839 315c 7831 355c 7839  c\x0b\x91\x15\x9
-0001a8e0: 305c 7831 315c 7865 385c 7838 355c 7838  0\x11\xe8\x85\x8
-0001a8f0: 305c 7864 635c 7861 395c 7830 345c 7838  0\xdc\xa9\x04\x8
-0001a900: 324e 5c78 6563 2220 2b0a 2020 2020 2020  2N\xec" +.      
-0001a910: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a920: 2020 2020 2062 225c 7862 665c 7830 375c       b"\xbf\x07\
-0001a930: 7830 335c 7831 645c 7830 665c 7830 665c  x03\x1d\x0f\x0f\
-0001a940: 7830 6622 202b 0a20 2020 2020 2020 2020  x0f" +.         
-0001a950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a960: 2020 2862 2273 6567 6d5c 7832 325c 7830    (b"segm\x22\x0
-0001a970: 305c 7830 305c 7830 3022 202b 0a20 2020  0\x00\x00" +.   
-0001a980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a990: 2020 2020 2020 2020 2062 225c 7830 315c           b"\x01\
-0001a9a0: 7830 3022 202b 0a20 2020 2020 2020 2020  x00" +.         
+0001a290: 2020 2020 2020 2020 2020 2062 225c 7830             b"\x0
+0001a2a0: 315c 7830 3022 202b 0a20 2020 2020 2020  1\x00" +.       
+0001a2b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a2c0: 2020 2020 2020 2020 2020 2020 6222 5c78              b"\x
+0001a2d0: 6433 5c78 6531 5c78 3931 5c78 6630 5c78  d3\xe1\x91\xf0\x
+0001a2e0: 3135 5c78 3934 5c78 3131 5c78 6538 5c78  15\x94\x11\xe8\x
+0001a2f0: 3931 5c78 6163 5c78 6463 5c78 6139 5c78  91\xac\xdc\xa9\x
+0001a300: 3034 5c78 3832 4e5c 7865 6322 202b 0a20  04\x82N\xec" +. 
+0001a310: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a330: 2020 6222 5c78 3030 5c78 3030 5c78 3030    b"\x00\x00\x00
+0001a340: 5c78 3030 5c78 3030 5c78 3030 5c78 3030  \x00\x00\x00\x00
+0001a350: 5c78 3030 2229 2929 0a0a 2020 2020 2020  \x00")))..      
+0001a360: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+0001a370: 616c 2868 6561 645b 2769 6427 5d2c 2055  al(head['id'], U
+0001a380: 5549 4428 2764 3139 6330 6239 312d 3135  UID('d19c0b91-15
+0001a390: 3930 2d31 3165 382d 3835 3830 2d64 6361  90-11e8-8580-dca
+0001a3a0: 3930 3438 3234 6565 6327 2929 0a20 2020  904824eec')).   
+0001a3b0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+0001a3c0: 4571 7561 6c28 6865 6164 5b27 6372 6561  Equal(head['crea
+0001a3d0: 7465 6427 5d2c 2064 6174 6574 696d 6528  ted'], datetime(
+0001a3e0: 3139 3833 2c20 332c 2032 392c 2031 352c  1983, 3, 29, 15,
+0001a3f0: 2031 352c 2031 3529 290a 2020 2020 2020   15, 15)).      
+0001a400: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+0001a410: 616c 286c 656e 2868 6561 645b 2773 6567  al(len(head['seg
+0001a420: 6d65 6e74 7327 5d29 2c20 3129 0a20 2020  ments']), 1).   
+0001a430: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+0001a440: 4571 7561 6c28 6865 6164 5b27 7365 676d  Equal(head['segm
+0001a450: 656e 7473 275d 5b30 5d5b 276c 6f63 616c  ents'][0]['local
+0001a460: 5f69 6427 5d2c 2031 290a 2020 2020 2020  _id'], 1).      
+0001a470: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+0001a480: 616c 2868 6561 645b 2773 6567 6d65 6e74  al(head['segment
+0001a490: 7327 5d5b 305d 5b27 6964 275d 2c20 5555  s'][0]['id'], UU
+0001a4a0: 4944 2827 6433 6531 3931 6630 2d31 3539  ID('d3e191f0-159
+0001a4b0: 342d 3131 6538 2d39 3161 632d 6463 6139  4-11e8-91ac-dca9
+0001a4c0: 3034 3832 3465 6563 2729 290a 2020 2020  04824eec')).    
+0001a4d0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+0001a4e0: 7175 616c 2868 6561 645b 2773 6567 6d65  qual(head['segme
+0001a4f0: 6e74 7327 5d5b 305d 5b27 7461 6773 275d  nts'][0]['tags']
+0001a500: 2c20 5b5d 290a 2020 2020 2020 2020 7365  , []).        se
+0001a510: 6c66 2e61 7373 6572 7445 7175 616c 2868  lf.assertEqual(h
+0001a520: 6561 645b 2773 6567 6d65 6e74 7327 5d5b  ead['segments'][
+0001a530: 305d 5b27 636f 756e 7427 5d2c 2030 290a  0]['count'], 0).
+0001a540: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+0001a550: 6572 7445 7175 616c 2868 6561 645b 2774  ertEqual(head['t
+0001a560: 6167 7327 5d2c 205b 5d29 0a0a 2020 2020  ags'], [])..    
+0001a570: 6465 6620 7465 7374 5f6c 6f61 6473 5f72  def test_loads_r
+0001a580: 6169 7365 735f 7768 656e 5f68 6561 645f  aises_when_head_
+0001a590: 746f 6f5f 736d 616c 6c28 7365 6c66 293a  too_small(self):
+0001a5a0: 0a20 2020 2020 2020 2077 6974 6820 7365  .        with se
+0001a5b0: 6c66 2e61 7373 6572 7452 6169 7365 7328  lf.assertRaises(
+0001a5c0: 4753 4644 6563 6f64 6545 7272 6f72 2920  GSFDecodeError) 
+0001a5d0: 6173 2063 6d3a 0a20 2020 2020 2020 2020  as cm:.         
+0001a5e0: 2020 2028 6865 6164 2c20 7365 676d 656e     (head, segmen
+0001a5f0: 7473 2920 3d20 6c6f 6164 7328 6222 5353  ts) = loads(b"SS
+0001a600: 4242 6772 7367 5c78 3037 5c78 3030 5c78  BBgrsg\x07\x00\x
+0001a610: 3030 5c78 3030 2220 2b0a 2020 2020 2020  00\x00" +.      
+0001a620: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a630: 2020 2020 2020 2020 2020 2020 2020 2028                 (
+0001a640: 6222 6865 6164 5c78 3239 5c78 3030 5c78  b"head\x29\x00\x
+0001a650: 3030 5c78 3030 2220 2b0a 2020 2020 2020  00\x00" +.      
+0001a660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a680: 6222 5c78 6431 5c78 3963 5c78 3062 5c78  b"\xd1\x9c\x0b\x
+0001a690: 3931 5c78 3135 5c78 3930 5c78 3131 5c78  91\x15\x90\x11\x
+0001a6a0: 6538 5c78 3835 5c78 3830 5c78 6463 5c78  e8\x85\x80\xdc\x
+0001a6b0: 6139 5c78 3034 5c78 3832 4e5c 7865 6322  a9\x04\x82N\xec"
+0001a6c0: 202b 0a20 2020 2020 2020 2020 2020 2020   +.             
+0001a6d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a6e0: 2020 2020 2020 2020 2062 225c 7862 665c           b"\xbf\
+0001a6f0: 7830 375c 7830 335c 7831 645c 7830 665c  x07\x03\x1d\x0f\
+0001a700: 7830 665c 7830 6622 202b 0a20 2020 2020  x0f\x0f" +.     
+0001a710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a730: 2028 6222 6475 6d79 5c78 3038 5c78 3030   (b"dumy\x08\x00
+0001a740: 5c78 3030 5c78 3030 2229 202b 0a20 2020  \x00\x00") +.   
+0001a750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a770: 2020 2028 6222 7365 676d 5c78 3232 5c78     (b"segm\x22\x
+0001a780: 3030 5c78 3030 5c78 3030 2220 2b0a 2020  00\x00\x00" +.  
+0001a790: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a7a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a7b0: 2020 2020 2062 225c 7830 315c 7830 3022       b"\x01\x00"
+0001a7c0: 202b 0a20 2020 2020 2020 2020 2020 2020   +.             
+0001a7d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a7e0: 2020 2020 2020 2020 2020 6222 5c78 6433            b"\xd3
+0001a7f0: 5c78 6531 5c78 3931 5c78 6630 5c78 3135  \xe1\x91\xf0\x15
+0001a800: 5c78 3934 5c78 3131 5c78 6538 5c78 3931  \x94\x11\xe8\x91
+0001a810: 5c78 6163 5c78 6463 5c78 6139 5c78 3034  \xac\xdc\xa9\x04
+0001a820: 5c78 3832 4e5c 7865 6322 202b 0a20 2020  \x82N\xec" +.   
+0001a830: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a850: 2020 2020 6222 5c78 3030 5c78 3030 5c78      b"\x00\x00\x
+0001a860: 3030 5c78 3030 5c78 3030 5c78 3030 5c78  00\x00\x00\x00\x
+0001a870: 3030 5c78 3030 2229 2929 0a0a 2020 2020  00\x00")))..    
+0001a880: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+0001a890: 7175 616c 2863 6d2e 6578 6365 7074 696f  qual(cm.exceptio
+0001a8a0: 6e2e 6f66 6673 6574 2c20 3531 290a 0a20  n.offset, 51).. 
+0001a8b0: 2020 2064 6566 2074 6573 745f 6c6f 6164     def test_load
+0001a8c0: 735f 7261 6973 6573 5f77 6865 6e5f 7365  s_raises_when_se
+0001a8d0: 676d 5f74 6f6f 5f73 6d61 6c6c 2873 656c  gm_too_small(sel
+0001a8e0: 6629 3a0a 2020 2020 2020 2020 7769 7468  f):.        with
+0001a8f0: 2073 656c 662e 6173 7365 7274 5261 6973   self.assertRais
+0001a900: 6573 2847 5346 4465 636f 6465 4572 726f  es(GSFDecodeErro
+0001a910: 7229 2061 7320 636d 3a0a 2020 2020 2020  r) as cm:.      
+0001a920: 2020 2020 2020 2868 6561 642c 2073 6567        (head, seg
+0001a930: 6d65 6e74 7329 203d 206c 6f61 6473 2862  ments) = loads(b
+0001a940: 2253 5342 4267 7273 675c 7830 375c 7830  "SSBBgrsg\x07\x0
+0001a950: 305c 7830 305c 7830 3022 202b 0a20 2020  0\x00\x00" +.   
+0001a960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a970: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a980: 2020 2862 2268 6561 645c 7834 315c 7830    (b"head\x41\x0
+0001a990: 305c 7830 305c 7830 3022 202b 0a20 2020  0\x00\x00" +.   
+0001a9a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001a9b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a9c0: 2020 2062 225c 7864 335c 7865 315c 7839     b"\xd3\xe1\x9
-0001a9d0: 315c 7866 305c 7831 355c 7839 345c 7831  1\xf0\x15\x94\x1
-0001a9e0: 315c 7865 385c 7839 315c 7861 635c 7864  1\xe8\x91\xac\xd
+0001a9c0: 2020 2062 225c 7864 315c 7839 635c 7830     b"\xd1\x9c\x0
+0001a9d0: 625c 7839 315c 7831 355c 7839 305c 7831  b\x91\x15\x90\x1
+0001a9e0: 315c 7865 385c 7838 355c 7838 305c 7864  1\xe8\x85\x80\xd
 0001a9f0: 635c 7861 395c 7830 345c 7838 324e 5c78  c\xa9\x04\x82N\x
 0001aa00: 6563 2220 2b0a 2020 2020 2020 2020 2020  ec" +.          
 0001aa10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001aa20: 2020 6222 5c78 3031 5c78 3030 5c78 3030    b"\x01\x00\x00
-0001aa30: 5c78 3030 5c78 3030 5c78 3030 5c78 3030  \x00\x00\x00\x00
-0001aa40: 5c78 3030 2229 2920 2b0a 2020 2020 2020  \x00")) +.      
+0001aa20: 2020 2020 2020 2020 2020 2020 6222 5c78              b"\x
+0001aa30: 6266 5c78 3037 5c78 3033 5c78 3164 5c78  bf\x07\x03\x1d\x
+0001aa40: 3066 5c78 3066 5c78 3066 2220 2b0a 2020  0f\x0f\x0f" +.  
 0001aa50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001aa60: 2020 2020 2862 2267 7261 695c 7838 645c      (b"grai\x8d\
-0001aa70: 7830 305c 7830 305c 7830 3022 202b 0a20  x00\x00\x00" +. 
-0001aa80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001aa90: 2020 2020 2020 2020 2020 6222 5c78 3031            b"\x01
-0001aaa0: 5c78 3030 2220 2b0a 2020 2020 2020 2020  \x00" +.        
-0001aab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001aac0: 2020 2028 6222 6762 6864 5c78 3833 5c78     (b"gbhd\x83\x
-0001aad0: 3030 5c78 3030 5c78 3030 2220 2b0a 2020  00\x00\x00" +.  
-0001aae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001aaf0: 2020 2020 2020 2020 2020 7372 635f 6964            src_id
-0001ab00: 2e62 7974 6573 202b 0a20 2020 2020 2020  .bytes +.       
-0001ab10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ab20: 2020 2020 2066 6c6f 775f 6964 2e62 7974       flow_id.byt
-0001ab30: 6573 202b 0a20 2020 2020 2020 2020 2020  es +.           
+0001aa60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001aa70: 2020 2020 2862 2273 6567 6d5c 7832 315c      (b"segm\x21\
+0001aa80: 7830 305c 7830 305c 7830 3022 202b 0a20  x00\x00\x00" +. 
+0001aa90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001aaa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001aab0: 2020 2020 2020 6222 5c78 3031 5c78 3030        b"\x01\x00
+0001aac0: 2220 2b0a 2020 2020 2020 2020 2020 2020  " +.            
+0001aad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001aae0: 2020 2020 2020 2020 2020 2062 225c 7864             b"\xd
+0001aaf0: 335c 7865 315c 7839 315c 7866 305c 7831  3\xe1\x91\xf0\x1
+0001ab00: 355c 7839 345c 7831 315c 7865 385c 7839  5\x94\x11\xe8\x9
+0001ab10: 315c 7861 635c 7864 635c 7861 395c 7830  1\xac\xdc\xa9\x0
+0001ab20: 345c 7838 324e 5c78 6563 2220 2b0a 2020  4\x82N\xec" +.  
+0001ab30: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001ab40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ab50: 2062 225c 7830 305c 7830 305c 7830 305c   b"\x00\x00\x00\
+0001ab50: 2020 2020 2062 225c 7830 305c 7830 305c       b"\x00\x00\
 0001ab60: 7830 305c 7830 305c 7830 305c 7830 305c  x00\x00\x00\x00\
-0001ab70: 7830 305c 7830 305c 7830 305c 7830 305c  x00\x00\x00\x00\
-0001ab80: 7830 305c 7830 305c 7830 305c 7830 305c  x00\x00\x00\x00\
-0001ab90: 7830 3022 202b 0a20 2020 2020 2020 2020  x00" +.         
-0001aba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001abb0: 2020 2062 225c 7830 305c 7830 305c 7830     b"\x00\x00\x0
-0001abc0: 305c 7830 305c 7830 305c 7830 305c 7830  0\x00\x00\x00\x0
-0001abd0: 305c 7830 305c 7830 305c 7830 3022 202b  0\x00\x00\x00" +
-0001abe0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001abf0: 2020 2020 2020 2020 2020 2020 2062 225c               b"\
-0001ac00: 7830 305c 7830 305c 7830 305c 7830 305c  x00\x00\x00\x00\
-0001ac10: 7830 305c 7830 305c 7830 305c 7830 305c  x00\x00\x00\x00\
-0001ac20: 7830 305c 7830 3022 202b 0a20 2020 2020  x00\x00" +.     
-0001ac30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ac40: 2020 2020 2020 2062 225c 7830 305c 7830         b"\x00\x0
-0001ac50: 305c 7830 305c 7830 305c 7830 305c 7830  0\x00\x00\x00\x0
-0001ac60: 305c 7830 305c 7830 3022 202b 0a20 2020  0\x00\x00" +.   
-0001ac70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ac80: 2020 2020 2020 2020 2062 225c 7830 305c           b"\x00\
-0001ac90: 7830 305c 7830 305c 7830 305c 7830 305c  x00\x00\x00\x00\
-0001aca0: 7830 305c 7830 305c 7830 3022 202b 0a20  x00\x00\x00" +. 
-0001acb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001acc0: 2020 2020 2020 2020 2020 2028 6222 7469             (b"ti
-0001acd0: 6c73 5c78 3237 5c78 3030 5c78 3030 5c78  ls\x27\x00\x00\x
-0001ace0: 3030 2220 2b0a 2020 2020 2020 2020 2020  00" +.          
-0001acf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ad00: 2020 2062 225c 7830 315c 7830 3022 202b     b"\x01\x00" +
-0001ad10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001ad20: 2020 2020 2020 2020 2020 2020 2020 6222                b"
-0001ad30: 6475 6d6d 7920 7469 6d65 636f 6465 5c78  dummy timecode\x
-0001ad40: 3030 5c78 3030 2220 2b0a 2020 2020 2020  00\x00" +.      
-0001ad50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ad60: 2020 2020 2020 2062 225c 7830 375c 7830         b"\x07\x0
-0001ad70: 305c 7830 305c 7830 3022 202b 0a20 2020  0\x00\x00" +.   
+0001ab70: 7830 305c 7830 3022 2929 290a 0a20 2020  x00\x00")))..   
+0001ab80: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+0001ab90: 4571 7561 6c28 636d 2e65 7863 6570 7469  Equal(cm.excepti
+0001aba0: 6f6e 2e6f 6666 7365 742c 2037 3729 0a0a  on.offset, 77)..
+0001abb0: 2020 2020 6465 6620 7465 7374 5f6c 6f61      def test_loa
+0001abc0: 6473 5f64 6563 6f64 6573 5f74 696c 7328  ds_decodes_tils(
+0001abd0: 7365 6c66 293a 0a20 2020 2020 2020 2073  self):.        s
+0001abe0: 7263 5f69 6420 3d20 5555 4944 2827 6337  rc_id = UUID('c7
+0001abf0: 3037 6436 3463 2d31 3539 362d 3131 6538  07d64c-1596-11e8
+0001ac00: 2d61 3366 622d 6463 6139 3034 3832 3465  -a3fb-dca904824e
+0001ac10: 6563 2729 0a20 2020 2020 2020 2066 6c6f  ec').        flo
+0001ac20: 775f 6964 203d 2055 5549 4428 2764 6137  w_id = UUID('da7
+0001ac30: 3836 3638 612d 3135 3936 2d31 3165 382d  8668a-1596-11e8-
+0001ac40: 6135 3737 2d64 6361 3930 3438 3234 6565  a577-dca904824ee
+0001ac50: 6327 290a 2020 2020 2020 2020 2868 6561  c').        (hea
+0001ac60: 642c 2073 6567 6d65 6e74 7329 203d 206c  d, segments) = l
+0001ac70: 6f61 6473 2862 2253 5342 4267 7273 675c  oads(b"SSBBgrsg\
+0001ac80: 7830 375c 7830 305c 7830 305c 7830 3022  x07\x00\x00\x00"
+0001ac90: 202b 0a20 2020 2020 2020 2020 2020 2020   +.             
+0001aca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001acb0: 2020 2020 2862 2268 6561 645c 7834 315c      (b"head\x41\
+0001acc0: 7830 305c 7830 305c 7830 3022 202b 0a20  x00\x00\x00" +. 
+0001acd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ace0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001acf0: 2062 225c 7864 315c 7839 635c 7830 625c   b"\xd1\x9c\x0b\
+0001ad00: 7839 315c 7831 355c 7839 305c 7831 315c  x91\x15\x90\x11\
+0001ad10: 7865 385c 7838 355c 7838 305c 7864 635c  xe8\x85\x80\xdc\
+0001ad20: 7861 395c 7830 345c 7838 324e 5c78 6563  xa9\x04\x82N\xec
+0001ad30: 2220 2b0a 2020 2020 2020 2020 2020 2020  " +.            
+0001ad40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ad50: 2020 2020 2020 6222 5c78 6266 5c78 3037        b"\xbf\x07
+0001ad60: 5c78 3033 5c78 3164 5c78 3066 5c78 3066  \x03\x1d\x0f\x0f
+0001ad70: 5c78 3066 2220 2b0a 2020 2020 2020 2020  \x0f" +.        
 0001ad80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ad90: 2020 2020 2020 2020 2020 6222 5c78 3139            b"\x19
-0001ada0: 5c78 3030 5c78 3030 5c78 3030 5c78 3031  \x00\x00\x00\x01
-0001adb0: 5c78 3030 5c78 3030 5c78 3030 2220 2b0a  \x00\x00\x00" +.
+0001ad90: 2020 2020 2020 2020 2020 2862 2273 6567            (b"seg
+0001ada0: 6d5c 7832 325c 7830 305c 7830 305c 7830  m\x22\x00\x00\x0
+0001adb0: 3022 202b 0a20 2020 2020 2020 2020 2020  0" +.           
 0001adc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001add0: 2020 2020 2020 2020 2020 2020 2062 225c               b"\
-0001ade0: 7830 3022 2929 2920 2b0a 2020 2020 2020  x00"))) +.      
+0001add0: 2020 2020 2020 2020 6222 5c78 3031 5c78          b"\x01\x
+0001ade0: 3030 2220 2b0a 2020 2020 2020 2020 2020  00" +.          
 0001adf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ae00: 2020 2020 2862 2267 7261 695c 7830 385c      (b"grai\x08\
-0001ae10: 7830 305c 7830 305c 7830 3022 2929 0a20  x00\x00\x00")). 
-0001ae20: 2020 2020 2020 2028 6865 6164 2c20 7365         (head, se
-0001ae30: 676d 656e 7473 2920 3d20 6177 6169 7420  gments) = await 
-0001ae40: 6c6f 6164 2866 7029 0a0a 2020 2020 2020  load(fp)..      
-0001ae50: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-0001ae60: 616c 2868 6561 645b 2769 6427 5d2c 2055  al(head['id'], U
-0001ae70: 5549 4428 2764 3139 6330 6239 312d 3135  UID('d19c0b91-15
-0001ae80: 3930 2d31 3165 382d 3835 3830 2d64 6361  90-11e8-8580-dca
-0001ae90: 3930 3438 3234 6565 6327 2929 0a20 2020  904824eec')).   
-0001aea0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-0001aeb0: 4571 7561 6c28 6865 6164 5b27 6372 6561  Equal(head['crea
-0001aec0: 7465 6427 5d2c 2064 6174 6574 696d 6528  ted'], datetime(
-0001aed0: 3139 3833 2c20 332c 2032 392c 2031 352c  1983, 3, 29, 15,
-0001aee0: 2031 352c 2031 3529 290a 2020 2020 2020   15, 15)).      
-0001aef0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-0001af00: 616c 286c 656e 2868 6561 645b 2773 6567  al(len(head['seg
-0001af10: 6d65 6e74 7327 5d29 2c20 3129 0a20 2020  ments']), 1).   
-0001af20: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-0001af30: 4571 7561 6c28 6865 6164 5b27 7365 676d  Equal(head['segm
-0001af40: 656e 7473 275d 5b30 5d5b 276c 6f63 616c  ents'][0]['local
-0001af50: 5f69 6427 5d2c 2031 290a 2020 2020 2020  _id'], 1).      
-0001af60: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-0001af70: 616c 2868 6561 645b 2773 6567 6d65 6e74  al(head['segment
-0001af80: 7327 5d5b 305d 5b27 6964 275d 2c20 5555  s'][0]['id'], UU
-0001af90: 4944 2827 6433 6531 3931 6630 2d31 3539  ID('d3e191f0-159
-0001afa0: 342d 3131 6538 2d39 3161 632d 6463 6139  4-11e8-91ac-dca9
-0001afb0: 3034 3832 3465 6563 2729 290a 2020 2020  04824eec')).    
-0001afc0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-0001afd0: 7175 616c 2868 6561 645b 2773 6567 6d65  qual(head['segme
-0001afe0: 6e74 7327 5d5b 305d 5b27 7461 6773 275d  nts'][0]['tags']
-0001aff0: 2c20 5b5d 290a 2020 2020 2020 2020 7365  , []).        se
-0001b000: 6c66 2e61 7373 6572 7445 7175 616c 2868  lf.assertEqual(h
-0001b010: 6561 645b 2773 6567 6d65 6e74 7327 5d5b  ead['segments'][
-0001b020: 305d 5b27 636f 756e 7427 5d2c 2031 290a  0]['count'], 1).
-0001b030: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-0001b040: 6572 7445 7175 616c 2868 6561 645b 2774  ertEqual(head['t
-0001b050: 6167 7327 5d2c 205b 5d29 0a20 2020 2020  ags'], []).     
-0001b060: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-0001b070: 7561 6c28 7365 676d 656e 7473 5b31 5d5b  ual(segments[1][
-0001b080: 305d 2e74 696d 656c 6162 656c 732c 205b  0].timelabels, [
-0001b090: 7b0a 2020 2020 2020 2020 2020 2020 2774  {.            't
-0001b0a0: 6167 273a 2027 6475 6d6d 7920 7469 6d65  ag': 'dummy time
-0001b0b0: 636f 6465 272c 0a20 2020 2020 2020 2020  code',.         
-0001b0c0: 2020 2027 7469 6d65 6c61 6265 6c27 3a20     'timelabel': 
-0001b0d0: 7b0a 2020 2020 2020 2020 2020 2020 2020  {.              
-0001b0e0: 2020 2766 7261 6d65 735f 7369 6e63 655f    'frames_since_
-0001b0f0: 6d69 646e 6967 6874 273a 2037 2c0a 2020  midnight': 7,.  
-0001b100: 2020 2020 2020 2020 2020 2020 2020 2766                'f
-0001b110: 7261 6d65 5f72 6174 655f 6e75 6d65 7261  rame_rate_numera
-0001b120: 746f 7227 3a20 3235 2c0a 2020 2020 2020  tor': 25,.      
-0001b130: 2020 2020 2020 2020 2020 2766 7261 6d65            'frame
-0001b140: 5f72 6174 655f 6465 6e6f 6d69 6e61 746f  _rate_denominato
-0001b150: 7227 3a20 312c 0a20 2020 2020 2020 2020  r': 1,.         
-0001b160: 2020 2020 2020 2027 6472 6f70 5f66 7261         'drop_fra
-0001b170: 6d65 273a 2046 616c 7365 7d7d 5d29 0a0a  me': False}}])..
-0001b180: 2020 2020 6465 6620 7465 7374 5f6c 6f61      def test_loa
-0001b190: 6473 5f72 6169 7365 735f 7768 656e 5f67  ds_raises_when_g
-0001b1a0: 7261 696e 5f74 7970 655f 756e 6b6e 6f77  rain_type_unknow
-0001b1b0: 6e28 7365 6c66 293a 0a20 2020 2020 2020  n(self):.       
-0001b1c0: 2077 6974 6820 7365 6c66 2e61 7373 6572   with self.asser
-0001b1d0: 7452 6169 7365 7328 4753 4644 6563 6f64  tRaises(GSFDecod
-0001b1e0: 6545 7272 6f72 2920 6173 2063 6d3a 0a20  eError) as cm:. 
-0001b1f0: 2020 2020 2020 2020 2020 2073 7263 5f69             src_i
-0001b200: 6420 3d20 5555 4944 2827 6337 3037 6436  d = UUID('c707d6
-0001b210: 3463 2d31 3539 362d 3131 6538 2d61 3366  4c-1596-11e8-a3f
-0001b220: 622d 6463 6139 3034 3832 3465 6563 2729  b-dca904824eec')
-0001b230: 0a20 2020 2020 2020 2020 2020 2066 6c6f  .            flo
-0001b240: 775f 6964 203d 2055 5549 4428 2764 6137  w_id = UUID('da7
-0001b250: 3836 3638 612d 3135 3936 2d31 3165 382d  8668a-1596-11e8-
-0001b260: 6135 3737 2d64 6361 3930 3438 3234 6565  a577-dca904824ee
-0001b270: 6327 290a 2020 2020 2020 2020 2020 2020  c').            
-0001b280: 2868 6561 642c 2073 6567 6d65 6e74 7329  (head, segments)
-0001b290: 203d 206c 6f61 6473 2862 2253 5342 4267   = loads(b"SSBBg
-0001b2a0: 7273 675c 7830 375c 7830 305c 7830 305c  rsg\x07\x00\x00\
-0001b2b0: 7830 3022 202b 0a20 2020 2020 2020 2020  x00" +.         
-0001b2c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b2d0: 2020 2020 2020 2020 2020 2020 2862 2268              (b"h
-0001b2e0: 6561 645c 7834 315c 7830 305c 7830 305c  ead\x41\x00\x00\
-0001b2f0: 7830 3022 202b 0a20 2020 2020 2020 2020  x00" +.         
-0001b300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b310: 2020 2020 2020 2020 2020 2020 2062 225c               b"\
-0001b320: 7864 315c 7839 635c 7830 625c 7839 315c  xd1\x9c\x0b\x91\
-0001b330: 7831 355c 7839 305c 7831 315c 7865 385c  x15\x90\x11\xe8\
-0001b340: 7838 355c 7838 305c 7864 635c 7861 395c  x85\x80\xdc\xa9\
-0001b350: 7830 345c 7838 324e 5c78 6563 2220 2b0a  x04\x82N\xec" +.
-0001b360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b380: 2020 2020 2020 6222 5c78 6266 5c78 3037        b"\xbf\x07
-0001b390: 5c78 3033 5c78 3164 5c78 3066 5c78 3066  \x03\x1d\x0f\x0f
-0001b3a0: 5c78 3066 2220 2b0a 2020 2020 2020 2020  \x0f" +.        
-0001b3b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b3c0: 2020 2020 2020 2020 2020 2020 2020 2862                (b
-0001b3d0: 2273 6567 6d5c 7832 325c 7830 305c 7830  "segm\x22\x00\x0
-0001b3e0: 305c 7830 3022 202b 0a20 2020 2020 2020  0\x00" +.       
-0001b3f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b410: 6222 5c78 3031 5c78 3030 2220 2b0a 2020  b"\x01\x00" +.  
-0001b420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b440: 2020 2020 2062 225c 7864 335c 7865 315c       b"\xd3\xe1\
-0001b450: 7839 315c 7866 305c 7831 355c 7839 345c  x91\xf0\x15\x94\
-0001b460: 7831 315c 7865 385c 7839 315c 7861 635c  x11\xe8\x91\xac\
-0001b470: 7864 635c 7861 395c 7830 345c 7838 324e  xdc\xa9\x04\x82N
-0001b480: 5c78 6563 2220 2b0a 2020 2020 2020 2020  \xec" +.        
-0001b490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b4a0: 2020 2020 2020 2020 2020 2020 2020 2062                 b
-0001b4b0: 225c 7830 315c 7830 305c 7830 305c 7830  "\x01\x00\x00\x0
-0001b4c0: 305c 7830 305c 7830 305c 7830 305c 7830  0\x00\x00\x00\x0
-0001b4d0: 3022 2929 202b 0a20 2020 2020 2020 2020  0")) +.         
-0001b4e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b4f0: 2020 2020 2020 2020 2020 2020 2862 2267              (b"g
-0001b500: 7261 695c 7838 645c 7830 305c 7830 305c  rai\x8d\x00\x00\
-0001b510: 7830 3022 202b 0a20 2020 2020 2020 2020  x00" +.         
-0001b520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b530: 2020 2020 2020 2020 2020 2020 2062 225c               b"\
-0001b540: 7830 315c 7830 3022 202b 0a20 2020 2020  x01\x00" +.     
-0001b550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b570: 2028 6222 6762 6864 5c78 3833 5c78 3030   (b"gbhd\x83\x00
-0001b580: 5c78 3030 5c78 3030 2220 2b0a 2020 2020  \x00\x00" +.    
-0001b590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b5a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b5b0: 2020 2073 7263 5f69 642e 6279 7465 7320     src_id.bytes 
-0001b5c0: 2b0a 2020 2020 2020 2020 2020 2020 2020  +.              
-0001b5d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b5e0: 2020 2020 2020 2020 2066 6c6f 775f 6964           flow_id
-0001b5f0: 2e62 7974 6573 202b 0a20 2020 2020 2020  .bytes +.       
-0001b600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b620: 6222 5c78 3030 5c78 3030 5c78 3030 5c78  b"\x00\x00\x00\x
-0001b630: 3030 5c78 3030 5c78 3030 5c78 3030 5c78  00\x00\x00\x00\x
-0001b640: 3030 5c78 3030 5c78 3030 5c78 3030 5c78  00\x00\x00\x00\x
-0001b650: 3030 5c78 3030 5c78 3030 5c78 3030 5c78  00\x00\x00\x00\x
-0001b660: 3030 2220 2b0a 2020 2020 2020 2020 2020  00" +.          
-0001b670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b680: 2020 2020 2020 2020 2020 2020 2062 225c               b"\
-0001b690: 7830 305c 7830 305c 7830 305c 7830 305c  x00\x00\x00\x00\
-0001b6a0: 7830 305c 7830 305c 7830 305c 7830 305c  x00\x00\x00\x00\
-0001b6b0: 7830 305c 7830 3022 202b 0a20 2020 2020  x00\x00" +.     
-0001b6c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b6d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b6e0: 2020 6222 5c78 3030 5c78 3030 5c78 3030    b"\x00\x00\x00
-0001b6f0: 5c78 3030 5c78 3030 5c78 3030 5c78 3030  \x00\x00\x00\x00
-0001b700: 5c78 3030 5c78 3030 5c78 3030 2220 2b0a  \x00\x00\x00" +.
-0001b710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b730: 2020 2020 2020 2062 225c 7830 305c 7830         b"\x00\x0
-0001b740: 305c 7830 305c 7830 305c 7830 305c 7830  0\x00\x00\x00\x0
-0001b750: 305c 7830 305c 7830 3022 202b 0a20 2020  0\x00\x00" +.   
-0001b760: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b780: 2020 2020 6222 5c78 3030 5c78 3030 5c78      b"\x00\x00\x
-0001b790: 3030 5c78 3030 5c78 3030 5c78 3030 5c78  00\x00\x00\x00\x
-0001b7a0: 3030 5c78 3030 2220 2b0a 2020 2020 2020  00\x00" +.      
-0001b7b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b7c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b7d0: 2028 6222 6475 6d79 5c78 3038 5c78 3030   (b"dumy\x08\x00
-0001b7e0: 5c78 3030 5c78 3030 2229 2929 290a 0a20  \x00\x00")))).. 
-0001b7f0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-0001b800: 7274 4571 7561 6c28 636d 2e65 7863 6570  rtEqual(cm.excep
-0001b810: 7469 6f6e 2e6f 6666 7365 742c 2031 3739  tion.offset, 179
-0001b820: 290a 0a20 2020 2064 6566 2074 6573 745f  )..    def test_
-0001b830: 6c6f 6164 735f 6465 636f 6465 735f 656d  loads_decodes_em
-0001b840: 7074 795f 6772 6169 6e73 2873 656c 6629  pty_grains(self)
-0001b850: 3a0a 2020 2020 2020 2020 7372 635f 6964  :.        src_id
-0001b860: 203d 2055 5549 4428 2763 3730 3764 3634   = UUID('c707d64
-0001b870: 632d 3135 3936 2d31 3165 382d 6133 6662  c-1596-11e8-a3fb
-0001b880: 2d64 6361 3930 3438 3234 6565 6327 290a  -dca904824eec').
-0001b890: 2020 2020 2020 2020 666c 6f77 5f69 6420          flow_id 
-0001b8a0: 3d20 5555 4944 2827 6461 3738 3636 3861  = UUID('da78668a
-0001b8b0: 2d31 3539 362d 3131 6538 2d61 3537 372d  -1596-11e8-a577-
-0001b8c0: 6463 6139 3034 3832 3465 6563 2729 0a20  dca904824eec'). 
-0001b8d0: 2020 2020 2020 2028 6865 6164 2c20 7365         (head, se
-0001b8e0: 676d 656e 7473 2920 3d20 6c6f 6164 7328  gments) = loads(
-0001b8f0: 6222 5353 4242 6772 7367 5c78 3037 5c78  b"SSBBgrsg\x07\x
-0001b900: 3030 5c78 3030 5c78 3030 2220 2b0a 2020  00\x00\x00" +.  
+0001ae00: 2020 2020 2020 2020 2062 225c 7864 335c           b"\xd3\
+0001ae10: 7865 315c 7839 315c 7866 305c 7831 355c  xe1\x91\xf0\x15\
+0001ae20: 7839 345c 7831 315c 7865 385c 7839 315c  x94\x11\xe8\x91\
+0001ae30: 7861 635c 7864 635c 7861 395c 7830 345c  xac\xdc\xa9\x04\
+0001ae40: 7838 324e 5c78 6563 2220 2b0a 2020 2020  x82N\xec" +.    
+0001ae50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ae60: 2020 2020 2020 2020 2020 2020 2020 2062                 b
+0001ae70: 225c 7830 315c 7830 305c 7830 305c 7830  "\x01\x00\x00\x0
+0001ae80: 305c 7830 305c 7830 305c 7830 305c 7830  0\x00\x00\x00\x0
+0001ae90: 3022 2929 202b 0a20 2020 2020 2020 2020  0")) +.         
+0001aea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001aeb0: 2020 2020 2020 2020 2862 2267 7261 695c          (b"grai\
+0001aec0: 7838 645c 7830 305c 7830 305c 7830 3022  x8d\x00\x00\x00"
+0001aed0: 202b 0a20 2020 2020 2020 2020 2020 2020   +.             
+0001aee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001aef0: 2020 2020 2062 225c 7830 315c 7830 3022       b"\x01\x00"
+0001af00: 202b 0a20 2020 2020 2020 2020 2020 2020   +.             
+0001af10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001af20: 2020 2020 2028 6222 6762 6864 5c78 3833       (b"gbhd\x83
+0001af30: 5c78 3030 5c78 3030 5c78 3030 2220 2b0a  \x00\x00\x00" +.
+0001af40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001af50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001af60: 2020 2073 7263 5f69 642e 6279 7465 7320     src_id.bytes 
+0001af70: 2b0a 2020 2020 2020 2020 2020 2020 2020  +.              
+0001af80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001af90: 2020 2020 2066 6c6f 775f 6964 2e62 7974       flow_id.byt
+0001afa0: 6573 202b 0a20 2020 2020 2020 2020 2020  es +.           
+0001afb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001afc0: 2020 2020 2020 2020 6222 5c78 3030 5c78          b"\x00\x
+0001afd0: 3030 5c78 3030 5c78 3030 5c78 3030 5c78  00\x00\x00\x00\x
+0001afe0: 3030 5c78 3030 5c78 3030 5c78 3030 5c78  00\x00\x00\x00\x
+0001aff0: 3030 5c78 3030 5c78 3030 5c78 3030 5c78  00\x00\x00\x00\x
+0001b000: 3030 5c78 3030 5c78 3030 2220 2b0a 2020  00\x00\x00" +.  
+0001b010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b030: 2062 225c 7830 305c 7830 305c 7830 305c   b"\x00\x00\x00\
+0001b040: 7830 305c 7830 305c 7830 305c 7830 305c  x00\x00\x00\x00\
+0001b050: 7830 305c 7830 305c 7830 3022 202b 0a20  x00\x00\x00" +. 
+0001b060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b080: 2020 6222 5c78 3030 5c78 3030 5c78 3030    b"\x00\x00\x00
+0001b090: 5c78 3030 5c78 3030 5c78 3030 5c78 3030  \x00\x00\x00\x00
+0001b0a0: 5c78 3030 5c78 3030 5c78 3030 2220 2b0a  \x00\x00\x00" +.
+0001b0b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b0d0: 2020 2062 225c 7830 305c 7830 305c 7830     b"\x00\x00\x0
+0001b0e0: 305c 7830 305c 7830 305c 7830 305c 7830  0\x00\x00\x00\x0
+0001b0f0: 305c 7830 3022 202b 0a20 2020 2020 2020  0\x00" +.       
+0001b100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b110: 2020 2020 2020 2020 2020 2020 6222 5c78              b"\x
+0001b120: 3030 5c78 3030 5c78 3030 5c78 3030 5c78  00\x00\x00\x00\x
+0001b130: 3030 5c78 3030 5c78 3030 5c78 3030 2220  00\x00\x00\x00" 
+0001b140: 2b0a 2020 2020 2020 2020 2020 2020 2020  +.              
+0001b150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b160: 2020 2020 2028 6222 7469 6c73 5c78 3237       (b"tils\x27
+0001b170: 5c78 3030 5c78 3030 5c78 3030 2220 2b0a  \x00\x00\x00" +.
+0001b180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b1a0: 2020 2020 6222 5c78 3031 5c78 3030 2220      b"\x01\x00" 
+0001b1b0: 2b0a 2020 2020 2020 2020 2020 2020 2020  +.              
+0001b1c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b1d0: 2020 2020 2020 6222 6475 6d6d 7920 7469        b"dummy ti
+0001b1e0: 6d65 636f 6465 5c78 3030 5c78 3030 2220  mecode\x00\x00" 
+0001b1f0: 2b0a 2020 2020 2020 2020 2020 2020 2020  +.              
+0001b200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b210: 2020 2020 2020 6222 5c78 3037 5c78 3030        b"\x07\x00
+0001b220: 5c78 3030 5c78 3030 2220 2b0a 2020 2020  \x00\x00" +.    
+0001b230: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b250: 6222 5c78 3139 5c78 3030 5c78 3030 5c78  b"\x19\x00\x00\x
+0001b260: 3030 5c78 3031 5c78 3030 5c78 3030 5c78  00\x01\x00\x00\x
+0001b270: 3030 2220 2b0a 2020 2020 2020 2020 2020  00" +.          
+0001b280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b290: 2020 2020 2020 2020 2020 6222 5c78 3030            b"\x00
+0001b2a0: 2229 2929 202b 0a20 2020 2020 2020 2020  "))) +.         
+0001b2b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b2c0: 2020 2020 2020 2020 2862 2267 7261 695c          (b"grai\
+0001b2d0: 7830 385c 7830 305c 7830 305c 7830 3022  x08\x00\x00\x00"
+0001b2e0: 2929 0a0a 2020 2020 2020 2020 7365 6c66  ))..        self
+0001b2f0: 2e61 7373 6572 7445 7175 616c 2868 6561  .assertEqual(hea
+0001b300: 645b 2769 6427 5d2c 2055 5549 4428 2764  d['id'], UUID('d
+0001b310: 3139 6330 6239 312d 3135 3930 2d31 3165  19c0b91-1590-11e
+0001b320: 382d 3835 3830 2d64 6361 3930 3438 3234  8-8580-dca904824
+0001b330: 6565 6327 2929 0a20 2020 2020 2020 2073  eec')).        s
+0001b340: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+0001b350: 6865 6164 5b27 6372 6561 7465 6427 5d2c  head['created'],
+0001b360: 2064 6174 6574 696d 6528 3139 3833 2c20   datetime(1983, 
+0001b370: 332c 2032 392c 2031 352c 2031 352c 2031  3, 29, 15, 15, 1
+0001b380: 3529 290a 2020 2020 2020 2020 7365 6c66  5)).        self
+0001b390: 2e61 7373 6572 7445 7175 616c 286c 656e  .assertEqual(len
+0001b3a0: 2868 6561 645b 2773 6567 6d65 6e74 7327  (head['segments'
+0001b3b0: 5d29 2c20 3129 0a20 2020 2020 2020 2073  ]), 1).        s
+0001b3c0: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+0001b3d0: 6865 6164 5b27 7365 676d 656e 7473 275d  head['segments']
+0001b3e0: 5b30 5d5b 276c 6f63 616c 5f69 6427 5d2c  [0]['local_id'],
+0001b3f0: 2031 290a 2020 2020 2020 2020 7365 6c66   1).        self
+0001b400: 2e61 7373 6572 7445 7175 616c 2868 6561  .assertEqual(hea
+0001b410: 645b 2773 6567 6d65 6e74 7327 5d5b 305d  d['segments'][0]
+0001b420: 5b27 6964 275d 2c20 5555 4944 2827 6433  ['id'], UUID('d3
+0001b430: 6531 3931 6630 2d31 3539 342d 3131 6538  e191f0-1594-11e8
+0001b440: 2d39 3161 632d 6463 6139 3034 3832 3465  -91ac-dca904824e
+0001b450: 6563 2729 290a 2020 2020 2020 2020 7365  ec')).        se
+0001b460: 6c66 2e61 7373 6572 7445 7175 616c 2868  lf.assertEqual(h
+0001b470: 6561 645b 2773 6567 6d65 6e74 7327 5d5b  ead['segments'][
+0001b480: 305d 5b27 7461 6773 275d 2c20 5b5d 290a  0]['tags'], []).
+0001b490: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+0001b4a0: 6572 7445 7175 616c 2868 6561 645b 2773  ertEqual(head['s
+0001b4b0: 6567 6d65 6e74 7327 5d5b 305d 5b27 636f  egments'][0]['co
+0001b4c0: 756e 7427 5d2c 2031 290a 2020 2020 2020  unt'], 1).      
+0001b4d0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+0001b4e0: 616c 2868 6561 645b 2774 6167 7327 5d2c  al(head['tags'],
+0001b4f0: 205b 5d29 0a20 2020 2020 2020 2073 656c   []).        sel
+0001b500: 662e 6173 7365 7274 4571 7561 6c28 7365  f.assertEqual(se
+0001b510: 676d 656e 7473 5b31 5d5b 305d 2e74 696d  gments[1][0].tim
+0001b520: 656c 6162 656c 732c 205b 7b0a 2020 2020  elabels, [{.    
+0001b530: 2020 2020 2020 2020 2774 6167 273a 2027          'tag': '
+0001b540: 6475 6d6d 7920 7469 6d65 636f 6465 272c  dummy timecode',
+0001b550: 0a20 2020 2020 2020 2020 2020 2027 7469  .            'ti
+0001b560: 6d65 6c61 6265 6c27 3a20 7b0a 2020 2020  melabel': {.    
+0001b570: 2020 2020 2020 2020 2020 2020 2766 7261              'fra
+0001b580: 6d65 735f 7369 6e63 655f 6d69 646e 6967  mes_since_midnig
+0001b590: 6874 273a 2037 2c0a 2020 2020 2020 2020  ht': 7,.        
+0001b5a0: 2020 2020 2020 2020 2766 7261 6d65 5f72          'frame_r
+0001b5b0: 6174 655f 6e75 6d65 7261 746f 7227 3a20  ate_numerator': 
+0001b5c0: 3235 2c0a 2020 2020 2020 2020 2020 2020  25,.            
+0001b5d0: 2020 2020 2766 7261 6d65 5f72 6174 655f      'frame_rate_
+0001b5e0: 6465 6e6f 6d69 6e61 746f 7227 3a20 312c  denominator': 1,
+0001b5f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001b600: 2027 6472 6f70 5f66 7261 6d65 273a 2046   'drop_frame': F
+0001b610: 616c 7365 7d7d 5d29 0a0a 2020 2020 6173  alse}}])..    as
+0001b620: 796e 6320 6465 6620 7465 7374 5f61 7379  ync def test_asy
+0001b630: 6e63 5f6c 6f61 645f 6465 636f 6465 735f  nc_load_decodes_
+0001b640: 7469 6c73 2873 656c 6629 3a0a 2020 2020  tils(self):.    
+0001b650: 2020 2020 7372 635f 6964 203d 2055 5549      src_id = UUI
+0001b660: 4428 2763 3730 3764 3634 632d 3135 3936  D('c707d64c-1596
+0001b670: 2d31 3165 382d 6133 6662 2d64 6361 3930  -11e8-a3fb-dca90
+0001b680: 3438 3234 6565 6327 290a 2020 2020 2020  4824eec').      
+0001b690: 2020 666c 6f77 5f69 6420 3d20 5555 4944    flow_id = UUID
+0001b6a0: 2827 6461 3738 3636 3861 2d31 3539 362d  ('da78668a-1596-
+0001b6b0: 3131 6538 2d61 3537 372d 6463 6139 3034  11e8-a577-dca904
+0001b6c0: 3832 3465 6563 2729 0a20 2020 2020 2020  824eec').       
+0001b6d0: 2066 7020 3d20 4173 796e 6342 7974 6573   fp = AsyncBytes
+0001b6e0: 494f 2862 2253 5342 4267 7273 675c 7830  IO(b"SSBBgrsg\x0
+0001b6f0: 375c 7830 305c 7830 305c 7830 3022 202b  7\x00\x00\x00" +
+0001b700: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001b710: 2020 2020 2020 2020 2020 2028 6222 6865             (b"he
+0001b720: 6164 5c78 3431 5c78 3030 5c78 3030 5c78  ad\x41\x00\x00\x
+0001b730: 3030 2220 2b0a 2020 2020 2020 2020 2020  00" +.          
+0001b740: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b750: 2062 225c 7864 315c 7839 635c 7830 625c   b"\xd1\x9c\x0b\
+0001b760: 7839 315c 7831 355c 7839 305c 7831 315c  x91\x15\x90\x11\
+0001b770: 7865 385c 7838 355c 7838 305c 7864 635c  xe8\x85\x80\xdc\
+0001b780: 7861 395c 7830 345c 7838 324e 5c78 6563  xa9\x04\x82N\xec
+0001b790: 2220 2b0a 2020 2020 2020 2020 2020 2020  " +.            
+0001b7a0: 2020 2020 2020 2020 2020 2020 2020 2062                 b
+0001b7b0: 225c 7862 665c 7830 375c 7830 335c 7831  "\xbf\x07\x03\x1
+0001b7c0: 645c 7830 665c 7830 665c 7830 6622 202b  d\x0f\x0f\x0f" +
+0001b7d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001b7e0: 2020 2020 2020 2020 2020 2020 2862 2273              (b"s
+0001b7f0: 6567 6d5c 7832 325c 7830 305c 7830 305c  egm\x22\x00\x00\
+0001b800: 7830 3022 202b 0a20 2020 2020 2020 2020  x00" +.         
+0001b810: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b820: 2020 2062 225c 7830 315c 7830 3022 202b     b"\x01\x00" +
+0001b830: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001b840: 2020 2020 2020 2020 2020 2020 2062 225c               b"\
+0001b850: 7864 335c 7865 315c 7839 315c 7866 305c  xd3\xe1\x91\xf0\
+0001b860: 7831 355c 7839 345c 7831 315c 7865 385c  x15\x94\x11\xe8\
+0001b870: 7839 315c 7861 635c 7864 635c 7861 395c  x91\xac\xdc\xa9\
+0001b880: 7830 345c 7838 324e 5c78 6563 2220 2b0a  x04\x82N\xec" +.
+0001b890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b8a0: 2020 2020 2020 2020 2020 2020 6222 5c78              b"\x
+0001b8b0: 3031 5c78 3030 5c78 3030 5c78 3030 5c78  01\x00\x00\x00\x
+0001b8c0: 3030 5c78 3030 5c78 3030 5c78 3030 2229  00\x00\x00\x00")
+0001b8d0: 2920 2b0a 2020 2020 2020 2020 2020 2020  ) +.            
+0001b8e0: 2020 2020 2020 2020 2020 2020 2020 2862                (b
+0001b8f0: 2267 7261 695c 7838 645c 7830 305c 7830  "grai\x8d\x00\x0
+0001b900: 305c 7830 3022 202b 0a20 2020 2020 2020  0\x00" +.       
 0001b910: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b920: 2020 2020 2020 2020 2020 2020 2020 2028                 (
-0001b930: 6222 6865 6164 5c78 3431 5c78 3030 5c78  b"head\x41\x00\x
-0001b940: 3030 5c78 3030 2220 2b0a 2020 2020 2020  00\x00" +.      
-0001b950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b960: 2020 2020 2020 2020 2020 2020 6222 5c78              b"\x
-0001b970: 6431 5c78 3963 5c78 3062 5c78 3931 5c78  d1\x9c\x0b\x91\x
-0001b980: 3135 5c78 3930 5c78 3131 5c78 6538 5c78  15\x90\x11\xe8\x
-0001b990: 3835 5c78 3830 5c78 6463 5c78 6139 5c78  85\x80\xdc\xa9\x
-0001b9a0: 3034 5c78 3832 4e5c 7865 6322 202b 0a20  04\x82N\xec" +. 
-0001b9b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b920: 2020 2020 6222 5c78 3031 5c78 3030 2220      b"\x01\x00" 
+0001b930: 2b0a 2020 2020 2020 2020 2020 2020 2020  +.              
+0001b940: 2020 2020 2020 2020 2020 2020 2028 6222               (b"
+0001b950: 6762 6864 5c78 3833 5c78 3030 5c78 3030  gbhd\x83\x00\x00
+0001b960: 5c78 3030 2220 2b0a 2020 2020 2020 2020  \x00" +.        
+0001b970: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b980: 2020 2020 7372 635f 6964 2e62 7974 6573      src_id.bytes
+0001b990: 202b 0a20 2020 2020 2020 2020 2020 2020   +.             
+0001b9a0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0001b9b0: 6c6f 775f 6964 2e62 7974 6573 202b 0a20  low_id.bytes +. 
 0001b9c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b9d0: 2062 225c 7862 665c 7830 375c 7830 335c   b"\xbf\x07\x03\
-0001b9e0: 7831 645c 7830 665c 7830 665c 7830 6622  x1d\x0f\x0f\x0f"
-0001b9f0: 202b 0a20 2020 2020 2020 2020 2020 2020   +.             
-0001ba00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ba10: 2020 2020 2028 6222 7365 676d 5c78 3232       (b"segm\x22
-0001ba20: 5c78 3030 5c78 3030 5c78 3030 2220 2b0a  \x00\x00\x00" +.
-0001ba30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ba40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ba50: 2020 2062 225c 7830 315c 7830 3022 202b     b"\x01\x00" +
-0001ba60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001b9d0: 2020 2020 2020 2020 2020 2062 225c 7830             b"\x0
+0001b9e0: 305c 7830 305c 7830 305c 7830 305c 7830  0\x00\x00\x00\x0
+0001b9f0: 305c 7830 305c 7830 305c 7830 305c 7830  0\x00\x00\x00\x0
+0001ba00: 305c 7830 305c 7830 305c 7830 305c 7830  0\x00\x00\x00\x0
+0001ba10: 305c 7830 305c 7830 305c 7830 3022 202b  0\x00\x00\x00" +
+0001ba20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001ba30: 2020 2020 2020 2020 2020 2020 2062 225c               b"\
+0001ba40: 7830 305c 7830 305c 7830 305c 7830 305c  x00\x00\x00\x00\
+0001ba50: 7830 305c 7830 305c 7830 305c 7830 305c  x00\x00\x00\x00\
+0001ba60: 7830 305c 7830 3022 202b 0a20 2020 2020  x00\x00" +.     
 0001ba70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ba80: 2020 2020 6222 5c78 6433 5c78 6531 5c78      b"\xd3\xe1\x
-0001ba90: 3931 5c78 6630 5c78 3135 5c78 3934 5c78  91\xf0\x15\x94\x
-0001baa0: 3131 5c78 6538 5c78 3931 5c78 6163 5c78  11\xe8\x91\xac\x
-0001bab0: 6463 5c78 6139 5c78 3034 5c78 3832 4e5c  dc\xa9\x04\x82N\
-0001bac0: 7865 6322 202b 0a20 2020 2020 2020 2020  xec" +.         
-0001bad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bae0: 2020 2020 2020 2020 2020 6222 5c78 3032            b"\x02
-0001baf0: 5c78 3030 5c78 3030 5c78 3030 5c78 3030  \x00\x00\x00\x00
-0001bb00: 5c78 3030 5c78 3030 5c78 3030 2229 2920  \x00\x00\x00")) 
-0001bb10: 2b0a 2020 2020 2020 2020 2020 2020 2020  +.              
-0001bb20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bb30: 2020 2028 6222 6772 6169 5c78 3636 5c78     (b"grai\x66\x
-0001bb40: 3030 5c78 3030 5c78 3030 2220 2b0a 2020  00\x00\x00" +.  
-0001bb50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bb60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bb70: 6222 5c78 3031 5c78 3030 2220 2b0a 2020  b"\x01\x00" +.  
-0001bb80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bb90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bba0: 2862 2267 6268 645c 7835 635c 7830 305c  (b"gbhd\x5c\x00\
-0001bbb0: 7830 305c 7830 3022 202b 0a20 2020 2020  x00\x00" +.     
-0001bbc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bbd0: 2020 2020 2020 2020 2020 2020 2020 7372                sr
-0001bbe0: 635f 6964 2e62 7974 6573 202b 0a20 2020  c_id.bytes +.   
-0001bbf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bc00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bc10: 666c 6f77 5f69 642e 6279 7465 7320 2b0a  flow_id.bytes +.
-0001bc20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bc30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bc40: 2020 2062 225c 7830 305c 7830 305c 7830     b"\x00\x00\x0
-0001bc50: 305c 7830 305c 7830 305c 7830 305c 7830  0\x00\x00\x00\x0
-0001bc60: 305c 7830 305c 7830 305c 7830 305c 7830  0\x00\x00\x00\x0
-0001bc70: 305c 7830 305c 7830 305c 7830 305c 7830  0\x00\x00\x00\x0
-0001bc80: 305c 7830 3022 202b 0a20 2020 2020 2020  0\x00" +.       
-0001bc90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bca0: 2020 2020 2020 2020 2020 2020 6222 5c78              b"\x
-0001bcb0: 3030 5c78 3030 5c78 3030 5c78 3030 5c78  00\x00\x00\x00\x
-0001bcc0: 3030 5c78 3030 5c78 3030 5c78 3030 5c78  00\x00\x00\x00\x
-0001bcd0: 3030 5c78 3030 2220 2b0a 2020 2020 2020  00\x00" +.      
-0001bce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bcf0: 2020 2020 2020 2020 2020 2020 2062 225c               b"\
-0001bd00: 7830 305c 7830 305c 7830 305c 7830 305c  x00\x00\x00\x00\
-0001bd10: 7830 305c 7830 305c 7830 305c 7830 305c  x00\x00\x00\x00\
-0001bd20: 7830 305c 7830 3022 202b 0a20 2020 2020  x00\x00" +.     
-0001bd30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bd40: 2020 2020 2020 2020 2020 2020 2020 6222                b"
-0001bd50: 5c78 3030 5c78 3030 5c78 3030 5c78 3030  \x00\x00\x00\x00
-0001bd60: 5c78 3030 5c78 3030 5c78 3030 5c78 3030  \x00\x00\x00\x00
-0001bd70: 2220 2b0a 2020 2020 2020 2020 2020 2020  " +.            
-0001bd80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bd90: 2020 2020 2020 2062 225c 7830 305c 7830         b"\x00\x0
-0001bda0: 305c 7830 305c 7830 305c 7830 305c 7830  0\x00\x00\x00\x0
-0001bdb0: 305c 7830 305c 7830 3022 2929 202b 0a20  0\x00\x00")) +. 
-0001bdc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bdd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bde0: 2862 2264 756d 795c 7830 385c 7830 305c  (b"dumy\x08\x00\
-0001bdf0: 7830 305c 7830 3022 2920 2b0a 2020 2020  x00\x00") +.    
-0001be00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001be10: 2020 2020 2020 2020 2020 2020 2028 6222               (b"
-0001be20: 6772 6169 5c78 3645 5c78 3030 5c78 3030  grai\x6E\x00\x00
-0001be30: 5c78 3030 2220 2b0a 2020 2020 2020 2020  \x00" +.        
-0001be40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001be50: 2020 2020 2020 2020 2020 6222 5c78 3031            b"\x01
-0001be60: 5c78 3030 2220 2b0a 2020 2020 2020 2020  \x00" +.        
-0001be70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001be80: 2020 2020 2020 2020 2020 2862 2267 6268            (b"gbh
-0001be90: 645c 7835 635c 7830 305c 7830 305c 7830  d\x5c\x00\x00\x0
-0001bea0: 3022 202b 0a20 2020 2020 2020 2020 2020  0" +.           
-0001beb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bec0: 2020 2020 2020 2020 7372 635f 6964 2e62          src_id.b
-0001bed0: 7974 6573 202b 0a20 2020 2020 2020 2020  ytes +.         
-0001bee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bef0: 2020 2020 2020 2020 2020 666c 6f77 5f69            flow_i
-0001bf00: 642e 6279 7465 7320 2b0a 2020 2020 2020  d.bytes +.      
-0001bf10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bf20: 2020 2020 2020 2020 2020 2020 2062 225c               b"\
-0001bf30: 7830 305c 7830 305c 7830 305c 7830 305c  x00\x00\x00\x00\
-0001bf40: 7830 305c 7830 305c 7830 305c 7830 305c  x00\x00\x00\x00\
-0001bf50: 7830 305c 7830 305c 7830 305c 7830 305c  x00\x00\x00\x00\
-0001bf60: 7830 305c 7830 305c 7830 305c 7830 3022  x00\x00\x00\x00"
-0001bf70: 202b 0a20 2020 2020 2020 2020 2020 2020   +.             
-0001bf80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bf90: 2020 2020 2020 6222 5c78 3030 5c78 3030        b"\x00\x00
-0001bfa0: 5c78 3030 5c78 3030 5c78 3030 5c78 3030  \x00\x00\x00\x00
-0001bfb0: 5c78 3030 5c78 3030 5c78 3030 5c78 3030  \x00\x00\x00\x00
-0001bfc0: 2220 2b0a 2020 2020 2020 2020 2020 2020  " +.            
-0001bfd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bfe0: 2020 2020 2020 2062 225c 7830 305c 7830         b"\x00\x0
-0001bff0: 305c 7830 305c 7830 305c 7830 305c 7830  0\x00\x00\x00\x0
-0001c000: 305c 7830 305c 7830 305c 7830 305c 7830  0\x00\x00\x00\x0
-0001c010: 3022 202b 0a20 2020 2020 2020 2020 2020  0" +.           
-0001c020: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c030: 2020 2020 2020 2020 6222 5c78 3030 5c78          b"\x00\x
-0001c040: 3030 5c78 3030 5c78 3030 5c78 3030 5c78  00\x00\x00\x00\x
-0001c050: 3030 5c78 3030 5c78 3030 2220 2b0a 2020  00\x00\x00" +.  
-0001c060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c080: 2062 225c 7830 305c 7830 305c 7830 305c   b"\x00\x00\x00\
-0001c090: 7830 305c 7830 305c 7830 305c 7830 305c  x00\x00\x00\x00\
-0001c0a0: 7830 3022 2920 2b0a 2020 2020 2020 2020  x00") +.        
-0001c0b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c0c0: 2020 2020 2020 2020 2020 2862 2267 7264            (b"grd
-0001c0d0: 745c 7830 385c 7830 305c 7830 305c 7830  t\x08\x00\x00\x0
-0001c0e0: 3022 2929 202b 0a20 2020 2020 2020 2020  0")) +.         
-0001c0f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c100: 2020 2020 2020 2020 2862 2264 756d 795c          (b"dumy\
-0001c110: 7830 385c 7830 305c 7830 305c 7830 3022  x08\x00\x00\x00"
-0001c120: 2929 0a0a 2020 2020 2020 2020 7365 6c66  ))..        self
-0001c130: 2e61 7373 6572 7445 7175 616c 286c 656e  .assertEqual(len
-0001c140: 2873 6567 6d65 6e74 735b 315d 292c 2032  (segments[1]), 2
-0001c150: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-0001c160: 7373 6572 7445 7175 616c 2873 6567 6d65  ssertEqual(segme
-0001c170: 6e74 735b 315d 5b30 5d2e 6772 6169 6e5f  nts[1][0].grain_
-0001c180: 7479 7065 2c20 2265 6d70 7479 2229 0a20  type, "empty"). 
-0001c190: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-0001c1a0: 7274 4973 4e6f 6e65 2873 6567 6d65 6e74  rtIsNone(segment
-0001c1b0: 735b 315d 5b30 5d2e 6461 7461 290a 2020  s[1][0].data).  
-0001c1c0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-0001c1d0: 7445 7175 616c 2873 6567 6d65 6e74 735b  tEqual(segments[
-0001c1e0: 315d 5b31 5d2e 6772 6169 6e5f 7479 7065  1][1].grain_type
-0001c1f0: 2c20 2265 6d70 7479 2229 0a20 2020 2020  , "empty").     
-0001c200: 2020 2073 656c 662e 6173 7365 7274 4973     self.assertIs
-0001c210: 4e6f 6e65 2873 6567 6d65 6e74 735b 315d  None(segments[1]
-0001c220: 5b31 5d2e 6461 7461 290a 0a20 2020 2064  [1].data)..    d
-0001c230: 6566 2074 6573 745f 6c6f 6164 735f 636f  ef test_loads_co
-0001c240: 6465 645f 6175 6469 6f28 7365 6c66 293a  ded_audio(self):
-0001c250: 0a20 2020 2020 2020 2028 6865 6164 2c20  .        (head, 
-0001c260: 7365 676d 656e 7473 2920 3d20 6c6f 6164  segments) = load
-0001c270: 7328 434f 4445 445f 4155 4449 4f5f 4441  s(CODED_AUDIO_DA
-0001c280: 5441 290a 0a20 2020 2020 2020 2073 656c  TA)..        sel
-0001c290: 662e 6173 7365 7274 4571 7561 6c28 6865  f.assertEqual(he
-0001c2a0: 6164 5b27 6372 6561 7465 6427 5d2c 2064  ad['created'], d
-0001c2b0: 6174 6574 696d 6528 3230 3138 2c20 322c  atetime(2018, 2,
-0001c2c0: 2037 2c20 3130 2c20 3338 2c20 3529 290a   7, 10, 38, 5)).
-0001c2d0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-0001c2e0: 6572 7445 7175 616c 2868 6561 645b 2769  ertEqual(head['i
-0001c2f0: 6427 5d2c 2055 5549 4428 2732 6462 6335  d'], UUID('2dbc5
-0001c300: 3838 392d 3135 6631 2d34 3237 632d 6237  889-15f1-427c-b7
-0001c310: 3237 2d35 3230 3164 6433 6230 3533 6327  27-5201dd3b053c'
-0001c320: 2929 0a20 2020 2020 2020 2073 656c 662e  )).        self.
-0001c330: 6173 7365 7274 4571 7561 6c28 6c65 6e28  assertEqual(len(
-0001c340: 6865 6164 5b27 7365 676d 656e 7473 275d  head['segments']
-0001c350: 292c 2031 290a 2020 2020 2020 2020 7365  ), 1).        se
-0001c360: 6c66 2e61 7373 6572 7445 7175 616c 2868  lf.assertEqual(h
-0001c370: 6561 645b 2773 6567 6d65 6e74 7327 5d5b  ead['segments'][
-0001c380: 305d 5b27 6964 275d 2c20 5555 4944 2827  0]['id'], UUID('
-0001c390: 3663 6133 6132 3137 2d66 3263 322d 3433  6ca3a217-f2c2-43
-0001c3a0: 3434 2d38 3332 622d 3665 6138 3762 6335  44-832b-6ea87bc5
-0001c3b0: 6464 6238 2729 290a 2020 2020 2020 2020  ddb8')).        
-0001c3c0: 7365 6c66 2e61 7373 6572 7449 6e28 6865  self.assertIn(he
-0001c3d0: 6164 5b27 7365 676d 656e 7473 275d 5b30  ad['segments'][0
-0001c3e0: 5d5b 276c 6f63 616c 5f69 6427 5d2c 2073  ]['local_id'], s
-0001c3f0: 6567 6d65 6e74 7329 0a20 2020 2020 2020  egments).       
-0001c400: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-0001c410: 6c28 6c65 6e28 7365 676d 656e 7473 5b68  l(len(segments[h
-0001c420: 6561 645b 2773 6567 6d65 6e74 7327 5d5b  ead['segments'][
-0001c430: 305d 5b27 6c6f 6361 6c5f 6964 275d 5d29  0]['local_id']])
-0001c440: 2c20 6865 6164 5b27 7365 676d 656e 7473  , head['segments
-0001c450: 275d 5b30 5d5b 2763 6f75 6e74 275d 290a  '][0]['count']).
-0001c460: 0a20 2020 2020 2020 2073 7461 7274 5f6f  .        start_o
-0001c470: 7473 203d 2054 696d 6573 7461 6d70 2831  ts = Timestamp(1
-0001c480: 3432 3031 3032 3830 302c 2030 290a 2020  420102800, 0).  
-0001c490: 2020 2020 2020 6f74 7320 3d20 7374 6172        ots = star
-0001c4a0: 745f 6f74 730a 2020 2020 2020 2020 746f  t_ots.        to
-0001c4b0: 7461 6c5f 7361 6d70 6c65 7320 3d20 300a  tal_samples = 0.
-0001c4c0: 2020 2020 2020 2020 6c65 6e67 7468 7320          lengths 
-0001c4d0: 3d20 5b36 3033 2c0a 2020 2020 2020 2020  = [603,.        
-0001c4e0: 2020 2020 2020 2020 2020 2036 3930 2c0a             690,.
-0001c4f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c500: 2020 2036 3930 2c0a 2020 2020 2020 2020     690,.        
-0001c510: 2020 2020 2020 2020 2020 2036 3839 2c0a             689,.
+0001ba80: 2020 2020 2020 2062 225c 7830 305c 7830         b"\x00\x0
+0001ba90: 305c 7830 305c 7830 305c 7830 305c 7830  0\x00\x00\x00\x0
+0001baa0: 305c 7830 305c 7830 305c 7830 305c 7830  0\x00\x00\x00\x0
+0001bab0: 3022 202b 0a20 2020 2020 2020 2020 2020  0" +.           
+0001bac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bad0: 2062 225c 7830 305c 7830 305c 7830 305c   b"\x00\x00\x00\
+0001bae0: 7830 305c 7830 305c 7830 305c 7830 305c  x00\x00\x00\x00\
+0001baf0: 7830 3022 202b 0a20 2020 2020 2020 2020  x00" +.         
+0001bb00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bb10: 2020 2062 225c 7830 305c 7830 305c 7830     b"\x00\x00\x0
+0001bb20: 305c 7830 305c 7830 305c 7830 305c 7830  0\x00\x00\x00\x0
+0001bb30: 305c 7830 3022 202b 0a20 2020 2020 2020  0\x00" +.       
+0001bb40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bb50: 2020 2020 2028 6222 7469 6c73 5c78 3237       (b"tils\x27
+0001bb60: 5c78 3030 5c78 3030 5c78 3030 2220 2b0a  \x00\x00\x00" +.
+0001bb70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bb80: 2020 2020 2020 2020 2020 2020 2062 225c               b"\
+0001bb90: 7830 315c 7830 3022 202b 0a20 2020 2020  x01\x00" +.     
+0001bba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bbb0: 2020 2020 2020 2020 6222 6475 6d6d 7920          b"dummy 
+0001bbc0: 7469 6d65 636f 6465 5c78 3030 5c78 3030  timecode\x00\x00
+0001bbd0: 2220 2b0a 2020 2020 2020 2020 2020 2020  " +.            
+0001bbe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bbf0: 2062 225c 7830 375c 7830 305c 7830 305c   b"\x07\x00\x00\
+0001bc00: 7830 3022 202b 0a20 2020 2020 2020 2020  x00" +.         
+0001bc10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bc20: 2020 2020 6222 5c78 3139 5c78 3030 5c78      b"\x19\x00\x
+0001bc30: 3030 5c78 3030 5c78 3031 5c78 3030 5c78  00\x00\x01\x00\x
+0001bc40: 3030 5c78 3030 2220 2b0a 2020 2020 2020  00\x00" +.      
+0001bc50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bc60: 2020 2020 2020 2062 225c 7830 3022 2929         b"\x00"))
+0001bc70: 2920 2b0a 2020 2020 2020 2020 2020 2020  ) +.            
+0001bc80: 2020 2020 2020 2020 2020 2020 2020 2862                (b
+0001bc90: 2267 7261 695c 7830 385c 7830 305c 7830  "grai\x08\x00\x0
+0001bca0: 305c 7830 3022 2929 0a20 2020 2020 2020  0\x00")).       
+0001bcb0: 2028 6865 6164 2c20 7365 676d 656e 7473   (head, segments
+0001bcc0: 2920 3d20 6177 6169 7420 6c6f 6164 2866  ) = await load(f
+0001bcd0: 7029 0a0a 2020 2020 2020 2020 7365 6c66  p)..        self
+0001bce0: 2e61 7373 6572 7445 7175 616c 2868 6561  .assertEqual(hea
+0001bcf0: 645b 2769 6427 5d2c 2055 5549 4428 2764  d['id'], UUID('d
+0001bd00: 3139 6330 6239 312d 3135 3930 2d31 3165  19c0b91-1590-11e
+0001bd10: 382d 3835 3830 2d64 6361 3930 3438 3234  8-8580-dca904824
+0001bd20: 6565 6327 2929 0a20 2020 2020 2020 2073  eec')).        s
+0001bd30: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+0001bd40: 6865 6164 5b27 6372 6561 7465 6427 5d2c  head['created'],
+0001bd50: 2064 6174 6574 696d 6528 3139 3833 2c20   datetime(1983, 
+0001bd60: 332c 2032 392c 2031 352c 2031 352c 2031  3, 29, 15, 15, 1
+0001bd70: 3529 290a 2020 2020 2020 2020 7365 6c66  5)).        self
+0001bd80: 2e61 7373 6572 7445 7175 616c 286c 656e  .assertEqual(len
+0001bd90: 2868 6561 645b 2773 6567 6d65 6e74 7327  (head['segments'
+0001bda0: 5d29 2c20 3129 0a20 2020 2020 2020 2073  ]), 1).        s
+0001bdb0: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+0001bdc0: 6865 6164 5b27 7365 676d 656e 7473 275d  head['segments']
+0001bdd0: 5b30 5d5b 276c 6f63 616c 5f69 6427 5d2c  [0]['local_id'],
+0001bde0: 2031 290a 2020 2020 2020 2020 7365 6c66   1).        self
+0001bdf0: 2e61 7373 6572 7445 7175 616c 2868 6561  .assertEqual(hea
+0001be00: 645b 2773 6567 6d65 6e74 7327 5d5b 305d  d['segments'][0]
+0001be10: 5b27 6964 275d 2c20 5555 4944 2827 6433  ['id'], UUID('d3
+0001be20: 6531 3931 6630 2d31 3539 342d 3131 6538  e191f0-1594-11e8
+0001be30: 2d39 3161 632d 6463 6139 3034 3832 3465  -91ac-dca904824e
+0001be40: 6563 2729 290a 2020 2020 2020 2020 7365  ec')).        se
+0001be50: 6c66 2e61 7373 6572 7445 7175 616c 2868  lf.assertEqual(h
+0001be60: 6561 645b 2773 6567 6d65 6e74 7327 5d5b  ead['segments'][
+0001be70: 305d 5b27 7461 6773 275d 2c20 5b5d 290a  0]['tags'], []).
+0001be80: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+0001be90: 6572 7445 7175 616c 2868 6561 645b 2773  ertEqual(head['s
+0001bea0: 6567 6d65 6e74 7327 5d5b 305d 5b27 636f  egments'][0]['co
+0001beb0: 756e 7427 5d2c 2031 290a 2020 2020 2020  unt'], 1).      
+0001bec0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+0001bed0: 616c 2868 6561 645b 2774 6167 7327 5d2c  al(head['tags'],
+0001bee0: 205b 5d29 0a20 2020 2020 2020 2073 656c   []).        sel
+0001bef0: 662e 6173 7365 7274 4571 7561 6c28 7365  f.assertEqual(se
+0001bf00: 676d 656e 7473 5b31 5d5b 305d 2e74 696d  gments[1][0].tim
+0001bf10: 656c 6162 656c 732c 205b 7b0a 2020 2020  elabels, [{.    
+0001bf20: 2020 2020 2020 2020 2774 6167 273a 2027          'tag': '
+0001bf30: 6475 6d6d 7920 7469 6d65 636f 6465 272c  dummy timecode',
+0001bf40: 0a20 2020 2020 2020 2020 2020 2027 7469  .            'ti
+0001bf50: 6d65 6c61 6265 6c27 3a20 7b0a 2020 2020  melabel': {.    
+0001bf60: 2020 2020 2020 2020 2020 2020 2766 7261              'fra
+0001bf70: 6d65 735f 7369 6e63 655f 6d69 646e 6967  mes_since_midnig
+0001bf80: 6874 273a 2037 2c0a 2020 2020 2020 2020  ht': 7,.        
+0001bf90: 2020 2020 2020 2020 2766 7261 6d65 5f72          'frame_r
+0001bfa0: 6174 655f 6e75 6d65 7261 746f 7227 3a20  ate_numerator': 
+0001bfb0: 3235 2c0a 2020 2020 2020 2020 2020 2020  25,.            
+0001bfc0: 2020 2020 2766 7261 6d65 5f72 6174 655f      'frame_rate_
+0001bfd0: 6465 6e6f 6d69 6e61 746f 7227 3a20 312c  denominator': 1,
+0001bfe0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001bff0: 2027 6472 6f70 5f66 7261 6d65 273a 2046   'drop_frame': F
+0001c000: 616c 7365 7d7d 5d29 0a0a 2020 2020 6465  alse}}])..    de
+0001c010: 6620 7465 7374 5f6c 6f61 6473 5f64 6563  f test_loads_dec
+0001c020: 6f64 6573 5f65 6d70 7479 5f67 7261 696e  odes_empty_grain
+0001c030: 7328 7365 6c66 293a 0a20 2020 2020 2020  s(self):.       
+0001c040: 2073 7263 5f69 6420 3d20 5555 4944 2827   src_id = UUID('
+0001c050: 6337 3037 6436 3463 2d31 3539 362d 3131  c707d64c-1596-11
+0001c060: 6538 2d61 3366 622d 6463 6139 3034 3832  e8-a3fb-dca90482
+0001c070: 3465 6563 2729 0a20 2020 2020 2020 2066  4eec').        f
+0001c080: 6c6f 775f 6964 203d 2055 5549 4428 2764  low_id = UUID('d
+0001c090: 6137 3836 3638 612d 3135 3936 2d31 3165  a78668a-1596-11e
+0001c0a0: 382d 6135 3737 2d64 6361 3930 3438 3234  8-a577-dca904824
+0001c0b0: 6565 6327 290a 2020 2020 2020 2020 2868  eec').        (h
+0001c0c0: 6561 642c 2073 6567 6d65 6e74 7329 203d  ead, segments) =
+0001c0d0: 206c 6f61 6473 2862 2253 5342 4267 7273   loads(b"SSBBgrs
+0001c0e0: 675c 7830 375c 7830 305c 7830 305c 7830  g\x07\x00\x00\x0
+0001c0f0: 3022 202b 0a20 2020 2020 2020 2020 2020  0" +.           
+0001c100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c110: 2020 2020 2020 2862 2268 6561 645c 7834        (b"head\x4
+0001c120: 315c 7830 305c 7830 305c 7830 3022 202b  1\x00\x00\x00" +
+0001c130: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001c140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c150: 2020 2062 225c 7864 315c 7839 635c 7830     b"\xd1\x9c\x0
+0001c160: 625c 7839 315c 7831 355c 7839 305c 7831  b\x91\x15\x90\x1
+0001c170: 315c 7865 385c 7838 355c 7838 305c 7864  1\xe8\x85\x80\xd
+0001c180: 635c 7861 395c 7830 345c 7838 324e 5c78  c\xa9\x04\x82N\x
+0001c190: 6563 2220 2b0a 2020 2020 2020 2020 2020  ec" +.          
+0001c1a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c1b0: 2020 2020 2020 2020 6222 5c78 6266 5c78          b"\xbf\x
+0001c1c0: 3037 5c78 3033 5c78 3164 5c78 3066 5c78  07\x03\x1d\x0f\x
+0001c1d0: 3066 5c78 3066 2220 2b0a 2020 2020 2020  0f\x0f" +.      
+0001c1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c1f0: 2020 2020 2020 2020 2020 2020 2862 2273              (b"s
+0001c200: 6567 6d5c 7832 325c 7830 305c 7830 305c  egm\x22\x00\x00\
+0001c210: 7830 3022 202b 0a20 2020 2020 2020 2020  x00" +.         
+0001c220: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c230: 2020 2020 2020 2020 2020 6222 5c78 3031            b"\x01
+0001c240: 5c78 3030 2220 2b0a 2020 2020 2020 2020  \x00" +.        
+0001c250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c260: 2020 2020 2020 2020 2020 2062 225c 7864             b"\xd
+0001c270: 335c 7865 315c 7839 315c 7866 305c 7831  3\xe1\x91\xf0\x1
+0001c280: 355c 7839 345c 7831 315c 7865 385c 7839  5\x94\x11\xe8\x9
+0001c290: 315c 7861 635c 7864 635c 7861 395c 7830  1\xac\xdc\xa9\x0
+0001c2a0: 345c 7838 324e 5c78 6563 2220 2b0a 2020  4\x82N\xec" +.  
+0001c2b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c2c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c2d0: 2062 225c 7830 325c 7830 305c 7830 305c   b"\x02\x00\x00\
+0001c2e0: 7830 305c 7830 305c 7830 305c 7830 305c  x00\x00\x00\x00\
+0001c2f0: 7830 3022 2929 202b 0a20 2020 2020 2020  x00")) +.       
+0001c300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c310: 2020 2020 2020 2020 2020 2862 2267 7261            (b"gra
+0001c320: 695c 7836 365c 7830 305c 7830 305c 7830  i\x66\x00\x00\x0
+0001c330: 3022 202b 0a20 2020 2020 2020 2020 2020  0" +.           
+0001c340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c350: 2020 2020 2020 2062 225c 7830 315c 7830         b"\x01\x0
+0001c360: 3022 202b 0a20 2020 2020 2020 2020 2020  0" +.           
+0001c370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c380: 2020 2020 2020 2028 6222 6762 6864 5c78         (b"gbhd\x
+0001c390: 3563 5c78 3030 5c78 3030 5c78 3030 2220  5c\x00\x00\x00" 
+0001c3a0: 2b0a 2020 2020 2020 2020 2020 2020 2020  +.              
+0001c3b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c3c0: 2020 2020 2073 7263 5f69 642e 6279 7465       src_id.byte
+0001c3d0: 7320 2b0a 2020 2020 2020 2020 2020 2020  s +.            
+0001c3e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c3f0: 2020 2020 2020 2066 6c6f 775f 6964 2e62         flow_id.b
+0001c400: 7974 6573 202b 0a20 2020 2020 2020 2020  ytes +.         
+0001c410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c420: 2020 2020 2020 2020 2020 6222 5c78 3030            b"\x00
+0001c430: 5c78 3030 5c78 3030 5c78 3030 5c78 3030  \x00\x00\x00\x00
+0001c440: 5c78 3030 5c78 3030 5c78 3030 5c78 3030  \x00\x00\x00\x00
+0001c450: 5c78 3030 5c78 3030 5c78 3030 5c78 3030  \x00\x00\x00\x00
+0001c460: 5c78 3030 5c78 3030 5c78 3030 2220 2b0a  \x00\x00\x00" +.
+0001c470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c480: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c490: 2020 2062 225c 7830 305c 7830 305c 7830     b"\x00\x00\x0
+0001c4a0: 305c 7830 305c 7830 305c 7830 305c 7830  0\x00\x00\x00\x0
+0001c4b0: 305c 7830 305c 7830 305c 7830 3022 202b  0\x00\x00\x00" +
+0001c4c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001c4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c4e0: 2020 2020 6222 5c78 3030 5c78 3030 5c78      b"\x00\x00\x
+0001c4f0: 3030 5c78 3030 5c78 3030 5c78 3030 5c78  00\x00\x00\x00\x
+0001c500: 3030 5c78 3030 5c78 3030 5c78 3030 2220  00\x00\x00\x00" 
+0001c510: 2b0a 2020 2020 2020 2020 2020 2020 2020  +.              
 0001c520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c530: 2020 2036 3930 2c0a 2020 2020 2020 2020     690,.        
-0001c540: 2020 2020 2020 2020 2020 2036 3930 2c0a             690,.
-0001c550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c560: 2020 2036 3839 2c0a 2020 2020 2020 2020     689,.        
-0001c570: 2020 2020 2020 2020 2020 2036 3930 2c0a             690,.
-0001c580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c590: 2020 2036 3930 2c0a 2020 2020 2020 2020     690,.        
-0001c5a0: 2020 2020 2020 2020 2020 2036 3839 5d0a             689].
-0001c5b0: 2020 2020 2020 2020 666f 7220 6772 6169          for grai
-0001c5c0: 6e20 696e 2073 6567 6d65 6e74 735b 6865  n in segments[he
-0001c5d0: 6164 5b27 7365 676d 656e 7473 275d 5b30  ad['segments'][0
-0001c5e0: 5d5b 276c 6f63 616c 5f69 6427 5d5d 3a0a  ]['local_id']]:.
-0001c5f0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0001c600: 2e61 7373 6572 7449 7349 6e73 7461 6e63  .assertIsInstanc
-0001c610: 6528 6772 6169 6e2c 2043 4f44 4544 4155  e(grain, CODEDAU
-0001c620: 4449 4f47 5241 494e 290a 2020 2020 2020  DIOGRAIN).      
-0001c630: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-0001c640: 7445 7175 616c 2867 7261 696e 2e67 7261  tEqual(grain.gra
-0001c650: 696e 5f74 7970 652c 2022 636f 6465 645f  in_type, "coded_
-0001c660: 6175 6469 6f22 290a 2020 2020 2020 2020  audio").        
-0001c670: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-0001c680: 7175 616c 2867 7261 696e 2e73 6f75 7263  qual(grain.sourc
-0001c690: 655f 6964 2c20 5555 4944 2827 3338 6266  e_id, UUID('38bf
-0001c6a0: 6439 3032 2d62 3335 662d 3430 6436 2d39  d902-b35f-40d6-9
-0001c6b0: 6563 662d 6463 3935 3836 3931 3330 6366  ecf-dc95869130cf
-0001c6c0: 2729 290a 2020 2020 2020 2020 2020 2020  ')).            
-0001c6d0: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-0001c6e0: 2867 7261 696e 2e66 6c6f 775f 6964 2c20  (grain.flow_id, 
-0001c6f0: 5555 4944 2827 6536 3135 3239 3662 2d66  UUID('e615296b-f
-0001c700: 6634 302d 3464 3935 2d38 3339 382d 3661  f40-4d95-8398-6a
-0001c710: 3430 3832 3330 3566 3361 2729 290a 2020  4082305f3a')).  
-0001c720: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-0001c730: 7373 6572 7445 7175 616c 2867 7261 696e  ssertEqual(grain
-0001c740: 2e6f 7269 6769 6e5f 7469 6d65 7374 616d  .origin_timestam
-0001c750: 702c 206f 7473 290a 0a20 2020 2020 2020  p, ots)..       
-0001c760: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-0001c770: 4571 7561 6c28 6772 6169 6e2e 666f 726d  Equal(grain.form
-0001c780: 6174 2c20 436f 6741 7564 696f 466f 726d  at, CogAudioForm
-0001c790: 6174 2e41 4143 290a 2020 2020 2020 2020  at.AAC).        
-0001c7a0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-0001c7b0: 7175 616c 2867 7261 696e 2e63 6861 6e6e  qual(grain.chann
-0001c7c0: 656c 732c 2032 290a 2020 2020 2020 2020  els, 2).        
-0001c7d0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-0001c7e0: 7175 616c 2867 7261 696e 2e73 616d 706c  qual(grain.sampl
-0001c7f0: 6573 2c20 3130 3234 290a 2020 2020 2020  es, 1024).      
-0001c800: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-0001c810: 7445 7175 616c 2867 7261 696e 2e70 7269  tEqual(grain.pri
-0001c820: 6d69 6e67 2c20 3029 0a20 2020 2020 2020  ming, 0).       
-0001c830: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-0001c840: 4571 7561 6c28 6772 6169 6e2e 7265 6d61  Equal(grain.rema
-0001c850: 696e 6465 722c 2030 290a 2020 2020 2020  inder, 0).      
-0001c860: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-0001c870: 7445 7175 616c 2867 7261 696e 2e73 616d  tEqual(grain.sam
-0001c880: 706c 655f 7261 7465 2c20 3438 3030 3029  ple_rate, 48000)
-0001c890: 0a0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-0001c8a0: 6c66 2e61 7373 6572 7445 7175 616c 286c  lf.assertEqual(l
-0001c8b0: 656e 2867 7261 696e 2e64 6174 6129 2c20  en(grain.data), 
-0001c8c0: 6c65 6e67 7468 735b 305d 290a 2020 2020  lengths[0]).    
-0001c8d0: 2020 2020 2020 2020 6c65 6e67 7468 732e          lengths.
-0001c8e0: 706f 7028 3029 0a20 2020 2020 2020 2020  pop(0).         
-0001c8f0: 2020 2074 6f74 616c 5f73 616d 706c 6573     total_samples
-0001c900: 202b 3d20 6772 6169 6e2e 7361 6d70 6c65   += grain.sample
-0001c910: 730a 2020 2020 2020 2020 2020 2020 6f74  s.            ot
-0001c920: 7320 3d20 7374 6172 745f 6f74 7320 2b20  s = start_ots + 
-0001c930: 5469 6d65 4f66 6673 6574 2e66 726f 6d5f  TimeOffset.from_
-0001c940: 636f 756e 7428 746f 7461 6c5f 7361 6d70  count(total_samp
-0001c950: 6c65 732c 2067 7261 696e 2e73 616d 706c  les, grain.sampl
-0001c960: 655f 7261 7465 290a 0a20 2020 2064 6566  e_rate)..    def
-0001c970: 2074 6573 745f 6c6f 6164 735f 6576 656e   test_loads_even
-0001c980: 7428 7365 6c66 293a 0a20 2020 2020 2020  t(self):.       
-0001c990: 2073 656c 662e 6d61 7844 6966 6620 3d20   self.maxDiff = 
-0001c9a0: 4e6f 6e65 0a20 2020 2020 2020 2028 6865  None.        (he
-0001c9b0: 6164 2c20 7365 676d 656e 7473 2920 3d20  ad, segments) = 
-0001c9c0: 6c6f 6164 7328 4556 454e 545f 4441 5441  loads(EVENT_DATA
-0001c9d0: 290a 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-0001c9e0: 6173 7365 7274 4571 7561 6c28 6865 6164  assertEqual(head
-0001c9f0: 5b27 6372 6561 7465 6427 5d2c 2064 6174  ['created'], dat
-0001ca00: 6574 696d 6528 3230 3138 2c20 322c 2037  etime(2018, 2, 7
-0001ca10: 2c20 3130 2c20 3337 2c20 3335 2929 0a20  , 10, 37, 35)). 
-0001ca20: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-0001ca30: 7274 4571 7561 6c28 6865 6164 5b27 6964  rtEqual(head['id
-0001ca40: 275d 2c20 5555 4944 2827 3363 3435 6638  '], UUID('3c45f8
-0001ca50: 6235 2d31 3835 332d 3437 3233 2d38 3038  b5-1853-4723-808
-0001ca60: 612d 6162 3563 6266 3539 3863 6363 2729  a-ab5cbf598ccc')
-0001ca70: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-0001ca80: 7373 6572 7445 7175 616c 286c 656e 2868  ssertEqual(len(h
-0001ca90: 6561 645b 2773 6567 6d65 6e74 7327 5d29  ead['segments'])
-0001caa0: 2c20 3129 0a20 2020 2020 2020 2073 656c  , 1).        sel
-0001cab0: 662e 6173 7365 7274 4571 7561 6c28 6865  f.assertEqual(he
-0001cac0: 6164 5b27 7365 676d 656e 7473 275d 5b30  ad['segments'][0
-0001cad0: 5d5b 2769 6427 5d2c 2055 5549 4428 2764  ]['id'], UUID('d
-0001cae0: 6230 3935 6362 352d 3035 3062 2d34 6238  b095cb5-050b-4b8
-0001caf0: 632d 3932 6538 2d33 3133 3531 3432 3265  c-92e8-31351422e
-0001cb00: 3933 6127 2929 0a20 2020 2020 2020 2073  93a')).        s
-0001cb10: 656c 662e 6173 7365 7274 496e 2868 6561  elf.assertIn(hea
-0001cb20: 645b 2773 6567 6d65 6e74 7327 5d5b 305d  d['segments'][0]
-0001cb30: 5b27 6c6f 6361 6c5f 6964 275d 2c20 7365  ['local_id'], se
-0001cb40: 676d 656e 7473 290a 2020 2020 2020 2020  gments).        
-0001cb50: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-0001cb60: 286c 656e 2873 6567 6d65 6e74 735b 6865  (len(segments[he
-0001cb70: 6164 5b27 7365 676d 656e 7473 275d 5b30  ad['segments'][0
-0001cb80: 5d5b 276c 6f63 616c 5f69 6427 5d5d 292c  ]['local_id']]),
-0001cb90: 2068 6561 645b 2773 6567 6d65 6e74 7327   head['segments'
-0001cba0: 5d5b 305d 5b27 636f 756e 7427 5d29 0a0a  ][0]['count'])..
-0001cbb0: 2020 2020 2020 2020 7374 6172 745f 6f74          start_ot
-0001cbc0: 7320 3d20 5469 6d65 7374 616d 7028 3134  s = Timestamp(14
-0001cbd0: 3437 3137 3635 3132 2c20 3430 3030 3030  47176512, 400000
-0001cbe0: 3030 3029 0a20 2020 2020 2020 206f 7473  000).        ots
-0001cbf0: 203d 2073 7461 7274 5f6f 7473 0a20 2020   = start_ots.   
-0001cc00: 2020 2020 206c 696e 6520 3d20 2727 0a20       line = ''. 
-0001cc10: 2020 2020 2020 2073 6571 6e75 6d20 3d20         seqnum = 
-0001cc20: 3331 3037 3738 3738 3934 3234 3234 3939  3107787894242499
-0001cc30: 3236 340a 2020 2020 2020 2020 666f 7220  264.        for 
-0001cc40: 6772 6169 6e20 696e 2073 6567 6d65 6e74  grain in segment
-0001cc50: 735b 6865 6164 5b27 7365 676d 656e 7473  s[head['segments
-0001cc60: 275d 5b30 5d5b 276c 6f63 616c 5f69 6427  '][0]['local_id'
-0001cc70: 5d5d 3a0a 2020 2020 2020 2020 2020 2020  ]]:.            
-0001cc80: 7365 6c66 2e61 7373 6572 7449 7349 6e73  self.assertIsIns
-0001cc90: 7461 6e63 6528 6772 6169 6e2c 2045 5645  tance(grain, EVE
-0001cca0: 4e54 4752 4149 4e29 0a20 2020 2020 2020  NTGRAIN).       
-0001ccb0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-0001ccc0: 4571 7561 6c28 6772 6169 6e2e 6772 6169  Equal(grain.grai
-0001ccd0: 6e5f 7479 7065 2c20 2265 7665 6e74 2229  n_type, "event")
-0001cce0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-0001ccf0: 662e 6173 7365 7274 4571 7561 6c28 6772  f.assertEqual(gr
-0001cd00: 6169 6e2e 736f 7572 6365 5f69 642c 2055  ain.source_id, U
-0001cd10: 5549 4428 2732 6462 3432 3638 652d 3832  UID('2db4268e-82
-0001cd20: 6566 2d34 3966 392d 6263 3066 2d31 3732  ef-49f9-bc0f-172
-0001cd30: 3665 3833 3532 6437 3627 2929 0a20 2020  6e8352d76')).   
-0001cd40: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
-0001cd50: 7365 7274 4571 7561 6c28 6772 6169 6e2e  sertEqual(grain.
-0001cd60: 666c 6f77 5f69 642c 2055 5549 4428 2735  flow_id, UUID('5
-0001cd70: 3333 3362 6165 392d 3037 3638 2d34 6533  333bae9-0768-4e3
-0001cd80: 312d 6265 3163 2d66 6264 3564 6332 6533  1-be1c-fbd5dc2e3
-0001cd90: 3461 6327 2929 0a20 2020 2020 2020 2020  4ac')).         
-0001cda0: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-0001cdb0: 7561 6c28 6772 6169 6e2e 6f72 6967 696e  ual(grain.origin
-0001cdc0: 5f74 696d 6573 7461 6d70 2c20 6f74 7329  _timestamp, ots)
-0001cdd0: 0a0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-0001cde0: 6c66 2e61 7373 6572 7445 7175 616c 2867  lf.assertEqual(g
-0001cdf0: 7261 696e 2e65 7665 6e74 5f74 7970 652c  rain.event_type,
-0001ce00: 2027 7572 6e3a 782d 6970 7374 7564 696f   'urn:x-ipstudio
-0001ce10: 3a66 6f72 6d61 743a 6576 656e 742e 7474  :format:event.tt
-0001ce20: 6578 742e 6562 7574 746c 6976 6527 290a  ext.ebuttlive').
-0001ce30: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0001ce40: 2e61 7373 6572 7445 7175 616c 2867 7261  .assertEqual(gra
-0001ce50: 696e 2e74 6f70 6963 2c20 2727 290a 2020  in.topic, '').  
-0001ce60: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-0001ce70: 7373 6572 7445 7175 616c 286c 656e 2867  ssertEqual(len(g
-0001ce80: 7261 696e 2e65 7665 6e74 5f64 6174 6129  rain.event_data)
-0001ce90: 2c20 3129 0a20 2020 2020 2020 2020 2020  , 1).           
-0001cea0: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-0001ceb0: 6c28 6772 6169 6e2e 6576 656e 745f 6461  l(grain.event_da
-0001cec0: 7461 5b30 5d2e 7061 7468 2c20 2753 7562  ta[0].path, 'Sub
-0001ced0: 7327 290a 2020 2020 2020 2020 2020 2020  s').            
-0001cee0: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-0001cef0: 2867 7261 696e 2e65 7665 6e74 5f64 6174  (grain.event_dat
-0001cf00: 615b 305d 2e70 7265 2c20 6c69 6e65 290a  a[0].pre, line).
-0001cf10: 2020 2020 2020 2020 2020 2020 6c69 6e65              line
-0001cf20: 203d 2028 280a 2020 2020 2020 2020 2020   = ((.          
-0001cf30: 2020 2020 2020 273c 3f78 6d6c 2076 6572        '<?xml ver
-0001cf40: 7369 6f6e 3d22 312e 3022 2065 6e63 6f64  sion="1.0" encod
-0001cf50: 696e 673d 2255 5446 2d38 223f 3e5c 6e3c  ing="UTF-8"?>\n<
-0001cf60: 7474 3a74 7420 7474 703a 7469 6d65 4261  tt:tt ttp:timeBa
-0001cf70: 7365 3d22 636c 6f63 6b22 2074 7470 3a63  se="clock" ttp:c
-0001cf80: 6c6f 636b 4d6f 6465 3d22 7574 6322 270a  lockMode="utc"'.
-0001cf90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cfa0: 2720 786d 6c3a 6c61 6e67 3d22 656e 2220  ' xml:lang="en" 
-0001cfb0: 786d 6c6e 733a 7474 3d22 6874 7470 3a2f  xmlns:tt="http:/
-0001cfc0: 2f77 7777 2e77 332e 6f72 672f 6e73 2f74  /www.w3.org/ns/t
-0001cfd0: 746d 6c22 2020 786d 6c6e 733a 6562 7574  tml"  xmlns:ebut
-0001cfe0: 7445 7874 3d22 7572 6e3a 6562 753a 7474  tExt="urn:ebu:tt
-0001cff0: 3a65 7874 656e 7369 6f6e 2227 0a20 2020  :extension"'.   
-0001d000: 2020 2020 2020 2020 2020 2020 2027 2020               '  
-0001d010: 786d 6c6e 733a 7474 703d 2268 7474 703a  xmlns:ttp="http:
-0001d020: 2f2f 7777 772e 7733 2e6f 7267 2f6e 732f  //www.w3.org/ns/
-0001d030: 7474 6d6c 2370 6172 616d 6574 6572 2220  ttml#parameter" 
-0001d040: 786d 6c6e 733a 7474 733d 2268 7474 703a  xmlns:tts="http:
-0001d050: 2f2f 7777 772e 7733 2e6f 7267 2f6e 732f  //www.w3.org/ns/
-0001d060: 7474 6d6c 2373 7479 6c69 6e67 2227 0a20  ttml#styling"'. 
-0001d070: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-0001d080: 2074 7470 3a63 656c 6c52 6573 6f6c 7574   ttp:cellResolut
-0001d090: 696f 6e3d 2235 3020 3330 2220 786d 6c6e  ion="50 30" xmln
-0001d0a0: 733a 6562 7574 746d 3d22 7572 6e3a 6562  s:ebuttm="urn:eb
-0001d0b0: 753a 7474 3a6d 6574 6164 6174 6122 2074  u:tt:metadata" t
-0001d0c0: 7473 3a65 7874 656e 743d 2231 3932 3070  ts:extent="1920p
-0001d0d0: 7820 3130 3830 7078 2227 0a20 2020 2020  x 1080px"'.     
-0001d0e0: 2020 2020 2020 2020 2020 2027 2074 7470             ' ttp
-0001d0f0: 3a64 726f 704d 6f64 653d 226e 6f6e 4472  :dropMode="nonDr
-0001d100: 6f70 2220 7474 703a 6d61 726b 6572 4d6f  op" ttp:markerMo
-0001d110: 6465 3d22 6469 7363 6f6e 7469 6e75 6f75  de="discontinuou
-0001d120: 7322 270a 2020 2020 2020 2020 2020 2020  s"'.            
-0001d130: 2020 2020 2720 6562 7574 746d 3a73 6571      ' ebuttm:seq
-0001d140: 7565 6e63 6549 6465 6e74 6966 6965 723d  uenceIdentifier=
-0001d150: 2235 3333 3362 6165 392d 3037 3638 2d34  "5333bae9-0768-4
-0001d160: 6533 312d 6265 3163 2d66 6264 3564 6332  e31-be1c-fbd5dc2
-0001d170: 6533 3461 6322 2065 6275 7474 6d3a 7365  e34ac" ebuttm:se
-0001d180: 7175 656e 6365 4e75 6d62 6572 3d22 2729  quenceNumber="')
-0001d190: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001d1a0: 202b 2073 7472 2873 6571 6e75 6d29 202b   + str(seqnum) +
-0001d1b0: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
-0001d1c0: 2020 2027 223e 3c74 743a 6865 6164 3e3c     '"><tt:head><
-0001d1d0: 7474 3a6d 6574 6164 6174 613e 3c65 6275  tt:metadata><ebu
-0001d1e0: 7474 6d3a 646f 6375 6d65 6e74 4d65 7461  ttm:documentMeta
-0001d1f0: 6461 7461 3e3c 6562 7574 746d 3a64 6f63  data><ebuttm:doc
-0001d200: 756d 656e 7445 6275 7474 5665 7273 696f  umentEbuttVersio
-0001d210: 6e3e 270a 2020 2020 2020 2020 2020 2020  n>'.            
-0001d220: 2020 2020 2776 312e 303c 2f65 6275 7474      'v1.0</ebutt
-0001d230: 6d3a 646f 6375 6d65 6e74 4562 7574 7456  m:documentEbuttV
-0001d240: 6572 7369 6f6e 3e3c 6562 7574 746d 3a64  ersion><ebuttm:d
-0001d250: 6f63 756d 656e 7454 6f74 616c 4e75 6d62  ocumentTotalNumb
-0001d260: 6572 4f66 5375 6274 6974 6c65 733e 270a  erOfSubtitles>'.
-0001d270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d280: 2731 3c2f 6562 7574 746d 3a64 6f63 756d  '1</ebuttm:docum
-0001d290: 656e 7454 6f74 616c 4e75 6d62 6572 4f66  entTotalNumberOf
-0001d2a0: 5375 6274 6974 6c65 733e 3c65 6275 7474  Subtitles><ebutt
-0001d2b0: 6d3a 646f 6375 6d65 6e74 4d61 7869 6d75  m:documentMaximu
-0001d2c0: 6d4e 756d 6265 724f 6644 6973 706c 6179  mNumberOfDisplay
-0001d2d0: 6162 6c65 4368 6172 6163 7465 7249 6e41  ableCharacterInA
-0001d2e0: 6e79 526f 773e 270a 2020 2020 2020 2020  nyRow>'.        
-0001d2f0: 2020 2020 2020 2020 2734 303c 2f65 6275          '40</ebu
-0001d300: 7474 6d3a 646f 6375 6d65 6e74 4d61 7869  ttm:documentMaxi
-0001d310: 6d75 6d4e 756d 6265 724f 6644 6973 706c  mumNumberOfDispl
-0001d320: 6179 6162 6c65 4368 6172 6163 7465 7249  ayableCharacterI
-0001d330: 6e41 6e79 526f 773e 3c65 6275 7474 6d3a  nAnyRow><ebuttm:
-0001d340: 646f 6375 6d65 6e74 436f 756e 7472 794f  documentCountryO
-0001d350: 664f 7269 6769 6e3e 270a 2020 2020 2020  fOrigin>'.      
-0001d360: 2020 2020 2020 2020 2020 2767 623c 2f65            'gb</e
-0001d370: 6275 7474 6d3a 646f 6375 6d65 6e74 436f  buttm:documentCo
-0001d380: 756e 7472 794f 664f 7269 6769 6e3e 3c2f  untryOfOrigin></
-0001d390: 6562 7574 746d 3a64 6f63 756d 656e 744d  ebuttm:documentM
-0001d3a0: 6574 6164 6174 613e 3c2f 7474 3a6d 6574  etadata></tt:met
-0001d3b0: 6164 6174 613e 3c74 743a 7374 796c 696e  adata><tt:stylin
-0001d3c0: 673e 270a 2020 2020 2020 2020 2020 2020  g>'.            
-0001d3d0: 2020 2020 273c 7474 3a73 7479 6c65 2078      '<tt:style x
-0001d3e0: 6d6c 3a69 643d 2264 6566 6175 6c74 5374  ml:id="defaultSt
-0001d3f0: 796c 6522 2074 7473 3a66 6f6e 7446 616d  yle" tts:fontFam
-0001d400: 696c 793d 226d 6f6e 6f73 7061 6365 5361  ily="monospaceSa
-0001d410: 6e73 5365 7269 6622 2074 7473 3a66 6f6e  nsSerif" tts:fon
-0001d420: 7453 697a 653d 2231 6320 3163 2227 0a20  tSize="1c 1c"'. 
-0001d430: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-0001d440: 2074 7473 3a6c 696e 6548 6569 6768 743d   tts:lineHeight=
-0001d450: 226e 6f72 6d61 6c22 2074 7473 3a74 6578  "normal" tts:tex
-0001d460: 7441 6c69 676e 3d22 6365 6e74 6572 2220  tAlign="center" 
-0001d470: 7474 733a 636f 6c6f 723d 2277 6869 7465  tts:color="white
-0001d480: 2220 7474 733a 6261 636b 6772 6f75 6e64  " tts:background
-0001d490: 436f 6c6f 723d 2274 7261 6e73 7061 7265  Color="transpare
-0001d4a0: 6e74 2227 0a20 2020 2020 2020 2020 2020  nt"'.           
-0001d4b0: 2020 2020 2027 2074 7473 3a66 6f6e 7453       ' tts:fontS
-0001d4c0: 7479 6c65 3d22 6e6f 726d 616c 2220 7474  tyle="normal" tt
-0001d4d0: 733a 666f 6e74 5765 6967 6874 3d22 6e6f  s:fontWeight="no
-0001d4e0: 726d 616c 2220 7474 733a 7465 7874 4465  rmal" tts:textDe
-0001d4f0: 636f 7261 7469 6f6e 3d22 6e6f 6e65 2220  coration="none" 
-0001d500: 2f3e 3c74 743a 7374 796c 6527 0a20 2020  /><tt:style'.   
-0001d510: 2020 2020 2020 2020 2020 2020 2027 2078               ' x
-0001d520: 6d6c 3a69 643d 2257 6869 7465 4f6e 426c  ml:id="WhiteOnBl
-0001d530: 6163 6b22 2074 7473 3a63 6f6c 6f72 3d22  ack" tts:color="
-0001d540: 7768 6974 6522 2074 7473 3a62 6163 6b67  white" tts:backg
-0001d550: 726f 756e 6443 6f6c 6f72 3d22 626c 6163  roundColor="blac
-0001d560: 6b22 2074 7473 3a66 6f6e 7453 697a 653d  k" tts:fontSize=
-0001d570: 2231 6320 3263 222f 3e27 0a20 2020 2020  "1c 2c"/>'.     
-0001d580: 2020 2020 2020 2020 2020 2027 3c74 743a             '<tt:
-0001d590: 7374 796c 6520 786d 6c3a 6964 3d22 7465  style xml:id="te
-0001d5a0: 7874 4365 6e74 6572 2220 7474 733a 7465  xtCenter" tts:te
-0001d5b0: 7874 416c 6967 6e3d 2263 656e 7465 7222  xtAlign="center"
-0001d5c0: 2f3e 3c2f 7474 3a73 7479 6c69 6e67 3e3c  /></tt:styling><
-0001d5d0: 7474 3a6c 6179 6f75 743e 3c74 743a 7265  tt:layout><tt:re
-0001d5e0: 6769 6f6e 270a 2020 2020 2020 2020 2020  gion'.          
-0001d5f0: 2020 2020 2020 2720 786d 6c3a 6964 3d22        ' xml:id="
-0001d600: 626f 7474 6f6d 2220 7474 733a 6f72 6967  bottom" tts:orig
-0001d610: 696e 3d22 3130 2520 3130 2522 2074 7473  in="10% 10%" tts
-0001d620: 3a65 7874 656e 743d 2238 3025 2038 3025  :extent="80% 80%
-0001d630: 2220 7474 733a 7061 6464 696e 673d 2230  " tts:padding="0
-0001d640: 6322 2074 7473 3a64 6973 706c 6179 416c  c" tts:displayAl
-0001d650: 6967 6e3d 2261 6674 6572 2227 0a20 2020  ign="after"'.   
-0001d660: 2020 2020 2020 2020 2020 2020 2027 2074               ' t
-0001d670: 7473 3a77 7269 7469 6e67 4d6f 6465 3d22  ts:writingMode="
-0001d680: 6c72 7462 222f 3e3c 2f74 743a 6c61 796f  lrtb"/></tt:layo
-0001d690: 7574 3e3c 2f74 743a 6865 6164 3e3c 7474  ut></tt:head><tt
-0001d6a0: 3a62 6f64 7920 6475 723d 2230 303a 3030  :body dur="00:00
-0001d6b0: 3a31 3022 3e3c 7474 3a64 6976 2073 7479  :10"><tt:div sty
-0001d6c0: 6c65 3d22 6465 6661 756c 7453 7479 6c65  le="defaultStyle
-0001d6d0: 223e 270a 2020 2020 2020 2020 2020 2020  ">'.            
-0001d6e0: 2020 2020 273c 7474 3a70 2078 6d6c 3a69      '<tt:p xml:i
-0001d6f0: 643d 2273 7562 3222 2073 7479 6c65 3d22  d="sub2" style="
-0001d700: 7465 7874 4365 6e74 6572 2220 7265 6769  textCenter" regi
-0001d710: 6f6e 3d22 626f 7474 6f6d 223e 3c74 743a  on="bottom"><tt:
-0001d720: 7370 616e 2073 7479 6c65 3d22 5768 6974  span style="Whit
-0001d730: 654f 6e42 6c61 636b 223e 2729 0a20 2020  eOnBlack">').   
-0001d740: 2020 2020 2020 2020 2020 2020 202b 206f               + o
-0001d750: 7473 2e74 6f5f 6973 6f38 3630 315f 7574  ts.to_iso8601_ut
-0001d760: 6328 2920 2b20 273c 2f74 743a 7370 616e  c() + '</tt:span
-0001d770: 3e3c 2f74 743a 703e 3c2f 7474 3a64 6976  ></tt:p></tt:div
-0001d780: 3e3c 2f74 743a 626f 6479 3e3c 2f74 743a  ></tt:body></tt:
-0001d790: 7474 3e27 2920 2023 204e 4f51 410a 2020  tt>')  # NOQA.  
-0001d7a0: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-0001d7b0: 7373 6572 7445 7175 616c 280a 2020 2020  ssertEqual(.    
-0001d7c0: 2020 2020 2020 2020 2020 2020 6772 6169              grai
-0001d7d0: 6e2e 6576 656e 745f 6461 7461 5b30 5d2e  n.event_data[0].
-0001d7e0: 706f 7374 2c0a 2020 2020 2020 2020 2020  post,.          
-0001d7f0: 2020 2020 2020 6c69 6e65 2c0a 2020 2020        line,.    
-0001d800: 2020 2020 2020 2020 2020 2020 6d73 673d              msg=
-0001d810: 225c 6e5c 6e45 7870 6563 7465 643a 5c6e  "\n\nExpected:\n
-0001d820: 5c6e 7b21 727d 5c6e 5c6e 476f 743a 5c6e  \n{!r}\n\nGot:\n
-0001d830: 5c6e 7b21 727d 5c6e 5c6e 222e 666f 726d  \n{!r}\n\n".form
-0001d840: 6174 286c 696e 652c 2067 7261 696e 2e65  at(line, grain.e
-0001d850: 7665 6e74 5f64 6174 615b 305d 2e70 6f73  vent_data[0].pos
-0001d860: 7429 290a 0a20 2020 2020 2020 2020 2020  t))..           
-0001d870: 206f 7473 203d 206f 7473 202b 2054 696d   ots = ots + Tim
-0001d880: 654f 6666 7365 742e 6672 6f6d 5f6e 616e  eOffset.from_nan
-0001d890: 6f73 6563 2832 3030 3030 3030 3029 0a20  osec(20000000). 
-0001d8a0: 2020 2020 2020 2020 2020 2073 6571 6e75             seqnu
-0001d8b0: 6d20 2b3d 2032 3030 3030 3030 300a       m += 20000000.
+0001c530: 2020 2020 2062 225c 7830 305c 7830 305c       b"\x00\x00\
+0001c540: 7830 305c 7830 305c 7830 305c 7830 305c  x00\x00\x00\x00\
+0001c550: 7830 305c 7830 3022 202b 0a20 2020 2020  x00\x00" +.     
+0001c560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c570: 2020 2020 2020 2020 2020 2020 2020 6222                b"
+0001c580: 5c78 3030 5c78 3030 5c78 3030 5c78 3030  \x00\x00\x00\x00
+0001c590: 5c78 3030 5c78 3030 5c78 3030 5c78 3030  \x00\x00\x00\x00
+0001c5a0: 2229 2920 2b0a 2020 2020 2020 2020 2020  ")) +.          
+0001c5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c5c0: 2020 2020 2020 2028 6222 6475 6d79 5c78         (b"dumy\x
+0001c5d0: 3038 5c78 3030 5c78 3030 5c78 3030 2229  08\x00\x00\x00")
+0001c5e0: 202b 0a20 2020 2020 2020 2020 2020 2020   +.             
+0001c5f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c600: 2020 2020 2862 2267 7261 695c 7836 455c      (b"grai\x6E\
+0001c610: 7830 305c 7830 305c 7830 3022 202b 0a20  x00\x00\x00" +. 
+0001c620: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c640: 2062 225c 7830 315c 7830 3022 202b 0a20   b"\x01\x00" +. 
+0001c650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c670: 2028 6222 6762 6864 5c78 3563 5c78 3030   (b"gbhd\x5c\x00
+0001c680: 5c78 3030 5c78 3030 2220 2b0a 2020 2020  \x00\x00" +.    
+0001c690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c6a0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0001c6b0: 7263 5f69 642e 6279 7465 7320 2b0a 2020  rc_id.bytes +.  
+0001c6c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c6d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c6e0: 2066 6c6f 775f 6964 2e62 7974 6573 202b   flow_id.bytes +
+0001c6f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001c700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c710: 2020 2020 6222 5c78 3030 5c78 3030 5c78      b"\x00\x00\x
+0001c720: 3030 5c78 3030 5c78 3030 5c78 3030 5c78  00\x00\x00\x00\x
+0001c730: 3030 5c78 3030 5c78 3030 5c78 3030 5c78  00\x00\x00\x00\x
+0001c740: 3030 5c78 3030 5c78 3030 5c78 3030 5c78  00\x00\x00\x00\x
+0001c750: 3030 5c78 3030 2220 2b0a 2020 2020 2020  00\x00" +.      
+0001c760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c770: 2020 2020 2020 2020 2020 2020 2062 225c               b"\
+0001c780: 7830 305c 7830 305c 7830 305c 7830 305c  x00\x00\x00\x00\
+0001c790: 7830 305c 7830 305c 7830 305c 7830 305c  x00\x00\x00\x00\
+0001c7a0: 7830 305c 7830 3022 202b 0a20 2020 2020  x00\x00" +.     
+0001c7b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c7c0: 2020 2020 2020 2020 2020 2020 2020 6222                b"
+0001c7d0: 5c78 3030 5c78 3030 5c78 3030 5c78 3030  \x00\x00\x00\x00
+0001c7e0: 5c78 3030 5c78 3030 5c78 3030 5c78 3030  \x00\x00\x00\x00
+0001c7f0: 5c78 3030 5c78 3030 2220 2b0a 2020 2020  \x00\x00" +.    
+0001c800: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c810: 2020 2020 2020 2020 2020 2020 2020 2062                 b
+0001c820: 225c 7830 305c 7830 305c 7830 305c 7830  "\x00\x00\x00\x0
+0001c830: 305c 7830 305c 7830 305c 7830 305c 7830  0\x00\x00\x00\x0
+0001c840: 3022 202b 0a20 2020 2020 2020 2020 2020  0" +.           
+0001c850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c860: 2020 2020 2020 2020 6222 5c78 3030 5c78          b"\x00\x
+0001c870: 3030 5c78 3030 5c78 3030 5c78 3030 5c78  00\x00\x00\x00\x
+0001c880: 3030 5c78 3030 5c78 3030 2229 202b 0a20  00\x00\x00") +. 
+0001c890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c8a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c8b0: 2028 6222 6772 6474 5c78 3038 5c78 3030   (b"grdt\x08\x00
+0001c8c0: 5c78 3030 5c78 3030 2229 2920 2b0a 2020  \x00\x00")) +.  
+0001c8d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c8e0: 2020 2020 2020 2020 2020 2020 2020 2028                 (
+0001c8f0: 6222 6475 6d79 5c78 3038 5c78 3030 5c78  b"dumy\x08\x00\x
+0001c900: 3030 5c78 3030 2229 290a 0a20 2020 2020  00\x00"))..     
+0001c910: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+0001c920: 7561 6c28 6c65 6e28 7365 676d 656e 7473  ual(len(segments
+0001c930: 5b31 5d29 2c20 3229 0a20 2020 2020 2020  [1]), 2).       
+0001c940: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+0001c950: 6c28 7365 676d 656e 7473 5b31 5d5b 305d  l(segments[1][0]
+0001c960: 2e67 7261 696e 5f74 7970 652c 2022 656d  .grain_type, "em
+0001c970: 7074 7922 290a 2020 2020 2020 2020 7365  pty").        se
+0001c980: 6c66 2e61 7373 6572 7449 734e 6f6e 6528  lf.assertIsNone(
+0001c990: 7365 676d 656e 7473 5b31 5d5b 305d 2e64  segments[1][0].d
+0001c9a0: 6174 6129 0a20 2020 2020 2020 2073 656c  ata).        sel
+0001c9b0: 662e 6173 7365 7274 4571 7561 6c28 7365  f.assertEqual(se
+0001c9c0: 676d 656e 7473 5b31 5d5b 315d 2e67 7261  gments[1][1].gra
+0001c9d0: 696e 5f74 7970 652c 2022 656d 7074 7922  in_type, "empty"
+0001c9e0: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+0001c9f0: 7373 6572 7449 734e 6f6e 6528 7365 676d  ssertIsNone(segm
+0001ca00: 656e 7473 5b31 5d5b 315d 2e64 6174 6129  ents[1][1].data)
+0001ca10: 0a0a 2020 2020 6465 6620 7465 7374 5f6c  ..    def test_l
+0001ca20: 6f61 6473 5f63 6f64 6564 5f61 7564 696f  oads_coded_audio
+0001ca30: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+0001ca40: 2868 6561 642c 2073 6567 6d65 6e74 7329  (head, segments)
+0001ca50: 203d 206c 6f61 6473 2843 4f44 4544 5f41   = loads(CODED_A
+0001ca60: 5544 494f 5f44 4154 415f 3829 0a0a 2020  UDIO_DATA_8)..  
+0001ca70: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+0001ca80: 7445 7175 616c 2868 6561 645b 2763 7265  tEqual(head['cre
+0001ca90: 6174 6564 275d 2c20 6461 7465 7469 6d65  ated'], datetime
+0001caa0: 2832 3032 332c 2036 2c20 382c 2031 312c  (2023, 6, 8, 11,
+0001cab0: 2033 342c 2033 2929 0a20 2020 2020 2020   34, 3)).       
+0001cac0: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+0001cad0: 6c28 6865 6164 5b27 6964 275d 2c20 5555  l(head['id'], UU
+0001cae0: 4944 2827 6663 6666 3830 3761 2d30 3565  ID('fcff807a-05e
+0001caf0: 372d 3131 6565 2d39 6365 662d 6666 3438  7-11ee-9cef-ff48
+0001cb00: 6637 6638 3161 6366 2729 290a 2020 2020  f7f81acf')).    
+0001cb10: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+0001cb20: 7175 616c 286c 656e 2868 6561 645b 2773  qual(len(head['s
+0001cb30: 6567 6d65 6e74 7327 5d29 2c20 3129 0a20  egments']), 1). 
+0001cb40: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+0001cb50: 7274 4571 7561 6c28 6865 6164 5b27 7365  rtEqual(head['se
+0001cb60: 676d 656e 7473 275d 5b30 5d5b 2769 6427  gments'][0]['id'
+0001cb70: 5d2c 2055 5549 4428 2766 6366 6638 3037  ], UUID('fcff807
+0001cb80: 622d 3035 6537 2d31 3165 652d 3963 6566  b-05e7-11ee-9cef
+0001cb90: 2d66 6634 3866 3766 3831 6163 6627 2929  -ff48f7f81acf'))
+0001cba0: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+0001cbb0: 7365 7274 496e 2868 6561 645b 2773 6567  sertIn(head['seg
+0001cbc0: 6d65 6e74 7327 5d5b 305d 5b27 6c6f 6361  ments'][0]['loca
+0001cbd0: 6c5f 6964 275d 2c20 7365 676d 656e 7473  l_id'], segments
+0001cbe0: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+0001cbf0: 7373 6572 7445 7175 616c 286c 656e 2873  ssertEqual(len(s
+0001cc00: 6567 6d65 6e74 735b 6865 6164 5b27 7365  egments[head['se
+0001cc10: 676d 656e 7473 275d 5b30 5d5b 276c 6f63  gments'][0]['loc
+0001cc20: 616c 5f69 6427 5d5d 292c 2068 6561 645b  al_id']]), head[
+0001cc30: 2773 6567 6d65 6e74 7327 5d5b 305d 5b27  'segments'][0]['
+0001cc40: 636f 756e 7427 5d29 0a0a 2020 2020 2020  count'])..      
+0001cc50: 2020 7374 6172 745f 6f74 7320 3d20 5469    start_ots = Ti
+0001cc60: 6d65 7374 616d 7028 3134 3230 3130 3238  mestamp(14201028
+0001cc70: 3030 2c20 3029 0a20 2020 2020 2020 206f  00, 0).        o
+0001cc80: 7473 203d 2073 7461 7274 5f6f 7473 0a20  ts = start_ots. 
+0001cc90: 2020 2020 2020 2074 6f74 616c 5f73 616d         total_sam
+0001cca0: 706c 6573 203d 2030 0a20 2020 2020 2020  ples = 0.       
+0001ccb0: 206c 656e 6774 6873 203d 205b 3630 332c   lengths = [603,
+0001ccc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001ccd0: 2020 2020 3639 302c 0a20 2020 2020 2020      690,.       
+0001cce0: 2020 2020 2020 2020 2020 2020 3639 302c              690,
+0001ccf0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001cd00: 2020 2020 3638 392c 0a20 2020 2020 2020      689,.       
+0001cd10: 2020 2020 2020 2020 2020 2020 3639 302c              690,
+0001cd20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001cd30: 2020 2020 3639 302c 0a20 2020 2020 2020      690,.       
+0001cd40: 2020 2020 2020 2020 2020 2020 3638 392c              689,
+0001cd50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001cd60: 2020 2020 3639 302c 0a20 2020 2020 2020      690,.       
+0001cd70: 2020 2020 2020 2020 2020 2020 3639 302c              690,
+0001cd80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001cd90: 2020 2020 3638 395d 0a20 2020 2020 2020      689].       
+0001cda0: 2066 6f72 2067 7261 696e 2069 6e20 7365   for grain in se
+0001cdb0: 676d 656e 7473 5b68 6561 645b 2773 6567  gments[head['seg
+0001cdc0: 6d65 6e74 7327 5d5b 305d 5b27 6c6f 6361  ments'][0]['loca
+0001cdd0: 6c5f 6964 275d 5d3a 0a20 2020 2020 2020  l_id']]:.       
+0001cde0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+0001cdf0: 4973 496e 7374 616e 6365 2867 7261 696e  IsInstance(grain
+0001ce00: 2c20 436f 6465 6441 7564 696f 4772 6169  , CodedAudioGrai
+0001ce10: 6e29 0a20 2020 2020 2020 2020 2020 2073  n).            s
+0001ce20: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+0001ce30: 6772 6169 6e2e 6772 6169 6e5f 7479 7065  grain.grain_type
+0001ce40: 2c20 2263 6f64 6564 5f61 7564 696f 2229  , "coded_audio")
+0001ce50: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0001ce60: 662e 6173 7365 7274 4571 7561 6c28 6772  f.assertEqual(gr
+0001ce70: 6169 6e2e 736f 7572 6365 5f69 642c 2055  ain.source_id, U
+0001ce80: 5549 4428 2733 3862 6664 3930 322d 6233  UID('38bfd902-b3
+0001ce90: 3566 2d34 3064 362d 3965 6366 2d64 6339  5f-40d6-9ecf-dc9
+0001cea0: 3538 3639 3133 3063 6627 2929 0a20 2020  5869130cf')).   
+0001ceb0: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
+0001cec0: 7365 7274 4571 7561 6c28 6772 6169 6e2e  sertEqual(grain.
+0001ced0: 666c 6f77 5f69 642c 2055 5549 4428 2765  flow_id, UUID('e
+0001cee0: 3631 3532 3936 622d 6666 3430 2d34 6439  615296b-ff40-4d9
+0001cef0: 352d 3833 3938 2d36 6134 3038 3233 3035  5-8398-6a4082305
+0001cf00: 6633 6127 2929 0a20 2020 2020 2020 2020  f3a')).         
+0001cf10: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+0001cf20: 7561 6c28 6772 6169 6e2e 6f72 6967 696e  ual(grain.origin
+0001cf30: 5f74 696d 6573 7461 6d70 2c20 6f74 7329  _timestamp, ots)
+0001cf40: 0a0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+0001cf50: 6c66 2e61 7373 6572 7445 7175 616c 2867  lf.assertEqual(g
+0001cf60: 7261 696e 2e66 6f72 6d61 742c 2043 6f67  rain.format, Cog
+0001cf70: 4175 6469 6f46 6f72 6d61 742e 4141 4329  AudioFormat.AAC)
+0001cf80: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0001cf90: 662e 6173 7365 7274 4571 7561 6c28 6772  f.assertEqual(gr
+0001cfa0: 6169 6e2e 6368 616e 6e65 6c73 2c20 3229  ain.channels, 2)
+0001cfb0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0001cfc0: 662e 6173 7365 7274 4571 7561 6c28 6772  f.assertEqual(gr
+0001cfd0: 6169 6e2e 7361 6d70 6c65 732c 2031 3032  ain.samples, 102
+0001cfe0: 3429 0a20 2020 2020 2020 2020 2020 2073  4).            s
+0001cff0: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+0001d000: 6772 6169 6e2e 7072 696d 696e 672c 2030  grain.priming, 0
+0001d010: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+0001d020: 6c66 2e61 7373 6572 7445 7175 616c 2867  lf.assertEqual(g
+0001d030: 7261 696e 2e72 656d 6169 6e64 6572 2c20  rain.remainder, 
+0001d040: 3029 0a20 2020 2020 2020 2020 2020 2073  0).            s
+0001d050: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+0001d060: 6772 6169 6e2e 7361 6d70 6c65 5f72 6174  grain.sample_rat
+0001d070: 652c 2034 3830 3030 290a 0a20 2020 2020  e, 48000)..     
+0001d080: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+0001d090: 7274 4571 7561 6c28 6c65 6e28 6772 6169  rtEqual(len(grai
+0001d0a0: 6e2e 6461 7461 292c 206c 656e 6774 6873  n.data), lengths
+0001d0b0: 5b30 5d29 0a20 2020 2020 2020 2020 2020  [0]).           
+0001d0c0: 206c 656e 6774 6873 2e70 6f70 2830 290a   lengths.pop(0).
+0001d0d0: 2020 2020 2020 2020 2020 2020 746f 7461              tota
+0001d0e0: 6c5f 7361 6d70 6c65 7320 2b3d 2067 7261  l_samples += gra
+0001d0f0: 696e 2e73 616d 706c 6573 0a20 2020 2020  in.samples.     
+0001d100: 2020 2020 2020 206f 7473 203d 2073 7461         ots = sta
+0001d110: 7274 5f6f 7473 202b 2054 696d 654f 6666  rt_ots + TimeOff
+0001d120: 7365 742e 6672 6f6d 5f63 6f75 6e74 2874  set.from_count(t
+0001d130: 6f74 616c 5f73 616d 706c 6573 2c20 6772  otal_samples, gr
+0001d140: 6169 6e2e 7361 6d70 6c65 5f72 6174 6529  ain.sample_rate)
+0001d150: 0a0a 2020 2020 6465 6620 7465 7374 5f6c  ..    def test_l
+0001d160: 6f61 6473 5f65 7665 6e74 2873 656c 6629  oads_event(self)
+0001d170: 3a0a 2020 2020 2020 2020 7365 6c66 2e6d  :.        self.m
+0001d180: 6178 4469 6666 203d 204e 6f6e 650a 2020  axDiff = None.  
+0001d190: 2020 2020 2020 2868 6561 642c 2073 6567        (head, seg
+0001d1a0: 6d65 6e74 7329 203d 206c 6f61 6473 2845  ments) = loads(E
+0001d1b0: 5645 4e54 5f44 4154 415f 3829 0a0a 2020  VENT_DATA_8)..  
+0001d1c0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+0001d1d0: 7445 7175 616c 2868 6561 645b 2763 7265  tEqual(head['cre
+0001d1e0: 6174 6564 275d 2c20 6461 7465 7469 6d65  ated'], datetime
+0001d1f0: 2832 3032 332c 2036 2c20 382c 2031 312c  (2023, 6, 8, 11,
+0001d200: 2033 342c 2033 2929 0a20 2020 2020 2020   34, 3)).       
+0001d210: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+0001d220: 6c28 6865 6164 5b27 6964 275d 2c20 5555  l(head['id'], UU
+0001d230: 4944 2827 6663 6666 3830 3765 2d30 3565  ID('fcff807e-05e
+0001d240: 372d 3131 6565 2d39 6365 662d 6666 3438  7-11ee-9cef-ff48
+0001d250: 6637 6638 3161 6366 2729 290a 2020 2020  f7f81acf')).    
+0001d260: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+0001d270: 7175 616c 286c 656e 2868 6561 645b 2773  qual(len(head['s
+0001d280: 6567 6d65 6e74 7327 5d29 2c20 3129 0a20  egments']), 1). 
+0001d290: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+0001d2a0: 7274 4571 7561 6c28 6865 6164 5b27 7365  rtEqual(head['se
+0001d2b0: 676d 656e 7473 275d 5b30 5d5b 2769 6427  gments'][0]['id'
+0001d2c0: 5d2c 2055 5549 4428 2766 6366 6638 3037  ], UUID('fcff807
+0001d2d0: 662d 3035 6537 2d31 3165 652d 3963 6566  f-05e7-11ee-9cef
+0001d2e0: 2d66 6634 3866 3766 3831 6163 6627 2929  -ff48f7f81acf'))
+0001d2f0: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+0001d300: 7365 7274 496e 2868 6561 645b 2773 6567  sertIn(head['seg
+0001d310: 6d65 6e74 7327 5d5b 305d 5b27 6c6f 6361  ments'][0]['loca
+0001d320: 6c5f 6964 275d 2c20 7365 676d 656e 7473  l_id'], segments
+0001d330: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+0001d340: 7373 6572 7445 7175 616c 286c 656e 2873  ssertEqual(len(s
+0001d350: 6567 6d65 6e74 735b 6865 6164 5b27 7365  egments[head['se
+0001d360: 676d 656e 7473 275d 5b30 5d5b 276c 6f63  gments'][0]['loc
+0001d370: 616c 5f69 6427 5d5d 292c 2068 6561 645b  al_id']]), head[
+0001d380: 2773 6567 6d65 6e74 7327 5d5b 305d 5b27  'segments'][0]['
+0001d390: 636f 756e 7427 5d29 0a0a 2020 2020 2020  count'])..      
+0001d3a0: 2020 7374 6172 745f 6f74 7320 3d20 5469    start_ots = Ti
+0001d3b0: 6d65 7374 616d 7028 3134 3437 3137 3635  mestamp(14471765
+0001d3c0: 3132 2c20 3430 3030 3030 3030 3029 0a20  12, 400000000). 
+0001d3d0: 2020 2020 2020 206f 7473 203d 2073 7461         ots = sta
+0001d3e0: 7274 5f6f 7473 0a20 2020 2020 2020 206c  rt_ots.        l
+0001d3f0: 696e 6520 3d20 2727 0a20 2020 2020 2020  ine = ''.       
+0001d400: 2073 6571 6e75 6d20 3d20 3331 3037 3738   seqnum = 310778
+0001d410: 3738 3934 3234 3234 3939 3236 340a 2020  7894242499264.  
+0001d420: 2020 2020 2020 666f 7220 6772 6169 6e20        for grain 
+0001d430: 696e 2073 6567 6d65 6e74 735b 6865 6164  in segments[head
+0001d440: 5b27 7365 676d 656e 7473 275d 5b30 5d5b  ['segments'][0][
+0001d450: 276c 6f63 616c 5f69 6427 5d5d 3a0a 2020  'local_id']]:.  
+0001d460: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+0001d470: 7373 6572 7449 7349 6e73 7461 6e63 6528  ssertIsInstance(
+0001d480: 6772 6169 6e2c 2045 7665 6e74 4772 6169  grain, EventGrai
+0001d490: 6e29 0a20 2020 2020 2020 2020 2020 2073  n).            s
+0001d4a0: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+0001d4b0: 6772 6169 6e2e 6772 6169 6e5f 7479 7065  grain.grain_type
+0001d4c0: 2c20 2265 7665 6e74 2229 0a20 2020 2020  , "event").     
+0001d4d0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+0001d4e0: 7274 4571 7561 6c28 6772 6169 6e2e 736f  rtEqual(grain.so
+0001d4f0: 7572 6365 5f69 642c 2055 5549 4428 2732  urce_id, UUID('2
+0001d500: 6462 3432 3638 652d 3832 6566 2d34 3966  db4268e-82ef-49f
+0001d510: 392d 6263 3066 2d31 3732 3665 3833 3532  9-bc0f-1726e8352
+0001d520: 6437 3627 2929 0a20 2020 2020 2020 2020  d76')).         
+0001d530: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+0001d540: 7561 6c28 6772 6169 6e2e 666c 6f77 5f69  ual(grain.flow_i
+0001d550: 642c 2055 5549 4428 2735 3333 3362 6165  d, UUID('5333bae
+0001d560: 392d 3037 3638 2d34 6533 312d 6265 3163  9-0768-4e31-be1c
+0001d570: 2d66 6264 3564 6332 6533 3461 6327 2929  -fbd5dc2e34ac'))
+0001d580: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0001d590: 662e 6173 7365 7274 4571 7561 6c28 6772  f.assertEqual(gr
+0001d5a0: 6169 6e2e 6f72 6967 696e 5f74 696d 6573  ain.origin_times
+0001d5b0: 7461 6d70 2c20 6f74 7329 0a0a 2020 2020  tamp, ots)..    
+0001d5c0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+0001d5d0: 6572 7445 7175 616c 2867 7261 696e 2e65  ertEqual(grain.e
+0001d5e0: 7665 6e74 5f74 7970 652c 2027 7572 6e3a  vent_type, 'urn:
+0001d5f0: 782d 6970 7374 7564 696f 3a66 6f72 6d61  x-ipstudio:forma
+0001d600: 743a 6576 656e 742e 7474 6578 742e 6562  t:event.ttext.eb
+0001d610: 7574 746c 6976 6527 290a 2020 2020 2020  uttlive').      
+0001d620: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+0001d630: 7445 7175 616c 2867 7261 696e 2e74 6f70  tEqual(grain.top
+0001d640: 6963 2c20 2727 290a 2020 2020 2020 2020  ic, '').        
+0001d650: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+0001d660: 7175 616c 286c 656e 2867 7261 696e 2e65  qual(len(grain.e
+0001d670: 7665 6e74 5f64 6174 6129 2c20 3129 0a20  vent_data), 1). 
+0001d680: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0001d690: 6173 7365 7274 4571 7561 6c28 6772 6169  assertEqual(grai
+0001d6a0: 6e2e 6576 656e 745f 6461 7461 5b30 5d2e  n.event_data[0].
+0001d6b0: 7061 7468 2c20 2753 7562 7327 290a 2020  path, 'Subs').  
+0001d6c0: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+0001d6d0: 7373 6572 7445 7175 616c 2867 7261 696e  ssertEqual(grain
+0001d6e0: 2e65 7665 6e74 5f64 6174 615b 305d 2e70  .event_data[0].p
+0001d6f0: 7265 2c20 6c69 6e65 290a 2020 2020 2020  re, line).      
+0001d700: 2020 2020 2020 6c69 6e65 203d 2028 280a        line = ((.
+0001d710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d720: 273c 3f78 6d6c 2076 6572 7369 6f6e 3d22  '<?xml version="
+0001d730: 312e 3022 2065 6e63 6f64 696e 673d 2255  1.0" encoding="U
+0001d740: 5446 2d38 223f 3e5c 6e3c 7474 3a74 7420  TF-8"?>\n<tt:tt 
+0001d750: 7474 703a 7469 6d65 4261 7365 3d22 636c  ttp:timeBase="cl
+0001d760: 6f63 6b22 2074 7470 3a63 6c6f 636b 4d6f  ock" ttp:clockMo
+0001d770: 6465 3d22 7574 6322 270a 2020 2020 2020  de="utc"'.      
+0001d780: 2020 2020 2020 2020 2020 2720 786d 6c3a            ' xml:
+0001d790: 6c61 6e67 3d22 656e 2220 786d 6c6e 733a  lang="en" xmlns:
+0001d7a0: 7474 3d22 6874 7470 3a2f 2f77 7777 2e77  tt="http://www.w
+0001d7b0: 332e 6f72 672f 6e73 2f74 746d 6c22 2020  3.org/ns/ttml"  
+0001d7c0: 786d 6c6e 733a 6562 7574 7445 7874 3d22  xmlns:ebuttExt="
+0001d7d0: 7572 6e3a 6562 753a 7474 3a65 7874 656e  urn:ebu:tt:exten
+0001d7e0: 7369 6f6e 2227 0a20 2020 2020 2020 2020  sion"'.         
+0001d7f0: 2020 2020 2020 2027 2020 786d 6c6e 733a         '  xmlns:
+0001d800: 7474 703d 2268 7474 703a 2f2f 7777 772e  ttp="http://www.
+0001d810: 7733 2e6f 7267 2f6e 732f 7474 6d6c 2370  w3.org/ns/ttml#p
+0001d820: 6172 616d 6574 6572 2220 786d 6c6e 733a  arameter" xmlns:
+0001d830: 7474 733d 2268 7474 703a 2f2f 7777 772e  tts="http://www.
+0001d840: 7733 2e6f 7267 2f6e 732f 7474 6d6c 2373  w3.org/ns/ttml#s
+0001d850: 7479 6c69 6e67 2227 0a20 2020 2020 2020  tyling"'.       
+0001d860: 2020 2020 2020 2020 2027 2074 7470 3a63           ' ttp:c
+0001d870: 656c 6c52 6573 6f6c 7574 696f 6e3d 2235  ellResolution="5
+0001d880: 3020 3330 2220 786d 6c6e 733a 6562 7574  0 30" xmlns:ebut
+0001d890: 746d 3d22 7572 6e3a 6562 753a 7474 3a6d  tm="urn:ebu:tt:m
+0001d8a0: 6574 6164 6174 6122 2074 7473 3a65 7874  etadata" tts:ext
+0001d8b0: 656e 743d 2231 3932 3070 7820 3130 3830  ent="1920px 1080
+0001d8c0: 7078 2227 0a20 2020 2020 2020 2020 2020  px"'.           
+0001d8d0: 2020 2020 2027 2074 7470 3a64 726f 704d       ' ttp:dropM
+0001d8e0: 6f64 653d 226e 6f6e 4472 6f70 2220 7474  ode="nonDrop" tt
+0001d8f0: 703a 6d61 726b 6572 4d6f 6465 3d22 6469  p:markerMode="di
+0001d900: 7363 6f6e 7469 6e75 6f75 7322 270a 2020  scontinuous"'.  
+0001d910: 2020 2020 2020 2020 2020 2020 2020 2720                ' 
+0001d920: 6562 7574 746d 3a73 6571 7565 6e63 6549  ebuttm:sequenceI
+0001d930: 6465 6e74 6966 6965 723d 2235 3333 3362  dentifier="5333b
+0001d940: 6165 392d 3037 3638 2d34 6533 312d 6265  ae9-0768-4e31-be
+0001d950: 3163 2d66 6264 3564 6332 6533 3461 6322  1c-fbd5dc2e34ac"
+0001d960: 2065 6275 7474 6d3a 7365 7175 656e 6365   ebuttm:sequence
+0001d970: 4e75 6d62 6572 3d22 2729 0a20 2020 2020  Number="').     
+0001d980: 2020 2020 2020 2020 2020 202b 2073 7472             + str
+0001d990: 2873 6571 6e75 6d29 202b 2028 0a20 2020  (seqnum) + (.   
+0001d9a0: 2020 2020 2020 2020 2020 2020 2027 223e               '">
+0001d9b0: 3c74 743a 6865 6164 3e3c 7474 3a6d 6574  <tt:head><tt:met
+0001d9c0: 6164 6174 613e 3c65 6275 7474 6d3a 646f  adata><ebuttm:do
+0001d9d0: 6375 6d65 6e74 4d65 7461 6461 7461 3e3c  cumentMetadata><
+0001d9e0: 6562 7574 746d 3a64 6f63 756d 656e 7445  ebuttm:documentE
+0001d9f0: 6275 7474 5665 7273 696f 6e3e 270a 2020  buttVersion>'.  
+0001da00: 2020 2020 2020 2020 2020 2020 2020 2776                'v
+0001da10: 312e 303c 2f65 6275 7474 6d3a 646f 6375  1.0</ebuttm:docu
+0001da20: 6d65 6e74 4562 7574 7456 6572 7369 6f6e  mentEbuttVersion
+0001da30: 3e3c 6562 7574 746d 3a64 6f63 756d 656e  ><ebuttm:documen
+0001da40: 7454 6f74 616c 4e75 6d62 6572 4f66 5375  tTotalNumberOfSu
+0001da50: 6274 6974 6c65 733e 270a 2020 2020 2020  btitles>'.      
+0001da60: 2020 2020 2020 2020 2020 2731 3c2f 6562            '1</eb
+0001da70: 7574 746d 3a64 6f63 756d 656e 7454 6f74  uttm:documentTot
+0001da80: 616c 4e75 6d62 6572 4f66 5375 6274 6974  alNumberOfSubtit
+0001da90: 6c65 733e 3c65 6275 7474 6d3a 646f 6375  les><ebuttm:docu
+0001daa0: 6d65 6e74 4d61 7869 6d75 6d4e 756d 6265  mentMaximumNumbe
+0001dab0: 724f 6644 6973 706c 6179 6162 6c65 4368  rOfDisplayableCh
+0001dac0: 6172 6163 7465 7249 6e41 6e79 526f 773e  aracterInAnyRow>
+0001dad0: 270a 2020 2020 2020 2020 2020 2020 2020  '.              
+0001dae0: 2020 2734 303c 2f65 6275 7474 6d3a 646f    '40</ebuttm:do
+0001daf0: 6375 6d65 6e74 4d61 7869 6d75 6d4e 756d  cumentMaximumNum
+0001db00: 6265 724f 6644 6973 706c 6179 6162 6c65  berOfDisplayable
+0001db10: 4368 6172 6163 7465 7249 6e41 6e79 526f  CharacterInAnyRo
+0001db20: 773e 3c65 6275 7474 6d3a 646f 6375 6d65  w><ebuttm:docume
+0001db30: 6e74 436f 756e 7472 794f 664f 7269 6769  ntCountryOfOrigi
+0001db40: 6e3e 270a 2020 2020 2020 2020 2020 2020  n>'.            
+0001db50: 2020 2020 2767 623c 2f65 6275 7474 6d3a      'gb</ebuttm:
+0001db60: 646f 6375 6d65 6e74 436f 756e 7472 794f  documentCountryO
+0001db70: 664f 7269 6769 6e3e 3c2f 6562 7574 746d  fOrigin></ebuttm
+0001db80: 3a64 6f63 756d 656e 744d 6574 6164 6174  :documentMetadat
+0001db90: 613e 3c2f 7474 3a6d 6574 6164 6174 613e  a></tt:metadata>
+0001dba0: 3c74 743a 7374 796c 696e 673e 270a 2020  <tt:styling>'.  
+0001dbb0: 2020 2020 2020 2020 2020 2020 2020 273c                '<
+0001dbc0: 7474 3a73 7479 6c65 2078 6d6c 3a69 643d  tt:style xml:id=
+0001dbd0: 2264 6566 6175 6c74 5374 796c 6522 2074  "defaultStyle" t
+0001dbe0: 7473 3a66 6f6e 7446 616d 696c 793d 226d  ts:fontFamily="m
+0001dbf0: 6f6e 6f73 7061 6365 5361 6e73 5365 7269  onospaceSansSeri
+0001dc00: 6622 2074 7473 3a66 6f6e 7453 697a 653d  f" tts:fontSize=
+0001dc10: 2231 6320 3163 2227 0a20 2020 2020 2020  "1c 1c"'.       
+0001dc20: 2020 2020 2020 2020 2027 2074 7473 3a6c           ' tts:l
+0001dc30: 696e 6548 6569 6768 743d 226e 6f72 6d61  ineHeight="norma
+0001dc40: 6c22 2074 7473 3a74 6578 7441 6c69 676e  l" tts:textAlign
+0001dc50: 3d22 6365 6e74 6572 2220 7474 733a 636f  ="center" tts:co
+0001dc60: 6c6f 723d 2277 6869 7465 2220 7474 733a  lor="white" tts:
+0001dc70: 6261 636b 6772 6f75 6e64 436f 6c6f 723d  backgroundColor=
+0001dc80: 2274 7261 6e73 7061 7265 6e74 2227 0a20  "transparent"'. 
+0001dc90: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+0001dca0: 2074 7473 3a66 6f6e 7453 7479 6c65 3d22   tts:fontStyle="
+0001dcb0: 6e6f 726d 616c 2220 7474 733a 666f 6e74  normal" tts:font
+0001dcc0: 5765 6967 6874 3d22 6e6f 726d 616c 2220  Weight="normal" 
+0001dcd0: 7474 733a 7465 7874 4465 636f 7261 7469  tts:textDecorati
+0001dce0: 6f6e 3d22 6e6f 6e65 2220 2f3e 3c74 743a  on="none" /><tt:
+0001dcf0: 7374 796c 6527 0a20 2020 2020 2020 2020  style'.         
+0001dd00: 2020 2020 2020 2027 2078 6d6c 3a69 643d         ' xml:id=
+0001dd10: 2257 6869 7465 4f6e 426c 6163 6b22 2074  "WhiteOnBlack" t
+0001dd20: 7473 3a63 6f6c 6f72 3d22 7768 6974 6522  ts:color="white"
+0001dd30: 2074 7473 3a62 6163 6b67 726f 756e 6443   tts:backgroundC
+0001dd40: 6f6c 6f72 3d22 626c 6163 6b22 2074 7473  olor="black" tts
+0001dd50: 3a66 6f6e 7453 697a 653d 2231 6320 3263  :fontSize="1c 2c
+0001dd60: 222f 3e27 0a20 2020 2020 2020 2020 2020  "/>'.           
+0001dd70: 2020 2020 2027 3c74 743a 7374 796c 6520       '<tt:style 
+0001dd80: 786d 6c3a 6964 3d22 7465 7874 4365 6e74  xml:id="textCent
+0001dd90: 6572 2220 7474 733a 7465 7874 416c 6967  er" tts:textAlig
+0001dda0: 6e3d 2263 656e 7465 7222 2f3e 3c2f 7474  n="center"/></tt
+0001ddb0: 3a73 7479 6c69 6e67 3e3c 7474 3a6c 6179  :styling><tt:lay
+0001ddc0: 6f75 743e 3c74 743a 7265 6769 6f6e 270a  out><tt:region'.
+0001ddd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dde0: 2720 786d 6c3a 6964 3d22 626f 7474 6f6d  ' xml:id="bottom
+0001ddf0: 2220 7474 733a 6f72 6967 696e 3d22 3130  " tts:origin="10
+0001de00: 2520 3130 2522 2074 7473 3a65 7874 656e  % 10%" tts:exten
+0001de10: 743d 2238 3025 2038 3025 2220 7474 733a  t="80% 80%" tts:
+0001de20: 7061 6464 696e 673d 2230 6322 2074 7473  padding="0c" tts
+0001de30: 3a64 6973 706c 6179 416c 6967 6e3d 2261  :displayAlign="a
+0001de40: 6674 6572 2227 0a20 2020 2020 2020 2020  fter"'.         
+0001de50: 2020 2020 2020 2027 2074 7473 3a77 7269         ' tts:wri
+0001de60: 7469 6e67 4d6f 6465 3d22 6c72 7462 222f  tingMode="lrtb"/
+0001de70: 3e3c 2f74 743a 6c61 796f 7574 3e3c 2f74  ></tt:layout></t
+0001de80: 743a 6865 6164 3e3c 7474 3a62 6f64 7920  t:head><tt:body 
+0001de90: 6475 723d 2230 303a 3030 3a31 3022 3e3c  dur="00:00:10"><
+0001dea0: 7474 3a64 6976 2073 7479 6c65 3d22 6465  tt:div style="de
+0001deb0: 6661 756c 7453 7479 6c65 223e 270a 2020  faultStyle">'.  
+0001dec0: 2020 2020 2020 2020 2020 2020 2020 273c                '<
+0001ded0: 7474 3a70 2078 6d6c 3a69 643d 2273 7562  tt:p xml:id="sub
+0001dee0: 3222 2073 7479 6c65 3d22 7465 7874 4365  2" style="textCe
+0001def0: 6e74 6572 2220 7265 6769 6f6e 3d22 626f  nter" region="bo
+0001df00: 7474 6f6d 223e 3c74 743a 7370 616e 2073  ttom"><tt:span s
+0001df10: 7479 6c65 3d22 5768 6974 654f 6e42 6c61  tyle="WhiteOnBla
+0001df20: 636b 223e 2729 0a20 2020 2020 2020 2020  ck">').         
+0001df30: 2020 2020 2020 202b 206f 7473 2e74 6f5f         + ots.to_
+0001df40: 6973 6f38 3630 315f 7574 6328 2920 2b20  iso8601_utc() + 
+0001df50: 273c 2f74 743a 7370 616e 3e3c 2f74 743a  '</tt:span></tt:
+0001df60: 703e 3c2f 7474 3a64 6976 3e3c 2f74 743a  p></tt:div></tt:
+0001df70: 626f 6479 3e3c 2f74 743a 7474 3e27 2920  body></tt:tt>') 
+0001df80: 2023 204e 4f51 410a 2020 2020 2020 2020   # NOQA.        
+0001df90: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+0001dfa0: 7175 616c 280a 2020 2020 2020 2020 2020  qual(.          
+0001dfb0: 2020 2020 2020 6772 6169 6e2e 6576 656e        grain.even
+0001dfc0: 745f 6461 7461 5b30 5d2e 706f 7374 2c0a  t_data[0].post,.
+0001dfd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dfe0: 6c69 6e65 2c0a 2020 2020 2020 2020 2020  line,.          
+0001dff0: 2020 2020 2020 6d73 673d 225c 6e5c 6e45        msg="\n\nE
+0001e000: 7870 6563 7465 643a 5c6e 5c6e 7b21 727d  xpected:\n\n{!r}
+0001e010: 5c6e 5c6e 476f 743a 5c6e 5c6e 7b21 727d  \n\nGot:\n\n{!r}
+0001e020: 5c6e 5c6e 222e 666f 726d 6174 286c 696e  \n\n".format(lin
+0001e030: 652c 2067 7261 696e 2e65 7665 6e74 5f64  e, grain.event_d
+0001e040: 6174 615b 305d 2e70 6f73 7429 290a 0a20  ata[0].post)).. 
+0001e050: 2020 2020 2020 2020 2020 206f 7473 203d             ots =
+0001e060: 206f 7473 202b 2054 696d 654f 6666 7365   ots + TimeOffse
+0001e070: 742e 6672 6f6d 5f6e 616e 6f73 6563 2832  t.from_nanosec(2
+0001e080: 3030 3030 3030 3029 0a20 2020 2020 2020  0000000).       
+0001e090: 2020 2020 2073 6571 6e75 6d20 2b3d 2032       seqnum += 2
+0001e0a0: 3030 3030 3030 300a 0a20 2020 2064 6566  0000000..    def
+0001e0b0: 2074 6573 745f 7265 6164 5f76 6572 7369   test_read_versi
+0001e0c0: 6f6e 5f37 2873 656c 6629 3a0a 2020 2020  on_7(self):.    
+0001e0d0: 2020 2020 7465 7374 5f64 6174 6120 3d20      test_data = 
+0001e0e0: 5b0a 2020 2020 2020 2020 2020 2020 2856  [.            (V
+0001e0f0: 4944 454f 5f44 4154 415f 372c 2056 4944  IDEO_DATA_7, VID
+0001e100: 454f 5f44 4154 415f 3829 2c0a 2020 2020  EO_DATA_8),.    
+0001e110: 2020 2020 2020 2020 2843 4f44 4544 5f56          (CODED_V
+0001e120: 4944 454f 5f44 4154 415f 372c 2043 4f44  IDEO_DATA_7, COD
+0001e130: 4544 5f56 4944 454f 5f44 4154 415f 3829  ED_VIDEO_DATA_8)
+0001e140: 2c0a 2020 2020 2020 2020 2020 2020 2841  ,.            (A
+0001e150: 5544 494f 5f44 4154 415f 372c 2041 5544  UDIO_DATA_7, AUD
+0001e160: 494f 5f44 4154 415f 3829 2c0a 2020 2020  IO_DATA_8),.    
+0001e170: 2020 2020 2020 2020 2843 4f44 4544 5f41          (CODED_A
+0001e180: 5544 494f 5f44 4154 415f 372c 2043 4f44  UDIO_DATA_7, COD
+0001e190: 4544 5f41 5544 494f 5f44 4154 415f 3829  ED_AUDIO_DATA_8)
+0001e1a0: 2c0a 2020 2020 2020 2020 2020 2020 2845  ,.            (E
+0001e1b0: 5645 4e54 5f44 4154 415f 372c 2045 5645  VENT_DATA_7, EVE
+0001e1c0: 4e54 5f44 4154 415f 3829 2c0a 2020 2020  NT_DATA_8),.    
+0001e1d0: 2020 2020 2020 2020 2849 4e54 4552 4c45          (INTERLE
+0001e1e0: 4156 4544 5f44 4154 415f 372c 2049 4e54  AVED_DATA_7, INT
+0001e1f0: 4552 4c45 4156 4544 5f44 4154 415f 3829  ERLEAVED_DATA_8)
+0001e200: 0a20 2020 2020 2020 205d 0a20 2020 2020  .        ].     
+0001e210: 2020 2066 6f72 2064 6174 6120 696e 2074     for data in t
+0001e220: 6573 745f 6461 7461 3a0a 2020 2020 2020  est_data:.      
+0001e230: 2020 2020 2020 7769 7468 2073 656c 662e        with self.
+0001e240: 7375 6254 6573 7428 6461 7461 3d64 6174  subTest(data=dat
+0001e250: 6129 3a0a 2020 2020 2020 2020 2020 2020  a):.            
+0001e260: 2020 2020 285f 2c20 7365 676d 656e 7473      (_, segments
+0001e270: 5f37 2920 3d20 6c6f 6164 7328 6461 7461  _7) = loads(data
+0001e280: 5b30 5d29 0a20 2020 2020 2020 2020 2020  [0]).           
+0001e290: 2020 2020 2028 5f2c 2073 6567 6d65 6e74       (_, segment
+0001e2a0: 735f 3829 203d 206c 6f61 6473 2864 6174  s_8) = loads(dat
+0001e2b0: 615b 315d 290a 2020 2020 2020 2020 2020  a[1]).          
+0001e2c0: 2020 2020 2020 666f 7220 6c6f 6361 6c5f        for local_
+0001e2d0: 6964 2069 6e20 7365 676d 656e 7473 5f37  id in segments_7
+0001e2e0: 2e6b 6579 7328 293a 0a20 2020 2020 2020  .keys():.       
+0001e2f0: 2020 2020 2020 2020 2020 2020 2063 6f6d               com
+0001e300: 7020 3d20 636f 6d70 6172 655f 6772 6169  p = compare_grai
+0001e310: 6e73 5f70 6169 7277 6973 6528 7365 676d  ns_pairwise(segm
+0001e320: 656e 7473 5f37 5b6c 6f63 616c 5f69 645d  ents_7[local_id]
+0001e330: 2c20 7365 676d 656e 7473 5f38 5b6c 6f63  , segments_8[loc
+0001e340: 616c 5f69 645d 290a 2020 2020 2020 2020  al_id]).        
+0001e350: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0001e360: 2e61 7373 6572 7454 7275 6528 636f 6d70  .assertTrue(comp
+0001e370: 2c20 6d73 673d 6622 7b63 6f6d 7021 727d  , msg=f"{comp!r}
+0001e380: 2229 0a                                  ").
```

### Comparing `mediagrains-3.5.2/tests/test_iobytes.py` & `mediagrains-4.0.0/tests/test_iobytes.py`

 * *Files identical despite different names*

### Comparing `mediagrains-3.5.2/tests/test_numpy_audiograin.py` & `mediagrains-4.0.0/tests/test_numpy_audiograin.py`

 * *Files 1% similar despite different names*

```diff
@@ -15,27 +15,27 @@
 #
 
 from unittest import IsolatedAsyncioTestCase
 
 import uuid
 from fractions import Fraction
 
-from mediagrains.numpy import AudioGrain
+from mediagrains.numpy.numpy_grains import AudioGrain
 from mediagrains.cogenums import (
     CogAudioFormat,
     COG_AUDIO_FORMAT_DEPTH,
     COG_AUDIO_FORMAT_DEPTH_S16,
     COG_AUDIO_FORMAT_DEPTH_S24,
     COG_AUDIO_FORMAT_DEPTH_S32,
     COG_AUDIO_IS_FLOAT,
     COG_AUDIO_IS_DOUBLE
 )
-from mediagrains import grain_constructors as bytesgrain_constructors
+import mediagrains.grains as bytesgrain_constructors
 
-from audio_utils import construct_audio_grain_data
+from .audio_utils import construct_audio_grain_data
 
 PCM_FORMATS = [
     CogAudioFormat.S16_PLANES,
     CogAudioFormat.S16_PAIRS,
     CogAudioFormat.S16_INTERLEAVED,
     CogAudioFormat.S24_PLANES,
     CogAudioFormat.S24_PAIRS,
@@ -151,15 +151,15 @@
         for fmt in PCM_FORMATS:
             for channels in range(1, 4):
                 with self.subTest(format=fmt, channels=channels):
                     test_data = self._create_test_data(fmt, channels)
                     bytes_grain = self._create_audio_grain(
                         fmt, test_data, constructor=bytesgrain_constructors.AudioGrain
                     )
-                    grain = AudioGrain(bytes_grain)
+                    grain = AudioGrain(grain=bytes_grain)
                     self._assert_channel_data_equal(grain, test_data)
 
     def test_mod_channel_data(self):
         """Check that modified channel data is reflected in the Grain's 'data'.
 
         Modifications to 24-bit format sample data is not reflected in the Grain's 'data'"""
         mod_formats = [fmt for fmt in PCM_FORMATS if fmt not in PCM_24BIT_FORMATS]
@@ -171,15 +171,15 @@
 
                     # Assign reversed data and then modify the channel data to the original
                     mod_grain = self._create_audio_grain(fmt, reversed_test_data)
                     for c in range(channels):
                         mod_grain.channel_data[c][:] = test_data[c][:]
 
                     # Create a new grain from the metadata and data
-                    grain = AudioGrain(mod_grain.meta, mod_grain.data)
+                    grain = AudioGrain(meta=mod_grain.meta, data=mod_grain.data)
 
                     self._assert_channel_data_equal(grain, test_data)
 
     async def test_audio_grain_async_await(self):
         """Check that grain data can be awaited"""
         fmt = CogAudioFormat.S16_INTERLEAVED
         test_data = self._create_test_data(fmt, 2)
```

### Comparing `mediagrains-3.5.2/tests/test_numpy_videograin.py` & `mediagrains-4.0.0/tests/test_numpy_videograin.py`

 * *Files 2% similar despite different names*

```diff
@@ -13,28 +13,28 @@
 # See the License for the specific language governing permissions and
 # limitations under the License.
 #
 
 from unittest import IsolatedAsyncioTestCase, mock
 
 import uuid
-from mediagrains.numpy import VideoGrain, VIDEOGRAIN
-from mediagrains.numpy.videograin import _dtype_from_cogframeformat
+from mediagrains.numpy.numpy_grains import VideoGrain
+from mediagrains.numpy.numpy_grains.VideoGrain import _dtype_from_cogframeformat
 from mediagrains.cogenums import (
     CogFrameFormat,
     CogFrameLayout,
     COG_FRAME_FORMAT_BYTES_PER_VALUE,
     COG_FRAME_FORMAT_H_SHIFT,
     COG_FRAME_FORMAT_V_SHIFT,
     COG_FRAME_IS_PLANAR,
     COG_FRAME_IS_PLANAR_RGB,
     COG_FRAME_FORMAT_ACTIVE_BITS)
 from mediagrains.gsf import loads, dumps
 from mediagrains.comparison import compare_grain
-from mediagrains import grain_constructors as bytesgrain_constructors
+import mediagrains.grains as bytesgrain_constructors
 from mediatimestamp.immutable import Timestamp, TimeRange
 from fractions import Fraction
 from copy import copy, deepcopy
 from typing import Tuple, Optional
 
 from itertools import chain, repeat
 
@@ -114,15 +114,15 @@
             return True
         else:
             raise Exception()
 
     def assertComponentsAreModifiable(self, grain):
         width = grain.width
         height = grain.height
-        fmt = grain.format
+        fmt = grain.cog_frame_format
 
         (hs, vs, _) = self._get_hs_vs_and_bps(fmt)
 
         # Test that changes to the component arrays are reflected in the main data array
         for y in range(0, 16):
             for x in range(0, 16):
                 grain.component_data[0][x, y] = (y*16 + x) & 0x3F
@@ -210,18 +210,18 @@
             self.assertEqual(grain.origin_timerange(), TimeRange.from_single_timestamp(ots))
             self.assertEqual(grain.sync_timestamp, sts)
             if not ignore_cts:
                 self.assertEqual(grain.creation_timestamp, cts)
             self.assertEqual(grain.rate, rate)
             self.assertEqual(grain.duration, 1/rate)
             self.assertEqual(grain.timelabels, [])
-            self.assertEqual(grain.format, fmt)
+            self.assertEqual(grain.cog_frame_format, fmt)
             self.assertEqual(grain.width, width)
             self.assertEqual(grain.height, height)
-            self.assertEqual(grain.layout, CogFrameLayout.FULL_FRAME)
+            self.assertEqual(grain.cog_frame_layout, CogFrameLayout.FULL_FRAME)
             self.assertEqual(grain.extension, 0)
             self.assertIsNone(grain.source_aspect_ratio)
             self.assertIsNone(grain.pixel_aspect_ratio)
 
             (hs, vs, bps) = self._get_hs_vs_and_bps(fmt)
 
             if COG_FRAME_IS_PLANAR(fmt):
@@ -407,15 +407,15 @@
                 output[y*32 + 4*x + 1] = next(yy) | (next(uu) << 10) | (next(yy) << 20)
                 output[y*32 + 4*x + 2] = next(vv) | (next(yy) << 10) | (next(uu) << 20)
                 output[y*32 + 4*x + 3] = next(yy) | (next(vv) << 10) | (next(yy) << 20)
 
         return output
 
     def write_test_pattern(self, grain):
-        fmt = grain.format
+        fmt = grain.cog_frame_format
 
         if self._is_rgb(fmt):
             (R, G, B) = self._test_pattern_rgb(fmt)
 
             grain.component_data.R[:, :] = R
             grain.component_data.G[:, :] = G
             grain.component_data.B[:, :] = B
@@ -433,16 +433,16 @@
             self.assertTrue(np.array_equal(a, b), msg="{} != {}".format(a, b))
         else:
             a = a.astype(np.dtype(np.int64))
             b = b.astype(np.dtype(np.int64))
             self.assertTrue(np.amax(np.absolute(a - b)) <= max_diff,
                             msg="{} - {} = {} (allowing up to {} difference)".format(a, b, a - b, max_diff))
 
-    def assertMatchesTestPattern(self, grain: VIDEOGRAIN, max_diff: Optional[int] = None):
-        fmt = grain.format
+    def assertMatchesTestPattern(self, grain: VideoGrain, max_diff: Optional[int] = None):
+        fmt = grain.cog_frame_format
 
         if self._is_rgb(fmt):
             (R, G, B) = self._test_pattern_rgb(fmt)
 
             self.assertArrayEqual(grain.component_data.R[:, :], R, max_diff=max_diff)
             self.assertArrayEqual(grain.component_data.G[:, :], G, max_diff=max_diff)
             self.assertArrayEqual(grain.component_data.B[:, :], B, max_diff=max_diff)
@@ -492,15 +492,15 @@
                     CogFrameFormat.xRGB,
                     CogFrameFormat.ABGR,
                     CogFrameFormat.xBGR,
                     CogFrameFormat.v216,
                     CogFrameFormat.v210]:
             with self.subTest(fmt=fmt):
                 with mock.patch.object(Timestamp, "get_time", return_value=cts):
-                    grain = VideoGrain(src_id, flow_id, origin_timestamp=ots, sync_timestamp=sts,
+                    grain = VideoGrain(src_id=src_id, flow_id=flow_id, origin_timestamp=ots, sync_timestamp=sts,
                                        cog_frame_format=fmt,
                                        width=1920, height=1080, cog_frame_layout=CogFrameLayout.FULL_FRAME)
 
                 self.assertIsVideoGrain(fmt)(grain)
 
                 if fmt is not CogFrameFormat.v210:
                     self.assertComponentsAreModifiable(grain)
@@ -509,15 +509,15 @@
         src_id = uuid.UUID("f18ee944-0841-11e8-b0b0-17cef04bd429")
         flow_id = uuid.UUID("f79ce4da-0841-11e8-9a5b-dfedb11bafeb")
         cts = Timestamp.from_tai_sec_nsec("417798915:0")
         ots = Timestamp.from_tai_sec_nsec("417798915:5")
         sts = Timestamp.from_tai_sec_nsec("417798915:10")
 
         with mock.patch.object(Timestamp, "get_time", return_value=cts):
-            grain = VideoGrain(src_id, flow_id,
+            grain = VideoGrain(src_id=src_id, flow_id=flow_id,
                                origin_timestamp=ConvertibleToTimestamp(ots),
                                sync_timestamp=ConvertibleToTimestamp(sts),
                                cog_frame_format=CogFrameFormat.S16_422_10BIT,
                                width=1920, height=1080, cog_frame_layout=CogFrameLayout.FULL_FRAME)
 
         self.assertIsVideoGrain(CogFrameFormat.S16_422_10BIT)(grain)
         self.assertComponentsAreModifiable(grain)
@@ -536,15 +536,15 @@
                     for x in range(0, 16):
                         _data[(i*16 + y)*16 + x] = x + (y << 4)
             return _data
 
         data_awaitable = _get_data()
 
         with mock.patch.object(Timestamp, "get_time", return_value=cts):
-            grain = VideoGrain(src_id, flow_id, origin_timestamp=ots, sync_timestamp=sts,
+            grain = VideoGrain(src_id=src_id, flow_id=flow_id, origin_timestamp=ots, sync_timestamp=sts,
                                cog_frame_format=CogFrameFormat.U8_444,
                                width=16, height=16, cog_frame_layout=CogFrameLayout.FULL_FRAME,
                                data=data_awaitable)
 
         self.assertIsNone(grain.data)
         self.assertEqual(len(grain.component_data), 0)
 
@@ -605,15 +605,15 @@
             CogFrameFormat.S16_444_10BIT_RGB,
             CogFrameFormat.S16_444_12BIT_RGB,
             CogFrameFormat.S32_444_RGB]
 
         for (fmt_in, fmt_out) in pairs_from(fmts):
             with self.subTest(fmt_in=fmt_in, fmt_out=fmt_out):
                 with mock.patch.object(Timestamp, "get_time", return_value=cts):
-                    grain_in = VideoGrain(src_id, flow_id, origin_timestamp=ots, sync_timestamp=sts,
+                    grain_in = VideoGrain(src_id=src_id, flow_id=flow_id, origin_timestamp=ots, sync_timestamp=sts,
                                           cog_frame_format=fmt_in,
                                           width=16, height=16, cog_frame_layout=CogFrameLayout.FULL_FRAME)
 
                 self.assertIsVideoGrain(fmt_in, width=16, height=16)(grain_in)
                 self.write_test_pattern(grain_in)
 
                 grain_out = grain_in.convert(fmt_out)
@@ -689,15 +689,15 @@
         flow_id = uuid.UUID("f79ce4da-0841-11e8-9a5b-dfedb11bafeb")
         cts = Timestamp.from_tai_sec_nsec("417798915:0")
         ots = Timestamp.from_tai_sec_nsec("417798915:5")
         sts = Timestamp.from_tai_sec_nsec("417798915:10")
 
         data = bytearray(11*1024*1024)
 
-        grain = VideoGrain({
+        grain = VideoGrain(meta={
             "grain": {
                 "grain_type": "video",
                 "source_id": src_id,
                 "flow_id": flow_id,
                 "origin_timestamp": ots,
                 "sync_timestamp": sts,
                 "creation_timestamp": cts,
@@ -736,15 +736,15 @@
                             "height": 1080,
                             "length": 2211840,
                             "offset": 8*1024*1024
                         },
                     ]
                 }
             }
-        }, data)
+        }, data=data)
 
         for y in range(0, 16):
             for x in range(0, 16):
                 grain.component_data[0][x, y] = (y*16 + x) & 0x3F
 
         for y in range(0, 16):
             for x in range(0, 8):
@@ -768,15 +768,15 @@
         src_id = uuid.UUID("f18ee944-0841-11e8-b0b0-17cef04bd429")
         flow_id = uuid.UUID("f79ce4da-0841-11e8-9a5b-dfedb11bafeb")
         cts = Timestamp.from_tai_sec_nsec("417798915:0")
         ots = Timestamp.from_tai_sec_nsec("417798915:5")
         sts = Timestamp.from_tai_sec_nsec("417798915:10")
 
         with mock.patch.object(Timestamp, "get_time", return_value=cts):
-            grain = VideoGrain(src_id, flow_id, origin_timestamp=ots, sync_timestamp=sts,
+            grain = VideoGrain(src_id=src_id, flow_id=flow_id, origin_timestamp=ots, sync_timestamp=sts,
                                cog_frame_format=CogFrameFormat.S16_422_10BIT,
                                width=1920, height=1080, cog_frame_layout=CogFrameLayout.FULL_FRAME)
 
         grain.data[0] = 0x1BBC
 
         clone = copy(grain)
 
@@ -790,15 +790,15 @@
         src_id = uuid.UUID("f18ee944-0841-11e8-b0b0-17cef04bd429")
         flow_id = uuid.UUID("f79ce4da-0841-11e8-9a5b-dfedb11bafeb")
         cts = Timestamp.from_tai_sec_nsec("417798915:0")
         ots = Timestamp.from_tai_sec_nsec("417798915:5")
         sts = Timestamp.from_tai_sec_nsec("417798915:10")
 
         with mock.patch.object(Timestamp, "get_time", return_value=cts):
-            grain = VideoGrain(src_id, flow_id, origin_timestamp=ots, sync_timestamp=sts,
+            grain = VideoGrain(src_id=src_id, flow_id=flow_id, origin_timestamp=ots, sync_timestamp=sts,
                                cog_frame_format=CogFrameFormat.S16_422_10BIT,
                                width=1920, height=1080, cog_frame_layout=CogFrameLayout.FULL_FRAME)
 
         grain.data[0] = 0x1BBC
 
         clone = deepcopy(grain)
 
@@ -810,18 +810,18 @@
 
     def test_length(self):
         """Check that the length override provides the length in bytes"""
         src_id = uuid.UUID("f18ee944-0841-11e8-b0b0-17cef04bd429")
         flow_id = uuid.UUID("f79ce4da-0841-11e8-9a5b-dfedb11bafeb")
         cts = Timestamp.from_tai_sec_nsec("417798915:0")
         with mock.patch.object(Timestamp, "get_time", return_value=cts):
-            grain = bytesgrain_constructors.VideoGrain(src_id, flow_id,
+            grain = bytesgrain_constructors.VideoGrain(src_id=src_id, flow_id=flow_id,
                                                        cog_frame_format=CogFrameFormat.S16_422_10BIT,
                                                        width=480, height=270)
-            np_grain = VideoGrain(grain).convert(CogFrameFormat.v210)
+            np_grain = VideoGrain(grain=grain).convert(CogFrameFormat.v210)
 
         self.assertEqual(np_grain.length, (480+47)//48*128*270)
 
     def test_video_grain_gsf_encode_decode(self):
         src_id = uuid.UUID("f18ee944-0841-11e8-b0b0-17cef04bd429")
         flow_id = uuid.UUID("f79ce4da-0841-11e8-9a5b-dfedb11bafeb")
         cts = Timestamp.from_tai_sec_nsec("417798915:0")
@@ -858,22 +858,22 @@
                     CogFrameFormat.xRGB,
                     CogFrameFormat.ABGR,
                     CogFrameFormat.xBGR,
                     CogFrameFormat.v216,
                     CogFrameFormat.v210]:
             with self.subTest(fmt=fmt):
                 with mock.patch.object(Timestamp, "get_time", return_value=cts):
-                    grain = VideoGrain(src_id, flow_id, origin_timestamp=ots, sync_timestamp=sts,
+                    grain = VideoGrain(src_id=src_id, flow_id=flow_id, origin_timestamp=ots, sync_timestamp=sts,
                                        cog_frame_format=fmt,
                                        width=16, height=16, cog_frame_layout=CogFrameLayout.FULL_FRAME)
 
                 self.write_test_pattern(grain)
 
                 (head, segments) = loads(dumps([grain]))
 
                 self.assertEqual(len(segments), 1)
                 self.assertIn(1, segments)
                 self.assertEqual(len(segments[1]), 1)
 
-                new_grain = VideoGrain(segments[1][0])
+                new_grain = VideoGrain(grain=segments[1][0])
                 comp = compare_grain(new_grain, grain)
                 self.assertTrue(comp, msg=str(comp))
```

### Comparing `mediagrains-3.5.2/tests/test_patterngenerators.py` & `mediagrains-4.0.0/tests/test_patterngenerators.py`

 * *Files 0% similar despite different names*

```diff
@@ -116,15 +116,15 @@
         cog_frame_format=CogFrameFormat.U8_444,
         rate=Fraction(25, 1)
     ):
         self.assertEqual(grain.source_id, src_id)
         self.assertEqual(grain.flow_id, flow_id)
         self.assertEqual(grain.origin_timestamp, ts)
         self.assertEqual(grain.sync_timestamp, ts)
-        self.assertEqual(grain.format, cog_frame_format)
+        self.assertEqual(grain.cog_frame_format, cog_frame_format)
         self.assertEqual(grain.rate, rate)
 
 
 class TestLumaSteps(VideoPatternGeneratorTestCase):
     def assertIsLumaStepsGrain(
         self,
         grain,
@@ -516,15 +516,15 @@
         channels=2,
         samples=None
     ):
         self.assertEqual(grain.source_id, src_id)
         self.assertEqual(grain.flow_id, flow_id)
         self.assertEqual(grain.origin_timestamp, ts)
         self.assertEqual(grain.sync_timestamp, ts)
-        self.assertEqual(grain.format, cog_audio_format)
+        self.assertEqual(grain.cog_audio_format, cog_audio_format)
         self.assertEqual(grain.rate, grain_rate)
         self.assertEqual(grain.sample_rate, sample_rate)
         self.assertEqual(grain.channels, channels)
         if samples is None:
             samples = sample_rate // grain_rate
         self.assertEqual(grain.samples, samples)
```

### Comparing `mediagrains-3.5.2/tests/test_video_psnr.py` & `mediagrains-4.0.0/tests/test_video_psnr.py`

 * *Files 1% similar despite different names*

```diff
@@ -14,15 +14,15 @@
 # limitations under the License.
 #
 
 from unittest import TestCase
 from sys import version_info
 import uuid
 
-from mediagrains import VideoGrain
+from mediagrains.grains import VideoGrain
 from mediagrains.cogenums import CogFrameFormat
 from mediagrains.comparison import compute_psnr
 
 SRC_ID = uuid.UUID("f18ee944-0841-11e8-b0b0-17cef04bd429")
 FLOW_ID = uuid.UUID("f79ce4da-0841-11e8-9a5b-dfedb11bafeb")
 
 
@@ -39,27 +39,27 @@
     CogFrameFormat.S16_444: (2, (4096, 60160-4096), (32768, 57344), (32768, 57344), 16),
     CogFrameFormat.S16_422: (2, (4096, 60160-4096), (32768, 57344), (32768, 57344), 16),
     CogFrameFormat.S16_420: (2, (4096, 60160-4096), (32768, 57344), (32768, 57344), 16),
 }
 
 
 def _create_grain(cog_frame_format):
-    return VideoGrain(SRC_ID, FLOW_ID,
+    return VideoGrain(src_id=SRC_ID, flow_id=FLOW_ID,
                       cog_frame_format=cog_frame_format,
                       width=480, height=270)
 
 
 def _set_colour_bars(vg, noise_mask=0xffff):
     """The code, except for the noise_mask, was copied from testsignalgenerator. It was duplicated here to keep
        the unit tests isolated.
 
     :params vg: A video GRAIN
     :params noise_mask: A mask applied to the colour bar line pixels
     """
-    cog_frame_format = vg.format
+    cog_frame_format = vg.cog_frame_format
     intensity = 0.75
 
     _bpp = pixel_ranges[cog_frame_format][0]
     _steps = 8
     bs = 16 - pixel_ranges[cog_frame_format][4]
 
     values = [
```

