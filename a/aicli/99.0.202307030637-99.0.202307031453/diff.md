# Comparing `tmp/aicli-99.0.202307030637-py3-none-any.whl.zip` & `tmp/aicli-99.0.202307031453-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,28 +1,28 @@
-Zip file size: 42791 bytes, number of entries: 26
--rw-r--r--  2.0 unx    95902 b- defN 23-Jul-03 06:36 ailib/__init__.py
--rw-r--r--  2.0 unx    75160 b- defN 23-Jul-03 06:36 ailib/cli.py
--rw-r--r--  2.0 unx      501 b- defN 23-Jul-03 06:36 ailib/agent/cluster-deployment-sno.yaml
--rw-r--r--  2.0 unx      501 b- defN 23-Jul-03 06:36 ailib/agent/cluster-deployment.yaml
--rw-r--r--  2.0 unx      123 b- defN 23-Jul-03 06:36 ailib/agent/cluster-image-set.yaml
--rw-r--r--  2.0 unx      369 b- defN 23-Jul-03 06:36 ailib/agent/infraenv.yaml
--rw-r--r--  2.0 unx      168 b- defN 23-Jul-03 06:36 ailib/agent/pull-secret.yaml
--rw-r--r--  2.0 unx      125 b- defN 23-Jul-03 06:36 ailib/agent/registries.conf.templ
--rw-r--r--  2.0 unx    11793 b- defN 23-Jul-03 06:36 ailib/common/__init__.py
--rw-r--r--  2.0 unx      748 b- defN 23-Jul-03 06:36 ailib/common/registries.conf.templ
--rw-r--r--  2.0 unx       58 b- defN 23-Jul-03 06:36 ailib/common/relocate/00-relocate-namespace.yaml
--rw-r--r--  2.0 unx      847 b- defN 23-Jul-03 06:36 ailib/common/relocate/10-relocate-ip.yaml
--rw-r--r--  2.0 unx       85 b- defN 23-Jul-03 06:36 ailib/common/relocate/97-relocate-sa.yaml
--rw-r--r--  2.0 unx      254 b- defN 23-Jul-03 06:36 ailib/common/relocate/98-relocate-binding.yaml
--rw-r--r--  2.0 unx      200 b- defN 23-Jul-03 06:36 ailib/common/relocate/99-ovn.yaml
--rw-r--r--  2.0 unx     1083 b- defN 23-Jul-03 06:36 ailib/common/relocate/99-relocate-job.yaml
--rw-r--r--  2.0 unx      752 b- defN 23-Jul-03 06:36 ailib/common/relocate/hack.ign
--rw-r--r--  2.0 unx      196 b- defN 23-Jul-03 06:36 ailib/common/relocate/hack.sh
--rw-r--r--  2.0 unx      169 b- defN 23-Jul-03 06:36 ailib/common/relocate/hack_sno.sh
--rw-r--r--  2.0 unx      728 b- defN 23-Jul-03 06:36 ailib/common/relocate/relocate-ip.sh
--rw-r--r--  2.0 unx     8542 b- defN 23-Jul-03 06:36 ailib/kfish/__init__.py
--rw-r--r--  2.0 unx      352 b- defN 23-Jul-03 06:37 aicli-99.0.202307030637.dist-info/METADATA
--rw-r--r--  2.0 unx       92 b- defN 23-Jul-03 06:37 aicli-99.0.202307030637.dist-info/WHEEL
--rw-r--r--  2.0 unx       40 b- defN 23-Jul-03 06:37 aicli-99.0.202307030637.dist-info/entry_points.txt
--rw-r--r--  2.0 unx        6 b- defN 23-Jul-03 06:37 aicli-99.0.202307030637.dist-info/top_level.txt
--rw-rw-r--  2.0 unx     2306 b- defN 23-Jul-03 06:37 aicli-99.0.202307030637.dist-info/RECORD
-26 files, 201100 bytes uncompressed, 38991 bytes compressed:  80.6%
+Zip file size: 42928 bytes, number of entries: 26
+-rw-r--r--  2.0 unx    95497 b- defN 23-Jul-03 14:51 ailib/__init__.py
+-rw-r--r--  2.0 unx    75160 b- defN 23-Jul-03 14:51 ailib/cli.py
+-rw-r--r--  2.0 unx      501 b- defN 23-Jul-03 14:51 ailib/agent/cluster-deployment-sno.yaml
+-rw-r--r--  2.0 unx      501 b- defN 23-Jul-03 14:51 ailib/agent/cluster-deployment.yaml
+-rw-r--r--  2.0 unx      123 b- defN 23-Jul-03 14:51 ailib/agent/cluster-image-set.yaml
+-rw-r--r--  2.0 unx      369 b- defN 23-Jul-03 14:51 ailib/agent/infraenv.yaml
+-rw-r--r--  2.0 unx      168 b- defN 23-Jul-03 14:51 ailib/agent/pull-secret.yaml
+-rw-r--r--  2.0 unx      125 b- defN 23-Jul-03 14:51 ailib/agent/registries.conf.templ
+-rw-r--r--  2.0 unx    11666 b- defN 23-Jul-03 14:51 ailib/common/__init__.py
+-rw-r--r--  2.0 unx      748 b- defN 23-Jul-03 14:51 ailib/common/registries.conf.templ
+-rw-r--r--  2.0 unx       58 b- defN 23-Jul-03 14:51 ailib/common/relocate/00-relocate-namespace.yaml
+-rw-r--r--  2.0 unx      847 b- defN 23-Jul-03 14:51 ailib/common/relocate/10-relocate-ip.yaml
+-rw-r--r--  2.0 unx       85 b- defN 23-Jul-03 14:51 ailib/common/relocate/97-relocate-sa.yaml
+-rw-r--r--  2.0 unx      254 b- defN 23-Jul-03 14:51 ailib/common/relocate/98-relocate-binding.yaml
+-rw-r--r--  2.0 unx      200 b- defN 23-Jul-03 14:51 ailib/common/relocate/99-ovn.yaml
+-rw-r--r--  2.0 unx     1083 b- defN 23-Jul-03 14:51 ailib/common/relocate/99-relocate-job.yaml
+-rw-r--r--  2.0 unx      752 b- defN 23-Jul-03 14:51 ailib/common/relocate/hack.ign
+-rw-r--r--  2.0 unx      196 b- defN 23-Jul-03 14:51 ailib/common/relocate/hack.sh
+-rw-r--r--  2.0 unx      169 b- defN 23-Jul-03 14:51 ailib/common/relocate/hack_sno.sh
+-rw-r--r--  2.0 unx      728 b- defN 23-Jul-03 14:51 ailib/common/relocate/relocate-ip.sh
+-rw-r--r--  2.0 unx     9748 b- defN 23-Jul-03 14:51 ailib/kfish/__init__.py
+-rw-r--r--  2.0 unx      352 b- defN 23-Jul-03 14:53 aicli-99.0.202307031453.dist-info/METADATA
+-rw-r--r--  2.0 unx       92 b- defN 23-Jul-03 14:53 aicli-99.0.202307031453.dist-info/WHEEL
+-rw-r--r--  2.0 unx       40 b- defN 23-Jul-03 14:53 aicli-99.0.202307031453.dist-info/entry_points.txt
+-rw-r--r--  2.0 unx        6 b- defN 23-Jul-03 14:53 aicli-99.0.202307031453.dist-info/top_level.txt
+-rw-rw-r--  2.0 unx     2306 b- defN 23-Jul-03 14:53 aicli-99.0.202307031453.dist-info/RECORD
+26 files, 201774 bytes uncompressed, 39128 bytes compressed:  80.6%
```

## zipnote {}

```diff
@@ -57,23 +57,23 @@
 
 Filename: ailib/common/relocate/relocate-ip.sh
 Comment: 
 
 Filename: ailib/kfish/__init__.py
 Comment: 
 
-Filename: aicli-99.0.202307030637.dist-info/METADATA
+Filename: aicli-99.0.202307031453.dist-info/METADATA
 Comment: 
 
-Filename: aicli-99.0.202307030637.dist-info/WHEEL
+Filename: aicli-99.0.202307031453.dist-info/WHEEL
 Comment: 
 
-Filename: aicli-99.0.202307030637.dist-info/entry_points.txt
+Filename: aicli-99.0.202307031453.dist-info/entry_points.txt
 Comment: 
 
-Filename: aicli-99.0.202307030637.dist-info/top_level.txt
+Filename: aicli-99.0.202307031453.dist-info/top_level.txt
 Comment: 
 
-Filename: aicli-99.0.202307030637.dist-info/RECORD
+Filename: aicli-99.0.202307031453.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## ailib/__init__.py

```diff
@@ -1,9 +1,9 @@
 from assisted_service_client import ApiClient, Configuration, api, models
-from ailib.common import warning, error, info, get_token, match_mac, valid_uuid
+from ailib.common import warning, error, info, get_token, match_mac
 from ailib.kfish import Redfish
 import base64
 from datetime import datetime
 import http.server
 from ipaddress import ip_network
 import json
 import os
@@ -47,21 +47,17 @@
         hostname = host.get('name', '')
         if hostnames and hostname not in hostnames:
             warning(f"host {hostname} not in {hostnames}. Skipping")
             continue
         bmc_url = host.get('bmc_url') or host.get('url')
         bmc_user = host.get('bmc_user') or host.get('user') or overrides.get('bmc_user')
         bmc_password = host.get('bmc_password') or host.get('password') or overrides.get('bmc_password')
-        bmc_model = host.get('bmc_model') or host.get('model') or overrides.get('model') or overrides.get('bmc_model')
-        bmc_model = bmc_model or 'dell'
         bmc_reset = host.get('reset') or host.get('bmc_reset') or overrides.get('bmc_reset', False)
-        if bmc_url is not None and 'redfish/v1/Systems/' in bmc_url and valid_uuid(os.path.basename(bmc_url)):
-            bmc_user, bmc_password = 'fake', 'fake'
-        if bmc_url is not None and bmc_user is not None and bmc_password is not None:
-            red = Redfish(bmc_url, bmc_user, bmc_password, model=bmc_model, debug=debug)
+        if bmc_url is not None:
+            red = Redfish(bmc_url, bmc_user, bmc_password, debug=debug)
             if bmc_reset:
                 red.reset()
                 sleep(240)
             msg = host['name'] if 'name' in host else f"with url {bmc_url}"
             info(f"Booting Host {msg}")
             try:
                 red.set_iso(iso_url)
```

## ailib/common/__init__.py

```diff
@@ -7,15 +7,14 @@
 import os
 import socket
 from shutil import copy2, which
 from subprocess import call
 import sys
 from tempfile import TemporaryDirectory
 from time import time
-from uuid import UUID
 import urllib3
 urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)
 import urllib.request
 import yaml
 
 # colors = {'blue': '36', 'red': '31', 'green': '32', 'yellow': '33', 'pink': '35', 'white': '37'}
 
@@ -136,22 +135,14 @@
     for interface in json.loads(host['inventory'])['interfaces']:
         if interface.get('mac_address', '') == mac:
             found = True
             break
     return found
 
 
-def valid_uuid(uuid):
-    try:
-        UUID(uuid)
-        return True
-    except:
-        return False
-
-
 def get_ip():
     s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
     s.connect(("8.8.8.8", 80))
     result = s.getsockname()[0]
     s.close()
     return result
```

## ailib/kfish/__init__.py

```diff
@@ -1,43 +1,84 @@
 from urllib.parse import urlparse
 from urllib.request import urlopen, Request
 import base64
 import json
 import ssl
 import sys
+from uuid import UUID
+
+
+def valid_uuid(uuid):
+    try:
+        UUID(uuid)
+        return True
+    except:
+        return False
+
+
+def virtual(url):
+    p = urlparse(url)
+    if not p.path.startswith('/redfish/v1/Systems'):
+        return False
+    path = p.path.replace('/redfish/v1/Systems/', '')
+    return valid_uuid(path) or len(path.split('/')) == 2
 
 
 class Redfish(object):
-    def __init__(self, url, user='root', password='calvin', insecure=True, model='dell', debug=False):
+    def __init__(self, url, user='root', password='calvin', insecure=True, debug=False, model=None):
         self.debug = debug
-        self.model = model.lower()
+        self.headers = {'Content-Type': 'application/json', 'Accept': 'application/json'}
+        self.context = ssl.create_default_context()
+        if insecure:
+            self.context.check_hostname = False
+            self.context.verify_mode = ssl.CERT_NONE
         url = url.replace('idrac-virtualmedia', 'https').replace('ilo5-virtualmedia', 'https')
+        if virtual(url):
+            self.model = 'fake'
+            if user is None or password is None:
+                user, password = 'fake', 'fake'
+        else:
+            self.model = model or self.get_model(url)
         if '://' not in url:
             if self.model in ['hp', 'hpe', 'supermicro']:
                 url = f"https://{url}/redfish/v1/Systems/1"
             elif self.model == 'dell':
                 url = f"https://{url}/redfish/v1/Systems/System.Embedded.1"
+                if user is None or password is None:
+                    user, password = 'root', 'calvin'
             else:
                 print(f"Invalid url {url}")
                 sys.exit(0)
-        p = urlparse(url)
         self.url = url
         if self.debug:
             print(f"Using base url {self.url}")
+        p = urlparse(url)
+        self.baseurl = f"{p.scheme}://{p.netloc}"
         self.user = user
         self.password = password
-        self.headers = {'Content-Type': 'application/json', 'Accept': 'application/json'}
         credentials = base64.b64encode(bytes(f'{user}:{password}', 'ascii')).decode('utf-8')
         self.headers["Authorization"] = f"Basic {credentials}"
-        self.baseurl = f"{p.scheme}://{p.netloc}"
         self.manager_url = None
-        self.context = ssl.create_default_context()
-        if insecure:
-            self.context.check_hostname = False
-            self.context.verify_mode = ssl.CERT_NONE
+
+    def get_model(self, url):
+        if '://' not in url:
+            url = f"https://{url}"
+        p = urlparse(url)
+        headers = {'Accept': 'application/json'}
+        request = Request(f"https://{p.netloc}/redfish/v1", headers=headers)
+        oem = json.loads(urlopen(request, context=self.context).read())['Oem']
+        if 'Dell' in oem:
+            model = "dell"
+        elif 'Hpe' in oem:
+            model = "hpe"
+        elif 'Supermicro' in oem:
+            model = "supermicro"
+        else:
+            model = 'N/A'
+        return model
 
     def get_manager_url(self):
         request = Request(self.url, headers=self.headers)
         response = json.loads(urlopen(request, context=self.context).read())
         return f"{self.baseurl}{response['Links']['ManagedBy'][0]['@odata.id']}"
 
     def get_iso_url(self):
```

## Comparing `aicli-99.0.202307030637.dist-info/RECORD` & `aicli-99.0.202307031453.dist-info/RECORD`

 * *Files 14% similar despite different names*

```diff
@@ -1,26 +1,26 @@
-ailib/__init__.py,sha256=eu2b479OaAASpBSxIa9lTHyddIRq58Qs7WQfmcKDpCI,95902
+ailib/__init__.py,sha256=3BNE2yl0dHtbZmYmBjqRM71Q6WHD_h_wnXrbqvil-Ug,95497
 ailib/cli.py,sha256=7vIjwi2Q92OfimTvyaF7rLRzGd1h7SBkIV1Oi94crBw,75160
 ailib/agent/cluster-deployment-sno.yaml,sha256=6NnAqpG7MBXg8uET1l5MW9AqxRfAM-kLPxRmj1TP7Hs,501
 ailib/agent/cluster-deployment.yaml,sha256=6NnAqpG7MBXg8uET1l5MW9AqxRfAM-kLPxRmj1TP7Hs,501
 ailib/agent/cluster-image-set.yaml,sha256=mgdW0mxChZW-T2QXF240ytri9xTZJP9A8YUiv0gQPzs,123
 ailib/agent/infraenv.yaml,sha256=b-K3w1SV-DeYizIq6ukD4OAjJPgNaffcbmpUwcodbbc,369
 ailib/agent/pull-secret.yaml,sha256=FacV1lU-kR7v1e6O2LpD9lvh0Jgtg8uAtiWCTi5vCCE,168
 ailib/agent/registries.conf.templ,sha256=iGX-B_zyNsieHV8fiHQLv7je5piHhLmLVejkaRtQWd8,125
-ailib/common/__init__.py,sha256=ikfsTbTIaM4klC2zwDcHaYWO-_bedqtCruEEgxRGXr8,11793
+ailib/common/__init__.py,sha256=BydbdF-1orqmVNOhzoKosVNvqV3nQpgfkwpESVT8Jv8,11666
 ailib/common/registries.conf.templ,sha256=s2d8IdYqjevLQtrOC0zO8SY3a5BcESDhJ7-VubcpUQM,748
 ailib/common/relocate/00-relocate-namespace.yaml,sha256=GcYRATh9o2xR091jMydeM9-jgnugYsNg3r9kzgCir8I,58
 ailib/common/relocate/10-relocate-ip.yaml,sha256=qKHvnn1-xyvROjuyl1f4TXqItGmERJ8GqizzstocOo0,847
 ailib/common/relocate/97-relocate-sa.yaml,sha256=cUOmmQJG9Yzhad1ZnW_utpqLEWtRgl7qUX-pmc508rI,85
 ailib/common/relocate/98-relocate-binding.yaml,sha256=rZmKz4Ev9-VtJVMT8CbkpcIWJ6ZfK9Qy809b5DK3KHw,254
 ailib/common/relocate/99-ovn.yaml,sha256=x5ActE4VnDw0s2YZr2RV9bRijttztaiHktkSm9neQII,200
 ailib/common/relocate/99-relocate-job.yaml,sha256=SsufiIEoeNJzZ8bGZtlYI14_V08_xnuHCt6ufeKRxfE,1083
 ailib/common/relocate/hack.ign,sha256=LvCDvzZyC5Apzik-OmJZMBG4MlkBsCm91OMt7NBwJtI,752
 ailib/common/relocate/hack.sh,sha256=X-FqHruR9IzlaUVtJc_NQnOyyG_zp45iUcb0pTRsgE0,196
 ailib/common/relocate/hack_sno.sh,sha256=gLVNgk0A7gu-MJnO2qV-ZeIKxSUYPm_Wtxix5EDqAkc,169
 ailib/common/relocate/relocate-ip.sh,sha256=hD-z8wDk-ZDIcmxo384pGXqxmEkPXT5icM7A_h1in0Q,728
-ailib/kfish/__init__.py,sha256=nct00nAOaZR-rOuI1HHtVKrYT8PpDFWm3A3wa8H7xCQ,8542
-aicli-99.0.202307030637.dist-info/METADATA,sha256=GABDBejfrDfaRwm85ttA0KNCfKODRvHLdZgZjOthJTs,352
-aicli-99.0.202307030637.dist-info/WHEEL,sha256=pkctZYzUS4AYVn6dJ-7367OJZivF2e8RA9b_ZBjif18,92
-aicli-99.0.202307030637.dist-info/entry_points.txt,sha256=7uqZ_1svrJHY6WVurmsOhlEb_FiRFEgdEnKj_7BuT0Q,40
-aicli-99.0.202307030637.dist-info/top_level.txt,sha256=uCyBeu-We3_G6jzv4SY05Rg3VHcZ2_Dr7dcFduB8Wsw,6
-aicli-99.0.202307030637.dist-info/RECORD,,
+ailib/kfish/__init__.py,sha256=0ji4IfqXH4T9svsyMwU0KeTGO3e4Z8JpdhQw8WSGUDg,9748
+aicli-99.0.202307031453.dist-info/METADATA,sha256=lZ7agLGC27hr-sclCTuiceoKI5NGtJ9P_SmtXlfepK8,352
+aicli-99.0.202307031453.dist-info/WHEEL,sha256=pkctZYzUS4AYVn6dJ-7367OJZivF2e8RA9b_ZBjif18,92
+aicli-99.0.202307031453.dist-info/entry_points.txt,sha256=7uqZ_1svrJHY6WVurmsOhlEb_FiRFEgdEnKj_7BuT0Q,40
+aicli-99.0.202307031453.dist-info/top_level.txt,sha256=uCyBeu-We3_G6jzv4SY05Rg3VHcZ2_Dr7dcFduB8Wsw,6
+aicli-99.0.202307031453.dist-info/RECORD,,
```

